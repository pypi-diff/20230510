# Comparing `tmp/PyMPX-1.2.4-py3-none-any.whl.zip` & `tmp/PyMPX-1.2.5-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,16 +1,16 @@
-Zip file size: 203365 bytes, number of entries: 45
+Zip file size: 203408 bytes, number of entries: 45
 -rw-rw-rw-  2.0 fat      103 b- defN 22-Jul-20 07:49 pympx/__init__.py
--rw-rw-rw-  2.0 fat       20 b- defN 22-Sep-22 10:33 pympx/_version.py
+-rw-rw-rw-  2.0 fat       20 b- defN 23-May-10 14:09 pympx/_version.py
 -rw-rw-rw-  2.0 fat     4312 b- defN 22-Jul-11 15:43 pympx/etl.py
 -rw-rw-rw-  2.0 fat     4901 b- defN 22-Jul-11 15:43 pympx/exceptions.py
 -rw-rw-rw-  2.0 fat    13157 b- defN 22-Jul-11 15:43 pympx/jupyter.py
 -rw-rw-rw-  2.0 fat    12486 b- defN 22-Jul-11 15:43 pympx/logconfig.py
--rw-rw-rw-  2.0 fat   265668 b- defN 22-Sep-16 10:13 pympx/low_level_utilities.py
--rw-rw-rw-  2.0 fat   482525 b- defN 22-Sep-22 09:20 pympx/pympx.py
+-rw-rw-rw-  2.0 fat   265773 b- defN 23-May-10 13:29 pympx/low_level_utilities.py
+-rw-rw-rw-  2.0 fat   482569 b- defN 23-May-10 13:29 pympx/pympx.py
 -rw-rw-rw-  2.0 fat   104961 b- defN 22-Jul-11 15:43 pympx/queuing.py
 -rw-rw-rw-  2.0 fat    10542 b- defN 22-Jul-11 15:43 pympx/utils.py
 -rw-rw-rw-  2.0 fat    12493 b- defN 22-Jul-11 15:43 pympx/validation.py
 -rw-rw-rw-  2.0 fat      152 b- defN 22-Jul-11 15:43 pympx/importer_scripts/Add_Time_Elements_to_Site.eimp
 -rw-rw-rw-  2.0 fat     1097 b- defN 22-Jul-11 15:43 pympx/importer_scripts/BulkImport.eimp
 -rw-rw-rw-  2.0 fat     1069 b- defN 22-Jul-11 15:43 pympx/importer_scripts/EmpowerImport.eimp
 -rw-rw-rw-  2.0 fat     3308 b- defN 22-Jul-11 15:43 pympx/importer_scripts/ExportAllDimensionElements.eimp
@@ -34,14 +34,14 @@
 -rw-rw-rw-  2.0 fat      822 b- defN 22-Jul-11 15:43 pympx/importer_scripts/ImportDimensionFields.eimp
 -rw-rw-rw-  2.0 fat      745 b- defN 22-Jul-11 15:43 pympx/importer_scripts/ImportDimensionStructure.eimp
 -rw-rw-rw-  2.0 fat      888 b- defN 22-Jul-11 15:43 pympx/importer_scripts/ImportSecurity.eimp
 -rw-rw-rw-  2.0 fat      731 b- defN 22-Jul-11 15:43 pympx/importer_scripts/ImportTimeDimensionElements.eimp
 -rw-rw-rw-  2.0 fat     1082 b- defN 22-Jul-11 15:43 pympx/importer_scripts/LoadCommentaryData.eimp
 -rw-rw-rw-  2.0 fat     1096 b- defN 22-Jul-11 15:43 pympx/importer_scripts/LoadCommentaryText.eimp
 -rw-rw-rw-  2.0 fat      314 b- defN 22-Jul-11 15:43 pympx/importer_scripts/Version.eimp
--rw-rw-rw-  2.0 fat     1076 b- defN 22-Sep-22 10:33 PyMPX-1.2.4.dist-info/LICENSE.txt
--rw-rw-rw-  2.0 fat     1537 b- defN 22-Sep-22 10:33 PyMPX-1.2.4.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 22-Sep-22 10:33 PyMPX-1.2.4.dist-info/WHEEL
--rw-rw-rw-  2.0 fat       30 b- defN 22-Sep-22 10:33 PyMPX-1.2.4.dist-info/eager_resources.txt
--rw-rw-rw-  2.0 fat        6 b- defN 22-Sep-22 10:33 PyMPX-1.2.4.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     4212 b- defN 22-Sep-22 10:33 PyMPX-1.2.4.dist-info/RECORD
-45 files, 949496 bytes uncompressed, 196499 bytes compressed:  79.3%
+-rw-rw-rw-  2.0 fat     1076 b- defN 23-May-10 14:09 PyMPX-1.2.5.dist-info/LICENSE.txt
+-rw-rw-rw-  2.0 fat     1603 b- defN 23-May-10 14:09 PyMPX-1.2.5.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-May-10 14:09 PyMPX-1.2.5.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat       30 b- defN 23-May-10 14:09 PyMPX-1.2.5.dist-info/eager_resources.txt
+-rw-rw-rw-  2.0 fat        6 b- defN 23-May-10 14:09 PyMPX-1.2.5.dist-info/top_level.txt
+-rw-rw-r--  2.0 fat     4212 b- defN 23-May-10 14:09 PyMPX-1.2.5.dist-info/RECORD
+45 files, 949711 bytes uncompressed, 196542 bytes compressed:  79.3%
```

## zipnote {}

```diff
@@ -111,26 +111,26 @@
 
 Filename: pympx/importer_scripts/LoadCommentaryText.eimp
 Comment: 
 
 Filename: pympx/importer_scripts/Version.eimp
 Comment: 
 
-Filename: PyMPX-1.2.4.dist-info/LICENSE.txt
+Filename: PyMPX-1.2.5.dist-info/LICENSE.txt
 Comment: 
 
-Filename: PyMPX-1.2.4.dist-info/METADATA
+Filename: PyMPX-1.2.5.dist-info/METADATA
 Comment: 
 
-Filename: PyMPX-1.2.4.dist-info/WHEEL
+Filename: PyMPX-1.2.5.dist-info/WHEEL
 Comment: 
 
-Filename: PyMPX-1.2.4.dist-info/eager_resources.txt
+Filename: PyMPX-1.2.5.dist-info/eager_resources.txt
 Comment: 
 
-Filename: PyMPX-1.2.4.dist-info/top_level.txt
+Filename: PyMPX-1.2.5.dist-info/top_level.txt
 Comment: 
 
-Filename: PyMPX-1.2.4.dist-info/RECORD
+Filename: PyMPX-1.2.5.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## pympx/_version.py

```diff
@@ -1 +1 @@
-__version__= '1.2.4'
+__version__= '1.2.5'
```

## pympx/low_level_utilities.py

```diff
@@ -4686,15 +4686,15 @@
     
     site_security_folder = os.path.join(security_folder,_sitename_for_security)    
     os.makedirs(site_security_folder,mode = 555, exist_ok = True)
     
     fernet = None
 
     
-    #Cycle through the subfolders, tryign to read an encrypted password from a file we have access to
+    #Cycle through the subfolders, trying to read an encrypted password from a file we have access to
 
     for d in os.listdir(site_security_folder):
         if os.path.isdir(os.path.join(site_security_folder,d)):
             #Try to read the security key file
             security_key_file = os.path.join(site_security_folder,d,'key1')
             user_file = os.path.join(site_security_folder,d,'key2')
             password_file = os.path.join(site_security_folder,d,'key3')
@@ -4708,21 +4708,22 @@
                     windows_encrypted_password = fernet.decrypt(f.read())
 
                 #The fernet encrypted files are still windows encrypted after being decrypted
                 #windows encrypted strings will be used in the empower scripts
                 with open(user_file,mode='rb') as f:
                     windows_encrypted_user = fernet.decrypt(f.read())    
                     
+                created_security_dir = os.path.join(site_security_folder,d)
+                
                 break    
             except:
                 fernet = None
                 windows_encrypted_password = None
                 windows_encrypted_user = None
-
-    created_security_dir = None
+                created_security_dir = None
                 
     #If we couldn't get access            
     if fernet is None:
         import ntsecuritycon
         import win32security
 
         created_security_dir = os.path.join(site_security_folder,datetime.datetime.now().strftime('key%Y%m%d%H%M%S'))
```

## pympx/pympx.py

```diff
@@ -1177,28982 +1177,28985 @@
 00004980: 730d 0a20 2020 2020 2020 2020 2020 2069  s..            i
 00004990: 6620 7365 6375 7269 7479 5f64 6972 2069  f security_dir i
 000049a0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
 000049b0: 2020 2020 2020 2020 2020 2020 2073 6875               shu
 000049c0: 7469 6c2e 726d 7472 6565 2873 6563 7572  til.rmtree(secur
 000049d0: 6974 795f 6469 7229 0d0a 2020 2020 2020  ity_dir)..      
 000049e0: 2020 2020 2020 7072 696e 7428 2745 7272        print('Err
-000049f0: 6f72 2063 7265 6174 6520 6120 7369 7465  or create a site
-00004a00: 3a20 696e 636f 7272 6563 7420 7375 7065  : incorrect supe
-00004a10: 7276 6f72 206e 616d 6520 6f72 2070 6173  rvor name or pas
-00004a20: 7377 6f72 6427 290d 0a20 2020 2020 2020  sword')..       
-00004a30: 2020 2020 2072 6169 7365 206d 7065 782e       raise mpex.
-00004a40: 456d 706f 7765 7249 6d70 6f72 7465 7245  EmpowerImporterE
-00004a50: 7272 6f72 2827 4572 726f 7220 6372 6561  rror('Error crea
-00004a60: 7465 2061 2073 6974 653a 2069 6e63 6f72  te a site: incor
-00004a70: 7265 6374 2073 7570 6572 766f 7220 6e61  rect supervor na
-00004a80: 6d65 206f 7220 7061 7373 776f 7264 2729  me or password')
-00004a90: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00004aa0: 2e6e 756d 6265 725f 6f66 5f75 6e69 745f  .number_of_unit_
-00004ab0: 6469 6d65 6e73 696f 6e73 3d6e 756d 6265  dimensions=numbe
-00004ac0: 725f 6f66 5f75 6e69 745f 6469 6d65 6e73  r_of_unit_dimens
-00004ad0: 696f 6e73 0d0a 2020 2020 2020 2020 6966  ions..        if
-00004ae0: 2073 656c 662e 6e75 6d62 6572 5f6f 665f   self.number_of_
-00004af0: 756e 6974 5f64 696d 656e 7369 6f6e 7320  unit_dimensions 
-00004b00: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-00004b10: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00004b20: 2020 2020 2020 2020 2020 2020 5f6e 756d              _num
-00004b30: 6265 725f 6f66 5f75 6e69 745f 6469 6d65  ber_of_unit_dime
-00004b40: 6e73 696f 6e73 203d 2073 6974 655f 6465  nsions = site_de
-00004b50: 7461 696c 735b 274e 756d 6265 7220 6f66  tails['Number of
-00004b60: 2075 6e69 7420 6469 6d65 6e73 696f 6e73   unit dimensions
-00004b70: 275d 0d0a 2020 2020 2020 2020 2020 2020  ']..            
-00004b80: 2020 2020 5f6e 756d 6265 725f 6f66 5f75      _number_of_u
-00004b90: 6e69 745f 6469 6d65 6e73 696f 6e73 203d  nit_dimensions =
-00004ba0: 2069 6e74 285f 6e75 6d62 6572 5f6f 665f   int(_number_of_
-00004bb0: 756e 6974 5f64 696d 656e 7369 6f6e 7329  unit_dimensions)
-00004bc0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00004bd0: 2020 2020 7365 6c66 2e6e 756d 6265 725f      self.number_
-00004be0: 6f66 5f75 6e69 745f 6469 6d65 6e73 696f  of_unit_dimensio
-00004bf0: 6e73 3d5f 6e75 6d62 6572 5f6f 665f 756e  ns=_number_of_un
-00004c00: 6974 5f64 696d 656e 7369 6f6e 730d 0a20  it_dimensions.. 
-00004c10: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00004c20: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
-00004c30: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00004c40: 730d 0a0d 0a20 2020 2020 2020 2069 6620  s....        if 
-00004c50: 7365 6c66 2e6e 756d 6265 725f 6f66 5f75  self.number_of_u
-00004c60: 6e69 745f 6469 6d65 6e73 696f 6e73 2069  nit_dimensions i
-00004c70: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-00004c80: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00004c90: 4572 726f 7228 2753 6974 6520 6f62 6a65  Error('Site obje
-00004ca0: 6374 2077 6173 2069 6e69 7469 616c 6973  ct was initialis
-00004cb0: 6564 2077 6974 686f 7574 2061 206e 756d  ed without a num
-00004cc0: 6265 725f 6f66 5f75 6e69 745f 6469 6d65  ber_of_unit_dime
-00004cd0: 6e73 696f 6e73 2070 6172 616d 6574 6572  nsions parameter
-00004ce0: 2c20 616e 6420 7468 6520 6e75 6d62 6572  , and the number
-00004cf0: 206f 6620 756e 6974 2064 696d 656e 7369   of unit dimensi
-00004d00: 6f6e 7320 636f 756c 6420 6e6f 7420 6265  ons could not be
-00004d10: 2072 6561 6420 6672 6f6d 2074 6865 2073   read from the s
-00004d20: 6974 652e 2045 6974 6865 7220 6368 616e  ite. Either chan
-00004d30: 6765 2079 6f75 7220 636f 6465 2074 6f20  ge your code to 
-00004d40: 6361 6c6c 2053 6974 6528 2920 7769 7468  call Site() with
-00004d50: 2074 6865 2070 6172 616d 6574 6572 206e   the parameter n
-00004d60: 756d 6265 725f 6f66 5f75 6e69 745f 6469  umber_of_unit_di
-00004d70: 6d65 6e73 696f 6e73 2073 6574 206f 7220  mensions set or 
-00004d80: 7570 6772 6164 6520 746f 2061 206c 6174  upgrade to a lat
-00004d90: 6572 2076 6572 7369 6f6e 206f 6620 496d  er version of Im
-00004da0: 706f 7274 6572 2067 7265 6174 6572 2074  porter greater t
-00004db0: 6861 6e20 6f72 2065 7175 616c 2074 6f20  han or equal to 
-00004dc0: 392e 352e 2e38 3535 2729 0d0a 0d0a 2020  9.5..855')....  
-00004dd0: 2020 2020 2020 7365 6c66 2e64 6566 696e        self.defin
-00004de0: 6974 696f 6e20 3d20 5f53 6974 6544 6566  ition = _SiteDef
-00004df0: 696e 6974 696f 6e4d 616e 6970 756c 6174  initionManipulat
-00004e00: 6f72 2873 6974 653d 7365 6c66 290d 0a0d  or(site=self)...
-00004e10: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
-00004e20: 696d 656e 7369 6f6e 7320 3d20 7b2a 2a7b  imensions = {**{
-00004e30: 6e3a 4469 6d65 6e73 696f 6e28 7369 7465  n:Dimension(site
-00004e40: 3d73 656c 662c 696e 6465 783d 6e29 2066  =self,index=n) f
-00004e50: 6f72 206e 2069 6e20 7261 6e67 6528 7365  or n in range(se
-00004e60: 6c66 2e6e 756d 6265 725f 6f66 5f75 6e69  lf.number_of_uni
-00004e70: 745f 6469 6d65 6e73 696f 6e73 297d 2c2a  t_dimensions)},*
-00004e80: 2a7b 6e3a 4469 6d65 6e73 696f 6e28 7369  *{n:Dimension(si
-00004e90: 7465 3d73 656c 662c 696e 6465 783d 6e29  te=self,index=n)
-00004ea0: 2066 6f72 206e 2069 6e20 5b38 2c39 2c31   for n in [8,9,1
-00004eb0: 302c 3131 2c31 325d 7d7d 0d0a 0d0a 2020  0,11,12]}}....  
-00004ec0: 2020 2020 2020 6966 2073 656c 662e 7374        if self.st
-00004ed0: 6f72 6167 655f 7479 7065 203d 3d20 2773  orage_type == 's
-00004ee0: 716c 273a 0d0a 2020 2020 2020 2020 2020  ql':..          
-00004ef0: 2020 2353 6861 7264 206f 6e20 6d65 7472    #Shard on metr
-00004f00: 6963 2066 6f72 2073 716c 2073 6974 6573  ic for sql sites
-00004f10: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00004f20: 6c66 2e73 746f 7261 6765 5f64 696d 656e  lf.storage_dimen
-00004f30: 7369 6f6e 5f69 6e64 6578 203d 2038 0d0a  sion_index = 8..
-00004f40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00004f50: 2e65 6c65 6d65 6e74 735f 7065 725f 7374  .elements_per_st
-00004f60: 6f72 6167 655f 6469 6d65 6e73 696f 6e20  orage_dimension 
-00004f70: 3d20 310d 0a20 2020 2020 2020 2065 6c73  = 1..        els
-00004f80: 653a 0d0a 0d0a 2020 2020 2020 2020 2020  e:....          
-00004f90: 2020 7365 6c66 2e73 746f 7261 6765 5f64    self.storage_d
-00004fa0: 696d 656e 7369 6f6e 5f69 6e64 6578 3d73  imension_index=s
-00004fb0: 746f 7261 6765 5f64 696d 656e 7369 6f6e  torage_dimension
-00004fc0: 5f69 6e64 6578 0d0a 2020 2020 2020 2020  _index..        
-00004fd0: 2020 2020 6966 2073 656c 662e 7374 6f72      if self.stor
-00004fe0: 6167 655f 6469 6d65 6e73 696f 6e5f 696e  age_dimension_in
-00004ff0: 6465 7820 6973 204e 6f6e 653a 0d0a 2020  dex is None:..  
-00005000: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00005010: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00005020: 2020 2020 2020 2020 5f73 746f 7261 6765          _storage
-00005030: 5f64 696d 656e 7369 6f6e 5f69 6e64 6578  _dimension_index
-00005040: 203d 2073 6974 655f 6465 7461 696c 735b   = site_details[
-00005050: 2753 746f 7261 6765 2064 696d 656e 7369  'Storage dimensi
-00005060: 6f6e 2069 6e64 6578 275d 0d0a 2020 2020  on index']..    
-00005070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005080: 5f73 746f 7261 6765 5f64 696d 656e 7369  _storage_dimensi
-00005090: 6f6e 5f69 6e64 6578 203d 2069 6e74 285f  on_index = int(_
-000050a0: 7374 6f72 6167 655f 6469 6d65 6e73 696f  storage_dimensio
-000050b0: 6e5f 696e 6465 7829 0d0a 0d0a 2020 2020  n_index)....    
-000050c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000050d0: 7365 6c66 2e73 746f 7261 6765 5f64 696d  self.storage_dim
-000050e0: 656e 7369 6f6e 5f69 6e64 6578 3d5f 7374  ension_index=_st
-000050f0: 6f72 6167 655f 6469 6d65 6e73 696f 6e5f  orage_dimension_
-00005100: 696e 6465 780d 0a20 2020 2020 2020 2020  index..         
-00005110: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-00005120: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
-00005130: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00005140: 730d 0a0d 0a20 2020 2020 2020 2020 2020  s....           
-00005150: 2073 656c 662e 656c 656d 656e 7473 5f70   self.elements_p
-00005160: 6572 5f73 746f 7261 6765 5f64 696d 656e  er_storage_dimen
-00005170: 7369 6f6e 3d65 6c65 6d65 6e74 735f 7065  sion=elements_pe
-00005180: 725f 7374 6f72 6167 655f 6469 6d65 6e73  r_storage_dimens
-00005190: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
-000051a0: 2069 6620 7365 6c66 2e65 6c65 6d65 6e74   if self.element
-000051b0: 735f 7065 725f 7374 6f72 6167 655f 6469  s_per_storage_di
-000051c0: 6d65 6e73 696f 6e20 6973 204e 6f6e 653a  mension is None:
-000051d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000051e0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-000051f0: 2020 2020 2020 2020 2020 2020 5f73 746f              _sto
-00005200: 7261 6765 5f6d 756c 7469 706c 6963 6974  rage_multiplicit
-00005210: 7920 3d20 7369 7465 5f64 6574 6169 6c73  y = site_details
-00005220: 5b27 5374 6f72 6167 6520 6d75 6c74 6970  ['Storage multip
-00005230: 6c69 6369 7479 275d 0d0a 2020 2020 2020  licity']..      
-00005240: 2020 2020 2020 2020 2020 2020 2020 5f73                _s
-00005250: 746f 7261 6765 5f6d 756c 7469 706c 6963  torage_multiplic
-00005260: 6974 7920 3d20 696e 7428 5f73 746f 7261  ity = int(_stora
-00005270: 6765 5f6d 756c 7469 706c 6963 6974 7929  ge_multiplicity)
-00005280: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00005290: 2020 2020 2020 2020 7365 6c66 2e65 6c65          self.ele
-000052a0: 6d65 6e74 735f 7065 725f 7374 6f72 6167  ments_per_storag
-000052b0: 655f 6469 6d65 6e73 696f 6e3d 5f73 746f  e_dimension=_sto
-000052c0: 7261 6765 5f6d 756c 7469 706c 6963 6974  rage_multiplicit
-000052d0: 790d 0a20 2020 2020 2020 2020 2020 2020  y..             
-000052e0: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
-000052f0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-00005300: 2020 2020 2020 2020 2070 6173 730d 0a0d           pass...
-00005310: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
-00005320: 2020 2020 2020 2020 2020 205f 6461 7461             _data
-00005330: 5f6c 6f63 6b69 6e67 5f64 696d 656e 7369  _locking_dimensi
-00005340: 6f6e 5f69 6e64 6578 203d 2073 6974 655f  on_index = site_
-00005350: 6465 7461 696c 735b 2744 6174 6120 6c6f  details['Data lo
-00005360: 636b 696e 6720 6469 6d65 6e73 696f 6e20  cking dimension 
-00005370: 696e 6465 7827 5d0d 0a20 2020 2020 2020  index']..       
-00005380: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00005390: 2020 2020 2020 2020 2020 205f 6461 7461             _data
-000053a0: 5f6c 6f63 6b69 6e67 5f64 696d 656e 7369  _locking_dimensi
-000053b0: 6f6e 5f69 6e64 6578 203d 2069 6e74 285f  on_index = int(_
-000053c0: 6461 7461 5f6c 6f63 6b69 6e67 5f64 696d  data_locking_dim
-000053d0: 656e 7369 6f6e 5f69 6e64 6578 290d 0a20  ension_index).. 
-000053e0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000053f0: 7420 5661 6c75 6545 7272 6f72 3a0d 0a20  t ValueError:.. 
-00005400: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-00005410: 6461 7461 5f6c 6f63 6b69 6e67 5f64 696d  data_locking_dim
-00005420: 656e 7369 6f6e 5f69 6e64 6578 203d 204e  ension_index = N
-00005430: 6f6e 650d 0a0d 0a20 2020 2020 2020 2020  one....         
-00005440: 2020 2073 656c 662e 6461 7461 5f6c 6f63     self.data_loc
-00005450: 6b69 6e67 5f64 696d 656e 7369 6f6e 5f69  king_dimension_i
-00005460: 6e64 6578 3d5f 6461 7461 5f6c 6f63 6b69  ndex=_data_locki
-00005470: 6e67 5f64 696d 656e 7369 6f6e 5f69 6e64  ng_dimension_ind
-00005480: 6578 0d0a 2020 2020 2020 2020 6578 6365  ex..        exce
-00005490: 7074 204b 6579 4572 726f 723a 0d0a 2020  pt KeyError:..  
-000054a0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-000054b0: 6174 615f 6c6f 636b 696e 675f 6469 6d65  ata_locking_dime
-000054c0: 6e73 696f 6e5f 696e 6465 783d 4e6f 6e65  nsion_index=None
-000054d0: 0d0a 0d0a 2020 2020 2020 2020 7472 793a  ....        try:
-000054e0: 0d0a 2020 2020 2020 2020 2020 2020 5f64  ..            _d
-000054f0: 6566 6175 6c74 5f6d 6561 7375 7265 203d  efault_measure =
-00005500: 2073 6974 655f 6465 7461 696c 735b 2744   site_details['D
-00005510: 6566 6175 6c74 206d 6561 7375 7265 275d  efault measure']
-00005520: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00005530: 7365 6c66 2e64 6566 6175 6c74 5f6d 6561  self.default_mea
-00005540: 7375 7265 3d5f 6465 6661 756c 745f 6d65  sure=_default_me
-00005550: 6173 7572 650d 0a20 2020 2020 2020 2065  asure..        e
-00005560: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
-00005570: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00005580: 662e 6465 6661 756c 745f 6d65 6173 7572  f.default_measur
-00005590: 653d 4e6f 6e65 0d0a 0d0a 2020 2020 2020  e=None....      
-000055a0: 2020 6966 2073 656c 662e 7374 6f72 6167    if self.storag
-000055b0: 655f 7479 7065 203d 3d20 2773 716c 273a  e_type == 'sql':
-000055c0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-000055d0: 6c66 2e5f 6461 7461 5f66 696c 6573 5f64  lf._data_files_d
-000055e0: 6972 203d 204e 6f6e 650d 0a20 2020 2020  ir = None..     
-000055f0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00005600: 2020 2020 2020 7365 6c66 2e5f 6461 7461        self._data
-00005610: 5f66 696c 6573 5f64 6972 203d 206f 732e  _files_dir = os.
-00005620: 7061 7468 2e6a 6f69 6e28 6f73 2e70 6174  path.join(os.pat
-00005630: 682e 6469 726e 616d 6528 7365 6c66 2e5f  h.dirname(self._
-00005640: 7061 7468 292c 2744 6174 6120 4669 6c65  path),'Data File
-00005650: 7327 290d 0a0d 0a20 2020 2020 2020 2073  s')....        s
-00005660: 656c 662e 5f6c 6f61 6465 7273 203d 207b  elf._loaders = {
-00005670: 7d0d 0a0d 0a20 2020 2020 2020 2073 656c  }....        sel
-00005680: 662e 6c6f 6767 696e 675f 7175 6575 6520  f.logging_queue 
-00005690: 3d20 6c6f 6767 696e 675f 7175 6575 650d  = logging_queue.
-000056a0: 0a0d 0a0d 0a20 2020 2020 2020 2023 5765  .....        #We
-000056b0: 2075 7365 2061 2070 7265 6669 7820 736f   use a prefix so
-000056c0: 2074 6861 7420 6475 616c 2073 6974 6520   that dual site 
-000056d0: 6c6f 6164 7320 6361 6e20 7370 6563 6966  loads can specif
-000056e0: 7920 7768 6174 2073 6974 6520 7468 6579  y what site they
-000056f0: 2061 7265 206c 6f61 6469 6e67 2077 6974   are loading wit
-00005700: 6820 7468 6520 7361 6d65 2073 6c6f 630d  h the same sloc.
-00005710: 0a20 2020 2020 2020 2069 6620 7072 6566  .        if pref
-00005720: 6978 3a0d 0a20 2020 2020 2020 2020 2020  ix:..           
-00005730: 2073 656c 662e 7072 6566 6978 203d 2070   self.prefix = p
-00005740: 7265 6669 780d 0a20 2020 2020 2020 2065  refix..        e
-00005750: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00005760: 2020 6966 2073 656c 662e 7374 6f72 6167    if self.storag
-00005770: 655f 7479 7065 203d 3d20 2773 716c 273a  e_type == 'sql':
-00005780: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005790: 2020 2355 7365 2074 6865 2066 6972 7374    #Use the first
-000057a0: 2035 2063 6861 7261 6374 6572 7320 6f66   5 characters of
-000057b0: 2074 6865 2064 6174 6162 6173 6520 6e61   the database na
-000057c0: 6d65 2069 6620 6e6f 2070 7265 6669 7820  me if no prefix 
-000057d0: 7761 7320 7370 6563 6966 6965 640d 0a20  was specified.. 
-000057e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000057f0: 656c 662e 7072 6566 6978 203d 7365 6c66  elf.prefix =self
-00005800: 2e64 625f 6e61 6d65 5b30 3a35 5d0d 0a20  .db_name[0:5].. 
-00005810: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00005820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005830: 2020 2355 7365 2074 6865 2066 6972 7374    #Use the first
-00005840: 2035 2063 6861 7261 6374 6572 7320 6f66   5 characters of
-00005850: 2074 6865 202e 656b 7320 6669 6c65 206e   the .eks file n
-00005860: 616d 6520 6966 206e 6f20 7072 6566 6978  ame if no prefix
-00005870: 2077 6173 2073 7065 6369 6669 6564 0d0a   was specified..
-00005880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005890: 7365 6c66 2e70 7265 6669 7820 3d20 6f73  self.prefix = os
-000058a0: 2e70 6174 682e 7370 6c69 7465 7874 286f  .path.splitext(o
-000058b0: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
-000058c0: 7365 6c66 2e5f 7061 7468 2929 5b30 5d5b  self._path))[0][
-000058d0: 303a 355d 0d0a 0d0a 2020 2020 2020 2020  0:5]....        
-000058e0: 7365 6c66 2e65 6d70 6f77 6572 5f69 6d70  self.empower_imp
-000058f0: 6f72 7465 725f 6578 6563 7574 6162 6c65  orter_executable
-00005900: 3d6f 732e 7061 7468 2e61 6273 7061 7468  =os.path.abspath
-00005910: 2865 6d70 6f77 6572 5f69 6d70 6f72 7465  (empower_importe
-00005920: 725f 6578 6563 7574 6162 6c65 290d 0a0d  r_executable)...
-00005930: 0a20 2020 2020 2020 2073 656c 662e 5f76  .        self._v
-00005940: 6965 7770 6f69 6e74 7320 3d20 5f56 6965  iewpoints = _Vie
-00005950: 7770 6f69 6e74 7347 6574 7465 7228 7369  wpointsGetter(si
-00005960: 7465 3d73 656c 6629 0d0a 0d0a 0d0a 0d0a  te=self)........
-00005970: 2020 2020 6465 6620 7369 7465 5f66 696c      def site_fil
-00005980: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
-00005990: 2020 7265 7475 726e 2073 656c 662e 5f73    return self._s
-000059a0: 6974 655f 6c6f 6361 746f 720d 0a20 2020  ite_locator..   
-000059b0: 200d 0a20 2020 2064 6566 2075 7365 726e   ..    def usern
-000059c0: 616d 6528 7365 6c66 293a 0d0a 2020 2020  ame(self):..    
-000059d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000059e0: 5f65 6e63 7279 7074 6564 5f75 7365 720d  _encrypted_user.
-000059f0: 0a20 2020 200d 0a20 2020 2064 6566 2070  .    ..    def p
-00005a00: 6173 7377 6f72 6428 7365 6c66 293a 0d0a  assword(self):..
-00005a10: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00005a20: 656c 662e 5f65 6e63 7279 7074 6564 5f70  elf._encrypted_p
-00005a30: 7764 0d0a 2020 2020 2020 2020 0d0a 2020  wd..        ..  
-00005a40: 2020 6465 6620 6c6f 6164 6572 2873 656c    def loader(sel
-00005a50: 662c 6e61 6d65 2c73 6f75 7263 653d 4e6f  f,name,source=No
-00005a60: 6e65 2c64 656c 7461 3d54 7275 652c 6964  ne,delta=True,id
-00005a70: 656e 7469 6669 6572 5f63 6f6c 756d 6e73  entifier_columns
-00005a80: 3d4e 6f6e 652c 656d 706f 7765 725f 7065  =None,empower_pe
-00005a90: 7269 6f64 5f74 7970 6520 3d20 6c6c 752e  riod_type = llu.
-00005aa0: 454d 504f 5745 525f 4d4f 4e54 485f 434f  EMPOWER_MONTH_CO
-00005ab0: 4e53 5441 4e54 293a 0d0a 2020 2020 2020  NSTANT):..      
-00005ac0: 2020 2727 2743 7265 6174 6520 6120 6e61    '''Create a na
-00005ad0: 6d65 6420 6c6f 6164 6572 2066 6f72 2074  med loader for t
-00005ae0: 6869 7320 7369 7465 2e0d 0a20 2020 2020  his site...     
-00005af0: 2020 204c 6f61 6465 7273 206e 6565 6420     Loaders need 
-00005b00: 746f 2062 6520 6e61 6d65 6420 746f 2065  to be named to e
-00005b10: 6e73 7572 6520 7468 6520 6275 6c6b 206c  nsure the bulk l
-00005b20: 6f61 6420 7072 6f63 6573 7320 776f 726b  oad process work
-00005b30: 7320 636f 7272 6563 746c 790d 0a20 2020  s correctly..   
-00005b40: 2020 2020 2027 2727 0d0a 2020 2020 2020       '''..      
-00005b50: 2020 6966 2069 6465 6e74 6966 6965 725f    if identifier_
-00005b60: 636f 6c75 6d6e 7320 6973 204e 6f6e 653a  columns is None:
-00005b70: 0d0a 2020 2020 2020 2020 2020 2020 6964  ..            id
-00005b80: 656e 7469 6669 6572 5f63 6f6c 756d 6e73  entifier_columns
-00005b90: 203d 205b 5d0d 0a0d 0a20 2020 2020 2020   = []....       
-00005ba0: 206c 3d4c 6f61 6465 7228 736f 7572 6365   l=Loader(source
-00005bb0: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
-00005bc0: 736f 7572 6365 0d0a 2020 2020 2020 2020  source..        
-00005bd0: 2020 2020 2020 2020 2c73 6974 6520 2020          ,site   
-00005be0: 2020 2020 2020 2020 2020 2020 203d 2073               = s
-00005bf0: 656c 660d 0a20 2020 2020 2020 2020 2020  elf..           
-00005c00: 2020 2020 202c 6c6f 6767 696e 675f 7175       ,logging_qu
-00005c10: 6575 6520 2020 2020 2020 3d20 7365 6c66  eue       = self
-00005c20: 2e6c 6f67 6769 6e67 5f71 7565 7565 0d0a  .logging_queue..
-00005c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005c40: 2c64 656c 7461 2020 2020 2020 2020 2020  ,delta          
-00005c50: 2020 2020 203d 2064 656c 7461 0d0a 2020       = delta..  
-00005c60: 2020 2020 2020 2020 2020 2020 2020 2c69                ,i
-00005c70: 6465 6e74 6966 6965 725f 636f 6c75 6d6e  dentifier_column
-00005c80: 7320 203d 2069 6465 6e74 6966 6965 725f  s  = identifier_
-00005c90: 636f 6c75 6d6e 730d 0a20 2020 2020 2020  columns..       
-00005ca0: 2020 2020 2020 2020 202c 6e61 6d65 2020           ,name  
-00005cb0: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
-00005cc0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-00005cd0: 2020 2020 2020 2c65 6d70 6f77 6572 5f70        ,empower_p
-00005ce0: 6572 696f 645f 7479 7065 203d 2065 6d70  eriod_type = emp
-00005cf0: 6f77 6572 5f70 6572 696f 645f 7479 7065  ower_period_type
-00005d00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00005d10: 2020 290d 0a20 2020 2020 2020 2073 656c    )..        sel
-00005d20: 662e 5f6c 6f61 6465 7273 5b6e 616d 655d  f._loaders[name]
-00005d30: 3d6c 0d0a 2020 2020 2020 2020 7265 7475  =l..        retu
-00005d40: 726e 206c 0d0a 0d0a 2020 2020 4070 726f  rn l....    @pro
-00005d50: 7065 7274 790d 0a20 2020 2064 6566 206c  perty..    def l
-00005d60: 6f61 6465 7273 2873 656c 6629 3a0d 0a20  oaders(self):.. 
-00005d70: 2020 2020 2020 2027 2727 5468 6520 6e61         '''The na
-00005d80: 6d65 6420 6c6f 6164 6572 7320 666f 7220  med loaders for 
-00005d90: 7468 6973 2073 6974 652e 0d0a 2020 2020  this site...    
-00005da0: 2020 2020 4120 3a63 6c61 7373 3a60 7e70      A :class:`~p
-00005db0: 796d 7078 2e4c 6f61 6465 7260 0d0a 2020  ympx.Loader`..  
-00005dc0: 2020 2020 2020 4c6f 6164 6572 7320 6e65        Loaders ne
-00005dd0: 6564 2074 6f20 6265 206e 616d 6564 2074  ed to be named t
-00005de0: 6f20 656e 7375 7265 2074 6865 2062 756c  o ensure the bul
-00005df0: 6b20 6c6f 6164 2070 726f 6365 7373 2077  k load process w
-00005e00: 6f72 6b73 2063 6f72 7265 6374 6c79 0d0a  orks correctly..
-00005e10: 2020 2020 2020 2020 2727 270d 0a20 2020          '''..   
-00005e20: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00005e30: 2e5f 6c6f 6164 6572 730d 0a0d 0a20 2020  ._loaders....   
-00005e40: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-00005e50: 6465 6620 6469 6d65 6e73 696f 6e73 2873  def dimensions(s
-00005e60: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
-00005e70: 2727 4120 6469 6374 696f 6e61 7279 206c  ''A dictionary l
-00005e80: 696b 6520 6f62 6a65 6374 206f 6620 7a65  ike object of ze
-00005e90: 726f 2069 6e64 6578 6564 2064 696d 656e  ro indexed dimen
-00005ea0: 7369 6f6e 7320 666f 7220 7468 6520 7369  sions for the si
-00005eb0: 7465 0d0a 0d0a 2020 2020 2020 2020 3e3e  te....        >>
-00005ec0: 3e20 2343 7265 6174 6520 6120 7265 6665  > #Create a refe
-00005ed0: 7265 6e63 6520 7468 6520 7468 6520 6375  rence the the cu
-00005ee0: 7374 6f6d 6572 2064 696d 656e 7369 6f6e  stomer dimension
-00005ef0: 2c20 6173 7375 6d69 6e67 2069 7420 6973  , assuming it is
-00005f00: 2074 6865 2066 6972 7374 2064 696d 656e   the first dimen
-00005f10: 7369 6f6e 2069 6e20 7468 6520 7369 7465  sion in the site
-00005f20: 2060 6d79 7369 7465 600d 0a20 2020 2020   `mysite`..     
-00005f30: 2020 203e 3e3e 2063 7573 746f 6d65 7220     >>> customer 
-00005f40: 3d20 6d79 7369 7465 2e64 696d 656e 7369  = mysite.dimensi
-00005f50: 6f6e 735b 305d 0d0a 2020 2020 2020 2020  ons[0]..        
-00005f60: 2727 270d 0a0d 0a20 2020 2020 2020 2072  '''....        r
-00005f70: 6574 7572 6e20 7365 6c66 2e5f 6469 6d65  eturn self._dime
-00005f80: 6e73 696f 6e73 0d0a 0d0a 2020 2020 4070  nsions....    @p
-00005f90: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-00005fa0: 2076 6965 7770 6f69 6e74 7328 7365 6c66   viewpoints(self
-00005fb0: 293a 0d0a 2020 2020 2020 2020 2727 2741  ):..        '''A
-00005fc0: 2064 6963 7469 6f6e 6172 792d 6c69 6b65   dictionary-like
-00005fd0: 206f 626a 6563 7420 6f66 2073 686f 7274   object of short
-00005fe0: 6e61 6d65 2069 6e64 6578 6564 2060 5669  name indexed `Vi
-00005ff0: 6577 706f 696e 7460 7320 666f 7220 7468  ewpoint`s for th
-00006000: 6973 2073 6974 650d 0a20 2020 2020 2020  is site..       
-00006010: 2027 2727 0d0a 0d0a 2020 2020 2020 2020   '''....        
-00006020: 7265 7475 726e 2073 656c 662e 5f76 6965  return self._vie
-00006030: 7770 6f69 6e74 730d 0a0d 0a20 2020 2040  wpoints....    @
-00006040: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-00006050: 6620 6d65 7472 6963 2873 656c 6629 3a0d  f metric(self):.
-00006060: 0a20 2020 2020 2020 2027 2727 4765 7473  .        '''Gets
-00006070: 2074 6865 206d 6574 7269 6320 6469 6d65   the metric dime
-00006080: 6e73 696f 6e20 692e 652e 202e 6469 6d65  nsion i.e. .dime
-00006090: 6e73 696f 6e73 5b39 5d20 2727 270d 0a20  nsions[9] '''.. 
-000060a0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000060b0: 6c66 2e64 696d 656e 7369 6f6e 735b 385d  lf.dimensions[8]
-000060c0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-000060d0: 790d 0a20 2020 2064 6566 206d 6f64 6528  y..    def mode(
-000060e0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-000060f0: 2727 2747 6574 7320 7468 6520 6d6f 6465  '''Gets the mode
-00006100: 2064 696d 656e 7369 6f6e 2069 2e65 2e20   dimension i.e. 
-00006110: 2e64 696d 656e 7369 6f6e 735b 395d 2027  .dimensions[9] '
-00006120: 2727 0d0a 2020 2020 2020 2020 7265 7475  ''..        retu
-00006130: 726e 2073 656c 662e 6469 6d65 6e73 696f  rn self.dimensio
-00006140: 6e73 5b39 5d0d 0a0d 0a20 2020 2040 7072  ns[9]....    @pr
-00006150: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-00006160: 6261 7365 2873 656c 6629 3a0d 0a20 2020  base(self):..   
-00006170: 2020 2020 2027 2727 4765 7473 2074 6865       '''Gets the
-00006180: 2062 6173 6520 6469 6d65 6e73 696f 6e20   base dimension 
-00006190: 692e 652e 202e 6469 6d65 6e73 696f 6e73  i.e. .dimensions
-000061a0: 5b31 305d 2027 2727 0d0a 0d0a 2020 2020  [10] '''....    
-000061b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000061c0: 6469 6d65 6e73 696f 6e73 5b31 305d 0d0a  dimensions[10]..
-000061d0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-000061e0: 0a20 2020 2064 6566 2074 696d 6528 7365  .    def time(se
-000061f0: 6c66 293a 0d0a 2020 2020 2020 2020 2727  lf):..        ''
-00006200: 2747 6574 7320 7468 6520 7469 6d65 2064  'Gets the time d
-00006210: 696d 656e 7369 6f6e 2069 2e65 2e20 2e64  imension i.e. .d
-00006220: 696d 656e 7369 6f6e 735b 3131 5d20 2727  imensions[11] ''
-00006230: 270d 0a20 2020 2020 2020 2072 6574 7572  '..        retur
-00006240: 6e20 7365 6c66 2e64 696d 656e 7369 6f6e  n self.dimension
-00006250: 735b 3131 5d0d 0a0d 0a20 2020 2040 7072  s[11]....    @pr
-00006260: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-00006270: 7472 616e 7366 6f72 6d61 7469 6f6e 2873  transformation(s
-00006280: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
-00006290: 2727 4765 7473 2074 6865 2074 7261 6e73  ''Gets the trans
-000062a0: 666f 726d 6174 696f 6e20 6469 6d65 6e73  formation dimens
-000062b0: 696f 6e20 692e 652e 202e 6469 6d65 6e73  ion i.e. .dimens
-000062c0: 696f 6e73 5b31 325d 2027 2727 0d0a 2020  ions[12] '''..  
-000062d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000062e0: 662e 6469 6d65 6e73 696f 6e73 5b31 325d  f.dimensions[12]
-000062f0: 0d0a 0d0a 2020 2020 2355 7469 6c69 7479  ....    #Utility
-00006300: 2070 726f 7065 7274 6965 7320 2d20 636f   properties - co
-00006310: 6d6d 6f6e 6c79 2075 7365 6420 7073 6575  mmonly used pseu
-00006320: 646f 6e79 6d73 0d0a 2020 2020 4070 726f  donyms..    @pro
-00006330: 7065 7274 790d 0a20 2020 2064 6566 2069  perty..    def i
-00006340: 6e64 6963 6174 6f72 2873 656c 6629 3a0d  ndicator(self):.
-00006350: 0a20 2020 2020 2020 2027 2727 2041 2073  .        ''' A s
-00006360: 796e 6f6e 796d 2066 6f72 2060 2e6d 6574  ynonym for `.met
-00006370: 7269 6360 2727 270d 0a20 2020 2020 2020  ric`'''..       
-00006380: 2072 6574 7572 6e20 7365 6c66 2e6d 6574   return self.met
-00006390: 7269 630d 0a20 2020 2040 7072 6f70 6572  ric..    @proper
-000063a0: 7479 0d0a 2020 2020 6465 6620 636f 6d70  ty..    def comp
-000063b0: 6172 6973 6f6e 2873 656c 6629 3a0d 0a20  arison(self):.. 
-000063c0: 2020 2020 2020 2027 2727 2041 2073 796e         ''' A syn
-000063d0: 6f6e 796d 2066 6f72 2060 2e6d 6f64 6560  onym for `.mode`
-000063e0: 2727 270d 0a20 2020 2020 2020 2072 6574  '''..        ret
-000063f0: 7572 6e20 7365 6c66 2e6d 6f64 650d 0a20  urn self.mode.. 
-00006400: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-00006410: 2020 6465 6620 6375 7272 656e 6379 2873    def currency(s
-00006420: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
-00006430: 2727 2041 2073 796e 6f6e 796d 2066 6f72  '' A synonym for
-00006440: 2060 2e62 6173 6560 2727 270d 0a20 2020   `.base`'''..   
-00006450: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00006460: 2e62 6173 650d 0a0d 0a20 2020 2064 6566  .base....    def
-00006470: 2068 6f75 7365 6b65 6570 2873 656c 6629   housekeep(self)
-00006480: 3a0d 0a20 2020 2020 2020 2027 2727 486f  :..        '''Ho
-00006490: 7573 656b 6565 7020 7468 6973 2073 6974  usekeep this sit
-000064a0: 652c 2074 6f20 7265 6475 6365 2074 6865  e, to reduce the
-000064b0: 2073 697a 6520 6f66 2064 6174 6120 6669   size of data fi
-000064c0: 6c65 7327 2727 0d0a 0d0a 2020 2020 2020  les'''....      
-000064d0: 2020 7365 6c66 2e69 6d70 6f72 7465 722e    self.importer.
-000064e0: 7275 6e5f 636f 6d6d 616e 6473 285b 2748  run_commands(['H
-000064f0: 6f75 7365 6b65 6570 275d 290d 0a0d 0a20  ousekeep']).... 
-00006500: 2020 2020 2020 206c 6f67 2e69 6e66 6f28         log.info(
-00006510: 2753 6974 6520 7b7d 2068 6f75 7365 6b65  'Site {} houseke
-00006520: 7074 272e 666f 726d 6174 2873 656c 662e  pt'.format(self.
-00006530: 5f70 6174 6829 290d 0a0d 0a20 2020 2040  _path))....    @
-00006540: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-00006550: 6620 696d 706f 7274 6572 2873 656c 6629  f importer(self)
-00006560: 3a0d 0a20 2020 2020 2020 2027 2727 4765  :..        '''Ge
-00006570: 7420 7468 6520 496d 706f 7274 6572 206f  t the Importer o
-00006580: 626a 6563 7420 666f 7220 7468 6973 2073  bject for this s
-00006590: 6974 652e 2053 6565 2049 6d70 6f72 7465  ite. See Importe
-000065a0: 7220 6170 6920 646f 6375 6d65 6e74 6174  r api documentat
-000065b0: 696f 6e20 666f 7220 686f 7720 746f 2075  ion for how to u
-000065c0: 7365 2074 6865 2072 6574 7572 6e65 6420  se the returned 
-000065d0: 496d 706f 7274 6572 206f 626a 6563 7427  Importer object'
-000065e0: 2727 0d0a 0d0a 2020 2020 2020 2020 7265  ''....        re
-000065f0: 7475 726e 2049 6d70 6f72 7465 7228 7365  turn Importer(se
-00006600: 6c66 290d 0a0d 0a20 2020 2040 7072 6f70  lf)....    @prop
-00006610: 6572 7479 0d0a 2020 2020 6465 6620 5f6c  erty..    def _l
-00006620: 6f67 6f6e 5f70 6172 616d 6574 6572 5f69  ogon_parameter_i
-00006630: 6d70 6f72 7465 725f 636f 6d6d 616e 6473  mporter_commands
-00006640: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00006650: 2027 2727 5265 7475 726e 2074 6865 2073   '''Return the s
-00006660: 7461 6e64 6172 6420 2727 270d 0a20 2020  tandard '''..   
-00006670: 2020 2020 2069 6620 7365 6c66 2e5f 656e       if self._en
-00006680: 6372 7970 7465 645f 7573 6572 2069 7320  crypted_user is 
-00006690: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-000066a0: 2020 2072 6574 7572 6e20 5b27 7365 742d     return ['set-
-000066b0: 7061 7261 6d65 7465 7220 7573 6572 3d27  parameter user='
-000066c0: 2020 2020 202b 2073 656c 662e 5f75 7365       + self._use
-000066d0: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
-000066e0: 2020 2020 2020 2c27 7365 742d 7061 7261        ,'set-para
-000066f0: 6d65 7465 7220 7061 7373 776f 7264 3d27  meter password='
-00006700: 202b 2073 656c 662e 5f70 7764 0d0a 2020   + self._pwd..  
-00006710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006720: 202c 2773 6574 2d70 6172 616d 6574 6572   ,'set-parameter
-00006730: 2073 6974 653d 2720 2020 2020 2b20 7365   site='     + se
-00006740: 6c66 2e5f 7369 7465 5f6c 6f63 6174 6f72  lf._site_locator
-00006750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00006760: 2020 2020 205d 0d0a 2020 2020 2020 2020       ]..        
-00006770: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00006780: 2020 2072 6574 7572 6e20 5b27 7365 742d     return ['set-
-00006790: 656e 6372 7970 7465 642d 7061 7261 6d65  encrypted-parame
-000067a0: 7465 7220 7573 6572 3d27 2020 2020 202b  ter user='     +
-000067b0: 2073 656c 662e 5f65 6e63 7279 7074 6564   self._encrypted
-000067c0: 5f75 7365 722e 6465 636f 6465 2827 7574  _user.decode('ut
-000067d0: 6638 2729 0d0a 2020 2020 2020 2020 2020  f8')..          
-000067e0: 2020 2020 2020 2020 202c 2773 6574 2d65           ,'set-e
-000067f0: 6e63 7279 7074 6564 2d70 6172 616d 6574  ncrypted-paramet
-00006800: 6572 2070 6173 7377 6f72 643d 2720 2b20  er password=' + 
-00006810: 7365 6c66 2e5f 656e 6372 7970 7465 645f  self._encrypted_
-00006820: 7077 6420 2e64 6563 6f64 6528 2775 7466  pwd .decode('utf
-00006830: 3827 290d 0a20 2020 2020 2020 2020 2020  8')..           
-00006840: 2020 2020 2020 2020 2c27 7365 742d 7061          ,'set-pa
-00006850: 7261 6d65 7465 7220 7369 7465 3d27 2020  rameter site='  
-00006860: 2020 2020 2020 2020 2020 2020 202b 2073               + s
-00006870: 656c 662e 5f73 6974 655f 6c6f 6361 746f  elf._site_locato
-00006880: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
-00006890: 2020 2020 2020 5d0d 0a0d 0a0d 0a63 6c61        ]......cla
-000068a0: 7373 2049 6d70 6f72 7465 7228 6f62 6a65  ss Importer(obje
-000068b0: 6374 293a 0d0a 0d0a 2020 2020 6465 6620  ct):....    def 
-000068c0: 5f5f 696e 6974 5f5f 2873 656c 662c 7369  __init__(self,si
-000068d0: 7465 293a 0d0a 2020 2020 2020 2020 7365  te):..        se
-000068e0: 6c66 2e73 6974 6520 3d20 7369 7465 0d0a  lf.site = site..
-000068f0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-00006900: 0a20 2020 2064 6566 2076 6572 7369 6f6e  .    def version
-00006910: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00006920: 2027 2727 4765 7420 7468 6520 7665 7273   '''Get the vers
-00006930: 696f 6e20 6f66 2069 6d70 6f72 7465 6420  ion of imported 
-00006940: 6173 2061 206c 6973 7420 6f66 2034 2069  as a list of 4 i
-00006950: 6e74 6567 6572 732e 206d 616a 6f72 2c20  ntegers. major, 
-00006960: 6d69 6e6f 722c 2072 656c 6561 7365 2061  minor, release a
-00006970: 6e64 2062 7569 6c64 2727 270d 0a0d 0a20  nd build'''.... 
-00006980: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00006990: 6c66 2e73 6974 652e 696d 706f 7274 6572  lf.site.importer
-000069a0: 5f76 6572 7369 6f6e 0d0a 0d0a 2020 2020  _version....    
-000069b0: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-000069c0: 6566 2065 7865 6375 7461 626c 6528 7365  ef executable(se
-000069d0: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
-000069e0: 7475 726e 2073 656c 662e 7369 7465 2e65  turn self.site.e
-000069f0: 6d70 6f77 6572 5f69 6d70 6f72 7465 725f  mpower_importer_
-00006a00: 6578 6563 7574 6162 6c65 0d0a 0d0a 2020  executable....  
-00006a10: 2020 6465 6620 7969 656c 645f 636f 6d6d    def yield_comm
-00006a20: 616e 6473 2873 656c 662c 636f 6d6d 616e  ands(self,comman
-00006a30: 645f 6c69 7374 2c68 6561 6465 7220 3d20  d_list,header = 
-00006a40: 4e6f 6e65 2c20 7370 6c69 745f 6f6e 5f74  None, split_on_t
-00006a50: 6162 203d 2054 7275 652c 7265 7475 726e  ab = True,return
-00006a60: 5f64 6963 7473 203d 2054 7275 652c 2066  _dicts = True, f
-00006a70: 6f72 6365 5f67 656e 6572 6174 6f72 203d  orce_generator =
-00006a80: 2046 616c 7365 2c20 6170 7065 6e64 5f6f   False, append_o
-00006a90: 7574 7075 745f 636f 6d6d 616e 6420 3d20  utput_command = 
-00006aa0: 5472 7565 293a 0d0a 2020 2020 2020 2020  True):..        
-00006ab0: 2727 2752 756e 2061 206c 6973 7420 6f66  '''Run a list of
-00006ac0: 2069 6d70 6f72 7465 7220 636f 6d6d 616e   importer comman
-00006ad0: 6473 206f 6e20 7468 6520 6174 7461 6368  ds on the attach
-00006ae0: 6564 2073 6974 650d 0a20 2020 2020 2020  ed site..       
-00006af0: 2055 7365 2024 7b73 6974 657d 2c20 247b   Use ${site}, ${
-00006b00: 7573 6572 7d20 616e 6420 247b 7061 7373  user} and ${pass
-00006b10: 776f 7264 7d20 706c 6163 6568 6f6c 6465  word} placeholde
-00006b20: 7273 2069 6e20 636f 6d6d 616e 6473 2c20  rs in commands, 
-00006b30: 7768 6963 6820 7769 6c6c 2062 6520 6669  which will be fi
-00006b40: 6c6c 6564 2077 6974 6820 7468 6520 7369  lled with the si
-00006b50: 7465 206c 6f63 6174 696f 6e20 616e 6420  te location and 
-00006b60: 656e 6372 7970 7465 6420 6c6f 676f 6e20  encrypted logon 
-00006b70: 696e 666f 726d 6174 696f 6e20 6672 6f6d  information from
-00006b80: 2074 6865 2053 6974 650d 0a0d 0a20 2020   the Site....   
-00006b90: 2020 2020 203a 7061 7261 6d20 636f 6d6d       :param comm
-00006ba0: 616e 645f 6c69 7374 3a20 636f 6d6d 616e  and_list: comman
-00006bb0: 6473 2079 6f75 2077 616e 7420 746f 2072  ds you want to r
-00006bc0: 756e 2e20 446f 6e27 7420 696e 636c 7564  un. Don't includ
-00006bd0: 6520 7468 6520 6261 7463 6820 636f 6d6d  e the batch comm
-00006be0: 616e 6473 2053 6974 6546 696c 652c 2055  ands SiteFile, U
-00006bf0: 7365 7220 6f72 2050 6173 7377 6f72 642c  ser or Password,
-00006c00: 2062 6563 6175 7365 2074 6865 7365 2061   because these a
-00006c10: 7265 2069 6e63 6c75 6465 640d 0a20 2020  re included..   
-00006c20: 2020 2020 203a 7061 7261 6d20 6865 6164       :param head
-00006c30: 6572 3a20 7573 6520 6120 6c69 7374 206f  er: use a list o
-00006c40: 6620 6865 6164 6572 2063 6f6c 756d 6e73  f header columns
-00006c50: 202d 2062 7920 6465 6661 756c 7420 7275   - by default ru
-00006c60: 6e5f 636f 6d6d 616e 6473 2075 7365 7320  n_commands uses 
-00006c70: 7468 6520 6669 7273 7420 7265 636f 7264  the first record
-00006c80: 2069 6e20 7468 6520 6f75 7470 7574 2061   in the output a
-00006c90: 7320 6120 6865 6164 6572 0d0a 2020 2020  s a header..    
-00006ca0: 2020 2020 3a70 6172 616d 2073 706c 6974      :param split
-00006cb0: 5f6f 6e5f 7461 623a 2073 706c 6974 2074  _on_tab: split t
-00006cc0: 6865 206f 7574 7075 7420 6279 2074 6865  he output by the
-00006cd0: 2074 6162 2063 6861 7261 6374 6572 2c20   tab character, 
-00006ce0: 7265 7475 726e 696e 6720 6c69 7374 7320  returning lists 
-00006cf0: 6f72 2064 6963 7469 6f6e 6172 6965 730d  or dictionaries.
-00006d00: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00006d10: 7265 7475 726e 5f64 6963 7473 203a 2072  return_dicts : r
-00006d20: 6574 7572 6e20 6120 6469 6374 696f 6e61  eturn a dictiona
-00006d30: 7279 2077 6974 6820 7468 6520 6b65 7973  ry with the keys
-00006d40: 2061 7320 7468 6520 6865 6164 6572 0d0a   as the header..
-00006d50: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
-00006d60: 6f72 6365 5f67 656e 6572 6174 6f72 3a20  orce_generator: 
-00006d70: 6120 7079 7468 6f6e 2067 656e 6572 6174  a python generat
-00006d80: 6f72 206f 626a 6563 7420 6973 2063 7265  or object is cre
-00006d90: 6174 6564 2069 6620 7468 6520 6669 6e61  ated if the fina
-00006da0: 6c20 636f 6d6d 616e 6420 6973 2027 6f75  l command is 'ou
-00006db0: 7470 7574 272c 206f 7220 6966 2074 6869  tput', or if thi
-00006dc0: 7320 666c 6167 2069 7320 7365 7420 746f  s flag is set to
-00006dd0: 2054 7275 650d 0a0d 0a20 2020 2020 2020   True....       
-00006de0: 203a 7265 7475 726e 3a20 6120 6765 6e65   :return: a gene
-00006df0: 7261 746f 7220 6f62 6a65 6374 2074 6861  rator object tha
-00006e00: 7420 6c6f 6f70 7320 6f76 6572 2074 6865  t loops over the
-00006e10: 206f 7574 7075 7420 6173 2069 7420 6973   output as it is
-00006e20: 2073 7472 6561 6d65 6420 6279 2074 6865   streamed by the
-00006e30: 2049 6d70 6f72 7465 7220 6578 6563 7574   Importer execut
-00006e40: 6162 6c65 0d0a 2020 2020 2020 2020 2727  able..        ''
-00006e50: 270d 0a0d 0a20 2020 2020 2020 2069 6620  '....        if 
-00006e60: 636f 6d6d 616e 645f 6c69 7374 203d 3d20  command_list == 
-00006e70: 5b5d 3a0d 0a20 2020 2020 2020 2020 2020  []:..           
-00006e80: 2072 6574 7572 6e0d 0a0d 0a20 2020 2020   return....     
-00006e90: 2020 2069 6620 6170 7065 6e64 5f6f 7574     if append_out
-00006ea0: 7075 745f 636f 6d6d 616e 643a 0d0a 2020  put_command:..  
-00006eb0: 2020 2020 2020 2020 2020 6f75 7470 7574            output
-00006ec0: 5f66 6f75 6e64 203d 2046 616c 7365 0d0a  _found = False..
-00006ed0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00006ee0: 636f 6d6d 616e 6420 696e 2063 6f6d 6d61  command in comma
-00006ef0: 6e64 5f6c 6973 743a 0d0a 2020 2020 2020  nd_list:..      
-00006f00: 2020 2020 2020 2020 2020 6966 2063 6f6d            if com
-00006f10: 6d61 6e64 2e73 7472 6970 2829 2e6c 6f77  mand.strip().low
-00006f20: 6572 2829 203d 3d20 276f 7574 7075 7427  er() == 'output'
-00006f30: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00006f40: 2020 2020 2020 206f 7574 7075 745f 666f         output_fo
-00006f50: 756e 6420 3d20 5472 7565 0d0a 2020 2020  und = True..    
+000049f0: 6f72 2063 7265 6174 696e 6720 6120 7369  or creating a si
+00004a00: 7465 3a20 696e 636f 7272 6563 7420 7375  te: incorrect su
+00004a10: 7065 7276 6973 6f72 206e 616d 6520 6f72  pervisor name or
+00004a20: 2070 6173 7377 6f72 642e 2050 6c65 6173   password. Pleas
+00004a30: 6520 7472 7920 6167 6169 6e27 290d 0a20  e try again').. 
+00004a40: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00004a50: 206d 7065 782e 456d 706f 7765 7249 6d70   mpex.EmpowerImp
+00004a60: 6f72 7465 7245 7272 6f72 2827 4572 726f  orterError('Erro
+00004a70: 7220 6372 6561 7469 6e67 2061 2073 6974  r creating a sit
+00004a80: 653a 2069 6e63 6f72 7265 6374 2073 7570  e: incorrect sup
+00004a90: 6572 7669 736f 7220 6e61 6d65 206f 7220  ervisor name or 
+00004aa0: 7061 7373 776f 7264 2e20 506c 6561 7365  password. Please
+00004ab0: 2074 7279 2061 6761 696e 2729 0d0a 0d0a   try again')....
+00004ac0: 2020 2020 2020 2020 7365 6c66 2e6e 756d          self.num
+00004ad0: 6265 725f 6f66 5f75 6e69 745f 6469 6d65  ber_of_unit_dime
+00004ae0: 6e73 696f 6e73 3d6e 756d 6265 725f 6f66  nsions=number_of
+00004af0: 5f75 6e69 745f 6469 6d65 6e73 696f 6e73  _unit_dimensions
+00004b00: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00004b10: 662e 6e75 6d62 6572 5f6f 665f 756e 6974  f.number_of_unit
+00004b20: 5f64 696d 656e 7369 6f6e 7320 6973 204e  _dimensions is N
+00004b30: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00004b40: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+00004b50: 2020 2020 2020 2020 5f6e 756d 6265 725f          _number_
+00004b60: 6f66 5f75 6e69 745f 6469 6d65 6e73 696f  of_unit_dimensio
+00004b70: 6e73 203d 2073 6974 655f 6465 7461 696c  ns = site_detail
+00004b80: 735b 274e 756d 6265 7220 6f66 2075 6e69  s['Number of uni
+00004b90: 7420 6469 6d65 6e73 696f 6e73 275d 0d0a  t dimensions']..
+00004ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004bb0: 5f6e 756d 6265 725f 6f66 5f75 6e69 745f  _number_of_unit_
+00004bc0: 6469 6d65 6e73 696f 6e73 203d 2069 6e74  dimensions = int
+00004bd0: 285f 6e75 6d62 6572 5f6f 665f 756e 6974  (_number_of_unit
+00004be0: 5f64 696d 656e 7369 6f6e 7329 0d0a 0d0a  _dimensions)....
+00004bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c00: 7365 6c66 2e6e 756d 6265 725f 6f66 5f75  self.number_of_u
+00004c10: 6e69 745f 6469 6d65 6e73 696f 6e73 3d5f  nit_dimensions=_
+00004c20: 6e75 6d62 6572 5f6f 665f 756e 6974 5f64  number_of_unit_d
+00004c30: 696d 656e 7369 6f6e 730d 0a20 2020 2020  imensions..     
+00004c40: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
+00004c50: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
+00004c60: 2020 2020 2020 2020 2070 6173 730d 0a0d           pass...
+00004c70: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00004c80: 2e6e 756d 6265 725f 6f66 5f75 6e69 745f  .number_of_unit_
+00004c90: 6469 6d65 6e73 696f 6e73 2069 7320 4e6f  dimensions is No
+00004ca0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00004cb0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00004cc0: 7228 2753 6974 6520 6f62 6a65 6374 2077  r('Site object w
+00004cd0: 6173 2069 6e69 7469 616c 6973 6564 2077  as initialised w
+00004ce0: 6974 686f 7574 2061 206e 756d 6265 725f  ithout a number_
+00004cf0: 6f66 5f75 6e69 745f 6469 6d65 6e73 696f  of_unit_dimensio
+00004d00: 6e73 2070 6172 616d 6574 6572 2c20 616e  ns parameter, an
+00004d10: 6420 7468 6520 6e75 6d62 6572 206f 6620  d the number of 
+00004d20: 756e 6974 2064 696d 656e 7369 6f6e 7320  unit dimensions 
+00004d30: 636f 756c 6420 6e6f 7420 6265 2072 6561  could not be rea
+00004d40: 6420 6672 6f6d 2074 6865 2073 6974 652e  d from the site.
+00004d50: 2045 6974 6865 7220 6368 616e 6765 2079   Either change y
+00004d60: 6f75 7220 636f 6465 2074 6f20 6361 6c6c  our code to call
+00004d70: 2053 6974 6528 2920 7769 7468 2074 6865   Site() with the
+00004d80: 2070 6172 616d 6574 6572 206e 756d 6265   parameter numbe
+00004d90: 725f 6f66 5f75 6e69 745f 6469 6d65 6e73  r_of_unit_dimens
+00004da0: 696f 6e73 2073 6574 206f 7220 7570 6772  ions set or upgr
+00004db0: 6164 6520 746f 2061 206c 6174 6572 2076  ade to a later v
+00004dc0: 6572 7369 6f6e 206f 6620 496d 706f 7274  ersion of Import
+00004dd0: 6572 2067 7265 6174 6572 2074 6861 6e20  er greater than 
+00004de0: 6f72 2065 7175 616c 2074 6f20 392e 352e  or equal to 9.5.
+00004df0: 2e38 3535 2729 0d0a 0d0a 2020 2020 2020  .855')....      
+00004e00: 2020 7365 6c66 2e64 6566 696e 6974 696f    self.definitio
+00004e10: 6e20 3d20 5f53 6974 6544 6566 696e 6974  n = _SiteDefinit
+00004e20: 696f 6e4d 616e 6970 756c 6174 6f72 2873  ionManipulator(s
+00004e30: 6974 653d 7365 6c66 290d 0a0d 0a20 2020  ite=self)....   
+00004e40: 2020 2020 2073 656c 662e 5f64 696d 656e       self._dimen
+00004e50: 7369 6f6e 7320 3d20 7b2a 2a7b 6e3a 4469  sions = {**{n:Di
+00004e60: 6d65 6e73 696f 6e28 7369 7465 3d73 656c  mension(site=sel
+00004e70: 662c 696e 6465 783d 6e29 2066 6f72 206e  f,index=n) for n
+00004e80: 2069 6e20 7261 6e67 6528 7365 6c66 2e6e   in range(self.n
+00004e90: 756d 6265 725f 6f66 5f75 6e69 745f 6469  umber_of_unit_di
+00004ea0: 6d65 6e73 696f 6e73 297d 2c2a 2a7b 6e3a  mensions)},**{n:
+00004eb0: 4469 6d65 6e73 696f 6e28 7369 7465 3d73  Dimension(site=s
+00004ec0: 656c 662c 696e 6465 783d 6e29 2066 6f72  elf,index=n) for
+00004ed0: 206e 2069 6e20 5b38 2c39 2c31 302c 3131   n in [8,9,10,11
+00004ee0: 2c31 325d 7d7d 0d0a 0d0a 2020 2020 2020  ,12]}}....      
+00004ef0: 2020 6966 2073 656c 662e 7374 6f72 6167    if self.storag
+00004f00: 655f 7479 7065 203d 3d20 2773 716c 273a  e_type == 'sql':
+00004f10: 0d0a 2020 2020 2020 2020 2020 2020 2353  ..            #S
+00004f20: 6861 7264 206f 6e20 6d65 7472 6963 2066  hard on metric f
+00004f30: 6f72 2073 716c 2073 6974 6573 0d0a 2020  or sql sites..  
+00004f40: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+00004f50: 746f 7261 6765 5f64 696d 656e 7369 6f6e  torage_dimension
+00004f60: 5f69 6e64 6578 203d 2038 0d0a 2020 2020  _index = 8..    
+00004f70: 2020 2020 2020 2020 7365 6c66 2e65 6c65          self.ele
+00004f80: 6d65 6e74 735f 7065 725f 7374 6f72 6167  ments_per_storag
+00004f90: 655f 6469 6d65 6e73 696f 6e20 3d20 310d  e_dimension = 1.
+00004fa0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00004fb0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00004fc0: 6c66 2e73 746f 7261 6765 5f64 696d 656e  lf.storage_dimen
+00004fd0: 7369 6f6e 5f69 6e64 6578 3d73 746f 7261  sion_index=stora
+00004fe0: 6765 5f64 696d 656e 7369 6f6e 5f69 6e64  ge_dimension_ind
+00004ff0: 6578 0d0a 2020 2020 2020 2020 2020 2020  ex..            
+00005000: 6966 2073 656c 662e 7374 6f72 6167 655f  if self.storage_
+00005010: 6469 6d65 6e73 696f 6e5f 696e 6465 7820  dimension_index 
+00005020: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00005030: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
+00005040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005050: 2020 2020 5f73 746f 7261 6765 5f64 696d      _storage_dim
+00005060: 656e 7369 6f6e 5f69 6e64 6578 203d 2073  ension_index = s
+00005070: 6974 655f 6465 7461 696c 735b 2753 746f  ite_details['Sto
+00005080: 7261 6765 2064 696d 656e 7369 6f6e 2069  rage dimension i
+00005090: 6e64 6578 275d 0d0a 2020 2020 2020 2020  ndex']..        
+000050a0: 2020 2020 2020 2020 2020 2020 5f73 746f              _sto
+000050b0: 7261 6765 5f64 696d 656e 7369 6f6e 5f69  rage_dimension_i
+000050c0: 6e64 6578 203d 2069 6e74 285f 7374 6f72  ndex = int(_stor
+000050d0: 6167 655f 6469 6d65 6e73 696f 6e5f 696e  age_dimension_in
+000050e0: 6465 7829 0d0a 0d0a 2020 2020 2020 2020  dex)....        
+000050f0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005100: 2e73 746f 7261 6765 5f64 696d 656e 7369  .storage_dimensi
+00005110: 6f6e 5f69 6e64 6578 3d5f 7374 6f72 6167  on_index=_storag
+00005120: 655f 6469 6d65 6e73 696f 6e5f 696e 6465  e_dimension_inde
+00005130: 780d 0a20 2020 2020 2020 2020 2020 2020  x..             
+00005140: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
+00005150: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00005160: 2020 2020 2020 2020 2070 6173 730d 0a0d           pass...
+00005170: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005180: 662e 656c 656d 656e 7473 5f70 6572 5f73  f.elements_per_s
+00005190: 746f 7261 6765 5f64 696d 656e 7369 6f6e  torage_dimension
+000051a0: 3d65 6c65 6d65 6e74 735f 7065 725f 7374  =elements_per_st
+000051b0: 6f72 6167 655f 6469 6d65 6e73 696f 6e0d  orage_dimension.
+000051c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000051d0: 7365 6c66 2e65 6c65 6d65 6e74 735f 7065  self.elements_pe
+000051e0: 725f 7374 6f72 6167 655f 6469 6d65 6e73  r_storage_dimens
+000051f0: 696f 6e20 6973 204e 6f6e 653a 0d0a 2020  ion is None:..  
+00005200: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00005210: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00005220: 2020 2020 2020 2020 5f73 746f 7261 6765          _storage
+00005230: 5f6d 756c 7469 706c 6963 6974 7920 3d20  _multiplicity = 
+00005240: 7369 7465 5f64 6574 6169 6c73 5b27 5374  site_details['St
+00005250: 6f72 6167 6520 6d75 6c74 6970 6c69 6369  orage multiplici
+00005260: 7479 275d 0d0a 2020 2020 2020 2020 2020  ty']..          
+00005270: 2020 2020 2020 2020 2020 5f73 746f 7261            _stora
+00005280: 6765 5f6d 756c 7469 706c 6963 6974 7920  ge_multiplicity 
+00005290: 3d20 696e 7428 5f73 746f 7261 6765 5f6d  = int(_storage_m
+000052a0: 756c 7469 706c 6963 6974 7929 0d0a 0d0a  ultiplicity)....
+000052b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052c0: 2020 2020 7365 6c66 2e65 6c65 6d65 6e74      self.element
+000052d0: 735f 7065 725f 7374 6f72 6167 655f 6469  s_per_storage_di
+000052e0: 6d65 6e73 696f 6e3d 5f73 746f 7261 6765  mension=_storage
+000052f0: 5f6d 756c 7469 706c 6963 6974 790d 0a20  _multiplicity.. 
+00005300: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00005310: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
+00005320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005330: 2020 2020 2070 6173 730d 0a0d 0a20 2020       pass....   
+00005340: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00005350: 2020 2020 2020 205f 6461 7461 5f6c 6f63         _data_loc
+00005360: 6b69 6e67 5f64 696d 656e 7369 6f6e 5f69  king_dimension_i
+00005370: 6e64 6578 203d 2073 6974 655f 6465 7461  ndex = site_deta
+00005380: 696c 735b 2744 6174 6120 6c6f 636b 696e  ils['Data lockin
+00005390: 6720 6469 6d65 6e73 696f 6e20 696e 6465  g dimension inde
+000053a0: 7827 5d0d 0a20 2020 2020 2020 2020 2020  x']..           
+000053b0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+000053c0: 2020 2020 2020 205f 6461 7461 5f6c 6f63         _data_loc
+000053d0: 6b69 6e67 5f64 696d 656e 7369 6f6e 5f69  king_dimension_i
+000053e0: 6e64 6578 203d 2069 6e74 285f 6461 7461  ndex = int(_data
+000053f0: 5f6c 6f63 6b69 6e67 5f64 696d 656e 7369  _locking_dimensi
+00005400: 6f6e 5f69 6e64 6578 290d 0a20 2020 2020  on_index)..     
+00005410: 2020 2020 2020 2065 7863 6570 7420 5661         except Va
+00005420: 6c75 6545 7272 6f72 3a0d 0a20 2020 2020  lueError:..     
+00005430: 2020 2020 2020 2020 2020 205f 6461 7461             _data
+00005440: 5f6c 6f63 6b69 6e67 5f64 696d 656e 7369  _locking_dimensi
+00005450: 6f6e 5f69 6e64 6578 203d 204e 6f6e 650d  on_index = None.
+00005460: 0a0d 0a20 2020 2020 2020 2020 2020 2073  ...            s
+00005470: 656c 662e 6461 7461 5f6c 6f63 6b69 6e67  elf.data_locking
+00005480: 5f64 696d 656e 7369 6f6e 5f69 6e64 6578  _dimension_index
+00005490: 3d5f 6461 7461 5f6c 6f63 6b69 6e67 5f64  =_data_locking_d
+000054a0: 696d 656e 7369 6f6e 5f69 6e64 6578 0d0a  imension_index..
+000054b0: 2020 2020 2020 2020 6578 6365 7074 204b          except K
+000054c0: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
+000054d0: 2020 2020 2020 7365 6c66 2e64 6174 615f        self.data_
+000054e0: 6c6f 636b 696e 675f 6469 6d65 6e73 696f  locking_dimensio
+000054f0: 6e5f 696e 6465 783d 4e6f 6e65 0d0a 0d0a  n_index=None....
+00005500: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00005510: 2020 2020 2020 2020 2020 5f64 6566 6175            _defau
+00005520: 6c74 5f6d 6561 7375 7265 203d 2073 6974  lt_measure = sit
+00005530: 655f 6465 7461 696c 735b 2744 6566 6175  e_details['Defau
+00005540: 6c74 206d 6561 7375 7265 275d 0d0a 0d0a  lt measure']....
+00005550: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00005560: 2e64 6566 6175 6c74 5f6d 6561 7375 7265  .default_measure
+00005570: 3d5f 6465 6661 756c 745f 6d65 6173 7572  =_default_measur
+00005580: 650d 0a20 2020 2020 2020 2065 7863 6570  e..        excep
+00005590: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
+000055a0: 2020 2020 2020 2020 2073 656c 662e 6465           self.de
+000055b0: 6661 756c 745f 6d65 6173 7572 653d 4e6f  fault_measure=No
+000055c0: 6e65 0d0a 0d0a 2020 2020 2020 2020 6966  ne....        if
+000055d0: 2073 656c 662e 7374 6f72 6167 655f 7479   self.storage_ty
+000055e0: 7065 203d 3d20 2773 716c 273a 0d0a 2020  pe == 'sql':..  
+000055f0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00005600: 6461 7461 5f66 696c 6573 5f64 6972 203d  data_files_dir =
+00005610: 204e 6f6e 650d 0a20 2020 2020 2020 2065   None..        e
+00005620: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00005630: 2020 7365 6c66 2e5f 6461 7461 5f66 696c    self._data_fil
+00005640: 6573 5f64 6972 203d 206f 732e 7061 7468  es_dir = os.path
+00005650: 2e6a 6f69 6e28 6f73 2e70 6174 682e 6469  .join(os.path.di
+00005660: 726e 616d 6528 7365 6c66 2e5f 7061 7468  rname(self._path
+00005670: 292c 2744 6174 6120 4669 6c65 7327 290d  ),'Data Files').
+00005680: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00005690: 5f6c 6f61 6465 7273 203d 207b 7d0d 0a0d  _loaders = {}...
+000056a0: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
+000056b0: 6767 696e 675f 7175 6575 6520 3d20 6c6f  gging_queue = lo
+000056c0: 6767 696e 675f 7175 6575 650d 0a0d 0a0d  gging_queue.....
+000056d0: 0a20 2020 2020 2020 2023 5765 2075 7365  .        #We use
+000056e0: 2061 2070 7265 6669 7820 736f 2074 6861   a prefix so tha
+000056f0: 7420 6475 616c 2073 6974 6520 6c6f 6164  t dual site load
+00005700: 7320 6361 6e20 7370 6563 6966 7920 7768  s can specify wh
+00005710: 6174 2073 6974 6520 7468 6579 2061 7265  at site they are
+00005720: 206c 6f61 6469 6e67 2077 6974 6820 7468   loading with th
+00005730: 6520 7361 6d65 2073 6c6f 630d 0a20 2020  e same sloc..   
+00005740: 2020 2020 2069 6620 7072 6566 6978 3a0d       if prefix:.
+00005750: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00005760: 662e 7072 6566 6978 203d 2070 7265 6669  f.prefix = prefi
+00005770: 780d 0a20 2020 2020 2020 2065 6c73 653a  x..        else:
+00005780: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00005790: 2073 656c 662e 7374 6f72 6167 655f 7479   self.storage_ty
+000057a0: 7065 203d 3d20 2773 716c 273a 0d0a 2020  pe == 'sql':..  
+000057b0: 2020 2020 2020 2020 2020 2020 2020 2355                #U
+000057c0: 7365 2074 6865 2066 6972 7374 2035 2063  se the first 5 c
+000057d0: 6861 7261 6374 6572 7320 6f66 2074 6865  haracters of the
+000057e0: 2064 6174 6162 6173 6520 6e61 6d65 2069   database name i
+000057f0: 6620 6e6f 2070 7265 6669 7820 7761 7320  f no prefix was 
+00005800: 7370 6563 6966 6965 640d 0a20 2020 2020  specified..     
+00005810: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005820: 7072 6566 6978 203d 7365 6c66 2e64 625f  prefix =self.db_
+00005830: 6e61 6d65 5b30 3a35 5d0d 0a20 2020 2020  name[0:5]..     
+00005840: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00005850: 2020 2020 2020 2020 2020 2020 2020 2355                #U
+00005860: 7365 2074 6865 2066 6972 7374 2035 2063  se the first 5 c
+00005870: 6861 7261 6374 6572 7320 6f66 2074 6865  haracters of the
+00005880: 202e 656b 7320 6669 6c65 206e 616d 6520   .eks file name 
+00005890: 6966 206e 6f20 7072 6566 6978 2077 6173  if no prefix was
+000058a0: 2073 7065 6369 6669 6564 0d0a 2020 2020   specified..    
+000058b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000058c0: 2e70 7265 6669 7820 3d20 6f73 2e70 6174  .prefix = os.pat
+000058d0: 682e 7370 6c69 7465 7874 286f 732e 7061  h.splitext(os.pa
+000058e0: 7468 2e62 6173 656e 616d 6528 7365 6c66  th.basename(self
+000058f0: 2e5f 7061 7468 2929 5b30 5d5b 303a 355d  ._path))[0][0:5]
+00005900: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00005910: 2e65 6d70 6f77 6572 5f69 6d70 6f72 7465  .empower_importe
+00005920: 725f 6578 6563 7574 6162 6c65 3d6f 732e  r_executable=os.
+00005930: 7061 7468 2e61 6273 7061 7468 2865 6d70  path.abspath(emp
+00005940: 6f77 6572 5f69 6d70 6f72 7465 725f 6578  ower_importer_ex
+00005950: 6563 7574 6162 6c65 290d 0a0d 0a20 2020  ecutable)....   
+00005960: 2020 2020 2073 656c 662e 5f76 6965 7770       self._viewp
+00005970: 6f69 6e74 7320 3d20 5f56 6965 7770 6f69  oints = _Viewpoi
+00005980: 6e74 7347 6574 7465 7228 7369 7465 3d73  ntsGetter(site=s
+00005990: 656c 6629 0d0a 0d0a 0d0a 0d0a 2020 2020  elf)........    
+000059a0: 6465 6620 7369 7465 5f66 696c 6528 7365  def site_file(se
+000059b0: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
+000059c0: 7475 726e 2073 656c 662e 5f73 6974 655f  turn self._site_
+000059d0: 6c6f 6361 746f 720d 0a20 2020 200d 0a20  locator..    .. 
+000059e0: 2020 2064 6566 2075 7365 726e 616d 6528     def username(
+000059f0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00005a00: 7265 7475 726e 2073 656c 662e 5f65 6e63  return self._enc
+00005a10: 7279 7074 6564 5f75 7365 720d 0a20 2020  rypted_user..   
+00005a20: 200d 0a20 2020 2064 6566 2070 6173 7377   ..    def passw
+00005a30: 6f72 6428 7365 6c66 293a 0d0a 2020 2020  ord(self):..    
+00005a40: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00005a50: 5f65 6e63 7279 7074 6564 5f70 7764 0d0a  _encrypted_pwd..
+00005a60: 2020 2020 2020 2020 0d0a 2020 2020 6465          ..    de
+00005a70: 6620 6c6f 6164 6572 2873 656c 662c 6e61  f loader(self,na
+00005a80: 6d65 2c73 6f75 7263 653d 4e6f 6e65 2c64  me,source=None,d
+00005a90: 656c 7461 3d54 7275 652c 6964 656e 7469  elta=True,identi
+00005aa0: 6669 6572 5f63 6f6c 756d 6e73 3d4e 6f6e  fier_columns=Non
+00005ab0: 652c 656d 706f 7765 725f 7065 7269 6f64  e,empower_period
+00005ac0: 5f74 7970 6520 3d20 6c6c 752e 454d 504f  _type = llu.EMPO
+00005ad0: 5745 525f 4d4f 4e54 485f 434f 4e53 5441  WER_MONTH_CONSTA
+00005ae0: 4e54 293a 0d0a 2020 2020 2020 2020 2727  NT):..        ''
+00005af0: 2743 7265 6174 6520 6120 6e61 6d65 6420  'Create a named 
+00005b00: 6c6f 6164 6572 2066 6f72 2074 6869 7320  loader for this 
+00005b10: 7369 7465 2e0d 0a20 2020 2020 2020 204c  site...        L
+00005b20: 6f61 6465 7273 206e 6565 6420 746f 2062  oaders need to b
+00005b30: 6520 6e61 6d65 6420 746f 2065 6e73 7572  e named to ensur
+00005b40: 6520 7468 6520 6275 6c6b 206c 6f61 6420  e the bulk load 
+00005b50: 7072 6f63 6573 7320 776f 726b 7320 636f  process works co
+00005b60: 7272 6563 746c 790d 0a20 2020 2020 2020  rrectly..       
+00005b70: 2027 2727 0d0a 2020 2020 2020 2020 6966   '''..        if
+00005b80: 2069 6465 6e74 6966 6965 725f 636f 6c75   identifier_colu
+00005b90: 6d6e 7320 6973 204e 6f6e 653a 0d0a 2020  mns is None:..  
+00005ba0: 2020 2020 2020 2020 2020 6964 656e 7469            identi
+00005bb0: 6669 6572 5f63 6f6c 756d 6e73 203d 205b  fier_columns = [
+00005bc0: 5d0d 0a0d 0a20 2020 2020 2020 206c 3d4c  ]....        l=L
+00005bd0: 6f61 6465 7228 736f 7572 6365 2020 2020  oader(source    
+00005be0: 2020 2020 2020 2020 2020 3d20 736f 7572            = sour
+00005bf0: 6365 0d0a 2020 2020 2020 2020 2020 2020  ce..            
+00005c00: 2020 2020 2c73 6974 6520 2020 2020 2020      ,site       
+00005c10: 2020 2020 2020 2020 203d 2073 656c 660d           = self.
+00005c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005c30: 202c 6c6f 6767 696e 675f 7175 6575 6520   ,logging_queue 
+00005c40: 2020 2020 2020 3d20 7365 6c66 2e6c 6f67        = self.log
+00005c50: 6769 6e67 5f71 7565 7565 0d0a 2020 2020  ging_queue..    
+00005c60: 2020 2020 2020 2020 2020 2020 2c64 656c              ,del
+00005c70: 7461 2020 2020 2020 2020 2020 2020 2020  ta              
+00005c80: 203d 2064 656c 7461 0d0a 2020 2020 2020   = delta..      
+00005c90: 2020 2020 2020 2020 2020 2c69 6465 6e74            ,ident
+00005ca0: 6966 6965 725f 636f 6c75 6d6e 7320 203d  ifier_columns  =
+00005cb0: 2069 6465 6e74 6966 6965 725f 636f 6c75   identifier_colu
+00005cc0: 6d6e 730d 0a20 2020 2020 2020 2020 2020  mns..           
+00005cd0: 2020 2020 202c 6e61 6d65 2020 2020 2020       ,name      
+00005ce0: 2020 2020 2020 2020 2020 3d20 6e61 6d65            = name
+00005cf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00005d00: 2020 2c65 6d70 6f77 6572 5f70 6572 696f    ,empower_perio
+00005d10: 645f 7479 7065 203d 2065 6d70 6f77 6572  d_type = empower
+00005d20: 5f70 6572 696f 645f 7479 7065 0d0a 2020  _period_type..  
+00005d30: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00005d40: 0a20 2020 2020 2020 2073 656c 662e 5f6c  .        self._l
+00005d50: 6f61 6465 7273 5b6e 616d 655d 3d6c 0d0a  oaders[name]=l..
+00005d60: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00005d70: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+00005d80: 790d 0a20 2020 2064 6566 206c 6f61 6465  y..    def loade
+00005d90: 7273 2873 656c 6629 3a0d 0a20 2020 2020  rs(self):..     
+00005da0: 2020 2027 2727 5468 6520 6e61 6d65 6420     '''The named 
+00005db0: 6c6f 6164 6572 7320 666f 7220 7468 6973  loaders for this
+00005dc0: 2073 6974 652e 0d0a 2020 2020 2020 2020   site...        
+00005dd0: 4120 3a63 6c61 7373 3a60 7e70 796d 7078  A :class:`~pympx
+00005de0: 2e4c 6f61 6465 7260 0d0a 2020 2020 2020  .Loader`..      
+00005df0: 2020 4c6f 6164 6572 7320 6e65 6564 2074    Loaders need t
+00005e00: 6f20 6265 206e 616d 6564 2074 6f20 656e  o be named to en
+00005e10: 7375 7265 2074 6865 2062 756c 6b20 6c6f  sure the bulk lo
+00005e20: 6164 2070 726f 6365 7373 2077 6f72 6b73  ad process works
+00005e30: 2063 6f72 7265 6374 6c79 0d0a 2020 2020   correctly..    
+00005e40: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
+00005e50: 2072 6574 7572 6e20 7365 6c66 2e5f 6c6f   return self._lo
+00005e60: 6164 6572 730d 0a0d 0a20 2020 2040 7072  aders....    @pr
+00005e70: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+00005e80: 6469 6d65 6e73 696f 6e73 2873 656c 6629  dimensions(self)
+00005e90: 3a0d 0a20 2020 2020 2020 2027 2727 4120  :..        '''A 
+00005ea0: 6469 6374 696f 6e61 7279 206c 696b 6520  dictionary like 
+00005eb0: 6f62 6a65 6374 206f 6620 7a65 726f 2069  object of zero i
+00005ec0: 6e64 6578 6564 2064 696d 656e 7369 6f6e  ndexed dimension
+00005ed0: 7320 666f 7220 7468 6520 7369 7465 0d0a  s for the site..
+00005ee0: 0d0a 2020 2020 2020 2020 3e3e 3e20 2343  ..        >>> #C
+00005ef0: 7265 6174 6520 6120 7265 6665 7265 6e63  reate a referenc
+00005f00: 6520 7468 6520 7468 6520 6375 7374 6f6d  e the the custom
+00005f10: 6572 2064 696d 656e 7369 6f6e 2c20 6173  er dimension, as
+00005f20: 7375 6d69 6e67 2069 7420 6973 2074 6865  suming it is the
+00005f30: 2066 6972 7374 2064 696d 656e 7369 6f6e   first dimension
+00005f40: 2069 6e20 7468 6520 7369 7465 2060 6d79   in the site `my
+00005f50: 7369 7465 600d 0a20 2020 2020 2020 203e  site`..        >
+00005f60: 3e3e 2063 7573 746f 6d65 7220 3d20 6d79  >> customer = my
+00005f70: 7369 7465 2e64 696d 656e 7369 6f6e 735b  site.dimensions[
+00005f80: 305d 0d0a 2020 2020 2020 2020 2727 270d  0]..        '''.
+00005f90: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
+00005fa0: 6e20 7365 6c66 2e5f 6469 6d65 6e73 696f  n self._dimensio
+00005fb0: 6e73 0d0a 0d0a 2020 2020 4070 726f 7065  ns....    @prope
+00005fc0: 7274 790d 0a20 2020 2064 6566 2076 6965  rty..    def vie
+00005fd0: 7770 6f69 6e74 7328 7365 6c66 293a 0d0a  wpoints(self):..
+00005fe0: 2020 2020 2020 2020 2727 2741 2064 6963          '''A dic
+00005ff0: 7469 6f6e 6172 792d 6c69 6b65 206f 626a  tionary-like obj
+00006000: 6563 7420 6f66 2073 686f 7274 6e61 6d65  ect of shortname
+00006010: 2069 6e64 6578 6564 2060 5669 6577 706f   indexed `Viewpo
+00006020: 696e 7460 7320 666f 7220 7468 6973 2073  int`s for this s
+00006030: 6974 650d 0a20 2020 2020 2020 2027 2727  ite..        '''
+00006040: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
+00006050: 726e 2073 656c 662e 5f76 6965 7770 6f69  rn self._viewpoi
+00006060: 6e74 730d 0a0d 0a20 2020 2040 7072 6f70  nts....    @prop
+00006070: 6572 7479 0d0a 2020 2020 6465 6620 6d65  erty..    def me
+00006080: 7472 6963 2873 656c 6629 3a0d 0a20 2020  tric(self):..   
+00006090: 2020 2020 2027 2727 4765 7473 2074 6865       '''Gets the
+000060a0: 206d 6574 7269 6320 6469 6d65 6e73 696f   metric dimensio
+000060b0: 6e20 692e 652e 202e 6469 6d65 6e73 696f  n i.e. .dimensio
+000060c0: 6e73 5b39 5d20 2727 270d 0a20 2020 2020  ns[9] '''..     
+000060d0: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
+000060e0: 696d 656e 7369 6f6e 735b 385d 0d0a 0d0a  imensions[8]....
+000060f0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+00006100: 2020 2064 6566 206d 6f64 6528 7365 6c66     def mode(self
+00006110: 293a 0d0a 2020 2020 2020 2020 2727 2747  ):..        '''G
+00006120: 6574 7320 7468 6520 6d6f 6465 2064 696d  ets the mode dim
+00006130: 656e 7369 6f6e 2069 2e65 2e20 2e64 696d  ension i.e. .dim
+00006140: 656e 7369 6f6e 735b 395d 2027 2727 0d0a  ensions[9] '''..
+00006150: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00006160: 656c 662e 6469 6d65 6e73 696f 6e73 5b39  elf.dimensions[9
+00006170: 5d0d 0a0d 0a20 2020 2040 7072 6f70 6572  ]....    @proper
+00006180: 7479 0d0a 2020 2020 6465 6620 6261 7365  ty..    def base
+00006190: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+000061a0: 2027 2727 4765 7473 2074 6865 2062 6173   '''Gets the bas
+000061b0: 6520 6469 6d65 6e73 696f 6e20 692e 652e  e dimension i.e.
+000061c0: 202e 6469 6d65 6e73 696f 6e73 5b31 305d   .dimensions[10]
+000061d0: 2027 2727 0d0a 0d0a 2020 2020 2020 2020   '''....        
+000061e0: 7265 7475 726e 2073 656c 662e 6469 6d65  return self.dime
+000061f0: 6e73 696f 6e73 5b31 305d 0d0a 0d0a 2020  nsions[10]....  
+00006200: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+00006210: 2064 6566 2074 696d 6528 7365 6c66 293a   def time(self):
+00006220: 0d0a 2020 2020 2020 2020 2727 2747 6574  ..        '''Get
+00006230: 7320 7468 6520 7469 6d65 2064 696d 656e  s the time dimen
+00006240: 7369 6f6e 2069 2e65 2e20 2e64 696d 656e  sion i.e. .dimen
+00006250: 7369 6f6e 735b 3131 5d20 2727 270d 0a20  sions[11] '''.. 
+00006260: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00006270: 6c66 2e64 696d 656e 7369 6f6e 735b 3131  lf.dimensions[11
+00006280: 5d0d 0a0d 0a20 2020 2040 7072 6f70 6572  ]....    @proper
+00006290: 7479 0d0a 2020 2020 6465 6620 7472 616e  ty..    def tran
+000062a0: 7366 6f72 6d61 7469 6f6e 2873 656c 6629  sformation(self)
+000062b0: 3a0d 0a20 2020 2020 2020 2027 2727 4765  :..        '''Ge
+000062c0: 7473 2074 6865 2074 7261 6e73 666f 726d  ts the transform
+000062d0: 6174 696f 6e20 6469 6d65 6e73 696f 6e20  ation dimension 
+000062e0: 692e 652e 202e 6469 6d65 6e73 696f 6e73  i.e. .dimensions
+000062f0: 5b31 325d 2027 2727 0d0a 2020 2020 2020  [12] '''..      
+00006300: 2020 7265 7475 726e 2073 656c 662e 6469    return self.di
+00006310: 6d65 6e73 696f 6e73 5b31 325d 0d0a 0d0a  mensions[12]....
+00006320: 2020 2020 2355 7469 6c69 7479 2070 726f      #Utility pro
+00006330: 7065 7274 6965 7320 2d20 636f 6d6d 6f6e  perties - common
+00006340: 6c79 2075 7365 6420 7073 6575 646f 6e79  ly used pseudony
+00006350: 6d73 0d0a 2020 2020 4070 726f 7065 7274  ms..    @propert
+00006360: 790d 0a20 2020 2064 6566 2069 6e64 6963  y..    def indic
+00006370: 6174 6f72 2873 656c 6629 3a0d 0a20 2020  ator(self):..   
+00006380: 2020 2020 2027 2727 2041 2073 796e 6f6e       ''' A synon
+00006390: 796d 2066 6f72 2060 2e6d 6574 7269 6360  ym for `.metric`
+000063a0: 2727 270d 0a20 2020 2020 2020 2072 6574  '''..        ret
+000063b0: 7572 6e20 7365 6c66 2e6d 6574 7269 630d  urn self.metric.
+000063c0: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+000063d0: 2020 2020 6465 6620 636f 6d70 6172 6973      def comparis
+000063e0: 6f6e 2873 656c 6629 3a0d 0a20 2020 2020  on(self):..     
+000063f0: 2020 2027 2727 2041 2073 796e 6f6e 796d     ''' A synonym
+00006400: 2066 6f72 2060 2e6d 6f64 6560 2727 270d   for `.mode`'''.
+00006410: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00006420: 7365 6c66 2e6d 6f64 650d 0a20 2020 2040  self.mode..    @
+00006430: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+00006440: 6620 6375 7272 656e 6379 2873 656c 6629  f currency(self)
+00006450: 3a0d 0a20 2020 2020 2020 2027 2727 2041  :..        ''' A
+00006460: 2073 796e 6f6e 796d 2066 6f72 2060 2e62   synonym for `.b
+00006470: 6173 6560 2727 270d 0a20 2020 2020 2020  ase`'''..       
+00006480: 2072 6574 7572 6e20 7365 6c66 2e62 6173   return self.bas
+00006490: 650d 0a0d 0a20 2020 2064 6566 2068 6f75  e....    def hou
+000064a0: 7365 6b65 6570 2873 656c 6629 3a0d 0a20  sekeep(self):.. 
+000064b0: 2020 2020 2020 2027 2727 486f 7573 656b         '''Housek
+000064c0: 6565 7020 7468 6973 2073 6974 652c 2074  eep this site, t
+000064d0: 6f20 7265 6475 6365 2074 6865 2073 697a  o reduce the siz
+000064e0: 6520 6f66 2064 6174 6120 6669 6c65 7327  e of data files'
+000064f0: 2727 0d0a 0d0a 2020 2020 2020 2020 7365  ''....        se
+00006500: 6c66 2e69 6d70 6f72 7465 722e 7275 6e5f  lf.importer.run_
+00006510: 636f 6d6d 616e 6473 285b 2748 6f75 7365  commands(['House
+00006520: 6b65 6570 275d 290d 0a0d 0a20 2020 2020  keep'])....     
+00006530: 2020 206c 6f67 2e69 6e66 6f28 2753 6974     log.info('Sit
+00006540: 6520 7b7d 2068 6f75 7365 6b65 7074 272e  e {} housekept'.
+00006550: 666f 726d 6174 2873 656c 662e 5f70 6174  format(self._pat
+00006560: 6829 290d 0a0d 0a20 2020 2040 7072 6f70  h))....    @prop
+00006570: 6572 7479 0d0a 2020 2020 6465 6620 696d  erty..    def im
+00006580: 706f 7274 6572 2873 656c 6629 3a0d 0a20  porter(self):.. 
+00006590: 2020 2020 2020 2027 2727 4765 7420 7468         '''Get th
+000065a0: 6520 496d 706f 7274 6572 206f 626a 6563  e Importer objec
+000065b0: 7420 666f 7220 7468 6973 2073 6974 652e  t for this site.
+000065c0: 2053 6565 2049 6d70 6f72 7465 7220 6170   See Importer ap
+000065d0: 6920 646f 6375 6d65 6e74 6174 696f 6e20  i documentation 
+000065e0: 666f 7220 686f 7720 746f 2075 7365 2074  for how to use t
+000065f0: 6865 2072 6574 7572 6e65 6420 496d 706f  he returned Impo
+00006600: 7274 6572 206f 626a 6563 7427 2727 0d0a  rter object'''..
+00006610: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00006620: 2049 6d70 6f72 7465 7228 7365 6c66 290d   Importer(self).
+00006630: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+00006640: 0d0a 2020 2020 6465 6620 5f6c 6f67 6f6e  ..    def _logon
+00006650: 5f70 6172 616d 6574 6572 5f69 6d70 6f72  _parameter_impor
+00006660: 7465 725f 636f 6d6d 616e 6473 2873 656c  ter_commands(sel
+00006670: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
+00006680: 5265 7475 726e 2074 6865 2073 7461 6e64  Return the stand
+00006690: 6172 6420 2727 270d 0a20 2020 2020 2020  ard '''..       
+000066a0: 2069 6620 7365 6c66 2e5f 656e 6372 7970   if self._encryp
+000066b0: 7465 645f 7573 6572 2069 7320 4e6f 6e65  ted_user is None
+000066c0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+000066d0: 6574 7572 6e20 5b27 7365 742d 7061 7261  eturn ['set-para
+000066e0: 6d65 7465 7220 7573 6572 3d27 2020 2020  meter user='    
+000066f0: 202b 2073 656c 662e 5f75 7365 720d 0a20   + self._user.. 
+00006700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006710: 2020 2c27 7365 742d 7061 7261 6d65 7465    ,'set-paramete
+00006720: 7220 7061 7373 776f 7264 3d27 202b 2073  r password=' + s
+00006730: 656c 662e 5f70 7764 0d0a 2020 2020 2020  elf._pwd..      
+00006740: 2020 2020 2020 2020 2020 2020 202c 2773               ,'s
+00006750: 6574 2d70 6172 616d 6574 6572 2073 6974  et-parameter sit
+00006760: 653d 2720 2020 2020 2b20 7365 6c66 2e5f  e='     + self._
+00006770: 7369 7465 5f6c 6f63 6174 6f72 0d0a 2020  site_locator..  
+00006780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006790: 205d 0d0a 2020 2020 2020 2020 656c 7365   ]..        else
+000067a0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+000067b0: 6574 7572 6e20 5b27 7365 742d 656e 6372  eturn ['set-encr
+000067c0: 7970 7465 642d 7061 7261 6d65 7465 7220  ypted-parameter 
+000067d0: 7573 6572 3d27 2020 2020 202b 2073 656c  user='     + sel
+000067e0: 662e 5f65 6e63 7279 7074 6564 5f75 7365  f._encrypted_use
+000067f0: 722e 6465 636f 6465 2827 7574 6638 2729  r.decode('utf8')
+00006800: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006810: 2020 2020 202c 2773 6574 2d65 6e63 7279       ,'set-encry
+00006820: 7074 6564 2d70 6172 616d 6574 6572 2070  pted-parameter p
+00006830: 6173 7377 6f72 643d 2720 2b20 7365 6c66  assword=' + self
+00006840: 2e5f 656e 6372 7970 7465 645f 7077 6420  ._encrypted_pwd 
+00006850: 2e64 6563 6f64 6528 2775 7466 3827 290d  .decode('utf8').
+00006860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006870: 2020 2020 2c27 7365 742d 7061 7261 6d65      ,'set-parame
+00006880: 7465 7220 7369 7465 3d27 2020 2020 2020  ter site='      
+00006890: 2020 2020 2020 2020 202b 2073 656c 662e           + self.
+000068a0: 5f73 6974 655f 6c6f 6361 746f 720d 0a20  _site_locator.. 
+000068b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000068c0: 2020 5d0d 0a0d 0a0d 0a63 6c61 7373 2049    ]......class I
+000068d0: 6d70 6f72 7465 7228 6f62 6a65 6374 293a  mporter(object):
+000068e0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 696e  ....    def __in
+000068f0: 6974 5f5f 2873 656c 662c 7369 7465 293a  it__(self,site):
+00006900: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+00006910: 6974 6520 3d20 7369 7465 0d0a 0d0a 2020  ite = site....  
+00006920: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+00006930: 2064 6566 2076 6572 7369 6f6e 2873 656c   def version(sel
+00006940: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
+00006950: 4765 7420 7468 6520 7665 7273 696f 6e20  Get the version 
+00006960: 6f66 2069 6d70 6f72 7465 6420 6173 2061  of imported as a
+00006970: 206c 6973 7420 6f66 2034 2069 6e74 6567   list of 4 integ
+00006980: 6572 732e 206d 616a 6f72 2c20 6d69 6e6f  ers. major, mino
+00006990: 722c 2072 656c 6561 7365 2061 6e64 2062  r, release and b
+000069a0: 7569 6c64 2727 270d 0a0d 0a20 2020 2020  uild'''....     
+000069b0: 2020 2072 6574 7572 6e20 7365 6c66 2e73     return self.s
+000069c0: 6974 652e 696d 706f 7274 6572 5f76 6572  ite.importer_ver
+000069d0: 7369 6f6e 0d0a 0d0a 2020 2020 4070 726f  sion....    @pro
+000069e0: 7065 7274 790d 0a20 2020 2064 6566 2065  perty..    def e
+000069f0: 7865 6375 7461 626c 6528 7365 6c66 293a  xecutable(self):
+00006a00: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00006a10: 2073 656c 662e 7369 7465 2e65 6d70 6f77   self.site.empow
+00006a20: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
+00006a30: 7574 6162 6c65 0d0a 0d0a 2020 2020 6465  utable....    de
+00006a40: 6620 7969 656c 645f 636f 6d6d 616e 6473  f yield_commands
+00006a50: 2873 656c 662c 636f 6d6d 616e 645f 6c69  (self,command_li
+00006a60: 7374 2c68 6561 6465 7220 3d20 4e6f 6e65  st,header = None
+00006a70: 2c20 7370 6c69 745f 6f6e 5f74 6162 203d  , split_on_tab =
+00006a80: 2054 7275 652c 7265 7475 726e 5f64 6963   True,return_dic
+00006a90: 7473 203d 2054 7275 652c 2066 6f72 6365  ts = True, force
+00006aa0: 5f67 656e 6572 6174 6f72 203d 2046 616c  _generator = Fal
+00006ab0: 7365 2c20 6170 7065 6e64 5f6f 7574 7075  se, append_outpu
+00006ac0: 745f 636f 6d6d 616e 6420 3d20 5472 7565  t_command = True
+00006ad0: 293a 0d0a 2020 2020 2020 2020 2727 2752  ):..        '''R
+00006ae0: 756e 2061 206c 6973 7420 6f66 2069 6d70  un a list of imp
+00006af0: 6f72 7465 7220 636f 6d6d 616e 6473 206f  orter commands o
+00006b00: 6e20 7468 6520 6174 7461 6368 6564 2073  n the attached s
+00006b10: 6974 650d 0a20 2020 2020 2020 2055 7365  ite..        Use
+00006b20: 2024 7b73 6974 657d 2c20 247b 7573 6572   ${site}, ${user
+00006b30: 7d20 616e 6420 247b 7061 7373 776f 7264  } and ${password
+00006b40: 7d20 706c 6163 6568 6f6c 6465 7273 2069  } placeholders i
+00006b50: 6e20 636f 6d6d 616e 6473 2c20 7768 6963  n commands, whic
+00006b60: 6820 7769 6c6c 2062 6520 6669 6c6c 6564  h will be filled
+00006b70: 2077 6974 6820 7468 6520 7369 7465 206c   with the site l
+00006b80: 6f63 6174 696f 6e20 616e 6420 656e 6372  ocation and encr
+00006b90: 7970 7465 6420 6c6f 676f 6e20 696e 666f  ypted logon info
+00006ba0: 726d 6174 696f 6e20 6672 6f6d 2074 6865  rmation from the
+00006bb0: 2053 6974 650d 0a0d 0a20 2020 2020 2020   Site....       
+00006bc0: 203a 7061 7261 6d20 636f 6d6d 616e 645f   :param command_
+00006bd0: 6c69 7374 3a20 636f 6d6d 616e 6473 2079  list: commands y
+00006be0: 6f75 2077 616e 7420 746f 2072 756e 2e20  ou want to run. 
+00006bf0: 446f 6e27 7420 696e 636c 7564 6520 7468  Don't include th
+00006c00: 6520 6261 7463 6820 636f 6d6d 616e 6473  e batch commands
+00006c10: 2053 6974 6546 696c 652c 2055 7365 7220   SiteFile, User 
+00006c20: 6f72 2050 6173 7377 6f72 642c 2062 6563  or Password, bec
+00006c30: 6175 7365 2074 6865 7365 2061 7265 2069  ause these are i
+00006c40: 6e63 6c75 6465 640d 0a20 2020 2020 2020  ncluded..       
+00006c50: 203a 7061 7261 6d20 6865 6164 6572 3a20   :param header: 
+00006c60: 7573 6520 6120 6c69 7374 206f 6620 6865  use a list of he
+00006c70: 6164 6572 2063 6f6c 756d 6e73 202d 2062  ader columns - b
+00006c80: 7920 6465 6661 756c 7420 7275 6e5f 636f  y default run_co
+00006c90: 6d6d 616e 6473 2075 7365 7320 7468 6520  mmands uses the 
+00006ca0: 6669 7273 7420 7265 636f 7264 2069 6e20  first record in 
+00006cb0: 7468 6520 6f75 7470 7574 2061 7320 6120  the output as a 
+00006cc0: 6865 6164 6572 0d0a 2020 2020 2020 2020  header..        
+00006cd0: 3a70 6172 616d 2073 706c 6974 5f6f 6e5f  :param split_on_
+00006ce0: 7461 623a 2073 706c 6974 2074 6865 206f  tab: split the o
+00006cf0: 7574 7075 7420 6279 2074 6865 2074 6162  utput by the tab
+00006d00: 2063 6861 7261 6374 6572 2c20 7265 7475   character, retu
+00006d10: 726e 696e 6720 6c69 7374 7320 6f72 2064  rning lists or d
+00006d20: 6963 7469 6f6e 6172 6965 730d 0a20 2020  ictionaries..   
+00006d30: 2020 2020 203a 7061 7261 6d20 7265 7475       :param retu
+00006d40: 726e 5f64 6963 7473 203a 2072 6574 7572  rn_dicts : retur
+00006d50: 6e20 6120 6469 6374 696f 6e61 7279 2077  n a dictionary w
+00006d60: 6974 6820 7468 6520 6b65 7973 2061 7320  ith the keys as 
+00006d70: 7468 6520 6865 6164 6572 0d0a 2020 2020  the header..    
+00006d80: 2020 2020 3a70 6172 616d 2066 6f72 6365      :param force
+00006d90: 5f67 656e 6572 6174 6f72 3a20 6120 7079  _generator: a py
+00006da0: 7468 6f6e 2067 656e 6572 6174 6f72 206f  thon generator o
+00006db0: 626a 6563 7420 6973 2063 7265 6174 6564  bject is created
+00006dc0: 2069 6620 7468 6520 6669 6e61 6c20 636f   if the final co
+00006dd0: 6d6d 616e 6420 6973 2027 6f75 7470 7574  mmand is 'output
+00006de0: 272c 206f 7220 6966 2074 6869 7320 666c  ', or if this fl
+00006df0: 6167 2069 7320 7365 7420 746f 2054 7275  ag is set to Tru
+00006e00: 650d 0a0d 0a20 2020 2020 2020 203a 7265  e....        :re
+00006e10: 7475 726e 3a20 6120 6765 6e65 7261 746f  turn: a generato
+00006e20: 7220 6f62 6a65 6374 2074 6861 7420 6c6f  r object that lo
+00006e30: 6f70 7320 6f76 6572 2074 6865 206f 7574  ops over the out
+00006e40: 7075 7420 6173 2069 7420 6973 2073 7472  put as it is str
+00006e50: 6561 6d65 6420 6279 2074 6865 2049 6d70  eamed by the Imp
+00006e60: 6f72 7465 7220 6578 6563 7574 6162 6c65  orter executable
+00006e70: 0d0a 2020 2020 2020 2020 2727 270d 0a0d  ..        '''...
+00006e80: 0a20 2020 2020 2020 2069 6620 636f 6d6d  .        if comm
+00006e90: 616e 645f 6c69 7374 203d 3d20 5b5d 3a0d  and_list == []:.
+00006ea0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00006eb0: 7572 6e0d 0a0d 0a20 2020 2020 2020 2069  urn....        i
+00006ec0: 6620 6170 7065 6e64 5f6f 7574 7075 745f  f append_output_
+00006ed0: 636f 6d6d 616e 643a 0d0a 2020 2020 2020  command:..      
+00006ee0: 2020 2020 2020 6f75 7470 7574 5f66 6f75        output_fou
+00006ef0: 6e64 203d 2046 616c 7365 0d0a 2020 2020  nd = False..    
+00006f00: 2020 2020 2020 2020 666f 7220 636f 6d6d          for comm
+00006f10: 616e 6420 696e 2063 6f6d 6d61 6e64 5f6c  and in command_l
+00006f20: 6973 743a 0d0a 2020 2020 2020 2020 2020  ist:..          
+00006f30: 2020 2020 2020 6966 2063 6f6d 6d61 6e64        if command
+00006f40: 2e73 7472 6970 2829 2e6c 6f77 6572 2829  .strip().lower()
+00006f50: 203d 3d20 276f 7574 7075 7427 3a0d 0a20   == 'output':.. 
 00006f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f70: 6272 6561 6b0d 0a20 2020 2020 2020 2020  break..         
-00006f80: 2020 2069 6620 6e6f 7420 6f75 7470 7574     if not output
-00006f90: 5f66 6f75 6e64 3a0d 0a20 2020 2020 2020  _found:..       
-00006fa0: 2020 2020 2020 2020 2063 6f6d 6d61 6e64           command
-00006fb0: 5f6c 6973 742e 6170 7065 6e64 2827 6f75  _list.append('ou
-00006fc0: 7470 7574 2729 0d0a 0d0a 2020 2020 2020  tput')....      
-00006fd0: 2020 636f 6d6d 616e 645f 6c69 7374 203d    command_list =
-00006fe0: 205b 2773 6574 2d65 6e63 7279 7074 6564   ['set-encrypted
-00006ff0: 2d70 6172 616d 6574 6572 2075 6e71 756f  -parameter unquo
-00007000: 7465 645f 7573 6572 3d27 2020 2020 202b  ted_user='     +
-00007010: 2073 656c 662e 7369 7465 2e5f 656e 6372   self.site._encr
-00007020: 7970 7465 645f 7573 6572 2e64 6563 6f64  ypted_user.decod
-00007030: 6528 2775 7466 3827 2920 2b20 2727 0d0a  e('utf8') + ''..
-00007040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007050: 2020 2020 2020 202c 2773 6574 2d65 6e63         ,'set-enc
-00007060: 7279 7074 6564 2d70 6172 616d 6574 6572  rypted-parameter
-00007070: 2075 6e71 756f 7465 645f 7061 7373 776f   unquoted_passwo
-00007080: 7264 3d27 202b 2073 656c 662e 7369 7465  rd=' + self.site
-00007090: 2e5f 656e 6372 7970 7465 645f 7077 6420  ._encrypted_pwd 
-000070a0: 2e64 6563 6f64 6528 2775 7466 3827 2920  .decode('utf8') 
-000070b0: 2b20 2727 0d0a 2020 2020 2020 2020 2020  + ''..          
-000070c0: 2020 2020 2020 2020 2020 2020 202c 2773               ,'s
-000070d0: 6574 2d70 6172 616d 6574 6572 2073 6974  et-parameter sit
-000070e0: 653d 2227 2020 2020 2020 2020 2020 2020  e="'            
-000070f0: 2020 2020 2020 2020 2020 202b 2073 656c             + sel
-00007100: 662e 7369 7465 2e5f 7369 7465 5f6c 6f63  f.site._site_loc
-00007110: 6174 6f72 202b 2027 2227 0d0a 2020 2020  ator + '"'..    
-00007120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007130: 2020 202c 2773 6574 2d70 6172 616d 6574     ,'set-paramet
-00007140: 6572 2075 7365 723d 2224 7b75 6e71 756f  er user="${unquo
-00007150: 7465 645f 7573 6572 7d22 270d 0a20 2020  ted_user}"'..   
-00007160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007170: 2020 2020 2c27 7365 742d 7061 7261 6d65      ,'set-parame
-00007180: 7465 7220 7061 7373 776f 7264 3d22 247b  ter password="${
-00007190: 756e 7175 6f74 6564 5f70 6173 7377 6f72  unquoted_passwor
-000071a0: 647d 2227 0d0a 2020 2020 2020 2020 2020  d}"'..          
-000071b0: 2020 2020 2020 2020 2020 2020 202c 2753               ,'S
-000071c0: 6974 6546 696c 6520 247b 7369 7465 7d27  iteFile ${site}'
+00006f70: 2020 206f 7574 7075 745f 666f 756e 6420     output_found 
+00006f80: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00006f90: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+00006fa0: 6b0d 0a20 2020 2020 2020 2020 2020 2069  k..            i
+00006fb0: 6620 6e6f 7420 6f75 7470 7574 5f66 6f75  f not output_fou
+00006fc0: 6e64 3a0d 0a20 2020 2020 2020 2020 2020  nd:..           
+00006fd0: 2020 2020 2063 6f6d 6d61 6e64 5f6c 6973       command_lis
+00006fe0: 742e 6170 7065 6e64 2827 6f75 7470 7574  t.append('output
+00006ff0: 2729 0d0a 0d0a 2020 2020 2020 2020 636f  ')....        co
+00007000: 6d6d 616e 645f 6c69 7374 203d 205b 2773  mmand_list = ['s
+00007010: 6574 2d65 6e63 7279 7074 6564 2d70 6172  et-encrypted-par
+00007020: 616d 6574 6572 2075 6e71 756f 7465 645f  ameter unquoted_
+00007030: 7573 6572 3d27 2020 2020 202b 2073 656c  user='     + sel
+00007040: 662e 7369 7465 2e5f 656e 6372 7970 7465  f.site._encrypte
+00007050: 645f 7573 6572 2e64 6563 6f64 6528 2775  d_user.decode('u
+00007060: 7466 3827 2920 2b20 2727 0d0a 2020 2020  tf8') + ''..    
+00007070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007080: 2020 202c 2773 6574 2d65 6e63 7279 7074     ,'set-encrypt
+00007090: 6564 2d70 6172 616d 6574 6572 2075 6e71  ed-parameter unq
+000070a0: 756f 7465 645f 7061 7373 776f 7264 3d27  uoted_password='
+000070b0: 202b 2073 656c 662e 7369 7465 2e5f 656e   + self.site._en
+000070c0: 6372 7970 7465 645f 7077 6420 2e64 6563  crypted_pwd .dec
+000070d0: 6f64 6528 2775 7466 3827 2920 2b20 2727  ode('utf8') + ''
+000070e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000070f0: 2020 2020 2020 2020 202c 2773 6574 2d70           ,'set-p
+00007100: 6172 616d 6574 6572 2073 6974 653d 2227  arameter site="'
+00007110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007120: 2020 2020 2020 202b 2073 656c 662e 7369         + self.si
+00007130: 7465 2e5f 7369 7465 5f6c 6f63 6174 6f72  te._site_locator
+00007140: 202b 2027 2227 0d0a 2020 2020 2020 2020   + '"'..        
+00007150: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+00007160: 2773 6574 2d70 6172 616d 6574 6572 2075  'set-parameter u
+00007170: 7365 723d 2224 7b75 6e71 756f 7465 645f  ser="${unquoted_
+00007180: 7573 6572 7d22 270d 0a20 2020 2020 2020  user}"'..       
+00007190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000071a0: 2c27 7365 742d 7061 7261 6d65 7465 7220  ,'set-parameter 
+000071b0: 7061 7373 776f 7264 3d22 247b 756e 7175  password="${unqu
+000071c0: 6f74 6564 5f70 6173 7377 6f72 647d 2227  oted_password}"'
 000071d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000071e0: 2020 2020 2020 2020 202c 2755 7365 7220           ,'User 
-000071f0: 247b 7573 6572 7d27 0d0a 2020 2020 2020  ${user}'..      
+000071e0: 2020 2020 2020 2020 202c 2753 6974 6546           ,'SiteF
+000071f0: 696c 6520 247b 7369 7465 7d27 0d0a 2020  ile ${site}'..  
 00007200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007210: 202c 2750 6173 7377 6f72 6420 247b 7061   ,'Password ${pa
-00007220: 7373 776f 7264 7d27 0d0a 2020 2020 2020  ssword}'..      
-00007230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007240: 205d 202b 2063 6f6d 6d61 6e64 5f6c 6973   ] + command_lis
-00007250: 740d 0a0d 0a0d 0a20 2020 2020 2020 206c  t......        l
-00007260: 6f67 2e76 6572 626f 7365 2827 5374 6172  og.verbose('Star
-00007270: 7465 6420 7275 6e6e 696e 6720 696d 706f  ted running impo
-00007280: 7274 6572 2063 6f6d 6d61 6e64 7327 290d  rter commands').
-00007290: 0a0d 0a20 2020 2020 2020 206e 203d 204e  ...        n = N
-000072a0: 6f6e 650d 0a0d 0a20 2020 2020 2020 2066  one....        f
-000072b0: 6f72 206e 2c20 6c69 6e65 2069 6e20 656e  or n, line in en
-000072c0: 756d 6572 6174 6528 6c6c 752e 7275 6e5f  umerate(llu.run_
-000072d0: 616e 645f 7969 656c 645f 7369 6e67 6c65  and_yield_single
-000072e0: 5f6f 7574 7075 745f 696d 706f 7274 6572  _output_importer
-000072f0: 5f63 6f6d 6d61 6e64 7328 636f 6d6d 616e  _commands(comman
-00007300: 645f 6c69 7374 0d0a 2020 2020 2020 2020  d_list..        
-00007310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007340: 2020 2020 2020 2020 2020 2020 2c65 6d70              ,emp
-00007350: 6f77 6572 5f69 6d70 6f72 7465 725f 6578  ower_importer_ex
-00007360: 6563 7574 6162 6c65 3d73 656c 662e 7369  ecutable=self.si
-00007370: 7465 2e65 6d70 6f77 6572 5f69 6d70 6f72  te.empower_impor
-00007380: 7465 725f 6578 6563 7574 6162 6c65 0d0a  ter_executable..
-00007390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007210: 2020 2020 202c 2755 7365 7220 247b 7573       ,'User ${us
+00007220: 6572 7d27 0d0a 2020 2020 2020 2020 2020  er}'..          
+00007230: 2020 2020 2020 2020 2020 2020 202c 2750               ,'P
+00007240: 6173 7377 6f72 6420 247b 7061 7373 776f  assword ${passwo
+00007250: 7264 7d27 0d0a 2020 2020 2020 2020 2020  rd}'..          
+00007260: 2020 2020 2020 2020 2020 2020 205d 202b               ] +
+00007270: 2063 6f6d 6d61 6e64 5f6c 6973 740d 0a0d   command_list...
+00007280: 0a0d 0a20 2020 2020 2020 206c 6f67 2e76  ...        log.v
+00007290: 6572 626f 7365 2827 5374 6172 7465 6420  erbose('Started 
+000072a0: 7275 6e6e 696e 6720 696d 706f 7274 6572  running importer
+000072b0: 2063 6f6d 6d61 6e64 7327 290d 0a0d 0a20   commands').... 
+000072c0: 2020 2020 2020 206e 203d 204e 6f6e 650d         n = None.
+000072d0: 0a0d 0a20 2020 2020 2020 2066 6f72 206e  ...        for n
+000072e0: 2c20 6c69 6e65 2069 6e20 656e 756d 6572  , line in enumer
+000072f0: 6174 6528 6c6c 752e 7275 6e5f 616e 645f  ate(llu.run_and_
+00007300: 7969 656c 645f 7369 6e67 6c65 5f6f 7574  yield_single_out
+00007310: 7075 745f 696d 706f 7274 6572 5f63 6f6d  put_importer_com
+00007320: 6d61 6e64 7328 636f 6d6d 616e 645f 6c69  mands(command_li
+00007330: 7374 0d0a 2020 2020 2020 2020 2020 2020  st..            
+00007340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007370: 2020 2020 2020 2020 2c65 6d70 6f77 6572          ,empower
+00007380: 5f69 6d70 6f72 7465 725f 6578 6563 7574  _importer_execut
+00007390: 6162 6c65 3d73 656c 662e 7369 7465 2e65  able=self.site.e
+000073a0: 6d70 6f77 6572 5f69 6d70 6f72 7465 725f  mpower_importer_
+000073b0: 6578 6563 7574 6162 6c65 0d0a 2020 2020  executable..    
 000073c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000073d0: 2020 2020 2929 3a0d 0a20 2020 2020 2020      )):..       
-000073e0: 2020 2020 2069 6620 6e20 3d3d 2030 2061       if n == 0 a
-000073f0: 6e64 2072 6574 7572 6e5f 6469 6374 7320  nd return_dicts 
-00007400: 616e 6420 6865 6164 6572 2069 7320 4e6f  and header is No
-00007410: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00007420: 2020 2020 2069 6620 7370 6c69 745f 6f6e       if split_on
-00007430: 5f74 6162 3a0d 0a20 2020 2020 2020 2020  _tab:..         
-00007440: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-00007450: 7220 3d20 6c69 6e65 2e73 706c 6974 2827  r = line.split('
-00007460: 5c74 2729 0d0a 2020 2020 2020 2020 2020  \t')..          
-00007470: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00007480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007490: 2068 6561 6465 7220 3d20 6c69 6e65 0d0a   header = line..
-000074a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000074b0: 636f 6e74 696e 7565 0d0a 0d0a 2020 2020  continue....    
-000074c0: 2020 2020 2020 2020 6966 2072 6574 7572          if retur
-000074d0: 6e5f 6469 6374 733a 0d0a 2020 2020 2020  n_dicts:..      
-000074e0: 2020 2020 2020 2020 2020 6966 2073 706c            if spl
-000074f0: 6974 5f6f 6e5f 7461 623a 0d0a 2020 2020  it_on_tab:..    
-00007500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007510: 7969 656c 6420 636f 6c6c 6563 7469 6f6e  yield collection
-00007520: 732e 4f72 6465 7265 6444 6963 7428 7a69  s.OrderedDict(zi
-00007530: 7028 6865 6164 6572 2c6c 696e 652e 7370  p(header,line.sp
-00007540: 6c69 7428 275c 7427 2929 290d 0a20 2020  lit('\t')))..   
-00007550: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00007560: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00007570: 2020 2020 2020 2020 7969 656c 6420 7b68          yield {h
-00007580: 6561 6465 723a 6c69 6e65 7d0d 0a20 2020  eader:line}..   
-00007590: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-000075a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075b0: 6966 2073 706c 6974 5f6f 6e5f 7461 623a  if split_on_tab:
-000075c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000075d0: 2020 2020 2020 7969 656c 6420 6c69 6e65        yield line
-000075e0: 2e73 706c 6974 2827 5c74 2729 0d0a 2020  .split('\t')..  
-000075f0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00007600: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00007610: 2020 2020 2020 2020 2079 6965 6c64 206c           yield l
-00007620: 696e 650d 0a0d 0a20 2020 2020 2020 2069  ine....        i
-00007630: 6620 6e20 3d3d 2030 2061 6e64 206c 696e  f n == 0 and lin
-00007640: 6520 213d 2027 273a 0d0a 2020 2020 2020  e != '':..      
-00007650: 2020 2020 2020 6966 206c 656e 286c 696e        if len(lin
-00007660: 6529 203e 2032 303a 0d0a 2020 2020 2020  e) > 20:..      
-00007670: 2020 2020 2020 2020 2020 7072 696e 7465            printe
-00007680: 645f 6c69 6e65 203d 206c 696e 655b 3a32  d_line = line[:2
-00007690: 305d 202b 2027 2e2e 2e20 3c66 6f6c 6c6f  0] + '... <follo
-000076a0: 7765 6420 6279 207b 7d20 6368 6172 6163  wed by {} charac
-000076b0: 7465 7273 3e27 2e66 6f72 6d61 7428 6c65  ters>'.format(le
-000076c0: 6e28 6c69 6e65 2920 2d20 3230 290d 0a20  n(line) - 20).. 
-000076d0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000076e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000076f0: 2020 7072 696e 7465 645f 6c69 6e65 203d    printed_line =
-00007700: 206c 696e 650d 0a0d 0a20 2020 2020 2020   line....       
-00007710: 2020 2020 206c 6f67 2e77 6172 6e69 6e67       log.warning
-00007720: 2827 456d 706f 7765 7220 696d 706f 7274  ('Empower import
-00007730: 6572 2072 6574 7572 6e65 6420 227b 7d22  er returned "{}"
-00007740: 2c20 6275 7420 7468 6973 2077 6173 206e  , but this was n
-00007750: 6f74 2064 6973 706c 6179 6564 2062 6563  ot displayed bec
-00007760: 6175 7365 2069 7420 7761 7320 696e 7465  ause it was inte
-00007770: 7270 7265 7465 6420 6173 2061 2068 6561  rpreted as a hea
-00007780: 6465 722e 2054 6f20 7265 6164 2074 6869  der. To read thi
-00007790: 7320 6c69 6e65 2073 6574 2070 6172 616d  s line set param
-000077a0: 6574 6572 2072 6574 7572 6e5f 6469 6374  eter return_dict
-000077b0: 7320 3d20 4661 6c73 6520 6f72 2073 6574  s = False or set
-000077c0: 2074 6865 2068 6561 6465 7220 7061 7261   the header para
-000077d0: 6d65 7465 7220 696e 202e 7275 6e5f 636f  meter in .run_co
-000077e0: 6d6d 616e 6473 2829 206f 7220 2e79 6965  mmands() or .yie
-000077f0: 6c64 5f63 6f6d 6d61 6e64 7328 2927 2e66  ld_commands()'.f
-00007800: 6f72 6d61 7428 7072 696e 7465 645f 6c69  ormat(printed_li
-00007810: 6e65 2929 0d0a 0d0a 2020 2020 2020 2020  ne))....        
-00007820: 6c6f 672e 7665 7262 6f73 6528 2746 696e  log.verbose('Fin
-00007830: 6973 6865 6420 7275 6e6e 696e 6720 696d  ished running im
-00007840: 706f 7274 6572 2063 6f6d 6d61 6e64 7327  porter commands'
-00007850: 290d 0a0d 0a20 2020 2064 6566 2072 756e  )....    def run
-00007860: 5f63 6f6d 6d61 6e64 7328 7365 6c66 2c63  _commands(self,c
-00007870: 6f6d 6d61 6e64 5f6c 6973 742c 6865 6164  ommand_list,head
-00007880: 6572 203d 204e 6f6e 652c 7370 6c69 745f  er = None,split_
-00007890: 6f6e 5f74 6162 203d 2054 7275 652c 7265  on_tab = True,re
-000078a0: 7475 726e 5f64 6963 7473 203d 2054 7275  turn_dicts = Tru
-000078b0: 652c 2066 6f72 6365 5f67 656e 6572 6174  e, force_generat
-000078c0: 6f72 203d 2046 616c 7365 2c20 6170 7065  or = False, appe
-000078d0: 6e64 5f6f 7574 7075 745f 636f 6d6d 616e  nd_output_comman
-000078e0: 6420 3d20 4661 6c73 6529 3a0d 0a20 2020  d = False):..   
-000078f0: 2020 2020 2027 2727 5275 6e20 6120 6c69       '''Run a li
-00007900: 7374 206f 6620 696d 706f 7274 6572 2063  st of importer c
-00007910: 6f6d 6d61 6e64 7320 6f6e 2074 6865 2061  ommands on the a
-00007920: 7474 6163 6865 6420 7369 7465 0d0a 2020  ttached site..  
-00007930: 2020 2020 2020 5573 6520 247b 7369 7465        Use ${site
-00007940: 7d2c 2024 7b75 7365 727d 2061 6e64 2024  }, ${user} and $
-00007950: 7b70 6173 7377 6f72 647d 2070 6c61 6365  {password} place
-00007960: 686f 6c64 6572 7320 696e 2063 6f6d 6d61  holders in comma
-00007970: 6e64 732c 2077 6869 6368 2077 696c 6c20  nds, which will 
-00007980: 6265 2066 696c 6c65 6420 7769 7468 2074  be filled with t
-00007990: 6865 2073 6974 6520 6c6f 6361 7469 6f6e  he site location
-000079a0: 2061 6e64 2065 6e63 7279 7074 6564 206c   and encrypted l
-000079b0: 6f67 6f6e 2069 6e66 6f72 6d61 7469 6f6e  ogon information
-000079c0: 0d0a 2020 2020 2020 2020 4966 2074 6865  ..        If the
-000079d0: 2066 696e 616c 2069 6d70 6f72 7465 7220   final importer 
-000079e0: 636f 6d6d 616e 6420 6973 2074 6865 2027  command is the '
-000079f0: 6f75 7470 7574 2720 636f 6d6d 616e 642c  output' command,
-00007a00: 2074 6865 6e20 7468 6973 2066 756e 6374   then this funct
-00007a10: 696f 6e20 7769 6c6c 2072 6574 7572 6e20  ion will return 
-00007a20: 6120 6765 6e65 7261 746f 7220 6f62 6a65  a generator obje
-00007a30: 6374 2074 6861 7420 6361 6e20 6265 206c  ct that can be l
-00007a40: 6f6f 7065 6420 6f76 6572 0d0a 0d0a 2020  ooped over....  
-00007a50: 2020 2020 2020 3a70 6172 616d 2063 6f6d        :param com
-00007a60: 6d61 6e64 5f6c 6973 743a 2063 6f6d 6d61  mand_list: comma
-00007a70: 6e64 7320 796f 7520 7761 6e74 2074 6f20  nds you want to 
-00007a80: 7275 6e2e 2044 6f6e 2774 2069 6e63 6c75  run. Don't inclu
-00007a90: 6465 2074 6865 2062 6174 6368 2063 6f6d  de the batch com
-00007aa0: 6d61 6e64 7320 5369 7465 4669 6c65 2c20  mands SiteFile, 
-00007ab0: 5573 6572 206f 7220 5061 7373 776f 7264  User or Password
-00007ac0: 2c20 6265 6361 7573 6520 7468 6573 6520  , because these 
-00007ad0: 6172 6520 696e 636c 7564 6564 0d0a 2020  are included..  
-00007ae0: 2020 2020 2020 3a70 6172 616d 2068 6561        :param hea
-00007af0: 6465 723a 2075 7365 2061 206c 6973 7420  der: use a list 
-00007b00: 6f66 2068 6561 6465 7220 636f 6c75 6d6e  of header column
-00007b10: 7320 2d20 6279 2064 6566 6175 6c74 2072  s - by default r
-00007b20: 756e 5f63 6f6d 6d61 6e64 7320 7573 6573  un_commands uses
-00007b30: 2074 6865 2066 6972 7374 2072 6563 6f72   the first recor
-00007b40: 6420 696e 2074 6865 206f 7574 7075 7420  d in the output 
-00007b50: 6173 2061 2068 6561 6465 720d 0a20 2020  as a header..   
-00007b60: 2020 2020 203a 7061 7261 6d20 7370 6c69       :param spli
-00007b70: 745f 6f6e 5f74 6162 3a20 7370 6c69 7420  t_on_tab: split 
-00007b80: 7468 6520 6f75 7470 7574 2062 7920 7468  the output by th
-00007b90: 6520 7461 6220 6368 6172 6163 7465 722c  e tab character,
-00007ba0: 2072 6574 7572 6e69 6e67 206c 6973 7473   returning lists
-00007bb0: 206f 7220 6469 6374 696f 6e61 7269 6573   or dictionaries
-00007bc0: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00007bd0: 2072 6574 7572 6e5f 6469 6374 7320 3a20   return_dicts : 
-00007be0: 7265 7475 726e 2061 2064 6963 7469 6f6e  return a diction
-00007bf0: 6172 7920 7769 7468 2074 6865 206b 6579  ary with the key
-00007c00: 7320 6173 2074 6865 2068 6561 6465 720d  s as the header.
-00007c10: 0a20 2020 2020 2020 2027 2727 0d0a 0d0a  .        '''....
-00007c20: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00007c30: 6c20 666f 7220 6c20 696e 2073 656c 662e  l for l in self.
-00007c40: 7969 656c 645f 636f 6d6d 616e 6473 2863  yield_commands(c
-00007c50: 6f6d 6d61 6e64 5f6c 6973 743d 636f 6d6d  ommand_list=comm
-00007c60: 616e 645f 6c69 7374 2c68 6561 6465 723d  and_list,header=
-00007c70: 6865 6164 6572 2c73 706c 6974 5f6f 6e5f  header,split_on_
-00007c80: 7461 6220 3d20 7370 6c69 745f 6f6e 5f74  tab = split_on_t
-00007c90: 6162 2c72 6574 7572 6e5f 6469 6374 7320  ab,return_dicts 
-00007ca0: 3d20 7265 7475 726e 5f64 6963 7473 2c20  = return_dicts, 
-00007cb0: 666f 7263 655f 6765 6e65 7261 746f 7220  force_generator 
-00007cc0: 3d20 5472 7565 2c61 7070 656e 645f 6f75  = True,append_ou
-00007cd0: 7470 7574 5f63 6f6d 6d61 6e64 3d61 7070  tput_command=app
-00007ce0: 656e 645f 6f75 7470 7574 5f63 6f6d 6d61  end_output_comma
-00007cf0: 6e64 295d 0d0a 0d0a 636c 6173 7320 5f53  nd)]....class _S
-00007d00: 6974 6544 6566 696e 6974 696f 6e4d 616e  iteDefinitionMan
-00007d10: 6970 756c 6174 6f72 286f 626a 6563 7429  ipulator(object)
-00007d20: 3a0d 0a20 2020 2027 2727 4120 6865 6c70  :..    '''A help
-00007d30: 6572 206f 626a 6563 7420 7468 6174 2061  er object that a
-00007d40: 6c6c 6f77 7320 7573 2074 6f20 6b65 6570  llows us to keep
-00007d50: 2073 6974 6520 6465 6669 6e69 7469 6f6e   site definition
-00007d60: 206d 616e 6970 756c 6174 696f 6e20 6f66   manipulation of
-00007d70: 6620 746f 206f 6e65 2073 6964 652e 0d0a  f to one side...
-00007d80: 2020 2020 5369 7465 2064 6566 696e 6974      Site definit
-00007d90: 696f 6e20 6d61 6e69 7075 6c61 7469 6f6e  ion manipulation
-00007da0: 2070 726f 6365 7373 6573 2061 7265 2065   processes are e
-00007db0: 7373 656e 7469 616c 6c79 2044 444c 206c  ssentially DDL l
-00007dc0: 696b 6520 2d20 6164 6469 6e67 2066 6965  ike - adding fie
-00007dd0: 6c64 7320 746f 2061 2064 696d 656e 7369  lds to a dimensi
-00007de0: 6f6e 2069 6e20 456d 706f 7765 7220 6973  on in Empower is
-00007df0: 206c 696b 6520 6164 6469 6e67 2063 6f6c   like adding col
-00007e00: 756d 6e73 2074 6f20 6120 7461 626c 6520  umns to a table 
-00007e10: 696e 2061 2064 6174 6162 6173 650d 0a20  in a database.. 
-00007e20: 2020 2053 6974 6573 2063 616e 2073 7469     Sites can sti
-00007e30: 6c6c 2062 6520 6465 6669 6e65 6420 696e  ll be defined in
-00007e40: 2074 6865 6972 2073 7562 2d6f 626a 6563   their sub-objec
-00007e50: 7473 2e20 452e 672e 2059 6f75 2063 616e  ts. E.g. You can
-00007e60: 2061 6464 2061 2066 6965 6c64 2074 6f20   add a field to 
-00007e70: 6120 4469 6d65 6e73 696f 6e2e 6669 656c  a Dimension.fiel
-00007e80: 6473 0d0a 2020 2020 486f 7765 7665 7220  ds..    However 
-00007e90: 7379 6e63 6872 6f6e 6973 696e 6720 7468  synchronising th
-00007ea0: 6520 6465 6669 6e69 7469 6f6e 2069 7320  e definition is 
-00007eb0: 646f 6e65 2069 6e20 6f6e 6520 706c 6163  done in one plac
-00007ec0: 652e 0d0a 2020 2020 5468 6174 2077 6179  e...    That way
-00007ed0: 2c20 6966 2079 6f75 2064 6964 6e27 7420  , if you didn't 
-00007ee0: 6d65 616e 2074 6f20 6368 616e 6765 2074  mean to change t
-00007ef0: 6865 2064 6566 696e 6974 696f 6e2c 2079  he definition, y
-00007f00: 6f75 2077 6f6e 2774 2061 6363 6964 656e  ou won't acciden
-00007f10: 7461 6c6c 7920 646f 2073 6f2c 2062 7574  tally do so, but
-00007f20: 2069 6620 796f 7520 6469 6420 6d65 616e   if you did mean
-00007f30: 2074 6f20 6368 616e 6765 2074 6865 2064   to change the d
-00007f40: 6566 696e 6974 696f 6e20 7468 656e 2061  efinition then a
-00007f50: 6c6c 206f 6620 796f 7572 2063 6861 6e67  ll of your chang
-00007f60: 6573 2063 616e 2062 6520 7379 6e63 6872  es can be synchr
-00007f70: 6f6e 6973 6564 2061 7420 6f6e 6365 0d0a  onised at once..
-00007f80: 2020 2020 5468 6520 6465 6669 6e69 7469      The definiti
-00007f90: 6f6e 206f 626a 6563 7420 6973 2061 6c73  on object is als
-00007fa0: 6f20 7573 6564 2074 6f20 6765 7420 7465  o used to get te
-00007fb0: 7874 7561 6c20 7265 7072 6573 656e 7461  xtual representa
-00007fc0: 7469 6f6e 7320 6f66 2074 6865 2073 6974  tions of the sit
-00007fd0: 650d 0a20 2020 2027 2727 0d0a 0d0a 2020  e..    '''....  
-00007fe0: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00007ff0: 656c 662c 7369 7465 293a 0d0a 0d0a 2020  elf,site):....  
-00008000: 2020 2020 2020 7365 6c66 2e73 6974 6520        self.site 
-00008010: 3d20 7369 7465 0d0a 0d0a 2020 2020 6465  = site....    de
-00008020: 6620 7379 6e63 6872 6f6e 6973 6528 7365  f synchronise(se
-00008030: 6c66 293a 0d0a 2020 2020 2020 2020 2727  lf):..        ''
-00008040: 2742 7269 6e67 2074 6865 2045 6d70 6f77  'Bring the Empow
-00008050: 6572 2064 6566 696e 6974 696f 6e20 7570  er definition up
-00008060: 2d74 6f2d 6461 7465 2077 6974 6820 6f75  -to-date with ou
-00008070: 7220 5369 7465 2064 6566 696e 6974 696f  r Site definitio
-00008080: 6e2c 2061 7070 6c79 696e 6720 616c 6c20  n, applying all 
-00008090: 6465 6669 6e69 7469 6f6e 2063 6861 6e67  definition chang
-000080a0: 6573 2727 270d 0a0d 0a20 2020 2020 2020  es'''....       
-000080b0: 2073 656c 662e 7379 6e63 6872 6f6e 6973   self.synchronis
-000080c0: 655f 7669 6577 706f 696e 745f 6465 6669  e_viewpoint_defi
-000080d0: 6e69 7469 6f6e 7328 290d 0a0d 0a0d 0a20  nitions()...... 
-000080e0: 2020 2064 6566 2073 796e 6368 726f 6e69     def synchroni
-000080f0: 7365 5f76 6965 7770 6f69 6e74 5f64 6566  se_viewpoint_def
-00008100: 696e 6974 696f 6e73 2873 656c 6629 3a0d  initions(self):.
-00008110: 0a20 2020 2020 2020 2027 2727 4272 696e  .        '''Brin
-00008120: 6720 7468 6520 456d 706f 7765 7220 5669  g the Empower Vi
-00008130: 6577 706f 696e 7473 2064 6566 696e 6974  ewpoints definit
-00008140: 696f 6e20 7570 2d74 6f2d 6461 7465 2077  ion up-to-date w
-00008150: 6974 6820 6f75 7220 5369 7465 2064 6566  ith our Site def
-00008160: 696e 6974 696f 6e2c 2061 7070 6c79 696e  inition, applyin
-00008170: 6720 616c 6c20 6465 6669 6e69 7469 6f6e  g all definition
-00008180: 2063 6861 6e67 6573 2727 270d 0a20 2020   changes'''..   
-00008190: 2020 2020 200d 0a20 2020 2020 2020 2073       ..        s
-000081a0: 656c 662e 7379 6e63 6872 6f6e 6973 655f  elf.synchronise_
-000081b0: 6469 6d65 6e73 696f 6e5f 6465 6669 6e69  dimension_defini
-000081c0: 7469 6f6e 7328 290d 0a0d 0a20 2020 2020  tions()....     
-000081d0: 2020 2023 544f 444f 202d 2072 756e 2074     #TODO - run t
-000081e0: 6865 2076 6965 7770 6f69 6e74 7320 7379  he viewpoints sy
-000081f0: 6e63 6872 6f6e 6973 6520 636f 6465 0d0a  nchronise code..
-00008200: 2020 2020 2020 2020 7061 7373 0d0a 0d0a          pass....
-00008210: 2020 2020 6465 6620 7379 6e63 6872 6f6e      def synchron
-00008220: 6973 655f 6469 6d65 6e73 696f 6e5f 6465  ise_dimension_de
-00008230: 6669 6e69 7469 6f6e 7328 7365 6c66 293a  finitions(self):
-00008240: 0d0a 2020 2020 2020 2020 2727 2742 7269  ..        '''Bri
-00008250: 6e67 2074 6865 2045 6d70 6f77 6572 2044  ng the Empower D
-00008260: 696d 656e 7369 6f6e 7320 6465 6669 6e69  imensions defini
-00008270: 7469 6f6e 2075 702d 746f 2d64 6174 6520  tion up-to-date 
-00008280: 7769 7468 206f 7572 2053 6974 6520 6465  with our Site de
-00008290: 6669 6e69 7469 6f6e 2c20 6170 706c 7969  finition, applyi
-000082a0: 6e67 2061 6c6c 2064 6566 696e 6974 696f  ng all definitio
-000082b0: 6e20 6368 616e 6765 7327 2727 0d0a 0d0a  n changes'''....
-000082c0: 2020 2020 2020 2020 7365 6c66 2e73 796e          self.syn
-000082d0: 6368 726f 6e69 7365 5f66 6965 6c64 5f64  chronise_field_d
-000082e0: 6566 696e 6974 696f 6e73 2829 0d0a 2020  efinitions()..  
-000082f0: 2020 2020 2020 666f 7220 6469 6d65 6e73        for dimens
-00008300: 696f 6e20 696e 2073 656c 662e 7369 7465  ion in self.site
-00008310: 2e64 696d 656e 7369 6f6e 732e 7661 6c75  .dimensions.valu
-00008320: 6573 2829 3a0d 0a20 2020 2020 2020 2020  es():..         
-00008330: 2020 2073 656c 662e 7379 6e63 6872 6f6e     self.synchron
-00008340: 6973 655f 7374 7275 6374 7572 655f 6465  ise_structure_de
-00008350: 6669 6e69 7469 6f6e 7328 6469 6d65 6e73  finitions(dimens
-00008360: 696f 6e3d 6469 6d65 6e73 696f 6e29 0d0a  ion=dimension)..
-00008370: 0d0a 0d0a 2020 2020 6465 6620 7379 6e63  ....    def sync
-00008380: 6872 6f6e 6973 655f 7374 7275 6374 7572  hronise_structur
-00008390: 655f 6465 6669 6e69 7469 6f6e 7328 7365  e_definitions(se
-000083a0: 6c66 2c64 696d 656e 7369 6f6e 293a 0d0a  lf,dimension):..
-000083b0: 2020 2020 2020 2020 2727 2742 7269 6e67          '''Bring
-000083c0: 2074 6865 2045 6d70 6f77 6572 2053 7472   the Empower Str
-000083d0: 7563 7475 7265 7320 6465 6669 6e69 7469  uctures definiti
-000083e0: 6f6e 2075 702d 746f 2d64 6174 6520 7769  on up-to-date wi
-000083f0: 7468 206f 7572 2053 6974 6520 6465 6669  th our Site defi
-00008400: 6e69 7469 6f6e 2c20 6170 706c 7969 6e67  nition, applying
-00008410: 2061 6c6c 2064 6566 696e 6974 696f 6e20   all definition 
-00008420: 6368 616e 6765 7327 2727 0d0a 0d0a 2020  changes'''....  
-00008430: 2020 2020 2020 2354 4f44 4f20 2d20 7275        #TODO - ru
-00008440: 6e20 7468 6520 7374 7275 6374 7572 6573  n the structures
-00008450: 2073 796e 6368 726f 6e69 7365 2063 6f64   synchronise cod
-00008460: 650d 0a20 2020 2020 2020 2073 7472 7563  e..        struc
-00008470: 7475 7265 735f 746f 5f63 7265 6174 6520  tures_to_create 
-00008480: 3d20 5b5d 0d0a 0d0a 2020 2020 2020 2020  = []....        
-00008490: 6465 6275 6720 3d20 6469 6d65 6e73 696f  debug = dimensio
-000084a0: 6e2e 7369 7465 2e5f 6465 6275 670d 0a0d  n.site._debug...
-000084b0: 0a20 2020 2020 2020 2023 4a41 5420 3230  .        #JAT 20
-000084c0: 3139 2d31 302d 3033 0d0a 2020 2020 2020  19-10-03..      
-000084d0: 2020 234f 6e6c 7920 7379 6e63 6872 6f6e    #Only synchron
-000084e0: 6973 6520 6966 2074 6865 2073 7472 7563  ise if the struc
-000084f0: 7475 7265 2068 6173 2062 6565 6e20 7265  ture has been re
-00008500: 6164 2e20 5374 7275 6374 7572 6520 776f  ad. Structure wo
-00008510: 756c 646e 2774 2068 6176 6520 6265 656e  uldn't have been
-00008520: 2061 6464 6564 2069 6620 6e6f 7420 7265   added if not re
-00008530: 6164 0d0a 2020 2020 2020 2020 2354 6869  ad..        #Thi
-00008540: 7320 7361 7665 7320 7573 2064 6f69 6e67  s saves us doing
-00008550: 2061 2066 756c 6c20 7374 7275 6374 7572   a full structur
-00008560: 6520 7661 6c75 6573 206c 6f61 6420 666f  e values load fo
-00008570: 7220 756e 746f 7563 6865 6420 6469 6d65  r untouched dime
-00008580: 6e73 696f 6e73 0d0a 2020 2020 2020 2020  nsions..        
-00008590: 6966 2064 696d 656e 7369 6f6e 2e73 7472  if dimension.str
-000085a0: 7563 7475 7265 732e 5f73 7472 7563 7475  uctures._structu
-000085b0: 7265 735f 7265 6164 3a0d 0a20 2020 2020  res_read:..     
-000085c0: 2020 2020 2020 2066 6f72 2073 7472 7563         for struc
-000085d0: 7475 7265 2069 6e20 6469 6d65 6e73 696f  ture in dimensio
-000085e0: 6e2e 7374 7275 6374 7572 6573 2e76 616c  n.structures.val
-000085f0: 7565 7328 293a 0d0a 2020 2020 2020 2020  ues():..        
-00008600: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00008610: 7472 7563 7475 7265 2e5f 6578 6973 7473  tructure._exists
-00008620: 5f69 6e5f 656d 706f 7765 723a 0d0a 2020  _in_empower:..  
-00008630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008640: 2020 7374 7275 6374 7572 6573 5f74 6f5f    structures_to_
-00008650: 6372 6561 7465 2e61 7070 656e 6428 7374  create.append(st
-00008660: 7275 6374 7572 6529 0d0a 0d0a 2020 2020  ructure)....    
-00008670: 2020 2020 6966 206c 656e 2873 7472 7563      if len(struc
-00008680: 7475 7265 735f 746f 5f63 7265 6174 6529  tures_to_create)
-00008690: 203e 2030 3a0d 0a0d 0a20 2020 2020 2020   > 0:....       
-000086a0: 2020 2020 2069 6620 6465 6275 673a 0d0a       if debug:..
-000086b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000086c0: 666f 7220 6469 7220 696e 205b 7365 6c66  for dir in [self
-000086d0: 2e5f 656d 706f 7765 725f 6469 6d5f 696d  ._empower_dim_im
-000086e0: 706f 7274 5f64 6972 5d3a 0d0a 0d0a 2020  port_dir]:....  
-000086f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008700: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00008710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008720: 6f73 2e6d 616b 6564 6972 7328 6469 7229  os.makedirs(dir)
-00008730: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00008740: 2020 2020 2020 6578 6365 7074 2046 696c        except Fil
-00008750: 6545 7869 7374 7345 7272 6f72 3a0d 0a20  eExistsError:.. 
+000073d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000073e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000073f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007400: 2929 3a0d 0a20 2020 2020 2020 2020 2020  )):..           
+00007410: 2069 6620 6e20 3d3d 2030 2061 6e64 2072   if n == 0 and r
+00007420: 6574 7572 6e5f 6469 6374 7320 616e 6420  eturn_dicts and 
+00007430: 6865 6164 6572 2069 7320 4e6f 6e65 3a0d  header is None:.
+00007440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007450: 2069 6620 7370 6c69 745f 6f6e 5f74 6162   if split_on_tab
+00007460: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00007470: 2020 2020 2020 2068 6561 6465 7220 3d20         header = 
+00007480: 6c69 6e65 2e73 706c 6974 2827 5c74 2729  line.split('\t')
+00007490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000074a0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000074b0: 2020 2020 2020 2020 2020 2020 2068 6561               hea
+000074c0: 6465 7220 3d20 6c69 6e65 0d0a 2020 2020  der = line..    
+000074d0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+000074e0: 696e 7565 0d0a 0d0a 2020 2020 2020 2020  inue....        
+000074f0: 2020 2020 6966 2072 6574 7572 6e5f 6469      if return_di
+00007500: 6374 733a 0d0a 2020 2020 2020 2020 2020  cts:..          
+00007510: 2020 2020 2020 6966 2073 706c 6974 5f6f        if split_o
+00007520: 6e5f 7461 623a 0d0a 2020 2020 2020 2020  n_tab:..        
+00007530: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+00007540: 6420 636f 6c6c 6563 7469 6f6e 732e 4f72  d collections.Or
+00007550: 6465 7265 6444 6963 7428 7a69 7028 6865  deredDict(zip(he
+00007560: 6164 6572 2c6c 696e 652e 7370 6c69 7428  ader,line.split(
+00007570: 275c 7427 2929 290d 0a20 2020 2020 2020  '\t')))..       
+00007580: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00007590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075a0: 2020 2020 7969 656c 6420 7b68 6561 6465      yield {heade
+000075b0: 723a 6c69 6e65 7d0d 0a20 2020 2020 2020  r:line}..       
+000075c0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000075d0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000075e0: 706c 6974 5f6f 6e5f 7461 623a 0d0a 2020  plit_on_tab:..  
+000075f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007600: 2020 7969 656c 6420 6c69 6e65 2e73 706c    yield line.spl
+00007610: 6974 2827 5c74 2729 0d0a 2020 2020 2020  it('\t')..      
+00007620: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00007630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007640: 2020 2020 2079 6965 6c64 206c 696e 650d       yield line.
+00007650: 0a0d 0a20 2020 2020 2020 2069 6620 6e20  ...        if n 
+00007660: 3d3d 2030 2061 6e64 206c 696e 6520 213d  == 0 and line !=
+00007670: 2027 273a 0d0a 2020 2020 2020 2020 2020   '':..          
+00007680: 2020 6966 206c 656e 286c 696e 6529 203e    if len(line) >
+00007690: 2032 303a 0d0a 2020 2020 2020 2020 2020   20:..          
+000076a0: 2020 2020 2020 7072 696e 7465 645f 6c69        printed_li
+000076b0: 6e65 203d 206c 696e 655b 3a32 305d 202b  ne = line[:20] +
+000076c0: 2027 2e2e 2e20 3c66 6f6c 6c6f 7765 6420   '... <followed 
+000076d0: 6279 207b 7d20 6368 6172 6163 7465 7273  by {} characters
+000076e0: 3e27 2e66 6f72 6d61 7428 6c65 6e28 6c69  >'.format(len(li
+000076f0: 6e65 2920 2d20 3230 290d 0a20 2020 2020  ne) - 20)..     
+00007700: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00007710: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00007720: 696e 7465 645f 6c69 6e65 203d 206c 696e  inted_line = lin
+00007730: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+00007740: 206c 6f67 2e77 6172 6e69 6e67 2827 456d   log.warning('Em
+00007750: 706f 7765 7220 696d 706f 7274 6572 2072  power importer r
+00007760: 6574 7572 6e65 6420 227b 7d22 2c20 6275  eturned "{}", bu
+00007770: 7420 7468 6973 2077 6173 206e 6f74 2064  t this was not d
+00007780: 6973 706c 6179 6564 2062 6563 6175 7365  isplayed because
+00007790: 2069 7420 7761 7320 696e 7465 7270 7265   it was interpre
+000077a0: 7465 6420 6173 2061 2068 6561 6465 722e  ted as a header.
+000077b0: 2054 6f20 7265 6164 2074 6869 7320 6c69   To read this li
+000077c0: 6e65 2073 6574 2070 6172 616d 6574 6572  ne set parameter
+000077d0: 2072 6574 7572 6e5f 6469 6374 7320 3d20   return_dicts = 
+000077e0: 4661 6c73 6520 6f72 2073 6574 2074 6865  False or set the
+000077f0: 2068 6561 6465 7220 7061 7261 6d65 7465   header paramete
+00007800: 7220 696e 202e 7275 6e5f 636f 6d6d 616e  r in .run_comman
+00007810: 6473 2829 206f 7220 2e79 6965 6c64 5f63  ds() or .yield_c
+00007820: 6f6d 6d61 6e64 7328 2927 2e66 6f72 6d61  ommands()'.forma
+00007830: 7428 7072 696e 7465 645f 6c69 6e65 2929  t(printed_line))
+00007840: 0d0a 0d0a 2020 2020 2020 2020 6c6f 672e  ....        log.
+00007850: 7665 7262 6f73 6528 2746 696e 6973 6865  verbose('Finishe
+00007860: 6420 7275 6e6e 696e 6720 696d 706f 7274  d running import
+00007870: 6572 2063 6f6d 6d61 6e64 7327 290d 0a0d  er commands')...
+00007880: 0a20 2020 2064 6566 2072 756e 5f63 6f6d  .    def run_com
+00007890: 6d61 6e64 7328 7365 6c66 2c63 6f6d 6d61  mands(self,comma
+000078a0: 6e64 5f6c 6973 742c 6865 6164 6572 203d  nd_list,header =
+000078b0: 204e 6f6e 652c 7370 6c69 745f 6f6e 5f74   None,split_on_t
+000078c0: 6162 203d 2054 7275 652c 7265 7475 726e  ab = True,return
+000078d0: 5f64 6963 7473 203d 2054 7275 652c 2066  _dicts = True, f
+000078e0: 6f72 6365 5f67 656e 6572 6174 6f72 203d  orce_generator =
+000078f0: 2046 616c 7365 2c20 6170 7065 6e64 5f6f   False, append_o
+00007900: 7574 7075 745f 636f 6d6d 616e 6420 3d20  utput_command = 
+00007910: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+00007920: 2027 2727 5275 6e20 6120 6c69 7374 206f   '''Run a list o
+00007930: 6620 696d 706f 7274 6572 2063 6f6d 6d61  f importer comma
+00007940: 6e64 7320 6f6e 2074 6865 2061 7474 6163  nds on the attac
+00007950: 6865 6420 7369 7465 0d0a 2020 2020 2020  hed site..      
+00007960: 2020 5573 6520 247b 7369 7465 7d2c 2024    Use ${site}, $
+00007970: 7b75 7365 727d 2061 6e64 2024 7b70 6173  {user} and ${pas
+00007980: 7377 6f72 647d 2070 6c61 6365 686f 6c64  sword} placehold
+00007990: 6572 7320 696e 2063 6f6d 6d61 6e64 732c  ers in commands,
+000079a0: 2077 6869 6368 2077 696c 6c20 6265 2066   which will be f
+000079b0: 696c 6c65 6420 7769 7468 2074 6865 2073  illed with the s
+000079c0: 6974 6520 6c6f 6361 7469 6f6e 2061 6e64  ite location and
+000079d0: 2065 6e63 7279 7074 6564 206c 6f67 6f6e   encrypted logon
+000079e0: 2069 6e66 6f72 6d61 7469 6f6e 0d0a 2020   information..  
+000079f0: 2020 2020 2020 4966 2074 6865 2066 696e        If the fin
+00007a00: 616c 2069 6d70 6f72 7465 7220 636f 6d6d  al importer comm
+00007a10: 616e 6420 6973 2074 6865 2027 6f75 7470  and is the 'outp
+00007a20: 7574 2720 636f 6d6d 616e 642c 2074 6865  ut' command, the
+00007a30: 6e20 7468 6973 2066 756e 6374 696f 6e20  n this function 
+00007a40: 7769 6c6c 2072 6574 7572 6e20 6120 6765  will return a ge
+00007a50: 6e65 7261 746f 7220 6f62 6a65 6374 2074  nerator object t
+00007a60: 6861 7420 6361 6e20 6265 206c 6f6f 7065  hat can be loope
+00007a70: 6420 6f76 6572 0d0a 0d0a 2020 2020 2020  d over....      
+00007a80: 2020 3a70 6172 616d 2063 6f6d 6d61 6e64    :param command
+00007a90: 5f6c 6973 743a 2063 6f6d 6d61 6e64 7320  _list: commands 
+00007aa0: 796f 7520 7761 6e74 2074 6f20 7275 6e2e  you want to run.
+00007ab0: 2044 6f6e 2774 2069 6e63 6c75 6465 2074   Don't include t
+00007ac0: 6865 2062 6174 6368 2063 6f6d 6d61 6e64  he batch command
+00007ad0: 7320 5369 7465 4669 6c65 2c20 5573 6572  s SiteFile, User
+00007ae0: 206f 7220 5061 7373 776f 7264 2c20 6265   or Password, be
+00007af0: 6361 7573 6520 7468 6573 6520 6172 6520  cause these are 
+00007b00: 696e 636c 7564 6564 0d0a 2020 2020 2020  included..      
+00007b10: 2020 3a70 6172 616d 2068 6561 6465 723a    :param header:
+00007b20: 2075 7365 2061 206c 6973 7420 6f66 2068   use a list of h
+00007b30: 6561 6465 7220 636f 6c75 6d6e 7320 2d20  eader columns - 
+00007b40: 6279 2064 6566 6175 6c74 2072 756e 5f63  by default run_c
+00007b50: 6f6d 6d61 6e64 7320 7573 6573 2074 6865  ommands uses the
+00007b60: 2066 6972 7374 2072 6563 6f72 6420 696e   first record in
+00007b70: 2074 6865 206f 7574 7075 7420 6173 2061   the output as a
+00007b80: 2068 6561 6465 720d 0a20 2020 2020 2020   header..       
+00007b90: 203a 7061 7261 6d20 7370 6c69 745f 6f6e   :param split_on
+00007ba0: 5f74 6162 3a20 7370 6c69 7420 7468 6520  _tab: split the 
+00007bb0: 6f75 7470 7574 2062 7920 7468 6520 7461  output by the ta
+00007bc0: 6220 6368 6172 6163 7465 722c 2072 6574  b character, ret
+00007bd0: 7572 6e69 6e67 206c 6973 7473 206f 7220  urning lists or 
+00007be0: 6469 6374 696f 6e61 7269 6573 0d0a 2020  dictionaries..  
+00007bf0: 2020 2020 2020 3a70 6172 616d 2072 6574        :param ret
+00007c00: 7572 6e5f 6469 6374 7320 3a20 7265 7475  urn_dicts : retu
+00007c10: 726e 2061 2064 6963 7469 6f6e 6172 7920  rn a dictionary 
+00007c20: 7769 7468 2074 6865 206b 6579 7320 6173  with the keys as
+00007c30: 2074 6865 2068 6561 6465 720d 0a20 2020   the header..   
+00007c40: 2020 2020 2027 2727 0d0a 0d0a 2020 2020       '''....    
+00007c50: 2020 2020 7265 7475 726e 205b 6c20 666f      return [l fo
+00007c60: 7220 6c20 696e 2073 656c 662e 7969 656c  r l in self.yiel
+00007c70: 645f 636f 6d6d 616e 6473 2863 6f6d 6d61  d_commands(comma
+00007c80: 6e64 5f6c 6973 743d 636f 6d6d 616e 645f  nd_list=command_
+00007c90: 6c69 7374 2c68 6561 6465 723d 6865 6164  list,header=head
+00007ca0: 6572 2c73 706c 6974 5f6f 6e5f 7461 6220  er,split_on_tab 
+00007cb0: 3d20 7370 6c69 745f 6f6e 5f74 6162 2c72  = split_on_tab,r
+00007cc0: 6574 7572 6e5f 6469 6374 7320 3d20 7265  eturn_dicts = re
+00007cd0: 7475 726e 5f64 6963 7473 2c20 666f 7263  turn_dicts, forc
+00007ce0: 655f 6765 6e65 7261 746f 7220 3d20 5472  e_generator = Tr
+00007cf0: 7565 2c61 7070 656e 645f 6f75 7470 7574  ue,append_output
+00007d00: 5f63 6f6d 6d61 6e64 3d61 7070 656e 645f  _command=append_
+00007d10: 6f75 7470 7574 5f63 6f6d 6d61 6e64 295d  output_command)]
+00007d20: 0d0a 0d0a 636c 6173 7320 5f53 6974 6544  ....class _SiteD
+00007d30: 6566 696e 6974 696f 6e4d 616e 6970 756c  efinitionManipul
+00007d40: 6174 6f72 286f 626a 6563 7429 3a0d 0a20  ator(object):.. 
+00007d50: 2020 2027 2727 4120 6865 6c70 6572 206f     '''A helper o
+00007d60: 626a 6563 7420 7468 6174 2061 6c6c 6f77  bject that allow
+00007d70: 7320 7573 2074 6f20 6b65 6570 2073 6974  s us to keep sit
+00007d80: 6520 6465 6669 6e69 7469 6f6e 206d 616e  e definition man
+00007d90: 6970 756c 6174 696f 6e20 6f66 6620 746f  ipulation off to
+00007da0: 206f 6e65 2073 6964 652e 0d0a 2020 2020   one side...    
+00007db0: 5369 7465 2064 6566 696e 6974 696f 6e20  Site definition 
+00007dc0: 6d61 6e69 7075 6c61 7469 6f6e 2070 726f  manipulation pro
+00007dd0: 6365 7373 6573 2061 7265 2065 7373 656e  cesses are essen
+00007de0: 7469 616c 6c79 2044 444c 206c 696b 6520  tially DDL like 
+00007df0: 2d20 6164 6469 6e67 2066 6965 6c64 7320  - adding fields 
+00007e00: 746f 2061 2064 696d 656e 7369 6f6e 2069  to a dimension i
+00007e10: 6e20 456d 706f 7765 7220 6973 206c 696b  n Empower is lik
+00007e20: 6520 6164 6469 6e67 2063 6f6c 756d 6e73  e adding columns
+00007e30: 2074 6f20 6120 7461 626c 6520 696e 2061   to a table in a
+00007e40: 2064 6174 6162 6173 650d 0a20 2020 2053   database..    S
+00007e50: 6974 6573 2063 616e 2073 7469 6c6c 2062  ites can still b
+00007e60: 6520 6465 6669 6e65 6420 696e 2074 6865  e defined in the
+00007e70: 6972 2073 7562 2d6f 626a 6563 7473 2e20  ir sub-objects. 
+00007e80: 452e 672e 2059 6f75 2063 616e 2061 6464  E.g. You can add
+00007e90: 2061 2066 6965 6c64 2074 6f20 6120 4469   a field to a Di
+00007ea0: 6d65 6e73 696f 6e2e 6669 656c 6473 0d0a  mension.fields..
+00007eb0: 2020 2020 486f 7765 7665 7220 7379 6e63      However sync
+00007ec0: 6872 6f6e 6973 696e 6720 7468 6520 6465  hronising the de
+00007ed0: 6669 6e69 7469 6f6e 2069 7320 646f 6e65  finition is done
+00007ee0: 2069 6e20 6f6e 6520 706c 6163 652e 0d0a   in one place...
+00007ef0: 2020 2020 5468 6174 2077 6179 2c20 6966      That way, if
+00007f00: 2079 6f75 2064 6964 6e27 7420 6d65 616e   you didn't mean
+00007f10: 2074 6f20 6368 616e 6765 2074 6865 2064   to change the d
+00007f20: 6566 696e 6974 696f 6e2c 2079 6f75 2077  efinition, you w
+00007f30: 6f6e 2774 2061 6363 6964 656e 7461 6c6c  on't accidentall
+00007f40: 7920 646f 2073 6f2c 2062 7574 2069 6620  y do so, but if 
+00007f50: 796f 7520 6469 6420 6d65 616e 2074 6f20  you did mean to 
+00007f60: 6368 616e 6765 2074 6865 2064 6566 696e  change the defin
+00007f70: 6974 696f 6e20 7468 656e 2061 6c6c 206f  ition then all o
+00007f80: 6620 796f 7572 2063 6861 6e67 6573 2063  f your changes c
+00007f90: 616e 2062 6520 7379 6e63 6872 6f6e 6973  an be synchronis
+00007fa0: 6564 2061 7420 6f6e 6365 0d0a 2020 2020  ed at once..    
+00007fb0: 5468 6520 6465 6669 6e69 7469 6f6e 206f  The definition o
+00007fc0: 626a 6563 7420 6973 2061 6c73 6f20 7573  bject is also us
+00007fd0: 6564 2074 6f20 6765 7420 7465 7874 7561  ed to get textua
+00007fe0: 6c20 7265 7072 6573 656e 7461 7469 6f6e  l representation
+00007ff0: 7320 6f66 2074 6865 2073 6974 650d 0a20  s of the site.. 
+00008000: 2020 2027 2727 0d0a 0d0a 2020 2020 6465     '''....    de
+00008010: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00008020: 7369 7465 293a 0d0a 0d0a 2020 2020 2020  site):....      
+00008030: 2020 7365 6c66 2e73 6974 6520 3d20 7369    self.site = si
+00008040: 7465 0d0a 0d0a 2020 2020 6465 6620 7379  te....    def sy
+00008050: 6e63 6872 6f6e 6973 6528 7365 6c66 293a  nchronise(self):
+00008060: 0d0a 2020 2020 2020 2020 2727 2742 7269  ..        '''Bri
+00008070: 6e67 2074 6865 2045 6d70 6f77 6572 2064  ng the Empower d
+00008080: 6566 696e 6974 696f 6e20 7570 2d74 6f2d  efinition up-to-
+00008090: 6461 7465 2077 6974 6820 6f75 7220 5369  date with our Si
+000080a0: 7465 2064 6566 696e 6974 696f 6e2c 2061  te definition, a
+000080b0: 7070 6c79 696e 6720 616c 6c20 6465 6669  pplying all defi
+000080c0: 6e69 7469 6f6e 2063 6861 6e67 6573 2727  nition changes''
+000080d0: 270d 0a0d 0a20 2020 2020 2020 2073 656c  '....        sel
+000080e0: 662e 7379 6e63 6872 6f6e 6973 655f 7669  f.synchronise_vi
+000080f0: 6577 706f 696e 745f 6465 6669 6e69 7469  ewpoint_definiti
+00008100: 6f6e 7328 290d 0a0d 0a0d 0a20 2020 2064  ons()......    d
+00008110: 6566 2073 796e 6368 726f 6e69 7365 5f76  ef synchronise_v
+00008120: 6965 7770 6f69 6e74 5f64 6566 696e 6974  iewpoint_definit
+00008130: 696f 6e73 2873 656c 6629 3a0d 0a20 2020  ions(self):..   
+00008140: 2020 2020 2027 2727 4272 696e 6720 7468       '''Bring th
+00008150: 6520 456d 706f 7765 7220 5669 6577 706f  e Empower Viewpo
+00008160: 696e 7473 2064 6566 696e 6974 696f 6e20  ints definition 
+00008170: 7570 2d74 6f2d 6461 7465 2077 6974 6820  up-to-date with 
+00008180: 6f75 7220 5369 7465 2064 6566 696e 6974  our Site definit
+00008190: 696f 6e2c 2061 7070 6c79 696e 6720 616c  ion, applying al
+000081a0: 6c20 6465 6669 6e69 7469 6f6e 2063 6861  l definition cha
+000081b0: 6e67 6573 2727 270d 0a20 2020 2020 2020  nges'''..       
+000081c0: 200d 0a20 2020 2020 2020 2073 656c 662e   ..        self.
+000081d0: 7379 6e63 6872 6f6e 6973 655f 6469 6d65  synchronise_dime
+000081e0: 6e73 696f 6e5f 6465 6669 6e69 7469 6f6e  nsion_definition
+000081f0: 7328 290d 0a0d 0a20 2020 2020 2020 2023  s()....        #
+00008200: 544f 444f 202d 2072 756e 2074 6865 2076  TODO - run the v
+00008210: 6965 7770 6f69 6e74 7320 7379 6e63 6872  iewpoints synchr
+00008220: 6f6e 6973 6520 636f 6465 0d0a 2020 2020  onise code..    
+00008230: 2020 2020 7061 7373 0d0a 0d0a 2020 2020      pass....    
+00008240: 6465 6620 7379 6e63 6872 6f6e 6973 655f  def synchronise_
+00008250: 6469 6d65 6e73 696f 6e5f 6465 6669 6e69  dimension_defini
+00008260: 7469 6f6e 7328 7365 6c66 293a 0d0a 2020  tions(self):..  
+00008270: 2020 2020 2020 2727 2742 7269 6e67 2074        '''Bring t
+00008280: 6865 2045 6d70 6f77 6572 2044 696d 656e  he Empower Dimen
+00008290: 7369 6f6e 7320 6465 6669 6e69 7469 6f6e  sions definition
+000082a0: 2075 702d 746f 2d64 6174 6520 7769 7468   up-to-date with
+000082b0: 206f 7572 2053 6974 6520 6465 6669 6e69   our Site defini
+000082c0: 7469 6f6e 2c20 6170 706c 7969 6e67 2061  tion, applying a
+000082d0: 6c6c 2064 6566 696e 6974 696f 6e20 6368  ll definition ch
+000082e0: 616e 6765 7327 2727 0d0a 0d0a 2020 2020  anges'''....    
+000082f0: 2020 2020 7365 6c66 2e73 796e 6368 726f      self.synchro
+00008300: 6e69 7365 5f66 6965 6c64 5f64 6566 696e  nise_field_defin
+00008310: 6974 696f 6e73 2829 0d0a 2020 2020 2020  itions()..      
+00008320: 2020 666f 7220 6469 6d65 6e73 696f 6e20    for dimension 
+00008330: 696e 2073 656c 662e 7369 7465 2e64 696d  in self.site.dim
+00008340: 656e 7369 6f6e 732e 7661 6c75 6573 2829  ensions.values()
+00008350: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00008360: 656c 662e 7379 6e63 6872 6f6e 6973 655f  elf.synchronise_
+00008370: 7374 7275 6374 7572 655f 6465 6669 6e69  structure_defini
+00008380: 7469 6f6e 7328 6469 6d65 6e73 696f 6e3d  tions(dimension=
+00008390: 6469 6d65 6e73 696f 6e29 0d0a 0d0a 0d0a  dimension)......
+000083a0: 2020 2020 6465 6620 7379 6e63 6872 6f6e      def synchron
+000083b0: 6973 655f 7374 7275 6374 7572 655f 6465  ise_structure_de
+000083c0: 6669 6e69 7469 6f6e 7328 7365 6c66 2c64  finitions(self,d
+000083d0: 696d 656e 7369 6f6e 293a 0d0a 2020 2020  imension):..    
+000083e0: 2020 2020 2727 2742 7269 6e67 2074 6865      '''Bring the
+000083f0: 2045 6d70 6f77 6572 2053 7472 7563 7475   Empower Structu
+00008400: 7265 7320 6465 6669 6e69 7469 6f6e 2075  res definition u
+00008410: 702d 746f 2d64 6174 6520 7769 7468 206f  p-to-date with o
+00008420: 7572 2053 6974 6520 6465 6669 6e69 7469  ur Site definiti
+00008430: 6f6e 2c20 6170 706c 7969 6e67 2061 6c6c  on, applying all
+00008440: 2064 6566 696e 6974 696f 6e20 6368 616e   definition chan
+00008450: 6765 7327 2727 0d0a 0d0a 2020 2020 2020  ges'''....      
+00008460: 2020 2354 4f44 4f20 2d20 7275 6e20 7468    #TODO - run th
+00008470: 6520 7374 7275 6374 7572 6573 2073 796e  e structures syn
+00008480: 6368 726f 6e69 7365 2063 6f64 650d 0a20  chronise code.. 
+00008490: 2020 2020 2020 2073 7472 7563 7475 7265         structure
+000084a0: 735f 746f 5f63 7265 6174 6520 3d20 5b5d  s_to_create = []
+000084b0: 0d0a 0d0a 2020 2020 2020 2020 6465 6275  ....        debu
+000084c0: 6720 3d20 6469 6d65 6e73 696f 6e2e 7369  g = dimension.si
+000084d0: 7465 2e5f 6465 6275 670d 0a0d 0a20 2020  te._debug....   
+000084e0: 2020 2020 2023 4a41 5420 3230 3139 2d31       #JAT 2019-1
+000084f0: 302d 3033 0d0a 2020 2020 2020 2020 234f  0-03..        #O
+00008500: 6e6c 7920 7379 6e63 6872 6f6e 6973 6520  nly synchronise 
+00008510: 6966 2074 6865 2073 7472 7563 7475 7265  if the structure
+00008520: 2068 6173 2062 6565 6e20 7265 6164 2e20   has been read. 
+00008530: 5374 7275 6374 7572 6520 776f 756c 646e  Structure wouldn
+00008540: 2774 2068 6176 6520 6265 656e 2061 6464  't have been add
+00008550: 6564 2069 6620 6e6f 7420 7265 6164 0d0a  ed if not read..
+00008560: 2020 2020 2020 2020 2354 6869 7320 7361          #This sa
+00008570: 7665 7320 7573 2064 6f69 6e67 2061 2066  ves us doing a f
+00008580: 756c 6c20 7374 7275 6374 7572 6520 7661  ull structure va
+00008590: 6c75 6573 206c 6f61 6420 666f 7220 756e  lues load for un
+000085a0: 746f 7563 6865 6420 6469 6d65 6e73 696f  touched dimensio
+000085b0: 6e73 0d0a 2020 2020 2020 2020 6966 2064  ns..        if d
+000085c0: 696d 656e 7369 6f6e 2e73 7472 7563 7475  imension.structu
+000085d0: 7265 732e 5f73 7472 7563 7475 7265 735f  res._structures_
+000085e0: 7265 6164 3a0d 0a20 2020 2020 2020 2020  read:..         
+000085f0: 2020 2066 6f72 2073 7472 7563 7475 7265     for structure
+00008600: 2069 6e20 6469 6d65 6e73 696f 6e2e 7374   in dimension.st
+00008610: 7275 6374 7572 6573 2e76 616c 7565 7328  ructures.values(
+00008620: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00008630: 2020 2020 6966 206e 6f74 2073 7472 7563      if not struc
+00008640: 7475 7265 2e5f 6578 6973 7473 5f69 6e5f  ture._exists_in_
+00008650: 656d 706f 7765 723a 0d0a 2020 2020 2020  empower:..      
+00008660: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00008670: 7275 6374 7572 6573 5f74 6f5f 6372 6561  ructures_to_crea
+00008680: 7465 2e61 7070 656e 6428 7374 7275 6374  te.append(struct
+00008690: 7572 6529 0d0a 0d0a 2020 2020 2020 2020  ure)....        
+000086a0: 6966 206c 656e 2873 7472 7563 7475 7265  if len(structure
+000086b0: 735f 746f 5f63 7265 6174 6529 203e 2030  s_to_create) > 0
+000086c0: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+000086d0: 2069 6620 6465 6275 673a 0d0a 2020 2020   if debug:..    
+000086e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000086f0: 6469 7220 696e 205b 7365 6c66 2e5f 656d  dir in [self._em
+00008700: 706f 7765 725f 6469 6d5f 696d 706f 7274  power_dim_import
+00008710: 5f64 6972 5d3a 0d0a 0d0a 2020 2020 2020  _dir]:....      
+00008720: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00008730: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00008740: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+00008750: 616b 6564 6972 7328 6469 7229 0d0a 2020  akedirs(dir)..  
 00008760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008770: 2020 2020 2020 2070 6173 730d 0a20 2020         pass..   
-00008780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008790: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
-000087a0: 6173 2065 3a0d 0a20 2020 2020 2020 2020  as e:..         
-000087b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000087c0: 6620 652e 7769 6e65 7272 6f72 203d 3d20  f e.winerror == 
-000087d0: 3132 333a 0d0a 2020 2020 2020 2020 2020  123:..          
-000087e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000087f0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00008800: 6f72 2827 4469 7265 6374 6f72 7920 227b  or('Directory "{
-00008810: 7d22 2068 6173 2061 6e20 696e 7661 6c69  }" has an invali
-00008820: 6420 6e61 6d65 2e20 4469 6420 796f 7520  d name. Did you 
-00008830: 7061 7373 2061 2073 6974 655f 6c6f 6361  pass a site_loca
-00008840: 746f 7220 7061 7468 2022 7b7d 2220 7769  tor path "{}" wi
-00008850: 7468 6f75 7420 646f 7562 6c65 2d65 7363  thout double-esc
-00008860: 6170 696e 6720 6261 636b 736c 6173 6865  aping backslashe
-00008870: 7320 6f72 2070 7265 6669 7869 6e67 2074  s or prefixing t
-00008880: 6865 2073 7472 696e 6720 7769 7468 2061  he string with a
-00008890: 6e20 2272 2220 666f 7220 7261 773f 272e  n "r" for raw?'.
-000088a0: 666f 726d 6174 2864 6972 2c72 6570 7228  format(dir,repr(
-000088b0: 7369 7465 5f6c 6f63 6174 6f72 2929 290d  site_locator))).
-000088c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000088d0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-000088e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000088f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00008900: 6520 650d 0a0d 0a20 2020 2020 2020 2020  e e....         
-00008910: 2020 2020 2020 2073 7472 7563 7475 7265         structure
-00008920: 5f6d 6574 6164 6174 615f 6669 6c65 7061  _metadata_filepa
-00008930: 7468 203d 206f 732e 7061 7468 2e6a 6f69  th = os.path.joi
-00008940: 6e28 7365 6c66 2e73 6974 652e 5f65 6d70  n(self.site._emp
-00008950: 6f77 6572 5f64 696d 5f69 6d70 6f72 745f  ower_dim_import_
-00008960: 6469 722c 2753 7472 7563 7475 7265 735f  dir,'Structures_
-00008970: 7b7d 2e74 7376 272e 666f 726d 6174 2864  {}.tsv'.format(d
-00008980: 696d 656e 7369 6f6e 2e69 6e64 6578 2929  imension.index))
-00008990: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-000089a0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-000089b0: 2020 2020 2073 7472 7563 7475 7265 5f6d       structure_m
-000089c0: 6574 6164 6174 615f 6669 6c65 7061 7468  etadata_filepath
-000089d0: 203d 2072 275c 5c2e 5c70 6970 655c 7b7d   = r'\\.\pipe\{}
-000089e0: 272e 666f 726d 6174 2875 7569 642e 7575  '.format(uuid.uu
-000089f0: 6964 3428 2929 0d0a 0d0a 2020 2020 2020  id4())....      
-00008a00: 2020 2020 2020 2343 6865 636b 2076 6572        #Check ver
-00008a10: 7369 6f6e 206f 6620 456d 706f 7765 720d  sion of Empower.
-00008a20: 0a20 2020 2020 2020 2020 2020 206d 616a  .            maj
-00008a30: 6f72 5f76 6572 7369 6f6e 2c20 6d69 6e6f  or_version, mino
-00008a40: 725f 7665 7273 696f 6e2c 2072 656c 6561  r_version, relea
-00008a50: 7365 2c20 7265 6c65 6173 655f 6e75 6d62  se, release_numb
-00008a60: 6572 203d 2073 656c 662e 7369 7465 2e69  er = self.site.i
-00008a70: 6d70 6f72 7465 725f 7665 7273 696f 6e0d  mporter_version.
-00008a80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00008a90: 286d 616a 6f72 5f76 6572 7369 6f6e 203d  (major_version =
-00008aa0: 3d20 3920 616e 6420 2872 656c 6561 7365  = 9 and (release
-00008ab0: 5f6e 756d 6265 7220 3e3d 2031 3934 3320  _number >= 1943 
-00008ac0: 6f72 206d 696e 6f72 5f76 6572 7369 6f6e  or minor_version
-00008ad0: 203e 3d37 2929 206f 7220 6d61 6a6f 725f   >=7)) or major_
-00008ae0: 7665 7273 696f 6e20 3e20 393a 0d0a 2020  version > 9:..  
-00008af0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00008b00: 2073 656c 662e 7369 7465 2e5f 656e 6372   self.site._encr
-00008b10: 7970 7465 645f 7573 6572 2069 7320 4e6f  ypted_user is No
-00008b20: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00008b30: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-00008b40: 7065 782e 456d 706f 7765 7249 6d70 6f72  pex.EmpowerImpor
-00008b50: 7465 7256 6572 7369 6f6e 4572 726f 7228  terVersionError(
-00008b60: 2741 6674 6572 2075 7067 7261 6469 6e67  'After upgrading
-00008b70: 2074 6f20 392e 352e 3138 2e31 3732 3420   to 9.5.18.1724 
-00008b80: 6f72 2062 6579 6f6e 642c 2079 6f75 206d  or beyond, you m
-00008b90: 7573 7420 7570 6772 6164 6520 796f 7572  ust upgrade your
-00008ba0: 2070 7974 686f 6e20 636f 6465 2074 6f20   python code to 
-00008bb0: 7573 6520 656e 6372 7970 7465 6420 7061  use encrypted pa
-00008bc0: 7373 776f 7264 7320 696e 2070 796d 7078  sswords in pympx
-00008bd0: 2e53 6974 6520 6f62 6a65 6374 7327 290d  .Site objects').
-00008be0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00008bf0: 2020 206c 6f67 2e69 6e66 6f28 2743 7265     log.info('Cre
-00008c00: 6174 696e 6720 6e65 7720 5374 7275 6374  ating new Struct
-00008c10: 7572 6520 6465 6669 6e69 7469 6f6e 7320  ure definitions 
-00008c20: 696e 2045 6d70 6f77 6572 2073 6974 6520  in Empower site 
-00008c30: 272b 7365 6c66 2e73 6974 652e 5f73 6974  '+self.site._sit
-00008c40: 655f 6c6f 6361 746f 7229 0d0a 0d0a 2020  e_locator)....  
-00008c50: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00008c60: 6620 5f79 6965 6c64 5f6e 6577 5f73 7472  f _yield_new_str
-00008c70: 7563 7475 7265 735f 7374 7269 6e67 7328  uctures_strings(
-00008c80: 7374 7275 6374 7572 6573 5f74 6f5f 6372  structures_to_cr
-00008c90: 6561 7465 293a 0d0a 2020 2020 2020 2020  eate):..        
-00008ca0: 2020 2020 2020 2020 2020 2020 2353 7769              #Swi
-00008cb0: 7463 6820 6465 7363 7269 7074 696f 6e20  tch description 
-00008cc0: 666f 7220 6120 636f 6e63 6174 656e 6174  for a concatenat
-00008cd0: 6564 206b 6579 202d 2077 6520 7769 6c6c  ed key - we will
-00008ce0: 2062 6520 6162 6c65 2074 6f20 6772 6162   be able to grab
-00008cf0: 2074 6865 2073 686f 7274 6e61 6d65 2061   the shortname a
-00008d00: 6e64 206c 696e 6b20 636f 7272 6563 7420  nd link correct 
-00008d10: 656c 656d 656e 7473 2069 6e20 6f72 6465  elements in orde
-00008d20: 7220 746f 2075 7064 6174 6520 6669 656c  r to update fiel
-00008d30: 6473 0d0a 2020 2020 2020 2020 2020 2020  ds..            
-00008d40: 2020 2020 2020 2020 2357 7269 7465 2074          #Write t
-00008d50: 6865 2074 6162 2073 6570 6172 6174 6564  he tab separated
-00008d60: 2068 6561 6465 720d 0a20 2020 2020 2020   header..       
-00008d70: 2020 2020 2020 2020 2020 2020 2079 6965               yie
-00008d80: 6c64 2027 4469 6d65 6e73 696f 6e5c 744c  ld 'Dimension\tL
-00008d90: 6f6e 676e 616d 655c 7453 686f 7274 6e61  ongname\tShortna
-00008da0: 6d65 5c74 4465 7363 7269 7074 696f 6e5c  me\tDescription\
-00008db0: 6e27 0d0a 0d0a 2020 2020 2020 2020 2020  n'....          
-00008dc0: 2020 2020 2020 2020 2020 2357 7269 7465            #Write
-00008dd0: 2064 6174 6120 666f 7220 616c 6c20 6f66   data for all of
-00008de0: 2074 6865 206e 6577 2066 6965 6c64 7320   the new fields 
-00008df0: 746f 2074 6865 2066 696c 650d 0a20 2020  to the file..   
-00008e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e10: 2066 6f72 206e 2c20 6e65 775f 7374 7275   for n, new_stru
-00008e20: 6374 7572 6520 696e 2065 6e75 6d65 7261  cture in enumera
-00008e30: 7465 2873 7472 7563 7475 7265 735f 746f  te(structures_to
-00008e40: 5f63 7265 6174 6529 3a0d 0a0d 0a20 2020  _create):....   
-00008e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008e60: 2020 2020 2079 6965 6c64 206e 6577 5f73       yield new_s
-00008e70: 7472 7563 7475 7265 2e64 696d 656e 7369  tructure.dimensi
-00008e80: 6f6e 2e6c 6f6e 676e 616d 650d 0a20 2020  on.longname..   
-00008e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ea0: 2020 2020 2079 6965 6c64 2027 5c74 270d       yield '\t'.
-00008eb0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00008ec0: 2020 2020 2020 2020 2020 2023 4f64 646c             #Oddl
-00008ed0: 792c 206c 6f6e 676e 616d 6520 6973 2074  y, longname is t
-00008ee0: 6865 206b 6579 2068 6572 652c 206e 6f74  he key here, not
-00008ef0: 2073 686f 7274 206e 616d 650d 0a20 2020   short name..   
-00008f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f10: 2020 2020 2079 6965 6c64 206e 6577 5f73       yield new_s
-00008f20: 7472 7563 7475 7265 2e6c 6f6e 676e 616d  tructure.longnam
-00008f30: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
-00008f40: 2020 2020 2020 2020 2020 2020 2079 6965               yie
-00008f50: 6c64 2027 5c74 270d 0a0d 0a20 2020 2020  ld '\t'....     
-00008f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f70: 2020 2069 6620 6e65 775f 7374 7275 6374     if new_struct
-00008f80: 7572 652e 7368 6f72 746e 616d 6520 6973  ure.shortname is
-00008f90: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00008fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008fb0: 2020 2020 2020 2020 7969 656c 6420 6e65          yield ne
-00008fc0: 775f 7374 7275 6374 7572 652e 7368 6f72  w_structure.shor
-00008fd0: 746e 616d 650d 0a20 2020 2020 2020 2020  tname..         
-00008fe0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-00008ff0: 6965 6c64 2027 5c74 270d 0a0d 0a0d 0a20  ield '\t'...... 
-00009000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009010: 2020 2020 2020 2069 6620 6e65 775f 7374         if new_st
-00009020: 7275 6374 7572 652e 6465 7363 7269 7074  ructure.descript
-00009030: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
-00009040: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009050: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-00009060: 656c 6420 6e65 775f 7374 7275 6374 7572  eld new_structur
-00009070: 652e 6465 7363 7269 7074 696f 6e0d 0a20  e.description.. 
-00009080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009090: 2020 2020 2020 2079 6965 6c64 2027 5c6e         yield '\n
-000090a0: 270d 0a0d 0a20 2020 2020 2020 2020 2020  '....           
-000090b0: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-000090c0: 2e69 6e66 6f28 2743 7265 6174 696e 6720  .info('Creating 
-000090d0: 6e65 7720 5374 7275 6374 7572 6520 6465  new Structure de
-000090e0: 6669 6e69 7469 6f6e 3a20 272b 7374 7228  finition: '+str(
-000090f0: 6e65 775f 7374 7275 6374 7572 652e 6c6f  new_structure.lo
-00009100: 6e67 6e61 6d65 2929 0d0a 0d0a 2020 2020  ngname))....    
-00009110: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
-00009120: 616e 645f 6c69 7374 203d 2073 656c 662e  and_list = self.
-00009130: 7369 7465 2e5f 6c6f 676f 6e5f 7061 7261  site._logon_para
-00009140: 6d65 7465 725f 696d 706f 7274 6572 5f63  meter_importer_c
-00009150: 6f6d 6d61 6e64 7320 2b20 5c0d 0a20 2020  ommands + \..   
-00009160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009170: 2020 2020 2020 2020 2020 2020 5b27 6c6f              ['lo
-00009180: 6164 2d66 696c 652d 7473 7620 2227 2020  ad-file-tsv "'  
+00008770: 2020 6578 6365 7074 2046 696c 6545 7869    except FileExi
+00008780: 7374 7345 7272 6f72 3a0d 0a20 2020 2020  stsError:..     
+00008790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000087a0: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
+000087b0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+000087c0: 6570 7420 4f53 4572 726f 7220 6173 2065  ept OSError as e
+000087d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000087e0: 2020 2020 2020 2020 2020 2069 6620 652e             if e.
+000087f0: 7769 6e65 7272 6f72 203d 3d20 3132 333a  winerror == 123:
+00008800: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008810: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00008820: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+00008830: 4469 7265 6374 6f72 7920 227b 7d22 2068  Directory "{}" h
+00008840: 6173 2061 6e20 696e 7661 6c69 6420 6e61  as an invalid na
+00008850: 6d65 2e20 4469 6420 796f 7520 7061 7373  me. Did you pass
+00008860: 2061 2073 6974 655f 6c6f 6361 746f 7220   a site_locator 
+00008870: 7061 7468 2022 7b7d 2220 7769 7468 6f75  path "{}" withou
+00008880: 7420 646f 7562 6c65 2d65 7363 6170 696e  t double-escapin
+00008890: 6720 6261 636b 736c 6173 6865 7320 6f72  g backslashes or
+000088a0: 2070 7265 6669 7869 6e67 2074 6865 2073   prefixing the s
+000088b0: 7472 696e 6720 7769 7468 2061 6e20 2272  tring with an "r
+000088c0: 2220 666f 7220 7261 773f 272e 666f 726d  " for raw?'.form
+000088d0: 6174 2864 6972 2c72 6570 7228 7369 7465  at(dir,repr(site
+000088e0: 5f6c 6f63 6174 6f72 2929 290d 0a20 2020  _locator)))..   
+000088f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008900: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00008910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008920: 2020 2020 2020 2020 7261 6973 6520 650d          raise e.
+00008930: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00008940: 2020 2073 7472 7563 7475 7265 5f6d 6574     structure_met
+00008950: 6164 6174 615f 6669 6c65 7061 7468 203d  adata_filepath =
+00008960: 206f 732e 7061 7468 2e6a 6f69 6e28 7365   os.path.join(se
+00008970: 6c66 2e73 6974 652e 5f65 6d70 6f77 6572  lf.site._empower
+00008980: 5f64 696d 5f69 6d70 6f72 745f 6469 722c  _dim_import_dir,
+00008990: 2753 7472 7563 7475 7265 735f 7b7d 2e74  'Structures_{}.t
+000089a0: 7376 272e 666f 726d 6174 2864 696d 656e  sv'.format(dimen
+000089b0: 7369 6f6e 2e69 6e64 6578 2929 0d0a 2020  sion.index))..  
+000089c0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+000089d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000089e0: 2073 7472 7563 7475 7265 5f6d 6574 6164   structure_metad
+000089f0: 6174 615f 6669 6c65 7061 7468 203d 2072  ata_filepath = r
+00008a00: 275c 5c2e 5c70 6970 655c 7b7d 272e 666f  '\\.\pipe\{}'.fo
+00008a10: 726d 6174 2875 7569 642e 7575 6964 3428  rmat(uuid.uuid4(
+00008a20: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
+00008a30: 2020 2343 6865 636b 2076 6572 7369 6f6e    #Check version
+00008a40: 206f 6620 456d 706f 7765 720d 0a20 2020   of Empower..   
+00008a50: 2020 2020 2020 2020 206d 616a 6f72 5f76           major_v
+00008a60: 6572 7369 6f6e 2c20 6d69 6e6f 725f 7665  ersion, minor_ve
+00008a70: 7273 696f 6e2c 2072 656c 6561 7365 2c20  rsion, release, 
+00008a80: 7265 6c65 6173 655f 6e75 6d62 6572 203d  release_number =
+00008a90: 2073 656c 662e 7369 7465 2e69 6d70 6f72   self.site.impor
+00008aa0: 7465 725f 7665 7273 696f 6e0d 0a20 2020  ter_version..   
+00008ab0: 2020 2020 2020 2020 2069 6620 286d 616a           if (maj
+00008ac0: 6f72 5f76 6572 7369 6f6e 203d 3d20 3920  or_version == 9 
+00008ad0: 616e 6420 2872 656c 6561 7365 5f6e 756d  and (release_num
+00008ae0: 6265 7220 3e3d 2031 3934 3320 6f72 206d  ber >= 1943 or m
+00008af0: 696e 6f72 5f76 6572 7369 6f6e 203e 3d37  inor_version >=7
+00008b00: 2929 206f 7220 6d61 6a6f 725f 7665 7273  )) or major_vers
+00008b10: 696f 6e20 3e20 393a 0d0a 2020 2020 2020  ion > 9:..      
+00008b20: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00008b30: 662e 7369 7465 2e5f 656e 6372 7970 7465  f.site._encrypte
+00008b40: 645f 7573 6572 2069 7320 4e6f 6e65 3a0d  d_user is None:.
+00008b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008b60: 2020 2020 2072 6169 7365 206d 7065 782e       raise mpex.
+00008b70: 456d 706f 7765 7249 6d70 6f72 7465 7256  EmpowerImporterV
+00008b80: 6572 7369 6f6e 4572 726f 7228 2741 6674  ersionError('Aft
+00008b90: 6572 2075 7067 7261 6469 6e67 2074 6f20  er upgrading to 
+00008ba0: 392e 352e 3138 2e31 3732 3420 6f72 2062  9.5.18.1724 or b
+00008bb0: 6579 6f6e 642c 2079 6f75 206d 7573 7420  eyond, you must 
+00008bc0: 7570 6772 6164 6520 796f 7572 2070 7974  upgrade your pyt
+00008bd0: 686f 6e20 636f 6465 2074 6f20 7573 6520  hon code to use 
+00008be0: 656e 6372 7970 7465 6420 7061 7373 776f  encrypted passwo
+00008bf0: 7264 7320 696e 2070 796d 7078 2e53 6974  rds in pympx.Sit
+00008c00: 6520 6f62 6a65 6374 7327 290d 0a0d 0a20  e objects').... 
+00008c10: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00008c20: 6f67 2e69 6e66 6f28 2743 7265 6174 696e  og.info('Creatin
+00008c30: 6720 6e65 7720 5374 7275 6374 7572 6520  g new Structure 
+00008c40: 6465 6669 6e69 7469 6f6e 7320 696e 2045  definitions in E
+00008c50: 6d70 6f77 6572 2073 6974 6520 272b 7365  mpower site '+se
+00008c60: 6c66 2e73 6974 652e 5f73 6974 655f 6c6f  lf.site._site_lo
+00008c70: 6361 746f 7229 0d0a 0d0a 2020 2020 2020  cator)....      
+00008c80: 2020 2020 2020 2020 2020 6465 6620 5f79            def _y
+00008c90: 6965 6c64 5f6e 6577 5f73 7472 7563 7475  ield_new_structu
+00008ca0: 7265 735f 7374 7269 6e67 7328 7374 7275  res_strings(stru
+00008cb0: 6374 7572 6573 5f74 6f5f 6372 6561 7465  ctures_to_create
+00008cc0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00008cd0: 2020 2020 2020 2020 2353 7769 7463 6820          #Switch 
+00008ce0: 6465 7363 7269 7074 696f 6e20 666f 7220  description for 
+00008cf0: 6120 636f 6e63 6174 656e 6174 6564 206b  a concatenated k
+00008d00: 6579 202d 2077 6520 7769 6c6c 2062 6520  ey - we will be 
+00008d10: 6162 6c65 2074 6f20 6772 6162 2074 6865  able to grab the
+00008d20: 2073 686f 7274 6e61 6d65 2061 6e64 206c   shortname and l
+00008d30: 696e 6b20 636f 7272 6563 7420 656c 656d  ink correct elem
+00008d40: 656e 7473 2069 6e20 6f72 6465 7220 746f  ents in order to
+00008d50: 2075 7064 6174 6520 6669 656c 6473 0d0a   update fields..
+00008d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d70: 2020 2020 2357 7269 7465 2074 6865 2074      #Write the t
+00008d80: 6162 2073 6570 6172 6174 6564 2068 6561  ab separated hea
+00008d90: 6465 720d 0a20 2020 2020 2020 2020 2020  der..           
+00008da0: 2020 2020 2020 2020 2079 6965 6c64 2027           yield '
+00008db0: 4469 6d65 6e73 696f 6e5c 744c 6f6e 676e  Dimension\tLongn
+00008dc0: 616d 655c 7453 686f 7274 6e61 6d65 5c74  ame\tShortname\t
+00008dd0: 4465 7363 7269 7074 696f 6e5c 6e27 0d0a  Description\n'..
+00008de0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00008df0: 2020 2020 2020 2357 7269 7465 2064 6174        #Write dat
+00008e00: 6120 666f 7220 616c 6c20 6f66 2074 6865  a for all of the
+00008e10: 206e 6577 2066 6965 6c64 7320 746f 2074   new fields to t
+00008e20: 6865 2066 696c 650d 0a20 2020 2020 2020  he file..       
+00008e30: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00008e40: 206e 2c20 6e65 775f 7374 7275 6374 7572   n, new_structur
+00008e50: 6520 696e 2065 6e75 6d65 7261 7465 2873  e in enumerate(s
+00008e60: 7472 7563 7475 7265 735f 746f 5f63 7265  tructures_to_cre
+00008e70: 6174 6529 3a0d 0a0d 0a20 2020 2020 2020  ate):....       
+00008e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e90: 2079 6965 6c64 206e 6577 5f73 7472 7563   yield new_struc
+00008ea0: 7475 7265 2e64 696d 656e 7369 6f6e 2e6c  ture.dimension.l
+00008eb0: 6f6e 676e 616d 650d 0a20 2020 2020 2020  ongname..       
+00008ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ed0: 2079 6965 6c64 2027 5c74 270d 0a0d 0a20   yield '\t'.... 
+00008ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ef0: 2020 2020 2020 2023 4f64 646c 792c 206c         #Oddly, l
+00008f00: 6f6e 676e 616d 6520 6973 2074 6865 206b  ongname is the k
+00008f10: 6579 2068 6572 652c 206e 6f74 2073 686f  ey here, not sho
+00008f20: 7274 206e 616d 650d 0a20 2020 2020 2020  rt name..       
+00008f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f40: 2079 6965 6c64 206e 6577 5f73 7472 7563   yield new_struc
+00008f50: 7475 7265 2e6c 6f6e 676e 616d 650d 0a0d  ture.longname...
+00008f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008f70: 2020 2020 2020 2020 2079 6965 6c64 2027           yield '
+00008f80: 5c74 270d 0a0d 0a20 2020 2020 2020 2020  \t'....         
+00008f90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00008fa0: 6620 6e65 775f 7374 7275 6374 7572 652e  f new_structure.
+00008fb0: 7368 6f72 746e 616d 6520 6973 206e 6f74  shortname is not
+00008fc0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00008fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008fe0: 2020 2020 7969 656c 6420 6e65 775f 7374      yield new_st
+00008ff0: 7275 6374 7572 652e 7368 6f72 746e 616d  ructure.shortnam
+00009000: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00009010: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+00009020: 2027 5c74 270d 0a0d 0a0d 0a20 2020 2020   '\t'......     
+00009030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009040: 2020 2069 6620 6e65 775f 7374 7275 6374     if new_struct
+00009050: 7572 652e 6465 7363 7269 7074 696f 6e20  ure.description 
+00009060: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00009070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009080: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
+00009090: 6e65 775f 7374 7275 6374 7572 652e 6465  new_structure.de
+000090a0: 7363 7269 7074 696f 6e0d 0a20 2020 2020  scription..     
+000090b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000090c0: 2020 2079 6965 6c64 2027 5c6e 270d 0a0d     yield '\n'...
+000090d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000090e0: 2020 2020 2020 2020 206c 6f67 2e69 6e66           log.inf
+000090f0: 6f28 2743 7265 6174 696e 6720 6e65 7720  o('Creating new 
+00009100: 5374 7275 6374 7572 6520 6465 6669 6e69  Structure defini
+00009110: 7469 6f6e 3a20 272b 7374 7228 6e65 775f  tion: '+str(new_
+00009120: 7374 7275 6374 7572 652e 6c6f 6e67 6e61  structure.longna
+00009130: 6d65 2929 0d0a 0d0a 2020 2020 2020 2020  me))....        
+00009140: 2020 2020 2020 2020 636f 6d6d 616e 645f          command_
+00009150: 6c69 7374 203d 2073 656c 662e 7369 7465  list = self.site
+00009160: 2e5f 6c6f 676f 6e5f 7061 7261 6d65 7465  ._logon_paramete
+00009170: 725f 696d 706f 7274 6572 5f63 6f6d 6d61  r_importer_comma
+00009180: 6e64 7320 2b20 5c0d 0a20 2020 2020 2020  nds + \..       
 00009190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091a0: 202b 2073 7472 7563 7475 7265 5f6d 6574   + structure_met
-000091b0: 6164 6174 615f 6669 6c65 7061 7468 202b  adata_filepath +
-000091c0: 2027 2227 0d0a 2020 2020 2020 2020 2020   '"'..          
-000091d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000091e0: 2020 2020 202c 2765 6d70 6f77 6572 2d69       ,'empower-i
-000091f0: 6d70 6f72 742d 7374 7275 6374 7572 6573  mport-structures
-00009200: 202d 6861 732d 6865 6164 6572 202d 7570   -has-header -up
-00009210: 7365 7274 2022 247b 7369 7465 7d22 2022  sert "${site}" "
-00009220: 247b 7573 6572 7d22 2022 247b 7061 7373  ${user}" "${pass
-00009230: 776f 7264 7d22 270d 0a20 2020 2020 2020  word}"'..       
-00009240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009250: 2020 2020 2020 2020 5d0d 0a0d 0a20 2020          ]....   
-00009260: 2020 2020 2020 2020 2020 2020 2023 496e               #In
-00009270: 2064 6562 7567 206d 6f64 6520 7772 6974   debug mode writ
-00009280: 6520 7468 6520 6461 7461 2069 6e74 6f20  e the data into 
-00009290: 6120 7473 7620 6669 6c65 2061 6e64 2072  a tsv file and r
-000092a0: 6561 6420 6974 2077 6974 6820 496d 706f  ead it with Impo
-000092b0: 7274 6572 2c20 7075 7474 696e 6720 7468  rter, putting th
-000092c0: 6520 656c 656d 656e 7473 2069 6e74 6f20  e elements into 
-000092d0: 456d 706f 7765 720d 0a20 2020 2020 2020  Empower..       
-000092e0: 2020 2020 2020 2020 2069 6620 6465 6275           if debu
-000092f0: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
-00009300: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-00009310: 6e28 7374 7275 6374 7572 655f 6d65 7461  n(structure_meta
-00009320: 6461 7461 5f66 696c 6570 6174 682c 2777  data_filepath,'w
-00009330: 272c 656e 636f 6469 6e67 3d27 7574 6638  ',encoding='utf8
-00009340: 2729 2061 7320 6e65 775f 7374 7275 6374  ') as new_struct
-00009350: 7572 6573 5f66 696c 653a 0d0a 2020 2020  ures_file:..    
-00009360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009370: 2020 2020 666f 7220 7320 696e 205f 7969      for s in _yi
-00009380: 656c 645f 6e65 775f 7374 7275 6374 7572  eld_new_structur
-00009390: 6573 5f73 7472 696e 6773 2873 7472 7563  es_strings(struc
-000093a0: 7475 7265 735f 746f 5f63 7265 6174 6529  tures_to_create)
-000093b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000093c0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000093d0: 6577 5f73 7472 7563 7475 7265 735f 6669  ew_structures_fi
-000093e0: 6c65 2e77 7269 7465 2873 290d 0a0d 0a20  le.write(s).... 
-000093f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009400: 2020 206c 6c75 2e72 756e 5f73 696e 676c     llu.run_singl
-00009410: 655f 6f75 7470 7574 5f69 6d70 6f72 7465  e_output_importe
-00009420: 725f 636f 6d6d 616e 6473 2863 6f6d 6d61  r_commands(comma
-00009430: 6e64 5f6c 6973 742c 2065 6d70 6f77 6572  nd_list, empower
-00009440: 5f69 6d70 6f72 7465 725f 6578 6563 7574  _importer_execut
-00009450: 6162 6c65 3d73 656c 662e 7369 7465 2e65  able=self.site.e
-00009460: 6d70 6f77 6572 5f69 6d70 6f72 7465 725f  mpower_importer_
-00009470: 6578 6563 7574 6162 6c65 290d 0a0d 0a20  executable).... 
-00009480: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00009490: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-000094a0: 2020 2020 2020 2020 2020 2349 6e20 276e            #In 'n
-000094b0: 6f72 6d61 6c27 206d 6f64 6520 646f 2061  ormal' mode do a
-000094c0: 206d 6572 7279 2064 616e 6365 2077 6974   merry dance wit
-000094d0: 6820 5769 6e64 6f77 7320 6e61 6d65 6420  h Windows named 
-000094e0: 7069 7065 732e 2054 6869 7320 6176 6f69  pipes. This avoi
-000094f0: 6473 2077 7269 7469 6e67 2074 6865 2064  ds writing the d
-00009500: 6174 6120 746f 2066 696c 6520 666f 7220  ata to file for 
-00009510: 7365 6375 7269 7479 2061 6e64 2070 7261  security and pra
-00009520: 6374 6963 616c 6974 7920 7265 6173 6f6e  cticality reason
-00009530: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-00009540: 2020 2020 2020 2023 7374 7275 6374 7572         #structur
-00009550: 655f 6d65 7461 6461 7461 5f66 696c 6570  e_metadata_filep
-00009560: 6174 6820 6973 2074 6865 206e 616d 6520  ath is the name 
-00009570: 6f66 2074 6865 206e 616d 6564 2070 6970  of the named pip
-00009580: 6520 652e 672e 205c 5c2e 5c70 6970 655c  e e.g. \\.\pipe\
-00009590: 3964 6363 6661 3038 2d34 3063 312d 3435  9dccfa08-40c1-45
-000095a0: 6635 2d38 6530 652d 6636 3463 3138 3530  f5-8e0e-f64c1850
-000095b0: 3262 6364 0d0a 2020 2020 2020 2020 2020  2bcd..          
-000095c0: 2020 2020 2020 2020 2020 2354 6865 206d            #The m
-000095d0: 6572 7279 2064 616e 6365 206d 6561 6e73  erry dance means
-000095e0: 2073 7461 7274 696e 6720 656d 706f 7765   starting empowe
-000095f0: 722c 2072 6566 6572 656e 6369 6e67 2074  r, referencing t
-00009600: 6865 2070 6970 652c 206f 7065 6e69 6e67  he pipe, opening
-00009610: 2074 6865 2070 6970 6520 6265 666f 7265   the pipe before
-00009620: 2065 6d70 6f77 6572 2069 7320 7072 6f70   empower is prop
-00009630: 6572 6c79 2073 7461 7274 6564 0d0a 2020  erly started..  
-00009640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009650: 2020 2373 6574 7469 6e67 2075 7020 7468    #setting up th
-00009660: 6520 6e61 6d65 6420 7069 7065 206f 6e20  e named pipe on 
-00009670: 7468 6973 2074 6872 6561 642c 2061 6e64  this thread, and
-00009680: 2077 7269 7469 6e67 2074 6f20 6974 2028   writing to it (
-00009690: 6173 2073 6f6f 6e20 6173 2049 6d70 6f72  as soon as Impor
-000096a0: 7465 7220 636f 6e6e 6563 7473 2061 7420  ter connects at 
-000096b0: 6974 7320 656e 6429 0d0a 2020 2020 2020  its end)..      
-000096c0: 2020 2020 2020 2020 2020 2020 2020 2354                #T
-000096d0: 6865 2064 6966 6669 6375 6c74 792c 2069  he difficulty, i
-000096e0: 7320 7468 6174 2077 6520 6861 7665 2074  s that we have t
-000096f0: 6f20 7061 7373 2074 6865 206e 616d 6520  o pass the name 
-00009700: 6f66 2074 6865 2070 6970 6520 746f 2049  of the pipe to I
-00009710: 6d70 6f72 7465 722c 2061 6e64 2072 656c  mporter, and rel
-00009720: 7920 6f6e 2074 6865 2066 6163 7420 7468  y on the fact th
-00009730: 6174 2069 7420 776f 6e27 7420 6861 7665  at it won't have
-00009740: 2074 696d 6520 746f 206f 7065 6e20 6974   time to open it
-00009750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009760: 2020 2020 2020 2362 6566 6f72 6520 7765        #before we
-00009770: 2068 6176 6520 6372 6561 7465 6420 6974   have created it
-00009780: 2e20 4275 7420 7765 2077 696c 6c20 626c  . But we will bl
-00009790: 6f63 6b20 6f6e 206f 7572 2073 6964 6520  ock on our side 
-000097a0: 756e 7469 6c20 496d 706f 7274 6572 2068  until Importer h
-000097b0: 6173 2063 6f6e 6e65 6374 6564 0d0a 2020  as connected..  
-000097c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097d0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-000097e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000097f0: 7072 6f63 203d 204e 6f6e 650d 0a20 2020  proc = None..   
-00009800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009810: 2020 2020 2070 726f 6320 3d20 6c6c 752e       proc = llu.
-00009820: 7374 6172 745f 6e6f 5f6f 7574 7075 745f  start_no_output_
-00009830: 696d 706f 7274 6572 5f63 6f6d 6d61 6e64  importer_command
-00009840: 7328 636f 6d6d 616e 645f 6c69 7374 2c65  s(command_list,e
-00009850: 6d70 6f77 6572 5f69 6d70 6f72 7465 725f  mpower_importer_
-00009860: 6578 6563 7574 6162 6c65 3d73 656c 662e  executable=self.
-00009870: 7369 7465 2e65 6d70 6f77 6572 5f69 6d70  site.empower_imp
-00009880: 6f72 7465 725f 6578 6563 7574 6162 6c65  orter_executable
-00009890: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000098a0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
-000098b0: 6c6c 752e 6f75 7462 6f75 6e64 5f70 6970  llu.outbound_pip
-000098c0: 6528 7374 7275 6374 7572 655f 6d65 7461  e(structure_meta
-000098d0: 6461 7461 5f66 696c 6570 6174 6829 2061  data_filepath) a
-000098e0: 7320 7069 7065 3a0d 0a0d 0a20 2020 2020  s pipe:....     
-000098f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009900: 2020 2020 2020 2066 6f72 2073 2069 6e20         for s in 
-00009910: 5f79 6965 6c64 5f6e 6577 5f73 7472 7563  _yield_new_struc
-00009920: 7475 7265 735f 7374 7269 6e67 7328 7374  tures_strings(st
-00009930: 7275 6374 7572 6573 5f74 6f5f 6372 6561  ructures_to_crea
-00009940: 7465 293a 0d0a 2020 2020 2020 2020 2020  te):..          
-00009950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009960: 2020 2020 2020 7769 6e33 3266 696c 652e        win32file.
-00009970: 5772 6974 6546 696c 6528 7069 7065 2c20  WriteFile(pipe, 
-00009980: 7374 722e 656e 636f 6465 2873 2929 0d0a  str.encode(s))..
-00009990: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000099a0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-000099b0: 672e 6465 6275 6728 2250 6970 6520 7b7d  g.debug("Pipe {}
-000099c0: 2066 696e 6973 6865 6420 7772 6974 696e   finished writin
-000099d0: 6722 2e66 6f72 6d61 7428 7374 7275 6374  g".format(struct
-000099e0: 7572 655f 6d65 7461 6461 7461 5f66 696c  ure_metadata_fil
-000099f0: 6570 6174 6829 290d 0a0d 0a20 2020 2020  epath))....     
-00009a00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00009a10: 696e 616c 6c79 3a0d 0a0d 0a20 2020 2020  inally:....     
-00009a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a30: 2020 2023 4368 6563 6b20 6966 2049 6d70     #Check if Imp
-00009a40: 6f72 7465 7220 7265 7475 726e 6564 2061  orter returned a
-00009a50: 6e20 6572 726f 7220 616e 6420 7261 6973  n error and rais
-00009a60: 6520 6974 2061 7320 6120 7079 7468 6f6e  e it as a python
-00009a70: 2069 6620 6974 2064 6964 0d0a 2020 2020   if it did..    
-00009a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009a90: 2020 2020 6c6c 752e 636f 6d70 6c65 7465      llu.complete
-00009aa0: 5f6e 6f5f 6f75 7470 7574 5f69 6d70 6f72  _no_output_impor
-00009ab0: 7465 725f 7072 6f63 6573 7328 7072 6f63  ter_process(proc
-00009ac0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00009ad0: 2020 2020 206c 6f67 2e69 6e66 6f28 274e       log.info('N
-00009ae0: 6577 2073 7472 7563 7475 7265 7320 6372  ew structures cr
-00009af0: 6561 7465 6420 696e 2045 6d70 6f77 6572  eated in Empower
-00009b00: 2073 6974 6520 272b 7365 6c66 2e73 6974   site '+self.sit
-00009b10: 652e 5f73 6974 655f 6c6f 6361 746f 7229  e._site_locator)
-00009b20: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00009b30: 2020 2020 666f 7220 7374 7275 6374 7572      for structur
-00009b40: 6520 696e 2073 7472 7563 7475 7265 735f  e in structures_
-00009b50: 746f 5f63 7265 6174 653a 0d0a 2020 2020  to_create:..    
-00009b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b70: 7374 7275 6374 7572 652e 5f65 7869 7374  structure._exist
-00009b80: 735f 696e 5f65 6d70 6f77 6572 203d 2054  s_in_empower = T
-00009b90: 7275 650d 0a0d 0a20 2020 2020 2020 2020  rue....         
-00009ba0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00009bb0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00009bc0: 6d70 6578 2e45 6d70 6f77 6572 496d 706f  mpex.EmpowerImpo
-00009bd0: 7274 6572 5665 7273 696f 6e45 7272 6f72  rterVersionError
-00009be0: 2827 596f 7520 6d75 7374 2075 7067 7261  ('You must upgra
-00009bf0: 6465 2074 6f20 456d 706f 7765 7220 496d  de to Empower Im
-00009c00: 706f 7274 6572 2039 2e35 2e31 382e 3139  porter 9.5.18.19
-00009c10: 3433 206f 7220 6265 796f 6e64 2061 6e64  43 or beyond and
-00009c20: 2075 7365 2065 6e63 7279 7074 6564 2070   use encrypted p
-00009c30: 6173 7377 6f72 6473 2069 6e20 6f72 6465  asswords in orde
-00009c40: 7220 746f 2063 7265 6174 6520 6e65 7720  r to create new 
-00009c50: 6669 656c 6473 2069 6e20 456d 706f 7765  fields in Empowe
-00009c60: 7227 290d 0a0d 0a0d 0a20 2020 2064 6566  r')......    def
-00009c70: 2073 796e 6368 726f 6e69 7365 5f66 6965   synchronise_fie
-00009c80: 6c64 5f64 6566 696e 6974 696f 6e73 2873  ld_definitions(s
-00009c90: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
-00009ca0: 2727 4272 696e 6720 7468 6520 456d 706f  ''Bring the Empo
-00009cb0: 7765 7220 6469 6d65 6e73 696f 6e20 6669  wer dimension fi
-00009cc0: 656c 6473 2064 6566 696e 6974 696f 6e20  elds definition 
-00009cd0: 7570 2d74 6f2d 6461 7465 2077 6974 6820  up-to-date with 
-00009ce0: 6f75 7220 5369 7465 2064 6566 696e 6974  our Site definit
-00009cf0: 696f 6e2c 2061 7070 6c79 696e 6720 616c  ion, applying al
-00009d00: 6c20 6465 6669 6e69 7469 6f6e 2063 6861  l definition cha
-00009d10: 6e67 6573 2727 270d 0a0d 0a20 2020 2020  nges'''....     
-00009d20: 2020 2023 4372 6561 7465 206e 6577 2066     #Create new f
-00009d30: 6965 6c64 7320 696e 2065 6d70 6f77 6572  ields in empower
-00009d40: 0d0a 2020 2020 2020 2020 2344 6f20 616c  ..        #Do al
-00009d50: 6c20 6469 6d65 6e73 696f 6e73 2061 7420  l dimensions at 
-00009d60: 6f6e 6365 2c20 666f 7220 7370 6565 640d  once, for speed.
-00009d70: 0a0d 0a20 2020 2020 2020 2064 6562 7567  ...        debug
-00009d80: 203d 2073 656c 662e 7369 7465 2e5f 6465   = self.site._de
-00009d90: 6275 670d 0a0d 0a20 2020 2020 2020 206e  bug....        n
-00009da0: 6577 5f66 6965 6c64 7320 3d20 5b5d 0d0a  ew_fields = []..
-00009db0: 2020 2020 2020 2020 6e65 775f 6669 656c          new_fiel
-00009dc0: 6473 5f62 795f 696e 6465 7820 3d20 7b7d  ds_by_index = {}
-00009dd0: 0d0a 2020 2020 2020 2020 666f 7220 6469  ..        for di
-00009de0: 6d65 6e73 696f 6e20 696e 2073 656c 662e  mension in self.
-00009df0: 7369 7465 2e64 696d 656e 7369 6f6e 732e  site.dimensions.
-00009e00: 7661 6c75 6573 2829 3a0d 0a20 2020 2020  values():..     
-00009e10: 2020 2020 2020 206e 6577 5f66 6965 6c64         new_field
-00009e20: 735f 6279 5f69 6e64 6578 5b64 696d 656e  s_by_index[dimen
-00009e30: 7369 6f6e 2e69 6e64 6578 5d20 3d20 5b5d  sion.index] = []
-00009e40: 0d0a 2020 2020 2020 2020 2020 2020 234a  ..            #J
-00009e50: 4154 2032 3031 392d 3130 2d30 3320 4368  AT 2019-10-03 Ch
-00009e60: 6563 6b20 7468 6174 2074 6865 7265 2061  eck that there a
-00009e70: 7265 2061 6e79 2066 6965 6c64 7320 6174  re any fields at
-00009e80: 2061 6c6c 2075 7369 6e67 2070 7269 7661   all using priva
-00009e90: 7465 206d 656d 6265 7273 202d 206f 7468  te members - oth
-00009ea0: 6572 7769 7365 2064 696d 656e 7369 6f6e  erwise dimension
-00009eb0: 2e66 6965 6c64 7320 646f 6573 2061 6e20  .fields does an 
-00009ec0: 656c 656d 656e 7420 6c6f 6164 0d0a 2020  element load..  
-00009ed0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00009ee0: 2864 696d 656e 7369 6f6e 2e5f 6669 656c  (dimension._fiel
-00009ef0: 6473 2e5f 6669 656c 6473 2920 3e20 303a  ds._fields) > 0:
-00009f00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009f10: 2020 666f 7220 6669 656c 645f 6e61 6d65    for field_name
-00009f20: 2069 6e20 6469 6d65 6e73 696f 6e2e 6669   in dimension.fi
-00009f30: 656c 6473 2e5f 6e65 775f 6669 656c 645f  elds._new_field_
-00009f40: 6e61 6d65 733a 0d0a 2020 2020 2020 2020  names:..        
-00009f50: 2020 2020 2020 2020 2020 2020 6669 656c              fiel
-00009f60: 6420 3d20 6469 6d65 6e73 696f 6e2e 6669  d = dimension.fi
-00009f70: 656c 6473 5b66 6965 6c64 5f6e 616d 655d  elds[field_name]
-00009f80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009f90: 2020 2020 2020 6966 2066 6965 6c64 2e6c        if field.l
-00009fa0: 6f6e 676e 616d 6520 6973 204e 6f6e 653a  ongname is None:
-00009fb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00009fc0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00009fd0: 6d70 6578 2e4d 5058 4572 726f 7228 2743  mpex.MPXError('C
-00009fe0: 616e 6e6f 7420 6372 6561 7465 2066 6965  annot create fie
-00009ff0: 6c64 2077 6974 686f 7574 2061 206c 6f6e  ld without a lon
-0000a000: 676e 616d 652e 2044 696d 656e 7369 6f6e  gname. Dimension
-0000a010: 3a20 7b7d 2c20 7368 6f72 746e 616d 653a  : {}, shortname:
-0000a020: 207b 7d2c 2066 6965 6c64 5f6e 616d 653a   {}, field_name:
-0000a030: 207b 7d27 2e66 6f72 6d61 7428 6469 6d65   {}'.format(dime
-0000a040: 6e73 696f 6e2e 6c6f 6e67 6e61 6d65 2c66  nsion.longname,f
-0000a050: 6965 6c64 2e73 686f 7274 6e61 6d65 2c66  ield.shortname,f
-0000a060: 6965 6c64 5f6e 616d 6529 290d 0a20 2020  ield_name))..   
-0000a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a080: 206e 6577 5f66 6965 6c64 732e 6170 7065   new_fields.appe
-0000a090: 6e64 287b 2744 696d 656e 7369 6f6e 273a  nd({'Dimension':
-0000a0a0: 6469 6d65 6e73 696f 6e2e 6c6f 6e67 6e61  dimension.longna
-0000a0b0: 6d65 2c20 274c 6f6e 676e 616d 6527 3a66  me, 'Longname':f
-0000a0c0: 6965 6c64 2e6c 6f6e 676e 616d 652c 2027  ield.longname, '
-0000a0d0: 5368 6f72 746e 616d 6527 3a20 6669 656c  Shortname': fiel
-0000a0e0: 642e 7368 6f72 746e 616d 652c 2744 6573  d.shortname,'Des
-0000a0f0: 6372 6970 7469 6f6e 273a 6669 656c 642e  cription':field.
-0000a100: 6465 7363 7269 7074 696f 6e7d 290d 0a20  description}).. 
-0000a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a120: 2020 206e 6577 5f66 6965 6c64 735f 6279     new_fields_by
-0000a130: 5f69 6e64 6578 5b64 696d 656e 7369 6f6e  _index[dimension
-0000a140: 2e69 6e64 6578 5d20 2b3d 205b 6669 656c  .index] += [fiel
-0000a150: 642e 7368 6f72 746e 616d 655d 0d0a 0d0a  d.shortname]....
-0000a160: 2020 2020 2020 2020 234f 6e6c 7920 7370          #Only sp
-0000a170: 656e 6420 7469 6d65 206c 6f67 6769 6e67  end time logging
-0000a180: 2069 6e20 746f 2045 6d70 6f77 6572 2069   in to Empower i
-0000a190: 6620 7468 6572 6520 6172 6520 6e65 7720  f there are new 
-0000a1a0: 6669 656c 6473 2074 6f20 6372 6561 7465  fields to create
-0000a1b0: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-0000a1c0: 286e 6577 5f66 6965 6c64 7329 203e 2030  (new_fields) > 0
-0000a1d0: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
-0000a1e0: 2069 6620 6465 6275 673a 0d0a 2020 2020   if debug:..    
-0000a1f0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000a200: 6469 7220 696e 205b 7365 6c66 2e73 6974  dir in [self.sit
-0000a210: 652e 5f65 6d70 6f77 6572 5f64 696d 5f69  e._empower_dim_i
-0000a220: 6d70 6f72 745f 6469 725d 3a0d 0a0d 0a20  mport_dir]:.... 
-0000a230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a240: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-0000a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a260: 206f 732e 6d61 6b65 6469 7273 2864 6972   os.makedirs(dir
-0000a270: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000a280: 2020 2020 2020 2065 7863 6570 7420 4669         except Fi
-0000a290: 6c65 4578 6973 7473 4572 726f 723a 0d0a  leExistsError:..
+000091a0: 2020 2020 2020 2020 5b27 6c6f 6164 2d66          ['load-f
+000091b0: 696c 652d 7473 7620 2227 2020 2020 2020  ile-tsv "'      
+000091c0: 2020 2020 2020 2020 2020 2020 202b 2073               + s
+000091d0: 7472 7563 7475 7265 5f6d 6574 6164 6174  tructure_metadat
+000091e0: 615f 6669 6c65 7061 7468 202b 2027 2227  a_filepath + '"'
+000091f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009210: 202c 2765 6d70 6f77 6572 2d69 6d70 6f72   ,'empower-impor
+00009220: 742d 7374 7275 6374 7572 6573 202d 6861  t-structures -ha
+00009230: 732d 6865 6164 6572 202d 7570 7365 7274  s-header -upsert
+00009240: 2022 247b 7369 7465 7d22 2022 247b 7573   "${site}" "${us
+00009250: 6572 7d22 2022 247b 7061 7373 776f 7264  er}" "${password
+00009260: 7d22 270d 0a20 2020 2020 2020 2020 2020  }"'..           
+00009270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009280: 2020 2020 5d0d 0a0d 0a20 2020 2020 2020      ]....       
+00009290: 2020 2020 2020 2020 2023 496e 2064 6562           #In deb
+000092a0: 7567 206d 6f64 6520 7772 6974 6520 7468  ug mode write th
+000092b0: 6520 6461 7461 2069 6e74 6f20 6120 7473  e data into a ts
+000092c0: 7620 6669 6c65 2061 6e64 2072 6561 6420  v file and read 
+000092d0: 6974 2077 6974 6820 496d 706f 7274 6572  it with Importer
+000092e0: 2c20 7075 7474 696e 6720 7468 6520 656c  , putting the el
+000092f0: 656d 656e 7473 2069 6e74 6f20 456d 706f  ements into Empo
+00009300: 7765 720d 0a20 2020 2020 2020 2020 2020  wer..           
+00009310: 2020 2020 2069 6620 6465 6275 673a 0d0a       if debug:..
+00009320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009330: 2020 2020 7769 7468 206f 7065 6e28 7374      with open(st
+00009340: 7275 6374 7572 655f 6d65 7461 6461 7461  ructure_metadata
+00009350: 5f66 696c 6570 6174 682c 2777 272c 656e  _filepath,'w',en
+00009360: 636f 6469 6e67 3d27 7574 6638 2729 2061  coding='utf8') a
+00009370: 7320 6e65 775f 7374 7275 6374 7572 6573  s new_structures
+00009380: 5f66 696c 653a 0d0a 2020 2020 2020 2020  _file:..        
+00009390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093a0: 666f 7220 7320 696e 205f 7969 656c 645f  for s in _yield_
+000093b0: 6e65 775f 7374 7275 6374 7572 6573 5f73  new_structures_s
+000093c0: 7472 696e 6773 2873 7472 7563 7475 7265  trings(structure
+000093d0: 735f 746f 5f63 7265 6174 6529 3a0d 0a20  s_to_create):.. 
+000093e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093f0: 2020 2020 2020 2020 2020 206e 6577 5f73             new_s
+00009400: 7472 7563 7475 7265 735f 6669 6c65 2e77  tructures_file.w
+00009410: 7269 7465 2873 290d 0a0d 0a20 2020 2020  rite(s)....     
+00009420: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00009430: 6c75 2e72 756e 5f73 696e 676c 655f 6f75  lu.run_single_ou
+00009440: 7470 7574 5f69 6d70 6f72 7465 725f 636f  tput_importer_co
+00009450: 6d6d 616e 6473 2863 6f6d 6d61 6e64 5f6c  mmands(command_l
+00009460: 6973 742c 2065 6d70 6f77 6572 5f69 6d70  ist, empower_imp
+00009470: 6f72 7465 725f 6578 6563 7574 6162 6c65  orter_executable
+00009480: 3d73 656c 662e 7369 7465 2e65 6d70 6f77  =self.site.empow
+00009490: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
+000094a0: 7574 6162 6c65 290d 0a0d 0a20 2020 2020  utable)....     
+000094b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000094c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000094d0: 2020 2020 2020 2349 6e20 276e 6f72 6d61        #In 'norma
+000094e0: 6c27 206d 6f64 6520 646f 2061 206d 6572  l' mode do a mer
+000094f0: 7279 2064 616e 6365 2077 6974 6820 5769  ry dance with Wi
+00009500: 6e64 6f77 7320 6e61 6d65 6420 7069 7065  ndows named pipe
+00009510: 732e 2054 6869 7320 6176 6f69 6473 2077  s. This avoids w
+00009520: 7269 7469 6e67 2074 6865 2064 6174 6120  riting the data 
+00009530: 746f 2066 696c 6520 666f 7220 7365 6375  to file for secu
+00009540: 7269 7479 2061 6e64 2070 7261 6374 6963  rity and practic
+00009550: 616c 6974 7920 7265 6173 6f6e 730d 0a20  ality reasons.. 
+00009560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009570: 2020 2023 7374 7275 6374 7572 655f 6d65     #structure_me
+00009580: 7461 6461 7461 5f66 696c 6570 6174 6820  tadata_filepath 
+00009590: 6973 2074 6865 206e 616d 6520 6f66 2074  is the name of t
+000095a0: 6865 206e 616d 6564 2070 6970 6520 652e  he named pipe e.
+000095b0: 672e 205c 5c2e 5c70 6970 655c 3964 6363  g. \\.\pipe\9dcc
+000095c0: 6661 3038 2d34 3063 312d 3435 6635 2d38  fa08-40c1-45f5-8
+000095d0: 6530 652d 6636 3463 3138 3530 3262 6364  e0e-f64c18502bcd
+000095e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000095f0: 2020 2020 2020 2354 6865 206d 6572 7279        #The merry
+00009600: 2064 616e 6365 206d 6561 6e73 2073 7461   dance means sta
+00009610: 7274 696e 6720 656d 706f 7765 722c 2072  rting empower, r
+00009620: 6566 6572 656e 6369 6e67 2074 6865 2070  eferencing the p
+00009630: 6970 652c 206f 7065 6e69 6e67 2074 6865  ipe, opening the
+00009640: 2070 6970 6520 6265 666f 7265 2065 6d70   pipe before emp
+00009650: 6f77 6572 2069 7320 7072 6f70 6572 6c79  ower is properly
+00009660: 2073 7461 7274 6564 0d0a 2020 2020 2020   started..      
+00009670: 2020 2020 2020 2020 2020 2020 2020 2373                #s
+00009680: 6574 7469 6e67 2075 7020 7468 6520 6e61  etting up the na
+00009690: 6d65 6420 7069 7065 206f 6e20 7468 6973  med pipe on this
+000096a0: 2074 6872 6561 642c 2061 6e64 2077 7269   thread, and wri
+000096b0: 7469 6e67 2074 6f20 6974 2028 6173 2073  ting to it (as s
+000096c0: 6f6f 6e20 6173 2049 6d70 6f72 7465 7220  oon as Importer 
+000096d0: 636f 6e6e 6563 7473 2061 7420 6974 7320  connects at its 
+000096e0: 656e 6429 0d0a 2020 2020 2020 2020 2020  end)..          
+000096f0: 2020 2020 2020 2020 2020 2354 6865 2064            #The d
+00009700: 6966 6669 6375 6c74 792c 2069 7320 7468  ifficulty, is th
+00009710: 6174 2077 6520 6861 7665 2074 6f20 7061  at we have to pa
+00009720: 7373 2074 6865 206e 616d 6520 6f66 2074  ss the name of t
+00009730: 6865 2070 6970 6520 746f 2049 6d70 6f72  he pipe to Impor
+00009740: 7465 722c 2061 6e64 2072 656c 7920 6f6e  ter, and rely on
+00009750: 2074 6865 2066 6163 7420 7468 6174 2069   the fact that i
+00009760: 7420 776f 6e27 7420 6861 7665 2074 696d  t won't have tim
+00009770: 6520 746f 206f 7065 6e20 6974 0d0a 2020  e to open it..  
+00009780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009790: 2020 2362 6566 6f72 6520 7765 2068 6176    #before we hav
+000097a0: 6520 6372 6561 7465 6420 6974 2e20 4275  e created it. Bu
+000097b0: 7420 7765 2077 696c 6c20 626c 6f63 6b20  t we will block 
+000097c0: 6f6e 206f 7572 2073 6964 6520 756e 7469  on our side unti
+000097d0: 6c20 496d 706f 7274 6572 2068 6173 2063  l Importer has c
+000097e0: 6f6e 6e65 6374 6564 0d0a 2020 2020 2020  onnected..      
+000097f0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00009800: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00009810: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
+00009820: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+00009830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009840: 2070 726f 6320 3d20 6c6c 752e 7374 6172   proc = llu.star
+00009850: 745f 6e6f 5f6f 7574 7075 745f 696d 706f  t_no_output_impo
+00009860: 7274 6572 5f63 6f6d 6d61 6e64 7328 636f  rter_commands(co
+00009870: 6d6d 616e 645f 6c69 7374 2c65 6d70 6f77  mmand_list,empow
+00009880: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
+00009890: 7574 6162 6c65 3d73 656c 662e 7369 7465  utable=self.site
+000098a0: 2e65 6d70 6f77 6572 5f69 6d70 6f72 7465  .empower_importe
+000098b0: 725f 6578 6563 7574 6162 6c65 290d 0a20  r_executable).. 
+000098c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000098d0: 2020 2020 2020 2077 6974 6820 6c6c 752e         with llu.
+000098e0: 6f75 7462 6f75 6e64 5f70 6970 6528 7374  outbound_pipe(st
+000098f0: 7275 6374 7572 655f 6d65 7461 6461 7461  ructure_metadata
+00009900: 5f66 696c 6570 6174 6829 2061 7320 7069  _filepath) as pi
+00009910: 7065 3a0d 0a0d 0a20 2020 2020 2020 2020  pe:....         
+00009920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009930: 2020 2066 6f72 2073 2069 6e20 5f79 6965     for s in _yie
+00009940: 6c64 5f6e 6577 5f73 7472 7563 7475 7265  ld_new_structure
+00009950: 735f 7374 7269 6e67 7328 7374 7275 6374  s_strings(struct
+00009960: 7572 6573 5f74 6f5f 6372 6561 7465 293a  ures_to_create):
+00009970: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00009980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009990: 2020 7769 6e33 3266 696c 652e 5772 6974    win32file.Writ
+000099a0: 6546 696c 6528 7069 7065 2c20 7374 722e  eFile(pipe, str.
+000099b0: 656e 636f 6465 2873 2929 0d0a 0d0a 2020  encode(s))....  
+000099c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000099d0: 2020 2020 2020 2020 2020 6c6f 672e 6465            log.de
+000099e0: 6275 6728 2250 6970 6520 7b7d 2066 696e  bug("Pipe {} fin
+000099f0: 6973 6865 6420 7772 6974 696e 6722 2e66  ished writing".f
+00009a00: 6f72 6d61 7428 7374 7275 6374 7572 655f  ormat(structure_
+00009a10: 6d65 7461 6461 7461 5f66 696c 6570 6174  metadata_filepat
+00009a20: 6829 290d 0a0d 0a20 2020 2020 2020 2020  h))....         
+00009a30: 2020 2020 2020 2020 2020 2066 696e 616c             final
+00009a40: 6c79 3a0d 0a0d 0a20 2020 2020 2020 2020  ly:....         
+00009a50: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009a60: 4368 6563 6b20 6966 2049 6d70 6f72 7465  Check if Importe
+00009a70: 7220 7265 7475 726e 6564 2061 6e20 6572  r returned an er
+00009a80: 726f 7220 616e 6420 7261 6973 6520 6974  ror and raise it
+00009a90: 2061 7320 6120 7079 7468 6f6e 2069 6620   as a python if 
+00009aa0: 6974 2064 6964 0d0a 2020 2020 2020 2020  it did..        
+00009ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ac0: 6c6c 752e 636f 6d70 6c65 7465 5f6e 6f5f  llu.complete_no_
+00009ad0: 6f75 7470 7574 5f69 6d70 6f72 7465 725f  output_importer_
+00009ae0: 7072 6f63 6573 7328 7072 6f63 290d 0a0d  process(proc)...
+00009af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009b00: 206c 6f67 2e69 6e66 6f28 274e 6577 2073   log.info('New s
+00009b10: 7472 7563 7475 7265 7320 6372 6561 7465  tructures create
+00009b20: 6420 696e 2045 6d70 6f77 6572 2073 6974  d in Empower sit
+00009b30: 6520 272b 7365 6c66 2e73 6974 652e 5f73  e '+self.site._s
+00009b40: 6974 655f 6c6f 6361 746f 7229 0d0a 0d0a  ite_locator)....
+00009b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b60: 666f 7220 7374 7275 6374 7572 6520 696e  for structure in
+00009b70: 2073 7472 7563 7475 7265 735f 746f 5f63   structures_to_c
+00009b80: 7265 6174 653a 0d0a 2020 2020 2020 2020  reate:..        
+00009b90: 2020 2020 2020 2020 2020 2020 7374 7275              stru
+00009ba0: 6374 7572 652e 5f65 7869 7374 735f 696e  cture._exists_in
+00009bb0: 5f65 6d70 6f77 6572 203d 2054 7275 650d  _empower = True.
+00009bc0: 0a0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
+00009bd0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00009be0: 2020 2020 2020 7261 6973 6520 6d70 6578        raise mpex
+00009bf0: 2e45 6d70 6f77 6572 496d 706f 7274 6572  .EmpowerImporter
+00009c00: 5665 7273 696f 6e45 7272 6f72 2827 596f  VersionError('Yo
+00009c10: 7520 6d75 7374 2075 7067 7261 6465 2074  u must upgrade t
+00009c20: 6f20 456d 706f 7765 7220 496d 706f 7274  o Empower Import
+00009c30: 6572 2039 2e35 2e31 382e 3139 3433 206f  er 9.5.18.1943 o
+00009c40: 7220 6265 796f 6e64 2061 6e64 2075 7365  r beyond and use
+00009c50: 2065 6e63 7279 7074 6564 2070 6173 7377   encrypted passw
+00009c60: 6f72 6473 2069 6e20 6f72 6465 7220 746f  ords in order to
+00009c70: 2063 7265 6174 6520 6e65 7720 6669 656c   create new fiel
+00009c80: 6473 2069 6e20 456d 706f 7765 7227 290d  ds in Empower').
+00009c90: 0a0d 0a0d 0a20 2020 2064 6566 2073 796e  .....    def syn
+00009ca0: 6368 726f 6e69 7365 5f66 6965 6c64 5f64  chronise_field_d
+00009cb0: 6566 696e 6974 696f 6e73 2873 656c 6629  efinitions(self)
+00009cc0: 3a0d 0a20 2020 2020 2020 2027 2727 4272  :..        '''Br
+00009cd0: 696e 6720 7468 6520 456d 706f 7765 7220  ing the Empower 
+00009ce0: 6469 6d65 6e73 696f 6e20 6669 656c 6473  dimension fields
+00009cf0: 2064 6566 696e 6974 696f 6e20 7570 2d74   definition up-t
+00009d00: 6f2d 6461 7465 2077 6974 6820 6f75 7220  o-date with our 
+00009d10: 5369 7465 2064 6566 696e 6974 696f 6e2c  Site definition,
+00009d20: 2061 7070 6c79 696e 6720 616c 6c20 6465   applying all de
+00009d30: 6669 6e69 7469 6f6e 2063 6861 6e67 6573  finition changes
+00009d40: 2727 270d 0a0d 0a20 2020 2020 2020 2023  '''....        #
+00009d50: 4372 6561 7465 206e 6577 2066 6965 6c64  Create new field
+00009d60: 7320 696e 2065 6d70 6f77 6572 0d0a 2020  s in empower..  
+00009d70: 2020 2020 2020 2344 6f20 616c 6c20 6469        #Do all di
+00009d80: 6d65 6e73 696f 6e73 2061 7420 6f6e 6365  mensions at once
+00009d90: 2c20 666f 7220 7370 6565 640d 0a0d 0a20  , for speed.... 
+00009da0: 2020 2020 2020 2064 6562 7567 203d 2073         debug = s
+00009db0: 656c 662e 7369 7465 2e5f 6465 6275 670d  elf.site._debug.
+00009dc0: 0a0d 0a20 2020 2020 2020 206e 6577 5f66  ...        new_f
+00009dd0: 6965 6c64 7320 3d20 5b5d 0d0a 2020 2020  ields = []..    
+00009de0: 2020 2020 6e65 775f 6669 656c 6473 5f62      new_fields_b
+00009df0: 795f 696e 6465 7820 3d20 7b7d 0d0a 2020  y_index = {}..  
+00009e00: 2020 2020 2020 666f 7220 6469 6d65 6e73        for dimens
+00009e10: 696f 6e20 696e 2073 656c 662e 7369 7465  ion in self.site
+00009e20: 2e64 696d 656e 7369 6f6e 732e 7661 6c75  .dimensions.valu
+00009e30: 6573 2829 3a0d 0a20 2020 2020 2020 2020  es():..         
+00009e40: 2020 206e 6577 5f66 6965 6c64 735f 6279     new_fields_by
+00009e50: 5f69 6e64 6578 5b64 696d 656e 7369 6f6e  _index[dimension
+00009e60: 2e69 6e64 6578 5d20 3d20 5b5d 0d0a 2020  .index] = []..  
+00009e70: 2020 2020 2020 2020 2020 234a 4154 2032            #JAT 2
+00009e80: 3031 392d 3130 2d30 3320 4368 6563 6b20  019-10-03 Check 
+00009e90: 7468 6174 2074 6865 7265 2061 7265 2061  that there are a
+00009ea0: 6e79 2066 6965 6c64 7320 6174 2061 6c6c  ny fields at all
+00009eb0: 2075 7369 6e67 2070 7269 7661 7465 206d   using private m
+00009ec0: 656d 6265 7273 202d 206f 7468 6572 7769  embers - otherwi
+00009ed0: 7365 2064 696d 656e 7369 6f6e 2e66 6965  se dimension.fie
+00009ee0: 6c64 7320 646f 6573 2061 6e20 656c 656d  lds does an elem
+00009ef0: 656e 7420 6c6f 6164 0d0a 2020 2020 2020  ent load..      
+00009f00: 2020 2020 2020 6966 206c 656e 2864 696d        if len(dim
+00009f10: 656e 7369 6f6e 2e5f 6669 656c 6473 2e5f  ension._fields._
+00009f20: 6669 656c 6473 2920 3e20 303a 0d0a 2020  fields) > 0:..  
+00009f30: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00009f40: 7220 6669 656c 645f 6e61 6d65 2069 6e20  r field_name in 
+00009f50: 6469 6d65 6e73 696f 6e2e 6669 656c 6473  dimension.fields
+00009f60: 2e5f 6e65 775f 6669 656c 645f 6e61 6d65  ._new_field_name
+00009f70: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00009f80: 2020 2020 2020 2020 6669 656c 6420 3d20          field = 
+00009f90: 6469 6d65 6e73 696f 6e2e 6669 656c 6473  dimension.fields
+00009fa0: 5b66 6965 6c64 5f6e 616d 655d 0d0a 2020  [field_name]..  
+00009fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009fc0: 2020 6966 2066 6965 6c64 2e6c 6f6e 676e    if field.longn
+00009fd0: 616d 6520 6973 204e 6f6e 653a 0d0a 2020  ame is None:..  
+00009fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009ff0: 2020 2020 2020 7261 6973 6520 6d70 6578        raise mpex
+0000a000: 2e4d 5058 4572 726f 7228 2743 616e 6e6f  .MPXError('Canno
+0000a010: 7420 6372 6561 7465 2066 6965 6c64 2077  t create field w
+0000a020: 6974 686f 7574 2061 206c 6f6e 676e 616d  ithout a longnam
+0000a030: 652e 2044 696d 656e 7369 6f6e 3a20 7b7d  e. Dimension: {}
+0000a040: 2c20 7368 6f72 746e 616d 653a 207b 7d2c  , shortname: {},
+0000a050: 2066 6965 6c64 5f6e 616d 653a 207b 7d27   field_name: {}'
+0000a060: 2e66 6f72 6d61 7428 6469 6d65 6e73 696f  .format(dimensio
+0000a070: 6e2e 6c6f 6e67 6e61 6d65 2c66 6965 6c64  n.longname,field
+0000a080: 2e73 686f 7274 6e61 6d65 2c66 6965 6c64  .shortname,field
+0000a090: 5f6e 616d 6529 290d 0a20 2020 2020 2020  _name))..       
+0000a0a0: 2020 2020 2020 2020 2020 2020 206e 6577               new
+0000a0b0: 5f66 6965 6c64 732e 6170 7065 6e64 287b  _fields.append({
+0000a0c0: 2744 696d 656e 7369 6f6e 273a 6469 6d65  'Dimension':dime
+0000a0d0: 6e73 696f 6e2e 6c6f 6e67 6e61 6d65 2c20  nsion.longname, 
+0000a0e0: 274c 6f6e 676e 616d 6527 3a66 6965 6c64  'Longname':field
+0000a0f0: 2e6c 6f6e 676e 616d 652c 2027 5368 6f72  .longname, 'Shor
+0000a100: 746e 616d 6527 3a20 6669 656c 642e 7368  tname': field.sh
+0000a110: 6f72 746e 616d 652c 2744 6573 6372 6970  ortname,'Descrip
+0000a120: 7469 6f6e 273a 6669 656c 642e 6465 7363  tion':field.desc
+0000a130: 7269 7074 696f 6e7d 290d 0a20 2020 2020  ription})..     
+0000a140: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000a150: 6577 5f66 6965 6c64 735f 6279 5f69 6e64  ew_fields_by_ind
+0000a160: 6578 5b64 696d 656e 7369 6f6e 2e69 6e64  ex[dimension.ind
+0000a170: 6578 5d20 2b3d 205b 6669 656c 642e 7368  ex] += [field.sh
+0000a180: 6f72 746e 616d 655d 0d0a 0d0a 2020 2020  ortname]....    
+0000a190: 2020 2020 234f 6e6c 7920 7370 656e 6420      #Only spend 
+0000a1a0: 7469 6d65 206c 6f67 6769 6e67 2069 6e20  time logging in 
+0000a1b0: 746f 2045 6d70 6f77 6572 2069 6620 7468  to Empower if th
+0000a1c0: 6572 6520 6172 6520 6e65 7720 6669 656c  ere are new fiel
+0000a1d0: 6473 2074 6f20 6372 6561 7465 0d0a 2020  ds to create..  
+0000a1e0: 2020 2020 2020 6966 206c 656e 286e 6577        if len(new
+0000a1f0: 5f66 6965 6c64 7329 203e 2030 3a0d 0a0d  _fields) > 0:...
+0000a200: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000a210: 6465 6275 673a 0d0a 2020 2020 2020 2020  debug:..        
+0000a220: 2020 2020 2020 2020 666f 7220 6469 7220          for dir 
+0000a230: 696e 205b 7365 6c66 2e73 6974 652e 5f65  in [self.site._e
+0000a240: 6d70 6f77 6572 5f64 696d 5f69 6d70 6f72  mpower_dim_impor
+0000a250: 745f 6469 725d 3a0d 0a0d 0a20 2020 2020  t_dir]:....     
+0000a260: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000a270: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0000a280: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+0000a290: 6d61 6b65 6469 7273 2864 6972 290d 0a20  makedirs(dir).. 
 0000a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2b0: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
-0000a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2d0: 2020 6578 6365 7074 204f 5345 7272 6f72    except OSError
-0000a2e0: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
-0000a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a300: 6966 2065 2e77 696e 6572 726f 7220 3d3d  if e.winerror ==
-0000a310: 2031 3233 3a0d 0a20 2020 2020 2020 2020   123:..         
-0000a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a330: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000a340: 726f 7228 2744 6972 6563 746f 7279 2022  ror('Directory "
-0000a350: 7b7d 2220 6861 7320 616e 2069 6e76 616c  {}" has an inval
-0000a360: 6964 206e 616d 652e 2044 6964 2079 6f75  id name. Did you
-0000a370: 2070 6173 7320 6120 7369 7465 5f6c 6f63   pass a site_loc
-0000a380: 6174 6f72 2070 6174 6820 227b 7d22 2077  ator path "{}" w
-0000a390: 6974 686f 7574 2064 6f75 626c 652d 6573  ithout double-es
-0000a3a0: 6361 7069 6e67 2062 6163 6b73 6c61 7368  caping backslash
-0000a3b0: 6573 206f 7220 7072 6566 6978 696e 6720  es or prefixing 
-0000a3c0: 7468 6520 7374 7269 6e67 2077 6974 6820  the string with 
-0000a3d0: 616e 2022 7222 2066 6f72 2072 6177 3f27  an "r" for raw?'
-0000a3e0: 2e66 6f72 6d61 7428 6469 722c 7265 7072  .format(dir,repr
-0000a3f0: 2873 6974 655f 6c6f 6361 746f 7229 2929  (site_locator)))
-0000a400: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a410: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0000a420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a430: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000a440: 7365 2065 0d0a 2020 2020 2020 2020 2020  se e..          
-0000a450: 2020 2020 2020 6669 656c 645f 6d65 7461        field_meta
-0000a460: 6461 7461 5f66 696c 6570 6174 6820 3d20  data_filepath = 
-0000a470: 6f73 2e70 6174 682e 6a6f 696e 2873 656c  os.path.join(sel
-0000a480: 662e 7369 7465 2e5f 656d 706f 7765 725f  f.site._empower_
-0000a490: 6469 6d5f 696d 706f 7274 5f64 6972 2c27  dim_import_dir,'
-0000a4a0: 4669 656c 6473 2e74 7376 2729 0d0a 2020  Fields.tsv')..  
-0000a4b0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-0000a4c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a4d0: 2066 6965 6c64 5f6d 6574 6164 6174 615f   field_metadata_
-0000a4e0: 6669 6c65 7061 7468 203d 2072 275c 5c2e  filepath = r'\\.
-0000a4f0: 5c70 6970 655c 7b7d 272e 666f 726d 6174  \pipe\{}'.format
-0000a500: 2875 7569 642e 7575 6964 3428 2929 0d0a  (uuid.uuid4())..
-0000a510: 0d0a 2020 2020 2020 2020 2020 2020 2343  ..            #C
-0000a520: 6865 636b 2076 6572 7369 6f6e 206f 6620  heck version of 
-0000a530: 456d 706f 7765 720d 0a20 2020 2020 2020  Empower..       
-0000a540: 2020 2020 206d 616a 6f72 5f76 6572 7369       major_versi
-0000a550: 6f6e 2c20 6d69 6e6f 725f 7665 7273 696f  on, minor_versio
-0000a560: 6e2c 2072 656c 6561 7365 2c20 7265 6c65  n, release, rele
-0000a570: 6173 655f 6e75 6d62 6572 203d 2073 656c  ase_number = sel
-0000a580: 662e 7369 7465 2e69 6d70 6f72 7465 725f  f.site.importer_
-0000a590: 7665 7273 696f 6e0d 0a20 2020 2020 2020  version..       
-0000a5a0: 2020 2020 2069 6620 2828 6d61 6a6f 725f       if ((major_
-0000a5b0: 7665 7273 696f 6e20 3d3d 2039 2061 6e64  version == 9 and
-0000a5c0: 2028 7265 6c65 6173 655f 6e75 6d62 6572   (release_number
-0000a5d0: 203e 3d20 3139 3433 206f 7220 6d69 6e6f   >= 1943 or mino
-0000a5e0: 725f 7665 7273 696f 6e20 3e3d 3729 2920  r_version >=7)) 
-0000a5f0: 6f72 206d 616a 6f72 5f76 6572 7369 6f6e  or major_version
-0000a600: 203e 2039 2920 616e 6420 7365 6c66 2e73   > 9) and self.s
-0000a610: 6974 652e 5f65 6e63 7279 7074 6564 5f75  ite._encrypted_u
-0000a620: 7365 7220 6973 206e 6f74 204e 6f6e 653a  ser is not None:
-0000a630: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0000a640: 2020 2020 6c6f 672e 696e 666f 2827 4372      log.info('Cr
-0000a650: 6561 7469 6e67 206e 6577 2046 6965 6c64  eating new Field
-0000a660: 2064 6566 696e 6974 696f 6e73 2069 6e20   definitions in 
-0000a670: 456d 706f 7765 7220 7369 7465 2027 2b73  Empower site '+s
-0000a680: 656c 662e 7369 7465 2e5f 7369 7465 5f6c  elf.site._site_l
-0000a690: 6f63 6174 6f72 290d 0a0d 0a20 2020 2020  ocator)....     
-0000a6a0: 2020 2020 2020 2020 2020 2064 6566 205f             def _
-0000a6b0: 7969 656c 645f 6669 656c 645f 6d65 7461  yield_field_meta
-0000a6c0: 6461 7461 5f73 7472 696e 6773 286e 6577  data_strings(new
-0000a6d0: 5f66 6965 6c64 7329 3a0d 0a20 2020 2020  _fields):..     
-0000a6e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000a6f0: 5772 6974 6520 7468 6520 7461 6220 7365  Write the tab se
-0000a700: 7061 7261 7465 6420 6865 6164 6572 0d0a  parated header..
-0000a710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a720: 2020 2020 7969 656c 6420 2744 696d 656e      yield 'Dimen
-0000a730: 7369 6f6e 5c74 4c6f 6e67 6e61 6d65 5c74  sion\tLongname\t
-0000a740: 5368 6f72 746e 616d 655c 7444 6573 6372  Shortname\tDescr
-0000a750: 6970 7469 6f6e 5c6e 270d 0a0d 0a20 2020  iption\n'....   
-0000a760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a770: 2023 5772 6974 6520 6461 7461 2066 6f72   #Write data for
-0000a780: 2061 6c6c 206f 6620 7468 6520 6e65 7720   all of the new 
-0000a790: 6669 656c 6473 2074 6f20 7468 6520 6669  fields to the fi
-0000a7a0: 6c65 0d0a 2020 2020 2020 2020 2020 2020  le..            
-0000a7b0: 2020 2020 2020 2020 666f 7220 6e2c 206e          for n, n
-0000a7c0: 6577 5f66 6965 6c64 2069 6e20 656e 756d  ew_field in enum
-0000a7d0: 6572 6174 6528 6e65 775f 6669 656c 6473  erate(new_fields
-0000a7e0: 293a 0d0a 0d0a 2020 2020 2020 2020 2020  ):....          
-0000a7f0: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-0000a800: 656c 6420 6e65 775f 6669 656c 645b 2744  eld new_field['D
-0000a810: 696d 656e 7369 6f6e 275d 0d0a 2020 2020  imension']..    
-0000a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a830: 2020 2020 7969 656c 6420 275c 7427 0d0a      yield '\t'..
-0000a840: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a850: 2020 2020 2020 2020 2020 234f 6464 6c79            #Oddly
-0000a860: 2c20 6c6f 6e67 6e61 6d65 2069 7320 7468  , longname is th
-0000a870: 6520 6b65 7920 6865 7265 2c20 6e6f 7420  e key here, not 
-0000a880: 7368 6f72 7420 6e61 6d65 0d0a 2020 2020  short name..    
-0000a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a8a0: 2020 2020 7969 656c 6420 6e65 775f 6669      yield new_fi
-0000a8b0: 656c 645b 274c 6f6e 676e 616d 6527 5d0d  eld['Longname'].
-0000a8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a8d0: 2020 2020 2020 2020 2079 6965 6c64 2027           yield '
-0000a8e0: 5c74 270d 0a0d 0a20 2020 2020 2020 2020  \t'....         
-0000a8f0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000a900: 6620 6e65 775f 6669 656c 645b 2753 686f  f new_field['Sho
-0000a910: 7274 6e61 6d65 275d 2069 7320 6e6f 7420  rtname'] is not 
-0000a920: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0000a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a940: 2020 2079 6965 6c64 206e 6577 5f66 6965     yield new_fie
-0000a950: 6c64 5b27 5368 6f72 746e 616d 6527 5d0d  ld['Shortname'].
-0000a960: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a970: 2020 2020 2020 2020 2079 6965 6c64 2027           yield '
-0000a980: 5c74 270d 0a0d 0a0d 0a20 2020 2020 2020  \t'......       
+0000a2b0: 2020 2065 7863 6570 7420 4669 6c65 4578     except FileEx
+0000a2c0: 6973 7473 4572 726f 723a 0d0a 2020 2020  istsError:..    
+0000a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2e0: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
+0000a2f0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+0000a300: 6365 7074 204f 5345 7272 6f72 2061 7320  cept OSError as 
+0000a310: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000a320: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+0000a330: 2e77 696e 6572 726f 7220 3d3d 2031 3233  .winerror == 123
+0000a340: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000a350: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000a360: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+0000a370: 2744 6972 6563 746f 7279 2022 7b7d 2220  'Directory "{}" 
+0000a380: 6861 7320 616e 2069 6e76 616c 6964 206e  has an invalid n
+0000a390: 616d 652e 2044 6964 2079 6f75 2070 6173  ame. Did you pas
+0000a3a0: 7320 6120 7369 7465 5f6c 6f63 6174 6f72  s a site_locator
+0000a3b0: 2070 6174 6820 227b 7d22 2077 6974 686f   path "{}" witho
+0000a3c0: 7574 2064 6f75 626c 652d 6573 6361 7069  ut double-escapi
+0000a3d0: 6e67 2062 6163 6b73 6c61 7368 6573 206f  ng backslashes o
+0000a3e0: 7220 7072 6566 6978 696e 6720 7468 6520  r prefixing the 
+0000a3f0: 7374 7269 6e67 2077 6974 6820 616e 2022  string with an "
+0000a400: 7222 2066 6f72 2072 6177 3f27 2e66 6f72  r" for raw?'.for
+0000a410: 6d61 7428 6469 722c 7265 7072 2873 6974  mat(dir,repr(sit
+0000a420: 655f 6c6f 6361 746f 7229 2929 0d0a 2020  e_locator)))..  
+0000a430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a440: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0000a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a460: 2020 2020 2020 2020 2072 6169 7365 2065           raise e
+0000a470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a480: 2020 6669 656c 645f 6d65 7461 6461 7461    field_metadata
+0000a490: 5f66 696c 6570 6174 6820 3d20 6f73 2e70  _filepath = os.p
+0000a4a0: 6174 682e 6a6f 696e 2873 656c 662e 7369  ath.join(self.si
+0000a4b0: 7465 2e5f 656d 706f 7765 725f 6469 6d5f  te._empower_dim_
+0000a4c0: 696d 706f 7274 5f64 6972 2c27 4669 656c  import_dir,'Fiel
+0000a4d0: 6473 2e74 7376 2729 0d0a 2020 2020 2020  ds.tsv')..      
+0000a4e0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0000a4f0: 2020 2020 2020 2020 2020 2020 2066 6965               fie
+0000a500: 6c64 5f6d 6574 6164 6174 615f 6669 6c65  ld_metadata_file
+0000a510: 7061 7468 203d 2072 275c 5c2e 5c70 6970  path = r'\\.\pip
+0000a520: 655c 7b7d 272e 666f 726d 6174 2875 7569  e\{}'.format(uui
+0000a530: 642e 7575 6964 3428 2929 0d0a 0d0a 2020  d.uuid4())....  
+0000a540: 2020 2020 2020 2020 2020 2343 6865 636b            #Check
+0000a550: 2076 6572 7369 6f6e 206f 6620 456d 706f   version of Empo
+0000a560: 7765 720d 0a20 2020 2020 2020 2020 2020  wer..           
+0000a570: 206d 616a 6f72 5f76 6572 7369 6f6e 2c20   major_version, 
+0000a580: 6d69 6e6f 725f 7665 7273 696f 6e2c 2072  minor_version, r
+0000a590: 656c 6561 7365 2c20 7265 6c65 6173 655f  elease, release_
+0000a5a0: 6e75 6d62 6572 203d 2073 656c 662e 7369  number = self.si
+0000a5b0: 7465 2e69 6d70 6f72 7465 725f 7665 7273  te.importer_vers
+0000a5c0: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
+0000a5d0: 2069 6620 2828 6d61 6a6f 725f 7665 7273   if ((major_vers
+0000a5e0: 696f 6e20 3d3d 2039 2061 6e64 2028 7265  ion == 9 and (re
+0000a5f0: 6c65 6173 655f 6e75 6d62 6572 203e 3d20  lease_number >= 
+0000a600: 3139 3433 206f 7220 6d69 6e6f 725f 7665  1943 or minor_ve
+0000a610: 7273 696f 6e20 3e3d 3729 2920 6f72 206d  rsion >=7)) or m
+0000a620: 616a 6f72 5f76 6572 7369 6f6e 203e 2039  ajor_version > 9
+0000a630: 2920 616e 6420 7365 6c66 2e73 6974 652e  ) and self.site.
+0000a640: 5f65 6e63 7279 7074 6564 5f75 7365 7220  _encrypted_user 
+0000a650: 6973 206e 6f74 204e 6f6e 653a 0d0a 0d0a  is not None:....
+0000a660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a670: 6c6f 672e 696e 666f 2827 4372 6561 7469  log.info('Creati
+0000a680: 6e67 206e 6577 2046 6965 6c64 2064 6566  ng new Field def
+0000a690: 696e 6974 696f 6e73 2069 6e20 456d 706f  initions in Empo
+0000a6a0: 7765 7220 7369 7465 2027 2b73 656c 662e  wer site '+self.
+0000a6b0: 7369 7465 2e5f 7369 7465 5f6c 6f63 6174  site._site_locat
+0000a6c0: 6f72 290d 0a0d 0a20 2020 2020 2020 2020  or)....         
+0000a6d0: 2020 2020 2020 2064 6566 205f 7969 656c         def _yiel
+0000a6e0: 645f 6669 656c 645f 6d65 7461 6461 7461  d_field_metadata
+0000a6f0: 5f73 7472 696e 6773 286e 6577 5f66 6965  _strings(new_fie
+0000a700: 6c64 7329 3a0d 0a20 2020 2020 2020 2020  lds):..         
+0000a710: 2020 2020 2020 2020 2020 2023 5772 6974             #Writ
+0000a720: 6520 7468 6520 7461 6220 7365 7061 7261  e the tab separa
+0000a730: 7465 6420 6865 6164 6572 0d0a 2020 2020  ted header..    
+0000a740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a750: 7969 656c 6420 2744 696d 656e 7369 6f6e  yield 'Dimension
+0000a760: 5c74 4c6f 6e67 6e61 6d65 5c74 5368 6f72  \tLongname\tShor
+0000a770: 746e 616d 655c 7444 6573 6372 6970 7469  tname\tDescripti
+0000a780: 6f6e 5c6e 270d 0a0d 0a20 2020 2020 2020  on\n'....       
+0000a790: 2020 2020 2020 2020 2020 2020 2023 5772               #Wr
+0000a7a0: 6974 6520 6461 7461 2066 6f72 2061 6c6c  ite data for all
+0000a7b0: 206f 6620 7468 6520 6e65 7720 6669 656c   of the new fiel
+0000a7c0: 6473 2074 6f20 7468 6520 6669 6c65 0d0a  ds to the file..
+0000a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7e0: 2020 2020 666f 7220 6e2c 206e 6577 5f66      for n, new_f
+0000a7f0: 6965 6c64 2069 6e20 656e 756d 6572 6174  ield in enumerat
+0000a800: 6528 6e65 775f 6669 656c 6473 293a 0d0a  e(new_fields):..
+0000a810: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000a820: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
+0000a830: 6e65 775f 6669 656c 645b 2744 696d 656e  new_field['Dimen
+0000a840: 7369 6f6e 275d 0d0a 2020 2020 2020 2020  sion']..        
+0000a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a860: 7969 656c 6420 275c 7427 0d0a 0d0a 2020  yield '\t'....  
+0000a870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a880: 2020 2020 2020 234f 6464 6c79 2c20 6c6f        #Oddly, lo
+0000a890: 6e67 6e61 6d65 2069 7320 7468 6520 6b65  ngname is the ke
+0000a8a0: 7920 6865 7265 2c20 6e6f 7420 7368 6f72  y here, not shor
+0000a8b0: 7420 6e61 6d65 0d0a 2020 2020 2020 2020  t name..        
+0000a8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8d0: 7969 656c 6420 6e65 775f 6669 656c 645b  yield new_field[
+0000a8e0: 274c 6f6e 676e 616d 6527 5d0d 0a20 2020  'Longname']..   
+0000a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a900: 2020 2020 2079 6965 6c64 2027 5c74 270d       yield '\t'.
+0000a910: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+0000a920: 2020 2020 2020 2020 2020 2069 6620 6e65             if ne
+0000a930: 775f 6669 656c 645b 2753 686f 7274 6e61  w_field['Shortna
+0000a940: 6d65 275d 2069 7320 6e6f 7420 4e6f 6e65  me'] is not None
+0000a950: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000a960: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+0000a970: 6965 6c64 206e 6577 5f66 6965 6c64 5b27  ield new_field['
+0000a980: 5368 6f72 746e 616d 6527 5d0d 0a20 2020  Shortname']..   
 0000a990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9a0: 2069 6620 6e65 775f 6669 656c 645b 2744   if new_field['D
-0000a9b0: 6573 6372 6970 7469 6f6e 275d 2069 7320  escription'] is 
-0000a9c0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-0000a9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a9e0: 2020 2020 2020 2079 6965 6c64 206e 6577         yield new
-0000a9f0: 5f66 6965 6c64 5b27 4465 7363 7269 7074  _field['Descript
-0000aa00: 696f 6e27 5d0d 0a20 2020 2020 2020 2020  ion']..         
-0000aa10: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-0000aa20: 6965 6c64 2027 5c6e 270d 0a0d 0a20 2020  ield '\n'....   
-0000aa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aa40: 2020 2020 206c 6f67 2e69 6e66 6f28 2743       log.info('C
-0000aa50: 7265 6174 696e 6720 6e65 7720 4669 656c  reating new Fiel
-0000aa60: 6420 6465 6669 6e69 7469 6f6e 3a20 272b  d definition: '+
-0000aa70: 7374 7228 6e65 775f 6669 656c 6429 290d  str(new_field)).
-0000aa80: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0000aa90: 2020 2063 6f6d 6d61 6e64 5f6c 6973 7420     command_list 
-0000aaa0: 3d20 7365 6c66 2e73 6974 652e 5f6c 6f67  = self.site._log
-0000aab0: 6f6e 5f70 6172 616d 6574 6572 5f69 6d70  on_parameter_imp
-0000aac0: 6f72 7465 725f 636f 6d6d 616e 6473 202b  orter_commands +
-0000aad0: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
-0000aae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aaf0: 2020 205b 276c 6f61 642d 6669 6c65 2d74     ['load-file-t
-0000ab00: 7376 2022 2720 2020 2020 2020 2020 2020  sv "'           
-0000ab10: 2020 2020 2020 2020 2b20 6669 656c 645f          + field_
-0000ab20: 6d65 7461 6461 7461 5f66 696c 6570 6174  metadata_filepat
-0000ab30: 6820 2b20 2722 270d 0a20 2020 2020 2020  h + '"'..       
-0000ab40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab50: 2020 2020 2020 2020 2c27 656d 706f 7765          ,'empowe
-0000ab60: 722d 696d 706f 7274 2d66 6965 6c64 2d65  r-import-field-e
-0000ab70: 6c65 6d65 6e74 7320 2d68 6173 2d68 6561  lements -has-hea
-0000ab80: 6465 7220 2d75 7073 6572 7420 2224 7b73  der -upsert "${s
-0000ab90: 6974 657d 2220 2224 7b75 7365 727d 2220  ite}" "${user}" 
-0000aba0: 2224 7b70 6173 7377 6f72 647d 2227 0d0a  "${password}"'..
-0000abb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000abc0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-0000abd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000abe0: 2020 2353 7769 7463 6820 6465 7363 7269    #Switch descri
-0000abf0: 7074 696f 6e20 666f 7220 6120 636f 6e63  ption for a conc
-0000ac00: 6174 656e 6174 6564 206b 6579 202d 2077  atenated key - w
-0000ac10: 6520 7769 6c6c 2062 6520 6162 6c65 2074  e will be able t
-0000ac20: 6f20 6772 6162 2074 6865 2073 686f 7274  o grab the short
-0000ac30: 6e61 6d65 2061 6e64 206c 696e 6b20 636f  name and link co
-0000ac40: 7272 6563 7420 656c 656d 656e 7473 2069  rrect elements i
-0000ac50: 6e20 6f72 6465 7220 746f 2075 7064 6174  n order to updat
-0000ac60: 6520 6669 656c 6473 0d0a 2020 2020 2020  e fields..      
-0000ac70: 2020 2020 2020 2020 2020 2349 6e20 6465            #In de
-0000ac80: 6275 6720 6d6f 6465 2077 7269 7465 2074  bug mode write t
-0000ac90: 6865 2064 6174 6120 696e 746f 2061 2074  he data into a t
-0000aca0: 7376 2066 696c 6520 616e 6420 7265 6164  sv file and read
-0000acb0: 2069 7420 7769 7468 2049 6d70 6f72 7465   it with Importe
-0000acc0: 722c 2070 7574 7469 6e67 2074 6865 2065  r, putting the e
-0000acd0: 6c65 6d65 6e74 7320 696e 746f 2045 6d70  lements into Emp
-0000ace0: 6f77 6572 0d0a 2020 2020 2020 2020 2020  ower..          
-0000acf0: 2020 2020 2020 6966 2064 6562 7567 3a0d        if debug:.
-0000ad00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ad10: 2020 2020 2077 6974 6820 6f70 656e 2866       with open(f
-0000ad20: 6965 6c64 5f6d 6574 6164 6174 615f 6669  ield_metadata_fi
-0000ad30: 6c65 7061 7468 2c27 7727 2c65 6e63 6f64  lepath,'w',encod
-0000ad40: 696e 673d 2775 7466 3827 2920 6173 206e  ing='utf8') as n
-0000ad50: 6577 5f66 6965 6c64 5f66 696c 653a 0d0a  ew_field_file:..
-0000ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad70: 2020 2020 2020 2020 666f 7220 7320 696e          for s in
-0000ad80: 205f 7969 656c 645f 6669 656c 645f 6d65   _yield_field_me
-0000ad90: 7461 6461 7461 5f73 7472 696e 6773 286e  tadata_strings(n
-0000ada0: 6577 5f66 6965 6c64 7329 3a0d 0a20 2020  ew_fields):..   
-0000adb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adc0: 2020 2020 2020 2020 206e 6577 5f66 6965           new_fie
-0000add0: 6c64 5f66 696c 652e 7772 6974 6528 7329  ld_file.write(s)
-0000ade0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0000adf0: 2020 2020 2020 2020 6c6c 752e 7275 6e5f          llu.run_
-0000ae00: 7369 6e67 6c65 5f6f 7574 7075 745f 696d  single_output_im
-0000ae10: 706f 7274 6572 5f63 6f6d 6d61 6e64 7328  porter_commands(
-0000ae20: 636f 6d6d 616e 645f 6c69 7374 2c20 656d  command_list, em
-0000ae30: 706f 7765 725f 696d 706f 7274 6572 5f65  power_importer_e
-0000ae40: 7865 6375 7461 626c 653d 7365 6c66 2e73  xecutable=self.s
-0000ae50: 6974 652e 656d 706f 7765 725f 696d 706f  ite.empower_impo
-0000ae60: 7274 6572 5f65 7865 6375 7461 626c 6529  rter_executable)
-0000ae70: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0000ae80: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0000ae90: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000aea0: 496e 2027 6e6f 726d 616c 2720 6d6f 6465  In 'normal' mode
-0000aeb0: 2064 6f20 6120 6d65 7272 7920 6461 6e63   do a merry danc
-0000aec0: 6520 7769 7468 2057 696e 646f 7773 206e  e with Windows n
-0000aed0: 616d 6564 2070 6970 6573 2e20 5468 6973  amed pipes. This
-0000aee0: 2061 766f 6964 7320 7772 6974 696e 6720   avoids writing 
-0000aef0: 7468 6520 6461 7461 2074 6f20 6669 6c65  the data to file
-0000af00: 2066 6f72 2073 6563 7572 6974 7920 616e   for security an
-0000af10: 6420 7072 6163 7469 6361 6c69 7479 2072  d practicality r
-0000af20: 6561 736f 6e73 0d0a 2020 2020 2020 2020  easons..        
-0000af30: 2020 2020 2020 2020 2020 2020 2366 6965              #fie
-0000af40: 6c64 5f6d 6574 6164 6174 615f 6669 6c65  ld_metadata_file
-0000af50: 7061 7468 2069 7320 7468 6520 6e61 6d65  path is the name
-0000af60: 206f 6620 7468 6520 6e61 6d65 6420 7069   of the named pi
-0000af70: 7065 2065 2e67 2e20 5c5c 2e5c 7069 7065  pe e.g. \\.\pipe
-0000af80: 5c39 6463 6366 6130 382d 3430 6331 2d34  \9dccfa08-40c1-4
-0000af90: 3566 352d 3865 3065 2d66 3634 6331 3835  5f5-8e0e-f64c185
-0000afa0: 3032 6263 640d 0a20 2020 2020 2020 2020  02bcd..         
-0000afb0: 2020 2020 2020 2020 2020 2023 5468 6520             #The 
-0000afc0: 6d65 7272 7920 6461 6e63 6520 6d65 616e  merry dance mean
-0000afd0: 7320 7374 6172 7469 6e67 2065 6d70 6f77  s starting empow
-0000afe0: 6572 2c20 7265 6665 7265 6e63 696e 6720  er, referencing 
-0000aff0: 7468 6520 7069 7065 2c20 6f70 656e 696e  the pipe, openin
-0000b000: 6720 7468 6520 7069 7065 2062 6566 6f72  g the pipe befor
-0000b010: 6520 656d 706f 7765 7220 6973 2070 726f  e empower is pro
-0000b020: 7065 726c 7920 7374 6172 7465 640d 0a20  perly started.. 
-0000b030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b040: 2020 2023 7365 7474 696e 6720 7570 2074     #setting up t
-0000b050: 6865 206e 616d 6564 2070 6970 6520 6f6e  he named pipe on
-0000b060: 2074 6869 7320 7468 7265 6164 2c20 616e   this thread, an
-0000b070: 6420 7772 6974 696e 6720 746f 2069 7420  d writing to it 
-0000b080: 2861 7320 736f 6f6e 2061 7320 496d 706f  (as soon as Impo
-0000b090: 7274 6572 2063 6f6e 6e65 6374 7320 6174  rter connects at
-0000b0a0: 2069 7473 2065 6e64 290d 0a20 2020 2020   its end)..     
-0000b0b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000b0c0: 5468 6520 6469 6666 6963 756c 7479 2c20  The difficulty, 
-0000b0d0: 6973 2074 6861 7420 7765 2068 6176 6520  is that we have 
-0000b0e0: 746f 2070 6173 7320 7468 6520 6e61 6d65  to pass the name
-0000b0f0: 206f 6620 7468 6520 7069 7065 2074 6f20   of the pipe to 
-0000b100: 496d 706f 7274 6572 2c20 616e 6420 7265  Importer, and re
-0000b110: 6c79 206f 6e20 7468 6520 6661 6374 2074  ly on the fact t
-0000b120: 6861 7420 6974 2077 6f6e 2774 2068 6176  hat it won't hav
-0000b130: 6520 7469 6d65 2074 6f20 6f70 656e 2069  e time to open i
-0000b140: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-0000b150: 2020 2020 2020 2023 6265 666f 7265 2077         #before w
-0000b160: 6520 6861 7665 2063 7265 6174 6564 2069  e have created i
-0000b170: 742e 2042 7574 2077 6520 7769 6c6c 2062  t. But we will b
-0000b180: 6c6f 636b 206f 6e20 6f75 7220 7369 6465  lock on our side
-0000b190: 2075 6e74 696c 2049 6d70 6f72 7465 7220   until Importer 
-0000b1a0: 6861 7320 636f 6e6e 6563 7465 640d 0a20  has connected.. 
-0000b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1c0: 2020 2070 726f 6320 3d20 4e6f 6e65 0d0a     proc = None..
-0000b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1e0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-0000b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b200: 2020 7072 6f63 203d 206c 6c75 2e73 7461    proc = llu.sta
-0000b210: 7274 5f6e 6f5f 6f75 7470 7574 5f69 6d70  rt_no_output_imp
-0000b220: 6f72 7465 725f 636f 6d6d 616e 6473 2863  orter_commands(c
-0000b230: 6f6d 6d61 6e64 5f6c 6973 742c 656d 706f  ommand_list,empo
-0000b240: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
-0000b250: 6375 7461 626c 653d 7365 6c66 2e73 6974  cutable=self.sit
-0000b260: 652e 656d 706f 7765 725f 696d 706f 7274  e.empower_import
-0000b270: 6572 5f65 7865 6375 7461 626c 6529 0d0a  er_executable)..
-0000b280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b290: 2020 2020 2020 2020 7769 7468 206c 6c75          with llu
-0000b2a0: 2e6f 7574 626f 756e 645f 7069 7065 2866  .outbound_pipe(f
-0000b2b0: 6965 6c64 5f6d 6574 6164 6174 615f 6669  ield_metadata_fi
-0000b2c0: 6c65 7061 7468 2920 6173 2070 6970 653a  lepath) as pipe:
-0000b2d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b2e0: 2020 2020 2020 2020 2020 2020 2020 2323                ##
-0000b2f0: 2046 726f 6d20 392e 3820 6f6e 7761 7264   From 9.8 onward
-0000b300: 7320 7772 6974 6520 7468 6520 5769 6e64  s write the Wind
-0000b310: 6f77 7320 4279 7465 204f 7264 6572 204d  ows Byte Order M
-0000b320: 6172 6b65 7220 2842 4f4d 290d 0a20 2020  arker (BOM)..   
-0000b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b340: 2020 2020 2020 2020 2023 6966 2028 286d           #if ((m
-0000b350: 616a 6f72 5f76 6572 7369 6f6e 203d 3d20  ajor_version == 
-0000b360: 3920 616e 6420 6d69 6e6f 725f 7665 7273  9 and minor_vers
-0000b370: 696f 6e20 3e3d 3829 206f 7220 6d61 6a6f  ion >=8) or majo
-0000b380: 725f 7665 7273 696f 6e20 3e20 3929 3a0d  r_version > 9):.
-0000b390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b3a0: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-0000b3b0: 2020 7769 6e33 3266 696c 652e 5772 6974    win32file.Writ
-0000b3c0: 6546 696c 6528 7069 7065 2c20 2222 2e65  eFile(pipe, "".e
-0000b3d0: 6e63 6f64 6528 2275 7466 2d38 2d73 6967  ncode("utf-8-sig
-0000b3e0: 2229 290d 0a20 2020 2020 2020 2020 2020  "))..           
-0000b3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b400: 2070 7269 6e74 2827 6e65 775f 6669 656c   print('new_fiel
-0000b410: 6473 272c 6e65 775f 6669 656c 6473 290d  ds',new_fields).
-0000b420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b430: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0000b440: 2073 2069 6e20 5f79 6965 6c64 5f66 6965   s in _yield_fie
-0000b450: 6c64 5f6d 6574 6164 6174 615f 7374 7269  ld_metadata_stri
-0000b460: 6e67 7328 6e65 775f 6669 656c 6473 293a  ngs(new_fields):
-0000b470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b490: 2020 7769 6e33 3266 696c 652e 5772 6974    win32file.Writ
-0000b4a0: 6546 696c 6528 7069 7065 2c20 732e 656e  eFile(pipe, s.en
-0000b4b0: 636f 6465 2829 290d 0a0d 0a20 2020 2020  code())....     
-0000b4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b4d0: 2020 2020 2020 206c 6f67 2e64 6562 7567         log.debug
-0000b4e0: 2822 5069 7065 207b 7d20 6669 6e69 7368  ("Pipe {} finish
-0000b4f0: 6564 2077 7269 7469 6e67 222e 666f 726d  ed writing".form
-0000b500: 6174 2866 6965 6c64 5f6d 6574 6164 6174  at(field_metadat
-0000b510: 615f 6669 6c65 7061 7468 2929 0d0a 0d0a  a_filepath))....
-0000b520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b530: 2020 2020 6669 6e61 6c6c 793a 0d0a 0d0a      finally:....
-0000b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b550: 2020 2020 2020 2020 2343 6865 636b 2069          #Check i
-0000b560: 6620 496d 706f 7274 6572 2072 6574 7572  f Importer retur
-0000b570: 6e65 6420 616e 2065 7272 6f72 2061 6e64  ned an error and
-0000b580: 2072 6169 7365 2069 7420 6173 2061 2070   raise it as a p
-0000b590: 7974 686f 6e20 6572 726f 7220 6966 2069  ython error if i
-0000b5a0: 7420 6469 640d 0a20 2020 2020 2020 2020  t did..         
-0000b5b0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000b5c0: 6c75 2e63 6f6d 706c 6574 655f 6e6f 5f6f  lu.complete_no_o
-0000b5d0: 7574 7075 745f 696d 706f 7274 6572 5f70  utput_importer_p
-0000b5e0: 726f 6365 7373 2870 726f 6329 0d0a 0d0a  rocess(proc)....
-0000b5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b600: 6c6f 672e 696e 666f 2827 4e65 7720 6669  log.info('New fi
-0000b610: 656c 6473 2063 7265 6174 6564 2069 6e20  elds created in 
-0000b620: 456d 706f 7765 7220 7369 7465 2027 2b73  Empower site '+s
-0000b630: 656c 662e 7369 7465 2e5f 7369 7465 5f6c  elf.site._site_l
-0000b640: 6f63 6174 6f72 290d 0a20 2020 2020 2020  ocator)..       
-0000b650: 2020 2020 2020 2020 2066 6f72 2064 696d           for dim
-0000b660: 5f69 6e64 6578 2c20 6669 656c 645f 7368  _index, field_sh
-0000b670: 6f72 746e 616d 6573 2069 6e20 6e65 775f  ortnames in new_
-0000b680: 6669 656c 6473 5f62 795f 696e 6465 782e  fields_by_index.
-0000b690: 6974 656d 7328 293a 0d0a 2020 2020 2020  items():..      
-0000b6a0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000b6b0: 7220 736e 2069 6e20 6669 656c 645f 7368  r sn in field_sh
-0000b6c0: 6f72 746e 616d 6573 3a0d 0a20 2020 2020  ortnames:..     
-0000b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6e0: 2020 2069 6620 736e 2069 7320 6e6f 7420     if sn is not 
-0000b6f0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0000b700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b710: 2020 2073 656c 662e 7369 7465 2e64 696d     self.site.dim
-0000b720: 656e 7369 6f6e 735b 6469 6d5f 696e 6465  ensions[dim_inde
-0000b730: 785d 2e66 6965 6c64 732e 5f61 6464 5f66  x].fields._add_f
-0000b740: 6965 6c64 5f6e 616d 6528 736e 290d 0a20  ield_name(sn).. 
-0000b750: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000b760: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000b770: 2020 7261 6973 6520 6d70 6578 2e45 6d70    raise mpex.Emp
-0000b780: 6f77 6572 496d 706f 7274 6572 5665 7273  owerImporterVers
-0000b790: 696f 6e45 7272 6f72 2827 596f 7520 6d75  ionError('You mu
-0000b7a0: 7374 2075 7067 7261 6465 2074 6f20 456d  st upgrade to Em
-0000b7b0: 706f 7765 7220 496d 706f 7274 6572 2039  power Importer 9
-0000b7c0: 2e35 2e31 382e 3139 3433 206f 7220 6265  .5.18.1943 or be
-0000b7d0: 796f 6e64 2061 6e64 2075 7365 2065 6e63  yond and use enc
-0000b7e0: 7279 7074 6564 2070 6173 7377 6f72 6473  rypted passwords
-0000b7f0: 2069 6e20 6f72 6465 7220 746f 2063 7265   in order to cre
-0000b800: 6174 6520 6e65 7720 6669 656c 6473 2069  ate new fields i
-0000b810: 6e20 456d 706f 7765 7227 290d 0a0d 0a20  n Empower').... 
-0000b820: 2020 2023 746f 646f 0d0a 2020 2020 2374     #todo..    #t
-0000b830: 6f2f 6672 6f6d 204a 534f 4e0d 0a20 2020  o/from JSON..   
-0000b840: 2023 746f 2f66 726f 6d20 5941 4d4c 0d0a   #to/from YAML..
-0000b850: 0d0a 636c 6173 7320 5f53 7472 7563 7475  ..class _Structu
-0000b860: 7265 4765 7474 6572 286f 626a 6563 7429  reGetter(object)
-0000b870: 3a0d 0a20 2020 2027 2727 446f 6573 2061  :..    '''Does a
-0000b880: 2062 6974 206f 6620 6d61 6769 6320 746f   bit of magic to
-0000b890: 2061 6c6c 6f77 2044 696d 656e 7369 6f6e   allow Dimension
-0000b8a0: 7320 746f 2068 6176 6520 6120 7374 7275  s to have a stru
-0000b8b0: 6374 7572 6573 206f 626a 6563 7420 7768  ctures object wh
-0000b8c0: 6963 6820 6265 6861 7665 7320 6c69 6b65  ich behaves like
-0000b8d0: 2061 206c 617a 7920 6c6f 6164 696e 6720   a lazy loading 
-0000b8e0: 6469 6374 696f 6e61 7279 2727 270d 0a20  dictionary'''.. 
-0000b8f0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0000b900: 7365 6c66 2c64 696d 656e 7369 6f6e 2c20  self,dimension, 
-0000b910: 656d 706f 7765 725f 696d 706f 7274 6572  empower_importer
-0000b920: 5f65 7865 6375 7461 626c 653d 6c6c 752e  _executable=llu.
-0000b930: 454d 504f 5745 525f 494d 504f 5254 4552  EMPOWER_IMPORTER
-0000b940: 5f45 5845 4355 5441 424c 4529 3a0d 0a20  _EXECUTABLE):.. 
-0000b950: 2020 2020 2020 2073 656c 662e 6469 6d65         self.dime
-0000b960: 6e73 696f 6e3d 6469 6d65 6e73 696f 6e0d  nsion=dimension.
-0000b970: 0a20 2020 2020 2020 2073 656c 662e 656d  .        self.em
-0000b980: 706f 7765 725f 696d 706f 7274 6572 5f65  power_importer_e
-0000b990: 7865 6375 7461 626c 6520 3d20 656d 706f  xecutable = empo
-0000b9a0: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
-0000b9b0: 6375 7461 626c 650d 0a20 2020 2020 2020  cutable..       
-0000b9c0: 2073 656c 662e 5f73 7472 7563 7475 7265   self._structure
-0000b9d0: 733d 7b7d 0d0a 0d0a 2020 2020 2020 2020  s={}....        
-0000b9e0: 7365 6c66 2e5f 5f73 7472 7563 7475 7265  self.__structure
-0000b9f0: 735f 7265 6164 2020 203d 2046 616c 7365  s_read   = False
-0000ba00: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0000ba10: 5f73 7472 7563 7475 7265 735f 7379 6e63  _structures_sync
-0000ba20: 6564 203d 2054 7275 650d 0a0d 0a20 2020  ed = True....   
-0000ba30: 2020 2020 2073 656c 662e 5f65 6e63 6f64       self._encod
-0000ba40: 696e 675f 6c69 7374 203d 205b 2775 7466  ing_list = ['utf
-0000ba50: 3827 2c27 6370 3132 3532 272c 276c 6174  8','cp1252','lat
-0000ba60: 696e 3127 5d0d 0a0d 0a20 2020 2064 6566  in1']....    def
-0000ba70: 2073 6574 5f70 7265 6665 7272 6564 5f65   set_preferred_e
-0000ba80: 6e63 6f64 696e 675f 6c69 7374 2873 656c  ncoding_list(sel
-0000ba90: 662c 6974 656d 293a 0d0a 2020 2020 2020  f,item):..      
-0000baa0: 2020 2727 2753 6574 2061 206c 6973 7420    '''Set a list 
-0000bab0: 6f66 2065 6e63 6f64 696e 6773 2074 6861  of encodings tha
-0000bac0: 7420 7769 6c6c 2062 6520 7472 6965 6420  t will be tried 
-0000bad0: 7768 656e 2072 6561 6469 6e67 2061 2073  when reading a s
-0000bae0: 7472 7563 7475 7265 2066 726f 6d20 456d  tructure from Em
-0000baf0: 706f 7765 722e 2054 6865 2065 6e63 6f64  power. The encod
-0000bb00: 696e 6773 2077 696c 6c20 6265 2074 7269  ings will be tri
-0000bb10: 6564 2069 6e20 7468 6520 6f72 6465 7220  ed in the order 
-0000bb20: 7072 6573 656e 7465 6420 696e 2074 6865  presented in the
-0000bb30: 206c 6973 740d 0a0d 0a20 2020 2020 2020   list....       
-0000bb40: 203a 7061 7261 6d20 6974 656d 3a20 4120   :param item: A 
-0000bb50: 6c69 7374 206f 6620 656e 636f 6469 6e67  list of encoding
-0000bb60: 7320 7468 6174 2077 696c 6c20 6265 2074  s that will be t
-0000bb70: 7269 6564 2e20 5468 6520 6465 6661 756c  ried. The defaul
-0000bb80: 7420 6c69 7374 2069 7320 5b27 7574 6638  t list is ['utf8
-0000bb90: 272c 2763 7031 3235 3227 2c27 6c61 7469  ','cp1252','lati
-0000bba0: 6e31 275d 0d0a 2020 2020 2020 2020 2727  n1']..        ''
-0000bbb0: 270d 0a20 2020 2020 2020 2069 6620 6973  '..        if is
-0000bbc0: 696e 7374 616e 6365 2869 7465 6d2c 7374  instance(item,st
-0000bbd0: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
-0000bbe0: 2073 656c 662e 5f65 6e63 6f64 696e 675f   self._encoding_
-0000bbf0: 6c69 7374 203d 205b 6974 656d 5d0d 0a20  list = [item].. 
-0000bc00: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0000bc10: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000bc20: 656e 636f 6469 6e67 5f6c 6973 7420 3d20  encoding_list = 
-0000bc30: 6c69 7374 2869 7465 6d29 0d0a 0d0a 2020  list(item)....  
-0000bc40: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000bc50: 660d 0a0d 0a20 2020 2023 5365 7420 7468  f....    #Set th
-0000bc60: 6573 6520 6173 2070 726f 7065 7274 6965  ese as propertie
-0000bc70: 7320 666f 7220 6465 6275 6767 696e 6720  s for debugging 
-0000bc80: 2d20 7768 656e 2061 6c6c 2069 7320 776f  - when all is wo
-0000bc90: 726b 696e 6720 6d61 6b65 2074 6865 6d20  rking make them 
-0000bca0: 6e6f 726d 616c 2061 7474 7269 6275 7465  normal attribute
-0000bcb0: 7320 6167 6169 6e0d 0a20 2020 2040 7072  s again..    @pr
-0000bcc0: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-0000bcd0: 5f73 7472 7563 7475 7265 735f 7265 6164  _structures_read
-0000bce0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0000bcf0: 2023 6c6f 672e 7761 726e 696e 6728 275f   #log.warning('_
-0000bd00: 7374 7275 6374 7572 6573 5f72 6561 6420  structures_read 
-0000bd10: 7265 7475 726e 696e 6720 7b7d 2066 6f72  returning {} for
-0000bd20: 207b 7d27 2e66 6f72 6d61 7428 7365 6c66   {}'.format(self
-0000bd30: 2e5f 5f73 7472 7563 7475 7265 735f 7265  .__structures_re
-0000bd40: 6164 2c69 6428 7365 6c66 2929 290d 0a20  ad,id(self))).. 
-0000bd50: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000bd60: 6c66 2e5f 5f73 7472 7563 7475 7265 735f  lf.__structures_
-0000bd70: 7265 6164 0d0a 0d0a 2020 2020 405f 7374  read....    @_st
-0000bd80: 7275 6374 7572 6573 5f72 6561 642e 7365  ructures_read.se
-0000bd90: 7474 6572 0d0a 2020 2020 6465 6620 5f73  tter..    def _s
-0000bda0: 7472 7563 7475 7265 735f 7265 6164 2873  tructures_read(s
-0000bdb0: 656c 662c 7661 6c29 3a0d 0a20 2020 2020  elf,val):..     
-0000bdc0: 2020 2023 6c6f 672e 7761 726e 696e 6728     #log.warning(
-0000bdd0: 275f 7374 7275 6374 7572 6573 5f72 6561  '_structures_rea
-0000bde0: 6420 7365 7420 746f 207b 7d20 666f 7220  d set to {} for 
-0000bdf0: 7b7d 272e 666f 726d 6174 2876 616c 2c69  {}'.format(val,i
-0000be00: 6428 7365 6c66 2929 290d 0a20 2020 2020  d(self)))..     
-0000be10: 2020 2073 656c 662e 5f5f 7374 7275 6374     self.__struct
-0000be20: 7572 6573 5f72 6561 6420 3d20 7661 6c0d  ures_read = val.
-0000be30: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-0000be40: 0d0a 2020 2020 6465 6620 5f73 7472 7563  ..    def _struc
-0000be50: 7475 7265 735f 7379 6e63 6564 2873 656c  tures_synced(sel
-0000be60: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-0000be70: 7572 6e20 7365 6c66 2e5f 5f73 7472 7563  urn self.__struc
-0000be80: 7475 7265 735f 7379 6e63 6564 0d0a 0d0a  tures_synced....
-0000be90: 2020 2020 405f 7374 7275 6374 7572 6573      @_structures
-0000bea0: 5f73 796e 6365 642e 7365 7474 6572 0d0a  _synced.setter..
-0000beb0: 2020 2020 6465 6620 5f73 7472 7563 7475      def _structu
-0000bec0: 7265 735f 7379 6e63 6564 2873 656c 662c  res_synced(self,
-0000bed0: 7661 6c29 3a0d 0a20 2020 2020 2020 2023  val):..        #
-0000bee0: 6c6f 672e 7761 726e 696e 6728 275f 7374  log.warning('_st
-0000bef0: 7275 6374 7572 6573 5f73 796e 6365 6420  ructures_synced 
-0000bf00: 7365 7420 746f 207b 7d27 2e66 6f72 6d61  set to {}'.forma
-0000bf10: 7428 7661 6c29 290d 0a20 2020 2020 2020  t(val))..       
-0000bf20: 2073 656c 662e 5f5f 7374 7275 6374 7572   self.__structur
-0000bf30: 6573 5f73 796e 6365 6420 3d20 7661 6c0d  es_synced = val.
-0000bf40: 0a0d 0a20 2020 2023 556e 6c69 6b65 2061  ...    #Unlike a
-0000bf50: 2073 7461 6e64 6172 6420 6469 6374 696f   standard dictio
-0000bf60: 6e61 7279 2077 6869 6368 2072 6574 7572  nary which retur
-0000bf70: 6e73 206b 6579 7320 696e 2069 7465 722c  ns keys in iter,
-0000bf80: 2072 6574 7572 6e20 7661 6c75 6573 2028   return values (
-0000bf90: 7369 6e63 6520 7468 6174 2773 2077 6861  since that's wha
-0000bfa0: 7420 7765 2075 7375 616c 6c79 2077 616e  t we usually wan
-0000bfb0: 7429 0d0a 2020 2020 6465 6620 5f5f 6974  t)..    def __it
-0000bfc0: 6572 5f5f 2873 656c 6629 3a0d 0a20 2020  er__(self):..   
-0000bfd0: 2020 2020 2073 656c 662e 5f69 7465 7261       self._itera
-0000bfe0: 746f 7220 3d20 6974 6572 2873 656c 662e  tor = iter(self.
-0000bff0: 7661 6c75 6573 2829 290d 0a20 2020 2020  values())..     
-0000c000: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
-0000c010: 0d0a 2020 2020 6465 6620 5f5f 6e65 7874  ..    def __next
-0000c020: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
-0000c030: 2020 2072 6574 7572 6e20 6e65 7874 2873     return next(s
-0000c040: 656c 662e 5f69 7465 7261 746f 7229 0d0a  elf._iterator)..
-0000c050: 0d0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
-0000c060: 7465 6d5f 5f28 7365 6c66 2c69 7465 6d29  tem__(self,item)
-0000c070: 3a0d 0a20 2020 2020 2020 2023 4c6f 6164  :..        #Load
-0000c080: 2074 6865 2053 7472 7563 7475 7265 7320   the Structures 
-0000c090: 6966 2077 6520 6861 7665 6e27 7420 616c  if we haven't al
-0000c0a0: 7265 6164 790d 0a20 2020 2020 2020 2074  ready..        t
-0000c0b0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-0000c0c0: 2069 6620 6e6f 7420 7365 6c66 2e5f 7374   if not self._st
-0000c0d0: 7275 6374 7572 6573 5f72 6561 643a 0d0a  ructures_read:..
-0000c0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c0f0: 7365 6c66 2e5f 6c6f 6164 5f73 7472 7563  self._load_struc
-0000c100: 7475 7265 7328 290d 0a20 2020 2020 2020  tures()..       
-0000c110: 2065 7863 6570 7420 6d70 6578 2e45 6d70   except mpex.Emp
-0000c120: 6f77 6572 496d 706f 7274 6572 5665 7273  owerImporterVers
-0000c130: 696f 6e45 7272 6f72 2061 7320 653a 0d0a  ionError as e:..
-0000c140: 2020 2020 2020 2020 2020 2020 2349 6620              #If 
-0000c150: 7468 6572 6520 6973 2061 6e20 496d 706f  there is an Impo
-0000c160: 7274 6572 2056 6572 7369 6f6e 2045 7272  rter Version Err
-0000c170: 6f72 2c20 6a75 7374 206c 6f61 6420 7468  or, just load th
-0000c180: 6520 7061 7274 6963 756c 6172 2073 7472  e particular str
-0000c190: 7563 7475 7265 0d0a 2020 2020 2020 2020  ucture..        
-0000c1a0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-0000c1b0: 2020 2020 2020 2020 2020 7320 3d20 7365            s = se
-0000c1c0: 6c66 2e5f 7374 7275 6374 7572 6573 5b69  lf._structures[i
-0000c1d0: 7465 6d5d 0d0a 2020 2020 2020 2020 2020  tem]..          
-0000c1e0: 2020 2020 2020 6966 206e 6f74 2073 2e5f        if not s._
-0000c1f0: 6869 6572 6172 6368 6965 735f 7265 6164  hierarchies_read
-0000c200: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000c210: 2020 2020 2020 2023 6c6f 672e 696e 666f         #log.info
-0000c220: 2827 5f6c 6f61 645f 7374 7275 6374 7572  ('_load_structur
-0000c230: 6520 3436 3527 290d 0a20 2020 2020 2020  e 465')..       
-0000c240: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0000c250: 662e 5f6c 6f61 645f 7374 7275 6374 7572  f._load_structur
-0000c260: 6528 6974 656d 2c6f 6c64 5f73 7472 7563  e(item,old_struc
-0000c270: 7475 7265 203d 2073 656c 662e 5f73 7472  ture = self._str
-0000c280: 7563 7475 7265 732c 656e 636f 6469 6e67  uctures,encoding
-0000c290: 5f6c 6973 743d 7365 6c66 2e5f 656e 636f  _list=self._enco
-0000c2a0: 6469 6e67 5f6c 6973 7429 0d0a 2020 2020  ding_list)..    
-0000c2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c2c0: 7365 6c66 2e5f 7374 7275 6374 7572 6573  self._structures
-0000c2d0: 5b69 7465 6d5d 2e64 696d 656e 7369 6f6e  [item].dimension
-0000c2e0: 3d73 656c 662e 6469 6d65 6e73 696f 6e0d  =self.dimension.
-0000c2f0: 0a0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
-0000c300: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
-0000c310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c320: 2073 656c 662e 5f6c 6f61 645f 7374 7275   self._load_stru
-0000c330: 6374 7572 6528 6974 656d 2c65 6e63 6f64  cture(item,encod
-0000c340: 696e 675f 6c69 7374 3d73 656c 662e 5f65  ing_list=self._e
-0000c350: 6e63 6f64 696e 675f 6c69 7374 290d 0a20  ncoding_list).. 
-0000c360: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000c370: 6c6f 672e 696e 666f 2827 5f6c 6f61 645f  log.info('_load_
-0000c380: 7374 7275 6374 7572 6520 3437 3127 290d  structure 471').
-0000c390: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c3a0: 2073 656c 662e 5f73 7472 7563 7475 7265   self._structure
-0000c3b0: 735b 6974 656d 5d2e 6469 6d65 6e73 696f  s[item].dimensio
-0000c3c0: 6e3d 7365 6c66 2e64 696d 656e 7369 6f6e  n=self.dimension
-0000c3d0: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-0000c3e0: 726e 2073 656c 662e 5f73 7472 7563 7475  rn self._structu
-0000c3f0: 7265 735b 6974 656d 5d0d 0a0d 0a20 2020  res[item]....   
-0000c400: 2064 6566 205f 5f73 6574 6974 656d 5f5f   def __setitem__
-0000c410: 2873 656c 662c 6b65 792c 6974 656d 293a  (self,key,item):
-0000c420: 0d0a 0d0a 2020 2020 2020 2020 2354 4f44  ....        #TOD
-0000c430: 4f20 2d20 616c 6c6f 7720 7468 6520 6164  O - allow the ad
-0000c440: 6469 6e67 206f 6620 7374 7269 6e67 732c  ding of strings,
-0000c450: 2062 7920 6372 6561 7469 6e67 2061 206e   by creating a n
-0000c460: 6577 2073 7472 7563 7475 7265 0d0a 2020  ew structure..  
-0000c470: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
-0000c480: 6e73 7461 6e63 6528 6974 656d 2c53 7472  nstance(item,Str
-0000c490: 7563 7475 7265 290d 0a20 2020 2020 2020  ucture)..       
-0000c4a0: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
-0000c4b0: 6365 286b 6579 2c73 7472 290d 0a0d 0a20  ce(key,str).... 
-0000c4c0: 2020 2020 2020 2069 6620 6974 656d 2e64         if item.d
-0000c4d0: 696d 656e 7369 6f6e 2021 3d20 7365 6c66  imension != self
-0000c4e0: 2e64 696d 656e 7369 6f6e 3a0d 0a20 2020  .dimension:..   
-0000c4f0: 2020 2020 2020 2020 2069 7465 6d2e 6469           item.di
-0000c500: 6d65 6e73 696f 6e20 3d20 7365 6c66 2e64  mension = self.d
-0000c510: 696d 656e 7369 6f6e 0d0a 0d0a 2020 2020  imension....    
-0000c520: 2020 2020 2349 6620 7468 6520 6974 656d      #If the item
-0000c530: 2069 7320 616c 7265 6164 7920 696e 2074   is already in t
-0000c540: 6865 2064 6963 7469 6f6e 6172 792c 2073  he dictionary, s
-0000c550: 7761 7020 6974 206f 7574 2066 6f72 2074  wap it out for t
-0000c560: 6865 206e 6577 206f 6e65 0d0a 2020 2020  he new one..    
-0000c570: 2020 2020 236f 7468 6572 7769 7365 2061      #otherwise a
-0000c580: 6464 2069 7420 6f6e 2074 6865 2065 6e64  dd it on the end
-0000c590: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0000c5a0: 7374 7275 6374 7572 6573 5b6b 6579 5d20  structures[key] 
-0000c5b0: 3d20 6974 656d 0d0a 2020 2020 2020 2020  = item..        
-0000c5c0: 2357 6520 6172 6520 636c 6561 726c 7920  #We are clearly 
-0000c5d0: 6e6f 206c 6f6e 6765 7220 7379 6e63 6872  no longer synchr
-0000c5e0: 6f6e 6973 6564 2077 6974 6820 656d 706f  onised with empo
-0000c5f0: 7765 720d 0a20 2020 2020 2020 2073 656c  wer..        sel
-0000c600: 662e 5f5f 7374 7275 6374 7572 6573 5f73  f.__structures_s
-0000c610: 796e 6365 6420 3d20 4661 6c73 650d 0a0d  ynced = False...
-0000c620: 0a20 2020 2023 4465 6669 6e65 2077 6861  .    #Define wha
-0000c630: 7420 6861 7070 656e 7320 7768 656e 2077  t happens when w
-0000c640: 6520 6361 6c6c 202b 3d0d 0a20 2020 2023  e call +=..    #
-0000c650: 5765 2077 616e 7420 746f 2061 7070 656e  We want to appen
-0000c660: 640d 0a20 2020 2064 6566 205f 5f69 6164  d..    def __iad
-0000c670: 645f 5f28 7365 6c66 2c6f 7468 6572 293a  d__(self,other):
-0000c680: 0d0a 2020 2020 2020 2020 6173 7365 7274  ..        assert
-0000c690: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-0000c6a0: 722c 5374 7275 6374 7572 6529 0d0a 2020  r,Structure)..  
-0000c6b0: 2020 2020 2020 2361 6464 2074 6865 206e        #add the n
-0000c6c0: 6577 2073 7472 7563 7475 7265 2069 6e74  ew structure int
-0000c6d0: 6f20 7468 6520 6469 6374 696f 6e61 7279  o the dictionary
-0000c6e0: 2075 7369 6e67 205f 5f73 6574 6974 656d   using __setitem
-0000c6f0: 5f5f 0d0a 2020 2020 2020 2020 7365 6c66  __..        self
-0000c700: 5b6f 7468 6572 2e73 686f 7274 6e61 6d65  [other.shortname
-0000c710: 5d20 3d20 6f74 6865 720d 0a20 2020 2020  ] = other..     
-0000c720: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
-0000c730: 0d0a 2020 2020 2344 6566 696e 6520 7768  ..    #Define wh
-0000c740: 6174 2068 6170 7065 6e73 2077 6865 6e20  at happens when 
-0000c750: 7765 2063 616c 6c20 7c3d 0d0a 2020 2020  we call |=..    
-0000c760: 2357 6520 7761 6e74 2074 6f20 6170 7065  #We want to appe
-0000c770: 6e64 2069 6620 6974 2069 7320 6e6f 7420  nd if it is not 
-0000c780: 7468 6572 6520 616c 7265 6164 790d 0a20  there already.. 
-0000c790: 2020 2064 6566 205f 5f69 6f72 5f5f 2873     def __ior__(s
-0000c7a0: 656c 662c 6f74 6865 7229 3a0d 0a20 2020  elf,other):..   
-0000c7b0: 2020 2020 2061 7373 6572 7420 6973 696e       assert isin
-0000c7c0: 7374 616e 6365 286f 7468 6572 2c53 7472  stance(other,Str
-0000c7d0: 7563 7475 7265 290d 0a20 2020 2020 2020  ucture)..       
-0000c7e0: 2023 6164 6420 7468 6520 6e65 7720 7374   #add the new st
-0000c7f0: 7275 6374 7572 6520 696e 746f 2074 6865  ructure into the
-0000c800: 2064 6963 7469 6f6e 6172 7920 7573 696e   dictionary usin
-0000c810: 6720 5f5f 7365 7469 7465 6d5f 5f0d 0a20  g __setitem__.. 
-0000c820: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-0000c830: 2020 2020 2020 2020 2073 656c 665b 6f74           self[ot
-0000c840: 6865 722e 7368 6f72 746e 616d 655d 0d0a  her.shortname]..
-0000c850: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-0000c860: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
-0000c870: 2020 2020 2020 7365 6c66 5b6f 7468 6572        self[other
-0000c880: 2e73 686f 7274 6e61 6d65 5d20 3d20 6f74  .shortname] = ot
-0000c890: 6865 720d 0a20 2020 2020 2020 2072 6574  her..        ret
-0000c8a0: 7572 6e20 7365 6c66 0d0a 0d0a 2020 2020  urn self....    
-0000c8b0: 6465 6620 5f6c 6f61 645f 7374 7275 6374  def _load_struct
-0000c8c0: 7572 6528 7365 6c66 2c69 7465 6d2c 6f6c  ure(self,item,ol
-0000c8d0: 645f 7374 7275 6374 7572 6520 3d20 4e6f  d_structure = No
-0000c8e0: 6e65 2c65 6e63 6f64 696e 675f 6c69 7374  ne,encoding_list
-0000c8f0: 3d4e 6f6e 6529 3a0d 0a20 2020 2020 2020  =None):..       
-0000c900: 2023 6c6f 672e 696e 666f 2827 5265 6164   #log.info('Read
-0000c910: 696e 6720 5374 7275 6374 7572 6520 272b  ing Structure '+
-0000c920: 7374 7228 6974 656d 292b 2720 666f 7220  str(item)+' for 
-0000c930: 6469 6d65 6e73 696f 6e20 272b 7374 7228  dimension '+str(
-0000c940: 7365 6c66 2e64 696d 656e 7369 6f6e 2e69  self.dimension.i
-0000c950: 6e64 6578 2929 0d0a 2020 2020 2020 2020  ndex))..        
-0000c960: 6966 206f 6c64 5f73 7472 7563 7475 7265  if old_structure
-0000c970: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-0000c980: 2020 2020 2020 2020 2020 206f 6c64 5f73             old_s
-0000c990: 7472 7563 7475 7265 2e5f 6869 6572 6172  tructure._hierar
-0000c9a0: 6368 6965 735f 7265 6164 203d 2054 7275  chies_read = Tru
-0000c9b0: 650d 0a0d 0a20 2020 2020 2020 2069 6620  e....        if 
-0000c9c0: 656e 636f 6469 6e67 5f6c 6973 7420 6973  encoding_list is
-0000c9d0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000c9e0: 2020 2020 656e 636f 6469 6e67 5f6c 6973      encoding_lis
-0000c9f0: 7420 3d20 7365 6c66 2e5f 656e 636f 6469  t = self._encodi
-0000ca00: 6e67 5f6c 6973 740d 0a0d 0a20 2020 2020  ng_list....     
-0000ca10: 2020 2066 6f72 206e 2c20 656e 636f 6469     for n, encodi
-0000ca20: 6e67 2069 6e20 656e 756d 6572 6174 6528  ng in enumerate(
-0000ca30: 656e 636f 6469 6e67 5f6c 6973 7429 3a0d  encoding_list):.
-0000ca40: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-0000ca50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0000ca60: 2020 2073 656c 662e 5f73 7472 7563 7475     self._structu
-0000ca70: 7265 735b 6974 656d 5d20 3d20 5f72 6561  res[item] = _rea
-0000ca80: 645f 7374 7275 6374 7572 655f 6672 6f6d  d_structure_from
-0000ca90: 5f73 6974 6528 6469 6d65 6e73 696f 6e20  _site(dimension 
-0000caa0: 2020 2020 3d20 7365 6c66 2e64 696d 656e      = self.dimen
-0000cab0: 7369 6f6e 0d0a 2020 2020 2020 2020 2020  sion..          
-0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000caf0: 2020 2020 2020 2020 2c73 686f 7274 6e61          ,shortna
-0000cb00: 6d65 2020 2020 203d 2069 7465 6d0d 0a20  me     = item.. 
+0000a9a0: 2020 2020 2079 6965 6c64 2027 5c74 270d       yield '\t'.
+0000a9b0: 0a0d 0a0d 0a20 2020 2020 2020 2020 2020  .....           
+0000a9c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000a9d0: 6e65 775f 6669 656c 645b 2744 6573 6372  new_field['Descr
+0000a9e0: 6970 7469 6f6e 275d 2069 7320 6e6f 7420  iption'] is not 
+0000a9f0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0000aa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa10: 2020 2079 6965 6c64 206e 6577 5f66 6965     yield new_fie
+0000aa20: 6c64 5b27 4465 7363 7269 7074 696f 6e27  ld['Description'
+0000aa30: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0000aa40: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+0000aa50: 2027 5c6e 270d 0a0d 0a20 2020 2020 2020   '\n'....       
+0000aa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa70: 206c 6f67 2e69 6e66 6f28 2743 7265 6174   log.info('Creat
+0000aa80: 696e 6720 6e65 7720 4669 656c 6420 6465  ing new Field de
+0000aa90: 6669 6e69 7469 6f6e 3a20 272b 7374 7228  finition: '+str(
+0000aaa0: 6e65 775f 6669 656c 6429 290d 0a0d 0a20  new_field)).... 
+0000aab0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0000aac0: 6f6d 6d61 6e64 5f6c 6973 7420 3d20 7365  ommand_list = se
+0000aad0: 6c66 2e73 6974 652e 5f6c 6f67 6f6e 5f70  lf.site._logon_p
+0000aae0: 6172 616d 6574 6572 5f69 6d70 6f72 7465  arameter_importe
+0000aaf0: 725f 636f 6d6d 616e 6473 202b 205c 0d0a  r_commands + \..
+0000ab00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab10: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0000ab20: 276c 6f61 642d 6669 6c65 2d74 7376 2022  'load-file-tsv "
+0000ab30: 2720 2020 2020 2020 2020 2020 2020 2020  '               
+0000ab40: 2020 2020 2b20 6669 656c 645f 6d65 7461      + field_meta
+0000ab50: 6461 7461 5f66 696c 6570 6174 6820 2b20  data_filepath + 
+0000ab60: 2722 270d 0a20 2020 2020 2020 2020 2020  '"'..           
+0000ab70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab80: 2020 2020 2c27 656d 706f 7765 722d 696d      ,'empower-im
+0000ab90: 706f 7274 2d66 6965 6c64 2d65 6c65 6d65  port-field-eleme
+0000aba0: 6e74 7320 2d68 6173 2d68 6561 6465 7220  nts -has-header 
+0000abb0: 2d75 7073 6572 7420 2224 7b73 6974 657d  -upsert "${site}
+0000abc0: 2220 2224 7b75 7365 727d 2220 2224 7b70  " "${user}" "${p
+0000abd0: 6173 7377 6f72 647d 2227 0d0a 2020 2020  assword}"'..    
+0000abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000abf0: 2020 2020 2020 2020 2020 205d 0d0a 2020             ]..  
+0000ac00: 2020 2020 2020 2020 2020 2020 2020 2353                #S
+0000ac10: 7769 7463 6820 6465 7363 7269 7074 696f  witch descriptio
+0000ac20: 6e20 666f 7220 6120 636f 6e63 6174 656e  n for a concaten
+0000ac30: 6174 6564 206b 6579 202d 2077 6520 7769  ated key - we wi
+0000ac40: 6c6c 2062 6520 6162 6c65 2074 6f20 6772  ll be able to gr
+0000ac50: 6162 2074 6865 2073 686f 7274 6e61 6d65  ab the shortname
+0000ac60: 2061 6e64 206c 696e 6b20 636f 7272 6563   and link correc
+0000ac70: 7420 656c 656d 656e 7473 2069 6e20 6f72  t elements in or
+0000ac80: 6465 7220 746f 2075 7064 6174 6520 6669  der to update fi
+0000ac90: 656c 6473 0d0a 2020 2020 2020 2020 2020  elds..          
+0000aca0: 2020 2020 2020 2349 6e20 6465 6275 6720        #In debug 
+0000acb0: 6d6f 6465 2077 7269 7465 2074 6865 2064  mode write the d
+0000acc0: 6174 6120 696e 746f 2061 2074 7376 2066  ata into a tsv f
+0000acd0: 696c 6520 616e 6420 7265 6164 2069 7420  ile and read it 
+0000ace0: 7769 7468 2049 6d70 6f72 7465 722c 2070  with Importer, p
+0000acf0: 7574 7469 6e67 2074 6865 2065 6c65 6d65  utting the eleme
+0000ad00: 6e74 7320 696e 746f 2045 6d70 6f77 6572  nts into Empower
+0000ad10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000ad20: 2020 6966 2064 6562 7567 3a0d 0a20 2020    if debug:..   
+0000ad30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad40: 2077 6974 6820 6f70 656e 2866 6965 6c64   with open(field
+0000ad50: 5f6d 6574 6164 6174 615f 6669 6c65 7061  _metadata_filepa
+0000ad60: 7468 2c27 7727 2c65 6e63 6f64 696e 673d  th,'w',encoding=
+0000ad70: 2775 7466 3827 2920 6173 206e 6577 5f66  'utf8') as new_f
+0000ad80: 6965 6c64 5f66 696c 653a 0d0a 2020 2020  ield_file:..    
+0000ad90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ada0: 2020 2020 666f 7220 7320 696e 205f 7969      for s in _yi
+0000adb0: 656c 645f 6669 656c 645f 6d65 7461 6461  eld_field_metada
+0000adc0: 7461 5f73 7472 696e 6773 286e 6577 5f66  ta_strings(new_f
+0000add0: 6965 6c64 7329 3a0d 0a20 2020 2020 2020  ields):..       
+0000ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000adf0: 2020 2020 206e 6577 5f66 6965 6c64 5f66       new_field_f
+0000ae00: 696c 652e 7772 6974 6528 7329 0d0a 0d0a  ile.write(s)....
+0000ae10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae20: 2020 2020 6c6c 752e 7275 6e5f 7369 6e67      llu.run_sing
+0000ae30: 6c65 5f6f 7574 7075 745f 696d 706f 7274  le_output_import
+0000ae40: 6572 5f63 6f6d 6d61 6e64 7328 636f 6d6d  er_commands(comm
+0000ae50: 616e 645f 6c69 7374 2c20 656d 706f 7765  and_list, empowe
+0000ae60: 725f 696d 706f 7274 6572 5f65 7865 6375  r_importer_execu
+0000ae70: 7461 626c 653d 7365 6c66 2e73 6974 652e  table=self.site.
+0000ae80: 656d 706f 7765 725f 696d 706f 7274 6572  empower_importer
+0000ae90: 5f65 7865 6375 7461 626c 6529 0d0a 0d0a  _executable)....
+0000aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aeb0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0000aec0: 2020 2020 2020 2020 2020 2023 496e 2027             #In '
+0000aed0: 6e6f 726d 616c 2720 6d6f 6465 2064 6f20  normal' mode do 
+0000aee0: 6120 6d65 7272 7920 6461 6e63 6520 7769  a merry dance wi
+0000aef0: 7468 2057 696e 646f 7773 206e 616d 6564  th Windows named
+0000af00: 2070 6970 6573 2e20 5468 6973 2061 766f   pipes. This avo
+0000af10: 6964 7320 7772 6974 696e 6720 7468 6520  ids writing the 
+0000af20: 6461 7461 2074 6f20 6669 6c65 2066 6f72  data to file for
+0000af30: 2073 6563 7572 6974 7920 616e 6420 7072   security and pr
+0000af40: 6163 7469 6361 6c69 7479 2072 6561 736f  acticality reaso
+0000af50: 6e73 0d0a 2020 2020 2020 2020 2020 2020  ns..            
+0000af60: 2020 2020 2020 2020 2366 6965 6c64 5f6d          #field_m
+0000af70: 6574 6164 6174 615f 6669 6c65 7061 7468  etadata_filepath
+0000af80: 2069 7320 7468 6520 6e61 6d65 206f 6620   is the name of 
+0000af90: 7468 6520 6e61 6d65 6420 7069 7065 2065  the named pipe e
+0000afa0: 2e67 2e20 5c5c 2e5c 7069 7065 5c39 6463  .g. \\.\pipe\9dc
+0000afb0: 6366 6130 382d 3430 6331 2d34 3566 352d  cfa08-40c1-45f5-
+0000afc0: 3865 3065 2d66 3634 6331 3835 3032 6263  8e0e-f64c18502bc
+0000afd0: 640d 0a20 2020 2020 2020 2020 2020 2020  d..             
+0000afe0: 2020 2020 2020 2023 5468 6520 6d65 7272         #The merr
+0000aff0: 7920 6461 6e63 6520 6d65 616e 7320 7374  y dance means st
+0000b000: 6172 7469 6e67 2065 6d70 6f77 6572 2c20  arting empower, 
+0000b010: 7265 6665 7265 6e63 696e 6720 7468 6520  referencing the 
+0000b020: 7069 7065 2c20 6f70 656e 696e 6720 7468  pipe, opening th
+0000b030: 6520 7069 7065 2062 6566 6f72 6520 656d  e pipe before em
+0000b040: 706f 7765 7220 6973 2070 726f 7065 726c  power is properl
+0000b050: 7920 7374 6172 7465 640d 0a20 2020 2020  y started..     
+0000b060: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000b070: 7365 7474 696e 6720 7570 2074 6865 206e  setting up the n
+0000b080: 616d 6564 2070 6970 6520 6f6e 2074 6869  amed pipe on thi
+0000b090: 7320 7468 7265 6164 2c20 616e 6420 7772  s thread, and wr
+0000b0a0: 6974 696e 6720 746f 2069 7420 2861 7320  iting to it (as 
+0000b0b0: 736f 6f6e 2061 7320 496d 706f 7274 6572  soon as Importer
+0000b0c0: 2063 6f6e 6e65 6374 7320 6174 2069 7473   connects at its
+0000b0d0: 2065 6e64 290d 0a20 2020 2020 2020 2020   end)..         
+0000b0e0: 2020 2020 2020 2020 2020 2023 5468 6520             #The 
+0000b0f0: 6469 6666 6963 756c 7479 2c20 6973 2074  difficulty, is t
+0000b100: 6861 7420 7765 2068 6176 6520 746f 2070  hat we have to p
+0000b110: 6173 7320 7468 6520 6e61 6d65 206f 6620  ass the name of 
+0000b120: 7468 6520 7069 7065 2074 6f20 496d 706f  the pipe to Impo
+0000b130: 7274 6572 2c20 616e 6420 7265 6c79 206f  rter, and rely o
+0000b140: 6e20 7468 6520 6661 6374 2074 6861 7420  n the fact that 
+0000b150: 6974 2077 6f6e 2774 2068 6176 6520 7469  it won't have ti
+0000b160: 6d65 2074 6f20 6f70 656e 2069 740d 0a20  me to open it.. 
+0000b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b180: 2020 2023 6265 666f 7265 2077 6520 6861     #before we ha
+0000b190: 7665 2063 7265 6174 6564 2069 742e 2042  ve created it. B
+0000b1a0: 7574 2077 6520 7769 6c6c 2062 6c6f 636b  ut we will block
+0000b1b0: 206f 6e20 6f75 7220 7369 6465 2075 6e74   on our side unt
+0000b1c0: 696c 2049 6d70 6f72 7465 7220 6861 7320  il Importer has 
+0000b1d0: 636f 6e6e 6563 7465 640d 0a20 2020 2020  connected..     
+0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000b1f0: 726f 6320 3d20 4e6f 6e65 0d0a 2020 2020  roc = None..    
+0000b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b210: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0000b220: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0000b230: 6f63 203d 206c 6c75 2e73 7461 7274 5f6e  oc = llu.start_n
+0000b240: 6f5f 6f75 7470 7574 5f69 6d70 6f72 7465  o_output_importe
+0000b250: 725f 636f 6d6d 616e 6473 2863 6f6d 6d61  r_commands(comma
+0000b260: 6e64 5f6c 6973 742c 656d 706f 7765 725f  nd_list,empower_
+0000b270: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
+0000b280: 626c 653d 7365 6c66 2e73 6974 652e 656d  ble=self.site.em
+0000b290: 706f 7765 725f 696d 706f 7274 6572 5f65  power_importer_e
+0000b2a0: 7865 6375 7461 626c 6529 0d0a 2020 2020  xecutable)..    
+0000b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b2c0: 2020 2020 7769 7468 206c 6c75 2e6f 7574      with llu.out
+0000b2d0: 626f 756e 645f 7069 7065 2866 6965 6c64  bound_pipe(field
+0000b2e0: 5f6d 6574 6164 6174 615f 6669 6c65 7061  _metadata_filepa
+0000b2f0: 7468 2920 6173 2070 6970 653a 0d0a 2020  th) as pipe:..  
+0000b300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b310: 2020 2020 2020 2020 2020 2323 2046 726f            ## Fro
+0000b320: 6d20 392e 3820 6f6e 7761 7264 7320 7772  m 9.8 onwards wr
+0000b330: 6974 6520 7468 6520 5769 6e64 6f77 7320  ite the Windows 
+0000b340: 4279 7465 204f 7264 6572 204d 6172 6b65  Byte Order Marke
+0000b350: 7220 2842 4f4d 290d 0a20 2020 2020 2020  r (BOM)..       
+0000b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b370: 2020 2020 2023 6966 2028 286d 616a 6f72       #if ((major
+0000b380: 5f76 6572 7369 6f6e 203d 3d20 3920 616e  _version == 9 an
+0000b390: 6420 6d69 6e6f 725f 7665 7273 696f 6e20  d minor_version 
+0000b3a0: 3e3d 3829 206f 7220 6d61 6a6f 725f 7665  >=8) or major_ve
+0000b3b0: 7273 696f 6e20 3e20 3929 3a0d 0a20 2020  rsion > 9):..   
+0000b3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3d0: 2020 2020 2020 2020 2023 2020 2020 7769           #    wi
+0000b3e0: 6e33 3266 696c 652e 5772 6974 6546 696c  n32file.WriteFil
+0000b3f0: 6528 7069 7065 2c20 2222 2e65 6e63 6f64  e(pipe, "".encod
+0000b400: 6528 2275 7466 2d38 2d73 6967 2229 290d  e("utf-8-sig")).
+0000b410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b420: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000b430: 6e74 2827 6e65 775f 6669 656c 6473 272c  nt('new_fields',
+0000b440: 6e65 775f 6669 656c 6473 290d 0a20 2020  new_fields)..   
+0000b450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b460: 2020 2020 2020 2020 2066 6f72 2073 2069           for s i
+0000b470: 6e20 5f79 6965 6c64 5f66 6965 6c64 5f6d  n _yield_field_m
+0000b480: 6574 6164 6174 615f 7374 7269 6e67 7328  etadata_strings(
+0000b490: 6e65 775f 6669 656c 6473 293a 0d0a 2020  new_fields):..  
+0000b4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b4b0: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+0000b4c0: 6e33 3266 696c 652e 5772 6974 6546 696c  n32file.WriteFil
+0000b4d0: 6528 7069 7065 2c20 732e 656e 636f 6465  e(pipe, s.encode
+0000b4e0: 2829 290d 0a0d 0a20 2020 2020 2020 2020  ())....         
+0000b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b500: 2020 206c 6f67 2e64 6562 7567 2822 5069     log.debug("Pi
+0000b510: 7065 207b 7d20 6669 6e69 7368 6564 2077  pe {} finished w
+0000b520: 7269 7469 6e67 222e 666f 726d 6174 2866  riting".format(f
+0000b530: 6965 6c64 5f6d 6574 6164 6174 615f 6669  ield_metadata_fi
+0000b540: 6c65 7061 7468 2929 0d0a 0d0a 2020 2020  lepath))....    
+0000b550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b560: 6669 6e61 6c6c 793a 0d0a 0d0a 2020 2020  finally:....    
+0000b570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b580: 2020 2020 2343 6865 636b 2069 6620 496d      #Check if Im
+0000b590: 706f 7274 6572 2072 6574 7572 6e65 6420  porter returned 
+0000b5a0: 616e 2065 7272 6f72 2061 6e64 2072 6169  an error and rai
+0000b5b0: 7365 2069 7420 6173 2061 2070 7974 686f  se it as a pytho
+0000b5c0: 6e20 6572 726f 7220 6966 2069 7420 6469  n error if it di
+0000b5d0: 640d 0a20 2020 2020 2020 2020 2020 2020  d..             
+0000b5e0: 2020 2020 2020 2020 2020 206c 6c75 2e63             llu.c
+0000b5f0: 6f6d 706c 6574 655f 6e6f 5f6f 7574 7075  omplete_no_outpu
+0000b600: 745f 696d 706f 7274 6572 5f70 726f 6365  t_importer_proce
+0000b610: 7373 2870 726f 6329 0d0a 0d0a 2020 2020  ss(proc)....    
+0000b620: 2020 2020 2020 2020 2020 2020 6c6f 672e              log.
+0000b630: 696e 666f 2827 4e65 7720 6669 656c 6473  info('New fields
+0000b640: 2063 7265 6174 6564 2069 6e20 456d 706f   created in Empo
+0000b650: 7765 7220 7369 7465 2027 2b73 656c 662e  wer site '+self.
+0000b660: 7369 7465 2e5f 7369 7465 5f6c 6f63 6174  site._site_locat
+0000b670: 6f72 290d 0a20 2020 2020 2020 2020 2020  or)..           
+0000b680: 2020 2020 2066 6f72 2064 696d 5f69 6e64       for dim_ind
+0000b690: 6578 2c20 6669 656c 645f 7368 6f72 746e  ex, field_shortn
+0000b6a0: 616d 6573 2069 6e20 6e65 775f 6669 656c  ames in new_fiel
+0000b6b0: 6473 5f62 795f 696e 6465 782e 6974 656d  ds_by_index.item
+0000b6c0: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
+0000b6d0: 2020 2020 2020 2020 2020 666f 7220 736e            for sn
+0000b6e0: 2069 6e20 6669 656c 645f 7368 6f72 746e   in field_shortn
+0000b6f0: 616d 6573 3a0d 0a20 2020 2020 2020 2020  ames:..         
+0000b700: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000b710: 6620 736e 2069 7320 6e6f 7420 4e6f 6e65  f sn is not None
+0000b720: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000b730: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b740: 656c 662e 7369 7465 2e64 696d 656e 7369  elf.site.dimensi
+0000b750: 6f6e 735b 6469 6d5f 696e 6465 785d 2e66  ons[dim_index].f
+0000b760: 6965 6c64 732e 5f61 6464 5f66 6965 6c64  ields._add_field
+0000b770: 5f6e 616d 6528 736e 290d 0a20 2020 2020  _name(sn)..     
+0000b780: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0000b790: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000b7a0: 6973 6520 6d70 6578 2e45 6d70 6f77 6572  ise mpex.Empower
+0000b7b0: 496d 706f 7274 6572 5665 7273 696f 6e45  ImporterVersionE
+0000b7c0: 7272 6f72 2827 596f 7520 6d75 7374 2075  rror('You must u
+0000b7d0: 7067 7261 6465 2074 6f20 456d 706f 7765  pgrade to Empowe
+0000b7e0: 7220 496d 706f 7274 6572 2039 2e35 2e31  r Importer 9.5.1
+0000b7f0: 382e 3139 3433 206f 7220 6265 796f 6e64  8.1943 or beyond
+0000b800: 2061 6e64 2075 7365 2065 6e63 7279 7074   and use encrypt
+0000b810: 6564 2070 6173 7377 6f72 6473 2069 6e20  ed passwords in 
+0000b820: 6f72 6465 7220 746f 2063 7265 6174 6520  order to create 
+0000b830: 6e65 7720 6669 656c 6473 2069 6e20 456d  new fields in Em
+0000b840: 706f 7765 7227 290d 0a0d 0a20 2020 2023  power')....    #
+0000b850: 746f 646f 0d0a 2020 2020 2374 6f2f 6672  todo..    #to/fr
+0000b860: 6f6d 204a 534f 4e0d 0a20 2020 2023 746f  om JSON..    #to
+0000b870: 2f66 726f 6d20 5941 4d4c 0d0a 0d0a 636c  /from YAML....cl
+0000b880: 6173 7320 5f53 7472 7563 7475 7265 4765  ass _StructureGe
+0000b890: 7474 6572 286f 626a 6563 7429 3a0d 0a20  tter(object):.. 
+0000b8a0: 2020 2027 2727 446f 6573 2061 2062 6974     '''Does a bit
+0000b8b0: 206f 6620 6d61 6769 6320 746f 2061 6c6c   of magic to all
+0000b8c0: 6f77 2044 696d 656e 7369 6f6e 7320 746f  ow Dimensions to
+0000b8d0: 2068 6176 6520 6120 7374 7275 6374 7572   have a structur
+0000b8e0: 6573 206f 626a 6563 7420 7768 6963 6820  es object which 
+0000b8f0: 6265 6861 7665 7320 6c69 6b65 2061 206c  behaves like a l
+0000b900: 617a 7920 6c6f 6164 696e 6720 6469 6374  azy loading dict
+0000b910: 696f 6e61 7279 2727 270d 0a20 2020 2064  ionary'''..    d
+0000b920: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+0000b930: 2c64 696d 656e 7369 6f6e 2c20 656d 706f  ,dimension, empo
+0000b940: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
+0000b950: 6375 7461 626c 653d 6c6c 752e 454d 504f  cutable=llu.EMPO
+0000b960: 5745 525f 494d 504f 5254 4552 5f45 5845  WER_IMPORTER_EXE
+0000b970: 4355 5441 424c 4529 3a0d 0a20 2020 2020  CUTABLE):..     
+0000b980: 2020 2073 656c 662e 6469 6d65 6e73 696f     self.dimensio
+0000b990: 6e3d 6469 6d65 6e73 696f 6e0d 0a20 2020  n=dimension..   
+0000b9a0: 2020 2020 2073 656c 662e 656d 706f 7765       self.empowe
+0000b9b0: 725f 696d 706f 7274 6572 5f65 7865 6375  r_importer_execu
+0000b9c0: 7461 626c 6520 3d20 656d 706f 7765 725f  table = empower_
+0000b9d0: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
+0000b9e0: 626c 650d 0a20 2020 2020 2020 2073 656c  ble..        sel
+0000b9f0: 662e 5f73 7472 7563 7475 7265 733d 7b7d  f._structures={}
+0000ba00: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0000ba10: 2e5f 5f73 7472 7563 7475 7265 735f 7265  .__structures_re
+0000ba20: 6164 2020 203d 2046 616c 7365 0d0a 2020  ad   = False..  
+0000ba30: 2020 2020 2020 7365 6c66 2e5f 5f73 7472        self.__str
+0000ba40: 7563 7475 7265 735f 7379 6e63 6564 203d  uctures_synced =
+0000ba50: 2054 7275 650d 0a0d 0a20 2020 2020 2020   True....       
+0000ba60: 2073 656c 662e 5f65 6e63 6f64 696e 675f   self._encoding_
+0000ba70: 6c69 7374 203d 205b 2775 7466 3827 2c27  list = ['utf8','
+0000ba80: 6370 3132 3532 272c 276c 6174 696e 3127  cp1252','latin1'
+0000ba90: 5d0d 0a0d 0a20 2020 2064 6566 2073 6574  ]....    def set
+0000baa0: 5f70 7265 6665 7272 6564 5f65 6e63 6f64  _preferred_encod
+0000bab0: 696e 675f 6c69 7374 2873 656c 662c 6974  ing_list(self,it
+0000bac0: 656d 293a 0d0a 2020 2020 2020 2020 2727  em):..        ''
+0000bad0: 2753 6574 2061 206c 6973 7420 6f66 2065  'Set a list of e
+0000bae0: 6e63 6f64 696e 6773 2074 6861 7420 7769  ncodings that wi
+0000baf0: 6c6c 2062 6520 7472 6965 6420 7768 656e  ll be tried when
+0000bb00: 2072 6561 6469 6e67 2061 2073 7472 7563   reading a struc
+0000bb10: 7475 7265 2066 726f 6d20 456d 706f 7765  ture from Empowe
+0000bb20: 722e 2054 6865 2065 6e63 6f64 696e 6773  r. The encodings
+0000bb30: 2077 696c 6c20 6265 2074 7269 6564 2069   will be tried i
+0000bb40: 6e20 7468 6520 6f72 6465 7220 7072 6573  n the order pres
+0000bb50: 656e 7465 6420 696e 2074 6865 206c 6973  ented in the lis
+0000bb60: 740d 0a0d 0a20 2020 2020 2020 203a 7061  t....        :pa
+0000bb70: 7261 6d20 6974 656d 3a20 4120 6c69 7374  ram item: A list
+0000bb80: 206f 6620 656e 636f 6469 6e67 7320 7468   of encodings th
+0000bb90: 6174 2077 696c 6c20 6265 2074 7269 6564  at will be tried
+0000bba0: 2e20 5468 6520 6465 6661 756c 7420 6c69  . The default li
+0000bbb0: 7374 2069 7320 5b27 7574 6638 272c 2763  st is ['utf8','c
+0000bbc0: 7031 3235 3227 2c27 6c61 7469 6e31 275d  p1252','latin1']
+0000bbd0: 0d0a 2020 2020 2020 2020 2727 270d 0a20  ..        '''.. 
+0000bbe0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+0000bbf0: 616e 6365 2869 7465 6d2c 7374 7229 3a0d  ance(item,str):.
+0000bc00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000bc10: 662e 5f65 6e63 6f64 696e 675f 6c69 7374  f._encoding_list
+0000bc20: 203d 205b 6974 656d 5d0d 0a20 2020 2020   = [item]..     
+0000bc30: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0000bc40: 2020 2020 2020 7365 6c66 2e5f 656e 636f        self._enco
+0000bc50: 6469 6e67 5f6c 6973 7420 3d20 6c69 7374  ding_list = list
+0000bc60: 2869 7465 6d29 0d0a 0d0a 2020 2020 2020  (item)....      
+0000bc70: 2020 7265 7475 726e 2073 656c 660d 0a0d    return self...
+0000bc80: 0a20 2020 2023 5365 7420 7468 6573 6520  .    #Set these 
+0000bc90: 6173 2070 726f 7065 7274 6965 7320 666f  as properties fo
+0000bca0: 7220 6465 6275 6767 696e 6720 2d20 7768  r debugging - wh
+0000bcb0: 656e 2061 6c6c 2069 7320 776f 726b 696e  en all is workin
+0000bcc0: 6720 6d61 6b65 2074 6865 6d20 6e6f 726d  g make them norm
+0000bcd0: 616c 2061 7474 7269 6275 7465 7320 6167  al attributes ag
+0000bce0: 6169 6e0d 0a20 2020 2040 7072 6f70 6572  ain..    @proper
+0000bcf0: 7479 0d0a 2020 2020 6465 6620 5f73 7472  ty..    def _str
+0000bd00: 7563 7475 7265 735f 7265 6164 2873 656c  uctures_read(sel
+0000bd10: 6629 3a0d 0a20 2020 2020 2020 2023 6c6f  f):..        #lo
+0000bd20: 672e 7761 726e 696e 6728 275f 7374 7275  g.warning('_stru
+0000bd30: 6374 7572 6573 5f72 6561 6420 7265 7475  ctures_read retu
+0000bd40: 726e 696e 6720 7b7d 2066 6f72 207b 7d27  rning {} for {}'
+0000bd50: 2e66 6f72 6d61 7428 7365 6c66 2e5f 5f73  .format(self.__s
+0000bd60: 7472 7563 7475 7265 735f 7265 6164 2c69  tructures_read,i
+0000bd70: 6428 7365 6c66 2929 290d 0a20 2020 2020  d(self)))..     
+0000bd80: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000bd90: 5f73 7472 7563 7475 7265 735f 7265 6164  _structures_read
+0000bda0: 0d0a 0d0a 2020 2020 405f 7374 7275 6374  ....    @_struct
+0000bdb0: 7572 6573 5f72 6561 642e 7365 7474 6572  ures_read.setter
+0000bdc0: 0d0a 2020 2020 6465 6620 5f73 7472 7563  ..    def _struc
+0000bdd0: 7475 7265 735f 7265 6164 2873 656c 662c  tures_read(self,
+0000bde0: 7661 6c29 3a0d 0a20 2020 2020 2020 2023  val):..        #
+0000bdf0: 6c6f 672e 7761 726e 696e 6728 275f 7374  log.warning('_st
+0000be00: 7275 6374 7572 6573 5f72 6561 6420 7365  ructures_read se
+0000be10: 7420 746f 207b 7d20 666f 7220 7b7d 272e  t to {} for {}'.
+0000be20: 666f 726d 6174 2876 616c 2c69 6428 7365  format(val,id(se
+0000be30: 6c66 2929 290d 0a20 2020 2020 2020 2073  lf)))..        s
+0000be40: 656c 662e 5f5f 7374 7275 6374 7572 6573  elf.__structures
+0000be50: 5f72 6561 6420 3d20 7661 6c0d 0a0d 0a20  _read = val.... 
+0000be60: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+0000be70: 2020 6465 6620 5f73 7472 7563 7475 7265    def _structure
+0000be80: 735f 7379 6e63 6564 2873 656c 6629 3a0d  s_synced(self):.
+0000be90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000bea0: 7365 6c66 2e5f 5f73 7472 7563 7475 7265  self.__structure
+0000beb0: 735f 7379 6e63 6564 0d0a 0d0a 2020 2020  s_synced....    
+0000bec0: 405f 7374 7275 6374 7572 6573 5f73 796e  @_structures_syn
+0000bed0: 6365 642e 7365 7474 6572 0d0a 2020 2020  ced.setter..    
+0000bee0: 6465 6620 5f73 7472 7563 7475 7265 735f  def _structures_
+0000bef0: 7379 6e63 6564 2873 656c 662c 7661 6c29  synced(self,val)
+0000bf00: 3a0d 0a20 2020 2020 2020 2023 6c6f 672e  :..        #log.
+0000bf10: 7761 726e 696e 6728 275f 7374 7275 6374  warning('_struct
+0000bf20: 7572 6573 5f73 796e 6365 6420 7365 7420  ures_synced set 
+0000bf30: 746f 207b 7d27 2e66 6f72 6d61 7428 7661  to {}'.format(va
+0000bf40: 6c29 290d 0a20 2020 2020 2020 2073 656c  l))..        sel
+0000bf50: 662e 5f5f 7374 7275 6374 7572 6573 5f73  f.__structures_s
+0000bf60: 796e 6365 6420 3d20 7661 6c0d 0a0d 0a20  ynced = val.... 
+0000bf70: 2020 2023 556e 6c69 6b65 2061 2073 7461     #Unlike a sta
+0000bf80: 6e64 6172 6420 6469 6374 696f 6e61 7279  ndard dictionary
+0000bf90: 2077 6869 6368 2072 6574 7572 6e73 206b   which returns k
+0000bfa0: 6579 7320 696e 2069 7465 722c 2072 6574  eys in iter, ret
+0000bfb0: 7572 6e20 7661 6c75 6573 2028 7369 6e63  urn values (sinc
+0000bfc0: 6520 7468 6174 2773 2077 6861 7420 7765  e that's what we
+0000bfd0: 2075 7375 616c 6c79 2077 616e 7429 0d0a   usually want)..
+0000bfe0: 2020 2020 6465 6620 5f5f 6974 6572 5f5f      def __iter__
+0000bff0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+0000c000: 2073 656c 662e 5f69 7465 7261 746f 7220   self._iterator 
+0000c010: 3d20 6974 6572 2873 656c 662e 7661 6c75  = iter(self.valu
+0000c020: 6573 2829 290d 0a20 2020 2020 2020 2072  es())..        r
+0000c030: 6574 7572 6e20 7365 6c66 0d0a 0d0a 2020  eturn self....  
+0000c040: 2020 6465 6620 5f5f 6e65 7874 5f5f 2873    def __next__(s
+0000c050: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
+0000c060: 6574 7572 6e20 6e65 7874 2873 656c 662e  eturn next(self.
+0000c070: 5f69 7465 7261 746f 7229 0d0a 0d0a 2020  _iterator)....  
+0000c080: 2020 6465 6620 5f5f 6765 7469 7465 6d5f    def __getitem_
+0000c090: 5f28 7365 6c66 2c69 7465 6d29 3a0d 0a20  _(self,item):.. 
+0000c0a0: 2020 2020 2020 2023 4c6f 6164 2074 6865         #Load the
+0000c0b0: 2053 7472 7563 7475 7265 7320 6966 2077   Structures if w
+0000c0c0: 6520 6861 7665 6e27 7420 616c 7265 6164  e haven't alread
+0000c0d0: 790d 0a20 2020 2020 2020 2074 7279 3a0d  y..        try:.
+0000c0e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000c0f0: 6e6f 7420 7365 6c66 2e5f 7374 7275 6374  not self._struct
+0000c100: 7572 6573 5f72 6561 643a 0d0a 2020 2020  ures_read:..    
+0000c110: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000c120: 2e5f 6c6f 6164 5f73 7472 7563 7475 7265  ._load_structure
+0000c130: 7328 290d 0a20 2020 2020 2020 2065 7863  s()..        exc
+0000c140: 6570 7420 6d70 6578 2e45 6d70 6f77 6572  ept mpex.Empower
+0000c150: 496d 706f 7274 6572 5665 7273 696f 6e45  ImporterVersionE
+0000c160: 7272 6f72 2061 7320 653a 0d0a 2020 2020  rror as e:..    
+0000c170: 2020 2020 2020 2020 2349 6620 7468 6572          #If ther
+0000c180: 6520 6973 2061 6e20 496d 706f 7274 6572  e is an Importer
+0000c190: 2056 6572 7369 6f6e 2045 7272 6f72 2c20   Version Error, 
+0000c1a0: 6a75 7374 206c 6f61 6420 7468 6520 7061  just load the pa
+0000c1b0: 7274 6963 756c 6172 2073 7472 7563 7475  rticular structu
+0000c1c0: 7265 0d0a 2020 2020 2020 2020 2020 2020  re..            
+0000c1d0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0000c1e0: 2020 2020 2020 7320 3d20 7365 6c66 2e5f        s = self._
+0000c1f0: 7374 7275 6374 7572 6573 5b69 7465 6d5d  structures[item]
+0000c200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000c210: 2020 6966 206e 6f74 2073 2e5f 6869 6572    if not s._hier
+0000c220: 6172 6368 6965 735f 7265 6164 3a0d 0a20  archies_read:.. 
+0000c230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c240: 2020 2023 6c6f 672e 696e 666f 2827 5f6c     #log.info('_l
+0000c250: 6f61 645f 7374 7275 6374 7572 6520 3436  oad_structure 46
+0000c260: 3527 290d 0a20 2020 2020 2020 2020 2020  5')..           
+0000c270: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
+0000c280: 6f61 645f 7374 7275 6374 7572 6528 6974  oad_structure(it
+0000c290: 656d 2c6f 6c64 5f73 7472 7563 7475 7265  em,old_structure
+0000c2a0: 203d 2073 656c 662e 5f73 7472 7563 7475   = self._structu
+0000c2b0: 7265 732c 656e 636f 6469 6e67 5f6c 6973  res,encoding_lis
+0000c2c0: 743d 7365 6c66 2e5f 656e 636f 6469 6e67  t=self._encoding
+0000c2d0: 5f6c 6973 7429 0d0a 2020 2020 2020 2020  _list)..        
+0000c2e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000c2f0: 2e5f 7374 7275 6374 7572 6573 5b69 7465  ._structures[ite
+0000c300: 6d5d 2e64 696d 656e 7369 6f6e 3d73 656c  m].dimension=sel
+0000c310: 662e 6469 6d65 6e73 696f 6e0d 0a0d 0a20  f.dimension.... 
+0000c320: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000c330: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
+0000c340: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c350: 662e 5f6c 6f61 645f 7374 7275 6374 7572  f._load_structur
+0000c360: 6528 6974 656d 2c65 6e63 6f64 696e 675f  e(item,encoding_
+0000c370: 6c69 7374 3d73 656c 662e 5f65 6e63 6f64  list=self._encod
+0000c380: 696e 675f 6c69 7374 290d 0a20 2020 2020  ing_list)..     
+0000c390: 2020 2020 2020 2020 2020 2023 6c6f 672e             #log.
+0000c3a0: 696e 666f 2827 5f6c 6f61 645f 7374 7275  info('_load_stru
+0000c3b0: 6374 7572 6520 3437 3127 290d 0a20 2020  cture 471')..   
+0000c3c0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000c3d0: 662e 5f73 7472 7563 7475 7265 735b 6974  f._structures[it
+0000c3e0: 656d 5d2e 6469 6d65 6e73 696f 6e3d 7365  em].dimension=se
+0000c3f0: 6c66 2e64 696d 656e 7369 6f6e 0d0a 0d0a  lf.dimension....
+0000c400: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000c410: 656c 662e 5f73 7472 7563 7475 7265 735b  elf._structures[
+0000c420: 6974 656d 5d0d 0a0d 0a20 2020 2064 6566  item]....    def
+0000c430: 205f 5f73 6574 6974 656d 5f5f 2873 656c   __setitem__(sel
+0000c440: 662c 6b65 792c 6974 656d 293a 0d0a 0d0a  f,key,item):....
+0000c450: 2020 2020 2020 2020 2354 4f44 4f20 2d20          #TODO - 
+0000c460: 616c 6c6f 7720 7468 6520 6164 6469 6e67  allow the adding
+0000c470: 206f 6620 7374 7269 6e67 732c 2062 7920   of strings, by 
+0000c480: 6372 6561 7469 6e67 2061 206e 6577 2073  creating a new s
+0000c490: 7472 7563 7475 7265 0d0a 2020 2020 2020  tructure..      
+0000c4a0: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
+0000c4b0: 6e63 6528 6974 656d 2c53 7472 7563 7475  nce(item,Structu
+0000c4c0: 7265 290d 0a20 2020 2020 2020 2061 7373  re)..        ass
+0000c4d0: 6572 7420 6973 696e 7374 616e 6365 286b  ert isinstance(k
+0000c4e0: 6579 2c73 7472 290d 0a0d 0a20 2020 2020  ey,str)....     
+0000c4f0: 2020 2069 6620 6974 656d 2e64 696d 656e     if item.dimen
+0000c500: 7369 6f6e 2021 3d20 7365 6c66 2e64 696d  sion != self.dim
+0000c510: 656e 7369 6f6e 3a0d 0a20 2020 2020 2020  ension:..       
+0000c520: 2020 2020 2069 7465 6d2e 6469 6d65 6e73       item.dimens
+0000c530: 696f 6e20 3d20 7365 6c66 2e64 696d 656e  ion = self.dimen
+0000c540: 7369 6f6e 0d0a 0d0a 2020 2020 2020 2020  sion....        
+0000c550: 2349 6620 7468 6520 6974 656d 2069 7320  #If the item is 
+0000c560: 616c 7265 6164 7920 696e 2074 6865 2064  already in the d
+0000c570: 6963 7469 6f6e 6172 792c 2073 7761 7020  ictionary, swap 
+0000c580: 6974 206f 7574 2066 6f72 2074 6865 206e  it out for the n
+0000c590: 6577 206f 6e65 0d0a 2020 2020 2020 2020  ew one..        
+0000c5a0: 236f 7468 6572 7769 7365 2061 6464 2069  #otherwise add i
+0000c5b0: 7420 6f6e 2074 6865 2065 6e64 0d0a 2020  t on the end..  
+0000c5c0: 2020 2020 2020 7365 6c66 2e5f 7374 7275        self._stru
+0000c5d0: 6374 7572 6573 5b6b 6579 5d20 3d20 6974  ctures[key] = it
+0000c5e0: 656d 0d0a 2020 2020 2020 2020 2357 6520  em..        #We 
+0000c5f0: 6172 6520 636c 6561 726c 7920 6e6f 206c  are clearly no l
+0000c600: 6f6e 6765 7220 7379 6e63 6872 6f6e 6973  onger synchronis
+0000c610: 6564 2077 6974 6820 656d 706f 7765 720d  ed with empower.
+0000c620: 0a20 2020 2020 2020 2073 656c 662e 5f5f  .        self.__
+0000c630: 7374 7275 6374 7572 6573 5f73 796e 6365  structures_synce
+0000c640: 6420 3d20 4661 6c73 650d 0a0d 0a20 2020  d = False....   
+0000c650: 2023 4465 6669 6e65 2077 6861 7420 6861   #Define what ha
+0000c660: 7070 656e 7320 7768 656e 2077 6520 6361  ppens when we ca
+0000c670: 6c6c 202b 3d0d 0a20 2020 2023 5765 2077  ll +=..    #We w
+0000c680: 616e 7420 746f 2061 7070 656e 640d 0a20  ant to append.. 
+0000c690: 2020 2064 6566 205f 5f69 6164 645f 5f28     def __iadd__(
+0000c6a0: 7365 6c66 2c6f 7468 6572 293a 0d0a 2020  self,other):..  
+0000c6b0: 2020 2020 2020 6173 7365 7274 2069 7369        assert isi
+0000c6c0: 6e73 7461 6e63 6528 6f74 6865 722c 5374  nstance(other,St
+0000c6d0: 7275 6374 7572 6529 0d0a 2020 2020 2020  ructure)..      
+0000c6e0: 2020 2361 6464 2074 6865 206e 6577 2073    #add the new s
+0000c6f0: 7472 7563 7475 7265 2069 6e74 6f20 7468  tructure into th
+0000c700: 6520 6469 6374 696f 6e61 7279 2075 7369  e dictionary usi
+0000c710: 6e67 205f 5f73 6574 6974 656d 5f5f 0d0a  ng __setitem__..
+0000c720: 2020 2020 2020 2020 7365 6c66 5b6f 7468          self[oth
+0000c730: 6572 2e73 686f 7274 6e61 6d65 5d20 3d20  er.shortname] = 
+0000c740: 6f74 6865 720d 0a20 2020 2020 2020 2072  other..        r
+0000c750: 6574 7572 6e20 7365 6c66 0d0a 0d0a 2020  eturn self....  
+0000c760: 2020 2344 6566 696e 6520 7768 6174 2068    #Define what h
+0000c770: 6170 7065 6e73 2077 6865 6e20 7765 2063  appens when we c
+0000c780: 616c 6c20 7c3d 0d0a 2020 2020 2357 6520  all |=..    #We 
+0000c790: 7761 6e74 2074 6f20 6170 7065 6e64 2069  want to append i
+0000c7a0: 6620 6974 2069 7320 6e6f 7420 7468 6572  f it is not ther
+0000c7b0: 6520 616c 7265 6164 790d 0a20 2020 2064  e already..    d
+0000c7c0: 6566 205f 5f69 6f72 5f5f 2873 656c 662c  ef __ior__(self,
+0000c7d0: 6f74 6865 7229 3a0d 0a20 2020 2020 2020  other):..       
+0000c7e0: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
+0000c7f0: 6365 286f 7468 6572 2c53 7472 7563 7475  ce(other,Structu
+0000c800: 7265 290d 0a20 2020 2020 2020 2023 6164  re)..        #ad
+0000c810: 6420 7468 6520 6e65 7720 7374 7275 6374  d the new struct
+0000c820: 7572 6520 696e 746f 2074 6865 2064 6963  ure into the dic
+0000c830: 7469 6f6e 6172 7920 7573 696e 6720 5f5f  tionary using __
+0000c840: 7365 7469 7465 6d5f 5f0d 0a20 2020 2020  setitem__..     
+0000c850: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+0000c860: 2020 2020 2073 656c 665b 6f74 6865 722e       self[other.
+0000c870: 7368 6f72 746e 616d 655d 0d0a 2020 2020  shortname]..    
+0000c880: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+0000c890: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+0000c8a0: 2020 7365 6c66 5b6f 7468 6572 2e73 686f    self[other.sho
+0000c8b0: 7274 6e61 6d65 5d20 3d20 6f74 6865 720d  rtname] = other.
+0000c8c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000c8d0: 7365 6c66 0d0a 0d0a 2020 2020 6465 6620  self....    def 
+0000c8e0: 5f6c 6f61 645f 7374 7275 6374 7572 6528  _load_structure(
+0000c8f0: 7365 6c66 2c69 7465 6d2c 6f6c 645f 7374  self,item,old_st
+0000c900: 7275 6374 7572 6520 3d20 4e6f 6e65 2c65  ructure = None,e
+0000c910: 6e63 6f64 696e 675f 6c69 7374 3d4e 6f6e  ncoding_list=Non
+0000c920: 6529 3a0d 0a20 2020 2020 2020 2023 6c6f  e):..        #lo
+0000c930: 672e 696e 666f 2827 5265 6164 696e 6720  g.info('Reading 
+0000c940: 5374 7275 6374 7572 6520 272b 7374 7228  Structure '+str(
+0000c950: 6974 656d 292b 2720 666f 7220 6469 6d65  item)+' for dime
+0000c960: 6e73 696f 6e20 272b 7374 7228 7365 6c66  nsion '+str(self
+0000c970: 2e64 696d 656e 7369 6f6e 2e69 6e64 6578  .dimension.index
+0000c980: 2929 0d0a 2020 2020 2020 2020 6966 206f  ))..        if o
+0000c990: 6c64 5f73 7472 7563 7475 7265 2069 7320  ld_structure is 
+0000c9a0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0000c9b0: 2020 2020 2020 206f 6c64 5f73 7472 7563         old_struc
+0000c9c0: 7475 7265 2e5f 6869 6572 6172 6368 6965  ture._hierarchie
+0000c9d0: 735f 7265 6164 203d 2054 7275 650d 0a0d  s_read = True...
+0000c9e0: 0a20 2020 2020 2020 2069 6620 656e 636f  .        if enco
+0000c9f0: 6469 6e67 5f6c 6973 7420 6973 204e 6f6e  ding_list is Non
+0000ca00: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000ca10: 656e 636f 6469 6e67 5f6c 6973 7420 3d20  encoding_list = 
+0000ca20: 7365 6c66 2e5f 656e 636f 6469 6e67 5f6c  self._encoding_l
+0000ca30: 6973 740d 0a0d 0a20 2020 2020 2020 2066  ist....        f
+0000ca40: 6f72 206e 2c20 656e 636f 6469 6e67 2069  or n, encoding i
+0000ca50: 6e20 656e 756d 6572 6174 6528 656e 636f  n enumerate(enco
+0000ca60: 6469 6e67 5f6c 6973 7429 3a0d 0a20 2020  ding_list):..   
+0000ca70: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+0000ca80: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000ca90: 656c 662e 5f73 7472 7563 7475 7265 735b  elf._structures[
+0000caa0: 6974 656d 5d20 3d20 5f72 6561 645f 7374  item] = _read_st
+0000cab0: 7275 6374 7572 655f 6672 6f6d 5f73 6974  ructure_from_sit
+0000cac0: 6528 6469 6d65 6e73 696f 6e20 2020 2020  e(dimension     
+0000cad0: 3d20 7365 6c66 2e64 696d 656e 7369 6f6e  = self.dimension
+0000cae0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb20: 2020 2020 2c73 686f 7274 6e61 6d65 2020      ,shortname  
+0000cb30: 2020 203d 2069 7465 6d0d 0a20 2020 2020     = item..     
 0000cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb50: 202c 656e 636f 6469 6e67 2020 2020 2020   ,encoding      
-0000cb60: 3d20 656e 636f 6469 6e67 0d0a 2020 2020  = encoding..    
-0000cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cba0: 2020 2020 2020 2020 2020 2020 2020 2c6f                ,o
-0000cbb0: 6c64 5f73 7472 7563 7475 7265 203d 206f  ld_structure = o
-0000cbc0: 6c64 5f73 7472 7563 7475 7265 0d0a 2020  ld_structure..  
-0000cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cb70: 2020 2020 2020 2020 2020 2020 202c 656e               ,en
+0000cb80: 636f 6469 6e67 2020 2020 2020 3d20 656e  coding      = en
+0000cb90: 636f 6469 6e67 0d0a 2020 2020 2020 2020  coding..        
+0000cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cbd0: 2020 2020 2020 2020 2020 2c6f 6c64 5f73            ,old_s
+0000cbe0: 7472 7563 7475 7265 203d 206f 6c64 5f73  tructure = old_s
+0000cbf0: 7472 7563 7475 7265 0d0a 2020 2020 2020  tructure..      
 0000cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc10: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000cc20: 2020 2062 7265 616b 0d0a 2020 2020 2020     break..      
-0000cc30: 2020 2020 2020 6578 6365 7074 2055 6e69        except Uni
-0000cc40: 636f 6465 4465 636f 6465 4572 726f 723a  codeDecodeError:
-0000cc50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000cc60: 2020 6966 206e 203e 206c 656e 2865 6e63    if n > len(enc
-0000cc70: 6f64 696e 675f 6c69 7374 293a 0d0a 2020  oding_list):..  
-0000cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cc90: 2020 7261 6973 6520 556e 6963 6f64 6544    raise UnicodeD
-0000cca0: 6563 6f64 6545 7272 6f72 2827 436f 756c  ecodeError('Coul
-0000ccb0: 6420 6e6f 7420 7265 6164 2073 7472 7563  d not read struc
-0000ccc0: 7475 7265 207b 7d20 7769 7468 2061 6e79  ture {} with any
-0000ccd0: 206f 6620 7468 6520 656e 636f 6469 6e67   of the encoding
-0000cce0: 7320 7b7d 272e 666f 726d 6174 2869 7465  s {}'.format(ite
-0000ccf0: 6d2c 656e 636f 6469 6e67 5f6c 6973 7429  m,encoding_list)
-0000cd00: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000cd10: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0000cd20: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0000cd30: 672e 7761 726e 696e 6728 2753 6c6f 7720  g.warning('Slow 
-0000cd40: 7374 7275 6374 7572 6520 7265 6164 207b  structure read {
-0000cd50: 7d20 7761 7320 6361 7573 6564 2062 7920  } was caused by 
-0000cd60: 7472 7969 6e67 207b 7d2e 272e 666f 726d  trying {}.'.form
-0000cd70: 6174 2869 7465 6d2c 2720 6265 666f 7265  at(item,' before
-0000cd80: 2027 2e6a 6f69 6e28 656e 636f 6469 6e67   '.join(encoding
-0000cd90: 5f6c 6973 745b 3a6e 2b31 5d29 2929 0d0a  _list[:n+1])))..
-0000cda0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0000cdb0: 7374 7275 6374 7572 6573 5b69 7465 6d5d  structures[item]
-0000cdc0: 2e64 696d 656e 7369 6f6e 203d 2073 656c  .dimension = sel
-0000cdd0: 662e 6469 6d65 6e73 696f 6e0d 0a0d 0a20  f.dimension.... 
-0000cde0: 2020 2064 6566 2076 616c 7565 7328 7365     def values(se
-0000cdf0: 6c66 293a 0d0a 2020 2020 2020 2020 7472  lf):..        tr
-0000ce00: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0000ce10: 6966 206e 6f74 2073 656c 662e 5f73 7472  if not self._str
-0000ce20: 7563 7475 7265 735f 7265 6164 3a0d 0a20  uctures_read:.. 
-0000ce30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000ce40: 656c 662e 5f6c 6f61 645f 7374 7275 6374  elf._load_struct
-0000ce50: 7572 6573 2829 0d0a 2020 2020 2020 2020  ures()..        
-0000ce60: 6578 6365 7074 206d 7065 782e 456d 706f  except mpex.Empo
-0000ce70: 7765 7249 6d70 6f72 7465 7256 6572 7369  werImporterVersi
-0000ce80: 6f6e 4572 726f 7220 6173 2065 3a0d 0a20  onError as e:.. 
-0000ce90: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000cea0: 2041 7474 7269 6275 7465 4572 726f 7228   AttributeError(
-0000ceb0: 272e 7374 7275 6374 7572 6573 2062 6568  '.structures beh
-0000cec0: 6176 6573 206c 696b 6520 6120 6469 6374  aves like a dict
-0000ced0: 696f 6e61 7279 2062 7574 2064 6f65 7320  ionary but does 
-0000cee0: 6e6f 7420 6861 7665 2061 2076 616c 7565  not have a value
-0000cef0: 7328 2920 6d65 7468 6f64 2062 6563 6175  s() method becau
-0000cf00: 7365 2077 6520 6361 6e6e 6f74 206c 6f61  se we cannot loa
-0000cf10: 6420 616c 6c20 6f66 2074 6865 2073 7472  d all of the str
-0000cf20: 7563 7475 7265 7320 666f 7220 6120 6769  uctures for a gi
-0000cf30: 7665 6e20 6469 6d65 6e73 696f 6e20 6672  ven dimension fr
-0000cf40: 6f6d 2045 6d70 6f77 6572 2077 6974 6820  om Empower with 
-0000cf50: 7468 6520 496d 706f 7274 6572 2076 6572  the Importer ver
-0000cf60: 7369 6f6e 2079 6f75 2061 7265 2075 7369  sion you are usi
-0000cf70: 6e67 2e5c 6e20 596f 7520 7769 6c6c 206e  ng.\n You will n
-0000cf80: 6565 6420 746f 2063 616c 6c20 6561 6368  eed to call each
-0000cf90: 2069 7465 6d20 7365 7061 7261 7465 6c79   item separately
-0000cfa0: 2e20 652e 672e 2073 6974 652e 6469 6d65  . e.g. site.dime
-0000cfb0: 6e73 696f 6e73 5b30 5d2e 7374 7275 6374  nsions[0].struct
-0000cfc0: 7572 6573 5b22 5350 414d 225d 2e20 272b  ures["SPAM"]. '+
-0000cfd0: 7374 7228 6529 290d 0a0d 0a20 2020 2020  str(e))....     
-0000cfe0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0000cff0: 7374 7275 6374 7572 6573 2e76 616c 7565  structures.value
-0000d000: 7328 290d 0a0d 0a20 2020 2064 6566 2069  s()....    def i
-0000d010: 7465 6d73 2873 656c 6629 3a0d 0a20 2020  tems(self):..   
-0000d020: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-0000d030: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-0000d040: 6c66 2e5f 7374 7275 6374 7572 6573 5f72  lf._structures_r
-0000d050: 6561 643a 0d0a 2020 2020 2020 2020 2020  ead:..          
-0000d060: 2020 2020 2020 7365 6c66 2e5f 6c6f 6164        self._load
-0000d070: 5f73 7472 7563 7475 7265 7328 290d 0a20  _structures().. 
-0000d080: 2020 2020 2020 2065 7863 6570 7420 6d70         except mp
-0000d090: 6578 2e45 6d70 6f77 6572 496d 706f 7274  ex.EmpowerImport
-0000d0a0: 6572 5665 7273 696f 6e45 7272 6f72 2061  erVersionError a
-0000d0b0: 7320 653a 0d0a 2020 2020 2020 2020 2020  s e:..          
-0000d0c0: 2020 7261 6973 6520 4174 7472 6962 7574    raise Attribut
-0000d0d0: 6545 7272 6f72 2827 2e73 7472 7563 7475  eError('.structu
-0000d0e0: 7265 7320 6265 6861 7665 7320 6c69 6b65  res behaves like
-0000d0f0: 2061 2064 6963 7469 6f6e 6172 7920 6275   a dictionary bu
-0000d100: 7420 646f 6573 206e 6f74 2068 6176 6520  t does not have 
-0000d110: 6120 6974 656d 7328 2920 6d65 7468 6f64  a items() method
-0000d120: 2062 6563 6175 7365 2077 6520 6361 6e6e   because we cann
-0000d130: 6f74 206c 6f61 6420 616c 6c20 6f66 2074  ot load all of t
-0000d140: 6865 2073 7472 7563 7475 7265 7320 666f  he structures fo
-0000d150: 7220 6120 6769 7665 6e20 6469 6d65 6e73  r a given dimens
-0000d160: 696f 6e20 6672 6f6d 2045 6d70 6f77 6572  ion from Empower
-0000d170: 2077 6974 6820 7468 6520 496d 706f 7274   with the Import
-0000d180: 6572 2076 6572 7369 6f6e 2079 6f75 2061  er version you a
-0000d190: 7265 2075 7369 6e67 2e5c 6e20 596f 7520  re using.\n You 
-0000d1a0: 7769 6c6c 206e 6565 6420 746f 2063 616c  will need to cal
-0000d1b0: 6c20 6561 6368 2069 7465 6d20 7365 7061  l each item sepa
-0000d1c0: 7261 7465 6c79 2e20 652e 672e 2073 6974  rately. e.g. sit
-0000d1d0: 652e 6469 6d65 6e73 696f 6e73 5b30 5d2e  e.dimensions[0].
-0000d1e0: 7374 7275 6374 7572 6573 5b22 5350 414d  structures["SPAM
-0000d1f0: 225d 2e20 272b 7374 7228 6529 290d 0a0d  "]. '+str(e))...
-0000d200: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000d210: 7365 6c66 2e5f 7374 7275 6374 7572 6573  self._structures
-0000d220: 2e69 7465 6d73 2829 0d0a 0d0a 2020 2020  .items()....    
-0000d230: 6465 6620 6b65 7973 2873 656c 6629 3a0d  def keys(self):.
-0000d240: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
-0000d250: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000d260: 7420 7365 6c66 2e5f 7374 7275 6374 7572  t self._structur
-0000d270: 6573 5f72 6561 643a 0d0a 2020 2020 2020  es_read:..      
-0000d280: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000d290: 6c6f 6164 5f73 7472 7563 7475 7265 7328  load_structures(
-0000d2a0: 290d 0a20 2020 2020 2020 2065 7863 6570  )..        excep
-0000d2b0: 7420 6d70 6578 2e45 6d70 6f77 6572 496d  t mpex.EmpowerIm
-0000d2c0: 706f 7274 6572 5665 7273 696f 6e45 7272  porterVersionErr
-0000d2d0: 6f72 2061 7320 653a 0d0a 2020 2020 2020  or as e:..      
-0000d2e0: 2020 2020 2020 7261 6973 6520 4174 7472        raise Attr
-0000d2f0: 6962 7574 6545 7272 6f72 2827 2e73 7472  ibuteError('.str
-0000d300: 7563 7475 7265 7320 6265 6861 7665 7320  uctures behaves 
-0000d310: 6c69 6b65 2061 2064 6963 7469 6f6e 6172  like a dictionar
-0000d320: 7920 6275 7420 646f 6573 206e 6f74 2068  y but does not h
-0000d330: 6176 6520 6120 6b65 7973 2829 206d 6574  ave a keys() met
-0000d340: 686f 6420 6265 6361 7573 6520 7765 2063  hod because we c
-0000d350: 616e 6e6f 7420 6c6f 6164 2061 6c6c 206f  annot load all o
-0000d360: 6620 7468 6520 7374 7275 6374 7572 6573  f the structures
-0000d370: 2066 6f72 2061 2067 6976 656e 2064 696d   for a given dim
-0000d380: 656e 7369 6f6e 2066 726f 6d20 456d 706f  ension from Empo
-0000d390: 7765 7220 7769 7468 2074 6865 2049 6d70  wer with the Imp
-0000d3a0: 6f72 7465 7220 7665 7273 696f 6e20 796f  orter version yo
-0000d3b0: 7520 6172 6520 7573 696e 672e 5c6e 2059  u are using.\n Y
-0000d3c0: 6f75 2077 696c 6c20 6e65 6564 2074 6f20  ou will need to 
-0000d3d0: 6361 6c6c 2065 6163 6820 6974 656d 2073  call each item s
-0000d3e0: 6570 6172 6174 656c 792e 2065 2e67 2e20  eparately. e.g. 
-0000d3f0: 7369 7465 2e64 696d 656e 7369 6f6e 735b  site.dimensions[
-0000d400: 305d 2e73 7472 7563 7475 7265 735b 2253  0].structures["S
-0000d410: 5041 4d22 5d2e 2027 2b73 7472 2865 2929  PAM"]. '+str(e))
-0000d420: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-0000d430: 726e 2073 656c 662e 5f73 7472 7563 7475  rn self._structu
-0000d440: 7265 732e 6b65 7973 2829 0d0a 0d0a 2020  res.keys()....  
-0000d450: 2020 6465 6620 5f5f 6c65 6e5f 5f28 7365    def __len__(se
-0000d460: 6c66 293a 0d0a 2020 2020 2020 2020 7472  lf):..        tr
-0000d470: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0000d480: 6966 206e 6f74 2073 656c 662e 5f73 7472  if not self._str
-0000d490: 7563 7475 7265 735f 7265 6164 3a0d 0a20  uctures_read:.. 
-0000d4a0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d4b0: 656c 662e 5f6c 6f61 645f 7374 7275 6374  elf._load_struct
-0000d4c0: 7572 6573 2829 0d0a 2020 2020 2020 2020  ures()..        
-0000d4d0: 6578 6365 7074 206d 7065 782e 456d 706f  except mpex.Empo
-0000d4e0: 7765 7249 6d70 6f72 7465 7256 6572 7369  werImporterVersi
-0000d4f0: 6f6e 4572 726f 7220 6173 2065 3a0d 0a20  onError as e:.. 
-0000d500: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000d510: 2041 7474 7269 6275 7465 4572 726f 7228   AttributeError(
-0000d520: 272e 7374 7275 6374 7572 6573 2062 6568  '.structures beh
-0000d530: 6176 6573 206c 696b 6520 6120 6469 6374  aves like a dict
-0000d540: 696f 6e61 7279 2062 7574 2064 6f65 7320  ionary but does 
-0000d550: 6e6f 7420 6861 7665 2061 206b 6579 7328  not have a keys(
-0000d560: 2920 6d65 7468 6f64 2062 6563 6175 7365  ) method because
-0000d570: 2077 6520 6361 6e6e 6f74 206c 6f61 6420   we cannot load 
-0000d580: 616c 6c20 6f66 2074 6865 2073 7472 7563  all of the struc
-0000d590: 7475 7265 7320 666f 7220 6120 6769 7665  tures for a give
-0000d5a0: 6e20 6469 6d65 6e73 696f 6e20 6672 6f6d  n dimension from
-0000d5b0: 2045 6d70 6f77 6572 2077 6974 6820 7468   Empower with th
-0000d5c0: 6520 496d 706f 7274 6572 2076 6572 7369  e Importer versi
-0000d5d0: 6f6e 2079 6f75 2061 7265 2075 7369 6e67  on you are using
-0000d5e0: 2e5c 6e20 596f 7520 7769 6c6c 206e 6565  .\n You will nee
-0000d5f0: 6420 746f 2063 616c 6c20 6561 6368 2069  d to call each i
-0000d600: 7465 6d20 7365 7061 7261 7465 6c79 2e20  tem separately. 
-0000d610: 652e 672e 2073 6974 652e 6469 6d65 6e73  e.g. site.dimens
-0000d620: 696f 6e73 5b30 5d2e 7374 7275 6374 7572  ions[0].structur
-0000d630: 6573 5b22 5350 414d 225d 2e20 272b 7374  es["SPAM"]. '+st
-0000d640: 7228 6529 290d 0a0d 0a20 2020 2020 2020  r(e))....       
-0000d650: 2072 6574 7572 6e20 6c65 6e28 7365 6c66   return len(self
-0000d660: 2e5f 7374 7275 6374 7572 6573 290d 0a0d  ._structures)...
-0000d670: 0a20 2020 2064 6566 205f 6c6f 6164 5f73  .    def _load_s
-0000d680: 7472 7563 7475 7265 7328 7365 6c66 293a  tructures(self):
-0000d690: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0000d6a0: 7374 7275 6374 7572 6573 5f72 6561 6420  structures_read 
-0000d6b0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-0000d6c0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-0000d6d0: 2020 6c6f 672e 7665 7262 6f73 6528 2752    log.verbose('R
-0000d6e0: 6561 6469 6e67 2053 7472 7563 7475 7265  eading Structure
-0000d6f0: 7320 666f 7220 6469 6d65 6e73 696f 6e20  s for dimension 
-0000d700: 272b 7374 7228 7365 6c66 2e64 696d 656e  '+str(self.dimen
-0000d710: 7369 6f6e 2e69 6e64 6578 2929 0d0a 2020  sion.index))..  
-0000d720: 2020 2020 2020 2020 2020 6d61 6a6f 725f            major_
-0000d730: 7665 7273 696f 6e2c 206d 696e 6f72 5f76  version, minor_v
-0000d740: 6572 7369 6f6e 2c20 7265 6c65 6173 652c  ersion, release,
-0000d750: 2072 656c 6561 7365 5f6e 756d 6265 7220   release_number 
-0000d760: 3d20 7365 6c66 2e64 696d 656e 7369 6f6e  = self.dimension
-0000d770: 2e73 6974 652e 696d 706f 7274 6572 5f76  .site.importer_v
-0000d780: 6572 7369 6f6e 0d0a 0d0a 2020 2020 2020  ersion....      
-0000d790: 2020 2020 2020 6966 2028 6d61 6a6f 725f        if (major_
-0000d7a0: 7665 7273 696f 6e20 3d3d 2039 2061 6e64  version == 9 and
-0000d7b0: 2028 7265 6c65 6173 655f 6e75 6d62 6572   (release_number
-0000d7c0: 203e 3d20 3138 3934 206f 7220 6d69 6e6f   >= 1894 or mino
-0000d7d0: 725f 7665 7273 696f 6e20 3e3d 3729 2920  r_version >=7)) 
-0000d7e0: 6f72 206d 616a 6f72 5f76 6572 7369 6f6e  or major_version
-0000d7f0: 203e 2039 3a0d 0a0d 0a20 2020 2020 2020   > 9:....       
-0000d800: 2020 2020 2020 2020 2073 656c 662e 5f73           self._s
-0000d810: 7472 7563 7475 7265 7320 3d20 5f63 7265  tructures = _cre
-0000d820: 6174 655f 656d 706f 7765 725f 6469 6d65  ate_empower_dime
-0000d830: 6e73 696f 6e5f 7368 6f72 746e 616d 655f  nsion_shortname_
-0000d840: 7374 7275 6374 7572 655f 6469 6374 2864  structure_dict(d
-0000d850: 696d 656e 7369 6f6e 2020 2020 2020 3d20  imension      = 
-0000d860: 7365 6c66 2e64 696d 656e 7369 6f6e 0d0a  self.dimension..
-0000d870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc30: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
+0000cc40: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000cc50: 7265 616b 0d0a 2020 2020 2020 2020 2020  reak..          
+0000cc60: 2020 6578 6365 7074 2055 6e69 636f 6465    except Unicode
+0000cc70: 4465 636f 6465 4572 726f 723a 0d0a 2020  DecodeError:..  
+0000cc80: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000cc90: 206e 203e 206c 656e 2865 6e63 6f64 696e   n > len(encodin
+0000cca0: 675f 6c69 7374 293a 0d0a 2020 2020 2020  g_list):..      
+0000ccb0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000ccc0: 6973 6520 556e 6963 6f64 6544 6563 6f64  ise UnicodeDecod
+0000ccd0: 6545 7272 6f72 2827 436f 756c 6420 6e6f  eError('Could no
+0000cce0: 7420 7265 6164 2073 7472 7563 7475 7265  t read structure
+0000ccf0: 207b 7d20 7769 7468 2061 6e79 206f 6620   {} with any of 
+0000cd00: 7468 6520 656e 636f 6469 6e67 7320 7b7d  the encodings {}
+0000cd10: 272e 666f 726d 6174 2869 7465 6d2c 656e  '.format(item,en
+0000cd20: 636f 6469 6e67 5f6c 6973 7429 290d 0a20  coding_list)).. 
+0000cd30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000cd40: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0000cd50: 2020 2020 2020 2020 2020 6c6f 672e 7761            log.wa
+0000cd60: 726e 696e 6728 2753 6c6f 7720 7374 7275  rning('Slow stru
+0000cd70: 6374 7572 6520 7265 6164 207b 7d20 7761  cture read {} wa
+0000cd80: 7320 6361 7573 6564 2062 7920 7472 7969  s caused by tryi
+0000cd90: 6e67 207b 7d2e 272e 666f 726d 6174 2869  ng {}.'.format(i
+0000cda0: 7465 6d2c 2720 6265 666f 7265 2027 2e6a  tem,' before '.j
+0000cdb0: 6f69 6e28 656e 636f 6469 6e67 5f6c 6973  oin(encoding_lis
+0000cdc0: 745b 3a6e 2b31 5d29 2929 0d0a 0d0a 2020  t[:n+1])))....  
+0000cdd0: 2020 2020 2020 7365 6c66 2e5f 7374 7275        self._stru
+0000cde0: 6374 7572 6573 5b69 7465 6d5d 2e64 696d  ctures[item].dim
+0000cdf0: 656e 7369 6f6e 203d 2073 656c 662e 6469  ension = self.di
+0000ce00: 6d65 6e73 696f 6e0d 0a0d 0a20 2020 2064  mension....    d
+0000ce10: 6566 2076 616c 7565 7328 7365 6c66 293a  ef values(self):
+0000ce20: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+0000ce30: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000ce40: 6f74 2073 656c 662e 5f73 7472 7563 7475  ot self._structu
+0000ce50: 7265 735f 7265 6164 3a0d 0a20 2020 2020  res_read:..     
+0000ce60: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000ce70: 5f6c 6f61 645f 7374 7275 6374 7572 6573  _load_structures
+0000ce80: 2829 0d0a 2020 2020 2020 2020 6578 6365  ()..        exce
+0000ce90: 7074 206d 7065 782e 456d 706f 7765 7249  pt mpex.EmpowerI
+0000cea0: 6d70 6f72 7465 7256 6572 7369 6f6e 4572  mporterVersionEr
+0000ceb0: 726f 7220 6173 2065 3a0d 0a20 2020 2020  ror as e:..     
+0000cec0: 2020 2020 2020 2072 6169 7365 2041 7474         raise Att
+0000ced0: 7269 6275 7465 4572 726f 7228 272e 7374  ributeError('.st
+0000cee0: 7275 6374 7572 6573 2062 6568 6176 6573  ructures behaves
+0000cef0: 206c 696b 6520 6120 6469 6374 696f 6e61   like a dictiona
+0000cf00: 7279 2062 7574 2064 6f65 7320 6e6f 7420  ry but does not 
+0000cf10: 6861 7665 2061 2076 616c 7565 7328 2920  have a values() 
+0000cf20: 6d65 7468 6f64 2062 6563 6175 7365 2077  method because w
+0000cf30: 6520 6361 6e6e 6f74 206c 6f61 6420 616c  e cannot load al
+0000cf40: 6c20 6f66 2074 6865 2073 7472 7563 7475  l of the structu
+0000cf50: 7265 7320 666f 7220 6120 6769 7665 6e20  res for a given 
+0000cf60: 6469 6d65 6e73 696f 6e20 6672 6f6d 2045  dimension from E
+0000cf70: 6d70 6f77 6572 2077 6974 6820 7468 6520  mpower with the 
+0000cf80: 496d 706f 7274 6572 2076 6572 7369 6f6e  Importer version
+0000cf90: 2079 6f75 2061 7265 2075 7369 6e67 2e5c   you are using.\
+0000cfa0: 6e20 596f 7520 7769 6c6c 206e 6565 6420  n You will need 
+0000cfb0: 746f 2063 616c 6c20 6561 6368 2069 7465  to call each ite
+0000cfc0: 6d20 7365 7061 7261 7465 6c79 2e20 652e  m separately. e.
+0000cfd0: 672e 2073 6974 652e 6469 6d65 6e73 696f  g. site.dimensio
+0000cfe0: 6e73 5b30 5d2e 7374 7275 6374 7572 6573  ns[0].structures
+0000cff0: 5b22 5350 414d 225d 2e20 272b 7374 7228  ["SPAM"]. '+str(
+0000d000: 6529 290d 0a0d 0a20 2020 2020 2020 2072  e))....        r
+0000d010: 6574 7572 6e20 7365 6c66 2e5f 7374 7275  eturn self._stru
+0000d020: 6374 7572 6573 2e76 616c 7565 7328 290d  ctures.values().
+0000d030: 0a0d 0a20 2020 2064 6566 2069 7465 6d73  ...    def items
+0000d040: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+0000d050: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+0000d060: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
+0000d070: 7374 7275 6374 7572 6573 5f72 6561 643a  structures_read:
+0000d080: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000d090: 2020 7365 6c66 2e5f 6c6f 6164 5f73 7472    self._load_str
+0000d0a0: 7563 7475 7265 7328 290d 0a20 2020 2020  uctures()..     
+0000d0b0: 2020 2065 7863 6570 7420 6d70 6578 2e45     except mpex.E
+0000d0c0: 6d70 6f77 6572 496d 706f 7274 6572 5665  mpowerImporterVe
+0000d0d0: 7273 696f 6e45 7272 6f72 2061 7320 653a  rsionError as e:
+0000d0e0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0000d0f0: 6973 6520 4174 7472 6962 7574 6545 7272  ise AttributeErr
+0000d100: 6f72 2827 2e73 7472 7563 7475 7265 7320  or('.structures 
+0000d110: 6265 6861 7665 7320 6c69 6b65 2061 2064  behaves like a d
+0000d120: 6963 7469 6f6e 6172 7920 6275 7420 646f  ictionary but do
+0000d130: 6573 206e 6f74 2068 6176 6520 6120 6974  es not have a it
+0000d140: 656d 7328 2920 6d65 7468 6f64 2062 6563  ems() method bec
+0000d150: 6175 7365 2077 6520 6361 6e6e 6f74 206c  ause we cannot l
+0000d160: 6f61 6420 616c 6c20 6f66 2074 6865 2073  oad all of the s
+0000d170: 7472 7563 7475 7265 7320 666f 7220 6120  tructures for a 
+0000d180: 6769 7665 6e20 6469 6d65 6e73 696f 6e20  given dimension 
+0000d190: 6672 6f6d 2045 6d70 6f77 6572 2077 6974  from Empower wit
+0000d1a0: 6820 7468 6520 496d 706f 7274 6572 2076  h the Importer v
+0000d1b0: 6572 7369 6f6e 2079 6f75 2061 7265 2075  ersion you are u
+0000d1c0: 7369 6e67 2e5c 6e20 596f 7520 7769 6c6c  sing.\n You will
+0000d1d0: 206e 6565 6420 746f 2063 616c 6c20 6561   need to call ea
+0000d1e0: 6368 2069 7465 6d20 7365 7061 7261 7465  ch item separate
+0000d1f0: 6c79 2e20 652e 672e 2073 6974 652e 6469  ly. e.g. site.di
+0000d200: 6d65 6e73 696f 6e73 5b30 5d2e 7374 7275  mensions[0].stru
+0000d210: 6374 7572 6573 5b22 5350 414d 225d 2e20  ctures["SPAM"]. 
+0000d220: 272b 7374 7228 6529 290d 0a0d 0a20 2020  '+str(e))....   
+0000d230: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000d240: 2e5f 7374 7275 6374 7572 6573 2e69 7465  ._structures.ite
+0000d250: 6d73 2829 0d0a 0d0a 2020 2020 6465 6620  ms()....    def 
+0000d260: 6b65 7973 2873 656c 6629 3a0d 0a20 2020  keys(self):..   
+0000d270: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+0000d280: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
+0000d290: 6c66 2e5f 7374 7275 6374 7572 6573 5f72  lf._structures_r
+0000d2a0: 6561 643a 0d0a 2020 2020 2020 2020 2020  ead:..          
+0000d2b0: 2020 2020 2020 7365 6c66 2e5f 6c6f 6164        self._load
+0000d2c0: 5f73 7472 7563 7475 7265 7328 290d 0a20  _structures().. 
+0000d2d0: 2020 2020 2020 2065 7863 6570 7420 6d70         except mp
+0000d2e0: 6578 2e45 6d70 6f77 6572 496d 706f 7274  ex.EmpowerImport
+0000d2f0: 6572 5665 7273 696f 6e45 7272 6f72 2061  erVersionError a
+0000d300: 7320 653a 0d0a 2020 2020 2020 2020 2020  s e:..          
+0000d310: 2020 7261 6973 6520 4174 7472 6962 7574    raise Attribut
+0000d320: 6545 7272 6f72 2827 2e73 7472 7563 7475  eError('.structu
+0000d330: 7265 7320 6265 6861 7665 7320 6c69 6b65  res behaves like
+0000d340: 2061 2064 6963 7469 6f6e 6172 7920 6275   a dictionary bu
+0000d350: 7420 646f 6573 206e 6f74 2068 6176 6520  t does not have 
+0000d360: 6120 6b65 7973 2829 206d 6574 686f 6420  a keys() method 
+0000d370: 6265 6361 7573 6520 7765 2063 616e 6e6f  because we canno
+0000d380: 7420 6c6f 6164 2061 6c6c 206f 6620 7468  t load all of th
+0000d390: 6520 7374 7275 6374 7572 6573 2066 6f72  e structures for
+0000d3a0: 2061 2067 6976 656e 2064 696d 656e 7369   a given dimensi
+0000d3b0: 6f6e 2066 726f 6d20 456d 706f 7765 7220  on from Empower 
+0000d3c0: 7769 7468 2074 6865 2049 6d70 6f72 7465  with the Importe
+0000d3d0: 7220 7665 7273 696f 6e20 796f 7520 6172  r version you ar
+0000d3e0: 6520 7573 696e 672e 5c6e 2059 6f75 2077  e using.\n You w
+0000d3f0: 696c 6c20 6e65 6564 2074 6f20 6361 6c6c  ill need to call
+0000d400: 2065 6163 6820 6974 656d 2073 6570 6172   each item separ
+0000d410: 6174 656c 792e 2065 2e67 2e20 7369 7465  ately. e.g. site
+0000d420: 2e64 696d 656e 7369 6f6e 735b 305d 2e73  .dimensions[0].s
+0000d430: 7472 7563 7475 7265 735b 2253 5041 4d22  tructures["SPAM"
+0000d440: 5d2e 2027 2b73 7472 2865 2929 0d0a 0d0a  ]. '+str(e))....
+0000d450: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000d460: 656c 662e 5f73 7472 7563 7475 7265 732e  elf._structures.
+0000d470: 6b65 7973 2829 0d0a 0d0a 2020 2020 6465  keys()....    de
+0000d480: 6620 5f5f 6c65 6e5f 5f28 7365 6c66 293a  f __len__(self):
+0000d490: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+0000d4a0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000d4b0: 6f74 2073 656c 662e 5f73 7472 7563 7475  ot self._structu
+0000d4c0: 7265 735f 7265 6164 3a0d 0a20 2020 2020  res_read:..     
+0000d4d0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000d4e0: 5f6c 6f61 645f 7374 7275 6374 7572 6573  _load_structures
+0000d4f0: 2829 0d0a 2020 2020 2020 2020 6578 6365  ()..        exce
+0000d500: 7074 206d 7065 782e 456d 706f 7765 7249  pt mpex.EmpowerI
+0000d510: 6d70 6f72 7465 7256 6572 7369 6f6e 4572  mporterVersionEr
+0000d520: 726f 7220 6173 2065 3a0d 0a20 2020 2020  ror as e:..     
+0000d530: 2020 2020 2020 2072 6169 7365 2041 7474         raise Att
+0000d540: 7269 6275 7465 4572 726f 7228 272e 7374  ributeError('.st
+0000d550: 7275 6374 7572 6573 2062 6568 6176 6573  ructures behaves
+0000d560: 206c 696b 6520 6120 6469 6374 696f 6e61   like a dictiona
+0000d570: 7279 2062 7574 2064 6f65 7320 6e6f 7420  ry but does not 
+0000d580: 6861 7665 2061 206b 6579 7328 2920 6d65  have a keys() me
+0000d590: 7468 6f64 2062 6563 6175 7365 2077 6520  thod because we 
+0000d5a0: 6361 6e6e 6f74 206c 6f61 6420 616c 6c20  cannot load all 
+0000d5b0: 6f66 2074 6865 2073 7472 7563 7475 7265  of the structure
+0000d5c0: 7320 666f 7220 6120 6769 7665 6e20 6469  s for a given di
+0000d5d0: 6d65 6e73 696f 6e20 6672 6f6d 2045 6d70  mension from Emp
+0000d5e0: 6f77 6572 2077 6974 6820 7468 6520 496d  ower with the Im
+0000d5f0: 706f 7274 6572 2076 6572 7369 6f6e 2079  porter version y
+0000d600: 6f75 2061 7265 2075 7369 6e67 2e5c 6e20  ou are using.\n 
+0000d610: 596f 7520 7769 6c6c 206e 6565 6420 746f  You will need to
+0000d620: 2063 616c 6c20 6561 6368 2069 7465 6d20   call each item 
+0000d630: 7365 7061 7261 7465 6c79 2e20 652e 672e  separately. e.g.
+0000d640: 2073 6974 652e 6469 6d65 6e73 696f 6e73   site.dimensions
+0000d650: 5b30 5d2e 7374 7275 6374 7572 6573 5b22  [0].structures["
+0000d660: 5350 414d 225d 2e20 272b 7374 7228 6529  SPAM"]. '+str(e)
+0000d670: 290d 0a0d 0a20 2020 2020 2020 2072 6574  )....        ret
+0000d680: 7572 6e20 6c65 6e28 7365 6c66 2e5f 7374  urn len(self._st
+0000d690: 7275 6374 7572 6573 290d 0a0d 0a20 2020  ructures)....   
+0000d6a0: 2064 6566 205f 6c6f 6164 5f73 7472 7563   def _load_struc
+0000d6b0: 7475 7265 7328 7365 6c66 293a 0d0a 2020  tures(self):..  
+0000d6c0: 2020 2020 2020 7365 6c66 2e5f 7374 7275        self._stru
+0000d6d0: 6374 7572 6573 5f72 6561 6420 3d20 5472  ctures_read = Tr
+0000d6e0: 7565 0d0a 2020 2020 2020 2020 7472 793a  ue..        try:
+0000d6f0: 0d0a 2020 2020 2020 2020 2020 2020 6c6f  ..            lo
+0000d700: 672e 7665 7262 6f73 6528 2752 6561 6469  g.verbose('Readi
+0000d710: 6e67 2053 7472 7563 7475 7265 7320 666f  ng Structures fo
+0000d720: 7220 6469 6d65 6e73 696f 6e20 272b 7374  r dimension '+st
+0000d730: 7228 7365 6c66 2e64 696d 656e 7369 6f6e  r(self.dimension
+0000d740: 2e69 6e64 6578 2929 0d0a 2020 2020 2020  .index))..      
+0000d750: 2020 2020 2020 6d61 6a6f 725f 7665 7273        major_vers
+0000d760: 696f 6e2c 206d 696e 6f72 5f76 6572 7369  ion, minor_versi
+0000d770: 6f6e 2c20 7265 6c65 6173 652c 2072 656c  on, release, rel
+0000d780: 6561 7365 5f6e 756d 6265 7220 3d20 7365  ease_number = se
+0000d790: 6c66 2e64 696d 656e 7369 6f6e 2e73 6974  lf.dimension.sit
+0000d7a0: 652e 696d 706f 7274 6572 5f76 6572 7369  e.importer_versi
+0000d7b0: 6f6e 0d0a 0d0a 2020 2020 2020 2020 2020  on....          
+0000d7c0: 2020 6966 2028 6d61 6a6f 725f 7665 7273    if (major_vers
+0000d7d0: 696f 6e20 3d3d 2039 2061 6e64 2028 7265  ion == 9 and (re
+0000d7e0: 6c65 6173 655f 6e75 6d62 6572 203e 3d20  lease_number >= 
+0000d7f0: 3138 3934 206f 7220 6d69 6e6f 725f 7665  1894 or minor_ve
+0000d800: 7273 696f 6e20 3e3d 3729 2920 6f72 206d  rsion >=7)) or m
+0000d810: 616a 6f72 5f76 6572 7369 6f6e 203e 2039  ajor_version > 9
+0000d820: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+0000d830: 2020 2020 2073 656c 662e 5f73 7472 7563       self._struc
+0000d840: 7475 7265 7320 3d20 5f63 7265 6174 655f  tures = _create_
+0000d850: 656d 706f 7765 725f 6469 6d65 6e73 696f  empower_dimensio
+0000d860: 6e5f 7368 6f72 746e 616d 655f 7374 7275  n_shortname_stru
+0000d870: 6374 7572 655f 6469 6374 2864 696d 656e  cture_dict(dimen
+0000d880: 7369 6f6e 2020 2020 2020 3d20 7365 6c66  sion      = self
+0000d890: 2e64 696d 656e 7369 6f6e 0d0a 2020 2020  .dimension..    
 0000d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d8c0: 2020 2020 202c 6f6c 645f 7374 7275 6374       ,old_struct
-0000d8d0: 7572 6573 203d 2073 656c 662e 5f73 7472  ures = self._str
-0000d8e0: 7563 7475 7265 732e 7661 6c75 6573 2829  uctures.values()
-0000d8f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8f0: 202c 6f6c 645f 7374 7275 6374 7572 6573   ,old_structures
+0000d900: 203d 2073 656c 662e 5f73 7472 7563 7475   = self._structu
+0000d910: 7265 732e 7661 6c75 6573 2829 0d0a 2020  res.values()..  
 0000d920: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d940: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
-0000d950: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0000d960: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000d970: 6169 7365 206d 7065 782e 456d 706f 7765  aise mpex.Empowe
-0000d980: 7249 6d70 6f72 7465 7256 6572 7369 6f6e  rImporterVersion
-0000d990: 4572 726f 7228 2746 756e 6374 696f 6e61  Error('Functiona
-0000d9a0: 6c69 7479 206e 6f74 2061 7661 696c 6162  lity not availab
-0000d9b0: 6c65 2069 6e20 7468 6973 2045 6d70 6f77  le in this Empow
-0000d9c0: 6572 2049 6d70 6f72 7465 7220 7665 7273  er Importer vers
-0000d9d0: 696f 6e20 7b7d 206e 6565 6420 6174 206c  ion {} need at l
-0000d9e0: 6561 7374 207b 7d27 2e66 6f72 6d61 7428  east {}'.format(
-0000d9f0: 272e 272e 6a6f 696e 285b 7374 7228 7629  '.'.join([str(v)
-0000da00: 2066 6f72 2076 2069 6e20 7365 6c66 2e64   for v in self.d
-0000da10: 696d 656e 7369 6f6e 2e73 6974 652e 696d  imension.site.im
-0000da20: 706f 7274 6572 5f76 6572 7369 6f6e 5d29  porter_version])
-0000da30: 2c20 2739 2e35 2e31 372e 3138 3934 2729  , '9.5.17.1894')
-0000da40: 290d 0a20 2020 2020 2020 2065 7863 6570  )..        excep
-0000da50: 7420 4578 6365 7074 696f 6e3a 0d0a 2020  t Exception:..  
-0000da60: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000da70: 7374 7275 6374 7572 6573 5f72 6561 6420  structures_read 
-0000da80: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-0000da90: 2020 2020 2072 6169 7365 0d0a 0d0a 0d0a       raise......
-0000daa0: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
-0000dab0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0000dac0: 2072 6574 7572 6e20 277b 7d20 6672 6f6d   return '{} from
-0000dad0: 203c 7b7d 206f 626a 6563 7420 6174 207b   <{} object at {
-0000dae0: 7d3e 272e 666f 726d 6174 2827 7b27 202b  }>'.format('{' +
-0000daf0: 2027 5c6e 272e 6a6f 696e 285b 2022 277b   '\n'.join([ "'{
-0000db00: 7d27 3a7b 7d22 2e66 6f72 6d61 7428 6b2c  }':{}".format(k,
-0000db10: 7265 7072 2876 2929 2066 6f72 206b 2c76  repr(v)) for k,v
-0000db20: 2069 6e20 7365 6c66 2e69 7465 6d73 2829   in self.items()
-0000db30: 5d29 202b 2027 7d27 2c73 656c 662e 5f5f  ]) + '}',self.__
-0000db40: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-0000db50: 2c68 6578 2869 6428 7365 6c66 2929 2029  ,hex(id(self)) )
-0000db60: 0d0a 0d0a 636c 6173 7320 5f48 6965 7261  ....class _Hiera
-0000db70: 7263 6869 6573 4765 7474 6572 286f 626a  rchiesGetter(obj
-0000db80: 6563 7429 3a0d 0a20 2020 2027 2727 446f  ect):..    '''Do
-0000db90: 6573 2061 2062 6974 206f 6620 6d61 6769  es a bit of magi
-0000dba0: 6320 746f 2061 6c6c 6f77 2053 7472 7563  c to allow Struc
-0000dbb0: 7475 7265 7320 746f 2068 6176 6520 6869  tures to have hi
-0000dbc0: 6572 6172 6368 6965 7320 2869 2e65 2e20  erarchies (i.e. 
-0000dbd0: 726f 6f74 2073 7472 7563 7475 7265 7329  root structures)
-0000dbe0: 2061 7070 6561 7220 6c69 6b65 2061 2064   appear like a d
-0000dbf0: 6963 7469 6f6e 6172 7927 2727 0d0a 2020  ictionary'''..  
-0000dc00: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-0000dc10: 656c 662c 7374 7275 6374 7572 6529 3a0d  elf,structure):.
-0000dc20: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
-0000dc30: 7275 6374 7572 653d 7374 7275 6374 7572  ructure=structur
-0000dc40: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0000dc50: 636c 6561 7228 290d 0a0d 0a20 2020 2023  clear()....    #
-0000dc60: 556e 6c69 6b65 2061 2073 7461 6e64 6172  Unlike a standar
-0000dc70: 6420 6469 6374 696f 6e61 7279 2077 6869  d dictionary whi
-0000dc80: 6368 2072 6574 7572 6e73 206b 6579 7320  ch returns keys 
-0000dc90: 696e 2069 7465 722c 2072 6574 7572 6e20  in iter, return 
-0000dca0: 7661 6c75 6573 2028 7369 6e63 6520 7468  values (since th
-0000dcb0: 6174 2773 2077 6861 7420 7765 2075 7375  at's what we usu
-0000dcc0: 616c 6c79 2077 616e 7429 0d0a 2020 2020  ally want)..    
-0000dcd0: 6465 6620 5f5f 6974 6572 5f5f 2873 656c  def __iter__(sel
-0000dce0: 6629 3a0d 0a20 2020 2020 2020 2069 6620  f):..        if 
-0000dcf0: 6e6f 7420 7365 6c66 2e73 7472 7563 7475  not self.structu
-0000dd00: 7265 2e5f 6869 6572 6172 6368 6965 735f  re._hierarchies_
-0000dd10: 7265 6164 3a0d 0a20 2020 2020 2020 2020  read:..         
-0000dd20: 2020 2023 6c6f 672e 696e 666f 2827 5f6c     #log.info('_l
-0000dd30: 6f61 645f 7374 7275 6374 7572 6520 3630  oad_structure 60
-0000dd40: 3227 290d 0a20 2020 2020 2020 2020 2020  2')..           
-0000dd50: 2073 656c 662e 7374 7275 6374 7572 652e   self.structure.
-0000dd60: 6469 6d65 6e73 696f 6e2e 7374 7275 6374  dimension.struct
-0000dd70: 7572 6573 2e5f 6c6f 6164 5f73 7472 7563  ures._load_struc
-0000dd80: 7475 7265 2873 656c 662e 7374 7275 6374  ture(self.struct
-0000dd90: 7572 652e 7368 6f72 7463 6f64 6529 0d0a  ure.shortcode)..
-0000dda0: 2020 2020 2020 2020 7365 6c66 2e5f 6974          self._it
-0000ddb0: 6572 6174 6f72 203d 2069 7465 7228 7365  erator = iter(se
-0000ddc0: 6c66 2e5f 726f 6f74 5f65 6c65 6d65 6e74  lf._root_element
-0000ddd0: 732e 7661 6c75 6573 2829 290d 0a20 2020  s.values())..   
-0000dde0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000ddf0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6e65  ....    def __ne
-0000de00: 7874 5f5f 2873 656c 6629 3a0d 0a20 2020  xt__(self):..   
-0000de10: 2020 2020 2072 6574 7572 6e20 6e65 7874       return next
-0000de20: 2873 656c 662e 5f69 7465 7261 746f 7229  (self._iterator)
-0000de30: 0d0a 0d0a 0d0a 2020 2020 6465 6620 5f5f  ......    def __
-0000de40: 6765 7469 7465 6d5f 5f28 7365 6c66 2c69  getitem__(self,i
-0000de50: 7465 6d29 3a0d 0a20 2020 2020 2020 2023  tem):..        #
-0000de60: 6966 206e 6f74 2073 656c 662e 7374 7275  if not self.stru
-0000de70: 6374 7572 652e 5f68 6965 7261 7263 6869  cture._hierarchi
-0000de80: 6573 5f72 6561 643a 0d0a 2020 2020 2020  es_read:..      
-0000de90: 2020 2320 2020 2073 656c 662e 5f6c 6f61    #    self._loa
-0000dea0: 645f 7374 7275 6374 7572 6528 6974 656d  d_structure(item
-0000deb0: 290d 0a20 2020 2020 2020 2023 2020 2020  )..        #    
-0000dec0: 7365 6c66 2e5f 7374 7275 6374 7572 6573  self._structures
-0000ded0: 5b69 7465 6d5d 2e64 696d 656e 7369 6f6e  [item].dimension
-0000dee0: 3d73 656c 662e 6469 6d65 6e73 696f 6e0d  =self.dimension.
-0000def0: 0a20 2020 2020 2020 2068 6965 7220 3d20  .        hier = 
-0000df00: 7365 6c66 2e73 7472 7563 7475 7265 2e67  self.structure.g
-0000df10: 6574 5f72 6f6f 745f 656c 656d 656e 7428  et_root_element(
-0000df20: 6974 656d 290d 0a20 2020 2020 2020 2069  item)..        i
-0000df30: 6620 6869 6572 2069 7320 4e6f 6e65 3a0d  f hier is None:.
-0000df40: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000df50: 7365 204b 6579 4572 726f 7228 2753 7472  se KeyError('Str
-0000df60: 7563 7475 7265 456c 656d 656e 7420 7769  uctureElement wi
-0000df70: 7468 2073 686f 7274 636f 6465 207b 7d20  th shortcode {} 
-0000df80: 6973 206e 6f74 2069 6e20 6869 6572 6172  is not in hierar
-0000df90: 6368 6965 7320 2869 2e65 2e20 726f 6f74  chies (i.e. root
-0000dfa0: 2065 6c65 6d65 6e74 7329 206f 6620 5374   elements) of St
-0000dfb0: 7275 6374 7572 6520 7b7d 272e 666f 726d  ructure {}'.form
-0000dfc0: 6174 2869 7465 6d2c 7365 6c66 2e73 7472  at(item,self.str
-0000dfd0: 7563 7475 7265 2e73 686f 7274 636f 6465  ucture.shortcode
-0000dfe0: 2929 0d0a 2020 2020 2020 2020 7265 7475  ))..        retu
-0000dff0: 726e 2068 6965 720d 0a0d 0a20 2020 2064  rn hier....    d
-0000e000: 6566 205f 5f73 6574 6974 656d 5f5f 2873  ef __setitem__(s
-0000e010: 656c 662c 206b 6579 2c20 6974 656d 293a  elf, key, item):
-0000e020: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-0000e030: 7070 656e 6428 6974 656d 290d 0a0d 0a20  ppend(item).... 
-0000e040: 2020 2064 6566 2063 6c65 6172 2873 656c     def clear(sel
-0000e050: 6629 3a0d 0a20 2020 2020 2020 2073 656c  f):..        sel
-0000e060: 662e 5f72 6f6f 745f 656c 656d 656e 7473  f._root_elements
-0000e070: 3d63 6f6c 6c65 6374 696f 6e73 2e4f 7264  =collections.Ord
-0000e080: 6572 6564 4469 6374 2829 0d0a 2020 2020  eredDict()..    
-0000e090: 2020 2020 2349 6620 7765 2776 6520 636c      #If we've cl
-0000e0a0: 6561 7265 6420 6974 2c20 7765 2064 6f6e  eared it, we don
-0000e0b0: 2774 206e 6565 6420 746f 2072 6561 6420  't need to read 
-0000e0c0: 6974 2c20 7765 276c 6c20 6f6e 6c79 2061  it, we'll only a
-0000e0d0: 6363 6964 656e 7461 6c6c 7920 6f76 6572  ccidentally over
-0000e0e0: 7772 6974 6520 6f6e 2074 6865 2066 6972  write on the fir
-0000e0f0: 7374 2072 6561 6421 0d0a 2020 2020 2020  st read!..      
-0000e100: 2020 7365 6c66 2e73 7472 7563 7475 7265    self.structure
-0000e110: 2e5f 6869 6572 6172 6368 6965 735f 7265  ._hierarchies_re
-0000e120: 6164 203d 2054 7275 650d 0a0d 0a20 2020  ad = True....   
-0000e130: 2064 6566 2061 7070 656e 6428 7365 6c66   def append(self
-0000e140: 2c20 6974 656d 293a 0d0a 0d0a 0d0a 0d0a  , item):........
-0000e150: 2020 2020 2020 2020 5f69 7465 6d5f 6973          _item_is
-0000e160: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
-0000e170: 6e74 203d 2046 616c 7365 0d0a 2020 2020  nt = False..    
-0000e180: 2020 2020 5f69 7465 6d5f 6973 5f65 6c65      _item_is_ele
-0000e190: 6d65 6e74 203d 2046 616c 7365 0d0a 2020  ment = False..  
-0000e1a0: 2020 2020 2020 5f69 7465 6d5f 6973 5f73        _item_is_s
-0000e1b0: 686f 7274 636f 6465 203d 2046 616c 7365  hortcode = False
-0000e1c0: 0d0a 0d0a 2020 2020 2020 2020 6966 2069  ....        if i
-0000e1d0: 7369 6e73 7461 6e63 6528 6974 656d 2c20  sinstance(item, 
-0000e1e0: 7374 7229 3a0d 0a20 2020 2020 2020 2020  str):..         
-0000e1f0: 2020 205f 6974 656d 5f69 735f 7368 6f72     _item_is_shor
-0000e200: 7463 6f64 6520 3d20 5472 7565 0d0a 2020  tcode = True..  
-0000e210: 2020 2020 2020 656c 7365 3a0d 0a0d 0a20        else:.... 
-0000e220: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
-0000e230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e240: 2069 7465 6d2e 6973 5f72 6f6f 740d 0a20   item.is_root.. 
-0000e250: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-0000e260: 6974 656d 5f69 735f 7374 7275 6374 7572  item_is_structur
-0000e270: 655f 656c 656d 656e 7420 3d20 5472 7565  e_element = True
-0000e280: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-0000e290: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
-0000e2a0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-0000e2b0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-0000e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2d0: 6974 656d 2e5f 6d65 6173 7572 650d 0a20  item._measure.. 
-0000e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e2f0: 2020 205f 6974 656d 5f69 735f 656c 656d     _item_is_elem
-0000e300: 656e 7420 3d20 5472 7565 0d0a 2020 2020  ent = True..    
-0000e310: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0000e320: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
-0000e330: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-0000e340: 2020 2020 2020 2020 2369 6620 7468 6520          #if the 
-0000e350: 6974 656d 2069 7320 616e 2069 7465 7261  item is an itera
-0000e360: 626c 6520 2861 6e64 2069 736e 2774 2061  ble (and isn't a
-0000e370: 2073 7472 696e 6729 2c20 6170 7065 6e64   string), append
-0000e380: 2061 6c6c 2069 7465 6d73 2074 6f20 7365   all items to se
-0000e390: 6c66 0d0a 2020 2020 2020 2020 2020 2020  lf..            
-0000e3a0: 2020 2020 2020 2020 2354 6869 7320 7761          #This wa
-0000e3b0: 7920 7765 2063 616e 2061 6464 2061 206c  y we can add a l
-0000e3c0: 6973 7420 6f66 2074 6869 6e67 7320 746f  ist of things to
-0000e3d0: 2061 2068 6965 7261 7263 6879 0d0a 2020   a hierarchy..  
-0000e3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e3f0: 2020 2374 7279 3a0d 0a20 2020 2020 2020    #try:..       
-0000e400: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0000e410: 2073 7562 5f69 7465 6d20 696e 2069 7465   sub_item in ite
-0000e420: 6d3a 0d0a 2020 2020 2020 2020 2020 2020  m:..            
-0000e430: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000e440: 2e61 7070 656e 6428 7375 625f 6974 656d  .append(sub_item
-0000e450: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000e460: 2020 2020 2020 2072 6574 7572 6e0d 0a20         return.. 
-0000e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e480: 2020 2023 2357 6527 6c6c 2067 6574 2061     ##We'll get a
-0000e490: 2054 7970 6545 7272 6f72 2069 6620 7468   TypeError if th
-0000e4a0: 6520 6f62 6a65 6374 2069 7320 6e6f 7420  e object is not 
-0000e4b0: 6974 6572 6162 6c65 0d0a 2020 2020 2020  iterable..      
-0000e4c0: 2020 2020 2020 2020 2020 2020 2020 2365                #e
-0000e4d0: 7863 6570 7420 5479 7065 4572 726f 723a  xcept TypeError:
-0000e4e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000e4f0: 2020 2020 2020 2320 2020 2070 6173 730d        #    pass.
-0000e500: 0a0d 0a20 2020 2020 2020 2069 6620 5f69  ...        if _i
-0000e510: 7465 6d5f 6973 5f73 7472 7563 7475 7265  tem_is_structure
-0000e520: 5f65 6c65 6d65 6e74 3a0d 0a20 2020 2020  _element:..     
-0000e530: 2020 2020 2020 205f 7374 7275 6374 7572         _structur
-0000e540: 655f 656c 656d 656e 7420 3d20 6974 656d  e_element = item
-0000e550: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000e560: 205f 7374 7275 6374 7572 655f 656c 656d   _structure_elem
-0000e570: 656e 742e 7374 7275 6374 7572 6520 6973  ent.structure is
-0000e580: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0000e590: 2020 2020 2020 2020 2357 6520 6172 6520          #We are 
-0000e5a0: 7072 6f62 6162 6c79 2061 7070 656e 6469  probably appendi
-0000e5b0: 6e67 2061 2063 6f70 6965 6420 6869 6572  ng a copied hier
-0000e5c0: 6172 6368 7920 2d20 7365 7420 7468 6520  archy - set the 
-0000e5d0: 7374 7275 6374 7572 6520 7468 726f 7567  structure throug
-0000e5e0: 686f 7574 2074 6865 2074 7265 650d 0a20  hout the tree.. 
-0000e5f0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-0000e600: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-0000e610: 742e 7374 7275 6374 7572 6520 3d20 7365  t.structure = se
-0000e620: 6c66 2e73 7472 7563 7475 7265 0d0a 2020  lf.structure..  
-0000e630: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0000e640: 7220 6368 2069 6e20 5f73 7472 7563 7475  r ch in _structu
-0000e650: 7265 5f65 6c65 6d65 6e74 2e77 616c 6b28  re_element.walk(
-0000e660: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000e670: 2020 2020 2020 2020 6368 2e73 7472 7563          ch.struc
-0000e680: 7475 7265 203d 2073 656c 662e 7374 7275  ture = self.stru
-0000e690: 6374 7572 650d 0a0d 0a20 2020 2020 2020  cture....       
-0000e6a0: 2065 6c69 6620 5f69 7465 6d5f 6973 5f65   elif _item_is_e
-0000e6b0: 6c65 6d65 6e74 3a0d 0a20 2020 2020 2020  lement:..       
-0000e6c0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-0000e6d0: 2020 2020 2020 2020 2020 205f 7374 7275             _stru
-0000e6e0: 6374 7572 655f 656c 656d 656e 7420 3d20  cture_element = 
-0000e6f0: 7365 6c66 2e73 7472 7563 7475 7265 2e68  self.structure.h
-0000e700: 6965 7261 7263 6869 6573 5b69 7465 6d2e  ierarchies[item.
-0000e710: 7368 6f72 7463 6f64 655d 0d0a 2020 2020  shortcode]..    
-0000e720: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
-0000e730: 6e74 2869 7465 6d2e 7368 6f72 7463 6f64  nt(item.shortcod
-0000e740: 652c 205f 7374 7275 6374 7572 655f 656c  e, _structure_el
-0000e750: 656d 656e 7429 0d0a 2020 2020 2020 2020  ement)..        
-0000e760: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-0000e770: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-0000e780: 2020 2020 2020 5f73 7472 7563 7475 7265        _structure
-0000e790: 5f65 6c65 6d65 6e74 203d 2053 7472 7563  _element = Struc
-0000e7a0: 7475 7265 456c 656d 656e 7428 7374 7275  tureElement(stru
-0000e7b0: 6374 7572 653d 7365 6c66 2e73 7472 7563  cture=self.struc
-0000e7c0: 7475 7265 2c65 6c65 6d65 6e74 3d69 7465  ture,element=ite
-0000e7d0: 6d2c 6973 5f72 6f6f 743d 5472 7565 290d  m,is_root=True).
-0000e7e0: 0a0d 0a20 2020 2020 2020 2065 6c69 6620  ...        elif 
-0000e7f0: 5f69 7465 6d5f 6973 5f73 686f 7274 636f  _item_is_shortco
-0000e800: 6465 3a0d 0a20 2020 2020 2020 2020 2020  de:..           
-0000e810: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-0000e820: 2020 2020 2020 205f 7374 7275 6374 7572         _structur
-0000e830: 655f 656c 656d 656e 7420 3d20 7365 6c66  e_element = self
-0000e840: 2e73 7472 7563 7475 7265 2e68 6965 7261  .structure.hiera
-0000e850: 7263 6869 6573 5b69 7465 6d5d 0d0a 2020  rchies[item]..  
-0000e860: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0000e870: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
-0000e880: 2020 2020 2020 2020 2020 2020 5f65 6c65              _ele
-0000e890: 6d65 6e74 203d 2073 656c 662e 7374 7275  ment = self.stru
-0000e8a0: 6374 7572 652e 6469 6d65 6e73 696f 6e2e  cture.dimension.
-0000e8b0: 656c 656d 656e 7473 5b69 7465 6d5d 0d0a  elements[item]..
-0000e8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e8d0: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
-0000e8e0: 6e74 203d 2053 7472 7563 7475 7265 456c  nt = StructureEl
-0000e8f0: 656d 656e 7428 7374 7275 6374 7572 653d  ement(structure=
-0000e900: 7365 6c66 2e73 7472 7563 7475 7265 2c65  self.structure,e
-0000e910: 6c65 6d65 6e74 3d5f 656c 656d 656e 742c  lement=_element,
-0000e920: 6973 5f72 6f6f 743d 5472 7565 290d 0a0d  is_root=True)...
-0000e930: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000e940: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
-0000e950: 6e74 2e65 6c65 6d65 6e74 2e6d 6173 7465  nt.element.maste
-0000e960: 7265 643a 0d0a 2020 2020 2020 2020 2020  red:..          
-0000e970: 2020 7261 6973 6520 4174 7472 6962 7574    raise Attribut
-0000e980: 6545 7272 6f72 2827 4361 6e6e 6f74 2063  eError('Cannot c
-0000e990: 7265 6174 6520 6120 6869 6572 6172 6368  reate a hierarch
-0000e9a0: 7920 7769 7468 2075 6e2d 7379 6e63 6872  y with un-synchr
-0000e9b0: 6f6e 6973 6564 2045 6c65 6d65 6e74 207b  onised Element {
-0000e9c0: 7d20 7573 6520 4469 6d65 6e73 696f 6e2e  } use Dimension.
-0000e9d0: 656c 656d 656e 7473 2e73 796e 6368 726f  elements.synchro
-0000e9e0: 6e69 7365 2829 2062 6566 6f72 6520 6372  nise() before cr
-0000e9f0: 6561 7469 6e67 2074 6865 2068 6965 7261  eating the hiera
-0000ea00: 7263 6879 2729 0d0a 0d0a 0d0a 2020 2020  rchy')......    
-0000ea10: 2020 2020 5f73 7472 7563 7475 7265 5f65      _structure_e
-0000ea20: 6c65 6d65 6e74 2e69 735f 726f 6f74 203d  lement.is_root =
-0000ea30: 2054 7275 650d 0a0d 0a20 2020 2020 2020   True....       
-0000ea40: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-0000ea50: 2020 2073 656c 662e 5f72 6f6f 745f 656c     self._root_el
-0000ea60: 656d 656e 7473 2e70 6f70 285f 7374 7275  ements.pop(_stru
-0000ea70: 6374 7572 655f 656c 656d 656e 742e 7368  cture_element.sh
-0000ea80: 6f72 7463 6f64 6529 0d0a 2020 2020 2020  ortcode)..      
-0000ea90: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-0000eaa0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-0000eab0: 7061 7373 0d0a 0d0a 2020 2020 2020 2020  pass....        
-0000eac0: 7365 6c66 2e5f 726f 6f74 5f65 6c65 6d65  self._root_eleme
-0000ead0: 6e74 735b 5f73 7472 7563 7475 7265 5f65  nts[_structure_e
-0000eae0: 6c65 6d65 6e74 2e73 686f 7274 636f 6465  lement.shortcode
-0000eaf0: 5d20 3d20 5f73 7472 7563 7475 7265 5f65  ] = _structure_e
-0000eb00: 6c65 6d65 6e74 0d0a 0d0a 2020 2020 2344  lement....    #D
-0000eb10: 6566 696e 6520 7768 6174 2068 6170 7065  efine what happe
-0000eb20: 6e73 2077 6865 6e20 7765 2063 616c 6c20  ns when we call 
-0000eb30: 2b3d 0d0a 2020 2020 2357 6520 7761 6e74  +=..    #We want
-0000eb40: 2074 6f20 6170 7065 6e64 0d0a 2020 2020   to append..    
-0000eb50: 6465 6620 5f5f 6961 6464 5f5f 2873 656c  def __iadd__(sel
-0000eb60: 662c 6f74 6865 7229 3a0d 0a20 2020 2020  f,other):..     
-0000eb70: 2020 2073 656c 662e 6170 7065 6e64 2869     self.append(i
-0000eb80: 7465 6d3d 6f74 6865 7229 0d0a 2020 2020  tem=other)..    
-0000eb90: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
-0000eba0: 0a0d 0a20 2020 2023 4465 6669 6e65 2077  ...    #Define w
-0000ebb0: 6861 7420 6861 7070 656e 7320 7768 656e  hat happens when
-0000ebc0: 2077 6520 6361 6c6c 207c 3d0d 0a20 2020   we call |=..   
-0000ebd0: 2023 5765 2077 616e 7420 746f 2061 7070   #We want to app
-0000ebe0: 656e 6420 6966 2069 7420 646f 6573 6e27  end if it doesn'
-0000ebf0: 7420 6578 6973 7420 616c 7265 6164 790d  t exist already.
-0000ec00: 0a20 2020 2064 6566 205f 5f69 6f72 5f5f  .    def __ior__
-0000ec10: 2873 656c 662c 6f74 6865 7229 3a0d 0a20  (self,other):.. 
-0000ec20: 2020 2020 2020 2073 686f 7274 6e61 6d65         shortname
-0000ec30: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-0000ec40: 2069 6620 7374 7228 6f74 6865 7229 203d   if str(other) =
-0000ec50: 3d20 6f74 6865 723a 0d0a 2020 2020 2020  = other:..      
-0000ec60: 2020 2020 2020 7368 6f72 746e 616d 6520        shortname 
-0000ec70: 3d20 6f74 6865 720d 0a20 2020 2020 2020  = other..       
-0000ec80: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0000ec90: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-0000eca0: 2020 2020 2020 2020 2020 7368 6f72 746e            shortn
-0000ecb0: 616d 6520 3d20 6f74 6865 722e 7368 6f72  ame = other.shor
-0000ecc0: 746e 616d 650d 0a20 2020 2020 2020 2020  tname..         
-0000ecd0: 2020 2065 7863 6570 7420 4174 7472 6962     except Attrib
-0000ece0: 7574 6545 7272 6f72 3a0d 0a20 2020 2020  uteError:..     
-0000ecf0: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
-0000ed00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ed10: 2020 2020 2066 6f72 2065 6c20 696e 206f       for el in o
-0000ed20: 7468 6572 3a0d 0a20 2020 2020 2020 2020  ther:..         
-0000ed30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000ed40: 656c 6620 7c3d 2065 6c0d 0a20 2020 2020  elf |= el..     
-0000ed50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000ed60: 6574 7572 6e20 7365 6c66 0d0a 2020 2020  eturn self..    
-0000ed70: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0000ed80: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
-0000ed90: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-0000eda0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-0000edb0: 7065 4572 726f 7228 2275 6e73 7570 706f  peError("unsuppo
-0000edc0: 7274 6564 206f 7065 7261 6e64 2074 7970  rted operand typ
-0000edd0: 6573 2873 2920 666f 7220 7c3d 3a20 275f  es(s) for |=: '_
-0000ede0: 4869 6572 6172 6368 6965 7347 6574 7465  HierarchiesGette
-0000edf0: 7227 2061 6e64 2027 7b7d 2722 2e66 6f72  r' and '{}'".for
-0000ee00: 6d61 7428 7479 7065 286f 7468 6572 2929  mat(type(other))
-0000ee10: 290d 0a0d 0a20 2020 2020 2020 2074 7279  )....        try
-0000ee20: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0000ee30: 656c 665b 7368 6f72 746e 616d 655d 0d0a  elf[shortname]..
-0000ee40: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-0000ee50: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
-0000ee60: 2020 2020 2020 7365 6c66 2e61 7070 656e        self.appen
-0000ee70: 6428 6974 656d 3d6f 7468 6572 290d 0a20  d(item=other).. 
-0000ee80: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000ee90: 6c66 0d0a 0d0a 0d0a 2020 2020 6465 6620  lf......    def 
-0000eea0: 6b65 7973 2873 656c 6629 3a0d 0a20 2020  keys(self):..   
-0000eeb0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-0000eec0: 2e73 7472 7563 7475 7265 2e5f 6869 6572  .structure._hier
-0000eed0: 6172 6368 6965 735f 7265 6164 3a0d 0a20  archies_read:.. 
-0000eee0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000eef0: 7374 7275 6374 7572 652e 6469 6d65 6e73  structure.dimens
-0000ef00: 696f 6e2e 7374 7275 6374 7572 6573 2e5f  ion.structures._
-0000ef10: 6c6f 6164 5f73 7472 7563 7475 7265 2873  load_structure(s
-0000ef20: 656c 662e 7374 7275 6374 7572 652e 7368  elf.structure.sh
-0000ef30: 6f72 7463 6f64 652c 6f6c 645f 7374 7275  ortcode,old_stru
-0000ef40: 6374 7572 6520 3d20 7365 6c66 2e73 7472  cture = self.str
-0000ef50: 7563 7475 7265 290d 0a0d 0a20 2020 2020  ucture)....     
-0000ef60: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0000ef70: 726f 6f74 5f65 6c65 6d65 6e74 732e 6b65  root_elements.ke
-0000ef80: 7973 2829 0d0a 0d0a 2020 2020 6465 6620  ys()....    def 
-0000ef90: 6974 656d 7328 7365 6c66 293a 0d0a 2020  items(self):..  
-0000efa0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0000efb0: 662e 7374 7275 6374 7572 652e 5f68 6965  f.structure._hie
-0000efc0: 7261 7263 6869 6573 5f72 6561 643a 0d0a  rarchies_read:..
-0000efd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000efe0: 2e73 7472 7563 7475 7265 2e64 696d 656e  .structure.dimen
-0000eff0: 7369 6f6e 2e73 7472 7563 7475 7265 732e  sion.structures.
-0000f000: 5f6c 6f61 645f 7374 7275 6374 7572 6528  _load_structure(
-0000f010: 7365 6c66 2e73 7472 7563 7475 7265 2e73  self.structure.s
-0000f020: 686f 7274 636f 6465 2c6f 6c64 5f73 7472  hortcode,old_str
-0000f030: 7563 7475 7265 203d 2073 656c 662e 7374  ucture = self.st
-0000f040: 7275 6374 7572 6529 0d0a 0d0a 2020 2020  ructure)....    
-0000f050: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000f060: 5f72 6f6f 745f 656c 656d 656e 7473 2e69  _root_elements.i
-0000f070: 7465 6d73 2829 0d0a 0d0a 2020 2020 6465  tems()....    de
-0000f080: 6620 7661 6c75 6573 2873 656c 6629 3a0d  f values(self):.
-0000f090: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000f0a0: 7365 6c66 2e73 7472 7563 7475 7265 2e5f  self.structure._
-0000f0b0: 6869 6572 6172 6368 6965 735f 7265 6164  hierarchies_read
-0000f0c0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0000f0d0: 656c 662e 7374 7275 6374 7572 652e 6469  elf.structure.di
-0000f0e0: 6d65 6e73 696f 6e2e 7374 7275 6374 7572  mension.structur
-0000f0f0: 6573 2e5f 6c6f 6164 5f73 7472 7563 7475  es._load_structu
-0000f100: 7265 2873 656c 662e 7374 7275 6374 7572  re(self.structur
-0000f110: 652e 7368 6f72 7463 6f64 652c 6f6c 645f  e.shortcode,old_
-0000f120: 7374 7275 6374 7572 6520 3d20 7365 6c66  structure = self
-0000f130: 2e73 7472 7563 7475 7265 290d 0a0d 0a20  .structure).... 
-0000f140: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000f150: 6c66 2e5f 726f 6f74 5f65 6c65 6d65 6e74  lf._root_element
-0000f160: 732e 7661 6c75 6573 2829 0d0a 0d0a 2020  s.values()....  
-0000f170: 2020 6465 6620 5f5f 6c65 6e5f 5f28 7365    def __len__(se
-0000f180: 6c66 293a 0d0a 0d0a 2020 2020 2020 2020  lf):....        
-0000f190: 7265 7475 726e 206c 656e 2873 656c 662e  return len(self.
-0000f1a0: 5f72 6f6f 745f 656c 656d 656e 7473 290d  _root_elements).
-0000f1b0: 0a0d 0a20 2020 2064 6566 205f 5f73 7472  ...    def __str
-0000f1c0: 5f5f 2873 656c 6629 3a0d 0a0d 0a20 2020  __(self):....   
-0000f1d0: 2020 2020 2072 6574 7572 6e20 277b 2720       return '{' 
-0000f1e0: 2b20 275c 6e27 2e6a 6f69 6e28 5b20 2227  + '\n'.join([ "'
-0000f1f0: 7b7d 273a 7b7d 222e 666f 726d 6174 286b  {}':{}".format(k
-0000f200: 2c72 6570 7228 7629 2920 666f 7220 6b2c  ,repr(v)) for k,
-0000f210: 7620 696e 2073 656c 662e 5f72 6f6f 745f  v in self._root_
-0000f220: 656c 656d 656e 7473 2e69 7465 6d73 2829  elements.items()
-0000f230: 5d29 202b 2027 7d27 0d0a 0d0a 0d0a 2020  ]) + '}'......  
-0000f240: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
-0000f250: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
-0000f260: 6574 7572 6e20 277b 7d20 6672 6f6d 203c  eturn '{} from <
-0000f270: 7b7d 206f 626a 6563 7420 6174 207b 7d3e  {} object at {}>
-0000f280: 272e 666f 726d 6174 2827 7b27 202b 2027  '.format('{' + '
-0000f290: 5c6e 272e 6a6f 696e 285b 2022 277b 7d27  \n'.join([ "'{}'
-0000f2a0: 3a7b 7d22 2e66 6f72 6d61 7428 6b2c 7265  :{}".format(k,re
-0000f2b0: 7072 2876 2929 2066 6f72 206b 2c76 2069  pr(v)) for k,v i
-0000f2c0: 6e20 7365 6c66 2e69 7465 6d73 2829 5d29  n self.items()])
-0000f2d0: 202b 2027 7d27 2c73 656c 662e 5f5f 636c   + '}',self.__cl
-0000f2e0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c68  ass__.__name__,h
-0000f2f0: 6578 2869 6428 7365 6c66 2929 2029 0d0a  ex(id(self)) )..
-0000f300: 0d0a 2020 2020 2354 4f44 4f0d 0a20 2020  ..    #TODO..   
-0000f310: 2023 205f 5f61 6464 5f5f 0d0a 2020 2020   # __add__..    
-0000f320: 2320 616e 640d 0a20 2020 2023 205f 5f72  # and..    # __r
-0000f330: 6164 645f 5f0d 0a0d 0a63 6c61 7373 2053  add__....class S
-0000f340: 7472 7563 7475 7265 456c 656d 656e 7443  tructureElementC
-0000f350: 6869 6c64 7265 6e28 6f62 6a65 6374 293a  hildren(object):
-0000f360: 0d0a 2020 2020 2727 2754 6865 206f 626a  ..    '''The obj
-0000f370: 6563 7420 7265 7475 726e 6564 2062 7920  ect returned by 
-0000f380: 6120 6361 6c6c 2074 6f20 5374 7275 6374  a call to Struct
-0000f390: 7572 6545 6c65 6d65 6e74 2e63 6869 6c64  ureElement.child
-0000f3a0: 7265 6e0d 0a20 2020 2044 6f65 7320 6120  ren..    Does a 
-0000f3b0: 6269 7420 6f66 206d 6167 6963 2074 6f20  bit of magic to 
-0000f3c0: 616c 6c6f 7720 5374 7275 6374 7572 6545  allow StructureE
-0000f3d0: 6c65 6d65 6e74 732e 6368 696c 6472 656e  lements.children
-0000f3e0: 2074 6f20 6170 7065 6172 206c 696b 6520   to appear like 
-0000f3f0: 6120 6469 6374 696f 6e61 7279 2c20 6f6e  a dictionary, on
-0000f400: 6c79 2077 6974 6820 6578 7472 6120 7370  ly with extra sp
-0000f410: 6563 6961 6c20 6675 6e63 7469 6f6e 7320  ecial functions 
-0000f420: 6c69 6b65 202b 3d20 2727 270d 0a0d 0a20  like += '''.... 
-0000f430: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0000f440: 7365 6c66 2c73 7472 7563 7475 7265 5f65  self,structure_e
-0000f450: 6c65 6d65 6e74 293a 0d0a 2020 2020 2020  lement):..      
-0000f460: 2020 2727 2749 7420 6973 2075 6e6c 696b    '''It is unlik
-0000f470: 656c 7920 7468 6174 2061 2075 7365 7220  ely that a user 
-0000f480: 6f66 2050 794d 5058 2077 6f75 6c64 2077  of PyMPX would w
-0000f490: 616e 7420 746f 2069 6e69 7469 616c 6973  ant to initialis
-0000f4a0: 6520 6120 5374 7275 6374 7572 6545 6c65  e a StructureEle
-0000f4b0: 6d65 6e74 4368 696c 6472 656e 206f 626a  mentChildren obj
-0000f4c0: 6563 7420 6469 7265 6374 6c79 2e0d 0a20  ect directly... 
-0000f4d0: 2020 2020 2020 2054 6869 7320 6f62 6a65         This obje
-0000f4e0: 6374 2069 7320 7573 7561 6c6c 7920 7265  ct is usually re
-0000f4f0: 7475 726e 6564 2062 7920 6361 6c6c 696e  turned by callin
-0000f500: 6720 652e 672e 206d 795f 7374 7275 6374  g e.g. my_struct
-0000f510: 7572 655f 656c 656d 656e 742e 6368 696c  ure_element.chil
-0000f520: 6472 656e 0d0a 0d0a 2020 2020 2020 2020  dren....        
-0000f530: 3a70 6172 616d 2073 7472 7563 7475 7265  :param structure
-0000f540: 5f65 6c65 6d65 6e74 3a20 5468 6520 5374  _element: The St
-0000f550: 7275 6374 7572 6545 6c65 6d65 6e74 2074  ructureElement t
-0000f560: 6861 7420 7468 6520 6368 696c 6472 656e  hat the children
-0000f570: 2077 696c 6c20 6265 6c6f 6e67 2074 6f0d   will belong to.
-0000f580: 0a20 2020 2020 2020 2027 2727 0d0a 0d0a  .        '''....
-0000f590: 2020 2020 2020 2020 7365 6c66 2e5f 7374          self._st
-0000f5a0: 7275 6374 7572 655f 656c 656d 656e 7420  ructure_element 
-0000f5b0: 2020 2020 2020 2020 203d 2073 7472 7563           = struc
-0000f5c0: 7475 7265 5f65 6c65 6d65 6e74 0d0a 0d0a  ture_element....
-0000f5d0: 2020 2020 2354 6865 2053 7472 7563 7475      #The Structu
-0000f5e0: 7265 456c 656d 656e 7443 6869 6c64 7265  reElementChildre
-0000f5f0: 6e20 6861 7320 7468 6520 756e 666f 7274  n has the unfort
-0000f600: 756e 6174 6520 7072 6f70 6572 7479 206f  unate property o
-0000f610: 6620 6265 6861 7669 6e67 206c 696b 6520  f behaving like 
-0000f620: 626f 7468 2061 206c 6973 7420 6974 6572  both a list iter
-0000f630: 6174 6f72 2061 6e64 2061 2064 6963 7469  ator and a dicti
-0000f640: 6f6e 6172 790d 0a20 2020 2023 4974 2773  onary..    #It's
-0000f650: 2061 2062 6974 206f 6620 6120 6d65 7373   a bit of a mess
-0000f660: 0d0a 2020 2020 6465 6620 5f5f 6974 6572  ..    def __iter
-0000f670: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
-0000f680: 2020 2073 656c 662e 5f69 7465 7261 746f     self._iterato
-0000f690: 7220 3d20 6974 6572 2873 656c 662e 7661  r = iter(self.va
-0000f6a0: 6c75 6573 2829 290d 0a20 2020 2020 2020  lues())..       
-0000f6b0: 2072 6574 7572 6e20 7365 6c66 0d0a 0d0a   return self....
-0000f6c0: 2020 2020 6465 6620 5f5f 6e65 7874 5f5f      def __next__
-0000f6d0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0000f6e0: 2072 6574 7572 6e20 6e65 7874 2873 656c   return next(sel
-0000f6f0: 662e 5f69 7465 7261 746f 7229 0d0a 0d0a  f._iterator)....
-0000f700: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
-0000f710: 6d5f 5f28 7365 6c66 2c6b 6579 293a 0d0a  m__(self,key):..
-0000f720: 2020 2020 2020 2020 666f 7220 6e2c 656c          for n,el
-0000f730: 2069 6e20 656e 756d 6572 6174 6528 7365   in enumerate(se
-0000f740: 6c66 2e5f 7374 7275 6374 7572 655f 656c  lf._structure_el
-0000f750: 656d 656e 742e 5f63 6869 6c64 5f73 7472  ement._child_str
-0000f760: 7563 7475 7265 5f65 6c65 6d65 6e74 735b  ucture_elements[
-0000f770: 3a3a 2d31 5d29 3a0d 0a20 2020 2020 2020  ::-1]):..       
-0000f780: 2020 2020 2069 6620 656c 2e73 686f 7274       if el.short
-0000f790: 6e61 6d65 203d 3d20 6b65 793a 0d0a 2020  name == key:..  
-0000f7a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000f7b0: 7475 726e 2065 6c0d 0a0d 0a20 2020 2020  turn el....     
-0000f7c0: 2020 2072 6169 7365 204b 6579 4572 726f     raise KeyErro
-0000f7d0: 7228 2753 7472 7563 7475 7265 456c 656d  r('StructureElem
-0000f7e0: 656e 7420 7b7d 2064 6f65 7320 6e6f 7420  ent {} does not 
-0000f7f0: 636f 6e74 6169 6e20 6120 6368 696c 6420  contain a child 
-0000f800: 7769 7468 2073 686f 7274 6e61 6d65 207b  with shortname {
-0000f810: 7d27 2e66 6f72 6d61 7428 7365 6c66 2e5f  }'.format(self._
-0000f820: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-0000f830: 742e 7061 7468 2c6b 6579 2929 0d0a 0d0a  t.path,key))....
-0000f840: 2020 2020 6465 6620 5f5f 7365 7469 7465      def __setite
-0000f850: 6d5f 5f28 7365 6c66 2c20 6b65 792c 2069  m__(self, key, i
-0000f860: 7465 6d29 3a0d 0a20 2020 2020 2020 2027  tem):..        '
-0000f870: 2727 5365 7420 7468 6520 6669 6e61 6c20  ''Set the final 
-0000f880: 656c 656d 656e 7420 696e 2074 6865 2063  element in the c
-0000f890: 6869 6c64 7265 6e20 7769 7468 206b 6579  hildren with key
-0000f8a0: 2073 686f 7274 636f 6465 2074 6f20 7468   shortcode to th
-0000f8b0: 6520 6974 656d 2076 616c 7565 0d0a 2020  e item value..  
-0000f8c0: 2020 2020 2020 4966 2074 6865 2069 7465        If the ite
-0000f8d0: 6d20 656c 656d 656e 7420 6973 206e 6f74  m element is not
-0000f8e0: 2069 6e20 7468 6520 6368 696c 6472 656e   in the children
-0000f8f0: 2074 6865 6e20 6164 6420 6974 2727 270d   then add it'''.
-0000f900: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000f910: 6973 696e 7374 616e 6365 2869 7465 6d2c  isinstance(item,
-0000f920: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-0000f930: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0000f940: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000f950: 2822 5374 7275 6374 7572 6545 6c65 6d65  ("StructureEleme
-0000f960: 6e74 2063 6869 6c64 7265 6e20 6361 6e20  nt children can 
-0000f970: 6f6e 6c79 2062 6520 7365 7420 7573 696e  only be set usin
-0000f980: 6720 7468 6520 6469 6374 696f 6e61 7279  g the dictionary
-0000f990: 2073 796e 7461 7820 746f 2061 6e6f 7468   syntax to anoth
-0000f9a0: 6572 2053 7472 7563 7475 7265 456c 656d  er StructureElem
-0000f9b0: 656e 742e 2059 6f75 2063 616c 6c65 6420  ent. You called 
-0000f9c0: 7b7d 5b27 7b7d 275d 203d 207b 7d2c 2061  {}['{}'] = {}, a
-0000f9d0: 7474 656d 7074 696e 6720 746f 2073 6574  ttempting to set
-0000f9e0: 2074 6865 2063 6869 6c64 2074 6f20 616e   the child to an
-0000f9f0: 206f 626a 6563 7420 6f66 2074 7970 6520   object of type 
-0000fa00: 7b7d 222e 666f 726d 6174 2872 6570 7228  {}".format(repr(
-0000fa10: 7365 6c66 292c 7265 7072 286b 6579 292c  self),repr(key),
-0000fa20: 7265 7072 2869 7465 6d29 2c74 7970 6528  repr(item),type(
-0000fa30: 6974 656d 2929 290d 0a0d 0a20 2020 2020  item)))....     
-0000fa40: 2020 2069 6620 6e6f 7420 6b65 7920 3d3d     if not key ==
-0000fa50: 2069 7465 6d2e 7368 6f72 746e 616d 653a   item.shortname:
-0000fa60: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-0000fa70: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-0000fa80: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-0000fa90: 2063 6869 6c64 7265 6e20 6361 6e20 6f6e   children can on
-0000faa0: 6c79 2062 6520 7365 7420 7573 696e 6720  ly be set using 
-0000fab0: 7468 6520 6469 6374 696f 6e61 7279 2073  the dictionary s
-0000fac0: 796e 7461 7820 746f 2061 2053 7472 7563  yntax to a Struc
-0000fad0: 7475 7265 456c 656d 656e 7420 7769 7468  tureElement with
-0000fae0: 2074 6865 2073 616d 6520 7368 6f72 7463   the same shortc
-0000faf0: 6f64 6520 6173 2074 6865 206b 6579 2e20  ode as the key. 
-0000fb00: 596f 7520 6361 6c6c 6564 207b 7d5b 277b  You called {}['{
-0000fb10: 7d27 5d20 3d20 7b7d 2c20 6174 7465 6d70  }'] = {}, attemp
-0000fb20: 7469 6e67 2074 6f20 7365 7420 7468 6520  ting to set the 
-0000fb30: 6368 696c 6420 746f 2061 2053 7472 7563  child to a Struc
-0000fb40: 7475 7265 456c 656d 656e 7420 7769 7468  tureElement with
-0000fb50: 2073 686f 7274 6e61 6d65 207b 7d22 2e66   shortname {}".f
-0000fb60: 6f72 6d61 7428 7265 7072 2873 656c 6629  ormat(repr(self)
-0000fb70: 2c72 6570 7228 6b65 7929 2c72 6570 7228  ,repr(key),repr(
-0000fb80: 6974 656d 292c 6974 656d 2e73 686f 7274  item),item.short
-0000fb90: 6e61 6d65 2929 0d0a 0d0a 0d0a 2020 2020  name))......    
-0000fba0: 2020 2020 2349 6620 7468 6520 6974 656d      #If the item
-0000fbb0: 2069 7320 616c 7265 6164 7920 696e 2074   is already in t
-0000fbc0: 6865 2064 6963 7469 6f6e 6172 792c 2073  he dictionary, s
-0000fbd0: 7761 7020 6974 206f 7574 2066 6f72 2074  wap it out for t
-0000fbe0: 6865 206e 6577 206f 6e65 0d0a 2020 2020  he new one..    
-0000fbf0: 2020 2020 236f 7468 6572 7769 7365 2061      #otherwise a
-0000fc00: 6464 2069 7420 6f6e 2074 6865 2065 6e64  dd it on the end
-0000fc10: 0d0a 0d0a 2020 2020 2020 2020 656c 656d  ....        elem
-0000fc20: 656e 745f 666f 756e 6420 3d20 4661 6c73  ent_found = Fals
-0000fc30: 650d 0a20 2020 2020 2020 2066 6f72 206e  e..        for n
-0000fc40: 2c65 6c20 696e 2065 6e75 6d65 7261 7465  ,el in enumerate
-0000fc50: 2873 656c 662e 5f73 7472 7563 7475 7265  (self._structure
-0000fc60: 5f65 6c65 6d65 6e74 2e5f 6368 696c 645f  _element._child_
-0000fc70: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-0000fc80: 7473 5b3a 3a2d 315d 293a 0d0a 2020 2020  ts[::-1]):..    
-0000fc90: 2020 2020 2020 2020 6966 2065 6c2e 7368          if el.sh
-0000fca0: 6f72 746e 616d 6520 3d3d 206b 6579 3a0d  ortname == key:.
-0000fcb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fcc0: 2073 656c 662e 5f73 7472 7563 7475 7265   self._structure
-0000fcd0: 5f65 6c65 6d65 6e74 2e5f 6368 696c 645f  _element._child_
-0000fce0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-0000fcf0: 7473 5b2d 2831 2b6e 295d 203d 2069 7465  ts[-(1+n)] = ite
-0000fd00: 6d0d 0a20 2020 2020 2020 2020 2020 2020  m..             
-0000fd10: 2020 2065 6c65 6d65 6e74 5f66 6f75 6e64     element_found
-0000fd20: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-0000fd30: 2020 2020 2020 2020 2062 7265 616b 0d0a           break..
-0000fd40: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0000fd50: 2065 6c65 6d65 6e74 5f66 6f75 6e64 3a0d   element_found:.
-0000fd60: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000fd70: 662e 6170 7065 6e64 2869 7465 6d29 0d0a  f.append(item)..
-0000fd80: 0d0a 2020 2020 6465 6620 6170 7065 6e64  ..    def append
-0000fd90: 2873 656c 662c 2069 7465 6d2c 206d 6572  (self, item, mer
-0000fda0: 6765 203d 2046 616c 7365 293a 0d0a 2020  ge = False):..  
-0000fdb0: 2020 2020 2020 2727 2741 6464 2061 2063        '''Add a c
-0000fdc0: 6869 6c64 2053 7472 7563 7475 7265 456c  hild StructureEl
-0000fdd0: 656d 656e 7420 746f 2074 6865 2063 6869  ement to the chi
-0000fde0: 6c64 7265 6e2e 0d0a 0d0a 2020 2020 2020  ldren.....      
-0000fdf0: 2020 3a70 6172 616d 2069 7465 6d3a 2053    :param item: S
-0000fe00: 7065 6369 6669 6361 7469 6f6e 206f 6620  pecification of 
-0000fe10: 7468 6520 6368 696c 6420 5374 7275 6374  the child Struct
-0000fe20: 7572 6545 6c65 6d65 6e74 2074 6f20 6562  ureElement to eb
-0000fe30: 2061 6464 6564 2e20 5661 6c69 6420 7661   added. Valid va
-0000fe40: 6c65 7573 2061 7265 2061 2053 7472 7563  leus are a Struc
-0000fe50: 7475 7265 456c 656d 656e 742c 2061 6e20  tureElement, an 
-0000fe60: 456c 656d 656e 7420 6f72 2061 2073 686f  Element or a sho
-0000fe70: 7274 6e61 6d65 2073 7472 696e 672c 2072  rtname string, r
-0000fe80: 6566 6572 696e 6720 746f 2061 6e20 456c  efering to an El
-0000fe90: 656d 656e 7420 696e 2074 6865 2044 696d  ement in the Dim
-0000fea0: 656e 7369 6f6e 2074 6861 7420 7468 6973  ension that this
-0000feb0: 2053 7472 7563 7475 7265 2062 656c 6f6e   Structure belon
-0000fec0: 6773 2074 6f2e 0d0a 2020 2020 2020 2020  gs to...        
-0000fed0: 2727 270d 0a0d 0a20 2020 2020 2020 205f  '''....        _
-0000fee0: 6974 656d 5f69 735f 7374 7275 6374 7572  item_is_structur
-0000fef0: 655f 656c 656d 656e 7420 3d20 4661 6c73  e_element = Fals
-0000ff00: 650d 0a20 2020 2020 2020 205f 6974 656d  e..        _item
-0000ff10: 5f69 735f 656c 656d 656e 7420 3d20 4661  _is_element = Fa
-0000ff20: 6c73 650d 0a20 2020 2020 2020 205f 6974  lse..        _it
-0000ff30: 656d 5f69 735f 7368 6f72 7463 6f64 6520  em_is_shortcode 
-0000ff40: 3d20 4661 6c73 650d 0a0d 0a20 2020 2020  = False....     
-0000ff50: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000ff60: 2869 7465 6d2c 2073 7472 293a 0d0a 2020  (item, str):..  
-0000ff70: 2020 2020 2020 2020 2020 5f69 7465 6d5f            _item_
-0000ff80: 6973 5f73 686f 7274 636f 6465 203d 2054  is_shortcode = T
-0000ff90: 7275 650d 0a20 2020 2020 2020 2065 6c73  rue..        els
-0000ffa0: 653a 0d0a 0d0a 2020 2020 2020 2020 2020  e:....          
-0000ffb0: 2020 2369 6620 7468 6520 6974 656d 2069    #if the item i
-0000ffc0: 7320 616e 2069 7465 7261 626c 6520 2861  s an iterable (a
-0000ffd0: 6e64 2069 736e 2774 2061 2073 7472 696e  nd isn't a strin
-0000ffe0: 6729 2c20 6170 7065 6e64 2061 6c6c 2069  g), append all i
-0000fff0: 7465 6d73 2074 6f20 7365 6c66 0d0a 2020  tems to self..  
-00010000: 2020 2020 2020 2020 2020 2354 6869 7320            #This 
-00010010: 7761 7920 7765 2063 616e 2061 6464 2061  way we can add a
-00010020: 206c 6973 7420 6f66 2074 6869 6e67 7320   list of things 
-00010030: 746f 2061 2068 6965 7261 7263 6879 0d0a  to a hierarchy..
-00010040: 2020 2020 2020 2020 2020 2020 6974 656d              item
-00010050: 7320 3d20 4e6f 6e65 0d0a 2020 2020 2020  s = None..      
-00010060: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00010070: 2020 2020 2020 2020 2020 2020 2354 7279              #Try
-00010080: 2074 7265 6174 696e 6720 7468 6520 6974   treating the it
-00010090: 656d 2061 7320 6120 6c69 7374 2028 6e6f  em as a list (no
-000100a0: 7720 7468 6174 2077 6520 6b6e 6f77 2069  w that we know i
-000100b0: 7420 6973 206e 6f74 2061 2073 7472 696e  t is not a strin
-000100c0: 6729 0d0a 2020 2020 2020 2020 2020 2020  g)..            
-000100d0: 2020 2020 2341 6e64 2061 7070 656e 6469      #And appendi
-000100e0: 6e67 2065 6163 6820 6f66 2074 6865 206d  ng each of the m
-000100f0: 656d 6265 7273 2069 6e20 7475 726e 0d0a  embers in turn..
-00010100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010110: 6974 656d 7320 3d20 5b65 6c20 666f 7220  items = [el for 
-00010120: 656c 2069 6e20 6974 656d 5d0d 0a20 2020  el in item]..   
-00010130: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00010140: 5479 7065 4572 726f 723a 0d0a 2020 2020  TypeError:..    
-00010150: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00010160: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00010170: 6966 2069 7465 6d73 2069 7320 6e6f 7420  if items is not 
-00010180: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00010190: 2020 2020 2020 2066 6f72 2065 6c20 696e         for el in
-000101a0: 2069 7465 6d3a 0d0a 2020 2020 2020 2020   item:..        
-000101b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000101c0: 2e61 7070 656e 6428 656c 2c6d 6572 6765  .append(el,merge
-000101d0: 3d6d 6572 6765 290d 0a20 2020 2020 2020  =merge)..       
-000101e0: 2020 2020 2020 2020 2023 5265 7475 726e           #Return
-000101f0: 206f 6e63 6520 7765 2776 6520 6170 7065   once we've appe
-00010200: 6e64 6564 2065 7665 7279 2065 6c65 6d65  nded every eleme
-00010210: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-00010220: 2020 2020 7265 7475 726e 0d0a 0d0a 2020      return....  
-00010230: 2020 2020 2020 2020 2020 2349 6620 7765            #If we
-00010240: 2067 6f74 2074 6869 7320 6661 7220 7468   got this far th
-00010250: 656e 2069 7465 6d20 6973 206e 6f74 2061  en item is not a
-00010260: 2073 7472 696e 6720 2869 2e65 2e20 7368   string (i.e. sh
-00010270: 6f72 7463 6f64 6529 206f 7220 6c69 7374  ortcode) or list
-00010280: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-00010290: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-000102a0: 2020 2020 6974 656d 2e69 735f 726f 6f74      item.is_root
-000102b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000102c0: 2020 5f69 7465 6d5f 6973 5f73 7472 7563    _item_is_struc
-000102d0: 7475 7265 5f65 6c65 6d65 6e74 203d 2054  ture_element = T
-000102e0: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-000102f0: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
-00010300: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
-00010310: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-00010320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010330: 2020 2069 7465 6d2e 5f6d 6561 7375 7265     item._measure
-00010340: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00010350: 2020 2020 2020 5f69 7465 6d5f 6973 5f65        _item_is_e
-00010360: 6c65 6d65 6e74 203d 2054 7275 650d 0a20  lement = True.. 
-00010370: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00010380: 7863 6570 7420 4174 7472 6962 7574 6545  xcept AttributeE
-00010390: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-000103a0: 2020 2020 2020 2020 2020 2023 5765 276c             #We'l
-000103b0: 6c20 7261 6973 6520 7468 6520 6572 726f  l raise the erro
-000103c0: 7220 6173 2061 2054 7970 6545 7272 6f72  r as a TypeError
-000103d0: 2066 7572 7468 6572 2064 6f77 6e0d 0a20   further down.. 
-000103e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103f0: 2020 2070 6173 730d 0a0d 0a20 2020 2020     pass....     
-00010400: 2020 2069 6620 5f69 7465 6d5f 6973 5f73     if _item_is_s
-00010410: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00010420: 3a0d 0a20 2020 2020 2020 2020 2020 205f  :..            _
-00010430: 6368 696c 645f 7374 7275 6374 7572 655f  child_structure_
-00010440: 656c 656d 656e 7420 3d20 6974 656d 0d0a  element = item..
-00010450: 0d0a 2020 2020 2020 2020 2020 2020 2353  ..            #S
-00010460: 7472 7563 7475 7265 2065 6c65 6d65 6e74  tructure element
-00010470: 7320 636f 756c 6420 6861 7665 2062 6565  s could have bee
-00010480: 6e20 6375 7420 6f72 2028 696d 706c 6963  n cut or (implic
-00010490: 6974 6c79 2920 636f 7069 6564 0d0a 2020  itly) copied..  
-000104a0: 2020 2020 2020 2020 2020 2343 7574 2065            #Cut e
-000104b0: 6c65 6d65 6e74 7320 7769 6c6c 206e 6f74  lements will not
-000104c0: 2068 6176 6520 6120 7061 7265 6e74 2c20   have a parent, 
-000104d0: 616e 6420 7761 6e74 2074 6f20 6265 2073  and want to be s
-000104e0: 6574 2074 6f20 6861 7665 2074 6869 7320  et to have this 
-000104f0: 7374 7275 6374 7572 6520 656c 656d 656e  structure elemen
-00010500: 7420 7061 7265 6e74 0d0a 2020 2020 2020  t parent..      
-00010510: 2020 2020 2020 2349 6d70 6c69 6369 746c        #Implicitl
-00010520: 7920 636f 7069 6564 2065 6c65 6d65 6e74  y copied element
-00010530: 7320 7769 6c6c 2068 6176 6520 6120 7061  s will have a pa
-00010540: 7265 6e74 2c20 616e 6420 6e65 6564 2074  rent, and need t
-00010550: 6f20 6265 2065 7870 6c69 6369 746c 7920  o be explicitly 
-00010560: 636f 7069 6564 0d0a 2020 2020 2020 2020  copied..        
-00010570: 2020 2020 6966 205f 6368 696c 645f 7374      if _child_st
-00010580: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
-00010590: 5f70 6172 656e 745f 7374 7275 6374 7572  _parent_structur
-000105a0: 655f 656c 656d 656e 7420 6973 204e 6f6e  e_element is Non
-000105b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000105c0: 2020 2020 5f63 6869 6c64 5f73 7472 7563      _child_struc
-000105d0: 7475 7265 5f65 6c65 6d65 6e74 2e73 7472  ture_element.str
-000105e0: 7563 7475 7265 203d 2073 656c 662e 5f73  ucture = self._s
-000105f0: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00010600: 2e73 7472 7563 7475 7265 0d0a 2020 2020  .structure..    
-00010610: 2020 2020 2020 2020 656c 6966 205f 6368          elif _ch
-00010620: 696c 645f 7374 7275 6374 7572 655f 656c  ild_structure_el
-00010630: 656d 656e 742e 5f70 6172 656e 745f 7374  ement._parent_st
-00010640: 7275 6374 7572 655f 656c 656d 656e 7420  ructure_element 
-00010650: 3d3d 2073 656c 662e 5f73 7472 7563 7475  == self._structu
-00010660: 7265 5f65 6c65 6d65 6e74 3a0d 0a20 2020  re_element:..   
-00010670: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00010680: 730d 0a20 2020 2020 2020 2020 2020 2065  s..            e
-00010690: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-000106a0: 2020 2020 2020 2344 6f20 7468 6520 6578        #Do the ex
-000106b0: 706c 6963 6974 2063 6f70 790d 0a20 2020  plicit copy..   
-000106c0: 2020 2020 2020 2020 2020 2020 205f 6368               _ch
-000106d0: 696c 645f 7374 7275 6374 7572 655f 656c  ild_structure_el
-000106e0: 656d 656e 7420 3d20 6974 656d 2e63 6f70  ement = item.cop
-000106f0: 7928 290d 0a0d 0a20 2020 2020 2020 2020  y()....         
-00010700: 2020 2069 6620 5f63 6869 6c64 5f73 7472     if _child_str
-00010710: 7563 7475 7265 5f65 6c65 6d65 6e74 2e73  ucture_element.s
-00010720: 7472 7563 7475 7265 2069 7320 4e6f 6e65  tructure is None
-00010730: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00010740: 2020 205f 6368 696c 645f 7374 7275 6374     _child_struct
-00010750: 7572 655f 656c 656d 656e 742e 7374 7275  ure_element.stru
-00010760: 6374 7572 6520 3d20 7365 6c66 2e5f 7374  cture = self._st
-00010770: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
-00010780: 7374 7275 6374 7572 650d 0a0d 0a20 2020  structure....   
-00010790: 2020 2020 2065 6c69 6620 5f69 7465 6d5f       elif _item_
-000107a0: 6973 5f65 6c65 6d65 6e74 3a0d 0a20 2020  is_element:..   
-000107b0: 2020 2020 2020 2020 205f 6368 696c 645f           _child_
-000107c0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-000107d0: 7420 3d20 5374 7275 6374 7572 6545 6c65  t = StructureEle
-000107e0: 6d65 6e74 2820 7374 7275 6374 7572 653d  ment( structure=
-000107f0: 7365 6c66 2e5f 7374 7275 6374 7572 655f  self._structure_
-00010800: 656c 656d 656e 742e 7374 7275 6374 7572  element.structur
-00010810: 652c 656c 656d 656e 743d 6974 656d 2c69  e,element=item,i
-00010820: 735f 726f 6f74 3d46 616c 7365 290d 0a20  s_root=False).. 
-00010830: 2020 2020 2020 2065 6c69 6620 5f69 7465         elif _ite
-00010840: 6d5f 6973 5f73 686f 7274 636f 6465 3a0d  m_is_shortcode:.
-00010850: 0a20 2020 2020 2020 2020 2020 205f 656c  .            _el
-00010860: 656d 656e 7420 3d20 7365 6c66 2e5f 7374  ement = self._st
-00010870: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
-00010880: 6469 6d65 6e73 696f 6e2e 656c 656d 656e  dimension.elemen
-00010890: 7473 5b69 7465 6d5d 0d0a 2020 2020 2020  ts[item]..      
-000108a0: 2020 2020 2020 5f63 6869 6c64 5f73 7472        _child_str
-000108b0: 7563 7475 7265 5f65 6c65 6d65 6e74 203d  ucture_element =
-000108c0: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
-000108d0: 7428 7374 7275 6374 7572 653d 7365 6c66  t(structure=self
-000108e0: 2e5f 7374 7275 6374 7572 655f 656c 656d  ._structure_elem
-000108f0: 656e 742e 7374 7275 6374 7572 652c 656c  ent.structure,el
-00010900: 656d 656e 743d 5f65 6c65 6d65 6e74 2c69  ement=_element,i
-00010910: 735f 726f 6f74 3d46 616c 7365 290d 0a20  s_root=False).. 
-00010920: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00010930: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00010940: 5479 7065 4572 726f 7228 2743 616e 6e6f  TypeError('Canno
-00010950: 7420 6170 7065 6e64 2069 7465 6d20 6f66  t append item of
-00010960: 2075 6e6b 6e6f 776e 2074 7970 653a 207b   unknown type: {
-00010970: 7d27 2e66 6f72 6d61 7428 7265 7072 2869  }'.format(repr(i
-00010980: 7465 6d29 2929 0d0a 0d0a 2020 2020 2020  tem)))....      
-00010990: 2020 6966 206e 6f74 205f 6368 696c 645f    if not _child_
-000109a0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-000109b0: 742e 656c 656d 656e 742e 6d61 7374 6572  t.element.master
-000109c0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-000109d0: 2072 6169 7365 2041 7474 7269 6275 7465   raise Attribute
-000109e0: 4572 726f 7228 2743 616e 6e6f 7420 6372  Error('Cannot cr
-000109f0: 6561 7465 2061 2068 6965 7261 7263 6879  eate a hierarchy
-00010a00: 2077 6974 6820 756e 2d73 796e 6368 726f   with un-synchro
-00010a10: 6e69 7365 6420 456c 656d 656e 7420 7b7d  nised Element {}
-00010a20: 2075 7365 2044 696d 656e 7369 6f6e 2e65   use Dimension.e
-00010a30: 6c65 6d65 6e74 732e 7379 6e63 6872 6f6e  lements.synchron
-00010a40: 6973 6528 2920 6265 666f 7265 2063 7265  ise() before cre
-00010a50: 6174 696e 6720 7468 6520 6869 6572 6172  ating the hierar
-00010a60: 6368 7927 290d 0a0d 0a20 2020 2020 2020  chy')....       
-00010a70: 2023 4966 2077 6520 6172 6520 6164 6469   #If we are addi
-00010a80: 6e67 206d 6572 6765 2065 6c65 6d65 6e74  ng merge element
-00010a90: 732c 2072 6574 7572 6e20 6966 7765 2066  s, return ifwe f
-00010aa0: 696e 6420 616e 2069 6465 6e74 6963 616c  ind an identical
-00010ab0: 2065 6c65 6d65 6e74 0d0a 2020 2020 2020   element..      
-00010ac0: 2020 6966 206d 6572 6765 3a0d 0a20 2020    if merge:..   
-00010ad0: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-00010ae0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00010af0: 656c 665b 5f63 6869 6c64 5f73 7472 7563  elf[_child_struc
-00010b00: 7475 7265 5f65 6c65 6d65 6e74 2e73 686f  ture_element.sho
-00010b10: 7274 636f 6465 5d0d 0a20 2020 2020 2020  rtcode]..       
-00010b20: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
-00010b30: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00010b40: 6570 7420 4b65 7945 7272 6f72 3a0d 0a20  ept KeyError:.. 
-00010b50: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00010b60: 6173 730d 0a0d 0a20 2020 2020 2020 2073  ass....        s
-00010b70: 656c 662e 5f73 7472 7563 7475 7265 5f65  elf._structure_e
-00010b80: 6c65 6d65 6e74 2e5f 6164 645f 6368 696c  lement._add_chil
-00010b90: 6428 5f63 6869 6c64 5f73 7472 7563 7475  d(_child_structu
-00010ba0: 7265 5f65 6c65 6d65 6e74 290d 0a0d 0a20  re_element).... 
-00010bb0: 2020 2064 6566 206f 7264 6572 5f62 795f     def order_by_
-00010bc0: 7368 6f72 7463 6f64 655f 6c69 7374 2873  shortcode_list(s
-00010bd0: 656c 662c 7368 6f72 7463 6f64 655f 6c69  elf,shortcode_li
-00010be0: 7374 293a 0d0a 2020 2020 2020 2020 2727  st):..        ''
-00010bf0: 274f 7264 6572 2074 6865 2063 6869 6c64  'Order the child
-00010c00: 7265 6e20 7573 696e 6720 6120 6c69 7374  ren using a list
-00010c10: 206f 6620 7368 6f72 7463 6f64 6573 2e20   of shortcodes. 
-00010c20: 4265 6361 7573 6520 456c 656d 656e 7473  Because Elements
-00010c30: 2063 616e 2063 6f6d 6520 616e 6420 676f   can come and go
-00010c40: 206f 7665 7220 7469 6d65 2c20 7368 6f72   over time, shor
-00010c50: 746e 616d 6573 2069 6e20 7468 6520 6c69  tnames in the li
-00010c60: 7374 2074 6861 7420 6172 6520 6e6f 7420  st that are not 
-00010c70: 6368 696c 6472 656e 2061 7265 2069 676e  children are ign
-00010c80: 6f72 6564 2c20 616e 6420 616e 7920 7368  ored, and any sh
-00010c90: 6f72 746e 616d 6573 206f 6620 6368 696c  ortnames of chil
-00010ca0: 6472 656e 2074 6861 7420 6172 6520 6e6f  dren that are no
-00010cb0: 7420 6d65 6e74 696f 6e65 6420 676f 2074  t mentioned go t
-00010cc0: 6f20 7468 6520 656e 6420 6f66 2074 6865  o the end of the
-00010cd0: 206c 6973 7420 696e 2074 6865 6972 206f   list in their o
-00010ce0: 7269 6769 6e61 6c20 6f72 6465 722e 2727  riginal order.''
-00010cf0: 270d 0a20 2020 2020 2020 205f 696e 6974  '..        _init
-00010d00: 6961 6c5f 6368 696c 6472 656e 203d 2073  ial_children = s
-00010d10: 656c 662e 5f73 7472 7563 7475 7265 5f65  elf._structure_e
-00010d20: 6c65 6d65 6e74 2e5f 6368 696c 645f 7374  lement._child_st
-00010d30: 7275 6374 7572 655f 656c 656d 656e 7473  ructure_elements
-00010d40: 2e63 6f70 7928 290d 0a20 2020 2020 2020  .copy()..       
-00010d50: 205f 696e 6974 6961 6c5f 706f 7369 7469   _initial_positi
-00010d60: 6f6e 735f 6279 5f73 686f 7274 636f 6465  ons_by_shortcode
-00010d70: 203d 207b 7d0d 0a0d 0a20 2020 2020 2020   = {}....       
-00010d80: 2023 4372 6561 7465 2061 206c 6973 7420   #Create a list 
-00010d90: 6f66 2070 6f73 6974 696f 6e73 2066 6f72  of positions for
-00010da0: 2065 6163 6820 7368 6f72 7463 6f64 650d   each shortcode.
-00010db0: 0a20 2020 2020 2020 2066 6f72 206e 2c20  .        for n, 
-00010dc0: 7365 2069 6e20 656e 756d 6572 6174 6528  se in enumerate(
-00010dd0: 7365 6c66 2e5f 7374 7275 6374 7572 655f  self._structure_
-00010de0: 656c 656d 656e 742e 5f63 6869 6c64 5f73  element._child_s
-00010df0: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00010e00: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
-00010e10: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00010e20: 2020 2020 2020 2070 6f73 5f6c 6973 7420         pos_list 
-00010e30: 3d20 5f69 6e69 7469 616c 5f70 6f73 6974  = _initial_posit
-00010e40: 696f 6e73 5f62 795f 7368 6f72 7463 6f64  ions_by_shortcod
-00010e50: 655b 7365 2e73 686f 7274 636f 6465 5d0d  e[se.shortcode].
-00010e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010e70: 2070 6f73 5f6c 6973 742e 6170 7065 6e64   pos_list.append
-00010e80: 286e 290d 0a20 2020 2020 2020 2020 2020  (n)..           
-00010e90: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
-00010ea0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00010eb0: 2020 205f 696e 6974 6961 6c5f 706f 7369     _initial_posi
-00010ec0: 7469 6f6e 735f 6279 5f73 686f 7274 636f  tions_by_shortco
-00010ed0: 6465 5b73 652e 7368 6f72 7463 6f64 655d  de[se.shortcode]
-00010ee0: 203d 205b 6e5d 0d0a 0d0a 2020 2020 2020   = [n]....      
-00010ef0: 2020 2343 6c65 6172 206f 7574 2063 6869    #Clear out chi
-00010f00: 6c64 7265 6e0d 0a20 2020 2020 2020 2073  ldren..        s
-00010f10: 656c 662e 636c 6561 7228 290d 0a0d 0a20  elf.clear().... 
-00010f20: 2020 2020 2020 2061 6c6c 5f6d 6f76 6564         all_moved
-00010f30: 5f73 686f 7274 636f 6465 7320 3d20 7b7d  _shortcodes = {}
-00010f40: 0d0a 2020 2020 2020 2020 234f 7264 6572  ..        #Order
-00010f50: 2062 7920 7468 6520 7368 6f72 7463 6f64   by the shortcod
-00010f60: 6573 0d0a 2020 2020 2020 2020 666f 7220  es..        for 
-00010f70: 7368 6f72 7463 6f64 6520 696e 2073 686f  shortcode in sho
-00010f80: 7274 636f 6465 5f6c 6973 743a 0d0a 2020  rtcode_list:..  
-00010f90: 2020 2020 2020 2020 2020 2352 6563 6f72            #Recor
-00010fa0: 6420 7368 6f72 7463 6f64 6573 206f 6620  d shortcodes of 
-00010fb0: 6d6f 7665 6420 656c 656d 656e 7473 2c20  moved elements, 
-00010fc0: 736f 2077 6520 6361 6e20 776f 726b 206f  so we can work o
-00010fd0: 7574 2028 7175 6963 6b6c 7929 2077 6861  ut (quickly) wha
-00010fe0: 7420 6469 646e 2774 206d 6f76 650d 0a20  t didn't move.. 
-00010ff0: 2020 2020 2020 2020 2020 2061 6c6c 5f6d             all_m
-00011000: 6f76 6564 5f73 686f 7274 636f 6465 735b  oved_shortcodes[
-00011010: 7368 6f72 7463 6f64 655d 203d 2073 686f  shortcode] = sho
-00011020: 7274 636f 6465 0d0a 0d0a 2020 2020 2020  rtcode....      
-00011030: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00011040: 2020 2020 2020 2020 2020 2020 5f63 6869              _chi
-00011050: 6c64 5f73 7472 7563 7475 7265 5f65 6c65  ld_structure_ele
-00011060: 6d65 6e74 5f69 6e64 6963 6573 203d 205f  ment_indices = _
-00011070: 696e 6974 6961 6c5f 706f 7369 7469 6f6e  initial_position
-00011080: 735f 6279 5f73 686f 7274 636f 6465 5b73  s_by_shortcode[s
-00011090: 686f 7274 636f 6465 5d0d 0a20 2020 2020  hortcode]..     
-000110a0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-000110b0: 6e64 2069 6e20 5f63 6869 6c64 5f73 7472  nd in _child_str
-000110c0: 7563 7475 7265 5f65 6c65 6d65 6e74 5f69  ucture_element_i
-000110d0: 6e64 6963 6573 3a0d 0a20 2020 2020 2020  ndices:..       
-000110e0: 2020 2020 2020 2020 2020 2020 2073 6520               se 
-000110f0: 3d20 5f69 6e69 7469 616c 5f63 6869 6c64  = _initial_child
-00011100: 7265 6e5b 696e 645d 0d0a 2020 2020 2020  ren[ind]..      
-00011110: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00011120: 6c66 2e5f 7374 7275 6374 7572 655f 656c  lf._structure_el
-00011130: 656d 656e 742e 5f61 6464 5f63 6869 6c64  ement._add_child
-00011140: 2873 6529 0d0a 0d0a 2020 2020 2020 2020  (se)....        
-00011150: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-00011160: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-00011170: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
-00011180: 0d0a 0d0a 2020 2020 2020 2020 2341 6464  ....        #Add
-00011190: 2061 6e79 7468 696e 6720 6c65 6674 2069   anything left i
-000111a0: 6e20 7468 6520 6f72 6967 696e 616c 2063  n the original c
-000111b0: 6869 6c64 7265 6e0d 0a20 2020 2020 2020  hildren..       
-000111c0: 2066 6f72 205f 6368 696c 645f 7374 7275   for _child_stru
-000111d0: 6374 7572 655f 656c 656d 656e 7420 696e  cture_element in
-000111e0: 205f 696e 6974 6961 6c5f 6368 696c 6472   _initial_childr
-000111f0: 656e 3a0d 0a20 2020 2020 2020 2020 2020  en:..           
-00011200: 2023 5365 6520 6966 2074 6865 2069 6e69   #See if the ini
-00011210: 7469 616c 2063 6869 6c64 2068 6173 2062  tial child has b
-00011220: 6565 6e20 6f72 6465 7264 2062 7920 7468  een orderd by th
-00011230: 6520 7368 6f72 7463 6f64 652c 206f 7220  e shortcode, or 
-00011240: 6966 2069 7420 6973 206f 6e65 206f 6620  if it is one of 
-00011250: 7468 6520 6c65 6674 6f76 6572 730d 0a20  the leftovers.. 
-00011260: 2020 2020 2020 2020 2020 2023 6c65 6674             #left
-00011270: 6f76 6572 7320 7769 6c6c 2062 6520 6164  overs will be ad
-00011280: 6465 6420 6261 636b 2069 6e20 7468 6569  ded back in thei
-00011290: 7220 6f72 6967 696e 616c 206f 7264 6572  r original order
-000112a0: 2c20 6166 7465 7220 7468 6520 6f72 6465  , after the orde
-000112b0: 7265 6420 656c 656d 656e 7473 0d0a 2020  red elements..  
-000112c0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-000112d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000112e0: 616c 6c5f 6d6f 7665 645f 7368 6f72 7463  all_moved_shortc
-000112f0: 6f64 6573 5b5f 6368 696c 645f 7374 7275  odes[_child_stru
-00011300: 6374 7572 655f 656c 656d 656e 742e 7368  cture_element.sh
-00011310: 6f72 746e 616d 655d 0d0a 2020 2020 2020  ortname]..      
-00011320: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-00011330: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-00011340: 2020 2020 2020 2020 2354 6865 2063 6869          #The chi
-00011350: 6c64 2068 6173 206e 6f74 2062 6565 6e20  ld has not been 
-00011360: 6d6f 7665 6420 696e 2064 7572 696e 6720  moved in during 
-00011370: 7468 6520 6f72 6465 7269 6e67 2070 726f  the ordering pro
-00011380: 6365 7373 2c20 736f 2061 6464 2069 7420  cess, so add it 
-00011390: 696e 206e 6f77 0d0a 2020 2020 2020 2020  in now..        
-000113a0: 2020 2020 2020 2020 7365 6c66 2e5f 7374          self._st
-000113b0: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
-000113c0: 5f61 6464 5f63 6869 6c64 285f 6368 696c  _add_child(_chil
-000113d0: 645f 7374 7275 6374 7572 655f 656c 656d  d_structure_elem
-000113e0: 656e 7429 0d0a 0d0a 2020 2020 6465 6620  ent)....    def 
-000113f0: 6375 7428 7365 6c66 293a 0d0a 2020 2020  cut(self):..    
-00011400: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
-00011410: 2052 656d 6f76 6520 7468 6520 6368 696c   Remove the chil
-00011420: 6472 656e 2066 726f 6d20 7468 6520 7061  dren from the pa
-00011430: 7265 6e74 2061 6e64 2072 6574 7572 6e20  rent and return 
-00011440: 7468 656d 2061 7320 6120 6c69 7374 2e0d  them as a list..
-00011450: 0a20 2020 2020 2020 2054 6869 7320 6675  .        This fu
-00011460: 6e63 7469 6f6e 2069 7320 7573 6566 756c  nction is useful
-00011470: 2077 6865 6e20 7765 2061 7265 2061 626f   when we are abo
-00011480: 7574 2074 6f20 2770 6173 7465 2720 7468  ut to 'paste' th
-00011490: 6520 6368 696c 6472 656e 2069 6e74 6f20  e children into 
-000114a0: 616e 6f74 6865 7220 7370 6f74 0d0a 2020  another spot..  
-000114b0: 2020 2020 2020 2727 270d 0a20 2020 2020        '''..     
-000114c0: 2020 2023 5765 206e 6565 6420 746f 2064     #We need to d
-000114d0: 6574 6163 6820 6561 6368 2063 6869 6c64  etach each child
-000114e0: 2066 726f 6d20 7468 6520 7061 7265 6e74   from the parent
-000114f0: 2073 7472 7563 7475 7265 2065 6c65 6d65   structure eleme
-00011500: 6e74 2c20 636c 6561 7220 6f75 7273 656c  nt, clear oursel
-00011510: 6620 616e 6420 7265 7475 726e 2061 206e  f and return a n
-00011520: 6577 2053 7472 7563 7475 7265 456c 656d  ew StructureElem
-00011530: 656e 7443 6869 6c64 7265 6e0d 0a20 2020  entChildren..   
-00011540: 2020 2020 2023 5468 6973 2077 6179 2c20       #This way, 
-00011550: 7768 656e 2070 6173 7465 6420 696e 2c20  when pasted in, 
-00011560: 7468 6520 6368 696c 6472 656e 2077 696c  the children wil
-00011570: 6c20 7265 6d61 696e 2074 6865 2073 616d  l remain the sam
-00011580: 6520 656e 7469 7469 6573 2c20 6275 7420  e entities, but 
-00011590: 7468 6520 6e65 7720 7061 7265 6e74 2053  the new parent S
-000115a0: 7472 7563 7475 7265 456c 656d 656e 7420  tructureElement 
-000115b0: 7769 6c6c 206e 6f74 2062 6520 706f 696e  will not be poin
-000115c0: 7469 6e67 0d0a 2020 2020 2020 2020 2374  ting..        #t
-000115d0: 6f20 736f 6d65 206f 7468 6572 2063 6869  o some other chi
-000115e0: 6c64 7265 6e0d 0a0d 0a20 2020 2020 2020  ldren....       
-000115f0: 2072 6574 7661 6c20 3d20 5b63 6820 666f   retval = [ch fo
-00011600: 7220 6368 2069 6e20 7365 6c66 2e76 616c  r ch in self.val
-00011610: 7565 7328 295d 0d0a 0d0a 2020 2020 2020  ues()]....      
-00011620: 2020 2343 6c65 6172 2063 6869 6c64 7265    #Clear childre
-00011630: 6e20 6f75 7420 6f66 2073 656c 660d 0a20  n out of self.. 
-00011640: 2020 2020 2020 2073 656c 662e 636c 6561         self.clea
-00011650: 7228 290d 0a0d 0a20 2020 2020 2020 2072  r()....        r
-00011660: 6574 7572 6e20 7265 7476 616c 0d0a 0d0a  eturn retval....
-00011670: 2020 2020 2344 6566 696e 6520 7768 6174      #Define what
-00011680: 2068 6170 7065 6e73 2077 6865 6e20 7765   happens when we
-00011690: 2063 616c 6c20 2b3d 0d0a 2020 2020 2357   call +=..    #W
-000116a0: 6520 7761 6e74 2074 6f20 6170 7065 6e64  e want to append
-000116b0: 0d0a 2020 2020 6465 6620 5f5f 6961 6464  ..    def __iadd
-000116c0: 5f5f 2873 656c 662c 6f74 6865 7229 3a0d  __(self,other):.
-000116d0: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
-000116e0: 7065 6e64 2869 7465 6d3d 6f74 6865 722c  pend(item=other,
-000116f0: 6d65 7267 653d 4661 6c73 6529 0d0a 2020  merge=False)..  
-00011700: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00011710: 660d 0a0d 0a20 2020 2023 4465 6669 6e65  f....    #Define
-00011720: 2077 6861 7420 6861 7070 656e 7320 7768   what happens wh
-00011730: 656e 2077 6520 6361 6c6c 207c 3d0d 0a20  en we call |=.. 
-00011740: 2020 2023 5765 2077 616e 7420 746f 2061     #We want to a
-00011750: 7070 656e 6420 756e 6971 7565 2069 7465  ppend unique ite
-00011760: 6d73 0d0a 2020 2020 6465 6620 5f5f 696f  ms..    def __io
-00011770: 725f 5f28 7365 6c66 2c6f 7468 6572 293a  r__(self,other):
-00011780: 0d0a 2020 2020 2020 2020 7365 6c66 2e61  ..        self.a
-00011790: 7070 656e 6428 6974 656d 3d6f 7468 6572  ppend(item=other
-000117a0: 2c6d 6572 6765 3d54 7275 6529 0d0a 2020  ,merge=True)..  
-000117b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000117c0: 660d 0a0d 0a20 2020 2023 4465 6669 6e65  f....    #Define
-000117d0: 2077 6861 7420 6861 7070 656e 7320 7768   what happens wh
-000117e0: 656e 2077 6520 6361 6c6c 202d 3d0d 0a20  en we call -=.. 
-000117f0: 2020 2023 5765 2077 616e 7420 746f 2072     #We want to r
-00011800: 656d 6f76 6520 7468 6520 6669 6e61 6c20  emove the final 
-00011810: 6368 696c 6420 7769 7468 2074 6861 7420  child with that 
-00011820: 6b65 790d 0a20 2020 2064 6566 205f 5f69  key..    def __i
-00011830: 7375 625f 5f28 7365 6c66 2c6f 7468 6572  sub__(self,other
-00011840: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-00011850: 2e5f 7374 7275 6374 7572 655f 656c 656d  ._structure_elem
-00011860: 656e 742e 7265 6d6f 7665 5f63 6869 6c64  ent.remove_child
-00011870: 286f 7468 6572 290d 0a20 2020 2020 2020  (other)..       
-00011880: 2072 6574 7572 6e20 7365 6c66 0d0a 0d0a   return self....
-00011890: 0d0a 2020 2020 6465 6620 6b65 7973 2873  ..    def keys(s
-000118a0: 656c 6629 3a0d 0a20 2020 2020 2020 2023  elf):..        #
-000118b0: 6966 206e 6f74 2073 656c 662e 6469 6d65  if not self.dime
-000118c0: 6e73 696f 6e2e 5f65 6c65 6d65 6e74 735f  nsion._elements_
-000118d0: 7265 6164 3a0d 0a20 2020 2020 2020 2023  read:..        #
-000118e0: 2020 2020 7365 6c66 2e5f 6c6f 6164 5f65      self._load_e
-000118f0: 6c65 6d65 6e74 7328 290d 0a20 2020 2020  lements()..     
-00011900: 2020 2066 6f72 2065 6c20 696e 2073 656c     for el in sel
-00011910: 662e 5f73 7472 7563 7475 7265 5f65 6c65  f._structure_ele
-00011920: 6d65 6e74 2e5f 6368 696c 645f 7374 7275  ment._child_stru
-00011930: 6374 7572 655f 656c 656d 656e 7473 3a0d  cture_elements:.
-00011940: 0a20 2020 2020 2020 2020 2020 2079 6965  .            yie
-00011950: 6c64 2065 6c2e 7368 6f72 746e 616d 650d  ld el.shortname.
-00011960: 0a0d 0a20 2020 2064 6566 2069 7465 6d73  ...    def items
-00011970: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00011980: 2023 6966 206e 6f74 2073 656c 662e 6469   #if not self.di
-00011990: 6d65 6e73 696f 6e2e 5f65 6c65 6d65 6e74  mension._element
-000119a0: 735f 7265 6164 3a0d 0a20 2020 2020 2020  s_read:..       
-000119b0: 2023 2020 2020 7365 6c66 2e5f 6c6f 6164   #    self._load
-000119c0: 5f65 6c65 6d65 6e74 7328 290d 0a20 2020  _elements()..   
-000119d0: 2020 2020 2066 6f72 2065 6c20 696e 2073       for el in s
-000119e0: 656c 662e 5f73 7472 7563 7475 7265 5f65  elf._structure_e
-000119f0: 6c65 6d65 6e74 2e5f 6368 696c 645f 7374  lement._child_st
-00011a00: 7275 6374 7572 655f 656c 656d 656e 7473  ructure_elements
-00011a10: 3a0d 0a20 2020 2020 2020 2020 2020 2079  :..            y
-00011a20: 6965 6c64 2065 6c2e 7368 6f72 746e 616d  ield el.shortnam
-00011a30: 652c 2065 6c0d 0a0d 0a20 2020 2064 6566  e, el....    def
-00011a40: 2076 616c 7565 7328 7365 6c66 293a 0d0a   values(self):..
-00011a50: 2020 2020 2020 2020 2369 6620 6e6f 7420          #if not 
-00011a60: 7365 6c66 2e64 696d 656e 7369 6f6e 2e5f  self.dimension._
-00011a70: 656c 656d 656e 7473 5f72 6561 643a 0d0a  elements_read:..
-00011a80: 2020 2020 2020 2020 2023 2020 2073 656c           #   sel
-00011a90: 662e 5f6c 6f61 645f 656c 656d 656e 7473  f._load_elements
-00011aa0: 2829 0d0a 2020 2020 2020 2020 666f 7220  ()..        for 
-00011ab0: 656c 2069 6e20 7365 6c66 2e5f 7374 7275  el in self._stru
-00011ac0: 6374 7572 655f 656c 656d 656e 742e 5f63  cture_element._c
-00011ad0: 6869 6c64 5f73 7472 7563 7475 7265 5f65  hild_structure_e
-00011ae0: 6c65 6d65 6e74 733a 0d0a 2020 2020 2020  lements:..      
-00011af0: 2020 2020 2020 7969 656c 6420 656c 0d0a        yield el..
-00011b00: 0d0a 0d0a 0d0a 2020 2020 6465 6620 5f5f  ......    def __
-00011b10: 6c65 6e5f 5f28 7365 6c66 293a 0d0a 2020  len__(self):..  
-00011b20: 2020 2020 2020 2369 6620 6e6f 7420 7365        #if not se
-00011b30: 6c66 2e64 696d 656e 7369 6f6e 2e5f 656c  lf.dimension._el
-00011b40: 656d 656e 7473 5f72 6561 643a 0d0a 2020  ements_read:..  
-00011b50: 2020 2020 2020 2320 2020 2073 656c 662e        #    self.
-00011b60: 5f6c 6f61 645f 656c 656d 656e 7473 2829  _load_elements()
-00011b70: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-00011b80: 726e 206c 656e 2873 656c 662e 5f73 7472  rn len(self._str
-00011b90: 7563 7475 7265 5f65 6c65 6d65 6e74 2e5f  ucture_element._
-00011ba0: 6368 696c 645f 7374 7275 6374 7572 655f  child_structure_
-00011bb0: 656c 656d 656e 7473 290d 0a0d 0a20 2020  elements)....   
-00011bc0: 2064 6566 205f 5f73 7472 5f5f 2873 656c   def __str__(sel
-00011bd0: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-00011be0: 7572 6e20 275b 2720 2b20 275c 6e27 2e6a  urn '[' + '\n'.j
-00011bf0: 6f69 6e28 5b20 762e 7368 6f72 746e 616d  oin([ v.shortnam
-00011c00: 6520 666f 7220 2076 2069 6e20 7365 6c66  e for  v in self
-00011c10: 2e5f 7374 7275 6374 7572 655f 656c 656d  ._structure_elem
-00011c20: 656e 742e 5f63 6869 6c64 5f73 7472 7563  ent._child_struc
-00011c30: 7475 7265 5f65 6c65 6d65 6e74 735d 2920  ture_elements]) 
-00011c40: 2b20 275d 270d 0a0d 0a0d 0a20 2020 2064  + ']'......    d
-00011c50: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
-00011c60: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-00011c70: 726e 2027 7b7d 2066 726f 6d20 3c7b 7d20  rn '{} from <{} 
-00011c80: 6f62 6a65 6374 2061 7420 7b7d 3e27 2e66  object at {}>'.f
-00011c90: 6f72 6d61 7428 277b 2720 2b20 275c 6e27  ormat('{' + '\n'
-00011ca0: 2e6a 6f69 6e28 5b20 2227 7b7d 273a 7b7d  .join([ "'{}':{}
-00011cb0: 222e 666f 726d 6174 286b 2c72 6570 7228  ".format(k,repr(
-00011cc0: 7629 2920 666f 7220 6b2c 7620 696e 2073  v)) for k,v in s
-00011cd0: 656c 662e 6974 656d 7328 295d 2920 2b20  elf.items()]) + 
-00011ce0: 277d 272c 7365 6c66 2e5f 5f63 6c61 7373  '}',self.__class
-00011cf0: 5f5f 2e5f 5f6e 616d 655f 5f2c 6865 7828  __.__name__,hex(
-00011d00: 6964 2873 656c 6629 2929 0d0a 0d0a 2020  id(self)))....  
-00011d10: 2020 6465 6620 636c 6561 7228 7365 6c66    def clear(self
-00011d20: 293a 0d0a 2020 2020 2020 2020 2727 2752  ):..        '''R
-00011d30: 656d 6f76 6520 616c 6c20 6f66 2074 6865  emove all of the
-00011d40: 2063 6869 6c64 7265 6e20 6672 6f6d 2074   children from t
-00011d50: 6865 2070 6172 656e 7427 2727 0d0a 2020  he parent'''..  
-00011d60: 2020 2020 2020 7365 6c66 2e5f 7374 7275        self._stru
-00011d70: 6374 7572 655f 656c 656d 656e 742e 7265  cture_element.re
-00011d80: 6d6f 7665 5f63 6869 6c64 7265 6e28 290d  move_children().
-00011d90: 0a0d 0a63 6c61 7373 205f 5374 7275 6374  ...class _Struct
-00011da0: 7572 6545 6c65 6d65 6e74 4465 7363 656e  ureElementDescen
-00011db0: 6461 6e74 7347 6574 7465 7228 6f62 6a65  dantsGetter(obje
-00011dc0: 6374 293a 0d0a 2020 2020 2727 2744 6f65  ct):..    '''Doe
-00011dd0: 7320 6120 6269 7420 6f66 206d 6167 6963  s a bit of magic
-00011de0: 2074 6f20 616c 6c6f 7720 5374 7275 6374   to allow Struct
-00011df0: 7572 6545 6c65 6d65 6e74 732e 6465 7363  ureElements.desc
-00011e00: 656e 6461 6e74 7320 746f 2061 7070 6561  endants to appea
-00011e10: 7220 6c69 6b65 2061 2064 6963 7469 6f6e  r like a diction
-00011e20: 6172 792c 206f 6e6c 7920 7769 7468 2065  ary, only with e
-00011e30: 7874 7261 2073 7065 6369 616c 2066 756e  xtra special fun
-00011e40: 6374 696f 6e73 206c 696b 6520 2b3d 2027  ctions like += '
-00011e50: 2727 0d0a 2020 2020 6465 6620 5f5f 696e  ''..    def __in
-00011e60: 6974 5f5f 2873 656c 662c 7374 7275 6374  it__(self,struct
-00011e70: 7572 655f 656c 656d 656e 7429 3a0d 0a20  ure_element):.. 
-00011e80: 2020 2020 2020 2073 656c 662e 5f73 7472         self._str
-00011e90: 7563 7475 7265 5f65 6c65 6d65 6e74 2020  ucture_element  
-00011ea0: 2020 2020 2020 2020 3d20 7374 7275 6374          = struct
-00011eb0: 7572 655f 656c 656d 656e 740d 0a0d 0a20  ure_element.... 
-00011ec0: 2020 2023 5468 6520 5f53 7472 7563 7475     #The _Structu
-00011ed0: 7265 456c 656d 656e 7444 6573 6365 6e64  reElementDescend
-00011ee0: 616e 7473 4765 7474 6572 2068 6173 2074  antsGetter has t
-00011ef0: 6865 2075 6e66 6f72 7475 6e61 7465 2070  he unfortunate p
-00011f00: 726f 7065 7274 7920 6f66 2062 6568 6176  roperty of behav
-00011f10: 696e 6720 6c69 6b65 2062 6f74 6820 6120  ing like both a 
-00011f20: 6c69 7374 2069 7465 7261 746f 7220 616e  list iterator an
-00011f30: 6420 6120 6469 6374 696f 6e61 7279 0d0a  d a dictionary..
-00011f40: 2020 2020 2349 7427 7320 6120 6269 7420      #It's a bit 
-00011f50: 6f66 2061 206d 6573 730d 0a20 2020 2064  of a mess..    d
-00011f60: 6566 205f 5f69 7465 725f 5f28 7365 6c66  ef __iter__(self
-00011f70: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
-00011f80: 2e5f 6974 6572 6174 6f72 203d 2069 7465  ._iterator = ite
-00011f90: 7228 7365 6c66 2e5f 7374 7275 6374 7572  r(self._structur
-00011fa0: 655f 656c 656d 656e 742e 7761 6c6b 2829  e_element.walk()
-00011fb0: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00011fc0: 6e20 7365 6c66 0d0a 0d0a 2020 2020 6465  n self....    de
-00011fd0: 6620 5f5f 6e65 7874 5f5f 2873 656c 6629  f __next__(self)
-00011fe0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-00011ff0: 6e20 6e65 7874 2873 656c 662e 5f69 7465  n next(self._ite
-00012000: 7261 746f 7229 0d0a 0d0a 2020 2020 6465  rator)....    de
-00012010: 6620 5f6e 6f72 6d61 6c69 7365 5f6b 6579  f _normalise_key
-00012020: 2873 656c 662c 6b65 7929 3a0d 0a20 2020  (self,key):..   
-00012030: 2020 2020 2023 5468 6520 696d 706f 7274       #The import
-00012040: 616e 7420 7061 7274 206f 6620 6465 7363  ant part of desc
-00012050: 656e 6461 6e74 7320 6973 2074 6861 7420  endants is that 
-00012060: 796f 7520 6361 6e20 6769 7665 2061 2063  you can give a c
-00012070: 6f6d 706f 7369 7465 206b 6579 2c20 6569  omposite key, ei
-00012080: 7468 6572 2061 7320 6120 7374 7269 6e67  ther as a string
-00012090: 206f 7220 6173 2061 206c 6973 740d 0a20   or as a list.. 
-000120a0: 2020 2020 2020 2023 6966 206b 6579 2069         #if key i
-000120b0: 7320 6120 7374 7269 6e67 2074 6865 6e20  s a string then 
-000120c0: 7765 2077 616e 7420 746f 2073 706c 6974  we want to split
-000120d0: 2069 7420 286f 6e20 666f 7277 6172 6420   it (on forward 
-000120e0: 736c 6173 6865 7329 2061 6e64 2063 7265  slashes) and cre
-000120f0: 6174 6520 6120 6c69 7374 206f 6620 7368  ate a list of sh
-00012100: 6f72 7463 6f64 6573 0d0a 2020 2020 2020  ortcodes..      
-00012110: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00012120: 6b65 792c 7374 7229 3a0d 0a20 2020 2020  key,str):..     
-00012130: 2020 2020 2020 2074 656d 705f 6b65 7920         temp_key 
-00012140: 3d20 6b65 792e 7370 6c69 7428 272f 2729  = key.split('/')
-00012150: 0d0a 2020 2020 2020 2020 2020 2020 6b65  ..            ke
-00012160: 7920 3d20 5b5d 0d0a 2020 2020 2020 2020  y = []..        
-00012170: 2020 2020 666f 7220 6b20 696e 2074 656d      for k in tem
-00012180: 705f 6b65 793a 0d0a 2020 2020 2020 2020  p_key:..        
-00012190: 2020 2020 2020 2020 6b20 3d20 6b2e 7374          k = k.st
-000121a0: 7269 7028 290d 0a20 2020 2020 2020 2020  rip()..         
-000121b0: 2020 2020 2020 2069 6620 6c65 6e28 6b29         if len(k)
-000121c0: 3e33 303a 0d0a 2020 2020 2020 2020 2020  >30:..          
-000121d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000121e0: 5661 6c75 6545 7272 6f72 2827 4b65 7920  ValueError('Key 
-000121f0: 636f 6e74 6169 6e73 2061 2073 686f 7274  contains a short
-00012200: 636f 6465 206c 6f6e 6765 7220 7468 616e  code longer than
-00012210: 2033 3020 6368 6172 6163 7465 7273 203a   30 characters :
-00012220: 272b 7374 7228 6b29 290d 0a20 2020 2020  '+str(k))..     
-00012230: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00012240: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00012250: 2020 2020 2020 6b65 792e 6170 7065 6e64        key.append
-00012260: 286b 290d 0a20 2020 2020 2020 2065 6c73  (k)..        els
-00012270: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00012280: 7061 7373 0d0a 0d0a 2020 2020 2020 2020  pass....        
-00012290: 7265 7475 726e 206b 6579 0d0a 0d0a 2020  return key....  
-000122a0: 2020 2354 4f44 4f20 2d20 6368 616e 6765    #TODO - change
-000122b0: 2074 6869 7320 746f 2063 616c 6c20 6765   this to call ge
-000122c0: 7420 656c 656d 656e 7473 206f 6e20 6120  t elements on a 
-000122d0: 7369 6e67 6c65 2073 686f 7274 636f 6465  single shortcode
-000122e0: 206b 6579 2077 6869 6368 2069 7320 6e6f   key which is no
-000122f0: 7420 6174 2072 6f6f 740d 0a20 2020 2023  t at root..    #
-00012300: 4368 616e 6765 2074 6869 7320 746f 2073  Change this to s
-00012310: 6561 7263 6820 666f 7220 6669 7273 7420  earch for first 
-00012320: 656c 656d 656e 7420 7573 696e 6720 6765  element using ge
-00012330: 745f 656c 656d 656e 7473 2061 6e64 2074  t_elements and t
-00012340: 6865 6e20 6d61 7463 6820 7468 6520 7265  hen match the re
-00012350: 7374 206f 6620 7468 6520 7472 6565 0d0a  st of the tree..
-00012360: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
-00012370: 6d5f 5f28 7365 6c66 2c6b 6579 293a 0d0a  m__(self,key):..
-00012380: 2020 2020 2020 2020 2354 6865 2069 6d70          #The imp
-00012390: 6f72 7461 6e74 2070 6172 7420 6f66 2064  ortant part of d
-000123a0: 6573 6365 6e64 616e 7473 2069 7320 7468  escendants is th
-000123b0: 6174 2079 6f75 2063 616e 2067 6976 6520  at you can give 
-000123c0: 6120 636f 6d70 6f73 6974 6520 6b65 792c  a composite key,
-000123d0: 2065 6974 6865 7220 6173 2061 2073 7472   either as a str
-000123e0: 696e 6720 6f72 2061 7320 6120 6c69 7374  ing or as a list
-000123f0: 0d0a 0d0a 2020 2020 2020 2020 6b65 7920  ....        key 
-00012400: 3d20 7365 6c66 2e5f 6e6f 726d 616c 6973  = self._normalis
-00012410: 655f 6b65 7928 6b65 7929 0d0a 0d0a 2020  e_key(key)....  
-00012420: 2020 2020 2020 2361 7373 756d 6520 7765        #assume we
-00012430: 2063 616e 2069 7465 7261 7465 206f 7665   can iterate ove
-00012440: 7220 7468 6520 6b65 7920 7061 7373 6564  r the key passed
-00012450: 2069 6e20 6f72 2074 6865 206b 6579 2063   in or the key c
-00012460: 7265 6174 6564 2066 726f 6d20 7468 6520  reated from the 
-00012470: 7374 7269 6e67 0d0a 2020 2020 2020 2020  string..        
-00012480: 2364 6573 6365 6e64 2074 6865 2068 6965  #descend the hie
-00012490: 7261 7263 6879 2075 6e74 696c 2077 6520  rarchy until we 
-000124a0: 6669 6e64 2074 6865 2065 6c65 6d65 6e74  find the element
-000124b0: 0d0a 2020 2020 2020 2020 7265 7476 616c  ..        retval
-000124c0: 203d 2073 656c 662e 5f73 7472 7563 7475   = self._structu
-000124d0: 7265 5f65 6c65 6d65 6e74 0d0a 2020 2020  re_element..    
-000124e0: 2020 2020 6966 206c 656e 286b 6579 2920      if len(key) 
-000124f0: 3e20 303a 0d0a 2020 2020 2020 2020 2020  > 0:..          
-00012500: 2020 666f 7220 6b20 696e 206b 6579 3a0d    for k in key:.
-00012510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012520: 2072 6574 7661 6c20 3d20 7265 7476 616c   retval = retval
-00012530: 2e63 6869 6c64 7265 6e5b 6b5d 0d0a 0d0a  .children[k]....
-00012540: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00012550: 6574 7661 6c0d 0a0d 0a20 2020 2064 6566  etval....    def
-00012560: 205f 5f73 6574 6974 656d 5f5f 2873 656c   __setitem__(sel
-00012570: 662c 206b 6579 2c20 6974 656d 293a 0d0a  f, key, item):..
-00012580: 2020 2020 2020 2020 6173 7365 7274 2069          assert i
-00012590: 7369 6e73 7461 6e63 6528 6974 656d 2c53  sinstance(item,S
-000125a0: 7472 7563 7475 7265 456c 656d 656e 7429  tructureElement)
-000125b0: 0d0a 0d0a 2020 2020 2020 2020 6b65 7920  ....        key 
-000125c0: 3d20 7365 6c66 2e5f 6e6f 726d 616c 6973  = self._normalis
-000125d0: 655f 6b65 7928 6b65 7929 0d0a 0d0a 2020  e_key(key)....  
-000125e0: 2020 2020 2020 6c6f 6f6b 6564 5f75 705f        looked_up_
-000125f0: 6974 656d 203d 2073 656c 665b 6b65 795d  item = self[key]
-00012600: 0d0a 0d0a 2020 2020 2020 2020 6173 7365  ....        asse
-00012610: 7274 2069 7369 6e73 7461 6e63 6528 6c6f  rt isinstance(lo
-00012620: 6f6b 6564 5f75 705f 6974 656d 2c53 7472  oked_up_item,Str
-00012630: 7563 7475 7265 456c 656d 656e 7429 0d0a  uctureElement)..
-00012640: 0d0a 2020 2020 2020 2020 6966 206c 6f6f  ..        if loo
-00012650: 6b65 645f 7570 5f69 7465 6d2e 6973 5f72  ked_up_item.is_r
-00012660: 6f6f 743a 0d0a 2020 2020 2020 2020 2020  oot:..          
-00012670: 2020 2353 6574 2074 6865 2068 6965 7261    #Set the hiera
-00012680: 7263 6879 2074 6f20 7468 6520 636f 7272  rchy to the corr
-00012690: 6563 7420 6974 656d 0d0a 2020 2020 2020  ect item..      
-000126a0: 2020 2020 2020 6c6f 6f6b 6564 5f75 705f        looked_up_
-000126b0: 6974 656d 2e73 7472 7563 7475 7265 2e68  item.structure.h
-000126c0: 6965 7261 7263 6869 6573 5b6c 6f6f 6b65  ierarchies[looke
-000126d0: 645f 7570 5f69 7465 6d2e 7368 6f72 7463  d_up_item.shortc
-000126e0: 6f64 655d 203d 2069 7465 6d0d 0a20 2020  ode] = item..   
-000126f0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00012700: 2020 2020 2020 2020 6c6f 6f6b 6564 5f75          looked_u
-00012710: 705f 6974 656d 2e70 6172 656e 742e 6368  p_item.parent.ch
-00012720: 696c 6472 656e 5b6c 6f6f 6b65 645f 7570  ildren[looked_up
-00012730: 5f69 7465 6d2e 7368 6f72 7463 6f64 655d  _item.shortcode]
-00012740: 203d 2069 7465 6d0d 0a0d 0a20 2020 2064   = item....    d
-00012750: 6566 2061 7070 656e 6428 7365 6c66 2c20  ef append(self, 
-00012760: 6974 656d 293a 0d0a 2020 2020 2020 2020  item):..        
-00012770: 7365 6c66 2e5f 7374 7275 6374 7572 655f  self._structure_
-00012780: 656c 656d 656e 742e 6368 696c 6472 656e  element.children
-00012790: 2e61 7070 656e 6428 6974 656d 290d 0a0d  .append(item)...
-000127a0: 0a20 2020 2023 4a41 5420 3230 3138 2d30  .    #JAT 2018-0
-000127b0: 382d 3130 3a20 4e6f 7420 7265 616c 6c79  8-10: Not really
-000127c0: 2073 7572 6520 686f 7720 7468 6973 2077   sure how this w
-000127d0: 6f75 6c64 2062 6520 636f 6465 6420 2d20  ould be coded - 
-000127e0: 6d61 7962 6520 6279 2072 6574 7572 6e69  maybe by returni
-000127f0: 6e67 2061 6e63 6573 746f 7273 2077 6869  ng ancestors whi
-00012800: 6c65 2077 616c 6b69 6e67 0d0a 2020 2020  le walking..    
-00012810: 2364 6566 206b 6579 7328 7365 6c66 293a  #def keys(self):
-00012820: 0d0a 2020 2020 2320 2020 2023 6966 206e  ..    #    #if n
-00012830: 6f74 2073 656c 662e 6469 6d65 6e73 696f  ot self.dimensio
-00012840: 6e2e 5f65 6c65 6d65 6e74 735f 7265 6164  n._elements_read
-00012850: 3a0d 0a20 2020 2023 2020 2020 2320 2020  :..    #    #   
-00012860: 2073 656c 662e 5f6c 6f61 645f 656c 656d   self._load_elem
-00012870: 656e 7473 2829 0d0a 2020 2020 230d 0a20  ents()..    #.. 
-00012880: 2020 2023 2020 2020 7265 7475 726e 2073     #    return s
-00012890: 656c 662e 5f73 7472 7563 7475 7265 5f65  elf._structure_e
-000128a0: 6c65 6d65 6e74 2e5f 6368 696c 645f 7374  lement._child_st
-000128b0: 7275 6374 7572 655f 656c 656d 656e 7473  ructure_elements
-000128c0: 2e6b 6579 7328 290d 0a20 2020 2023 0d0a  .keys()..    #..
-000128d0: 2020 2020 2364 6566 2069 7465 6d73 2873      #def items(s
-000128e0: 656c 6629 3a0d 0a20 2020 2023 2020 2020  elf):..    #    
-000128f0: 2369 6620 6e6f 7420 7365 6c66 2e64 696d  #if not self.dim
-00012900: 656e 7369 6f6e 2e5f 656c 656d 656e 7473  ension._elements
-00012910: 5f72 6561 643a 0d0a 2020 2020 2320 2020  _read:..    #   
-00012920: 2023 2020 2020 7365 6c66 2e5f 6c6f 6164   #    self._load
-00012930: 5f65 6c65 6d65 6e74 7328 290d 0a20 2020  _elements()..   
-00012940: 2023 0d0a 2020 2020 2320 2020 2072 6574   #..    #    ret
-00012950: 7572 6e20 7365 6c66 2e5f 7374 7275 6374  urn self._struct
-00012960: 7572 655f 656c 656d 656e 742e 5f63 6869  ure_element._chi
-00012970: 6c64 5f73 7472 7563 7475 7265 5f65 6c65  ld_structure_ele
-00012980: 6d65 6e74 732e 6974 656d 7328 290d 0a0d  ments.items()...
-00012990: 0a20 2020 2023 4953 2074 6869 7320 7269  .    #IS this ri
-000129a0: 6768 743f 2061 7265 2077 6520 7265 616c  ght? are we real
-000129b0: 6c79 2077 616c 6b69 6e67 3f0d 0a20 2020  ly walking?..   
-000129c0: 2064 6566 2076 616c 7565 7328 7365 6c66   def values(self
-000129d0: 293a 0d0a 2020 2020 2020 2020 2369 6620  ):..        #if 
-000129e0: 6e6f 7420 7365 6c66 2e64 696d 656e 7369  not self.dimensi
-000129f0: 6f6e 2e5f 656c 656d 656e 7473 5f72 6561  on._elements_rea
-00012a00: 643a 0d0a 2020 2020 2020 2020 2023 2020  d:..         #  
-00012a10: 2073 656c 662e 5f6c 6f61 645f 656c 656d   self._load_elem
-00012a20: 656e 7473 2829 0d0a 0d0a 2020 2020 2020  ents()....      
-00012a30: 2020 7265 7475 726e 2073 656c 662e 5f73    return self._s
-00012a40: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00012a50: 2e77 616c 6b28 290d 0a0d 0a20 2020 2023  .walk()....    #
-00012a60: 6465 6620 5f5f 6c65 6e5f 5f28 7365 6c66  def __len__(self
-00012a70: 293a 0d0a 2020 2020 2320 2020 2023 6966  ):..    #    #if
-00012a80: 206e 6f74 2073 656c 662e 6469 6d65 6e73   not self.dimens
-00012a90: 696f 6e2e 5f65 6c65 6d65 6e74 735f 7265  ion._elements_re
-00012aa0: 6164 3a0d 0a20 2020 2023 2020 2020 2320  ad:..    #    # 
-00012ab0: 2020 2073 656c 662e 5f6c 6f61 645f 656c     self._load_el
-00012ac0: 656d 656e 7473 2829 0d0a 2020 2020 230d  ements()..    #.
-00012ad0: 0a20 2020 2023 2020 2020 7265 7475 726e  .    #    return
-00012ae0: 206c 656e 2873 656c 662e 5f73 7472 7563   len(self._struc
-00012af0: 7475 7265 5f65 6c65 6d65 6e74 2e5f 6368  ture_element._ch
-00012b00: 696c 645f 7374 7275 6374 7572 655f 656c  ild_structure_el
-00012b10: 656d 656e 7473 290d 0a0d 0a20 2020 2023  ements)....    #
-00012b20: 6465 6620 5f5f 7374 725f 5f28 7365 6c66  def __str__(self
-00012b30: 293a 0d0a 2020 2020 2320 2020 2072 6574  ):..    #    ret
-00012b40: 7572 6e20 7374 7228 7365 6c66 2e5f 7374  urn str(self._st
-00012b50: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
-00012b60: 5f63 6869 6c64 5f73 7472 7563 7475 7265  _child_structure
-00012b70: 5f65 6c65 6d65 6e74 7329 0d0a 0d0a 2020  _elements)....  
-00012b80: 2020 6465 6620 636c 6561 7228 7365 6c66    def clear(self
-00012b90: 293a 0d0a 2020 2020 2020 2020 2727 2752  ):..        '''R
-00012ba0: 656d 6f76 6520 616c 6c20 6f66 2074 6865  emove all of the
-00012bb0: 2063 6869 6c64 7265 6e20 6672 6f6d 2074   children from t
-00012bc0: 6865 2053 7472 7563 7475 7265 456c 656d  he StructureElem
-00012bd0: 656e 7420 7768 6f73 6520 6465 7363 656e  ent whose descen
-00012be0: 6461 6e74 7320 6172 6520 6265 696e 6720  dants are being 
-00012bf0: 7265 7475 726e 6564 2e27 2727 0d0a 2020  returned.'''..  
-00012c00: 2020 2020 2020 7365 6c66 2e5f 7374 7275        self._stru
-00012c10: 6374 7572 655f 656c 656d 656e 742e 7265  cture_element.re
-00012c20: 6d6f 7665 5f63 6869 6c64 7265 6e28 290d  move_children().
-00012c30: 0a0d 0a63 6c61 7373 205f 5374 7275 6374  ...class _Struct
-00012c40: 7572 6544 6573 6365 6e64 616e 7473 4765  ureDescendantsGe
-00012c50: 7474 6572 286f 626a 6563 7429 3a0d 0a20  tter(object):.. 
-00012c60: 2020 2027 2727 446f 6573 2061 2062 6974     '''Does a bit
-00012c70: 206f 6620 6d61 6769 6320 746f 2061 6c6c   of magic to all
-00012c80: 6f77 2053 7472 7563 7475 7265 2e64 6573  ow Structure.des
-00012c90: 6365 6e64 616e 7473 2074 6f20 6170 7065  cendants to appe
-00012ca0: 6172 206c 696b 6520 6120 6469 6374 696f  ar like a dictio
-00012cb0: 6e61 7279 2c20 6f6e 6c79 2077 6974 6820  nary, only with 
-00012cc0: 6578 7472 6120 7370 6563 6961 6c20 6675  extra special fu
-00012cd0: 6e63 7469 6f6e 7320 6c69 6b65 202b 3d20  nctions like += 
-00012ce0: 2727 270d 0a20 2020 2064 6566 205f 5f69  '''..    def __i
-00012cf0: 6e69 745f 5f28 7365 6c66 2c73 7472 7563  nit__(self,struc
-00012d00: 7475 7265 293a 0d0a 2020 2020 2020 2020  ture):..        
-00012d10: 7365 6c66 2e5f 7374 7275 6374 7572 6520  self._structure 
-00012d20: 2020 2020 2020 2020 203d 2073 7472 7563           = struc
-00012d30: 7475 7265 0d0a 0d0a 2020 2020 2354 6865  ture....    #The
-00012d40: 205f 5374 7275 6374 7572 6545 6c65 6d65   _StructureEleme
-00012d50: 6e74 4465 7363 656e 6461 6e74 7347 6574  ntDescendantsGet
-00012d60: 7465 7220 6861 7320 7468 6520 756e 666f  ter has the unfo
-00012d70: 7274 756e 6174 6520 7072 6f70 6572 7479  rtunate property
-00012d80: 206f 6620 6265 6861 7669 6e67 206c 696b   of behaving lik
-00012d90: 6520 626f 7468 2061 206c 6973 7420 6974  e both a list it
-00012da0: 6572 6174 6f72 2061 6e64 2061 2064 6963  erator and a dic
-00012db0: 7469 6f6e 6172 790d 0a20 2020 2023 4974  tionary..    #It
-00012dc0: 2773 2061 2062 6974 206f 6620 6120 6d65  's a bit of a me
-00012dd0: 7373 0d0a 2020 2020 6465 6620 5f5f 6974  ss..    def __it
-00012de0: 6572 5f5f 2873 656c 6629 3a0d 0a20 2020  er__(self):..   
-00012df0: 2020 2020 2073 656c 662e 5f69 7465 7261       self._itera
-00012e00: 746f 7220 3d20 6974 6572 2873 656c 662e  tor = iter(self.
-00012e10: 5f73 7472 7563 7475 7265 2e77 616c 6b28  _structure.walk(
-00012e20: 2929 0d0a 2020 2020 2020 2020 7265 7475  ))..        retu
-00012e30: 726e 2073 656c 660d 0a0d 0a20 2020 2064  rn self....    d
-00012e40: 6566 205f 5f6e 6578 745f 5f28 7365 6c66  ef __next__(self
-00012e50: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-00012e60: 726e 206e 6578 7428 7365 6c66 2e5f 6974  rn next(self._it
-00012e70: 6572 6174 6f72 290d 0a0d 0a20 2020 2064  erator)....    d
-00012e80: 6566 205f 6e6f 726d 616c 6973 655f 6b65  ef _normalise_ke
-00012e90: 7928 7365 6c66 2c6b 6579 293a 0d0a 2020  y(self,key):..  
-00012ea0: 2020 2020 2020 2354 6865 2069 6d70 6f72        #The impor
-00012eb0: 7461 6e74 2070 6172 7420 6f66 2064 6573  tant part of des
-00012ec0: 6365 6e64 616e 7473 2069 7320 7468 6174  cendants is that
-00012ed0: 2079 6f75 2063 616e 2067 6976 6520 6120   you can give a 
-00012ee0: 636f 6d70 6f73 6974 6520 6b65 792c 2065  composite key, e
-00012ef0: 6974 6865 7220 6173 2061 2073 7472 696e  ither as a strin
-00012f00: 6720 6f72 2061 7320 6120 6c69 7374 0d0a  g or as a list..
-00012f10: 2020 2020 2020 2020 2369 6620 6b65 7920          #if key 
-00012f20: 6973 2061 2073 7472 696e 6720 7468 656e  is a string then
-00012f30: 2077 6520 7761 6e74 2074 6f20 7370 6c69   we want to spli
-00012f40: 7420 6974 2028 6f6e 2066 6f72 7761 7264  t it (on forward
-00012f50: 2073 6c61 7368 2920 616e 6420 6372 6561   slash) and crea
-00012f60: 7465 2061 206c 6973 7420 6f66 2073 686f  te a list of sho
-00012f70: 7274 636f 6465 730d 0a20 2020 2020 2020  rtcodes..       
-00012f80: 2069 6620 6973 696e 7374 616e 6365 286b   if isinstance(k
-00012f90: 6579 2c73 7472 293a 0d0a 2020 2020 2020  ey,str):..      
-00012fa0: 2020 2020 2020 7465 6d70 5f6b 6579 203d        temp_key =
-00012fb0: 206b 6579 2e73 706c 6974 2827 2f27 290d   key.split('/').
-00012fc0: 0a20 2020 2020 2020 2020 2020 206b 6579  .            key
-00012fd0: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
-00012fe0: 2020 2066 6f72 206b 2069 6e20 7465 6d70     for k in temp
-00012ff0: 5f6b 6579 3a0d 0a20 2020 2020 2020 2020  _key:..         
-00013000: 2020 2020 2020 206b 203d 206b 2e73 7472         k = k.str
-00013010: 6970 2829 0d0a 2020 2020 2020 2020 2020  ip()..          
-00013020: 2020 2020 2020 6966 206c 656e 286b 293e        if len(k)>
-00013030: 6c6c 752e 7368 6f72 746e 616d 655f 7369  llu.shortname_si
-00013040: 7a65 3a0d 0a20 2020 2020 2020 2020 2020  ze:..           
-00013050: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00013060: 616c 7565 4572 726f 7228 0d0a 2020 2020  alueError(..    
-00013070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013080: 2020 2020 274b 6579 2063 6f6e 7461 696e      'Key contain
-00013090: 7320 6120 7368 6f72 7463 6f64 6520 6c6f  s a shortcode lo
-000130a0: 6e67 6572 2074 6861 6e20 7b6d 6178 5f6c  nger than {max_l
-000130b0: 656e 6774 687d 2063 6861 7261 6374 6572  ength} character
-000130c0: 7320 3a7b 6163 7475 616c 5f6c 656e 6774  s :{actual_lengt
-000130d0: 687d 204d 616b 6520 7375 7265 206b 6579  h} Make sure key
-000130e0: 2069 7320 7365 7061 7261 7465 6420 6279   is separated by
-000130f0: 2066 6f72 7761 7264 7320 736c 6173 6865   forwards slashe
-00013100: 7320 282f 2927 0d0a 2020 2020 2020 2020  s (/)'..        
-00013110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013120: 2e66 6f72 6d61 7428 6c6c 752e 7368 6f72  .format(llu.shor
-00013130: 746e 616d 655f 7369 7a65 2c20 6b29 0d0a  tname_size, k)..
-00013140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013150: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
-00013160: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0000d940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d970: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
+0000d980: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0000d990: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000d9a0: 206d 7065 782e 456d 706f 7765 7249 6d70   mpex.EmpowerImp
+0000d9b0: 6f72 7465 7256 6572 7369 6f6e 4572 726f  orterVersionErro
+0000d9c0: 7228 2746 756e 6374 696f 6e61 6c69 7479  r('Functionality
+0000d9d0: 206e 6f74 2061 7661 696c 6162 6c65 2069   not available i
+0000d9e0: 6e20 7468 6973 2045 6d70 6f77 6572 2049  n this Empower I
+0000d9f0: 6d70 6f72 7465 7220 7665 7273 696f 6e20  mporter version 
+0000da00: 7b7d 206e 6565 6420 6174 206c 6561 7374  {} need at least
+0000da10: 207b 7d27 2e66 6f72 6d61 7428 272e 272e   {}'.format('.'.
+0000da20: 6a6f 696e 285b 7374 7228 7629 2066 6f72  join([str(v) for
+0000da30: 2076 2069 6e20 7365 6c66 2e64 696d 656e   v in self.dimen
+0000da40: 7369 6f6e 2e73 6974 652e 696d 706f 7274  sion.site.import
+0000da50: 6572 5f76 6572 7369 6f6e 5d29 2c20 2739  er_version]), '9
+0000da60: 2e35 2e31 372e 3138 3934 2729 290d 0a20  .5.17.1894')).. 
+0000da70: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+0000da80: 6365 7074 696f 6e3a 0d0a 2020 2020 2020  ception:..      
+0000da90: 2020 2020 2020 7365 6c66 2e5f 7374 7275        self._stru
+0000daa0: 6374 7572 6573 5f72 6561 6420 3d20 4661  ctures_read = Fa
+0000dab0: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+0000dac0: 2072 6169 7365 0d0a 0d0a 0d0a 2020 2020   raise......    
+0000dad0: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
+0000dae0: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+0000daf0: 7572 6e20 277b 7d20 6672 6f6d 203c 7b7d  urn '{} from <{}
+0000db00: 206f 626a 6563 7420 6174 207b 7d3e 272e   object at {}>'.
+0000db10: 666f 726d 6174 2827 7b27 202b 2027 5c6e  format('{' + '\n
+0000db20: 272e 6a6f 696e 285b 2022 277b 7d27 3a7b  '.join([ "'{}':{
+0000db30: 7d22 2e66 6f72 6d61 7428 6b2c 7265 7072  }".format(k,repr
+0000db40: 2876 2929 2066 6f72 206b 2c76 2069 6e20  (v)) for k,v in 
+0000db50: 7365 6c66 2e69 7465 6d73 2829 5d29 202b  self.items()]) +
+0000db60: 2027 7d27 2c73 656c 662e 5f5f 636c 6173   '}',self.__clas
+0000db70: 735f 5f2e 5f5f 6e61 6d65 5f5f 2c68 6578  s__.__name__,hex
+0000db80: 2869 6428 7365 6c66 2929 2029 0d0a 0d0a  (id(self)) )....
+0000db90: 636c 6173 7320 5f48 6965 7261 7263 6869  class _Hierarchi
+0000dba0: 6573 4765 7474 6572 286f 626a 6563 7429  esGetter(object)
+0000dbb0: 3a0d 0a20 2020 2027 2727 446f 6573 2061  :..    '''Does a
+0000dbc0: 2062 6974 206f 6620 6d61 6769 6320 746f   bit of magic to
+0000dbd0: 2061 6c6c 6f77 2053 7472 7563 7475 7265   allow Structure
+0000dbe0: 7320 746f 2068 6176 6520 6869 6572 6172  s to have hierar
+0000dbf0: 6368 6965 7320 2869 2e65 2e20 726f 6f74  chies (i.e. root
+0000dc00: 2073 7472 7563 7475 7265 7329 2061 7070   structures) app
+0000dc10: 6561 7220 6c69 6b65 2061 2064 6963 7469  ear like a dicti
+0000dc20: 6f6e 6172 7927 2727 0d0a 2020 2020 6465  onary'''..    de
+0000dc30: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+0000dc40: 7374 7275 6374 7572 6529 3a0d 0a20 2020  structure):..   
+0000dc50: 2020 2020 2073 656c 662e 7374 7275 6374       self.struct
+0000dc60: 7572 653d 7374 7275 6374 7572 650d 0a20  ure=structure.. 
+0000dc70: 2020 2020 2020 2073 656c 662e 636c 6561         self.clea
+0000dc80: 7228 290d 0a0d 0a20 2020 2023 556e 6c69  r()....    #Unli
+0000dc90: 6b65 2061 2073 7461 6e64 6172 6420 6469  ke a standard di
+0000dca0: 6374 696f 6e61 7279 2077 6869 6368 2072  ctionary which r
+0000dcb0: 6574 7572 6e73 206b 6579 7320 696e 2069  eturns keys in i
+0000dcc0: 7465 722c 2072 6574 7572 6e20 7661 6c75  ter, return valu
+0000dcd0: 6573 2028 7369 6e63 6520 7468 6174 2773  es (since that's
+0000dce0: 2077 6861 7420 7765 2075 7375 616c 6c79   what we usually
+0000dcf0: 2077 616e 7429 0d0a 2020 2020 6465 6620   want)..    def 
+0000dd00: 5f5f 6974 6572 5f5f 2873 656c 6629 3a0d  __iter__(self):.
+0000dd10: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0000dd20: 7365 6c66 2e73 7472 7563 7475 7265 2e5f  self.structure._
+0000dd30: 6869 6572 6172 6368 6965 735f 7265 6164  hierarchies_read
+0000dd40: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0000dd50: 6c6f 672e 696e 666f 2827 5f6c 6f61 645f  log.info('_load_
+0000dd60: 7374 7275 6374 7572 6520 3630 3227 290d  structure 602').
+0000dd70: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000dd80: 662e 7374 7275 6374 7572 652e 6469 6d65  f.structure.dime
+0000dd90: 6e73 696f 6e2e 7374 7275 6374 7572 6573  nsion.structures
+0000dda0: 2e5f 6c6f 6164 5f73 7472 7563 7475 7265  ._load_structure
+0000ddb0: 2873 656c 662e 7374 7275 6374 7572 652e  (self.structure.
+0000ddc0: 7368 6f72 7463 6f64 6529 0d0a 2020 2020  shortcode)..    
+0000ddd0: 2020 2020 7365 6c66 2e5f 6974 6572 6174      self._iterat
+0000dde0: 6f72 203d 2069 7465 7228 7365 6c66 2e5f  or = iter(self._
+0000ddf0: 726f 6f74 5f65 6c65 6d65 6e74 732e 7661  root_elements.va
+0000de00: 6c75 6573 2829 290d 0a20 2020 2020 2020  lues())..       
+0000de10: 2072 6574 7572 6e20 7365 6c66 0d0a 0d0a   return self....
+0000de20: 2020 2020 6465 6620 5f5f 6e65 7874 5f5f      def __next__
+0000de30: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+0000de40: 2072 6574 7572 6e20 6e65 7874 2873 656c   return next(sel
+0000de50: 662e 5f69 7465 7261 746f 7229 0d0a 0d0a  f._iterator)....
+0000de60: 0d0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
+0000de70: 7465 6d5f 5f28 7365 6c66 2c69 7465 6d29  tem__(self,item)
+0000de80: 3a0d 0a20 2020 2020 2020 2023 6966 206e  :..        #if n
+0000de90: 6f74 2073 656c 662e 7374 7275 6374 7572  ot self.structur
+0000dea0: 652e 5f68 6965 7261 7263 6869 6573 5f72  e._hierarchies_r
+0000deb0: 6561 643a 0d0a 2020 2020 2020 2020 2320  ead:..        # 
+0000dec0: 2020 2073 656c 662e 5f6c 6f61 645f 7374     self._load_st
+0000ded0: 7275 6374 7572 6528 6974 656d 290d 0a20  ructure(item).. 
+0000dee0: 2020 2020 2020 2023 2020 2020 7365 6c66         #    self
+0000def0: 2e5f 7374 7275 6374 7572 6573 5b69 7465  ._structures[ite
+0000df00: 6d5d 2e64 696d 656e 7369 6f6e 3d73 656c  m].dimension=sel
+0000df10: 662e 6469 6d65 6e73 696f 6e0d 0a20 2020  f.dimension..   
+0000df20: 2020 2020 2068 6965 7220 3d20 7365 6c66       hier = self
+0000df30: 2e73 7472 7563 7475 7265 2e67 6574 5f72  .structure.get_r
+0000df40: 6f6f 745f 656c 656d 656e 7428 6974 656d  oot_element(item
+0000df50: 290d 0a20 2020 2020 2020 2069 6620 6869  )..        if hi
+0000df60: 6572 2069 7320 4e6f 6e65 3a0d 0a20 2020  er is None:..   
+0000df70: 2020 2020 2020 2020 2072 6169 7365 204b           raise K
+0000df80: 6579 4572 726f 7228 2753 7472 7563 7475  eyError('Structu
+0000df90: 7265 456c 656d 656e 7420 7769 7468 2073  reElement with s
+0000dfa0: 686f 7274 636f 6465 207b 7d20 6973 206e  hortcode {} is n
+0000dfb0: 6f74 2069 6e20 6869 6572 6172 6368 6965  ot in hierarchie
+0000dfc0: 7320 2869 2e65 2e20 726f 6f74 2065 6c65  s (i.e. root ele
+0000dfd0: 6d65 6e74 7329 206f 6620 5374 7275 6374  ments) of Struct
+0000dfe0: 7572 6520 7b7d 272e 666f 726d 6174 2869  ure {}'.format(i
+0000dff0: 7465 6d2c 7365 6c66 2e73 7472 7563 7475  tem,self.structu
+0000e000: 7265 2e73 686f 7274 636f 6465 2929 0d0a  re.shortcode))..
+0000e010: 2020 2020 2020 2020 7265 7475 726e 2068          return h
+0000e020: 6965 720d 0a0d 0a20 2020 2064 6566 205f  ier....    def _
+0000e030: 5f73 6574 6974 656d 5f5f 2873 656c 662c  _setitem__(self,
+0000e040: 206b 6579 2c20 6974 656d 293a 0d0a 2020   key, item):..  
+0000e050: 2020 2020 2020 7365 6c66 2e61 7070 656e        self.appen
+0000e060: 6428 6974 656d 290d 0a0d 0a20 2020 2064  d(item)....    d
+0000e070: 6566 2063 6c65 6172 2873 656c 6629 3a0d  ef clear(self):.
+0000e080: 0a20 2020 2020 2020 2073 656c 662e 5f72  .        self._r
+0000e090: 6f6f 745f 656c 656d 656e 7473 3d63 6f6c  oot_elements=col
+0000e0a0: 6c65 6374 696f 6e73 2e4f 7264 6572 6564  lections.Ordered
+0000e0b0: 4469 6374 2829 0d0a 2020 2020 2020 2020  Dict()..        
+0000e0c0: 2349 6620 7765 2776 6520 636c 6561 7265  #If we've cleare
+0000e0d0: 6420 6974 2c20 7765 2064 6f6e 2774 206e  d it, we don't n
+0000e0e0: 6565 6420 746f 2072 6561 6420 6974 2c20  eed to read it, 
+0000e0f0: 7765 276c 6c20 6f6e 6c79 2061 6363 6964  we'll only accid
+0000e100: 656e 7461 6c6c 7920 6f76 6572 7772 6974  entally overwrit
+0000e110: 6520 6f6e 2074 6865 2066 6972 7374 2072  e on the first r
+0000e120: 6561 6421 0d0a 2020 2020 2020 2020 7365  ead!..        se
+0000e130: 6c66 2e73 7472 7563 7475 7265 2e5f 6869  lf.structure._hi
+0000e140: 6572 6172 6368 6965 735f 7265 6164 203d  erarchies_read =
+0000e150: 2054 7275 650d 0a0d 0a20 2020 2064 6566   True....    def
+0000e160: 2061 7070 656e 6428 7365 6c66 2c20 6974   append(self, it
+0000e170: 656d 293a 0d0a 0d0a 0d0a 0d0a 2020 2020  em):........    
+0000e180: 2020 2020 5f69 7465 6d5f 6973 5f73 7472      _item_is_str
+0000e190: 7563 7475 7265 5f65 6c65 6d65 6e74 203d  ucture_element =
+0000e1a0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+0000e1b0: 5f69 7465 6d5f 6973 5f65 6c65 6d65 6e74  _item_is_element
+0000e1c0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+0000e1d0: 2020 5f69 7465 6d5f 6973 5f73 686f 7274    _item_is_short
+0000e1e0: 636f 6465 203d 2046 616c 7365 0d0a 0d0a  code = False....
+0000e1f0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0000e200: 7461 6e63 6528 6974 656d 2c20 7374 7229  tance(item, str)
+0000e210: 3a0d 0a20 2020 2020 2020 2020 2020 205f  :..            _
+0000e220: 6974 656d 5f69 735f 7368 6f72 7463 6f64  item_is_shortcod
+0000e230: 6520 3d20 5472 7565 0d0a 2020 2020 2020  e = True..      
+0000e240: 2020 656c 7365 3a0d 0a0d 0a20 2020 2020    else:....     
+0000e250: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+0000e260: 2020 2020 2020 2020 2020 2020 2069 7465               ite
+0000e270: 6d2e 6973 5f72 6f6f 740d 0a20 2020 2020  m.is_root..     
+0000e280: 2020 2020 2020 2020 2020 205f 6974 656d             _item
+0000e290: 5f69 735f 7374 7275 6374 7572 655f 656c  _is_structure_el
+0000e2a0: 656d 656e 7420 3d20 5472 7565 0d0a 2020  ement = True..  
+0000e2b0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000e2c0: 2041 7474 7269 6275 7465 4572 726f 723a   AttributeError:
+0000e2d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e2e0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+0000e2f0: 2020 2020 2020 2020 2020 2020 6974 656d              item
+0000e300: 2e5f 6d65 6173 7572 650d 0a20 2020 2020  ._measure..     
+0000e310: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0000e320: 6974 656d 5f69 735f 656c 656d 656e 7420  item_is_element 
+0000e330: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+0000e340: 2020 2020 2020 2020 6578 6365 7074 2041          except A
+0000e350: 7474 7269 6275 7465 4572 726f 723a 0d0a  ttributeError:..
+0000e360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e370: 2020 2020 2369 6620 7468 6520 6974 656d      #if the item
+0000e380: 2069 7320 616e 2069 7465 7261 626c 6520   is an iterable 
+0000e390: 2861 6e64 2069 736e 2774 2061 2073 7472  (and isn't a str
+0000e3a0: 696e 6729 2c20 6170 7065 6e64 2061 6c6c  ing), append all
+0000e3b0: 2069 7465 6d73 2074 6f20 7365 6c66 0d0a   items to self..
+0000e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e3d0: 2020 2020 2354 6869 7320 7761 7920 7765      #This way we
+0000e3e0: 2063 616e 2061 6464 2061 206c 6973 7420   can add a list 
+0000e3f0: 6f66 2074 6869 6e67 7320 746f 2061 2068  of things to a h
+0000e400: 6965 7261 7263 6879 0d0a 2020 2020 2020  ierarchy..      
+0000e410: 2020 2020 2020 2020 2020 2020 2020 2374                #t
+0000e420: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0000e430: 2020 2020 2020 2020 2066 6f72 2073 7562           for sub
+0000e440: 5f69 7465 6d20 696e 2069 7465 6d3a 0d0a  _item in item:..
+0000e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e460: 2020 2020 2020 2020 7365 6c66 2e61 7070          self.app
+0000e470: 656e 6428 7375 625f 6974 656d 290d 0a20  end(sub_item).. 
+0000e480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e490: 2020 2072 6574 7572 6e0d 0a20 2020 2020     return..     
+0000e4a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000e4b0: 2357 6527 6c6c 2067 6574 2061 2054 7970  #We'll get a Typ
+0000e4c0: 6545 7272 6f72 2069 6620 7468 6520 6f62  eError if the ob
+0000e4d0: 6a65 6374 2069 7320 6e6f 7420 6974 6572  ject is not iter
+0000e4e0: 6162 6c65 0d0a 2020 2020 2020 2020 2020  able..          
+0000e4f0: 2020 2020 2020 2020 2020 2365 7863 6570            #excep
+0000e500: 7420 5479 7065 4572 726f 723a 0d0a 2020  t TypeError:..  
+0000e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e520: 2020 2320 2020 2070 6173 730d 0a0d 0a20    #    pass.... 
+0000e530: 2020 2020 2020 2069 6620 5f69 7465 6d5f         if _item_
+0000e540: 6973 5f73 7472 7563 7475 7265 5f65 6c65  is_structure_ele
+0000e550: 6d65 6e74 3a0d 0a20 2020 2020 2020 2020  ment:..         
+0000e560: 2020 205f 7374 7275 6374 7572 655f 656c     _structure_el
+0000e570: 656d 656e 7420 3d20 6974 656d 0d0a 2020  ement = item..  
+0000e580: 2020 2020 2020 2020 2020 6966 205f 7374            if _st
+0000e590: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
+0000e5a0: 7374 7275 6374 7572 6520 6973 204e 6f6e  structure is Non
+0000e5b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000e5c0: 2020 2020 2357 6520 6172 6520 7072 6f62      #We are prob
+0000e5d0: 6162 6c79 2061 7070 656e 6469 6e67 2061  ably appending a
+0000e5e0: 2063 6f70 6965 6420 6869 6572 6172 6368   copied hierarch
+0000e5f0: 7920 2d20 7365 7420 7468 6520 7374 7275  y - set the stru
+0000e600: 6374 7572 6520 7468 726f 7567 686f 7574  cture throughout
+0000e610: 2074 6865 2074 7265 650d 0a20 2020 2020   the tree..     
+0000e620: 2020 2020 2020 2020 2020 205f 7374 7275             _stru
+0000e630: 6374 7572 655f 656c 656d 656e 742e 7374  cture_element.st
+0000e640: 7275 6374 7572 6520 3d20 7365 6c66 2e73  ructure = self.s
+0000e650: 7472 7563 7475 7265 0d0a 2020 2020 2020  tructure..      
+0000e660: 2020 2020 2020 2020 2020 666f 7220 6368            for ch
+0000e670: 2069 6e20 5f73 7472 7563 7475 7265 5f65   in _structure_e
+0000e680: 6c65 6d65 6e74 2e77 616c 6b28 293a 0d0a  lement.walk():..
+0000e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6a0: 2020 2020 6368 2e73 7472 7563 7475 7265      ch.structure
+0000e6b0: 203d 2073 656c 662e 7374 7275 6374 7572   = self.structur
+0000e6c0: 650d 0a0d 0a20 2020 2020 2020 2065 6c69  e....        eli
+0000e6d0: 6620 5f69 7465 6d5f 6973 5f65 6c65 6d65  f _item_is_eleme
+0000e6e0: 6e74 3a0d 0a20 2020 2020 2020 2020 2020  nt:..           
+0000e6f0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+0000e700: 2020 2020 2020 205f 7374 7275 6374 7572         _structur
+0000e710: 655f 656c 656d 656e 7420 3d20 7365 6c66  e_element = self
+0000e720: 2e73 7472 7563 7475 7265 2e68 6965 7261  .structure.hiera
+0000e730: 7263 6869 6573 5b69 7465 6d2e 7368 6f72  rchies[item.shor
+0000e740: 7463 6f64 655d 0d0a 2020 2020 2020 2020  tcode]..        
+0000e750: 2020 2020 2020 2020 2370 7269 6e74 2869          #print(i
+0000e760: 7465 6d2e 7368 6f72 7463 6f64 652c 205f  tem.shortcode, _
+0000e770: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+0000e780: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+0000e790: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
+0000e7a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0000e7b0: 2020 5f73 7472 7563 7475 7265 5f65 6c65    _structure_ele
+0000e7c0: 6d65 6e74 203d 2053 7472 7563 7475 7265  ment = Structure
+0000e7d0: 456c 656d 656e 7428 7374 7275 6374 7572  Element(structur
+0000e7e0: 653d 7365 6c66 2e73 7472 7563 7475 7265  e=self.structure
+0000e7f0: 2c65 6c65 6d65 6e74 3d69 7465 6d2c 6973  ,element=item,is
+0000e800: 5f72 6f6f 743d 5472 7565 290d 0a0d 0a20  _root=True).... 
+0000e810: 2020 2020 2020 2065 6c69 6620 5f69 7465         elif _ite
+0000e820: 6d5f 6973 5f73 686f 7274 636f 6465 3a0d  m_is_shortcode:.
+0000e830: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+0000e840: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000e850: 2020 205f 7374 7275 6374 7572 655f 656c     _structure_el
+0000e860: 656d 656e 7420 3d20 7365 6c66 2e73 7472  ement = self.str
+0000e870: 7563 7475 7265 2e68 6965 7261 7263 6869  ucture.hierarchi
+0000e880: 6573 5b69 7465 6d5d 0d0a 2020 2020 2020  es[item]..      
+0000e890: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+0000e8a0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+0000e8b0: 2020 2020 2020 2020 5f65 6c65 6d65 6e74          _element
+0000e8c0: 203d 2073 656c 662e 7374 7275 6374 7572   = self.structur
+0000e8d0: 652e 6469 6d65 6e73 696f 6e2e 656c 656d  e.dimension.elem
+0000e8e0: 656e 7473 5b69 7465 6d5d 0d0a 2020 2020  ents[item]..    
+0000e8f0: 2020 2020 2020 2020 2020 2020 5f73 7472              _str
+0000e900: 7563 7475 7265 5f65 6c65 6d65 6e74 203d  ucture_element =
+0000e910: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
+0000e920: 7428 7374 7275 6374 7572 653d 7365 6c66  t(structure=self
+0000e930: 2e73 7472 7563 7475 7265 2c65 6c65 6d65  .structure,eleme
+0000e940: 6e74 3d5f 656c 656d 656e 742c 6973 5f72  nt=_element,is_r
+0000e950: 6f6f 743d 5472 7565 290d 0a0d 0a20 2020  oot=True)....   
+0000e960: 2020 2020 2069 6620 6e6f 7420 5f73 7472       if not _str
+0000e970: 7563 7475 7265 5f65 6c65 6d65 6e74 2e65  ucture_element.e
+0000e980: 6c65 6d65 6e74 2e6d 6173 7465 7265 643a  lement.mastered:
+0000e990: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0000e9a0: 6973 6520 4174 7472 6962 7574 6545 7272  ise AttributeErr
+0000e9b0: 6f72 2827 4361 6e6e 6f74 2063 7265 6174  or('Cannot creat
+0000e9c0: 6520 6120 6869 6572 6172 6368 7920 7769  e a hierarchy wi
+0000e9d0: 7468 2075 6e2d 7379 6e63 6872 6f6e 6973  th un-synchronis
+0000e9e0: 6564 2045 6c65 6d65 6e74 207b 7d20 7573  ed Element {} us
+0000e9f0: 6520 4469 6d65 6e73 696f 6e2e 656c 656d  e Dimension.elem
+0000ea00: 656e 7473 2e73 796e 6368 726f 6e69 7365  ents.synchronise
+0000ea10: 2829 2062 6566 6f72 6520 6372 6561 7469  () before creati
+0000ea20: 6e67 2074 6865 2068 6965 7261 7263 6879  ng the hierarchy
+0000ea30: 2729 0d0a 0d0a 0d0a 2020 2020 2020 2020  ')......        
+0000ea40: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+0000ea50: 6e74 2e69 735f 726f 6f74 203d 2054 7275  nt.is_root = Tru
+0000ea60: 650d 0a0d 0a20 2020 2020 2020 2074 7279  e....        try
+0000ea70: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0000ea80: 656c 662e 5f72 6f6f 745f 656c 656d 656e  elf._root_elemen
+0000ea90: 7473 2e70 6f70 285f 7374 7275 6374 7572  ts.pop(_structur
+0000eaa0: 655f 656c 656d 656e 742e 7368 6f72 7463  e_element.shortc
+0000eab0: 6f64 6529 0d0a 2020 2020 2020 2020 6578  ode)..        ex
+0000eac0: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
+0000ead0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+0000eae0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0000eaf0: 2e5f 726f 6f74 5f65 6c65 6d65 6e74 735b  ._root_elements[
+0000eb00: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+0000eb10: 6e74 2e73 686f 7274 636f 6465 5d20 3d20  nt.shortcode] = 
+0000eb20: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+0000eb30: 6e74 0d0a 0d0a 2020 2020 2344 6566 696e  nt....    #Defin
+0000eb40: 6520 7768 6174 2068 6170 7065 6e73 2077  e what happens w
+0000eb50: 6865 6e20 7765 2063 616c 6c20 2b3d 0d0a  hen we call +=..
+0000eb60: 2020 2020 2357 6520 7761 6e74 2074 6f20      #We want to 
+0000eb70: 6170 7065 6e64 0d0a 2020 2020 6465 6620  append..    def 
+0000eb80: 5f5f 6961 6464 5f5f 2873 656c 662c 6f74  __iadd__(self,ot
+0000eb90: 6865 7229 3a0d 0a20 2020 2020 2020 2073  her):..        s
+0000eba0: 656c 662e 6170 7065 6e64 2869 7465 6d3d  elf.append(item=
+0000ebb0: 6f74 6865 7229 0d0a 2020 2020 2020 2020  other)..        
+0000ebc0: 7265 7475 726e 2073 656c 660d 0a0d 0a20  return self.... 
+0000ebd0: 2020 2023 4465 6669 6e65 2077 6861 7420     #Define what 
+0000ebe0: 6861 7070 656e 7320 7768 656e 2077 6520  happens when we 
+0000ebf0: 6361 6c6c 207c 3d0d 0a20 2020 2023 5765  call |=..    #We
+0000ec00: 2077 616e 7420 746f 2061 7070 656e 6420   want to append 
+0000ec10: 6966 2069 7420 646f 6573 6e27 7420 6578  if it doesn't ex
+0000ec20: 6973 7420 616c 7265 6164 790d 0a20 2020  ist already..   
+0000ec30: 2064 6566 205f 5f69 6f72 5f5f 2873 656c   def __ior__(sel
+0000ec40: 662c 6f74 6865 7229 3a0d 0a20 2020 2020  f,other):..     
+0000ec50: 2020 2073 686f 7274 6e61 6d65 203d 204e     shortname = N
+0000ec60: 6f6e 650d 0a20 2020 2020 2020 2069 6620  one..        if 
+0000ec70: 7374 7228 6f74 6865 7229 203d 3d20 6f74  str(other) == ot
+0000ec80: 6865 723a 0d0a 2020 2020 2020 2020 2020  her:..          
+0000ec90: 2020 7368 6f72 746e 616d 6520 3d20 6f74    shortname = ot
+0000eca0: 6865 720d 0a20 2020 2020 2020 2065 6c73  her..        els
+0000ecb0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0000ecc0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0000ecd0: 2020 2020 2020 7368 6f72 746e 616d 6520        shortname 
+0000ece0: 3d20 6f74 6865 722e 7368 6f72 746e 616d  = other.shortnam
+0000ecf0: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
+0000ed00: 7863 6570 7420 4174 7472 6962 7574 6545  xcept AttributeE
+0000ed10: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+0000ed20: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+0000ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ed40: 2066 6f72 2065 6c20 696e 206f 7468 6572   for el in other
+0000ed50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0000ed60: 2020 2020 2020 2020 2020 2073 656c 6620             self 
+0000ed70: 7c3d 2065 6c0d 0a20 2020 2020 2020 2020  |= el..         
+0000ed80: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000ed90: 6e20 7365 6c66 0d0a 2020 2020 2020 2020  n self..        
+0000eda0: 2020 2020 2020 2020 6578 6365 7074 2041          except A
+0000edb0: 7474 7269 6275 7465 4572 726f 723a 0d0a  ttributeError:..
+0000edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edd0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+0000ede0: 726f 7228 2275 6e73 7570 706f 7274 6564  ror("unsupported
+0000edf0: 206f 7065 7261 6e64 2074 7970 6573 2873   operand types(s
+0000ee00: 2920 666f 7220 7c3d 3a20 275f 4869 6572  ) for |=: '_Hier
+0000ee10: 6172 6368 6965 7347 6574 7465 7227 2061  archiesGetter' a
+0000ee20: 6e64 2027 7b7d 2722 2e66 6f72 6d61 7428  nd '{}'".format(
+0000ee30: 7479 7065 286f 7468 6572 2929 290d 0a0d  type(other)))...
+0000ee40: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
+0000ee50: 2020 2020 2020 2020 2020 2073 656c 665b             self[
+0000ee60: 7368 6f72 746e 616d 655d 0d0a 2020 2020  shortname]..    
+0000ee70: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+0000ee80: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+0000ee90: 2020 7365 6c66 2e61 7070 656e 6428 6974    self.append(it
+0000eea0: 656d 3d6f 7468 6572 290d 0a20 2020 2020  em=other)..     
+0000eeb0: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
+0000eec0: 0d0a 0d0a 2020 2020 6465 6620 6b65 7973  ....    def keys
+0000eed0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+0000eee0: 2069 6620 6e6f 7420 7365 6c66 2e73 7472   if not self.str
+0000eef0: 7563 7475 7265 2e5f 6869 6572 6172 6368  ucture._hierarch
+0000ef00: 6965 735f 7265 6164 3a0d 0a20 2020 2020  ies_read:..     
+0000ef10: 2020 2020 2020 2073 656c 662e 7374 7275         self.stru
+0000ef20: 6374 7572 652e 6469 6d65 6e73 696f 6e2e  cture.dimension.
+0000ef30: 7374 7275 6374 7572 6573 2e5f 6c6f 6164  structures._load
+0000ef40: 5f73 7472 7563 7475 7265 2873 656c 662e  _structure(self.
+0000ef50: 7374 7275 6374 7572 652e 7368 6f72 7463  structure.shortc
+0000ef60: 6f64 652c 6f6c 645f 7374 7275 6374 7572  ode,old_structur
+0000ef70: 6520 3d20 7365 6c66 2e73 7472 7563 7475  e = self.structu
+0000ef80: 7265 290d 0a0d 0a20 2020 2020 2020 2072  re)....        r
+0000ef90: 6574 7572 6e20 7365 6c66 2e5f 726f 6f74  eturn self._root
+0000efa0: 5f65 6c65 6d65 6e74 732e 6b65 7973 2829  _elements.keys()
+0000efb0: 0d0a 0d0a 2020 2020 6465 6620 6974 656d  ....    def item
+0000efc0: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+0000efd0: 2020 6966 206e 6f74 2073 656c 662e 7374    if not self.st
+0000efe0: 7275 6374 7572 652e 5f68 6965 7261 7263  ructure._hierarc
+0000eff0: 6869 6573 5f72 6561 643a 0d0a 2020 2020  hies_read:..    
+0000f000: 2020 2020 2020 2020 7365 6c66 2e73 7472          self.str
+0000f010: 7563 7475 7265 2e64 696d 656e 7369 6f6e  ucture.dimension
+0000f020: 2e73 7472 7563 7475 7265 732e 5f6c 6f61  .structures._loa
+0000f030: 645f 7374 7275 6374 7572 6528 7365 6c66  d_structure(self
+0000f040: 2e73 7472 7563 7475 7265 2e73 686f 7274  .structure.short
+0000f050: 636f 6465 2c6f 6c64 5f73 7472 7563 7475  code,old_structu
+0000f060: 7265 203d 2073 656c 662e 7374 7275 6374  re = self.struct
+0000f070: 7572 6529 0d0a 0d0a 2020 2020 2020 2020  ure)....        
+0000f080: 7265 7475 726e 2073 656c 662e 5f72 6f6f  return self._roo
+0000f090: 745f 656c 656d 656e 7473 2e69 7465 6d73  t_elements.items
+0000f0a0: 2829 0d0a 0d0a 2020 2020 6465 6620 7661  ()....    def va
+0000f0b0: 6c75 6573 2873 656c 6629 3a0d 0a20 2020  lues(self):..   
+0000f0c0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0000f0d0: 2e73 7472 7563 7475 7265 2e5f 6869 6572  .structure._hier
+0000f0e0: 6172 6368 6965 735f 7265 6164 3a0d 0a20  archies_read:.. 
+0000f0f0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000f100: 7374 7275 6374 7572 652e 6469 6d65 6e73  structure.dimens
+0000f110: 696f 6e2e 7374 7275 6374 7572 6573 2e5f  ion.structures._
+0000f120: 6c6f 6164 5f73 7472 7563 7475 7265 2873  load_structure(s
+0000f130: 656c 662e 7374 7275 6374 7572 652e 7368  elf.structure.sh
+0000f140: 6f72 7463 6f64 652c 6f6c 645f 7374 7275  ortcode,old_stru
+0000f150: 6374 7572 6520 3d20 7365 6c66 2e73 7472  cture = self.str
+0000f160: 7563 7475 7265 290d 0a0d 0a20 2020 2020  ucture)....     
+0000f170: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000f180: 726f 6f74 5f65 6c65 6d65 6e74 732e 7661  root_elements.va
+0000f190: 6c75 6573 2829 0d0a 0d0a 2020 2020 6465  lues()....    de
+0000f1a0: 6620 5f5f 6c65 6e5f 5f28 7365 6c66 293a  f __len__(self):
+0000f1b0: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
+0000f1c0: 726e 206c 656e 2873 656c 662e 5f72 6f6f  rn len(self._roo
+0000f1d0: 745f 656c 656d 656e 7473 290d 0a0d 0a20  t_elements).... 
+0000f1e0: 2020 2064 6566 205f 5f73 7472 5f5f 2873     def __str__(s
+0000f1f0: 656c 6629 3a0d 0a0d 0a20 2020 2020 2020  elf):....       
+0000f200: 2072 6574 7572 6e20 277b 2720 2b20 275c   return '{' + '\
+0000f210: 6e27 2e6a 6f69 6e28 5b20 2227 7b7d 273a  n'.join([ "'{}':
+0000f220: 7b7d 222e 666f 726d 6174 286b 2c72 6570  {}".format(k,rep
+0000f230: 7228 7629 2920 666f 7220 6b2c 7620 696e  r(v)) for k,v in
+0000f240: 2073 656c 662e 5f72 6f6f 745f 656c 656d   self._root_elem
+0000f250: 656e 7473 2e69 7465 6d73 2829 5d29 202b  ents.items()]) +
+0000f260: 2027 7d27 0d0a 0d0a 0d0a 2020 2020 6465   '}'......    de
+0000f270: 6620 5f5f 7265 7072 5f5f 2873 656c 6629  f __repr__(self)
+0000f280: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+0000f290: 6e20 277b 7d20 6672 6f6d 203c 7b7d 206f  n '{} from <{} o
+0000f2a0: 626a 6563 7420 6174 207b 7d3e 272e 666f  bject at {}>'.fo
+0000f2b0: 726d 6174 2827 7b27 202b 2027 5c6e 272e  rmat('{' + '\n'.
+0000f2c0: 6a6f 696e 285b 2022 277b 7d27 3a7b 7d22  join([ "'{}':{}"
+0000f2d0: 2e66 6f72 6d61 7428 6b2c 7265 7072 2876  .format(k,repr(v
+0000f2e0: 2929 2066 6f72 206b 2c76 2069 6e20 7365  )) for k,v in se
+0000f2f0: 6c66 2e69 7465 6d73 2829 5d29 202b 2027  lf.items()]) + '
+0000f300: 7d27 2c73 656c 662e 5f5f 636c 6173 735f  }',self.__class_
+0000f310: 5f2e 5f5f 6e61 6d65 5f5f 2c68 6578 2869  _.__name__,hex(i
+0000f320: 6428 7365 6c66 2929 2029 0d0a 0d0a 2020  d(self)) )....  
+0000f330: 2020 2354 4f44 4f0d 0a20 2020 2023 205f    #TODO..    # _
+0000f340: 5f61 6464 5f5f 0d0a 2020 2020 2320 616e  _add__..    # an
+0000f350: 640d 0a20 2020 2023 205f 5f72 6164 645f  d..    # __radd_
+0000f360: 5f0d 0a0d 0a63 6c61 7373 2053 7472 7563  _....class Struc
+0000f370: 7475 7265 456c 656d 656e 7443 6869 6c64  tureElementChild
+0000f380: 7265 6e28 6f62 6a65 6374 293a 0d0a 2020  ren(object):..  
+0000f390: 2020 2727 2754 6865 206f 626a 6563 7420    '''The object 
+0000f3a0: 7265 7475 726e 6564 2062 7920 6120 6361  returned by a ca
+0000f3b0: 6c6c 2074 6f20 5374 7275 6374 7572 6545  ll to StructureE
+0000f3c0: 6c65 6d65 6e74 2e63 6869 6c64 7265 6e0d  lement.children.
+0000f3d0: 0a20 2020 2044 6f65 7320 6120 6269 7420  .    Does a bit 
+0000f3e0: 6f66 206d 6167 6963 2074 6f20 616c 6c6f  of magic to allo
+0000f3f0: 7720 5374 7275 6374 7572 6545 6c65 6d65  w StructureEleme
+0000f400: 6e74 732e 6368 696c 6472 656e 2074 6f20  nts.children to 
+0000f410: 6170 7065 6172 206c 696b 6520 6120 6469  appear like a di
+0000f420: 6374 696f 6e61 7279 2c20 6f6e 6c79 2077  ctionary, only w
+0000f430: 6974 6820 6578 7472 6120 7370 6563 6961  ith extra specia
+0000f440: 6c20 6675 6e63 7469 6f6e 7320 6c69 6b65  l functions like
+0000f450: 202b 3d20 2727 270d 0a0d 0a20 2020 2064   += '''....    d
+0000f460: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+0000f470: 2c73 7472 7563 7475 7265 5f65 6c65 6d65  ,structure_eleme
+0000f480: 6e74 293a 0d0a 2020 2020 2020 2020 2727  nt):..        ''
+0000f490: 2749 7420 6973 2075 6e6c 696b 656c 7920  'It is unlikely 
+0000f4a0: 7468 6174 2061 2075 7365 7220 6f66 2050  that a user of P
+0000f4b0: 794d 5058 2077 6f75 6c64 2077 616e 7420  yMPX would want 
+0000f4c0: 746f 2069 6e69 7469 616c 6973 6520 6120  to initialise a 
+0000f4d0: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+0000f4e0: 4368 696c 6472 656e 206f 626a 6563 7420  Children object 
+0000f4f0: 6469 7265 6374 6c79 2e0d 0a20 2020 2020  directly...     
+0000f500: 2020 2054 6869 7320 6f62 6a65 6374 2069     This object i
+0000f510: 7320 7573 7561 6c6c 7920 7265 7475 726e  s usually return
+0000f520: 6564 2062 7920 6361 6c6c 696e 6720 652e  ed by calling e.
+0000f530: 672e 206d 795f 7374 7275 6374 7572 655f  g. my_structure_
+0000f540: 656c 656d 656e 742e 6368 696c 6472 656e  element.children
+0000f550: 0d0a 0d0a 2020 2020 2020 2020 3a70 6172  ....        :par
+0000f560: 616d 2073 7472 7563 7475 7265 5f65 6c65  am structure_ele
+0000f570: 6d65 6e74 3a20 5468 6520 5374 7275 6374  ment: The Struct
+0000f580: 7572 6545 6c65 6d65 6e74 2074 6861 7420  ureElement that 
+0000f590: 7468 6520 6368 696c 6472 656e 2077 696c  the children wil
+0000f5a0: 6c20 6265 6c6f 6e67 2074 6f0d 0a20 2020  l belong to..   
+0000f5b0: 2020 2020 2027 2727 0d0a 0d0a 2020 2020       '''....    
+0000f5c0: 2020 2020 7365 6c66 2e5f 7374 7275 6374      self._struct
+0000f5d0: 7572 655f 656c 656d 656e 7420 2020 2020  ure_element     
+0000f5e0: 2020 2020 203d 2073 7472 7563 7475 7265       = structure
+0000f5f0: 5f65 6c65 6d65 6e74 0d0a 0d0a 2020 2020  _element....    
+0000f600: 2354 6865 2053 7472 7563 7475 7265 456c  #The StructureEl
+0000f610: 656d 656e 7443 6869 6c64 7265 6e20 6861  ementChildren ha
+0000f620: 7320 7468 6520 756e 666f 7274 756e 6174  s the unfortunat
+0000f630: 6520 7072 6f70 6572 7479 206f 6620 6265  e property of be
+0000f640: 6861 7669 6e67 206c 696b 6520 626f 7468  having like both
+0000f650: 2061 206c 6973 7420 6974 6572 6174 6f72   a list iterator
+0000f660: 2061 6e64 2061 2064 6963 7469 6f6e 6172   and a dictionar
+0000f670: 790d 0a20 2020 2023 4974 2773 2061 2062  y..    #It's a b
+0000f680: 6974 206f 6620 6120 6d65 7373 0d0a 2020  it of a mess..  
+0000f690: 2020 6465 6620 5f5f 6974 6572 5f5f 2873    def __iter__(s
+0000f6a0: 656c 6629 3a0d 0a20 2020 2020 2020 2073  elf):..        s
+0000f6b0: 656c 662e 5f69 7465 7261 746f 7220 3d20  elf._iterator = 
+0000f6c0: 6974 6572 2873 656c 662e 7661 6c75 6573  iter(self.values
+0000f6d0: 2829 290d 0a20 2020 2020 2020 2072 6574  ())..        ret
+0000f6e0: 7572 6e20 7365 6c66 0d0a 0d0a 2020 2020  urn self....    
+0000f6f0: 6465 6620 5f5f 6e65 7874 5f5f 2873 656c  def __next__(sel
+0000f700: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+0000f710: 7572 6e20 6e65 7874 2873 656c 662e 5f69  urn next(self._i
+0000f720: 7465 7261 746f 7229 0d0a 0d0a 2020 2020  terator)....    
+0000f730: 6465 6620 5f5f 6765 7469 7465 6d5f 5f28  def __getitem__(
+0000f740: 7365 6c66 2c6b 6579 293a 0d0a 2020 2020  self,key):..    
+0000f750: 2020 2020 666f 7220 6e2c 656c 2069 6e20      for n,el in 
+0000f760: 656e 756d 6572 6174 6528 7365 6c66 2e5f  enumerate(self._
+0000f770: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+0000f780: 742e 5f63 6869 6c64 5f73 7472 7563 7475  t._child_structu
+0000f790: 7265 5f65 6c65 6d65 6e74 735b 3a3a 2d31  re_elements[::-1
+0000f7a0: 5d29 3a0d 0a20 2020 2020 2020 2020 2020  ]):..           
+0000f7b0: 2069 6620 656c 2e73 686f 7274 6e61 6d65   if el.shortname
+0000f7c0: 203d 3d20 6b65 793a 0d0a 2020 2020 2020   == key:..      
+0000f7d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000f7e0: 2065 6c0d 0a0d 0a20 2020 2020 2020 2072   el....        r
+0000f7f0: 6169 7365 204b 6579 4572 726f 7228 2753  aise KeyError('S
+0000f800: 7472 7563 7475 7265 456c 656d 656e 7420  tructureElement 
+0000f810: 7b7d 2064 6f65 7320 6e6f 7420 636f 6e74  {} does not cont
+0000f820: 6169 6e20 6120 6368 696c 6420 7769 7468  ain a child with
+0000f830: 2073 686f 7274 6e61 6d65 207b 7d27 2e66   shortname {}'.f
+0000f840: 6f72 6d61 7428 7365 6c66 2e5f 7374 7275  ormat(self._stru
+0000f850: 6374 7572 655f 656c 656d 656e 742e 7061  cture_element.pa
+0000f860: 7468 2c6b 6579 2929 0d0a 0d0a 2020 2020  th,key))....    
+0000f870: 6465 6620 5f5f 7365 7469 7465 6d5f 5f28  def __setitem__(
+0000f880: 7365 6c66 2c20 6b65 792c 2069 7465 6d29  self, key, item)
+0000f890: 3a0d 0a20 2020 2020 2020 2027 2727 5365  :..        '''Se
+0000f8a0: 7420 7468 6520 6669 6e61 6c20 656c 656d  t the final elem
+0000f8b0: 656e 7420 696e 2074 6865 2063 6869 6c64  ent in the child
+0000f8c0: 7265 6e20 7769 7468 206b 6579 2073 686f  ren with key sho
+0000f8d0: 7274 636f 6465 2074 6f20 7468 6520 6974  rtcode to the it
+0000f8e0: 656d 2076 616c 7565 0d0a 2020 2020 2020  em value..      
+0000f8f0: 2020 4966 2074 6865 2069 7465 6d20 656c    If the item el
+0000f900: 656d 656e 7420 6973 206e 6f74 2069 6e20  ement is not in 
+0000f910: 7468 6520 6368 696c 6472 656e 2074 6865  the children the
+0000f920: 6e20 6164 6420 6974 2727 270d 0a20 2020  n add it'''..   
+0000f930: 2020 2020 2069 6620 6e6f 7420 6973 696e       if not isin
+0000f940: 7374 616e 6365 2869 7465 6d2c 5374 7275  stance(item,Stru
+0000f950: 6374 7572 6545 6c65 6d65 6e74 293a 0d0a  ctureElement):..
+0000f960: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000f970: 6520 5661 6c75 6545 7272 6f72 2822 5374  e ValueError("St
+0000f980: 7275 6374 7572 6545 6c65 6d65 6e74 2063  ructureElement c
+0000f990: 6869 6c64 7265 6e20 6361 6e20 6f6e 6c79  hildren can only
+0000f9a0: 2062 6520 7365 7420 7573 696e 6720 7468   be set using th
+0000f9b0: 6520 6469 6374 696f 6e61 7279 2073 796e  e dictionary syn
+0000f9c0: 7461 7820 746f 2061 6e6f 7468 6572 2053  tax to another S
+0000f9d0: 7472 7563 7475 7265 456c 656d 656e 742e  tructureElement.
+0000f9e0: 2059 6f75 2063 616c 6c65 6420 7b7d 5b27   You called {}['
+0000f9f0: 7b7d 275d 203d 207b 7d2c 2061 7474 656d  {}'] = {}, attem
+0000fa00: 7074 696e 6720 746f 2073 6574 2074 6865  pting to set the
+0000fa10: 2063 6869 6c64 2074 6f20 616e 206f 626a   child to an obj
+0000fa20: 6563 7420 6f66 2074 7970 6520 7b7d 222e  ect of type {}".
+0000fa30: 666f 726d 6174 2872 6570 7228 7365 6c66  format(repr(self
+0000fa40: 292c 7265 7072 286b 6579 292c 7265 7072  ),repr(key),repr
+0000fa50: 2869 7465 6d29 2c74 7970 6528 6974 656d  (item),type(item
+0000fa60: 2929 290d 0a0d 0a20 2020 2020 2020 2069  )))....        i
+0000fa70: 6620 6e6f 7420 6b65 7920 3d3d 2069 7465  f not key == ite
+0000fa80: 6d2e 7368 6f72 746e 616d 653a 0d0a 2020  m.shortname:..  
+0000fa90: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000faa0: 5661 6c75 6545 7272 6f72 2822 5374 7275  ValueError("Stru
+0000fab0: 6374 7572 6545 6c65 6d65 6e74 2063 6869  ctureElement chi
+0000fac0: 6c64 7265 6e20 6361 6e20 6f6e 6c79 2062  ldren can only b
+0000fad0: 6520 7365 7420 7573 696e 6720 7468 6520  e set using the 
+0000fae0: 6469 6374 696f 6e61 7279 2073 796e 7461  dictionary synta
+0000faf0: 7820 746f 2061 2053 7472 7563 7475 7265  x to a Structure
+0000fb00: 456c 656d 656e 7420 7769 7468 2074 6865  Element with the
+0000fb10: 2073 616d 6520 7368 6f72 7463 6f64 6520   same shortcode 
+0000fb20: 6173 2074 6865 206b 6579 2e20 596f 7520  as the key. You 
+0000fb30: 6361 6c6c 6564 207b 7d5b 277b 7d27 5d20  called {}['{}'] 
+0000fb40: 3d20 7b7d 2c20 6174 7465 6d70 7469 6e67  = {}, attempting
+0000fb50: 2074 6f20 7365 7420 7468 6520 6368 696c   to set the chil
+0000fb60: 6420 746f 2061 2053 7472 7563 7475 7265  d to a Structure
+0000fb70: 456c 656d 656e 7420 7769 7468 2073 686f  Element with sho
+0000fb80: 7274 6e61 6d65 207b 7d22 2e66 6f72 6d61  rtname {}".forma
+0000fb90: 7428 7265 7072 2873 656c 6629 2c72 6570  t(repr(self),rep
+0000fba0: 7228 6b65 7929 2c72 6570 7228 6974 656d  r(key),repr(item
+0000fbb0: 292c 6974 656d 2e73 686f 7274 6e61 6d65  ),item.shortname
+0000fbc0: 2929 0d0a 0d0a 0d0a 2020 2020 2020 2020  ))......        
+0000fbd0: 2349 6620 7468 6520 6974 656d 2069 7320  #If the item is 
+0000fbe0: 616c 7265 6164 7920 696e 2074 6865 2064  already in the d
+0000fbf0: 6963 7469 6f6e 6172 792c 2073 7761 7020  ictionary, swap 
+0000fc00: 6974 206f 7574 2066 6f72 2074 6865 206e  it out for the n
+0000fc10: 6577 206f 6e65 0d0a 2020 2020 2020 2020  ew one..        
+0000fc20: 236f 7468 6572 7769 7365 2061 6464 2069  #otherwise add i
+0000fc30: 7420 6f6e 2074 6865 2065 6e64 0d0a 0d0a  t on the end....
+0000fc40: 2020 2020 2020 2020 656c 656d 656e 745f          element_
+0000fc50: 666f 756e 6420 3d20 4661 6c73 650d 0a20  found = False.. 
+0000fc60: 2020 2020 2020 2066 6f72 206e 2c65 6c20         for n,el 
+0000fc70: 696e 2065 6e75 6d65 7261 7465 2873 656c  in enumerate(sel
+0000fc80: 662e 5f73 7472 7563 7475 7265 5f65 6c65  f._structure_ele
+0000fc90: 6d65 6e74 2e5f 6368 696c 645f 7374 7275  ment._child_stru
+0000fca0: 6374 7572 655f 656c 656d 656e 7473 5b3a  cture_elements[:
+0000fcb0: 3a2d 315d 293a 0d0a 2020 2020 2020 2020  :-1]):..        
+0000fcc0: 2020 2020 6966 2065 6c2e 7368 6f72 746e      if el.shortn
+0000fcd0: 616d 6520 3d3d 206b 6579 3a0d 0a20 2020  ame == key:..   
+0000fce0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000fcf0: 662e 5f73 7472 7563 7475 7265 5f65 6c65  f._structure_ele
+0000fd00: 6d65 6e74 2e5f 6368 696c 645f 7374 7275  ment._child_stru
+0000fd10: 6374 7572 655f 656c 656d 656e 7473 5b2d  cture_elements[-
+0000fd20: 2831 2b6e 295d 203d 2069 7465 6d0d 0a20  (1+n)] = item.. 
+0000fd30: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0000fd40: 6c65 6d65 6e74 5f66 6f75 6e64 203d 2054  lement_found = T
+0000fd50: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
+0000fd60: 2020 2020 2062 7265 616b 0d0a 0d0a 2020       break....  
+0000fd70: 2020 2020 2020 6966 206e 6f74 2065 6c65        if not ele
+0000fd80: 6d65 6e74 5f66 6f75 6e64 3a0d 0a20 2020  ment_found:..   
+0000fd90: 2020 2020 2020 2020 2073 656c 662e 6170           self.ap
+0000fda0: 7065 6e64 2869 7465 6d29 0d0a 0d0a 2020  pend(item)....  
+0000fdb0: 2020 6465 6620 6170 7065 6e64 2873 656c    def append(sel
+0000fdc0: 662c 2069 7465 6d2c 206d 6572 6765 203d  f, item, merge =
+0000fdd0: 2046 616c 7365 293a 0d0a 2020 2020 2020   False):..      
+0000fde0: 2020 2727 2741 6464 2061 2063 6869 6c64    '''Add a child
+0000fdf0: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
+0000fe00: 7420 746f 2074 6865 2063 6869 6c64 7265  t to the childre
+0000fe10: 6e2e 0d0a 0d0a 2020 2020 2020 2020 3a70  n.....        :p
+0000fe20: 6172 616d 2069 7465 6d3a 2053 7065 6369  aram item: Speci
+0000fe30: 6669 6361 7469 6f6e 206f 6620 7468 6520  fication of the 
+0000fe40: 6368 696c 6420 5374 7275 6374 7572 6545  child StructureE
+0000fe50: 6c65 6d65 6e74 2074 6f20 6562 2061 6464  lement to eb add
+0000fe60: 6564 2e20 5661 6c69 6420 7661 6c65 7573  ed. Valid valeus
+0000fe70: 2061 7265 2061 2053 7472 7563 7475 7265   are a Structure
+0000fe80: 456c 656d 656e 742c 2061 6e20 456c 656d  Element, an Elem
+0000fe90: 656e 7420 6f72 2061 2073 686f 7274 6e61  ent or a shortna
+0000fea0: 6d65 2073 7472 696e 672c 2072 6566 6572  me string, refer
+0000feb0: 696e 6720 746f 2061 6e20 456c 656d 656e  ing to an Elemen
+0000fec0: 7420 696e 2074 6865 2044 696d 656e 7369  t in the Dimensi
+0000fed0: 6f6e 2074 6861 7420 7468 6973 2053 7472  on that this Str
+0000fee0: 7563 7475 7265 2062 656c 6f6e 6773 2074  ucture belongs t
+0000fef0: 6f2e 0d0a 2020 2020 2020 2020 2727 270d  o...        '''.
+0000ff00: 0a0d 0a20 2020 2020 2020 205f 6974 656d  ...        _item
+0000ff10: 5f69 735f 7374 7275 6374 7572 655f 656c  _is_structure_el
+0000ff20: 656d 656e 7420 3d20 4661 6c73 650d 0a20  ement = False.. 
+0000ff30: 2020 2020 2020 205f 6974 656d 5f69 735f         _item_is_
+0000ff40: 656c 656d 656e 7420 3d20 4661 6c73 650d  element = False.
+0000ff50: 0a20 2020 2020 2020 205f 6974 656d 5f69  .        _item_i
+0000ff60: 735f 7368 6f72 7463 6f64 6520 3d20 4661  s_shortcode = Fa
+0000ff70: 6c73 650d 0a0d 0a20 2020 2020 2020 2069  lse....        i
+0000ff80: 6620 6973 696e 7374 616e 6365 2869 7465  f isinstance(ite
+0000ff90: 6d2c 2073 7472 293a 0d0a 2020 2020 2020  m, str):..      
+0000ffa0: 2020 2020 2020 5f69 7465 6d5f 6973 5f73        _item_is_s
+0000ffb0: 686f 7274 636f 6465 203d 2054 7275 650d  hortcode = True.
+0000ffc0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0000ffd0: 0d0a 2020 2020 2020 2020 2020 2020 2369  ..            #i
+0000ffe0: 6620 7468 6520 6974 656d 2069 7320 616e  f the item is an
+0000fff0: 2069 7465 7261 626c 6520 2861 6e64 2069   iterable (and i
+00010000: 736e 2774 2061 2073 7472 696e 6729 2c20  sn't a string), 
+00010010: 6170 7065 6e64 2061 6c6c 2069 7465 6d73  append all items
+00010020: 2074 6f20 7365 6c66 0d0a 2020 2020 2020   to self..      
+00010030: 2020 2020 2020 2354 6869 7320 7761 7920        #This way 
+00010040: 7765 2063 616e 2061 6464 2061 206c 6973  we can add a lis
+00010050: 7420 6f66 2074 6869 6e67 7320 746f 2061  t of things to a
+00010060: 2068 6965 7261 7263 6879 0d0a 2020 2020   hierarchy..    
+00010070: 2020 2020 2020 2020 6974 656d 7320 3d20          items = 
+00010080: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+00010090: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+000100a0: 2020 2020 2020 2020 2354 7279 2074 7265          #Try tre
+000100b0: 6174 696e 6720 7468 6520 6974 656d 2061  ating the item a
+000100c0: 7320 6120 6c69 7374 2028 6e6f 7720 7468  s a list (now th
+000100d0: 6174 2077 6520 6b6e 6f77 2069 7420 6973  at we know it is
+000100e0: 206e 6f74 2061 2073 7472 696e 6729 0d0a   not a string)..
+000100f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010100: 2341 6e64 2061 7070 656e 6469 6e67 2065  #And appending e
+00010110: 6163 6820 6f66 2074 6865 206d 656d 6265  ach of the membe
+00010120: 7273 2069 6e20 7475 726e 0d0a 2020 2020  rs in turn..    
+00010130: 2020 2020 2020 2020 2020 2020 6974 656d              item
+00010140: 7320 3d20 5b65 6c20 666f 7220 656c 2069  s = [el for el i
+00010150: 6e20 6974 656d 5d0d 0a20 2020 2020 2020  n item]..       
+00010160: 2020 2020 2065 7863 6570 7420 5479 7065       except Type
+00010170: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+00010180: 2020 2020 2020 2020 7061 7373 0d0a 0d0a          pass....
+00010190: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+000101a0: 7465 6d73 2069 7320 6e6f 7420 4e6f 6e65  tems is not None
+000101b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000101c0: 2020 2066 6f72 2065 6c20 696e 2069 7465     for el in ite
+000101d0: 6d3a 0d0a 2020 2020 2020 2020 2020 2020  m:..            
+000101e0: 2020 2020 2020 2020 7365 6c66 2e61 7070          self.app
+000101f0: 656e 6428 656c 2c6d 6572 6765 3d6d 6572  end(el,merge=mer
+00010200: 6765 290d 0a20 2020 2020 2020 2020 2020  ge)..           
+00010210: 2020 2020 2023 5265 7475 726e 206f 6e63       #Return onc
+00010220: 6520 7765 2776 6520 6170 7065 6e64 6564  e we've appended
+00010230: 2065 7665 7279 2065 6c65 6d65 6e74 0d0a   every element..
+00010240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010250: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
+00010260: 2020 2020 2020 2349 6620 7765 2067 6f74        #If we got
+00010270: 2074 6869 7320 6661 7220 7468 656e 2069   this far then i
+00010280: 7465 6d20 6973 206e 6f74 2061 2073 7472  tem is not a str
+00010290: 696e 6720 2869 2e65 2e20 7368 6f72 7463  ing (i.e. shortc
+000102a0: 6f64 6529 206f 7220 6c69 7374 0d0a 2020  ode) or list..  
+000102b0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
+000102c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000102d0: 6974 656d 2e69 735f 726f 6f74 0d0a 2020  item.is_root..  
+000102e0: 2020 2020 2020 2020 2020 2020 2020 5f69                _i
+000102f0: 7465 6d5f 6973 5f73 7472 7563 7475 7265  tem_is_structure
+00010300: 5f65 6c65 6d65 6e74 203d 2054 7275 650d  _element = True.
+00010310: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00010320: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
+00010330: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00010340: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00010350: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00010360: 7465 6d2e 5f6d 6561 7375 7265 0d0a 2020  tem._measure..  
+00010370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010380: 2020 5f69 7465 6d5f 6973 5f65 6c65 6d65    _item_is_eleme
+00010390: 6e74 203d 2054 7275 650d 0a20 2020 2020  nt = True..     
+000103a0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+000103b0: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
+000103c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000103d0: 2020 2020 2020 2023 5765 276c 6c20 7261         #We'll ra
+000103e0: 6973 6520 7468 6520 6572 726f 7220 6173  ise the error as
+000103f0: 2061 2054 7970 6545 7272 6f72 2066 7572   a TypeError fur
+00010400: 7468 6572 2064 6f77 6e0d 0a20 2020 2020  ther down..     
+00010410: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00010420: 6173 730d 0a0d 0a20 2020 2020 2020 2069  ass....        i
+00010430: 6620 5f69 7465 6d5f 6973 5f73 7472 7563  f _item_is_struc
+00010440: 7475 7265 5f65 6c65 6d65 6e74 3a0d 0a20  ture_element:.. 
+00010450: 2020 2020 2020 2020 2020 205f 6368 696c             _chil
+00010460: 645f 7374 7275 6374 7572 655f 656c 656d  d_structure_elem
+00010470: 656e 7420 3d20 6974 656d 0d0a 0d0a 2020  ent = item....  
+00010480: 2020 2020 2020 2020 2020 2353 7472 7563            #Struc
+00010490: 7475 7265 2065 6c65 6d65 6e74 7320 636f  ture elements co
+000104a0: 756c 6420 6861 7665 2062 6565 6e20 6375  uld have been cu
+000104b0: 7420 6f72 2028 696d 706c 6963 6974 6c79  t or (implicitly
+000104c0: 2920 636f 7069 6564 0d0a 2020 2020 2020  ) copied..      
+000104d0: 2020 2020 2020 2343 7574 2065 6c65 6d65        #Cut eleme
+000104e0: 6e74 7320 7769 6c6c 206e 6f74 2068 6176  nts will not hav
+000104f0: 6520 6120 7061 7265 6e74 2c20 616e 6420  e a parent, and 
+00010500: 7761 6e74 2074 6f20 6265 2073 6574 2074  want to be set t
+00010510: 6f20 6861 7665 2074 6869 7320 7374 7275  o have this stru
+00010520: 6374 7572 6520 656c 656d 656e 7420 7061  cture element pa
+00010530: 7265 6e74 0d0a 2020 2020 2020 2020 2020  rent..          
+00010540: 2020 2349 6d70 6c69 6369 746c 7920 636f    #Implicitly co
+00010550: 7069 6564 2065 6c65 6d65 6e74 7320 7769  pied elements wi
+00010560: 6c6c 2068 6176 6520 6120 7061 7265 6e74  ll have a parent
+00010570: 2c20 616e 6420 6e65 6564 2074 6f20 6265  , and need to be
+00010580: 2065 7870 6c69 6369 746c 7920 636f 7069   explicitly copi
+00010590: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
+000105a0: 6966 205f 6368 696c 645f 7374 7275 6374  if _child_struct
+000105b0: 7572 655f 656c 656d 656e 742e 5f70 6172  ure_element._par
+000105c0: 656e 745f 7374 7275 6374 7572 655f 656c  ent_structure_el
+000105d0: 656d 656e 7420 6973 204e 6f6e 653a 0d0a  ement is None:..
+000105e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000105f0: 5f63 6869 6c64 5f73 7472 7563 7475 7265  _child_structure
+00010600: 5f65 6c65 6d65 6e74 2e73 7472 7563 7475  _element.structu
+00010610: 7265 203d 2073 656c 662e 5f73 7472 7563  re = self._struc
+00010620: 7475 7265 5f65 6c65 6d65 6e74 2e73 7472  ture_element.str
+00010630: 7563 7475 7265 0d0a 2020 2020 2020 2020  ucture..        
+00010640: 2020 2020 656c 6966 205f 6368 696c 645f      elif _child_
+00010650: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+00010660: 742e 5f70 6172 656e 745f 7374 7275 6374  t._parent_struct
+00010670: 7572 655f 656c 656d 656e 7420 3d3d 2073  ure_element == s
+00010680: 656c 662e 5f73 7472 7563 7475 7265 5f65  elf._structure_e
+00010690: 6c65 6d65 6e74 3a0d 0a20 2020 2020 2020  lement:..       
+000106a0: 2020 2020 2020 2020 2070 6173 730d 0a20           pass.. 
+000106b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000106c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000106d0: 2020 2344 6f20 7468 6520 6578 706c 6963    #Do the explic
+000106e0: 6974 2063 6f70 790d 0a20 2020 2020 2020  it copy..       
+000106f0: 2020 2020 2020 2020 205f 6368 696c 645f           _child_
+00010700: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+00010710: 7420 3d20 6974 656d 2e63 6f70 7928 290d  t = item.copy().
+00010720: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+00010730: 6620 5f63 6869 6c64 5f73 7472 7563 7475  f _child_structu
+00010740: 7265 5f65 6c65 6d65 6e74 2e73 7472 7563  re_element.struc
+00010750: 7475 7265 2069 7320 4e6f 6e65 3a0d 0a20  ture is None:.. 
+00010760: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00010770: 6368 696c 645f 7374 7275 6374 7572 655f  child_structure_
+00010780: 656c 656d 656e 742e 7374 7275 6374 7572  element.structur
+00010790: 6520 3d20 7365 6c66 2e5f 7374 7275 6374  e = self._struct
+000107a0: 7572 655f 656c 656d 656e 742e 7374 7275  ure_element.stru
+000107b0: 6374 7572 650d 0a0d 0a20 2020 2020 2020  cture....       
+000107c0: 2065 6c69 6620 5f69 7465 6d5f 6973 5f65   elif _item_is_e
+000107d0: 6c65 6d65 6e74 3a0d 0a20 2020 2020 2020  lement:..       
+000107e0: 2020 2020 205f 6368 696c 645f 7374 7275       _child_stru
+000107f0: 6374 7572 655f 656c 656d 656e 7420 3d20  cture_element = 
+00010800: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+00010810: 2820 7374 7275 6374 7572 653d 7365 6c66  ( structure=self
+00010820: 2e5f 7374 7275 6374 7572 655f 656c 656d  ._structure_elem
+00010830: 656e 742e 7374 7275 6374 7572 652c 656c  ent.structure,el
+00010840: 656d 656e 743d 6974 656d 2c69 735f 726f  ement=item,is_ro
+00010850: 6f74 3d46 616c 7365 290d 0a20 2020 2020  ot=False)..     
+00010860: 2020 2065 6c69 6620 5f69 7465 6d5f 6973     elif _item_is
+00010870: 5f73 686f 7274 636f 6465 3a0d 0a20 2020  _shortcode:..   
+00010880: 2020 2020 2020 2020 205f 656c 656d 656e           _elemen
+00010890: 7420 3d20 7365 6c66 2e5f 7374 7275 6374  t = self._struct
+000108a0: 7572 655f 656c 656d 656e 742e 6469 6d65  ure_element.dime
+000108b0: 6e73 696f 6e2e 656c 656d 656e 7473 5b69  nsion.elements[i
+000108c0: 7465 6d5d 0d0a 2020 2020 2020 2020 2020  tem]..          
+000108d0: 2020 5f63 6869 6c64 5f73 7472 7563 7475    _child_structu
+000108e0: 7265 5f65 6c65 6d65 6e74 203d 2053 7472  re_element = Str
+000108f0: 7563 7475 7265 456c 656d 656e 7428 7374  uctureElement(st
+00010900: 7275 6374 7572 653d 7365 6c66 2e5f 7374  ructure=self._st
+00010910: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
+00010920: 7374 7275 6374 7572 652c 656c 656d 656e  structure,elemen
+00010930: 743d 5f65 6c65 6d65 6e74 2c69 735f 726f  t=_element,is_ro
+00010940: 6f74 3d46 616c 7365 290d 0a20 2020 2020  ot=False)..     
+00010950: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00010960: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+00010970: 4572 726f 7228 2743 616e 6e6f 7420 6170  Error('Cannot ap
+00010980: 7065 6e64 2069 7465 6d20 6f66 2075 6e6b  pend item of unk
+00010990: 6e6f 776e 2074 7970 653a 207b 7d27 2e66  nown type: {}'.f
+000109a0: 6f72 6d61 7428 7265 7072 2869 7465 6d29  ormat(repr(item)
+000109b0: 2929 0d0a 0d0a 2020 2020 2020 2020 6966  ))....        if
+000109c0: 206e 6f74 205f 6368 696c 645f 7374 7275   not _child_stru
+000109d0: 6374 7572 655f 656c 656d 656e 742e 656c  cture_element.el
+000109e0: 656d 656e 742e 6d61 7374 6572 6564 3a0d  ement.mastered:.
+000109f0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00010a00: 7365 2041 7474 7269 6275 7465 4572 726f  se AttributeErro
+00010a10: 7228 2743 616e 6e6f 7420 6372 6561 7465  r('Cannot create
+00010a20: 2061 2068 6965 7261 7263 6879 2077 6974   a hierarchy wit
+00010a30: 6820 756e 2d73 796e 6368 726f 6e69 7365  h un-synchronise
+00010a40: 6420 456c 656d 656e 7420 7b7d 2075 7365  d Element {} use
+00010a50: 2044 696d 656e 7369 6f6e 2e65 6c65 6d65   Dimension.eleme
+00010a60: 6e74 732e 7379 6e63 6872 6f6e 6973 6528  nts.synchronise(
+00010a70: 2920 6265 666f 7265 2063 7265 6174 696e  ) before creatin
+00010a80: 6720 7468 6520 6869 6572 6172 6368 7927  g the hierarchy'
+00010a90: 290d 0a0d 0a20 2020 2020 2020 2023 4966  )....        #If
+00010aa0: 2077 6520 6172 6520 6164 6469 6e67 206d   we are adding m
+00010ab0: 6572 6765 2065 6c65 6d65 6e74 732c 2072  erge elements, r
+00010ac0: 6574 7572 6e20 6966 7765 2066 696e 6420  eturn ifwe find 
+00010ad0: 616e 2069 6465 6e74 6963 616c 2065 6c65  an identical ele
+00010ae0: 6d65 6e74 0d0a 2020 2020 2020 2020 6966  ment..        if
+00010af0: 206d 6572 6765 3a0d 0a20 2020 2020 2020   merge:..       
+00010b00: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00010b10: 2020 2020 2020 2020 2020 2073 656c 665b             self[
+00010b20: 5f63 6869 6c64 5f73 7472 7563 7475 7265  _child_structure
+00010b30: 5f65 6c65 6d65 6e74 2e73 686f 7274 636f  _element.shortco
+00010b40: 6465 5d0d 0a20 2020 2020 2020 2020 2020  de]..           
+00010b50: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
+00010b60: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00010b70: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
+00010b80: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+00010b90: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00010ba0: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00010bb0: 6e74 2e5f 6164 645f 6368 696c 6428 5f63  nt._add_child(_c
+00010bc0: 6869 6c64 5f73 7472 7563 7475 7265 5f65  hild_structure_e
+00010bd0: 6c65 6d65 6e74 290d 0a0d 0a20 2020 2064  lement)....    d
+00010be0: 6566 206f 7264 6572 5f62 795f 7368 6f72  ef order_by_shor
+00010bf0: 7463 6f64 655f 6c69 7374 2873 656c 662c  tcode_list(self,
+00010c00: 7368 6f72 7463 6f64 655f 6c69 7374 293a  shortcode_list):
+00010c10: 0d0a 2020 2020 2020 2020 2727 274f 7264  ..        '''Ord
+00010c20: 6572 2074 6865 2063 6869 6c64 7265 6e20  er the children 
+00010c30: 7573 696e 6720 6120 6c69 7374 206f 6620  using a list of 
+00010c40: 7368 6f72 7463 6f64 6573 2e20 4265 6361  shortcodes. Beca
+00010c50: 7573 6520 456c 656d 656e 7473 2063 616e  use Elements can
+00010c60: 2063 6f6d 6520 616e 6420 676f 206f 7665   come and go ove
+00010c70: 7220 7469 6d65 2c20 7368 6f72 746e 616d  r time, shortnam
+00010c80: 6573 2069 6e20 7468 6520 6c69 7374 2074  es in the list t
+00010c90: 6861 7420 6172 6520 6e6f 7420 6368 696c  hat are not chil
+00010ca0: 6472 656e 2061 7265 2069 676e 6f72 6564  dren are ignored
+00010cb0: 2c20 616e 6420 616e 7920 7368 6f72 746e  , and any shortn
+00010cc0: 616d 6573 206f 6620 6368 696c 6472 656e  ames of children
+00010cd0: 2074 6861 7420 6172 6520 6e6f 7420 6d65   that are not me
+00010ce0: 6e74 696f 6e65 6420 676f 2074 6f20 7468  ntioned go to th
+00010cf0: 6520 656e 6420 6f66 2074 6865 206c 6973  e end of the lis
+00010d00: 7420 696e 2074 6865 6972 206f 7269 6769  t in their origi
+00010d10: 6e61 6c20 6f72 6465 722e 2727 270d 0a20  nal order.'''.. 
+00010d20: 2020 2020 2020 205f 696e 6974 6961 6c5f         _initial_
+00010d30: 6368 696c 6472 656e 203d 2073 656c 662e  children = self.
+00010d40: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00010d50: 6e74 2e5f 6368 696c 645f 7374 7275 6374  nt._child_struct
+00010d60: 7572 655f 656c 656d 656e 7473 2e63 6f70  ure_elements.cop
+00010d70: 7928 290d 0a20 2020 2020 2020 205f 696e  y()..        _in
+00010d80: 6974 6961 6c5f 706f 7369 7469 6f6e 735f  itial_positions_
+00010d90: 6279 5f73 686f 7274 636f 6465 203d 207b  by_shortcode = {
+00010da0: 7d0d 0a0d 0a20 2020 2020 2020 2023 4372  }....        #Cr
+00010db0: 6561 7465 2061 206c 6973 7420 6f66 2070  eate a list of p
+00010dc0: 6f73 6974 696f 6e73 2066 6f72 2065 6163  ositions for eac
+00010dd0: 6820 7368 6f72 7463 6f64 650d 0a20 2020  h shortcode..   
+00010de0: 2020 2020 2066 6f72 206e 2c20 7365 2069       for n, se i
+00010df0: 6e20 656e 756d 6572 6174 6528 7365 6c66  n enumerate(self
+00010e00: 2e5f 7374 7275 6374 7572 655f 656c 656d  ._structure_elem
+00010e10: 656e 742e 5f63 6869 6c64 5f73 7472 7563  ent._child_struc
+00010e20: 7475 7265 5f65 6c65 6d65 6e74 7329 3a0d  ture_elements):.
+00010e30: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+00010e40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00010e50: 2020 2070 6f73 5f6c 6973 7420 3d20 5f69     pos_list = _i
+00010e60: 6e69 7469 616c 5f70 6f73 6974 696f 6e73  nitial_positions
+00010e70: 5f62 795f 7368 6f72 7463 6f64 655b 7365  _by_shortcode[se
+00010e80: 2e73 686f 7274 636f 6465 5d0d 0a20 2020  .shortcode]..   
+00010e90: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
+00010ea0: 5f6c 6973 742e 6170 7065 6e64 286e 290d  _list.append(n).
+00010eb0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00010ec0: 6570 7420 4b65 7945 7272 6f72 3a0d 0a20  ept KeyError:.. 
+00010ed0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00010ee0: 696e 6974 6961 6c5f 706f 7369 7469 6f6e  initial_position
+00010ef0: 735f 6279 5f73 686f 7274 636f 6465 5b73  s_by_shortcode[s
+00010f00: 652e 7368 6f72 7463 6f64 655d 203d 205b  e.shortcode] = [
+00010f10: 6e5d 0d0a 0d0a 2020 2020 2020 2020 2343  n]....        #C
+00010f20: 6c65 6172 206f 7574 2063 6869 6c64 7265  lear out childre
+00010f30: 6e0d 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+00010f40: 636c 6561 7228 290d 0a0d 0a20 2020 2020  clear()....     
+00010f50: 2020 2061 6c6c 5f6d 6f76 6564 5f73 686f     all_moved_sho
+00010f60: 7274 636f 6465 7320 3d20 7b7d 0d0a 2020  rtcodes = {}..  
+00010f70: 2020 2020 2020 234f 7264 6572 2062 7920        #Order by 
+00010f80: 7468 6520 7368 6f72 7463 6f64 6573 0d0a  the shortcodes..
+00010f90: 2020 2020 2020 2020 666f 7220 7368 6f72          for shor
+00010fa0: 7463 6f64 6520 696e 2073 686f 7274 636f  tcode in shortco
+00010fb0: 6465 5f6c 6973 743a 0d0a 2020 2020 2020  de_list:..      
+00010fc0: 2020 2020 2020 2352 6563 6f72 6420 7368        #Record sh
+00010fd0: 6f72 7463 6f64 6573 206f 6620 6d6f 7665  ortcodes of move
+00010fe0: 6420 656c 656d 656e 7473 2c20 736f 2077  d elements, so w
+00010ff0: 6520 6361 6e20 776f 726b 206f 7574 2028  e can work out (
+00011000: 7175 6963 6b6c 7929 2077 6861 7420 6469  quickly) what di
+00011010: 646e 2774 206d 6f76 650d 0a20 2020 2020  dn't move..     
+00011020: 2020 2020 2020 2061 6c6c 5f6d 6f76 6564         all_moved
+00011030: 5f73 686f 7274 636f 6465 735b 7368 6f72  _shortcodes[shor
+00011040: 7463 6f64 655d 203d 2073 686f 7274 636f  tcode] = shortco
+00011050: 6465 0d0a 0d0a 2020 2020 2020 2020 2020  de....          
+00011060: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+00011070: 2020 2020 2020 2020 5f63 6869 6c64 5f73          _child_s
+00011080: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+00011090: 5f69 6e64 6963 6573 203d 205f 696e 6974  _indices = _init
+000110a0: 6961 6c5f 706f 7369 7469 6f6e 735f 6279  ial_positions_by
+000110b0: 5f73 686f 7274 636f 6465 5b73 686f 7274  _shortcode[short
+000110c0: 636f 6465 5d0d 0a20 2020 2020 2020 2020  code]..         
+000110d0: 2020 2020 2020 2066 6f72 2069 6e64 2069         for ind i
+000110e0: 6e20 5f63 6869 6c64 5f73 7472 7563 7475  n _child_structu
+000110f0: 7265 5f65 6c65 6d65 6e74 5f69 6e64 6963  re_element_indic
+00011100: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+00011110: 2020 2020 2020 2020 2073 6520 3d20 5f69           se = _i
+00011120: 6e69 7469 616c 5f63 6869 6c64 7265 6e5b  nitial_children[
+00011130: 696e 645d 0d0a 2020 2020 2020 2020 2020  ind]..          
+00011140: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00011150: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+00011160: 742e 5f61 6464 5f63 6869 6c64 2873 6529  t._add_child(se)
+00011170: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00011180: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
+00011190: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000111a0: 2020 636f 6e74 696e 7565 0d0a 0d0a 0d0a    continue......
+000111b0: 2020 2020 2020 2020 2341 6464 2061 6e79          #Add any
+000111c0: 7468 696e 6720 6c65 6674 2069 6e20 7468  thing left in th
+000111d0: 6520 6f72 6967 696e 616c 2063 6869 6c64  e original child
+000111e0: 7265 6e0d 0a20 2020 2020 2020 2066 6f72  ren..        for
+000111f0: 205f 6368 696c 645f 7374 7275 6374 7572   _child_structur
+00011200: 655f 656c 656d 656e 7420 696e 205f 696e  e_element in _in
+00011210: 6974 6961 6c5f 6368 696c 6472 656e 3a0d  itial_children:.
+00011220: 0a20 2020 2020 2020 2020 2020 2023 5365  .            #Se
+00011230: 6520 6966 2074 6865 2069 6e69 7469 616c  e if the initial
+00011240: 2063 6869 6c64 2068 6173 2062 6565 6e20   child has been 
+00011250: 6f72 6465 7264 2062 7920 7468 6520 7368  orderd by the sh
+00011260: 6f72 7463 6f64 652c 206f 7220 6966 2069  ortcode, or if i
+00011270: 7420 6973 206f 6e65 206f 6620 7468 6520  t is one of the 
+00011280: 6c65 6674 6f76 6572 730d 0a20 2020 2020  leftovers..     
+00011290: 2020 2020 2020 2023 6c65 6674 6f76 6572         #leftover
+000112a0: 7320 7769 6c6c 2062 6520 6164 6465 6420  s will be added 
+000112b0: 6261 636b 2069 6e20 7468 6569 7220 6f72  back in their or
+000112c0: 6967 696e 616c 206f 7264 6572 2c20 6166  iginal order, af
+000112d0: 7465 7220 7468 6520 6f72 6465 7265 6420  ter the ordered 
+000112e0: 656c 656d 656e 7473 0d0a 2020 2020 2020  elements..      
+000112f0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00011300: 2020 2020 2020 2020 2020 2020 616c 6c5f              all_
+00011310: 6d6f 7665 645f 7368 6f72 7463 6f64 6573  moved_shortcodes
+00011320: 5b5f 6368 696c 645f 7374 7275 6374 7572  [_child_structur
+00011330: 655f 656c 656d 656e 742e 7368 6f72 746e  e_element.shortn
+00011340: 616d 655d 0d0a 2020 2020 2020 2020 2020  ame]..          
+00011350: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+00011360: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+00011370: 2020 2020 2354 6865 2063 6869 6c64 2068      #The child h
+00011380: 6173 206e 6f74 2062 6565 6e20 6d6f 7665  as not been move
+00011390: 6420 696e 2064 7572 696e 6720 7468 6520  d in during the 
+000113a0: 6f72 6465 7269 6e67 2070 726f 6365 7373  ordering process
+000113b0: 2c20 736f 2061 6464 2069 7420 696e 206e  , so add it in n
+000113c0: 6f77 0d0a 2020 2020 2020 2020 2020 2020  ow..            
+000113d0: 2020 2020 7365 6c66 2e5f 7374 7275 6374      self._struct
+000113e0: 7572 655f 656c 656d 656e 742e 5f61 6464  ure_element._add
+000113f0: 5f63 6869 6c64 285f 6368 696c 645f 7374  _child(_child_st
+00011400: 7275 6374 7572 655f 656c 656d 656e 7429  ructure_element)
+00011410: 0d0a 0d0a 2020 2020 6465 6620 6375 7428  ....    def cut(
+00011420: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00011430: 2727 270d 0a20 2020 2020 2020 2052 656d  '''..        Rem
+00011440: 6f76 6520 7468 6520 6368 696c 6472 656e  ove the children
+00011450: 2066 726f 6d20 7468 6520 7061 7265 6e74   from the parent
+00011460: 2061 6e64 2072 6574 7572 6e20 7468 656d   and return them
+00011470: 2061 7320 6120 6c69 7374 2e0d 0a20 2020   as a list...   
+00011480: 2020 2020 2054 6869 7320 6675 6e63 7469       This functi
+00011490: 6f6e 2069 7320 7573 6566 756c 2077 6865  on is useful whe
+000114a0: 6e20 7765 2061 7265 2061 626f 7574 2074  n we are about t
+000114b0: 6f20 2770 6173 7465 2720 7468 6520 6368  o 'paste' the ch
+000114c0: 696c 6472 656e 2069 6e74 6f20 616e 6f74  ildren into anot
+000114d0: 6865 7220 7370 6f74 0d0a 2020 2020 2020  her spot..      
+000114e0: 2020 2727 270d 0a20 2020 2020 2020 2023    '''..        #
+000114f0: 5765 206e 6565 6420 746f 2064 6574 6163  We need to detac
+00011500: 6820 6561 6368 2063 6869 6c64 2066 726f  h each child fro
+00011510: 6d20 7468 6520 7061 7265 6e74 2073 7472  m the parent str
+00011520: 7563 7475 7265 2065 6c65 6d65 6e74 2c20  ucture element, 
+00011530: 636c 6561 7220 6f75 7273 656c 6620 616e  clear ourself an
+00011540: 6420 7265 7475 726e 2061 206e 6577 2053  d return a new S
+00011550: 7472 7563 7475 7265 456c 656d 656e 7443  tructureElementC
+00011560: 6869 6c64 7265 6e0d 0a20 2020 2020 2020  hildren..       
+00011570: 2023 5468 6973 2077 6179 2c20 7768 656e   #This way, when
+00011580: 2070 6173 7465 6420 696e 2c20 7468 6520   pasted in, the 
+00011590: 6368 696c 6472 656e 2077 696c 6c20 7265  children will re
+000115a0: 6d61 696e 2074 6865 2073 616d 6520 656e  main the same en
+000115b0: 7469 7469 6573 2c20 6275 7420 7468 6520  tities, but the 
+000115c0: 6e65 7720 7061 7265 6e74 2053 7472 7563  new parent Struc
+000115d0: 7475 7265 456c 656d 656e 7420 7769 6c6c  tureElement will
+000115e0: 206e 6f74 2062 6520 706f 696e 7469 6e67   not be pointing
+000115f0: 0d0a 2020 2020 2020 2020 2374 6f20 736f  ..        #to so
+00011600: 6d65 206f 7468 6572 2063 6869 6c64 7265  me other childre
+00011610: 6e0d 0a0d 0a20 2020 2020 2020 2072 6574  n....        ret
+00011620: 7661 6c20 3d20 5b63 6820 666f 7220 6368  val = [ch for ch
+00011630: 2069 6e20 7365 6c66 2e76 616c 7565 7328   in self.values(
+00011640: 295d 0d0a 0d0a 2020 2020 2020 2020 2343  )]....        #C
+00011650: 6c65 6172 2063 6869 6c64 7265 6e20 6f75  lear children ou
+00011660: 7420 6f66 2073 656c 660d 0a20 2020 2020  t of self..     
+00011670: 2020 2073 656c 662e 636c 6561 7228 290d     self.clear().
+00011680: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
+00011690: 6e20 7265 7476 616c 0d0a 0d0a 2020 2020  n retval....    
+000116a0: 2344 6566 696e 6520 7768 6174 2068 6170  #Define what hap
+000116b0: 7065 6e73 2077 6865 6e20 7765 2063 616c  pens when we cal
+000116c0: 6c20 2b3d 0d0a 2020 2020 2357 6520 7761  l +=..    #We wa
+000116d0: 6e74 2074 6f20 6170 7065 6e64 0d0a 2020  nt to append..  
+000116e0: 2020 6465 6620 5f5f 6961 6464 5f5f 2873    def __iadd__(s
+000116f0: 656c 662c 6f74 6865 7229 3a0d 0a20 2020  elf,other):..   
+00011700: 2020 2020 2073 656c 662e 6170 7065 6e64       self.append
+00011710: 2869 7465 6d3d 6f74 6865 722c 6d65 7267  (item=other,merg
+00011720: 653d 4661 6c73 6529 0d0a 2020 2020 2020  e=False)..      
+00011730: 2020 7265 7475 726e 2073 656c 660d 0a0d    return self...
+00011740: 0a20 2020 2023 4465 6669 6e65 2077 6861  .    #Define wha
+00011750: 7420 6861 7070 656e 7320 7768 656e 2077  t happens when w
+00011760: 6520 6361 6c6c 207c 3d0d 0a20 2020 2023  e call |=..    #
+00011770: 5765 2077 616e 7420 746f 2061 7070 656e  We want to appen
+00011780: 6420 756e 6971 7565 2069 7465 6d73 0d0a  d unique items..
+00011790: 2020 2020 6465 6620 5f5f 696f 725f 5f28      def __ior__(
+000117a0: 7365 6c66 2c6f 7468 6572 293a 0d0a 2020  self,other):..  
+000117b0: 2020 2020 2020 7365 6c66 2e61 7070 656e        self.appen
+000117c0: 6428 6974 656d 3d6f 7468 6572 2c6d 6572  d(item=other,mer
+000117d0: 6765 3d54 7275 6529 0d0a 2020 2020 2020  ge=True)..      
+000117e0: 2020 7265 7475 726e 2073 656c 660d 0a0d    return self...
+000117f0: 0a20 2020 2023 4465 6669 6e65 2077 6861  .    #Define wha
+00011800: 7420 6861 7070 656e 7320 7768 656e 2077  t happens when w
+00011810: 6520 6361 6c6c 202d 3d0d 0a20 2020 2023  e call -=..    #
+00011820: 5765 2077 616e 7420 746f 2072 656d 6f76  We want to remov
+00011830: 6520 7468 6520 6669 6e61 6c20 6368 696c  e the final chil
+00011840: 6420 7769 7468 2074 6861 7420 6b65 790d  d with that key.
+00011850: 0a20 2020 2064 6566 205f 5f69 7375 625f  .    def __isub_
+00011860: 5f28 7365 6c66 2c6f 7468 6572 293a 0d0a  _(self,other):..
+00011870: 2020 2020 2020 2020 7365 6c66 2e5f 7374          self._st
+00011880: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
+00011890: 7265 6d6f 7665 5f63 6869 6c64 286f 7468  remove_child(oth
+000118a0: 6572 290d 0a20 2020 2020 2020 2072 6574  er)..        ret
+000118b0: 7572 6e20 7365 6c66 0d0a 0d0a 0d0a 2020  urn self......  
+000118c0: 2020 6465 6620 6b65 7973 2873 656c 6629    def keys(self)
+000118d0: 3a0d 0a20 2020 2020 2020 2023 6966 206e  :..        #if n
+000118e0: 6f74 2073 656c 662e 6469 6d65 6e73 696f  ot self.dimensio
+000118f0: 6e2e 5f65 6c65 6d65 6e74 735f 7265 6164  n._elements_read
+00011900: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
+00011910: 7365 6c66 2e5f 6c6f 6164 5f65 6c65 6d65  self._load_eleme
+00011920: 6e74 7328 290d 0a20 2020 2020 2020 2066  nts()..        f
+00011930: 6f72 2065 6c20 696e 2073 656c 662e 5f73  or el in self._s
+00011940: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+00011950: 2e5f 6368 696c 645f 7374 7275 6374 7572  ._child_structur
+00011960: 655f 656c 656d 656e 7473 3a0d 0a20 2020  e_elements:..   
+00011970: 2020 2020 2020 2020 2079 6965 6c64 2065           yield e
+00011980: 6c2e 7368 6f72 746e 616d 650d 0a0d 0a20  l.shortname.... 
+00011990: 2020 2064 6566 2069 7465 6d73 2873 656c     def items(sel
+000119a0: 6629 3a0d 0a20 2020 2020 2020 2023 6966  f):..        #if
+000119b0: 206e 6f74 2073 656c 662e 6469 6d65 6e73   not self.dimens
+000119c0: 696f 6e2e 5f65 6c65 6d65 6e74 735f 7265  ion._elements_re
+000119d0: 6164 3a0d 0a20 2020 2020 2020 2023 2020  ad:..        #  
+000119e0: 2020 7365 6c66 2e5f 6c6f 6164 5f65 6c65    self._load_ele
+000119f0: 6d65 6e74 7328 290d 0a20 2020 2020 2020  ments()..       
+00011a00: 2066 6f72 2065 6c20 696e 2073 656c 662e   for el in self.
+00011a10: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00011a20: 6e74 2e5f 6368 696c 645f 7374 7275 6374  nt._child_struct
+00011a30: 7572 655f 656c 656d 656e 7473 3a0d 0a20  ure_elements:.. 
+00011a40: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+00011a50: 2065 6c2e 7368 6f72 746e 616d 652c 2065   el.shortname, e
+00011a60: 6c0d 0a0d 0a20 2020 2064 6566 2076 616c  l....    def val
+00011a70: 7565 7328 7365 6c66 293a 0d0a 2020 2020  ues(self):..    
+00011a80: 2020 2020 2369 6620 6e6f 7420 7365 6c66      #if not self
+00011a90: 2e64 696d 656e 7369 6f6e 2e5f 656c 656d  .dimension._elem
+00011aa0: 656e 7473 5f72 6561 643a 0d0a 2020 2020  ents_read:..    
+00011ab0: 2020 2020 2023 2020 2073 656c 662e 5f6c       #   self._l
+00011ac0: 6f61 645f 656c 656d 656e 7473 2829 0d0a  oad_elements()..
+00011ad0: 2020 2020 2020 2020 666f 7220 656c 2069          for el i
+00011ae0: 6e20 7365 6c66 2e5f 7374 7275 6374 7572  n self._structur
+00011af0: 655f 656c 656d 656e 742e 5f63 6869 6c64  e_element._child
+00011b00: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00011b10: 6e74 733a 0d0a 2020 2020 2020 2020 2020  nts:..          
+00011b20: 2020 7969 656c 6420 656c 0d0a 0d0a 0d0a    yield el......
+00011b30: 0d0a 2020 2020 6465 6620 5f5f 6c65 6e5f  ..    def __len_
+00011b40: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+00011b50: 2020 2369 6620 6e6f 7420 7365 6c66 2e64    #if not self.d
+00011b60: 696d 656e 7369 6f6e 2e5f 656c 656d 656e  imension._elemen
+00011b70: 7473 5f72 6561 643a 0d0a 2020 2020 2020  ts_read:..      
+00011b80: 2020 2320 2020 2073 656c 662e 5f6c 6f61    #    self._loa
+00011b90: 645f 656c 656d 656e 7473 2829 0d0a 0d0a  d_elements()....
+00011ba0: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00011bb0: 656e 2873 656c 662e 5f73 7472 7563 7475  en(self._structu
+00011bc0: 7265 5f65 6c65 6d65 6e74 2e5f 6368 696c  re_element._chil
+00011bd0: 645f 7374 7275 6374 7572 655f 656c 656d  d_structure_elem
+00011be0: 656e 7473 290d 0a0d 0a20 2020 2064 6566  ents)....    def
+00011bf0: 205f 5f73 7472 5f5f 2873 656c 6629 3a0d   __str__(self):.
+00011c00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00011c10: 275b 2720 2b20 275c 6e27 2e6a 6f69 6e28  '[' + '\n'.join(
+00011c20: 5b20 762e 7368 6f72 746e 616d 6520 666f  [ v.shortname fo
+00011c30: 7220 2076 2069 6e20 7365 6c66 2e5f 7374  r  v in self._st
+00011c40: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
+00011c50: 5f63 6869 6c64 5f73 7472 7563 7475 7265  _child_structure
+00011c60: 5f65 6c65 6d65 6e74 735d 2920 2b20 275d  _elements]) + ']
+00011c70: 270d 0a0d 0a0d 0a20 2020 2064 6566 205f  '......    def _
+00011c80: 5f72 6570 725f 5f28 7365 6c66 293a 0d0a  _repr__(self):..
+00011c90: 2020 2020 2020 2020 7265 7475 726e 2027          return '
+00011ca0: 7b7d 2066 726f 6d20 3c7b 7d20 6f62 6a65  {} from <{} obje
+00011cb0: 6374 2061 7420 7b7d 3e27 2e66 6f72 6d61  ct at {}>'.forma
+00011cc0: 7428 277b 2720 2b20 275c 6e27 2e6a 6f69  t('{' + '\n'.joi
+00011cd0: 6e28 5b20 2227 7b7d 273a 7b7d 222e 666f  n([ "'{}':{}".fo
+00011ce0: 726d 6174 286b 2c72 6570 7228 7629 2920  rmat(k,repr(v)) 
+00011cf0: 666f 7220 6b2c 7620 696e 2073 656c 662e  for k,v in self.
+00011d00: 6974 656d 7328 295d 2920 2b20 277d 272c  items()]) + '}',
+00011d10: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
+00011d20: 5f6e 616d 655f 5f2c 6865 7828 6964 2873  _name__,hex(id(s
+00011d30: 656c 6629 2929 0d0a 0d0a 2020 2020 6465  elf)))....    de
+00011d40: 6620 636c 6561 7228 7365 6c66 293a 0d0a  f clear(self):..
+00011d50: 2020 2020 2020 2020 2727 2752 656d 6f76          '''Remov
+00011d60: 6520 616c 6c20 6f66 2074 6865 2063 6869  e all of the chi
+00011d70: 6c64 7265 6e20 6672 6f6d 2074 6865 2070  ldren from the p
+00011d80: 6172 656e 7427 2727 0d0a 2020 2020 2020  arent'''..      
+00011d90: 2020 7365 6c66 2e5f 7374 7275 6374 7572    self._structur
+00011da0: 655f 656c 656d 656e 742e 7265 6d6f 7665  e_element.remove
+00011db0: 5f63 6869 6c64 7265 6e28 290d 0a0d 0a63  _children()....c
+00011dc0: 6c61 7373 205f 5374 7275 6374 7572 6545  lass _StructureE
+00011dd0: 6c65 6d65 6e74 4465 7363 656e 6461 6e74  lementDescendant
+00011de0: 7347 6574 7465 7228 6f62 6a65 6374 293a  sGetter(object):
+00011df0: 0d0a 2020 2020 2727 2744 6f65 7320 6120  ..    '''Does a 
+00011e00: 6269 7420 6f66 206d 6167 6963 2074 6f20  bit of magic to 
+00011e10: 616c 6c6f 7720 5374 7275 6374 7572 6545  allow StructureE
+00011e20: 6c65 6d65 6e74 732e 6465 7363 656e 6461  lements.descenda
+00011e30: 6e74 7320 746f 2061 7070 6561 7220 6c69  nts to appear li
+00011e40: 6b65 2061 2064 6963 7469 6f6e 6172 792c  ke a dictionary,
+00011e50: 206f 6e6c 7920 7769 7468 2065 7874 7261   only with extra
+00011e60: 2073 7065 6369 616c 2066 756e 6374 696f   special functio
+00011e70: 6e73 206c 696b 6520 2b3d 2027 2727 0d0a  ns like += '''..
+00011e80: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00011e90: 2873 656c 662c 7374 7275 6374 7572 655f  (self,structure_
+00011ea0: 656c 656d 656e 7429 3a0d 0a20 2020 2020  element):..     
+00011eb0: 2020 2073 656c 662e 5f73 7472 7563 7475     self._structu
+00011ec0: 7265 5f65 6c65 6d65 6e74 2020 2020 2020  re_element      
+00011ed0: 2020 2020 3d20 7374 7275 6374 7572 655f      = structure_
+00011ee0: 656c 656d 656e 740d 0a0d 0a20 2020 2023  element....    #
+00011ef0: 5468 6520 5f53 7472 7563 7475 7265 456c  The _StructureEl
+00011f00: 656d 656e 7444 6573 6365 6e64 616e 7473  ementDescendants
+00011f10: 4765 7474 6572 2068 6173 2074 6865 2075  Getter has the u
+00011f20: 6e66 6f72 7475 6e61 7465 2070 726f 7065  nfortunate prope
+00011f30: 7274 7920 6f66 2062 6568 6176 696e 6720  rty of behaving 
+00011f40: 6c69 6b65 2062 6f74 6820 6120 6c69 7374  like both a list
+00011f50: 2069 7465 7261 746f 7220 616e 6420 6120   iterator and a 
+00011f60: 6469 6374 696f 6e61 7279 0d0a 2020 2020  dictionary..    
+00011f70: 2349 7427 7320 6120 6269 7420 6f66 2061  #It's a bit of a
+00011f80: 206d 6573 730d 0a20 2020 2064 6566 205f   mess..    def _
+00011f90: 5f69 7465 725f 5f28 7365 6c66 293a 0d0a  _iter__(self):..
+00011fa0: 2020 2020 2020 2020 7365 6c66 2e5f 6974          self._it
+00011fb0: 6572 6174 6f72 203d 2069 7465 7228 7365  erator = iter(se
+00011fc0: 6c66 2e5f 7374 7275 6374 7572 655f 656c  lf._structure_el
+00011fd0: 656d 656e 742e 7761 6c6b 2829 290d 0a20  ement.walk()).. 
+00011fe0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00011ff0: 6c66 0d0a 0d0a 2020 2020 6465 6620 5f5f  lf....    def __
+00012000: 6e65 7874 5f5f 2873 656c 6629 3a0d 0a20  next__(self):.. 
+00012010: 2020 2020 2020 2072 6574 7572 6e20 6e65         return ne
+00012020: 7874 2873 656c 662e 5f69 7465 7261 746f  xt(self._iterato
+00012030: 7229 0d0a 0d0a 2020 2020 6465 6620 5f6e  r)....    def _n
+00012040: 6f72 6d61 6c69 7365 5f6b 6579 2873 656c  ormalise_key(sel
+00012050: 662c 6b65 7929 3a0d 0a20 2020 2020 2020  f,key):..       
+00012060: 2023 5468 6520 696d 706f 7274 616e 7420   #The important 
+00012070: 7061 7274 206f 6620 6465 7363 656e 6461  part of descenda
+00012080: 6e74 7320 6973 2074 6861 7420 796f 7520  nts is that you 
+00012090: 6361 6e20 6769 7665 2061 2063 6f6d 706f  can give a compo
+000120a0: 7369 7465 206b 6579 2c20 6569 7468 6572  site key, either
+000120b0: 2061 7320 6120 7374 7269 6e67 206f 7220   as a string or 
+000120c0: 6173 2061 206c 6973 740d 0a20 2020 2020  as a list..     
+000120d0: 2020 2023 6966 206b 6579 2069 7320 6120     #if key is a 
+000120e0: 7374 7269 6e67 2074 6865 6e20 7765 2077  string then we w
+000120f0: 616e 7420 746f 2073 706c 6974 2069 7420  ant to split it 
+00012100: 286f 6e20 666f 7277 6172 6420 736c 6173  (on forward slas
+00012110: 6865 7329 2061 6e64 2063 7265 6174 6520  hes) and create 
+00012120: 6120 6c69 7374 206f 6620 7368 6f72 7463  a list of shortc
+00012130: 6f64 6573 0d0a 2020 2020 2020 2020 6966  odes..        if
+00012140: 2069 7369 6e73 7461 6e63 6528 6b65 792c   isinstance(key,
+00012150: 7374 7229 3a0d 0a20 2020 2020 2020 2020  str):..         
+00012160: 2020 2074 656d 705f 6b65 7920 3d20 6b65     temp_key = ke
+00012170: 792e 7370 6c69 7428 272f 2729 0d0a 2020  y.split('/')..  
+00012180: 2020 2020 2020 2020 2020 6b65 7920 3d20            key = 
+00012190: 5b5d 0d0a 2020 2020 2020 2020 2020 2020  []..            
+000121a0: 666f 7220 6b20 696e 2074 656d 705f 6b65  for k in temp_ke
+000121b0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+000121c0: 2020 2020 6b20 3d20 6b2e 7374 7269 7028      k = k.strip(
+000121d0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+000121e0: 2020 2069 6620 6c65 6e28 6b29 3e33 303a     if len(k)>30:
+000121f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00012200: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00012210: 6545 7272 6f72 2827 4b65 7920 636f 6e74  eError('Key cont
+00012220: 6169 6e73 2061 2073 686f 7274 636f 6465  ains a shortcode
+00012230: 206c 6f6e 6765 7220 7468 616e 2033 3020   longer than 30 
+00012240: 6368 6172 6163 7465 7273 203a 272b 7374  characters :'+st
+00012250: 7228 6b29 290d 0a20 2020 2020 2020 2020  r(k))..         
+00012260: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00012270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012280: 2020 6b65 792e 6170 7065 6e64 286b 290d    key.append(k).
+00012290: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+000122a0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+000122b0: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
+000122c0: 726e 206b 6579 0d0a 0d0a 2020 2020 2354  rn key....    #T
+000122d0: 4f44 4f20 2d20 6368 616e 6765 2074 6869  ODO - change thi
+000122e0: 7320 746f 2063 616c 6c20 6765 7420 656c  s to call get el
+000122f0: 656d 656e 7473 206f 6e20 6120 7369 6e67  ements on a sing
+00012300: 6c65 2073 686f 7274 636f 6465 206b 6579  le shortcode key
+00012310: 2077 6869 6368 2069 7320 6e6f 7420 6174   which is not at
+00012320: 2072 6f6f 740d 0a20 2020 2023 4368 616e   root..    #Chan
+00012330: 6765 2074 6869 7320 746f 2073 6561 7263  ge this to searc
+00012340: 6820 666f 7220 6669 7273 7420 656c 656d  h for first elem
+00012350: 656e 7420 7573 696e 6720 6765 745f 656c  ent using get_el
+00012360: 656d 656e 7473 2061 6e64 2074 6865 6e20  ements and then 
+00012370: 6d61 7463 6820 7468 6520 7265 7374 206f  match the rest o
+00012380: 6620 7468 6520 7472 6565 0d0a 2020 2020  f the tree..    
+00012390: 6465 6620 5f5f 6765 7469 7465 6d5f 5f28  def __getitem__(
+000123a0: 7365 6c66 2c6b 6579 293a 0d0a 2020 2020  self,key):..    
+000123b0: 2020 2020 2354 6865 2069 6d70 6f72 7461      #The importa
+000123c0: 6e74 2070 6172 7420 6f66 2064 6573 6365  nt part of desce
+000123d0: 6e64 616e 7473 2069 7320 7468 6174 2079  ndants is that y
+000123e0: 6f75 2063 616e 2067 6976 6520 6120 636f  ou can give a co
+000123f0: 6d70 6f73 6974 6520 6b65 792c 2065 6974  mposite key, eit
+00012400: 6865 7220 6173 2061 2073 7472 696e 6720  her as a string 
+00012410: 6f72 2061 7320 6120 6c69 7374 0d0a 0d0a  or as a list....
+00012420: 2020 2020 2020 2020 6b65 7920 3d20 7365          key = se
+00012430: 6c66 2e5f 6e6f 726d 616c 6973 655f 6b65  lf._normalise_ke
+00012440: 7928 6b65 7929 0d0a 0d0a 2020 2020 2020  y(key)....      
+00012450: 2020 2361 7373 756d 6520 7765 2063 616e    #assume we can
+00012460: 2069 7465 7261 7465 206f 7665 7220 7468   iterate over th
+00012470: 6520 6b65 7920 7061 7373 6564 2069 6e20  e key passed in 
+00012480: 6f72 2074 6865 206b 6579 2063 7265 6174  or the key creat
+00012490: 6564 2066 726f 6d20 7468 6520 7374 7269  ed from the stri
+000124a0: 6e67 0d0a 2020 2020 2020 2020 2364 6573  ng..        #des
+000124b0: 6365 6e64 2074 6865 2068 6965 7261 7263  cend the hierarc
+000124c0: 6879 2075 6e74 696c 2077 6520 6669 6e64  hy until we find
+000124d0: 2074 6865 2065 6c65 6d65 6e74 0d0a 2020   the element..  
+000124e0: 2020 2020 2020 7265 7476 616c 203d 2073        retval = s
+000124f0: 656c 662e 5f73 7472 7563 7475 7265 5f65  elf._structure_e
+00012500: 6c65 6d65 6e74 0d0a 2020 2020 2020 2020  lement..        
+00012510: 6966 206c 656e 286b 6579 2920 3e20 303a  if len(key) > 0:
+00012520: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00012530: 7220 6b20 696e 206b 6579 3a0d 0a20 2020  r k in key:..   
+00012540: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00012550: 7661 6c20 3d20 7265 7476 616c 2e63 6869  val = retval.chi
+00012560: 6c64 7265 6e5b 6b5d 0d0a 0d0a 2020 2020  ldren[k]....    
+00012570: 2020 2020 7265 7475 726e 2072 6574 7661      return retva
+00012580: 6c0d 0a0d 0a20 2020 2064 6566 205f 5f73  l....    def __s
+00012590: 6574 6974 656d 5f5f 2873 656c 662c 206b  etitem__(self, k
+000125a0: 6579 2c20 6974 656d 293a 0d0a 2020 2020  ey, item):..    
+000125b0: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+000125c0: 7461 6e63 6528 6974 656d 2c53 7472 7563  tance(item,Struc
+000125d0: 7475 7265 456c 656d 656e 7429 0d0a 0d0a  tureElement)....
+000125e0: 2020 2020 2020 2020 6b65 7920 3d20 7365          key = se
+000125f0: 6c66 2e5f 6e6f 726d 616c 6973 655f 6b65  lf._normalise_ke
+00012600: 7928 6b65 7929 0d0a 0d0a 2020 2020 2020  y(key)....      
+00012610: 2020 6c6f 6f6b 6564 5f75 705f 6974 656d    looked_up_item
+00012620: 203d 2073 656c 665b 6b65 795d 0d0a 0d0a   = self[key]....
+00012630: 2020 2020 2020 2020 6173 7365 7274 2069          assert i
+00012640: 7369 6e73 7461 6e63 6528 6c6f 6f6b 6564  sinstance(looked
+00012650: 5f75 705f 6974 656d 2c53 7472 7563 7475  _up_item,Structu
+00012660: 7265 456c 656d 656e 7429 0d0a 0d0a 2020  reElement)....  
+00012670: 2020 2020 2020 6966 206c 6f6f 6b65 645f        if looked_
+00012680: 7570 5f69 7465 6d2e 6973 5f72 6f6f 743a  up_item.is_root:
+00012690: 0d0a 2020 2020 2020 2020 2020 2020 2353  ..            #S
+000126a0: 6574 2074 6865 2068 6965 7261 7263 6879  et the hierarchy
+000126b0: 2074 6f20 7468 6520 636f 7272 6563 7420   to the correct 
+000126c0: 6974 656d 0d0a 2020 2020 2020 2020 2020  item..          
+000126d0: 2020 6c6f 6f6b 6564 5f75 705f 6974 656d    looked_up_item
+000126e0: 2e73 7472 7563 7475 7265 2e68 6965 7261  .structure.hiera
+000126f0: 7263 6869 6573 5b6c 6f6f 6b65 645f 7570  rchies[looked_up
+00012700: 5f69 7465 6d2e 7368 6f72 7463 6f64 655d  _item.shortcode]
+00012710: 203d 2069 7465 6d0d 0a20 2020 2020 2020   = item..       
+00012720: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00012730: 2020 2020 6c6f 6f6b 6564 5f75 705f 6974      looked_up_it
+00012740: 656d 2e70 6172 656e 742e 6368 696c 6472  em.parent.childr
+00012750: 656e 5b6c 6f6f 6b65 645f 7570 5f69 7465  en[looked_up_ite
+00012760: 6d2e 7368 6f72 7463 6f64 655d 203d 2069  m.shortcode] = i
+00012770: 7465 6d0d 0a0d 0a20 2020 2064 6566 2061  tem....    def a
+00012780: 7070 656e 6428 7365 6c66 2c20 6974 656d  ppend(self, item
+00012790: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+000127a0: 2e5f 7374 7275 6374 7572 655f 656c 656d  ._structure_elem
+000127b0: 656e 742e 6368 696c 6472 656e 2e61 7070  ent.children.app
+000127c0: 656e 6428 6974 656d 290d 0a0d 0a20 2020  end(item)....   
+000127d0: 2023 4a41 5420 3230 3138 2d30 382d 3130   #JAT 2018-08-10
+000127e0: 3a20 4e6f 7420 7265 616c 6c79 2073 7572  : Not really sur
+000127f0: 6520 686f 7720 7468 6973 2077 6f75 6c64  e how this would
+00012800: 2062 6520 636f 6465 6420 2d20 6d61 7962   be coded - mayb
+00012810: 6520 6279 2072 6574 7572 6e69 6e67 2061  e by returning a
+00012820: 6e63 6573 746f 7273 2077 6869 6c65 2077  ncestors while w
+00012830: 616c 6b69 6e67 0d0a 2020 2020 2364 6566  alking..    #def
+00012840: 206b 6579 7328 7365 6c66 293a 0d0a 2020   keys(self):..  
+00012850: 2020 2320 2020 2023 6966 206e 6f74 2073    #    #if not s
+00012860: 656c 662e 6469 6d65 6e73 696f 6e2e 5f65  elf.dimension._e
+00012870: 6c65 6d65 6e74 735f 7265 6164 3a0d 0a20  lements_read:.. 
+00012880: 2020 2023 2020 2020 2320 2020 2073 656c     #    #    sel
+00012890: 662e 5f6c 6f61 645f 656c 656d 656e 7473  f._load_elements
+000128a0: 2829 0d0a 2020 2020 230d 0a20 2020 2023  ()..    #..    #
+000128b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000128c0: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+000128d0: 6e74 2e5f 6368 696c 645f 7374 7275 6374  nt._child_struct
+000128e0: 7572 655f 656c 656d 656e 7473 2e6b 6579  ure_elements.key
+000128f0: 7328 290d 0a20 2020 2023 0d0a 2020 2020  s()..    #..    
+00012900: 2364 6566 2069 7465 6d73 2873 656c 6629  #def items(self)
+00012910: 3a0d 0a20 2020 2023 2020 2020 2369 6620  :..    #    #if 
+00012920: 6e6f 7420 7365 6c66 2e64 696d 656e 7369  not self.dimensi
+00012930: 6f6e 2e5f 656c 656d 656e 7473 5f72 6561  on._elements_rea
+00012940: 643a 0d0a 2020 2020 2320 2020 2023 2020  d:..    #    #  
+00012950: 2020 7365 6c66 2e5f 6c6f 6164 5f65 6c65    self._load_ele
+00012960: 6d65 6e74 7328 290d 0a20 2020 2023 0d0a  ments()..    #..
+00012970: 2020 2020 2320 2020 2072 6574 7572 6e20      #    return 
+00012980: 7365 6c66 2e5f 7374 7275 6374 7572 655f  self._structure_
+00012990: 656c 656d 656e 742e 5f63 6869 6c64 5f73  element._child_s
+000129a0: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+000129b0: 732e 6974 656d 7328 290d 0a0d 0a20 2020  s.items()....   
+000129c0: 2023 4953 2074 6869 7320 7269 6768 743f   #IS this right?
+000129d0: 2061 7265 2077 6520 7265 616c 6c79 2077   are we really w
+000129e0: 616c 6b69 6e67 3f0d 0a20 2020 2064 6566  alking?..    def
+000129f0: 2076 616c 7565 7328 7365 6c66 293a 0d0a   values(self):..
+00012a00: 2020 2020 2020 2020 2369 6620 6e6f 7420          #if not 
+00012a10: 7365 6c66 2e64 696d 656e 7369 6f6e 2e5f  self.dimension._
+00012a20: 656c 656d 656e 7473 5f72 6561 643a 0d0a  elements_read:..
+00012a30: 2020 2020 2020 2020 2023 2020 2073 656c           #   sel
+00012a40: 662e 5f6c 6f61 645f 656c 656d 656e 7473  f._load_elements
+00012a50: 2829 0d0a 0d0a 2020 2020 2020 2020 7265  ()....        re
+00012a60: 7475 726e 2073 656c 662e 5f73 7472 7563  turn self._struc
+00012a70: 7475 7265 5f65 6c65 6d65 6e74 2e77 616c  ture_element.wal
+00012a80: 6b28 290d 0a0d 0a20 2020 2023 6465 6620  k()....    #def 
+00012a90: 5f5f 6c65 6e5f 5f28 7365 6c66 293a 0d0a  __len__(self):..
+00012aa0: 2020 2020 2320 2020 2023 6966 206e 6f74      #    #if not
+00012ab0: 2073 656c 662e 6469 6d65 6e73 696f 6e2e   self.dimension.
+00012ac0: 5f65 6c65 6d65 6e74 735f 7265 6164 3a0d  _elements_read:.
+00012ad0: 0a20 2020 2023 2020 2020 2320 2020 2073  .    #    #    s
+00012ae0: 656c 662e 5f6c 6f61 645f 656c 656d 656e  elf._load_elemen
+00012af0: 7473 2829 0d0a 2020 2020 230d 0a20 2020  ts()..    #..   
+00012b00: 2023 2020 2020 7265 7475 726e 206c 656e   #    return len
+00012b10: 2873 656c 662e 5f73 7472 7563 7475 7265  (self._structure
+00012b20: 5f65 6c65 6d65 6e74 2e5f 6368 696c 645f  _element._child_
+00012b30: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+00012b40: 7473 290d 0a0d 0a20 2020 2023 6465 6620  ts)....    #def 
+00012b50: 5f5f 7374 725f 5f28 7365 6c66 293a 0d0a  __str__(self):..
+00012b60: 2020 2020 2320 2020 2072 6574 7572 6e20      #    return 
+00012b70: 7374 7228 7365 6c66 2e5f 7374 7275 6374  str(self._struct
+00012b80: 7572 655f 656c 656d 656e 742e 5f63 6869  ure_element._chi
+00012b90: 6c64 5f73 7472 7563 7475 7265 5f65 6c65  ld_structure_ele
+00012ba0: 6d65 6e74 7329 0d0a 0d0a 2020 2020 6465  ments)....    de
+00012bb0: 6620 636c 6561 7228 7365 6c66 293a 0d0a  f clear(self):..
+00012bc0: 2020 2020 2020 2020 2727 2752 656d 6f76          '''Remov
+00012bd0: 6520 616c 6c20 6f66 2074 6865 2063 6869  e all of the chi
+00012be0: 6c64 7265 6e20 6672 6f6d 2074 6865 2053  ldren from the S
+00012bf0: 7472 7563 7475 7265 456c 656d 656e 7420  tructureElement 
+00012c00: 7768 6f73 6520 6465 7363 656e 6461 6e74  whose descendant
+00012c10: 7320 6172 6520 6265 696e 6720 7265 7475  s are being retu
+00012c20: 726e 6564 2e27 2727 0d0a 2020 2020 2020  rned.'''..      
+00012c30: 2020 7365 6c66 2e5f 7374 7275 6374 7572    self._structur
+00012c40: 655f 656c 656d 656e 742e 7265 6d6f 7665  e_element.remove
+00012c50: 5f63 6869 6c64 7265 6e28 290d 0a0d 0a63  _children()....c
+00012c60: 6c61 7373 205f 5374 7275 6374 7572 6544  lass _StructureD
+00012c70: 6573 6365 6e64 616e 7473 4765 7474 6572  escendantsGetter
+00012c80: 286f 626a 6563 7429 3a0d 0a20 2020 2027  (object):..    '
+00012c90: 2727 446f 6573 2061 2062 6974 206f 6620  ''Does a bit of 
+00012ca0: 6d61 6769 6320 746f 2061 6c6c 6f77 2053  magic to allow S
+00012cb0: 7472 7563 7475 7265 2e64 6573 6365 6e64  tructure.descend
+00012cc0: 616e 7473 2074 6f20 6170 7065 6172 206c  ants to appear l
+00012cd0: 696b 6520 6120 6469 6374 696f 6e61 7279  ike a dictionary
+00012ce0: 2c20 6f6e 6c79 2077 6974 6820 6578 7472  , only with extr
+00012cf0: 6120 7370 6563 6961 6c20 6675 6e63 7469  a special functi
+00012d00: 6f6e 7320 6c69 6b65 202b 3d20 2727 270d  ons like += '''.
+00012d10: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+00012d20: 5f28 7365 6c66 2c73 7472 7563 7475 7265  _(self,structure
+00012d30: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+00012d40: 2e5f 7374 7275 6374 7572 6520 2020 2020  ._structure     
+00012d50: 2020 2020 203d 2073 7472 7563 7475 7265       = structure
+00012d60: 0d0a 0d0a 2020 2020 2354 6865 205f 5374  ....    #The _St
+00012d70: 7275 6374 7572 6545 6c65 6d65 6e74 4465  ructureElementDe
+00012d80: 7363 656e 6461 6e74 7347 6574 7465 7220  scendantsGetter 
+00012d90: 6861 7320 7468 6520 756e 666f 7274 756e  has the unfortun
+00012da0: 6174 6520 7072 6f70 6572 7479 206f 6620  ate property of 
+00012db0: 6265 6861 7669 6e67 206c 696b 6520 626f  behaving like bo
+00012dc0: 7468 2061 206c 6973 7420 6974 6572 6174  th a list iterat
+00012dd0: 6f72 2061 6e64 2061 2064 6963 7469 6f6e  or and a diction
+00012de0: 6172 790d 0a20 2020 2023 4974 2773 2061  ary..    #It's a
+00012df0: 2062 6974 206f 6620 6120 6d65 7373 0d0a   bit of a mess..
+00012e00: 2020 2020 6465 6620 5f5f 6974 6572 5f5f      def __iter__
+00012e10: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00012e20: 2073 656c 662e 5f69 7465 7261 746f 7220   self._iterator 
+00012e30: 3d20 6974 6572 2873 656c 662e 5f73 7472  = iter(self._str
+00012e40: 7563 7475 7265 2e77 616c 6b28 2929 0d0a  ucture.walk())..
+00012e50: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00012e60: 656c 660d 0a0d 0a20 2020 2064 6566 205f  elf....    def _
+00012e70: 5f6e 6578 745f 5f28 7365 6c66 293a 0d0a  _next__(self):..
+00012e80: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+00012e90: 6578 7428 7365 6c66 2e5f 6974 6572 6174  ext(self._iterat
+00012ea0: 6f72 290d 0a0d 0a20 2020 2064 6566 205f  or)....    def _
+00012eb0: 6e6f 726d 616c 6973 655f 6b65 7928 7365  normalise_key(se
+00012ec0: 6c66 2c6b 6579 293a 0d0a 2020 2020 2020  lf,key):..      
+00012ed0: 2020 2354 6865 2069 6d70 6f72 7461 6e74    #The important
+00012ee0: 2070 6172 7420 6f66 2064 6573 6365 6e64   part of descend
+00012ef0: 616e 7473 2069 7320 7468 6174 2079 6f75  ants is that you
+00012f00: 2063 616e 2067 6976 6520 6120 636f 6d70   can give a comp
+00012f10: 6f73 6974 6520 6b65 792c 2065 6974 6865  osite key, eithe
+00012f20: 7220 6173 2061 2073 7472 696e 6720 6f72  r as a string or
+00012f30: 2061 7320 6120 6c69 7374 0d0a 2020 2020   as a list..    
+00012f40: 2020 2020 2369 6620 6b65 7920 6973 2061      #if key is a
+00012f50: 2073 7472 696e 6720 7468 656e 2077 6520   string then we 
+00012f60: 7761 6e74 2074 6f20 7370 6c69 7420 6974  want to split it
+00012f70: 2028 6f6e 2066 6f72 7761 7264 2073 6c61   (on forward sla
+00012f80: 7368 2920 616e 6420 6372 6561 7465 2061  sh) and create a
+00012f90: 206c 6973 7420 6f66 2073 686f 7274 636f   list of shortco
+00012fa0: 6465 730d 0a20 2020 2020 2020 2069 6620  des..        if 
+00012fb0: 6973 696e 7374 616e 6365 286b 6579 2c73  isinstance(key,s
+00012fc0: 7472 293a 0d0a 2020 2020 2020 2020 2020  tr):..          
+00012fd0: 2020 7465 6d70 5f6b 6579 203d 206b 6579    temp_key = key
+00012fe0: 2e73 706c 6974 2827 2f27 290d 0a20 2020  .split('/')..   
+00012ff0: 2020 2020 2020 2020 206b 6579 203d 205b           key = [
+00013000: 5d0d 0a20 2020 2020 2020 2020 2020 2066  ]..            f
+00013010: 6f72 206b 2069 6e20 7465 6d70 5f6b 6579  or k in temp_key
+00013020: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00013030: 2020 206b 203d 206b 2e73 7472 6970 2829     k = k.strip()
+00013040: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00013050: 2020 6966 206c 656e 286b 293e 6c6c 752e    if len(k)>llu.
+00013060: 7368 6f72 746e 616d 655f 7369 7a65 3a0d  shortname_size:.
+00013070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013080: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00013090: 4572 726f 7228 0d0a 2020 2020 2020 2020  Error(..        
+000130a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130b0: 274b 6579 2063 6f6e 7461 696e 7320 6120  'Key contains a 
+000130c0: 7368 6f72 7463 6f64 6520 6c6f 6e67 6572  shortcode longer
+000130d0: 2074 6861 6e20 7b6d 6178 5f6c 656e 6774   than {max_lengt
+000130e0: 687d 2063 6861 7261 6374 6572 7320 3a7b  h} characters :{
+000130f0: 6163 7475 616c 5f6c 656e 6774 687d 204d  actual_length} M
+00013100: 616b 6520 7375 7265 206b 6579 2069 7320  ake sure key is 
+00013110: 7365 7061 7261 7465 6420 6279 2066 6f72  separated by for
+00013120: 7761 7264 7320 736c 6173 6865 7320 282f  wards slashes (/
+00013130: 2927 0d0a 2020 2020 2020 2020 2020 2020  )'..            
+00013140: 2020 2020 2020 2020 2020 2020 2e66 6f72              .for
+00013150: 6d61 7428 6c6c 752e 7368 6f72 746e 616d  mat(llu.shortnam
+00013160: 655f 7369 7a65 2c20 6b29 0d0a 2020 2020  e_size, k)..    
 00013170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013180: 2020 6b65 792e 6170 7065 6e64 286b 290d    key.append(k).
-00013190: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-000131a0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-000131b0: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-000131c0: 726e 206b 6579 0d0a 0d0a 2020 2020 6465  rn key....    de
-000131d0: 6620 5f5f 6765 7469 7465 6d5f 5f28 7365  f __getitem__(se
-000131e0: 6c66 2c6b 6579 293a 0d0a 2020 2020 2020  lf,key):..      
-000131f0: 2020 2354 6865 2069 6d70 6f72 7461 6e74    #The important
-00013200: 2070 6172 7420 6f66 2064 6573 6365 6e64   part of descend
-00013210: 616e 7473 2069 7320 7468 6174 2079 6f75  ants is that you
-00013220: 2063 616e 2067 6976 6520 6120 636f 6d70   can give a comp
-00013230: 6f73 6974 6520 6b65 792c 2065 6974 6865  osite key, eithe
-00013240: 7220 6173 2061 2073 7472 696e 6720 6f72  r as a string or
-00013250: 2061 7320 6120 6c69 7374 0d0a 0d0a 2020   as a list....  
-00013260: 2020 2020 2020 6b65 7920 3d20 7365 6c66        key = self
-00013270: 2e5f 6e6f 726d 616c 6973 655f 6b65 7928  ._normalise_key(
-00013280: 6b65 7929 0d0a 0d0a 2020 2020 2020 2020  key)....        
-00013290: 2361 7373 756d 6520 7765 2063 616e 2069  #assume we can i
-000132a0: 7465 7261 7465 206f 7665 7220 7468 6520  terate over the 
-000132b0: 6b65 7920 7061 7373 6564 2069 6e20 6f72  key passed in or
-000132c0: 2074 6865 206b 6579 2063 7265 6174 6564   the key created
-000132d0: 2066 726f 6d20 7468 6520 7374 7269 6e67   from the string
-000132e0: 0d0a 2020 2020 2020 2020 2364 6573 6365  ..        #desce
-000132f0: 6e64 2074 6865 2068 6965 7261 7263 6879  nd the hierarchy
-00013300: 2075 6e74 696c 2077 6520 6669 6e64 2074   until we find t
-00013310: 6865 2065 6c65 6d65 6e74 0d0a 2020 2020  he element..    
-00013320: 2020 2020 6869 6572 6172 6368 7920 3d20      hierarchy = 
-00013330: 7365 6c66 2e5f 7374 7275 6374 7572 652e  self._structure.
-00013340: 6869 6572 6172 6368 6965 735b 6b65 795b  hierarchies[key[
-00013350: 305d 5d0d 0a0d 0a20 2020 2020 2020 2069  0]]....        i
-00013360: 6620 6c65 6e28 6b65 7929 203e 2031 3a0d  f len(key) > 1:.
-00013370: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00013380: 7572 6e20 6869 6572 6172 6368 792e 6465  urn hierarchy.de
-00013390: 7363 656e 6461 6e74 735b 6b65 795b 313a  scendants[key[1:
-000133a0: 5d5d 0d0a 2020 2020 2020 2020 656c 7365  ]]..        else
-000133b0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-000133c0: 6574 7572 6e20 6869 6572 6172 6368 790d  eturn hierarchy.
-000133d0: 0a0d 0a20 2020 2064 6566 205f 5f73 6574  ...    def __set
-000133e0: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
-000133f0: 2c20 6974 656d 293a 0d0a 2020 2020 2020  , item):..      
-00013400: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-00013410: 6e63 6528 6974 656d 2c53 7472 7563 7475  nce(item,Structu
-00013420: 7265 456c 656d 656e 7429 0d0a 0d0a 2020  reElement)....  
-00013430: 2020 2020 2020 6b65 7920 3d20 7365 6c66        key = self
-00013440: 2e5f 6e6f 726d 616c 6973 655f 6b65 7928  ._normalise_key(
-00013450: 6b65 7929 0d0a 0d0a 2020 2020 2020 2020  key)....        
-00013460: 6c6f 6f6b 6564 5f75 705f 6974 656d 203d  looked_up_item =
-00013470: 2073 656c 665b 6b65 795d 0d0a 0d0a 2020   self[key]....  
-00013480: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00013490: 6e63 6528 6c6f 6f6b 6564 5f75 705f 6974  nce(looked_up_it
-000134a0: 656d 2c20 5374 7275 6374 7572 6529 3a0d  em, Structure):.
-000134b0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000134c0: 7365 2056 616c 7565 4572 726f 7228 2743  se ValueError('C
-000134d0: 616e 6e6f 7420 7365 7420 6120 7374 7275  annot set a stru
-000134e0: 6374 7572 6520 7573 696e 6720 2e64 6573  cture using .des
-000134f0: 6365 6e64 616e 7473 2729 0d0a 2020 2020  cendants')..    
-00013500: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00013510: 6e63 6528 6c6f 6f6b 6564 5f75 705f 6974  nce(looked_up_it
-00013520: 656d 2c20 5374 7275 6374 7572 6545 6c65  em, StructureEle
-00013530: 6d65 6e74 293a 0d0a 2020 2020 2020 2020  ment):..        
-00013540: 2020 2020 2343 6865 636b 2069 6620 7765      #Check if we
-00013550: 2061 7265 2073 6574 7469 6e67 2061 2068   are setting a h
-00013560: 6965 7261 7263 6879 2028 726f 6f74 2073  ierarchy (root s
-00013570: 7472 7563 7475 7265 2065 6c65 6d65 6e74  tructure element
-00013580: 2920 6f72 2066 7572 7468 6572 2064 6f77  ) or further dow
-00013590: 6e0d 0a20 2020 2020 2020 2020 2020 2069  n..            i
-000135a0: 6620 6c65 6e28 6b65 7929 3d3d 323a 0d0a  f len(key)==2:..
-000135b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135c0: 2353 6574 2074 6865 2068 6965 7261 7263  #Set the hierarc
-000135d0: 6879 2074 6f20 7468 6520 636f 7272 6563  hy to the correc
-000135e0: 7420 6974 656d 0d0a 2020 2020 2020 2020  t item..        
-000135f0: 2020 2020 2020 2020 7365 6c66 2e5f 7374          self._st
-00013600: 7275 6374 7572 652e 6869 6572 6172 6368  ructure.hierarch
-00013610: 6965 735b 6c6f 6f6b 6564 5f75 705f 6974  ies[looked_up_it
-00013620: 656d 2e73 686f 7274 636f 6465 5d20 3d20  em.shortcode] = 
-00013630: 6974 656d 0d0a 2020 2020 2020 2020 2020  item..          
-00013640: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00013650: 2020 2020 2020 2020 206c 6f6f 6b65 645f           looked_
-00013660: 7570 5f69 7465 6d2e 7061 7265 6e74 2e63  up_item.parent.c
-00013670: 6869 6c64 7265 6e5b 6c6f 6f6b 6564 5f75  hildren[looked_u
-00013680: 705f 6974 656d 2e73 686f 7274 636f 6465  p_item.shortcode
-00013690: 5d20 3d20 6974 656d 0d0a 0d0a 2020 2020  ] = item....    
-000136a0: 2364 6566 2061 7070 656e 6428 7365 6c66  #def append(self
-000136b0: 2c20 6974 656d 293a 0d0a 2020 2020 2320  , item):..    # 
-000136c0: 2020 2073 656c 662e 5f73 7472 7563 7475     self._structu
-000136d0: 7265 2e68 6965 7261 7263 6869 6573 2869  re.hierarchies(i
-000136e0: 7465 6d29 0d0a 0d0a 2020 2020 234a 4154  tem)....    #JAT
-000136f0: 2032 3031 382d 3038 2d31 303a 204e 6f74   2018-08-10: Not
-00013700: 2072 6561 6c6c 7920 7375 7265 2068 6f77   really sure how
-00013710: 2074 6869 7320 776f 756c 6420 6265 2063   this would be c
-00013720: 6f64 6564 202d 206d 6179 6265 2062 7920  oded - maybe by 
-00013730: 7265 7475 726e 696e 6720 616e 6365 7374  returning ancest
-00013740: 6f72 7320 7768 696c 6520 7761 6c6b 696e  ors while walkin
-00013750: 670d 0a20 2020 2023 6465 6620 6b65 7973  g..    #def keys
-00013760: 2873 656c 6629 3a0d 0a20 2020 2023 2020  (self):..    #  
-00013770: 2020 2369 6620 6e6f 7420 7365 6c66 2e64    #if not self.d
-00013780: 696d 656e 7369 6f6e 2e5f 656c 656d 656e  imension._elemen
-00013790: 7473 5f72 6561 643a 0d0a 2020 2020 2320  ts_read:..    # 
-000137a0: 2020 2023 2020 2020 7365 6c66 2e5f 6c6f     #    self._lo
-000137b0: 6164 5f65 6c65 6d65 6e74 7328 290d 0a20  ad_elements().. 
-000137c0: 2020 2023 0d0a 2020 2020 2320 2020 2072     #..    #    r
-000137d0: 6574 7572 6e20 7365 6c66 2e5f 7374 7275  eturn self._stru
-000137e0: 6374 7572 655f 656c 656d 656e 742e 5f63  cture_element._c
-000137f0: 6869 6c64 5f73 7472 7563 7475 7265 5f65  hild_structure_e
-00013800: 6c65 6d65 6e74 732e 6b65 7973 2829 0d0a  lements.keys()..
-00013810: 2020 2020 230d 0a20 2020 2023 6465 6620      #..    #def 
-00013820: 6974 656d 7328 7365 6c66 293a 0d0a 2020  items(self):..  
-00013830: 2020 2320 2020 2023 6966 206e 6f74 2073    #    #if not s
-00013840: 656c 662e 6469 6d65 6e73 696f 6e2e 5f65  elf.dimension._e
-00013850: 6c65 6d65 6e74 735f 7265 6164 3a0d 0a20  lements_read:.. 
-00013860: 2020 2023 2020 2020 2320 2020 2073 656c     #    #    sel
-00013870: 662e 5f6c 6f61 645f 656c 656d 656e 7473  f._load_elements
-00013880: 2829 0d0a 2020 2020 230d 0a20 2020 2023  ()..    #..    #
-00013890: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000138a0: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
-000138b0: 6e74 2e5f 6368 696c 645f 7374 7275 6374  nt._child_struct
-000138c0: 7572 655f 656c 656d 656e 7473 2e69 7465  ure_elements.ite
-000138d0: 6d73 2829 0d0a 0d0a 2020 2020 2349 5320  ms()....    #IS 
-000138e0: 7468 6973 2072 6967 6874 3f20 6172 6520  this right? are 
-000138f0: 7765 2072 6561 6c6c 7920 7761 6c6b 696e  we really walkin
-00013900: 673f 0d0a 2020 2020 6465 6620 7661 6c75  g?..    def valu
-00013910: 6573 2873 656c 6629 3a0d 0a0d 0a20 2020  es(self):....   
-00013920: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00013930: 2e5f 7374 7275 6374 7572 652e 7761 6c6b  ._structure.walk
-00013940: 2829 0d0a 0d0a 2020 2020 2364 6566 205f  ()....    #def _
-00013950: 5f6c 656e 5f5f 2873 656c 6629 3a0d 0a20  _len__(self):.. 
-00013960: 2020 2023 2020 2020 2369 6620 6e6f 7420     #    #if not 
-00013970: 7365 6c66 2e64 696d 656e 7369 6f6e 2e5f  self.dimension._
-00013980: 656c 656d 656e 7473 5f72 6561 643a 0d0a  elements_read:..
-00013990: 2020 2020 2320 2020 2023 2020 2020 7365      #    #    se
-000139a0: 6c66 2e5f 6c6f 6164 5f65 6c65 6d65 6e74  lf._load_element
-000139b0: 7328 290d 0a20 2020 2023 0d0a 2020 2020  s()..    #..    
-000139c0: 2320 2020 2072 6574 7572 6e20 6c65 6e28  #    return len(
-000139d0: 7365 6c66 2e5f 7374 7275 6374 7572 655f  self._structure_
-000139e0: 656c 656d 656e 742e 5f63 6869 6c64 5f73  element._child_s
-000139f0: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00013a00: 7329 0d0a 0d0a 2020 2020 2364 6566 205f  s)....    #def _
-00013a10: 5f73 7472 5f5f 2873 656c 6629 3a0d 0a20  _str__(self):.. 
-00013a20: 2020 2023 2020 2020 7265 7475 726e 2073     #    return s
-00013a30: 7472 2873 656c 662e 5f73 7472 7563 7475  tr(self._structu
-00013a40: 7265 5f65 6c65 6d65 6e74 2e5f 6368 696c  re_element._chil
-00013a50: 645f 7374 7275 6374 7572 655f 656c 656d  d_structure_elem
-00013a60: 656e 7473 290d 0a0d 0a20 2020 2064 6566  ents)....    def
-00013a70: 2063 6c65 6172 2873 656c 6629 3a0d 0a20   clear(self):.. 
-00013a80: 2020 2020 2020 2073 656c 662e 5f73 7472         self._str
-00013a90: 7563 7475 7265 2e68 6965 7261 7263 6869  ucture.hierarchi
-00013aa0: 6573 2e63 6c65 6172 2829 0d0a 0d0a 636c  es.clear()....cl
-00013ab0: 6173 7320 5f45 6c65 6d65 6e74 7347 6574  ass _ElementsGet
-00013ac0: 7465 7228 6f62 6a65 6374 293a 0d0a 2020  ter(object):..  
-00013ad0: 2020 2727 2744 6f65 7320 6120 6269 7420    '''Does a bit 
-00013ae0: 6f66 206d 6167 6963 2074 6f20 616c 6c6f  of magic to allo
-00013af0: 7720 4469 6d65 6e73 696f 6e73 2074 6f20  w Dimensions to 
-00013b00: 6861 7665 2061 2065 6c65 6d65 6e74 7320  have a elements 
-00013b10: 6f62 6a65 6374 2077 6869 6368 2062 6568  object which beh
-00013b20: 6176 6573 206c 696b 6520 6120 6c61 7a79  aves like a lazy
-00013b30: 206c 6f61 6469 6e67 2064 6963 7469 6f6e   loading diction
-00013b40: 6172 7927 2727 0d0a 2020 2020 6465 6620  ary'''..    def 
-00013b50: 5f5f 696e 6974 5f5f 2873 656c 662c 6469  __init__(self,di
-00013b60: 6d65 6e73 696f 6e2c 2065 6d70 6f77 6572  mension, empower
-00013b70: 5f69 6d70 6f72 7465 725f 6578 6563 7574  _importer_execut
-00013b80: 6162 6c65 3d6c 6c75 2e45 4d50 4f57 4552  able=llu.EMPOWER
-00013b90: 5f49 4d50 4f52 5445 525f 4558 4543 5554  _IMPORTER_EXECUT
-00013ba0: 4142 4c45 293a 0d0a 2020 2020 2020 2020  ABLE):..        
-00013bb0: 7365 6c66 2e64 696d 656e 7369 6f6e 3d64  self.dimension=d
-00013bc0: 696d 656e 7369 6f6e 0d0a 2020 2020 2020  imension..      
-00013bd0: 2020 7365 6c66 2e65 6d70 6f77 6572 5f69    self.empower_i
-00013be0: 6d70 6f72 7465 725f 6578 6563 7574 6162  mporter_executab
-00013bf0: 6c65 203d 2065 6d70 6f77 6572 5f69 6d70  le = empower_imp
-00013c00: 6f72 7465 725f 6578 6563 7574 6162 6c65  orter_executable
-00013c10: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00013c20: 656c 656d 656e 7473 3d7b 7d0d 0a20 2020  elements={}..   
-00013c30: 2020 2020 2073 656c 662e 5f65 6c65 6d65       self._eleme
-00013c40: 6e74 735f 7769 7468 6f75 745f 7368 6f72  nts_without_shor
-00013c50: 746e 616d 6573 203d 205b 5d0d 0a0d 0a20  tnames = [].... 
-00013c60: 2020 2020 2020 2073 656c 662e 5f5f 656c         self.__el
-00013c70: 656d 656e 7473 5f72 6561 6420 3d20 4661  ements_read = Fa
-00013c80: 6c73 650d 0a20 2020 2020 2020 2073 656c  lse..        sel
-00013c90: 662e 5f5f 656c 656d 656e 7473 5f73 796e  f.__elements_syn
-00013ca0: 6365 6420 3d20 5472 7565 0d0a 2020 2020  ced = True..    
-00013cb0: 2020 2020 7365 6c66 2e5f 5f65 6c65 6d65      self.__eleme
-00013cc0: 6e74 5f64 6174 6166 7261 6d65 203d 204e  nt_dataframe = N
-00013cd0: 6f6e 650d 0a0d 0a20 2020 2020 2020 2073  one....        s
-00013ce0: 656c 662e 5f5f 7365 6375 7269 7479 5f65  elf.__security_e
-00013cf0: 6469 7465 6420 3d20 4661 6c73 650d 0a20  dited = False.. 
-00013d00: 2020 2020 2020 2073 656c 662e 5f73 6563         self._sec
-00013d10: 7572 6974 795f 7265 6164 203d 2046 616c  urity_read = Fal
-00013d20: 7365 0d0a 0d0a 2020 2020 2353 6574 2074  se....    #Set t
-00013d30: 6865 7365 2061 7320 7072 6f70 6572 7469  hese as properti
-00013d40: 6573 2066 6f72 2064 6562 7567 6769 6e67  es for debugging
-00013d50: 202d 2077 6865 6e20 616c 6c20 6973 2077   - when all is w
-00013d60: 6f72 6b69 6e67 206d 616b 6520 7468 656d  orking make them
-00013d70: 206e 6f72 6d61 6c20 6174 7472 6962 7574   normal attribut
-00013d80: 6573 2061 6761 696e 0d0a 2020 2020 4070  es again..    @p
-00013d90: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-00013da0: 205f 656c 656d 656e 7473 5f72 6561 6428   _elements_read(
-00013db0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00013dc0: 7265 7475 726e 2073 656c 662e 5f5f 656c  return self.__el
-00013dd0: 656d 656e 7473 5f72 6561 640d 0a0d 0a20  ements_read.... 
-00013de0: 2020 2040 5f65 6c65 6d65 6e74 735f 7265     @_elements_re
-00013df0: 6164 2e73 6574 7465 720d 0a20 2020 2064  ad.setter..    d
-00013e00: 6566 205f 656c 656d 656e 7473 5f72 6561  ef _elements_rea
-00013e10: 6428 7365 6c66 2c76 616c 293a 0d0a 2020  d(self,val):..  
-00013e20: 2020 2020 2020 236c 6f67 2e77 6172 6e69        #log.warni
-00013e30: 6e67 2827 5f65 6c65 6d65 6e74 735f 7265  ng('_elements_re
-00013e40: 6164 2073 6574 2074 6f20 7b7d 272e 666f  ad set to {}'.fo
-00013e50: 726d 6174 2876 616c 2929 0d0a 2020 2020  rmat(val))..    
-00013e60: 2020 2020 7365 6c66 2e5f 5f65 6c65 6d65      self.__eleme
-00013e70: 6e74 735f 7265 6164 203d 2076 616c 0d0a  nts_read = val..
-00013e80: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-00013e90: 0a20 2020 2064 6566 205f 7365 6375 7269  .    def _securi
-00013ea0: 7479 5f65 6469 7465 6428 7365 6c66 293a  ty_edited(self):
-00013eb0: 0d0a 2020 2020 2020 2020 2370 7269 6e74  ..        #print
-00013ec0: 2827 3137 3339 3a20 272c 7365 6c66 2e5f  ('1739: ',self._
-00013ed0: 5f73 6563 7572 6974 795f 6564 6974 6564  _security_edited
-00013ee0: 2029 0d0a 2020 2020 2020 2020 7265 7475   )..        retu
-00013ef0: 726e 2073 656c 662e 5f5f 7365 6375 7269  rn self.__securi
-00013f00: 7479 5f65 6469 7465 640d 0a0d 0a20 2020  ty_edited....   
-00013f10: 2040 5f73 6563 7572 6974 795f 6564 6974   @_security_edit
-00013f20: 6564 2e73 6574 7465 720d 0a20 2020 2064  ed.setter..    d
-00013f30: 6566 205f 7365 6375 7269 7479 5f65 6469  ef _security_edi
-00013f40: 7465 6428 7365 6c66 2c76 616c 293a 0d0a  ted(self,val):..
-00013f50: 2020 2020 2020 2020 236c 6f67 2e77 6172          #log.war
-00013f60: 6e69 6e67 2827 5f65 6c65 6d65 6e74 735f  ning('_elements_
-00013f70: 7265 6164 2073 6574 2074 6f20 7b7d 272e  read set to {}'.
-00013f80: 666f 726d 6174 2876 616c 2929 0d0a 2020  format(val))..  
-00013f90: 2020 2020 2020 7365 6c66 2e5f 5f73 6563        self.__sec
-00013fa0: 7572 6974 795f 6564 6974 6564 203d 2076  urity_edited = v
-00013fb0: 616c 0d0a 2020 2020 2020 2020 2370 7269  al..        #pri
-00013fc0: 6e74 2827 3838 353a 2027 2c73 656c 662e  nt('885: ',self.
-00013fd0: 5f5f 7365 6375 7269 7479 5f65 6469 7465  __security_edite
-00013fe0: 6420 290d 0a0d 0a20 2020 2040 7072 6f70  d )....    @prop
-00013ff0: 6572 7479 0d0a 2020 2020 6465 6620 5f65  erty..    def _e
-00014000: 6c65 6d65 6e74 735f 7379 6e63 6564 2873  lements_synced(s
-00014010: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
-00014020: 6574 7572 6e20 7365 6c66 2e5f 5f65 6c65  eturn self.__ele
-00014030: 6d65 6e74 735f 7379 6e63 6564 0d0a 0d0a  ments_synced....
-00014040: 2020 2020 405f 656c 656d 656e 7473 5f73      @_elements_s
-00014050: 796e 6365 642e 7365 7474 6572 0d0a 2020  ynced.setter..  
-00014060: 2020 6465 6620 5f65 6c65 6d65 6e74 735f    def _elements_
-00014070: 7379 6e63 6564 2873 656c 662c 7661 6c29  synced(self,val)
-00014080: 3a0d 0a20 2020 2020 2020 2023 6c6f 672e  :..        #log.
-00014090: 7761 726e 696e 6728 275f 656c 656d 656e  warning('_elemen
-000140a0: 7473 5f73 796e 6365 6420 7365 7420 746f  ts_synced set to
-000140b0: 207b 7d27 2e66 6f72 6d61 7428 7661 6c29   {}'.format(val)
-000140c0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-000140d0: 5f5f 656c 656d 656e 7473 5f73 796e 6365  __elements_synce
-000140e0: 6420 3d20 7661 6c0d 0a0d 0a20 2020 2040  d = val....    @
-000140f0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-00014100: 6620 5f65 6c65 6d65 6e74 5f64 6174 6166  f _element_dataf
-00014110: 7261 6d65 2873 656c 6629 3a0d 0a20 2020  rame(self):..   
-00014120: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00014130: 2e5f 5f65 6c65 6d65 6e74 5f64 6174 6166  .__element_dataf
-00014140: 7261 6d65 0d0a 0d0a 2020 2020 405f 656c  rame....    @_el
-00014150: 656d 656e 745f 6461 7461 6672 616d 652e  ement_dataframe.
-00014160: 7365 7474 6572 0d0a 2020 2020 6465 6620  setter..    def 
-00014170: 5f65 6c65 6d65 6e74 5f64 6174 6166 7261  _element_datafra
-00014180: 6d65 2873 656c 662c 7661 6c29 3a0d 0a20  me(self,val):.. 
-00014190: 2020 2020 2020 2023 6966 2076 616c 2069         #if val i
-000141a0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-000141b0: 2023 2020 2020 236c 6f67 2e77 6172 6e69   #    #log.warni
-000141c0: 6e67 2827 5f65 6c65 6d65 6e74 5f64 6174  ng('_element_dat
-000141d0: 6166 7261 6d65 2073 6574 2074 6f20 4e6f  aframe set to No
-000141e0: 6e65 2729 0d0a 2020 2020 2020 2020 2320  ne')..        # 
-000141f0: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
-00014200: 2023 656c 7365 3a0d 0a20 2020 2020 2020   #else:..       
-00014210: 2023 2020 2020 236c 6f67 2e77 6172 6e69   #    #log.warni
-00014220: 6e67 2827 5f65 6c65 6d65 6e74 5f64 6174  ng('_element_dat
-00014230: 6166 7261 6d65 2073 6574 2729 0d0a 2020  aframe set')..  
-00014240: 2020 2020 2020 7365 6c66 2e5f 5f65 6c65        self.__ele
-00014250: 6d65 6e74 5f64 6174 6166 7261 6d65 203d  ment_dataframe =
-00014260: 2076 616c 0d0a 0d0a 2020 2020 6465 6620   val....    def 
-00014270: 5f5f 6465 6c69 7465 6d5f 5f28 7365 6c66  __delitem__(self
-00014280: 2c69 7465 6d29 3a0d 0a20 2020 2020 2020  ,item):..       
-00014290: 2023 4c6f 6164 2074 6865 2045 6c65 6d65   #Load the Eleme
-000142a0: 6e74 7320 6966 2077 6520 6861 7665 6e27  nts if we haven'
-000142b0: 7420 616c 7265 6164 790d 0a20 2020 2020  t already..     
-000142c0: 2020 2069 6620 6e6f 7420 7365 6c66 2e5f     if not self._
-000142d0: 656c 656d 656e 7473 5f72 6561 643a 0d0a  elements_read:..
-000142e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000142f0: 2e5f 6c6f 6164 5f65 6c65 6d65 6e74 7328  ._load_elements(
-00014300: 290d 0a0d 0a20 2020 2020 2020 2064 656c  )....        del
-00014310: 2073 656c 662e 5f65 6c65 6d65 6e74 735b   self._elements[
-00014320: 6974 656d 5d0d 0a0d 0a20 2020 2023 556e  item]....    #Un
-00014330: 6c69 6b65 2061 2073 7461 6e64 6172 6420  like a standard 
-00014340: 6469 6374 696f 6e61 7279 2077 6869 6368  dictionary which
-00014350: 2072 6574 7572 6e73 206b 6579 7320 696e   returns keys in
-00014360: 2069 7465 722c 2072 6574 7572 6e20 7661   iter, return va
-00014370: 6c75 6573 2028 7369 6e63 6520 7468 6174  lues (since that
-00014380: 2773 2077 6861 7420 7765 2075 7375 616c  's what we usual
-00014390: 6c79 2077 616e 7429 0d0a 2020 2020 6465  ly want)..    de
-000143a0: 6620 5f5f 6974 6572 5f5f 2873 656c 6629  f __iter__(self)
-000143b0: 3a0d 0a20 2020 2020 2020 2023 4a41 5420  :..        #JAT 
-000143c0: 3230 3139 2d30 332d 3130 2050 594d 2d34  2019-03-10 PYM-4
-000143d0: 322c 2063 6861 6e67 6564 2074 6f20 6765  2, changed to ge
-000143e0: 7420 7468 6520 6465 6661 756c 7420 6974  t the default it
-000143f0: 6572 6174 6f72 2074 6f20 646f 2074 6865  erator to do the
-00014400: 206c 617a 7920 6c6f 6164 2066 726f 6d20   lazy load from 
-00014410: 456d 706f 7765 7220 6265 666f 7265 2072  Empower before r
-00014420: 6574 7572 6e69 6e67 2073 656c 660d 0a20  eturning self.. 
-00014430: 2020 2020 2020 2073 656c 662e 5f69 7465         self._ite
-00014440: 7261 746f 7220 3d20 6974 6572 2873 656c  rator = iter(sel
-00014450: 662e 7661 6c75 6573 2829 290d 0a20 2020  f.values())..   
-00014460: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00014470: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6e65  ....    def __ne
-00014480: 7874 5f5f 2873 656c 6629 3a0d 0a20 2020  xt__(self):..   
-00014490: 2020 2020 2072 6574 7572 6e20 6e65 7874       return next
-000144a0: 2873 656c 662e 5f69 7465 7261 746f 7229  (self._iterator)
-000144b0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6765  ....    def __ge
-000144c0: 7469 7465 6d5f 5f28 7365 6c66 2c69 7465  titem__(self,ite
-000144d0: 6d29 3a0d 0a20 2020 2020 2020 2023 4c6f  m):..        #Lo
-000144e0: 6164 2074 6865 2045 6c65 6d65 6e74 7320  ad the Elements 
-000144f0: 6966 2077 6520 6861 7665 6e27 7420 616c  if we haven't al
-00014500: 7265 6164 790d 0a20 2020 2020 2020 2069  ready..        i
-00014510: 6620 6e6f 7420 7365 6c66 2e5f 656c 656d  f not self._elem
-00014520: 656e 7473 5f72 6561 643a 0d0a 2020 2020  ents_read:..    
-00014530: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-00014540: 6164 5f65 6c65 6d65 6e74 7328 6465 6275  ad_elements(debu
-00014550: 673d 7365 6c66 2e64 696d 656e 7369 6f6e  g=self.dimension
-00014560: 2e73 6974 652e 5f64 6562 7567 290d 0a0d  .site._debug)...
-00014570: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00014580: 7365 6c66 2e5f 656c 656d 656e 7473 5b69  self._elements[i
-00014590: 7465 6d5d 0d0a 0d0a 2020 2020 6465 6620  tem]....    def 
-000145a0: 5f5f 7365 7469 7465 6d5f 5f28 7365 6c66  __setitem__(self
-000145b0: 2c20 6b65 792c 2069 7465 6d29 3a0d 0a20  , key, item):.. 
-000145c0: 2020 2020 2020 2023 2044 6f65 7320 7468         # Does th
-000145d0: 6520 5b5d 2073 6574 206f 7665 726c 6f61  e [] set overloa
-000145e0: 6469 6e67 0d0a 2020 2020 2020 2020 0d0a  ding..        ..
-000145f0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00014600: 656c 662e 5f65 6c65 6d65 6e74 735f 7265  elf._elements_re
-00014610: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
-00014620: 2073 656c 662e 5f6c 6f61 645f 656c 656d   self._load_elem
-00014630: 656e 7473 2864 6562 7567 3d73 656c 662e  ents(debug=self.
-00014640: 6469 6d65 6e73 696f 6e2e 7369 7465 2e5f  dimension.site._
-00014650: 6465 6275 6729 0d0a 0d0a 2020 2020 2020  debug)....      
-00014660: 2020 2341 6464 696e 6720 616e 2065 6c65    #Adding an ele
-00014670: 6d65 6e74 206e 756c 6c69 6669 6573 2074  ment nullifies t
-00014680: 6865 2064 6174 6166 7261 6d65 0d0a 2020  he dataframe..  
-00014690: 2020 2020 2020 7365 6c66 2e5f 656c 656d        self._elem
-000146a0: 656e 745f 6461 7461 6672 616d 6520 3d20  ent_dataframe = 
-000146b0: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
-000146c0: 2320 466c 6167 2074 6861 7420 6564 6974  # Flag that edit
-000146d0: 7320 6861 7665 2062 6565 6e20 6d61 6465  s have been made
-000146e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-000146f0: 656c 656d 656e 7473 5f73 796e 6365 6420  elements_synced 
-00014700: 3d20 4661 6c73 650d 0a0d 0a20 2020 2020  = False....     
-00014710: 2020 2069 6620 6b65 7920 6973 204e 6f6e     if key is Non
-00014720: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00014730: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00014740: 2827 2e65 6c65 6d65 6e74 735b 5d20 6361  ('.elements[] ca
-00014750: 6e20 6e6f 7420 6861 7665 2061 6e20 6974  n not have an it
-00014760: 656d 2061 6464 6564 2077 6974 6820 6120  em added with a 
-00014770: 4e6f 6e65 206b 6579 2729 0d0a 2020 2020  None key')..    
-00014780: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00014790: 2020 2020 2020 2073 656c 662e 5f65 6c65         self._ele
-000147a0: 6d65 6e74 735b 6b65 795d 2020 203d 2069  ments[key]   = i
-000147b0: 7465 6d0d 0a0d 0a20 2020 2020 2020 2023  tem....        #
-000147c0: 4164 6420 7468 6520 6974 656d 2074 6f20  Add the item to 
-000147d0: 7468 6520 5f65 6c65 6d65 6e74 7320 6461  the _elements da
-000147e0: 7461 6672 616d 6520 6966 2069 7420 6578  taframe if it ex
-000147f0: 6973 7473 0d0a 0d0a 2020 2020 6465 6620  ists....    def 
-00014800: 5f5f 696f 725f 5f28 7365 6c66 2c69 7465  __ior__(self,ite
-00014810: 6d29 3a0d 0a20 2020 2020 2020 2027 2727  m):..        '''
-00014820: 4465 6669 6e65 2073 796e 7461 7820 666f  Define syntax fo
-00014830: 7220 7c3d 2069 2e65 2e20 6164 6420 6966  r |= i.e. add if
-00014840: 2064 6f65 736e 2774 2061 6c72 6561 6479   doesn't already
-00014850: 2065 7869 7374 202d 206f 7468 6572 7769   exist - otherwi
-00014860: 7365 2069 676e 6f72 6527 2727 0d0a 2020  se ignore'''..  
-00014870: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00014880: 6e63 6528 6974 656d 2c45 6c65 6d65 6e74  nce(item,Element
-00014890: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000148a0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-000148b0: 2020 2020 2020 7365 6c66 5b69 7465 6d2e        self[item.
-000148c0: 7368 6f72 746e 616d 655d 0d0a 2020 2020  shortname]..    
-000148d0: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-000148e0: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
-000148f0: 2020 2020 2020 2020 2020 7365 6c66 2e61            self.a
-00014900: 7070 656e 6428 6974 656d 290d 0a20 2020  ppend(item)..   
-00014910: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00014920: 616e 6365 2869 7465 6d2c 7374 7229 3a0d  ance(item,str):.
-00014930: 0a20 2020 2020 2020 2020 2020 2023 4372  .            #Cr
-00014940: 6561 7465 2061 2073 7475 6220 616e 6420  eate a stub and 
-00014950: 6164 6420 6974 0d0a 2020 2020 2020 2020  add it..        
-00014960: 2020 2020 7365 6c66 207c 3d20 456c 656d      self |= Elem
-00014970: 656e 7428 6469 6d65 6e73 696f 6e3d 7365  ent(dimension=se
-00014980: 6c66 2e64 696d 656e 7369 6f6e 2c20 7368  lf.dimension, sh
-00014990: 6f72 746e 616d 6520 3d20 6974 656d 2c6c  ortname = item,l
-000149a0: 6f6e 676e 616d 653d 6974 656d 2e63 6170  ongname=item.cap
-000149b0: 6974 616c 697a 6528 292c 6465 7363 7269  italize(),descri
-000149c0: 7074 696f 6e3d 6974 656d 2e63 6170 6974  ption=item.capit
-000149d0: 616c 697a 6528 2929 0d0a 2020 2020 2020  alize())..      
-000149e0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-000149f0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00014a00: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00014a10: 2069 6e20 6974 656d 3a0d 0a20 2020 2020   in item:..     
-00014a20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00014a30: 656c 6620 7c3d 2069 0d0a 2020 2020 2020  elf |= i..      
-00014a40: 2020 2020 2020 6578 6365 7074 2054 7970        except Typ
-00014a50: 6545 7272 6f72 3a20 236e 6f6e 2069 7465  eError: #non ite
-00014a60: 7261 626c 6573 2077 696c 6c20 7261 6973  rables will rais
-00014a70: 6520 6120 5479 7065 4572 726f 720d 0a0d  e a TypeError...
-00014a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014a90: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00014aa0: 2020 2020 2020 2020 2020 2065 6c20 3d20             el = 
-00014ab0: 6974 656d 2e65 6c65 6d65 6e74 0d0a 2020  item.element..  
-00014ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ad0: 2020 7365 6c66 207c 3d20 656c 0d0a 2020    self |= el..  
-00014ae0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00014af0: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
-00014b00: 726f 723a 0d0a 0d0a 2020 2020 2020 2020  ror:....        
-00014b10: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00014b20: 6520 5661 6c75 6545 7272 6f72 2827 436f  e ValueError('Co
-00014b30: 756c 6420 6e6f 7420 636f 6d62 696e 6520  uld not combine 
-00014b40: 6f62 6a65 6374 7320 7b7d 2061 6e64 207b  objects {} and {
-00014b50: 7d20 7573 696e 6720 7c3d 2073 796e 7461  } using |= synta
-00014b60: 7827 2e66 6f72 6d61 7428 7265 7072 2873  x'.format(repr(s
-00014b70: 656c 6629 2c72 6570 7228 6974 656d 2929  elf),repr(item))
-00014b80: 290d 0a0d 0a20 2020 2020 2020 2072 6574  )....        ret
-00014b90: 7572 6e20 7365 6c66 0d0a 0d0a 2020 2020  urn self....    
-00014ba0: 6465 6620 5f5f 6961 6464 5f5f 2873 656c  def __iadd__(sel
-00014bb0: 662c 6974 656d 293a 0d0a 2020 2020 2020  f,item):..      
-00014bc0: 2020 2727 2744 6566 696e 6520 7379 6e74    '''Define synt
-00014bd0: 6178 2066 6f72 202b 3d20 692e 652e 2061  ax for += i.e. a
-00014be0: 6464 2069 6620 646f 6573 6e27 7420 616c  dd if doesn't al
-00014bf0: 7265 6164 7920 6578 6973 7420 2d20 6f74  ready exist - ot
-00014c00: 6865 7277 6973 6520 7261 6973 6520 5661  herwise raise Va
-00014c10: 6c75 6545 7272 6f72 2727 270d 0a20 2020  lueError'''..   
-00014c20: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-00014c30: 6365 2869 7465 6d2c 456c 656d 656e 7429  ce(item,Element)
-00014c40: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00014c50: 4f6e 6c79 2061 6464 2074 6865 2065 6c65  Only add the ele
-00014c60: 6d65 6e74 2069 6620 6974 2064 6965 736e  ment if it diesn
-00014c70: 2774 2061 6c72 6561 6479 2065 7869 7374  't already exist
-00014c80: 202d 2069 6620 6974 2064 6f65 732c 2072   - if it does, r
-00014c90: 6169 7365 2061 2076 616c 7565 2065 7272  aise a value err
-00014ca0: 6f72 0d0a 2020 2020 2020 2020 2020 2020  or..            
-00014cb0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-00014cc0: 2020 2020 2020 7365 6c66 5b69 7465 6d2e        self[item.
-00014cd0: 7368 6f72 746e 616d 655d 0d0a 2020 2020  shortname]..    
-00014ce0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00014cf0: 6520 5661 6c75 6545 7272 6f72 2827 4361  e ValueError('Ca
-00014d00: 6e6e 6f74 2061 6464 2069 7465 6d20 7b7d  nnot add item {}
-00014d10: 2074 6f20 2e65 6c65 6d65 6e74 7320 6265   to .elements be
-00014d20: 6361 7573 6520 616e 2069 7465 6d20 7769  cause an item wi
-00014d30: 7468 2074 6869 7320 7368 6f72 746e 616d  th this shortnam
-00014d40: 6520 616c 7265 6164 7920 6578 6973 7473  e already exists
-00014d50: 272e 666f 726d 6174 2872 6570 7228 6974  '.format(repr(it
-00014d60: 656d 2929 290d 0a20 2020 2020 2020 2020  em)))..         
-00014d70: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
-00014d80: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-00014d90: 2020 2020 2073 656c 662e 6170 7065 6e64       self.append
-00014da0: 2869 7465 6d29 0d0a 0d0a 2020 2020 2020  (item)....      
-00014db0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
-00014dc0: 6528 6974 656d 2c73 7472 293a 0d0a 2020  e(item,str):..  
-00014dd0: 2020 2020 2020 2020 2020 2343 7265 6174            #Creat
-00014de0: 6520 6120 7374 7562 2061 6e64 2061 6464  e a stub and add
-00014df0: 2069 740d 0a20 2020 2020 2020 2020 2020   it..           
-00014e00: 2073 656c 6620 2b3d 2045 6c65 6d65 6e74   self += Element
-00014e10: 2864 696d 656e 7369 6f6e 3d73 656c 662e  (dimension=self.
-00014e20: 6469 6d65 6e73 696f 6e2c 2073 686f 7274  dimension, short
-00014e30: 6e61 6d65 203d 2069 7465 6d2c 6c6f 6e67  name = item,long
-00014e40: 6e61 6d65 3d69 7465 6d2e 6361 7069 7461  name=item.capita
-00014e50: 6c69 7a65 2829 2c64 6573 6372 6970 7469  lize(),descripti
-00014e60: 6f6e 3d69 7465 6d2e 6361 7069 7461 6c69  on=item.capitali
-00014e70: 7a65 2829 290d 0a20 2020 2020 2020 2065  ze())..        e
-00014e80: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00014e90: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00014ea0: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00014eb0: 2069 7465 6d3a 0d0a 2020 2020 2020 2020   item:..        
-00014ec0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00014ed0: 202b 3d20 690d 0a20 2020 2020 2020 2020   += i..         
-00014ee0: 2020 2065 7863 6570 7420 5479 7065 4572     except TypeEr
-00014ef0: 726f 723a 2023 6e6f 6e20 6974 6572 6162  ror: #non iterab
-00014f00: 6c65 7320 7769 6c6c 2072 6169 7365 2061  les will raise a
-00014f10: 2054 7970 6545 7272 6f72 0d0a 0d0a 2020   TypeError....  
-00014f20: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00014f30: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00014f40: 2020 2020 2020 2020 656c 203d 2069 7465          el = ite
-00014f50: 6d2e 656c 656d 656e 740d 0a20 2020 2020  m.element..     
-00014f60: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00014f70: 656c 6620 2b3d 2065 6c0d 0a20 2020 2020  elf += el..     
-00014f80: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00014f90: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
-00014fa0: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
-00014fb0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00014fc0: 616c 7565 4572 726f 7228 2743 6f75 6c64  alueError('Could
-00014fd0: 206e 6f74 2063 6f6d 6269 6e65 206f 626a   not combine obj
-00014fe0: 6563 7473 207b 7d20 616e 6420 7b7d 2075  ects {} and {} u
-00014ff0: 7369 6e67 202b 3d20 7379 6e74 6178 272e  sing += syntax'.
-00015000: 666f 726d 6174 2872 6570 7228 7365 6c66  format(repr(self
-00015010: 292c 7265 7072 2869 7465 6d29 2929 0d0a  ),repr(item)))..
-00015020: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00015030: 2073 656c 660d 0a0d 0a20 2020 2064 6566   self....    def
-00015040: 2061 7070 656e 6428 7365 6c66 2c69 7465   append(self,ite
-00015050: 6d29 3a0d 0a20 2020 2020 2020 2061 7373  m):..        ass
-00015060: 6572 7420 6973 696e 7374 616e 6365 2869  ert isinstance(i
-00015070: 7465 6d2c 456c 656d 656e 7429 0d0a 2020  tem,Element)..  
-00015080: 2020 2020 2020 7365 6c66 5b69 7465 6d2e        self[item.
-00015090: 7368 6f72 746e 616d 655d 203d 2069 7465  shortname] = ite
-000150a0: 6d0d 0a0d 0a20 2020 2064 6566 205f 6c6f  m....    def _lo
-000150b0: 6164 5f65 6c65 6d65 6e74 7328 7365 6c66  ad_elements(self
-000150c0: 2c64 6562 7567 2020 2020 2020 2020 2020  ,debug          
-000150d0: 2020 2020 2020 2020 2020 2020 203d 2046               = F
-000150e0: 616c 7365 293a 0d0a 2020 2020 2020 2020  alse):..        
-000150f0: 6c6f 672e 7665 7262 6f73 6528 2752 6561  log.verbose('Rea
-00015100: 6469 6e67 2045 6c65 6d65 6e74 7320 666f  ding Elements fo
-00015110: 7220 6469 6d65 6e73 696f 6e20 272b 7374  r dimension '+st
-00015120: 7228 7365 6c66 2e64 696d 656e 7369 6f6e  r(self.dimension
-00015130: 2e69 6e64 6578 2929 0d0a 2020 2020 2020  .index))..      
-00015140: 2020 2353 6574 205f 656c 656d 656e 7473    #Set _elements
-00015150: 5f72 6561 6420 6e6f 772c 206f 7220 7765  _read now, or we
-00015160: 276c 6c20 656e 6420 7570 2069 6e20 6120  'll end up in a 
-00015170: 6c6f 6f70 0d0a 2020 2020 2020 2020 7365  loop..        se
-00015180: 6c66 2e5f 656c 656d 656e 7473 5f72 6561  lf._elements_rea
-00015190: 6420 3d20 5472 7565 0d0a 2020 2020 2020  d = True..      
-000151a0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-000151b0: 2020 2020 7365 6c66 2e5f 656c 656d 656e      self._elemen
-000151c0: 7473 203d 205f 6372 6561 7465 5f65 6d70  ts = _create_emp
-000151d0: 6f77 6572 5f64 696d 656e 7369 6f6e 5f73  ower_dimension_s
-000151e0: 686f 7274 6e61 6d65 5f65 6c65 6d65 6e74  hortname_element
-000151f0: 5f64 6963 7428 6469 6d65 6e73 696f 6e20  _dict(dimension 
-00015200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015210: 2020 3d20 7365 6c66 2e64 696d 656e 7369    = self.dimensi
-00015220: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
-00015230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013180: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00013190: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+000131a0: 2020 2020 2020 2020 2020 2020 2020 6b65                ke
+000131b0: 792e 6170 7065 6e64 286b 290d 0a20 2020  y.append(k)..   
+000131c0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000131d0: 2020 2020 2020 2020 7061 7373 0d0a 0d0a          pass....
+000131e0: 2020 2020 2020 2020 7265 7475 726e 206b          return k
+000131f0: 6579 0d0a 0d0a 2020 2020 6465 6620 5f5f  ey....    def __
+00013200: 6765 7469 7465 6d5f 5f28 7365 6c66 2c6b  getitem__(self,k
+00013210: 6579 293a 0d0a 2020 2020 2020 2020 2354  ey):..        #T
+00013220: 6865 2069 6d70 6f72 7461 6e74 2070 6172  he important par
+00013230: 7420 6f66 2064 6573 6365 6e64 616e 7473  t of descendants
+00013240: 2069 7320 7468 6174 2079 6f75 2063 616e   is that you can
+00013250: 2067 6976 6520 6120 636f 6d70 6f73 6974   give a composit
+00013260: 6520 6b65 792c 2065 6974 6865 7220 6173  e key, either as
+00013270: 2061 2073 7472 696e 6720 6f72 2061 7320   a string or as 
+00013280: 6120 6c69 7374 0d0a 0d0a 2020 2020 2020  a list....      
+00013290: 2020 6b65 7920 3d20 7365 6c66 2e5f 6e6f    key = self._no
+000132a0: 726d 616c 6973 655f 6b65 7928 6b65 7929  rmalise_key(key)
+000132b0: 0d0a 0d0a 2020 2020 2020 2020 2361 7373  ....        #ass
+000132c0: 756d 6520 7765 2063 616e 2069 7465 7261  ume we can itera
+000132d0: 7465 206f 7665 7220 7468 6520 6b65 7920  te over the key 
+000132e0: 7061 7373 6564 2069 6e20 6f72 2074 6865  passed in or the
+000132f0: 206b 6579 2063 7265 6174 6564 2066 726f   key created fro
+00013300: 6d20 7468 6520 7374 7269 6e67 0d0a 2020  m the string..  
+00013310: 2020 2020 2020 2364 6573 6365 6e64 2074        #descend t
+00013320: 6865 2068 6965 7261 7263 6879 2075 6e74  he hierarchy unt
+00013330: 696c 2077 6520 6669 6e64 2074 6865 2065  il we find the e
+00013340: 6c65 6d65 6e74 0d0a 2020 2020 2020 2020  lement..        
+00013350: 6869 6572 6172 6368 7920 3d20 7365 6c66  hierarchy = self
+00013360: 2e5f 7374 7275 6374 7572 652e 6869 6572  ._structure.hier
+00013370: 6172 6368 6965 735b 6b65 795b 305d 5d0d  archies[key[0]].
+00013380: 0a0d 0a20 2020 2020 2020 2069 6620 6c65  ...        if le
+00013390: 6e28 6b65 7929 203e 2031 3a0d 0a20 2020  n(key) > 1:..   
+000133a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000133b0: 6869 6572 6172 6368 792e 6465 7363 656e  hierarchy.descen
+000133c0: 6461 6e74 735b 6b65 795b 313a 5d5d 0d0a  dants[key[1:]]..
+000133d0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000133e0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000133f0: 6e20 6869 6572 6172 6368 790d 0a0d 0a20  n hierarchy.... 
+00013400: 2020 2064 6566 205f 5f73 6574 6974 656d     def __setitem
+00013410: 5f5f 2873 656c 662c 206b 6579 2c20 6974  __(self, key, it
+00013420: 656d 293a 0d0a 2020 2020 2020 2020 6173  em):..        as
+00013430: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
+00013440: 6974 656d 2c53 7472 7563 7475 7265 456c  item,StructureEl
+00013450: 656d 656e 7429 0d0a 0d0a 2020 2020 2020  ement)....      
+00013460: 2020 6b65 7920 3d20 7365 6c66 2e5f 6e6f    key = self._no
+00013470: 726d 616c 6973 655f 6b65 7928 6b65 7929  rmalise_key(key)
+00013480: 0d0a 0d0a 2020 2020 2020 2020 6c6f 6f6b  ....        look
+00013490: 6564 5f75 705f 6974 656d 203d 2073 656c  ed_up_item = sel
+000134a0: 665b 6b65 795d 0d0a 0d0a 2020 2020 2020  f[key]....      
+000134b0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000134c0: 6c6f 6f6b 6564 5f75 705f 6974 656d 2c20  looked_up_item, 
+000134d0: 5374 7275 6374 7572 6529 3a0d 0a20 2020  Structure):..   
+000134e0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000134f0: 616c 7565 4572 726f 7228 2743 616e 6e6f  alueError('Canno
+00013500: 7420 7365 7420 6120 7374 7275 6374 7572  t set a structur
+00013510: 6520 7573 696e 6720 2e64 6573 6365 6e64  e using .descend
+00013520: 616e 7473 2729 0d0a 2020 2020 2020 2020  ants')..        
+00013530: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00013540: 6c6f 6f6b 6564 5f75 705f 6974 656d 2c20  looked_up_item, 
+00013550: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+00013560: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00013570: 2343 6865 636b 2069 6620 7765 2061 7265  #Check if we are
+00013580: 2073 6574 7469 6e67 2061 2068 6965 7261   setting a hiera
+00013590: 7263 6879 2028 726f 6f74 2073 7472 7563  rchy (root struc
+000135a0: 7475 7265 2065 6c65 6d65 6e74 2920 6f72  ture element) or
+000135b0: 2066 7572 7468 6572 2064 6f77 6e0d 0a20   further down.. 
+000135c0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+000135d0: 6e28 6b65 7929 3d3d 323a 0d0a 2020 2020  n(key)==2:..    
+000135e0: 2020 2020 2020 2020 2020 2020 2353 6574              #Set
+000135f0: 2074 6865 2068 6965 7261 7263 6879 2074   the hierarchy t
+00013600: 6f20 7468 6520 636f 7272 6563 7420 6974  o the correct it
+00013610: 656d 0d0a 2020 2020 2020 2020 2020 2020  em..            
+00013620: 2020 2020 7365 6c66 2e5f 7374 7275 6374      self._struct
+00013630: 7572 652e 6869 6572 6172 6368 6965 735b  ure.hierarchies[
+00013640: 6c6f 6f6b 6564 5f75 705f 6974 656d 2e73  looked_up_item.s
+00013650: 686f 7274 636f 6465 5d20 3d20 6974 656d  hortcode] = item
+00013660: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00013670: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00013680: 2020 2020 206c 6f6f 6b65 645f 7570 5f69       looked_up_i
+00013690: 7465 6d2e 7061 7265 6e74 2e63 6869 6c64  tem.parent.child
+000136a0: 7265 6e5b 6c6f 6f6b 6564 5f75 705f 6974  ren[looked_up_it
+000136b0: 656d 2e73 686f 7274 636f 6465 5d20 3d20  em.shortcode] = 
+000136c0: 6974 656d 0d0a 0d0a 2020 2020 2364 6566  item....    #def
+000136d0: 2061 7070 656e 6428 7365 6c66 2c20 6974   append(self, it
+000136e0: 656d 293a 0d0a 2020 2020 2320 2020 2073  em):..    #    s
+000136f0: 656c 662e 5f73 7472 7563 7475 7265 2e68  elf._structure.h
+00013700: 6965 7261 7263 6869 6573 2869 7465 6d29  ierarchies(item)
+00013710: 0d0a 0d0a 2020 2020 234a 4154 2032 3031  ....    #JAT 201
+00013720: 382d 3038 2d31 303a 204e 6f74 2072 6561  8-08-10: Not rea
+00013730: 6c6c 7920 7375 7265 2068 6f77 2074 6869  lly sure how thi
+00013740: 7320 776f 756c 6420 6265 2063 6f64 6564  s would be coded
+00013750: 202d 206d 6179 6265 2062 7920 7265 7475   - maybe by retu
+00013760: 726e 696e 6720 616e 6365 7374 6f72 7320  rning ancestors 
+00013770: 7768 696c 6520 7761 6c6b 696e 670d 0a20  while walking.. 
+00013780: 2020 2023 6465 6620 6b65 7973 2873 656c     #def keys(sel
+00013790: 6629 3a0d 0a20 2020 2023 2020 2020 2369  f):..    #    #i
+000137a0: 6620 6e6f 7420 7365 6c66 2e64 696d 656e  f not self.dimen
+000137b0: 7369 6f6e 2e5f 656c 656d 656e 7473 5f72  sion._elements_r
+000137c0: 6561 643a 0d0a 2020 2020 2320 2020 2023  ead:..    #    #
+000137d0: 2020 2020 7365 6c66 2e5f 6c6f 6164 5f65      self._load_e
+000137e0: 6c65 6d65 6e74 7328 290d 0a20 2020 2023  lements()..    #
+000137f0: 0d0a 2020 2020 2320 2020 2072 6574 7572  ..    #    retur
+00013800: 6e20 7365 6c66 2e5f 7374 7275 6374 7572  n self._structur
+00013810: 655f 656c 656d 656e 742e 5f63 6869 6c64  e_element._child
+00013820: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00013830: 6e74 732e 6b65 7973 2829 0d0a 2020 2020  nts.keys()..    
+00013840: 230d 0a20 2020 2023 6465 6620 6974 656d  #..    #def item
+00013850: 7328 7365 6c66 293a 0d0a 2020 2020 2320  s(self):..    # 
+00013860: 2020 2023 6966 206e 6f74 2073 656c 662e     #if not self.
+00013870: 6469 6d65 6e73 696f 6e2e 5f65 6c65 6d65  dimension._eleme
+00013880: 6e74 735f 7265 6164 3a0d 0a20 2020 2023  nts_read:..    #
+00013890: 2020 2020 2320 2020 2073 656c 662e 5f6c      #    self._l
+000138a0: 6f61 645f 656c 656d 656e 7473 2829 0d0a  oad_elements()..
+000138b0: 2020 2020 230d 0a20 2020 2023 2020 2020      #..    #    
+000138c0: 7265 7475 726e 2073 656c 662e 5f73 7472  return self._str
+000138d0: 7563 7475 7265 5f65 6c65 6d65 6e74 2e5f  ucture_element._
+000138e0: 6368 696c 645f 7374 7275 6374 7572 655f  child_structure_
+000138f0: 656c 656d 656e 7473 2e69 7465 6d73 2829  elements.items()
+00013900: 0d0a 0d0a 2020 2020 2349 5320 7468 6973  ....    #IS this
+00013910: 2072 6967 6874 3f20 6172 6520 7765 2072   right? are we r
+00013920: 6561 6c6c 7920 7761 6c6b 696e 673f 0d0a  eally walking?..
+00013930: 2020 2020 6465 6620 7661 6c75 6573 2873      def values(s
+00013940: 656c 6629 3a0d 0a0d 0a20 2020 2020 2020  elf):....       
+00013950: 2072 6574 7572 6e20 7365 6c66 2e5f 7374   return self._st
+00013960: 7275 6374 7572 652e 7761 6c6b 2829 0d0a  ructure.walk()..
+00013970: 0d0a 2020 2020 2364 6566 205f 5f6c 656e  ..    #def __len
+00013980: 5f5f 2873 656c 6629 3a0d 0a20 2020 2023  __(self):..    #
+00013990: 2020 2020 2369 6620 6e6f 7420 7365 6c66      #if not self
+000139a0: 2e64 696d 656e 7369 6f6e 2e5f 656c 656d  .dimension._elem
+000139b0: 656e 7473 5f72 6561 643a 0d0a 2020 2020  ents_read:..    
+000139c0: 2320 2020 2023 2020 2020 7365 6c66 2e5f  #    #    self._
+000139d0: 6c6f 6164 5f65 6c65 6d65 6e74 7328 290d  load_elements().
+000139e0: 0a20 2020 2023 0d0a 2020 2020 2320 2020  .    #..    #   
+000139f0: 2072 6574 7572 6e20 6c65 6e28 7365 6c66   return len(self
+00013a00: 2e5f 7374 7275 6374 7572 655f 656c 656d  ._structure_elem
+00013a10: 656e 742e 5f63 6869 6c64 5f73 7472 7563  ent._child_struc
+00013a20: 7475 7265 5f65 6c65 6d65 6e74 7329 0d0a  ture_elements)..
+00013a30: 0d0a 2020 2020 2364 6566 205f 5f73 7472  ..    #def __str
+00013a40: 5f5f 2873 656c 6629 3a0d 0a20 2020 2023  __(self):..    #
+00013a50: 2020 2020 7265 7475 726e 2073 7472 2873      return str(s
+00013a60: 656c 662e 5f73 7472 7563 7475 7265 5f65  elf._structure_e
+00013a70: 6c65 6d65 6e74 2e5f 6368 696c 645f 7374  lement._child_st
+00013a80: 7275 6374 7572 655f 656c 656d 656e 7473  ructure_elements
+00013a90: 290d 0a0d 0a20 2020 2064 6566 2063 6c65  )....    def cle
+00013aa0: 6172 2873 656c 6629 3a0d 0a20 2020 2020  ar(self):..     
+00013ab0: 2020 2073 656c 662e 5f73 7472 7563 7475     self._structu
+00013ac0: 7265 2e68 6965 7261 7263 6869 6573 2e63  re.hierarchies.c
+00013ad0: 6c65 6172 2829 0d0a 0d0a 636c 6173 7320  lear()....class 
+00013ae0: 5f45 6c65 6d65 6e74 7347 6574 7465 7228  _ElementsGetter(
+00013af0: 6f62 6a65 6374 293a 0d0a 2020 2020 2727  object):..    ''
+00013b00: 2744 6f65 7320 6120 6269 7420 6f66 206d  'Does a bit of m
+00013b10: 6167 6963 2074 6f20 616c 6c6f 7720 4469  agic to allow Di
+00013b20: 6d65 6e73 696f 6e73 2074 6f20 6861 7665  mensions to have
+00013b30: 2061 2065 6c65 6d65 6e74 7320 6f62 6a65   a elements obje
+00013b40: 6374 2077 6869 6368 2062 6568 6176 6573  ct which behaves
+00013b50: 206c 696b 6520 6120 6c61 7a79 206c 6f61   like a lazy loa
+00013b60: 6469 6e67 2064 6963 7469 6f6e 6172 7927  ding dictionary'
+00013b70: 2727 0d0a 2020 2020 6465 6620 5f5f 696e  ''..    def __in
+00013b80: 6974 5f5f 2873 656c 662c 6469 6d65 6e73  it__(self,dimens
+00013b90: 696f 6e2c 2065 6d70 6f77 6572 5f69 6d70  ion, empower_imp
+00013ba0: 6f72 7465 725f 6578 6563 7574 6162 6c65  orter_executable
+00013bb0: 3d6c 6c75 2e45 4d50 4f57 4552 5f49 4d50  =llu.EMPOWER_IMP
+00013bc0: 4f52 5445 525f 4558 4543 5554 4142 4c45  ORTER_EXECUTABLE
+00013bd0: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+00013be0: 2e64 696d 656e 7369 6f6e 3d64 696d 656e  .dimension=dimen
+00013bf0: 7369 6f6e 0d0a 2020 2020 2020 2020 7365  sion..        se
+00013c00: 6c66 2e65 6d70 6f77 6572 5f69 6d70 6f72  lf.empower_impor
+00013c10: 7465 725f 6578 6563 7574 6162 6c65 203d  ter_executable =
+00013c20: 2065 6d70 6f77 6572 5f69 6d70 6f72 7465   empower_importe
+00013c30: 725f 6578 6563 7574 6162 6c65 0d0a 2020  r_executable..  
+00013c40: 2020 2020 2020 7365 6c66 2e5f 656c 656d        self._elem
+00013c50: 656e 7473 3d7b 7d0d 0a20 2020 2020 2020  ents={}..       
+00013c60: 2073 656c 662e 5f65 6c65 6d65 6e74 735f   self._elements_
+00013c70: 7769 7468 6f75 745f 7368 6f72 746e 616d  without_shortnam
+00013c80: 6573 203d 205b 5d0d 0a0d 0a20 2020 2020  es = []....     
+00013c90: 2020 2073 656c 662e 5f5f 656c 656d 656e     self.__elemen
+00013ca0: 7473 5f72 6561 6420 3d20 4661 6c73 650d  ts_read = False.
+00013cb0: 0a20 2020 2020 2020 2073 656c 662e 5f5f  .        self.__
+00013cc0: 656c 656d 656e 7473 5f73 796e 6365 6420  elements_synced 
+00013cd0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00013ce0: 7365 6c66 2e5f 5f65 6c65 6d65 6e74 5f64  self.__element_d
+00013cf0: 6174 6166 7261 6d65 203d 204e 6f6e 650d  ataframe = None.
+00013d00: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00013d10: 5f5f 7365 6375 7269 7479 5f65 6469 7465  __security_edite
+00013d20: 6420 3d20 4661 6c73 650d 0a20 2020 2020  d = False..     
+00013d30: 2020 2073 656c 662e 5f73 6563 7572 6974     self._securit
+00013d40: 795f 7265 6164 203d 2046 616c 7365 0d0a  y_read = False..
+00013d50: 0d0a 2020 2020 2353 6574 2074 6865 7365  ..    #Set these
+00013d60: 2061 7320 7072 6f70 6572 7469 6573 2066   as properties f
+00013d70: 6f72 2064 6562 7567 6769 6e67 202d 2077  or debugging - w
+00013d80: 6865 6e20 616c 6c20 6973 2077 6f72 6b69  hen all is worki
+00013d90: 6e67 206d 616b 6520 7468 656d 206e 6f72  ng make them nor
+00013da0: 6d61 6c20 6174 7472 6962 7574 6573 2061  mal attributes a
+00013db0: 6761 696e 0d0a 2020 2020 4070 726f 7065  gain..    @prope
+00013dc0: 7274 790d 0a20 2020 2064 6566 205f 656c  rty..    def _el
+00013dd0: 656d 656e 7473 5f72 6561 6428 7365 6c66  ements_read(self
+00013de0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+00013df0: 726e 2073 656c 662e 5f5f 656c 656d 656e  rn self.__elemen
+00013e00: 7473 5f72 6561 640d 0a0d 0a20 2020 2040  ts_read....    @
+00013e10: 5f65 6c65 6d65 6e74 735f 7265 6164 2e73  _elements_read.s
+00013e20: 6574 7465 720d 0a20 2020 2064 6566 205f  etter..    def _
+00013e30: 656c 656d 656e 7473 5f72 6561 6428 7365  elements_read(se
+00013e40: 6c66 2c76 616c 293a 0d0a 2020 2020 2020  lf,val):..      
+00013e50: 2020 236c 6f67 2e77 6172 6e69 6e67 2827    #log.warning('
+00013e60: 5f65 6c65 6d65 6e74 735f 7265 6164 2073  _elements_read s
+00013e70: 6574 2074 6f20 7b7d 272e 666f 726d 6174  et to {}'.format
+00013e80: 2876 616c 2929 0d0a 2020 2020 2020 2020  (val))..        
+00013e90: 7365 6c66 2e5f 5f65 6c65 6d65 6e74 735f  self.__elements_
+00013ea0: 7265 6164 203d 2076 616c 0d0a 0d0a 2020  read = val....  
+00013eb0: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+00013ec0: 2064 6566 205f 7365 6375 7269 7479 5f65   def _security_e
+00013ed0: 6469 7465 6428 7365 6c66 293a 0d0a 2020  dited(self):..  
+00013ee0: 2020 2020 2020 2370 7269 6e74 2827 3137        #print('17
+00013ef0: 3339 3a20 272c 7365 6c66 2e5f 5f73 6563  39: ',self.__sec
+00013f00: 7572 6974 795f 6564 6974 6564 2029 0d0a  urity_edited )..
+00013f10: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00013f20: 656c 662e 5f5f 7365 6375 7269 7479 5f65  elf.__security_e
+00013f30: 6469 7465 640d 0a0d 0a20 2020 2040 5f73  dited....    @_s
+00013f40: 6563 7572 6974 795f 6564 6974 6564 2e73  ecurity_edited.s
+00013f50: 6574 7465 720d 0a20 2020 2064 6566 205f  etter..    def _
+00013f60: 7365 6375 7269 7479 5f65 6469 7465 6428  security_edited(
+00013f70: 7365 6c66 2c76 616c 293a 0d0a 2020 2020  self,val):..    
+00013f80: 2020 2020 236c 6f67 2e77 6172 6e69 6e67      #log.warning
+00013f90: 2827 5f65 6c65 6d65 6e74 735f 7265 6164  ('_elements_read
+00013fa0: 2073 6574 2074 6f20 7b7d 272e 666f 726d   set to {}'.form
+00013fb0: 6174 2876 616c 2929 0d0a 2020 2020 2020  at(val))..      
+00013fc0: 2020 7365 6c66 2e5f 5f73 6563 7572 6974    self.__securit
+00013fd0: 795f 6564 6974 6564 203d 2076 616c 0d0a  y_edited = val..
+00013fe0: 2020 2020 2020 2020 2370 7269 6e74 2827          #print('
+00013ff0: 3838 353a 2027 2c73 656c 662e 5f5f 7365  885: ',self.__se
+00014000: 6375 7269 7479 5f65 6469 7465 6420 290d  curity_edited ).
+00014010: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+00014020: 0d0a 2020 2020 6465 6620 5f65 6c65 6d65  ..    def _eleme
+00014030: 6e74 735f 7379 6e63 6564 2873 656c 6629  nts_synced(self)
+00014040: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
+00014050: 6e20 7365 6c66 2e5f 5f65 6c65 6d65 6e74  n self.__element
+00014060: 735f 7379 6e63 6564 0d0a 0d0a 2020 2020  s_synced....    
+00014070: 405f 656c 656d 656e 7473 5f73 796e 6365  @_elements_synce
+00014080: 642e 7365 7474 6572 0d0a 2020 2020 6465  d.setter..    de
+00014090: 6620 5f65 6c65 6d65 6e74 735f 7379 6e63  f _elements_sync
+000140a0: 6564 2873 656c 662c 7661 6c29 3a0d 0a20  ed(self,val):.. 
+000140b0: 2020 2020 2020 2023 6c6f 672e 7761 726e         #log.warn
+000140c0: 696e 6728 275f 656c 656d 656e 7473 5f73  ing('_elements_s
+000140d0: 796e 6365 6420 7365 7420 746f 207b 7d27  ynced set to {}'
+000140e0: 2e66 6f72 6d61 7428 7661 6c29 290d 0a20  .format(val)).. 
+000140f0: 2020 2020 2020 2073 656c 662e 5f5f 656c         self.__el
+00014100: 656d 656e 7473 5f73 796e 6365 6420 3d20  ements_synced = 
+00014110: 7661 6c0d 0a0d 0a20 2020 2040 7072 6f70  val....    @prop
+00014120: 6572 7479 0d0a 2020 2020 6465 6620 5f65  erty..    def _e
+00014130: 6c65 6d65 6e74 5f64 6174 6166 7261 6d65  lement_dataframe
+00014140: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00014150: 2072 6574 7572 6e20 7365 6c66 2e5f 5f65   return self.__e
+00014160: 6c65 6d65 6e74 5f64 6174 6166 7261 6d65  lement_dataframe
+00014170: 0d0a 0d0a 2020 2020 405f 656c 656d 656e  ....    @_elemen
+00014180: 745f 6461 7461 6672 616d 652e 7365 7474  t_dataframe.sett
+00014190: 6572 0d0a 2020 2020 6465 6620 5f65 6c65  er..    def _ele
+000141a0: 6d65 6e74 5f64 6174 6166 7261 6d65 2873  ment_dataframe(s
+000141b0: 656c 662c 7661 6c29 3a0d 0a20 2020 2020  elf,val):..     
+000141c0: 2020 2023 6966 2076 616c 2069 7320 4e6f     #if val is No
+000141d0: 6e65 3a0d 0a20 2020 2020 2020 2023 2020  ne:..        #  
+000141e0: 2020 236c 6f67 2e77 6172 6e69 6e67 2827    #log.warning('
+000141f0: 5f65 6c65 6d65 6e74 5f64 6174 6166 7261  _element_datafra
+00014200: 6d65 2073 6574 2074 6f20 4e6f 6e65 2729  me set to None')
+00014210: 0d0a 2020 2020 2020 2020 2320 2020 2070  ..        #    p
+00014220: 6173 730d 0a20 2020 2020 2020 2023 656c  ass..        #el
+00014230: 7365 3a0d 0a20 2020 2020 2020 2023 2020  se:..        #  
+00014240: 2020 236c 6f67 2e77 6172 6e69 6e67 2827    #log.warning('
+00014250: 5f65 6c65 6d65 6e74 5f64 6174 6166 7261  _element_datafra
+00014260: 6d65 2073 6574 2729 0d0a 2020 2020 2020  me set')..      
+00014270: 2020 7365 6c66 2e5f 5f65 6c65 6d65 6e74    self.__element
+00014280: 5f64 6174 6166 7261 6d65 203d 2076 616c  _dataframe = val
+00014290: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6465  ....    def __de
+000142a0: 6c69 7465 6d5f 5f28 7365 6c66 2c69 7465  litem__(self,ite
+000142b0: 6d29 3a0d 0a20 2020 2020 2020 2023 4c6f  m):..        #Lo
+000142c0: 6164 2074 6865 2045 6c65 6d65 6e74 7320  ad the Elements 
+000142d0: 6966 2077 6520 6861 7665 6e27 7420 616c  if we haven't al
+000142e0: 7265 6164 790d 0a20 2020 2020 2020 2069  ready..        i
+000142f0: 6620 6e6f 7420 7365 6c66 2e5f 656c 656d  f not self._elem
+00014300: 656e 7473 5f72 6561 643a 0d0a 2020 2020  ents_read:..    
+00014310: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
+00014320: 6164 5f65 6c65 6d65 6e74 7328 290d 0a0d  ad_elements()...
+00014330: 0a20 2020 2020 2020 2064 656c 2073 656c  .        del sel
+00014340: 662e 5f65 6c65 6d65 6e74 735b 6974 656d  f._elements[item
+00014350: 5d0d 0a0d 0a20 2020 2023 556e 6c69 6b65  ]....    #Unlike
+00014360: 2061 2073 7461 6e64 6172 6420 6469 6374   a standard dict
+00014370: 696f 6e61 7279 2077 6869 6368 2072 6574  ionary which ret
+00014380: 7572 6e73 206b 6579 7320 696e 2069 7465  urns keys in ite
+00014390: 722c 2072 6574 7572 6e20 7661 6c75 6573  r, return values
+000143a0: 2028 7369 6e63 6520 7468 6174 2773 2077   (since that's w
+000143b0: 6861 7420 7765 2075 7375 616c 6c79 2077  hat we usually w
+000143c0: 616e 7429 0d0a 2020 2020 6465 6620 5f5f  ant)..    def __
+000143d0: 6974 6572 5f5f 2873 656c 6629 3a0d 0a20  iter__(self):.. 
+000143e0: 2020 2020 2020 2023 4a41 5420 3230 3139         #JAT 2019
+000143f0: 2d30 332d 3130 2050 594d 2d34 322c 2063  -03-10 PYM-42, c
+00014400: 6861 6e67 6564 2074 6f20 6765 7420 7468  hanged to get th
+00014410: 6520 6465 6661 756c 7420 6974 6572 6174  e default iterat
+00014420: 6f72 2074 6f20 646f 2074 6865 206c 617a  or to do the laz
+00014430: 7920 6c6f 6164 2066 726f 6d20 456d 706f  y load from Empo
+00014440: 7765 7220 6265 666f 7265 2072 6574 7572  wer before retur
+00014450: 6e69 6e67 2073 656c 660d 0a20 2020 2020  ning self..     
+00014460: 2020 2073 656c 662e 5f69 7465 7261 746f     self._iterato
+00014470: 7220 3d20 6974 6572 2873 656c 662e 7661  r = iter(self.va
+00014480: 6c75 6573 2829 290d 0a20 2020 2020 2020  lues())..       
+00014490: 2072 6574 7572 6e20 7365 6c66 0d0a 0d0a   return self....
+000144a0: 2020 2020 6465 6620 5f5f 6e65 7874 5f5f      def __next__
+000144b0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+000144c0: 2072 6574 7572 6e20 6e65 7874 2873 656c   return next(sel
+000144d0: 662e 5f69 7465 7261 746f 7229 0d0a 0d0a  f._iterator)....
+000144e0: 2020 2020 6465 6620 5f5f 6765 7469 7465      def __getite
+000144f0: 6d5f 5f28 7365 6c66 2c69 7465 6d29 3a0d  m__(self,item):.
+00014500: 0a20 2020 2020 2020 2023 4c6f 6164 2074  .        #Load t
+00014510: 6865 2045 6c65 6d65 6e74 7320 6966 2077  he Elements if w
+00014520: 6520 6861 7665 6e27 7420 616c 7265 6164  e haven't alread
+00014530: 790d 0a20 2020 2020 2020 2069 6620 6e6f  y..        if no
+00014540: 7420 7365 6c66 2e5f 656c 656d 656e 7473  t self._elements
+00014550: 5f72 6561 643a 0d0a 2020 2020 2020 2020  _read:..        
+00014560: 2020 2020 7365 6c66 2e5f 6c6f 6164 5f65      self._load_e
+00014570: 6c65 6d65 6e74 7328 6465 6275 673d 7365  lements(debug=se
+00014580: 6c66 2e64 696d 656e 7369 6f6e 2e73 6974  lf.dimension.sit
+00014590: 652e 5f64 6562 7567 290d 0a0d 0a20 2020  e._debug)....   
+000145a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000145b0: 2e5f 656c 656d 656e 7473 5b69 7465 6d5d  ._elements[item]
+000145c0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 7365  ....    def __se
+000145d0: 7469 7465 6d5f 5f28 7365 6c66 2c20 6b65  titem__(self, ke
+000145e0: 792c 2069 7465 6d29 3a0d 0a20 2020 2020  y, item):..     
+000145f0: 2020 2023 2044 6f65 7320 7468 6520 5b5d     # Does the []
+00014600: 2073 6574 206f 7665 726c 6f61 6469 6e67   set overloading
+00014610: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+00014620: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00014630: 5f65 6c65 6d65 6e74 735f 7265 6164 3a0d  _elements_read:.
+00014640: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00014650: 662e 5f6c 6f61 645f 656c 656d 656e 7473  f._load_elements
+00014660: 2864 6562 7567 3d73 656c 662e 6469 6d65  (debug=self.dime
+00014670: 6e73 696f 6e2e 7369 7465 2e5f 6465 6275  nsion.site._debu
+00014680: 6729 0d0a 0d0a 2020 2020 2020 2020 2341  g)....        #A
+00014690: 6464 696e 6720 616e 2065 6c65 6d65 6e74  dding an element
+000146a0: 206e 756c 6c69 6669 6573 2074 6865 2064   nullifies the d
+000146b0: 6174 6166 7261 6d65 0d0a 2020 2020 2020  ataframe..      
+000146c0: 2020 7365 6c66 2e5f 656c 656d 656e 745f    self._element_
+000146d0: 6461 7461 6672 616d 6520 3d20 4e6f 6e65  dataframe = None
+000146e0: 0d0a 0d0a 2020 2020 2020 2020 2320 466c  ....        # Fl
+000146f0: 6167 2074 6861 7420 6564 6974 7320 6861  ag that edits ha
+00014700: 7665 2062 6565 6e20 6d61 6465 0d0a 2020  ve been made..  
+00014710: 2020 2020 2020 7365 6c66 2e5f 656c 656d        self._elem
+00014720: 656e 7473 5f73 796e 6365 6420 3d20 4661  ents_synced = Fa
+00014730: 6c73 650d 0a0d 0a20 2020 2020 2020 2069  lse....        i
+00014740: 6620 6b65 7920 6973 204e 6f6e 653a 0d0a  f key is None:..
+00014750: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00014760: 6520 5661 6c75 6545 7272 6f72 2827 2e65  e ValueError('.e
+00014770: 6c65 6d65 6e74 735b 5d20 6361 6e20 6e6f  lements[] can no
+00014780: 7420 6861 7665 2061 6e20 6974 656d 2061  t have an item a
+00014790: 6464 6564 2077 6974 6820 6120 4e6f 6e65  dded with a None
+000147a0: 206b 6579 2729 0d0a 2020 2020 2020 2020   key')..        
+000147b0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000147c0: 2020 2073 656c 662e 5f65 6c65 6d65 6e74     self._element
+000147d0: 735b 6b65 795d 2020 203d 2069 7465 6d0d  s[key]   = item.
+000147e0: 0a0d 0a20 2020 2020 2020 2023 4164 6420  ...        #Add 
+000147f0: 7468 6520 6974 656d 2074 6f20 7468 6520  the item to the 
+00014800: 5f65 6c65 6d65 6e74 7320 6461 7461 6672  _elements datafr
+00014810: 616d 6520 6966 2069 7420 6578 6973 7473  ame if it exists
+00014820: 0d0a 0d0a 2020 2020 6465 6620 5f5f 696f  ....    def __io
+00014830: 725f 5f28 7365 6c66 2c69 7465 6d29 3a0d  r__(self,item):.
+00014840: 0a20 2020 2020 2020 2027 2727 4465 6669  .        '''Defi
+00014850: 6e65 2073 796e 7461 7820 666f 7220 7c3d  ne syntax for |=
+00014860: 2069 2e65 2e20 6164 6420 6966 2064 6f65   i.e. add if doe
+00014870: 736e 2774 2061 6c72 6561 6479 2065 7869  sn't already exi
+00014880: 7374 202d 206f 7468 6572 7769 7365 2069  st - otherwise i
+00014890: 676e 6f72 6527 2727 0d0a 2020 2020 2020  gnore'''..      
+000148a0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+000148b0: 6974 656d 2c45 6c65 6d65 6e74 293a 0d0a  item,Element):..
+000148c0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+000148d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000148e0: 2020 7365 6c66 5b69 7465 6d2e 7368 6f72    self[item.shor
+000148f0: 746e 616d 655d 0d0a 2020 2020 2020 2020  tname]..        
+00014900: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+00014910: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+00014920: 2020 2020 2020 7365 6c66 2e61 7070 656e        self.appen
+00014930: 6428 6974 656d 290d 0a20 2020 2020 2020  d(item)..       
+00014940: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+00014950: 2869 7465 6d2c 7374 7229 3a0d 0a20 2020  (item,str):..   
+00014960: 2020 2020 2020 2020 2023 4372 6561 7465           #Create
+00014970: 2061 2073 7475 6220 616e 6420 6164 6420   a stub and add 
+00014980: 6974 0d0a 2020 2020 2020 2020 2020 2020  it..            
+00014990: 7365 6c66 207c 3d20 456c 656d 656e 7428  self |= Element(
+000149a0: 6469 6d65 6e73 696f 6e3d 7365 6c66 2e64  dimension=self.d
+000149b0: 696d 656e 7369 6f6e 2c20 7368 6f72 746e  imension, shortn
+000149c0: 616d 6520 3d20 6974 656d 2c6c 6f6e 676e  ame = item,longn
+000149d0: 616d 653d 6974 656d 2e63 6170 6974 616c  ame=item.capital
+000149e0: 697a 6528 292c 6465 7363 7269 7074 696f  ize(),descriptio
+000149f0: 6e3d 6974 656d 2e63 6170 6974 616c 697a  n=item.capitaliz
+00014a00: 6528 2929 0d0a 2020 2020 2020 2020 656c  e())..        el
+00014a10: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00014a20: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00014a30: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+00014a40: 6974 656d 3a0d 0a20 2020 2020 2020 2020  item:..         
+00014a50: 2020 2020 2020 2020 2020 2073 656c 6620             self 
+00014a60: 7c3d 2069 0d0a 2020 2020 2020 2020 2020  |= i..          
+00014a70: 2020 6578 6365 7074 2054 7970 6545 7272    except TypeErr
+00014a80: 6f72 3a20 236e 6f6e 2069 7465 7261 626c  or: #non iterabl
+00014a90: 6573 2077 696c 6c20 7261 6973 6520 6120  es will raise a 
+00014aa0: 5479 7065 4572 726f 720d 0a0d 0a20 2020  TypeError....   
+00014ab0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00014ac0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00014ad0: 2020 2020 2020 2065 6c20 3d20 6974 656d         el = item
+00014ae0: 2e65 6c65 6d65 6e74 0d0a 2020 2020 2020  .element..      
+00014af0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00014b00: 6c66 207c 3d20 656c 0d0a 2020 2020 2020  lf |= el..      
+00014b10: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00014b20: 2041 7474 7269 6275 7465 4572 726f 723a   AttributeError:
+00014b30: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00014b40: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00014b50: 6c75 6545 7272 6f72 2827 436f 756c 6420  lueError('Could 
+00014b60: 6e6f 7420 636f 6d62 696e 6520 6f62 6a65  not combine obje
+00014b70: 6374 7320 7b7d 2061 6e64 207b 7d20 7573  cts {} and {} us
+00014b80: 696e 6720 7c3d 2073 796e 7461 7827 2e66  ing |= syntax'.f
+00014b90: 6f72 6d61 7428 7265 7072 2873 656c 6629  ormat(repr(self)
+00014ba0: 2c72 6570 7228 6974 656d 2929 290d 0a0d  ,repr(item)))...
+00014bb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00014bc0: 7365 6c66 0d0a 0d0a 2020 2020 6465 6620  self....    def 
+00014bd0: 5f5f 6961 6464 5f5f 2873 656c 662c 6974  __iadd__(self,it
+00014be0: 656d 293a 0d0a 2020 2020 2020 2020 2727  em):..        ''
+00014bf0: 2744 6566 696e 6520 7379 6e74 6178 2066  'Define syntax f
+00014c00: 6f72 202b 3d20 692e 652e 2061 6464 2069  or += i.e. add i
+00014c10: 6620 646f 6573 6e27 7420 616c 7265 6164  f doesn't alread
+00014c20: 7920 6578 6973 7420 2d20 6f74 6865 7277  y exist - otherw
+00014c30: 6973 6520 7261 6973 6520 5661 6c75 6545  ise raise ValueE
+00014c40: 7272 6f72 2727 270d 0a20 2020 2020 2020  rror'''..       
+00014c50: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
+00014c60: 7465 6d2c 456c 656d 656e 7429 3a0d 0a20  tem,Element):.. 
+00014c70: 2020 2020 2020 2020 2020 2023 4f6e 6c79             #Only
+00014c80: 2061 6464 2074 6865 2065 6c65 6d65 6e74   add the element
+00014c90: 2069 6620 6974 2064 6965 736e 2774 2061   if it diesn't a
+00014ca0: 6c72 6561 6479 2065 7869 7374 202d 2069  lready exist - i
+00014cb0: 6620 6974 2064 6f65 732c 2072 6169 7365  f it does, raise
+00014cc0: 2061 2076 616c 7565 2065 7272 6f72 0d0a   a value error..
+00014cd0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00014ce0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00014cf0: 2020 7365 6c66 5b69 7465 6d2e 7368 6f72    self[item.shor
+00014d00: 746e 616d 655d 0d0a 2020 2020 2020 2020  tname]..        
+00014d10: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00014d20: 6c75 6545 7272 6f72 2827 4361 6e6e 6f74  lueError('Cannot
+00014d30: 2061 6464 2069 7465 6d20 7b7d 2074 6f20   add item {} to 
+00014d40: 2e65 6c65 6d65 6e74 7320 6265 6361 7573  .elements becaus
+00014d50: 6520 616e 2069 7465 6d20 7769 7468 2074  e an item with t
+00014d60: 6869 7320 7368 6f72 746e 616d 6520 616c  his shortname al
+00014d70: 7265 6164 7920 6578 6973 7473 272e 666f  ready exists'.fo
+00014d80: 726d 6174 2872 6570 7228 6974 656d 2929  rmat(repr(item))
+00014d90: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
+00014da0: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
+00014db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014dc0: 2073 656c 662e 6170 7065 6e64 2869 7465   self.append(ite
+00014dd0: 6d29 0d0a 0d0a 2020 2020 2020 2020 656c  m)....        el
+00014de0: 6966 2069 7369 6e73 7461 6e63 6528 6974  if isinstance(it
+00014df0: 656d 2c73 7472 293a 0d0a 2020 2020 2020  em,str):..      
+00014e00: 2020 2020 2020 2343 7265 6174 6520 6120        #Create a 
+00014e10: 7374 7562 2061 6e64 2061 6464 2069 740d  stub and add it.
+00014e20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00014e30: 6620 2b3d 2045 6c65 6d65 6e74 2864 696d  f += Element(dim
+00014e40: 656e 7369 6f6e 3d73 656c 662e 6469 6d65  ension=self.dime
+00014e50: 6e73 696f 6e2c 2073 686f 7274 6e61 6d65  nsion, shortname
+00014e60: 203d 2069 7465 6d2c 6c6f 6e67 6e61 6d65   = item,longname
+00014e70: 3d69 7465 6d2e 6361 7069 7461 6c69 7a65  =item.capitalize
+00014e80: 2829 2c64 6573 6372 6970 7469 6f6e 3d69  (),description=i
+00014e90: 7465 6d2e 6361 7069 7461 6c69 7a65 2829  tem.capitalize()
+00014ea0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
+00014eb0: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+00014ec0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00014ed0: 2020 2020 666f 7220 6920 696e 2069 7465      for i in ite
+00014ee0: 6d3a 0d0a 2020 2020 2020 2020 2020 2020  m:..            
+00014ef0: 2020 2020 2020 2020 7365 6c66 202b 3d20          self += 
+00014f00: 690d 0a20 2020 2020 2020 2020 2020 2065  i..            e
+00014f10: 7863 6570 7420 5479 7065 4572 726f 723a  xcept TypeError:
+00014f20: 2023 6e6f 6e20 6974 6572 6162 6c65 7320   #non iterables 
+00014f30: 7769 6c6c 2072 6169 7365 2061 2054 7970  will raise a Typ
+00014f40: 6545 7272 6f72 0d0a 0d0a 2020 2020 2020  eError....      
+00014f50: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
+00014f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f70: 2020 2020 656c 203d 2069 7465 6d2e 656c      el = item.el
+00014f80: 656d 656e 740d 0a20 2020 2020 2020 2020  ement..         
+00014f90: 2020 2020 2020 2020 2020 2073 656c 6620             self 
+00014fa0: 2b3d 2065 6c0d 0a20 2020 2020 2020 2020  += el..         
+00014fb0: 2020 2020 2020 2065 7863 6570 7420 4174         except At
+00014fc0: 7472 6962 7574 6545 7272 6f72 3a0d 0a0d  tributeError:...
+00014fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014fe0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00014ff0: 4572 726f 7228 2743 6f75 6c64 206e 6f74  Error('Could not
+00015000: 2063 6f6d 6269 6e65 206f 626a 6563 7473   combine objects
+00015010: 207b 7d20 616e 6420 7b7d 2075 7369 6e67   {} and {} using
+00015020: 202b 3d20 7379 6e74 6178 272e 666f 726d   += syntax'.form
+00015030: 6174 2872 6570 7228 7365 6c66 292c 7265  at(repr(self),re
+00015040: 7072 2869 7465 6d29 2929 0d0a 0d0a 2020  pr(item)))....  
+00015050: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00015060: 660d 0a0d 0a20 2020 2064 6566 2061 7070  f....    def app
+00015070: 656e 6428 7365 6c66 2c69 7465 6d29 3a0d  end(self,item):.
+00015080: 0a20 2020 2020 2020 2061 7373 6572 7420  .        assert 
+00015090: 6973 696e 7374 616e 6365 2869 7465 6d2c  isinstance(item,
+000150a0: 456c 656d 656e 7429 0d0a 2020 2020 2020  Element)..      
+000150b0: 2020 7365 6c66 5b69 7465 6d2e 7368 6f72    self[item.shor
+000150c0: 746e 616d 655d 203d 2069 7465 6d0d 0a0d  tname] = item...
+000150d0: 0a20 2020 2064 6566 205f 6c6f 6164 5f65  .    def _load_e
+000150e0: 6c65 6d65 6e74 7328 7365 6c66 2c64 6562  lements(self,deb
+000150f0: 7567 2020 2020 2020 2020 2020 2020 2020  ug              
+00015100: 2020 2020 2020 2020 203d 2046 616c 7365           = False
+00015110: 293a 0d0a 2020 2020 2020 2020 6c6f 672e  ):..        log.
+00015120: 7665 7262 6f73 6528 2752 6561 6469 6e67  verbose('Reading
+00015130: 2045 6c65 6d65 6e74 7320 666f 7220 6469   Elements for di
+00015140: 6d65 6e73 696f 6e20 272b 7374 7228 7365  mension '+str(se
+00015150: 6c66 2e64 696d 656e 7369 6f6e 2e69 6e64  lf.dimension.ind
+00015160: 6578 2929 0d0a 2020 2020 2020 2020 2353  ex))..        #S
+00015170: 6574 205f 656c 656d 656e 7473 5f72 6561  et _elements_rea
+00015180: 6420 6e6f 772c 206f 7220 7765 276c 6c20  d now, or we'll 
+00015190: 656e 6420 7570 2069 6e20 6120 6c6f 6f70  end up in a loop
+000151a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+000151b0: 656c 656d 656e 7473 5f72 6561 6420 3d20  elements_read = 
+000151c0: 5472 7565 0d0a 2020 2020 2020 2020 7472  True..        tr
+000151d0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+000151e0: 7365 6c66 2e5f 656c 656d 656e 7473 203d  self._elements =
+000151f0: 205f 6372 6561 7465 5f65 6d70 6f77 6572   _create_empower
+00015200: 5f64 696d 656e 7369 6f6e 5f73 686f 7274  _dimension_short
+00015210: 6e61 6d65 5f65 6c65 6d65 6e74 5f64 6963  name_element_dic
+00015220: 7428 6469 6d65 6e73 696f 6e20 2020 2020  t(dimension     
+00015230: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
+00015240: 7365 6c66 2e64 696d 656e 7369 6f6e 0d0a  self.dimension..
 00015250: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015270: 202c 6465 6275 6720 2020 2020 2020 2020   ,debug         
-00015280: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
-00015290: 6465 6275 670d 0a20 2020 2020 2020 2020  debug..         
-000152a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015290: 2020 2020 2020 2020 2020 2020 202c 6465               ,de
+000152a0: 6275 6720 2020 2020 2020 2020 2020 2020  bug             
+000152b0: 2020 2020 2020 2020 2020 3d20 6465 6275            = debu
+000152c0: 670d 0a20 2020 2020 2020 2020 2020 2020  g..             
 000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152e0: 2020 2020 290d 0a20 2020 2020 2020 2065      )..        e
-000152f0: 7863 6570 743a 0d0a 2020 2020 2020 2020  xcept:..        
-00015300: 2020 2020 7365 6c66 2e5f 656c 656d 656e      self._elemen
-00015310: 7473 5f72 6561 6420 3d20 4661 6c73 650d  ts_read = False.
-00015320: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00015330: 7365 0d0a 0d0a 2020 2020 6465 6620 5f6c  se....    def _l
-00015340: 6f61 645f 7365 6375 7269 7479 2873 656c  oad_security(sel
-00015350: 6629 3a0d 0a0d 0a20 2020 2020 2020 2069  f):....        i
-00015360: 6620 7365 6c66 2e5f 7365 6375 7269 7479  f self._security
-00015370: 5f72 6561 643a 0d0a 2020 2020 2020 2020  _read:..        
-00015380: 2020 2020 7265 7475 726e 0d0a 0d0a 2020      return....  
-00015390: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-000153a0: 662e 5f65 6c65 6d65 6e74 735f 7265 6164  f._elements_read
-000153b0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-000153c0: 656c 662e 5f6c 6f61 645f 656c 656d 656e  elf._load_elemen
-000153d0: 7473 2829 0d0a 0d0a 2020 2020 2020 2020  ts()....        
-000153e0: 6966 2073 656c 662e 6469 6d65 6e73 696f  if self.dimensio
-000153f0: 6e2e 6c6f 6e67 6e61 6d65 2069 7320 4e6f  n.longname is No
-00015400: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00015410: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00015420: 7228 2743 616e 6e6f 7420 696d 706f 7274  r('Cannot import
-00015430: 2064 696d 656e 7369 6f6e 2073 6563 7572   dimension secur
-00015440: 6974 7920 756e 7469 6c20 7468 6520 2e6c  ity until the .l
-00015450: 6f6e 676e 616d 6520 7072 6f70 6572 7479  ongname property
-00015460: 206f 6620 6469 6d65 6e73 696f 6e20 7b7d   of dimension {}
-00015470: 2068 6173 2062 6565 6e20 7365 7427 2e66   has been set'.f
-00015480: 6f72 6d61 7428 7365 6c66 2e64 696d 656e  ormat(self.dimen
-00015490: 7369 6f6e 2e69 6e64 6578 2929 0d0a 0d0a  sion.index))....
-000154a0: 2020 2020 2020 2020 6c6f 672e 7665 7262          log.verb
-000154b0: 6f73 6528 2752 6561 6469 6e67 2045 6c65  ose('Reading Ele
-000154c0: 6d65 6e74 2053 6563 7572 6974 7920 666f  ment Security fo
-000154d0: 7220 6469 6d65 6e73 696f 6e5b 7b7d 5d27  r dimension[{}]'
-000154e0: 2e66 6f72 6d61 7428 7365 6c66 2e64 696d  .format(self.dim
-000154f0: 656e 7369 6f6e 2e69 6e64 6578 2929 0d0a  ension.index))..
-00015500: 0d0a 2020 2020 2020 2020 2370 756c 6c20  ..        #pull 
-00015510: 7468 6520 6461 7461 2069 6e20 616e 6420  the data in and 
-00015520: 7365 7420 7365 6375 7269 7479 0d0a 2020  set security..  
-00015530: 2020 2020 2020 7365 6375 7269 7479 5f64        security_d
-00015540: 6174 6120 3d20 5b5d 0d0a 0d0a 2020 2020  ata = []....    
-00015550: 2020 2020 636f 6d6d 616e 645f 6c69 7374      command_list
-00015560: 203d 2073 656c 662e 6469 6d65 6e73 696f   = self.dimensio
-00015570: 6e2e 7369 7465 2e5f 6c6f 676f 6e5f 7061  n.site._logon_pa
-00015580: 7261 6d65 7465 725f 696d 706f 7274 6572  rameter_importer
-00015590: 5f63 6f6d 6d61 6e64 7320 2b20 5c0d 0a20  _commands + \.. 
-000155a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155b0: 2020 2020 2020 5b27 7365 742d 7061 7261        ['set-para
-000155c0: 6d65 7465 7220 6469 6d65 6e73 696f 6e6e  meter dimensionn
-000155d0: 616d 653d 2720 2020 2020 202b 2073 656c  ame='      + sel
-000155e0: 662e 6469 6d65 6e73 696f 6e2e 6c6f 6e67  f.dimension.long
-000155f0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-00015600: 2020 2020 2020 2020 2020 2020 202c 2765               ,'e
-00015610: 6d70 6f77 6572 2d65 7870 6f72 742d 7365  mpower-export-se
-00015620: 6375 7269 7479 2d73 6574 7469 6e67 7320  curity-settings 
-00015630: 2224 7b73 6974 657d 2220 2224 7b75 7365  "${site}" "${use
-00015640: 727d 2220 2224 7b70 6173 7377 6f72 647d  r}" "${password}
-00015650: 2220 2224 7b64 696d 656e 7369 6f6e 6e61  " "${dimensionna
-00015660: 6d65 7d22 270d 0a20 2020 2020 2020 2020  me}"'..         
-00015670: 2020 2020 2020 2020 2020 2020 2020 2c27                ,'
-00015680: 6f75 7470 7574 270d 0a20 2020 2020 2020  output'..       
-00015690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156a0: 5d0d 0a0d 0a20 2020 2020 2020 206f 7574  ]....        out
-000156b0: 7075 7420 3d20 6c6c 752e 7275 6e5f 7369  put = llu.run_si
-000156c0: 6e67 6c65 5f6f 7574 7075 745f 696d 706f  ngle_output_impo
-000156d0: 7274 6572 5f63 6f6d 6d61 6e64 7328 636f  rter_commands(co
-000156e0: 6d6d 616e 645f 6c69 7374 2c65 6d70 6f77  mmand_list,empow
-000156f0: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
-00015700: 7574 6162 6c65 3d73 656c 662e 6469 6d65  utable=self.dime
-00015710: 6e73 696f 6e2e 7369 7465 2e65 6d70 6f77  nsion.site.empow
-00015720: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
-00015730: 7574 6162 6c65 290d 0a0d 0a20 2020 2020  utable)....     
-00015740: 2020 206d 616a 6f72 5f76 6572 7369 6f6e     major_version
-00015750: 2c20 6d69 6e6f 725f 7665 7273 696f 6e2c  , minor_version,
-00015760: 2072 656c 6561 7365 2c20 7265 6c65 6173   release, releas
-00015770: 655f 6e75 6d62 6572 203d 2073 656c 662e  e_number = self.
-00015780: 6469 6d65 6e73 696f 6e2e 7369 7465 2e69  dimension.site.i
-00015790: 6d70 6f72 7465 725f 7665 7273 696f 6e0d  mporter_version.
-000157a0: 0a0d 0a20 2020 2020 2020 2023 496e 206f  ...        #In o
-000157b0: 6c64 6572 2076 6572 7369 6f6e 7320 6f66  lder versions of
-000157c0: 2049 6d70 6f72 7465 7220 7468 6572 6520   Importer there 
-000157d0: 7761 7320 736f 6d65 2077 6569 7264 2064  was some weird d
-000157e0: 6f75 626c 6520 7175 6f74 6573 2069 6e20  ouble quotes in 
-000157f0: 7468 6520 6f75 7470 7574 0d0a 2020 2020  the output..    
-00015800: 2020 2020 6966 2028 6d61 6a6f 725f 7665      if (major_ve
-00015810: 7273 696f 6e20 3d3d 2039 2061 6e64 2028  rsion == 9 and (
-00015820: 7265 6c65 6173 655f 6e75 6d62 6572 203e  release_number >
-00015830: 3d20 3137 3234 206f 7220 6d69 6e6f 725f  = 1724 or minor_
-00015840: 7665 7273 696f 6e20 3e3d 3729 2920 6f72  version >=7)) or
-00015850: 206d 616a 6f72 5f76 6572 7369 6f6e 203e   major_version >
-00015860: 2039 3a0d 0a20 2020 2020 2020 2020 2020   9:..           
-00015870: 2066 6f72 206e 2c20 6c69 6e65 2069 6e20   for n, line in 
-00015880: 656e 756d 6572 6174 6528 6f75 7470 7574  enumerate(output
-00015890: 2e73 706c 6974 2827 5c6e 2729 293a 0d0a  .split('\n')):..
-000158a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158b0: 6966 206e 203e 2030 2061 6e64 206c 656e  if n > 0 and len
-000158c0: 286c 696e 6529 203e 2030 3a0d 0a20 2020  (line) > 0:..   
-000158d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158e0: 2073 6563 7572 6974 795f 6461 7461 2e61   security_data.a
-000158f0: 7070 656e 6428 6c69 6e65 2e73 706c 6974  ppend(line.split
-00015900: 2827 5c74 2729 290d 0a20 2020 2020 2020  ('\t'))..       
-00015910: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00015920: 2020 2020 666f 7220 6e2c 206c 696e 6520      for n, line 
-00015930: 696e 2065 6e75 6d65 7261 7465 286f 7574  in enumerate(out
-00015940: 7075 742e 7370 6c69 7428 275c 6e27 2929  put.split('\n'))
-00015950: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00015960: 2020 2069 6620 6e20 3e20 3020 616e 6420     if n > 0 and 
-00015970: 6c65 6e28 6c69 6e65 2920 3e20 303a 0d0a  len(line) > 0:..
-00015980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015990: 2020 2020 2353 7472 6970 206f 6666 2064      #Strip off d
-000159a0: 6f75 626c 6520 7175 6f74 6573 2061 6e64  ouble quotes and
-000159b0: 2063 6172 7269 6167 6520 7265 7475 726e   carriage return
-000159c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000159d0: 2020 2020 2020 6173 7365 7274 206c 696e        assert lin
-000159e0: 655b 305d 3d3d 2722 270d 0a20 2020 2020  e[0]=='"'..     
-000159f0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00015a00: 7373 6572 7420 6c69 6e65 5b2d 325d 3d3d  ssert line[-2]==
-00015a10: 2722 270d 0a0d 0a20 2020 2020 2020 2020  '"'....         
-00015a20: 2020 2020 2020 2020 2020 2073 6563 7572             secur
-00015a30: 6974 795f 6461 7461 2e61 7070 656e 6428  ity_data.append(
-00015a40: 6c69 6e65 5b31 3a2d 325d 2e73 706c 6974  line[1:-2].split
-00015a50: 2827 5c74 2729 290d 0a0d 0a0d 0a20 2020  ('\t'))......   
-00015a60: 2020 2020 2066 6f72 2064 6174 756d 2069       for datum i
-00015a70: 6e20 7365 6375 7269 7479 5f64 6174 613a  n security_data:
-00015a80: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00015a90: 6469 6d65 6e73 696f 6e5f 6e61 6d65 203d  dimension_name =
-00015aa0: 2064 6174 756d 5b30 5d0d 0a0d 0a20 2020   datum[0]....   
-00015ab0: 2020 2020 2020 2020 2023 446f 2074 6869           #Do thi
-00015ac0: 7320 6173 7365 7274 696f 6e20 746f 206d  s assertion to m
-00015ad0: 616b 6520 6865 6c70 2061 7373 7572 6520  ake help assure 
-00015ae0: 7765 2776 6520 7265 6164 2074 6865 2064  we've read the d
-00015af0: 6174 6120 636f 7272 6563 746c 790d 0a20  ata correctly.. 
-00015b00: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00015b10: 7420 7365 6c66 2e64 696d 656e 7369 6f6e  t self.dimension
-00015b20: 2e6c 6f6e 676e 616d 6520 3d3d 2064 696d  .longname == dim
-00015b30: 656e 7369 6f6e 5f6e 616d 652c 2027 4469  ension_name, 'Di
-00015b40: 6d65 6e73 696f 6e20 6e61 6d65 2064 696d  mension name dim
-00015b50: 656e 7369 6f6e 2e6c 6f6e 676e 616d 6520  ension.longname 
-00015b60: 227b 7d22 206d 7573 7420 6d61 7463 6820  "{}" must match 
-00015b70: 6f75 7470 7574 2066 726f 6d20 496d 706f  output from Impo
-00015b80: 7274 6572 2022 7b7d 2227 2e66 6f72 6d61  rter "{}"'.forma
-00015b90: 7428 7365 6c66 2e64 696d 656e 7369 6f6e  t(self.dimension
-00015ba0: 2e6c 6f6e 676e 616d 652c 2064 696d 656e  .longname, dimen
-00015bb0: 7369 6f6e 5f6e 616d 6529 0d0a 0d0a 2020  sion_name)....  
-00015bc0: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-00015bd0: 745f 6964 656e 7469 6669 6572 7320 3d20  t_identifiers = 
-00015be0: 6461 7475 6d5b 315d 0d0a 2020 2020 2020  datum[1]..      
-00015bf0: 2020 2020 2020 6d6f 6469 6669 6572 5f64        modifier_d
-00015c00: 6563 6c61 7261 7469 6f6e 203d 2064 6174  eclaration = dat
-00015c10: 756d 5b32 5d0d 0a20 2020 2020 2020 2020  um[2]..         
-00015c20: 2020 206d 6f64 6966 6965 725f 6675 6e63     modifier_func
-00015c30: 7469 6f6e 203d 2064 6174 756d 5b33 5d0d  tion = datum[3].
-00015c40: 0a20 2020 2020 2020 2020 2020 206d 6f64  .            mod
-00015c50: 6966 6965 725f 6c69 7374 5f73 7472 696e  ifier_list_strin
-00015c60: 6720 3d20 6461 7475 6d5b 345d 0d0a 2020  g = datum[4]..  
-00015c70: 2020 2020 2020 2020 2020 7669 6577 6572            viewer
-00015c80: 5f64 6563 6c61 7261 7469 6f6e 203d 2064  _declaration = d
-00015c90: 6174 756d 5b35 5d0d 0a20 2020 2020 2020  atum[5]..       
-00015ca0: 2020 2020 2076 6965 7765 725f 6675 6e63       viewer_func
-00015cb0: 7469 6f6e 203d 2064 6174 756d 5b36 5d0d  tion = datum[6].
-00015cc0: 0a20 2020 2020 2020 2020 2020 2076 6965  .            vie
-00015cd0: 7765 725f 6c69 7374 5f73 7472 696e 6720  wer_list_string 
-00015ce0: 3d20 6461 7475 6d5b 375d 0d0a 2020 2020  = datum[7]..    
-00015cf0: 2020 2020 2020 2020 6461 7461 5f76 6965          data_vie
-00015d00: 7765 725f 6465 636c 6172 6174 696f 6e20  wer_declaration 
-00015d10: 3d20 6461 7475 6d5b 385d 0d0a 2020 2020  = datum[8]..    
-00015d20: 2020 2020 2020 2020 6461 7461 5f76 6965          data_vie
-00015d30: 7765 725f 6675 6e63 7469 6f6e 203d 2064  wer_function = d
-00015d40: 6174 756d 5b39 5d0d 0a20 2020 2020 2020  atum[9]..       
-00015d50: 2020 2020 2064 6174 615f 7669 6577 6572       data_viewer
-00015d60: 5f6c 6973 745f 7374 7269 6e67 203d 2064  _list_string = d
-00015d70: 6174 756d 5b31 305d 0d0a 0d0a 2020 2020  atum[10]....    
-00015d80: 2020 2020 2020 2020 656c 656d 656e 745f          element_
-00015d90: 6964 656e 7469 6669 6572 5f70 6172 7473  identifier_parts
-00015da0: 203d 2065 6c65 6d65 6e74 5f69 6465 6e74   = element_ident
-00015db0: 6966 6965 7273 2e73 706c 6974 2827 2827  ifiers.split('('
-00015dc0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00015dd0: 6c65 6d65 6e74 5f73 6320 3d20 2728 272e  lement_sc = '('.
-00015de0: 6a6f 696e 2865 6c65 6d65 6e74 5f69 6465  join(element_ide
-00015df0: 6e74 6966 6965 725f 7061 7274 735b 3a2d  ntifier_parts[:-
-00015e00: 315d 292e 7374 7269 7028 290d 0a20 2020  1]).strip()..   
-00015e10: 2020 2020 2020 2020 2023 4765 7420 7468           #Get th
-00015e20: 6520 6c61 7374 2062 6974 2061 6674 6572  e last bit after
-00015e30: 2061 206f 7065 6e20 6272 6163 6b65 742c   a open bracket,
-00015e40: 2074 6865 6e20 7374 7269 7020 7468 6520   then strip the 
-00015e50: 636c 6f73 6520 6272 6163 6b65 7420 6f66  close bracket of
-00015e60: 6620 7468 6520 656e 640d 0a20 2020 2020  f the end..     
-00015e70: 2020 2020 2020 2065 6c65 6d65 6e74 5f70         element_p
-00015e80: 6879 7369 6420 3d20 696e 7428 656c 656d  hysid = int(elem
-00015e90: 656e 745f 6964 656e 7469 6669 6572 5f70  ent_identifier_p
-00015ea0: 6172 7473 5b2d 315d 5b3a 2d31 5d2e 7265  arts[-1][:-1].re
-00015eb0: 706c 6163 6528 2729 272c 2727 2929 0d0a  place(')',''))..
-00015ec0: 0d0a 2020 2020 2020 2020 2020 2020 6173  ..            as
-00015ed0: 7365 7274 206d 6f64 6966 6965 725f 6465  sert modifier_de
-00015ee0: 636c 6172 6174 696f 6e20 3d3d 2027 4d6f  claration == 'Mo
-00015ef0: 6469 6669 6572 7327 2c20 2753 6563 7572  difiers', 'Secur
-00015f00: 6974 7920 6f75 7470 7574 2069 7320 696e  ity output is in
-00015f10: 2069 6e63 6f72 7265 6374 2066 6f72 6d61   incorrect forma
-00015f20: 7427 0d0a 2020 2020 2020 2020 2020 2020  t'..            
-00015f30: 6173 7365 7274 2076 6965 7765 725f 6465  assert viewer_de
-00015f40: 636c 6172 6174 696f 6e20 3d3d 2027 5669  claration == 'Vi
-00015f50: 6577 6572 7327 2c20 2753 6563 7572 6974  ewers', 'Securit
-00015f60: 7920 6f75 7470 7574 2069 7320 696e 2069  y output is in i
-00015f70: 6e63 6f72 7265 6374 2066 6f72 6d61 7427  ncorrect format'
-00015f80: 0d0a 2020 2020 2020 2020 2020 2020 6173  ..            as
-00015f90: 7365 7274 2064 6174 615f 7669 6577 6572  sert data_viewer
-00015fa0: 5f64 6563 6c61 7261 7469 6f6e 203d 3d20  _declaration == 
-00015fb0: 2744 6174 6120 5669 6577 6572 7327 2c20  'Data Viewers', 
-00015fc0: 2753 6563 7572 6974 7920 6f75 7470 7574  'Security output
-00015fd0: 2069 7320 696e 2069 6e63 6f72 7265 6374   is in incorrect
-00015fe0: 2066 6f72 6d61 7427 0d0a 0d0a 2020 2020   format'....    
-00015ff0: 2020 2020 2020 2020 6d6f 6469 6669 6572          modifier
-00016000: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
-00016010: 2020 2020 6966 206d 6f64 6966 6965 725f      if modifier_
-00016020: 6675 6e63 7469 6f6e 203d 3d20 2753 6574  function == 'Set
-00016030: 273a 0d0a 0d0a 2020 2020 2020 2020 2020  ':....          
-00016040: 2020 2020 2020 6d6f 6469 6669 6572 5f6c        modifier_l
-00016050: 6973 7420 3d20 6d6f 6469 6669 6572 5f6c  ist = modifier_l
-00016060: 6973 745f 7374 7269 6e67 2e73 706c 6974  ist_string.split
-00016070: 2827 2b27 290d 0a0d 0a20 2020 2020 2020  ('+')....       
-00016080: 2020 2020 2020 2020 2066 6f72 206d 6f64           for mod
-00016090: 6966 6965 7220 696e 206d 6f64 6966 6965  ifier in modifie
-000160a0: 725f 6c69 7374 3a0d 0a20 2020 2020 2020  r_list:..       
-000160b0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-000160c0: 6966 6965 725f 7061 7274 7320 3d20 6d6f  ifier_parts = mo
-000160d0: 6469 6669 6572 2e73 706c 6974 2827 2827  difier.split('('
-000160e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-000160f0: 2020 2020 2020 206d 6f64 6966 6965 725f         modifier_
-00016100: 7363 203d 2027 2827 2e6a 6f69 6e28 6d6f  sc = '('.join(mo
-00016110: 6469 6669 6572 5f70 6172 7473 5b3a 2d31  difier_parts[:-1
-00016120: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00016130: 2020 2020 2020 2020 2347 6574 2074 6865          #Get the
-00016140: 206c 6173 7420 6269 7420 6166 7465 7220   last bit after 
-00016150: 6120 6f70 656e 2062 7261 636b 6574 2c20  a open bracket, 
-00016160: 7468 656e 2073 7472 6970 2074 6865 2063  then strip the c
-00016170: 6c6f 7365 2062 7261 636b 6574 206f 6666  lose bracket off
-00016180: 2074 6865 2065 6e64 0d0a 2020 2020 2020   the end..      
-00016190: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-000161a0: 6469 6669 6572 5f70 6879 7369 6420 3d20  difier_physid = 
-000161b0: 6d6f 6469 6669 6572 5f70 6172 7473 5b2d  modifier_parts[-
-000161c0: 315d 5b3a 2d31 5d2e 7265 706c 6163 6528  1][:-1].replace(
-000161d0: 2729 272c 2727 290d 0a0d 0a20 2020 2020  ')','')....     
-000161e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000161f0: 6f64 6966 6965 7273 2e61 7070 656e 6428  odifiers.append(
-00016200: 286d 6f64 6966 6965 725f 7363 2c69 6e74  (modifier_sc,int
-00016210: 286d 6f64 6966 6965 725f 7068 7973 6964  (modifier_physid
-00016220: 2929 290d 0a0d 0a20 2020 2020 2020 2020  )))....         
-00016230: 2020 2076 6965 7765 7273 203d 205b 5d0d     viewers = [].
-00016240: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00016250: 7669 6577 6572 5f66 756e 6374 696f 6e20  viewer_function 
-00016260: 3d3d 2027 5365 7427 3a0d 0a0d 0a20 2020  == 'Set':....   
-00016270: 2020 2020 2020 2020 2020 2020 2076 6965               vie
-00016280: 7765 725f 6c69 7374 203d 2076 6965 7765  wer_list = viewe
-00016290: 725f 6c69 7374 5f73 7472 696e 672e 7370  r_list_string.sp
-000162a0: 6c69 7428 272b 2729 0d0a 0d0a 2020 2020  lit('+')....    
-000162b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000162c0: 7669 6577 6572 2069 6e20 7669 6577 6572  viewer in viewer
-000162d0: 5f6c 6973 743a 0d0a 2020 2020 2020 2020  _list:..        
-000162e0: 2020 2020 2020 2020 2020 2020 7669 6577              view
-000162f0: 6572 5f70 6172 7473 203d 2076 6965 7765  er_parts = viewe
-00016300: 722e 7370 6c69 7428 2728 2729 0d0a 2020  r.split('(')..  
-00016310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016320: 2020 7669 6577 6572 5f73 6320 3d20 2728    viewer_sc = '(
-00016330: 272e 6a6f 696e 2876 6965 7765 725f 7061  '.join(viewer_pa
-00016340: 7274 735b 3a2d 315d 290d 0a20 2020 2020  rts[:-1])..     
-00016350: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00016360: 4765 7420 7468 6520 6c61 7374 2062 6974  Get the last bit
-00016370: 2061 6674 6572 2061 206f 7065 6e20 6272   after a open br
-00016380: 6163 6b65 742c 2074 6865 6e20 7374 7269  acket, then stri
-00016390: 7020 7468 6520 636c 6f73 6520 6272 6163  p the close brac
-000163a0: 6b65 7420 6f66 6620 7468 6520 656e 640d  ket off the end.
-000163b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000163c0: 2020 2020 2076 6965 7765 725f 7068 7973       viewer_phys
-000163d0: 6964 203d 2076 6965 7765 725f 7061 7274  id = viewer_part
-000163e0: 735b 2d31 5d5b 3a2d 315d 2e72 6570 6c61  s[-1][:-1].repla
-000163f0: 6365 2827 2927 2c27 2729 0d0a 0d0a 2020  ce(')','')....  
-00016400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016410: 2020 7669 6577 6572 732e 6170 7065 6e64    viewers.append
-00016420: 2828 7669 6577 6572 5f73 632c 696e 7428  ((viewer_sc,int(
-00016430: 7669 6577 6572 5f70 6879 7369 6429 2929  viewer_physid)))
-00016440: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00016450: 6461 7461 5f76 6965 7765 7273 203d 205b  data_viewers = [
-00016460: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
-00016470: 6620 6461 7461 5f76 6965 7765 725f 6675  f data_viewer_fu
-00016480: 6e63 7469 6f6e 203d 3d20 2753 6574 273a  nction == 'Set':
-00016490: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000164a0: 2020 2020 6461 7461 5f76 6965 7765 725f      data_viewer_
-000164b0: 6c69 7374 203d 2064 6174 615f 7669 6577  list = data_view
-000164c0: 6572 5f6c 6973 745f 7374 7269 6e67 2e73  er_list_string.s
-000164d0: 706c 6974 2827 2b27 290d 0a0d 0a20 2020  plit('+')....   
-000164e0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-000164f0: 2064 6174 615f 7669 6577 6572 2069 6e20   data_viewer in 
-00016500: 6461 7461 5f76 6965 7765 725f 6c69 7374  data_viewer_list
-00016510: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00016520: 2020 2020 2020 2064 6174 615f 7669 6577         data_view
-00016530: 6572 5f70 6172 7473 203d 2064 6174 615f  er_parts = data_
-00016540: 7669 6577 6572 2e73 706c 6974 2827 2827  viewer.split('('
-00016550: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00016560: 2020 2020 2020 2064 6174 615f 7669 6577         data_view
-00016570: 6572 5f73 6320 3d20 2728 272e 6a6f 696e  er_sc = '('.join
-00016580: 2864 6174 615f 7669 6577 6572 5f70 6172  (data_viewer_par
-00016590: 7473 5b3a 2d31 5d29 0d0a 2020 2020 2020  ts[:-1])..      
-000165a0: 2020 2020 2020 2020 2020 2020 2020 2347                #G
-000165b0: 6574 2074 6865 206c 6173 7420 6269 7420  et the last bit 
-000165c0: 6166 7465 7220 6120 6f70 656e 2062 7261  after a open bra
-000165d0: 636b 6574 2c20 7468 656e 2073 7472 6970  cket, then strip
-000165e0: 2074 6865 2063 6c6f 7365 2062 7261 636b   the close brack
-000165f0: 6574 206f 6666 2074 6865 2065 6e64 0d0a  et off the end..
-00016600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016610: 2020 2020 6461 7461 5f76 6965 7765 725f      data_viewer_
-00016620: 7068 7973 6964 203d 2064 6174 615f 7669  physid = data_vi
-00016630: 6577 6572 5f70 6172 7473 5b2d 315d 5b3a  ewer_parts[-1][:
-00016640: 2d31 5d2e 7265 706c 6163 6528 2729 272c  -1].replace(')',
-00016650: 2727 290d 0a0d 0a20 2020 2020 2020 2020  '')....         
-00016660: 2020 2020 2020 2020 2020 2064 6174 615f             data_
-00016670: 7669 6577 6572 732e 6170 7065 6e64 2828  viewers.append((
-00016680: 6461 7461 5f76 6965 7765 725f 7363 2c69  data_viewer_sc,i
-00016690: 6e74 2864 6174 615f 7669 6577 6572 5f70  nt(data_viewer_p
-000166a0: 6879 7369 6429 2929 0d0a 0d0a 2020 2020  hysid)))....    
-000166b0: 2020 2020 2020 2020 6966 206e 6f74 2028          if not (
-000166c0: 6d6f 6469 6669 6572 5f66 756e 6374 696f  modifier_functio
-000166d0: 6e20 3d3d 2027 436c 6561 7227 2061 6e64  n == 'Clear' and
-000166e0: 2076 6965 7765 725f 6675 6e63 7469 6f6e   viewer_function
-000166f0: 203d 3d20 2743 6c65 6172 2720 616e 6420   == 'Clear' and 
-00016700: 6461 7461 5f76 6965 7765 725f 6675 6e63  data_viewer_func
-00016710: 7469 6f6e 203d 3d20 2743 6c65 6172 2729  tion == 'Clear')
-00016720: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
-00016730: 2020 2020 2065 6c20 3d20 7365 6c66 2e5f       el = self._
-00016740: 656c 656d 656e 7473 5b65 6c65 6d65 6e74  elements[element
-00016750: 5f73 635d 0d0a 0d0a 2020 2020 2020 2020  _sc]....        
-00016760: 2020 2020 2020 2020 2344 6f20 7468 6973          #Do this
-00016770: 2061 7373 6572 7469 6f6e 2074 6f20 6d61   assertion to ma
-00016780: 6b65 2073 7572 6520 7765 2776 6520 7265  ke sure we've re
-00016790: 6164 2074 6865 2073 686f 7274 636f 6465  ad the shortcode
-000167a0: 2063 6f72 7265 6374 6c79 0d0a 2020 2020   correctly..    
-000167b0: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-000167c0: 7274 2065 6c2e 7068 7973 6964 203d 3d20  rt el.physid == 
-000167d0: 656c 656d 656e 745f 7068 7973 6964 0d0a  element_physid..
-000167e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000167f0: 2020 2354 4f44 4f20 2d20 7768 656e 2077    #TODO - when w
-00016800: 6520 6361 6e20 6765 7420 7573 6572 7320  e can get users 
-00016810: 6672 6f6d 2061 2073 6974 652c 2061 7373  from a site, ass
-00016820: 6572 7420 7468 6569 7220 7068 7973 6964  ert their physid
-00016830: 206d 6174 6368 6573 2074 6865 2073 6372   matches the scr
-00016840: 6170 6564 2070 6879 7369 640d 0a0d 0a20  aped physid.... 
-00016850: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00016860: 6966 2065 6c65 6d65 6e74 5f73 6320 3d3d  if element_sc ==
-00016870: 2027 4d61 6e61 6765 6d65 6e27 3a0d 0a20   'Managemen':.. 
-00016880: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00016890: 2020 2020 7072 696e 7428 6461 7461 5f76      print(data_v
-000168a0: 6965 7765 7273 2c76 6965 7765 7273 2c6d  iewers,viewers,m
-000168b0: 6f64 6966 6965 7273 290d 0a0d 0a20 2020  odifiers)....   
-000168c0: 2020 2020 2020 2020 2020 2020 2065 6c2e               el.
-000168d0: 5f73 6563 7572 6974 7920 3d20 456c 656d  _security = Elem
-000168e0: 656e 7453 6563 7572 6974 7928 656c 656d  entSecurity(elem
-000168f0: 656e 7420 2020 2020 2020 2020 2020 2020  ent             
-00016900: 2020 2020 203d 2065 6c0d 0a20 2020 2020       = el..     
-00016910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015310: 290d 0a20 2020 2020 2020 2065 7863 6570  )..        excep
+00015320: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00015330: 7365 6c66 2e5f 656c 656d 656e 7473 5f72  self._elements_r
+00015340: 6561 6420 3d20 4661 6c73 650d 0a20 2020  ead = False..   
+00015350: 2020 2020 2020 2020 2072 6169 7365 0d0a           raise..
+00015360: 0d0a 2020 2020 6465 6620 5f6c 6f61 645f  ..    def _load_
+00015370: 7365 6375 7269 7479 2873 656c 6629 3a0d  security(self):.
+00015380: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
+00015390: 6c66 2e5f 7365 6375 7269 7479 5f72 6561  lf._security_rea
+000153a0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+000153b0: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
+000153c0: 2020 6966 206e 6f74 2073 656c 662e 5f65    if not self._e
+000153d0: 6c65 6d65 6e74 735f 7265 6164 3a0d 0a20  lements_read:.. 
+000153e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000153f0: 5f6c 6f61 645f 656c 656d 656e 7473 2829  _load_elements()
+00015400: 0d0a 0d0a 2020 2020 2020 2020 6966 2073  ....        if s
+00015410: 656c 662e 6469 6d65 6e73 696f 6e2e 6c6f  elf.dimension.lo
+00015420: 6e67 6e61 6d65 2069 7320 4e6f 6e65 3a0d  ngname is None:.
+00015430: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00015440: 7365 2056 616c 7565 4572 726f 7228 2743  se ValueError('C
+00015450: 616e 6e6f 7420 696d 706f 7274 2064 696d  annot import dim
+00015460: 656e 7369 6f6e 2073 6563 7572 6974 7920  ension security 
+00015470: 756e 7469 6c20 7468 6520 2e6c 6f6e 676e  until the .longn
+00015480: 616d 6520 7072 6f70 6572 7479 206f 6620  ame property of 
+00015490: 6469 6d65 6e73 696f 6e20 7b7d 2068 6173  dimension {} has
+000154a0: 2062 6565 6e20 7365 7427 2e66 6f72 6d61   been set'.forma
+000154b0: 7428 7365 6c66 2e64 696d 656e 7369 6f6e  t(self.dimension
+000154c0: 2e69 6e64 6578 2929 0d0a 0d0a 2020 2020  .index))....    
+000154d0: 2020 2020 6c6f 672e 7665 7262 6f73 6528      log.verbose(
+000154e0: 2752 6561 6469 6e67 2045 6c65 6d65 6e74  'Reading Element
+000154f0: 2053 6563 7572 6974 7920 666f 7220 6469   Security for di
+00015500: 6d65 6e73 696f 6e5b 7b7d 5d27 2e66 6f72  mension[{}]'.for
+00015510: 6d61 7428 7365 6c66 2e64 696d 656e 7369  mat(self.dimensi
+00015520: 6f6e 2e69 6e64 6578 2929 0d0a 0d0a 2020  on.index))....  
+00015530: 2020 2020 2020 2370 756c 6c20 7468 6520        #pull the 
+00015540: 6461 7461 2069 6e20 616e 6420 7365 7420  data in and set 
+00015550: 7365 6375 7269 7479 0d0a 2020 2020 2020  security..      
+00015560: 2020 7365 6375 7269 7479 5f64 6174 6120    security_data 
+00015570: 3d20 5b5d 0d0a 0d0a 2020 2020 2020 2020  = []....        
+00015580: 636f 6d6d 616e 645f 6c69 7374 203d 2073  command_list = s
+00015590: 656c 662e 6469 6d65 6e73 696f 6e2e 7369  elf.dimension.si
+000155a0: 7465 2e5f 6c6f 676f 6e5f 7061 7261 6d65  te._logon_parame
+000155b0: 7465 725f 696d 706f 7274 6572 5f63 6f6d  ter_importer_com
+000155c0: 6d61 6e64 7320 2b20 5c0d 0a20 2020 2020  mands + \..     
+000155d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155e0: 2020 5b27 7365 742d 7061 7261 6d65 7465    ['set-paramete
+000155f0: 7220 6469 6d65 6e73 696f 6e6e 616d 653d  r dimensionname=
+00015600: 2720 2020 2020 202b 2073 656c 662e 6469  '      + self.di
+00015610: 6d65 6e73 696f 6e2e 6c6f 6e67 6e61 6d65  mension.longname
+00015620: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00015630: 2020 2020 2020 2020 202c 2765 6d70 6f77           ,'empow
+00015640: 6572 2d65 7870 6f72 742d 7365 6375 7269  er-export-securi
+00015650: 7479 2d73 6574 7469 6e67 7320 2224 7b73  ty-settings "${s
+00015660: 6974 657d 2220 2224 7b75 7365 727d 2220  ite}" "${user}" 
+00015670: 2224 7b70 6173 7377 6f72 647d 2220 2224  "${password}" "$
+00015680: 7b64 696d 656e 7369 6f6e 6e61 6d65 7d22  {dimensionname}"
+00015690: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
+000156a0: 2020 2020 2020 2020 2020 2c27 6f75 7470            ,'outp
+000156b0: 7574 270d 0a20 2020 2020 2020 2020 2020  ut'..           
+000156c0: 2020 2020 2020 2020 2020 2020 5d0d 0a0d              ]...
+000156d0: 0a20 2020 2020 2020 206f 7574 7075 7420  .        output 
+000156e0: 3d20 6c6c 752e 7275 6e5f 7369 6e67 6c65  = llu.run_single
+000156f0: 5f6f 7574 7075 745f 696d 706f 7274 6572  _output_importer
+00015700: 5f63 6f6d 6d61 6e64 7328 636f 6d6d 616e  _commands(comman
+00015710: 645f 6c69 7374 2c65 6d70 6f77 6572 5f69  d_list,empower_i
+00015720: 6d70 6f72 7465 725f 6578 6563 7574 6162  mporter_executab
+00015730: 6c65 3d73 656c 662e 6469 6d65 6e73 696f  le=self.dimensio
+00015740: 6e2e 7369 7465 2e65 6d70 6f77 6572 5f69  n.site.empower_i
+00015750: 6d70 6f72 7465 725f 6578 6563 7574 6162  mporter_executab
+00015760: 6c65 290d 0a0d 0a20 2020 2020 2020 206d  le)....        m
+00015770: 616a 6f72 5f76 6572 7369 6f6e 2c20 6d69  ajor_version, mi
+00015780: 6e6f 725f 7665 7273 696f 6e2c 2072 656c  nor_version, rel
+00015790: 6561 7365 2c20 7265 6c65 6173 655f 6e75  ease, release_nu
+000157a0: 6d62 6572 203d 2073 656c 662e 6469 6d65  mber = self.dime
+000157b0: 6e73 696f 6e2e 7369 7465 2e69 6d70 6f72  nsion.site.impor
+000157c0: 7465 725f 7665 7273 696f 6e0d 0a0d 0a20  ter_version.... 
+000157d0: 2020 2020 2020 2023 496e 206f 6c64 6572         #In older
+000157e0: 2076 6572 7369 6f6e 7320 6f66 2049 6d70   versions of Imp
+000157f0: 6f72 7465 7220 7468 6572 6520 7761 7320  orter there was 
+00015800: 736f 6d65 2077 6569 7264 2064 6f75 626c  some weird doubl
+00015810: 6520 7175 6f74 6573 2069 6e20 7468 6520  e quotes in the 
+00015820: 6f75 7470 7574 0d0a 2020 2020 2020 2020  output..        
+00015830: 6966 2028 6d61 6a6f 725f 7665 7273 696f  if (major_versio
+00015840: 6e20 3d3d 2039 2061 6e64 2028 7265 6c65  n == 9 and (rele
+00015850: 6173 655f 6e75 6d62 6572 203e 3d20 3137  ase_number >= 17
+00015860: 3234 206f 7220 6d69 6e6f 725f 7665 7273  24 or minor_vers
+00015870: 696f 6e20 3e3d 3729 2920 6f72 206d 616a  ion >=7)) or maj
+00015880: 6f72 5f76 6572 7369 6f6e 203e 2039 3a0d  or_version > 9:.
+00015890: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+000158a0: 206e 2c20 6c69 6e65 2069 6e20 656e 756d   n, line in enum
+000158b0: 6572 6174 6528 6f75 7470 7574 2e73 706c  erate(output.spl
+000158c0: 6974 2827 5c6e 2729 293a 0d0a 2020 2020  it('\n')):..    
+000158d0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000158e0: 203e 2030 2061 6e64 206c 656e 286c 696e   > 0 and len(lin
+000158f0: 6529 203e 2030 3a0d 0a20 2020 2020 2020  e) > 0:..       
+00015900: 2020 2020 2020 2020 2020 2020 2073 6563               sec
+00015910: 7572 6974 795f 6461 7461 2e61 7070 656e  urity_data.appen
+00015920: 6428 6c69 6e65 2e73 706c 6974 2827 5c74  d(line.split('\t
+00015930: 2729 290d 0a20 2020 2020 2020 2065 6c73  '))..        els
+00015940: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00015950: 666f 7220 6e2c 206c 696e 6520 696e 2065  for n, line in e
+00015960: 6e75 6d65 7261 7465 286f 7574 7075 742e  numerate(output.
+00015970: 7370 6c69 7428 275c 6e27 2929 3a0d 0a20  split('\n')):.. 
+00015980: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00015990: 6620 6e20 3e20 3020 616e 6420 6c65 6e28  f n > 0 and len(
+000159a0: 6c69 6e65 2920 3e20 303a 0d0a 2020 2020  line) > 0:..    
+000159b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000159c0: 2353 7472 6970 206f 6666 2064 6f75 626c  #Strip off doubl
+000159d0: 6520 7175 6f74 6573 2061 6e64 2063 6172  e quotes and car
+000159e0: 7269 6167 6520 7265 7475 726e 0d0a 2020  riage return..  
+000159f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a00: 2020 6173 7365 7274 206c 696e 655b 305d    assert line[0]
+00015a10: 3d3d 2722 270d 0a20 2020 2020 2020 2020  =='"'..         
+00015a20: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00015a30: 7420 6c69 6e65 5b2d 325d 3d3d 2722 270d  t line[-2]=='"'.
+00015a40: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00015a50: 2020 2020 2020 2073 6563 7572 6974 795f         security_
+00015a60: 6461 7461 2e61 7070 656e 6428 6c69 6e65  data.append(line
+00015a70: 5b31 3a2d 325d 2e73 706c 6974 2827 5c74  [1:-2].split('\t
+00015a80: 2729 290d 0a0d 0a0d 0a20 2020 2020 2020  '))......       
+00015a90: 2066 6f72 2064 6174 756d 2069 6e20 7365   for datum in se
+00015aa0: 6375 7269 7479 5f64 6174 613a 0d0a 0d0a  curity_data:....
+00015ab0: 2020 2020 2020 2020 2020 2020 6469 6d65              dime
+00015ac0: 6e73 696f 6e5f 6e61 6d65 203d 2064 6174  nsion_name = dat
+00015ad0: 756d 5b30 5d0d 0a0d 0a20 2020 2020 2020  um[0]....       
+00015ae0: 2020 2020 2023 446f 2074 6869 7320 6173       #Do this as
+00015af0: 7365 7274 696f 6e20 746f 206d 616b 6520  sertion to make 
+00015b00: 6865 6c70 2061 7373 7572 6520 7765 2776  help assure we'v
+00015b10: 6520 7265 6164 2074 6865 2064 6174 6120  e read the data 
+00015b20: 636f 7272 6563 746c 790d 0a20 2020 2020  correctly..     
+00015b30: 2020 2020 2020 2061 7373 6572 7420 7365         assert se
+00015b40: 6c66 2e64 696d 656e 7369 6f6e 2e6c 6f6e  lf.dimension.lon
+00015b50: 676e 616d 6520 3d3d 2064 696d 656e 7369  gname == dimensi
+00015b60: 6f6e 5f6e 616d 652c 2027 4469 6d65 6e73  on_name, 'Dimens
+00015b70: 696f 6e20 6e61 6d65 2064 696d 656e 7369  ion name dimensi
+00015b80: 6f6e 2e6c 6f6e 676e 616d 6520 227b 7d22  on.longname "{}"
+00015b90: 206d 7573 7420 6d61 7463 6820 6f75 7470   must match outp
+00015ba0: 7574 2066 726f 6d20 496d 706f 7274 6572  ut from Importer
+00015bb0: 2022 7b7d 2227 2e66 6f72 6d61 7428 7365   "{}"'.format(se
+00015bc0: 6c66 2e64 696d 656e 7369 6f6e 2e6c 6f6e  lf.dimension.lon
+00015bd0: 676e 616d 652c 2064 696d 656e 7369 6f6e  gname, dimension
+00015be0: 5f6e 616d 6529 0d0a 0d0a 2020 2020 2020  _name)....      
+00015bf0: 2020 2020 2020 656c 656d 656e 745f 6964        element_id
+00015c00: 656e 7469 6669 6572 7320 3d20 6461 7475  entifiers = datu
+00015c10: 6d5b 315d 0d0a 2020 2020 2020 2020 2020  m[1]..          
+00015c20: 2020 6d6f 6469 6669 6572 5f64 6563 6c61    modifier_decla
+00015c30: 7261 7469 6f6e 203d 2064 6174 756d 5b32  ration = datum[2
+00015c40: 5d0d 0a20 2020 2020 2020 2020 2020 206d  ]..            m
+00015c50: 6f64 6966 6965 725f 6675 6e63 7469 6f6e  odifier_function
+00015c60: 203d 2064 6174 756d 5b33 5d0d 0a20 2020   = datum[3]..   
+00015c70: 2020 2020 2020 2020 206d 6f64 6966 6965           modifie
+00015c80: 725f 6c69 7374 5f73 7472 696e 6720 3d20  r_list_string = 
+00015c90: 6461 7475 6d5b 345d 0d0a 2020 2020 2020  datum[4]..      
+00015ca0: 2020 2020 2020 7669 6577 6572 5f64 6563        viewer_dec
+00015cb0: 6c61 7261 7469 6f6e 203d 2064 6174 756d  laration = datum
+00015cc0: 5b35 5d0d 0a20 2020 2020 2020 2020 2020  [5]..           
+00015cd0: 2076 6965 7765 725f 6675 6e63 7469 6f6e   viewer_function
+00015ce0: 203d 2064 6174 756d 5b36 5d0d 0a20 2020   = datum[6]..   
+00015cf0: 2020 2020 2020 2020 2076 6965 7765 725f           viewer_
+00015d00: 6c69 7374 5f73 7472 696e 6720 3d20 6461  list_string = da
+00015d10: 7475 6d5b 375d 0d0a 2020 2020 2020 2020  tum[7]..        
+00015d20: 2020 2020 6461 7461 5f76 6965 7765 725f      data_viewer_
+00015d30: 6465 636c 6172 6174 696f 6e20 3d20 6461  declaration = da
+00015d40: 7475 6d5b 385d 0d0a 2020 2020 2020 2020  tum[8]..        
+00015d50: 2020 2020 6461 7461 5f76 6965 7765 725f      data_viewer_
+00015d60: 6675 6e63 7469 6f6e 203d 2064 6174 756d  function = datum
+00015d70: 5b39 5d0d 0a20 2020 2020 2020 2020 2020  [9]..           
+00015d80: 2064 6174 615f 7669 6577 6572 5f6c 6973   data_viewer_lis
+00015d90: 745f 7374 7269 6e67 203d 2064 6174 756d  t_string = datum
+00015da0: 5b31 305d 0d0a 0d0a 2020 2020 2020 2020  [10]....        
+00015db0: 2020 2020 656c 656d 656e 745f 6964 656e      element_iden
+00015dc0: 7469 6669 6572 5f70 6172 7473 203d 2065  tifier_parts = e
+00015dd0: 6c65 6d65 6e74 5f69 6465 6e74 6966 6965  lement_identifie
+00015de0: 7273 2e73 706c 6974 2827 2827 290d 0a20  rs.split('(').. 
+00015df0: 2020 2020 2020 2020 2020 2065 6c65 6d65             eleme
+00015e00: 6e74 5f73 6320 3d20 2728 272e 6a6f 696e  nt_sc = '('.join
+00015e10: 2865 6c65 6d65 6e74 5f69 6465 6e74 6966  (element_identif
+00015e20: 6965 725f 7061 7274 735b 3a2d 315d 292e  ier_parts[:-1]).
+00015e30: 7374 7269 7028 290d 0a20 2020 2020 2020  strip()..       
+00015e40: 2020 2020 2023 4765 7420 7468 6520 6c61       #Get the la
+00015e50: 7374 2062 6974 2061 6674 6572 2061 206f  st bit after a o
+00015e60: 7065 6e20 6272 6163 6b65 742c 2074 6865  pen bracket, the
+00015e70: 6e20 7374 7269 7020 7468 6520 636c 6f73  n strip the clos
+00015e80: 6520 6272 6163 6b65 7420 6f66 6620 7468  e bracket off th
+00015e90: 6520 656e 640d 0a20 2020 2020 2020 2020  e end..         
+00015ea0: 2020 2065 6c65 6d65 6e74 5f70 6879 7369     element_physi
+00015eb0: 6420 3d20 696e 7428 656c 656d 656e 745f  d = int(element_
+00015ec0: 6964 656e 7469 6669 6572 5f70 6172 7473  identifier_parts
+00015ed0: 5b2d 315d 5b3a 2d31 5d2e 7265 706c 6163  [-1][:-1].replac
+00015ee0: 6528 2729 272c 2727 2929 0d0a 0d0a 2020  e(')',''))....  
+00015ef0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00015f00: 206d 6f64 6966 6965 725f 6465 636c 6172   modifier_declar
+00015f10: 6174 696f 6e20 3d3d 2027 4d6f 6469 6669  ation == 'Modifi
+00015f20: 6572 7327 2c20 2753 6563 7572 6974 7920  ers', 'Security 
+00015f30: 6f75 7470 7574 2069 7320 696e 2069 6e63  output is in inc
+00015f40: 6f72 7265 6374 2066 6f72 6d61 7427 0d0a  orrect format'..
+00015f50: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00015f60: 7274 2076 6965 7765 725f 6465 636c 6172  rt viewer_declar
+00015f70: 6174 696f 6e20 3d3d 2027 5669 6577 6572  ation == 'Viewer
+00015f80: 7327 2c20 2753 6563 7572 6974 7920 6f75  s', 'Security ou
+00015f90: 7470 7574 2069 7320 696e 2069 6e63 6f72  tput is in incor
+00015fa0: 7265 6374 2066 6f72 6d61 7427 0d0a 2020  rect format'..  
+00015fb0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00015fc0: 2064 6174 615f 7669 6577 6572 5f64 6563   data_viewer_dec
+00015fd0: 6c61 7261 7469 6f6e 203d 3d20 2744 6174  laration == 'Dat
+00015fe0: 6120 5669 6577 6572 7327 2c20 2753 6563  a Viewers', 'Sec
+00015ff0: 7572 6974 7920 6f75 7470 7574 2069 7320  urity output is 
+00016000: 696e 2069 6e63 6f72 7265 6374 2066 6f72  in incorrect for
+00016010: 6d61 7427 0d0a 0d0a 2020 2020 2020 2020  mat'....        
+00016020: 2020 2020 6d6f 6469 6669 6572 7320 3d20      modifiers = 
+00016030: 5b5d 0d0a 2020 2020 2020 2020 2020 2020  []..            
+00016040: 6966 206d 6f64 6966 6965 725f 6675 6e63  if modifier_func
+00016050: 7469 6f6e 203d 3d20 2753 6574 273a 0d0a  tion == 'Set':..
+00016060: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016070: 2020 6d6f 6469 6669 6572 5f6c 6973 7420    modifier_list 
+00016080: 3d20 6d6f 6469 6669 6572 5f6c 6973 745f  = modifier_list_
+00016090: 7374 7269 6e67 2e73 706c 6974 2827 2b27  string.split('+'
+000160a0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+000160b0: 2020 2020 2066 6f72 206d 6f64 6966 6965       for modifie
+000160c0: 7220 696e 206d 6f64 6966 6965 725f 6c69  r in modifier_li
+000160d0: 7374 3a0d 0a20 2020 2020 2020 2020 2020  st:..           
+000160e0: 2020 2020 2020 2020 206d 6f64 6966 6965           modifie
+000160f0: 725f 7061 7274 7320 3d20 6d6f 6469 6669  r_parts = modifi
+00016100: 6572 2e73 706c 6974 2827 2827 290d 0a20  er.split('(').. 
+00016110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016120: 2020 206d 6f64 6966 6965 725f 7363 203d     modifier_sc =
+00016130: 2027 2827 2e6a 6f69 6e28 6d6f 6469 6669   '('.join(modifi
+00016140: 6572 5f70 6172 7473 5b3a 2d31 5d29 0d0a  er_parts[:-1])..
+00016150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016160: 2020 2020 2347 6574 2074 6865 206c 6173      #Get the las
+00016170: 7420 6269 7420 6166 7465 7220 6120 6f70  t bit after a op
+00016180: 656e 2062 7261 636b 6574 2c20 7468 656e  en bracket, then
+00016190: 2073 7472 6970 2074 6865 2063 6c6f 7365   strip the close
+000161a0: 2062 7261 636b 6574 206f 6666 2074 6865   bracket off the
+000161b0: 2065 6e64 0d0a 2020 2020 2020 2020 2020   end..          
+000161c0: 2020 2020 2020 2020 2020 6d6f 6469 6669            modifi
+000161d0: 6572 5f70 6879 7369 6420 3d20 6d6f 6469  er_physid = modi
+000161e0: 6669 6572 5f70 6172 7473 5b2d 315d 5b3a  fier_parts[-1][:
+000161f0: 2d31 5d2e 7265 706c 6163 6528 2729 272c  -1].replace(')',
+00016200: 2727 290d 0a0d 0a20 2020 2020 2020 2020  '')....         
+00016210: 2020 2020 2020 2020 2020 206d 6f64 6966             modif
+00016220: 6965 7273 2e61 7070 656e 6428 286d 6f64  iers.append((mod
+00016230: 6966 6965 725f 7363 2c69 6e74 286d 6f64  ifier_sc,int(mod
+00016240: 6966 6965 725f 7068 7973 6964 2929 290d  ifier_physid))).
+00016250: 0a0d 0a20 2020 2020 2020 2020 2020 2076  ...            v
+00016260: 6965 7765 7273 203d 205b 5d0d 0a20 2020  iewers = []..   
+00016270: 2020 2020 2020 2020 2069 6620 7669 6577           if view
+00016280: 6572 5f66 756e 6374 696f 6e20 3d3d 2027  er_function == '
+00016290: 5365 7427 3a0d 0a0d 0a20 2020 2020 2020  Set':....       
+000162a0: 2020 2020 2020 2020 2076 6965 7765 725f           viewer_
+000162b0: 6c69 7374 203d 2076 6965 7765 725f 6c69  list = viewer_li
+000162c0: 7374 5f73 7472 696e 672e 7370 6c69 7428  st_string.split(
+000162d0: 272b 2729 0d0a 0d0a 2020 2020 2020 2020  '+')....        
+000162e0: 2020 2020 2020 2020 666f 7220 7669 6577          for view
+000162f0: 6572 2069 6e20 7669 6577 6572 5f6c 6973  er in viewer_lis
+00016300: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00016310: 2020 2020 2020 2020 7669 6577 6572 5f70          viewer_p
+00016320: 6172 7473 203d 2076 6965 7765 722e 7370  arts = viewer.sp
+00016330: 6c69 7428 2728 2729 0d0a 2020 2020 2020  lit('(')..      
+00016340: 2020 2020 2020 2020 2020 2020 2020 7669                vi
+00016350: 6577 6572 5f73 6320 3d20 2728 272e 6a6f  ewer_sc = '('.jo
+00016360: 696e 2876 6965 7765 725f 7061 7274 735b  in(viewer_parts[
+00016370: 3a2d 315d 290d 0a20 2020 2020 2020 2020  :-1])..         
+00016380: 2020 2020 2020 2020 2020 2023 4765 7420             #Get 
+00016390: 7468 6520 6c61 7374 2062 6974 2061 6674  the last bit aft
+000163a0: 6572 2061 206f 7065 6e20 6272 6163 6b65  er a open bracke
+000163b0: 742c 2074 6865 6e20 7374 7269 7020 7468  t, then strip th
+000163c0: 6520 636c 6f73 6520 6272 6163 6b65 7420  e close bracket 
+000163d0: 6f66 6620 7468 6520 656e 640d 0a20 2020  off the end..   
+000163e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163f0: 2076 6965 7765 725f 7068 7973 6964 203d   viewer_physid =
+00016400: 2076 6965 7765 725f 7061 7274 735b 2d31   viewer_parts[-1
+00016410: 5d5b 3a2d 315d 2e72 6570 6c61 6365 2827  ][:-1].replace('
+00016420: 2927 2c27 2729 0d0a 0d0a 2020 2020 2020  )','')....      
+00016430: 2020 2020 2020 2020 2020 2020 2020 7669                vi
+00016440: 6577 6572 732e 6170 7065 6e64 2828 7669  ewers.append((vi
+00016450: 6577 6572 5f73 632c 696e 7428 7669 6577  ewer_sc,int(view
+00016460: 6572 5f70 6879 7369 6429 2929 0d0a 0d0a  er_physid)))....
+00016470: 2020 2020 2020 2020 2020 2020 6461 7461              data
+00016480: 5f76 6965 7765 7273 203d 205b 5d0d 0a20  _viewers = [].. 
+00016490: 2020 2020 2020 2020 2020 2069 6620 6461             if da
+000164a0: 7461 5f76 6965 7765 725f 6675 6e63 7469  ta_viewer_functi
+000164b0: 6f6e 203d 3d20 2753 6574 273a 0d0a 0d0a  on == 'Set':....
+000164c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164d0: 6461 7461 5f76 6965 7765 725f 6c69 7374  data_viewer_list
+000164e0: 203d 2064 6174 615f 7669 6577 6572 5f6c   = data_viewer_l
+000164f0: 6973 745f 7374 7269 6e67 2e73 706c 6974  ist_string.split
+00016500: 2827 2b27 290d 0a0d 0a20 2020 2020 2020  ('+')....       
+00016510: 2020 2020 2020 2020 2066 6f72 2064 6174           for dat
+00016520: 615f 7669 6577 6572 2069 6e20 6461 7461  a_viewer in data
+00016530: 5f76 6965 7765 725f 6c69 7374 3a0d 0a20  _viewer_list:.. 
+00016540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016550: 2020 2064 6174 615f 7669 6577 6572 5f70     data_viewer_p
+00016560: 6172 7473 203d 2064 6174 615f 7669 6577  arts = data_view
+00016570: 6572 2e73 706c 6974 2827 2827 290d 0a20  er.split('(').. 
+00016580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016590: 2020 2064 6174 615f 7669 6577 6572 5f73     data_viewer_s
+000165a0: 6320 3d20 2728 272e 6a6f 696e 2864 6174  c = '('.join(dat
+000165b0: 615f 7669 6577 6572 5f70 6172 7473 5b3a  a_viewer_parts[:
+000165c0: 2d31 5d29 0d0a 2020 2020 2020 2020 2020  -1])..          
+000165d0: 2020 2020 2020 2020 2020 2347 6574 2074            #Get t
+000165e0: 6865 206c 6173 7420 6269 7420 6166 7465  he last bit afte
+000165f0: 7220 6120 6f70 656e 2062 7261 636b 6574  r a open bracket
+00016600: 2c20 7468 656e 2073 7472 6970 2074 6865  , then strip the
+00016610: 2063 6c6f 7365 2062 7261 636b 6574 206f   close bracket o
+00016620: 6666 2074 6865 2065 6e64 0d0a 2020 2020  ff the end..    
+00016630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016640: 6461 7461 5f76 6965 7765 725f 7068 7973  data_viewer_phys
+00016650: 6964 203d 2064 6174 615f 7669 6577 6572  id = data_viewer
+00016660: 5f70 6172 7473 5b2d 315d 5b3a 2d31 5d2e  _parts[-1][:-1].
+00016670: 7265 706c 6163 6528 2729 272c 2727 290d  replace(')','').
+00016680: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00016690: 2020 2020 2020 2064 6174 615f 7669 6577         data_view
+000166a0: 6572 732e 6170 7065 6e64 2828 6461 7461  ers.append((data
+000166b0: 5f76 6965 7765 725f 7363 2c69 6e74 2864  _viewer_sc,int(d
+000166c0: 6174 615f 7669 6577 6572 5f70 6879 7369  ata_viewer_physi
+000166d0: 6429 2929 0d0a 0d0a 2020 2020 2020 2020  d)))....        
+000166e0: 2020 2020 6966 206e 6f74 2028 6d6f 6469      if not (modi
+000166f0: 6669 6572 5f66 756e 6374 696f 6e20 3d3d  fier_function ==
+00016700: 2027 436c 6561 7227 2061 6e64 2076 6965   'Clear' and vie
+00016710: 7765 725f 6675 6e63 7469 6f6e 203d 3d20  wer_function == 
+00016720: 2743 6c65 6172 2720 616e 6420 6461 7461  'Clear' and data
+00016730: 5f76 6965 7765 725f 6675 6e63 7469 6f6e  _viewer_function
+00016740: 203d 3d20 2743 6c65 6172 2729 3a0d 0a0d   == 'Clear'):...
+00016750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016760: 2065 6c20 3d20 7365 6c66 2e5f 656c 656d   el = self._elem
+00016770: 656e 7473 5b65 6c65 6d65 6e74 5f73 635d  ents[element_sc]
+00016780: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00016790: 2020 2020 2344 6f20 7468 6973 2061 7373      #Do this ass
+000167a0: 6572 7469 6f6e 2074 6f20 6d61 6b65 2073  ertion to make s
+000167b0: 7572 6520 7765 2776 6520 7265 6164 2074  ure we've read t
+000167c0: 6865 2073 686f 7274 636f 6465 2063 6f72  he shortcode cor
+000167d0: 7265 6374 6c79 0d0a 2020 2020 2020 2020  rectly..        
+000167e0: 2020 2020 2020 2020 6173 7365 7274 2065          assert e
+000167f0: 6c2e 7068 7973 6964 203d 3d20 656c 656d  l.physid == elem
+00016800: 656e 745f 7068 7973 6964 0d0a 0d0a 2020  ent_physid....  
+00016810: 2020 2020 2020 2020 2020 2020 2020 2354                #T
+00016820: 4f44 4f20 2d20 7768 656e 2077 6520 6361  ODO - when we ca
+00016830: 6e20 6765 7420 7573 6572 7320 6672 6f6d  n get users from
+00016840: 2061 2073 6974 652c 2061 7373 6572 7420   a site, assert 
+00016850: 7468 6569 7220 7068 7973 6964 206d 6174  their physid mat
+00016860: 6368 6573 2074 6865 2073 6372 6170 6564  ches the scraped
+00016870: 2070 6879 7369 640d 0a0d 0a20 2020 2020   physid....     
+00016880: 2020 2020 2020 2020 2020 2023 6966 2065             #if e
+00016890: 6c65 6d65 6e74 5f73 6320 3d3d 2027 4d61  lement_sc == 'Ma
+000168a0: 6e61 6765 6d65 6e27 3a0d 0a20 2020 2020  nagemen':..     
+000168b0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+000168c0: 7072 696e 7428 6461 7461 5f76 6965 7765  print(data_viewe
+000168d0: 7273 2c76 6965 7765 7273 2c6d 6f64 6966  rs,viewers,modif
+000168e0: 6965 7273 290d 0a0d 0a20 2020 2020 2020  iers)....       
+000168f0: 2020 2020 2020 2020 2065 6c2e 5f73 6563           el._sec
+00016900: 7572 6974 7920 3d20 456c 656d 656e 7453  urity = ElementS
+00016910: 6563 7572 6974 7928 656c 656d 656e 7420  ecurity(element 
 00016920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016930: 2020 2020 2020 2020 202c 6461 7461 5f76           ,data_v
-00016940: 6965 7765 7273 2020 2020 2020 2020 2020  iewers          
-00016950: 2020 203d 207b 6476 5f73 6320 666f 7220     = {dv_sc for 
-00016960: 6476 5f73 632c 2064 765f 7068 7973 6964  dv_sc, dv_physid
-00016970: 2069 6e20 6461 7461 5f76 6965 7765 7273   in data_viewers
-00016980: 7d0d 0a20 2020 2020 2020 2020 2020 2020  }..             
-00016990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000169a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000169b0: 202c 7669 6577 6572 7320 2020 2020 2020   ,viewers       
-000169c0: 2020 2020 2020 2020 2020 203d 207b 765f             = {v_
-000169d0: 7363 2020 666f 7220 765f 7363 2c20 2076  sc  for v_sc,  v
-000169e0: 5f70 6879 7369 6420 2069 6e20 7669 6577  _physid  in view
-000169f0: 6572 737d 0d0a 2020 2020 2020 2020 2020  ers}..          
-00016a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a20: 2020 2020 2c6d 6f64 6966 6965 7273 2020      ,modifiers  
-00016a30: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
-00016a40: 7b6d 5f73 6320 2066 6f72 206d 5f73 632c  {m_sc  for m_sc,
-00016a50: 2020 6d5f 7068 7973 6964 2020 696e 206d    m_physid  in m
-00016a60: 6f64 6966 6965 7273 7d0d 0a20 2020 2020  odifiers}..     
-00016a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016a90: 2020 2020 2020 2020 202c 696e 6974 6961           ,initia
-00016aa0: 6c69 7365 5f73 796e 6368 6564 2020 2020  lise_synched    
-00016ab0: 2020 203d 2054 7275 650d 0a20 2020 2020     = True..     
-00016ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ae0: 2020 2020 2020 2020 202c 696e 6974 6961           ,initia
-00016af0: 6c69 7365 5f61 735f 6465 6661 756c 7420  lise_as_default 
-00016b00: 2020 203d 2046 616c 7365 0d0a 2020 2020     = False..    
-00016b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b30: 2020 2020 2020 2020 2020 290d 0a20 2020            )..   
-00016b40: 2020 2020 2020 2020 2020 2020 2023 6966               #if
-00016b50: 2065 6c65 6d65 6e74 5f73 6320 3d3d 2027   element_sc == '
-00016b60: 4d61 6e61 6765 6d65 6e27 3a0d 0a20 2020  Managemen':..   
-00016b70: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00016b80: 2020 7072 696e 7428 6461 7475 6d29 0d0a    print(datum)..
-00016b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ba0: 2320 2020 2070 7269 6e74 2865 6c2e 5f73  #    print(el._s
-00016bb0: 6563 7572 6974 792e 6461 7461 5f76 6965  ecurity.data_vie
-00016bc0: 7765 7273 2c65 6c2e 5f73 6563 7572 6974  wers,el._securit
-00016bd0: 792e 7669 6577 6572 732c 656c 2e5f 7365  y.viewers,el._se
-00016be0: 6375 7269 7479 2e6d 6f64 6966 6965 7273  curity.modifiers
-00016bf0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-00016c00: 662e 5f73 6563 7572 6974 795f 7265 6164  f._security_read
-00016c10: 203d 2054 7275 650d 0a0d 0a0d 0a20 2020   = True......   
-00016c20: 2064 6566 206b 6579 7328 7365 6c66 293a   def keys(self):
-00016c30: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00016c40: 2073 656c 662e 5f65 6c65 6d65 6e74 735f   self._elements_
-00016c50: 7265 6164 3a0d 0a20 2020 2020 2020 2020  read:..         
-00016c60: 2020 2073 656c 662e 5f6c 6f61 645f 656c     self._load_el
-00016c70: 656d 656e 7473 2829 0d0a 0d0a 2020 2020  ements()....    
-00016c80: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00016c90: 5f65 6c65 6d65 6e74 732e 6b65 7973 2829  _elements.keys()
-00016ca0: 0d0a 0d0a 2020 2020 6465 6620 6974 656d  ....    def item
-00016cb0: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
-00016cc0: 2020 6966 206e 6f74 2073 656c 662e 5f65    if not self._e
-00016cd0: 6c65 6d65 6e74 735f 7265 6164 3a0d 0a20  lements_read:.. 
-00016ce0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00016cf0: 5f6c 6f61 645f 656c 656d 656e 7473 2829  _load_elements()
-00016d00: 0d0a 0d0a 2020 2020 2020 2020 7969 656c  ....        yiel
-00016d10: 6420 6672 6f6d 2073 656c 662e 5f65 6c65  d from self._ele
-00016d20: 6d65 6e74 732e 6974 656d 7328 290d 0a20  ments.items().. 
-00016d30: 2020 2020 2020 2066 6f72 2065 6c20 696e         for el in
-00016d40: 2073 656c 662e 5f65 6c65 6d65 6e74 735f   self._elements_
-00016d50: 7769 7468 6f75 745f 7368 6f72 746e 616d  without_shortnam
-00016d60: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-00016d70: 2079 6965 6c64 204e 6f6e 652c 2065 6c0d   yield None, el.
-00016d80: 0a0d 0a20 2020 2064 6566 2076 616c 7565  ...    def value
-00016d90: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
-00016da0: 2020 6966 206e 6f74 2073 656c 662e 5f65    if not self._e
-00016db0: 6c65 6d65 6e74 735f 7265 6164 3a0d 0a20  lements_read:.. 
-00016dc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00016dd0: 5f6c 6f61 645f 656c 656d 656e 7473 2829  _load_elements()
-00016de0: 0d0a 0d0a 2020 2020 2020 2020 7969 656c  ....        yiel
-00016df0: 6420 6672 6f6d 2073 656c 662e 5f65 6c65  d from self._ele
-00016e00: 6d65 6e74 732e 7661 6c75 6573 2829 0d0a  ments.values()..
+00016930: 203d 2065 6c0d 0a20 2020 2020 2020 2020   = el..         
+00016940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016960: 2020 2020 202c 6461 7461 5f76 6965 7765       ,data_viewe
+00016970: 7273 2020 2020 2020 2020 2020 2020 203d  rs             =
+00016980: 207b 6476 5f73 6320 666f 7220 6476 5f73   {dv_sc for dv_s
+00016990: 632c 2064 765f 7068 7973 6964 2069 6e20  c, dv_physid in 
+000169a0: 6461 7461 5f76 6965 7765 7273 7d0d 0a20  data_viewers}.. 
+000169b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000169d0: 2020 2020 2020 2020 2020 2020 202c 7669               ,vi
+000169e0: 6577 6572 7320 2020 2020 2020 2020 2020  ewers           
+000169f0: 2020 2020 2020 203d 207b 765f 7363 2020         = {v_sc  
+00016a00: 666f 7220 765f 7363 2c20 2076 5f70 6879  for v_sc,  v_phy
+00016a10: 7369 6420 2069 6e20 7669 6577 6572 737d  sid  in viewers}
+00016a20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00016a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a50: 2c6d 6f64 6966 6965 7273 2020 2020 2020  ,modifiers      
+00016a60: 2020 2020 2020 2020 2020 3d20 7b6d 5f73            = {m_s
+00016a70: 6320 2066 6f72 206d 5f73 632c 2020 6d5f  c  for m_sc,  m_
+00016a80: 7068 7973 6964 2020 696e 206d 6f64 6966  physid  in modif
+00016a90: 6965 7273 7d0d 0a20 2020 2020 2020 2020  iers}..         
+00016aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ac0: 2020 2020 202c 696e 6974 6961 6c69 7365       ,initialise
+00016ad0: 5f73 796e 6368 6564 2020 2020 2020 203d  _synched       =
+00016ae0: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+00016af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b10: 2020 2020 202c 696e 6974 6961 6c69 7365       ,initialise
+00016b20: 5f61 735f 6465 6661 756c 7420 2020 203d  _as_default    =
+00016b30: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00016b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016b60: 2020 2020 2020 290d 0a20 2020 2020 2020        )..       
+00016b70: 2020 2020 2020 2020 2023 6966 2065 6c65           #if ele
+00016b80: 6d65 6e74 5f73 6320 3d3d 2027 4d61 6e61  ment_sc == 'Mana
+00016b90: 6765 6d65 6e27 3a0d 0a20 2020 2020 2020  gemen':..       
+00016ba0: 2020 2020 2020 2020 2023 2020 2020 7072           #    pr
+00016bb0: 696e 7428 6461 7475 6d29 0d0a 2020 2020  int(datum)..    
+00016bc0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00016bd0: 2070 7269 6e74 2865 6c2e 5f73 6563 7572   print(el._secur
+00016be0: 6974 792e 6461 7461 5f76 6965 7765 7273  ity.data_viewers
+00016bf0: 2c65 6c2e 5f73 6563 7572 6974 792e 7669  ,el._security.vi
+00016c00: 6577 6572 732c 656c 2e5f 7365 6375 7269  ewers,el._securi
+00016c10: 7479 2e6d 6f64 6966 6965 7273 290d 0a0d  ty.modifiers)...
+00016c20: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+00016c30: 6563 7572 6974 795f 7265 6164 203d 2054  ecurity_read = T
+00016c40: 7275 650d 0a0d 0a0d 0a20 2020 2064 6566  rue......    def
+00016c50: 206b 6579 7328 7365 6c66 293a 0d0a 2020   keys(self):..  
+00016c60: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00016c70: 662e 5f65 6c65 6d65 6e74 735f 7265 6164  f._elements_read
+00016c80: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00016c90: 656c 662e 5f6c 6f61 645f 656c 656d 656e  elf._load_elemen
+00016ca0: 7473 2829 0d0a 0d0a 2020 2020 2020 2020  ts()....        
+00016cb0: 7265 7475 726e 2073 656c 662e 5f65 6c65  return self._ele
+00016cc0: 6d65 6e74 732e 6b65 7973 2829 0d0a 0d0a  ments.keys()....
+00016cd0: 2020 2020 6465 6620 6974 656d 7328 7365      def items(se
+00016ce0: 6c66 293a 0d0a 2020 2020 2020 2020 6966  lf):..        if
+00016cf0: 206e 6f74 2073 656c 662e 5f65 6c65 6d65   not self._eleme
+00016d00: 6e74 735f 7265 6164 3a0d 0a20 2020 2020  nts_read:..     
+00016d10: 2020 2020 2020 2073 656c 662e 5f6c 6f61         self._loa
+00016d20: 645f 656c 656d 656e 7473 2829 0d0a 0d0a  d_elements()....
+00016d30: 2020 2020 2020 2020 7969 656c 6420 6672          yield fr
+00016d40: 6f6d 2073 656c 662e 5f65 6c65 6d65 6e74  om self._element
+00016d50: 732e 6974 656d 7328 290d 0a20 2020 2020  s.items()..     
+00016d60: 2020 2066 6f72 2065 6c20 696e 2073 656c     for el in sel
+00016d70: 662e 5f65 6c65 6d65 6e74 735f 7769 7468  f._elements_with
+00016d80: 6f75 745f 7368 6f72 746e 616d 6573 3a0d  out_shortnames:.
+00016d90: 0a20 2020 2020 2020 2020 2020 2079 6965  .            yie
+00016da0: 6c64 204e 6f6e 652c 2065 6c0d 0a0d 0a20  ld None, el.... 
+00016db0: 2020 2064 6566 2076 616c 7565 7328 7365     def values(se
+00016dc0: 6c66 293a 0d0a 2020 2020 2020 2020 6966  lf):..        if
+00016dd0: 206e 6f74 2073 656c 662e 5f65 6c65 6d65   not self._eleme
+00016de0: 6e74 735f 7265 6164 3a0d 0a20 2020 2020  nts_read:..     
+00016df0: 2020 2020 2020 2073 656c 662e 5f6c 6f61         self._loa
+00016e00: 645f 656c 656d 656e 7473 2829 0d0a 0d0a  d_elements()....
 00016e10: 2020 2020 2020 2020 7969 656c 6420 6672          yield fr
 00016e20: 6f6d 2073 656c 662e 5f65 6c65 6d65 6e74  om self._element
-00016e30: 735f 7769 7468 6f75 745f 7368 6f72 746e  s_without_shortn
-00016e40: 616d 6573 0d0a 0d0a 2020 2020 6465 6620  ames....    def 
-00016e50: 5f5f 6c65 6e5f 5f28 7365 6c66 293a 0d0a  __len__(self):..
-00016e60: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00016e70: 656c 662e 5f65 6c65 6d65 6e74 735f 7265  elf._elements_re
-00016e80: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
-00016e90: 2073 656c 662e 5f6c 6f61 645f 656c 656d   self._load_elem
-00016ea0: 656e 7473 2829 0d0a 0d0a 2020 2020 2020  ents()....      
-00016eb0: 2020 7265 7475 726e 206c 656e 2873 656c    return len(sel
-00016ec0: 662e 5f65 6c65 6d65 6e74 7329 202b 206c  f._elements) + l
-00016ed0: 656e 2873 656c 662e 5f65 6c65 6d65 6e74  en(self._element
-00016ee0: 735f 7769 7468 6f75 745f 7368 6f72 746e  s_without_shortn
-00016ef0: 616d 6573 290d 0a0d 0a0d 0a20 2020 2064  ames)......    d
-00016f00: 6566 205f 5f72 6570 725f 5f28 7365 6c66  ef __repr__(self
-00016f10: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-00016f20: 726e 2027 7b7d 2066 726f 6d20 3c7b 7d20  rn '{} from <{} 
-00016f30: 6f62 6a65 6374 2061 7420 7b7d 3e27 2e66  object at {}>'.f
-00016f40: 6f72 6d61 7428 277b 2720 2b20 275c 6e27  ormat('{' + '\n'
-00016f50: 2e6a 6f69 6e28 5b20 2227 7b7d 273a 7b7d  .join([ "'{}':{}
-00016f60: 222e 666f 726d 6174 286b 2c72 6570 7228  ".format(k,repr(
-00016f70: 7629 2920 666f 7220 6b2c 7620 696e 2073  v)) for k,v in s
-00016f80: 656c 662e 6974 656d 7328 295d 2920 2b20  elf.items()]) + 
-00016f90: 277d 272c 7365 6c66 2e5f 5f63 6c61 7373  '}',self.__class
-00016fa0: 5f5f 2e5f 5f6e 616d 655f 5f2c 6865 7828  __.__name__,hex(
-00016fb0: 6964 2873 656c 6629 2920 2020 2029 0d0a  id(self))    )..
-00016fc0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-00016fd0: 0a20 2020 2064 6566 2064 6174 6166 7261  .    def datafra
-00016fe0: 6d65 2873 656c 6629 3a0d 0a0d 0a20 2020  me(self):....   
-00016ff0: 2020 2020 2069 6620 7365 6c66 2e5f 656c       if self._el
-00017000: 656d 656e 745f 6461 7461 6672 616d 6520  ement_dataframe 
-00017010: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00017020: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017030: 2073 656c 662e 5f65 6c65 6d65 6e74 5f64   self._element_d
-00017040: 6174 6166 7261 6d65 0d0a 2020 2020 2020  ataframe..      
-00017050: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00017060: 2020 2020 2023 6d61 6b65 2074 6865 2064       #make the d
-00017070: 6174 6166 7261 6d65 206f 7574 206f 6620  ataframe out of 
-00017080: 656c 656d 656e 7473 2069 6e20 7365 6c66  elements in self
-00017090: 2e5f 656c 656d 656e 7473 0d0a 2020 2020  ._elements..    
-000170a0: 2020 2020 2020 2020 7365 6c66 2e5f 656c          self._el
-000170b0: 656d 656e 745f 6461 7461 6672 616d 6520  ement_dataframe 
-000170c0: 3d20 7064 2e44 6174 6146 7261 6d65 285b  = pd.DataFrame([
-000170d0: 6469 6374 2849 443d 656c 656d 656e 742e  dict(ID=element.
-000170e0: 7068 7973 6964 2c20 2a2a 656c 656d 656e  physid, **elemen
-000170f0: 742e 6669 656c 6473 2920 666f 7220 656c  t.fields) for el
-00017100: 656d 656e 7420 696e 2073 656c 662e 7661  ement in self.va
-00017110: 6c75 6573 2829 5d2b 5b64 6963 7428 656c  lues()]+[dict(el
-00017120: 656d 656e 742e 6669 656c 6473 2920 666f  ement.fields) fo
-00017130: 7220 656c 656d 656e 7420 696e 2073 656c  r element in sel
-00017140: 662e 5f65 6c65 6d65 6e74 735f 7769 7468  f._elements_with
-00017150: 6f75 745f 7368 6f72 746e 616d 6573 5d0d  out_shortnames].
-00017160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017190: 2020 2023 2c63 6f6c 756d 6e73 203d 205b     #,columns = [
-000171a0: 2749 4427 2c27 5368 6f72 7420 4e61 6d65  'ID','Short Name
-000171b0: 272c 274c 6f6e 6720 4e61 6d65 272c 2744  ','Long Name','D
-000171c0: 6573 6372 6970 7469 6f6e 272c 2747 726f  escription','Gro
-000171d0: 7570 204f 6e6c 7927 2c27 4361 6c63 756c  up Only','Calcul
-000171e0: 6174 696f 6e20 5374 6174 7573 272c 2743  ation Status','C
-000171f0: 616c 6375 6c61 7469 6f6e 272c 2743 6f6c  alculation','Col
-00017200: 6f75 7227 2c27 4d65 6173 7572 6520 456c  our','Measure El
-00017210: 656d 656e 7427 5d29 0d0a 2020 2020 2020  ement'])..      
-00017220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017240: 2020 2020 2020 2020 2020 2020 2c63 6f6c              ,col
-00017250: 756d 6e73 203d 205b 2749 4427 5d2b 5b6b  umns = ['ID']+[k
-00017260: 2066 6f72 206b 2069 6e20 7365 6c66 2e64   for k in self.d
-00017270: 696d 656e 7369 6f6e 2e66 6965 6c64 732e  imension.fields.
-00017280: 6b65 7973 2829 5d29 0d0a 0d0a 2020 2020  keys()])....    
-00017290: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000172a0: 656c 662e 5f65 6c65 6d65 6e74 5f64 6174  elf._element_dat
-000172b0: 6166 7261 6d65 0d0a 0d0a 2020 2020 4064  aframe....    @d
-000172c0: 6174 6166 7261 6d65 2e73 6574 7465 720d  ataframe.setter.
-000172d0: 0a20 2020 2064 6566 2064 6174 6166 7261  .    def datafra
-000172e0: 6d65 2873 656c 662c 6466 293a 0d0a 2020  me(self,df):..  
-000172f0: 2020 2020 2020 7261 6973 6520 4174 7472        raise Attr
-00017300: 6962 7574 6545 7272 6f72 2822 446f 6e27  ibuteError("Don'
-00017310: 7420 7365 7420 7468 6520 6461 7461 6672  t set the datafr
-00017320: 616d 6520 6469 7265 6374 6c79 2077 6974  ame directly wit
-00017330: 6820 4469 6d65 6e73 696f 6e2e 656c 656d  h Dimension.elem
-00017340: 656e 7473 2e64 6174 6166 7261 6d65 202d  ents.dataframe -
-00017350: 2075 7365 2044 696d 656e 7369 6f6e 2e65   use Dimension.e
-00017360: 6c65 6d65 6e74 732e 6d65 7267 6528 736f  lements.merge(so
-00017370: 7572 6365 3d3c 6461 7461 6672 616d 653e  urce=<dataframe>
-00017380: 2c6b 6579 733d 3c6b 6579 636f 6c75 6d6e  ,keys=<keycolumn
-00017390: 733e 2920 696e 7374 6561 6422 290d 0a0d  s>) instead")...
-000173a0: 0a20 2020 2064 6566 205f 6361 6e6f 6e69  .    def _canoni
-000173b0: 6361 6c5f 656c 656d 656e 7473 5f62 795f  cal_elements_by_
-000173c0: 706b 2873 656c 662c 206b 6579 7329 3a0d  pk(self, keys):.
-000173d0: 0a20 2020 2020 2020 2027 2727 4765 7420  .        '''Get 
-000173e0: 6120 6469 6374 696f 6e61 7279 206f 6620  a dictionary of 
-000173f0: 6361 6e6f 6e69 6361 6c20 656c 656d 656e  canonical elemen
-00017400: 7473 2062 7920 7768 6963 6865 7665 7220  ts by whichever 
-00017410: 6b65 7920 6973 2070 6173 7365 6420 696e  key is passed in
-00017420: 0d0a 2020 2020 2020 2020 5370 6c69 7420  ..        Split 
-00017430: 6f75 7420 6173 2061 206e 6577 2066 756e  out as a new fun
-00017440: 7469 6f6e 2074 6f20 6169 6420 7465 7374  tion to aid test
-00017450: 696e 670d 0a20 2020 2020 2020 2027 2727  ing..        '''
-00017460: 0d0a 2020 2020 2020 2020 6361 6e6f 6e69  ..        canoni
-00017470: 6361 6c5f 656c 656d 656e 7473 5f62 795f  cal_elements_by_
-00017480: 706b 3d7b 7475 706c 6528 656c 2e66 6965  pk={tuple(el.fie
-00017490: 6c64 735b 7072 696d 6172 795f 6b65 795f  lds[primary_key_
-000174a0: 636f 6c75 6d6e 5d20 666f 7220 7072 696d  column] for prim
-000174b0: 6172 795f 6b65 795f 636f 6c75 6d6e 2069  ary_key_column i
-000174c0: 6e20 6b65 7973 293a 656c 2066 6f72 2065  n keys):el for e
-000174d0: 6c20 696e 2073 656c 662e 7661 6c75 6573  l in self.values
-000174e0: 2829 7d0d 0a20 2020 2020 2020 2072 6574  ()}..        ret
-000174f0: 7572 6e20 6361 6e6f 6e69 6361 6c5f 656c  urn canonical_el
-00017500: 656d 656e 7473 5f62 795f 706b 0d0a 0d0a  ements_by_pk....
-00017510: 2020 2020 6465 6620 5f67 6574 5f63 616e      def _get_can
-00017520: 6f6e 6963 616c 5f65 6c65 6d65 6e74 2873  onical_element(s
-00017530: 656c 662c 2065 6c2c 206b 6579 732c 2063  elf, el, keys, c
-00017540: 616e 6f6e 6963 616c 5f65 6c65 6d65 6e74  anonical_element
-00017550: 735f 6279 5f70 6b29 3a0d 0a20 2020 2020  s_by_pk):..     
-00017560: 2020 2027 2727 4765 7420 6120 6361 6e6f     '''Get a cano
-00017570: 6e69 6361 6c20 656c 656d 656e 7420 666f  nical element fo
-00017580: 7220 6120 6769 7665 6e20 656c 656d 656e  r a given elemen
-00017590: 742c 2075 7369 6e67 2061 2067 6976 656e  t, using a given
-000175a0: 2073 6574 206f 6620 6b65 7973 2061 6e64   set of keys and
-000175b0: 2061 205f 6361 6e6f 6e69 6361 6c5f 656c   a _canonical_el
-000175c0: 656d 656e 7473 206c 6f6f 6b75 700d 0a20  ements lookup.. 
-000175d0: 2020 2020 2020 2053 706c 6974 206f 7574         Split out
-000175e0: 2061 7320 6120 6e65 7720 6675 6e74 696f   as a new funtio
-000175f0: 6e20 746f 2061 6964 2074 6573 7469 6e67  n to aid testing
-00017600: 0d0a 2020 2020 2020 2020 2727 270d 0a0d  ..        '''...
-00017610: 0a20 2020 2020 2020 2023 5365 6520 6966  .        #See if
-00017620: 2c20 6769 7665 6e20 7468 6520 7072 696d  , given the prim
-00017630: 6172 7920 6b65 7920 6465 6669 6e65 6420  ary key defined 
-00017640: 6279 2074 6865 2075 7365 7220 2863 6f75  by the user (cou
-00017650: 6c64 2062 6520 666f 7220 696e 7374 616e  ld be for instan
-00017660: 6365 2022 4c6f 6e67 204e 616d 6522 206f  ce "Long Name" o
-00017670: 7220 6120 6669 656c 6429 2077 6520 616c  r a field) we al
-00017680: 7265 6164 7920 6861 7665 2074 6869 7320  ready have this 
-00017690: 656c 656d 656e 7420 696e 2074 6865 2073  element in the s
-000176a0: 6974 650d 0a20 2020 2020 2020 2065 6c65  ite..        ele
-000176b0: 6d65 6e74 5f63 686f 7365 6e5f 706b 203d  ment_chosen_pk =
-000176c0: 2074 7570 6c65 2865 6c2e 6669 656c 6473   tuple(el.fields
-000176d0: 5b70 7269 6d61 7279 5f6b 6579 5f63 6f6c  [primary_key_col
-000176e0: 756d 6e5d 2066 6f72 2070 7269 6d61 7279  umn] for primary
-000176f0: 5f6b 6579 5f63 6f6c 756d 6e20 696e 206b  _key_column in k
-00017700: 6579 7329 0d0a 0d0a 2020 2020 2020 2020  eys)....        
-00017710: 666f 7220 7072 696d 6172 795f 6b65 795f  for primary_key_
-00017720: 636f 6c75 6d6e 2069 6e20 6b65 7973 3a0d  column in keys:.
-00017730: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00017740: 6d61 7279 5f6b 6579 5f76 616c 7565 203d  mary_key_value =
-00017750: 2065 6c2e 6669 656c 6473 5b70 7269 6d61   el.fields[prima
-00017760: 7279 5f6b 6579 5f63 6f6c 756d 6e5d 0d0a  ry_key_column]..
-00017770: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00017780: 7269 6d61 7279 5f6b 6579 5f76 616c 7565  rimary_key_value
-00017790: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-000177a0: 2028 275c 6e27 2069 6e20 7374 7228 7072   ('\n' in str(pr
-000177b0: 696d 6172 795f 6b65 795f 7661 6c75 6529  imary_key_value)
-000177c0: 206f 7220 275c 7427 2069 6e20 7374 7228   or '\t' in str(
-000177d0: 7072 696d 6172 795f 6b65 795f 7661 6c75  primary_key_valu
-000177e0: 6529 293a 0d0a 2020 2020 2020 2020 2020  e)):..          
-000177f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00017800: 6545 7272 6f72 2827 416e 2065 6c65 6d65  eError('An eleme
-00017810: 6e74 2077 6974 6820 6361 6e6e 6f74 2062  nt with cannot b
-00017820: 6520 6d65 7267 6564 2069 6620 6974 7320  e merged if its 
-00017830: 6b65 7973 2063 6f6e 7461 696e 2061 2073  keys contain a s
-00017840: 7472 696e 6720 636f 6e74 6169 6e69 6e67  tring containing
-00017850: 2061 2074 6162 206f 7220 6e65 776c 696e   a tab or newlin
-00017860: 652c 206f 7220 616e 206f 626a 6563 7420  e, or an object 
-00017870: 7468 6174 2065 7661 6c75 6174 6573 2074  that evaluates t
-00017880: 6f20 7375 6368 2061 7320 7374 7269 6e67  o such as string
-00017890: 2e20 456c 656d 656e 743a 207b 7d2c 2066  . Element: {}, f
-000178a0: 6965 6c64 3a20 7b7d 2c20 6669 656c 6420  ield: {}, field 
-000178b0: 7661 6c75 653a 207b 7d27 2e66 6f72 6d61  value: {}'.forma
-000178c0: 7428 7265 7072 2865 6c29 2c70 7269 6d61  t(repr(el),prima
-000178d0: 7279 5f6b 6579 5f63 6f6c 756d 6e2c 7265  ry_key_column,re
-000178e0: 7072 2870 7269 6d61 7279 5f6b 6579 5f76  pr(primary_key_v
-000178f0: 616c 7565 2929 290d 0a0d 0a0d 0a20 2020  alue)))......   
-00017900: 2020 2020 2023 6966 2065 6c65 6d65 6e74       #if element
-00017910: 5f63 686f 7365 6e5f 706b 203d 3d20 2827  _chosen_pk == ('
-00017920: 486f 6d65 2049 6d70 726f 7665 6d65 6e74  Home Improvement
-00017930: 272c 2753 6563 746f 7227 293a 0d0a 2020  ','Sector'):..  
-00017940: 2020 2020 2020 2320 2020 2070 7269 6e74        #    print
-00017950: 2827 656c 656d 656e 745f 6368 6f73 656e  ('element_chosen
-00017960: 5f70 6b3a 2027 2c65 6c65 6d65 6e74 5f63  _pk: ',element_c
-00017970: 686f 7365 6e5f 706b 290d 0a20 2020 2020  hosen_pk)..     
-00017980: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00017990: 2020 2020 2063 616e 6f6e 6963 616c 5f65       canonical_e
-000179a0: 6c20 3d20 6361 6e6f 6e69 6361 6c5f 656c  l = canonical_el
-000179b0: 656d 656e 7473 5f62 795f 706b 5b65 6c65  ements_by_pk[ele
-000179c0: 6d65 6e74 5f63 686f 7365 6e5f 706b 5d0d  ment_chosen_pk].
-000179d0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-000179e0: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
-000179f0: 2020 2020 2020 2063 616e 6f6e 6963 616c         canonical
-00017a00: 5f65 6c20 3d20 4e6f 6e65 0d0a 0d0a 2020  _el = None....  
-00017a10: 2020 2020 2020 7265 7475 726e 2063 616e        return can
-00017a20: 6f6e 6963 616c 5f65 6c0d 0a0d 0a20 2020  onical_el....   
-00017a30: 2064 6566 206d 6572 6765 2873 656c 662c   def merge(self,
-00017a40: 736f 7572 6365 2c6b 6579 733d 5b27 5368  source,keys=['Sh
-00017a50: 6f72 7420 4e61 6d65 275d 293a 0d0a 2020  ort Name']):..  
-00017a60: 2020 2020 2020 2727 274d 6572 6765 2069        '''Merge i
-00017a70: 6e20 656c 656d 656e 7473 2066 726f 6d20  n elements from 
-00017a80: 7468 6520 736f 7572 6365 2069 6e74 6f20  the source into 
-00017a90: 7468 6520 4469 6d65 6e73 696f 6e27 7320  the Dimension's 
-00017aa0: 656c 656d 656e 7473 2c20 7361 7669 6e67  elements, saving
-00017ab0: 2069 6620 6e65 6365 7373 6172 7920 696e   if necessary in
-00017ac0: 206f 7264 6572 2074 6f20 6372 6561 7465   order to create
-00017ad0: 2070 6879 7369 6473 2061 6e64 2073 7461   physids and sta
-00017ae0: 6e64 6172 6420 456d 706f 7765 7220 7368  ndard Empower sh
-00017af0: 6f72 746e 616d 6573 0d0a 0d0a 2020 2020  ortnames....    
-00017b00: 2020 2020 3a70 6172 616d 2073 6f75 7263      :param sourc
-00017b10: 653a 2061 2070 616e 6461 7320 4461 7461  e: a pandas Data
-00017b20: 4672 616d 652c 206c 6973 7420 6f66 2045  Frame, list of E
-00017b30: 6c65 6d65 6e74 732c 206f 7220 6469 6374  lements, or dict
-00017b40: 696f 6e61 7279 206f 6620 456c 656d 656e  ionary of Elemen
-00017b50: 7473 0d0a 2020 2020 2020 2020 3a70 6172  ts..        :par
-00017b60: 616d 206b 6579 733a 2061 206c 6973 7420  am keys: a list 
-00017b70: 6f66 2066 6965 6c64 7320 746f 2062 6520  of fields to be 
-00017b80: 7573 6564 2061 7320 7468 6520 6b65 7920  used as the key 
-00017b90: 696e 2074 6865 206d 6572 6765 0d0a 0d0a  in the merge....
-00017ba0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00017bb0: 2052 6574 7572 6e73 2061 6e20 6f62 6a65   Returns an obje
-00017bc0: 6374 206f 6620 7468 6520 7361 6d65 2074  ct of the same t
-00017bd0: 7970 6520 6173 2077 6173 2070 6173 7365  ype as was passe
-00017be0: 6420 696e 2028 4461 7461 4672 616d 652c  d in (DataFrame,
-00017bf0: 206c 6973 7420 6f66 2065 6c65 6d65 6e74   list of element
-00017c00: 7320 6f72 2045 6c65 6d65 6e74 2920 7769  s or Element) wi
-00017c10: 7468 2074 6865 2063 616e 6f6e 6963 616c  th the canonical
-00017c20: 2076 6572 7369 6f6e 7320 6f66 2074 6865   versions of the
-00017c30: 2065 6c65 6d65 6e74 7320 2d20 692e 652e   elements - i.e.
-00017c40: 2074 6865 206f 6e65 7320 7379 6e63 6872   the ones synchr
-00017c50: 6f6e 6973 6564 2077 6974 6820 456d 706f  onised with Empo
-00017c60: 7765 7220 6966 2074 6865 7920 616c 7265  wer if they alre
-00017c70: 6164 7920 6578 6973 7465 642c 206f 7220  ady existed, or 
-00017c80: 7468 6520 6e65 7720 6f6e 6573 2069 6620  the new ones if 
-00017c90: 7468 6579 2061 7265 2062 7261 6e64 206e  they are brand n
-00017ca0: 6577 0d0a 2020 2020 2020 2020 2727 270d  ew..        '''.
-00017cb0: 0a20 2020 2020 2020 2064 6174 6166 7261  .        datafra
-00017cc0: 6d65 203d 204e 6f6e 650d 0a20 2020 2020  me = None..     
-00017cd0: 2020 2069 735f 6c69 7374 203d 2046 616c     is_list = Fal
-00017ce0: 7365 0d0a 2020 2020 2020 2020 6973 5f64  se..        is_d
-00017cf0: 6963 7420 3d20 4661 6c73 650d 0a20 2020  ict = False..   
-00017d00: 2020 2020 2069 735f 6466 203d 2046 616c       is_df = Fal
-00017d10: 7365 0d0a 2020 2020 2020 2020 6973 5f65  se..        is_e
-00017d20: 6c65 6d65 6e74 203d 2046 616c 7365 0d0a  lement = False..
-00017d30: 0d0a 2020 2020 2020 2020 234e 6f74 2073  ..        #Not s
-00017d40: 7572 6520 7468 6973 2069 7320 6163 7475  ure this is actu
-00017d50: 616c 6c79 2064 6f69 6e67 2061 6e79 7468  ally doing anyth
-00017d60: 696e 672c 2073 6f20 746f 6f6b 2066 726f  ing, so took fro
-00017d70: 6d20 7468 6520 7061 7261 6d65 7465 7273  m the parameters
-00017d80: 0d0a 2020 2020 2020 2020 7379 6e63 203d  ..        sync =
-00017d90: 2054 7275 650d 0a20 2020 2020 2020 206f   True..        o
-00017da0: 7574 7075 745f 6c69 7374 203d 205b 5d0d  utput_list = [].
-00017db0: 0a0d 0a0d 0a20 2020 2020 2020 2023 5265  .....        #Re
-00017dc0: 7665 7273 6520 6475 636b 7479 7065 2074  verse ducktype t
-00017dd0: 6865 2073 6f75 7263 650d 0a20 2020 2020  he source..     
-00017de0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00017df0: 2020 2020 2073 6f75 7263 652e 6178 6573       source.axes
-00017e00: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
-00017e10: 7461 6672 616d 6520 3d20 736f 7572 6365  taframe = source
-00017e20: 0d0a 2020 2020 2020 2020 2020 2020 6973  ..            is
-00017e30: 5f64 6620 3d20 5472 7565 0d0a 2020 2020  _df = True..    
-00017e40: 2020 2020 6578 6365 7074 2041 7474 7269      except Attri
-00017e50: 6275 7465 4572 726f 723a 0d0a 2020 2020  buteError:..    
-00017e60: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-00017e70: 2020 2020 2020 2020 2020 2020 2020 736f                so
-00017e80: 7572 6365 2e76 616c 7565 7328 290d 0a20  urce.values().. 
-00017e90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00017ea0: 735f 6469 6374 203d 2054 7275 650d 0a20  s_dict = True.. 
-00017eb0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00017ec0: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
-00017ed0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00017ee0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00017ef0: 2873 6f75 7263 652c 2045 6c65 6d65 6e74  (source, Element
-00017f00: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00017f10: 2020 2020 2020 2020 6973 5f65 6c65 6d65          is_eleme
-00017f20: 6e74 203d 2054 7275 650d 0a20 2020 2020  nt = True..     
-00017f30: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00017f40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017f50: 2020 2020 2020 6973 5f6c 6973 7420 3d20        is_list = 
-00017f60: 5472 7565 0d0a 0d0a 2020 2020 2020 2020  True....        
-00017f70: 234b 6565 7020 7472 6163 6b20 6f66 2074  #Keep track of t
-00017f80: 6865 2065 6c65 6d65 6e74 7320 7765 2061  he elements we a
-00017f90: 7265 2063 7265 6174 696e 6720 2d20 7573  re creating - us
-00017fa0: 696e 6720 7468 6520 7072 696d 6172 7920  ing the primary 
-00017fb0: 6b65 7920 7061 7373 6564 2069 6e20 6173  key passed in as
-00017fc0: 2061 2066 756e 6374 696f 6e20 7061 7261   a function para
-00017fd0: 6d65 7465 720d 0a20 2020 2020 2020 2023  meter..        #
-00017fe0: 4669 7273 7420 706f 7075 6c61 7465 2074  First populate t
-00017ff0: 6865 2064 6963 7469 6f6e 6172 7920 7769  he dictionary wi
-00018000: 7468 2063 7572 7265 6e74 2065 6c65 6d65  th current eleme
-00018010: 6e74 7320 696e 6465 7865 6420 6279 2074  nts indexed by t
-00018020: 6865 2063 686f 7365 6e20 7072 696d 6172  he chosen primar
-00018030: 7920 6b65 790d 0a20 2020 2020 2020 2063  y key..        c
-00018040: 616e 6f6e 6963 616c 5f65 6c65 6d65 6e74  anonical_element
-00018050: 735f 6279 5f70 6b3d 7365 6c66 2e5f 6361  s_by_pk=self._ca
-00018060: 6e6f 6e69 6361 6c5f 656c 656d 656e 7473  nonical_elements
-00018070: 5f62 795f 706b 286b 6579 7329 0d0a 0d0a  _by_pk(keys)....
-00018080: 2020 2020 2020 2020 6966 2064 6174 6166          if dataf
-00018090: 7261 6d65 2069 7320 6e6f 7420 4e6f 6e65  rame is not None
-000180a0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-000180b0: 4472 6f70 2061 6e79 2064 7570 6c69 6361  Drop any duplica
-000180c0: 7465 730d 0a20 2020 2020 2020 2020 2020  tes..           
-000180d0: 2064 6174 6166 7261 6d65 203d 2064 6174   dataframe = dat
-000180e0: 6166 7261 6d65 2e63 6f70 7928 292e 6472  aframe.copy().dr
-000180f0: 6f70 5f64 7570 6c69 6361 7465 7328 7375  op_duplicates(su
-00018100: 6273 6574 3d6b 6579 732c 6b65 6570 3d27  bset=keys,keep='
-00018110: 6c61 7374 2729 0d0a 2020 2020 2020 2020  last')..        
-00018120: 2020 2020 6974 6572 6174 6f72 203d 205f      iterator = _
-00018130: 6461 7461 6672 616d 655f 6173 5f65 6c65  dataframe_as_ele
-00018140: 6d65 6e74 7328 6461 7461 6672 616d 652c  ments(dataframe,
-00018150: 6469 6d65 6e73 696f 6e3d 7365 6c66 2e64  dimension=self.d
-00018160: 696d 656e 7369 6f6e 290d 0a20 2020 2020  imension)..     
-00018170: 2020 2020 2020 2066 6965 6c64 735f 746f         fields_to
-00018180: 5f6d 6572 6765 203d 206c 6973 7428 6461  _merge = list(da
-00018190: 7461 6672 616d 652e 636f 6c75 6d6e 7329  taframe.columns)
-000181a0: 0d0a 2020 2020 2020 2020 6966 2069 735f  ..        if is_
-000181b0: 6469 6374 3a0d 0a20 2020 2020 2020 2020  dict:..         
-000181c0: 2020 2069 7465 7261 746f 7220 3d20 736f     iterator = so
-000181d0: 7572 6365 2e76 616c 7565 7328 290d 0a20  urce.values().. 
-000181e0: 2020 2020 2020 2020 2020 2066 6965 6c64             field
-000181f0: 735f 746f 5f6d 6572 6765 203d 204e 6f6e  s_to_merge = Non
-00018200: 650d 0a20 2020 2020 2020 2069 6620 6973  e..        if is
-00018210: 5f6c 6973 743a 0d0a 2020 2020 2020 2020  _list:..        
-00018220: 2020 2020 6974 6572 6174 6f72 203d 2073      iterator = s
-00018230: 6f75 7263 650d 0a20 2020 2020 2020 2020  ource..         
-00018240: 2020 2066 6965 6c64 735f 746f 5f6d 6572     fields_to_mer
-00018250: 6765 203d 204e 6f6e 650d 0a20 2020 2020  ge = None..     
-00018260: 2020 2069 6620 6973 5f65 6c65 6d65 6e74     if is_element
-00018270: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00018280: 7465 7261 746f 7220 3d20 5b73 6f75 7263  terator = [sourc
-00018290: 655d 0d0a 2020 2020 2020 2020 2020 2020  e]..            
-000182a0: 6669 656c 6473 5f74 6f5f 6d65 7267 6520  fields_to_merge 
-000182b0: 3d20 4e6f 6e65 0d0a 0d0a 2020 2020 2020  = None....      
-000182c0: 2020 2323 4b65 6570 2074 7261 636b 206f    ##Keep track o
-000182d0: 6620 7468 6520 656c 656d 656e 7473 2062  f the elements b
-000182e0: 7920 7468 6569 7220 7072 696d 6172 7920  y their primary 
-000182f0: 6b65 790d 0a20 2020 2020 2020 2023 656c  key..        #el
-00018300: 656d 656e 7473 5f62 795f 706b 203d 207b  ements_by_pk = {
-00018310: 7d0d 0a0d 0a20 2020 2020 2020 2066 6f72  }....        for
-00018320: 2065 6c20 696e 2069 7465 7261 746f 723a   el in iterator:
-00018330: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00018340: 6361 6e6f 6e69 6361 6c5f 656c 203d 2073  canonical_el = s
-00018350: 656c 662e 5f67 6574 5f63 616e 6f6e 6963  elf._get_canonic
-00018360: 616c 5f65 6c65 6d65 6e74 2865 6c2c 206b  al_element(el, k
-00018370: 6579 732c 2063 616e 6f6e 6963 616c 5f65  eys, canonical_e
-00018380: 6c65 6d65 6e74 735f 6279 5f70 6b29 0d0a  lements_by_pk)..
-00018390: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000183a0: 6966 2063 616e 6f6e 6963 616c 5f65 6c20  if canonical_el 
-000183b0: 6973 206e 6f74 204e 6f6e 653a 0d0a 0d0a  is not None:....
-000183c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183d0: 2369 6620 656c 656d 656e 745f 6368 6f73  #if element_chos
-000183e0: 656e 5f70 6b20 3d3d 2028 2748 6f6d 6520  en_pk == ('Home 
-000183f0: 496d 7072 6f76 656d 656e 7427 2c27 5365  Improvement','Se
-00018400: 6374 6f72 2729 3a0d 0a20 2020 2020 2020  ctor'):..       
-00018410: 2020 2020 2020 2020 2023 2020 2020 7072           #    pr
-00018420: 696e 7428 2763 616e 6f6e 6963 616c 5f65  int('canonical_e
-00018430: 6c3a 2027 2c63 616e 6f6e 6963 616c 5f65  l: ',canonical_e
-00018440: 6c29 0d0a 0d0a 2020 2020 2020 2020 2020  l)....          
-00018450: 2020 2020 2020 234f 6e63 6520 7765 2068        #Once we h
-00018460: 6176 6520 6120 6361 6e6f 6e69 6361 6c20  ave a canonical 
-00018470: 7368 6f72 746e 616d 6520 7765 206d 7573  shortname we mus
-00018480: 7420 7265 6d6f 7665 2074 6865 206f 6c64  t remove the old
-00018490: 2073 686f 7274 6e61 6d65 2066 726f 6d20   shortname from 
-000184a0: 7468 6520 5f45 6c65 6d65 6e74 7347 6574  the _ElementsGet
-000184b0: 7465 720d 0a20 2020 2020 2020 2020 2020  ter..           
-000184c0: 2020 2020 2069 6620 656c 2e73 686f 7274       if el.short
-000184d0: 6e61 6d65 2021 3d20 6361 6e6f 6e69 6361  name != canonica
-000184e0: 6c5f 656c 2e73 686f 7274 6e61 6d65 3a0d  l_el.shortname:.
-000184f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018500: 2020 2020 206f 6c64 5f73 686f 7274 6e61       old_shortna
-00018510: 6d65 203d 2065 6c2e 7368 6f72 746e 616d  me = el.shortnam
-00018520: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00018530: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00018540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018550: 2020 2020 2064 656c 2073 656c 665b 6f6c       del self[ol
-00018560: 645f 7368 6f72 746e 616d 655d 0d0a 2020  d_shortname]..  
+00016e30: 732e 7661 6c75 6573 2829 0d0a 2020 2020  s.values()..    
+00016e40: 2020 2020 7969 656c 6420 6672 6f6d 2073      yield from s
+00016e50: 656c 662e 5f65 6c65 6d65 6e74 735f 7769  elf._elements_wi
+00016e60: 7468 6f75 745f 7368 6f72 746e 616d 6573  thout_shortnames
+00016e70: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6c65  ....    def __le
+00016e80: 6e5f 5f28 7365 6c66 293a 0d0a 2020 2020  n__(self):..    
+00016e90: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00016ea0: 5f65 6c65 6d65 6e74 735f 7265 6164 3a0d  _elements_read:.
+00016eb0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00016ec0: 662e 5f6c 6f61 645f 656c 656d 656e 7473  f._load_elements
+00016ed0: 2829 0d0a 0d0a 2020 2020 2020 2020 7265  ()....        re
+00016ee0: 7475 726e 206c 656e 2873 656c 662e 5f65  turn len(self._e
+00016ef0: 6c65 6d65 6e74 7329 202b 206c 656e 2873  lements) + len(s
+00016f00: 656c 662e 5f65 6c65 6d65 6e74 735f 7769  elf._elements_wi
+00016f10: 7468 6f75 745f 7368 6f72 746e 616d 6573  thout_shortnames
+00016f20: 290d 0a0d 0a0d 0a20 2020 2064 6566 205f  )......    def _
+00016f30: 5f72 6570 725f 5f28 7365 6c66 293a 0d0a  _repr__(self):..
+00016f40: 2020 2020 2020 2020 7265 7475 726e 2027          return '
+00016f50: 7b7d 2066 726f 6d20 3c7b 7d20 6f62 6a65  {} from <{} obje
+00016f60: 6374 2061 7420 7b7d 3e27 2e66 6f72 6d61  ct at {}>'.forma
+00016f70: 7428 277b 2720 2b20 275c 6e27 2e6a 6f69  t('{' + '\n'.joi
+00016f80: 6e28 5b20 2227 7b7d 273a 7b7d 222e 666f  n([ "'{}':{}".fo
+00016f90: 726d 6174 286b 2c72 6570 7228 7629 2920  rmat(k,repr(v)) 
+00016fa0: 666f 7220 6b2c 7620 696e 2073 656c 662e  for k,v in self.
+00016fb0: 6974 656d 7328 295d 2920 2b20 277d 272c  items()]) + '}',
+00016fc0: 7365 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f  self.__class__._
+00016fd0: 5f6e 616d 655f 5f2c 6865 7828 6964 2873  _name__,hex(id(s
+00016fe0: 656c 6629 2920 2020 2029 0d0a 0d0a 2020  elf))    )....  
+00016ff0: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+00017000: 2064 6566 2064 6174 6166 7261 6d65 2873   def dataframe(s
+00017010: 656c 6629 3a0d 0a0d 0a20 2020 2020 2020  elf):....       
+00017020: 2069 6620 7365 6c66 2e5f 656c 656d 656e   if self._elemen
+00017030: 745f 6461 7461 6672 616d 6520 6973 206e  t_dataframe is n
+00017040: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+00017050: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00017060: 662e 5f65 6c65 6d65 6e74 5f64 6174 6166  f._element_dataf
+00017070: 7261 6d65 0d0a 2020 2020 2020 2020 656c  rame..        el
+00017080: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00017090: 2023 6d61 6b65 2074 6865 2064 6174 6166   #make the dataf
+000170a0: 7261 6d65 206f 7574 206f 6620 656c 656d  rame out of elem
+000170b0: 656e 7473 2069 6e20 7365 6c66 2e5f 656c  ents in self._el
+000170c0: 656d 656e 7473 0d0a 2020 2020 2020 2020  ements..        
+000170d0: 2020 2020 7365 6c66 2e5f 656c 656d 656e      self._elemen
+000170e0: 745f 6461 7461 6672 616d 6520 3d20 7064  t_dataframe = pd
+000170f0: 2e44 6174 6146 7261 6d65 285b 6469 6374  .DataFrame([dict
+00017100: 2849 443d 656c 656d 656e 742e 7068 7973  (ID=element.phys
+00017110: 6964 2c20 2a2a 656c 656d 656e 742e 6669  id, **element.fi
+00017120: 656c 6473 2920 666f 7220 656c 656d 656e  elds) for elemen
+00017130: 7420 696e 2073 656c 662e 7661 6c75 6573  t in self.values
+00017140: 2829 5d2b 5b64 6963 7428 656c 656d 656e  ()]+[dict(elemen
+00017150: 742e 6669 656c 6473 2920 666f 7220 656c  t.fields) for el
+00017160: 656d 656e 7420 696e 2073 656c 662e 5f65  ement in self._e
+00017170: 6c65 6d65 6e74 735f 7769 7468 6f75 745f  lements_without_
+00017180: 7368 6f72 746e 616d 6573 5d0d 0a20 2020  shortnames]..   
+00017190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000171c0: 2c63 6f6c 756d 6e73 203d 205b 2749 4427  ,columns = ['ID'
+000171d0: 2c27 5368 6f72 7420 4e61 6d65 272c 274c  ,'Short Name','L
+000171e0: 6f6e 6720 4e61 6d65 272c 2744 6573 6372  ong Name','Descr
+000171f0: 6970 7469 6f6e 272c 2747 726f 7570 204f  iption','Group O
+00017200: 6e6c 7927 2c27 4361 6c63 756c 6174 696f  nly','Calculatio
+00017210: 6e20 5374 6174 7573 272c 2743 616c 6375  n Status','Calcu
+00017220: 6c61 7469 6f6e 272c 2743 6f6c 6f75 7227  lation','Colour'
+00017230: 2c27 4d65 6173 7572 6520 456c 656d 656e  ,'Measure Elemen
+00017240: 7427 5d29 0d0a 2020 2020 2020 2020 2020  t'])..          
+00017250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017270: 2020 2020 2020 2020 2c63 6f6c 756d 6e73          ,columns
+00017280: 203d 205b 2749 4427 5d2b 5b6b 2066 6f72   = ['ID']+[k for
+00017290: 206b 2069 6e20 7365 6c66 2e64 696d 656e   k in self.dimen
+000172a0: 7369 6f6e 2e66 6965 6c64 732e 6b65 7973  sion.fields.keys
+000172b0: 2829 5d29 0d0a 0d0a 2020 2020 2020 2020  ()])....        
+000172c0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000172d0: 5f65 6c65 6d65 6e74 5f64 6174 6166 7261  _element_datafra
+000172e0: 6d65 0d0a 0d0a 2020 2020 4064 6174 6166  me....    @dataf
+000172f0: 7261 6d65 2e73 6574 7465 720d 0a20 2020  rame.setter..   
+00017300: 2064 6566 2064 6174 6166 7261 6d65 2873   def dataframe(s
+00017310: 656c 662c 6466 293a 0d0a 2020 2020 2020  elf,df):..      
+00017320: 2020 7261 6973 6520 4174 7472 6962 7574    raise Attribut
+00017330: 6545 7272 6f72 2822 446f 6e27 7420 7365  eError("Don't se
+00017340: 7420 7468 6520 6461 7461 6672 616d 6520  t the dataframe 
+00017350: 6469 7265 6374 6c79 2077 6974 6820 4469  directly with Di
+00017360: 6d65 6e73 696f 6e2e 656c 656d 656e 7473  mension.elements
+00017370: 2e64 6174 6166 7261 6d65 202d 2075 7365  .dataframe - use
+00017380: 2044 696d 656e 7369 6f6e 2e65 6c65 6d65   Dimension.eleme
+00017390: 6e74 732e 6d65 7267 6528 736f 7572 6365  nts.merge(source
+000173a0: 3d3c 6461 7461 6672 616d 653e 2c6b 6579  =<dataframe>,key
+000173b0: 733d 3c6b 6579 636f 6c75 6d6e 733e 2920  s=<keycolumns>) 
+000173c0: 696e 7374 6561 6422 290d 0a0d 0a20 2020  instead")....   
+000173d0: 2064 6566 205f 6361 6e6f 6e69 6361 6c5f   def _canonical_
+000173e0: 656c 656d 656e 7473 5f62 795f 706b 2873  elements_by_pk(s
+000173f0: 656c 662c 206b 6579 7329 3a0d 0a20 2020  elf, keys):..   
+00017400: 2020 2020 2027 2727 4765 7420 6120 6469       '''Get a di
+00017410: 6374 696f 6e61 7279 206f 6620 6361 6e6f  ctionary of cano
+00017420: 6e69 6361 6c20 656c 656d 656e 7473 2062  nical elements b
+00017430: 7920 7768 6963 6865 7665 7220 6b65 7920  y whichever key 
+00017440: 6973 2070 6173 7365 6420 696e 0d0a 2020  is passed in..  
+00017450: 2020 2020 2020 5370 6c69 7420 6f75 7420        Split out 
+00017460: 6173 2061 206e 6577 2066 756e 7469 6f6e  as a new funtion
+00017470: 2074 6f20 6169 6420 7465 7374 696e 670d   to aid testing.
+00017480: 0a20 2020 2020 2020 2027 2727 0d0a 2020  .        '''..  
+00017490: 2020 2020 2020 6361 6e6f 6e69 6361 6c5f        canonical_
+000174a0: 656c 656d 656e 7473 5f62 795f 706b 3d7b  elements_by_pk={
+000174b0: 7475 706c 6528 656c 2e66 6965 6c64 735b  tuple(el.fields[
+000174c0: 7072 696d 6172 795f 6b65 795f 636f 6c75  primary_key_colu
+000174d0: 6d6e 5d20 666f 7220 7072 696d 6172 795f  mn] for primary_
+000174e0: 6b65 795f 636f 6c75 6d6e 2069 6e20 6b65  key_column in ke
+000174f0: 7973 293a 656c 2066 6f72 2065 6c20 696e  ys):el for el in
+00017500: 2073 656c 662e 7661 6c75 6573 2829 7d0d   self.values()}.
+00017510: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00017520: 6361 6e6f 6e69 6361 6c5f 656c 656d 656e  canonical_elemen
+00017530: 7473 5f62 795f 706b 0d0a 0d0a 2020 2020  ts_by_pk....    
+00017540: 6465 6620 5f67 6574 5f63 616e 6f6e 6963  def _get_canonic
+00017550: 616c 5f65 6c65 6d65 6e74 2873 656c 662c  al_element(self,
+00017560: 2065 6c2c 206b 6579 732c 2063 616e 6f6e   el, keys, canon
+00017570: 6963 616c 5f65 6c65 6d65 6e74 735f 6279  ical_elements_by
+00017580: 5f70 6b29 3a0d 0a20 2020 2020 2020 2027  _pk):..        '
+00017590: 2727 4765 7420 6120 6361 6e6f 6e69 6361  ''Get a canonica
+000175a0: 6c20 656c 656d 656e 7420 666f 7220 6120  l element for a 
+000175b0: 6769 7665 6e20 656c 656d 656e 742c 2075  given element, u
+000175c0: 7369 6e67 2061 2067 6976 656e 2073 6574  sing a given set
+000175d0: 206f 6620 6b65 7973 2061 6e64 2061 205f   of keys and a _
+000175e0: 6361 6e6f 6e69 6361 6c5f 656c 656d 656e  canonical_elemen
+000175f0: 7473 206c 6f6f 6b75 700d 0a20 2020 2020  ts lookup..     
+00017600: 2020 2053 706c 6974 206f 7574 2061 7320     Split out as 
+00017610: 6120 6e65 7720 6675 6e74 696f 6e20 746f  a new funtion to
+00017620: 2061 6964 2074 6573 7469 6e67 0d0a 2020   aid testing..  
+00017630: 2020 2020 2020 2727 270d 0a0d 0a20 2020        '''....   
+00017640: 2020 2020 2023 5365 6520 6966 2c20 6769       #See if, gi
+00017650: 7665 6e20 7468 6520 7072 696d 6172 7920  ven the primary 
+00017660: 6b65 7920 6465 6669 6e65 6420 6279 2074  key defined by t
+00017670: 6865 2075 7365 7220 2863 6f75 6c64 2062  he user (could b
+00017680: 6520 666f 7220 696e 7374 616e 6365 2022  e for instance "
+00017690: 4c6f 6e67 204e 616d 6522 206f 7220 6120  Long Name" or a 
+000176a0: 6669 656c 6429 2077 6520 616c 7265 6164  field) we alread
+000176b0: 7920 6861 7665 2074 6869 7320 656c 656d  y have this elem
+000176c0: 656e 7420 696e 2074 6865 2073 6974 650d  ent in the site.
+000176d0: 0a20 2020 2020 2020 2065 6c65 6d65 6e74  .        element
+000176e0: 5f63 686f 7365 6e5f 706b 203d 2074 7570  _chosen_pk = tup
+000176f0: 6c65 2865 6c2e 6669 656c 6473 5b70 7269  le(el.fields[pri
+00017700: 6d61 7279 5f6b 6579 5f63 6f6c 756d 6e5d  mary_key_column]
+00017710: 2066 6f72 2070 7269 6d61 7279 5f6b 6579   for primary_key
+00017720: 5f63 6f6c 756d 6e20 696e 206b 6579 7329  _column in keys)
+00017730: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
+00017740: 7072 696d 6172 795f 6b65 795f 636f 6c75  primary_key_colu
+00017750: 6d6e 2069 6e20 6b65 7973 3a0d 0a20 2020  mn in keys:..   
+00017760: 2020 2020 2020 2020 2070 7269 6d61 7279           primary
+00017770: 5f6b 6579 5f76 616c 7565 203d 2065 6c2e  _key_value = el.
+00017780: 6669 656c 6473 5b70 7269 6d61 7279 5f6b  fields[primary_k
+00017790: 6579 5f63 6f6c 756d 6e5d 0d0a 2020 2020  ey_column]..    
+000177a0: 2020 2020 2020 2020 6966 2070 7269 6d61          if prima
+000177b0: 7279 5f6b 6579 5f76 616c 7565 2069 7320  ry_key_value is 
+000177c0: 6e6f 7420 4e6f 6e65 2061 6e64 2028 275c  not None and ('\
+000177d0: 6e27 2069 6e20 7374 7228 7072 696d 6172  n' in str(primar
+000177e0: 795f 6b65 795f 7661 6c75 6529 206f 7220  y_key_value) or 
+000177f0: 275c 7427 2069 6e20 7374 7228 7072 696d  '\t' in str(prim
+00017800: 6172 795f 6b65 795f 7661 6c75 6529 293a  ary_key_value)):
+00017810: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00017820: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00017830: 6f72 2827 416e 2065 6c65 6d65 6e74 2077  or('An element w
+00017840: 6974 6820 6361 6e6e 6f74 2062 6520 6d65  ith cannot be me
+00017850: 7267 6564 2069 6620 6974 7320 6b65 7973  rged if its keys
+00017860: 2063 6f6e 7461 696e 2061 2073 7472 696e   contain a strin
+00017870: 6720 636f 6e74 6169 6e69 6e67 2061 2074  g containing a t
+00017880: 6162 206f 7220 6e65 776c 696e 652c 206f  ab or newline, o
+00017890: 7220 616e 206f 626a 6563 7420 7468 6174  r an object that
+000178a0: 2065 7661 6c75 6174 6573 2074 6f20 7375   evaluates to su
+000178b0: 6368 2061 7320 7374 7269 6e67 2e20 456c  ch as string. El
+000178c0: 656d 656e 743a 207b 7d2c 2066 6965 6c64  ement: {}, field
+000178d0: 3a20 7b7d 2c20 6669 656c 6420 7661 6c75  : {}, field valu
+000178e0: 653a 207b 7d27 2e66 6f72 6d61 7428 7265  e: {}'.format(re
+000178f0: 7072 2865 6c29 2c70 7269 6d61 7279 5f6b  pr(el),primary_k
+00017900: 6579 5f63 6f6c 756d 6e2c 7265 7072 2870  ey_column,repr(p
+00017910: 7269 6d61 7279 5f6b 6579 5f76 616c 7565  rimary_key_value
+00017920: 2929 290d 0a0d 0a0d 0a20 2020 2020 2020  )))......       
+00017930: 2023 6966 2065 6c65 6d65 6e74 5f63 686f   #if element_cho
+00017940: 7365 6e5f 706b 203d 3d20 2827 486f 6d65  sen_pk == ('Home
+00017950: 2049 6d70 726f 7665 6d65 6e74 272c 2753   Improvement','S
+00017960: 6563 746f 7227 293a 0d0a 2020 2020 2020  ector'):..      
+00017970: 2020 2320 2020 2070 7269 6e74 2827 656c    #    print('el
+00017980: 656d 656e 745f 6368 6f73 656e 5f70 6b3a  ement_chosen_pk:
+00017990: 2027 2c65 6c65 6d65 6e74 5f63 686f 7365   ',element_chose
+000179a0: 6e5f 706b 290d 0a20 2020 2020 2020 2074  n_pk)..        t
+000179b0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+000179c0: 2063 616e 6f6e 6963 616c 5f65 6c20 3d20   canonical_el = 
+000179d0: 6361 6e6f 6e69 6361 6c5f 656c 656d 656e  canonical_elemen
+000179e0: 7473 5f62 795f 706b 5b65 6c65 6d65 6e74  ts_by_pk[element
+000179f0: 5f63 686f 7365 6e5f 706b 5d0d 0a20 2020  _chosen_pk]..   
+00017a00: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+00017a10: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+00017a20: 2020 2063 616e 6f6e 6963 616c 5f65 6c20     canonical_el 
+00017a30: 3d20 4e6f 6e65 0d0a 0d0a 2020 2020 2020  = None....      
+00017a40: 2020 7265 7475 726e 2063 616e 6f6e 6963    return canonic
+00017a50: 616c 5f65 6c0d 0a0d 0a20 2020 2064 6566  al_el....    def
+00017a60: 206d 6572 6765 2873 656c 662c 736f 7572   merge(self,sour
+00017a70: 6365 2c6b 6579 733d 5b27 5368 6f72 7420  ce,keys=['Short 
+00017a80: 4e61 6d65 275d 293a 0d0a 2020 2020 2020  Name']):..      
+00017a90: 2020 2727 274d 6572 6765 2069 6e20 656c    '''Merge in el
+00017aa0: 656d 656e 7473 2066 726f 6d20 7468 6520  ements from the 
+00017ab0: 736f 7572 6365 2069 6e74 6f20 7468 6520  source into the 
+00017ac0: 4469 6d65 6e73 696f 6e27 7320 656c 656d  Dimension's elem
+00017ad0: 656e 7473 2c20 7361 7669 6e67 2069 6620  ents, saving if 
+00017ae0: 6e65 6365 7373 6172 7920 696e 206f 7264  necessary in ord
+00017af0: 6572 2074 6f20 6372 6561 7465 2070 6879  er to create phy
+00017b00: 7369 6473 2061 6e64 2073 7461 6e64 6172  sids and standar
+00017b10: 6420 456d 706f 7765 7220 7368 6f72 746e  d Empower shortn
+00017b20: 616d 6573 0d0a 0d0a 2020 2020 2020 2020  ames....        
+00017b30: 3a70 6172 616d 2073 6f75 7263 653a 2061  :param source: a
+00017b40: 2070 616e 6461 7320 4461 7461 4672 616d   pandas DataFram
+00017b50: 652c 206c 6973 7420 6f66 2045 6c65 6d65  e, list of Eleme
+00017b60: 6e74 732c 206f 7220 6469 6374 696f 6e61  nts, or dictiona
+00017b70: 7279 206f 6620 456c 656d 656e 7473 0d0a  ry of Elements..
+00017b80: 2020 2020 2020 2020 3a70 6172 616d 206b          :param k
+00017b90: 6579 733a 2061 206c 6973 7420 6f66 2066  eys: a list of f
+00017ba0: 6965 6c64 7320 746f 2062 6520 7573 6564  ields to be used
+00017bb0: 2061 7320 7468 6520 6b65 7920 696e 2074   as the key in t
+00017bc0: 6865 206d 6572 6765 0d0a 0d0a 2020 2020  he merge....    
+00017bd0: 2020 2020 3a72 6574 7572 6e3a 2052 6574      :return: Ret
+00017be0: 7572 6e73 2061 6e20 6f62 6a65 6374 206f  urns an object o
+00017bf0: 6620 7468 6520 7361 6d65 2074 7970 6520  f the same type 
+00017c00: 6173 2077 6173 2070 6173 7365 6420 696e  as was passed in
+00017c10: 2028 4461 7461 4672 616d 652c 206c 6973   (DataFrame, lis
+00017c20: 7420 6f66 2065 6c65 6d65 6e74 7320 6f72  t of elements or
+00017c30: 2045 6c65 6d65 6e74 2920 7769 7468 2074   Element) with t
+00017c40: 6865 2063 616e 6f6e 6963 616c 2076 6572  he canonical ver
+00017c50: 7369 6f6e 7320 6f66 2074 6865 2065 6c65  sions of the ele
+00017c60: 6d65 6e74 7320 2d20 692e 652e 2074 6865  ments - i.e. the
+00017c70: 206f 6e65 7320 7379 6e63 6872 6f6e 6973   ones synchronis
+00017c80: 6564 2077 6974 6820 456d 706f 7765 7220  ed with Empower 
+00017c90: 6966 2074 6865 7920 616c 7265 6164 7920  if they already 
+00017ca0: 6578 6973 7465 642c 206f 7220 7468 6520  existed, or the 
+00017cb0: 6e65 7720 6f6e 6573 2069 6620 7468 6579  new ones if they
+00017cc0: 2061 7265 2062 7261 6e64 206e 6577 0d0a   are brand new..
+00017cd0: 2020 2020 2020 2020 2727 270d 0a20 2020          '''..   
+00017ce0: 2020 2020 2064 6174 6166 7261 6d65 203d       dataframe =
+00017cf0: 204e 6f6e 650d 0a20 2020 2020 2020 2069   None..        i
+00017d00: 735f 6c69 7374 203d 2046 616c 7365 0d0a  s_list = False..
+00017d10: 2020 2020 2020 2020 6973 5f64 6963 7420          is_dict 
+00017d20: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00017d30: 2069 735f 6466 203d 2046 616c 7365 0d0a   is_df = False..
+00017d40: 2020 2020 2020 2020 6973 5f65 6c65 6d65          is_eleme
+00017d50: 6e74 203d 2046 616c 7365 0d0a 0d0a 2020  nt = False....  
+00017d60: 2020 2020 2020 234e 6f74 2073 7572 6520        #Not sure 
+00017d70: 7468 6973 2069 7320 6163 7475 616c 6c79  this is actually
+00017d80: 2064 6f69 6e67 2061 6e79 7468 696e 672c   doing anything,
+00017d90: 2073 6f20 746f 6f6b 2066 726f 6d20 7468   so took from th
+00017da0: 6520 7061 7261 6d65 7465 7273 0d0a 2020  e parameters..  
+00017db0: 2020 2020 2020 7379 6e63 203d 2054 7275        sync = Tru
+00017dc0: 650d 0a20 2020 2020 2020 206f 7574 7075  e..        outpu
+00017dd0: 745f 6c69 7374 203d 205b 5d0d 0a0d 0a0d  t_list = [].....
+00017de0: 0a20 2020 2020 2020 2023 5265 7665 7273  .        #Revers
+00017df0: 6520 6475 636b 7479 7065 2074 6865 2073  e ducktype the s
+00017e00: 6f75 7263 650d 0a20 2020 2020 2020 2074  ource..        t
+00017e10: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+00017e20: 2073 6f75 7263 652e 6178 6573 0d0a 2020   source.axes..  
+00017e30: 2020 2020 2020 2020 2020 6461 7461 6672            datafr
+00017e40: 616d 6520 3d20 736f 7572 6365 0d0a 2020  ame = source..  
+00017e50: 2020 2020 2020 2020 2020 6973 5f64 6620            is_df 
+00017e60: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00017e70: 6578 6365 7074 2041 7474 7269 6275 7465  except Attribute
+00017e80: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+00017e90: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+00017ea0: 2020 2020 2020 2020 2020 736f 7572 6365            source
+00017eb0: 2e76 616c 7565 7328 290d 0a20 2020 2020  .values()..     
+00017ec0: 2020 2020 2020 2020 2020 2069 735f 6469             is_di
+00017ed0: 6374 203d 2054 7275 650d 0a20 2020 2020  ct = True..     
+00017ee0: 2020 2020 2020 2065 7863 6570 7420 4174         except At
+00017ef0: 7472 6962 7574 6545 7272 6f72 3a0d 0a20  tributeError:.. 
+00017f00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00017f10: 6620 6973 696e 7374 616e 6365 2873 6f75  f isinstance(sou
+00017f20: 7263 652c 2045 6c65 6d65 6e74 293a 0d0a  rce, Element):..
+00017f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f40: 2020 2020 6973 5f65 6c65 6d65 6e74 203d      is_element =
+00017f50: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+00017f60: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00017f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f80: 2020 6973 5f6c 6973 7420 3d20 5472 7565    is_list = True
+00017f90: 0d0a 0d0a 2020 2020 2020 2020 234b 6565  ....        #Kee
+00017fa0: 7020 7472 6163 6b20 6f66 2074 6865 2065  p track of the e
+00017fb0: 6c65 6d65 6e74 7320 7765 2061 7265 2063  lements we are c
+00017fc0: 7265 6174 696e 6720 2d20 7573 696e 6720  reating - using 
+00017fd0: 7468 6520 7072 696d 6172 7920 6b65 7920  the primary key 
+00017fe0: 7061 7373 6564 2069 6e20 6173 2061 2066  passed in as a f
+00017ff0: 756e 6374 696f 6e20 7061 7261 6d65 7465  unction paramete
+00018000: 720d 0a20 2020 2020 2020 2023 4669 7273  r..        #Firs
+00018010: 7420 706f 7075 6c61 7465 2074 6865 2064  t populate the d
+00018020: 6963 7469 6f6e 6172 7920 7769 7468 2063  ictionary with c
+00018030: 7572 7265 6e74 2065 6c65 6d65 6e74 7320  urrent elements 
+00018040: 696e 6465 7865 6420 6279 2074 6865 2063  indexed by the c
+00018050: 686f 7365 6e20 7072 696d 6172 7920 6b65  hosen primary ke
+00018060: 790d 0a20 2020 2020 2020 2063 616e 6f6e  y..        canon
+00018070: 6963 616c 5f65 6c65 6d65 6e74 735f 6279  ical_elements_by
+00018080: 5f70 6b3d 7365 6c66 2e5f 6361 6e6f 6e69  _pk=self._canoni
+00018090: 6361 6c5f 656c 656d 656e 7473 5f62 795f  cal_elements_by_
+000180a0: 706b 286b 6579 7329 0d0a 0d0a 2020 2020  pk(keys)....    
+000180b0: 2020 2020 6966 2064 6174 6166 7261 6d65      if dataframe
+000180c0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+000180d0: 2020 2020 2020 2020 2020 2023 4472 6f70             #Drop
+000180e0: 2061 6e79 2064 7570 6c69 6361 7465 730d   any duplicates.
+000180f0: 0a20 2020 2020 2020 2020 2020 2064 6174  .            dat
+00018100: 6166 7261 6d65 203d 2064 6174 6166 7261  aframe = datafra
+00018110: 6d65 2e63 6f70 7928 292e 6472 6f70 5f64  me.copy().drop_d
+00018120: 7570 6c69 6361 7465 7328 7375 6273 6574  uplicates(subset
+00018130: 3d6b 6579 732c 6b65 6570 3d27 6c61 7374  =keys,keep='last
+00018140: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+00018150: 6974 6572 6174 6f72 203d 205f 6461 7461  iterator = _data
+00018160: 6672 616d 655f 6173 5f65 6c65 6d65 6e74  frame_as_element
+00018170: 7328 6461 7461 6672 616d 652c 6469 6d65  s(dataframe,dime
+00018180: 6e73 696f 6e3d 7365 6c66 2e64 696d 656e  nsion=self.dimen
+00018190: 7369 6f6e 290d 0a20 2020 2020 2020 2020  sion)..         
+000181a0: 2020 2066 6965 6c64 735f 746f 5f6d 6572     fields_to_mer
+000181b0: 6765 203d 206c 6973 7428 6461 7461 6672  ge = list(datafr
+000181c0: 616d 652e 636f 6c75 6d6e 7329 0d0a 2020  ame.columns)..  
+000181d0: 2020 2020 2020 6966 2069 735f 6469 6374        if is_dict
+000181e0: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+000181f0: 7465 7261 746f 7220 3d20 736f 7572 6365  terator = source
+00018200: 2e76 616c 7565 7328 290d 0a20 2020 2020  .values()..     
+00018210: 2020 2020 2020 2066 6965 6c64 735f 746f         fields_to
+00018220: 5f6d 6572 6765 203d 204e 6f6e 650d 0a20  _merge = None.. 
+00018230: 2020 2020 2020 2069 6620 6973 5f6c 6973         if is_lis
+00018240: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00018250: 6974 6572 6174 6f72 203d 2073 6f75 7263  iterator = sourc
+00018260: 650d 0a20 2020 2020 2020 2020 2020 2066  e..            f
+00018270: 6965 6c64 735f 746f 5f6d 6572 6765 203d  ields_to_merge =
+00018280: 204e 6f6e 650d 0a20 2020 2020 2020 2069   None..        i
+00018290: 6620 6973 5f65 6c65 6d65 6e74 3a0d 0a20  f is_element:.. 
+000182a0: 2020 2020 2020 2020 2020 2069 7465 7261             itera
+000182b0: 746f 7220 3d20 5b73 6f75 7263 655d 0d0a  tor = [source]..
+000182c0: 2020 2020 2020 2020 2020 2020 6669 656c              fiel
+000182d0: 6473 5f74 6f5f 6d65 7267 6520 3d20 4e6f  ds_to_merge = No
+000182e0: 6e65 0d0a 0d0a 2020 2020 2020 2020 2323  ne....        ##
+000182f0: 4b65 6570 2074 7261 636b 206f 6620 7468  Keep track of th
+00018300: 6520 656c 656d 656e 7473 2062 7920 7468  e elements by th
+00018310: 6569 7220 7072 696d 6172 7920 6b65 790d  eir primary key.
+00018320: 0a20 2020 2020 2020 2023 656c 656d 656e  .        #elemen
+00018330: 7473 5f62 795f 706b 203d 207b 7d0d 0a0d  ts_by_pk = {}...
+00018340: 0a20 2020 2020 2020 2066 6f72 2065 6c20  .        for el 
+00018350: 696e 2069 7465 7261 746f 723a 0d0a 0d0a  in iterator:....
+00018360: 2020 2020 2020 2020 2020 2020 6361 6e6f              cano
+00018370: 6e69 6361 6c5f 656c 203d 2073 656c 662e  nical_el = self.
+00018380: 5f67 6574 5f63 616e 6f6e 6963 616c 5f65  _get_canonical_e
+00018390: 6c65 6d65 6e74 2865 6c2c 206b 6579 732c  lement(el, keys,
+000183a0: 2063 616e 6f6e 6963 616c 5f65 6c65 6d65   canonical_eleme
+000183b0: 6e74 735f 6279 5f70 6b29 0d0a 0d0a 0d0a  nts_by_pk)......
+000183c0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+000183d0: 616e 6f6e 6963 616c 5f65 6c20 6973 206e  anonical_el is n
+000183e0: 6f74 204e 6f6e 653a 0d0a 0d0a 2020 2020  ot None:....    
+000183f0: 2020 2020 2020 2020 2020 2020 2369 6620              #if 
+00018400: 656c 656d 656e 745f 6368 6f73 656e 5f70  element_chosen_p
+00018410: 6b20 3d3d 2028 2748 6f6d 6520 496d 7072  k == ('Home Impr
+00018420: 6f76 656d 656e 7427 2c27 5365 6374 6f72  ovement','Sector
+00018430: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
+00018440: 2020 2020 2023 2020 2020 7072 696e 7428       #    print(
+00018450: 2763 616e 6f6e 6963 616c 5f65 6c3a 2027  'canonical_el: '
+00018460: 2c63 616e 6f6e 6963 616c 5f65 6c29 0d0a  ,canonical_el)..
+00018470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018480: 2020 234f 6e63 6520 7765 2068 6176 6520    #Once we have 
+00018490: 6120 6361 6e6f 6e69 6361 6c20 7368 6f72  a canonical shor
+000184a0: 746e 616d 6520 7765 206d 7573 7420 7265  tname we must re
+000184b0: 6d6f 7665 2074 6865 206f 6c64 2073 686f  move the old sho
+000184c0: 7274 6e61 6d65 2066 726f 6d20 7468 6520  rtname from the 
+000184d0: 5f45 6c65 6d65 6e74 7347 6574 7465 720d  _ElementsGetter.
+000184e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000184f0: 2069 6620 656c 2e73 686f 7274 6e61 6d65   if el.shortname
+00018500: 2021 3d20 6361 6e6f 6e69 6361 6c5f 656c   != canonical_el
+00018510: 2e73 686f 7274 6e61 6d65 3a0d 0a20 2020  .shortname:..   
+00018520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018530: 206f 6c64 5f73 686f 7274 6e61 6d65 203d   old_shortname =
+00018540: 2065 6c2e 7368 6f72 746e 616d 650d 0a20   el.shortname.. 
+00018550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018560: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
 00018570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018580: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-00018590: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-000185a0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-000185b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000185c0: 2020 6361 6e6f 6e69 6361 6c5f 7368 6f72    canonical_shor
-000185d0: 746e 616d 6520 3d20 6361 6e6f 6e69 6361  tname = canonica
-000185e0: 6c5f 656c 2e73 686f 7274 6e61 6d65 0d0a  l_el.shortname..
-000185f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018600: 2020 234d 6572 6765 2074 6865 206e 6577    #Merge the new
-00018610: 2065 6c65 6d65 6e74 2069 6e20 7769 7468   element in with
-00018620: 2074 6865 206f 6c64 0d0a 2020 2020 2020   the old..      
-00018630: 2020 2020 2020 2020 2020 6361 6e6f 6e69            canoni
-00018640: 6361 6c5f 656c 2e6d 6572 6765 2865 6c2c  cal_el.merge(el,
-00018650: 6669 656c 6473 5f74 6f5f 6d65 7267 653d  fields_to_merge=
-00018660: 6669 656c 6473 5f74 6f5f 6d65 7267 6529  fields_to_merge)
-00018670: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018680: 2020 234a 7573 7420 696e 2063 6173 6520    #Just in case 
-00018690: 6d61 6b65 2073 7572 6520 7468 6520 7368  make sure the sh
-000186a0: 6f72 746e 616d 6520 7374 6179 7320 7468  ortname stays th
-000186b0: 6520 7361 6d65 0d0a 2020 2020 2020 2020  e same..        
-000186c0: 2020 2020 2020 2020 6361 6e6f 6e69 6361          canonica
-000186d0: 6c5f 656c 2e73 686f 7274 6e61 6d65 203d  l_el.shortname =
-000186e0: 2063 616e 6f6e 6963 616c 5f73 686f 7274   canonical_short
-000186f0: 6e61 6d65 0d0a 0d0a 2020 2020 2020 2020  name....        
-00018700: 2020 2020 2020 2020 7365 6c66 5b63 616e          self[can
-00018710: 6f6e 6963 616c 5f65 6c2e 7368 6f72 746e  onical_el.shortn
-00018720: 616d 655d 203d 2063 616e 6f6e 6963 616c  ame] = canonical
-00018730: 5f65 6c0d 0a0d 0a20 2020 2020 2020 2020  _el....         
-00018740: 2020 2020 2020 2023 2361 6e64 2075 7064         ##and upd
-00018750: 6174 6520 7468 6520 776f 726b 696e 6720  ate the working 
-00018760: 6c69 7374 2076 6572 7369 6f6e 0d0a 2020  list version..  
-00018770: 2020 2020 2020 2020 2020 2020 2020 2365                #e
-00018780: 6c65 6d65 6e74 735f 6279 5f70 6b5b 656c  lements_by_pk[el
-00018790: 656d 656e 745f 6368 6f73 656e 5f70 6b5d  ement_chosen_pk]
-000187a0: 203d 206f 6c64 5f65 6c0d 0a0d 0a20 2020   = old_el....   
-000187b0: 2020 2020 2020 2020 2020 2020 206f 7574               out
-000187c0: 7075 745f 6c69 7374 2e61 7070 656e 6428  put_list.append(
-000187d0: 6361 6e6f 6e69 6361 6c5f 656c 290d 0a0d  canonical_el)...
-000187e0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000187f0: 653a 0d0a 0d0a 2020 2020 2020 2020 2020  e:....          
-00018800: 2020 2020 2020 6966 2065 6c2e 6469 6d65        if el.dime
-00018810: 6e73 696f 6e20 6973 204e 6f6e 653a 0d0a  nsion is None:..
-00018820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018830: 2020 2020 656c 2e64 696d 656e 7369 6f6e      el.dimension
-00018840: 203d 2073 656c 662e 6469 6d65 6e73 696f   = self.dimensio
-00018850: 6e0d 0a0d 0a0d 0a20 2020 2020 2020 2020  n......         
-00018860: 2020 2020 2020 2023 4164 6420 7468 6520         #Add the 
-00018870: 656c 656d 656e 7420 746f 2074 6865 2064  element to the d
-00018880: 696d 656e 7369 6f6e 2773 206c 6973 7420  imension's list 
-00018890: 6f66 2065 6c65 6d65 6e74 732c 2061 6e64  of elements, and
-000188a0: 2074 6f20 6f75 7220 776f 726b 696e 6720   to our working 
-000188b0: 6c69 7374 0d0a 2020 2020 2020 2020 2020  list..          
-000188c0: 2020 2020 2020 6966 2065 6c2e 7368 6f72        if el.shor
-000188d0: 746e 616d 6520 6973 204e 6f6e 653a 0d0a  tname is None:..
-000188e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188f0: 2020 2020 7365 6c66 2e5f 656c 656d 656e      self._elemen
-00018900: 7473 5f77 6974 686f 7574 5f73 686f 7274  ts_without_short
-00018910: 6e61 6d65 732e 6170 7065 6e64 2865 6c29  names.append(el)
-00018920: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018930: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00018940: 2020 2020 2020 2020 2020 2020 2023 5765               #We
-00018950: 2064 6f20 6e6f 7420 7761 6e74 2074 6f20   do not want to 
-00018960: 6f76 6572 7772 6974 6520 7468 6520 7368  overwrite the sh
-00018970: 6f72 7463 6f64 6520 6966 2069 7420 616c  ortcode if it al
-00018980: 7265 6164 7920 6578 6973 7473 2062 7574  ready exists but
-00018990: 2075 6e64 6572 2061 2064 6966 6665 7265   under a differe
-000189a0: 6e74 206b 6579 0d0a 2020 2020 2020 2020  nt key..        
-000189b0: 2020 2020 2020 2020 2020 2020 2354 6861              #Tha
-000189c0: 7420 636f 756c 6420 6163 6369 6465 6e74  t could accident
-000189d0: 616c 6c79 2068 6170 7065 6e2c 2062 7574  ally happen, but
-000189e0: 2077 6520 6365 7274 6169 6e6c 7920 646f   we certainly do
-000189f0: 6e27 7420 7761 6e74 2074 6f20 646f 2069  n't want to do i
-00018a00: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-00018a10: 2020 2020 2020 2073 686f 7274 6e61 6d65         shortname
-00018a20: 5f61 6c72 6561 6479 5f65 7869 7374 7320  _already_exists 
-00018a30: 3d20 4661 6c73 650d 0a0d 0a20 2020 2020  = False....     
-00018a40: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00018a50: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-00018a60: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00018a70: 665b 656c 2e73 686f 7274 6e61 6d65 5d0d  f[el.shortname].
+00018580: 2064 656c 2073 656c 665b 6f6c 645f 7368   del self[old_sh
+00018590: 6f72 746e 616d 655d 0d0a 2020 2020 2020  ortname]..      
+000185a0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+000185b0: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
+000185c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000185d0: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
+000185e0: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+000185f0: 6e6f 6e69 6361 6c5f 7368 6f72 746e 616d  nonical_shortnam
+00018600: 6520 3d20 6361 6e6f 6e69 6361 6c5f 656c  e = canonical_el
+00018610: 2e73 686f 7274 6e61 6d65 0d0a 0d0a 2020  .shortname....  
+00018620: 2020 2020 2020 2020 2020 2020 2020 234d                #M
+00018630: 6572 6765 2074 6865 206e 6577 2065 6c65  erge the new ele
+00018640: 6d65 6e74 2069 6e20 7769 7468 2074 6865  ment in with the
+00018650: 206f 6c64 0d0a 2020 2020 2020 2020 2020   old..          
+00018660: 2020 2020 2020 6361 6e6f 6e69 6361 6c5f        canonical_
+00018670: 656c 2e6d 6572 6765 2865 6c2c 6669 656c  el.merge(el,fiel
+00018680: 6473 5f74 6f5f 6d65 7267 653d 6669 656c  ds_to_merge=fiel
+00018690: 6473 5f74 6f5f 6d65 7267 6529 0d0a 2020  ds_to_merge)..  
+000186a0: 2020 2020 2020 2020 2020 2020 2020 234a                #J
+000186b0: 7573 7420 696e 2063 6173 6520 6d61 6b65  ust in case make
+000186c0: 2073 7572 6520 7468 6520 7368 6f72 746e   sure the shortn
+000186d0: 616d 6520 7374 6179 7320 7468 6520 7361  ame stays the sa
+000186e0: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
+000186f0: 2020 2020 6361 6e6f 6e69 6361 6c5f 656c      canonical_el
+00018700: 2e73 686f 7274 6e61 6d65 203d 2063 616e  .shortname = can
+00018710: 6f6e 6963 616c 5f73 686f 7274 6e61 6d65  onical_shortname
+00018720: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00018730: 2020 2020 7365 6c66 5b63 616e 6f6e 6963      self[canonic
+00018740: 616c 5f65 6c2e 7368 6f72 746e 616d 655d  al_el.shortname]
+00018750: 203d 2063 616e 6f6e 6963 616c 5f65 6c0d   = canonical_el.
+00018760: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00018770: 2020 2023 2361 6e64 2075 7064 6174 6520     ##and update 
+00018780: 7468 6520 776f 726b 696e 6720 6c69 7374  the working list
+00018790: 2076 6572 7369 6f6e 0d0a 2020 2020 2020   version..      
+000187a0: 2020 2020 2020 2020 2020 2365 6c65 6d65            #eleme
+000187b0: 6e74 735f 6279 5f70 6b5b 656c 656d 656e  nts_by_pk[elemen
+000187c0: 745f 6368 6f73 656e 5f70 6b5d 203d 206f  t_chosen_pk] = o
+000187d0: 6c64 5f65 6c0d 0a0d 0a20 2020 2020 2020  ld_el....       
+000187e0: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+000187f0: 6c69 7374 2e61 7070 656e 6428 6361 6e6f  list.append(cano
+00018800: 6e69 6361 6c5f 656c 290d 0a0d 0a20 2020  nical_el)....   
+00018810: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00018820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018830: 2020 6966 2065 6c2e 6469 6d65 6e73 696f    if el.dimensio
+00018840: 6e20 6973 204e 6f6e 653a 0d0a 2020 2020  n is None:..    
+00018850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018860: 656c 2e64 696d 656e 7369 6f6e 203d 2073  el.dimension = s
+00018870: 656c 662e 6469 6d65 6e73 696f 6e0d 0a0d  elf.dimension...
+00018880: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00018890: 2020 2023 4164 6420 7468 6520 656c 656d     #Add the elem
+000188a0: 656e 7420 746f 2074 6865 2064 696d 656e  ent to the dimen
+000188b0: 7369 6f6e 2773 206c 6973 7420 6f66 2065  sion's list of e
+000188c0: 6c65 6d65 6e74 732c 2061 6e64 2074 6f20  lements, and to 
+000188d0: 6f75 7220 776f 726b 696e 6720 6c69 7374  our working list
+000188e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000188f0: 2020 6966 2065 6c2e 7368 6f72 746e 616d    if el.shortnam
+00018900: 6520 6973 204e 6f6e 653a 0d0a 2020 2020  e is None:..    
+00018910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018920: 7365 6c66 2e5f 656c 656d 656e 7473 5f77  self._elements_w
+00018930: 6974 686f 7574 5f73 686f 7274 6e61 6d65  ithout_shortname
+00018940: 732e 6170 7065 6e64 2865 6c29 0d0a 2020  s.append(el)..  
+00018950: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00018960: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00018970: 2020 2020 2020 2020 2023 5765 2064 6f20           #We do 
+00018980: 6e6f 7420 7761 6e74 2074 6f20 6f76 6572  not want to over
+00018990: 7772 6974 6520 7468 6520 7368 6f72 7463  write the shortc
+000189a0: 6f64 6520 6966 2069 7420 616c 7265 6164  ode if it alread
+000189b0: 7920 6578 6973 7473 2062 7574 2075 6e64  y exists but und
+000189c0: 6572 2061 2064 6966 6665 7265 6e74 206b  er a different k
+000189d0: 6579 0d0a 2020 2020 2020 2020 2020 2020  ey..            
+000189e0: 2020 2020 2020 2020 2354 6861 7420 636f          #That co
+000189f0: 756c 6420 6163 6369 6465 6e74 616c 6c79  uld accidentally
+00018a00: 2068 6170 7065 6e2c 2062 7574 2077 6520   happen, but we 
+00018a10: 6365 7274 6169 6e6c 7920 646f 6e27 7420  certainly don't 
+00018a20: 7761 6e74 2074 6f20 646f 2069 740d 0a20  want to do it.. 
+00018a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a40: 2020 2073 686f 7274 6e61 6d65 5f61 6c72     shortname_alr
+00018a50: 6561 6479 5f65 7869 7374 7320 3d20 4661  eady_exists = Fa
+00018a60: 6c73 650d 0a0d 0a20 2020 2020 2020 2020  lse....         
+00018a70: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
 00018a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018a90: 2020 2020 2020 2020 2073 686f 7274 6e61           shortna
-00018aa0: 6d65 5f61 6c72 6561 6479 5f65 7869 7374  me_already_exist
-00018ab0: 7320 3d20 5472 7565 0d0a 2020 2020 2020  s = True..      
-00018ac0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00018ad0: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
-00018ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018af0: 2020 2020 2020 2020 7061 7373 0d0a 0d0a          pass....
-00018b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b10: 2020 2020 6966 2073 686f 7274 6e61 6d65      if shortname
-00018b20: 5f61 6c72 6561 6479 5f65 7869 7374 733a  _already_exists:
-00018b30: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00018b40: 2020 2020 2020 2020 2020 2020 2343 6865              #Che
-00018b50: 636b 2077 6865 7468 6572 2074 6865 2070  ck whether the p
-00018b60: 7265 2d65 7869 7374 696e 6720 656c 656d  re-existing elem
-00018b70: 656e 7427 7320 6b65 7973 2061 7265 2074  ent's keys are t
-00018b80: 6865 2073 616d 6520 2d20 6966 2073 6f20  he same - if so 
-00018b90: 636f 7079 2066 6965 6c64 7320 696e 0d0a  copy fields in..
-00018ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018bb0: 2020 2020 2020 2020 2349 6620 6b65 7973          #If keys
-00018bc0: 2064 6f6e 2774 206d 6174 6368 2c20 7468   don't match, th
-00018bd0: 656e 2072 6169 7365 2061 6e20 6572 726f  en raise an erro
-00018be0: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
-00018bf0: 2020 2020 2020 2020 2020 2070 7265 5f65             pre_e
-00018c00: 7869 7374 696e 675f 656c 656d 656e 7420  xisting_element 
-00018c10: 3d20 7365 6c66 5b65 6c2e 7368 6f72 746e  = self[el.shortn
-00018c20: 616d 655d 0d0a 2020 2020 2020 2020 2020  ame]..          
-00018c30: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00018c40: 655f 6578 6973 7469 6e67 5f65 6c65 6d65  e_existing_eleme
-00018c50: 6e74 5f6b 6579 203d 2074 7570 6c65 2870  nt_key = tuple(p
-00018c60: 7265 5f65 7869 7374 696e 675f 656c 656d  re_existing_elem
-00018c70: 656e 742e 6669 656c 6473 5b70 7269 6d61  ent.fields[prima
-00018c80: 7279 5f6b 6579 5f63 6f6c 756d 6e5d 2066  ry_key_column] f
-00018c90: 6f72 2070 7269 6d61 7279 5f6b 6579 5f63  or primary_key_c
-00018ca0: 6f6c 756d 6e20 696e 206b 6579 7329 0d0a  olumn in keys)..
-00018cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018cc0: 2020 2020 2020 2020 6966 2070 7265 5f65          if pre_e
-00018cd0: 7869 7374 696e 675f 656c 656d 656e 745f  xisting_element_
-00018ce0: 6b65 7920 3d3d 2074 7570 6c65 2865 6c2e  key == tuple(el.
-00018cf0: 6669 656c 6473 5b70 7269 6d61 7279 5f6b  fields[primary_k
-00018d00: 6579 5f63 6f6c 756d 6e5d 2066 6f72 2070  ey_column] for p
-00018d10: 7269 6d61 7279 5f6b 6579 5f63 6f6c 756d  rimary_key_colum
-00018d20: 6e20 696e 206b 6579 7329 3a0d 0a20 2020  n in keys):..   
-00018d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018d40: 2020 2020 2020 2020 2070 7265 5f65 7869           pre_exi
-00018d50: 7374 696e 675f 656c 656d 656e 742e 6d65  sting_element.me
-00018d60: 7267 6528 656c 2c66 6965 6c64 735f 746f  rge(el,fields_to
-00018d70: 5f6d 6572 6765 3d66 6965 6c64 735f 746f  _merge=fields_to
-00018d80: 5f6d 6572 6765 290d 0a20 2020 2020 2020  _merge)..       
-00018d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018da0: 2065 6c69 6620 7072 655f 6578 6973 7469   elif pre_existi
-00018db0: 6e67 5f65 6c65 6d65 6e74 2e6c 6f6e 676e  ng_element.longn
-00018dc0: 616d 6520 3d3d 2027 7e54 4523 4d50 7e27  ame == '~TE#MP~'
-00018dd0: 2b70 7265 5f65 7869 7374 696e 675f 656c  +pre_existing_el
-00018de0: 656d 656e 742e 7368 6f72 746e 616d 653a  ement.shortname:
-00018df0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018e00: 2020 2020 2020 2020 2020 2020 2020 2346                #F
-00018e10: 6978 2070 6172 7469 616c 6c79 206c 6f61  ix partially loa
-00018e20: 6465 6420 656c 656d 656e 7473 2062 7920  ded elements by 
-00018e30: 6f76 6572 7772 6974 696e 6720 7468 656d  overwriting them
-00018e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018e50: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00018e60: 655f 6578 6973 7469 6e67 5f65 6c65 6d65  e_existing_eleme
-00018e70: 6e74 2e6d 6572 6765 2865 6c2c 6669 656c  nt.merge(el,fiel
-00018e80: 6473 5f74 6f5f 6d65 7267 653d 6669 656c  ds_to_merge=fiel
-00018e90: 6473 5f74 6f5f 6d65 7267 6529 0d0a 2020  ds_to_merge)..  
-00018ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018eb0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00018ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ed0: 2020 2020 2020 2020 2072 6169 7365 204b           raise K
-00018ee0: 6579 4572 726f 7228 274b 6579 3a20 7b7d  eyError('Key: {}
-00018ef0: 2e20 456c 656d 656e 7420 7769 7468 2053  . Element with S
-00018f00: 686f 7274 204e 616d 653a 227b 7d22 2061  hort Name:"{}" a
-00018f10: 6c72 6561 6479 2065 7869 7374 7320 696e  lready exists in
-00018f20: 2074 6865 2064 696d 656e 7369 6f6e 2077   the dimension w
-00018f30: 6974 6820 6b65 7920 7b7d 2e20 596f 7520  ith key {}. You 
-00018f40: 7769 6c6c 206e 6565 6420 746f 206d 616e  will need to man
-00018f50: 7561 6c6c 7920 6465 6c65 7465 2069 7420  ually delete it 
-00018f60: 6672 6f6d 2074 6865 2073 6974 6520 746f  from the site to
-00018f70: 2072 6570 6169 7220 7468 6520 6c6f 6164   repair the load
-00018f80: 2e27 2e66 6f72 6d61 7428 656c 656d 656e  .'.format(elemen
-00018f90: 745f 6368 6f73 656e 5f70 6b2c 656c 2e73  t_chosen_pk,el.s
-00018fa0: 686f 7274 6e61 6d65 2c70 7265 5f65 7869  hortname,pre_exi
-00018fb0: 7374 696e 675f 656c 656d 656e 745f 6b65  sting_element_ke
-00018fc0: 7929 290d 0a20 2020 2020 2020 2020 2020  y))..           
-00018fd0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00018fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ff0: 2020 2020 2020 2020 7365 6c66 5b65 6c2e          self[el.
-00019000: 7368 6f72 746e 616d 655d 203d 2065 6c0d  shortname] = el.
-00019010: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00019020: 2020 2023 7075 7420 696e 2061 2064 6566     #put in a def
-00019030: 6175 6c74 206c 6f6e 676e 616d 6520 6966  ault longname if
-00019040: 206e 6f6e 6520 6861 7320 6265 656e 2073   none has been s
-00019050: 6574 2061 6e64 2077 6520 6172 6520 6d65  et and we are me
-00019060: 7267 696e 6720 6f6e 2073 686f 7274 6e61  rging on shortna
-00019070: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
-00019080: 2020 2020 6966 206b 6579 7320 3d3d 205b      if keys == [
-00019090: 2753 686f 7274 204e 616d 6527 5d20 616e  'Short Name'] an
-000190a0: 6420 656c 2e73 686f 7274 6e61 6d65 2069  d el.shortname i
-000190b0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2065  s not None and e
-000190c0: 6c2e 6c6f 6e67 6e61 6d65 2069 7320 4e6f  l.longname is No
-000190d0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-000190e0: 2020 2020 2020 2020 2065 6c2e 6c6f 6e67           el.long
-000190f0: 6e61 6d65 203d 2073 7472 2865 6c2e 7368  name = str(el.sh
-00019100: 6f72 746e 616d 6529 2e63 6170 6974 616c  ortname).capital
-00019110: 697a 6528 290d 0a0d 0a20 2020 2020 2020  ize()....       
-00019120: 2020 2020 2020 2020 206f 7574 7075 745f           output_
-00019130: 6c69 7374 2e61 7070 656e 6428 656c 290d  list.append(el).
-00019140: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00019150: 2020 2023 656c 656d 656e 7473 5f62 795f     #elements_by_
-00019160: 706b 5b65 6c65 6d65 6e74 5f63 686f 7365  pk[element_chose
-00019170: 6e5f 706b 5d20 3d20 656c 0d0a 0d0a 2020  n_pk] = el....  
-00019180: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00019190: 656c 656d 656e 7473 5f73 796e 6365 6420  elements_synced 
-000191a0: 3d20 4661 6c73 650d 0a0d 0a20 2020 2020  = False....     
-000191b0: 2020 2023 7365 6c66 2e5f 656c 656d 656e     #self._elemen
-000191c0: 745f 6461 7461 6672 616d 6520 3d20 7064  t_dataframe = pd
-000191d0: 2e44 6174 6146 7261 6d65 285b 656c 656d  .DataFrame([elem
-000191e0: 656e 742e 6669 656c 6473 2066 6f72 2065  ent.fields for e
-000191f0: 6c65 6d65 6e74 2069 6e20 7365 6c66 2e76  lement in self.v
-00019200: 616c 7565 7328 295d 2b5b 656c 656d 656e  alues()]+[elemen
-00019210: 742e 6669 656c 6473 2066 6f72 2065 6c65  t.fields for ele
-00019220: 6d65 6e74 2069 6e20 7365 6c66 2e5f 656c  ment in self._el
-00019230: 656d 656e 7473 5f77 6974 686f 7574 5f73  ements_without_s
-00019240: 686f 7274 6e61 6d65 735d 290d 0a0d 0a20  hortnames]).... 
-00019250: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
-00019260: 6c66 2e5f 656c 656d 656e 7473 5f77 6974  lf._elements_wit
-00019270: 686f 7574 5f73 686f 7274 6e61 6d65 7329  hout_shortnames)
-00019280: 203e 2030 3a0d 0a20 2020 2020 2020 2020   > 0:..         
-00019290: 2020 2073 656c 662e 7379 6e63 6872 6f6e     self.synchron
-000192a0: 6973 6528 7265 6578 706f 7274 3d73 796e  ise(reexport=syn
-000192b0: 632c 7265 696d 706f 7274 3d73 796e 632c  c,reimport=sync,
-000192c0: 7072 696d 6172 795f 6b65 795f 6669 656c  primary_key_fiel
-000192d0: 6473 3d6b 6579 7329 0d0a 0d0a 2020 2020  ds=keys)....    
-000192e0: 2020 2020 6966 2069 735f 6469 6374 3a0d      if is_dict:.
-000192f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00019300: 7572 6e20 7b65 6c2e 7368 6f72 746e 616d  urn {el.shortnam
-00019310: 653a 656c 2066 6f72 2065 6c20 696e 206f  e:el for el in o
-00019320: 7574 7075 745f 6c69 7374 7d0d 0a0d 0a20  utput_list}.... 
-00019330: 2020 2020 2020 2069 6620 6973 5f6c 6973         if is_lis
-00019340: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-00019350: 7265 7475 726e 206f 7574 7075 745f 6c69  return output_li
-00019360: 7374 0d0a 0d0a 2020 2020 2020 2020 6966  st....        if
-00019370: 2069 735f 6466 3a0d 0a20 2020 2020 2020   is_df:..       
-00019380: 2020 2020 2073 656c 662e 5f65 6c65 6d65       self._eleme
-00019390: 6e74 5f64 6174 6166 7261 6d65 203d 204e  nt_dataframe = N
-000193a0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-000193b0: 2072 6574 7572 6e20 7365 6c66 2e64 6174   return self.dat
-000193c0: 6166 7261 6d65 0d0a 0d0a 2020 2020 2020  aframe....      
-000193d0: 2020 6966 2069 735f 656c 656d 656e 743a    if is_element:
-000193e0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-000193f0: 7475 726e 206f 7574 7075 745f 6c69 7374  turn output_list
-00019400: 5b30 5d0d 0a0d 0a20 2020 2064 6566 2073  [0]....    def s
-00019410: 796e 6368 726f 6e69 7365 2873 656c 662c  ynchronise(self,
-00019420: 7265 6578 706f 7274 3d54 7275 652c 7265  reexport=True,re
-00019430: 696d 706f 7274 3d46 616c 7365 2c70 7269  import=False,pri
-00019440: 6d61 7279 5f6b 6579 5f66 6965 6c64 733d  mary_key_fields=
-00019450: 5b27 5368 6f72 7420 4e61 6d65 275d 293a  ['Short Name']):
-00019460: 0d0a 2020 2020 2020 2020 2727 270d 0a20  ..        '''.. 
-00019470: 2020 2020 2020 2027 2727 0d0a 2020 2020         '''..    
-00019480: 2020 2020 6465 6275 6720 2020 2020 2020      debug       
-00019490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194a0: 3d20 7365 6c66 2e64 696d 656e 7369 6f6e  = self.dimension
-000194b0: 2e73 6974 652e 5f64 6562 7567 0d0a 2020  .site._debug..  
-000194c0: 2020 2020 0d0a 2020 2020 2020 2020 2323      ..        ##
-000194d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000194e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000194f0: 2323 2323 2323 2323 2323 0d0a 2020 2020  ##########..    
-00019500: 2020 2020 230d 0a20 2020 2020 2020 2023      #..        #
-00019510: 204e 4f54 453a 2054 696d 6520 6469 6d65   NOTE: Time dime
-00019520: 6e73 696f 6e20 656c 656d 656e 7473 2061  nsion elements a
-00019530: 7265 2063 7265 6174 6564 2075 7369 6e67  re created using
-00019540: 206f 6e65 2065 6d70 6f77 6572 2066 756e   one empower fun
-00019550: 6374 696f 6e2c 2061 6e64 2074 6865 6e20  ction, and then 
-00019560: 7570 6461 7465 6420 746f 2061 6464 2074  updated to add t
-00019570: 6865 2063 6f72 7265 6374 206c 6f6e 676e  he correct longn
-00019580: 616d 6520 616e 6420 6465 7363 7269 7074  ame and descript
-00019590: 696f 6e0d 0a20 2020 2020 2020 2023 2020  ion..        #  
-000195a0: 2020 2020 2041 7420 7468 6520 7469 6d65       At the time
-000195b0: 2062 6569 6e67 2c20 7765 2063 616e 6e6f   being, we canno
-000195c0: 7420 6372 6561 7465 2074 696d 6520 4469  t create time Di
-000195d0: 6d65 6e73 696f 6e73 2075 7369 6e67 2061  mensions using a
-000195e0: 2073 686f 7274 6e61 6d65 2c20 736f 2077   shortname, so w
-000195f0: 6520 6669 7273 7420 7075 7420 7468 6520  e first put the 
-00019600: 7368 6f72 746e 616d 6520 696e 2074 6865  shortname in the
-00019610: 206c 6f6e 676e 616d 6520 616e 6420 456d   longname and Em
-00019620: 706f 7765 7220 7769 6c6c 2064 6566 6175  power will defau
-00019630: 6c74 2074 6865 2073 686f 7274 6e61 6d65  lt the shortname
-00019640: 2074 6f20 7468 6520 6c6f 6e67 6e61 6d65   to the longname
-00019650: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-00019660: 2020 5468 656e 2077 6520 7570 6461 7465    Then we update
-00019670: 2074 6865 2074 696d 6520 6469 6d65 6e73   the time dimens
-00019680: 696f 6e20 6279 2064 6f69 6e67 2061 2073  ion by doing a s
-00019690: 7461 6e64 6172 6420 696d 706f 7274 0d0a  tandard import..
-000196a0: 2020 2020 2020 2020 230d 0a0d 0a20 2020          #....   
-000196b0: 2020 2020 206b 6579 735f 7368 6f72 746e       keys_shortn
-000196c0: 616d 655f 6c6b 7020 3d20 7b7d 0d0a 0d0a  ame_lkp = {}....
-000196d0: 2020 2020 2020 2020 2369 6620 6c65 6e28          #if len(
-000196e0: 7365 6c66 2e5f 656c 656d 656e 7473 292b  self._elements)+
-000196f0: 6c65 6e28 7365 6c66 2e5f 656c 656d 656e  len(self._elemen
-00019700: 7473 5f77 6974 686f 7574 5f73 686f 7274  ts_without_short
-00019710: 636f 6465 7329 3d3d 303a 0d0a 2020 2020  codes)==0:..    
-00019720: 2020 2020 2320 2020 2072 6574 7572 6e0d      #    return.
-00019730: 0a0d 0a20 2020 2020 2020 2069 735f 7469  ...        is_ti
-00019740: 6d65 5f64 696d 656e 7369 6f6e 203d 2073  me_dimension = s
-00019750: 656c 662e 6469 6d65 6e73 696f 6e2e 696e  elf.dimension.in
-00019760: 6465 7820 3d3d 2031 310d 0a0d 0a20 2020  dex == 11....   
-00019770: 2020 2020 2023 2323 2323 2323 2323 2323       ###########
-00019780: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00019790: 2323 2323 2323 2323 0d0a 2020 2020 2020  ########..      
-000197a0: 2020 230d 0a20 2020 2020 2020 2023 0d0a    #..        #..
-000197b0: 2020 2020 2020 2020 2320 2020 2054 4f44          #    TOD
-000197c0: 4f20 2d20 6368 6563 6b20 6966 2077 6520  O - check if we 
-000197d0: 6e65 6564 2074 6f20 6372 6561 7465 206e  need to create n
-000197e0: 6577 2066 6965 6c64 7320 6669 7273 742c  ew fields first,
-000197f0: 2061 6e64 2074 6872 6f77 2061 6e20 6572   and throw an er
-00019800: 726f 7220 6966 2077 6520 646f 0d0a 2020  ror if we do..  
-00019810: 2020 2020 2020 2320 2020 2020 2020 2020        #         
-00019820: 2020 6974 2069 7320 6265 7374 2074 6f20    it is best to 
-00019830: 6372 6561 7465 206e 6577 2066 6965 6c64  create new field
-00019840: 732c 2073 7472 7563 7475 7265 7320 616e  s, structures an
-00019850: 6420 7669 6577 706f 696e 7473 2028 692e  d viewpoints (i.
-00019860: 652e 2054 7275 6520 456d 706f 7765 7220  e. True Empower 
-00019870: 4d65 7461 6461 7461 2920 6173 2061 2044  Metadata) as a D
-00019880: 444c 2073 7479 6c65 2073 7465 700d 0a20  DL style step.. 
-00019890: 2020 2020 2020 2023 0d0a 2020 2020 2020         #..      
-000198a0: 2020 2320 2020 5369 7465 2e72 6564 6566    #   Site.redef
-000198b0: 696e 6528 290d 0a0d 0a20 2020 2020 2020  ine()....       
-000198c0: 2023 2020 2053 6974 652e 6465 6669 6e69   #   Site.defini
-000198d0: 7469 6f6e 2e73 796e 6368 726f 6e69 7365  tion.synchronise
-000198e0: 2829 0d0a 0d0a 2020 2020 2020 2020 2343  ()....        #C
-000198f0: 7265 6174 6520 6120 6e65 7720 6f75 7470  reate a new outp
-00019900: 7574 5f65 6c65 6d65 6e74 7320 6c69 7374  ut_elements list
-00019910: 202d 2069 2e65 2e20 656c 656d 656e 7473   - i.e. elements
-00019920: 2074 6861 7420 6861 7665 206e 6f74 2062   that have not b
-00019930: 6565 6e20 6d61 7374 6572 6564 2062 6566  een mastered bef
-00019940: 6f72 650d 0a20 2020 2020 2020 206e 6577  ore..        new
-00019950: 5f6f 7574 7075 745f 656c 656d 656e 7473  _output_elements
-00019960: 3d5b 5d0d 0a20 2020 2020 2020 2023 466f  =[]..        #Fo
-00019970: 7220 6561 6368 2065 6c65 6d65 6e74 2069  r each element i
-00019980: 6e20 7468 6520 696e 7075 7420 656c 656d  n the input elem
-00019990: 656e 7473 206c 6973 742c 2069 6620 6974  ents list, if it
-000199a0: 2064 6f65 736e 2774 2065 7869 7374 2069   doesn't exist i
-000199b0: 6e20 7468 6520 6469 6374 696f 6e61 7279  n the dictionary
-000199c0: 206f 6620 656c 656d 656e 7473 2066 726f   of elements fro
-000199d0: 6d20 7468 6520 7369 7465 2c20 7468 656e  m the site, then
-000199e0: 2070 7574 2069 7420 696e 746f 2074 6865   put it into the
-000199f0: 206f 7574 7075 7420 656c 656d 656e 7473   output elements
-00019a00: 0d0a 2020 2020 2020 2020 2370 7269 6e74  ..        #print
-00019a10: 285b 652e 7068 7973 6964 2066 6f72 2065  ([e.physid for e
-00019a20: 2069 6e20 7365 6c66 2e76 616c 7565 7328   in self.values(
-00019a30: 295d 290d 0a20 2020 2020 2020 2066 6f72  )])..        for
-00019a40: 2069 6e70 7574 5f65 6c65 6d65 6e74 2069   input_element i
-00019a50: 6e20 7365 6c66 2e76 616c 7565 7328 293a  n self.values():
-00019a60: 0d0a 2020 2020 2020 2020 2020 2020 234d  ..            #M
-00019a70: 6173 7465 7220 6e65 7720 656c 656d 656e  aster new elemen
-00019a80: 7473 0d0a 2020 2020 2020 2020 2020 2020  ts..            
-00019a90: 6966 206e 6f74 2069 6e70 7574 5f65 6c65  if not input_ele
-00019aa0: 6d65 6e74 2e6d 6173 7465 7265 643a 0d0a  ment.mastered:..
-00019ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ac0: 6e65 775f 6f75 7470 7574 5f65 6c65 6d65  new_output_eleme
-00019ad0: 6e74 732e 6170 7065 6e64 2869 6e70 7574  nts.append(input
-00019ae0: 5f65 6c65 6d65 6e74 290d 0a0d 0a20 2020  _element)....   
-00019af0: 2020 2020 2023 7072 696e 7428 6e65 775f       #print(new_
-00019b00: 6f75 7470 7574 5f65 6c65 6d65 6e74 7329  output_elements)
-00019b10: 0d0a 0d0a 2020 2020 2020 2020 2349 6e20  ....        #In 
-00019b20: 6465 6275 6720 6d6f 6465 2c20 7772 6974  debug mode, writ
-00019b30: 6520 7468 6520 6f75 7470 7574 2065 6c65  e the output ele
-00019b40: 6d65 6e74 7320 746f 2061 2077 6f72 6b69  ments to a worki
-00019b50: 6e67 2066 696c 6520 666f 7220 696d 706f  ng file for impo
-00019b60: 7274 696e 6720 696e 746f 2065 6d70 6f77  rting into empow
-00019b70: 6572 0d0a 2020 2020 2020 2020 6966 2064  er..        if d
-00019b80: 6562 7567 3a0d 0a20 2020 2020 2020 2020  ebug:..         
-00019b90: 2020 2066 6f72 2064 6972 2069 6e20 5b73     for dir in [s
-00019ba0: 656c 662e 6469 6d65 6e73 696f 6e2e 7369  elf.dimension.si
-00019bb0: 7465 2e5f 656d 706f 7765 725f 6469 6d5f  te._empower_dim_
-00019bc0: 696d 706f 7274 5f64 6972 5d3a 0d0a 0d0a  import_dir]:....
-00019bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019be0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-00019bf0: 2020 2020 2020 2020 2020 6f73 2e6d 616b            os.mak
-00019c00: 6564 6972 7328 6469 7229 0d0a 2020 2020  edirs(dir)..    
-00019c10: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00019c20: 7074 2046 696c 6545 7869 7374 7345 7272  pt FileExistsErr
-00019c30: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-00019c40: 2020 2020 2020 2020 2070 6173 730d 0a20           pass.. 
-00019c50: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00019c60: 7863 6570 7420 4f53 4572 726f 7220 6173  xcept OSError as
-00019c70: 2065 3a0d 0a20 2020 2020 2020 2020 2020   e:..           
-00019c80: 2020 2020 2020 2020 2069 6620 652e 7769           if e.wi
-00019c90: 6e65 7272 6f72 203d 3d20 3132 333a 0d0a  nerror == 123:..
-00019ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019cb0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00019cc0: 6c75 6545 7272 6f72 2827 4469 7265 6374  lueError('Direct
-00019cd0: 6f72 7920 227b 7d22 2068 6173 2061 6e20  ory "{}" has an 
-00019ce0: 696e 7661 6c69 6420 6e61 6d65 2e20 4469  invalid name. Di
-00019cf0: 6420 796f 7520 7061 7373 2061 2073 6974  d you pass a sit
-00019d00: 655f 6c6f 6361 746f 7220 7061 7468 2022  e_locator path "
-00019d10: 7b7d 2220 7769 7468 6f75 7420 646f 7562  {}" without doub
-00019d20: 6c65 2d65 7363 6170 696e 6720 6261 636b  le-escaping back
-00019d30: 736c 6173 6865 7320 6f72 2070 7265 6669  slashes or prefi
-00019d40: 7869 6e67 2074 6865 2073 7472 696e 6720  xing the string 
-00019d50: 7769 7468 2061 6e20 2272 2220 666f 7220  with an "r" for 
-00019d60: 7261 773f 272e 666f 726d 6174 2864 6972  raw?'.format(dir
-00019d70: 2c72 6570 7228 7369 7465 5f6c 6f63 6174  ,repr(site_locat
-00019d80: 6f72 2929 290d 0a20 2020 2020 2020 2020  or)))..         
-00019d90: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00019da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019db0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00019dc0: 650d 0a20 2020 2020 2020 2020 2020 2069  e..            i
-00019dd0: 6d70 6f72 7465 645f 6469 6d65 6e73 696f  mported_dimensio
-00019de0: 6e5f 6669 6c65 7061 7468 203d 206f 732e  n_filepath = os.
-00019df0: 7061 7468 2e6a 6f69 6e28 7365 6c66 2e64  path.join(self.d
-00019e00: 696d 656e 7369 6f6e 2e73 6974 652e 5f65  imension.site._e
-00019e10: 6d70 6f77 6572 5f64 696d 5f69 6d70 6f72  mpower_dim_impor
-00019e20: 745f 6469 722c 2744 696d 656e 7369 6f6e  t_dir,'Dimension
-00019e30: 5f27 2b73 7472 2873 656c 662e 6469 6d65  _'+str(self.dime
-00019e40: 6e73 696f 6e2e 696e 6465 7829 2b27 5f4e  nsion.index)+'_N
-00019e50: 6577 456c 656d 656e 7473 2e74 7376 2729  ewElements.tsv')
-00019e60: 0d0a 2020 2020 2020 2020 2020 2020 696d  ..            im
-00019e70: 706f 7274 6564 5f66 6965 6c64 735f 6669  ported_fields_fi
-00019e80: 6c65 7061 7468 203d 206f 732e 7061 7468  lepath = os.path
-00019e90: 2e6a 6f69 6e28 7365 6c66 2e64 696d 656e  .join(self.dimen
-00019ea0: 7369 6f6e 2e73 6974 652e 5f65 6d70 6f77  sion.site._empow
-00019eb0: 6572 5f64 696d 5f69 6d70 6f72 745f 6469  er_dim_import_di
-00019ec0: 722c 2744 696d 656e 7369 6f6e 5f27 2b73  r,'Dimension_'+s
-00019ed0: 7472 2873 656c 662e 6469 6d65 6e73 696f  tr(self.dimensio
-00019ee0: 6e2e 696e 6465 7829 2b27 5f4e 6577 456c  n.index)+'_NewEl
-00019ef0: 656d 656e 7446 6965 6c64 732e 7473 7627  ementFields.tsv'
-00019f00: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00019f10: 6d70 6f72 7465 645f 7469 6d65 5f64 696d  mported_time_dim
-00019f20: 656e 7369 6f6e 5f66 696c 6570 6174 6820  ension_filepath 
-00019f30: 3d20 6f73 2e70 6174 682e 6a6f 696e 2873  = os.path.join(s
-00019f40: 656c 662e 6469 6d65 6e73 696f 6e2e 7369  elf.dimension.si
-00019f50: 7465 2e5f 656d 706f 7765 725f 6469 6d5f  te._empower_dim_
-00019f60: 696d 706f 7274 5f64 6972 2c27 4469 6d65  import_dir,'Dime
-00019f70: 6e73 696f 6e5f 272b 7374 7228 7365 6c66  nsion_'+str(self
-00019f80: 2e64 696d 656e 7369 6f6e 2e69 6e64 6578  .dimension.index
-00019f90: 292b 275f 4e65 7754 696d 6545 6c65 6d65  )+'_NewTimeEleme
-00019fa0: 6e74 732e 7473 7627 290d 0a20 2020 2020  nts.tsv')..     
-00019fb0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00019fc0: 2020 2020 2020 2343 7265 6174 6520 756e        #Create un
-00019fd0: 6971 7565 206e 616d 6564 2070 6970 6573  ique named pipes
-00019fe0: 2074 6f20 7265 6164 2061 6e64 2077 7269   to read and wri
-00019ff0: 7465 2074 6f0d 0a20 2020 2020 2020 2020  te to..         
-0001a000: 2020 2069 6d70 6f72 7465 645f 6469 6d65     imported_dime
-0001a010: 6e73 696f 6e5f 6669 6c65 7061 7468 2020  nsion_filepath  
-0001a020: 2020 2020 3d20 7227 5c5c 2e5c 7069 7065      = r'\\.\pipe
-0001a030: 5c7b 7d27 2e66 6f72 6d61 7428 7575 6964  \{}'.format(uuid
-0001a040: 2e75 7569 6434 2829 290d 0a20 2020 2020  .uuid4())..     
-0001a050: 2020 2020 2020 2069 6d70 6f72 7465 645f         imported_
-0001a060: 6669 656c 6473 5f66 696c 6570 6174 6820  fields_filepath 
-0001a070: 2020 2020 2020 2020 3d20 7227 5c5c 2e5c          = r'\\.\
-0001a080: 7069 7065 5c7b 7d27 2e66 6f72 6d61 7428  pipe\{}'.format(
-0001a090: 7575 6964 2e75 7569 6434 2829 290d 0a20  uuid.uuid4()).. 
-0001a0a0: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
-0001a0b0: 7465 645f 7469 6d65 5f64 696d 656e 7369  ted_time_dimensi
-0001a0c0: 6f6e 5f66 696c 6570 6174 6820 3d20 7227  on_filepath = r'
-0001a0d0: 5c5c 2e5c 7069 7065 5c7b 7d27 2e66 6f72  \\.\pipe\{}'.for
-0001a0e0: 6d61 7428 7575 6964 2e75 7569 6434 2829  mat(uuid.uuid4()
-0001a0f0: 290d 0a0d 0a0d 0a20 2020 2020 2020 2023  )......        #
-0001a100: 4c6f 6f6b 7570 206f 6620 6368 6172 6163  Lookup of charac
-0001a110: 7465 7273 2074 6861 7420 6361 6e20 676f  ters that can go
-0001a120: 2069 6e20 6120 7368 6f72 7463 6f64 650d   in a shortcode.
-0001a130: 0a20 2020 2020 2020 2023 676f 6f64 5f73  .        #good_s
-0001a140: 686f 7274 636f 6465 5f63 6861 7220 3d20  hortcode_char = 
-0001a150: 7b27 5127 3a31 2c27 5727 3a31 2c27 4527  {'Q':1,'W':1,'E'
-0001a160: 3a31 2c27 5227 3a31 2c27 5427 3a31 2c27  :1,'R':1,'T':1,'
-0001a170: 5927 3a31 2c27 5527 3a31 2c27 4927 3a31  Y':1,'U':1,'I':1
-0001a180: 2c27 4f27 3a31 2c27 5027 3a31 2c27 4127  ,'O':1,'P':1,'A'
-0001a190: 3a31 2c27 5327 3a31 2c27 4427 3a31 2c27  :1,'S':1,'D':1,'
-0001a1a0: 4627 3a31 2c27 4727 3a31 2c27 4827 3a31  F':1,'G':1,'H':1
-0001a1b0: 2c27 4a27 3a31 2c27 4b27 3a31 2c27 4c27  ,'J':1,'K':1,'L'
-0001a1c0: 3a31 2c27 5a27 3a31 2c27 5827 3a31 2c27  :1,'Z':1,'X':1,'
-0001a1d0: 4327 3a31 2c27 5627 3a31 2c27 4227 3a31  C':1,'V':1,'B':1
-0001a1e0: 2c27 4e27 3a31 2c27 4d27 3a31 2c27 7127  ,'N':1,'M':1,'q'
-0001a1f0: 3a31 2c27 7727 3a31 2c27 6527 3a31 2c27  :1,'w':1,'e':1,'
-0001a200: 7227 3a31 2c27 7427 3a31 2c27 7927 3a31  r':1,'t':1,'y':1
-0001a210: 2c27 7527 3a31 2c27 6927 3a31 2c27 6f27  ,'u':1,'i':1,'o'
-0001a220: 3a31 2c27 7027 3a31 2c27 6127 3a31 2c27  :1,'p':1,'a':1,'
-0001a230: 7327 3a31 2c27 6427 3a31 2c27 6627 3a31  s':1,'d':1,'f':1
-0001a240: 2c27 6727 3a31 2c27 6827 3a31 2c27 6a27  ,'g':1,'h':1,'j'
-0001a250: 3a31 2c27 6b27 3a31 2c27 6c27 3a31 2c27  :1,'k':1,'l':1,'
-0001a260: 7a27 3a31 2c27 7827 3a31 2c27 6327 3a31  z':1,'x':1,'c':1
-0001a270: 2c27 7627 3a31 2c27 6227 3a31 2c27 6e27  ,'v':1,'b':1,'n'
-0001a280: 3a31 2c27 6d27 3a31 2c27 3127 3a31 2c27  :1,'m':1,'1':1,'
-0001a290: 3227 3a31 2c27 3327 3a31 2c27 3427 3a31  2':1,'3':1,'4':1
-0001a2a0: 2c27 3527 3a31 2c27 3627 3a31 2c27 3727  ,'5':1,'6':1,'7'
-0001a2b0: 3a31 2c27 3827 3a31 2c27 3927 3a31 2c27  :1,'8':1,'9':1,'
-0001a2c0: 3027 3a31 7d0d 0a20 2020 2020 2020 2062  0':1}..        b
-0001a2d0: 6164 5f73 686f 7274 636f 6465 5f63 6861  ad_shortcode_cha
-0001a2e0: 7220 3d20 7b27 2227 3a31 2c22 2722 3a31  r = {'"':1,"'":1
-0001a2f0: 2c22 2b22 3a31 2c22 2d22 3a31 2c22 2a22  ,"+":1,"-":1,"*"
-0001a300: 3a31 2c22 2822 3a31 2c22 2922 3a31 2c22  :1,"(":1,")":1,"
-0001a310: 2f22 3a31 2c22 4022 3a31 2c22 2c22 3a31  /":1,"@":1,",":1
-0001a320: 2c22 7c22 3a31 2c22 5e22 3a31 2c22 3d22  ,"|":1,"^":1,"="
-0001a330: 3a31 2c22 5c6e 223a 312c 225c 7222 3a31  :1,"\n":1,"\r":1
-0001a340: 2c22 5c74 223a 312c 222e 223a 312c 2220  ,"\t":1,".":1," 
-0001a350: 223a 317d 0d0a 2020 2020 2020 2020 0d0a  ":1}..        ..
-0001a360: 2020 2020 2020 2020 6e65 775f 7469 6d65          new_time
-0001a370: 5f65 6c65 6d65 6e74 7320 3d20 5b5d 0d0a  _elements = []..
-0001a380: 2020 2020 2020 2020 6e65 775f 7374 616e          new_stan
-0001a390: 6461 7264 5f65 6c65 6d65 6e74 7320 3d20  dard_elements = 
-0001a3a0: 5b5d 0d0a 0d0a 2020 2020 2020 2020 6966  []....        if
-0001a3b0: 2069 735f 7469 6d65 5f64 696d 656e 7369   is_time_dimensi
-0001a3c0: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
-0001a3d0: 2066 6f72 2065 6c20 696e 206e 6577 5f6f   for el in new_o
-0001a3e0: 7574 7075 745f 656c 656d 656e 7473 3a0d  utput_elements:.
-0001a3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a400: 2069 6620 6973 696e 7374 616e 6365 2865   if isinstance(e
-0001a410: 6c2c 5469 6d65 456c 656d 656e 7429 3a0d  l,TimeElement):.
-0001a420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a430: 2020 2020 206e 6577 5f74 696d 655f 656c       new_time_el
-0001a440: 656d 656e 7473 2e61 7070 656e 6428 656c  ements.append(el
-0001a450: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001a460: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0001a470: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0001a480: 775f 7374 616e 6461 7264 5f65 6c65 6d65  w_standard_eleme
-0001a490: 6e74 732e 6170 7065 6e64 2865 6c29 0d0a  nts.append(el)..
-0001a4a0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0001a4b0: 2020 2020 2020 2020 2020 206e 6577 5f73             new_s
-0001a4c0: 7461 6e64 6172 645f 656c 656d 656e 7473  tandard_elements
-0001a4d0: 203d 206e 6577 5f6f 7574 7075 745f 656c   = new_output_el
-0001a4e0: 656d 656e 7473 0d0a 0d0a 0d0a 2020 2020  ements......    
-0001a4f0: 2020 2020 6966 206c 656e 286e 6577 5f74      if len(new_t
-0001a500: 696d 655f 656c 656d 656e 7473 2920 3e20  ime_elements) > 
-0001a510: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-0001a520: 5f74 696d 655f 6469 6d65 6e73 696f 6e5f  _time_dimension_
-0001a530: 696d 706f 7274 5f65 6c65 6d65 6e74 7328  import_elements(
-0001a540: 6469 6d65 6e73 696f 6e20 2020 2020 2020  dimension       
-0001a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a560: 203d 2073 656c 662e 6469 6d65 6e73 696f   = self.dimensio
-0001a570: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
-0001a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a590: 2020 2020 2020 2020 2020 2020 2020 2c65                ,e
-0001a5a0: 6c65 6d65 6e74 7320 2020 2020 2020 2020  lements         
+00018a90: 2020 2020 2020 2020 2073 656c 665b 656c           self[el
+00018aa0: 2e73 686f 7274 6e61 6d65 5d0d 0a20 2020  .shortname]..   
+00018ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ac0: 2020 2020 2073 686f 7274 6e61 6d65 5f61       shortname_a
+00018ad0: 6c72 6561 6479 5f65 7869 7374 7320 3d20  lready_exists = 
+00018ae0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+00018af0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00018b00: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
+00018b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b20: 2020 2020 7061 7373 0d0a 0d0a 2020 2020      pass....    
+00018b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b40: 6966 2073 686f 7274 6e61 6d65 5f61 6c72  if shortname_alr
+00018b50: 6561 6479 5f65 7869 7374 733a 0d0a 0d0a  eady_exists:....
+00018b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b70: 2020 2020 2020 2020 2343 6865 636b 2077          #Check w
+00018b80: 6865 7468 6572 2074 6865 2070 7265 2d65  hether the pre-e
+00018b90: 7869 7374 696e 6720 656c 656d 656e 7427  xisting element'
+00018ba0: 7320 6b65 7973 2061 7265 2074 6865 2073  s keys are the s
+00018bb0: 616d 6520 2d20 6966 2073 6f20 636f 7079  ame - if so copy
+00018bc0: 2066 6965 6c64 7320 696e 0d0a 2020 2020   fields in..    
+00018bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018be0: 2020 2020 2349 6620 6b65 7973 2064 6f6e      #If keys don
+00018bf0: 2774 206d 6174 6368 2c20 7468 656e 2072  't match, then r
+00018c00: 6169 7365 2061 6e20 6572 726f 720d 0a20  aise an error.. 
+00018c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018c20: 2020 2020 2020 2070 7265 5f65 7869 7374         pre_exist
+00018c30: 696e 675f 656c 656d 656e 7420 3d20 7365  ing_element = se
+00018c40: 6c66 5b65 6c2e 7368 6f72 746e 616d 655d  lf[el.shortname]
+00018c50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00018c60: 2020 2020 2020 2020 2020 7072 655f 6578            pre_ex
+00018c70: 6973 7469 6e67 5f65 6c65 6d65 6e74 5f6b  isting_element_k
+00018c80: 6579 203d 2074 7570 6c65 2870 7265 5f65  ey = tuple(pre_e
+00018c90: 7869 7374 696e 675f 656c 656d 656e 742e  xisting_element.
+00018ca0: 6669 656c 6473 5b70 7269 6d61 7279 5f6b  fields[primary_k
+00018cb0: 6579 5f63 6f6c 756d 6e5d 2066 6f72 2070  ey_column] for p
+00018cc0: 7269 6d61 7279 5f6b 6579 5f63 6f6c 756d  rimary_key_colum
+00018cd0: 6e20 696e 206b 6579 7329 0d0a 2020 2020  n in keys)..    
+00018ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018cf0: 2020 2020 6966 2070 7265 5f65 7869 7374      if pre_exist
+00018d00: 696e 675f 656c 656d 656e 745f 6b65 7920  ing_element_key 
+00018d10: 3d3d 2074 7570 6c65 2865 6c2e 6669 656c  == tuple(el.fiel
+00018d20: 6473 5b70 7269 6d61 7279 5f6b 6579 5f63  ds[primary_key_c
+00018d30: 6f6c 756d 6e5d 2066 6f72 2070 7269 6d61  olumn] for prima
+00018d40: 7279 5f6b 6579 5f63 6f6c 756d 6e20 696e  ry_key_column in
+00018d50: 206b 6579 7329 3a0d 0a20 2020 2020 2020   keys):..       
+00018d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d70: 2020 2020 2070 7265 5f65 7869 7374 696e       pre_existin
+00018d80: 675f 656c 656d 656e 742e 6d65 7267 6528  g_element.merge(
+00018d90: 656c 2c66 6965 6c64 735f 746f 5f6d 6572  el,fields_to_mer
+00018da0: 6765 3d66 6965 6c64 735f 746f 5f6d 6572  ge=fields_to_mer
+00018db0: 6765 290d 0a20 2020 2020 2020 2020 2020  ge)..           
+00018dc0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+00018dd0: 6620 7072 655f 6578 6973 7469 6e67 5f65  f pre_existing_e
+00018de0: 6c65 6d65 6e74 2e6c 6f6e 676e 616d 6520  lement.longname 
+00018df0: 3d3d 2027 7e54 4523 4d50 7e27 2b70 7265  == '~TE#MP~'+pre
+00018e00: 5f65 7869 7374 696e 675f 656c 656d 656e  _existing_elemen
+00018e10: 742e 7368 6f72 746e 616d 653a 0d0a 2020  t.shortname:..  
+00018e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e30: 2020 2020 2020 2020 2020 2346 6978 2070            #Fix p
+00018e40: 6172 7469 616c 6c79 206c 6f61 6465 6420  artially loaded 
+00018e50: 656c 656d 656e 7473 2062 7920 6f76 6572  elements by over
+00018e60: 7772 6974 696e 6720 7468 656d 0d0a 2020  writing them..  
+00018e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e80: 2020 2020 2020 2020 2020 7072 655f 6578            pre_ex
+00018e90: 6973 7469 6e67 5f65 6c65 6d65 6e74 2e6d  isting_element.m
+00018ea0: 6572 6765 2865 6c2c 6669 656c 6473 5f74  erge(el,fields_t
+00018eb0: 6f5f 6d65 7267 653d 6669 656c 6473 5f74  o_merge=fields_t
+00018ec0: 6f5f 6d65 7267 6529 0d0a 2020 2020 2020  o_merge)..      
+00018ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ee0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00018ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f00: 2020 2020 2072 6169 7365 204b 6579 4572       raise KeyEr
+00018f10: 726f 7228 274b 6579 3a20 7b7d 2e20 456c  ror('Key: {}. El
+00018f20: 656d 656e 7420 7769 7468 2053 686f 7274  ement with Short
+00018f30: 204e 616d 653a 227b 7d22 2061 6c72 6561   Name:"{}" alrea
+00018f40: 6479 2065 7869 7374 7320 696e 2074 6865  dy exists in the
+00018f50: 2064 696d 656e 7369 6f6e 2077 6974 6820   dimension with 
+00018f60: 6b65 7920 7b7d 2e20 596f 7520 7769 6c6c  key {}. You will
+00018f70: 206e 6565 6420 746f 206d 616e 7561 6c6c   need to manuall
+00018f80: 7920 6465 6c65 7465 2069 7420 6672 6f6d  y delete it from
+00018f90: 2074 6865 2073 6974 6520 746f 2072 6570   the site to rep
+00018fa0: 6169 7220 7468 6520 6c6f 6164 2e27 2e66  air the load.'.f
+00018fb0: 6f72 6d61 7428 656c 656d 656e 745f 6368  ormat(element_ch
+00018fc0: 6f73 656e 5f70 6b2c 656c 2e73 686f 7274  osen_pk,el.short
+00018fd0: 6e61 6d65 2c70 7265 5f65 7869 7374 696e  name,pre_existin
+00018fe0: 675f 656c 656d 656e 745f 6b65 7929 290d  g_element_key)).
+00018ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019000: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00019010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019020: 2020 2020 7365 6c66 5b65 6c2e 7368 6f72      self[el.shor
+00019030: 746e 616d 655d 203d 2065 6c0d 0a0d 0a20  tname] = el.... 
+00019040: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00019050: 7075 7420 696e 2061 2064 6566 6175 6c74  put in a default
+00019060: 206c 6f6e 676e 616d 6520 6966 206e 6f6e   longname if non
+00019070: 6520 6861 7320 6265 656e 2073 6574 2061  e has been set a
+00019080: 6e64 2077 6520 6172 6520 6d65 7267 696e  nd we are mergin
+00019090: 6720 6f6e 2073 686f 7274 6e61 6d65 0d0a  g on shortname..
+000190a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190b0: 6966 206b 6579 7320 3d3d 205b 2753 686f  if keys == ['Sho
+000190c0: 7274 204e 616d 6527 5d20 616e 6420 656c  rt Name'] and el
+000190d0: 2e73 686f 7274 6e61 6d65 2069 7320 6e6f  .shortname is no
+000190e0: 7420 4e6f 6e65 2061 6e64 2065 6c2e 6c6f  t None and el.lo
+000190f0: 6e67 6e61 6d65 2069 7320 4e6f 6e65 3a0d  ngname is None:.
+00019100: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019110: 2020 2020 2065 6c2e 6c6f 6e67 6e61 6d65       el.longname
+00019120: 203d 2073 7472 2865 6c2e 7368 6f72 746e   = str(el.shortn
+00019130: 616d 6529 2e63 6170 6974 616c 697a 6528  ame).capitalize(
+00019140: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+00019150: 2020 2020 206f 7574 7075 745f 6c69 7374       output_list
+00019160: 2e61 7070 656e 6428 656c 290d 0a0d 0a20  .append(el).... 
+00019170: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00019180: 656c 656d 656e 7473 5f62 795f 706b 5b65  elements_by_pk[e
+00019190: 6c65 6d65 6e74 5f63 686f 7365 6e5f 706b  lement_chosen_pk
+000191a0: 5d20 3d20 656c 0d0a 0d0a 2020 2020 2020  ] = el....      
+000191b0: 2020 2020 2020 7365 6c66 2e5f 656c 656d        self._elem
+000191c0: 656e 7473 5f73 796e 6365 6420 3d20 4661  ents_synced = Fa
+000191d0: 6c73 650d 0a0d 0a20 2020 2020 2020 2023  lse....        #
+000191e0: 7365 6c66 2e5f 656c 656d 656e 745f 6461  self._element_da
+000191f0: 7461 6672 616d 6520 3d20 7064 2e44 6174  taframe = pd.Dat
+00019200: 6146 7261 6d65 285b 656c 656d 656e 742e  aFrame([element.
+00019210: 6669 656c 6473 2066 6f72 2065 6c65 6d65  fields for eleme
+00019220: 6e74 2069 6e20 7365 6c66 2e76 616c 7565  nt in self.value
+00019230: 7328 295d 2b5b 656c 656d 656e 742e 6669  s()]+[element.fi
+00019240: 656c 6473 2066 6f72 2065 6c65 6d65 6e74  elds for element
+00019250: 2069 6e20 7365 6c66 2e5f 656c 656d 656e   in self._elemen
+00019260: 7473 5f77 6974 686f 7574 5f73 686f 7274  ts_without_short
+00019270: 6e61 6d65 735d 290d 0a0d 0a20 2020 2020  names])....     
+00019280: 2020 2069 6620 6c65 6e28 7365 6c66 2e5f     if len(self._
+00019290: 656c 656d 656e 7473 5f77 6974 686f 7574  elements_without
+000192a0: 5f73 686f 7274 6e61 6d65 7329 203e 2030  _shortnames) > 0
+000192b0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+000192c0: 656c 662e 7379 6e63 6872 6f6e 6973 6528  elf.synchronise(
+000192d0: 7265 6578 706f 7274 3d73 796e 632c 7265  reexport=sync,re
+000192e0: 696d 706f 7274 3d73 796e 632c 7072 696d  import=sync,prim
+000192f0: 6172 795f 6b65 795f 6669 656c 6473 3d6b  ary_key_fields=k
+00019300: 6579 7329 0d0a 0d0a 2020 2020 2020 2020  eys)....        
+00019310: 6966 2069 735f 6469 6374 3a0d 0a20 2020  if is_dict:..   
+00019320: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00019330: 7b65 6c2e 7368 6f72 746e 616d 653a 656c  {el.shortname:el
+00019340: 2066 6f72 2065 6c20 696e 206f 7574 7075   for el in outpu
+00019350: 745f 6c69 7374 7d0d 0a0d 0a20 2020 2020  t_list}....     
+00019360: 2020 2069 6620 6973 5f6c 6973 743a 0d0a     if is_list:..
+00019370: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00019380: 726e 206f 7574 7075 745f 6c69 7374 0d0a  rn output_list..
+00019390: 0d0a 2020 2020 2020 2020 6966 2069 735f  ..        if is_
+000193a0: 6466 3a0d 0a20 2020 2020 2020 2020 2020  df:..           
+000193b0: 2073 656c 662e 5f65 6c65 6d65 6e74 5f64   self._element_d
+000193c0: 6174 6166 7261 6d65 203d 204e 6f6e 650d  ataframe = None.
+000193d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000193e0: 7572 6e20 7365 6c66 2e64 6174 6166 7261  urn self.datafra
+000193f0: 6d65 0d0a 0d0a 2020 2020 2020 2020 6966  me....        if
+00019400: 2069 735f 656c 656d 656e 743a 0d0a 2020   is_element:..  
+00019410: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00019420: 206f 7574 7075 745f 6c69 7374 5b30 5d0d   output_list[0].
+00019430: 0a0d 0a20 2020 2064 6566 2073 796e 6368  ...    def synch
+00019440: 726f 6e69 7365 2873 656c 662c 7265 6578  ronise(self,reex
+00019450: 706f 7274 3d54 7275 652c 7265 696d 706f  port=True,reimpo
+00019460: 7274 3d46 616c 7365 2c70 7269 6d61 7279  rt=False,primary
+00019470: 5f6b 6579 5f66 6965 6c64 733d 5b27 5368  _key_fields=['Sh
+00019480: 6f72 7420 4e61 6d65 275d 293a 0d0a 2020  ort Name']):..  
+00019490: 2020 2020 2020 2727 270d 0a20 2020 2020        '''..     
+000194a0: 2020 2027 2727 0d0a 2020 2020 2020 2020     '''..        
+000194b0: 6465 6275 6720 2020 2020 2020 2020 2020  debug           
+000194c0: 2020 2020 2020 2020 2020 2020 3d20 7365              = se
+000194d0: 6c66 2e64 696d 656e 7369 6f6e 2e73 6974  lf.dimension.sit
+000194e0: 652e 5f64 6562 7567 0d0a 2020 2020 2020  e._debug..      
+000194f0: 0d0a 2020 2020 2020 2020 2323 2323 2323  ..        ######
+00019500: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00019510: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00019520: 2323 2323 2323 0d0a 2020 2020 2020 2020  ######..        
+00019530: 230d 0a20 2020 2020 2020 2023 204e 4f54  #..        # NOT
+00019540: 453a 2054 696d 6520 6469 6d65 6e73 696f  E: Time dimensio
+00019550: 6e20 656c 656d 656e 7473 2061 7265 2063  n elements are c
+00019560: 7265 6174 6564 2075 7369 6e67 206f 6e65  reated using one
+00019570: 2065 6d70 6f77 6572 2066 756e 6374 696f   empower functio
+00019580: 6e2c 2061 6e64 2074 6865 6e20 7570 6461  n, and then upda
+00019590: 7465 6420 746f 2061 6464 2074 6865 2063  ted to add the c
+000195a0: 6f72 7265 6374 206c 6f6e 676e 616d 6520  orrect longname 
+000195b0: 616e 6420 6465 7363 7269 7074 696f 6e0d  and description.
+000195c0: 0a20 2020 2020 2020 2023 2020 2020 2020  .        #      
+000195d0: 2041 7420 7468 6520 7469 6d65 2062 6569   At the time bei
+000195e0: 6e67 2c20 7765 2063 616e 6e6f 7420 6372  ng, we cannot cr
+000195f0: 6561 7465 2074 696d 6520 4469 6d65 6e73  eate time Dimens
+00019600: 696f 6e73 2075 7369 6e67 2061 2073 686f  ions using a sho
+00019610: 7274 6e61 6d65 2c20 736f 2077 6520 6669  rtname, so we fi
+00019620: 7273 7420 7075 7420 7468 6520 7368 6f72  rst put the shor
+00019630: 746e 616d 6520 696e 2074 6865 206c 6f6e  tname in the lon
+00019640: 676e 616d 6520 616e 6420 456d 706f 7765  gname and Empowe
+00019650: 7220 7769 6c6c 2064 6566 6175 6c74 2074  r will default t
+00019660: 6865 2073 686f 7274 6e61 6d65 2074 6f20  he shortname to 
+00019670: 7468 6520 6c6f 6e67 6e61 6d65 0d0a 2020  the longname..  
+00019680: 2020 2020 2020 2320 2020 2020 2020 5468        #       Th
+00019690: 656e 2077 6520 7570 6461 7465 2074 6865  en we update the
+000196a0: 2074 696d 6520 6469 6d65 6e73 696f 6e20   time dimension 
+000196b0: 6279 2064 6f69 6e67 2061 2073 7461 6e64  by doing a stand
+000196c0: 6172 6420 696d 706f 7274 0d0a 2020 2020  ard import..    
+000196d0: 2020 2020 230d 0a0d 0a20 2020 2020 2020      #....       
+000196e0: 206b 6579 735f 7368 6f72 746e 616d 655f   keys_shortname_
+000196f0: 6c6b 7020 3d20 7b7d 0d0a 0d0a 2020 2020  lkp = {}....    
+00019700: 2020 2020 2369 6620 6c65 6e28 7365 6c66      #if len(self
+00019710: 2e5f 656c 656d 656e 7473 292b 6c65 6e28  ._elements)+len(
+00019720: 7365 6c66 2e5f 656c 656d 656e 7473 5f77  self._elements_w
+00019730: 6974 686f 7574 5f73 686f 7274 636f 6465  ithout_shortcode
+00019740: 7329 3d3d 303a 0d0a 2020 2020 2020 2020  s)==0:..        
+00019750: 2320 2020 2072 6574 7572 6e0d 0a0d 0a20  #    return.... 
+00019760: 2020 2020 2020 2069 735f 7469 6d65 5f64         is_time_d
+00019770: 696d 656e 7369 6f6e 203d 2073 656c 662e  imension = self.
+00019780: 6469 6d65 6e73 696f 6e2e 696e 6465 7820  dimension.index 
+00019790: 3d3d 2031 310d 0a0d 0a20 2020 2020 2020  == 11....       
+000197a0: 2023 2323 2323 2323 2323 2323 2323 2323   ###############
+000197b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000197c0: 2323 2323 0d0a 2020 2020 2020 2020 230d  ####..        #.
+000197d0: 0a20 2020 2020 2020 2023 0d0a 2020 2020  .        #..    
+000197e0: 2020 2020 2320 2020 2054 4f44 4f20 2d20      #    TODO - 
+000197f0: 6368 6563 6b20 6966 2077 6520 6e65 6564  check if we need
+00019800: 2074 6f20 6372 6561 7465 206e 6577 2066   to create new f
+00019810: 6965 6c64 7320 6669 7273 742c 2061 6e64  ields first, and
+00019820: 2074 6872 6f77 2061 6e20 6572 726f 7220   throw an error 
+00019830: 6966 2077 6520 646f 0d0a 2020 2020 2020  if we do..      
+00019840: 2020 2320 2020 2020 2020 2020 2020 6974    #           it
+00019850: 2069 7320 6265 7374 2074 6f20 6372 6561   is best to crea
+00019860: 7465 206e 6577 2066 6965 6c64 732c 2073  te new fields, s
+00019870: 7472 7563 7475 7265 7320 616e 6420 7669  tructures and vi
+00019880: 6577 706f 696e 7473 2028 692e 652e 2054  ewpoints (i.e. T
+00019890: 7275 6520 456d 706f 7765 7220 4d65 7461  rue Empower Meta
+000198a0: 6461 7461 2920 6173 2061 2044 444c 2073  data) as a DDL s
+000198b0: 7479 6c65 2073 7465 700d 0a20 2020 2020  tyle step..     
+000198c0: 2020 2023 0d0a 2020 2020 2020 2020 2320     #..        # 
+000198d0: 2020 5369 7465 2e72 6564 6566 696e 6528    Site.redefine(
+000198e0: 290d 0a0d 0a20 2020 2020 2020 2023 2020  )....        #  
+000198f0: 2053 6974 652e 6465 6669 6e69 7469 6f6e   Site.definition
+00019900: 2e73 796e 6368 726f 6e69 7365 2829 0d0a  .synchronise()..
+00019910: 0d0a 2020 2020 2020 2020 2343 7265 6174  ..        #Creat
+00019920: 6520 6120 6e65 7720 6f75 7470 7574 5f65  e a new output_e
+00019930: 6c65 6d65 6e74 7320 6c69 7374 202d 2069  lements list - i
+00019940: 2e65 2e20 656c 656d 656e 7473 2074 6861  .e. elements tha
+00019950: 7420 6861 7665 206e 6f74 2062 6565 6e20  t have not been 
+00019960: 6d61 7374 6572 6564 2062 6566 6f72 650d  mastered before.
+00019970: 0a20 2020 2020 2020 206e 6577 5f6f 7574  .        new_out
+00019980: 7075 745f 656c 656d 656e 7473 3d5b 5d0d  put_elements=[].
+00019990: 0a20 2020 2020 2020 2023 466f 7220 6561  .        #For ea
+000199a0: 6368 2065 6c65 6d65 6e74 2069 6e20 7468  ch element in th
+000199b0: 6520 696e 7075 7420 656c 656d 656e 7473  e input elements
+000199c0: 206c 6973 742c 2069 6620 6974 2064 6f65   list, if it doe
+000199d0: 736e 2774 2065 7869 7374 2069 6e20 7468  sn't exist in th
+000199e0: 6520 6469 6374 696f 6e61 7279 206f 6620  e dictionary of 
+000199f0: 656c 656d 656e 7473 2066 726f 6d20 7468  elements from th
+00019a00: 6520 7369 7465 2c20 7468 656e 2070 7574  e site, then put
+00019a10: 2069 7420 696e 746f 2074 6865 206f 7574   it into the out
+00019a20: 7075 7420 656c 656d 656e 7473 0d0a 2020  put elements..  
+00019a30: 2020 2020 2020 2370 7269 6e74 285b 652e        #print([e.
+00019a40: 7068 7973 6964 2066 6f72 2065 2069 6e20  physid for e in 
+00019a50: 7365 6c66 2e76 616c 7565 7328 295d 290d  self.values()]).
+00019a60: 0a20 2020 2020 2020 2066 6f72 2069 6e70  .        for inp
+00019a70: 7574 5f65 6c65 6d65 6e74 2069 6e20 7365  ut_element in se
+00019a80: 6c66 2e76 616c 7565 7328 293a 0d0a 2020  lf.values():..  
+00019a90: 2020 2020 2020 2020 2020 234d 6173 7465            #Maste
+00019aa0: 7220 6e65 7720 656c 656d 656e 7473 0d0a  r new elements..
+00019ab0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00019ac0: 6f74 2069 6e70 7574 5f65 6c65 6d65 6e74  ot input_element
+00019ad0: 2e6d 6173 7465 7265 643a 0d0a 2020 2020  .mastered:..    
+00019ae0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00019af0: 6f75 7470 7574 5f65 6c65 6d65 6e74 732e  output_elements.
+00019b00: 6170 7065 6e64 2869 6e70 7574 5f65 6c65  append(input_ele
+00019b10: 6d65 6e74 290d 0a0d 0a20 2020 2020 2020  ment)....       
+00019b20: 2023 7072 696e 7428 6e65 775f 6f75 7470   #print(new_outp
+00019b30: 7574 5f65 6c65 6d65 6e74 7329 0d0a 0d0a  ut_elements)....
+00019b40: 2020 2020 2020 2020 2349 6e20 6465 6275          #In debu
+00019b50: 6720 6d6f 6465 2c20 7772 6974 6520 7468  g mode, write th
+00019b60: 6520 6f75 7470 7574 2065 6c65 6d65 6e74  e output element
+00019b70: 7320 746f 2061 2077 6f72 6b69 6e67 2066  s to a working f
+00019b80: 696c 6520 666f 7220 696d 706f 7274 696e  ile for importin
+00019b90: 6720 696e 746f 2065 6d70 6f77 6572 0d0a  g into empower..
+00019ba0: 2020 2020 2020 2020 6966 2064 6562 7567          if debug
+00019bb0: 3a0d 0a20 2020 2020 2020 2020 2020 2066  :..            f
+00019bc0: 6f72 2064 6972 2069 6e20 5b73 656c 662e  or dir in [self.
+00019bd0: 6469 6d65 6e73 696f 6e2e 7369 7465 2e5f  dimension.site._
+00019be0: 656d 706f 7765 725f 6469 6d5f 696d 706f  empower_dim_impo
+00019bf0: 7274 5f64 6972 5d3a 0d0a 0d0a 2020 2020  rt_dir]:....    
+00019c00: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00019c10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00019c20: 2020 2020 2020 6f73 2e6d 616b 6564 6972        os.makedir
+00019c30: 7328 6469 7229 0d0a 2020 2020 2020 2020  s(dir)..        
+00019c40: 2020 2020 2020 2020 6578 6365 7074 2046          except F
+00019c50: 696c 6545 7869 7374 7345 7272 6f72 3a0d  ileExistsError:.
+00019c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019c70: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
+00019c80: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00019c90: 7420 4f53 4572 726f 7220 6173 2065 3a0d  t OSError as e:.
+00019ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019cb0: 2020 2020 2069 6620 652e 7769 6e65 7272       if e.winerr
+00019cc0: 6f72 203d 3d20 3132 333a 0d0a 2020 2020  or == 123:..    
+00019cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ce0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00019cf0: 7272 6f72 2827 4469 7265 6374 6f72 7920  rror('Directory 
+00019d00: 227b 7d22 2068 6173 2061 6e20 696e 7661  "{}" has an inva
+00019d10: 6c69 6420 6e61 6d65 2e20 4469 6420 796f  lid name. Did yo
+00019d20: 7520 7061 7373 2061 2073 6974 655f 6c6f  u pass a site_lo
+00019d30: 6361 746f 7220 7061 7468 2022 7b7d 2220  cator path "{}" 
+00019d40: 7769 7468 6f75 7420 646f 7562 6c65 2d65  without double-e
+00019d50: 7363 6170 696e 6720 6261 636b 736c 6173  scaping backslas
+00019d60: 6865 7320 6f72 2070 7265 6669 7869 6e67  hes or prefixing
+00019d70: 2074 6865 2073 7472 696e 6720 7769 7468   the string with
+00019d80: 2061 6e20 2272 2220 666f 7220 7261 773f   an "r" for raw?
+00019d90: 272e 666f 726d 6174 2864 6972 2c72 6570  '.format(dir,rep
+00019da0: 7228 7369 7465 5f6c 6f63 6174 6f72 2929  r(site_locator))
+00019db0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00019dc0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00019dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019de0: 2020 2020 2020 7261 6973 6520 650d 0a20        raise e.. 
+00019df0: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+00019e00: 7465 645f 6469 6d65 6e73 696f 6e5f 6669  ted_dimension_fi
+00019e10: 6c65 7061 7468 203d 206f 732e 7061 7468  lepath = os.path
+00019e20: 2e6a 6f69 6e28 7365 6c66 2e64 696d 656e  .join(self.dimen
+00019e30: 7369 6f6e 2e73 6974 652e 5f65 6d70 6f77  sion.site._empow
+00019e40: 6572 5f64 696d 5f69 6d70 6f72 745f 6469  er_dim_import_di
+00019e50: 722c 2744 696d 656e 7369 6f6e 5f27 2b73  r,'Dimension_'+s
+00019e60: 7472 2873 656c 662e 6469 6d65 6e73 696f  tr(self.dimensio
+00019e70: 6e2e 696e 6465 7829 2b27 5f4e 6577 456c  n.index)+'_NewEl
+00019e80: 656d 656e 7473 2e74 7376 2729 0d0a 2020  ements.tsv')..  
+00019e90: 2020 2020 2020 2020 2020 696d 706f 7274            import
+00019ea0: 6564 5f66 6965 6c64 735f 6669 6c65 7061  ed_fields_filepa
+00019eb0: 7468 203d 206f 732e 7061 7468 2e6a 6f69  th = os.path.joi
+00019ec0: 6e28 7365 6c66 2e64 696d 656e 7369 6f6e  n(self.dimension
+00019ed0: 2e73 6974 652e 5f65 6d70 6f77 6572 5f64  .site._empower_d
+00019ee0: 696d 5f69 6d70 6f72 745f 6469 722c 2744  im_import_dir,'D
+00019ef0: 696d 656e 7369 6f6e 5f27 2b73 7472 2873  imension_'+str(s
+00019f00: 656c 662e 6469 6d65 6e73 696f 6e2e 696e  elf.dimension.in
+00019f10: 6465 7829 2b27 5f4e 6577 456c 656d 656e  dex)+'_NewElemen
+00019f20: 7446 6965 6c64 732e 7473 7627 290d 0a20  tFields.tsv').. 
+00019f30: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+00019f40: 7465 645f 7469 6d65 5f64 696d 656e 7369  ted_time_dimensi
+00019f50: 6f6e 5f66 696c 6570 6174 6820 3d20 6f73  on_filepath = os
+00019f60: 2e70 6174 682e 6a6f 696e 2873 656c 662e  .path.join(self.
+00019f70: 6469 6d65 6e73 696f 6e2e 7369 7465 2e5f  dimension.site._
+00019f80: 656d 706f 7765 725f 6469 6d5f 696d 706f  empower_dim_impo
+00019f90: 7274 5f64 6972 2c27 4469 6d65 6e73 696f  rt_dir,'Dimensio
+00019fa0: 6e5f 272b 7374 7228 7365 6c66 2e64 696d  n_'+str(self.dim
+00019fb0: 656e 7369 6f6e 2e69 6e64 6578 292b 275f  ension.index)+'_
+00019fc0: 4e65 7754 696d 6545 6c65 6d65 6e74 732e  NewTimeElements.
+00019fd0: 7473 7627 290d 0a20 2020 2020 2020 2065  tsv')..        e
+00019fe0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00019ff0: 2020 2343 7265 6174 6520 756e 6971 7565    #Create unique
+0001a000: 206e 616d 6564 2070 6970 6573 2074 6f20   named pipes to 
+0001a010: 7265 6164 2061 6e64 2077 7269 7465 2074  read and write t
+0001a020: 6f0d 0a20 2020 2020 2020 2020 2020 2069  o..            i
+0001a030: 6d70 6f72 7465 645f 6469 6d65 6e73 696f  mported_dimensio
+0001a040: 6e5f 6669 6c65 7061 7468 2020 2020 2020  n_filepath      
+0001a050: 3d20 7227 5c5c 2e5c 7069 7065 5c7b 7d27  = r'\\.\pipe\{}'
+0001a060: 2e66 6f72 6d61 7428 7575 6964 2e75 7569  .format(uuid.uui
+0001a070: 6434 2829 290d 0a20 2020 2020 2020 2020  d4())..         
+0001a080: 2020 2069 6d70 6f72 7465 645f 6669 656c     imported_fiel
+0001a090: 6473 5f66 696c 6570 6174 6820 2020 2020  ds_filepath     
+0001a0a0: 2020 2020 3d20 7227 5c5c 2e5c 7069 7065      = r'\\.\pipe
+0001a0b0: 5c7b 7d27 2e66 6f72 6d61 7428 7575 6964  \{}'.format(uuid
+0001a0c0: 2e75 7569 6434 2829 290d 0a20 2020 2020  .uuid4())..     
+0001a0d0: 2020 2020 2020 2069 6d70 6f72 7465 645f         imported_
+0001a0e0: 7469 6d65 5f64 696d 656e 7369 6f6e 5f66  time_dimension_f
+0001a0f0: 696c 6570 6174 6820 3d20 7227 5c5c 2e5c  ilepath = r'\\.\
+0001a100: 7069 7065 5c7b 7d27 2e66 6f72 6d61 7428  pipe\{}'.format(
+0001a110: 7575 6964 2e75 7569 6434 2829 290d 0a0d  uuid.uuid4())...
+0001a120: 0a0d 0a20 2020 2020 2020 2023 4c6f 6f6b  ...        #Look
+0001a130: 7570 206f 6620 6368 6172 6163 7465 7273  up of characters
+0001a140: 2074 6861 7420 6361 6e20 676f 2069 6e20   that can go in 
+0001a150: 6120 7368 6f72 7463 6f64 650d 0a20 2020  a shortcode..   
+0001a160: 2020 2020 2023 676f 6f64 5f73 686f 7274       #good_short
+0001a170: 636f 6465 5f63 6861 7220 3d20 7b27 5127  code_char = {'Q'
+0001a180: 3a31 2c27 5727 3a31 2c27 4527 3a31 2c27  :1,'W':1,'E':1,'
+0001a190: 5227 3a31 2c27 5427 3a31 2c27 5927 3a31  R':1,'T':1,'Y':1
+0001a1a0: 2c27 5527 3a31 2c27 4927 3a31 2c27 4f27  ,'U':1,'I':1,'O'
+0001a1b0: 3a31 2c27 5027 3a31 2c27 4127 3a31 2c27  :1,'P':1,'A':1,'
+0001a1c0: 5327 3a31 2c27 4427 3a31 2c27 4627 3a31  S':1,'D':1,'F':1
+0001a1d0: 2c27 4727 3a31 2c27 4827 3a31 2c27 4a27  ,'G':1,'H':1,'J'
+0001a1e0: 3a31 2c27 4b27 3a31 2c27 4c27 3a31 2c27  :1,'K':1,'L':1,'
+0001a1f0: 5a27 3a31 2c27 5827 3a31 2c27 4327 3a31  Z':1,'X':1,'C':1
+0001a200: 2c27 5627 3a31 2c27 4227 3a31 2c27 4e27  ,'V':1,'B':1,'N'
+0001a210: 3a31 2c27 4d27 3a31 2c27 7127 3a31 2c27  :1,'M':1,'q':1,'
+0001a220: 7727 3a31 2c27 6527 3a31 2c27 7227 3a31  w':1,'e':1,'r':1
+0001a230: 2c27 7427 3a31 2c27 7927 3a31 2c27 7527  ,'t':1,'y':1,'u'
+0001a240: 3a31 2c27 6927 3a31 2c27 6f27 3a31 2c27  :1,'i':1,'o':1,'
+0001a250: 7027 3a31 2c27 6127 3a31 2c27 7327 3a31  p':1,'a':1,'s':1
+0001a260: 2c27 6427 3a31 2c27 6627 3a31 2c27 6727  ,'d':1,'f':1,'g'
+0001a270: 3a31 2c27 6827 3a31 2c27 6a27 3a31 2c27  :1,'h':1,'j':1,'
+0001a280: 6b27 3a31 2c27 6c27 3a31 2c27 7a27 3a31  k':1,'l':1,'z':1
+0001a290: 2c27 7827 3a31 2c27 6327 3a31 2c27 7627  ,'x':1,'c':1,'v'
+0001a2a0: 3a31 2c27 6227 3a31 2c27 6e27 3a31 2c27  :1,'b':1,'n':1,'
+0001a2b0: 6d27 3a31 2c27 3127 3a31 2c27 3227 3a31  m':1,'1':1,'2':1
+0001a2c0: 2c27 3327 3a31 2c27 3427 3a31 2c27 3527  ,'3':1,'4':1,'5'
+0001a2d0: 3a31 2c27 3627 3a31 2c27 3727 3a31 2c27  :1,'6':1,'7':1,'
+0001a2e0: 3827 3a31 2c27 3927 3a31 2c27 3027 3a31  8':1,'9':1,'0':1
+0001a2f0: 7d0d 0a20 2020 2020 2020 2062 6164 5f73  }..        bad_s
+0001a300: 686f 7274 636f 6465 5f63 6861 7220 3d20  hortcode_char = 
+0001a310: 7b27 2227 3a31 2c22 2722 3a31 2c22 2b22  {'"':1,"'":1,"+"
+0001a320: 3a31 2c22 2d22 3a31 2c22 2a22 3a31 2c22  :1,"-":1,"*":1,"
+0001a330: 2822 3a31 2c22 2922 3a31 2c22 2f22 3a31  (":1,")":1,"/":1
+0001a340: 2c22 4022 3a31 2c22 2c22 3a31 2c22 7c22  ,"@":1,",":1,"|"
+0001a350: 3a31 2c22 5e22 3a31 2c22 3d22 3a31 2c22  :1,"^":1,"=":1,"
+0001a360: 5c6e 223a 312c 225c 7222 3a31 2c22 5c74  \n":1,"\r":1,"\t
+0001a370: 223a 312c 222e 223a 312c 2220 223a 317d  ":1,".":1," ":1}
+0001a380: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0001a390: 2020 2020 6e65 775f 7469 6d65 5f65 6c65      new_time_ele
+0001a3a0: 6d65 6e74 7320 3d20 5b5d 0d0a 2020 2020  ments = []..    
+0001a3b0: 2020 2020 6e65 775f 7374 616e 6461 7264      new_standard
+0001a3c0: 5f65 6c65 6d65 6e74 7320 3d20 5b5d 0d0a  _elements = []..
+0001a3d0: 0d0a 2020 2020 2020 2020 6966 2069 735f  ..        if is_
+0001a3e0: 7469 6d65 5f64 696d 656e 7369 6f6e 3a0d  time_dimension:.
+0001a3f0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001a400: 2065 6c20 696e 206e 6577 5f6f 7574 7075   el in new_outpu
+0001a410: 745f 656c 656d 656e 7473 3a0d 0a20 2020  t_elements:..   
+0001a420: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001a430: 6973 696e 7374 616e 6365 2865 6c2c 5469  isinstance(el,Ti
+0001a440: 6d65 456c 656d 656e 7429 3a0d 0a20 2020  meElement):..   
+0001a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a460: 206e 6577 5f74 696d 655f 656c 656d 656e   new_time_elemen
+0001a470: 7473 2e61 7070 656e 6428 656c 290d 0a20  ts.append(el).. 
+0001a480: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001a490: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0001a4a0: 2020 2020 2020 2020 2020 6e65 775f 7374            new_st
+0001a4b0: 616e 6461 7264 5f65 6c65 6d65 6e74 732e  andard_elements.
+0001a4c0: 6170 7065 6e64 2865 6c29 0d0a 2020 2020  append(el)..    
+0001a4d0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0001a4e0: 2020 2020 2020 206e 6577 5f73 7461 6e64         new_stand
+0001a4f0: 6172 645f 656c 656d 656e 7473 203d 206e  ard_elements = n
+0001a500: 6577 5f6f 7574 7075 745f 656c 656d 656e  ew_output_elemen
+0001a510: 7473 0d0a 0d0a 0d0a 2020 2020 2020 2020  ts......        
+0001a520: 6966 206c 656e 286e 6577 5f74 696d 655f  if len(new_time_
+0001a530: 656c 656d 656e 7473 2920 3e20 303a 0d0a  elements) > 0:..
+0001a540: 2020 2020 2020 2020 2020 2020 5f74 696d              _tim
+0001a550: 655f 6469 6d65 6e73 696f 6e5f 696d 706f  e_dimension_impo
+0001a560: 7274 5f65 6c65 6d65 6e74 7328 6469 6d65  rt_elements(dime
+0001a570: 6e73 696f 6e20 2020 2020 2020 2020 2020  nsion           
+0001a580: 2020 2020 2020 2020 2020 2020 203d 2073               = s
+0001a590: 656c 662e 6469 6d65 6e73 696f 6e0d 0a20  elf.dimension.. 
+0001a5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5c0: 3d20 6e65 775f 7469 6d65 5f65 6c65 6d65  = new_time_eleme
-0001a5d0: 6e74 730d 0a20 2020 2020 2020 2020 2020  nts..           
-0001a5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a600: 2c69 6d70 6f72 7465 645f 6469 6d65 6e73  ,imported_dimens
-0001a610: 696f 6e5f 6669 6c65 7061 7468 2020 2020  ion_filepath    
-0001a620: 2020 3d20 696d 706f 7274 6564 5f64 696d    = imported_dim
-0001a630: 656e 7369 6f6e 5f66 696c 6570 6174 680d  ension_filepath.
-0001a640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a660: 2020 2020 2020 2020 2020 2020 2c69 6d70              ,imp
-0001a670: 6f72 7465 645f 7469 6d65 5f64 696d 656e  orted_time_dimen
-0001a680: 7369 6f6e 5f66 696c 6570 6174 6820 3d20  sion_filepath = 
-0001a690: 696d 706f 7274 6564 5f74 696d 655f 6469  imported_time_di
-0001a6a0: 6d65 6e73 696f 6e5f 6669 6c65 7061 7468  mension_filepath
-0001a6b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6d0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-0001a6e0: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
-0001a6f0: 286e 6577 5f73 7461 6e64 6172 645f 656c  (new_standard_el
-0001a700: 656d 656e 7473 2920 3e20 303a 0d0a 0d0a  ements) > 0:....
-0001a710: 2020 2020 2020 2020 2020 2020 2353 7769              #Swi
-0001a720: 7463 6820 6465 7363 7269 7074 696f 6e20  tch description 
-0001a730: 666f 7220 6120 636f 6e63 6174 656e 6174  for a concatenat
-0001a740: 6564 206b 6579 202d 2077 6520 7769 6c6c  ed key - we will
-0001a750: 2062 6520 6162 6c65 2074 6f20 6772 6162   be able to grab
-0001a760: 2074 6865 2073 686f 7274 6e61 6d65 2061   the shortname a
-0001a770: 6e64 206c 696e 6b20 636f 7272 6563 7420  nd link correct 
-0001a780: 656c 656d 656e 7473 2069 6e20 6f72 6465  elements in orde
-0001a790: 7220 746f 2075 7064 6174 6520 6669 656c  r to update fiel
-0001a7a0: 6473 0d0a 2020 2020 2020 2020 2020 2020  ds..            
-0001a7b0: 6465 6620 5f65 6c65 6d65 6e74 5f73 7472  def _element_str
-0001a7c0: 696e 675f 666f 725f 696d 706f 7274 5f66  ing_for_import_f
-0001a7d0: 696c 6528 6f75 7470 7574 5f65 6c65 6d65  ile(output_eleme
-0001a7e0: 6e74 2c70 7269 6d61 7279 5f6b 6579 5f66  nt,primary_key_f
-0001a7f0: 6965 6c64 732c 6e29 3a0d 0a0d 0a20 2020  ields,n):....   
-0001a800: 2020 2020 2020 2020 2020 2020 2027 2727               '''
-0001a810: 6e20 6469 7361 6d62 6967 7561 7465 7320  n disambiguates 
-0001a820: 6265 7477 6565 6e20 6561 6368 2065 6c65  between each ele
-0001a830: 6d65 6e74 2074 6f20 666f 7263 6520 456d  ment to force Em
-0001a840: 706f 7765 7220 746f 2063 7265 6174 6520  power to create 
-0001a850: 6e65 7720 7368 6f72 746e 616d 6573 2066  new shortnames f
-0001a860: 6f72 2065 6163 6820 656c 656d 656e 7427  or each element'
-0001a870: 2727 0d0a 2020 2020 2020 2020 2020 2020  ''..            
-0001a880: 2020 2020 5f65 6c65 6d65 6e74 5f73 7472      _element_str
-0001a890: 696e 6720 3d20 2222 0d0a 2020 2020 2020  ing = ""..      
-0001a8a0: 2020 2020 2020 2020 2020 2350 7574 2063            #Put c
-0001a8b0: 6f6e 6361 7465 6e61 7465 6420 6b65 7920  oncatenated key 
-0001a8c0: 696e 746f 206c 6f6e 676e 616d 650d 0a20  into longname.. 
-0001a8d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001a8e0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-0001a8f0: 2020 2020 2020 2020 205f 656c 656d 656e           _elemen
-0001a900: 745f 7374 7269 6e67 2b3d 2027 7e54 4523  t_string+= '~TE#
-0001a910: 4d50 7e27 2b27 7e23 7e27 2e6a 6f69 6e28  MP~'+'~#~'.join(
-0001a920: 6f75 7470 7574 5f65 6c65 6d65 6e74 2e66  output_element.f
-0001a930: 6965 6c64 735b 6b65 795d 2066 6f72 206b  ields[key] for k
-0001a940: 6579 2069 6e20 7072 696d 6172 795f 6b65  ey in primary_ke
-0001a950: 795f 6669 656c 6473 290d 0a20 2020 2020  y_fields)..     
-0001a960: 2020 2020 2020 2020 2020 2020 2020 200d                 .
-0001a970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a980: 2065 7863 6570 7420 5479 7065 4572 726f   except TypeErro
-0001a990: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-0001a9a0: 2020 2020 2020 2020 234e 6f74 2061 6c6c          #Not all
-0001a9b0: 206e 6577 2065 6c65 6d65 6e74 7320 6172   new elements ar
-0001a9c0: 6520 6265 696e 6720 6372 6561 7465 6420  e being created 
-0001a9d0: 6265 6361 7573 6520 6f66 2074 6865 206d  because of the m
-0001a9e0: 6572 6765 202d 2074 6865 7265 206d 6179  erge - there may
-0001a9f0: 2062 6520 736f 6d65 2073 7461 6e64 6172   be some standar
-0001aa00: 6420 656c 656d 656e 7473 2062 6569 6e67  d elements being
-0001aa10: 2063 7265 6174 6564 2077 6974 6820 6120   created with a 
-0001aa20: 7368 6f72 746e 616d 650d 0a20 2020 2020  shortname..     
-0001aa30: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001aa40: 6620 6f75 7470 7574 5f65 6c65 6d65 6e74  f output_element
-0001aa50: 2e6c 6f6e 676e 616d 6520 6973 204e 6f6e  .longname is Non
-0001aa60: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0001aa70: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001aa80: 6520 5661 6c75 6545 7272 6f72 2827 4361  e ValueError('Ca
-0001aa90: 6e6e 6f74 2063 7265 6174 6520 6f75 7470  nnot create outp
-0001aaa0: 7574 2065 6c65 6d65 6e74 2077 6974 6820  ut element with 
-0001aab0: 6e6f 206c 6f6e 676e 616d 652e 2053 686f  no longname. Sho
-0001aac0: 7274 6e61 6d65 2069 7320 7b7d 2c20 7068  rtname is {}, ph
-0001aad0: 7973 6964 2069 7320 7b7d 2c20 6b65 7966  ysid is {}, keyf
-0001aae0: 6965 6c64 7320 6172 6520 7b7d 272e 666f  ields are {}'.fo
-0001aaf0: 726d 6174 286f 7574 7075 745f 656c 656d  rmat(output_elem
-0001ab00: 656e 742e 7368 6f72 746e 616d 652c 6f75  ent.shortname,ou
-0001ab10: 7470 7574 5f65 6c65 6d65 6e74 2e70 6879  tput_element.phy
-0001ab20: 7369 642c 7b6b 6579 3a20 6f75 7470 7574  sid,{key: output
-0001ab30: 5f65 6c65 6d65 6e74 2e66 6965 6c64 735b  _element.fields[
-0001ab40: 6b65 795d 2066 6f72 206b 6579 2069 6e20  key] for key in 
-0001ab50: 7072 696d 6172 795f 6b65 795f 6669 656c  primary_key_fiel
-0001ab60: 6473 7d29 290d 0a20 2020 2020 2020 2020  ds}))..         
-0001ab70: 2020 2020 2020 2020 2020 205f 656c 656d             _elem
-0001ab80: 656e 745f 7374 7269 6e67 2b3d 206f 7574  ent_string+= out
-0001ab90: 7075 745f 656c 656d 656e 742e 6c6f 6e67  put_element.long
-0001aba0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-0001abb0: 2020 2020 2020 5f65 6c65 6d65 6e74 5f73        _element_s
-0001abc0: 7472 696e 672b 3d20 275c 7427 0d0a 2020  tring+= '\t'..  
-0001abd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001abe0: 206f 7574 7075 745f 656c 656d 656e 742e   output_element.
-0001abf0: 7368 6f72 746e 616d 6520 6973 206e 6f74  shortname is not
-0001ac00: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0001ac10: 2020 2020 2020 2020 2020 2020 5f65 6c65              _ele
-0001ac20: 6d65 6e74 5f73 7472 696e 672b 3d20 6f75  ment_string+= ou
-0001ac30: 7470 7574 5f65 6c65 6d65 6e74 2e73 686f  tput_element.sho
-0001ac40: 7274 6e61 6d65 0d0a 2020 2020 2020 2020  rtname..        
-0001ac50: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0001ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac70: 2020 2023 4d61 6b65 2073 7572 6520 7468     #Make sure th
-0001ac80: 6572 6520 6172 6520 6e6f 2062 6164 2063  ere are no bad c
-0001ac90: 6861 7261 6374 6572 7320 696e 2074 6865  haracters in the
-0001aca0: 2073 7475 6220 7368 6f72 746e 616d 6573   stub shortnames
-0001acb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001acc0: 2020 2020 2020 7374 7562 5f73 686f 7274        stub_short
-0001acd0: 6e61 6d65 203d 2027 270d 0a20 2020 2020  name = ''..     
-0001ace0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001acf0: 6620 6f75 7470 7574 5f65 6c65 6d65 6e74  f output_element
-0001ad00: 2e6c 6f6e 676e 616d 6520 6973 204e 6f6e  .longname is Non
-0001ad10: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0001ad20: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001ad30: 6520 5661 6c75 6545 7272 6f72 2827 4361  e ValueError('Ca
-0001ad40: 6e6e 6f74 2063 7265 6174 6520 6f75 7470  nnot create outp
-0001ad50: 7574 2065 6c65 6d65 6e74 2077 6974 6820  ut element with 
-0001ad60: 6e6f 206c 6f6e 676e 616d 652e 2053 686f  no longname. Sho
-0001ad70: 7274 6e61 6d65 2069 7320 7b7d 2c20 7068  rtname is {}, ph
-0001ad80: 7973 6964 2069 7320 7b7d 2c20 6b65 7966  ysid is {}, keyf
-0001ad90: 6965 6c64 7320 6172 6520 7b7d 272e 666f  ields are {}'.fo
-0001ada0: 726d 6174 286f 7574 7075 745f 656c 656d  rmat(output_elem
-0001adb0: 656e 742e 7368 6f72 746e 616d 652c 6f75  ent.shortname,ou
-0001adc0: 7470 7574 5f65 6c65 6d65 6e74 2e70 6879  tput_element.phy
-0001add0: 7369 642c 7b6b 6579 3a20 6f75 7470 7574  sid,{key: output
-0001ade0: 5f65 6c65 6d65 6e74 2e66 6965 6c64 735b  _element.fields[
-0001adf0: 6b65 795d 2066 6f72 206b 6579 2069 6e20  key] for key in 
-0001ae00: 7072 696d 6172 795f 6b65 795f 6669 656c  primary_key_fiel
-0001ae10: 6473 7d29 290d 0a0d 0a20 2020 2020 2020  ds}))....       
-0001ae20: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001ae30: 2063 6861 7220 696e 206f 7574 7075 745f   char in output_
-0001ae40: 656c 656d 656e 742e 6c6f 6e67 6e61 6d65  element.longname
-0001ae50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001ae60: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
-0001ae70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ae80: 2020 2020 2020 2020 2020 2020 2023 4368               #Ch
-0001ae90: 6563 6b20 6966 2074 6865 2063 6861 7261  eck if the chara
-0001aea0: 6374 6572 2069 7320 6120 6261 6420 6f6e  cter is a bad on
-0001aeb0: 652c 2069 6620 736f 2061 6261 6e64 6f6e  e, if so abandon
-0001aec0: 2069 742c 2069 6620 6e6f 7420 6164 6420   it, if not add 
-0001aed0: 6974 206f 6e0d 0a20 2020 2020 2020 2020  it on..         
-0001aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aef0: 2020 2062 6164 5f73 686f 7274 636f 6465     bad_shortcode
-0001af00: 5f63 6861 725b 6368 6172 5d0d 0a20 2020  _char[char]..   
-0001af10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af20: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-0001af30: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+0001a5c0: 2020 2020 2020 2020 2020 2c65 6c65 6d65            ,eleme
+0001a5d0: 6e74 7320 2020 2020 2020 2020 2020 2020  nts             
+0001a5e0: 2020 2020 2020 2020 2020 2020 3d20 6e65              = ne
+0001a5f0: 775f 7469 6d65 5f65 6c65 6d65 6e74 730d  w_time_elements.
+0001a600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a620: 2020 2020 2020 2020 2020 2020 2c69 6d70              ,imp
+0001a630: 6f72 7465 645f 6469 6d65 6e73 696f 6e5f  orted_dimension_
+0001a640: 6669 6c65 7061 7468 2020 2020 2020 3d20  filepath      = 
+0001a650: 696d 706f 7274 6564 5f64 696d 656e 7369  imported_dimensi
+0001a660: 6f6e 5f66 696c 6570 6174 680d 0a20 2020  on_filepath..   
+0001a670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a690: 2020 2020 2020 2020 2c69 6d70 6f72 7465          ,importe
+0001a6a0: 645f 7469 6d65 5f64 696d 656e 7369 6f6e  d_time_dimension
+0001a6b0: 5f66 696c 6570 6174 6820 3d20 696d 706f  _filepath = impo
+0001a6c0: 7274 6564 5f74 696d 655f 6469 6d65 6e73  rted_time_dimens
+0001a6d0: 696f 6e5f 6669 6c65 7061 7468 0d0a 2020  ion_filepath..  
+0001a6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a700: 2020 2020 2020 2020 2029 0d0a 0d0a 2020           )....  
+0001a710: 2020 2020 2020 6966 206c 656e 286e 6577        if len(new
+0001a720: 5f73 7461 6e64 6172 645f 656c 656d 656e  _standard_elemen
+0001a730: 7473 2920 3e20 303a 0d0a 0d0a 2020 2020  ts) > 0:....    
+0001a740: 2020 2020 2020 2020 2353 7769 7463 6820          #Switch 
+0001a750: 6465 7363 7269 7074 696f 6e20 666f 7220  description for 
+0001a760: 6120 636f 6e63 6174 656e 6174 6564 206b  a concatenated k
+0001a770: 6579 202d 2077 6520 7769 6c6c 2062 6520  ey - we will be 
+0001a780: 6162 6c65 2074 6f20 6772 6162 2074 6865  able to grab the
+0001a790: 2073 686f 7274 6e61 6d65 2061 6e64 206c   shortname and l
+0001a7a0: 696e 6b20 636f 7272 6563 7420 656c 656d  ink correct elem
+0001a7b0: 656e 7473 2069 6e20 6f72 6465 7220 746f  ents in order to
+0001a7c0: 2075 7064 6174 6520 6669 656c 6473 0d0a   update fields..
+0001a7d0: 2020 2020 2020 2020 2020 2020 6465 6620              def 
+0001a7e0: 5f65 6c65 6d65 6e74 5f73 7472 696e 675f  _element_string_
+0001a7f0: 666f 725f 696d 706f 7274 5f66 696c 6528  for_import_file(
+0001a800: 6f75 7470 7574 5f65 6c65 6d65 6e74 2c70  output_element,p
+0001a810: 7269 6d61 7279 5f6b 6579 5f66 6965 6c64  rimary_key_field
+0001a820: 732c 6e29 3a0d 0a0d 0a20 2020 2020 2020  s,n):....       
+0001a830: 2020 2020 2020 2020 2027 2727 6e20 6469           '''n di
+0001a840: 7361 6d62 6967 7561 7465 7320 6265 7477  sambiguates betw
+0001a850: 6565 6e20 6561 6368 2065 6c65 6d65 6e74  een each element
+0001a860: 2074 6f20 666f 7263 6520 456d 706f 7765   to force Empowe
+0001a870: 7220 746f 2063 7265 6174 6520 6e65 7720  r to create new 
+0001a880: 7368 6f72 746e 616d 6573 2066 6f72 2065  shortnames for e
+0001a890: 6163 6820 656c 656d 656e 7427 2727 0d0a  ach element'''..
+0001a8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a8b0: 5f65 6c65 6d65 6e74 5f73 7472 696e 6720  _element_string 
+0001a8c0: 3d20 2222 0d0a 2020 2020 2020 2020 2020  = ""..          
+0001a8d0: 2020 2020 2020 2350 7574 2063 6f6e 6361        #Put conca
+0001a8e0: 7465 6e61 7465 6420 6b65 7920 696e 746f  tenated key into
+0001a8f0: 206c 6f6e 676e 616d 650d 0a20 2020 2020   longname..     
+0001a900: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+0001a910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a920: 2020 2020 205f 656c 656d 656e 745f 7374       _element_st
+0001a930: 7269 6e67 2b3d 2027 7e54 4523 4d50 7e27  ring+= '~TE#MP~'
+0001a940: 2b27 7e23 7e27 2e6a 6f69 6e28 6f75 7470  +'~#~'.join(outp
+0001a950: 7574 5f65 6c65 6d65 6e74 2e66 6965 6c64  ut_element.field
+0001a960: 735b 6b65 795d 2066 6f72 206b 6579 2069  s[key] for key i
+0001a970: 6e20 7072 696d 6172 795f 6b65 795f 6669  n primary_key_fi
+0001a980: 656c 6473 290d 0a20 2020 2020 2020 2020  elds)..         
+0001a990: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+0001a9a0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0001a9b0: 6570 7420 5479 7065 4572 726f 723a 0d0a  ept TypeError:..
+0001a9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a9d0: 2020 2020 234e 6f74 2061 6c6c 206e 6577      #Not all new
+0001a9e0: 2065 6c65 6d65 6e74 7320 6172 6520 6265   elements are be
+0001a9f0: 696e 6720 6372 6561 7465 6420 6265 6361  ing created beca
+0001aa00: 7573 6520 6f66 2074 6865 206d 6572 6765  use of the merge
+0001aa10: 202d 2074 6865 7265 206d 6179 2062 6520   - there may be 
+0001aa20: 736f 6d65 2073 7461 6e64 6172 6420 656c  some standard el
+0001aa30: 656d 656e 7473 2062 6569 6e67 2063 7265  ements being cre
+0001aa40: 6174 6564 2077 6974 6820 6120 7368 6f72  ated with a shor
+0001aa50: 746e 616d 650d 0a20 2020 2020 2020 2020  tname..         
+0001aa60: 2020 2020 2020 2020 2020 2069 6620 6f75             if ou
+0001aa70: 7470 7574 5f65 6c65 6d65 6e74 2e6c 6f6e  tput_element.lon
+0001aa80: 676e 616d 6520 6973 204e 6f6e 653a 0d0a  gname is None:..
+0001aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aaa0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0001aab0: 6c75 6545 7272 6f72 2827 4361 6e6e 6f74  lueError('Cannot
+0001aac0: 2063 7265 6174 6520 6f75 7470 7574 2065   create output e
+0001aad0: 6c65 6d65 6e74 2077 6974 6820 6e6f 206c  lement with no l
+0001aae0: 6f6e 676e 616d 652e 2053 686f 7274 6e61  ongname. Shortna
+0001aaf0: 6d65 2069 7320 7b7d 2c20 7068 7973 6964  me is {}, physid
+0001ab00: 2069 7320 7b7d 2c20 6b65 7966 6965 6c64   is {}, keyfield
+0001ab10: 7320 6172 6520 7b7d 272e 666f 726d 6174  s are {}'.format
+0001ab20: 286f 7574 7075 745f 656c 656d 656e 742e  (output_element.
+0001ab30: 7368 6f72 746e 616d 652c 6f75 7470 7574  shortname,output
+0001ab40: 5f65 6c65 6d65 6e74 2e70 6879 7369 642c  _element.physid,
+0001ab50: 7b6b 6579 3a20 6f75 7470 7574 5f65 6c65  {key: output_ele
+0001ab60: 6d65 6e74 2e66 6965 6c64 735b 6b65 795d  ment.fields[key]
+0001ab70: 2066 6f72 206b 6579 2069 6e20 7072 696d   for key in prim
+0001ab80: 6172 795f 6b65 795f 6669 656c 6473 7d29  ary_key_fields})
+0001ab90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+0001aba0: 2020 2020 2020 205f 656c 656d 656e 745f         _element_
+0001abb0: 7374 7269 6e67 2b3d 206f 7574 7075 745f  string+= output_
+0001abc0: 656c 656d 656e 742e 6c6f 6e67 6e61 6d65  element.longname
+0001abd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001abe0: 2020 5f65 6c65 6d65 6e74 5f73 7472 696e    _element_strin
+0001abf0: 672b 3d20 275c 7427 0d0a 2020 2020 2020  g+= '\t'..      
+0001ac00: 2020 2020 2020 2020 2020 6966 206f 7574            if out
+0001ac10: 7075 745f 656c 656d 656e 742e 7368 6f72  put_element.shor
+0001ac20: 746e 616d 6520 6973 206e 6f74 204e 6f6e  tname is not Non
+0001ac30: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0001ac40: 2020 2020 2020 2020 5f65 6c65 6d65 6e74          _element
+0001ac50: 5f73 7472 696e 672b 3d20 6f75 7470 7574  _string+= output
+0001ac60: 5f65 6c65 6d65 6e74 2e73 686f 7274 6e61  _element.shortna
+0001ac70: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
+0001ac80: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0001ac90: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001aca0: 4d61 6b65 2073 7572 6520 7468 6572 6520  Make sure there 
+0001acb0: 6172 6520 6e6f 2062 6164 2063 6861 7261  are no bad chara
+0001acc0: 6374 6572 7320 696e 2074 6865 2073 7475  cters in the stu
+0001acd0: 6220 7368 6f72 746e 616d 6573 0d0a 2020  b shortnames..  
+0001ace0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001acf0: 2020 7374 7562 5f73 686f 7274 6e61 6d65    stub_shortname
+0001ad00: 203d 2027 270d 0a20 2020 2020 2020 2020   = ''..         
+0001ad10: 2020 2020 2020 2020 2020 2069 6620 6f75             if ou
+0001ad20: 7470 7574 5f65 6c65 6d65 6e74 2e6c 6f6e  tput_element.lon
+0001ad30: 676e 616d 6520 6973 204e 6f6e 653a 0d0a  gname is None:..
+0001ad40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ad50: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0001ad60: 6c75 6545 7272 6f72 2827 4361 6e6e 6f74  lueError('Cannot
+0001ad70: 2063 7265 6174 6520 6f75 7470 7574 2065   create output e
+0001ad80: 6c65 6d65 6e74 2077 6974 6820 6e6f 206c  lement with no l
+0001ad90: 6f6e 676e 616d 652e 2053 686f 7274 6e61  ongname. Shortna
+0001ada0: 6d65 2069 7320 7b7d 2c20 7068 7973 6964  me is {}, physid
+0001adb0: 2069 7320 7b7d 2c20 6b65 7966 6965 6c64   is {}, keyfield
+0001adc0: 7320 6172 6520 7b7d 272e 666f 726d 6174  s are {}'.format
+0001add0: 286f 7574 7075 745f 656c 656d 656e 742e  (output_element.
+0001ade0: 7368 6f72 746e 616d 652c 6f75 7470 7574  shortname,output
+0001adf0: 5f65 6c65 6d65 6e74 2e70 6879 7369 642c  _element.physid,
+0001ae00: 7b6b 6579 3a20 6f75 7470 7574 5f65 6c65  {key: output_ele
+0001ae10: 6d65 6e74 2e66 6965 6c64 735b 6b65 795d  ment.fields[key]
+0001ae20: 2066 6f72 206b 6579 2069 6e20 7072 696d   for key in prim
+0001ae30: 6172 795f 6b65 795f 6669 656c 6473 7d29  ary_key_fields})
+0001ae40: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+0001ae50: 2020 2020 2020 2020 2066 6f72 2063 6861           for cha
+0001ae60: 7220 696e 206f 7574 7075 745f 656c 656d  r in output_elem
+0001ae70: 656e 742e 6c6f 6e67 6e61 6d65 3a0d 0a20  ent.longname:.. 
+0001ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae90: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+0001aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aeb0: 2020 2020 2020 2020 2023 4368 6563 6b20           #Check 
+0001aec0: 6966 2074 6865 2063 6861 7261 6374 6572  if the character
+0001aed0: 2069 7320 6120 6261 6420 6f6e 652c 2069   is a bad one, i
+0001aee0: 6620 736f 2061 6261 6e64 6f6e 2069 742c  f so abandon it,
+0001aef0: 2069 6620 6e6f 7420 6164 6420 6974 206f   if not add it o
+0001af00: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
+0001af10: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0001af20: 6164 5f73 686f 7274 636f 6465 5f63 6861  ad_shortcode_cha
+0001af30: 725b 6368 6172 5d0d 0a20 2020 2020 2020  r[char]..       
 0001af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af50: 2020 2073 7475 625f 7368 6f72 746e 616d     stub_shortnam
-0001af60: 6520 2b3d 2063 6861 720d 0a20 2020 2020  e += char..     
-0001af70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001af80: 2054 4f44 4f3a 2052 6561 6c6c 7920 6e65   TODO: Really ne
-0001af90: 6564 2074 6f20 6c6f 6f6b 2061 7420 7468  ed to look at th
-0001afa0: 6973 2068 6163 6b79 2062 6568 6176 696f  is hacky behavio
-0001afb0: 7572 2e2e 2e2e 0d0a 0d0a 2020 2020 2020  ur........      
-0001afc0: 2020 2020 2020 2020 2020 2020 2020 2373                #s
-0001afd0: 7475 6220 7368 6f72 746e 616d 6573 2061  tub shortnames a
-0001afe0: 7265 2064 656c 6962 6572 6174 656c 7920  re deliberately 
-0001aff0: 746f 6f20 6c6f 6e67 2061 6e64 2064 6966  too long and dif
-0001b000: 6665 7265 6e74 2066 726f 6d20 6561 6368  ferent from each
-0001b010: 206f 7468 6572 2c20 746f 2066 6f72 6365   other, to force
-0001b020: 2045 6d70 6f77 6572 2074 6f20 6765 6e65   Empower to gene
-0001b030: 7261 7465 206e 6577 206f 6e65 730d 0a20  rate new ones.. 
-0001b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b050: 2020 2023 5f65 6c65 6d65 6e74 5f73 7472     #_element_str
-0001b060: 696e 6720 2b3d 2073 7475 625f 7368 6f72  ing += stub_shor
-0001b070: 746e 616d 655b 3a31 305d 2b28 272b 272a  tname[:10]+('+'*
-0001b080: 3531 3229 2b73 7472 286e 290d 0a20 2020  512)+str(n)..   
-0001b090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0a0: 205f 656c 656d 656e 745f 7374 7269 6e67   _element_string
-0001b0b0: 202b 3d20 7374 7562 5f73 686f 7274 6e61   += stub_shortna
-0001b0c0: 6d65 5b3a 6c6c 752e 7368 6f72 746e 616d  me[:llu.shortnam
-0001b0d0: 655f 7369 7a65 5d2b 272b 272b 7374 7228  e_size]+'+'+str(
-0001b0e0: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
-0001b0f0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-0001b100: 2020 2020 2020 2020 2020 5f65 6c65 6d65            _eleme
-0001b110: 6e74 5f73 7472 696e 6720 2b3d 2027 5c74  nt_string += '\t
-0001b120: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
-0001b130: 2020 2069 6620 6f75 7470 7574 5f65 6c65     if output_ele
-0001b140: 6d65 6e74 2e64 6573 6372 6970 7469 6f6e  ment.description
-0001b150: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-0001b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b170: 2020 205f 656c 656d 656e 745f 7374 7269     _element_stri
-0001b180: 6e67 202b 3d20 6f75 7470 7574 5f65 6c65  ng += output_ele
-0001b190: 6d65 6e74 2e64 6573 6372 6970 7469 6f6e  ment.description
-0001b1a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001b1b0: 2020 5f65 6c65 6d65 6e74 5f73 7472 696e    _element_strin
-0001b1c0: 6720 2b3d 2027 5c6e 270d 0a0d 0a20 2020  g += '\n'....   
-0001b1d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001b1e0: 7572 6e20 5f65 6c65 6d65 6e74 5f73 7472  urn _element_str
-0001b1f0: 696e 670d 0a0d 0a20 2020 2020 2020 2020  ing....         
-0001b200: 2020 2023 4372 6561 7465 2074 6865 2063     #Create the c
-0001b210: 6f6d 6d61 6e64 7320 746f 2049 6d70 6f72  ommands to Impor
-0001b220: 7420 7468 6520 656c 656d 656e 7473 2069  t the elements i
-0001b230: 6e20 7468 6520 776f 726b 696e 6720 6669  n the working fi
-0001b240: 6c65 2069 6e74 6f20 456d 706f 7765 720d  le into Empower.
-0001b250: 0a20 2020 2020 2020 2020 2020 2023 5468  .            #Th
-0001b260: 6573 6520 7769 6c6c 2062 6520 7275 6e20  ese will be run 
-0001b270: 6279 2049 6d70 6f72 7465 7220 696e 2061  by Importer in a
-0001b280: 206d 6f6d 656e 7420 7768 656e 2077 6520   moment when we 
-0001b290: 6172 6520 7265 6164 7920 746f 2064 6f20  are ready to do 
-0001b2a0: 6f75 7220 6d65 7272 7920 6d75 6c74 692d  our merry multi-
-0001b2b0: 7072 6f63 6573 7369 6e67 2064 616e 6365  processing dance
-0001b2c0: 2077 6974 6820 6e61 6d65 6420 7069 7065   with named pipe
-0001b2d0: 730d 0a20 2020 2020 2020 2020 2020 2023  s..            #
-0001b2e0: 4669 6e69 7368 206f 6666 2074 6865 2063  Finish off the c
-0001b2f0: 6f6d 6d61 6e64 206c 6973 7420 6e6f 7720  ommand list now 
-0001b300: 7765 2776 6520 7365 7420 6170 7072 6f70  we've set approp
-0001b310: 7269 6174 6520 7573 6572 6e61 6d65 2f70  riate username/p
-0001b320: 6173 7377 6f72 640d 0a20 2020 2020 2020  assword..       
-0001b330: 2020 2020 2063 6f6d 6d61 6e64 5f6c 6973       command_lis
-0001b340: 7420 3d20 7365 6c66 2e64 696d 656e 7369  t = self.dimensi
-0001b350: 6f6e 2e73 6974 652e 5f6c 6f67 6f6e 5f70  on.site._logon_p
-0001b360: 6172 616d 6574 6572 5f69 6d70 6f72 7465  arameter_importe
-0001b370: 725f 636f 6d6d 616e 6473 202b 205c 0d0a  r_commands + \..
-0001b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b390: 2020 2020 2020 2020 2020 205b 2773 6574             ['set
-0001b3a0: 2d70 6172 616d 6574 6572 2064 696d 656e  -parameter dimen
-0001b3b0: 7369 6f6e 5f69 6e64 6578 3d27 2020 2020  sion_index='    
-0001b3c0: 2b20 7374 7228 7365 6c66 2e64 696d 656e  + str(self.dimen
-0001b3d0: 7369 6f6e 2e69 6e64 6578 290d 0a20 2020  sion.index)..   
-0001b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b3f0: 2020 2020 2020 2020 2c27 6c6f 6164 2d66          ,'load-f
-0001b400: 696c 652d 7473 7620 2227 2020 2020 2020  ile-tsv "'      
-0001b410: 2020 2020 2020 2020 2020 2020 202b 2069               + i
-0001b420: 6d70 6f72 7465 645f 6469 6d65 6e73 696f  mported_dimensio
-0001b430: 6e5f 6669 6c65 7061 7468 202b 2027 2227  n_filepath + '"'
-0001b440: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001b450: 2020 2020 2020 2020 2020 2020 202c 2765               ,'e
-0001b460: 6d70 6f77 6572 2d69 6d70 6f72 742d 656c  mpower-import-el
-0001b470: 656d 656e 7473 2022 247b 7369 7465 7d22  ements "${site}"
-0001b480: 2022 247b 7573 6572 7d22 2022 247b 7061   "${user}" "${pa
-0001b490: 7373 776f 7264 7d22 2024 7b64 696d 656e  ssword}" ${dimen
-0001b4a0: 7369 6f6e 5f69 6e64 6578 7d27 0d0a 2020  sion_index}'..  
-0001b4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b4c0: 2020 2020 2020 2020 205d 0d0a 0d0a 2020           ]....  
-0001b4d0: 2020 2020 2020 2020 2020 2349 6e20 6465            #In de
-0001b4e0: 6275 6720 6d6f 6465 2077 7269 7465 2074  bug mode write t
-0001b4f0: 6865 2064 6174 6120 696e 746f 2061 2074  he data into a t
-0001b500: 7376 2066 696c 6520 616e 6420 7265 6164  sv file and read
-0001b510: 2069 7420 7769 7468 2049 6d70 6f72 7465   it with Importe
-0001b520: 722c 2070 7574 7469 6e67 2074 6865 2065  r, putting the e
-0001b530: 6c65 6d65 6e74 7320 696e 746f 2045 6d70  lements into Emp
-0001b540: 6f77 6572 0d0a 2020 2020 2020 2020 2020  ower..          
-0001b550: 2020 6966 2064 6562 7567 3a0d 0a20 2020    if debug:..   
-0001b560: 2020 2020 2020 2020 2020 2020 2077 6974               wit
-0001b570: 6820 6f70 656e 2869 6d70 6f72 7465 645f  h open(imported_
-0001b580: 6469 6d65 6e73 696f 6e5f 6669 6c65 7061  dimension_filepa
-0001b590: 7468 2c27 7727 2c65 6e63 6f64 696e 673d  th,'w',encoding=
-0001b5a0: 2775 7466 3827 2920 6173 2069 6d70 6f72  'utf8') as impor
-0001b5b0: 7465 645f 6469 6d65 6e73 696f 6e5f 6669  ted_dimension_fi
-0001b5c0: 6c65 3a0d 0a20 2020 2020 2020 2020 2020  le:..           
-0001b5d0: 2020 2020 2020 2020 2066 6f72 206e 2c20           for n, 
-0001b5e0: 6f75 7470 7574 5f65 6c65 6d65 6e74 2069  output_element i
-0001b5f0: 6e20 656e 756d 6572 6174 6528 6e65 775f  n enumerate(new_
-0001b600: 7374 616e 6461 7264 5f65 6c65 6d65 6e74  standard_element
-0001b610: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
-0001b620: 2020 2020 2020 2020 2020 2020 2069 6d70               imp
-0001b630: 6f72 7465 645f 6469 6d65 6e73 696f 6e5f  orted_dimension_
-0001b640: 6669 6c65 2e77 7269 7465 285f 656c 656d  file.write(_elem
-0001b650: 656e 745f 7374 7269 6e67 5f66 6f72 5f69  ent_string_for_i
-0001b660: 6d70 6f72 745f 6669 6c65 286f 7574 7075  mport_file(outpu
-0001b670: 745f 656c 656d 656e 742c 7072 696d 6172  t_element,primar
-0001b680: 795f 6b65 795f 6669 656c 6473 2c6e 2929  y_key_fields,n))
-0001b690: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001b6a0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-0001b6b0: 2020 206c 6c75 2e72 756e 5f73 696e 676c     llu.run_singl
-0001b6c0: 655f 6f75 7470 7574 5f69 6d70 6f72 7465  e_output_importe
-0001b6d0: 725f 636f 6d6d 616e 6473 2863 6f6d 6d61  r_commands(comma
-0001b6e0: 6e64 5f6c 6973 742c 2065 6d70 6f77 6572  nd_list, empower
-0001b6f0: 5f69 6d70 6f72 7465 725f 6578 6563 7574  _importer_execut
-0001b700: 6162 6c65 3d73 656c 662e 6469 6d65 6e73  able=self.dimens
-0001b710: 696f 6e2e 7369 7465 2e65 6d70 6f77 6572  ion.site.empower
-0001b720: 5f69 6d70 6f72 7465 725f 6578 6563 7574  _importer_execut
-0001b730: 6162 6c65 290d 0a0d 0a20 2020 2020 2020  able)....       
-0001b740: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0001b750: 2020 2020 2020 2020 2020 2020 2349 6e20              #In 
-0001b760: 276e 6f72 6d61 6c27 206d 6f64 6520 646f  'normal' mode do
-0001b770: 2061 206d 6572 7279 2064 616e 6365 2077   a merry dance w
-0001b780: 6974 6820 5769 6e64 6f77 7320 6e61 6d65  ith Windows name
-0001b790: 6420 7069 7065 732e 2054 6869 7320 6176  d pipes. This av
-0001b7a0: 6f69 6473 2077 7269 7469 6e67 2074 6865  oids writing the
-0001b7b0: 2064 6174 6120 746f 2066 696c 6520 666f   data to file fo
-0001b7c0: 7220 7365 6375 7269 7479 2061 6e64 2070  r security and p
-0001b7d0: 7261 6374 6963 616c 6974 7920 7265 6173  racticality reas
-0001b7e0: 6f6e 730d 0a20 2020 2020 2020 2020 2020  ons..           
-0001b7f0: 2020 2020 2023 696d 706f 7274 6564 5f64       #imported_d
-0001b800: 696d 656e 7369 6f6e 5f66 696c 6570 6174  imension_filepat
-0001b810: 6820 6973 2074 6865 206e 616d 6520 6f66  h is the name of
-0001b820: 2074 6865 206e 616d 6564 2070 6970 6520   the named pipe 
-0001b830: 652e 672e 205c 5c2e 5c70 6970 655c 3964  e.g. \\.\pipe\9d
-0001b840: 6363 6661 3038 2d34 3063 312d 3435 6635  ccfa08-40c1-45f5
-0001b850: 2d38 6530 652d 6636 3463 3138 3530 3262  -8e0e-f64c18502b
-0001b860: 6364 0d0a 2020 2020 2020 2020 2020 2020  cd..            
-0001b870: 2020 2020 2354 6865 206d 6572 7279 2064      #The merry d
-0001b880: 616e 6365 206d 6561 6e73 2073 7461 7274  ance means start
-0001b890: 696e 6720 656d 706f 7765 722c 2072 6566  ing empower, ref
-0001b8a0: 6572 656e 6369 6e67 2074 6865 2070 6970  erencing the pip
-0001b8b0: 652c 206f 7065 6e69 6e67 2074 6865 2070  e, opening the p
-0001b8c0: 6970 6520 6265 666f 7265 2065 6d70 6f77  ipe before empow
-0001b8d0: 6572 2069 7320 7072 6f70 6572 6c79 2073  er is properly s
-0001b8e0: 7461 7274 6564 0d0a 2020 2020 2020 2020  tarted..        
-0001b8f0: 2020 2020 2020 2020 2373 6574 7469 6e67          #setting
-0001b900: 2075 7020 7468 6520 6e61 6d65 6420 7069   up the named pi
-0001b910: 7065 206f 6e20 7468 6973 2074 6872 6561  pe on this threa
-0001b920: 642c 2061 6e64 2077 7269 7469 6e67 2074  d, and writing t
-0001b930: 6f20 6974 2028 6173 2073 6f6f 6e20 6173  o it (as soon as
-0001b940: 2049 6d70 6f72 7465 7220 636f 6e6e 6563   Importer connec
-0001b950: 7473 2061 7420 6974 7320 656e 6429 0d0a  ts at its end)..
-0001b960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b970: 2354 6865 2064 6966 6669 6375 6c74 792c  #The difficulty,
-0001b980: 2069 7320 7468 6174 2077 6520 6861 7665   is that we have
-0001b990: 2074 6f20 7061 7373 2074 6865 206e 616d   to pass the nam
-0001b9a0: 6520 6f66 2074 6865 2070 6970 6520 746f  e of the pipe to
-0001b9b0: 2049 6d70 6f72 7465 722c 2061 6e64 2072   Importer, and r
-0001b9c0: 656c 7920 6f6e 2074 6865 2066 6163 7420  ely on the fact 
-0001b9d0: 7468 6174 2069 7420 776f 6e27 7420 6861  that it won't ha
-0001b9e0: 7665 2074 696d 6520 746f 206f 7065 6e20  ve time to open 
-0001b9f0: 6974 0d0a 2020 2020 2020 2020 2020 2020  it..            
-0001ba00: 2020 2020 2362 6566 6f72 6520 7765 2068      #before we h
-0001ba10: 6176 6520 6372 6561 7465 6420 6974 2e20  ave created it. 
-0001ba20: 4275 7420 7765 2077 696c 6c20 626c 6f63  But we will bloc
-0001ba30: 6b20 6f6e 206f 7572 2073 6964 6520 756e  k on our side un
-0001ba40: 7469 6c20 496d 706f 7274 6572 2068 6173  til Importer has
-0001ba50: 2063 6f6e 6e65 6374 6564 0d0a 2020 2020   connected..    
-0001ba60: 2020 2020 2020 2020 2020 2020 7072 6f63              proc
-0001ba70: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-0001ba80: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-0001ba90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001baa0: 2020 2070 726f 6320 3d20 6c6c 752e 7374     proc = llu.st
-0001bab0: 6172 745f 6e6f 5f6f 7574 7075 745f 696d  art_no_output_im
-0001bac0: 706f 7274 6572 5f63 6f6d 6d61 6e64 7328  porter_commands(
-0001bad0: 636f 6d6d 616e 645f 6c69 7374 2c65 6d70  command_list,emp
-0001bae0: 6f77 6572 5f69 6d70 6f72 7465 725f 6578  ower_importer_ex
-0001baf0: 6563 7574 6162 6c65 3d73 656c 662e 6469  ecutable=self.di
-0001bb00: 6d65 6e73 696f 6e2e 7369 7465 2e65 6d70  mension.site.emp
-0001bb10: 6f77 6572 5f69 6d70 6f72 7465 725f 6578  ower_importer_ex
-0001bb20: 6563 7574 6162 6c65 290d 0a20 2020 2020  ecutable)..     
-0001bb30: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001bb40: 6974 6820 6c6c 752e 6f75 7462 6f75 6e64  ith llu.outbound
-0001bb50: 5f70 6970 6528 696d 706f 7274 6564 5f64  _pipe(imported_d
-0001bb60: 696d 656e 7369 6f6e 5f66 696c 6570 6174  imension_filepat
-0001bb70: 6829 2061 7320 7069 7065 3a0d 0a0d 0a20  h) as pipe:.... 
-0001bb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb90: 2020 2020 2020 2066 6f72 206e 2c20 6f75         for n, ou
-0001bba0: 7470 7574 5f65 6c65 6d65 6e74 2069 6e20  tput_element in 
-0001bbb0: 656e 756d 6572 6174 6528 6e65 775f 7374  enumerate(new_st
-0001bbc0: 616e 6461 7264 5f65 6c65 6d65 6e74 7329  andard_elements)
-0001bbd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001bbe0: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001bbf0: 696e 3332 6669 6c65 2e57 7269 7465 4669  in32file.WriteFi
-0001bc00: 6c65 2870 6970 652c 2073 7472 2e65 6e63  le(pipe, str.enc
-0001bc10: 6f64 6528 5f65 6c65 6d65 6e74 5f73 7472  ode(_element_str
-0001bc20: 696e 675f 666f 725f 696d 706f 7274 5f66  ing_for_import_f
-0001bc30: 696c 6528 6f75 7470 7574 5f65 6c65 6d65  ile(output_eleme
-0001bc40: 6e74 2c70 7269 6d61 7279 5f6b 6579 5f66  nt,primary_key_f
-0001bc50: 6965 6c64 732c 6e29 2929 0d0a 0d0a 2020  ields,n)))....  
-0001bc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bc70: 2020 2020 2020 6c6f 672e 6465 6275 6728        log.debug(
-0001bc80: 2250 6970 6520 7b7d 2066 696e 6973 6865  "Pipe {} finishe
-0001bc90: 6420 7772 6974 696e 6722 2e66 6f72 6d61  d writing".forma
-0001bca0: 7428 696d 706f 7274 6564 5f64 696d 656e  t(imported_dimen
-0001bcb0: 7369 6f6e 5f66 696c 6570 6174 6829 290d  sion_filepath)).
-0001bcc0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0001bcd0: 2020 2066 696e 616c 6c79 3a0d 0a20 2020     finally:..   
-0001bce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bcf0: 2023 4368 6563 6b20 6966 2049 6d70 6f72   #Check if Impor
-0001bd00: 7465 7220 7265 7475 726e 6564 2061 6e20  ter returned an 
-0001bd10: 6572 726f 7220 616e 6420 7261 6973 6520  error and raise 
-0001bd20: 6974 2061 7320 6120 7079 7468 6f6e 2069  it as a python i
-0001bd30: 6620 6974 2064 6964 0d0a 2020 2020 2020  f it did..      
-0001bd40: 2020 2020 2020 2020 2020 2020 2020 6c6c                ll
-0001bd50: 752e 636f 6d70 6c65 7465 5f6e 6f5f 6f75  u.complete_no_ou
-0001bd60: 7470 7574 5f69 6d70 6f72 7465 725f 7072  tput_importer_pr
-0001bd70: 6f63 6573 7328 7072 6f63 290d 0a0d 0a0d  ocess(proc).....
-0001bd80: 0a20 2020 2020 2020 2023 4e65 6564 2074  .        #Need t
-0001bd90: 6f20 6d61 7463 6820 7570 206f 6e20 6b65  o match up on ke
-0001bda0: 7920 636f 6c75 6d6e 2066 6f72 206e 6577  y column for new
-0001bdb0: 2069 7465 6d73 0d0a 2020 2020 2020 2020   items..        
-0001bdc0: 2346 6972 7374 2063 6865 636b 2074 6865  #First check the
-0001bdd0: 7265 2061 7265 2066 6965 6c64 730d 0a0d  re are fields...
-0001bde0: 0a20 2020 2020 2020 2066 6f72 2065 6c65  .        for ele
-0001bdf0: 6d65 6e74 2069 6e20 5f63 7265 6174 655f  ment in _create_
-0001be00: 656d 706f 7765 725f 6469 6d65 6e73 696f  empower_dimensio
-0001be10: 6e5f 656c 656d 656e 745f 6c69 7374 2864  n_element_list(d
-0001be20: 696d 656e 7369 6f6e 203d 2073 656c 662e  imension = self.
-0001be30: 6469 6d65 6e73 696f 6e2c 6465 6275 6720  dimension,debug 
-0001be40: 3d20 6465 6275 6729 3a0d 0a20 2020 2020  = debug):..     
-0001be50: 2020 2020 2020 2069 6620 656c 656d 656e         if elemen
-0001be60: 742e 6c6f 6e67 6e61 6d65 5b3a 375d 3d3d  t.longname[:7]==
-0001be70: 277e 5445 234d 507e 273a 0d0a 2020 2020  '~TE#MP~':..    
-0001be80: 2020 2020 2020 2020 2020 2020 6b65 7973              keys
-0001be90: 203d 2065 6c65 6d65 6e74 2e6c 6f6e 676e   = element.longn
-0001bea0: 616d 655b 373a 5d2e 7370 6c69 7428 277e  ame[7:].split('~
-0001beb0: 237e 2729 0d0a 2020 2020 2020 2020 2020  #~')..          
-0001bec0: 2020 2020 2020 236b 6579 7320 3d20 656c        #keys = el
-0001bed0: 656d 656e 742e 6c6f 6e67 6e61 6d65 5b37  ement.longname[7
-0001bee0: 3a5d 2e73 706c 6974 2827 4027 290d 0a20  :].split('@').. 
-0001bef0: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0001bf00: 6579 735f 7368 6f72 746e 616d 655f 6c6b  eys_shortname_lk
-0001bf10: 705b 7475 706c 6528 6b65 7973 295d 203d  p[tuple(keys)] =
-0001bf20: 2065 6c65 6d65 6e74 0d0a 2020 2020 2020   element..      
-0001bf30: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0001bf40: 6e63 6528 656c 656d 656e 742c 5469 6d65  nce(element,Time
-0001bf50: 456c 656d 656e 7429 3a0d 0a20 2020 2020  Element):..     
-0001bf60: 2020 2020 2020 2020 2020 206b 6579 735f             keys_
-0001bf70: 7368 6f72 746e 616d 655f 6c6b 705b 2865  shortname_lkp[(e
-0001bf80: 6c65 6d65 6e74 2e73 686f 7274 6e61 6d65  lement.shortname
-0001bf90: 2c29 5d20 3d20 656c 656d 656e 740d 0a0d  ,)] = element...
-0001bfa0: 0a20 2020 2020 2020 2023 5265 6164 2054  .        #Read T
-0001bfb0: 696d 6520 616e 6420 5374 616e 6461 7264  ime and Standard
-0001bfc0: 2065 6c65 6d65 6e74 7320 6261 636b 2069   elements back i
-0001bfd0: 6e74 6f20 4469 6d65 6e73 696f 6e20 2d20  nto Dimension - 
-0001bfe0: 656e 7375 7269 6e67 2077 6520 6c65 6176  ensuring we leav
-0001bff0: 6520 456c 656d 656e 7420 6f62 6a65 6374  e Element object
-0001c000: 7320 696e 2044 696d 656e 7369 6f6e 2061  s in Dimension a
-0001c010: 7320 7468 6520 7361 6d65 206f 6e65 730d  s the same ones.
-0001c020: 0a20 2020 2020 2020 2066 6f72 2065 6c65  .        for ele
-0001c030: 6d65 6e74 2069 6e20 6e65 775f 6f75 7470  ment in new_outp
-0001c040: 7574 5f65 6c65 6d65 6e74 733a 0d0a 2020  ut_elements:..  
-0001c050: 2020 2020 2020 2020 2020 2367 6574 2074            #get t
-0001c060: 6865 206b 6579 2066 6965 6c64 7320 616e  he key fields an
-0001c070: 6420 6c6f 6f6b 2075 7020 7468 6520 656d  d look up the em
-0001c080: 706f 7765 7220 656c 656d 656e 7420 7468  power element th
-0001c090: 6174 2068 6164 2061 2064 6573 6372 6970  at had a descrip
-0001c0a0: 7469 6f6e 206c 696e 6b65 6420 746f 2074  tion linked to t
-0001c0b0: 6865 7365 206b 6579 2066 6965 6c64 730d  hese key fields.
-0001c0c0: 0a20 2020 2020 0d0a 2020 2020 2020 2020  .     ..        
-0001c0d0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-0001c0e0: 2020 2020 2020 2020 2020 656d 705f 656c            emp_el
-0001c0f0: 656d 656e 7420 3d20 6b65 7973 5f73 686f  ement = keys_sho
-0001c100: 7274 6e61 6d65 5f6c 6b70 5b74 7570 6c65  rtname_lkp[tuple
-0001c110: 2865 6c65 6d65 6e74 2e66 6965 6c64 735b  (element.fields[
-0001c120: 6b65 795d 2066 6f72 206b 6579 2069 6e20  key] for key in 
-0001c130: 7072 696d 6172 795f 6b65 795f 6669 656c  primary_key_fiel
-0001c140: 6473 295d 0d0a 2020 2020 2020 2020 2020  ds)]..          
-0001c150: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-0001c160: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-0001c170: 2020 2020 656d 705f 656c 656d 656e 7420      emp_element 
-0001c180: 3d20 7365 6c66 5b65 6c65 6d65 6e74 2e73  = self[element.s
-0001c190: 686f 7274 6e61 6d65 5d0d 0a20 2020 2020  hortname]..     
-0001c1a0: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-0001c1b0: 2020 2020 200d 0a20 2020 2020 2020 2020       ..         
-0001c1c0: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
-0001c1d0: 2023 4e65 7720 656c 656d 656e 7473 206d   #New elements m
-0001c1e0: 6179 2061 6c72 6561 6479 2068 6176 6520  ay already have 
-0001c1f0: 7368 6f72 746e 616d 6573 202d 206f 6e6c  shortnames - onl
-0001c200: 7920 7468 6f73 6520 7368 6f72 746e 616d  y those shortnam
-0001c210: 6573 2061 7265 206e 6f74 2063 616e 6f6e  es are not canon
-0001c220: 6963 616c 2045 6d70 6f77 6572 2073 686f  ical Empower sho
-0001c230: 7274 6e61 6d65 730d 0a20 2020 2020 2020  rtnames..       
-0001c240: 2020 2020 2023 7765 2077 696c 6c20 6e65       #we will ne
-0001c250: 6564 2074 6f20 7265 6d6f 7665 2074 686f  ed to remove tho
-0001c260: 7365 2065 6c65 6d65 6e74 7320 6672 6f6d  se elements from
-0001c270: 2074 6865 2073 7461 6e64 6172 6420 6469   the standard di
-0001c280: 6d65 6e73 696f 6e20 5f45 6c65 6d65 6e74  mension _Element
-0001c290: 7347 6574 7465 7220 6469 6374 696f 6e61  sGetter dictiona
-0001c2a0: 7279 2061 7320 7468 6174 2074 6865 7920  ry as that they 
-0001c2b0: 6e6f 206c 6f6e 6765 7220 6170 7065 6172  no longer appear
-0001c2c0: 2075 6e64 6572 2074 6865 206f 6c64 2073   under the old s
-0001c2d0: 686f 7274 6e61 6d65 0d0a 2020 2020 2020  hortname..      
-0001c2e0: 2020 2020 2020 6966 2065 6c65 6d65 6e74        if element
-0001c2f0: 2e73 686f 7274 6e61 6d65 2021 3d20 656d  .shortname != em
-0001c300: 705f 656c 656d 656e 742e 7368 6f72 746e  p_element.shortn
-0001c310: 616d 653a 0d0a 2020 2020 2020 2020 2020  ame:..          
-0001c320: 2020 2020 2020 6f6c 645f 7368 6f72 746e        old_shortn
-0001c330: 616d 6520 3d20 656c 656d 656e 742e 7368  ame = element.sh
-0001c340: 6f72 746e 616d 650d 0a20 2020 2020 2020  ortname..       
-0001c350: 2020 2020 2020 2020 2023 4e6f 7465 202d           #Note -
-0001c360: 2069 6620 6f6c 645f 7368 6f72 746e 616d   if old_shortnam
-0001c370: 6520 6973 204e 6f6e 652c 2074 6865 6e20  e is None, then 
-0001c380: 7468 6520 656c 656d 656e 7420 7769 6c6c  the element will
-0001c390: 2062 6520 696e 2073 656c 662e 5f65 6c65   be in self._ele
-0001c3a0: 6d65 6e74 735f 7769 7468 6f75 745f 7368  ments_without_sh
-0001c3b0: 6f72 746e 616d 6573 2077 6869 6368 2077  ortnames which w
-0001c3c0: 696c 6c20 6265 2072 6573 6574 2061 2066  ill be reset a f
-0001c3d0: 6577 206c 696e 6573 2062 656c 6f77 2074  ew lines below t
-0001c3e0: 6869 7320 6f6e 650d 0a20 2020 2020 2020  his one..       
-0001c3f0: 2020 2020 2020 2020 2069 6620 6f6c 645f           if old_
-0001c400: 7368 6f72 746e 616d 6520 6973 206e 6f74  shortname is not
-0001c410: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0001c420: 2020 2020 2020 2020 2020 2020 6465 6c20              del 
-0001c430: 7365 6c66 5b6f 6c64 5f73 686f 7274 6e61  self[old_shortna
-0001c440: 6d65 5d0d 0a0d 0a20 2020 2020 2020 2020  me]....         
-0001c450: 2020 2023 234a 4154 2032 3031 392d 3130     ##JAT 2019-10
-0001c460: 2d31 3020 7765 2063 616e 6e6f 7420 6173  -10 we cannot as
-0001c470: 7365 7274 2065 6d70 5f65 6c65 6d65 6e74  sert emp_element
-0001c480: 2e70 6879 7369 6420 6973 206e 6f74 204e  .physid is not N
-0001c490: 6f6e 652c 2062 6563 6175 7365 2077 6520  one, because we 
-0001c4a0: 6d61 7920 6265 206d 6572 6769 6e67 2074  may be merging t
-0001c4b0: 6f20 6120 7072 6576 696f 7573 6c79 2075  o a previously u
-0001c4c0: 6e73 796e 6368 726f 6e69 7365 6420 656c  nsynchronised el
-0001c4d0: 656d 656e 740d 0a20 2020 2020 2020 2020  ement..         
-0001c4e0: 2020 2023 6173 7365 7274 2020 656d 705f     #assert  emp_
-0001c4f0: 656c 656d 656e 742e 7068 7973 6964 2069  element.physid i
-0001c500: 7320 6e6f 7420 4e6f 6e65 0d0a 0d0a 2020  s not None....  
-0001c510: 2020 2020 2020 2020 2020 2343 6f70 7920            #Copy 
-0001c520: 696e 2074 6865 2064 6174 6120 6672 6f6d  in the data from
-0001c530: 2065 6d70 6f77 6572 202d 206d 6173 7465   empower - maste
-0001c540: 7269 6e67 2069 740d 0a20 2020 2020 2020  ring it..       
-0001c550: 2020 2020 2065 6c65 6d65 6e74 2e73 686f       element.sho
-0001c560: 7274 6e61 6d65 203d 2065 6d70 5f65 6c65  rtname = emp_ele
-0001c570: 6d65 6e74 2e73 686f 7274 6e61 6d65 0d0a  ment.shortname..
-0001c580: 2020 2020 2020 2020 2020 2020 656c 656d              elem
-0001c590: 656e 742e 7068 7973 6964 2020 2020 3d20  ent.physid    = 
-0001c5a0: 656d 705f 656c 656d 656e 742e 7068 7973  emp_element.phys
-0001c5b0: 6964 0d0a 2020 2020 2020 2020 2020 2020  id..            
-0001c5c0: 2354 7261 6e73 6665 7220 7768 6174 2077  #Transfer what w
-0001c5d0: 6173 2061 6e20 656c 656d 656e 7420 7769  as an element wi
-0001c5e0: 7468 6f75 7420 6120 7368 6f72 746e 616d  thout a shortnam
-0001c5f0: 6520 696e 746f 2074 6865 2073 7461 6e64  e into the stand
-0001c600: 6172 6420 656c 656d 656e 7420 6469 6374  ard element dict
-0001c610: 696f 6e61 7279 0d0a 2020 2020 2020 2020  ionary..        
-0001c620: 2020 2020 7365 6c66 5b65 6c65 6d65 6e74      self[element
-0001c630: 2e73 686f 7274 6e61 6d65 5d20 3d20 656c  .shortname] = el
-0001c640: 656d 656e 740d 0a0d 0a0d 0a20 2020 2020  ement......     
-0001c650: 2020 2023 5765 2068 6176 6520 6e6f 7720     #We have now 
-0001c660: 7075 7420 616c 6c20 656c 656d 656e 7473  put all elements
-0001c670: 2077 6974 686f 7574 2073 686f 7274 6e61   without shortna
-0001c680: 6d65 7320 696e 746f 2074 6865 2073 7461  mes into the sta
-0001c690: 6e64 6172 6420 5f65 6c65 6d65 6e74 7320  ndard _elements 
-0001c6a0: 6469 6374 696f 6e61 7279 0d0a 2020 2020  dictionary..    
-0001c6b0: 2020 2020 7365 6c66 2e5f 656c 656d 656e      self._elemen
-0001c6c0: 7473 5f77 6974 686f 7574 5f73 686f 7274  ts_without_short
-0001c6d0: 6e61 6d65 7320 3d20 5b5d 0d0a 0d0a 2020  names = []....  
-0001c6e0: 2020 2020 2020 2366 6f72 2065 6c65 6d65        #for eleme
-0001c6f0: 6e74 2069 6e20 7365 6c66 2e76 616c 7565  nt in self.value
-0001c700: 7328 293a 0d0a 2020 2020 2020 2020 2320  s():..        # 
-0001c710: 2020 2066 6f72 206b 2c20 7620 696e 2065     for k, v in e
-0001c720: 6c65 6d65 6e74 2e66 6965 6c64 732e 6974  lement.fields.it
-0001c730: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
-0001c740: 2320 2020 2020 2020 2070 7269 6e74 2865  #        print(e
-0001c750: 6c65 6d65 6e74 2e73 686f 7274 6e61 6d65  lement.shortname
-0001c760: 2c20 6b2c 2076 290d 0a0d 0a20 2020 2020  , k, v)....     
-0001c770: 2020 2064 6566 205f 7969 656c 645f 656d     def _yield_em
-0001c780: 7074 795f 6361 6c63 756c 6174 696f 6e73  pty_calculations
-0001c790: 5f73 7472 696e 6773 285f 656c 656d 656e  _strings(_elemen
-0001c7a0: 7473 5f69 7465 7261 746f 7229 3a0d 0a20  ts_iterator):.. 
-0001c7b0: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
-0001c7c0: 6c65 6d65 6e74 2069 6e20 5f65 6c65 6d65  lement in _eleme
-0001c7d0: 6e74 735f 6974 6572 6174 6f72 3a0d 0a20  nts_iterator:.. 
-0001c7e0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001c7f0: 6f72 2066 6965 6c64 5f73 686f 7274 6e61  or field_shortna
-0001c800: 6d65 2c20 6669 656c 645f 7661 6c75 6520  me, field_value 
-0001c810: 696e 2065 6c65 6d65 6e74 2e66 6965 6c64  in element.field
-0001c820: 732e 6564 6974 6564 5f69 7465 6d73 3a0d  s.edited_items:.
-0001c830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c840: 2020 2020 2069 6620 6669 656c 645f 7368       if field_sh
-0001c850: 6f72 746e 616d 6520 3d3d 2027 4361 6c63  ortname == 'Calc
-0001c860: 756c 6174 696f 6e27 2061 6e64 206e 6f74  ulation' and not
-0001c870: 2066 6965 6c64 5f76 616c 7565 2069 7320   field_value is 
-0001c880: 4e6f 6e65 2061 6e64 206e 6f74 2066 6965  None and not fie
-0001c890: 6c64 5f76 616c 7565 203d 3d20 2727 3a0d  ld_value == '':.
-0001c8a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c8b0: 2020 2020 2020 2020 2079 6965 6c64 2065           yield e
-0001c8c0: 6c65 6d65 6e74 2e73 686f 7274 6e61 6d65  lement.shortname
-0001c8d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001c8e0: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
-0001c8f0: 275c 7443 616c 6375 6c61 7469 6f6e 5c74  '\tCalculation\t
-0001c900: 404d 7973 656c 665c 6e27 0d0a 0d0a 2020  @Myself\n'....  
-0001c910: 2020 2020 2020 2357 6520 7769 6c6c 2063        #We will c
-0001c920: 616c 6c20 7468 6973 2066 756e 6374 696f  all this functio
-0001c930: 6e20 7477 6963 6520 746f 2064 6574 6572  n twice to deter
-0001c940: 6d69 6e65 2069 6620 7765 206e 6565 6420  mine if we need 
-0001c950: 746f 2063 616c 6c20 496d 706f 7274 6572  to call Importer
-0001c960: 2028 7768 6963 6820 6973 2073 6c6f 7729   (which is slow)
-0001c970: 0d0a 2020 2020 2020 2020 6465 6620 5f79  ..        def _y
-0001c980: 6965 6c64 5f66 6965 6c64 735f 7374 7269  ield_fields_stri
-0001c990: 6e67 7328 5f65 6c65 6d65 6e74 735f 6974  ngs(_elements_it
-0001c9a0: 6572 6174 6f72 2c66 6965 6c64 5f63 6861  erator,field_cha
-0001c9b0: 6e67 655f 636f 756e 745f 6c69 7374 3d5b  nge_count_list=[
-0001c9c0: 305d 293a 0d0a 2020 2020 2020 2020 2020  0]):..          
-0001c9d0: 2020 746f 7461 6c5f 6669 656c 645f 6368    total_field_ch
-0001c9e0: 616e 6765 7320 3d20 300d 0a20 2020 2020  anges = 0..     
-0001c9f0: 2020 2020 2020 2066 6f72 2065 6c65 6d65         for eleme
-0001ca00: 6e74 2069 6e20 5f65 6c65 6d65 6e74 735f  nt in _elements_
-0001ca10: 6974 6572 6174 6f72 3a0d 0a20 2020 2020  iterator:..     
-0001ca20: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-0001ca30: 6965 6c64 5f73 686f 7274 6e61 6d65 2c20  ield_shortname, 
-0001ca40: 6669 656c 645f 7661 6c75 6520 696e 2065  field_value in e
-0001ca50: 6c65 6d65 6e74 2e66 6965 6c64 732e 6564  lement.fields.ed
-0001ca60: 6974 6564 5f69 7465 6d73 3a0d 0a0d 0a20  ited_items:.... 
-0001ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca80: 2020 2023 7072 696e 7428 656c 656d 656e     #print(elemen
-0001ca90: 742e 7368 6f72 746e 616d 652c 2066 6965  t.shortname, fie
-0001caa0: 6c64 5f73 686f 7274 6e61 6d65 2c20 6669  ld_shortname, fi
-0001cab0: 656c 645f 7661 6c75 6529 0d0a 2020 2020  eld_value)..    
-0001cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cad0: 6966 2066 6965 6c64 5f73 686f 7274 6e61  if field_shortna
-0001cae0: 6d65 206e 6f74 2069 6e20 5b27 5368 6f72  me not in ['Shor
-0001caf0: 7420 4e61 6d65 270d 0a20 2020 2020 2020  t Name'..       
-0001cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb20: 2020 2020 2020 202c 274d 6561 7375 7265         ,'Measure
-0001cb30: 2045 6c65 6d65 6e74 270d 0a20 2020 2020   Element'..     
+0001af50: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+0001af60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001af70: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001af80: 7475 625f 7368 6f72 746e 616d 6520 2b3d  tub_shortname +=
+0001af90: 2063 6861 720d 0a20 2020 2020 2020 2020   char..         
+0001afa0: 2020 2020 2020 2020 2020 2023 2054 4f44             # TOD
+0001afb0: 4f3a 2052 6561 6c6c 7920 6e65 6564 2074  O: Really need t
+0001afc0: 6f20 6c6f 6f6b 2061 7420 7468 6973 2068  o look at this h
+0001afd0: 6163 6b79 2062 6568 6176 696f 7572 2e2e  acky behaviour..
+0001afe0: 2e2e 0d0a 0d0a 2020 2020 2020 2020 2020  ......          
+0001aff0: 2020 2020 2020 2020 2020 2373 7475 6220            #stub 
+0001b000: 7368 6f72 746e 616d 6573 2061 7265 2064  shortnames are d
+0001b010: 656c 6962 6572 6174 656c 7920 746f 6f20  eliberately too 
+0001b020: 6c6f 6e67 2061 6e64 2064 6966 6665 7265  long and differe
+0001b030: 6e74 2066 726f 6d20 6561 6368 206f 7468  nt from each oth
+0001b040: 6572 2c20 746f 2066 6f72 6365 2045 6d70  er, to force Emp
+0001b050: 6f77 6572 2074 6f20 6765 6e65 7261 7465  ower to generate
+0001b060: 206e 6577 206f 6e65 730d 0a20 2020 2020   new ones..     
+0001b070: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001b080: 5f65 6c65 6d65 6e74 5f73 7472 696e 6720  _element_string 
+0001b090: 2b3d 2073 7475 625f 7368 6f72 746e 616d  += stub_shortnam
+0001b0a0: 655b 3a31 305d 2b28 272b 272a 3531 3229  e[:10]+('+'*512)
+0001b0b0: 2b73 7472 286e 290d 0a20 2020 2020 2020  +str(n)..       
+0001b0c0: 2020 2020 2020 2020 2020 2020 205f 656c               _el
+0001b0d0: 656d 656e 745f 7374 7269 6e67 202b 3d20  ement_string += 
+0001b0e0: 7374 7562 5f73 686f 7274 6e61 6d65 5b3a  stub_shortname[:
+0001b0f0: 6c6c 752e 7368 6f72 746e 616d 655f 7369  llu.shortname_si
+0001b100: 7a65 5d2b 272b 272b 7374 7228 6e29 0d0a  ze]+'+'+str(n)..
+0001b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b120: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+0001b130: 2020 2020 2020 5f65 6c65 6d65 6e74 5f73        _element_s
+0001b140: 7472 696e 6720 2b3d 2027 5c74 270d 0a20  tring += '\t'.. 
+0001b150: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b160: 6620 6f75 7470 7574 5f65 6c65 6d65 6e74  f output_element
+0001b170: 2e64 6573 6372 6970 7469 6f6e 2069 7320  .description is 
+0001b180: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0001b190: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0001b1a0: 656c 656d 656e 745f 7374 7269 6e67 202b  element_string +
+0001b1b0: 3d20 6f75 7470 7574 5f65 6c65 6d65 6e74  = output_element
+0001b1c0: 2e64 6573 6372 6970 7469 6f6e 0d0a 2020  .description..  
+0001b1d0: 2020 2020 2020 2020 2020 2020 2020 5f65                _e
+0001b1e0: 6c65 6d65 6e74 5f73 7472 696e 6720 2b3d  lement_string +=
+0001b1f0: 2027 5c6e 270d 0a0d 0a20 2020 2020 2020   '\n'....       
+0001b200: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001b210: 5f65 6c65 6d65 6e74 5f73 7472 696e 670d  _element_string.
+0001b220: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
+0001b230: 4372 6561 7465 2074 6865 2063 6f6d 6d61  Create the comma
+0001b240: 6e64 7320 746f 2049 6d70 6f72 7420 7468  nds to Import th
+0001b250: 6520 656c 656d 656e 7473 2069 6e20 7468  e elements in th
+0001b260: 6520 776f 726b 696e 6720 6669 6c65 2069  e working file i
+0001b270: 6e74 6f20 456d 706f 7765 720d 0a20 2020  nto Empower..   
+0001b280: 2020 2020 2020 2020 2023 5468 6573 6520           #These 
+0001b290: 7769 6c6c 2062 6520 7275 6e20 6279 2049  will be run by I
+0001b2a0: 6d70 6f72 7465 7220 696e 2061 206d 6f6d  mporter in a mom
+0001b2b0: 656e 7420 7768 656e 2077 6520 6172 6520  ent when we are 
+0001b2c0: 7265 6164 7920 746f 2064 6f20 6f75 7220  ready to do our 
+0001b2d0: 6d65 7272 7920 6d75 6c74 692d 7072 6f63  merry multi-proc
+0001b2e0: 6573 7369 6e67 2064 616e 6365 2077 6974  essing dance wit
+0001b2f0: 6820 6e61 6d65 6420 7069 7065 730d 0a20  h named pipes.. 
+0001b300: 2020 2020 2020 2020 2020 2023 4669 6e69             #Fini
+0001b310: 7368 206f 6666 2074 6865 2063 6f6d 6d61  sh off the comma
+0001b320: 6e64 206c 6973 7420 6e6f 7720 7765 2776  nd list now we'v
+0001b330: 6520 7365 7420 6170 7072 6f70 7269 6174  e set appropriat
+0001b340: 6520 7573 6572 6e61 6d65 2f70 6173 7377  e username/passw
+0001b350: 6f72 640d 0a20 2020 2020 2020 2020 2020  ord..           
+0001b360: 2063 6f6d 6d61 6e64 5f6c 6973 7420 3d20   command_list = 
+0001b370: 7365 6c66 2e64 696d 656e 7369 6f6e 2e73  self.dimension.s
+0001b380: 6974 652e 5f6c 6f67 6f6e 5f70 6172 616d  ite._logon_param
+0001b390: 6574 6572 5f69 6d70 6f72 7465 725f 636f  eter_importer_co
+0001b3a0: 6d6d 616e 6473 202b 205c 0d0a 2020 2020  mmands + \..    
+0001b3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b3c0: 2020 2020 2020 205b 2773 6574 2d70 6172         ['set-par
+0001b3d0: 616d 6574 6572 2064 696d 656e 7369 6f6e  ameter dimension
+0001b3e0: 5f69 6e64 6578 3d27 2020 2020 2b20 7374  _index='    + st
+0001b3f0: 7228 7365 6c66 2e64 696d 656e 7369 6f6e  r(self.dimension
+0001b400: 2e69 6e64 6578 290d 0a20 2020 2020 2020  .index)..       
+0001b410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b420: 2020 2020 2c27 6c6f 6164 2d66 696c 652d      ,'load-file-
+0001b430: 7473 7620 2227 2020 2020 2020 2020 2020  tsv "'          
+0001b440: 2020 2020 2020 2020 202b 2069 6d70 6f72           + impor
+0001b450: 7465 645f 6469 6d65 6e73 696f 6e5f 6669  ted_dimension_fi
+0001b460: 6c65 7061 7468 202b 2027 2227 0d0a 2020  lepath + '"'..  
+0001b470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b480: 2020 2020 2020 2020 202c 2765 6d70 6f77           ,'empow
+0001b490: 6572 2d69 6d70 6f72 742d 656c 656d 656e  er-import-elemen
+0001b4a0: 7473 2022 247b 7369 7465 7d22 2022 247b  ts "${site}" "${
+0001b4b0: 7573 6572 7d22 2022 247b 7061 7373 776f  user}" "${passwo
+0001b4c0: 7264 7d22 2024 7b64 696d 656e 7369 6f6e  rd}" ${dimension
+0001b4d0: 5f69 6e64 6578 7d27 0d0a 2020 2020 2020  _index}'..      
+0001b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b4f0: 2020 2020 205d 0d0a 0d0a 2020 2020 2020       ]....      
+0001b500: 2020 2020 2020 2349 6e20 6465 6275 6720        #In debug 
+0001b510: 6d6f 6465 2077 7269 7465 2074 6865 2064  mode write the d
+0001b520: 6174 6120 696e 746f 2061 2074 7376 2066  ata into a tsv f
+0001b530: 696c 6520 616e 6420 7265 6164 2069 7420  ile and read it 
+0001b540: 7769 7468 2049 6d70 6f72 7465 722c 2070  with Importer, p
+0001b550: 7574 7469 6e67 2074 6865 2065 6c65 6d65  utting the eleme
+0001b560: 6e74 7320 696e 746f 2045 6d70 6f77 6572  nts into Empower
+0001b570: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0001b580: 2064 6562 7567 3a0d 0a20 2020 2020 2020   debug:..       
+0001b590: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+0001b5a0: 656e 2869 6d70 6f72 7465 645f 6469 6d65  en(imported_dime
+0001b5b0: 6e73 696f 6e5f 6669 6c65 7061 7468 2c27  nsion_filepath,'
+0001b5c0: 7727 2c65 6e63 6f64 696e 673d 2775 7466  w',encoding='utf
+0001b5d0: 3827 2920 6173 2069 6d70 6f72 7465 645f  8') as imported_
+0001b5e0: 6469 6d65 6e73 696f 6e5f 6669 6c65 3a0d  dimension_file:.
+0001b5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b600: 2020 2020 2066 6f72 206e 2c20 6f75 7470       for n, outp
+0001b610: 7574 5f65 6c65 6d65 6e74 2069 6e20 656e  ut_element in en
+0001b620: 756d 6572 6174 6528 6e65 775f 7374 616e  umerate(new_stan
+0001b630: 6461 7264 5f65 6c65 6d65 6e74 7329 3a0d  dard_elements):.
+0001b640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b650: 2020 2020 2020 2020 2069 6d70 6f72 7465           importe
+0001b660: 645f 6469 6d65 6e73 696f 6e5f 6669 6c65  d_dimension_file
+0001b670: 2e77 7269 7465 285f 656c 656d 656e 745f  .write(_element_
+0001b680: 7374 7269 6e67 5f66 6f72 5f69 6d70 6f72  string_for_impor
+0001b690: 745f 6669 6c65 286f 7574 7075 745f 656c  t_file(output_el
+0001b6a0: 656d 656e 742c 7072 696d 6172 795f 6b65  ement,primary_ke
+0001b6b0: 795f 6669 656c 6473 2c6e 2929 0d0a 2020  y_fields,n))..  
+0001b6c0: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
+0001b6d0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001b6e0: 6c75 2e72 756e 5f73 696e 676c 655f 6f75  lu.run_single_ou
+0001b6f0: 7470 7574 5f69 6d70 6f72 7465 725f 636f  tput_importer_co
+0001b700: 6d6d 616e 6473 2863 6f6d 6d61 6e64 5f6c  mmands(command_l
+0001b710: 6973 742c 2065 6d70 6f77 6572 5f69 6d70  ist, empower_imp
+0001b720: 6f72 7465 725f 6578 6563 7574 6162 6c65  orter_executable
+0001b730: 3d73 656c 662e 6469 6d65 6e73 696f 6e2e  =self.dimension.
+0001b740: 7369 7465 2e65 6d70 6f77 6572 5f69 6d70  site.empower_imp
+0001b750: 6f72 7465 725f 6578 6563 7574 6162 6c65  orter_executable
+0001b760: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+0001b770: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0001b780: 2020 2020 2020 2020 2349 6e20 276e 6f72          #In 'nor
+0001b790: 6d61 6c27 206d 6f64 6520 646f 2061 206d  mal' mode do a m
+0001b7a0: 6572 7279 2064 616e 6365 2077 6974 6820  erry dance with 
+0001b7b0: 5769 6e64 6f77 7320 6e61 6d65 6420 7069  Windows named pi
+0001b7c0: 7065 732e 2054 6869 7320 6176 6f69 6473  pes. This avoids
+0001b7d0: 2077 7269 7469 6e67 2074 6865 2064 6174   writing the dat
+0001b7e0: 6120 746f 2066 696c 6520 666f 7220 7365  a to file for se
+0001b7f0: 6375 7269 7479 2061 6e64 2070 7261 6374  curity and pract
+0001b800: 6963 616c 6974 7920 7265 6173 6f6e 730d  icality reasons.
+0001b810: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b820: 2023 696d 706f 7274 6564 5f64 696d 656e   #imported_dimen
+0001b830: 7369 6f6e 5f66 696c 6570 6174 6820 6973  sion_filepath is
+0001b840: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
+0001b850: 206e 616d 6564 2070 6970 6520 652e 672e   named pipe e.g.
+0001b860: 205c 5c2e 5c70 6970 655c 3964 6363 6661   \\.\pipe\9dccfa
+0001b870: 3038 2d34 3063 312d 3435 6635 2d38 6530  08-40c1-45f5-8e0
+0001b880: 652d 6636 3463 3138 3530 3262 6364 0d0a  e-f64c18502bcd..
+0001b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8a0: 2354 6865 206d 6572 7279 2064 616e 6365  #The merry dance
+0001b8b0: 206d 6561 6e73 2073 7461 7274 696e 6720   means starting 
+0001b8c0: 656d 706f 7765 722c 2072 6566 6572 656e  empower, referen
+0001b8d0: 6369 6e67 2074 6865 2070 6970 652c 206f  cing the pipe, o
+0001b8e0: 7065 6e69 6e67 2074 6865 2070 6970 6520  pening the pipe 
+0001b8f0: 6265 666f 7265 2065 6d70 6f77 6572 2069  before empower i
+0001b900: 7320 7072 6f70 6572 6c79 2073 7461 7274  s properly start
+0001b910: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
+0001b920: 2020 2020 2373 6574 7469 6e67 2075 7020      #setting up 
+0001b930: 7468 6520 6e61 6d65 6420 7069 7065 206f  the named pipe o
+0001b940: 6e20 7468 6973 2074 6872 6561 642c 2061  n this thread, a
+0001b950: 6e64 2077 7269 7469 6e67 2074 6f20 6974  nd writing to it
+0001b960: 2028 6173 2073 6f6f 6e20 6173 2049 6d70   (as soon as Imp
+0001b970: 6f72 7465 7220 636f 6e6e 6563 7473 2061  orter connects a
+0001b980: 7420 6974 7320 656e 6429 0d0a 2020 2020  t its end)..    
+0001b990: 2020 2020 2020 2020 2020 2020 2354 6865              #The
+0001b9a0: 2064 6966 6669 6375 6c74 792c 2069 7320   difficulty, is 
+0001b9b0: 7468 6174 2077 6520 6861 7665 2074 6f20  that we have to 
+0001b9c0: 7061 7373 2074 6865 206e 616d 6520 6f66  pass the name of
+0001b9d0: 2074 6865 2070 6970 6520 746f 2049 6d70   the pipe to Imp
+0001b9e0: 6f72 7465 722c 2061 6e64 2072 656c 7920  orter, and rely 
+0001b9f0: 6f6e 2074 6865 2066 6163 7420 7468 6174  on the fact that
+0001ba00: 2069 7420 776f 6e27 7420 6861 7665 2074   it won't have t
+0001ba10: 696d 6520 746f 206f 7065 6e20 6974 0d0a  ime to open it..
+0001ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ba30: 2362 6566 6f72 6520 7765 2068 6176 6520  #before we have 
+0001ba40: 6372 6561 7465 6420 6974 2e20 4275 7420  created it. But 
+0001ba50: 7765 2077 696c 6c20 626c 6f63 6b20 6f6e  we will block on
+0001ba60: 206f 7572 2073 6964 6520 756e 7469 6c20   our side until 
+0001ba70: 496d 706f 7274 6572 2068 6173 2063 6f6e  Importer has con
+0001ba80: 6e65 6374 6564 0d0a 2020 2020 2020 2020  nected..        
+0001ba90: 2020 2020 2020 2020 7072 6f63 203d 204e          proc = N
+0001baa0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+0001bab0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+0001bac0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001bad0: 726f 6320 3d20 6c6c 752e 7374 6172 745f  roc = llu.start_
+0001bae0: 6e6f 5f6f 7574 7075 745f 696d 706f 7274  no_output_import
+0001baf0: 6572 5f63 6f6d 6d61 6e64 7328 636f 6d6d  er_commands(comm
+0001bb00: 616e 645f 6c69 7374 2c65 6d70 6f77 6572  and_list,empower
+0001bb10: 5f69 6d70 6f72 7465 725f 6578 6563 7574  _importer_execut
+0001bb20: 6162 6c65 3d73 656c 662e 6469 6d65 6e73  able=self.dimens
+0001bb30: 696f 6e2e 7369 7465 2e65 6d70 6f77 6572  ion.site.empower
+0001bb40: 5f69 6d70 6f72 7465 725f 6578 6563 7574  _importer_execut
+0001bb50: 6162 6c65 290d 0a20 2020 2020 2020 2020  able)..         
+0001bb60: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0001bb70: 6c6c 752e 6f75 7462 6f75 6e64 5f70 6970  llu.outbound_pip
+0001bb80: 6528 696d 706f 7274 6564 5f64 696d 656e  e(imported_dimen
+0001bb90: 7369 6f6e 5f66 696c 6570 6174 6829 2061  sion_filepath) a
+0001bba0: 7320 7069 7065 3a0d 0a0d 0a20 2020 2020  s pipe:....     
+0001bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bbc0: 2020 2066 6f72 206e 2c20 6f75 7470 7574     for n, output
+0001bbd0: 5f65 6c65 6d65 6e74 2069 6e20 656e 756d  _element in enum
+0001bbe0: 6572 6174 6528 6e65 775f 7374 616e 6461  erate(new_standa
+0001bbf0: 7264 5f65 6c65 6d65 6e74 7329 3a0d 0a20  rd_elements):.. 
+0001bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc10: 2020 2020 2020 2020 2020 2077 696e 3332             win32
+0001bc20: 6669 6c65 2e57 7269 7465 4669 6c65 2870  file.WriteFile(p
+0001bc30: 6970 652c 2073 7472 2e65 6e63 6f64 6528  ipe, str.encode(
+0001bc40: 5f65 6c65 6d65 6e74 5f73 7472 696e 675f  _element_string_
+0001bc50: 666f 725f 696d 706f 7274 5f66 696c 6528  for_import_file(
+0001bc60: 6f75 7470 7574 5f65 6c65 6d65 6e74 2c70  output_element,p
+0001bc70: 7269 6d61 7279 5f6b 6579 5f66 6965 6c64  rimary_key_field
+0001bc80: 732c 6e29 2929 0d0a 0d0a 2020 2020 2020  s,n)))....      
+0001bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bca0: 2020 6c6f 672e 6465 6275 6728 2250 6970    log.debug("Pip
+0001bcb0: 6520 7b7d 2066 696e 6973 6865 6420 7772  e {} finished wr
+0001bcc0: 6974 696e 6722 2e66 6f72 6d61 7428 696d  iting".format(im
+0001bcd0: 706f 7274 6564 5f64 696d 656e 7369 6f6e  ported_dimension
+0001bce0: 5f66 696c 6570 6174 6829 290d 0a0d 0a20  _filepath)).... 
+0001bcf0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001bd00: 696e 616c 6c79 3a0d 0a20 2020 2020 2020  inally:..       
+0001bd10: 2020 2020 2020 2020 2020 2020 2023 4368               #Ch
+0001bd20: 6563 6b20 6966 2049 6d70 6f72 7465 7220  eck if Importer 
+0001bd30: 7265 7475 726e 6564 2061 6e20 6572 726f  returned an erro
+0001bd40: 7220 616e 6420 7261 6973 6520 6974 2061  r and raise it a
+0001bd50: 7320 6120 7079 7468 6f6e 2069 6620 6974  s a python if it
+0001bd60: 2064 6964 0d0a 2020 2020 2020 2020 2020   did..          
+0001bd70: 2020 2020 2020 2020 2020 6c6c 752e 636f            llu.co
+0001bd80: 6d70 6c65 7465 5f6e 6f5f 6f75 7470 7574  mplete_no_output
+0001bd90: 5f69 6d70 6f72 7465 725f 7072 6f63 6573  _importer_proces
+0001bda0: 7328 7072 6f63 290d 0a0d 0a0d 0a20 2020  s(proc)......   
+0001bdb0: 2020 2020 2023 4e65 6564 2074 6f20 6d61       #Need to ma
+0001bdc0: 7463 6820 7570 206f 6e20 6b65 7920 636f  tch up on key co
+0001bdd0: 6c75 6d6e 2066 6f72 206e 6577 2069 7465  lumn for new ite
+0001bde0: 6d73 0d0a 2020 2020 2020 2020 2346 6972  ms..        #Fir
+0001bdf0: 7374 2063 6865 636b 2074 6865 7265 2061  st check there a
+0001be00: 7265 2066 6965 6c64 730d 0a0d 0a20 2020  re fields....   
+0001be10: 2020 2020 2066 6f72 2065 6c65 6d65 6e74       for element
+0001be20: 2069 6e20 5f63 7265 6174 655f 656d 706f   in _create_empo
+0001be30: 7765 725f 6469 6d65 6e73 696f 6e5f 656c  wer_dimension_el
+0001be40: 656d 656e 745f 6c69 7374 2864 696d 656e  ement_list(dimen
+0001be50: 7369 6f6e 203d 2073 656c 662e 6469 6d65  sion = self.dime
+0001be60: 6e73 696f 6e2c 6465 6275 6720 3d20 6465  nsion,debug = de
+0001be70: 6275 6729 3a0d 0a20 2020 2020 2020 2020  bug):..         
+0001be80: 2020 2069 6620 656c 656d 656e 742e 6c6f     if element.lo
+0001be90: 6e67 6e61 6d65 5b3a 375d 3d3d 277e 5445  ngname[:7]=='~TE
+0001bea0: 234d 507e 273a 0d0a 2020 2020 2020 2020  #MP~':..        
+0001beb0: 2020 2020 2020 2020 6b65 7973 203d 2065          keys = e
+0001bec0: 6c65 6d65 6e74 2e6c 6f6e 676e 616d 655b  lement.longname[
+0001bed0: 373a 5d2e 7370 6c69 7428 277e 237e 2729  7:].split('~#~')
+0001bee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001bef0: 2020 236b 6579 7320 3d20 656c 656d 656e    #keys = elemen
+0001bf00: 742e 6c6f 6e67 6e61 6d65 5b37 3a5d 2e73  t.longname[7:].s
+0001bf10: 706c 6974 2827 4027 290d 0a20 2020 2020  plit('@')..     
+0001bf20: 2020 2020 2020 2020 2020 206b 6579 735f             keys_
+0001bf30: 7368 6f72 746e 616d 655f 6c6b 705b 7475  shortname_lkp[tu
+0001bf40: 706c 6528 6b65 7973 295d 203d 2065 6c65  ple(keys)] = ele
+0001bf50: 6d65 6e74 0d0a 2020 2020 2020 2020 2020  ment..          
+0001bf60: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+0001bf70: 656c 656d 656e 742c 5469 6d65 456c 656d  element,TimeElem
+0001bf80: 656e 7429 3a0d 0a20 2020 2020 2020 2020  ent):..         
+0001bf90: 2020 2020 2020 206b 6579 735f 7368 6f72         keys_shor
+0001bfa0: 746e 616d 655f 6c6b 705b 2865 6c65 6d65  tname_lkp[(eleme
+0001bfb0: 6e74 2e73 686f 7274 6e61 6d65 2c29 5d20  nt.shortname,)] 
+0001bfc0: 3d20 656c 656d 656e 740d 0a0d 0a20 2020  = element....   
+0001bfd0: 2020 2020 2023 5265 6164 2054 696d 6520       #Read Time 
+0001bfe0: 616e 6420 5374 616e 6461 7264 2065 6c65  and Standard ele
+0001bff0: 6d65 6e74 7320 6261 636b 2069 6e74 6f20  ments back into 
+0001c000: 4469 6d65 6e73 696f 6e20 2d20 656e 7375  Dimension - ensu
+0001c010: 7269 6e67 2077 6520 6c65 6176 6520 456c  ring we leave El
+0001c020: 656d 656e 7420 6f62 6a65 6374 7320 696e  ement objects in
+0001c030: 2044 696d 656e 7369 6f6e 2061 7320 7468   Dimension as th
+0001c040: 6520 7361 6d65 206f 6e65 730d 0a20 2020  e same ones..   
+0001c050: 2020 2020 2066 6f72 2065 6c65 6d65 6e74       for element
+0001c060: 2069 6e20 6e65 775f 6f75 7470 7574 5f65   in new_output_e
+0001c070: 6c65 6d65 6e74 733a 0d0a 2020 2020 2020  lements:..      
+0001c080: 2020 2020 2020 2367 6574 2074 6865 206b        #get the k
+0001c090: 6579 2066 6965 6c64 7320 616e 6420 6c6f  ey fields and lo
+0001c0a0: 6f6b 2075 7020 7468 6520 656d 706f 7765  ok up the empowe
+0001c0b0: 7220 656c 656d 656e 7420 7468 6174 2068  r element that h
+0001c0c0: 6164 2061 2064 6573 6372 6970 7469 6f6e  ad a description
+0001c0d0: 206c 696e 6b65 6420 746f 2074 6865 7365   linked to these
+0001c0e0: 206b 6579 2066 6965 6c64 730d 0a20 2020   key fields..   
+0001c0f0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+0001c100: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0001c110: 2020 2020 2020 656d 705f 656c 656d 656e        emp_elemen
+0001c120: 7420 3d20 6b65 7973 5f73 686f 7274 6e61  t = keys_shortna
+0001c130: 6d65 5f6c 6b70 5b74 7570 6c65 2865 6c65  me_lkp[tuple(ele
+0001c140: 6d65 6e74 2e66 6965 6c64 735b 6b65 795d  ment.fields[key]
+0001c150: 2066 6f72 206b 6579 2069 6e20 7072 696d   for key in prim
+0001c160: 6172 795f 6b65 795f 6669 656c 6473 295d  ary_key_fields)]
+0001c170: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
+0001c180: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
+0001c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1a0: 656d 705f 656c 656d 656e 7420 3d20 7365  emp_element = se
+0001c1b0: 6c66 5b65 6c65 6d65 6e74 2e73 686f 7274  lf[element.short
+0001c1c0: 6e61 6d65 5d0d 0a20 2020 2020 2020 2020  name]..         
+0001c1d0: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+0001c1e0: 200d 0a20 2020 2020 2020 2020 2020 200d   ..            .
+0001c1f0: 0a20 2020 2020 2020 2020 2020 2023 4e65  .            #Ne
+0001c200: 7720 656c 656d 656e 7473 206d 6179 2061  w elements may a
+0001c210: 6c72 6561 6479 2068 6176 6520 7368 6f72  lready have shor
+0001c220: 746e 616d 6573 202d 206f 6e6c 7920 7468  tnames - only th
+0001c230: 6f73 6520 7368 6f72 746e 616d 6573 2061  ose shortnames a
+0001c240: 7265 206e 6f74 2063 616e 6f6e 6963 616c  re not canonical
+0001c250: 2045 6d70 6f77 6572 2073 686f 7274 6e61   Empower shortna
+0001c260: 6d65 730d 0a20 2020 2020 2020 2020 2020  mes..           
+0001c270: 2023 7765 2077 696c 6c20 6e65 6564 2074   #we will need t
+0001c280: 6f20 7265 6d6f 7665 2074 686f 7365 2065  o remove those e
+0001c290: 6c65 6d65 6e74 7320 6672 6f6d 2074 6865  lements from the
+0001c2a0: 2073 7461 6e64 6172 6420 6469 6d65 6e73   standard dimens
+0001c2b0: 696f 6e20 5f45 6c65 6d65 6e74 7347 6574  ion _ElementsGet
+0001c2c0: 7465 7220 6469 6374 696f 6e61 7279 2061  ter dictionary a
+0001c2d0: 7320 7468 6174 2074 6865 7920 6e6f 206c  s that they no l
+0001c2e0: 6f6e 6765 7220 6170 7065 6172 2075 6e64  onger appear und
+0001c2f0: 6572 2074 6865 206f 6c64 2073 686f 7274  er the old short
+0001c300: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+0001c310: 2020 6966 2065 6c65 6d65 6e74 2e73 686f    if element.sho
+0001c320: 7274 6e61 6d65 2021 3d20 656d 705f 656c  rtname != emp_el
+0001c330: 656d 656e 742e 7368 6f72 746e 616d 653a  ement.shortname:
+0001c340: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001c350: 2020 6f6c 645f 7368 6f72 746e 616d 6520    old_shortname 
+0001c360: 3d20 656c 656d 656e 742e 7368 6f72 746e  = element.shortn
+0001c370: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
+0001c380: 2020 2020 2023 4e6f 7465 202d 2069 6620       #Note - if 
+0001c390: 6f6c 645f 7368 6f72 746e 616d 6520 6973  old_shortname is
+0001c3a0: 204e 6f6e 652c 2074 6865 6e20 7468 6520   None, then the 
+0001c3b0: 656c 656d 656e 7420 7769 6c6c 2062 6520  element will be 
+0001c3c0: 696e 2073 656c 662e 5f65 6c65 6d65 6e74  in self._element
+0001c3d0: 735f 7769 7468 6f75 745f 7368 6f72 746e  s_without_shortn
+0001c3e0: 616d 6573 2077 6869 6368 2077 696c 6c20  ames which will 
+0001c3f0: 6265 2072 6573 6574 2061 2066 6577 206c  be reset a few l
+0001c400: 696e 6573 2062 656c 6f77 2074 6869 7320  ines below this 
+0001c410: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+0001c420: 2020 2020 2069 6620 6f6c 645f 7368 6f72       if old_shor
+0001c430: 746e 616d 6520 6973 206e 6f74 204e 6f6e  tname is not Non
+0001c440: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0001c450: 2020 2020 2020 2020 6465 6c20 7365 6c66          del self
+0001c460: 5b6f 6c64 5f73 686f 7274 6e61 6d65 5d0d  [old_shortname].
+0001c470: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
+0001c480: 234a 4154 2032 3031 392d 3130 2d31 3020  #JAT 2019-10-10 
+0001c490: 7765 2063 616e 6e6f 7420 6173 7365 7274  we cannot assert
+0001c4a0: 2065 6d70 5f65 6c65 6d65 6e74 2e70 6879   emp_element.phy
+0001c4b0: 7369 6420 6973 206e 6f74 204e 6f6e 652c  sid is not None,
+0001c4c0: 2062 6563 6175 7365 2077 6520 6d61 7920   because we may 
+0001c4d0: 6265 206d 6572 6769 6e67 2074 6f20 6120  be merging to a 
+0001c4e0: 7072 6576 696f 7573 6c79 2075 6e73 796e  previously unsyn
+0001c4f0: 6368 726f 6e69 7365 6420 656c 656d 656e  chronised elemen
+0001c500: 740d 0a20 2020 2020 2020 2020 2020 2023  t..            #
+0001c510: 6173 7365 7274 2020 656d 705f 656c 656d  assert  emp_elem
+0001c520: 656e 742e 7068 7973 6964 2069 7320 6e6f  ent.physid is no
+0001c530: 7420 4e6f 6e65 0d0a 0d0a 2020 2020 2020  t None....      
+0001c540: 2020 2020 2020 2343 6f70 7920 696e 2074        #Copy in t
+0001c550: 6865 2064 6174 6120 6672 6f6d 2065 6d70  he data from emp
+0001c560: 6f77 6572 202d 206d 6173 7465 7269 6e67  ower - mastering
+0001c570: 2069 740d 0a20 2020 2020 2020 2020 2020   it..           
+0001c580: 2065 6c65 6d65 6e74 2e73 686f 7274 6e61   element.shortna
+0001c590: 6d65 203d 2065 6d70 5f65 6c65 6d65 6e74  me = emp_element
+0001c5a0: 2e73 686f 7274 6e61 6d65 0d0a 2020 2020  .shortname..    
+0001c5b0: 2020 2020 2020 2020 656c 656d 656e 742e          element.
+0001c5c0: 7068 7973 6964 2020 2020 3d20 656d 705f  physid    = emp_
+0001c5d0: 656c 656d 656e 742e 7068 7973 6964 0d0a  element.physid..
+0001c5e0: 2020 2020 2020 2020 2020 2020 2354 7261              #Tra
+0001c5f0: 6e73 6665 7220 7768 6174 2077 6173 2061  nsfer what was a
+0001c600: 6e20 656c 656d 656e 7420 7769 7468 6f75  n element withou
+0001c610: 7420 6120 7368 6f72 746e 616d 6520 696e  t a shortname in
+0001c620: 746f 2074 6865 2073 7461 6e64 6172 6420  to the standard 
+0001c630: 656c 656d 656e 7420 6469 6374 696f 6e61  element dictiona
+0001c640: 7279 0d0a 2020 2020 2020 2020 2020 2020  ry..            
+0001c650: 7365 6c66 5b65 6c65 6d65 6e74 2e73 686f  self[element.sho
+0001c660: 7274 6e61 6d65 5d20 3d20 656c 656d 656e  rtname] = elemen
+0001c670: 740d 0a0d 0a0d 0a20 2020 2020 2020 2023  t......        #
+0001c680: 5765 2068 6176 6520 6e6f 7720 7075 7420  We have now put 
+0001c690: 616c 6c20 656c 656d 656e 7473 2077 6974  all elements wit
+0001c6a0: 686f 7574 2073 686f 7274 6e61 6d65 7320  hout shortnames 
+0001c6b0: 696e 746f 2074 6865 2073 7461 6e64 6172  into the standar
+0001c6c0: 6420 5f65 6c65 6d65 6e74 7320 6469 6374  d _elements dict
+0001c6d0: 696f 6e61 7279 0d0a 2020 2020 2020 2020  ionary..        
+0001c6e0: 7365 6c66 2e5f 656c 656d 656e 7473 5f77  self._elements_w
+0001c6f0: 6974 686f 7574 5f73 686f 7274 6e61 6d65  ithout_shortname
+0001c700: 7320 3d20 5b5d 0d0a 0d0a 2020 2020 2020  s = []....      
+0001c710: 2020 2366 6f72 2065 6c65 6d65 6e74 2069    #for element i
+0001c720: 6e20 7365 6c66 2e76 616c 7565 7328 293a  n self.values():
+0001c730: 0d0a 2020 2020 2020 2020 2320 2020 2066  ..        #    f
+0001c740: 6f72 206b 2c20 7620 696e 2065 6c65 6d65  or k, v in eleme
+0001c750: 6e74 2e66 6965 6c64 732e 6974 656d 7328  nt.fields.items(
+0001c760: 293a 0d0a 2020 2020 2020 2020 2320 2020  ):..        #   
+0001c770: 2020 2020 2070 7269 6e74 2865 6c65 6d65       print(eleme
+0001c780: 6e74 2e73 686f 7274 6e61 6d65 2c20 6b2c  nt.shortname, k,
+0001c790: 2076 290d 0a0d 0a20 2020 2020 2020 2064   v)....        d
+0001c7a0: 6566 205f 7969 656c 645f 656d 7074 795f  ef _yield_empty_
+0001c7b0: 6361 6c63 756c 6174 696f 6e73 5f73 7472  calculations_str
+0001c7c0: 696e 6773 285f 656c 656d 656e 7473 5f69  ings(_elements_i
+0001c7d0: 7465 7261 746f 7229 3a0d 0a20 2020 2020  terator):..     
+0001c7e0: 2020 2020 2020 2066 6f72 2065 6c65 6d65         for eleme
+0001c7f0: 6e74 2069 6e20 5f65 6c65 6d65 6e74 735f  nt in _elements_
+0001c800: 6974 6572 6174 6f72 3a0d 0a20 2020 2020  iterator:..     
+0001c810: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
+0001c820: 6965 6c64 5f73 686f 7274 6e61 6d65 2c20  ield_shortname, 
+0001c830: 6669 656c 645f 7661 6c75 6520 696e 2065  field_value in e
+0001c840: 6c65 6d65 6e74 2e66 6965 6c64 732e 6564  lement.fields.ed
+0001c850: 6974 6564 5f69 7465 6d73 3a0d 0a20 2020  ited_items:..   
+0001c860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c870: 2069 6620 6669 656c 645f 7368 6f72 746e   if field_shortn
+0001c880: 616d 6520 3d3d 2027 4361 6c63 756c 6174  ame == 'Calculat
+0001c890: 696f 6e27 2061 6e64 206e 6f74 2066 6965  ion' and not fie
+0001c8a0: 6c64 5f76 616c 7565 2069 7320 4e6f 6e65  ld_value is None
+0001c8b0: 2061 6e64 206e 6f74 2066 6965 6c64 5f76   and not field_v
+0001c8c0: 616c 7565 203d 3d20 2727 3a0d 0a20 2020  alue == '':..   
+0001c8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8e0: 2020 2020 2079 6965 6c64 2065 6c65 6d65       yield eleme
+0001c8f0: 6e74 2e73 686f 7274 6e61 6d65 0d0a 2020  nt.shortname..  
+0001c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c910: 2020 2020 2020 7969 656c 6420 275c 7443        yield '\tC
+0001c920: 616c 6375 6c61 7469 6f6e 5c74 404d 7973  alculation\t@Mys
+0001c930: 656c 665c 6e27 0d0a 0d0a 2020 2020 2020  elf\n'....      
+0001c940: 2020 2357 6520 7769 6c6c 2063 616c 6c20    #We will call 
+0001c950: 7468 6973 2066 756e 6374 696f 6e20 7477  this function tw
+0001c960: 6963 6520 746f 2064 6574 6572 6d69 6e65  ice to determine
+0001c970: 2069 6620 7765 206e 6565 6420 746f 2063   if we need to c
+0001c980: 616c 6c20 496d 706f 7274 6572 2028 7768  all Importer (wh
+0001c990: 6963 6820 6973 2073 6c6f 7729 0d0a 2020  ich is slow)..  
+0001c9a0: 2020 2020 2020 6465 6620 5f79 6965 6c64        def _yield
+0001c9b0: 5f66 6965 6c64 735f 7374 7269 6e67 7328  _fields_strings(
+0001c9c0: 5f65 6c65 6d65 6e74 735f 6974 6572 6174  _elements_iterat
+0001c9d0: 6f72 2c66 6965 6c64 5f63 6861 6e67 655f  or,field_change_
+0001c9e0: 636f 756e 745f 6c69 7374 3d5b 305d 293a  count_list=[0]):
+0001c9f0: 0d0a 2020 2020 2020 2020 2020 2020 746f  ..            to
+0001ca00: 7461 6c5f 6669 656c 645f 6368 616e 6765  tal_field_change
+0001ca10: 7320 3d20 300d 0a20 2020 2020 2020 2020  s = 0..         
+0001ca20: 2020 2066 6f72 2065 6c65 6d65 6e74 2069     for element i
+0001ca30: 6e20 5f65 6c65 6d65 6e74 735f 6974 6572  n _elements_iter
+0001ca40: 6174 6f72 3a0d 0a20 2020 2020 2020 2020  ator:..         
+0001ca50: 2020 2020 2020 2066 6f72 2066 6965 6c64         for field
+0001ca60: 5f73 686f 7274 6e61 6d65 2c20 6669 656c  _shortname, fiel
+0001ca70: 645f 7661 6c75 6520 696e 2065 6c65 6d65  d_value in eleme
+0001ca80: 6e74 2e66 6965 6c64 732e 6564 6974 6564  nt.fields.edited
+0001ca90: 5f69 7465 6d73 3a0d 0a0d 0a20 2020 2020  _items:....     
+0001caa0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001cab0: 7072 696e 7428 656c 656d 656e 742e 7368  print(element.sh
+0001cac0: 6f72 746e 616d 652c 2066 6965 6c64 5f73  ortname, field_s
+0001cad0: 686f 7274 6e61 6d65 2c20 6669 656c 645f  hortname, field_
+0001cae0: 7661 6c75 6529 0d0a 2020 2020 2020 2020  value)..        
+0001caf0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+0001cb00: 6965 6c64 5f73 686f 7274 6e61 6d65 206e  ield_shortname n
+0001cb10: 6f74 2069 6e20 5b27 5368 6f72 7420 4e61  ot in ['Short Na
+0001cb20: 6d65 270d 0a20 2020 2020 2020 2020 2020  me'..           
+0001cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001cb40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb60: 2020 2020 2020 2020 205d 3a0d 0a0d 0a20           ]:.... 
+0001cb50: 2020 202c 274d 6561 7375 7265 2045 6c65     ,'Measure Ele
+0001cb60: 6d65 6e74 270d 0a20 2020 2020 2020 2020  ment'..         
 0001cb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb80: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-0001cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cba0: 2020 2020 2020 2020 2063 616e 6f6e 6963           canonic
-0001cbb0: 616c 5f66 6965 6c64 5f73 686f 7274 6e61  al_field_shortna
-0001cbc0: 6d65 203d 207b 274c 6f6e 6720 4e61 6d65  me = {'Long Name
-0001cbd0: 2720 2020 2020 2020 2020 203a 2027 4c6f  '          : 'Lo
-0001cbe0: 6e67 6e61 6d65 270d 0a20 2020 2020 2020  ngname'..       
-0001cbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc20: 202c 2747 726f 7570 204f 6e6c 7927 2020   ,'Group Only'  
-0001cc30: 2020 2020 2020 203a 2027 4772 6f75 704f         : 'GroupO
-0001cc40: 6e6c 7927 0d0a 2020 2020 2020 2020 2020  nly'..          
-0001cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc70: 2020 2020 2020 2020 2020 2020 2020 2c27                ,'
-0001cc80: 4361 6c63 756c 6174 696f 6e20 5374 6174  Calculation Stat
-0001cc90: 7573 2720 3a20 2753 7461 7475 7327 0d0a  us' : 'Status'..
-0001cca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ccb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ccd0: 2020 2020 2020 2020 7d5b 6669 656c 645f          }[field_
-0001cce0: 7368 6f72 746e 616d 655d 0d0a 2020 2020  shortname]..    
+0001cb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cb90: 2020 2020 205d 3a0d 0a0d 0a20 2020 2020       ]:....     
+0001cba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbb0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+0001cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbd0: 2020 2020 2063 616e 6f6e 6963 616c 5f66       canonical_f
+0001cbe0: 6965 6c64 5f73 686f 7274 6e61 6d65 203d  ield_shortname =
+0001cbf0: 207b 274c 6f6e 6720 4e61 6d65 2720 2020   {'Long Name'   
+0001cc00: 2020 2020 2020 203a 2027 4c6f 6e67 6e61         : 'Longna
+0001cc10: 6d65 270d 0a20 2020 2020 2020 2020 2020  me'..           
+0001cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc40: 2020 2020 2020 2020 2020 2020 202c 2747               ,'G
+0001cc50: 726f 7570 204f 6e6c 7927 2020 2020 2020  roup Only'      
+0001cc60: 2020 203a 2027 4772 6f75 704f 6e6c 7927     : 'GroupOnly'
+0001cc70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cca0: 2020 2020 2020 2020 2020 2c27 4361 6c63            ,'Calc
+0001ccb0: 756c 6174 696f 6e20 5374 6174 7573 2720  ulation Status' 
+0001ccc0: 3a20 2753 7461 7475 7327 0d0a 2020 2020  : 'Status'..    
+0001ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001ccf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd00: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-0001cd10: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+0001cd00: 2020 2020 7d5b 6669 656c 645f 7368 6f72      }[field_shor
+0001cd10: 746e 616d 655d 0d0a 2020 2020 2020 2020  tname]..        
 0001cd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd30: 2020 6361 6e6f 6e69 6361 6c5f 6669 656c    canonical_fiel
-0001cd40: 645f 7368 6f72 746e 616d 6520 3d20 6669  d_shortname = fi
-0001cd50: 656c 645f 7368 6f72 746e 616d 650d 0a0d  eld_shortname...
-0001cd60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cd70: 2020 2020 2020 2020 2069 6620 6361 6e6f           if cano
-0001cd80: 6e69 6361 6c5f 6669 656c 645f 7368 6f72  nical_field_shor
-0001cd90: 746e 616d 6520 696e 205b 2747 726f 7570  tname in ['Group
-0001cda0: 4f6e 6c79 272c 2753 7461 7475 7327 2c27  Only','Status','
-0001cdb0: 4361 6c63 756c 6174 696f 6e27 2c27 436f  Calculation','Co
-0001cdc0: 6c6f 7572 275d 2061 6e64 2066 6965 6c64  lour'] and field
-0001cdd0: 5f76 616c 7565 2069 7320 4e6f 6e65 206f  _value is None o
-0001cde0: 7220 6669 656c 645f 7661 6c75 6520 3d3d  r field_value ==
-0001cdf0: 2027 273a 0d0a 2020 2020 2020 2020 2020   '':..          
-0001ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce10: 2020 2357 6520 646f 6e27 7420 7761 6e74    #We don't want
-0001ce20: 2074 6f20 7772 6974 6520 656d 7074 7920   to write empty 
-0001ce30: 7661 6c75 6573 2069 6e74 6f20 7468 6573  values into thes
-0001ce40: 6520 6669 656c 6473 206f 7220 7765 276c  e fields or we'l
-0001ce50: 6c20 6765 7420 6572 726f 7273 0d0a 2020  l get errors..  
-0001ce60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ce70: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-0001ce80: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-0001ce90: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001cea0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001ceb0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001cec0: 454c 454d 454e 5420 5348 4f52 544e 414d  ELEMENT SHORTNAM
-0001ced0: 452c 4649 454c 4420 5348 4f52 544e 414d  E,FIELD SHORTNAM
-0001cee0: 452c 5641 4c55 450d 0a20 2020 2020 2020  E,VALUE..       
-0001cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf00: 2020 2020 2079 6965 6c64 2065 6c65 6d65       yield eleme
-0001cf10: 6e74 2e73 686f 7274 6e61 6d65 0d0a 2020  nt.shortname..  
+0001cd30: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
+0001cd40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001cd50: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+0001cd60: 6e6f 6e69 6361 6c5f 6669 656c 645f 7368  nonical_field_sh
+0001cd70: 6f72 746e 616d 6520 3d20 6669 656c 645f  ortname = field_
+0001cd80: 7368 6f72 746e 616d 650d 0a0d 0a20 2020  shortname....   
+0001cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cda0: 2020 2020 2069 6620 6361 6e6f 6e69 6361       if canonica
+0001cdb0: 6c5f 6669 656c 645f 7368 6f72 746e 616d  l_field_shortnam
+0001cdc0: 6520 696e 205b 2747 726f 7570 4f6e 6c79  e in ['GroupOnly
+0001cdd0: 272c 2753 7461 7475 7327 2c27 4361 6c63  ','Status','Calc
+0001cde0: 756c 6174 696f 6e27 2c27 436f 6c6f 7572  ulation','Colour
+0001cdf0: 275d 2061 6e64 2066 6965 6c64 5f76 616c  '] and field_val
+0001ce00: 7565 2069 7320 4e6f 6e65 206f 7220 6669  ue is None or fi
+0001ce10: 656c 645f 7661 6c75 6520 3d3d 2027 273a  eld_value == '':
+0001ce20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ce30: 2020 2020 2020 2020 2020 2020 2020 2357                #W
+0001ce40: 6520 646f 6e27 7420 7761 6e74 2074 6f20  e don't want to 
+0001ce50: 7772 6974 6520 656d 7074 7920 7661 6c75  write empty valu
+0001ce60: 6573 2069 6e74 6f20 7468 6573 6520 6669  es into these fi
+0001ce70: 656c 6473 206f 7220 7765 276c 6c20 6765  elds or we'll ge
+0001ce80: 7420 6572 726f 7273 0d0a 2020 2020 2020  t errors..      
+0001ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cea0: 2020 2020 2020 636f 6e74 696e 7565 0d0a        continue..
+0001ceb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cec0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0001ced0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cee0: 2020 2020 2020 2020 2020 2023 454c 454d             #ELEM
+0001cef0: 454e 5420 5348 4f52 544e 414d 452c 4649  ENT SHORTNAME,FI
+0001cf00: 454c 4420 5348 4f52 544e 414d 452c 5641  ELD SHORTNAME,VA
+0001cf10: 4c55 450d 0a20 2020 2020 2020 2020 2020  LUE..           
 0001cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf30: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
-0001cf40: 275c 7427 0d0a 2020 2020 2020 2020 2020  '\t'..          
+0001cf30: 2079 6965 6c64 2065 6c65 6d65 6e74 2e73   yield element.s
+0001cf40: 686f 7274 6e61 6d65 0d0a 2020 2020 2020  hortname..      
 0001cf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cf60: 2020 234d 6170 2074 6865 206f 7574 7075    #Map the outpu
-0001cf70: 7420 6e61 6d65 7320 666f 7220 7468 6520  t names for the 
-0001cf80: 6669 656c 6473 2074 6f20 7468 6520 696e  fields to the in
-0001cf90: 7075 7420 7368 6f72 746e 616d 6573 2066  put shortnames f
-0001cfa0: 6f72 2074 6865 2066 6965 6c64 730d 0a20  or the fields.. 
-0001cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfc0: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-0001cfd0: 2073 7472 2863 616e 6f6e 6963 616c 5f66   str(canonical_f
-0001cfe0: 6965 6c64 5f73 686f 7274 6e61 6d65 290d  ield_shortname).
-0001cff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d000: 2020 2020 2020 2020 2020 2020 2079 6965               yie
-0001d010: 6c64 2027 5c74 270d 0a20 2020 2020 2020  ld '\t'..       
+0001cf60: 2020 2020 2020 7969 656c 6420 275c 7427        yield '\t'
+0001cf70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001cf80: 2020 2020 2020 2020 2020 2020 2020 234d                #M
+0001cf90: 6170 2074 6865 206f 7574 7075 7420 6e61  ap the output na
+0001cfa0: 6d65 7320 666f 7220 7468 6520 6669 656c  mes for the fiel
+0001cfb0: 6473 2074 6f20 7468 6520 696e 7075 7420  ds to the input 
+0001cfc0: 7368 6f72 746e 616d 6573 2066 6f72 2074  shortnames for t
+0001cfd0: 6865 2066 6965 6c64 730d 0a20 2020 2020  he fields..     
+0001cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cff0: 2020 2020 2020 2079 6965 6c64 2073 7472         yield str
+0001d000: 2863 616e 6f6e 6963 616c 5f66 6965 6c64  (canonical_field
+0001d010: 5f73 686f 7274 6e61 6d65 290d 0a20 2020  _shortname)..   
 0001d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d030: 2020 2020 2069 6620 6669 656c 645f 7661       if field_va
-0001d040: 6c75 6520 6973 206e 6f74 204e 6f6e 653a  lue is not None:
-0001d050: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d070: 2020 234d 6170 2047 726f 7570 2065 6c65    #Map Group ele
-0001d080: 6d65 6e74 7320 746f 2054 7275 650d 0a20  ments to True.. 
-0001d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001d0b0: 6620 2863 616e 6f6e 6963 616c 5f66 6965  f (canonical_fie
-0001d0c0: 6c64 5f73 686f 7274 6e61 6d65 203d 3d20  ld_shortname == 
-0001d0d0: 2747 726f 7570 4f6e 6c79 2729 2061 6e64  'GroupOnly') and
-0001d0e0: 2028 6669 656c 645f 7661 6c75 6520 3d3d   (field_value ==
-0001d0f0: 2022 4772 6f75 7022 293a 0d0a 2020 2020   "Group"):..    
-0001d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d120: 6669 656c 645f 7661 6c75 6520 3d20 2254  field_value = "T
-0001d130: 7275 6522 0d0a 2020 2020 2020 2020 2020  rue"..          
-0001d140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d150: 2020 2020 2020 6966 2027 5c6e 2720 696e        if '\n' in
-0001d160: 2073 7472 2866 6965 6c64 5f76 616c 7565   str(field_value
-0001d170: 2920 6f72 2027 5c74 2720 696e 2073 7472  ) or '\t' in str
-0001d180: 2866 6965 6c64 5f76 616c 7565 293a 0d0a  (field_value):..
-0001d190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1b0: 2020 2020 7969 656c 6420 2722 270d 0a20      yield '"'.. 
+0001d030: 2020 2020 2020 2020 2079 6965 6c64 2027           yield '
+0001d040: 5c74 270d 0a20 2020 2020 2020 2020 2020  \t'..           
+0001d050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d060: 2069 6620 6669 656c 645f 7661 6c75 6520   if field_value 
+0001d070: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+0001d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d090: 2020 2020 2020 2020 2020 2020 2020 234d                #M
+0001d0a0: 6170 2047 726f 7570 2065 6c65 6d65 6e74  ap Group element
+0001d0b0: 7320 746f 2054 7275 650d 0a20 2020 2020  s to True..     
+0001d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0d0: 2020 2020 2020 2020 2020 2069 6620 2863             if (c
+0001d0e0: 616e 6f6e 6963 616c 5f66 6965 6c64 5f73  anonical_field_s
+0001d0f0: 686f 7274 6e61 6d65 203d 3d20 2747 726f  hortname == 'Gro
+0001d100: 7570 4f6e 6c79 2729 2061 6e64 2028 6669  upOnly') and (fi
+0001d110: 656c 645f 7661 6c75 6520 3d3d 2022 4772  eld_value == "Gr
+0001d120: 6f75 7022 293a 0d0a 2020 2020 2020 2020  oup"):..        
+0001d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d140: 2020 2020 2020 2020 2020 2020 6669 656c              fiel
+0001d150: 645f 7661 6c75 6520 3d20 2254 7275 6522  d_value = "True"
+0001d160: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d180: 2020 6966 2027 5c6e 2720 696e 2073 7472    if '\n' in str
+0001d190: 2866 6965 6c64 5f76 616c 7565 2920 6f72  (field_value) or
+0001d1a0: 2027 5c74 2720 696e 2073 7472 2866 6965   '\t' in str(fie
+0001d1b0: 6c64 5f76 616c 7565 293a 0d0a 2020 2020  ld_value):..    
 0001d1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001d1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1e0: 2020 2079 6965 6c64 2073 7472 2866 6965     yield str(fie
-0001d1f0: 6c64 5f76 616c 7565 292e 7265 706c 6163  ld_value).replac
-0001d200: 6528 2722 272c 2722 2227 290d 0a20 2020  e('"','""')..   
-0001d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d230: 2079 6965 6c64 2027 2227 0d0a 2020 2020   yield '"'..    
+0001d1e0: 7969 656c 6420 2722 270d 0a20 2020 2020  yield '"'..     
+0001d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d200: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+0001d210: 6965 6c64 2073 7472 2866 6965 6c64 5f76  ield str(field_v
+0001d220: 616c 7565 292e 7265 706c 6163 6528 2722  alue).replace('"
+0001d230: 272c 2722 2227 290d 0a20 2020 2020 2020  ','""')..       
 0001d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d250: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001d260: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001d250: 2020 2020 2020 2020 2020 2020 2079 6965               yie
+0001d260: 6c64 2027 2227 0d0a 2020 2020 2020 2020  ld '"'..        
 0001d270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d280: 2020 2020 2020 2079 6965 6c64 2073 7472         yield str
-0001d290: 2866 6965 6c64 5f76 616c 7565 292e 7265  (field_value).re
-0001d2a0: 706c 6163 6528 2722 272c 2722 2227 290d  place('"','""').
-0001d2b0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0001d2c0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-0001d2d0: 6965 6c64 2027 5c6e 270d 0a20 2020 2020  ield '\n'..     
+0001d280: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0001d290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d2b0: 2020 2079 6965 6c64 2073 7472 2866 6965     yield str(fie
+0001d2c0: 6c64 5f76 616c 7565 292e 7265 706c 6163  ld_value).replac
+0001d2d0: 6528 2722 272c 2722 2227 290d 0a0d 0a20  e('"','""').... 
 0001d2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2f0: 2020 2020 2020 2074 6f74 616c 5f66 6965         total_fie
-0001d300: 6c64 5f63 6861 6e67 6573 202b 3d20 310d  ld_changes += 1.
-0001d310: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-0001d320: 5468 6973 2069 7320 7468 6520 2772 6574  This is the 'ret
-0001d330: 7572 6e20 7661 6c75 6527 2070 6173 7365  urn value' passe
-0001d340: 6420 696e 2061 7320 6120 6d75 7461 626c  d in as a mutabl
-0001d350: 6520 6c69 7374 0d0a 2020 2020 2020 2020  e list..        
-0001d360: 2020 2020 6669 656c 645f 6368 616e 6765      field_change
-0001d370: 5f63 6f75 6e74 5f6c 6973 745b 305d 3d74  _count_list[0]=t
-0001d380: 6f74 616c 5f66 6965 6c64 5f63 6861 6e67  otal_field_chang
-0001d390: 6573 0d0a 0d0a 2020 2020 2020 2020 2344  es....        #D
-0001d3a0: 6f20 7477 6f20 7061 7373 6573 2c20 746f  o two passes, to
-0001d3b0: 2064 6574 6572 6d69 6e65 2077 6865 7468   determine wheth
-0001d3c0: 6572 2077 6520 7761 6e74 2074 6f20 6361  er we want to ca
-0001d3d0: 6c6c 2074 6865 2075 7064 6174 6520 6669  ll the update fi
-0001d3e0: 656c 6473 2069 6d70 6f72 7465 7220 7363  elds importer sc
-0001d3f0: 7269 7074 0d0a 0d0a 2020 2020 2020 2020  ript....        
-0001d400: 234b 6565 7020 7472 6163 6b20 6f66 206e  #Keep track of n
-0001d410: 756d 6265 7220 6f66 2066 6965 6c64 2063  umber of field c
-0001d420: 6861 6e67 6573 2073 6f20 7765 2064 6f6e  hanges so we don
-0001d430: 2774 2064 6f20 756e 6e65 6365 7373 6172  't do unnecessar
-0001d440: 7920 776f 726b 0d0a 2020 2020 2020 2020  y work..        
-0001d450: 2357 6520 6e65 6564 2074 6f20 7472 6163  #We need to trac
-0001d460: 6b20 6368 616e 6765 7320 696e 2061 206d  k changes in a m
-0001d470: 7574 6162 6c65 2028 692e 652e 206c 6973  utable (i.e. lis
-0001d480: 7429 0d0a 2020 2020 2020 2020 6669 656c  t)..        fiel
-0001d490: 645f 6368 616e 6765 5f63 6f75 6e74 5f6c  d_change_count_l
-0001d4a0: 6973 7420 3d20 5b30 5d0d 0a20 2020 2020  ist = [0]..     
-0001d4b0: 2020 2066 6f72 2073 2069 6e20 5f79 6965     for s in _yie
-0001d4c0: 6c64 5f66 6965 6c64 735f 7374 7269 6e67  ld_fields_string
-0001d4d0: 7328 7365 6c66 2e76 616c 7565 7328 292c  s(self.values(),
-0001d4e0: 6669 656c 645f 6368 616e 6765 5f63 6f75  field_change_cou
-0001d4f0: 6e74 5f6c 6973 7429 3a0d 0a20 2020 2020  nt_list):..     
-0001d500: 2020 2020 2020 2070 6173 730d 0a20 2020         pass..   
-0001d510: 2020 2020 2074 6f74 616c 5f66 6965 6c64       total_field
-0001d520: 5f63 6861 6e67 6573 203d 2066 6965 6c64  _changes = field
-0001d530: 5f63 6861 6e67 655f 636f 756e 745f 6c69  _change_count_li
-0001d540: 7374 5b30 5d0d 0a0d 0a20 2020 2020 2020  st[0]....       
-0001d550: 2069 6620 746f 7461 6c5f 6669 656c 645f   if total_field_
-0001d560: 6368 616e 6765 7320 3e20 303a 0d0a 0d0a  changes > 0:....
-0001d570: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-0001d580: 6d6d 616e 645f 6c69 7374 203d 2073 656c  mmand_list = sel
-0001d590: 662e 6469 6d65 6e73 696f 6e2e 7369 7465  f.dimension.site
-0001d5a0: 2e5f 6c6f 676f 6e5f 7061 7261 6d65 7465  ._logon_paramete
-0001d5b0: 725f 696d 706f 7274 6572 5f63 6f6d 6d61  r_importer_comma
-0001d5c0: 6e64 7320 2b20 5c0d 0a20 2020 2020 2020  nds + \..       
-0001d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5e0: 2020 2020 5b27 7365 742d 7061 7261 6d65      ['set-parame
-0001d5f0: 7465 7220 696e 7075 745f 6669 6c65 3d27  ter input_file='
-0001d600: 2020 2020 202b 2069 6d70 6f72 7465 645f       + imported_
-0001d610: 6669 656c 6473 5f66 696c 6570 6174 680d  fields_filepath.
-0001d620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d630: 2020 2020 2020 2020 2020 2020 2c27 6c6f              ,'lo
-0001d640: 6164 2d66 696c 652d 7473 7620 2224 7b69  ad-file-tsv "${i
-0001d650: 6e70 7574 5f66 696c 657d 2227 0d0a 2020  nput_file}"'..  
-0001d660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d670: 2020 2020 2020 2020 205d 0d0a 0d0a 2020           ]....  
-0001d680: 2020 2020 2020 2020 2020 2343 7265 6174            #Creat
-0001d690: 6520 7468 6520 656c 656d 656e 7420 6669  e the element fi
-0001d6a0: 656c 6473 2028 666f 7220 616c 6c20 656c  elds (for all el
-0001d6b0: 656d 656e 7473 202d 206e 6f74 206a 7573  ements - not jus
-0001d6c0: 7420 6e65 7720 6f6e 6573 290d 0a20 2020  t new ones)..   
-0001d6d0: 2020 2020 2020 2020 206d 616a 6f72 5f76           major_v
-0001d6e0: 6572 7369 6f6e 2c20 6d69 6e6f 725f 7665  ersion, minor_ve
-0001d6f0: 7273 696f 6e2c 2072 656c 6561 7365 2c20  rsion, release, 
-0001d700: 7265 6c65 6173 655f 6e75 6d62 6572 203d  release_number =
-0001d710: 2073 656c 662e 6469 6d65 6e73 696f 6e2e   self.dimension.
-0001d720: 7369 7465 2e69 6d70 6f72 7465 725f 7665  site.importer_ve
-0001d730: 7273 696f 6e0d 0a0d 0a20 2020 2020 2020  rsion....       
-0001d740: 2020 2020 2069 6620 286d 616a 6f72 5f76       if (major_v
-0001d750: 6572 7369 6f6e 203d 3d20 3920 616e 6420  ersion == 9 and 
-0001d760: 2872 656c 6561 7365 5f6e 756d 6265 7220  (release_number 
-0001d770: 3e3d 2031 3732 3420 6f72 206d 696e 6f72  >= 1724 or minor
-0001d780: 5f76 6572 7369 6f6e 203e 3d37 2929 206f  _version >=7)) o
-0001d790: 7220 6d61 6a6f 725f 7665 7273 696f 6e20  r major_version 
-0001d7a0: 3e20 393a 0d0a 2020 2020 2020 2020 2020  > 9:..          
-0001d7b0: 2020 2020 2020 636f 6d6d 616e 645f 6c69        command_li
-0001d7c0: 7374 202b 3d20 5b27 656d 706f 7765 722d  st += ['empower-
-0001d7d0: 696d 706f 7274 2d66 6965 6c64 2d76 616c  import-field-val
-0001d7e0: 7565 7320 2224 7b73 6974 657d 2220 2224  ues "${site}" "$
-0001d7f0: 7b75 7365 727d 2220 2224 7b70 6173 7377  {user}" "${passw
-0001d800: 6f72 647d 2220 272b 7374 7228 7365 6c66  ord}" '+str(self
-0001d810: 2e64 696d 656e 7369 6f6e 2e69 6e64 6578  .dimension.index
-0001d820: 295d 0d0a 2020 2020 2020 2020 2020 2020  )]..            
-0001d830: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0001d840: 2020 2020 2020 2023 5573 6520 7468 6520         #Use the 
-0001d850: 656d 706f 7765 722d 696d 706f 7274 2d66  empower-import-f
-0001d860: 6965 6c64 7320 636f 6d6d 616e 6420 6465  ields command de
-0001d870: 7072 6563 6174 6564 2069 6e20 6275 696c  precated in buil
-0001d880: 6420 3137 3234 0d0a 2020 2020 2020 2020  d 1724..        
-0001d890: 2020 2020 2020 2020 636f 6d6d 616e 645f          command_
-0001d8a0: 6c69 7374 202b 3d20 5b27 656d 706f 7765  list += ['empowe
-0001d8b0: 722d 696d 706f 7274 2d66 6965 6c64 7320  r-import-fields 
-0001d8c0: 2224 7b73 6974 657d 2220 2224 7b75 7365  "${site}" "${use
-0001d8d0: 727d 2220 2224 7b70 6173 7377 6f72 647d  r}" "${password}
-0001d8e0: 2220 272b 7374 7228 7365 6c66 2e64 696d  " '+str(self.dim
-0001d8f0: 656e 7369 6f6e 2e69 6e64 6578 295d 0d0a  ension.index)]..
-0001d900: 0d0a 2020 2020 2020 2020 2020 2020 2349  ..            #I
-0001d910: 6e20 6465 6275 6720 6d6f 6465 2077 7269  n debug mode wri
-0001d920: 7465 2074 6865 2064 6174 6120 696e 746f  te the data into
-0001d930: 2061 2074 7376 2066 696c 6520 616e 6420   a tsv file and 
-0001d940: 7265 6164 2069 7420 7769 7468 2049 6d70  read it with Imp
-0001d950: 6f72 7465 722c 2070 7574 7469 6e67 2074  orter, putting t
-0001d960: 6865 2065 6c65 6d65 6e74 7320 696e 746f  he elements into
-0001d970: 2045 6d70 6f77 6572 0d0a 2020 2020 2020   Empower..      
-0001d980: 2020 2020 2020 6966 2064 6562 7567 3a0d        if debug:.
-0001d990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d9a0: 2023 4e6f 6e20 7469 6d65 2064 696d 656e   #Non time dimen
-0001d9b0: 7369 6f6e 7320 6d61 7920 6861 7665 2066  sions may have f
-0001d9c0: 6965 6c64 7320 2d20 7772 6974 6520 7468  ields - write th
-0001d9d0: 6520 7374 616e 6461 7264 2061 6e64 206e  e standard and n
-0001d9e0: 6f6e 2073 7461 6e64 6172 6420 6669 656c  on standard fiel
-0001d9f0: 6473 2074 6f20 6669 6c65 2061 6e64 2069  ds to file and i
-0001da00: 6d70 6f72 7420 7468 656d 0d0a 2020 2020  mport them..    
-0001da10: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0001da20: 206f 7065 6e28 696d 706f 7274 6564 5f66   open(imported_f
-0001da30: 6965 6c64 735f 6669 6c65 7061 7468 2c27  ields_filepath,'
-0001da40: 7727 2c65 6e63 6f64 696e 673d 2775 7466  w',encoding='utf
-0001da50: 3827 2920 6173 2069 6d70 6f72 7465 645f  8') as imported_
-0001da60: 6669 656c 6473 5f66 696c 653a 0d0a 0d0a  fields_file:....
-0001da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da80: 2020 2020 2357 7269 7465 2065 6d70 7479      #Write empty
-0001da90: 2063 616c 6375 6c61 7469 6f6e 2065 6c65   calculation ele
-0001daa0: 6d65 6e74 7320 666f 7220 616c 6c20 6368  ments for all ch
-0001dab0: 616e 6765 6420 6361 6c63 756c 6174 696f  anged calculatio
-0001dac0: 6e73 2074 6f20 6865 6c70 2070 7265 7665  ns to help preve
-0001dad0: 6e74 2063 6972 6375 6c61 7220 6361 6c63  nt circular calc
-0001dae0: 756c 6174 696f 6e73 0d0a 2020 2020 2020  ulations..      
-0001daf0: 2020 2020 2020 2020 2020 2020 2020 2354                #T
-0001db00: 6865 7365 2077 696c 6c20 6265 206f 7665  hese will be ove
-0001db10: 7277 7269 7474 656e 2069 6d6d 6564 6961  rwritten immedia
-0001db20: 7465 6c79 0d0a 2020 2020 2020 2020 2020  tely..          
-0001db30: 2020 2020 2020 2020 2020 666f 7220 7320            for s 
-0001db40: 696e 205f 7969 656c 645f 656d 7074 795f  in _yield_empty_
-0001db50: 6361 6c63 756c 6174 696f 6e73 5f73 7472  calculations_str
-0001db60: 696e 6773 2873 656c 662e 7661 6c75 6573  ings(self.values
-0001db70: 2829 293a 0d0a 2020 2020 2020 2020 2020  ()):..          
-0001db80: 2020 2020 2020 2020 2020 2020 2020 696d                im
-0001db90: 706f 7274 6564 5f66 6965 6c64 735f 6669  ported_fields_fi
-0001dba0: 6c65 2e77 7269 7465 2873 290d 0a0d 0a20  le.write(s).... 
-0001dbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbc0: 2020 2023 5772 6974 6520 6669 656c 6473     #Write fields
-0001dbd0: 2066 6f72 2061 6c6c 2065 6c65 6d65 6e74   for all element
-0001dbe0: 732c 206f 6e6c 7920 7468 6520 6368 616e  s, only the chan
-0001dbf0: 6765 6420 6669 656c 6473 2077 696c 6c20  ged fields will 
-0001dc00: 6765 7420 7772 6974 7465 6e0d 0a20 2020  get written..   
-0001dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc20: 2066 6f72 2073 2069 6e20 5f79 6965 6c64   for s in _yield
-0001dc30: 5f66 6965 6c64 735f 7374 7269 6e67 7328  _fields_strings(
-0001dc40: 7365 6c66 2e76 616c 7565 7328 2929 3a0d  self.values()):.
-0001dc50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dc60: 2020 2020 2020 2020 2069 6d70 6f72 7465           importe
-0001dc70: 645f 6669 656c 6473 5f66 696c 652e 7772  d_fields_file.wr
-0001dc80: 6974 6528 7329 0d0a 0d0a 2020 2020 2020  ite(s)....      
-0001dc90: 2020 2020 2020 2020 2020 6c6c 752e 7275            llu.ru
-0001dca0: 6e5f 7369 6e67 6c65 5f6f 7574 7075 745f  n_single_output_
-0001dcb0: 696d 706f 7274 6572 5f63 6f6d 6d61 6e64  importer_command
-0001dcc0: 7328 636f 6d6d 616e 645f 6c69 7374 2c65  s(command_list,e
-0001dcd0: 6d70 6f77 6572 5f69 6d70 6f72 7465 725f  mpower_importer_
-0001dce0: 6578 6563 7574 6162 6c65 3d73 656c 662e  executable=self.
-0001dcf0: 6469 6d65 6e73 696f 6e2e 7369 7465 2e65  dimension.site.e
-0001dd00: 6d70 6f77 6572 5f69 6d70 6f72 7465 725f  mpower_importer_
-0001dd10: 6578 6563 7574 6162 6c65 290d 0a0d 0a20  executable).... 
-0001dd20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001dd30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001dd40: 2020 2349 6e20 276e 6f72 6d61 6c27 206d    #In 'normal' m
-0001dd50: 6f64 6520 646f 2061 206d 6572 7279 2064  ode do a merry d
-0001dd60: 616e 6365 2077 6974 6820 5769 6e64 6f77  ance with Window
-0001dd70: 7320 6e61 6d65 6420 7069 7065 732e 2054  s named pipes. T
-0001dd80: 6869 7320 6176 6f69 6473 2077 7269 7469  his avoids writi
-0001dd90: 6e67 2074 6865 2064 6174 6120 746f 2066  ng the data to f
-0001dda0: 696c 6520 666f 7220 7365 6375 7269 7479  ile for security
-0001ddb0: 2061 6e64 2070 7261 6374 6963 616c 6974   and practicalit
-0001ddc0: 7920 7265 6173 6f6e 730d 0a20 2020 2020  y reasons..     
-0001ddd0: 2020 2020 2020 2020 2020 2023 696d 706f             #impo
-0001dde0: 7274 6564 5f66 6965 6c64 735f 6669 6c65  rted_fields_file
-0001ddf0: 7061 7468 2069 7320 7468 6520 6e61 6d65  path is the name
-0001de00: 206f 6620 7468 6520 6e61 6d65 6420 7069   of the named pi
-0001de10: 7065 2065 2e67 2e20 5c5c 2e5c 7069 7065  pe e.g. \\.\pipe
-0001de20: 5c39 6463 6366 6130 382d 3430 6331 2d34  \9dccfa08-40c1-4
-0001de30: 3566 352d 3865 3065 2d66 3634 6331 3835  5f5-8e0e-f64c185
-0001de40: 3032 6263 640d 0a20 2020 2020 2020 2020  02bcd..         
-0001de50: 2020 2020 2020 2023 5468 6520 6d65 7272         #The merr
-0001de60: 7920 6461 6e63 6520 6d65 616e 7320 7374  y dance means st
-0001de70: 6172 7469 6e67 2065 6d70 6f77 6572 2c20  arting empower, 
-0001de80: 7265 6665 7265 6e63 696e 6720 7468 6520  referencing the 
-0001de90: 7069 7065 2c20 6f70 656e 696e 6720 7468  pipe, opening th
-0001dea0: 6520 7069 7065 2062 6566 6f72 6520 656d  e pipe before em
-0001deb0: 706f 7765 7220 6973 2070 726f 7065 726c  power is properl
-0001dec0: 7920 7374 6172 7465 640d 0a20 2020 2020  y started..     
-0001ded0: 2020 2020 2020 2020 2020 2023 7365 7474             #sett
-0001dee0: 696e 6720 7570 2074 6865 206e 616d 6564  ing up the named
-0001def0: 2070 6970 6520 6f6e 2074 6869 7320 7468   pipe on this th
-0001df00: 7265 6164 2c20 616e 6420 7772 6974 696e  read, and writin
-0001df10: 6720 746f 2069 7420 2861 7320 736f 6f6e  g to it (as soon
-0001df20: 2061 7320 496d 706f 7274 6572 2063 6f6e   as Importer con
-0001df30: 6e65 6374 7320 6174 2069 7473 2065 6e64  nects at its end
-0001df40: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001df50: 2020 2023 5468 6520 6469 6666 6963 756c     #The difficul
-0001df60: 7479 2c20 6973 2074 6861 7420 7765 2068  ty, is that we h
-0001df70: 6176 6520 746f 2070 6173 7320 7468 6520  ave to pass the 
-0001df80: 6e61 6d65 206f 6620 7468 6520 7069 7065  name of the pipe
-0001df90: 2074 6f20 496d 706f 7274 6572 2c20 616e   to Importer, an
-0001dfa0: 6420 7265 6c79 206f 6e20 7468 6520 6661  d rely on the fa
-0001dfb0: 6374 2074 6861 7420 6974 2077 6f6e 2774  ct that it won't
-0001dfc0: 2068 6176 6520 7469 6d65 2074 6f20 6f70   have time to op
-0001dfd0: 656e 2069 740d 0a20 2020 2020 2020 2020  en it..         
-0001dfe0: 2020 2020 2020 2023 6265 666f 7265 2077         #before w
-0001dff0: 6520 6861 7665 2063 7265 6174 6564 2069  e have created i
-0001e000: 742e 2042 7574 2077 6520 7769 6c6c 2062  t. But we will b
-0001e010: 6c6f 636b 206f 6e20 6f75 7220 7369 6465  lock on our side
-0001e020: 2075 6e74 696c 2049 6d70 6f72 7465 7220   until Importer 
-0001e030: 6861 7320 636f 6e6e 6563 7465 640d 0a20  has connected.. 
-0001e040: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001e050: 726f 6320 3d20 4e6f 6e65 0d0a 2020 2020  roc = None..    
-0001e060: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-0001e070: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001e080: 2020 2020 2020 7072 6f63 203d 206c 6c75        proc = llu
-0001e090: 2e73 7461 7274 5f6e 6f5f 6f75 7470 7574  .start_no_output
-0001e0a0: 5f69 6d70 6f72 7465 725f 636f 6d6d 616e  _importer_comman
-0001e0b0: 6473 2863 6f6d 6d61 6e64 5f6c 6973 742c  ds(command_list,
-0001e0c0: 656d 706f 7765 725f 696d 706f 7274 6572  empower_importer
-0001e0d0: 5f65 7865 6375 7461 626c 653d 7365 6c66  _executable=self
-0001e0e0: 2e64 696d 656e 7369 6f6e 2e73 6974 652e  .dimension.site.
-0001e0f0: 656d 706f 7765 725f 696d 706f 7274 6572  empower_importer
-0001e100: 5f65 7865 6375 7461 626c 6529 0d0a 2020  _executable)..  
-0001e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e120: 2020 7769 7468 206c 6c75 2e6f 7574 626f    with llu.outbo
-0001e130: 756e 645f 7069 7065 2869 6d70 6f72 7465  und_pipe(importe
-0001e140: 645f 6669 656c 6473 5f66 696c 6570 6174  d_fields_filepat
-0001e150: 6829 2061 7320 7069 7065 3a0d 0a0d 0a20  h) as pipe:.... 
-0001e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e170: 2020 2020 2020 2023 5772 6974 6520 656d         #Write em
-0001e180: 7074 7920 6361 6c63 756c 6174 696f 6e20  pty calculation 
-0001e190: 656c 656d 656e 7473 2066 6f72 2061 6c6c  elements for all
-0001e1a0: 2063 6861 6e67 6564 2063 616c 6375 6c61   changed calcula
-0001e1b0: 7469 6f6e 7320 746f 2068 656c 7020 7072  tions to help pr
-0001e1c0: 6576 656e 7420 6369 7263 756c 6172 2063  event circular c
-0001e1d0: 616c 6375 6c61 7469 6f6e 730d 0a20 2020  alculations..   
-0001e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1f0: 2020 2020 2023 5468 6573 6520 7769 6c6c       #These will
-0001e200: 2062 6520 6f76 6572 7772 6974 7465 6e20   be overwritten 
-0001e210: 696d 6d65 6469 6174 656c 790d 0a20 2020  immediately..   
-0001e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e230: 2020 2020 2066 6f72 2073 2069 6e20 5f79       for s in _y
-0001e240: 6965 6c64 5f65 6d70 7479 5f63 616c 6375  ield_empty_calcu
-0001e250: 6c61 7469 6f6e 735f 7374 7269 6e67 7328  lations_strings(
-0001e260: 7365 6c66 2e76 616c 7565 7328 2929 3a0d  self.values()):.
-0001e270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e280: 2020 2020 2020 2020 2020 2020 2077 696e               win
-0001e290: 3332 6669 6c65 2e57 7269 7465 4669 6c65  32file.WriteFile
-0001e2a0: 2870 6970 652c 2073 7472 2e65 6e63 6f64  (pipe, str.encod
-0001e2b0: 6528 7329 290d 0a0d 0a20 2020 2020 2020  e(s))....       
-0001e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2d0: 2023 5772 6974 6520 6669 656c 6473 2066   #Write fields f
-0001e2e0: 6f72 2061 6c6c 2065 6c65 6d65 6e74 732c  or all elements,
-0001e2f0: 206f 6e6c 7920 7468 6520 6368 616e 6765   only the change
-0001e300: 6420 6669 656c 6473 2077 696c 6c20 6765  d fields will ge
-0001e310: 7420 7772 6974 7465 6e0d 0a20 2020 2020  t written..     
-0001e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e330: 2020 2066 6f72 2073 2069 6e20 5f79 6965     for s in _yie
-0001e340: 6c64 5f66 6965 6c64 735f 7374 7269 6e67  ld_fields_string
-0001e350: 7328 7365 6c66 2e76 616c 7565 7328 2929  s(self.values())
-0001e360: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001e370: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-0001e380: 696e 3332 6669 6c65 2e57 7269 7465 4669  in32file.WriteFi
-0001e390: 6c65 2870 6970 652c 2073 7472 2e65 6e63  le(pipe, str.enc
-0001e3a0: 6f64 6528 7329 290d 0a0d 0a20 2020 2020  ode(s))....     
-0001e3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3c0: 2020 206c 6f67 2e64 6562 7567 2822 5069     log.debug("Pi
-0001e3d0: 7065 207b 7d20 6669 6e69 7368 6564 2077  pe {} finished w
-0001e3e0: 7269 7469 6e67 222e 666f 726d 6174 2869  riting".format(i
-0001e3f0: 6d70 6f72 7465 645f 6669 656c 6473 5f66  mported_fields_f
-0001e400: 696c 6570 6174 6829 290d 0a0d 0a20 2020  ilepath))....   
-0001e410: 2020 2020 2020 2020 2020 2020 2066 696e               fin
-0001e420: 616c 6c79 3a0d 0a0d 0a20 2020 2020 2020  ally:....       
-0001e430: 2020 2020 2020 2020 2020 2020 2023 4368               #Ch
-0001e440: 6563 6b20 6966 2049 6d70 6f72 7465 7220  eck if Importer 
-0001e450: 7265 7475 726e 6564 2061 6e20 6572 726f  returned an erro
-0001e460: 7220 616e 6420 7261 6973 6520 6974 2061  r and raise it a
-0001e470: 7320 6120 7079 7468 6f6e 2069 6620 6974  s a python if it
-0001e480: 2064 6964 0d0a 2020 2020 2020 2020 2020   did..          
-0001e490: 2020 2020 2020 2020 2020 6c6c 752e 636f            llu.co
-0001e4a0: 6d70 6c65 7465 5f6e 6f5f 6f75 7470 7574  mplete_no_output
-0001e4b0: 5f69 6d70 6f72 7465 725f 7072 6f63 6573  _importer_proces
-0001e4c0: 7328 7072 6f63 290d 0a0d 0a0d 0a20 2020  s(proc)......   
-0001e4d0: 2020 2020 2020 2020 206c 6f67 2e76 6572           log.ver
-0001e4e0: 626f 7365 2827 4c6f 6164 6564 2066 6965  bose('Loaded fie
-0001e4f0: 6c64 7327 290d 0a0d 0a20 2020 2020 2020  lds')....       
-0001e500: 2066 6f72 2065 6c65 6d65 6e74 2069 6e20   for element in 
-0001e510: 7365 6c66 2e76 616c 7565 7328 293a 0d0a  self.values():..
-0001e520: 2020 2020 2020 2020 2020 2020 656c 656d              elem
-0001e530: 656e 742e 6669 656c 6473 2e72 6573 6574  ent.fields.reset
-0001e540: 5f65 6469 745f 7374 6174 7573 2829 0d0a  _edit_status()..
-0001e550: 2020 2020 2020 2020 2020 2020 656c 656d              elem
-0001e560: 656e 742e 5f65 6469 7465 6420 3d20 4661  ent._edited = Fa
-0001e570: 6c73 650d 0a0d 0a0d 0a20 2020 2020 2020  lse......       
-0001e580: 2069 6620 6973 5f74 696d 655f 6469 6d65   if is_time_dime
-0001e590: 6e73 696f 6e3a 0d0a 2020 2020 2020 2020  nsion:..        
-0001e5a0: 2020 2020 6c6f 672e 7665 7262 6f73 6528      log.verbose(
-0001e5b0: 2754 696d 6520 456c 656d 656e 7473 2075  'Time Elements u
-0001e5c0: 7064 6174 6564 2066 6f72 2064 696d 656e  pdated for dimen
-0001e5d0: 7369 6f6e 2027 2b73 7472 2873 656c 662e  sion '+str(self.
-0001e5e0: 6469 6d65 6e73 696f 6e2e 696e 6465 7829  dimension.index)
-0001e5f0: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-0001e600: 0d0a 2020 2020 2020 2020 2020 2020 6c6f  ..            lo
-0001e610: 672e 7665 7262 6f73 6528 2745 6c65 6d65  g.verbose('Eleme
-0001e620: 6e74 7320 6372 6561 7465 6420 666f 7220  nts created for 
-0001e630: 6469 6d65 6e73 696f 6e20 272b 7374 7228  dimension '+str(
-0001e640: 7365 6c66 2e64 696d 656e 7369 6f6e 2e69  self.dimension.i
-0001e650: 6e64 6578 2929 0d0a 0d0a 2020 2020 2020  ndex))....      
-0001e660: 2020 7365 6c66 2e5f 656c 656d 656e 7473    self._elements
-0001e670: 5f73 796e 6365 6420 3d20 5472 7565 0d0a  _synced = True..
-0001e680: 0d0a 2020 2020 2020 2020 2373 796e 6368  ..        #synch
-0001e690: 726f 6e69 7365 2073 6563 7572 6974 790d  ronise security.
-0001e6a0: 0a20 2020 2020 2020 2023 7072 696e 7428  .        #print(
-0001e6b0: 2731 3436 333a 272c 7365 6c66 2e64 696d  '1463:',self.dim
-0001e6c0: 656e 7369 6f6e 2e65 6c65 6d65 6e74 732e  ension.elements.
-0001e6d0: 5f73 6563 7572 6974 795f 6564 6974 6564  _security_edited
-0001e6e0: 290d 0a20 2020 2020 2020 2069 6620 7365  )..        if se
-0001e6f0: 6c66 2e64 696d 656e 7369 6f6e 2e65 6c65  lf.dimension.ele
-0001e700: 6d65 6e74 732e 5f73 6563 7572 6974 795f  ments._security_
-0001e710: 6564 6974 6564 3a0d 0a0d 0a20 2020 2020  edited:....     
-0001e720: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
-0001e730: 696d 656e 7369 6f6e 2e6c 6f6e 676e 616d  imension.longnam
-0001e740: 6520 6973 204e 6f6e 653a 0d0a 2020 2020  e is None:..    
-0001e750: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001e760: 6520 5661 6c75 6545 7272 6f72 2827 4361  e ValueError('Ca
-0001e770: 6e6e 6f74 2073 796e 6368 726f 6e69 7365  nnot synchronise
-0001e780: 2064 696d 656e 7369 6f6e 2073 6563 7572   dimension secur
-0001e790: 6974 7920 756e 7469 6c20 7468 6520 2e6c  ity until the .l
-0001e7a0: 6f6e 676e 616d 6520 7072 6f70 6572 7479  ongname property
-0001e7b0: 206f 6620 6469 6d65 6e73 696f 6e20 7b7d   of dimension {}
-0001e7c0: 2068 6173 2062 6565 6e20 7365 7427 2e66   has been set'.f
-0001e7d0: 6f72 6d61 7428 7365 6c66 2e64 696d 656e  ormat(self.dimen
-0001e7e0: 7369 6f6e 2e69 6e64 6578 2929 0d0a 0d0a  sion.index))....
-0001e7f0: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-0001e800: 6562 7567 3a0d 0a20 2020 2020 2020 2020  ebug:..         
-0001e810: 2020 2020 2020 2066 6f72 2064 6972 2069         for dir i
-0001e820: 6e20 5b73 656c 662e 5f65 6d70 6f77 6572  n [self._empower
-0001e830: 5f64 696d 5f69 6d70 6f72 745f 6469 725d  _dim_import_dir]
-0001e840: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
-0001e850: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-0001e860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e870: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
-0001e880: 7273 2864 6972 290d 0a20 2020 2020 2020  rs(dir)..       
-0001e890: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0001e8a0: 6570 7420 4669 6c65 4578 6973 7473 4572  ept FileExistsEr
-0001e8b0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-0001e8c0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0001e8d0: 7373 0d0a 2020 2020 2020 2020 2020 2020  ss..            
-0001e8e0: 2020 2020 2020 2020 6578 6365 7074 204f          except O
-0001e8f0: 5345 7272 6f72 2061 7320 653a 0d0a 2020  SError as e:..  
+0001d2f0: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+0001d300: 2027 5c6e 270d 0a20 2020 2020 2020 2020   '\n'..         
+0001d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d320: 2020 2074 6f74 616c 5f66 6965 6c64 5f63     total_field_c
+0001d330: 6861 6e67 6573 202b 3d20 310d 0a0d 0a20  hanges += 1.... 
+0001d340: 2020 2020 2020 2020 2020 2023 5468 6973             #This
+0001d350: 2069 7320 7468 6520 2772 6574 7572 6e20   is the 'return 
+0001d360: 7661 6c75 6527 2070 6173 7365 6420 696e  value' passed in
+0001d370: 2061 7320 6120 6d75 7461 626c 6520 6c69   as a mutable li
+0001d380: 7374 0d0a 2020 2020 2020 2020 2020 2020  st..            
+0001d390: 6669 656c 645f 6368 616e 6765 5f63 6f75  field_change_cou
+0001d3a0: 6e74 5f6c 6973 745b 305d 3d74 6f74 616c  nt_list[0]=total
+0001d3b0: 5f66 6965 6c64 5f63 6861 6e67 6573 0d0a  _field_changes..
+0001d3c0: 0d0a 2020 2020 2020 2020 2344 6f20 7477  ..        #Do tw
+0001d3d0: 6f20 7061 7373 6573 2c20 746f 2064 6574  o passes, to det
+0001d3e0: 6572 6d69 6e65 2077 6865 7468 6572 2077  ermine whether w
+0001d3f0: 6520 7761 6e74 2074 6f20 6361 6c6c 2074  e want to call t
+0001d400: 6865 2075 7064 6174 6520 6669 656c 6473  he update fields
+0001d410: 2069 6d70 6f72 7465 7220 7363 7269 7074   importer script
+0001d420: 0d0a 0d0a 2020 2020 2020 2020 234b 6565  ....        #Kee
+0001d430: 7020 7472 6163 6b20 6f66 206e 756d 6265  p track of numbe
+0001d440: 7220 6f66 2066 6965 6c64 2063 6861 6e67  r of field chang
+0001d450: 6573 2073 6f20 7765 2064 6f6e 2774 2064  es so we don't d
+0001d460: 6f20 756e 6e65 6365 7373 6172 7920 776f  o unnecessary wo
+0001d470: 726b 0d0a 2020 2020 2020 2020 2357 6520  rk..        #We 
+0001d480: 6e65 6564 2074 6f20 7472 6163 6b20 6368  need to track ch
+0001d490: 616e 6765 7320 696e 2061 206d 7574 6162  anges in a mutab
+0001d4a0: 6c65 2028 692e 652e 206c 6973 7429 0d0a  le (i.e. list)..
+0001d4b0: 2020 2020 2020 2020 6669 656c 645f 6368          field_ch
+0001d4c0: 616e 6765 5f63 6f75 6e74 5f6c 6973 7420  ange_count_list 
+0001d4d0: 3d20 5b30 5d0d 0a20 2020 2020 2020 2066  = [0]..        f
+0001d4e0: 6f72 2073 2069 6e20 5f79 6965 6c64 5f66  or s in _yield_f
+0001d4f0: 6965 6c64 735f 7374 7269 6e67 7328 7365  ields_strings(se
+0001d500: 6c66 2e76 616c 7565 7328 292c 6669 656c  lf.values(),fiel
+0001d510: 645f 6368 616e 6765 5f63 6f75 6e74 5f6c  d_change_count_l
+0001d520: 6973 7429 3a0d 0a20 2020 2020 2020 2020  ist):..         
+0001d530: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
+0001d540: 2074 6f74 616c 5f66 6965 6c64 5f63 6861   total_field_cha
+0001d550: 6e67 6573 203d 2066 6965 6c64 5f63 6861  nges = field_cha
+0001d560: 6e67 655f 636f 756e 745f 6c69 7374 5b30  nge_count_list[0
+0001d570: 5d0d 0a0d 0a20 2020 2020 2020 2069 6620  ]....        if 
+0001d580: 746f 7461 6c5f 6669 656c 645f 6368 616e  total_field_chan
+0001d590: 6765 7320 3e20 303a 0d0a 0d0a 0d0a 2020  ges > 0:......  
+0001d5a0: 2020 2020 2020 2020 2020 636f 6d6d 616e            comman
+0001d5b0: 645f 6c69 7374 203d 2073 656c 662e 6469  d_list = self.di
+0001d5c0: 6d65 6e73 696f 6e2e 7369 7465 2e5f 6c6f  mension.site._lo
+0001d5d0: 676f 6e5f 7061 7261 6d65 7465 725f 696d  gon_parameter_im
+0001d5e0: 706f 7274 6572 5f63 6f6d 6d61 6e64 7320  porter_commands 
+0001d5f0: 2b20 5c0d 0a20 2020 2020 2020 2020 2020  + \..           
+0001d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d610: 5b27 7365 742d 7061 7261 6d65 7465 7220  ['set-parameter 
+0001d620: 696e 7075 745f 6669 6c65 3d27 2020 2020  input_file='    
+0001d630: 202b 2069 6d70 6f72 7465 645f 6669 656c   + imported_fiel
+0001d640: 6473 5f66 696c 6570 6174 680d 0a20 2020  ds_filepath..   
+0001d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d660: 2020 2020 2020 2020 2c27 6c6f 6164 2d66          ,'load-f
+0001d670: 696c 652d 7473 7620 2224 7b69 6e70 7574  ile-tsv "${input
+0001d680: 5f66 696c 657d 2227 0d0a 2020 2020 2020  _file}"'..      
+0001d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6a0: 2020 2020 205d 0d0a 0d0a 2020 2020 2020       ]....      
+0001d6b0: 2020 2020 2020 2343 7265 6174 6520 7468        #Create th
+0001d6c0: 6520 656c 656d 656e 7420 6669 656c 6473  e element fields
+0001d6d0: 2028 666f 7220 616c 6c20 656c 656d 656e   (for all elemen
+0001d6e0: 7473 202d 206e 6f74 206a 7573 7420 6e65  ts - not just ne
+0001d6f0: 7720 6f6e 6573 290d 0a20 2020 2020 2020  w ones)..       
+0001d700: 2020 2020 206d 616a 6f72 5f76 6572 7369       major_versi
+0001d710: 6f6e 2c20 6d69 6e6f 725f 7665 7273 696f  on, minor_versio
+0001d720: 6e2c 2072 656c 6561 7365 2c20 7265 6c65  n, release, rele
+0001d730: 6173 655f 6e75 6d62 6572 203d 2073 656c  ase_number = sel
+0001d740: 662e 6469 6d65 6e73 696f 6e2e 7369 7465  f.dimension.site
+0001d750: 2e69 6d70 6f72 7465 725f 7665 7273 696f  .importer_versio
+0001d760: 6e0d 0a0d 0a20 2020 2020 2020 2020 2020  n....           
+0001d770: 2069 6620 286d 616a 6f72 5f76 6572 7369   if (major_versi
+0001d780: 6f6e 203d 3d20 3920 616e 6420 2872 656c  on == 9 and (rel
+0001d790: 6561 7365 5f6e 756d 6265 7220 3e3d 2031  ease_number >= 1
+0001d7a0: 3732 3420 6f72 206d 696e 6f72 5f76 6572  724 or minor_ver
+0001d7b0: 7369 6f6e 203e 3d37 2929 206f 7220 6d61  sion >=7)) or ma
+0001d7c0: 6a6f 725f 7665 7273 696f 6e20 3e20 393a  jor_version > 9:
+0001d7d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001d7e0: 2020 636f 6d6d 616e 645f 6c69 7374 202b    command_list +
+0001d7f0: 3d20 5b27 656d 706f 7765 722d 696d 706f  = ['empower-impo
+0001d800: 7274 2d66 6965 6c64 2d76 616c 7565 7320  rt-field-values 
+0001d810: 2224 7b73 6974 657d 2220 2224 7b75 7365  "${site}" "${use
+0001d820: 727d 2220 2224 7b70 6173 7377 6f72 647d  r}" "${password}
+0001d830: 2220 272b 7374 7228 7365 6c66 2e64 696d  " '+str(self.dim
+0001d840: 656e 7369 6f6e 2e69 6e64 6578 295d 0d0a  ension.index)]..
+0001d850: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001d860: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001d870: 2020 2023 5573 6520 7468 6520 656d 706f     #Use the empo
+0001d880: 7765 722d 696d 706f 7274 2d66 6965 6c64  wer-import-field
+0001d890: 7320 636f 6d6d 616e 6420 6465 7072 6563  s command deprec
+0001d8a0: 6174 6564 2069 6e20 6275 696c 6420 3137  ated in build 17
+0001d8b0: 3234 0d0a 2020 2020 2020 2020 2020 2020  24..            
+0001d8c0: 2020 2020 636f 6d6d 616e 645f 6c69 7374      command_list
+0001d8d0: 202b 3d20 5b27 656d 706f 7765 722d 696d   += ['empower-im
+0001d8e0: 706f 7274 2d66 6965 6c64 7320 2224 7b73  port-fields "${s
+0001d8f0: 6974 657d 2220 2224 7b75 7365 727d 2220  ite}" "${user}" 
+0001d900: 2224 7b70 6173 7377 6f72 647d 2220 272b  "${password}" '+
+0001d910: 7374 7228 7365 6c66 2e64 696d 656e 7369  str(self.dimensi
+0001d920: 6f6e 2e69 6e64 6578 295d 0d0a 0d0a 2020  on.index)]....  
+0001d930: 2020 2020 2020 2020 2020 2349 6e20 6465            #In de
+0001d940: 6275 6720 6d6f 6465 2077 7269 7465 2074  bug mode write t
+0001d950: 6865 2064 6174 6120 696e 746f 2061 2074  he data into a t
+0001d960: 7376 2066 696c 6520 616e 6420 7265 6164  sv file and read
+0001d970: 2069 7420 7769 7468 2049 6d70 6f72 7465   it with Importe
+0001d980: 722c 2070 7574 7469 6e67 2074 6865 2065  r, putting the e
+0001d990: 6c65 6d65 6e74 7320 696e 746f 2045 6d70  lements into Emp
+0001d9a0: 6f77 6572 0d0a 2020 2020 2020 2020 2020  ower..          
+0001d9b0: 2020 6966 2064 6562 7567 3a0d 0a20 2020    if debug:..   
+0001d9c0: 2020 2020 2020 2020 2020 2020 2023 4e6f               #No
+0001d9d0: 6e20 7469 6d65 2064 696d 656e 7369 6f6e  n time dimension
+0001d9e0: 7320 6d61 7920 6861 7665 2066 6965 6c64  s may have field
+0001d9f0: 7320 2d20 7772 6974 6520 7468 6520 7374  s - write the st
+0001da00: 616e 6461 7264 2061 6e64 206e 6f6e 2073  andard and non s
+0001da10: 7461 6e64 6172 6420 6669 656c 6473 2074  tandard fields t
+0001da20: 6f20 6669 6c65 2061 6e64 2069 6d70 6f72  o file and impor
+0001da30: 7420 7468 656d 0d0a 2020 2020 2020 2020  t them..        
+0001da40: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
+0001da50: 6e28 696d 706f 7274 6564 5f66 6965 6c64  n(imported_field
+0001da60: 735f 6669 6c65 7061 7468 2c27 7727 2c65  s_filepath,'w',e
+0001da70: 6e63 6f64 696e 673d 2775 7466 3827 2920  ncoding='utf8') 
+0001da80: 6173 2069 6d70 6f72 7465 645f 6669 656c  as imported_fiel
+0001da90: 6473 5f66 696c 653a 0d0a 0d0a 2020 2020  ds_file:....    
+0001daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dab0: 2357 7269 7465 2065 6d70 7479 2063 616c  #Write empty cal
+0001dac0: 6375 6c61 7469 6f6e 2065 6c65 6d65 6e74  culation element
+0001dad0: 7320 666f 7220 616c 6c20 6368 616e 6765  s for all change
+0001dae0: 6420 6361 6c63 756c 6174 696f 6e73 2074  d calculations t
+0001daf0: 6f20 6865 6c70 2070 7265 7665 6e74 2063  o help prevent c
+0001db00: 6972 6375 6c61 7220 6361 6c63 756c 6174  ircular calculat
+0001db10: 696f 6e73 0d0a 2020 2020 2020 2020 2020  ions..          
+0001db20: 2020 2020 2020 2020 2020 2354 6865 7365            #These
+0001db30: 2077 696c 6c20 6265 206f 7665 7277 7269   will be overwri
+0001db40: 7474 656e 2069 6d6d 6564 6961 7465 6c79  tten immediately
+0001db50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001db60: 2020 2020 2020 666f 7220 7320 696e 205f        for s in _
+0001db70: 7969 656c 645f 656d 7074 795f 6361 6c63  yield_empty_calc
+0001db80: 756c 6174 696f 6e73 5f73 7472 696e 6773  ulations_strings
+0001db90: 2873 656c 662e 7661 6c75 6573 2829 293a  (self.values()):
+0001dba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001dbb0: 2020 2020 2020 2020 2020 696d 706f 7274            import
+0001dbc0: 6564 5f66 6965 6c64 735f 6669 6c65 2e77  ed_fields_file.w
+0001dbd0: 7269 7465 2873 290d 0a0d 0a20 2020 2020  rite(s)....     
+0001dbe0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001dbf0: 5772 6974 6520 6669 656c 6473 2066 6f72  Write fields for
+0001dc00: 2061 6c6c 2065 6c65 6d65 6e74 732c 206f   all elements, o
+0001dc10: 6e6c 7920 7468 6520 6368 616e 6765 6420  nly the changed 
+0001dc20: 6669 656c 6473 2077 696c 6c20 6765 7420  fields will get 
+0001dc30: 7772 6974 7465 6e0d 0a20 2020 2020 2020  written..       
+0001dc40: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0001dc50: 2073 2069 6e20 5f79 6965 6c64 5f66 6965   s in _yield_fie
+0001dc60: 6c64 735f 7374 7269 6e67 7328 7365 6c66  lds_strings(self
+0001dc70: 2e76 616c 7565 7328 2929 3a0d 0a20 2020  .values()):..   
+0001dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc90: 2020 2020 2069 6d70 6f72 7465 645f 6669       imported_fi
+0001dca0: 656c 6473 5f66 696c 652e 7772 6974 6528  elds_file.write(
+0001dcb0: 7329 0d0a 0d0a 2020 2020 2020 2020 2020  s)....          
+0001dcc0: 2020 2020 2020 6c6c 752e 7275 6e5f 7369        llu.run_si
+0001dcd0: 6e67 6c65 5f6f 7574 7075 745f 696d 706f  ngle_output_impo
+0001dce0: 7274 6572 5f63 6f6d 6d61 6e64 7328 636f  rter_commands(co
+0001dcf0: 6d6d 616e 645f 6c69 7374 2c65 6d70 6f77  mmand_list,empow
+0001dd00: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
+0001dd10: 7574 6162 6c65 3d73 656c 662e 6469 6d65  utable=self.dime
+0001dd20: 6e73 696f 6e2e 7369 7465 2e65 6d70 6f77  nsion.site.empow
+0001dd30: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
+0001dd40: 7574 6162 6c65 290d 0a0d 0a20 2020 2020  utable)....     
+0001dd50: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0001dd60: 2020 2020 2020 2020 2020 2020 2020 2349                #I
+0001dd70: 6e20 276e 6f72 6d61 6c27 206d 6f64 6520  n 'normal' mode 
+0001dd80: 646f 2061 206d 6572 7279 2064 616e 6365  do a merry dance
+0001dd90: 2077 6974 6820 5769 6e64 6f77 7320 6e61   with Windows na
+0001dda0: 6d65 6420 7069 7065 732e 2054 6869 7320  med pipes. This 
+0001ddb0: 6176 6f69 6473 2077 7269 7469 6e67 2074  avoids writing t
+0001ddc0: 6865 2064 6174 6120 746f 2066 696c 6520  he data to file 
+0001ddd0: 666f 7220 7365 6375 7269 7479 2061 6e64  for security and
+0001dde0: 2070 7261 6374 6963 616c 6974 7920 7265   practicality re
+0001ddf0: 6173 6f6e 730d 0a20 2020 2020 2020 2020  asons..         
+0001de00: 2020 2020 2020 2023 696d 706f 7274 6564         #imported
+0001de10: 5f66 6965 6c64 735f 6669 6c65 7061 7468  _fields_filepath
+0001de20: 2069 7320 7468 6520 6e61 6d65 206f 6620   is the name of 
+0001de30: 7468 6520 6e61 6d65 6420 7069 7065 2065  the named pipe e
+0001de40: 2e67 2e20 5c5c 2e5c 7069 7065 5c39 6463  .g. \\.\pipe\9dc
+0001de50: 6366 6130 382d 3430 6331 2d34 3566 352d  cfa08-40c1-45f5-
+0001de60: 3865 3065 2d66 3634 6331 3835 3032 6263  8e0e-f64c18502bc
+0001de70: 640d 0a20 2020 2020 2020 2020 2020 2020  d..             
+0001de80: 2020 2023 5468 6520 6d65 7272 7920 6461     #The merry da
+0001de90: 6e63 6520 6d65 616e 7320 7374 6172 7469  nce means starti
+0001dea0: 6e67 2065 6d70 6f77 6572 2c20 7265 6665  ng empower, refe
+0001deb0: 7265 6e63 696e 6720 7468 6520 7069 7065  rencing the pipe
+0001dec0: 2c20 6f70 656e 696e 6720 7468 6520 7069  , opening the pi
+0001ded0: 7065 2062 6566 6f72 6520 656d 706f 7765  pe before empowe
+0001dee0: 7220 6973 2070 726f 7065 726c 7920 7374  r is properly st
+0001def0: 6172 7465 640d 0a20 2020 2020 2020 2020  arted..         
+0001df00: 2020 2020 2020 2023 7365 7474 696e 6720         #setting 
+0001df10: 7570 2074 6865 206e 616d 6564 2070 6970  up the named pip
+0001df20: 6520 6f6e 2074 6869 7320 7468 7265 6164  e on this thread
+0001df30: 2c20 616e 6420 7772 6974 696e 6720 746f  , and writing to
+0001df40: 2069 7420 2861 7320 736f 6f6e 2061 7320   it (as soon as 
+0001df50: 496d 706f 7274 6572 2063 6f6e 6e65 6374  Importer connect
+0001df60: 7320 6174 2069 7473 2065 6e64 290d 0a20  s at its end).. 
+0001df70: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001df80: 5468 6520 6469 6666 6963 756c 7479 2c20  The difficulty, 
+0001df90: 6973 2074 6861 7420 7765 2068 6176 6520  is that we have 
+0001dfa0: 746f 2070 6173 7320 7468 6520 6e61 6d65  to pass the name
+0001dfb0: 206f 6620 7468 6520 7069 7065 2074 6f20   of the pipe to 
+0001dfc0: 496d 706f 7274 6572 2c20 616e 6420 7265  Importer, and re
+0001dfd0: 6c79 206f 6e20 7468 6520 6661 6374 2074  ly on the fact t
+0001dfe0: 6861 7420 6974 2077 6f6e 2774 2068 6176  hat it won't hav
+0001dff0: 6520 7469 6d65 2074 6f20 6f70 656e 2069  e time to open i
+0001e000: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+0001e010: 2020 2023 6265 666f 7265 2077 6520 6861     #before we ha
+0001e020: 7665 2063 7265 6174 6564 2069 742e 2042  ve created it. B
+0001e030: 7574 2077 6520 7769 6c6c 2062 6c6f 636b  ut we will block
+0001e040: 206f 6e20 6f75 7220 7369 6465 2075 6e74   on our side unt
+0001e050: 696c 2049 6d70 6f72 7465 7220 6861 7320  il Importer has 
+0001e060: 636f 6e6e 6563 7465 640d 0a20 2020 2020  connected..     
+0001e070: 2020 2020 2020 2020 2020 2070 726f 6320             proc 
+0001e080: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+0001e090: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+0001e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0b0: 2020 7072 6f63 203d 206c 6c75 2e73 7461    proc = llu.sta
+0001e0c0: 7274 5f6e 6f5f 6f75 7470 7574 5f69 6d70  rt_no_output_imp
+0001e0d0: 6f72 7465 725f 636f 6d6d 616e 6473 2863  orter_commands(c
+0001e0e0: 6f6d 6d61 6e64 5f6c 6973 742c 656d 706f  ommand_list,empo
+0001e0f0: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
+0001e100: 6375 7461 626c 653d 7365 6c66 2e64 696d  cutable=self.dim
+0001e110: 656e 7369 6f6e 2e73 6974 652e 656d 706f  ension.site.empo
+0001e120: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
+0001e130: 6375 7461 626c 6529 0d0a 2020 2020 2020  cutable)..      
+0001e140: 2020 2020 2020 2020 2020 2020 2020 7769                wi
+0001e150: 7468 206c 6c75 2e6f 7574 626f 756e 645f  th llu.outbound_
+0001e160: 7069 7065 2869 6d70 6f72 7465 645f 6669  pipe(imported_fi
+0001e170: 656c 6473 5f66 696c 6570 6174 6829 2061  elds_filepath) a
+0001e180: 7320 7069 7065 3a0d 0a0d 0a20 2020 2020  s pipe:....     
+0001e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1a0: 2020 2023 5772 6974 6520 656d 7074 7920     #Write empty 
+0001e1b0: 6361 6c63 756c 6174 696f 6e20 656c 656d  calculation elem
+0001e1c0: 656e 7473 2066 6f72 2061 6c6c 2063 6861  ents for all cha
+0001e1d0: 6e67 6564 2063 616c 6375 6c61 7469 6f6e  nged calculation
+0001e1e0: 7320 746f 2068 656c 7020 7072 6576 656e  s to help preven
+0001e1f0: 7420 6369 7263 756c 6172 2063 616c 6375  t circular calcu
+0001e200: 6c61 7469 6f6e 730d 0a20 2020 2020 2020  lations..       
+0001e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e220: 2023 5468 6573 6520 7769 6c6c 2062 6520   #These will be 
+0001e230: 6f76 6572 7772 6974 7465 6e20 696d 6d65  overwritten imme
+0001e240: 6469 6174 656c 790d 0a20 2020 2020 2020  diately..       
+0001e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e260: 2066 6f72 2073 2069 6e20 5f79 6965 6c64   for s in _yield
+0001e270: 5f65 6d70 7479 5f63 616c 6375 6c61 7469  _empty_calculati
+0001e280: 6f6e 735f 7374 7269 6e67 7328 7365 6c66  ons_strings(self
+0001e290: 2e76 616c 7565 7328 2929 3a0d 0a20 2020  .values()):..   
+0001e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2b0: 2020 2020 2020 2020 2077 696e 3332 6669           win32fi
+0001e2c0: 6c65 2e57 7269 7465 4669 6c65 2870 6970  le.WriteFile(pip
+0001e2d0: 652c 2073 7472 2e65 6e63 6f64 6528 7329  e, str.encode(s)
+0001e2e0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+0001e2f0: 2020 2020 2020 2020 2020 2020 2023 5772               #Wr
+0001e300: 6974 6520 6669 656c 6473 2066 6f72 2061  ite fields for a
+0001e310: 6c6c 2065 6c65 6d65 6e74 732c 206f 6e6c  ll elements, onl
+0001e320: 7920 7468 6520 6368 616e 6765 6420 6669  y the changed fi
+0001e330: 656c 6473 2077 696c 6c20 6765 7420 7772  elds will get wr
+0001e340: 6974 7465 6e0d 0a20 2020 2020 2020 2020  itten..         
+0001e350: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001e360: 6f72 2073 2069 6e20 5f79 6965 6c64 5f66  or s in _yield_f
+0001e370: 6965 6c64 735f 7374 7269 6e67 7328 7365  ields_strings(se
+0001e380: 6c66 2e76 616c 7565 7328 2929 3a0d 0a20  lf.values()):.. 
+0001e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3a0: 2020 2020 2020 2020 2020 2077 696e 3332             win32
+0001e3b0: 6669 6c65 2e57 7269 7465 4669 6c65 2870  file.WriteFile(p
+0001e3c0: 6970 652c 2073 7472 2e65 6e63 6f64 6528  ipe, str.encode(
+0001e3d0: 7329 290d 0a0d 0a20 2020 2020 2020 2020  s))....         
+0001e3e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001e3f0: 6f67 2e64 6562 7567 2822 5069 7065 207b  og.debug("Pipe {
+0001e400: 7d20 6669 6e69 7368 6564 2077 7269 7469  } finished writi
+0001e410: 6e67 222e 666f 726d 6174 2869 6d70 6f72  ng".format(impor
+0001e420: 7465 645f 6669 656c 6473 5f66 696c 6570  ted_fields_filep
+0001e430: 6174 6829 290d 0a0d 0a20 2020 2020 2020  ath))....       
+0001e440: 2020 2020 2020 2020 2066 696e 616c 6c79           finally
+0001e450: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+0001e460: 2020 2020 2020 2020 2023 4368 6563 6b20           #Check 
+0001e470: 6966 2049 6d70 6f72 7465 7220 7265 7475  if Importer retu
+0001e480: 726e 6564 2061 6e20 6572 726f 7220 616e  rned an error an
+0001e490: 6420 7261 6973 6520 6974 2061 7320 6120  d raise it as a 
+0001e4a0: 7079 7468 6f6e 2069 6620 6974 2064 6964  python if it did
+0001e4b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001e4c0: 2020 2020 2020 6c6c 752e 636f 6d70 6c65        llu.comple
+0001e4d0: 7465 5f6e 6f5f 6f75 7470 7574 5f69 6d70  te_no_output_imp
+0001e4e0: 6f72 7465 725f 7072 6f63 6573 7328 7072  orter_process(pr
+0001e4f0: 6f63 290d 0a0d 0a0d 0a20 2020 2020 2020  oc)......       
+0001e500: 2020 2020 206c 6f67 2e76 6572 626f 7365       log.verbose
+0001e510: 2827 4c6f 6164 6564 2066 6965 6c64 7327  ('Loaded fields'
+0001e520: 290d 0a0d 0a20 2020 2020 2020 2066 6f72  )....        for
+0001e530: 2065 6c65 6d65 6e74 2069 6e20 7365 6c66   element in self
+0001e540: 2e76 616c 7565 7328 293a 0d0a 2020 2020  .values():..    
+0001e550: 2020 2020 2020 2020 656c 656d 656e 742e          element.
+0001e560: 6669 656c 6473 2e72 6573 6574 5f65 6469  fields.reset_edi
+0001e570: 745f 7374 6174 7573 2829 0d0a 2020 2020  t_status()..    
+0001e580: 2020 2020 2020 2020 656c 656d 656e 742e          element.
+0001e590: 5f65 6469 7465 6420 3d20 4661 6c73 650d  _edited = False.
+0001e5a0: 0a0d 0a0d 0a20 2020 2020 2020 2069 6620  .....        if 
+0001e5b0: 6973 5f74 696d 655f 6469 6d65 6e73 696f  is_time_dimensio
+0001e5c0: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+0001e5d0: 6c6f 672e 7665 7262 6f73 6528 2754 696d  log.verbose('Tim
+0001e5e0: 6520 456c 656d 656e 7473 2075 7064 6174  e Elements updat
+0001e5f0: 6564 2066 6f72 2064 696d 656e 7369 6f6e  ed for dimension
+0001e600: 2027 2b73 7472 2873 656c 662e 6469 6d65   '+str(self.dime
+0001e610: 6e73 696f 6e2e 696e 6465 7829 290d 0a20  nsion.index)).. 
+0001e620: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0001e630: 2020 2020 2020 2020 2020 6c6f 672e 7665            log.ve
+0001e640: 7262 6f73 6528 2745 6c65 6d65 6e74 7320  rbose('Elements 
+0001e650: 6372 6561 7465 6420 666f 7220 6469 6d65  created for dime
+0001e660: 6e73 696f 6e20 272b 7374 7228 7365 6c66  nsion '+str(self
+0001e670: 2e64 696d 656e 7369 6f6e 2e69 6e64 6578  .dimension.index
+0001e680: 2929 0d0a 0d0a 2020 2020 2020 2020 7365  ))....        se
+0001e690: 6c66 2e5f 656c 656d 656e 7473 5f73 796e  lf._elements_syn
+0001e6a0: 6365 6420 3d20 5472 7565 0d0a 0d0a 2020  ced = True....  
+0001e6b0: 2020 2020 2020 2373 796e 6368 726f 6e69        #synchroni
+0001e6c0: 7365 2073 6563 7572 6974 790d 0a20 2020  se security..   
+0001e6d0: 2020 2020 2023 7072 696e 7428 2731 3436       #print('146
+0001e6e0: 333a 272c 7365 6c66 2e64 696d 656e 7369  3:',self.dimensi
+0001e6f0: 6f6e 2e65 6c65 6d65 6e74 732e 5f73 6563  on.elements._sec
+0001e700: 7572 6974 795f 6564 6974 6564 290d 0a20  urity_edited).. 
+0001e710: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
+0001e720: 696d 656e 7369 6f6e 2e65 6c65 6d65 6e74  imension.element
+0001e730: 732e 5f73 6563 7572 6974 795f 6564 6974  s._security_edit
+0001e740: 6564 3a0d 0a0d 0a20 2020 2020 2020 2020  ed:....         
+0001e750: 2020 2069 6620 7365 6c66 2e64 696d 656e     if self.dimen
+0001e760: 7369 6f6e 2e6c 6f6e 676e 616d 6520 6973  sion.longname is
+0001e770: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0001e780: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0001e790: 6c75 6545 7272 6f72 2827 4361 6e6e 6f74  lueError('Cannot
+0001e7a0: 2073 796e 6368 726f 6e69 7365 2064 696d   synchronise dim
+0001e7b0: 656e 7369 6f6e 2073 6563 7572 6974 7920  ension security 
+0001e7c0: 756e 7469 6c20 7468 6520 2e6c 6f6e 676e  until the .longn
+0001e7d0: 616d 6520 7072 6f70 6572 7479 206f 6620  ame property of 
+0001e7e0: 6469 6d65 6e73 696f 6e20 7b7d 2068 6173  dimension {} has
+0001e7f0: 2062 6565 6e20 7365 7427 2e66 6f72 6d61   been set'.forma
+0001e800: 7428 7365 6c66 2e64 696d 656e 7369 6f6e  t(self.dimension
+0001e810: 2e69 6e64 6578 2929 0d0a 0d0a 2020 2020  .index))....    
+0001e820: 2020 2020 2020 2020 6966 2064 6562 7567          if debug
+0001e830: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001e840: 2020 2066 6f72 2064 6972 2069 6e20 5b73     for dir in [s
+0001e850: 656c 662e 5f65 6d70 6f77 6572 5f64 696d  elf._empower_dim
+0001e860: 5f69 6d70 6f72 745f 6469 725d 3a0d 0a0d  _import_dir]:...
+0001e870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e880: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+0001e890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8a0: 2020 206f 732e 6d61 6b65 6469 7273 2864     os.makedirs(d
+0001e8b0: 6972 290d 0a20 2020 2020 2020 2020 2020  ir)..           
+0001e8c0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0001e8d0: 4669 6c65 4578 6973 7473 4572 726f 723a  FileExistsError:
+0001e8e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001e8f0: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
 0001e900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e910: 2020 2020 2020 6966 2065 2e77 696e 6572        if e.winer
-0001e920: 726f 7220 3d3d 2031 3233 3a0d 0a20 2020  ror == 123:..   
+0001e910: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
+0001e920: 6f72 2061 7320 653a 0d0a 2020 2020 2020  or as e:..      
 0001e930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e940: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-0001e950: 616c 7565 4572 726f 7228 2744 6972 6563  alueError('Direc
-0001e960: 746f 7279 2022 7b7d 2220 6861 7320 616e  tory "{}" has an
-0001e970: 2069 6e76 616c 6964 206e 616d 652e 2044   invalid name. D
-0001e980: 6964 2079 6f75 2070 6173 7320 6120 7369  id you pass a si
-0001e990: 7465 5f6c 6f63 6174 6f72 2070 6174 6820  te_locator path 
-0001e9a0: 227b 7d22 2077 6974 686f 7574 2064 6f75  "{}" without dou
-0001e9b0: 626c 652d 6573 6361 7069 6e67 2062 6163  ble-escaping bac
-0001e9c0: 6b73 6c61 7368 6573 206f 7220 7072 6566  kslashes or pref
-0001e9d0: 6978 696e 6720 7468 6520 7374 7269 6e67  ixing the string
-0001e9e0: 2077 6974 6820 616e 2022 7222 2066 6f72   with an "r" for
-0001e9f0: 2072 6177 3f27 2e66 6f72 6d61 7428 6469   raw?'.format(di
-0001ea00: 722c 7265 7072 2873 6974 655f 6c6f 6361  r,repr(site_loca
-0001ea10: 746f 7229 2929 0d0a 2020 2020 2020 2020  tor)))..        
-0001ea20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea30: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0001ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea50: 2020 2072 6169 7365 2065 0d0a 2020 2020     raise e..    
-0001ea60: 2020 2020 2020 2020 2020 2020 7365 6375              secu
-0001ea70: 7269 7479 5f66 696c 6570 6174 683d 6f73  rity_filepath=os
-0001ea80: 2e70 6174 682e 6a6f 696e 2873 656c 662e  .path.join(self.
-0001ea90: 6469 6d65 6e73 696f 6e2e 7369 7465 2e5f  dimension.site._
-0001eaa0: 656d 706f 7765 725f 6469 6d5f 696d 706f  empower_dim_impo
-0001eab0: 7274 5f64 6972 2c27 4469 6d65 6e73 696f  rt_dir,'Dimensio
-0001eac0: 6e5f 272b 7374 7228 7365 6c66 2e64 696d  n_'+str(self.dim
-0001ead0: 656e 7369 6f6e 2e69 6e64 6578 292b 275f  ension.index)+'_
-0001eae0: 5365 6375 7269 7479 2e74 7376 2729 0d0a  Security.tsv')..
-0001eaf0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0001eb00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001eb10: 2020 2023 4372 6561 7465 2075 6e69 7175     #Create uniqu
-0001eb20: 6520 6e61 6d65 6420 7069 7065 7320 746f  e named pipes to
-0001eb30: 2072 6561 6420 616e 6420 7772 6974 6520   read and write 
-0001eb40: 746f 0d0a 2020 2020 2020 2020 2020 2020  to..            
-0001eb50: 2020 2020 7365 6375 7269 7479 5f66 696c      security_fil
-0001eb60: 6570 6174 683d 2072 275c 5c2e 5c70 6970  epath= r'\\.\pip
-0001eb70: 655c 7b7d 272e 666f 726d 6174 2875 7569  e\{}'.format(uui
-0001eb80: 642e 7575 6964 3428 2929 0d0a 0d0a 2020  d.uuid4())....  
-0001eb90: 2020 2020 2020 2020 2020 6c6f 672e 7665            log.ve
-0001eba0: 7262 6f73 6528 2753 796e 6368 726f 6e69  rbose('Synchroni
-0001ebb0: 7369 6e67 2045 6c65 6d65 6e74 2053 6563  sing Element Sec
-0001ebc0: 7572 6974 7920 666f 7220 6469 6d65 6e73  urity for dimens
-0001ebd0: 696f 6e5b 7b7d 5d27 2e66 6f72 6d61 7428  ion[{}]'.format(
-0001ebe0: 7365 6c66 2e64 696d 656e 7369 6f6e 2e69  self.dimension.i
-0001ebf0: 6e64 6578 2929 0d0a 0d0a 2020 2020 2020  ndex))....      
-0001ec00: 2020 2020 2020 2374 6869 7320 6973 2077        #this is w
-0001ec10: 6861 7420 7765 2077 696c 6c20 6265 2073  hat we will be s
-0001ec20: 656e 6469 6e67 2074 6f20 496d 706f 7274  ending to Import
-0001ec30: 6572 2028 6173 2074 7376 2920 2d20 6d61  er (as tsv) - ma
-0001ec40: 7962 6520 696e 2061 2066 696c 652c 206d  ybe in a file, m
-0001ec50: 6179 6265 2069 6e20 6120 7069 7065 0d0a  aybe in a pipe..
-0001ec60: 2020 2020 2020 2020 2020 2020 6465 6620              def 
-0001ec70: 5f79 6965 6c64 5f73 6563 7572 6974 795f  _yield_security_
-0001ec80: 7374 7269 6e67 7328 293a 0d0a 2020 2020  strings():..    
-0001ec90: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001eca0: 656c 656d 656e 7420 696e 2073 656c 662e  element in self.
-0001ecb0: 7661 6c75 6573 2829 3a0d 0a20 2020 2020  values():..     
-0001ecc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001ecd0: 6620 656c 656d 656e 742e 7365 6375 7269  f element.securi
-0001ece0: 7479 2e65 6469 7465 643a 0d0a 0d0a 2020  ty.edited:....  
-0001ecf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed00: 2020 2020 2020 7969 656c 6420 7365 6c66        yield self
-0001ed10: 2e64 696d 656e 7369 6f6e 2e6c 6f6e 676e  .dimension.longn
-0001ed20: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
-0001ed30: 2020 2020 2020 2020 2020 2020 2079 6965               yie
-0001ed40: 6c64 2027 5c74 270d 0a20 2020 2020 2020  ld '\t'..       
-0001ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed60: 2079 6965 6c64 2065 6c65 6d65 6e74 2e73   yield element.s
-0001ed70: 686f 7274 6e61 6d65 0d0a 2020 2020 2020  hortname..      
-0001ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed90: 2020 7969 656c 6420 275c 7427 0d0a 2020    yield '\t'..  
-0001eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001edb0: 2020 2020 2020 7969 656c 6420 274d 6f64        yield 'Mod
-0001edc0: 6966 6965 7273 270d 0a20 2020 2020 2020  ifiers'..       
+0001e940: 2020 6966 2065 2e77 696e 6572 726f 7220    if e.winerror 
+0001e950: 3d3d 2031 3233 3a0d 0a20 2020 2020 2020  == 123:..       
+0001e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e970: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0001e980: 4572 726f 7228 2744 6972 6563 746f 7279  Error('Directory
+0001e990: 2022 7b7d 2220 6861 7320 616e 2069 6e76   "{}" has an inv
+0001e9a0: 616c 6964 206e 616d 652e 2044 6964 2079  alid name. Did y
+0001e9b0: 6f75 2070 6173 7320 6120 7369 7465 5f6c  ou pass a site_l
+0001e9c0: 6f63 6174 6f72 2070 6174 6820 227b 7d22  ocator path "{}"
+0001e9d0: 2077 6974 686f 7574 2064 6f75 626c 652d   without double-
+0001e9e0: 6573 6361 7069 6e67 2062 6163 6b73 6c61  escaping backsla
+0001e9f0: 7368 6573 206f 7220 7072 6566 6978 696e  shes or prefixin
+0001ea00: 6720 7468 6520 7374 7269 6e67 2077 6974  g the string wit
+0001ea10: 6820 616e 2022 7222 2066 6f72 2072 6177  h an "r" for raw
+0001ea20: 3f27 2e66 6f72 6d61 7428 6469 722c 7265  ?'.format(dir,re
+0001ea30: 7072 2873 6974 655f 6c6f 6361 746f 7229  pr(site_locator)
+0001ea40: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0001ea50: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001ea60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001ea70: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001ea80: 6169 7365 2065 0d0a 2020 2020 2020 2020  aise e..        
+0001ea90: 2020 2020 2020 2020 7365 6375 7269 7479          security
+0001eaa0: 5f66 696c 6570 6174 683d 6f73 2e70 6174  _filepath=os.pat
+0001eab0: 682e 6a6f 696e 2873 656c 662e 6469 6d65  h.join(self.dime
+0001eac0: 6e73 696f 6e2e 7369 7465 2e5f 656d 706f  nsion.site._empo
+0001ead0: 7765 725f 6469 6d5f 696d 706f 7274 5f64  wer_dim_import_d
+0001eae0: 6972 2c27 4469 6d65 6e73 696f 6e5f 272b  ir,'Dimension_'+
+0001eaf0: 7374 7228 7365 6c66 2e64 696d 656e 7369  str(self.dimensi
+0001eb00: 6f6e 2e69 6e64 6578 292b 275f 5365 6375  on.index)+'_Secu
+0001eb10: 7269 7479 2e74 7376 2729 0d0a 2020 2020  rity.tsv')..    
+0001eb20: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0001eb30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001eb40: 4372 6561 7465 2075 6e69 7175 6520 6e61  Create unique na
+0001eb50: 6d65 6420 7069 7065 7320 746f 2072 6561  med pipes to rea
+0001eb60: 6420 616e 6420 7772 6974 6520 746f 0d0a  d and write to..
+0001eb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eb80: 7365 6375 7269 7479 5f66 696c 6570 6174  security_filepat
+0001eb90: 683d 2072 275c 5c2e 5c70 6970 655c 7b7d  h= r'\\.\pipe\{}
+0001eba0: 272e 666f 726d 6174 2875 7569 642e 7575  '.format(uuid.uu
+0001ebb0: 6964 3428 2929 0d0a 0d0a 2020 2020 2020  id4())....      
+0001ebc0: 2020 2020 2020 6c6f 672e 7665 7262 6f73        log.verbos
+0001ebd0: 6528 2753 796e 6368 726f 6e69 7369 6e67  e('Synchronising
+0001ebe0: 2045 6c65 6d65 6e74 2053 6563 7572 6974   Element Securit
+0001ebf0: 7920 666f 7220 6469 6d65 6e73 696f 6e5b  y for dimension[
+0001ec00: 7b7d 5d27 2e66 6f72 6d61 7428 7365 6c66  {}]'.format(self
+0001ec10: 2e64 696d 656e 7369 6f6e 2e69 6e64 6578  .dimension.index
+0001ec20: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
+0001ec30: 2020 2374 6869 7320 6973 2077 6861 7420    #this is what 
+0001ec40: 7765 2077 696c 6c20 6265 2073 656e 6469  we will be sendi
+0001ec50: 6e67 2074 6f20 496d 706f 7274 6572 2028  ng to Importer (
+0001ec60: 6173 2074 7376 2920 2d20 6d61 7962 6520  as tsv) - maybe 
+0001ec70: 696e 2061 2066 696c 652c 206d 6179 6265  in a file, maybe
+0001ec80: 2069 6e20 6120 7069 7065 0d0a 2020 2020   in a pipe..    
+0001ec90: 2020 2020 2020 2020 6465 6620 5f79 6965          def _yie
+0001eca0: 6c64 5f73 6563 7572 6974 795f 7374 7269  ld_security_stri
+0001ecb0: 6e67 7328 293a 0d0a 2020 2020 2020 2020  ngs():..        
+0001ecc0: 2020 2020 2020 2020 666f 7220 656c 656d          for elem
+0001ecd0: 656e 7420 696e 2073 656c 662e 7661 6c75  ent in self.valu
+0001ece0: 6573 2829 3a0d 0a20 2020 2020 2020 2020  es():..         
+0001ecf0: 2020 2020 2020 2020 2020 2069 6620 656c             if el
+0001ed00: 656d 656e 742e 7365 6375 7269 7479 2e65  ement.security.e
+0001ed10: 6469 7465 643a 0d0a 0d0a 2020 2020 2020  dited:....      
+0001ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed30: 2020 7969 656c 6420 7365 6c66 2e64 696d    yield self.dim
+0001ed40: 656e 7369 6f6e 2e6c 6f6e 676e 616d 650d  ension.longname.
+0001ed50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ed60: 2020 2020 2020 2020 2079 6965 6c64 2027           yield '
+0001ed70: 5c74 270d 0a20 2020 2020 2020 2020 2020  \t'..           
+0001ed80: 2020 2020 2020 2020 2020 2020 2079 6965               yie
+0001ed90: 6c64 2065 6c65 6d65 6e74 2e73 686f 7274  ld element.short
+0001eda0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+0001edb0: 2020 2020 2020 2020 2020 2020 2020 7969                yi
+0001edc0: 656c 6420 275c 7427 0d0a 2020 2020 2020  eld '\t'..      
 0001edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ede0: 2079 6965 6c64 2027 5c74 270d 0a20 2020   yield '\t'..   
-0001edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee00: 2020 2020 2069 6620 6c65 6e28 656c 656d       if len(elem
-0001ee10: 656e 742e 7365 6375 7269 7479 2e6d 6f64  ent.security.mod
-0001ee20: 6966 6965 7273 2920 3d3d 2030 3a0d 0a20  ifiers) == 0:.. 
-0001ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee40: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-0001ee50: 2027 436c 6561 7227 0d0a 2020 2020 2020   'Clear'..      
+0001ede0: 2020 7969 656c 6420 274d 6f64 6966 6965    yield 'Modifie
+0001edf0: 7273 270d 0a20 2020 2020 2020 2020 2020  rs'..           
+0001ee00: 2020 2020 2020 2020 2020 2020 2079 6965               yie
+0001ee10: 6c64 2027 5c74 270d 0a20 2020 2020 2020  ld '\t'..       
+0001ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ee30: 2069 6620 6c65 6e28 656c 656d 656e 742e   if len(element.
+0001ee40: 7365 6375 7269 7479 2e6d 6f64 6966 6965  security.modifie
+0001ee50: 7273 2920 3d3d 2030 3a0d 0a20 2020 2020  rs) == 0:..     
 0001ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee70: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0001ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee90: 2020 2020 2079 6965 6c64 2027 5365 7427       yield 'Set'
-0001eea0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001eeb0: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
-0001eec0: 275c 7427 0d0a 2020 2020 2020 2020 2020  '\t'..          
-0001eed0: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-0001eee0: 656c 6420 272b 272e 6a6f 696e 2865 6c65  eld '+'.join(ele
-0001eef0: 6d65 6e74 2e73 6563 7572 6974 792e 6d6f  ment.security.mo
-0001ef00: 6469 6669 6572 7329 0d0a 0d0a 2020 2020  difiers)....    
-0001ef10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef20: 2020 2020 7969 656c 6420 275c 7427 0d0a      yield '\t'..
-0001ef30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef40: 2020 2020 2020 2020 7969 656c 6420 2756          yield 'V
-0001ef50: 6965 7765 7273 270d 0a20 2020 2020 2020  iewers'..       
+0001ee70: 2020 2020 2020 2079 6965 6c64 2027 436c         yield 'Cl
+0001ee80: 6561 7227 0d0a 2020 2020 2020 2020 2020  ear'..          
+0001ee90: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0001eea0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0001eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eec0: 2079 6965 6c64 2027 5365 7427 0d0a 2020   yield 'Set'..  
+0001eed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eee0: 2020 2020 2020 7969 656c 6420 275c 7427        yield '\t'
+0001eef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001ef00: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
+0001ef10: 272b 272e 6a6f 696e 2865 6c65 6d65 6e74  '+'.join(element
+0001ef20: 2e73 6563 7572 6974 792e 6d6f 6469 6669  .security.modifi
+0001ef30: 6572 7329 0d0a 0d0a 2020 2020 2020 2020  ers)....        
+0001ef40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ef50: 7969 656c 6420 275c 7427 0d0a 2020 2020  yield '\t'..    
 0001ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef70: 2079 6965 6c64 2027 5c74 270d 0a20 2020   yield '\t'..   
-0001ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef90: 2020 2020 2069 6620 6c65 6e28 656c 656d       if len(elem
-0001efa0: 656e 742e 7365 6375 7269 7479 2e76 6965  ent.security.vie
-0001efb0: 7765 7273 2920 3d3d 2030 3a0d 0a20 2020  wers) == 0:..   
-0001efc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001efd0: 2020 2020 2020 2020 2079 6965 6c64 2027           yield '
-0001efe0: 436c 6561 7227 0d0a 2020 2020 2020 2020  Clear'..        
+0001ef70: 2020 2020 7969 656c 6420 2756 6965 7765      yield 'Viewe
+0001ef80: 7273 270d 0a20 2020 2020 2020 2020 2020  rs'..           
+0001ef90: 2020 2020 2020 2020 2020 2020 2079 6965               yie
+0001efa0: 6c64 2027 5c74 270d 0a20 2020 2020 2020  ld '\t'..       
+0001efb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001efc0: 2069 6620 6c65 6e28 656c 656d 656e 742e   if len(element.
+0001efd0: 7365 6375 7269 7479 2e76 6965 7765 7273  security.viewers
+0001efe0: 2920 3d3d 2030 3a0d 0a20 2020 2020 2020  ) == 0:..       
 0001eff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f000: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0001f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f020: 2020 2079 6965 6c64 2027 5365 7427 0d0a     yield 'Set'..
-0001f030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f040: 2020 2020 2020 2020 7969 656c 6420 275c          yield '\
-0001f050: 7427 0d0a 2020 2020 2020 2020 2020 2020  t'..            
-0001f060: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
-0001f070: 6420 272b 272e 6a6f 696e 2865 6c65 6d65  d '+'.join(eleme
-0001f080: 6e74 2e73 6563 7572 6974 792e 7669 6577  nt.security.view
-0001f090: 6572 7329 0d0a 0d0a 2020 2020 2020 2020  ers)....        
-0001f0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f0b0: 7969 656c 6420 275c 7427 0d0a 2020 2020  yield '\t'..    
-0001f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f0d0: 2020 2020 7969 656c 6420 2744 6174 6120      yield 'Data 
-0001f0e0: 5669 6577 6572 7327 0d0a 2020 2020 2020  Viewers'..      
+0001f000: 2020 2020 2079 6965 6c64 2027 436c 6561       yield 'Clea
+0001f010: 7227 0d0a 2020 2020 2020 2020 2020 2020  r'..            
+0001f020: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0001f030: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001f040: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+0001f050: 6965 6c64 2027 5365 7427 0d0a 2020 2020  ield 'Set'..    
+0001f060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f070: 2020 2020 7969 656c 6420 275c 7427 0d0a      yield '\t'..
+0001f080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f090: 2020 2020 2020 2020 7969 656c 6420 272b          yield '+
+0001f0a0: 272e 6a6f 696e 2865 6c65 6d65 6e74 2e73  '.join(element.s
+0001f0b0: 6563 7572 6974 792e 7669 6577 6572 7329  ecurity.viewers)
+0001f0c0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0001f0d0: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+0001f0e0: 6420 275c 7427 0d0a 2020 2020 2020 2020  d '\t'..        
 0001f0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f100: 2020 7969 656c 6420 275c 7427 0d0a 2020    yield '\t'..  
-0001f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f120: 2020 2020 2020 6966 206c 656e 2865 6c65        if len(ele
-0001f130: 6d65 6e74 2e73 6563 7572 6974 792e 6461  ment.security.da
-0001f140: 7461 5f76 6965 7765 7273 2920 3d3d 2030  ta_viewers) == 0
-0001f150: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0001f160: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-0001f170: 6965 6c64 2027 436c 6561 7227 0d0a 2020  ield 'Clear'..  
+0001f100: 7969 656c 6420 2744 6174 6120 5669 6577  yield 'Data View
+0001f110: 6572 7327 0d0a 2020 2020 2020 2020 2020  ers'..          
+0001f120: 2020 2020 2020 2020 2020 2020 2020 7969                yi
+0001f130: 656c 6420 275c 7427 0d0a 2020 2020 2020  eld '\t'..      
+0001f140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f150: 2020 6966 206c 656e 2865 6c65 6d65 6e74    if len(element
+0001f160: 2e73 6563 7572 6974 792e 6461 7461 5f76  .security.data_v
+0001f170: 6965 7765 7273 2920 3d3d 2030 3a0d 0a20  iewers) == 0:.. 
 0001f180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f190: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-0001f1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f1b0: 2020 2020 2020 2020 2079 6965 6c64 2027           yield '
-0001f1c0: 5365 7427 0d0a 2020 2020 2020 2020 2020  Set'..          
-0001f1d0: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-0001f1e0: 656c 6420 275c 7427 0d0a 2020 2020 2020  eld '\t'..      
-0001f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f200: 2020 7969 656c 6420 272b 272e 6a6f 696e    yield '+'.join
-0001f210: 2865 6c65 6d65 6e74 2e73 6563 7572 6974  (element.securit
-0001f220: 792e 6461 7461 5f76 6965 7765 7273 290d  y.data_viewers).
-0001f230: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0001f240: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-0001f250: 2027 5c6e 270d 0a0d 0a20 2020 2020 2020   '\n'....       
-0001f260: 2020 2020 2023 5275 6e20 7468 6520 7265       #Run the re
-0001f270: 7175 6973 6974 6520 696d 706f 7274 6572  quisite importer
-0001f280: 2063 6f6d 6d61 6e64 730d 0a0d 0a20 2020   commands....   
-0001f290: 2020 2020 2020 2020 2063 6f6d 6d61 6e64           command
-0001f2a0: 5f6c 6973 7420 3d20 7365 6c66 2e64 696d  _list = self.dim
-0001f2b0: 656e 7369 6f6e 2e73 6974 652e 5f6c 6f67  ension.site._log
-0001f2c0: 6f6e 5f70 6172 616d 6574 6572 5f69 6d70  on_parameter_imp
-0001f2d0: 6f72 7465 725f 636f 6d6d 616e 6473 202b  orter_commands +
-0001f2e0: 205c 0d0a 2020 2020 2020 2020 2020 2020   \..            
-0001f2f0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-0001f300: 276c 6f61 642d 6669 6c65 2d74 7376 2022  'load-file-tsv "
-0001f310: 2720 2020 2020 2020 2020 2020 2020 2020  '               
-0001f320: 2020 2020 2b20 7365 6375 7269 7479 5f66      + security_f
-0001f330: 696c 6570 6174 6820 2b20 2722 270d 0a20  ilepath + '"'.. 
+0001f190: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+0001f1a0: 2027 436c 6561 7227 0d0a 2020 2020 2020   'Clear'..      
+0001f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f1c0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0001f1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f1e0: 2020 2020 2079 6965 6c64 2027 5365 7427       yield 'Set'
+0001f1f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001f200: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
+0001f210: 275c 7427 0d0a 2020 2020 2020 2020 2020  '\t'..          
+0001f220: 2020 2020 2020 2020 2020 2020 2020 7969                yi
+0001f230: 656c 6420 272b 272e 6a6f 696e 2865 6c65  eld '+'.join(ele
+0001f240: 6d65 6e74 2e73 6563 7572 6974 792e 6461  ment.security.da
+0001f250: 7461 5f76 6965 7765 7273 290d 0a0d 0a20  ta_viewers).... 
+0001f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f270: 2020 2020 2020 2079 6965 6c64 2027 5c6e         yield '\n
+0001f280: 270d 0a0d 0a20 2020 2020 2020 2020 2020  '....           
+0001f290: 2023 5275 6e20 7468 6520 7265 7175 6973   #Run the requis
+0001f2a0: 6974 6520 696d 706f 7274 6572 2063 6f6d  ite importer com
+0001f2b0: 6d61 6e64 730d 0a0d 0a20 2020 2020 2020  mands....       
+0001f2c0: 2020 2020 2063 6f6d 6d61 6e64 5f6c 6973       command_lis
+0001f2d0: 7420 3d20 7365 6c66 2e64 696d 656e 7369  t = self.dimensi
+0001f2e0: 6f6e 2e73 6974 652e 5f6c 6f67 6f6e 5f70  on.site._logon_p
+0001f2f0: 6172 616d 6574 6572 5f69 6d70 6f72 7465  arameter_importe
+0001f300: 725f 636f 6d6d 616e 6473 202b 205c 0d0a  r_commands + \..
+0001f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f320: 2020 2020 2020 2020 2020 205b 276c 6f61             ['loa
+0001f330: 642d 6669 6c65 2d74 7376 2022 2720 2020  d-file-tsv "'   
 0001f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f350: 2020 2020 2020 2020 2020 2c27 656d 706f            ,'empo
-0001f360: 7765 722d 696d 706f 7274 2d73 6563 7572  wer-import-secur
-0001f370: 6974 792d 7365 7474 696e 6773 2022 247b  ity-settings "${
-0001f380: 7369 7465 7d22 2022 247b 7573 6572 7d22  site}" "${user}"
-0001f390: 2022 247b 7061 7373 776f 7264 7d22 270d   "${password}"'.
-0001f3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f3b0: 2020 2020 2020 2020 2020 2020 5d0d 0a0d              ]...
-0001f3c0: 0a20 2020 2020 2020 2020 2020 2023 496e  .            #In
-0001f3d0: 2064 6562 7567 206d 6f64 6520 7772 6974   debug mode writ
-0001f3e0: 6520 7468 6520 6461 7461 2069 6e74 6f20  e the data into 
-0001f3f0: 6120 7473 7620 6669 6c65 2061 6e64 2072  a tsv file and r
-0001f400: 6561 6420 6974 2077 6974 6820 496d 706f  ead it with Impo
-0001f410: 7274 6572 2c20 7075 7474 696e 6720 7468  rter, putting th
-0001f420: 6520 7374 7275 6374 7572 6520 696e 746f  e structure into
-0001f430: 2045 6d70 6f77 6572 0d0a 2020 2020 2020   Empower..      
-0001f440: 2020 2020 2020 6966 2064 6562 7567 3a0d        if debug:.
-0001f450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f460: 2023 4e6f 6e20 7469 6d65 2064 696d 656e   #Non time dimen
-0001f470: 7369 6f6e 7320 6d61 7920 6861 7665 2066  sions may have f
-0001f480: 6965 6c64 7320 2d20 7772 6974 6520 7468  ields - write th
-0001f490: 6520 7374 616e 6461 7264 2061 6e64 206e  e standard and n
-0001f4a0: 6f6e 2073 7461 6e64 6172 6420 6669 656c  on standard fiel
-0001f4b0: 6473 2074 6f20 6669 6c65 2061 6e64 2069  ds to file and i
-0001f4c0: 6d70 6f72 7420 7468 656d 0d0a 2020 2020  mport them..    
-0001f4d0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0001f4e0: 206f 7065 6e28 7365 6375 7269 7479 5f66   open(security_f
-0001f4f0: 696c 6570 6174 682c 2777 272c 656e 636f  ilepath,'w',enco
-0001f500: 6469 6e67 3d27 7574 6638 2729 2061 7320  ding='utf8') as 
-0001f510: 7461 7267 6574 5f66 696c 653a 0d0a 2020  target_file:..  
-0001f520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f530: 2020 666f 7220 7320 696e 205f 7969 656c    for s in _yiel
-0001f540: 645f 7365 6375 7269 7479 5f73 7472 696e  d_security_strin
-0001f550: 6773 2829 3a0d 0a20 2020 2020 2020 2020  gs():..         
-0001f560: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001f570: 6172 6765 745f 6669 6c65 2e77 7269 7465  arget_file.write
-0001f580: 2873 290d 0a0d 0a20 2020 2020 2020 2020  (s)....         
-0001f590: 2020 2020 2020 206c 6c75 2e72 756e 5f73         llu.run_s
-0001f5a0: 696e 676c 655f 6f75 7470 7574 5f69 6d70  ingle_output_imp
-0001f5b0: 6f72 7465 725f 636f 6d6d 616e 6473 2863  orter_commands(c
-0001f5c0: 6f6d 6d61 6e64 5f6c 6973 742c 656d 706f  ommand_list,empo
-0001f5d0: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
-0001f5e0: 6375 7461 626c 653d 7365 6c66 2e64 696d  cutable=self.dim
-0001f5f0: 656e 7369 6f6e 2e73 6974 652e 656d 706f  ension.site.empo
-0001f600: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
-0001f610: 6375 7461 626c 6529 0d0a 0d0a 2020 2020  cutable)....    
-0001f620: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0001f630: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001f640: 496e 2027 6e6f 726d 616c 2720 6d6f 6465  In 'normal' mode
-0001f650: 2064 6f20 6120 6d65 7272 7920 6461 6e63   do a merry danc
-0001f660: 6520 7769 7468 2057 696e 646f 7773 206e  e with Windows n
-0001f670: 616d 6564 2070 6970 6573 2e20 5468 6973  amed pipes. This
-0001f680: 2061 766f 6964 7320 7772 6974 696e 6720   avoids writing 
-0001f690: 7468 6520 6461 7461 2074 6f20 6669 6c65  the data to file
-0001f6a0: 2066 6f72 2073 6563 7572 6974 7920 616e   for security an
-0001f6b0: 6420 7072 6163 7469 6361 6c69 7479 2072  d practicality r
-0001f6c0: 6561 736f 6e73 0d0a 2020 2020 2020 2020  easons..        
-0001f6d0: 2020 2020 2020 2020 2373 6563 7572 6974          #securit
-0001f6e0: 795f 6669 6c65 7061 7468 2069 7320 7468  y_filepath is th
-0001f6f0: 6520 6e61 6d65 206f 6620 7468 6520 6e61  e name of the na
-0001f700: 6d65 6420 7069 7065 2065 2e67 2e20 5c5c  med pipe e.g. \\
-0001f710: 2e5c 7069 7065 5c39 6463 6366 6130 382d  .\pipe\9dccfa08-
-0001f720: 3430 6331 2d34 3566 352d 3865 3065 2d66  40c1-45f5-8e0e-f
-0001f730: 3634 6331 3835 3032 6263 640d 0a20 2020  64c18502bcd..   
-0001f740: 2020 2020 2020 2020 2020 2020 2023 5468               #Th
-0001f750: 6520 6d65 7272 7920 6461 6e63 6520 6d65  e merry dance me
-0001f760: 616e 7320 7374 6172 7469 6e67 2049 6d70  ans starting Imp
-0001f770: 6f72 7465 722c 2072 6566 6572 656e 6369  orter, referenci
-0001f780: 6e67 2074 6865 2070 6970 652c 206f 7065  ng the pipe, ope
-0001f790: 6e69 6e67 2074 6865 2070 6970 6520 6265  ning the pipe be
-0001f7a0: 666f 7265 2049 6d70 6f72 7465 7220 6973  fore Importer is
-0001f7b0: 2070 726f 7065 726c 7920 7374 6172 7465   properly starte
-0001f7c0: 640d 0a20 2020 2020 2020 2020 2020 2020  d..             
-0001f7d0: 2020 2023 7365 7474 696e 6720 7570 2074     #setting up t
-0001f7e0: 6865 206e 616d 6564 2070 6970 6520 6f6e  he named pipe on
-0001f7f0: 2074 6869 7320 7468 7265 6164 2c20 616e   this thread, an
-0001f800: 6420 7772 6974 696e 6720 746f 2069 7420  d writing to it 
-0001f810: 2861 7320 736f 6f6e 2061 7320 496d 706f  (as soon as Impo
-0001f820: 7274 6572 2063 6f6e 6e65 6374 7320 6174  rter connects at
-0001f830: 2069 7473 2065 6e64 290d 0a20 2020 2020   its end)..     
-0001f840: 2020 2020 2020 2020 2020 2023 5468 6520             #The 
-0001f850: 6469 6666 6963 756c 7479 2c20 6973 2074  difficulty, is t
-0001f860: 6861 7420 7765 2068 6176 6520 746f 2070  hat we have to p
-0001f870: 6173 7320 7468 6520 6e61 6d65 206f 6620  ass the name of 
-0001f880: 7468 6520 7069 7065 2074 6f20 496d 706f  the pipe to Impo
-0001f890: 7274 6572 2c20 616e 6420 7265 6c79 206f  rter, and rely o
-0001f8a0: 6e20 7468 6520 6661 6374 2074 6861 7420  n the fact that 
-0001f8b0: 6974 2077 6f6e 2774 2068 6176 6520 7469  it won't have ti
-0001f8c0: 6d65 2074 6f20 6f70 656e 2069 740d 0a20  me to open it.. 
-0001f8d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001f8e0: 6265 666f 7265 2077 6520 6861 7665 2063  before we have c
-0001f8f0: 7265 6174 6564 2069 742e 2042 7574 2077  reated it. But w
-0001f900: 6520 7769 6c6c 2062 6c6f 636b 206f 6e20  e will block on 
-0001f910: 6f75 7220 7369 6465 2075 6e74 696c 2049  our side until I
-0001f920: 6d70 6f72 7465 7220 6861 7320 636f 6e6e  mporter has conn
-0001f930: 6563 7465 640d 0a20 2020 2020 2020 2020  ected..         
-0001f940: 2020 2020 2020 2070 726f 6320 3d20 4e6f         proc = No
-0001f950: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0001f960: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-0001f970: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0001f980: 6f63 203d 206c 6c75 2e73 7461 7274 5f6e  oc = llu.start_n
-0001f990: 6f5f 6f75 7470 7574 5f69 6d70 6f72 7465  o_output_importe
-0001f9a0: 725f 636f 6d6d 616e 6473 2863 6f6d 6d61  r_commands(comma
-0001f9b0: 6e64 5f6c 6973 742c 656d 706f 7765 725f  nd_list,empower_
-0001f9c0: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
-0001f9d0: 626c 653d 7365 6c66 2e64 696d 656e 7369  ble=self.dimensi
-0001f9e0: 6f6e 2e73 6974 652e 656d 706f 7765 725f  on.site.empower_
-0001f9f0: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
-0001fa00: 626c 6529 0d0a 0d0a 2020 2020 2020 2020  ble)....        
-0001fa10: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0001fa20: 206c 6c75 2e6f 7574 626f 756e 645f 7069   llu.outbound_pi
-0001fa30: 7065 2873 6563 7572 6974 795f 6669 6c65  pe(security_file
-0001fa40: 7061 7468 2920 6173 2070 6970 653a 0d0a  path) as pipe:..
-0001fa50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001fa60: 2020 2020 2020 2020 2020 666f 7220 7320            for s 
-0001fa70: 696e 205f 7969 656c 645f 7365 6375 7269  in _yield_securi
-0001fa80: 7479 5f73 7472 696e 6773 2829 3a0d 0a20  ty_strings():.. 
-0001fa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001faa0: 2020 2020 2020 2020 2020 2077 696e 3332             win32
-0001fab0: 6669 6c65 2e57 7269 7465 4669 6c65 2870  file.WriteFile(p
-0001fac0: 6970 652c 2073 7472 2e65 6e63 6f64 6528  ipe, str.encode(
-0001fad0: 7329 290d 0a0d 0a20 2020 2020 2020 2020  s))....         
-0001fae0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001faf0: 6f67 2e64 6562 7567 2822 5069 7065 207b  og.debug("Pipe {
-0001fb00: 7d20 6669 6e69 7368 6564 2077 7269 7469  } finished writi
-0001fb10: 6e67 222e 666f 726d 6174 2873 6563 7572  ng".format(secur
-0001fb20: 6974 795f 6669 6c65 7061 7468 2929 0d0a  ity_filepath))..
-0001fb30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001fb40: 2020 6669 6e61 6c6c 793a 0d0a 0d0a 2020    finally:....  
-0001fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb60: 2020 2343 6865 636b 2069 6620 496d 706f    #Check if Impo
-0001fb70: 7274 6572 2072 6574 7572 6e65 6420 616e  rter returned an
-0001fb80: 2065 7272 6f72 2061 6e64 2072 6169 7365   error and raise
-0001fb90: 2069 7420 6173 2061 2070 7974 686f 6e20   it as a python 
-0001fba0: 6966 2069 7420 6469 640d 0a20 2020 2020  if it did..     
-0001fbb0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001fbc0: 6c75 2e63 6f6d 706c 6574 655f 6e6f 5f6f  lu.complete_no_o
-0001fbd0: 7574 7075 745f 696d 706f 7274 6572 5f70  utput_importer_p
-0001fbe0: 726f 6365 7373 2870 726f 6329 0d0a 0d0a  rocess(proc)....
-0001fbf0: 2020 2020 2020 2020 2323 2320 5365 7420          ### Set 
-0001fc00: 666c 6167 2020 746f 2067 6574 2073 6563  flag  to get sec
-0001fc10: 7572 6974 7920 746f 2063 6f6d 706c 6574  urity to complet
-0001fc20: 656c 7920 7265 7379 6e63 6820 6e65 7874  ely resynch next
-0001fc30: 2074 696d 650d 0a20 2020 2020 2020 2066   time..        f
-0001fc40: 6f72 2065 6c65 6d65 6e74 2069 6e20 7365  or element in se
-0001fc50: 6c66 2e76 616c 7565 7328 293a 0d0a 2020  lf.values():..  
-0001fc60: 2020 2020 2020 2020 2020 6966 2065 6c65            if ele
-0001fc70: 6d65 6e74 2e5f 7365 6375 7269 7479 2069  ment._security i
-0001fc80: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-0001fc90: 2020 2020 2020 2020 2020 2020 2065 6c65               ele
-0001fca0: 6d65 6e74 2e5f 7365 6375 7269 7479 2e5f  ment._security._
-0001fcb0: 7669 6577 6572 7320 3d20 4e6f 6e65 0d0a  viewers = None..
-0001fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fcd0: 656c 656d 656e 742e 5f73 6563 7572 6974  element._securit
-0001fce0: 792e 5f6d 6f64 6966 6965 7273 203d 204e  y._modifiers = N
-0001fcf0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-0001fd00: 2020 2020 2065 6c65 6d65 6e74 2e5f 7365       element._se
-0001fd10: 6375 7269 7479 2e5f 6461 7461 5f76 6965  curity._data_vie
-0001fd20: 7765 7273 203d 204e 6f6e 650d 0a20 2020  wers = None..   
-0001fd30: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
-0001fd40: 2e5f 7365 6375 7269 7479 203d 204e 6f6e  ._security = Non
-0001fd50: 650d 0a0d 0a20 2020 2020 2020 2073 656c  e....        sel
-0001fd60: 662e 5f73 6563 7572 6974 795f 7265 6164  f._security_read
-0001fd70: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-0001fd80: 2020 2365 6469 7473 2068 6176 6520 6265    #edits have be
-0001fd90: 656e 2073 796e 6368 6564 0d0a 2020 2020  en synched..    
-0001fda0: 2020 2020 7365 6c66 2e5f 5f73 6563 7572      self.__secur
-0001fdb0: 6974 795f 6564 6974 6564 203d 2046 616c  ity_edited = Fal
-0001fdc0: 7365 0d0a 2020 2020 2020 2020 2370 7269  se..        #pri
-0001fdd0: 6e74 2873 656c 6629 0d0a 2020 2020 2020  nt(self)..      
-0001fde0: 2020 2370 7269 6e74 2827 3135 3237 3a20    #print('1527: 
-0001fdf0: 272c 7365 6c66 2e5f 5f73 6563 7572 6974  ',self.__securit
-0001fe00: 795f 6564 6974 6564 2029 0d0a 0d0a 2020  y_edited )....  
-0001fe10: 2020 2020 2020 2323 2323 2323 2323 2323        ##########
-0001fe20: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001fe30: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0001fe40: 2323 2323 2323 2323 2323 0d0a 0d0a 2020  ##########....  
-0001fe50: 2020 2020 2020 2363 6865 636b 2069 6620        #check if 
-0001fe60: 616c 6c20 6f66 2074 6865 2065 6c65 6d65  all of the eleme
-0001fe70: 6e74 7320 6172 6520 6d61 7374 6572 6564  nts are mastered
-0001fe80: 202d 2069 6620 736f 2c20 7468 656e 2077   - if so, then w
-0001fe90: 6520 646f 6e27 7420 6e65 6564 2074 6f20  e don't need to 
-0001fea0: 7265 7379 6e63 6820 2862 7920 6c61 7a79  resynch (by lazy
-0001feb0: 206c 6f61 6469 6e67 290d 0a20 2020 2020   loading)..     
-0001fec0: 2020 2066 6f72 2065 6c20 696e 2073 656c     for el in sel
-0001fed0: 662e 7661 6c75 6573 2829 3a0d 0a0d 0a20  f.values():.... 
-0001fee0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001fef0: 7420 656c 2e6d 6173 7465 7265 643a 0d0a  t el.mastered:..
-0001ff00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff10: 2352 6569 6d70 6f72 7420 6c61 7a69 6c79  #Reimport lazily
-0001ff20: 2062 7920 7365 7474 696e 6720 7365 6c66   by setting self
-0001ff30: 2e5f 656c 656d 656e 7473 5f72 6561 6420  ._elements_read 
-0001ff40: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
-0001ff50: 2020 2020 2020 2020 2023 5468 6973 2077           #This w
-0001ff60: 696c 6c20 7065 7273 7561 6465 2074 6865  ill persuade the
-0001ff70: 205f 656c 656d 656e 7473 4765 7474 6572   _elementsGetter
-0001ff80: 2074 6f20 7265 2d65 7870 6f72 7420 616e   to re-export an
-0001ff90: 6420 7265 2d72 6561 6420 7468 6520 6469  d re-read the di
-0001ffa0: 6d65 6e73 696f 6e2c 2072 6174 6865 7220  mension, rather 
-0001ffb0: 7468 616e 2075 7369 6e67 2074 6865 2063  than using the c
-0001ffc0: 6163 6865 6420 7665 7273 696f 6e0d 0a20  ached version.. 
-0001ffd0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001ffe0: 656c 662e 5f65 6c65 6d65 6e74 735f 7265  elf._elements_re
-0001fff0: 6164 203d 2046 616c 7365 0d0a 2020 2020  ad = False..    
-00020000: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00020010: 6b0d 0a0d 0a0d 0a20 2020 2020 2020 2073  k......        s
-00020020: 656c 662e 5f65 6c65 6d65 6e74 5f64 6174  elf._element_dat
-00020030: 6166 7261 6d65 203d 204e 6f6e 650d 0a0d  aframe = None...
-00020040: 0a20 2020 2020 2020 2067 632e 636f 6c6c  .        gc.coll
-00020050: 6563 7428 290d 0a0d 0a63 6c61 7373 205f  ect()....class _
-00020060: 4669 656c 6473 4765 7474 6572 286f 626a  FieldsGetter(obj
-00020070: 6563 7429 3a0d 0a20 2020 2027 2727 446f  ect):..    '''Do
-00020080: 6573 2061 2062 6974 206f 6620 6d61 6769  es a bit of magi
-00020090: 6320 746f 2061 6c6c 6f77 2045 6c65 6d65  c to allow Eleme
-000200a0: 6e74 7320 746f 2068 6176 6520 6120 6669  nts to have a fi
-000200b0: 656c 6473 2061 7474 7269 6275 7465 2074  elds attribute t
-000200c0: 6861 7420 7265 636f 7264 7320 6564 6974  hat records edit
-000200d0: 696e 6720 6368 616e 6765 7327 2727 0d0a  ing changes'''..
-000200e0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-000200f0: 2873 656c 662c 656c 656d 656e 742c 2066  (self,element, f
-00020100: 6965 6c64 732c 696e 6974 6961 6c69 7365  ields,initialise
-00020110: 5f61 735f 6564 6974 6564 293a 0d0a 2020  _as_edited):..  
-00020120: 2020 2020 2020 7365 6c66 2e65 6c65 6d65        self.eleme
-00020130: 6e74 3d65 6c65 6d65 6e74 0d0a 0d0a 2020  nt=element....  
-00020140: 2020 2020 2020 6966 2065 6c65 6d65 6e74        if element
-00020150: 2e64 696d 656e 7369 6f6e 2069 7320 6e6f  .dimension is no
-00020160: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00020170: 2020 2020 2073 656c 662e 5f66 6965 6c64       self._field
-00020180: 733d 636f 6c6c 6563 7469 6f6e 732e 4f72  s=collections.Or
-00020190: 6465 7265 6444 6963 7428 290d 0a20 2020  deredDict()..   
-000201a0: 2020 2020 2020 2020 2066 6f72 206b 2069           for k i
-000201b0: 6e20 656c 656d 656e 742e 6469 6d65 6e73  n element.dimens
-000201c0: 696f 6e2e 5f66 6965 6c64 732e 6b65 7973  ion._fields.keys
-000201d0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-000201e0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-000201f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00020200: 656c 662e 5f66 6965 6c64 735b 6b5d 203d  elf._fields[k] =
-00020210: 2066 6965 6c64 735b 6b5d 0d0a 2020 2020   fields[k]..    
-00020220: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00020230: 7074 204b 6579 4572 726f 723a 0d0a 2020  pt KeyError:..  
-00020240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020250: 2020 7365 6c66 2e5f 6669 656c 6473 5b6b    self._fields[k
-00020260: 5d20 3d20 4e6f 6e65 0d0a 2020 2020 2020  ] = None..      
-00020270: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00020280: 2020 2020 2073 656c 662e 5f66 6965 6c64       self._field
-00020290: 733d 636f 6c6c 6563 7469 6f6e 732e 4f72  s=collections.Or
-000202a0: 6465 7265 6444 6963 7428 6669 656c 6473  deredDict(fields
-000202b0: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
-000202c0: 662e 5f66 6965 6c64 5f65 6469 7473 3d7b  f._field_edits={
-000202d0: 7d0d 0a20 2020 2020 2020 2069 6620 696e  }..        if in
-000202e0: 6974 6961 6c69 7365 5f61 735f 6564 6974  itialise_as_edit
-000202f0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
-00020300: 2066 6f72 206b 2c76 2020 696e 2066 6965   for k,v  in fie
-00020310: 6c64 732e 6974 656d 7328 293a 0d0a 2020  lds.items():..  
-00020320: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00020330: 2076 2069 7320 6e6f 7420 4e6f 6e65 2061   v is not None a
-00020340: 6e64 2076 2021 3d20 2727 3a0d 0a20 2020  nd v != '':..   
-00020350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020360: 2073 656c 662e 5f66 6965 6c64 5f65 6469   self._field_edi
-00020370: 7473 5b6b 5d20 3d20 5472 7565 0d0a 2020  ts[k] = True..  
-00020380: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00020390: 2020 2020 2020 2020 2073 656c 662e 7265           self.re
-000203a0: 7365 745f 6564 6974 5f73 7461 7475 7328  set_edit_status(
-000203b0: 290d 0a0d 0a20 2020 2040 7072 6f70 6572  )....    @proper
-000203c0: 7479 0d0a 2020 2020 6465 6620 6564 6974  ty..    def edit
-000203d0: 6564 2873 656c 6629 3a0d 0a20 2020 2020  ed(self):..     
-000203e0: 2020 2023 5265 7475 726e 2054 7275 6520     #Return True 
-000203f0: 6966 2061 6e79 206f 6620 7468 6520 6669  if any of the fi
-00020400: 656c 6473 2068 6176 6520 6265 656e 2065  elds have been e
-00020410: 6469 7465 640d 0a0d 0a20 2020 2020 2020  dited....       
-00020420: 2066 6f72 2065 6469 7465 6420 696e 2073   for edited in s
-00020430: 656c 662e 5f66 6965 6c64 5f65 6469 7473  elf._field_edits
-00020440: 2e76 616c 7565 7328 293a 0d0a 2020 2020  .values():..    
-00020450: 2020 2020 2020 2020 6966 2065 6469 7465          if edite
-00020460: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
-00020470: 2020 2020 7265 7475 726e 2054 7275 650d      return True.
-00020480: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
-00020490: 6e20 4661 6c73 650d 0a0d 0a20 2020 2040  n False....    @
-000204a0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-000204b0: 6620 6564 6974 6564 5f69 7465 6d73 2873  f edited_items(s
-000204c0: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
-000204d0: 2727 5265 7475 726e 2066 6965 6c64 7320  ''Return fields 
-000204e0: 7768 6963 6820 6861 7665 2062 6565 6e20  which have been 
-000204f0: 6564 6974 6564 2061 7320 6966 2063 616c  edited as if cal
-00020500: 6c69 6e67 2069 7465 6d73 2829 2069 2e65  ling items() i.e
-00020510: 2e20 6b65 792c 2076 616c 7565 2070 6169  . key, value pai
-00020520: 7273 2727 270d 0a0d 0a20 2020 2020 2020  rs'''....       
-00020530: 2066 6f72 206b 2c20 6564 6974 6564 2069   for k, edited i
-00020540: 6e20 7365 6c66 2e5f 6669 656c 645f 6564  n self._field_ed
-00020550: 6974 732e 6974 656d 7328 293a 0d0a 2020  its.items():..  
-00020560: 2020 2020 2020 2020 2020 6966 2065 6469            if edi
-00020570: 7465 643a 0d0a 2020 2020 2020 2020 2020  ted:..          
-00020580: 2020 2020 2020 7969 656c 6420 6b2c 2073        yield k, s
-00020590: 656c 662e 5f66 6965 6c64 735b 6b5d 0d0a  elf._fields[k]..
-000205a0: 0d0a 2020 2020 6465 6620 7265 7365 745f  ..    def reset_
-000205b0: 6564 6974 5f73 7461 7475 7328 7365 6c66  edit_status(self
-000205c0: 293a 0d0a 2020 2020 2020 2020 2353 6574  ):..        #Set
-000205d0: 2065 6469 7420 7374 6174 7573 2062 6163   edit status bac
-000205e0: 6b20 746f 206e 6f20 6564 6974 730d 0a20  k to no edits.. 
-000205f0: 2020 2020 2020 2023 7072 696e 7428 277b         #print('{
-00020600: 7d20 7265 7365 7420 6564 6974 2073 7461  } reset edit sta
-00020610: 7475 7327 2e66 6f72 6d61 7428 7365 6c66  tus'.format(self
-00020620: 2e65 6c65 6d65 6e74 2e70 6879 7369 6429  .element.physid)
-00020630: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00020640: 5f66 6965 6c64 5f65 6469 7473 3d7b 7d0d  _field_edits={}.
-00020650: 0a0d 0a20 2020 2064 6566 205f 5f69 7465  ...    def __ite
-00020660: 725f 5f28 7365 6c66 293a 0d0a 2020 2020  r__(self):..    
-00020670: 2020 2020 7365 6c66 2e5f 6974 6572 6174      self._iterat
-00020680: 6f72 203d 2069 7465 7228 7365 6c66 2e6b  or = iter(self.k
-00020690: 6579 7328 2929 0d0a 2020 2020 2020 2020  eys())..        
-000206a0: 7265 7475 726e 2073 656c 660d 0a0d 0a20  return self.... 
-000206b0: 2020 2064 6566 205f 5f6e 6578 745f 5f28     def __next__(
-000206c0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-000206d0: 7265 7475 726e 206e 6578 7428 7365 6c66  return next(self
-000206e0: 2e5f 6974 6572 6174 6f72 290d 0a0d 0a20  ._iterator).... 
-000206f0: 2020 2064 6566 205f 5f67 6574 6974 656d     def __getitem
-00020700: 5f5f 2873 656c 662c 6974 656d 293a 0d0a  __(self,item):..
-00020710: 2020 2020 2020 2020 2323 4c6f 6164 2074          ##Load t
-00020720: 6865 2045 6c65 6d65 6e74 7320 6966 2077  he Elements if w
-00020730: 6520 6861 7665 6e27 7420 616c 7265 6164  e haven't alread
-00020740: 790d 0a20 2020 2020 2020 2023 6966 206e  y..        #if n
-00020750: 6f74 2073 656c 662e 6469 6d65 6e73 696f  ot self.dimensio
-00020760: 6e2e 5f65 6c65 6d65 6e74 735f 7265 6164  n._elements_read
-00020770: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
-00020780: 7365 6c66 2e5f 6c6f 6164 5f65 6c65 6d65  self._load_eleme
-00020790: 6e74 7328 290d 0a0d 0a20 2020 2020 2020  nts()....       
-000207a0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-000207b0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-000207c0: 6669 656c 6473 5b69 7465 6d5d 0d0a 2020  fields[item]..  
-000207d0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-000207e0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-000207f0: 2020 2020 6966 2073 656c 662e 656c 656d      if self.elem
-00020800: 656e 742e 6469 6d65 6e73 696f 6e20 6973  ent.dimension is
-00020810: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00020820: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-00020830: 7465 6d20 696e 2073 656c 662e 656c 656d  tem in self.elem
-00020840: 656e 742e 6469 6d65 6e73 696f 6e2e 6669  ent.dimension.fi
-00020850: 656c 6473 2e6b 6579 7328 293a 0d0a 2020  elds.keys():..  
-00020860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020870: 2020 2341 6464 204e 6f6e 6520 746f 2073    #Add None to s
-00020880: 6176 6520 7468 6973 206c 6f67 6963 2068  ave this logic h
-00020890: 6170 7065 6e69 6e67 2061 6c6c 206f 6620  appening all of 
-000208a0: 7468 6520 7469 6d65 0d0a 2020 2020 2020  the time..      
-000208b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000208c0: 6c66 2e5f 6669 656c 6473 5b69 7465 6d5d  lf._fields[item]
-000208d0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-000208e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000208f0: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
-00020900: 2020 2020 2020 2352 652d 7261 6973 6520        #Re-raise 
-00020910: 6f6e 6c79 2069 6620 7765 2068 6176 6520  only if we have 
-00020920: 6e6f 7420 7265 7475 726e 6564 2061 204e  not returned a N
-00020930: 6f6e 6520 7661 6c75 6520 2869 2e65 2e20  one value (i.e. 
-00020940: 7261 6973 6520 6966 2074 6865 206b 6579  raise if the key
-00020950: 2069 7320 6e6f 7420 6120 6469 6d65 6e73   is not a dimens
-00020960: 696f 6e20 6669 656c 6429 0d0a 2020 2020  ion field)..    
-00020970: 2020 2020 2020 2020 7261 6973 650d 0a0d          raise...
-00020980: 0a0d 0a20 2020 2064 6566 205f 5f73 6574  ...    def __set
-00020990: 6974 656d 5f5f 2873 656c 662c 206b 6579  item__(self, key
-000209a0: 2c20 6974 656d 293a 0d0a 0d0a 2020 2020  , item):....    
-000209b0: 2020 2020 2369 6620 6e6f 7420 7365 6c66      #if not self
-000209c0: 2e64 696d 656e 7369 6f6e 2e5f 656c 656d  .dimension._elem
-000209d0: 656e 7473 5f72 6561 643a 0d0a 2020 2020  ents_read:..    
-000209e0: 2020 2020 2320 2020 2073 656c 662e 5f6c      #    self._l
-000209f0: 6f61 645f 656c 656d 656e 7473 2829 0d0a  oad_elements()..
-00020a00: 0d0a 2020 2020 2020 2020 2341 6464 2066  ..        #Add f
-00020a10: 6965 6c64 206e 616d 6573 2069 6620 7765  ield names if we
-00020a20: 2068 6176 656e 2774 2072 6561 6420 7468   haven't read th
-00020a30: 6520 6469 6d65 6e73 696f 6e20 7965 740d  e dimension yet.
-00020a40: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00020a50: 7365 6c66 2e65 6c65 6d65 6e74 2e64 696d  self.element.dim
-00020a60: 656e 7369 6f6e 2069 7320 4e6f 6e65 2061  ension is None a
-00020a70: 6e64 206e 6f74 2073 656c 662e 656c 656d  nd not self.elem
-00020a80: 656e 742e 6469 6d65 6e73 696f 6e2e 656c  ent.dimension.el
-00020a90: 656d 656e 7473 2e5f 656c 656d 656e 7473  ements._elements
-00020aa0: 5f72 6561 643a 0d0a 2020 2020 2020 2020  _read:..        
-00020ab0: 2020 2020 7365 6c66 2e65 6c65 6d65 6e74      self.element
-00020ac0: 2e64 696d 656e 7369 6f6e 2e66 6965 6c64  .dimension.field
-00020ad0: 732e 5f61 6464 5f66 6965 6c64 5f6e 616d  s._add_field_nam
-00020ae0: 6528 6b65 792c 6672 6f6d 5f65 6d70 6f77  e(key,from_empow
-00020af0: 6572 3d46 616c 7365 290d 0a0d 0a20 2020  er=False)....   
-00020b00: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00020b10: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00020b20: 6669 656c 6473 5b6b 6579 5d20 3d3d 2069  fields[key] == i
-00020b30: 7465 6d3a 0d0a 2020 2020 2020 2020 2020  tem:..          
-00020b40: 2020 2020 2020 2364 6f6e 2774 2064 6f20        #don't do 
-00020b50: 616e 7974 6869 6e67 2028 696e 636c 7564  anything (includ
-00020b60: 696e 6720 7265 636f 7264 696e 6720 616e  ing recording an
-00020b70: 2065 6469 7429 2069 6620 7468 6520 6974   edit) if the it
-00020b80: 656d 2069 7320 616c 7265 6164 7920 7468  em is already th
-00020b90: 6520 7361 6d65 2061 7320 7468 6520 7661  e same as the va
-00020ba0: 6c75 650d 0a20 2020 2020 2020 2020 2020  lue..           
-00020bb0: 2020 2020 2072 6574 7572 6e0d 0a20 2020       return..   
-00020bc0: 2020 2020 2020 2020 2065 6c69 6620 6b65           elif ke
-00020bd0: 7920 3d3d 2027 4361 6c63 756c 6174 696f  y == 'Calculatio
-00020be0: 6e27 3a0d 0a20 2020 2020 2020 2020 2020  n':..           
-00020bf0: 2020 2020 2023 4361 6c63 756c 6174 696f       #Calculatio
-00020c00: 6e20 6861 7320 6368 616e 6765 6420 2874  n has changed (t
-00020c10: 6f20 7368 6f72 746e 616d 6520 6261 7365  o shortname base
-00020c20: 6420 636f 6e73 6f6c 6964 6174 696f 6e20  d consolidation 
-00020c30: 7072 6f62 6162 6c79 290d 0a20 2020 2020  probably)..     
-00020c40: 2020 2020 2020 2020 2020 2023 6275 7420             #but 
-00020c50: 7468 6520 756e 6465 726c 7969 6e67 2063  the underlying c
-00020c60: 616c 6375 6c61 7469 6f6e 2069 7320 7468  alculation is th
-00020c70: 6520 7361 6d65 2c20 6265 6361 7573 6520  e same, because 
-00020c80: 456d 706f 7765 7220 6578 706f 7274 6564  Empower exported
-00020c90: 2074 6865 2070 6879 7369 6420 7374 7269   the physid stri
-00020ca0: 6e67 2c20 7768 6572 6561 7320 6974 2072  ng, whereas it r
-00020cb0: 6571 7569 7265 7320 7468 6520 7368 6f72  equires the shor
-00020cc0: 746e 616d 6573 0d0a 2020 2020 2020 2020  tnames..        
-00020cd0: 2020 2020 2020 2020 2373 6f20 6368 6563          #so chec
-00020ce0: 6b20 6966 2074 6865 2070 6879 7369 6420  k if the physid 
-00020cf0: 7665 7273 696f 6e20 6f66 2074 6865 2063  version of the c
-00020d00: 616c 6375 6c61 7469 6f6e 2068 6173 2063  alculation has c
-00020d10: 6861 6e67 6564 202d 2069 6620 6e6f 7420  hanged - if not 
-00020d20: 7468 656e 2063 6861 6e67 6520 6974 2062  then change it b
-00020d30: 7574 2064 6f6e 2774 206d 6172 6b20 7468  ut don't mark th
-00020d40: 6520 6669 656c 6473 2061 7320 6564 6974  e fields as edit
-00020d50: 6564 2e0d 0a20 2020 2020 2020 2020 2020  ed...           
-00020d60: 2020 2020 2069 6620 7365 6c66 2e65 6c65       if self.ele
-00020d70: 6d65 6e74 2e5f 7068 7973 6964 5f63 616c  ment._physid_cal
-00020d80: 6375 6c61 7469 6f6e 203d 3d20 7365 6c66  culation == self
-00020d90: 2e5f 6669 656c 6473 5b6b 6579 5d3a 0d0a  ._fields[key]:..
-00020da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020db0: 2020 2020 7365 6c66 2e5f 6669 656c 6473      self._fields
-00020dc0: 5b6b 6579 5d20 2020 2020 2020 2020 2020  [key]           
-00020dd0: 2020 3d20 6974 656d 0d0a 2020 2020 2020    = item..      
-00020de0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00020df0: 7475 726e 0d0a 0d0a 0d0a 2020 2020 2020  turn......      
-00020e00: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-00020e10: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-00020e20: 2369 6620 206b 6579 203d 3d20 2744 6573  #if  key == 'Des
-00020e30: 6372 6970 7469 6f6e 273a 0d0a 2020 2020  cription':..    
-00020e40: 2020 2020 2020 2020 2320 2020 2074 7279          #    try
-00020e50: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00020e60: 2020 2020 2020 2020 7072 696e 7428 277b          print('{
-00020e70: 7d20 7b7d 2065 6469 7465 6420 7b7d 2e20  } {} edited {}. 
-00020e80: 7b7d 202d 3e20 7b7d 2027 2e66 6f72 6d61  {} -> {} '.forma
-00020e90: 7428 7365 6c66 2e65 6c65 6d65 6e74 2e70  t(self.element.p
-00020ea0: 6879 7369 642c 2073 656c 662e 656c 656d  hysid, self.elem
-00020eb0: 656e 742e 7368 6f72 746e 616d 652c 6b65  ent.shortname,ke
-00020ec0: 792c 7365 6c66 2e5f 6669 656c 6473 5b6b  y,self._fields[k
-00020ed0: 6579 5d2c 6974 656d 2929 0d0a 2020 2020  ey],item))..    
-00020ee0: 2020 2020 2020 2020 2320 2020 2065 7863          #    exc
-00020ef0: 6570 7420 4b65 7945 7272 6f72 3a0d 0a20  ept KeyError:.. 
-00020f00: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00020f10: 2020 2020 7072 696e 7428 277b 7d20 7b7d      print('{} {}
-00020f20: 2065 6469 7465 6420 7b7d 2e20 7b7d 202d   edited {}. {} -
-00020f30: 3e20 7b7d 2027 2e66 6f72 6d61 7428 7365  > {} '.format(se
-00020f40: 6c66 2e65 6c65 6d65 6e74 2e70 6879 7369  lf.element.physi
-00020f50: 642c 2073 656c 662e 656c 656d 656e 742e  d, self.element.
-00020f60: 7368 6f72 746e 616d 652c 6b65 792c 4e6f  shortname,key,No
-00020f70: 6e65 2c69 7465 6d29 290d 0a20 2020 2020  ne,item))..     
-00020f80: 2020 2020 2020 2070 6173 730d 0a0d 0a0d         pass.....
-00020f90: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
-00020fa0: 6965 6c64 735b 6b65 795d 2020 2020 2020  ields[key]      
-00020fb0: 2020 2020 2020 203d 2069 7465 6d0d 0a20         = item.. 
-00020fc0: 2020 2020 2020 2073 656c 662e 5f66 6965         self._fie
-00020fd0: 6c64 5f65 6469 7473 5b6b 6579 5d20 2020  ld_edits[key]   
-00020fe0: 2020 2020 203d 2054 7275 650d 0a20 2020       = True..   
-00020ff0: 2020 2020 2073 656c 662e 656c 656d 656e       self.elemen
-00021000: 742e 5f65 6469 7465 6420 2020 2020 2020  t._edited       
-00021010: 2020 203d 2054 7275 650d 0a20 2020 2020     = True..     
-00021020: 2020 2073 656c 662e 656c 656d 656e 742e     self.element.
-00021030: 5f73 796e 6368 6564 2020 2020 2020 2020  _synched        
-00021040: 203d 2046 616c 7365 0d0a 0d0a 0d0a 2020   = False......  
-00021050: 2020 6465 6620 6b65 7973 2873 656c 6629    def keys(self)
-00021060: 3a0d 0a20 2020 2020 2020 2023 6966 206e  :..        #if n
-00021070: 6f74 2073 656c 662e 6469 6d65 6e73 696f  ot self.dimensio
-00021080: 6e2e 5f65 6c65 6d65 6e74 735f 7265 6164  n._elements_read
-00021090: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
-000210a0: 7365 6c66 2e5f 6c6f 6164 5f65 6c65 6d65  self._load_eleme
-000210b0: 6e74 7328 290d 0a0d 0a20 2020 2020 2020  nts()....       
-000210c0: 2072 6574 7572 6e20 7365 6c66 2e5f 6669   return self._fi
-000210d0: 656c 6473 2e6b 6579 7328 290d 0a0d 0a20  elds.keys().... 
-000210e0: 2020 2064 6566 2069 7465 6d73 2873 656c     def items(sel
-000210f0: 6629 3a0d 0a20 2020 2020 2020 2023 6966  f):..        #if
-00021100: 206e 6f74 2073 656c 662e 6469 6d65 6e73   not self.dimens
-00021110: 696f 6e2e 5f65 6c65 6d65 6e74 735f 7265  ion._elements_re
-00021120: 6164 3a0d 0a20 2020 2020 2020 2023 2020  ad:..        #  
-00021130: 2020 7365 6c66 2e5f 6c6f 6164 5f65 6c65    self._load_ele
-00021140: 6d65 6e74 7328 290d 0a0d 0a20 2020 2020  ments()....     
-00021150: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00021160: 6669 656c 6473 2e69 7465 6d73 2829 0d0a  fields.items()..
-00021170: 0d0a 2020 2020 6465 6620 7661 6c75 6573  ..    def values
-00021180: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00021190: 2023 6966 206e 6f74 2073 656c 662e 6469   #if not self.di
-000211a0: 6d65 6e73 696f 6e2e 5f65 6c65 6d65 6e74  mension._element
-000211b0: 735f 7265 6164 3a0d 0a20 2020 2020 2020  s_read:..       
-000211c0: 2020 2320 2020 7365 6c66 2e5f 6c6f 6164    #   self._load
-000211d0: 5f65 6c65 6d65 6e74 7328 290d 0a0d 0a20  _elements().... 
-000211e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000211f0: 6c66 2e5f 6669 656c 6473 2e76 616c 7565  lf._fields.value
-00021200: 7328 290d 0a0d 0a20 2020 2064 6566 205f  s()....    def _
-00021210: 5f6c 656e 5f5f 2873 656c 6629 3a0d 0a20  _len__(self):.. 
-00021220: 2020 2020 2020 2023 6966 206e 6f74 2073         #if not s
-00021230: 656c 662e 6469 6d65 6e73 696f 6e2e 5f65  elf.dimension._e
-00021240: 6c65 6d65 6e74 735f 7265 6164 3a0d 0a20  lements_read:.. 
-00021250: 2020 2020 2020 2023 2020 2020 7365 6c66         #    self
-00021260: 2e5f 6c6f 6164 5f65 6c65 6d65 6e74 7328  ._load_elements(
-00021270: 290d 0a0d 0a20 2020 2020 2020 2072 6574  )....        ret
-00021280: 7572 6e20 6c65 6e28 7365 6c66 2e5f 6669  urn len(self._fi
-00021290: 656c 6473 290d 0a0d 0a20 2020 2064 6566  elds)....    def
-000212a0: 205f 5f73 7472 5f5f 2873 656c 6629 3a0d   __str__(self):.
-000212b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000212c0: 7374 7228 7365 6c66 2e5f 6669 656c 6473  str(self._fields
-000212d0: 290d 0a0d 0a20 2020 2064 6566 205f 5f72  )....    def __r
-000212e0: 6570 725f 5f28 7365 6c66 293a 0d0a 2020  epr__(self):..  
-000212f0: 2020 2020 2020 7265 7475 726e 2027 7b7d        return '{}
-00021300: 2066 726f 6d20 3c7b 7d20 6f62 6a65 6374   from <{} object
-00021310: 2061 7420 7b7d 3e27 2e66 6f72 6d61 7428   at {}>'.format(
-00021320: 277b 2720 2b20 275c 6e27 2e6a 6f69 6e28  '{' + '\n'.join(
-00021330: 5b20 2227 7b7d 273a 7b7d 222e 666f 726d  [ "'{}':{}".form
-00021340: 6174 286b 2c72 6570 7228 7629 2920 666f  at(k,repr(v)) fo
-00021350: 7220 6b2c 7620 696e 2073 656c 662e 6974  r k,v in self.it
-00021360: 656d 7328 295d 2920 2b20 277d 272c 7365  ems()]) + '}',se
-00021370: 6c66 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  lf.__class__.__n
-00021380: 616d 655f 5f2c 6865 7828 6964 2873 656c  ame__,hex(id(sel
-00021390: 6629 2920 2029 0d0a 0d0a 0d0a 636c 6173  f))  )......clas
-000213a0: 7320 5f44 696d 656e 7369 6f6e 4669 656c  s _DimensionFiel
-000213b0: 6473 4765 7474 6572 286f 626a 6563 7429  dsGetter(object)
-000213c0: 3a0d 0a20 2020 2027 2727 446f 6573 2061  :..    '''Does a
-000213d0: 2062 6974 206f 6620 6d61 6769 6320 746f   bit of magic to
-000213e0: 2061 6c6c 6f77 2044 696d 656e 7369 6f6e   allow Dimension
-000213f0: 2e66 6965 6c64 7320 746f 2068 6176 6520  .fields to have 
-00021400: 7c3d 2061 6e64 2073 696d 696c 6172 206d  |= and similar m
-00021410: 6167 6963 206d 6574 686f 6473 2061 7070  agic methods app
-00021420: 6c69 6564 2727 270d 0a20 2020 2064 6566  lied'''..    def
-00021430: 205f 5f69 6e69 745f 5f28 7365 6c66 2c64   __init__(self,d
-00021440: 696d 656e 7369 6f6e 293a 0d0a 2020 2020  imension):..    
-00021450: 2020 2020 7365 6c66 2e64 696d 656e 7369      self.dimensi
-00021460: 6f6e 3d64 696d 656e 7369 6f6e 0d0a 0d0a  on=dimension....
-00021470: 2020 2020 2020 2020 7365 6c66 2e5f 6669          self._fi
-00021480: 656c 6473 203d 2063 6f6c 6c65 6374 696f  elds = collectio
-00021490: 6e73 2e4f 7264 6572 6564 4469 6374 2829  ns.OrderedDict()
-000214a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-000214b0: 6669 656c 645f 6e61 6d65 735f 696e 5f65  field_names_in_e
-000214c0: 6d70 6f77 6572 203d 2063 6f6c 6c65 6374  mpower = collect
-000214d0: 696f 6e73 2e4f 7264 6572 6564 4469 6374  ions.OrderedDict
-000214e0: 2829 0d0a 0d0a 2020 2020 6465 6620 5f61  ()....    def _a
-000214f0: 6464 5f66 6965 6c64 5f6e 616d 6528 7365  dd_field_name(se
-00021500: 6c66 2c66 6965 6c64 6e61 6d65 2c66 726f  lf,fieldname,fro
-00021510: 6d5f 656d 706f 7765 723d 4661 6c73 6529  m_empower=False)
-00021520: 3a0d 0a20 2020 2020 2020 2023 544f 444f  :..        #TODO
-00021530: 202d 2061 7320 736f 6f6e 2061 7320 7765   - as soon as we
-00021540: 2063 616e 2067 6574 2066 6965 6c64 206e   can get field n
-00021550: 616d 6573 2028 616c 6f6e 6529 2069 6e74  ames (alone) int
-00021560: 6f20 7468 6520 6469 6d65 6e73 696f 6e20  o the dimension 
-00021570: 6672 6f6d 2045 6d70 6f77 6572 2067 6574  from Empower get
-00021580: 2072 6964 206f 6620 7468 6973 2e20 4974   rid of this. It
-00021590: 2069 7320 736c 6f77 696e 6720 646f 776e   is slowing down
-000215a0: 2073 6f20 6d61 6e79 206f 7468 6572 2066   so many other f
-000215b0: 756e 6374 696f 6e20 6361 6c6c 730d 0a0d  unction calls...
-000215c0: 0a20 2020 2020 2020 2069 6620 6669 656c  .        if fiel
-000215d0: 646e 616d 6520 6973 204e 6f6e 653a 0d0a  dname is None:..
-000215e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000215f0: 6520 5661 6c75 6545 7272 6f72 2827 4469  e ValueError('Di
-00021600: 6d65 6e73 696f 6e20 6669 656c 6473 2063  mension fields c
-00021610: 616e 206e 6f74 2068 6176 6520 616e 2065  an not have an e
-00021620: 6d70 7479 2028 4e6f 6e65 2920 6b65 7920  mpty (None) key 
-00021630: 666f 7220 6974 656d 2729 0d0a 0d0a 2020  for item')....  
-00021640: 2020 2020 2020 7365 6c66 2e5f 6669 656c        self._fiel
-00021650: 6473 5b66 6965 6c64 6e61 6d65 5d20 3d20  ds[fieldname] = 
-00021660: 4669 656c 6444 6566 696e 6974 696f 6e28  FieldDefinition(
-00021670: 6c6f 6e67 6e61 6d65 3d66 6965 6c64 6e61  longname=fieldna
-00021680: 6d65 290d 0a0d 0a20 2020 2020 2020 2069  me)....        i
-00021690: 6620 6672 6f6d 5f65 6d70 6f77 6572 3a0d  f from_empower:.
-000216a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000216b0: 662e 5f66 6965 6c64 5f6e 616d 6573 5f69  f._field_names_i
-000216c0: 6e5f 656d 706f 7765 725b 6669 656c 646e  n_empower[fieldn
-000216d0: 616d 655d 203d 2066 6965 6c64 6e61 6d65  ame] = fieldname
-000216e0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-000216f0: 790d 0a20 2020 2064 6566 205f 6e65 775f  y..    def _new_
-00021700: 6669 656c 645f 6e61 6d65 7328 7365 6c66  field_names(self
-00021710: 293a 0d0a 2020 2020 2020 2020 6966 206c  ):..        if l
-00021720: 656e 2873 656c 662e 5f66 6965 6c64 7329  en(self._fields)
-00021730: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
-00021740: 2020 2020 7265 7475 726e 0d0a 0d0a 2020      return....  
-00021750: 2020 2020 2020 2727 2759 6965 6c64 2061        '''Yield a
-00021760: 6c6c 2066 6965 6c64 206e 616d 6573 2074  ll field names t
-00021770: 6861 7420 6172 6520 6e6f 7420 696e 2045  hat are not in E
-00021780: 6d70 6f77 6572 202d 2074 6865 7927 6c6c  mpower - they'll
-00021790: 2062 6520 6e65 7727 2727 0d0a 2020 2020   be new'''..    
-000217a0: 2020 2020 666f 7220 6620 696e 2073 656c      for f in sel
-000217b0: 662e 6b65 7973 2829 3a0d 0a20 2020 2020  f.keys():..     
-000217c0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-000217d0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-000217e0: 662e 5f66 6965 6c64 5f6e 616d 6573 5f69  f._field_names_i
-000217f0: 6e5f 656d 706f 7765 725b 665d 0d0a 2020  n_empower[f]..  
-00021800: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00021810: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
-00021820: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00021830: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00021840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021850: 2020 2079 6965 6c64 2066 0d0a 0d0a 2020     yield f....  
-00021860: 2020 6465 6620 5f5f 696f 725f 5f28 7365    def __ior__(se
-00021870: 6c66 2c6f 7468 6572 293a 0d0a 2020 2020  lf,other):..    
-00021880: 2020 2020 6b3d 4e6f 6e65 0d0a 2020 2020      k=None..    
-00021890: 2020 2020 763d 4e6f 6e65 0d0a 2020 2020      v=None..    
-000218a0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000218b0: 6528 6f74 6865 722c 4669 656c 6444 6566  e(other,FieldDef
-000218c0: 696e 6974 696f 6e29 3a0d 0a20 2020 2020  inition):..     
-000218d0: 2020 2020 2020 2069 6620 6f74 6865 722e         if other.
-000218e0: 7368 6f72 746e 616d 6520 6973 204e 6f6e  shortname is Non
-000218f0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00021900: 2020 2020 6b3d 6f74 6865 722e 6c6f 6e67      k=other.long
-00021910: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-00021920: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00021930: 2020 2020 2020 2020 206b 3d6f 7468 6572           k=other
-00021940: 2e73 686f 7274 6e61 6d65 0d0a 2020 2020  .shortname..    
-00021950: 2020 2020 2020 2020 763d 6f74 6865 720d          v=other.
-00021960: 0a20 2020 2020 2020 2065 6c69 6620 7374  .        elif st
-00021970: 7228 6f74 6865 7229 3d3d 6f74 6865 723a  r(other)==other:
-00021980: 0d0a 2020 2020 2020 2020 2020 2020 6b20  ..            k 
-00021990: 3d20 6f74 6865 720d 0a20 2020 2020 2020  = other..       
-000219a0: 2020 2020 2076 203d 2046 6965 6c64 4465       v = FieldDe
-000219b0: 6669 6e69 7469 6f6e 2873 686f 7274 6e61  finition(shortna
-000219c0: 6d65 3d6f 7468 6572 2c6c 6f6e 676e 616d  me=other,longnam
-000219d0: 653d 6f74 6865 7229 0d0a 2020 2020 2020  e=other)..      
-000219e0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-000219f0: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
-00021a00: 7272 6f72 2822 756e 7375 7070 6f72 7465  rror("unsupporte
-00021a10: 6420 6f70 6572 616e 6420 7479 7065 7328  d operand types(
-00021a20: 7329 2066 6f72 207c 3d3a 2027 5f44 696d  s) for |=: '_Dim
-00021a30: 656e 7369 6f6e 4669 656c 6473 4765 7474  ensionFieldsGett
-00021a40: 6572 2720 616e 6420 277b 7d27 222e 666f  er' and '{}'".fo
-00021a50: 726d 6174 2874 7970 6528 6f74 6865 7229  rmat(type(other)
-00021a60: 2929 0d0a 0d0a 2020 2020 2020 2020 234f  ))....        #O
-00021a70: 6e6c 7920 6164 6420 6966 2064 6f65 736e  nly add if doesn
-00021a80: 2774 2065 7869 7374 2061 6c72 6561 6479  't exist already
-00021a90: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
-00021aa0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00021ab0: 5b6b 5d0d 0a20 2020 2020 2020 2065 7863  [k]..        exc
-00021ac0: 6570 7420 4b65 7945 7272 6f72 3a0d 0a20  ept KeyError:.. 
-00021ad0: 2020 2020 2020 2020 2020 2073 656c 665b             self[
-00021ae0: 6b5d 203d 2076 0d0a 2020 2020 2020 2020  k] = v..        
-00021af0: 2372 6574 7572 6e20 7365 6c66 2c20 6265  #return self, be
-00021b00: 6361 7573 6520 7468 6174 2069 7320 7768  cause that is wh
-00021b10: 6174 205f 5f69 6f72 5f5f 206d 7573 7420  at __ior__ must 
-00021b20: 616c 7761 7973 2064 6f0d 0a20 2020 2020  always do..     
-00021b30: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
-00021b40: 0d0a 2020 2020 6465 6620 5f5f 6961 6464  ..    def __iadd
-00021b50: 5f5f 2873 656c 662c 6f74 6865 7229 3a0d  __(self,other):.
-00021b60: 0a20 2020 2020 2020 206b 3d4e 6f6e 650d  .        k=None.
-00021b70: 0a20 2020 2020 2020 2076 3d4e 6f6e 650d  .        v=None.
-00021b80: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00021b90: 7374 616e 6365 286f 7468 6572 2c46 6965  stance(other,Fie
-00021ba0: 6c64 4465 6669 6e69 7469 6f6e 293a 0d0a  ldDefinition):..
-00021bb0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-00021bc0: 7468 6572 2e73 686f 7274 6e61 6d65 2069  ther.shortname i
-00021bd0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-00021be0: 2020 2020 2020 2020 206b 3d6f 7468 6572           k=other
-00021bf0: 2e6c 6f6e 676e 616d 650d 0a20 2020 2020  .longname..     
-00021c00: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00021c10: 2020 2020 2020 2020 2020 2020 2020 6b3d                k=
-00021c20: 6f74 6865 722e 7368 6f72 746e 616d 650d  other.shortname.
-00021c30: 0a20 2020 2020 2020 2020 2020 2076 3d6f  .            v=o
-00021c40: 7468 6572 0d0a 2020 2020 2020 2020 656c  ther..        el
-00021c50: 6966 2073 7472 286f 7468 6572 293d 3d6f  if str(other)==o
-00021c60: 7468 6572 3a0d 0a20 2020 2020 2020 2020  ther:..         
-00021c70: 2020 206b 203d 206f 7468 6572 0d0a 2020     k = other..  
-00021c80: 2020 2020 2020 2020 2020 7620 3d20 4669            v = Fi
-00021c90: 656c 6444 6566 696e 6974 696f 6e28 7368  eldDefinition(sh
-00021ca0: 6f72 746e 616d 653d 6f74 6865 722c 6c6f  ortname=other,lo
-00021cb0: 6e67 6e61 6d65 3d6f 7468 6572 290d 0a20  ngname=other).. 
-00021cc0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00021cd0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00021ce0: 5479 7065 4572 726f 7228 2275 6e73 7570  TypeError("unsup
-00021cf0: 706f 7274 6564 206f 7065 7261 6e64 2074  ported operand t
-00021d00: 7970 6573 2873 2920 666f 7220 7c3d 3a20  ypes(s) for |=: 
-00021d10: 275f 4469 6d65 6e73 696f 6e46 6965 6c64  '_DimensionField
-00021d20: 7347 6574 7465 7227 2061 6e64 2027 7b7d  sGetter' and '{}
-00021d30: 2722 2e66 6f72 6d61 7428 7479 7065 286f  '".format(type(o
-00021d40: 7468 6572 2929 290d 0a0d 0a20 2020 2020  ther)))....     
-00021d50: 2020 2073 656c 665b 6b5d 203d 2076 0d0a     self[k] = v..
-00021d60: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00021d70: 656c 660d 0a0d 0a20 2020 2064 6566 205f  elf....    def _
-00021d80: 5f69 7465 725f 5f28 7365 6c66 293a 0d0a  _iter__(self):..
-00021d90: 2020 2020 2020 2020 7365 6c66 2e5f 6974          self._it
-00021da0: 6572 6174 6f72 203d 2069 7465 7228 7365  erator = iter(se
-00021db0: 6c66 2e6b 6579 7328 2929 0d0a 2020 2020  lf.keys())..    
-00021dc0: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
-00021dd0: 0a0d 0a20 2020 2064 6566 205f 5f6e 6578  ...    def __nex
-00021de0: 745f 5f28 7365 6c66 293a 0d0a 2020 2020  t__(self):..    
-00021df0: 2020 2020 7265 7475 726e 206e 6578 7428      return next(
-00021e00: 7365 6c66 2e5f 6974 6572 6174 6f72 290d  self._iterator).
-00021e10: 0a0d 0a20 2020 2064 6566 205f 5f67 6574  ...    def __get
-00021e20: 6974 656d 5f5f 2873 656c 662c 6974 656d  item__(self,item
-00021e30: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-00021e40: 726e 2073 656c 662e 5f66 6965 6c64 735b  rn self._fields[
-00021e50: 6974 656d 5d0d 0a0d 0a20 2020 2064 6566  item]....    def
-00021e60: 205f 5f73 6574 6974 656d 5f5f 2873 656c   __setitem__(sel
-00021e70: 662c 206b 6579 2c20 6974 656d 293a 0d0a  f, key, item):..
-00021e80: 2020 2020 2020 2020 2369 6620 6e6f 7420          #if not 
-00021e90: 7365 6c66 2e64 696d 656e 7369 6f6e 2e5f  self.dimension._
-00021ea0: 656c 656d 656e 7473 5f72 6561 643a 0d0a  elements_read:..
-00021eb0: 2020 2020 2020 2020 2320 2020 2073 656c          #    sel
-00021ec0: 662e 5f6c 6f61 645f 656c 656d 656e 7473  f._load_elements
-00021ed0: 2829 0d0a 2020 2020 2020 2020 6966 206e  ()..        if n
-00021ee0: 6f74 2069 7369 6e73 7461 6e63 6528 6974  ot isinstance(it
-00021ef0: 656d 2c20 4669 656c 6444 6566 696e 6974  em, FieldDefinit
-00021f00: 696f 6e29 3a0d 0a20 2020 2020 2020 2020  ion):..         
-00021f10: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-00021f20: 6f72 2822 596f 7520 6361 6e20 6f6e 6c79  or("You can only
-00021f30: 2073 6574 2061 2044 696d 656e 7369 6f6e   set a Dimension
-00021f40: 2773 2066 6965 6c64 7320 746f 2062 6520  's fields to be 
-00021f50: 4669 656c 6444 6566 696e 6974 696f 6e20  FieldDefinition 
-00021f60: 6f62 6a65 6374 732e 2045 7870 6563 7469  objects. Expecti
-00021f70: 6e67 206f 626a 6563 7420 6f66 2074 7970  ng object of typ
-00021f80: 6520 4669 656c 6444 6566 696e 6974 696f  e FieldDefinitio
-00021f90: 6e2c 2067 6f74 206f 626a 6563 7420 7b7d  n, got object {}
-00021fa0: 206f 6620 7479 7065 207b 7d22 2e66 6f72   of type {}".for
-00021fb0: 6d61 7428 6974 656d 2c20 7479 7065 2869  mat(item, type(i
-00021fc0: 7465 6d29 2929 0d0a 0d0a 2020 2020 2020  tem)))....      
-00021fd0: 2020 6966 2069 7465 6d2e 6c6f 6e67 6e61    if item.longna
-00021fe0: 6d65 2069 7320 4e6f 6e65 3a0d 0a20 2020  me is None:..   
-00021ff0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00022000: 616c 7565 4572 726f 7228 2259 6f75 2063  alueError("You c
-00022010: 616e 206f 6e6c 7920 7365 7420 6120 4469  an only set a Di
-00022020: 6d65 6e73 696f 6e27 7320 6669 656c 6473  mension's fields
-00022030: 2074 6f20 6265 2046 6965 6c64 4465 6669   to be FieldDefi
-00022040: 6e69 7469 6f6e 206f 626a 6563 7420 7769  nition object wi
-00022050: 7468 2061 206c 6f6e 676e 616d 652e 2054  th a longname. T
-00022060: 6865 206c 6f6e 676e 616d 6520 6973 2073  he longname is s
-00022070: 6574 2074 6f20 4e6f 6e65 2077 6869 6368  et to None which
-00022080: 2069 7320 6e6f 7420 6163 6365 7074 6162   is not acceptab
-00022090: 6c65 2069 6e20 456d 706f 7765 722c 2066  le in Empower, f
-000220a0: 6f72 206f 626a 6563 7420 7b7d 222e 666f  or object {}".fo
-000220b0: 726d 6174 2869 7465 6d29 290d 0a0d 0a20  rmat(item)).... 
-000220c0: 2020 2020 2020 2023 4164 6420 6669 656c         #Add fiel
-000220d0: 6420 6e61 6d65 7320 6966 2077 6520 6861  d names if we ha
-000220e0: 7665 6e27 7420 7265 6164 2074 6865 2064  ven't read the d
-000220f0: 696d 656e 7369 6f6e 2079 6574 0d0a 2020  imension yet..  
-00022100: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00022110: 662e 6469 6d65 6e73 696f 6e20 6973 204e  f.dimension is N
-00022120: 6f6e 6520 616e 6420 6e6f 7420 7365 6c66  one and not self
-00022130: 2e64 696d 656e 7369 6f6e 2e65 6c65 6d65  .dimension.eleme
-00022140: 6e74 732e 5f65 6c65 6d65 6e74 735f 7265  nts._elements_re
-00022150: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
-00022160: 2073 656c 662e 5f61 6464 5f66 6965 6c64   self._add_field
-00022170: 5f6e 616d 6528 6b65 792c 6672 6f6d 5f65  _name(key,from_e
-00022180: 6d70 6f77 6572 3d46 616c 7365 290d 0a0d  mpower=False)...
-00022190: 0a20 2020 2020 2020 2069 6620 6b65 7920  .        if key 
-000221a0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-000221b0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000221c0: 6545 7272 6f72 2827 4469 6d65 6e73 696f  eError('Dimensio
-000221d0: 6e20 6669 656c 6473 2063 616e 206e 6f74  n fields can not
-000221e0: 2068 6176 6520 616e 2065 6d70 7479 2028   have an empty (
-000221f0: 4e6f 6e65 2920 6b65 7920 666f 7220 6974  None) key for it
-00022200: 656d 3a20 7b7d 272e 666f 726d 6174 2869  em: {}'.format(i
-00022210: 7465 6d29 290d 0a0d 0a20 2020 2020 2020  tem))....       
-00022220: 2073 656c 662e 5f66 6965 6c64 735b 6b65   self._fields[ke
-00022230: 795d 2020 2020 2020 2020 2020 2020 203d  y]             =
-00022240: 2069 7465 6d0d 0a0d 0a20 2020 2064 6566   item....    def
-00022250: 206b 6579 7328 7365 6c66 293a 0d0a 2020   keys(self):..  
-00022260: 2020 2020 2020 2369 6620 6e6f 7420 7365        #if not se
-00022270: 6c66 2e64 696d 656e 7369 6f6e 2e5f 656c  lf.dimension._el
-00022280: 656d 656e 7473 5f72 6561 643a 0d0a 2020  ements_read:..  
-00022290: 2020 2020 2020 2320 2020 2073 656c 662e        #    self.
-000222a0: 5f6c 6f61 645f 656c 656d 656e 7473 2829  _load_elements()
-000222b0: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-000222c0: 726e 2073 656c 662e 5f66 6965 6c64 732e  rn self._fields.
-000222d0: 6b65 7973 2829 0d0a 0d0a 2020 2020 6465  keys()....    de
-000222e0: 6620 6974 656d 7328 7365 6c66 293a 0d0a  f items(self):..
-000222f0: 2020 2020 2020 2020 2369 6620 6e6f 7420          #if not 
-00022300: 7365 6c66 2e64 696d 656e 7369 6f6e 2e5f  self.dimension._
-00022310: 656c 656d 656e 7473 5f72 6561 643a 0d0a  elements_read:..
-00022320: 2020 2020 2020 2020 2320 2020 2073 656c          #    sel
-00022330: 662e 5f6c 6f61 645f 656c 656d 656e 7473  f._load_elements
-00022340: 2829 0d0a 0d0a 2020 2020 2020 2020 7265  ()....        re
-00022350: 7475 726e 2073 656c 662e 5f66 6965 6c64  turn self._field
-00022360: 732e 6974 656d 7328 290d 0a0d 0a20 2020  s.items()....   
-00022370: 2064 6566 2076 616c 7565 7328 7365 6c66   def values(self
-00022380: 293a 0d0a 2020 2020 2020 2020 2369 6620  ):..        #if 
-00022390: 6e6f 7420 7365 6c66 2e64 696d 656e 7369  not self.dimensi
-000223a0: 6f6e 2e5f 656c 656d 656e 7473 5f72 6561  on._elements_rea
-000223b0: 643a 0d0a 2020 2020 2020 2020 2023 2020  d:..         #  
-000223c0: 2073 656c 662e 5f6c 6f61 645f 656c 656d   self._load_elem
-000223d0: 656e 7473 2829 0d0a 0d0a 2020 2020 2020  ents()....      
-000223e0: 2020 7265 7475 726e 2073 656c 662e 5f66    return self._f
-000223f0: 6965 6c64 732e 7661 6c75 6573 2829 0d0a  ields.values()..
-00022400: 0d0a 2020 2020 6465 6620 5f5f 6c65 6e5f  ..    def __len_
-00022410: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
-00022420: 2020 2369 6620 6e6f 7420 7365 6c66 2e64    #if not self.d
-00022430: 696d 656e 7369 6f6e 2e5f 656c 656d 656e  imension._elemen
-00022440: 7473 5f72 6561 643a 0d0a 2020 2020 2020  ts_read:..      
-00022450: 2020 2320 2020 2073 656c 662e 5f6c 6f61    #    self._loa
-00022460: 645f 656c 656d 656e 7473 2829 0d0a 0d0a  d_elements()....
-00022470: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-00022480: 656e 2873 656c 662e 5f66 6965 6c64 7329  en(self._fields)
-00022490: 0d0a 0d0a 2020 2020 6465 6620 5f5f 7374  ....    def __st
-000224a0: 725f 5f28 7365 6c66 293a 0d0a 2020 2020  r__(self):..    
-000224b0: 2020 2020 7265 7475 726e 2073 7472 2873      return str(s
-000224c0: 656c 662e 5f66 6965 6c64 7329 0d0a 0d0a  elf._fields)....
-000224d0: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
-000224e0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-000224f0: 2072 6574 7572 6e20 277b 7d20 6672 6f6d   return '{} from
-00022500: 203c 7b7d 206f 626a 6563 7420 6174 207b   <{} object at {
-00022510: 7d3e 272e 666f 726d 6174 2827 7b27 202b  }>'.format('{' +
-00022520: 2027 5c6e 272e 6a6f 696e 285b 2022 277b   '\n'.join([ "'{
-00022530: 7d27 3a7b 7d22 2e66 6f72 6d61 7428 6b2c  }':{}".format(k,
-00022540: 7265 7072 2876 2929 2066 6f72 206b 2c76  repr(v)) for k,v
-00022550: 2069 6e20 7365 6c66 2e69 7465 6d73 2829   in self.items()
-00022560: 5d29 202b 2027 7d27 2c73 656c 662e 5f5f  ]) + '}',self.__
-00022570: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-00022580: 2c68 6578 2869 6428 7365 6c66 2929 2020  ,hex(id(self))  
-00022590: 290d 0a0d 0a63 6c61 7373 205f 5365 6375  )....class _Secu
-000225a0: 7269 7479 5573 6572 7347 6574 7465 7228  rityUsersGetter(
-000225b0: 6f62 6a65 6374 293a 0d0a 2020 2020 2727  object):..    ''
-000225c0: 2744 6f65 7320 6120 6269 7420 6f66 206d  'Does a bit of m
-000225d0: 6167 6963 2074 6f20 616c 6c6f 7720 456c  agic to allow El
-000225e0: 656d 656e 7473 2074 6f20 6861 7665 2076  ements to have v
-000225f0: 6965 7765 7273 2c20 6d6f 6469 6669 6572  iewers, modifier
-00022600: 7320 616e 6420 6461 7461 5f76 6965 7765  s and data_viewe
-00022610: 7273 2061 7474 7269 6275 7465 7320 7468  rs attributes th
-00022620: 6174 206c 617a 7920 6c6f 6164 2061 6e64  at lazy load and
-00022630: 2072 6563 6f72 6420 6564 6974 696e 6720   record editing 
-00022640: 6368 616e 6765 730d 0a20 2020 205f 5365  changes..    _Se
-00022650: 6375 7269 7479 5573 6572 7347 6574 7465  curityUsersGette
-00022660: 7220 6265 6861 7665 7320 6c69 6b65 2061  r behaves like a
-00022670: 206c 6973 7420 286f 6620 7573 6572 2073   list (of user s
-00022680: 686f 7274 636f 6465 7329 0d0a 2020 2020  hortcodes)..    
-00022690: 4f6e 6520 5f53 6563 7572 6974 7955 7365  One _SecurityUse
-000226a0: 7273 4765 7474 6572 2077 696c 6c20 6265  rsGetter will be
-000226b0: 2063 7265 6174 6564 2066 6f72 2065 6163   created for eac
-000226c0: 6820 6f66 2074 6865 202e 7669 6577 6572  h of the .viewer
-000226d0: 732c 202e 6d6f 6469 6669 6572 7320 616e  s, .modifiers an
-000226e0: 6420 2e64 6174 615f 7669 6577 6572 7320  d .data_viewers 
-000226f0: 7072 6f70 6572 7469 6573 0d0a 0d0a 2020  properties....  
-00022700: 2020 4e6f 726d 616c 6c79 2045 6c65 6d65    Normally Eleme
-00022710: 6e74 2e76 6965 7765 7273 2c20 6d6f 6469  nt.viewers, modi
-00022720: 6669 6572 7320 616e 6420 6461 7461 5f76  fiers and data_v
-00022730: 6965 7765 7273 2077 696c 6c20 6265 204e  iewers will be N
-00022740: 6f6e 650d 0a20 2020 2027 2727 0d0a 2020  one..    '''..  
-00022750: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00022760: 656c 662c 656c 656d 656e 742c 2075 7365  elf,element, use
-00022770: 7273 203d 2073 6574 2c69 6e69 7469 616c  rs = set,initial
-00022780: 6973 655f 7379 6e63 6865 643d 4661 6c73  ise_synched=Fals
-00022790: 652c 2069 6e69 7469 616c 6973 655f 6173  e, initialise_as
-000227a0: 5f64 6566 6175 6c74 203d 2054 7275 6529  _default = True)
-000227b0: 3a0d 0a20 2020 2020 2020 2027 2727 0d0a  :..        '''..
-000227c0: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
-000227d0: 6e69 7469 616c 6973 655f 7379 6e63 6865  nitialise_synche
-000227e0: 643a 2020 7768 656e 206c 6f61 6469 6e67  d:  when loading
-000227f0: 2074 6865 2073 6563 7572 6974 7920 6672   the security fr
-00022800: 6f6d 2045 6d70 6f77 6572 2077 6520 6172  om Empower we ar
-00022810: 6520 7379 6e63 6872 6f6e 6973 6564 2e20  e synchronised. 
-00022820: 5768 656e 2063 7265 6174 696e 6720 6e65  When creating ne
-00022830: 7720 456c 656d 656e 7473 2061 6e64 2061  w Elements and a
-00022840: 6464 696e 6720 7365 6375 7269 7479 2077  dding security w
-00022850: 6520 6172 6520 6e6f 740d 0a0d 0a20 2020  e are not....   
-00022860: 2020 2020 203a 7061 7261 6d20 696e 6974       :param init
-00022870: 6961 6c69 7365 5f61 735f 6465 6661 756c  ialise_as_defaul
-00022880: 743a 2077 6865 6e20 6372 6561 7469 6e67  t: when creating
-00022890: 2073 6563 7572 6974 7920 666f 7220 6120   security for a 
-000228a0: 6e65 7720 656c 656d 656e 7420 7765 2075  new element we u
-000228b0: 7375 616c 6c79 2077 616e 7420 746f 2068  sually want to h
-000228c0: 6176 6520 6a75 7374 2064 6566 6175 6c74  ave just default
-000228d0: 2073 6563 7572 6974 7920 2869 2e65 2e20   security (i.e. 
-000228e0: 6e6f 7468 696e 6720 7265 636f 7264 6564  nothing recorded
-000228f0: 292e 2049 6620 7468 6973 2069 7320 7468  ). If this is th
-00022900: 6520 6361 7365 2072 6563 6f72 6420 6974  e case record it
-00022910: 2068 6572 6520 746f 206b 6565 7020 7072   here to keep pr
-00022920: 6f63 6573 7369 6e67 206c 6967 6874 0d0a  ocessing light..
-00022930: 2020 2020 2020 2020 2727 270d 0a0d 0a20          '''.... 
-00022940: 2020 2020 2020 2023 5768 656e 2069 6e69         #When ini
-00022950: 7469 616c 6973 696e 6720 6173 2064 6566  tialising as def
-00022960: 6175 6c74 2c20 7765 2077 616e 7420 746f  ault, we want to
-00022970: 206b 6565 7020 7468 6520 636c 6173 7320   keep the class 
-00022980: 6c69 6768 742d 206a 7573 7420 7365 7420  light- just set 
-00022990: 7365 6c66 2e64 6566 6175 6c74 203d 2054  self.default = T
-000229a0: 7275 6520 616e 6420 7365 7420 6120 706f  rue and set a po
-000229b0: 696e 7465 7220 6261 636b 2074 6f20 7468  inter back to th
-000229c0: 6520 656c 656d 656e 740d 0a20 2020 2020  e element..     
-000229d0: 2020 2069 6620 696e 6974 6961 6c69 7365     if initialise
-000229e0: 5f61 735f 6465 6661 756c 743a 0d0a 2020  _as_default:..  
-000229f0: 2020 2020 2020 2020 2020 7365 6c66 2e64            self.d
-00022a00: 6566 6175 6c74 3d54 7275 650d 0a20 2020  efault=True..   
-00022a10: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00022a20: 2020 2020 2020 2020 7365 6c66 2e64 6566          self.def
-00022a30: 6175 6c74 3d46 616c 7365 0d0a 0d0a 2020  ault=False....  
-00022a40: 2020 2020 2020 7365 6c66 2e65 6c65 6d65        self.eleme
-00022a50: 6e74 3d65 6c65 6d65 6e74 0d0a 0d0a 2020  nt=element....  
-00022a60: 2020 2020 2020 2357 6520 686f 6c64 2074        #We hold t
-00022a70: 776f 2073 6574 7320 6f66 2075 7365 7273  wo sets of users
-00022a80: 2061 6e64 2074 6865 2063 7572 7265 6e74   and the current
-00022a90: 2076 6572 7369 6f6e 2061 6e64 2074 6865   version and the
-00022aa0: 2073 796e 6368 6564 2076 6572 7369 6f6e   synched version
-00022ab0: 2066 726f 6d20 456d 706f 7765 720d 0a20   from Empower.. 
-00022ac0: 2020 2020 2020 2023 5765 2063 616e 2063         #We can c
-00022ad0: 6865 636b 2066 6f72 2065 6469 7473 2062  heck for edits b
-00022ae0: 6573 7420 7468 6973 2077 6179 2c20 7369  est this way, si
-00022af0: 6e63 6520 6120 636f 6d70 6c65 7820 7072  nce a complex pr
-00022b00: 6f63 6573 7320 6973 206c 696b 656c 7920  ocess is likely 
-00022b10: 746f 2061 6464 2061 6e64 2072 656d 6f76  to add and remov
-00022b20: 6520 7573 6572 730d 0a20 2020 2020 2020  e users..       
-00022b30: 2073 656c 662e 5f75 7365 7273 203d 2073   self._users = s
-00022b40: 6574 2875 7365 7273 290d 0a0d 0a20 2020  et(users)....   
-00022b50: 2020 2020 2023 4465 6661 756c 7420 7365       #Default se
-00022b60: 6c66 2e65 6469 7465 6420 2d20 7468 6973  lf.edited - this
-00022b70: 2077 696c 6c20 6765 7420 6f76 6572 7772   will get overwr
-00022b80: 6974 7465 6e20 6279 2073 656c 662e 5f73  itten by self._s
-00022b90: 6574 5f65 6469 7465 6428 2920 6973 206e  et_edited() is n
-00022ba0: 6563 6573 7361 7279 0d0a 2020 2020 2020  ecessary..      
-00022bb0: 2020 7365 6c66 2e5f 6564 6974 6564 203d    self._edited =
-00022bc0: 2046 616c 7365 0d0a 0d0a 2020 2020 2020   False....      
-00022bd0: 2020 6966 2069 6e69 7469 616c 6973 655f    if initialise_
-00022be0: 7379 6e63 6865 643a 0d0a 2020 2020 2020  synched:..      
-00022bf0: 2020 2020 2020 2357 6520 696e 6974 6961        #We initia
-00022c00: 6c69 7365 2073 796e 6368 6564 2077 6865  lise synched whe
-00022c10: 6e20 7765 2063 7265 6174 6520 7468 6520  n we create the 
-00022c20: 7365 6375 7269 7479 2064 6972 6563 746c  security directl
-00022c30: 7920 6672 6f6d 2045 6d70 6f77 6572 0d0a  y from Empower..
-00022c40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00022c50: 2e5f 7379 6e63 6865 645f 7573 6572 7320  ._synched_users 
-00022c60: 3d20 7365 7428 7573 6572 7329 0d0a 2020  = set(users)..  
-00022c70: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00022c80: 7365 6375 7269 7479 5f72 6561 6420 3d20  security_read = 
-00022c90: 5472 7565 0d0a 0d0a 2020 2020 2020 2020  True....        
-00022ca0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00022cb0: 2020 2073 656c 662e 5f73 6563 7572 6974     self._securit
-00022cc0: 795f 7265 6164 203d 2046 616c 7365 0d0a  y_read = False..
-00022cd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00022ce0: 2e5f 7379 6e63 6865 645f 7573 6572 7320  ._synched_users 
-00022cf0: 3d20 7365 7428 290d 0a20 2020 2020 2020  = set()..       
-00022d00: 2020 2020 2069 6620 6c65 6e28 7365 6c66       if len(self
-00022d10: 2e5f 7573 6572 7329 203e 2030 3a0d 0a20  ._users) > 0:.. 
-00022d20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00022d30: 656c 662e 5f73 6574 5f65 6469 7465 6428  elf._set_edited(
-00022d40: 290d 0a0d 0a0d 0a0d 0a20 2020 2064 6566  )........    def
-00022d50: 205f 7365 745f 6564 6974 6564 2873 656c   _set_edited(sel
-00022d60: 6629 3a0d 0a20 2020 2020 2020 2020 7365  f):..         se
-00022d70: 6c66 2e5f 6564 6974 6564 203d 2054 7275  lf._edited = Tru
-00022d80: 650d 0a20 2020 2020 2020 2020 7365 6c66  e..         self
-00022d90: 2e65 6c65 6d65 6e74 2e64 696d 656e 7369  .element.dimensi
-00022da0: 6f6e 2e65 6c65 6d65 6e74 732e 5f73 6563  on.elements._sec
-00022db0: 7572 6974 795f 6564 6974 6564 203d 2054  urity_edited = T
-00022dc0: 7275 650d 0a20 2020 2020 2020 2020 2370  rue..         #p
-00022dd0: 7269 6e74 2827 3137 3235 3a20 272c 7365  rint('1725: ',se
-00022de0: 6c66 2e65 6c65 6d65 6e74 2e64 696d 656e  lf.element.dimen
-00022df0: 7369 6f6e 2e65 6c65 6d65 6e74 732e 5f73  sion.elements._s
-00022e00: 6563 7572 6974 795f 6564 6974 6564 2029  ecurity_edited )
-00022e10: 0d0a 0d0a 2020 2020 6465 6620 5f6c 617a  ....    def _laz
-00022e20: 795f 6c6f 6164 2873 656c 6629 3a0d 0a20  y_load(self):.. 
-00022e30: 2020 2020 2020 2023 576f 726b 206f 7574         #Work out
-00022e40: 2069 6620 7365 6375 7269 7479 2068 6173   if security has
-00022e50: 2062 6565 6e20 6c6f 6164 6564 2066 6f72   been loaded for
-00022e60: 2074 6865 2065 6c65 6d65 6e74 730d 0a20   the elements.. 
-00022e70: 2020 2020 2020 2023 5573 6520 6120 6c6f         #Use a lo
-00022e80: 6361 6c20 7368 6f72 7463 7574 2062 6f6f  cal shortcut boo
-00022e90: 6c65 616e 2c20 746f 2073 6176 6520 7072  lean, to save pr
-00022ea0: 6f63 6573 7369 6e67 2074 696d 650d 0a0d  ocessing time...
-00022eb0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00022ec0: 7365 6c66 2e5f 7365 6375 7269 7479 5f72  self._security_r
-00022ed0: 6561 643a 0d0a 2020 2020 2020 2020 2020  ead:..          
-00022ee0: 2020 7365 6c66 2e65 6c65 6d65 6e74 2e64    self.element.d
-00022ef0: 696d 656e 7369 6f6e 2e5f 6c6f 6164 5f73  imension._load_s
-00022f00: 6563 7572 6974 7928 290d 0a20 2020 2020  ecurity()..     
-00022f10: 2020 2020 2020 2073 656c 662e 5f73 6563         self._sec
-00022f20: 7572 6974 795f 7265 6164 203d 2054 7275  urity_read = Tru
-00022f30: 650d 0a0d 0a20 2020 2040 7072 6f70 6572  e....    @proper
-00022f40: 7479 0d0a 2020 2020 6465 6620 6564 6974  ty..    def edit
-00022f50: 6564 2873 656c 6629 3a0d 0a20 2020 2020  ed(self):..     
-00022f60: 2020 2023 5265 6164 206f 6e6c 7920 7072     #Read only pr
-00022f70: 6f70 6572 7479 0d0a 2020 2020 2020 2020  operty..        
-00022f80: 2352 6574 7572 6e20 5472 7565 2069 6620  #Return True if 
-00022f90: 6564 6974 6564 2061 6e64 205f 7379 6e63  edited and _sync
-00022fa0: 6865 645f 7573 6572 7320 213d 205f 7573  hed_users != _us
-00022fb0: 6572 730d 0a20 2020 2020 2020 2023 6966  ers..        #if
-00022fc0: 2073 656c 662e 5f65 6469 7465 643a 0d0a   self._edited:..
-00022fd0: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
-00022fe0: 6e74 2827 3137 3334 3a27 2c73 656c 662e  nt('1734:',self.
-00022ff0: 5f73 796e 6368 6564 5f75 7365 7273 2021  _synched_users !
-00023000: 3d20 7365 6c66 2e5f 7573 6572 7329 0d0a  = self._users)..
-00023010: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
-00023020: 6e74 2873 656c 662e 5f73 796e 6368 6564  nt(self._synched
-00023030: 5f75 7365 7273 202c 2073 656c 662e 5f75  _users , self._u
-00023040: 7365 7273 290d 0a20 2020 2020 2020 2072  sers)..        r
-00023050: 6574 7572 6e20 2073 656c 662e 5f65 6469  eturn  self._edi
-00023060: 7465 6420 616e 6420 7365 6c66 2e5f 7379  ted and self._sy
-00023070: 6e63 6865 645f 7573 6572 7320 213d 2073  nched_users != s
-00023080: 656c 662e 5f75 7365 7273 0d0a 0d0a 0d0a  elf._users......
-00023090: 2020 2020 6465 6620 5f5f 636f 6e74 6169      def __contai
-000230a0: 6e73 5f5f 2873 656c 662c 2069 7465 6d29  ns__(self, item)
-000230b0: 3a0d 0a20 2020 2020 2020 2023 4c6f 6164  :..        #Load
-000230c0: 2074 6865 2055 7365 7273 2069 6620 7765   the Users if we
-000230d0: 2068 6176 656e 2774 2061 6c72 6561 6479   haven't already
-000230e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-000230f0: 6c61 7a79 5f6c 6f61 6428 290d 0a0d 0a20  lazy_load().... 
-00023100: 2020 2020 2020 2072 6574 7572 6e20 6974         return it
-00023110: 656d 2069 6e20 7365 6c66 2e5f 7573 6572  em in self._user
-00023120: 730d 0a0d 0a20 2020 2064 6566 205f 5f69  s....    def __i
-00023130: 7465 725f 5f28 7365 6c66 293a 0d0a 2020  ter__(self):..  
-00023140: 2020 2020 2020 7365 6c66 2e5f 6974 6572        self._iter
-00023150: 6174 6f72 203d 2069 7465 7228 6c69 7374  ator = iter(list
-00023160: 2873 656c 662e 5f75 7365 7273 2929 0d0a  (self._users))..
-00023170: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00023180: 656c 660d 0a0d 0a20 2020 2064 6566 205f  elf....    def _
-00023190: 5f6e 6578 745f 5f28 7365 6c66 293a 0d0a  _next__(self):..
-000231a0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-000231b0: 6578 7428 7365 6c66 2e5f 6974 6572 6174  ext(self._iterat
-000231c0: 6f72 290d 0a0d 0a20 2020 2023 7570 6461  or)....    #upda
-000231d0: 7465 282a 6f74 6865 7273 290d 0a20 2020  te(*others)..   
-000231e0: 2023 7365 7420 7c3d 206f 7468 6572 207c   #set |= other |
-000231f0: 202e 2e2e 0d0a 2020 2020 230d 0a20 2020   .....    #..   
-00023200: 2023 2020 2020 5570 6461 7465 2074 6865   #    Update the
-00023210: 2073 6574 2c20 6164 6469 6e67 2065 6c65   set, adding ele
-00023220: 6d65 6e74 7320 6672 6f6d 2061 6c6c 206f  ments from all o
-00023230: 7468 6572 732e 0d0a 2020 2020 230d 0a20  thers...    #.. 
-00023240: 2020 2023 696e 7465 7273 6563 7469 6f6e     #intersection
-00023250: 5f75 7064 6174 6528 2a6f 7468 6572 7329  _update(*others)
-00023260: 0d0a 2020 2020 2373 6574 2026 3d20 6f74  ..    #set &= ot
-00023270: 6865 7220 2620 2e2e 2e0d 0a20 2020 2023  her & .....    #
-00023280: 0d0a 2020 2020 2320 2020 2055 7064 6174  ..    #    Updat
-00023290: 6520 7468 6520 7365 742c 206b 6565 7069  e the set, keepi
-000232a0: 6e67 206f 6e6c 7920 656c 656d 656e 7473  ng only elements
-000232b0: 2066 6f75 6e64 2069 6e20 6974 2061 6e64   found in it and
-000232c0: 2061 6c6c 206f 7468 6572 732e 0d0a 2020   all others...  
-000232d0: 2020 230d 0a20 2020 2023 6469 6666 6572    #..    #differ
-000232e0: 656e 6365 5f75 7064 6174 6528 2a6f 7468  ence_update(*oth
-000232f0: 6572 7329 0d0a 2020 2020 2373 6574 202d  ers)..    #set -
-00023300: 3d20 6f74 6865 7220 7c20 2e2e 2e0d 0a20  = other | ..... 
-00023310: 2020 2023 0d0a 2020 2020 2320 2020 2055     #..    #    U
-00023320: 7064 6174 6520 7468 6520 7365 742c 2072  pdate the set, r
-00023330: 656d 6f76 696e 6720 656c 656d 656e 7473  emoving elements
-00023340: 2066 6f75 6e64 2069 6e20 6f74 6865 7273   found in others
-00023350: 2e0d 0a20 2020 2023 0d0a 2020 2020 2373  ...    #..    #s
-00023360: 796d 6d65 7472 6963 5f64 6966 6665 7265  ymmetric_differe
-00023370: 6e63 655f 7570 6461 7465 286f 7468 6572  nce_update(other
-00023380: 290d 0a20 2020 2023 7365 7420 5e3d 206f  )..    #set ^= o
-00023390: 7468 6572 0d0a 2020 2020 230d 0a20 2020  ther..    #..   
-000233a0: 2023 2020 2020 5570 6461 7465 2074 6865   #    Update the
-000233b0: 2073 6574 2c20 6b65 6570 696e 6720 6f6e   set, keeping on
-000233c0: 6c79 2065 6c65 6d65 6e74 7320 666f 756e  ly elements foun
-000233d0: 6420 696e 2065 6974 6865 7220 7365 742c  d in either set,
-000233e0: 2062 7574 206e 6f74 2069 6e20 626f 7468   but not in both
-000233f0: 2e0d 0a20 2020 2023 0d0a 0d0a 2020 2020  ...    #....    
-00023400: 6465 6620 6164 6428 7365 6c66 2c20 6974  def add(self, it
-00023410: 656d 293a 0d0a 2020 2020 2020 2020 2727  em):..        ''
-00023420: 2741 6464 2069 7465 6d20 746f 2074 6865  'Add item to the
-00023430: 2073 6574 206f 6620 7573 6572 2073 686f   set of user sho
-00023440: 7274 636f 6465 7327 2727 0d0a 2020 2020  rtcodes'''..    
-00023450: 2020 2020 234c 6f61 6420 7468 6520 5573      #Load the Us
-00023460: 6572 7320 6966 2077 6520 6861 7665 6e27  ers if we haven'
-00023470: 7420 616c 7265 6164 790d 0a20 2020 2020  t already..     
-00023480: 2020 2023 7072 696e 7428 2731 3738 323a     #print('1782:
-00023490: 272c 7365 6c66 2e5f 7365 6375 7269 7479  ',self._security
-000234a0: 5f72 6561 6429 0d0a 2020 2020 2020 2020  _read)..        
-000234b0: 2370 7269 6e74 2827 3137 3833 3a20 272c  #print('1783: ',
-000234c0: 7365 6c66 2e65 6c65 6d65 6e74 2e64 696d  self.element.dim
-000234d0: 656e 7369 6f6e 2e65 6c65 6d65 6e74 732e  ension.elements.
-000234e0: 5f73 6563 7572 6974 795f 6564 6974 6564  _security_edited
-000234f0: 2029 0d0a 2020 2020 2020 2020 7365 6c66   )..        self
-00023500: 2e5f 6c61 7a79 5f6c 6f61 6428 290d 0a20  ._lazy_load().. 
-00023510: 2020 2020 2020 2023 7072 696e 7428 2731         #print('1
-00023520: 3738 353a 272c 7365 6c66 2e5f 7365 6375  785:',self._secu
-00023530: 7269 7479 5f72 6561 6429 0d0a 2020 2020  rity_read)..    
-00023540: 2020 2020 2370 7269 6e74 2827 3137 3836      #print('1786
-00023550: 3a20 272c 7365 6c66 2e65 6c65 6d65 6e74  : ',self.element
-00023560: 2e64 696d 656e 7369 6f6e 2e65 6c65 6d65  .dimension.eleme
-00023570: 6e74 732e 5f73 6563 7572 6974 795f 6564  nts._security_ed
-00023580: 6974 6564 2029 0d0a 2020 2020 2020 2020  ited )..        
-00023590: 7265 7476 616c 203d 2073 656c 662e 5f75  retval = self._u
-000235a0: 7365 7273 2e61 6464 2869 7465 6d29 0d0a  sers.add(item)..
-000235b0: 2020 2020 2020 2020 2370 7269 6e74 2827          #print('
-000235c0: 3137 3838 3a27 2c73 656c 662e 5f73 6563  1788:',self._sec
-000235d0: 7572 6974 795f 7265 6164 290d 0a20 2020  urity_read)..   
-000235e0: 2020 2020 2023 7072 696e 7428 2731 3738       #print('178
-000235f0: 393a 2027 2c73 656c 662e 656c 656d 656e  9: ',self.elemen
-00023600: 742e 6469 6d65 6e73 696f 6e2e 656c 656d  t.dimension.elem
-00023610: 656e 7473 2e5f 7365 6375 7269 7479 5f65  ents._security_e
-00023620: 6469 7465 6420 290d 0a20 2020 2020 2020  dited )..       
-00023630: 2073 656c 662e 5f73 6574 5f65 6469 7465   self._set_edite
-00023640: 6428 290d 0a20 2020 2020 2020 2023 7072  d()..        #pr
-00023650: 696e 7428 2731 3739 313a 272c 7365 6c66  int('1791:',self
-00023660: 2e5f 7365 6375 7269 7479 5f72 6561 6429  ._security_read)
-00023670: 0d0a 2020 2020 2020 2020 2370 7269 6e74  ..        #print
-00023680: 2827 3137 3932 3a20 272c 7365 6c66 2e65  ('1792: ',self.e
-00023690: 6c65 6d65 6e74 2e64 696d 656e 7369 6f6e  lement.dimension
-000236a0: 2e65 6c65 6d65 6e74 732e 5f73 6563 7572  .elements._secur
-000236b0: 6974 795f 6564 6974 6564 2029 0d0a 2020  ity_edited )..  
-000236c0: 2020 2020 2020 2370 7269 6e74 2827 3137        #print('17
-000236d0: 3933 3a27 2c73 656c 662e 5f73 796e 6368  93:',self._synch
-000236e0: 6564 5f75 7365 7273 290d 0a20 2020 2020  ed_users)..     
-000236f0: 2020 2023 7072 696e 7428 2731 3739 343a     #print('1794:
-00023700: 272c 7365 6c66 2e5f 7573 6572 7329 0d0a  ',self._users)..
-00023710: 2020 2020 2020 2020 2370 7269 6e74 2827          #print('
-00023720: 3137 3935 3a27 2c72 6570 7228 7365 6c66  1795:',repr(self
-00023730: 2929 0d0a 2020 2020 2020 2020 7265 7475  ))..        retu
-00023740: 726e 2072 6574 7661 6c0d 0a0d 0a20 2020  rn retval....   
-00023750: 2064 6566 205f 5f69 6164 645f 5f28 7365   def __iadd__(se
-00023760: 6c66 2c69 7465 6d29 3a0d 0a20 2020 2020  lf,item):..     
-00023770: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00023780: 2020 2020 2073 656c 662e 5f75 7365 7273       self._users
-00023790: 2e61 6464 2869 7465 6d29 0d0a 2020 2020  .add(item)..    
-000237a0: 2020 2020 6578 6365 7074 2054 7970 6545      except TypeE
-000237b0: 7272 6f72 2061 7320 653a 0d0a 2020 2020  rror as e:..    
-000237c0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-000237d0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000237e0: 7220 7375 6269 7465 6d20 696e 2069 7465  r subitem in ite
-000237f0: 6d3a 0d0a 2020 2020 2020 2020 2020 2020  m:..            
-00023800: 2020 2020 2020 2020 7365 6c66 2e5f 7573          self._us
-00023810: 6572 732e 6164 6428 7375 6269 7465 6d29  ers.add(subitem)
-00023820: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-00023830: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
-00023840: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-00023850: 2020 2020 2020 7261 6973 6520 650d 0a0d        raise e...
-00023860: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00023870: 7365 6c66 0d0a 0d0a 2020 2020 6465 6620  self....    def 
-00023880: 5f5f 6973 7562 5f5f 2873 656c 662c 6974  __isub__(self,it
-00023890: 656d 293a 0d0a 2020 2020 2020 2020 7472  em):..        tr
-000238a0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-000238b0: 7365 6c66 2e5f 7573 6572 732e 6469 7363  self._users.disc
-000238c0: 6172 6428 6974 656d 290d 0a20 2020 2020  ard(item)..     
-000238d0: 2020 2065 7863 6570 7420 5479 7065 4572     except TypeEr
-000238e0: 726f 7220 6173 2065 3a0d 0a20 2020 2020  ror as e:..     
-000238f0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00023900: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00023910: 2073 7562 6974 656d 2069 6e20 6974 656d   subitem in item
-00023920: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00023930: 2020 2020 2020 2073 656c 662e 5f75 7365         self._use
-00023940: 7273 2e64 6973 6361 7264 2873 7562 6974  rs.discard(subit
-00023950: 656d 290d 0a20 2020 2020 2020 2020 2020  em)..           
-00023960: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
-00023970: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
-00023980: 2020 2020 2020 2020 2072 6169 7365 2065           raise e
-00023990: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-000239a0: 726e 2073 656c 660d 0a0d 0a0d 0a20 2020  rn self......   
-000239b0: 2023 7265 6d6f 7665 2865 6c65 6d29 0d0a   #remove(elem)..
-000239c0: 2020 2020 230d 0a20 2020 2023 0d0a 0d0a      #..    #....
-000239d0: 2020 2020 6465 6620 7365 7428 7365 6c66      def set(self
-000239e0: 2c69 7465 6d29 3a0d 0a20 2020 2020 2020  ,item):..       
-000239f0: 2073 656c 662e 636c 6561 7228 290d 0a20   self.clear().. 
-00023a00: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00023a10: 616e 6365 2869 7465 6d2c 7374 7229 3a0d  ance(item,str):.
-00023a20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00023a30: 662e 6164 6428 6974 656d 290d 0a20 2020  f.add(item)..   
-00023a40: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00023a50: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-00023a60: 2069 7465 6d3a 0d0a 2020 2020 2020 2020   item:..        
-00023a70: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00023a80: 2869 290d 0a0d 0a20 2020 2064 6566 2072  (i)....    def r
-00023a90: 656d 6f76 6528 7365 6c66 2c20 6974 656d  emove(self, item
-00023aa0: 293a 0d0a 2020 2020 2020 2020 2727 2752  ):..        '''R
-00023ab0: 656d 6f76 6520 6974 656d 2066 726f 6d20  emove item from 
-00023ac0: 7468 6520 7365 7420 6f66 2075 7365 7220  the set of user 
-00023ad0: 7368 6f72 7463 6f64 6573 2e20 5261 6973  shortcodes. Rais
-00023ae0: 6573 204b 6579 4572 726f 7220 6966 2069  es KeyError if i
-00023af0: 7465 6d20 6973 206e 6f74 2063 6f6e 7461  tem is not conta
-00023b00: 696e 6564 2069 6e20 7468 6520 7365 742e  ined in the set.
-00023b10: 2727 270d 0a0d 0a20 2020 2020 2020 2023  '''....        #
-00023b20: 4c6f 6164 2074 6865 2055 7365 7273 2069  Load the Users i
-00023b30: 6620 7765 2068 6176 656e 2774 2061 6c72  f we haven't alr
-00023b40: 6561 6479 0d0a 2020 2020 2020 2020 7365  eady..        se
-00023b50: 6c66 2e5f 6c61 7a79 5f6c 6f61 6428 290d  lf._lazy_load().
-00023b60: 0a20 2020 2020 2020 2072 6574 7661 6c20  .        retval 
-00023b70: 3d20 7365 6c66 2e5f 7573 6572 732e 7265  = self._users.re
-00023b80: 6d6f 7665 2869 7465 6d29 0d0a 2020 2020  move(item)..    
-00023b90: 2020 2020 7365 6c66 2e5f 7365 745f 6564      self._set_ed
-00023ba0: 6974 6564 2829 0d0a 2020 2020 2020 2020  ited()..        
-00023bb0: 7265 7475 726e 2072 6574 7661 6c0d 0a0d  return retval...
-00023bc0: 0a20 2020 2064 6566 205f 5f73 7562 5f5f  .    def __sub__
-00023bd0: 2873 656c 662c 6974 656d 293a 0d0a 2020  (self,item):..  
-00023be0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00023bf0: 662e 6469 7363 6172 6428 6974 656d 290d  f.discard(item).
-00023c00: 0a0d 0a20 2020 2064 6566 2064 6973 6361  ...    def disca
-00023c10: 7264 2873 656c 662c 2069 7465 6d29 3a0d  rd(self, item):.
-00023c20: 0a20 2020 2020 2020 2027 2727 5265 6d6f  .        '''Remo
-00023c30: 7665 2069 7465 6d20 6672 6f6d 2074 6865  ve item from the
-00023c40: 2073 6574 206f 6620 7573 6572 2073 686f   set of user sho
-00023c50: 7274 636f 6465 7320 6966 2069 7420 6973  rtcodes if it is
-00023c60: 2070 7265 7365 6e74 2e27 2727 0d0a 0d0a   present.'''....
-00023c70: 2020 2020 2020 2020 234c 6f61 6420 7468          #Load th
-00023c80: 6520 5573 6572 7320 6966 2077 6520 6861  e Users if we ha
-00023c90: 7665 6e27 7420 616c 7265 6164 790d 0a20  ven't already.. 
-00023ca0: 2020 2020 2020 2073 656c 662e 5f6c 617a         self._laz
-00023cb0: 795f 6c6f 6164 2829 0d0a 2020 2020 2020  y_load()..      
-00023cc0: 2020 7265 7476 616c 203d 2073 656c 662e    retval = self.
-00023cd0: 5f75 7365 7273 2e64 6973 6361 7264 2869  _users.discard(i
-00023ce0: 7465 6d29 0d0a 2020 2020 2020 2020 7365  tem)..        se
-00023cf0: 6c66 2e5f 7365 745f 6564 6974 6564 2829  lf._set_edited()
-00023d00: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00023d10: 2072 6574 7661 6c0d 0a0d 0a20 2020 2023   retval....    #
-00023d20: 706f 7028 290d 0a20 2020 2023 0d0a 2020  pop()..    #..  
-00023d30: 2020 2320 2020 2052 656d 6f76 6520 616e    #    Remove an
-00023d40: 6420 7265 7475 726e 2061 6e20 6172 6269  d return an arbi
-00023d50: 7472 6172 7920 656c 656d 656e 7420 6672  trary element fr
-00023d60: 6f6d 2074 6865 2073 6574 2e20 5261 6973  om the set. Rais
-00023d70: 6573 204b 6579 4572 726f 7220 6966 2074  es KeyError if t
-00023d80: 6865 2073 6574 2069 7320 656d 7074 792e  he set is empty.
-00023d90: 0d0a 2020 2020 230d 0a20 2020 2064 6566  ..    #..    def
-00023da0: 2063 6c65 6172 2873 656c 6629 3a0d 0a20   clear(self):.. 
-00023db0: 2020 2020 2020 2027 2727 5265 6d6f 7665         '''Remove
-00023dc0: 2061 6c6c 2075 7365 7273 2073 686f 7274   all users short
-00023dd0: 636f 6465 7320 6672 6f6d 2074 6865 2073  codes from the s
-00023de0: 6574 2e27 2727 0d0a 0d0a 2020 2020 2020  et.'''....      
-00023df0: 2020 234c 6f61 6420 7468 6520 5573 6572    #Load the User
-00023e00: 7320 6966 2077 6520 6861 7665 6e27 7420  s if we haven't 
-00023e10: 616c 7265 6164 790d 0a20 2020 2020 2020  already..       
-00023e20: 2073 656c 662e 5f6c 617a 795f 6c6f 6164   self._lazy_load
-00023e30: 2829 0d0a 2020 2020 2020 2020 7265 7476  ()..        retv
-00023e40: 616c 203d 2020 7365 6c66 2e5f 7573 6572  al =  self._user
-00023e50: 732e 636c 6561 7228 290d 0a20 2020 2020  s.clear()..     
-00023e60: 2020 2073 656c 662e 5f73 6574 5f65 6469     self._set_edi
-00023e70: 7465 6428 290d 0a20 2020 2020 2020 2023  ted()..        #
-00023e80: 4966 2077 6520 6172 6520 636c 6561 7265  If we are cleare
-00023e90: 642c 2077 6520 646f 6e27 7420 7761 6e74  d, we don't want
-00023ea0: 2074 6f20 6163 6369 6465 6e74 616c 6c79   to accidentally
-00023eb0: 2072 652d 696e 6974 6961 6c69 7a65 2076   re-initialize v
-00023ec0: 6961 2061 6e6f 7468 6572 2072 6561 640d  ia another read.
-00023ed0: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-00023ee0: 6563 7572 6974 795f 7265 6164 203d 2054  ecurity_read = T
-00023ef0: 7275 650d 0a20 2020 2020 2020 2072 6574  rue..        ret
-00023f00: 7572 6e20 7265 7476 616c 0d0a 0d0a 2020  urn retval....  
-00023f10: 2020 2369 7364 6973 6a6f 696e 7428 6f74    #isdisjoint(ot
-00023f20: 6865 7229 0d0a 2020 2020 230d 0a20 2020  her)..    #..   
-00023f30: 2023 2020 2020 5265 7475 726e 2054 7275   #    Return Tru
-00023f40: 6520 6966 2074 6865 2073 6574 2068 6173  e if the set has
-00023f50: 206e 6f20 656c 656d 656e 7473 2069 6e20   no elements in 
-00023f60: 636f 6d6d 6f6e 2077 6974 6820 6f74 6865  common with othe
-00023f70: 722e 2053 6574 7320 6172 6520 6469 736a  r. Sets are disj
-00023f80: 6f69 6e74 2069 6620 616e 6420 6f6e 6c79  oint if and only
-00023f90: 2069 6620 7468 6569 7220 696e 7465 7273   if their inters
-00023fa0: 6563 7469 6f6e 2069 7320 7468 6520 656d  ection is the em
-00023fb0: 7074 7920 7365 742e 0d0a 2020 2020 230d  pty set...    #.
-00023fc0: 0a20 2020 2023 6973 7375 6273 6574 286f  .    #issubset(o
-00023fd0: 7468 6572 290d 0a20 2020 2023 7365 7420  ther)..    #set 
-00023fe0: 3c3d 206f 7468 6572 0d0a 2020 2020 230d  <= other..    #.
-00023ff0: 0a20 2020 2023 2020 2020 5465 7374 2077  .    #    Test w
-00024000: 6865 7468 6572 2065 7665 7279 2065 6c65  hether every ele
-00024010: 6d65 6e74 2069 6e20 7468 6520 7365 7420  ment in the set 
-00024020: 6973 2069 6e20 6f74 6865 722e 0d0a 2020  is in other...  
-00024030: 2020 230d 0a20 2020 2023 7365 7420 3c20    #..    #set < 
-00024040: 6f74 6865 720d 0a20 2020 2023 0d0a 2020  other..    #..  
-00024050: 2020 2320 2020 2054 6573 7420 7768 6574    #    Test whet
-00024060: 6865 7220 7468 6520 7365 7420 6973 2061  her the set is a
-00024070: 2070 726f 7065 7220 7375 6273 6574 206f   proper subset o
-00024080: 6620 6f74 6865 722c 2074 6861 7420 6973  f other, that is
-00024090: 2c20 7365 7420 3c3d 206f 7468 6572 2061  , set <= other a
-000240a0: 6e64 2073 6574 2021 3d20 6f74 6865 722e  nd set != other.
-000240b0: 0d0a 2020 2020 230d 0a20 2020 2023 6973  ..    #..    #is
-000240c0: 7375 7065 7273 6574 286f 7468 6572 290d  superset(other).
-000240d0: 0a20 2020 2023 7365 7420 3e3d 206f 7468  .    #set >= oth
-000240e0: 6572 0d0a 2020 2020 230d 0a20 2020 2023  er..    #..    #
-000240f0: 2020 2020 5465 7374 2077 6865 7468 6572      Test whether
-00024100: 2065 7665 7279 2065 6c65 6d65 6e74 2069   every element i
-00024110: 6e20 6f74 6865 7220 6973 2069 6e20 7468  n other is in th
-00024120: 6520 7365 742e 0d0a 2020 2020 230d 0a20  e set...    #.. 
-00024130: 2020 2023 7365 7420 3e20 6f74 6865 720d     #set > other.
-00024140: 0a20 2020 2023 0d0a 2020 2020 2320 2020  .    #..    #   
-00024150: 2054 6573 7420 7768 6574 6865 7220 7468   Test whether th
-00024160: 6520 7365 7420 6973 2061 2070 726f 7065  e set is a prope
-00024170: 7220 7375 7065 7273 6574 206f 6620 6f74  r superset of ot
-00024180: 6865 722c 2074 6861 7420 6973 2c20 7365  her, that is, se
-00024190: 7420 3e3d 206f 7468 6572 2061 6e64 2073  t >= other and s
-000241a0: 6574 2021 3d20 6f74 6865 722e 0d0a 2020  et != other...  
-000241b0: 2020 230d 0a20 2020 2023 756e 696f 6e28    #..    #union(
-000241c0: 2a6f 7468 6572 7329 0d0a 2020 2020 2373  *others)..    #s
-000241d0: 6574 207c 206f 7468 6572 207c 202e 2e2e  et | other | ...
-000241e0: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
-000241f0: 2020 5265 7475 726e 2061 206e 6577 2073    Return a new s
-00024200: 6574 2077 6974 6820 656c 656d 656e 7473  et with elements
-00024210: 2066 726f 6d20 7468 6520 7365 7420 616e   from the set an
-00024220: 6420 616c 6c20 6f74 6865 7273 2e0d 0a20  d all others... 
-00024230: 2020 2023 0d0a 2020 2020 2369 6e74 6572     #..    #inter
-00024240: 7365 6374 696f 6e28 2a6f 7468 6572 7329  section(*others)
-00024250: 0d0a 2020 2020 2373 6574 2026 206f 7468  ..    #set & oth
-00024260: 6572 2026 202e 2e2e 0d0a 2020 2020 230d  er & .....    #.
-00024270: 0a20 2020 2023 2020 2020 5265 7475 726e  .    #    Return
-00024280: 2061 206e 6577 2073 6574 2077 6974 6820   a new set with 
-00024290: 656c 656d 656e 7473 2063 6f6d 6d6f 6e20  elements common 
-000242a0: 746f 2074 6865 2073 6574 2061 6e64 2061  to the set and a
-000242b0: 6c6c 206f 7468 6572 732e 0d0a 2020 2020  ll others...    
-000242c0: 230d 0a20 2020 2023 6469 6666 6572 656e  #..    #differen
-000242d0: 6365 282a 6f74 6865 7273 290d 0a20 2020  ce(*others)..   
-000242e0: 2023 7365 7420 2d20 6f74 6865 7220 2d20   #set - other - 
-000242f0: 2e2e 2e0d 0a20 2020 2023 0d0a 2020 2020  .....    #..    
-00024300: 2320 2020 2052 6574 7572 6e20 6120 6e65  #    Return a ne
-00024310: 7720 7365 7420 7769 7468 2065 6c65 6d65  w set with eleme
-00024320: 6e74 7320 696e 2074 6865 2073 6574 2074  nts in the set t
-00024330: 6861 7420 6172 6520 6e6f 7420 696e 2074  hat are not in t
-00024340: 6865 206f 7468 6572 732e 0d0a 2020 2020  he others...    
-00024350: 230d 0a20 2020 2023 7379 6d6d 6574 7269  #..    #symmetri
-00024360: 635f 6469 6666 6572 656e 6365 286f 7468  c_difference(oth
-00024370: 6572 290d 0a20 2020 2023 7365 7420 5e20  er)..    #set ^ 
-00024380: 6f74 6865 720d 0a20 2020 2023 0d0a 2020  other..    #..  
-00024390: 2020 2320 2020 2052 6574 7572 6e20 6120    #    Return a 
-000243a0: 6e65 7720 7365 7420 7769 7468 2065 6c65  new set with ele
-000243b0: 6d65 6e74 7320 696e 2065 6974 6865 7220  ments in either 
-000243c0: 7468 6520 7365 7420 6f72 206f 7468 6572  the set or other
-000243d0: 2062 7574 206e 6f74 2062 6f74 682e 0d0a   but not both...
-000243e0: 2020 2020 230d 0a0d 0a20 2020 2064 6566      #....    def
-000243f0: 205f 5f6c 656e 5f5f 2873 656c 6629 3a0d   __len__(self):.
-00024400: 0a20 2020 2020 2020 2023 4c6f 6164 2074  .        #Load t
-00024410: 6865 2055 7365 7273 2069 6620 7765 2068  he Users if we h
-00024420: 6176 656e 2774 2061 6c72 6561 6479 0d0a  aven't already..
-00024430: 2020 2020 2020 2020 7365 6c66 2e5f 6c61          self._la
-00024440: 7a79 5f6c 6f61 6428 290d 0a0d 0a20 2020  zy_load()....   
-00024450: 2020 2020 2072 6574 7572 6e20 6c65 6e28       return len(
-00024460: 7365 6c66 2e5f 7573 6572 7329 0d0a 0d0a  self._users)....
-00024470: 2020 2020 6465 6620 5f5f 7374 725f 5f28      def __str__(
-00024480: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00024490: 234c 6f61 6420 7468 6520 5573 6572 7320  #Load the Users 
-000244a0: 6966 2077 6520 6861 7665 6e27 7420 616c  if we haven't al
-000244b0: 7265 6164 790d 0a20 2020 2020 2020 2073  ready..        s
-000244c0: 656c 662e 5f6c 617a 795f 6c6f 6164 2829  elf._lazy_load()
-000244d0: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-000244e0: 726e 2073 7472 2873 656c 662e 5f75 7365  rn str(self._use
-000244f0: 7273 290d 0a0d 0a20 2020 2064 6566 205f  rs)....    def _
-00024500: 5f72 6570 725f 5f28 7365 6c66 293a 0d0a  _repr__(self):..
-00024510: 2020 2020 2020 2020 234c 6f61 6420 7468          #Load th
-00024520: 6520 5573 6572 7320 6966 2077 6520 6861  e Users if we ha
-00024530: 7665 6e27 7420 616c 7265 6164 790d 0a20  ven't already.. 
-00024540: 2020 2020 2020 2073 656c 662e 5f6c 617a         self._laz
-00024550: 795f 6c6f 6164 2829 0d0a 0d0a 2020 2020  y_load()....    
-00024560: 2020 2020 7265 7475 726e 2027 5573 6572      return 'User
-00024570: 7320 7b7d 2066 726f 6d20 3c7b 7d20 6f62  s {} from <{} ob
-00024580: 6a65 6374 2061 7420 7b7d 3e27 2e66 6f72  ject at {}>'.for
-00024590: 6d61 7428 277b 272b 2027 2c20 272e 6a6f  mat('{'+ ', '.jo
-000245a0: 696e 285b 2227 7b7d 2722 2e66 6f72 6d61  in(["'{}'".forma
-000245b0: 7428 7529 2066 6f72 2075 2069 6e20 7365  t(u) for u in se
-000245c0: 6c66 2e5f 7573 6572 735d 292b 2027 7d27  lf._users])+ '}'
-000245d0: 2c73 656c 662e 5f5f 636c 6173 735f 5f2e  ,self.__class__.
-000245e0: 5f5f 6e61 6d65 5f5f 2c68 6578 2869 6428  __name__,hex(id(
-000245f0: 7365 6c66 2929 2029 0d0a 0d0a 636c 6173  self)) )....clas
-00024600: 7320 5f56 6965 7770 6f69 6e74 7347 6574  s _ViewpointsGet
-00024610: 7465 7228 6f62 6a65 6374 293a 0d0a 2020  ter(object):..  
-00024620: 2020 2727 2744 6f65 7320 6120 6269 7420    '''Does a bit 
-00024630: 6f66 206d 6167 6963 2074 6f20 616c 6c6f  of magic to allo
-00024640: 7720 5369 7465 7320 746f 2068 6176 6520  w Sites to have 
-00024650: 6120 7669 6577 706f 696e 7473 206f 626a  a viewpoints obj
-00024660: 6563 7420 7768 6963 6820 6265 6861 7665  ect which behave
-00024670: 7320 6c69 6b65 2061 206c 617a 7920 6c6f  s like a lazy lo
-00024680: 6164 696e 6720 6469 6374 696f 6e61 7279  ading dictionary
-00024690: 2727 270d 0a20 2020 2064 6566 205f 5f69  '''..    def __i
-000246a0: 6e69 745f 5f28 7365 6c66 2c73 6974 6529  nit__(self,site)
-000246b0: 3a0d 0a20 2020 2020 2020 206c 6f67 2e64  :..        log.d
-000246c0: 6562 7567 2827 4372 6561 7469 6e67 205f  ebug('Creating _
-000246d0: 5669 6577 706f 696e 7473 4765 7474 6572  ViewpointsGetter
-000246e0: 2729 0d0a 2020 2020 2020 2020 7365 6c66  ')..        self
-000246f0: 2e73 6974 653d 7369 7465 0d0a 2020 2020  .site=site..    
-00024700: 2020 2020 7365 6c66 2e5f 7669 6577 706f      self._viewpo
-00024710: 696e 7473 3d7b 7d0d 0a0d 0a20 2020 2020  ints={}....     
-00024720: 2020 2073 656c 662e 5f5f 7669 6577 706f     self.__viewpo
-00024730: 696e 7473 5f72 6561 6420 3d20 4661 6c73  ints_read = Fals
-00024740: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-00024750: 5f5f 7669 6577 706f 696e 7473 5f73 796e  __viewpoints_syn
-00024760: 6365 6420 3d20 5472 7565 0d0a 0d0a 2020  ced = True....  
-00024770: 2020 2353 6574 2074 6865 7365 2061 7320    #Set these as 
-00024780: 7072 6f70 6572 7469 6573 2066 6f72 2064  properties for d
-00024790: 6562 7567 6769 6e67 202d 2077 6865 6e20  ebugging - when 
-000247a0: 616c 6c20 6973 2077 6f72 6b69 6e67 206d  all is working m
-000247b0: 616b 6520 7468 656d 206e 6f72 6d61 6c20  ake them normal 
-000247c0: 6174 7472 6962 7574 6573 2061 6761 696e  attributes again
-000247d0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-000247e0: 0a20 2020 2064 6566 205f 7669 6577 706f  .    def _viewpo
-000247f0: 696e 7473 5f72 6561 6428 7365 6c66 293a  ints_read(self):
-00024800: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00024810: 2073 656c 662e 5f5f 7669 6577 706f 696e   self.__viewpoin
-00024820: 7473 5f72 6561 640d 0a0d 0a20 2020 2040  ts_read....    @
-00024830: 5f76 6965 7770 6f69 6e74 735f 7265 6164  _viewpoints_read
-00024840: 2e73 6574 7465 720d 0a20 2020 2064 6566  .setter..    def
-00024850: 205f 7669 6577 706f 696e 7473 5f72 6561   _viewpoints_rea
-00024860: 6428 7365 6c66 2c76 616c 293a 0d0a 2020  d(self,val):..  
-00024870: 2020 2020 2020 236c 6f67 2e64 6562 7567        #log.debug
-00024880: 2827 5f76 6965 7770 6f69 6e74 735f 7265  ('_viewpoints_re
-00024890: 6164 2073 6574 2074 6f20 7b7d 272e 666f  ad set to {}'.fo
-000248a0: 726d 6174 2876 616c 2929 0d0a 2020 2020  rmat(val))..    
-000248b0: 2020 2020 7365 6c66 2e5f 5f76 6965 7770      self.__viewp
-000248c0: 6f69 6e74 735f 7265 6164 203d 2076 616c  oints_read = val
-000248d0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-000248e0: 790d 0a20 2020 2064 6566 205f 7669 6577  y..    def _view
-000248f0: 706f 696e 7473 5f73 796e 6365 6428 7365  points_synced(se
-00024900: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
-00024910: 7475 726e 2073 656c 662e 5f5f 7669 6577  turn self.__view
-00024920: 706f 696e 7473 5f73 796e 6365 640d 0a0d  points_synced...
-00024930: 0a20 2020 2040 5f76 6965 7770 6f69 6e74  .    @_viewpoint
-00024940: 735f 7379 6e63 6564 2e73 6574 7465 720d  s_synced.setter.
-00024950: 0a20 2020 2064 6566 205f 7669 6577 706f  .    def _viewpo
-00024960: 696e 7473 5f73 796e 6365 6428 7365 6c66  ints_synced(self
-00024970: 2c76 616c 293a 0d0a 2020 2020 2020 2020  ,val):..        
-00024980: 236c 6f67 2e77 6172 6e69 6e67 2827 5f76  #log.warning('_v
-00024990: 6965 7770 6f69 6e74 735f 7379 6e63 6564  iewpoints_synced
-000249a0: 2073 6574 2074 6f20 7b7d 272e 666f 726d   set to {}'.form
-000249b0: 6174 2876 616c 2929 0d0a 2020 2020 2020  at(val))..      
-000249c0: 2020 7365 6c66 2e5f 5f76 6965 7770 6f69    self.__viewpoi
-000249d0: 6e74 735f 7379 6e63 6564 203d 2076 616c  nts_synced = val
-000249e0: 0d0a 0d0a 2020 2020 2355 6e6c 696b 6520  ....    #Unlike 
-000249f0: 6120 7374 616e 6461 7264 2064 6963 7469  a standard dicti
-00024a00: 6f6e 6172 7920 7768 6963 6820 7265 7475  onary which retu
-00024a10: 726e 7320 6b65 7973 2069 6e20 6974 6572  rns keys in iter
-00024a20: 2c20 7265 7475 726e 2076 616c 7565 7320  , return values 
-00024a30: 2873 696e 6365 2074 6861 7427 7320 7768  (since that's wh
-00024a40: 6174 2077 6520 7573 7561 6c6c 7920 7761  at we usually wa
-00024a50: 6e74 290d 0a20 2020 2064 6566 205f 5f69  nt)..    def __i
-00024a60: 7465 725f 5f28 7365 6c66 293a 0d0a 2020  ter__(self):..  
-00024a70: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00024a80: 662e 5f76 6965 7770 6f69 6e74 735f 7265  f._viewpoints_re
-00024a90: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
-00024aa0: 2073 656c 662e 5f6c 6f61 645f 7669 6577   self._load_view
-00024ab0: 706f 696e 7473 2829 0d0a 2020 2020 2020  points()..      
-00024ac0: 2020 6c6f 672e 6465 6275 6728 2743 616c    log.debug('Cal
-00024ad0: 6c65 6420 5f56 6965 7770 6f69 6e74 7347  led _ViewpointsG
-00024ae0: 6574 7465 722e 5f5f 6974 6572 5f5f 2729  etter.__iter__')
-00024af0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00024b00: 6974 6572 6174 6f72 203d 2069 7465 7228  iterator = iter(
-00024b10: 7365 6c66 2e5f 7669 6577 706f 696e 7473  self._viewpoints
-00024b20: 2e76 616c 7565 7328 2929 0d0a 2020 2020  .values())..    
-00024b30: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
-00024b40: 0a0d 0a20 2020 2064 6566 205f 5f6e 6578  ...    def __nex
-00024b50: 745f 5f28 7365 6c66 293a 0d0a 2020 2020  t__(self):..    
-00024b60: 2020 2020 6c6f 672e 6465 6275 6728 2743      log.debug('C
-00024b70: 616c 6c65 6420 5f56 6965 7770 6f69 6e74  alled _Viewpoint
-00024b80: 7347 6574 7465 722e 5f5f 6e65 7874 5f5f  sGetter.__next__
-00024b90: 2729 0d0a 2020 2020 2020 2020 7265 7475  ')..        retu
-00024ba0: 726e 206e 6578 7428 7365 6c66 2e5f 6974  rn next(self._it
-00024bb0: 6572 6174 6f72 290d 0a0d 0a20 2020 2064  erator)....    d
-00024bc0: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
-00024bd0: 656c 662c 6974 656d 293a 0d0a 2020 2020  elf,item):..    
-00024be0: 2020 2020 234c 6f61 6420 7468 6520 5669      #Load the Vi
-00024bf0: 6577 706f 696e 7473 2069 6620 7765 2068  ewpoints if we h
-00024c00: 6176 656e 2774 2061 6c72 6561 6479 0d0a  aven't already..
-00024c10: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00024c20: 656c 662e 5f76 6965 7770 6f69 6e74 735f  elf._viewpoints_
-00024c30: 7265 6164 3a0d 0a20 2020 2020 2020 2020  read:..         
-00024c40: 2020 2073 656c 662e 5f6c 6f61 645f 7669     self._load_vi
-00024c50: 6577 706f 696e 7473 2829 0d0a 0d0a 2020  ewpoints()....  
-00024c60: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00024c70: 662e 5f76 6965 7770 6f69 6e74 735b 6974  f._viewpoints[it
-00024c80: 656d 5d0d 0a0d 0a20 2020 2064 6566 205f  em]....    def _
-00024c90: 6c6f 6164 5f76 6965 7770 6f69 6e74 7328  load_viewpoints(
-00024ca0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00024cb0: 6c6f 672e 7665 7262 6f73 6528 2752 6561  log.verbose('Rea
-00024cc0: 6469 6e67 2056 6965 7770 6f69 6e74 7327  ding Viewpoints'
-00024cd0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00024ce0: 5f76 6965 7770 6f69 6e74 735f 7265 6164  _viewpoints_read
-00024cf0: 203d 2054 7275 650d 0a0d 0a20 2020 2020   = True....     
-00024d00: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00024d10: 2020 2020 206d 616a 6f72 5f76 6572 7369       major_versi
-00024d20: 6f6e 2c20 6d69 6e6f 725f 7665 7273 696f  on, minor_versio
-00024d30: 6e2c 2072 656c 6561 7365 2c20 7265 6c65  n, release, rele
-00024d40: 6173 655f 6e75 6d62 6572 203d 2073 656c  ase_number = sel
-00024d50: 662e 7369 7465 2e69 6d70 6f72 7465 725f  f.site.importer_
-00024d60: 7665 7273 696f 6e0d 0a0d 0a20 2020 2020  version....     
-00024d70: 2020 2020 2020 2069 6620 7365 6c66 2e73         if self.s
-00024d80: 6974 652e 5f65 6e63 7279 7074 6564 5f75  ite._encrypted_u
-00024d90: 7365 7220 6973 204e 6f6e 653a 0d0a 2020  ser is None:..  
-00024da0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00024db0: 6973 6520 6d70 6578 2e45 6d70 6f77 6572  ise mpex.Empower
-00024dc0: 5365 6375 7269 7479 4572 726f 7228 2754  SecurityError('T
-00024dd0: 6865 2065 6e63 7279 7074 6564 5f75 7365  he encrypted_use
-00024de0: 7220 6d75 7374 2062 6520 7365 7420 746f  r must be set to
-00024df0: 2061 6363 6573 7320 7669 6577 706f 696e   access viewpoin
-00024e00: 7473 2e20 5265 6d6f 7665 2068 6172 6463  ts. Remove hardc
-00024e10: 6f64 6564 2070 6173 7377 6f72 6473 2061  oded passwords a
-00024e20: 6e64 2075 7365 7220 6e61 6d65 7320 696e  nd user names in
-00024e30: 2063 616c 6c73 2074 6f20 5369 7465 2829   calls to Site()
-00024e40: 2069 6e20 796f 7572 2073 6372 6970 742c   in your script,
-00024e50: 2069 6e20 6f72 6465 7220 746f 2062 6520   in order to be 
-00024e60: 7072 6f6d 7074 6564 2066 6f72 2061 2075  prompted for a u
-00024e70: 7365 7220 616e 6420 7061 7373 776f 7264  ser and password
-00024e80: 2729 0d0a 0d0a 2020 2020 2020 2020 2020  ')....          
-00024e90: 2020 6966 2028 6d61 6a6f 725f 7665 7273    if (major_vers
-00024ea0: 696f 6e20 3d3d 2039 2061 6e64 2028 7265  ion == 9 and (re
-00024eb0: 6c65 6173 655f 6e75 6d62 6572 203e 3d20  lease_number >= 
-00024ec0: 3139 3433 206f 7220 6d69 6e6f 725f 7665  1943 or minor_ve
-00024ed0: 7273 696f 6e20 3e3d 3729 2920 6f72 206d  rsion >=7)) or m
-00024ee0: 616a 6f72 5f76 6572 7369 6f6e 203e 2039  ajor_version > 9
-00024ef0: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
-00024f00: 2020 2020 2072 6574 7572 6e5f 6469 6374       return_dict
-00024f10: 3d7b 7d0d 0a0d 0a20 2020 2020 2020 2020  ={}....         
-00024f20: 2020 2020 2020 2023 4865 6c70 6572 2066         #Helper f
-00024f30: 756e 6374 696f 6e20 746f 2063 6f6e 7665  unction to conve
-00024f40: 7274 2073 7472 696e 6773 2063 6f72 7265  rt strings corre
-00024f50: 6374 6c79 0d0a 2020 2020 2020 2020 2020  ctly..          
-00024f60: 2020 2020 2020 6465 6620 636f 6e76 6572        def conver
-00024f70: 745f 7374 7269 6e67 2873 293a 0d0a 2020  t_string(s):..  
-00024f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024f90: 2020 6966 2073 203d 3d20 2727 3a0d 0a20    if s == '':.. 
-00024fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024fb0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00024fc0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00024fd0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00024fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00024ff0: 2020 2020 2020 2072 6574 7572 6e20 730d         return s.
-00025000: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00025010: 2020 2023 5468 6520 7669 6577 706f 696e     #The viewpoin
-00025020: 7420 6c69 7374 2074 6861 7420 7769 6c6c  t list that will
-00025030: 2062 6520 7265 7475 726e 6564 202d 2077   be returned - w
-00025040: 6527 6c6c 2061 6464 2076 6965 7770 6f69  e'll add viewpoi
-00025050: 6e74 7320 746f 2074 6869 7320 6c69 7374  nts to this list
-00025060: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00025070: 2020 7669 6577 706f 696e 745f 6c69 7374    viewpoint_list
-00025080: 3d5b 5d0d 0a0d 0a20 2020 2020 2020 2020  =[]....         
-00025090: 2020 2020 2020 2023 5468 6973 2069 7320         #This is 
-000250a0: 6e6f 7420 6120 6261 636b 706f 7274 6564  not a backported
-000250b0: 2063 6f6d 6d61 6e64 2c20 736f 2072 756e   command, so run
-000250c0: 206f 6e6c 7920 7769 7468 2065 6e63 7279   only with encry
-000250d0: 7074 696f 6e2c 2069 6e20 6f72 6465 7220  ption, in order 
-000250e0: 746f 206e 7564 6765 2075 7365 7273 2074  to nudge users t
-000250f0: 6f77 6172 6420 6265 7374 2070 7261 6374  oward best pract
-00025100: 6963 650d 0a20 2020 2020 2020 2020 2020  ice..           
-00025110: 2020 2020 206c 6f67 2e76 6572 626f 7365       log.verbose
-00025120: 2820 2252 756e 6e69 6e67 2049 4d50 4f52  ( "Running IMPOR
-00025130: 5445 523a 2066 726f 6d20 3c73 7464 696e  TER: from <stdin
-00025140: 3e20 7769 7468 2065 6e63 7279 7074 6564  > with encrypted
-00025150: 206c 6f67 6f6e 2074 6f20 6578 706f 7274   logon to export
-00025160: 2074 6865 2045 6d70 6f77 6572 2053 6974   the Empower Sit
-00025170: 6520 7669 6577 706f 696e 7473 2066 726f  e viewpoints fro
-00025180: 6d20 222b 7365 6c66 2e73 6974 652e 5f73  m "+self.site._s
-00025190: 6974 655f 6c6f 6361 746f 7229 0d0a 0d0a  ite_locator)....
-000251a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000251b0: 6966 2028 6d61 6a6f 725f 7665 7273 696f  if (major_versio
-000251c0: 6e20 3d3d 2039 2061 6e64 2028 7265 6c65  n == 9 and (rele
-000251d0: 6173 655f 6e75 6d62 6572 203e 3d20 3231  ase_number >= 21
-000251e0: 3432 206f 7220 6d69 6e6f 725f 7665 7273  42 or minor_vers
-000251f0: 696f 6e20 3e3d 3729 2920 6f72 206d 616a  ion >=7)) or maj
-00025200: 6f72 5f76 6572 7369 6f6e 203e 2039 3a0d  or_version > 9:.
-00025210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025220: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-00025230: 6c66 2e73 6974 652e 696d 706f 7274 6572  lf.site.importer
-00025240: 2e72 756e 5f63 6f6d 6d61 6e64 7328 5b27  .run_commands(['
-00025250: 656d 706f 7765 722d 6578 706f 7274 2d76  empower-export-v
-00025260: 6965 7770 6f69 6e74 7320 2d70 6879 732d  iewpoints -phys-
-00025270: 6964 7320 247b 7369 7465 7d20 247b 7573  ids ${site} ${us
-00025280: 6572 7d20 247b 7061 7373 776f 7264 7d27  er} ${password}'
-00025290: 2c27 6f75 7470 7574 275d 290d 0a20 2020  ,'output'])..   
-000252a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000252b0: 2070 6879 7369 6473 5f69 6e63 6c75 6465   physids_include
-000252c0: 6420 3d20 5472 7565 0d0a 2020 2020 2020  d = True..      
-000252d0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-000252e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000252f0: 2020 2020 2072 6573 756c 7420 3d20 7365       result = se
-00025300: 6c66 2e73 6974 652e 696d 706f 7274 6572  lf.site.importer
-00025310: 2e72 756e 5f63 6f6d 6d61 6e64 7328 5b27  .run_commands(['
-00025320: 656d 706f 7765 722d 6578 706f 7274 2d76  empower-export-v
-00025330: 6965 7770 6f69 6e74 7320 247b 7369 7465  iewpoints ${site
-00025340: 7d20 247b 7573 6572 7d20 247b 7061 7373  } ${user} ${pass
-00025350: 776f 7264 7d27 2c27 6f75 7470 7574 275d  word}','output']
-00025360: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00025370: 2020 2020 2020 2070 6879 7369 6473 5f69         physids_i
-00025380: 6e63 6c75 6465 6420 3d20 4661 6c73 650d  ncluded = False.
-00025390: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-000253a0: 2020 2066 6965 6c64 6e61 6d65 7320 3d20     fieldnames = 
-000253b0: 2020 2072 6573 756c 745b 305d 2e6b 6579     result[0].key
-000253c0: 7328 290d 0a20 2020 2020 2020 2020 2020  s()..           
-000253d0: 2020 2020 2023 5573 6520 6361 6e6f 6e69       #Use canoni
-000253e0: 6361 6c20 5374 7275 6374 7572 6573 2069  cal Structures i
-000253f0: 6620 7468 6579 2068 6176 6520 6265 656e  f they have been
-00025400: 206c 6f61 6465 6420 616c 7265 6164 7920   loaded already 
-00025410: 6f72 2063 7265 6174 6520 7374 7562 7320  or create stubs 
-00025420: 2877 6520 646f 6e27 7420 6e65 6564 2065  (we don't need e
-00025430: 7665 7279 2053 7472 7563 7475 7265 206c  very Structure l
-00025440: 6f61 6465 6420 666f 7220 6576 6572 7920  oaded for every 
-00025450: 7669 6577 706f 696e 7429 0d0a 2020 2020  viewpoint)..    
-00025460: 2020 2020 2020 2020 2020 2020 2343 6865              #Che
-00025470: 636b 2066 6f72 2074 6865 2065 7869 7374  ck for the exist
-00025480: 696e 6720 7374 7275 6374 7572 6520 6279  ing structure by
-00025490: 206c 6f6f 6b69 6e67 2061 7420 7468 6520   looking at the 
-000254a0: 6f62 6a65 6374 2064 6972 6563 746c 7920  object directly 
-000254b0: 2d20 646f 6e27 7420 7573 6520 7468 6520  - don't use the 
-000254c0: 6163 6365 7373 6f72 206d 6574 686f 6420  accessor method 
-000254d0: 6f72 2077 6520 7769 6c6c 2070 726f 766f  or we will provo
-000254e0: 6b65 2061 206c 617a 7920 6c6f 6164 0d0a  ke a lazy load..
-000254f0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00025500: 2020 2020 2355 7365 2074 6865 2066 6965      #Use the fie
-00025510: 6c64 206e 616d 6573 206f 6620 7468 6520  ld names of the 
-00025520: 7669 6577 706f 696e 7473 2074 6f20 7365  viewpoints to se
-00025530: 7420 7468 6520 6c6f 6e67 206e 616d 6573  t the long names
-00025540: 206f 6620 7468 6520 6469 6d65 6e73 696f   of the dimensio
-00025550: 6e73 0d0a 2020 2020 2020 2020 2020 2020  ns..            
-00025560: 2020 2020 666f 7220 6e2c 2066 6965 6c64      for n, field
-00025570: 2069 6e20 656e 756d 6572 6174 6528 6669   in enumerate(fi
-00025580: 656c 646e 616d 6573 293a 0d0a 2020 2020  eldnames):..    
-00025590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000255a0: 6966 206e 2b31 203c 2073 656c 662e 7369  if n+1 < self.si
-000255b0: 7465 2e6e 756d 6265 725f 6f66 5f75 6e69  te.number_of_uni
-000255c0: 745f 6469 6d65 6e73 696f 6e73 3a0d 0a20  t_dimensions:.. 
-000255d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000255e0: 2020 2020 2020 2073 656c 662e 7369 7465         self.site
-000255f0: 2e64 696d 656e 7369 6f6e 735b 6e5d 2e5f  .dimensions[n]._
-00025600: 6c6f 6e67 6e61 6d65 203d 2066 6965 6c64  longname = field
-00025610: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00025620: 2020 2020 2020 2020 656c 6966 206e 203e          elif n >
-00025630: 3d20 7365 6c66 2e73 6974 652e 6e75 6d62  = self.site.numb
-00025640: 6572 5f6f 665f 756e 6974 5f64 696d 656e  er_of_unit_dimen
-00025650: 7369 6f6e 7320 616e 6420 6e20 3c20 7365  sions and n < se
+0001f350: 2b20 7365 6375 7269 7479 5f66 696c 6570  + security_filep
+0001f360: 6174 6820 2b20 2722 270d 0a20 2020 2020  ath + '"'..     
+0001f370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f380: 2020 2020 2020 2c27 656d 706f 7765 722d        ,'empower-
+0001f390: 696d 706f 7274 2d73 6563 7572 6974 792d  import-security-
+0001f3a0: 7365 7474 696e 6773 2022 247b 7369 7465  settings "${site
+0001f3b0: 7d22 2022 247b 7573 6572 7d22 2022 247b  }" "${user}" "${
+0001f3c0: 7061 7373 776f 7264 7d22 270d 0a20 2020  password}"'..   
+0001f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f3e0: 2020 2020 2020 2020 5d0d 0a0d 0a20 2020          ]....   
+0001f3f0: 2020 2020 2020 2020 2023 496e 2064 6562           #In deb
+0001f400: 7567 206d 6f64 6520 7772 6974 6520 7468  ug mode write th
+0001f410: 6520 6461 7461 2069 6e74 6f20 6120 7473  e data into a ts
+0001f420: 7620 6669 6c65 2061 6e64 2072 6561 6420  v file and read 
+0001f430: 6974 2077 6974 6820 496d 706f 7274 6572  it with Importer
+0001f440: 2c20 7075 7474 696e 6720 7468 6520 7374  , putting the st
+0001f450: 7275 6374 7572 6520 696e 746f 2045 6d70  ructure into Emp
+0001f460: 6f77 6572 0d0a 2020 2020 2020 2020 2020  ower..          
+0001f470: 2020 6966 2064 6562 7567 3a0d 0a20 2020    if debug:..   
+0001f480: 2020 2020 2020 2020 2020 2020 2023 4e6f               #No
+0001f490: 6e20 7469 6d65 2064 696d 656e 7369 6f6e  n time dimension
+0001f4a0: 7320 6d61 7920 6861 7665 2066 6965 6c64  s may have field
+0001f4b0: 7320 2d20 7772 6974 6520 7468 6520 7374  s - write the st
+0001f4c0: 616e 6461 7264 2061 6e64 206e 6f6e 2073  andard and non s
+0001f4d0: 7461 6e64 6172 6420 6669 656c 6473 2074  tandard fields t
+0001f4e0: 6f20 6669 6c65 2061 6e64 2069 6d70 6f72  o file and impor
+0001f4f0: 7420 7468 656d 0d0a 2020 2020 2020 2020  t them..        
+0001f500: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
+0001f510: 6e28 7365 6375 7269 7479 5f66 696c 6570  n(security_filep
+0001f520: 6174 682c 2777 272c 656e 636f 6469 6e67  ath,'w',encoding
+0001f530: 3d27 7574 6638 2729 2061 7320 7461 7267  ='utf8') as targ
+0001f540: 6574 5f66 696c 653a 0d0a 2020 2020 2020  et_file:..      
+0001f550: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001f560: 7220 7320 696e 205f 7969 656c 645f 7365  r s in _yield_se
+0001f570: 6375 7269 7479 5f73 7472 696e 6773 2829  curity_strings()
+0001f580: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0001f590: 2020 2020 2020 2020 2020 2074 6172 6765             targe
+0001f5a0: 745f 6669 6c65 2e77 7269 7465 2873 290d  t_file.write(s).
+0001f5b0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+0001f5c0: 2020 206c 6c75 2e72 756e 5f73 696e 676c     llu.run_singl
+0001f5d0: 655f 6f75 7470 7574 5f69 6d70 6f72 7465  e_output_importe
+0001f5e0: 725f 636f 6d6d 616e 6473 2863 6f6d 6d61  r_commands(comma
+0001f5f0: 6e64 5f6c 6973 742c 656d 706f 7765 725f  nd_list,empower_
+0001f600: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
+0001f610: 626c 653d 7365 6c66 2e64 696d 656e 7369  ble=self.dimensi
+0001f620: 6f6e 2e73 6974 652e 656d 706f 7765 725f  on.site.empower_
+0001f630: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
+0001f640: 626c 6529 0d0a 0d0a 2020 2020 2020 2020  ble)....        
+0001f650: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0001f660: 2020 2020 2020 2020 2020 2023 496e 2027             #In '
+0001f670: 6e6f 726d 616c 2720 6d6f 6465 2064 6f20  normal' mode do 
+0001f680: 6120 6d65 7272 7920 6461 6e63 6520 7769  a merry dance wi
+0001f690: 7468 2057 696e 646f 7773 206e 616d 6564  th Windows named
+0001f6a0: 2070 6970 6573 2e20 5468 6973 2061 766f   pipes. This avo
+0001f6b0: 6964 7320 7772 6974 696e 6720 7468 6520  ids writing the 
+0001f6c0: 6461 7461 2074 6f20 6669 6c65 2066 6f72  data to file for
+0001f6d0: 2073 6563 7572 6974 7920 616e 6420 7072   security and pr
+0001f6e0: 6163 7469 6361 6c69 7479 2072 6561 736f  acticality reaso
+0001f6f0: 6e73 0d0a 2020 2020 2020 2020 2020 2020  ns..            
+0001f700: 2020 2020 2373 6563 7572 6974 795f 6669      #security_fi
+0001f710: 6c65 7061 7468 2069 7320 7468 6520 6e61  lepath is the na
+0001f720: 6d65 206f 6620 7468 6520 6e61 6d65 6420  me of the named 
+0001f730: 7069 7065 2065 2e67 2e20 5c5c 2e5c 7069  pipe e.g. \\.\pi
+0001f740: 7065 5c39 6463 6366 6130 382d 3430 6331  pe\9dccfa08-40c1
+0001f750: 2d34 3566 352d 3865 3065 2d66 3634 6331  -45f5-8e0e-f64c1
+0001f760: 3835 3032 6263 640d 0a20 2020 2020 2020  8502bcd..       
+0001f770: 2020 2020 2020 2020 2023 5468 6520 6d65           #The me
+0001f780: 7272 7920 6461 6e63 6520 6d65 616e 7320  rry dance means 
+0001f790: 7374 6172 7469 6e67 2049 6d70 6f72 7465  starting Importe
+0001f7a0: 722c 2072 6566 6572 656e 6369 6e67 2074  r, referencing t
+0001f7b0: 6865 2070 6970 652c 206f 7065 6e69 6e67  he pipe, opening
+0001f7c0: 2074 6865 2070 6970 6520 6265 666f 7265   the pipe before
+0001f7d0: 2049 6d70 6f72 7465 7220 6973 2070 726f   Importer is pro
+0001f7e0: 7065 726c 7920 7374 6172 7465 640d 0a20  perly started.. 
+0001f7f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001f800: 7365 7474 696e 6720 7570 2074 6865 206e  setting up the n
+0001f810: 616d 6564 2070 6970 6520 6f6e 2074 6869  amed pipe on thi
+0001f820: 7320 7468 7265 6164 2c20 616e 6420 7772  s thread, and wr
+0001f830: 6974 696e 6720 746f 2069 7420 2861 7320  iting to it (as 
+0001f840: 736f 6f6e 2061 7320 496d 706f 7274 6572  soon as Importer
+0001f850: 2063 6f6e 6e65 6374 7320 6174 2069 7473   connects at its
+0001f860: 2065 6e64 290d 0a20 2020 2020 2020 2020   end)..         
+0001f870: 2020 2020 2020 2023 5468 6520 6469 6666         #The diff
+0001f880: 6963 756c 7479 2c20 6973 2074 6861 7420  iculty, is that 
+0001f890: 7765 2068 6176 6520 746f 2070 6173 7320  we have to pass 
+0001f8a0: 7468 6520 6e61 6d65 206f 6620 7468 6520  the name of the 
+0001f8b0: 7069 7065 2074 6f20 496d 706f 7274 6572  pipe to Importer
+0001f8c0: 2c20 616e 6420 7265 6c79 206f 6e20 7468  , and rely on th
+0001f8d0: 6520 6661 6374 2074 6861 7420 6974 2077  e fact that it w
+0001f8e0: 6f6e 2774 2068 6176 6520 7469 6d65 2074  on't have time t
+0001f8f0: 6f20 6f70 656e 2069 740d 0a20 2020 2020  o open it..     
+0001f900: 2020 2020 2020 2020 2020 2023 6265 666f             #befo
+0001f910: 7265 2077 6520 6861 7665 2063 7265 6174  re we have creat
+0001f920: 6564 2069 742e 2042 7574 2077 6520 7769  ed it. But we wi
+0001f930: 6c6c 2062 6c6f 636b 206f 6e20 6f75 7220  ll block on our 
+0001f940: 7369 6465 2075 6e74 696c 2049 6d70 6f72  side until Impor
+0001f950: 7465 7220 6861 7320 636f 6e6e 6563 7465  ter has connecte
+0001f960: 640d 0a20 2020 2020 2020 2020 2020 2020  d..             
+0001f970: 2020 2070 726f 6320 3d20 4e6f 6e65 0d0a     proc = None..
+0001f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f990: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0001f9a0: 2020 2020 2020 2020 2020 7072 6f63 203d            proc =
+0001f9b0: 206c 6c75 2e73 7461 7274 5f6e 6f5f 6f75   llu.start_no_ou
+0001f9c0: 7470 7574 5f69 6d70 6f72 7465 725f 636f  tput_importer_co
+0001f9d0: 6d6d 616e 6473 2863 6f6d 6d61 6e64 5f6c  mmands(command_l
+0001f9e0: 6973 742c 656d 706f 7765 725f 696d 706f  ist,empower_impo
+0001f9f0: 7274 6572 5f65 7865 6375 7461 626c 653d  rter_executable=
+0001fa00: 7365 6c66 2e64 696d 656e 7369 6f6e 2e73  self.dimension.s
+0001fa10: 6974 652e 656d 706f 7765 725f 696d 706f  ite.empower_impo
+0001fa20: 7274 6572 5f65 7865 6375 7461 626c 6529  rter_executable)
+0001fa30: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0001fa40: 2020 2020 2020 2020 7769 7468 206c 6c75          with llu
+0001fa50: 2e6f 7574 626f 756e 645f 7069 7065 2873  .outbound_pipe(s
+0001fa60: 6563 7572 6974 795f 6669 6c65 7061 7468  ecurity_filepath
+0001fa70: 2920 6173 2070 6970 653a 0d0a 0d0a 2020  ) as pipe:....  
+0001fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa90: 2020 2020 2020 666f 7220 7320 696e 205f        for s in _
+0001faa0: 7969 656c 645f 7365 6375 7269 7479 5f73  yield_security_s
+0001fab0: 7472 696e 6773 2829 3a0d 0a20 2020 2020  trings():..     
+0001fac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fad0: 2020 2020 2020 2077 696e 3332 6669 6c65         win32file
+0001fae0: 2e57 7269 7465 4669 6c65 2870 6970 652c  .WriteFile(pipe,
+0001faf0: 2073 7472 2e65 6e63 6f64 6528 7329 290d   str.encode(s)).
+0001fb00: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+0001fb10: 2020 2020 2020 2020 2020 206c 6f67 2e64             log.d
+0001fb20: 6562 7567 2822 5069 7065 207b 7d20 6669  ebug("Pipe {} fi
+0001fb30: 6e69 7368 6564 2077 7269 7469 6e67 222e  nished writing".
+0001fb40: 666f 726d 6174 2873 6563 7572 6974 795f  format(security_
+0001fb50: 6669 6c65 7061 7468 2929 0d0a 0d0a 2020  filepath))....  
+0001fb60: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0001fb70: 6e61 6c6c 793a 0d0a 0d0a 2020 2020 2020  nally:....      
+0001fb80: 2020 2020 2020 2020 2020 2020 2020 2343                #C
+0001fb90: 6865 636b 2069 6620 496d 706f 7274 6572  heck if Importer
+0001fba0: 2072 6574 7572 6e65 6420 616e 2065 7272   returned an err
+0001fbb0: 6f72 2061 6e64 2072 6169 7365 2069 7420  or and raise it 
+0001fbc0: 6173 2061 2070 7974 686f 6e20 6966 2069  as a python if i
+0001fbd0: 7420 6469 640d 0a20 2020 2020 2020 2020  t did..         
+0001fbe0: 2020 2020 2020 2020 2020 206c 6c75 2e63             llu.c
+0001fbf0: 6f6d 706c 6574 655f 6e6f 5f6f 7574 7075  omplete_no_outpu
+0001fc00: 745f 696d 706f 7274 6572 5f70 726f 6365  t_importer_proce
+0001fc10: 7373 2870 726f 6329 0d0a 0d0a 2020 2020  ss(proc)....    
+0001fc20: 2020 2020 2323 2320 5365 7420 666c 6167      ### Set flag
+0001fc30: 2020 746f 2067 6574 2073 6563 7572 6974    to get securit
+0001fc40: 7920 746f 2063 6f6d 706c 6574 656c 7920  y to completely 
+0001fc50: 7265 7379 6e63 6820 6e65 7874 2074 696d  resynch next tim
+0001fc60: 650d 0a20 2020 2020 2020 2066 6f72 2065  e..        for e
+0001fc70: 6c65 6d65 6e74 2069 6e20 7365 6c66 2e76  lement in self.v
+0001fc80: 616c 7565 7328 293a 0d0a 2020 2020 2020  alues():..      
+0001fc90: 2020 2020 2020 6966 2065 6c65 6d65 6e74        if element
+0001fca0: 2e5f 7365 6375 7269 7479 2069 7320 6e6f  ._security is no
+0001fcb0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0001fcc0: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
+0001fcd0: 2e5f 7365 6375 7269 7479 2e5f 7669 6577  ._security._view
+0001fce0: 6572 7320 3d20 4e6f 6e65 0d0a 2020 2020  ers = None..    
+0001fcf0: 2020 2020 2020 2020 2020 2020 656c 656d              elem
+0001fd00: 656e 742e 5f73 6563 7572 6974 792e 5f6d  ent._security._m
+0001fd10: 6f64 6966 6965 7273 203d 204e 6f6e 650d  odifiers = None.
+0001fd20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fd30: 2065 6c65 6d65 6e74 2e5f 7365 6375 7269   element._securi
+0001fd40: 7479 2e5f 6461 7461 5f76 6965 7765 7273  ty._data_viewers
+0001fd50: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+0001fd60: 2020 2020 2065 6c65 6d65 6e74 2e5f 7365       element._se
+0001fd70: 6375 7269 7479 203d 204e 6f6e 650d 0a0d  curity = None...
+0001fd80: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
+0001fd90: 6563 7572 6974 795f 7265 6164 203d 2046  ecurity_read = F
+0001fda0: 616c 7365 0d0a 2020 2020 2020 2020 2365  alse..        #e
+0001fdb0: 6469 7473 2068 6176 6520 6265 656e 2073  dits have been s
+0001fdc0: 796e 6368 6564 0d0a 2020 2020 2020 2020  ynched..        
+0001fdd0: 7365 6c66 2e5f 5f73 6563 7572 6974 795f  self.__security_
+0001fde0: 6564 6974 6564 203d 2046 616c 7365 0d0a  edited = False..
+0001fdf0: 2020 2020 2020 2020 2370 7269 6e74 2873          #print(s
+0001fe00: 656c 6629 0d0a 2020 2020 2020 2020 2370  elf)..        #p
+0001fe10: 7269 6e74 2827 3135 3237 3a20 272c 7365  rint('1527: ',se
+0001fe20: 6c66 2e5f 5f73 6563 7572 6974 795f 6564  lf.__security_ed
+0001fe30: 6974 6564 2029 0d0a 0d0a 2020 2020 2020  ited )....      
+0001fe40: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+0001fe50: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001fe60: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0001fe70: 2323 2323 2323 0d0a 0d0a 2020 2020 2020  ######....      
+0001fe80: 2020 2363 6865 636b 2069 6620 616c 6c20    #check if all 
+0001fe90: 6f66 2074 6865 2065 6c65 6d65 6e74 7320  of the elements 
+0001fea0: 6172 6520 6d61 7374 6572 6564 202d 2069  are mastered - i
+0001feb0: 6620 736f 2c20 7468 656e 2077 6520 646f  f so, then we do
+0001fec0: 6e27 7420 6e65 6564 2074 6f20 7265 7379  n't need to resy
+0001fed0: 6e63 6820 2862 7920 6c61 7a79 206c 6f61  nch (by lazy loa
+0001fee0: 6469 6e67 290d 0a20 2020 2020 2020 2066  ding)..        f
+0001fef0: 6f72 2065 6c20 696e 2073 656c 662e 7661  or el in self.va
+0001ff00: 6c75 6573 2829 3a0d 0a0d 0a20 2020 2020  lues():....     
+0001ff10: 2020 2020 2020 2069 6620 6e6f 7420 656c         if not el
+0001ff20: 2e6d 6173 7465 7265 643a 0d0a 2020 2020  .mastered:..    
+0001ff30: 2020 2020 2020 2020 2020 2020 2352 6569              #Rei
+0001ff40: 6d70 6f72 7420 6c61 7a69 6c79 2062 7920  mport lazily by 
+0001ff50: 7365 7474 696e 6720 7365 6c66 2e5f 656c  setting self._el
+0001ff60: 656d 656e 7473 5f72 6561 6420 3d20 4661  ements_read = Fa
+0001ff70: 6c73 650d 0a20 2020 2020 2020 2020 2020  lse..           
+0001ff80: 2020 2020 2023 5468 6973 2077 696c 6c20       #This will 
+0001ff90: 7065 7273 7561 6465 2074 6865 205f 656c  persuade the _el
+0001ffa0: 656d 656e 7473 4765 7474 6572 2074 6f20  ementsGetter to 
+0001ffb0: 7265 2d65 7870 6f72 7420 616e 6420 7265  re-export and re
+0001ffc0: 2d72 6561 6420 7468 6520 6469 6d65 6e73  -read the dimens
+0001ffd0: 696f 6e2c 2072 6174 6865 7220 7468 616e  ion, rather than
+0001ffe0: 2075 7369 6e67 2074 6865 2063 6163 6865   using the cache
+0001fff0: 6420 7665 7273 696f 6e0d 0a20 2020 2020  d version..     
+00020000: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00020010: 5f65 6c65 6d65 6e74 735f 7265 6164 203d  _elements_read =
+00020020: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00020030: 2020 2020 2020 2020 6272 6561 6b0d 0a0d          break...
+00020040: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00020050: 5f65 6c65 6d65 6e74 5f64 6174 6166 7261  _element_datafra
+00020060: 6d65 203d 204e 6f6e 650d 0a0d 0a20 2020  me = None....   
+00020070: 2020 2020 2067 632e 636f 6c6c 6563 7428       gc.collect(
+00020080: 290d 0a0d 0a63 6c61 7373 205f 4669 656c  )....class _Fiel
+00020090: 6473 4765 7474 6572 286f 626a 6563 7429  dsGetter(object)
+000200a0: 3a0d 0a20 2020 2027 2727 446f 6573 2061  :..    '''Does a
+000200b0: 2062 6974 206f 6620 6d61 6769 6320 746f   bit of magic to
+000200c0: 2061 6c6c 6f77 2045 6c65 6d65 6e74 7320   allow Elements 
+000200d0: 746f 2068 6176 6520 6120 6669 656c 6473  to have a fields
+000200e0: 2061 7474 7269 6275 7465 2074 6861 7420   attribute that 
+000200f0: 7265 636f 7264 7320 6564 6974 696e 6720  records editing 
+00020100: 6368 616e 6765 7327 2727 0d0a 2020 2020  changes'''..    
+00020110: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00020120: 662c 656c 656d 656e 742c 2066 6965 6c64  f,element, field
+00020130: 732c 696e 6974 6961 6c69 7365 5f61 735f  s,initialise_as_
+00020140: 6564 6974 6564 293a 0d0a 2020 2020 2020  edited):..      
+00020150: 2020 7365 6c66 2e65 6c65 6d65 6e74 3d65    self.element=e
+00020160: 6c65 6d65 6e74 0d0a 0d0a 2020 2020 2020  lement....      
+00020170: 2020 6966 2065 6c65 6d65 6e74 2e64 696d    if element.dim
+00020180: 656e 7369 6f6e 2069 7320 6e6f 7420 4e6f  ension is not No
+00020190: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+000201a0: 2073 656c 662e 5f66 6965 6c64 733d 636f   self._fields=co
+000201b0: 6c6c 6563 7469 6f6e 732e 4f72 6465 7265  llections.Ordere
+000201c0: 6444 6963 7428 290d 0a20 2020 2020 2020  dDict()..       
+000201d0: 2020 2020 2066 6f72 206b 2069 6e20 656c       for k in el
+000201e0: 656d 656e 742e 6469 6d65 6e73 696f 6e2e  ement.dimension.
+000201f0: 5f66 6965 6c64 732e 6b65 7973 2829 3a0d  _fields.keys():.
+00020200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020210: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00020220: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00020230: 5f66 6965 6c64 735b 6b5d 203d 2066 6965  _fields[k] = fie
+00020240: 6c64 735b 6b5d 0d0a 2020 2020 2020 2020  lds[k]..        
+00020250: 2020 2020 2020 2020 6578 6365 7074 204b          except K
+00020260: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
+00020270: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00020280: 6c66 2e5f 6669 656c 6473 5b6b 5d20 3d20  lf._fields[k] = 
+00020290: 4e6f 6e65 0d0a 2020 2020 2020 2020 656c  None..        el
+000202a0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000202b0: 2073 656c 662e 5f66 6965 6c64 733d 636f   self._fields=co
+000202c0: 6c6c 6563 7469 6f6e 732e 4f72 6465 7265  llections.Ordere
+000202d0: 6444 6963 7428 6669 656c 6473 290d 0a0d  dDict(fields)...
+000202e0: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
+000202f0: 6965 6c64 5f65 6469 7473 3d7b 7d0d 0a20  ield_edits={}.. 
+00020300: 2020 2020 2020 2069 6620 696e 6974 6961         if initia
+00020310: 6c69 7365 5f61 735f 6564 6974 6564 3a0d  lise_as_edited:.
+00020320: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00020330: 206b 2c76 2020 696e 2066 6965 6c64 732e   k,v  in fields.
+00020340: 6974 656d 7328 293a 0d0a 2020 2020 2020  items():..      
+00020350: 2020 2020 2020 2020 2020 6966 2076 2069            if v i
+00020360: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2076  s not None and v
+00020370: 2021 3d20 2727 3a0d 0a20 2020 2020 2020   != '':..       
+00020380: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00020390: 662e 5f66 6965 6c64 5f65 6469 7473 5b6b  f._field_edits[k
+000203a0: 5d20 3d20 5472 7565 0d0a 2020 2020 2020  ] = True..      
+000203b0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000203c0: 2020 2020 2073 656c 662e 7265 7365 745f       self.reset_
+000203d0: 6564 6974 5f73 7461 7475 7328 290d 0a0d  edit_status()...
+000203e0: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+000203f0: 2020 2020 6465 6620 6564 6974 6564 2873      def edited(s
+00020400: 656c 6629 3a0d 0a20 2020 2020 2020 2023  elf):..        #
+00020410: 5265 7475 726e 2054 7275 6520 6966 2061  Return True if a
+00020420: 6e79 206f 6620 7468 6520 6669 656c 6473  ny of the fields
+00020430: 2068 6176 6520 6265 656e 2065 6469 7465   have been edite
+00020440: 640d 0a0d 0a20 2020 2020 2020 2066 6f72  d....        for
+00020450: 2065 6469 7465 6420 696e 2073 656c 662e   edited in self.
+00020460: 5f66 6965 6c64 5f65 6469 7473 2e76 616c  _field_edits.val
+00020470: 7565 7328 293a 0d0a 2020 2020 2020 2020  ues():..        
+00020480: 2020 2020 6966 2065 6469 7465 643a 0d0a      if edited:..
+00020490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000204a0: 7265 7475 726e 2054 7275 650d 0a0d 0a20  return True.... 
+000204b0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+000204c0: 6c73 650d 0a0d 0a20 2020 2040 7072 6f70  lse....    @prop
+000204d0: 6572 7479 0d0a 2020 2020 6465 6620 6564  erty..    def ed
+000204e0: 6974 6564 5f69 7465 6d73 2873 656c 6629  ited_items(self)
+000204f0: 3a0d 0a20 2020 2020 2020 2027 2727 5265  :..        '''Re
+00020500: 7475 726e 2066 6965 6c64 7320 7768 6963  turn fields whic
+00020510: 6820 6861 7665 2062 6565 6e20 6564 6974  h have been edit
+00020520: 6564 2061 7320 6966 2063 616c 6c69 6e67  ed as if calling
+00020530: 2069 7465 6d73 2829 2069 2e65 2e20 6b65   items() i.e. ke
+00020540: 792c 2076 616c 7565 2070 6169 7273 2727  y, value pairs''
+00020550: 270d 0a0d 0a20 2020 2020 2020 2066 6f72  '....        for
+00020560: 206b 2c20 6564 6974 6564 2069 6e20 7365   k, edited in se
+00020570: 6c66 2e5f 6669 656c 645f 6564 6974 732e  lf._field_edits.
+00020580: 6974 656d 7328 293a 0d0a 2020 2020 2020  items():..      
+00020590: 2020 2020 2020 6966 2065 6469 7465 643a        if edited:
+000205a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000205b0: 2020 7969 656c 6420 6b2c 2073 656c 662e    yield k, self.
+000205c0: 5f66 6965 6c64 735b 6b5d 0d0a 0d0a 2020  _fields[k]....  
+000205d0: 2020 6465 6620 7265 7365 745f 6564 6974    def reset_edit
+000205e0: 5f73 7461 7475 7328 7365 6c66 293a 0d0a  _status(self):..
+000205f0: 2020 2020 2020 2020 2353 6574 2065 6469          #Set edi
+00020600: 7420 7374 6174 7573 2062 6163 6b20 746f  t status back to
+00020610: 206e 6f20 6564 6974 730d 0a20 2020 2020   no edits..     
+00020620: 2020 2023 7072 696e 7428 277b 7d20 7265     #print('{} re
+00020630: 7365 7420 6564 6974 2073 7461 7475 7327  set edit status'
+00020640: 2e66 6f72 6d61 7428 7365 6c66 2e65 6c65  .format(self.ele
+00020650: 6d65 6e74 2e70 6879 7369 6429 290d 0a20  ment.physid)).. 
+00020660: 2020 2020 2020 2073 656c 662e 5f66 6965         self._fie
+00020670: 6c64 5f65 6469 7473 3d7b 7d0d 0a0d 0a20  ld_edits={}.... 
+00020680: 2020 2064 6566 205f 5f69 7465 725f 5f28     def __iter__(
+00020690: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+000206a0: 7365 6c66 2e5f 6974 6572 6174 6f72 203d  self._iterator =
+000206b0: 2069 7465 7228 7365 6c66 2e6b 6579 7328   iter(self.keys(
+000206c0: 2929 0d0a 2020 2020 2020 2020 7265 7475  ))..        retu
+000206d0: 726e 2073 656c 660d 0a0d 0a20 2020 2064  rn self....    d
+000206e0: 6566 205f 5f6e 6578 745f 5f28 7365 6c66  ef __next__(self
+000206f0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+00020700: 726e 206e 6578 7428 7365 6c66 2e5f 6974  rn next(self._it
+00020710: 6572 6174 6f72 290d 0a0d 0a20 2020 2064  erator)....    d
+00020720: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
+00020730: 656c 662c 6974 656d 293a 0d0a 2020 2020  elf,item):..    
+00020740: 2020 2020 2323 4c6f 6164 2074 6865 2045      ##Load the E
+00020750: 6c65 6d65 6e74 7320 6966 2077 6520 6861  lements if we ha
+00020760: 7665 6e27 7420 616c 7265 6164 790d 0a20  ven't already.. 
+00020770: 2020 2020 2020 2023 6966 206e 6f74 2073         #if not s
+00020780: 656c 662e 6469 6d65 6e73 696f 6e2e 5f65  elf.dimension._e
+00020790: 6c65 6d65 6e74 735f 7265 6164 3a0d 0a20  lements_read:.. 
+000207a0: 2020 2020 2020 2023 2020 2020 7365 6c66         #    self
+000207b0: 2e5f 6c6f 6164 5f65 6c65 6d65 6e74 7328  ._load_elements(
+000207c0: 290d 0a0d 0a20 2020 2020 2020 2074 7279  )....        try
+000207d0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+000207e0: 6574 7572 6e20 7365 6c66 2e5f 6669 656c  eturn self._fiel
+000207f0: 6473 5b69 7465 6d5d 0d0a 2020 2020 2020  ds[item]..      
+00020800: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+00020810: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+00020820: 6966 2073 656c 662e 656c 656d 656e 742e  if self.element.
+00020830: 6469 6d65 6e73 696f 6e20 6973 206e 6f74  dimension is not
+00020840: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00020850: 2020 2020 2020 2020 6966 2069 7465 6d20          if item 
+00020860: 696e 2073 656c 662e 656c 656d 656e 742e  in self.element.
+00020870: 6469 6d65 6e73 696f 6e2e 6669 656c 6473  dimension.fields
+00020880: 2e6b 6579 7328 293a 0d0a 2020 2020 2020  .keys():..      
+00020890: 2020 2020 2020 2020 2020 2020 2020 2341                #A
+000208a0: 6464 204e 6f6e 6520 746f 2073 6176 6520  dd None to save 
+000208b0: 7468 6973 206c 6f67 6963 2068 6170 7065  this logic happe
+000208c0: 6e69 6e67 2061 6c6c 206f 6620 7468 6520  ning all of the 
+000208d0: 7469 6d65 0d0a 2020 2020 2020 2020 2020  time..          
+000208e0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+000208f0: 6669 656c 6473 5b69 7465 6d5d 203d 204e  fields[item] = N
+00020900: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+00020910: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00020920: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+00020930: 2020 2352 652d 7261 6973 6520 6f6e 6c79    #Re-raise only
+00020940: 2069 6620 7765 2068 6176 6520 6e6f 7420   if we have not 
+00020950: 7265 7475 726e 6564 2061 204e 6f6e 6520  returned a None 
+00020960: 7661 6c75 6520 2869 2e65 2e20 7261 6973  value (i.e. rais
+00020970: 6520 6966 2074 6865 206b 6579 2069 7320  e if the key is 
+00020980: 6e6f 7420 6120 6469 6d65 6e73 696f 6e20  not a dimension 
+00020990: 6669 656c 6429 0d0a 2020 2020 2020 2020  field)..        
+000209a0: 2020 2020 7261 6973 650d 0a0d 0a0d 0a20      raise...... 
+000209b0: 2020 2064 6566 205f 5f73 6574 6974 656d     def __setitem
+000209c0: 5f5f 2873 656c 662c 206b 6579 2c20 6974  __(self, key, it
+000209d0: 656d 293a 0d0a 0d0a 2020 2020 2020 2020  em):....        
+000209e0: 2369 6620 6e6f 7420 7365 6c66 2e64 696d  #if not self.dim
+000209f0: 656e 7369 6f6e 2e5f 656c 656d 656e 7473  ension._elements
+00020a00: 5f72 6561 643a 0d0a 2020 2020 2020 2020  _read:..        
+00020a10: 2320 2020 2073 656c 662e 5f6c 6f61 645f  #    self._load_
+00020a20: 656c 656d 656e 7473 2829 0d0a 0d0a 2020  elements()....  
+00020a30: 2020 2020 2020 2341 6464 2066 6965 6c64        #Add field
+00020a40: 206e 616d 6573 2069 6620 7765 2068 6176   names if we hav
+00020a50: 656e 2774 2072 6561 6420 7468 6520 6469  en't read the di
+00020a60: 6d65 6e73 696f 6e20 7965 740d 0a20 2020  mension yet..   
+00020a70: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+00020a80: 2e65 6c65 6d65 6e74 2e64 696d 656e 7369  .element.dimensi
+00020a90: 6f6e 2069 7320 4e6f 6e65 2061 6e64 206e  on is None and n
+00020aa0: 6f74 2073 656c 662e 656c 656d 656e 742e  ot self.element.
+00020ab0: 6469 6d65 6e73 696f 6e2e 656c 656d 656e  dimension.elemen
+00020ac0: 7473 2e5f 656c 656d 656e 7473 5f72 6561  ts._elements_rea
+00020ad0: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00020ae0: 7365 6c66 2e65 6c65 6d65 6e74 2e64 696d  self.element.dim
+00020af0: 656e 7369 6f6e 2e66 6965 6c64 732e 5f61  ension.fields._a
+00020b00: 6464 5f66 6965 6c64 5f6e 616d 6528 6b65  dd_field_name(ke
+00020b10: 792c 6672 6f6d 5f65 6d70 6f77 6572 3d46  y,from_empower=F
+00020b20: 616c 7365 290d 0a0d 0a20 2020 2020 2020  alse)....       
+00020b30: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00020b40: 2020 2069 6620 7365 6c66 2e5f 6669 656c     if self._fiel
+00020b50: 6473 5b6b 6579 5d20 3d3d 2069 7465 6d3a  ds[key] == item:
+00020b60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00020b70: 2020 2364 6f6e 2774 2064 6f20 616e 7974    #don't do anyt
+00020b80: 6869 6e67 2028 696e 636c 7564 696e 6720  hing (including 
+00020b90: 7265 636f 7264 696e 6720 616e 2065 6469  recording an edi
+00020ba0: 7429 2069 6620 7468 6520 6974 656d 2069  t) if the item i
+00020bb0: 7320 616c 7265 6164 7920 7468 6520 7361  s already the sa
+00020bc0: 6d65 2061 7320 7468 6520 7661 6c75 650d  me as the value.
+00020bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020be0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
+00020bf0: 2020 2020 2065 6c69 6620 6b65 7920 3d3d       elif key ==
+00020c00: 2027 4361 6c63 756c 6174 696f 6e27 3a0d   'Calculation':.
+00020c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020c20: 2023 4361 6c63 756c 6174 696f 6e20 6861   #Calculation ha
+00020c30: 7320 6368 616e 6765 6420 2874 6f20 7368  s changed (to sh
+00020c40: 6f72 746e 616d 6520 6261 7365 6420 636f  ortname based co
+00020c50: 6e73 6f6c 6964 6174 696f 6e20 7072 6f62  nsolidation prob
+00020c60: 6162 6c79 290d 0a20 2020 2020 2020 2020  ably)..         
+00020c70: 2020 2020 2020 2023 6275 7420 7468 6520         #but the 
+00020c80: 756e 6465 726c 7969 6e67 2063 616c 6375  underlying calcu
+00020c90: 6c61 7469 6f6e 2069 7320 7468 6520 7361  lation is the sa
+00020ca0: 6d65 2c20 6265 6361 7573 6520 456d 706f  me, because Empo
+00020cb0: 7765 7220 6578 706f 7274 6564 2074 6865  wer exported the
+00020cc0: 2070 6879 7369 6420 7374 7269 6e67 2c20   physid string, 
+00020cd0: 7768 6572 6561 7320 6974 2072 6571 7569  whereas it requi
+00020ce0: 7265 7320 7468 6520 7368 6f72 746e 616d  res the shortnam
+00020cf0: 6573 0d0a 2020 2020 2020 2020 2020 2020  es..            
+00020d00: 2020 2020 2373 6f20 6368 6563 6b20 6966      #so check if
+00020d10: 2074 6865 2070 6879 7369 6420 7665 7273   the physid vers
+00020d20: 696f 6e20 6f66 2074 6865 2063 616c 6375  ion of the calcu
+00020d30: 6c61 7469 6f6e 2068 6173 2063 6861 6e67  lation has chang
+00020d40: 6564 202d 2069 6620 6e6f 7420 7468 656e  ed - if not then
+00020d50: 2063 6861 6e67 6520 6974 2062 7574 2064   change it but d
+00020d60: 6f6e 2774 206d 6172 6b20 7468 6520 6669  on't mark the fi
+00020d70: 656c 6473 2061 7320 6564 6974 6564 2e0d  elds as edited..
+00020d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020d90: 2069 6620 7365 6c66 2e65 6c65 6d65 6e74   if self.element
+00020da0: 2e5f 7068 7973 6964 5f63 616c 6375 6c61  ._physid_calcula
+00020db0: 7469 6f6e 203d 3d20 7365 6c66 2e5f 6669  tion == self._fi
+00020dc0: 656c 6473 5b6b 6579 5d3a 0d0a 2020 2020  elds[key]:..    
+00020dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020de0: 7365 6c66 2e5f 6669 656c 6473 5b6b 6579  self._fields[key
+00020df0: 5d20 2020 2020 2020 2020 2020 2020 3d20  ]             = 
+00020e00: 6974 656d 0d0a 2020 2020 2020 2020 2020  item..          
+00020e10: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00020e20: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6578  ......        ex
+00020e30: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
+00020e40: 2020 2020 2020 2020 2020 2020 2369 6620              #if 
+00020e50: 206b 6579 203d 3d20 2744 6573 6372 6970   key == 'Descrip
+00020e60: 7469 6f6e 273a 0d0a 2020 2020 2020 2020  tion':..        
+00020e70: 2020 2020 2320 2020 2074 7279 3a0d 0a20      #    try:.. 
+00020e80: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00020e90: 2020 2020 7072 696e 7428 277b 7d20 7b7d      print('{} {}
+00020ea0: 2065 6469 7465 6420 7b7d 2e20 7b7d 202d   edited {}. {} -
+00020eb0: 3e20 7b7d 2027 2e66 6f72 6d61 7428 7365  > {} '.format(se
+00020ec0: 6c66 2e65 6c65 6d65 6e74 2e70 6879 7369  lf.element.physi
+00020ed0: 642c 2073 656c 662e 656c 656d 656e 742e  d, self.element.
+00020ee0: 7368 6f72 746e 616d 652c 6b65 792c 7365  shortname,key,se
+00020ef0: 6c66 2e5f 6669 656c 6473 5b6b 6579 5d2c  lf._fields[key],
+00020f00: 6974 656d 2929 0d0a 2020 2020 2020 2020  item))..        
+00020f10: 2020 2020 2320 2020 2065 7863 6570 7420      #    except 
+00020f20: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
+00020f30: 2020 2020 2020 2023 2020 2020 2020 2020         #        
+00020f40: 7072 696e 7428 277b 7d20 7b7d 2065 6469  print('{} {} edi
+00020f50: 7465 6420 7b7d 2e20 7b7d 202d 3e20 7b7d  ted {}. {} -> {}
+00020f60: 2027 2e66 6f72 6d61 7428 7365 6c66 2e65   '.format(self.e
+00020f70: 6c65 6d65 6e74 2e70 6879 7369 642c 2073  lement.physid, s
+00020f80: 656c 662e 656c 656d 656e 742e 7368 6f72  elf.element.shor
+00020f90: 746e 616d 652c 6b65 792c 4e6f 6e65 2c69  tname,key,None,i
+00020fa0: 7465 6d29 290d 0a20 2020 2020 2020 2020  tem))..         
+00020fb0: 2020 2070 6173 730d 0a0d 0a0d 0a20 2020     pass......   
+00020fc0: 2020 2020 2073 656c 662e 5f66 6965 6c64       self._field
+00020fd0: 735b 6b65 795d 2020 2020 2020 2020 2020  s[key]          
+00020fe0: 2020 203d 2069 7465 6d0d 0a20 2020 2020     = item..     
+00020ff0: 2020 2073 656c 662e 5f66 6965 6c64 5f65     self._field_e
+00021000: 6469 7473 5b6b 6579 5d20 2020 2020 2020  dits[key]       
+00021010: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+00021020: 2073 656c 662e 656c 656d 656e 742e 5f65   self.element._e
+00021030: 6469 7465 6420 2020 2020 2020 2020 203d  dited          =
+00021040: 2054 7275 650d 0a20 2020 2020 2020 2073   True..        s
+00021050: 656c 662e 656c 656d 656e 742e 5f73 796e  elf.element._syn
+00021060: 6368 6564 2020 2020 2020 2020 203d 2046  ched         = F
+00021070: 616c 7365 0d0a 0d0a 0d0a 2020 2020 6465  alse......    de
+00021080: 6620 6b65 7973 2873 656c 6629 3a0d 0a20  f keys(self):.. 
+00021090: 2020 2020 2020 2023 6966 206e 6f74 2073         #if not s
+000210a0: 656c 662e 6469 6d65 6e73 696f 6e2e 5f65  elf.dimension._e
+000210b0: 6c65 6d65 6e74 735f 7265 6164 3a0d 0a20  lements_read:.. 
+000210c0: 2020 2020 2020 2023 2020 2020 7365 6c66         #    self
+000210d0: 2e5f 6c6f 6164 5f65 6c65 6d65 6e74 7328  ._load_elements(
+000210e0: 290d 0a0d 0a20 2020 2020 2020 2072 6574  )....        ret
+000210f0: 7572 6e20 7365 6c66 2e5f 6669 656c 6473  urn self._fields
+00021100: 2e6b 6579 7328 290d 0a0d 0a20 2020 2064  .keys()....    d
+00021110: 6566 2069 7465 6d73 2873 656c 6629 3a0d  ef items(self):.
+00021120: 0a20 2020 2020 2020 2023 6966 206e 6f74  .        #if not
+00021130: 2073 656c 662e 6469 6d65 6e73 696f 6e2e   self.dimension.
+00021140: 5f65 6c65 6d65 6e74 735f 7265 6164 3a0d  _elements_read:.
+00021150: 0a20 2020 2020 2020 2023 2020 2020 7365  .        #    se
+00021160: 6c66 2e5f 6c6f 6164 5f65 6c65 6d65 6e74  lf._load_element
+00021170: 7328 290d 0a0d 0a20 2020 2020 2020 2072  s()....        r
+00021180: 6574 7572 6e20 7365 6c66 2e5f 6669 656c  eturn self._fiel
+00021190: 6473 2e69 7465 6d73 2829 0d0a 0d0a 2020  ds.items()....  
+000211a0: 2020 6465 6620 7661 6c75 6573 2873 656c    def values(sel
+000211b0: 6629 3a0d 0a20 2020 2020 2020 2023 6966  f):..        #if
+000211c0: 206e 6f74 2073 656c 662e 6469 6d65 6e73   not self.dimens
+000211d0: 696f 6e2e 5f65 6c65 6d65 6e74 735f 7265  ion._elements_re
+000211e0: 6164 3a0d 0a20 2020 2020 2020 2020 2320  ad:..         # 
+000211f0: 2020 7365 6c66 2e5f 6c6f 6164 5f65 6c65    self._load_ele
+00021200: 6d65 6e74 7328 290d 0a0d 0a20 2020 2020  ments()....     
+00021210: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00021220: 6669 656c 6473 2e76 616c 7565 7328 290d  fields.values().
+00021230: 0a0d 0a20 2020 2064 6566 205f 5f6c 656e  ...    def __len
+00021240: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
+00021250: 2020 2023 6966 206e 6f74 2073 656c 662e     #if not self.
+00021260: 6469 6d65 6e73 696f 6e2e 5f65 6c65 6d65  dimension._eleme
+00021270: 6e74 735f 7265 6164 3a0d 0a20 2020 2020  nts_read:..     
+00021280: 2020 2023 2020 2020 7365 6c66 2e5f 6c6f     #    self._lo
+00021290: 6164 5f65 6c65 6d65 6e74 7328 290d 0a0d  ad_elements()...
+000212a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000212b0: 6c65 6e28 7365 6c66 2e5f 6669 656c 6473  len(self._fields
+000212c0: 290d 0a0d 0a20 2020 2064 6566 205f 5f73  )....    def __s
+000212d0: 7472 5f5f 2873 656c 6629 3a0d 0a20 2020  tr__(self):..   
+000212e0: 2020 2020 2072 6574 7572 6e20 7374 7228       return str(
+000212f0: 7365 6c66 2e5f 6669 656c 6473 290d 0a0d  self._fields)...
+00021300: 0a20 2020 2064 6566 205f 5f72 6570 725f  .    def __repr_
+00021310: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+00021320: 2020 7265 7475 726e 2027 7b7d 2066 726f    return '{} fro
+00021330: 6d20 3c7b 7d20 6f62 6a65 6374 2061 7420  m <{} object at 
+00021340: 7b7d 3e27 2e66 6f72 6d61 7428 277b 2720  {}>'.format('{' 
+00021350: 2b20 275c 6e27 2e6a 6f69 6e28 5b20 2227  + '\n'.join([ "'
+00021360: 7b7d 273a 7b7d 222e 666f 726d 6174 286b  {}':{}".format(k
+00021370: 2c72 6570 7228 7629 2920 666f 7220 6b2c  ,repr(v)) for k,
+00021380: 7620 696e 2073 656c 662e 6974 656d 7328  v in self.items(
+00021390: 295d 2920 2b20 277d 272c 7365 6c66 2e5f  )]) + '}',self._
+000213a0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+000213b0: 5f2c 6865 7828 6964 2873 656c 6629 2920  _,hex(id(self)) 
+000213c0: 2029 0d0a 0d0a 0d0a 636c 6173 7320 5f44   )......class _D
+000213d0: 696d 656e 7369 6f6e 4669 656c 6473 4765  imensionFieldsGe
+000213e0: 7474 6572 286f 626a 6563 7429 3a0d 0a20  tter(object):.. 
+000213f0: 2020 2027 2727 446f 6573 2061 2062 6974     '''Does a bit
+00021400: 206f 6620 6d61 6769 6320 746f 2061 6c6c   of magic to all
+00021410: 6f77 2044 696d 656e 7369 6f6e 2e66 6965  ow Dimension.fie
+00021420: 6c64 7320 746f 2068 6176 6520 7c3d 2061  lds to have |= a
+00021430: 6e64 2073 696d 696c 6172 206d 6167 6963  nd similar magic
+00021440: 206d 6574 686f 6473 2061 7070 6c69 6564   methods applied
+00021450: 2727 270d 0a20 2020 2064 6566 205f 5f69  '''..    def __i
+00021460: 6e69 745f 5f28 7365 6c66 2c64 696d 656e  nit__(self,dimen
+00021470: 7369 6f6e 293a 0d0a 2020 2020 2020 2020  sion):..        
+00021480: 7365 6c66 2e64 696d 656e 7369 6f6e 3d64  self.dimension=d
+00021490: 696d 656e 7369 6f6e 0d0a 0d0a 2020 2020  imension....    
+000214a0: 2020 2020 7365 6c66 2e5f 6669 656c 6473      self._fields
+000214b0: 203d 2063 6f6c 6c65 6374 696f 6e73 2e4f   = collections.O
+000214c0: 7264 6572 6564 4469 6374 2829 0d0a 2020  rderedDict()..  
+000214d0: 2020 2020 2020 7365 6c66 2e5f 6669 656c        self._fiel
+000214e0: 645f 6e61 6d65 735f 696e 5f65 6d70 6f77  d_names_in_empow
+000214f0: 6572 203d 2063 6f6c 6c65 6374 696f 6e73  er = collections
+00021500: 2e4f 7264 6572 6564 4469 6374 2829 0d0a  .OrderedDict()..
+00021510: 0d0a 2020 2020 6465 6620 5f61 6464 5f66  ..    def _add_f
+00021520: 6965 6c64 5f6e 616d 6528 7365 6c66 2c66  ield_name(self,f
+00021530: 6965 6c64 6e61 6d65 2c66 726f 6d5f 656d  ieldname,from_em
+00021540: 706f 7765 723d 4661 6c73 6529 3a0d 0a20  power=False):.. 
+00021550: 2020 2020 2020 2023 544f 444f 202d 2061         #TODO - a
+00021560: 7320 736f 6f6e 2061 7320 7765 2063 616e  s soon as we can
+00021570: 2067 6574 2066 6965 6c64 206e 616d 6573   get field names
+00021580: 2028 616c 6f6e 6529 2069 6e74 6f20 7468   (alone) into th
+00021590: 6520 6469 6d65 6e73 696f 6e20 6672 6f6d  e dimension from
+000215a0: 2045 6d70 6f77 6572 2067 6574 2072 6964   Empower get rid
+000215b0: 206f 6620 7468 6973 2e20 4974 2069 7320   of this. It is 
+000215c0: 736c 6f77 696e 6720 646f 776e 2073 6f20  slowing down so 
+000215d0: 6d61 6e79 206f 7468 6572 2066 756e 6374  many other funct
+000215e0: 696f 6e20 6361 6c6c 730d 0a0d 0a20 2020  ion calls....   
+000215f0: 2020 2020 2069 6620 6669 656c 646e 616d       if fieldnam
+00021600: 6520 6973 204e 6f6e 653a 0d0a 2020 2020  e is None:..    
+00021610: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00021620: 6c75 6545 7272 6f72 2827 4469 6d65 6e73  lueError('Dimens
+00021630: 696f 6e20 6669 656c 6473 2063 616e 206e  ion fields can n
+00021640: 6f74 2068 6176 6520 616e 2065 6d70 7479  ot have an empty
+00021650: 2028 4e6f 6e65 2920 6b65 7920 666f 7220   (None) key for 
+00021660: 6974 656d 2729 0d0a 0d0a 2020 2020 2020  item')....      
+00021670: 2020 7365 6c66 2e5f 6669 656c 6473 5b66    self._fields[f
+00021680: 6965 6c64 6e61 6d65 5d20 3d20 4669 656c  ieldname] = Fiel
+00021690: 6444 6566 696e 6974 696f 6e28 6c6f 6e67  dDefinition(long
+000216a0: 6e61 6d65 3d66 6965 6c64 6e61 6d65 290d  name=fieldname).
+000216b0: 0a0d 0a20 2020 2020 2020 2069 6620 6672  ...        if fr
+000216c0: 6f6d 5f65 6d70 6f77 6572 3a0d 0a20 2020  om_empower:..   
+000216d0: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+000216e0: 6965 6c64 5f6e 616d 6573 5f69 6e5f 656d  ield_names_in_em
+000216f0: 706f 7765 725b 6669 656c 646e 616d 655d  power[fieldname]
+00021700: 203d 2066 6965 6c64 6e61 6d65 0d0a 0d0a   = fieldname....
+00021710: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+00021720: 2020 2064 6566 205f 6e65 775f 6669 656c     def _new_fiel
+00021730: 645f 6e61 6d65 7328 7365 6c66 293a 0d0a  d_names(self):..
+00021740: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
+00021750: 656c 662e 5f66 6965 6c64 7329 203d 3d20  elf._fields) == 
+00021760: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
+00021770: 7265 7475 726e 0d0a 0d0a 2020 2020 2020  return....      
+00021780: 2020 2727 2759 6965 6c64 2061 6c6c 2066    '''Yield all f
+00021790: 6965 6c64 206e 616d 6573 2074 6861 7420  ield names that 
+000217a0: 6172 6520 6e6f 7420 696e 2045 6d70 6f77  are not in Empow
+000217b0: 6572 202d 2074 6865 7927 6c6c 2062 6520  er - they'll be 
+000217c0: 6e65 7727 2727 0d0a 2020 2020 2020 2020  new'''..        
+000217d0: 666f 7220 6620 696e 2073 656c 662e 6b65  for f in self.ke
+000217e0: 7973 2829 3a0d 0a20 2020 2020 2020 2020  ys():..         
+000217f0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00021800: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+00021810: 6965 6c64 5f6e 616d 6573 5f69 6e5f 656d  ield_names_in_em
+00021820: 706f 7765 725b 665d 0d0a 2020 2020 2020  power[f]..      
+00021830: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+00021840: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+00021850: 2020 2020 2020 2020 6966 2066 2069 7320          if f is 
+00021860: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00021870: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00021880: 6965 6c64 2066 0d0a 0d0a 2020 2020 6465  ield f....    de
+00021890: 6620 5f5f 696f 725f 5f28 7365 6c66 2c6f  f __ior__(self,o
+000218a0: 7468 6572 293a 0d0a 2020 2020 2020 2020  ther):..        
+000218b0: 6b3d 4e6f 6e65 0d0a 2020 2020 2020 2020  k=None..        
+000218c0: 763d 4e6f 6e65 0d0a 2020 2020 2020 2020  v=None..        
+000218d0: 6966 2069 7369 6e73 7461 6e63 6528 6f74  if isinstance(ot
+000218e0: 6865 722c 4669 656c 6444 6566 696e 6974  her,FieldDefinit
+000218f0: 696f 6e29 3a0d 0a20 2020 2020 2020 2020  ion):..         
+00021900: 2020 2069 6620 6f74 6865 722e 7368 6f72     if other.shor
+00021910: 746e 616d 6520 6973 204e 6f6e 653a 0d0a  tname is None:..
+00021920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021930: 6b3d 6f74 6865 722e 6c6f 6e67 6e61 6d65  k=other.longname
+00021940: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00021950: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00021960: 2020 2020 206b 3d6f 7468 6572 2e73 686f       k=other.sho
+00021970: 7274 6e61 6d65 0d0a 2020 2020 2020 2020  rtname..        
+00021980: 2020 2020 763d 6f74 6865 720d 0a20 2020      v=other..   
+00021990: 2020 2020 2065 6c69 6620 7374 7228 6f74       elif str(ot
+000219a0: 6865 7229 3d3d 6f74 6865 723a 0d0a 2020  her)==other:..  
+000219b0: 2020 2020 2020 2020 2020 6b20 3d20 6f74            k = ot
+000219c0: 6865 720d 0a20 2020 2020 2020 2020 2020  her..           
+000219d0: 2076 203d 2046 6965 6c64 4465 6669 6e69   v = FieldDefini
+000219e0: 7469 6f6e 2873 686f 7274 6e61 6d65 3d6f  tion(shortname=o
+000219f0: 7468 6572 2c6c 6f6e 676e 616d 653d 6f74  ther,longname=ot
+00021a00: 6865 7229 0d0a 2020 2020 2020 2020 656c  her)..        el
+00021a10: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00021a20: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+00021a30: 2822 756e 7375 7070 6f72 7465 6420 6f70  ("unsupported op
+00021a40: 6572 616e 6420 7479 7065 7328 7329 2066  erand types(s) f
+00021a50: 6f72 207c 3d3a 2027 5f44 696d 656e 7369  or |=: '_Dimensi
+00021a60: 6f6e 4669 656c 6473 4765 7474 6572 2720  onFieldsGetter' 
+00021a70: 616e 6420 277b 7d27 222e 666f 726d 6174  and '{}'".format
+00021a80: 2874 7970 6528 6f74 6865 7229 2929 0d0a  (type(other)))..
+00021a90: 0d0a 2020 2020 2020 2020 234f 6e6c 7920  ..        #Only 
+00021aa0: 6164 6420 6966 2064 6f65 736e 2774 2065  add if doesn't e
+00021ab0: 7869 7374 2061 6c72 6561 6479 0d0a 2020  xist already..  
+00021ac0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00021ad0: 2020 2020 2020 2020 7365 6c66 5b6b 5d0d          self[k].
+00021ae0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00021af0: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
+00021b00: 2020 2020 2020 2073 656c 665b 6b5d 203d         self[k] =
+00021b10: 2076 0d0a 2020 2020 2020 2020 2372 6574   v..        #ret
+00021b20: 7572 6e20 7365 6c66 2c20 6265 6361 7573  urn self, becaus
+00021b30: 6520 7468 6174 2069 7320 7768 6174 205f  e that is what _
+00021b40: 5f69 6f72 5f5f 206d 7573 7420 616c 7761  _ior__ must alwa
+00021b50: 7973 2064 6f0d 0a20 2020 2020 2020 2072  ys do..        r
+00021b60: 6574 7572 6e20 7365 6c66 0d0a 0d0a 2020  eturn self....  
+00021b70: 2020 6465 6620 5f5f 6961 6464 5f5f 2873    def __iadd__(s
+00021b80: 656c 662c 6f74 6865 7229 3a0d 0a20 2020  elf,other):..   
+00021b90: 2020 2020 206b 3d4e 6f6e 650d 0a20 2020       k=None..   
+00021ba0: 2020 2020 2076 3d4e 6f6e 650d 0a20 2020       v=None..   
+00021bb0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00021bc0: 6365 286f 7468 6572 2c46 6965 6c64 4465  ce(other,FieldDe
+00021bd0: 6669 6e69 7469 6f6e 293a 0d0a 2020 2020  finition):..    
+00021be0: 2020 2020 2020 2020 6966 206f 7468 6572          if other
+00021bf0: 2e73 686f 7274 6e61 6d65 2069 7320 4e6f  .shortname is No
+00021c00: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00021c10: 2020 2020 206b 3d6f 7468 6572 2e6c 6f6e       k=other.lon
+00021c20: 676e 616d 650d 0a20 2020 2020 2020 2020  gname..         
+00021c30: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00021c40: 2020 2020 2020 2020 2020 6b3d 6f74 6865            k=othe
+00021c50: 722e 7368 6f72 746e 616d 650d 0a20 2020  r.shortname..   
+00021c60: 2020 2020 2020 2020 2076 3d6f 7468 6572           v=other
+00021c70: 0d0a 2020 2020 2020 2020 656c 6966 2073  ..        elif s
+00021c80: 7472 286f 7468 6572 293d 3d6f 7468 6572  tr(other)==other
+00021c90: 3a0d 0a20 2020 2020 2020 2020 2020 206b  :..            k
+00021ca0: 203d 206f 7468 6572 0d0a 2020 2020 2020   = other..      
+00021cb0: 2020 2020 2020 7620 3d20 4669 656c 6444        v = FieldD
+00021cc0: 6566 696e 6974 696f 6e28 7368 6f72 746e  efinition(shortn
+00021cd0: 616d 653d 6f74 6865 722c 6c6f 6e67 6e61  ame=other,longna
+00021ce0: 6d65 3d6f 7468 6572 290d 0a20 2020 2020  me=other)..     
+00021cf0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00021d00: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
+00021d10: 4572 726f 7228 2275 6e73 7570 706f 7274  Error("unsupport
+00021d20: 6564 206f 7065 7261 6e64 2074 7970 6573  ed operand types
+00021d30: 2873 2920 666f 7220 7c3d 3a20 275f 4469  (s) for |=: '_Di
+00021d40: 6d65 6e73 696f 6e46 6965 6c64 7347 6574  mensionFieldsGet
+00021d50: 7465 7227 2061 6e64 2027 7b7d 2722 2e66  ter' and '{}'".f
+00021d60: 6f72 6d61 7428 7479 7065 286f 7468 6572  ormat(type(other
+00021d70: 2929 290d 0a0d 0a20 2020 2020 2020 2073  )))....        s
+00021d80: 656c 665b 6b5d 203d 2076 0d0a 2020 2020  elf[k] = v..    
+00021d90: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
+00021da0: 0a0d 0a20 2020 2064 6566 205f 5f69 7465  ...    def __ite
+00021db0: 725f 5f28 7365 6c66 293a 0d0a 2020 2020  r__(self):..    
+00021dc0: 2020 2020 7365 6c66 2e5f 6974 6572 6174      self._iterat
+00021dd0: 6f72 203d 2069 7465 7228 7365 6c66 2e6b  or = iter(self.k
+00021de0: 6579 7328 2929 0d0a 2020 2020 2020 2020  eys())..        
+00021df0: 7265 7475 726e 2073 656c 660d 0a0d 0a20  return self.... 
+00021e00: 2020 2064 6566 205f 5f6e 6578 745f 5f28     def __next__(
+00021e10: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00021e20: 7265 7475 726e 206e 6578 7428 7365 6c66  return next(self
+00021e30: 2e5f 6974 6572 6174 6f72 290d 0a0d 0a20  ._iterator).... 
+00021e40: 2020 2064 6566 205f 5f67 6574 6974 656d     def __getitem
+00021e50: 5f5f 2873 656c 662c 6974 656d 293a 0d0a  __(self,item):..
+00021e60: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00021e70: 656c 662e 5f66 6965 6c64 735b 6974 656d  elf._fields[item
+00021e80: 5d0d 0a0d 0a20 2020 2064 6566 205f 5f73  ]....    def __s
+00021e90: 6574 6974 656d 5f5f 2873 656c 662c 206b  etitem__(self, k
+00021ea0: 6579 2c20 6974 656d 293a 0d0a 2020 2020  ey, item):..    
+00021eb0: 2020 2020 2369 6620 6e6f 7420 7365 6c66      #if not self
+00021ec0: 2e64 696d 656e 7369 6f6e 2e5f 656c 656d  .dimension._elem
+00021ed0: 656e 7473 5f72 6561 643a 0d0a 2020 2020  ents_read:..    
+00021ee0: 2020 2020 2320 2020 2073 656c 662e 5f6c      #    self._l
+00021ef0: 6f61 645f 656c 656d 656e 7473 2829 0d0a  oad_elements()..
+00021f00: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+00021f10: 7369 6e73 7461 6e63 6528 6974 656d 2c20  sinstance(item, 
+00021f20: 4669 656c 6444 6566 696e 6974 696f 6e29  FieldDefinition)
+00021f30: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00021f40: 6169 7365 2054 7970 6545 7272 6f72 2822  aise TypeError("
+00021f50: 596f 7520 6361 6e20 6f6e 6c79 2073 6574  You can only set
+00021f60: 2061 2044 696d 656e 7369 6f6e 2773 2066   a Dimension's f
+00021f70: 6965 6c64 7320 746f 2062 6520 4669 656c  ields to be Fiel
+00021f80: 6444 6566 696e 6974 696f 6e20 6f62 6a65  dDefinition obje
+00021f90: 6374 732e 2045 7870 6563 7469 6e67 206f  cts. Expecting o
+00021fa0: 626a 6563 7420 6f66 2074 7970 6520 4669  bject of type Fi
+00021fb0: 656c 6444 6566 696e 6974 696f 6e2c 2067  eldDefinition, g
+00021fc0: 6f74 206f 626a 6563 7420 7b7d 206f 6620  ot object {} of 
+00021fd0: 7479 7065 207b 7d22 2e66 6f72 6d61 7428  type {}".format(
+00021fe0: 6974 656d 2c20 7479 7065 2869 7465 6d29  item, type(item)
+00021ff0: 2929 0d0a 0d0a 2020 2020 2020 2020 6966  ))....        if
+00022000: 2069 7465 6d2e 6c6f 6e67 6e61 6d65 2069   item.longname i
+00022010: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00022020: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00022030: 4572 726f 7228 2259 6f75 2063 616e 206f  Error("You can o
+00022040: 6e6c 7920 7365 7420 6120 4469 6d65 6e73  nly set a Dimens
+00022050: 696f 6e27 7320 6669 656c 6473 2074 6f20  ion's fields to 
+00022060: 6265 2046 6965 6c64 4465 6669 6e69 7469  be FieldDefiniti
+00022070: 6f6e 206f 626a 6563 7420 7769 7468 2061  on object with a
+00022080: 206c 6f6e 676e 616d 652e 2054 6865 206c   longname. The l
+00022090: 6f6e 676e 616d 6520 6973 2073 6574 2074  ongname is set t
+000220a0: 6f20 4e6f 6e65 2077 6869 6368 2069 7320  o None which is 
+000220b0: 6e6f 7420 6163 6365 7074 6162 6c65 2069  not acceptable i
+000220c0: 6e20 456d 706f 7765 722c 2066 6f72 206f  n Empower, for o
+000220d0: 626a 6563 7420 7b7d 222e 666f 726d 6174  bject {}".format
+000220e0: 2869 7465 6d29 290d 0a0d 0a20 2020 2020  (item))....     
+000220f0: 2020 2023 4164 6420 6669 656c 6420 6e61     #Add field na
+00022100: 6d65 7320 6966 2077 6520 6861 7665 6e27  mes if we haven'
+00022110: 7420 7265 6164 2074 6865 2064 696d 656e  t read the dimen
+00022120: 7369 6f6e 2079 6574 0d0a 2020 2020 2020  sion yet..      
+00022130: 2020 6966 206e 6f74 2073 656c 662e 6469    if not self.di
+00022140: 6d65 6e73 696f 6e20 6973 204e 6f6e 6520  mension is None 
+00022150: 616e 6420 6e6f 7420 7365 6c66 2e64 696d  and not self.dim
+00022160: 656e 7369 6f6e 2e65 6c65 6d65 6e74 732e  ension.elements.
+00022170: 5f65 6c65 6d65 6e74 735f 7265 6164 3a0d  _elements_read:.
+00022180: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00022190: 662e 5f61 6464 5f66 6965 6c64 5f6e 616d  f._add_field_nam
+000221a0: 6528 6b65 792c 6672 6f6d 5f65 6d70 6f77  e(key,from_empow
+000221b0: 6572 3d46 616c 7365 290d 0a0d 0a20 2020  er=False)....   
+000221c0: 2020 2020 2069 6620 6b65 7920 6973 204e       if key is N
+000221d0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000221e0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+000221f0: 6f72 2827 4469 6d65 6e73 696f 6e20 6669  or('Dimension fi
+00022200: 656c 6473 2063 616e 206e 6f74 2068 6176  elds can not hav
+00022210: 6520 616e 2065 6d70 7479 2028 4e6f 6e65  e an empty (None
+00022220: 2920 6b65 7920 666f 7220 6974 656d 3a20  ) key for item: 
+00022230: 7b7d 272e 666f 726d 6174 2869 7465 6d29  {}'.format(item)
+00022240: 290d 0a0d 0a20 2020 2020 2020 2073 656c  )....        sel
+00022250: 662e 5f66 6965 6c64 735b 6b65 795d 2020  f._fields[key]  
+00022260: 2020 2020 2020 2020 2020 203d 2069 7465             = ite
+00022270: 6d0d 0a0d 0a20 2020 2064 6566 206b 6579  m....    def key
+00022280: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+00022290: 2020 2369 6620 6e6f 7420 7365 6c66 2e64    #if not self.d
+000222a0: 696d 656e 7369 6f6e 2e5f 656c 656d 656e  imension._elemen
+000222b0: 7473 5f72 6561 643a 0d0a 2020 2020 2020  ts_read:..      
+000222c0: 2020 2320 2020 2073 656c 662e 5f6c 6f61    #    self._loa
+000222d0: 645f 656c 656d 656e 7473 2829 0d0a 0d0a  d_elements()....
+000222e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000222f0: 656c 662e 5f66 6965 6c64 732e 6b65 7973  elf._fields.keys
+00022300: 2829 0d0a 0d0a 2020 2020 6465 6620 6974  ()....    def it
+00022310: 656d 7328 7365 6c66 293a 0d0a 2020 2020  ems(self):..    
+00022320: 2020 2020 2369 6620 6e6f 7420 7365 6c66      #if not self
+00022330: 2e64 696d 656e 7369 6f6e 2e5f 656c 656d  .dimension._elem
+00022340: 656e 7473 5f72 6561 643a 0d0a 2020 2020  ents_read:..    
+00022350: 2020 2020 2320 2020 2073 656c 662e 5f6c      #    self._l
+00022360: 6f61 645f 656c 656d 656e 7473 2829 0d0a  oad_elements()..
+00022370: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00022380: 2073 656c 662e 5f66 6965 6c64 732e 6974   self._fields.it
+00022390: 656d 7328 290d 0a0d 0a20 2020 2064 6566  ems()....    def
+000223a0: 2076 616c 7565 7328 7365 6c66 293a 0d0a   values(self):..
+000223b0: 2020 2020 2020 2020 2369 6620 6e6f 7420          #if not 
+000223c0: 7365 6c66 2e64 696d 656e 7369 6f6e 2e5f  self.dimension._
+000223d0: 656c 656d 656e 7473 5f72 6561 643a 0d0a  elements_read:..
+000223e0: 2020 2020 2020 2020 2023 2020 2073 656c           #   sel
+000223f0: 662e 5f6c 6f61 645f 656c 656d 656e 7473  f._load_elements
+00022400: 2829 0d0a 0d0a 2020 2020 2020 2020 7265  ()....        re
+00022410: 7475 726e 2073 656c 662e 5f66 6965 6c64  turn self._field
+00022420: 732e 7661 6c75 6573 2829 0d0a 0d0a 2020  s.values()....  
+00022430: 2020 6465 6620 5f5f 6c65 6e5f 5f28 7365    def __len__(se
+00022440: 6c66 293a 0d0a 2020 2020 2020 2020 2369  lf):..        #i
+00022450: 6620 6e6f 7420 7365 6c66 2e64 696d 656e  f not self.dimen
+00022460: 7369 6f6e 2e5f 656c 656d 656e 7473 5f72  sion._elements_r
+00022470: 6561 643a 0d0a 2020 2020 2020 2020 2320  ead:..        # 
+00022480: 2020 2073 656c 662e 5f6c 6f61 645f 656c     self._load_el
+00022490: 656d 656e 7473 2829 0d0a 0d0a 2020 2020  ements()....    
+000224a0: 2020 2020 7265 7475 726e 206c 656e 2873      return len(s
+000224b0: 656c 662e 5f66 6965 6c64 7329 0d0a 0d0a  elf._fields)....
+000224c0: 2020 2020 6465 6620 5f5f 7374 725f 5f28      def __str__(
+000224d0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+000224e0: 7265 7475 726e 2073 7472 2873 656c 662e  return str(self.
+000224f0: 5f66 6965 6c64 7329 0d0a 0d0a 2020 2020  _fields)....    
+00022500: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
+00022510: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+00022520: 7572 6e20 277b 7d20 6672 6f6d 203c 7b7d  urn '{} from <{}
+00022530: 206f 626a 6563 7420 6174 207b 7d3e 272e   object at {}>'.
+00022540: 666f 726d 6174 2827 7b27 202b 2027 5c6e  format('{' + '\n
+00022550: 272e 6a6f 696e 285b 2022 277b 7d27 3a7b  '.join([ "'{}':{
+00022560: 7d22 2e66 6f72 6d61 7428 6b2c 7265 7072  }".format(k,repr
+00022570: 2876 2929 2066 6f72 206b 2c76 2069 6e20  (v)) for k,v in 
+00022580: 7365 6c66 2e69 7465 6d73 2829 5d29 202b  self.items()]) +
+00022590: 2027 7d27 2c73 656c 662e 5f5f 636c 6173   '}',self.__clas
+000225a0: 735f 5f2e 5f5f 6e61 6d65 5f5f 2c68 6578  s__.__name__,hex
+000225b0: 2869 6428 7365 6c66 2929 2020 290d 0a0d  (id(self))  )...
+000225c0: 0a63 6c61 7373 205f 5365 6375 7269 7479  .class _Security
+000225d0: 5573 6572 7347 6574 7465 7228 6f62 6a65  UsersGetter(obje
+000225e0: 6374 293a 0d0a 2020 2020 2727 2744 6f65  ct):..    '''Doe
+000225f0: 7320 6120 6269 7420 6f66 206d 6167 6963  s a bit of magic
+00022600: 2074 6f20 616c 6c6f 7720 456c 656d 656e   to allow Elemen
+00022610: 7473 2074 6f20 6861 7665 2076 6965 7765  ts to have viewe
+00022620: 7273 2c20 6d6f 6469 6669 6572 7320 616e  rs, modifiers an
+00022630: 6420 6461 7461 5f76 6965 7765 7273 2061  d data_viewers a
+00022640: 7474 7269 6275 7465 7320 7468 6174 206c  ttributes that l
+00022650: 617a 7920 6c6f 6164 2061 6e64 2072 6563  azy load and rec
+00022660: 6f72 6420 6564 6974 696e 6720 6368 616e  ord editing chan
+00022670: 6765 730d 0a20 2020 205f 5365 6375 7269  ges..    _Securi
+00022680: 7479 5573 6572 7347 6574 7465 7220 6265  tyUsersGetter be
+00022690: 6861 7665 7320 6c69 6b65 2061 206c 6973  haves like a lis
+000226a0: 7420 286f 6620 7573 6572 2073 686f 7274  t (of user short
+000226b0: 636f 6465 7329 0d0a 2020 2020 4f6e 6520  codes)..    One 
+000226c0: 5f53 6563 7572 6974 7955 7365 7273 4765  _SecurityUsersGe
+000226d0: 7474 6572 2077 696c 6c20 6265 2063 7265  tter will be cre
+000226e0: 6174 6564 2066 6f72 2065 6163 6820 6f66  ated for each of
+000226f0: 2074 6865 202e 7669 6577 6572 732c 202e   the .viewers, .
+00022700: 6d6f 6469 6669 6572 7320 616e 6420 2e64  modifiers and .d
+00022710: 6174 615f 7669 6577 6572 7320 7072 6f70  ata_viewers prop
+00022720: 6572 7469 6573 0d0a 0d0a 2020 2020 4e6f  erties....    No
+00022730: 726d 616c 6c79 2045 6c65 6d65 6e74 2e76  rmally Element.v
+00022740: 6965 7765 7273 2c20 6d6f 6469 6669 6572  iewers, modifier
+00022750: 7320 616e 6420 6461 7461 5f76 6965 7765  s and data_viewe
+00022760: 7273 2077 696c 6c20 6265 204e 6f6e 650d  rs will be None.
+00022770: 0a20 2020 2027 2727 0d0a 2020 2020 6465  .    '''..    de
+00022780: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00022790: 656c 656d 656e 742c 2075 7365 7273 203d  element, users =
+000227a0: 2073 6574 2c69 6e69 7469 616c 6973 655f   set,initialise_
+000227b0: 7379 6e63 6865 643d 4661 6c73 652c 2069  synched=False, i
+000227c0: 6e69 7469 616c 6973 655f 6173 5f64 6566  nitialise_as_def
+000227d0: 6175 6c74 203d 2054 7275 6529 3a0d 0a20  ault = True):.. 
+000227e0: 2020 2020 2020 2027 2727 0d0a 2020 2020         '''..    
+000227f0: 2020 2020 3a70 6172 616d 2069 6e69 7469      :param initi
+00022800: 616c 6973 655f 7379 6e63 6865 643a 2020  alise_synched:  
+00022810: 7768 656e 206c 6f61 6469 6e67 2074 6865  when loading the
+00022820: 2073 6563 7572 6974 7920 6672 6f6d 2045   security from E
+00022830: 6d70 6f77 6572 2077 6520 6172 6520 7379  mpower we are sy
+00022840: 6e63 6872 6f6e 6973 6564 2e20 5768 656e  nchronised. When
+00022850: 2063 7265 6174 696e 6720 6e65 7720 456c   creating new El
+00022860: 656d 656e 7473 2061 6e64 2061 6464 696e  ements and addin
+00022870: 6720 7365 6375 7269 7479 2077 6520 6172  g security we ar
+00022880: 6520 6e6f 740d 0a0d 0a20 2020 2020 2020  e not....       
+00022890: 203a 7061 7261 6d20 696e 6974 6961 6c69   :param initiali
+000228a0: 7365 5f61 735f 6465 6661 756c 743a 2077  se_as_default: w
+000228b0: 6865 6e20 6372 6561 7469 6e67 2073 6563  hen creating sec
+000228c0: 7572 6974 7920 666f 7220 6120 6e65 7720  urity for a new 
+000228d0: 656c 656d 656e 7420 7765 2075 7375 616c  element we usual
+000228e0: 6c79 2077 616e 7420 746f 2068 6176 6520  ly want to have 
+000228f0: 6a75 7374 2064 6566 6175 6c74 2073 6563  just default sec
+00022900: 7572 6974 7920 2869 2e65 2e20 6e6f 7468  urity (i.e. noth
+00022910: 696e 6720 7265 636f 7264 6564 292e 2049  ing recorded). I
+00022920: 6620 7468 6973 2069 7320 7468 6520 6361  f this is the ca
+00022930: 7365 2072 6563 6f72 6420 6974 2068 6572  se record it her
+00022940: 6520 746f 206b 6565 7020 7072 6f63 6573  e to keep proces
+00022950: 7369 6e67 206c 6967 6874 0d0a 2020 2020  sing light..    
+00022960: 2020 2020 2727 270d 0a0d 0a20 2020 2020      '''....     
+00022970: 2020 2023 5768 656e 2069 6e69 7469 616c     #When initial
+00022980: 6973 696e 6720 6173 2064 6566 6175 6c74  ising as default
+00022990: 2c20 7765 2077 616e 7420 746f 206b 6565  , we want to kee
+000229a0: 7020 7468 6520 636c 6173 7320 6c69 6768  p the class ligh
+000229b0: 742d 206a 7573 7420 7365 7420 7365 6c66  t- just set self
+000229c0: 2e64 6566 6175 6c74 203d 2054 7275 6520  .default = True 
+000229d0: 616e 6420 7365 7420 6120 706f 696e 7465  and set a pointe
+000229e0: 7220 6261 636b 2074 6f20 7468 6520 656c  r back to the el
+000229f0: 656d 656e 740d 0a20 2020 2020 2020 2069  ement..        i
+00022a00: 6620 696e 6974 6961 6c69 7365 5f61 735f  f initialise_as_
+00022a10: 6465 6661 756c 743a 0d0a 2020 2020 2020  default:..      
+00022a20: 2020 2020 2020 7365 6c66 2e64 6566 6175        self.defau
+00022a30: 6c74 3d54 7275 650d 0a20 2020 2020 2020  lt=True..       
+00022a40: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00022a50: 2020 2020 7365 6c66 2e64 6566 6175 6c74      self.default
+00022a60: 3d46 616c 7365 0d0a 0d0a 2020 2020 2020  =False....      
+00022a70: 2020 7365 6c66 2e65 6c65 6d65 6e74 3d65    self.element=e
+00022a80: 6c65 6d65 6e74 0d0a 0d0a 2020 2020 2020  lement....      
+00022a90: 2020 2357 6520 686f 6c64 2074 776f 2073    #We hold two s
+00022aa0: 6574 7320 6f66 2075 7365 7273 2061 6e64  ets of users and
+00022ab0: 2074 6865 2063 7572 7265 6e74 2076 6572   the current ver
+00022ac0: 7369 6f6e 2061 6e64 2074 6865 2073 796e  sion and the syn
+00022ad0: 6368 6564 2076 6572 7369 6f6e 2066 726f  ched version fro
+00022ae0: 6d20 456d 706f 7765 720d 0a20 2020 2020  m Empower..     
+00022af0: 2020 2023 5765 2063 616e 2063 6865 636b     #We can check
+00022b00: 2066 6f72 2065 6469 7473 2062 6573 7420   for edits best 
+00022b10: 7468 6973 2077 6179 2c20 7369 6e63 6520  this way, since 
+00022b20: 6120 636f 6d70 6c65 7820 7072 6f63 6573  a complex proces
+00022b30: 7320 6973 206c 696b 656c 7920 746f 2061  s is likely to a
+00022b40: 6464 2061 6e64 2072 656d 6f76 6520 7573  dd and remove us
+00022b50: 6572 730d 0a20 2020 2020 2020 2073 656c  ers..        sel
+00022b60: 662e 5f75 7365 7273 203d 2073 6574 2875  f._users = set(u
+00022b70: 7365 7273 290d 0a0d 0a20 2020 2020 2020  sers)....       
+00022b80: 2023 4465 6661 756c 7420 7365 6c66 2e65   #Default self.e
+00022b90: 6469 7465 6420 2d20 7468 6973 2077 696c  dited - this wil
+00022ba0: 6c20 6765 7420 6f76 6572 7772 6974 7465  l get overwritte
+00022bb0: 6e20 6279 2073 656c 662e 5f73 6574 5f65  n by self._set_e
+00022bc0: 6469 7465 6428 2920 6973 206e 6563 6573  dited() is neces
+00022bd0: 7361 7279 0d0a 2020 2020 2020 2020 7365  sary..        se
+00022be0: 6c66 2e5f 6564 6974 6564 203d 2046 616c  lf._edited = Fal
+00022bf0: 7365 0d0a 0d0a 2020 2020 2020 2020 6966  se....        if
+00022c00: 2069 6e69 7469 616c 6973 655f 7379 6e63   initialise_sync
+00022c10: 6865 643a 0d0a 2020 2020 2020 2020 2020  hed:..          
+00022c20: 2020 2357 6520 696e 6974 6961 6c69 7365    #We initialise
+00022c30: 2073 796e 6368 6564 2077 6865 6e20 7765   synched when we
+00022c40: 2063 7265 6174 6520 7468 6520 7365 6375   create the secu
+00022c50: 7269 7479 2064 6972 6563 746c 7920 6672  rity directly fr
+00022c60: 6f6d 2045 6d70 6f77 6572 0d0a 2020 2020  om Empower..    
+00022c70: 2020 2020 2020 2020 7365 6c66 2e5f 7379          self._sy
+00022c80: 6e63 6865 645f 7573 6572 7320 3d20 7365  nched_users = se
+00022c90: 7428 7573 6572 7329 0d0a 2020 2020 2020  t(users)..      
+00022ca0: 2020 2020 2020 7365 6c66 2e5f 7365 6375        self._secu
+00022cb0: 7269 7479 5f72 6561 6420 3d20 5472 7565  rity_read = True
+00022cc0: 0d0a 0d0a 2020 2020 2020 2020 656c 7365  ....        else
+00022cd0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00022ce0: 656c 662e 5f73 6563 7572 6974 795f 7265  elf._security_re
+00022cf0: 6164 203d 2046 616c 7365 0d0a 2020 2020  ad = False..    
+00022d00: 2020 2020 2020 2020 7365 6c66 2e5f 7379          self._sy
+00022d10: 6e63 6865 645f 7573 6572 7320 3d20 7365  nched_users = se
+00022d20: 7428 290d 0a20 2020 2020 2020 2020 2020  t()..           
+00022d30: 2069 6620 6c65 6e28 7365 6c66 2e5f 7573   if len(self._us
+00022d40: 6572 7329 203e 2030 3a0d 0a20 2020 2020  ers) > 0:..     
+00022d50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00022d60: 5f73 6574 5f65 6469 7465 6428 290d 0a0d  _set_edited()...
+00022d70: 0a0d 0a0d 0a20 2020 2064 6566 205f 7365  .....    def _se
+00022d80: 745f 6564 6974 6564 2873 656c 6629 3a0d  t_edited(self):.
+00022d90: 0a20 2020 2020 2020 2020 7365 6c66 2e5f  .         self._
+00022da0: 6564 6974 6564 203d 2054 7275 650d 0a20  edited = True.. 
+00022db0: 2020 2020 2020 2020 7365 6c66 2e65 6c65          self.ele
+00022dc0: 6d65 6e74 2e64 696d 656e 7369 6f6e 2e65  ment.dimension.e
+00022dd0: 6c65 6d65 6e74 732e 5f73 6563 7572 6974  lements._securit
+00022de0: 795f 6564 6974 6564 203d 2054 7275 650d  y_edited = True.
+00022df0: 0a20 2020 2020 2020 2020 2370 7269 6e74  .         #print
+00022e00: 2827 3137 3235 3a20 272c 7365 6c66 2e65  ('1725: ',self.e
+00022e10: 6c65 6d65 6e74 2e64 696d 656e 7369 6f6e  lement.dimension
+00022e20: 2e65 6c65 6d65 6e74 732e 5f73 6563 7572  .elements._secur
+00022e30: 6974 795f 6564 6974 6564 2029 0d0a 0d0a  ity_edited )....
+00022e40: 2020 2020 6465 6620 5f6c 617a 795f 6c6f      def _lazy_lo
+00022e50: 6164 2873 656c 6629 3a0d 0a20 2020 2020  ad(self):..     
+00022e60: 2020 2023 576f 726b 206f 7574 2069 6620     #Work out if 
+00022e70: 7365 6375 7269 7479 2068 6173 2062 6565  security has bee
+00022e80: 6e20 6c6f 6164 6564 2066 6f72 2074 6865  n loaded for the
+00022e90: 2065 6c65 6d65 6e74 730d 0a20 2020 2020   elements..     
+00022ea0: 2020 2023 5573 6520 6120 6c6f 6361 6c20     #Use a local 
+00022eb0: 7368 6f72 7463 7574 2062 6f6f 6c65 616e  shortcut boolean
+00022ec0: 2c20 746f 2073 6176 6520 7072 6f63 6573  , to save proces
+00022ed0: 7369 6e67 2074 696d 650d 0a0d 0a20 2020  sing time....   
+00022ee0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+00022ef0: 2e5f 7365 6375 7269 7479 5f72 6561 643a  ._security_read:
+00022f00: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00022f10: 6c66 2e65 6c65 6d65 6e74 2e64 696d 656e  lf.element.dimen
+00022f20: 7369 6f6e 2e5f 6c6f 6164 5f73 6563 7572  sion._load_secur
+00022f30: 6974 7928 290d 0a20 2020 2020 2020 2020  ity()..         
+00022f40: 2020 2073 656c 662e 5f73 6563 7572 6974     self._securit
+00022f50: 795f 7265 6164 203d 2054 7275 650d 0a0d  y_read = True...
+00022f60: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+00022f70: 2020 2020 6465 6620 6564 6974 6564 2873      def edited(s
+00022f80: 656c 6629 3a0d 0a20 2020 2020 2020 2023  elf):..        #
+00022f90: 5265 6164 206f 6e6c 7920 7072 6f70 6572  Read only proper
+00022fa0: 7479 0d0a 2020 2020 2020 2020 2352 6574  ty..        #Ret
+00022fb0: 7572 6e20 5472 7565 2069 6620 6564 6974  urn True if edit
+00022fc0: 6564 2061 6e64 205f 7379 6e63 6865 645f  ed and _synched_
+00022fd0: 7573 6572 7320 213d 205f 7573 6572 730d  users != _users.
+00022fe0: 0a20 2020 2020 2020 2023 6966 2073 656c  .        #if sel
+00022ff0: 662e 5f65 6469 7465 643a 0d0a 2020 2020  f._edited:..    
+00023000: 2020 2020 2020 2020 2370 7269 6e74 2827          #print('
+00023010: 3137 3334 3a27 2c73 656c 662e 5f73 796e  1734:',self._syn
+00023020: 6368 6564 5f75 7365 7273 2021 3d20 7365  ched_users != se
+00023030: 6c66 2e5f 7573 6572 7329 0d0a 2020 2020  lf._users)..    
+00023040: 2020 2020 2020 2020 2370 7269 6e74 2873          #print(s
+00023050: 656c 662e 5f73 796e 6368 6564 5f75 7365  elf._synched_use
+00023060: 7273 202c 2073 656c 662e 5f75 7365 7273  rs , self._users
+00023070: 290d 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00023080: 6e20 2073 656c 662e 5f65 6469 7465 6420  n  self._edited 
+00023090: 616e 6420 7365 6c66 2e5f 7379 6e63 6865  and self._synche
+000230a0: 645f 7573 6572 7320 213d 2073 656c 662e  d_users != self.
+000230b0: 5f75 7365 7273 0d0a 0d0a 0d0a 2020 2020  _users......    
+000230c0: 6465 6620 5f5f 636f 6e74 6169 6e73 5f5f  def __contains__
+000230d0: 2873 656c 662c 2069 7465 6d29 3a0d 0a20  (self, item):.. 
+000230e0: 2020 2020 2020 2023 4c6f 6164 2074 6865         #Load the
+000230f0: 2055 7365 7273 2069 6620 7765 2068 6176   Users if we hav
+00023100: 656e 2774 2061 6c72 6561 6479 0d0a 2020  en't already..  
+00023110: 2020 2020 2020 7365 6c66 2e5f 6c61 7a79        self._lazy
+00023120: 5f6c 6f61 6428 290d 0a0d 0a20 2020 2020  _load()....     
+00023130: 2020 2072 6574 7572 6e20 6974 656d 2069     return item i
+00023140: 6e20 7365 6c66 2e5f 7573 6572 730d 0a0d  n self._users...
+00023150: 0a20 2020 2064 6566 205f 5f69 7465 725f  .    def __iter_
+00023160: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+00023170: 2020 7365 6c66 2e5f 6974 6572 6174 6f72    self._iterator
+00023180: 203d 2069 7465 7228 6c69 7374 2873 656c   = iter(list(sel
+00023190: 662e 5f75 7365 7273 2929 0d0a 2020 2020  f._users))..    
+000231a0: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
+000231b0: 0a0d 0a20 2020 2064 6566 205f 5f6e 6578  ...    def __nex
+000231c0: 745f 5f28 7365 6c66 293a 0d0a 2020 2020  t__(self):..    
+000231d0: 2020 2020 7265 7475 726e 206e 6578 7428      return next(
+000231e0: 7365 6c66 2e5f 6974 6572 6174 6f72 290d  self._iterator).
+000231f0: 0a0d 0a20 2020 2023 7570 6461 7465 282a  ...    #update(*
+00023200: 6f74 6865 7273 290d 0a20 2020 2023 7365  others)..    #se
+00023210: 7420 7c3d 206f 7468 6572 207c 202e 2e2e  t |= other | ...
+00023220: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
+00023230: 2020 5570 6461 7465 2074 6865 2073 6574    Update the set
+00023240: 2c20 6164 6469 6e67 2065 6c65 6d65 6e74  , adding element
+00023250: 7320 6672 6f6d 2061 6c6c 206f 7468 6572  s from all other
+00023260: 732e 0d0a 2020 2020 230d 0a20 2020 2023  s...    #..    #
+00023270: 696e 7465 7273 6563 7469 6f6e 5f75 7064  intersection_upd
+00023280: 6174 6528 2a6f 7468 6572 7329 0d0a 2020  ate(*others)..  
+00023290: 2020 2373 6574 2026 3d20 6f74 6865 7220    #set &= other 
+000232a0: 2620 2e2e 2e0d 0a20 2020 2023 0d0a 2020  & .....    #..  
+000232b0: 2020 2320 2020 2055 7064 6174 6520 7468    #    Update th
+000232c0: 6520 7365 742c 206b 6565 7069 6e67 206f  e set, keeping o
+000232d0: 6e6c 7920 656c 656d 656e 7473 2066 6f75  nly elements fou
+000232e0: 6e64 2069 6e20 6974 2061 6e64 2061 6c6c  nd in it and all
+000232f0: 206f 7468 6572 732e 0d0a 2020 2020 230d   others...    #.
+00023300: 0a20 2020 2023 6469 6666 6572 656e 6365  .    #difference
+00023310: 5f75 7064 6174 6528 2a6f 7468 6572 7329  _update(*others)
+00023320: 0d0a 2020 2020 2373 6574 202d 3d20 6f74  ..    #set -= ot
+00023330: 6865 7220 7c20 2e2e 2e0d 0a20 2020 2023  her | .....    #
+00023340: 0d0a 2020 2020 2320 2020 2055 7064 6174  ..    #    Updat
+00023350: 6520 7468 6520 7365 742c 2072 656d 6f76  e the set, remov
+00023360: 696e 6720 656c 656d 656e 7473 2066 6f75  ing elements fou
+00023370: 6e64 2069 6e20 6f74 6865 7273 2e0d 0a20  nd in others... 
+00023380: 2020 2023 0d0a 2020 2020 2373 796d 6d65     #..    #symme
+00023390: 7472 6963 5f64 6966 6665 7265 6e63 655f  tric_difference_
+000233a0: 7570 6461 7465 286f 7468 6572 290d 0a20  update(other).. 
+000233b0: 2020 2023 7365 7420 5e3d 206f 7468 6572     #set ^= other
+000233c0: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
+000233d0: 2020 5570 6461 7465 2074 6865 2073 6574    Update the set
+000233e0: 2c20 6b65 6570 696e 6720 6f6e 6c79 2065  , keeping only e
+000233f0: 6c65 6d65 6e74 7320 666f 756e 6420 696e  lements found in
+00023400: 2065 6974 6865 7220 7365 742c 2062 7574   either set, but
+00023410: 206e 6f74 2069 6e20 626f 7468 2e0d 0a20   not in both... 
+00023420: 2020 2023 0d0a 0d0a 2020 2020 6465 6620     #....    def 
+00023430: 6164 6428 7365 6c66 2c20 6974 656d 293a  add(self, item):
+00023440: 0d0a 2020 2020 2020 2020 2727 2741 6464  ..        '''Add
+00023450: 2069 7465 6d20 746f 2074 6865 2073 6574   item to the set
+00023460: 206f 6620 7573 6572 2073 686f 7274 636f   of user shortco
+00023470: 6465 7327 2727 0d0a 2020 2020 2020 2020  des'''..        
+00023480: 234c 6f61 6420 7468 6520 5573 6572 7320  #Load the Users 
+00023490: 6966 2077 6520 6861 7665 6e27 7420 616c  if we haven't al
+000234a0: 7265 6164 790d 0a20 2020 2020 2020 2023  ready..        #
+000234b0: 7072 696e 7428 2731 3738 323a 272c 7365  print('1782:',se
+000234c0: 6c66 2e5f 7365 6375 7269 7479 5f72 6561  lf._security_rea
+000234d0: 6429 0d0a 2020 2020 2020 2020 2370 7269  d)..        #pri
+000234e0: 6e74 2827 3137 3833 3a20 272c 7365 6c66  nt('1783: ',self
+000234f0: 2e65 6c65 6d65 6e74 2e64 696d 656e 7369  .element.dimensi
+00023500: 6f6e 2e65 6c65 6d65 6e74 732e 5f73 6563  on.elements._sec
+00023510: 7572 6974 795f 6564 6974 6564 2029 0d0a  urity_edited )..
+00023520: 2020 2020 2020 2020 7365 6c66 2e5f 6c61          self._la
+00023530: 7a79 5f6c 6f61 6428 290d 0a20 2020 2020  zy_load()..     
+00023540: 2020 2023 7072 696e 7428 2731 3738 353a     #print('1785:
+00023550: 272c 7365 6c66 2e5f 7365 6375 7269 7479  ',self._security
+00023560: 5f72 6561 6429 0d0a 2020 2020 2020 2020  _read)..        
+00023570: 2370 7269 6e74 2827 3137 3836 3a20 272c  #print('1786: ',
+00023580: 7365 6c66 2e65 6c65 6d65 6e74 2e64 696d  self.element.dim
+00023590: 656e 7369 6f6e 2e65 6c65 6d65 6e74 732e  ension.elements.
+000235a0: 5f73 6563 7572 6974 795f 6564 6974 6564  _security_edited
+000235b0: 2029 0d0a 2020 2020 2020 2020 7265 7476   )..        retv
+000235c0: 616c 203d 2073 656c 662e 5f75 7365 7273  al = self._users
+000235d0: 2e61 6464 2869 7465 6d29 0d0a 2020 2020  .add(item)..    
+000235e0: 2020 2020 2370 7269 6e74 2827 3137 3838      #print('1788
+000235f0: 3a27 2c73 656c 662e 5f73 6563 7572 6974  :',self._securit
+00023600: 795f 7265 6164 290d 0a20 2020 2020 2020  y_read)..       
+00023610: 2023 7072 696e 7428 2731 3738 393a 2027   #print('1789: '
+00023620: 2c73 656c 662e 656c 656d 656e 742e 6469  ,self.element.di
+00023630: 6d65 6e73 696f 6e2e 656c 656d 656e 7473  mension.elements
+00023640: 2e5f 7365 6375 7269 7479 5f65 6469 7465  ._security_edite
+00023650: 6420 290d 0a20 2020 2020 2020 2073 656c  d )..        sel
+00023660: 662e 5f73 6574 5f65 6469 7465 6428 290d  f._set_edited().
+00023670: 0a20 2020 2020 2020 2023 7072 696e 7428  .        #print(
+00023680: 2731 3739 313a 272c 7365 6c66 2e5f 7365  '1791:',self._se
+00023690: 6375 7269 7479 5f72 6561 6429 0d0a 2020  curity_read)..  
+000236a0: 2020 2020 2020 2370 7269 6e74 2827 3137        #print('17
+000236b0: 3932 3a20 272c 7365 6c66 2e65 6c65 6d65  92: ',self.eleme
+000236c0: 6e74 2e64 696d 656e 7369 6f6e 2e65 6c65  nt.dimension.ele
+000236d0: 6d65 6e74 732e 5f73 6563 7572 6974 795f  ments._security_
+000236e0: 6564 6974 6564 2029 0d0a 2020 2020 2020  edited )..      
+000236f0: 2020 2370 7269 6e74 2827 3137 3933 3a27    #print('1793:'
+00023700: 2c73 656c 662e 5f73 796e 6368 6564 5f75  ,self._synched_u
+00023710: 7365 7273 290d 0a20 2020 2020 2020 2023  sers)..        #
+00023720: 7072 696e 7428 2731 3739 343a 272c 7365  print('1794:',se
+00023730: 6c66 2e5f 7573 6572 7329 0d0a 2020 2020  lf._users)..    
+00023740: 2020 2020 2370 7269 6e74 2827 3137 3935      #print('1795
+00023750: 3a27 2c72 6570 7228 7365 6c66 2929 0d0a  :',repr(self))..
+00023760: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00023770: 6574 7661 6c0d 0a0d 0a20 2020 2064 6566  etval....    def
+00023780: 205f 5f69 6164 645f 5f28 7365 6c66 2c69   __iadd__(self,i
+00023790: 7465 6d29 3a0d 0a20 2020 2020 2020 2074  tem):..        t
+000237a0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+000237b0: 2073 656c 662e 5f75 7365 7273 2e61 6464   self._users.add
+000237c0: 2869 7465 6d29 0d0a 2020 2020 2020 2020  (item)..        
+000237d0: 6578 6365 7074 2054 7970 6545 7272 6f72  except TypeError
+000237e0: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
+000237f0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+00023800: 2020 2020 2020 2020 2020 666f 7220 7375            for su
+00023810: 6269 7465 6d20 696e 2069 7465 6d3a 0d0a  bitem in item:..
+00023820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023830: 2020 2020 7365 6c66 2e5f 7573 6572 732e      self._users.
+00023840: 6164 6428 7375 6269 7465 6d29 0d0a 2020  add(subitem)..  
+00023850: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00023860: 2041 7474 7269 6275 7465 4572 726f 723a   AttributeError:
+00023870: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00023880: 2020 7261 6973 6520 650d 0a0d 0a20 2020    raise e....   
+00023890: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000238a0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6973  ....    def __is
+000238b0: 7562 5f5f 2873 656c 662c 6974 656d 293a  ub__(self,item):
+000238c0: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+000238d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000238e0: 2e5f 7573 6572 732e 6469 7363 6172 6428  ._users.discard(
+000238f0: 6974 656d 290d 0a20 2020 2020 2020 2065  item)..        e
+00023900: 7863 6570 7420 5479 7065 4572 726f 7220  xcept TypeError 
+00023910: 6173 2065 3a0d 0a20 2020 2020 2020 2020  as e:..         
+00023920: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00023930: 2020 2020 2020 2020 2066 6f72 2073 7562           for sub
+00023940: 6974 656d 2069 6e20 6974 656d 3a0d 0a20  item in item:.. 
+00023950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023960: 2020 2073 656c 662e 5f75 7365 7273 2e64     self._users.d
+00023970: 6973 6361 7264 2873 7562 6974 656d 290d  iscard(subitem).
+00023980: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00023990: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
+000239a0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+000239b0: 2020 2020 2072 6169 7365 2065 0d0a 0d0a       raise e....
+000239c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000239d0: 656c 660d 0a0d 0a0d 0a20 2020 2023 7265  elf......    #re
+000239e0: 6d6f 7665 2865 6c65 6d29 0d0a 2020 2020  move(elem)..    
+000239f0: 230d 0a20 2020 2023 0d0a 0d0a 2020 2020  #..    #....    
+00023a00: 6465 6620 7365 7428 7365 6c66 2c69 7465  def set(self,ite
+00023a10: 6d29 3a0d 0a20 2020 2020 2020 2073 656c  m):..        sel
+00023a20: 662e 636c 6561 7228 290d 0a20 2020 2020  f.clear()..     
+00023a30: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00023a40: 2869 7465 6d2c 7374 7229 3a0d 0a20 2020  (item,str):..   
+00023a50: 2020 2020 2020 2020 2073 656c 662e 6164           self.ad
+00023a60: 6428 6974 656d 290d 0a20 2020 2020 2020  d(item)..       
+00023a70: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00023a80: 2020 2020 666f 7220 6920 696e 2069 7465      for i in ite
+00023a90: 6d3a 0d0a 2020 2020 2020 2020 2020 2020  m:..            
+00023aa0: 2020 2020 7365 6c66 2e61 6464 2869 290d      self.add(i).
+00023ab0: 0a0d 0a20 2020 2064 6566 2072 656d 6f76  ...    def remov
+00023ac0: 6528 7365 6c66 2c20 6974 656d 293a 0d0a  e(self, item):..
+00023ad0: 2020 2020 2020 2020 2727 2752 656d 6f76          '''Remov
+00023ae0: 6520 6974 656d 2066 726f 6d20 7468 6520  e item from the 
+00023af0: 7365 7420 6f66 2075 7365 7220 7368 6f72  set of user shor
+00023b00: 7463 6f64 6573 2e20 5261 6973 6573 204b  tcodes. Raises K
+00023b10: 6579 4572 726f 7220 6966 2069 7465 6d20  eyError if item 
+00023b20: 6973 206e 6f74 2063 6f6e 7461 696e 6564  is not contained
+00023b30: 2069 6e20 7468 6520 7365 742e 2727 270d   in the set.'''.
+00023b40: 0a0d 0a20 2020 2020 2020 2023 4c6f 6164  ...        #Load
+00023b50: 2074 6865 2055 7365 7273 2069 6620 7765   the Users if we
+00023b60: 2068 6176 656e 2774 2061 6c72 6561 6479   haven't already
+00023b70: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00023b80: 6c61 7a79 5f6c 6f61 6428 290d 0a20 2020  lazy_load()..   
+00023b90: 2020 2020 2072 6574 7661 6c20 3d20 7365       retval = se
+00023ba0: 6c66 2e5f 7573 6572 732e 7265 6d6f 7665  lf._users.remove
+00023bb0: 2869 7465 6d29 0d0a 2020 2020 2020 2020  (item)..        
+00023bc0: 7365 6c66 2e5f 7365 745f 6564 6974 6564  self._set_edited
+00023bd0: 2829 0d0a 2020 2020 2020 2020 7265 7475  ()..        retu
+00023be0: 726e 2072 6574 7661 6c0d 0a0d 0a20 2020  rn retval....   
+00023bf0: 2064 6566 205f 5f73 7562 5f5f 2873 656c   def __sub__(sel
+00023c00: 662c 6974 656d 293a 0d0a 2020 2020 2020  f,item):..      
+00023c10: 2020 7265 7475 726e 2073 656c 662e 6469    return self.di
+00023c20: 7363 6172 6428 6974 656d 290d 0a0d 0a20  scard(item).... 
+00023c30: 2020 2064 6566 2064 6973 6361 7264 2873     def discard(s
+00023c40: 656c 662c 2069 7465 6d29 3a0d 0a20 2020  elf, item):..   
+00023c50: 2020 2020 2027 2727 5265 6d6f 7665 2069       '''Remove i
+00023c60: 7465 6d20 6672 6f6d 2074 6865 2073 6574  tem from the set
+00023c70: 206f 6620 7573 6572 2073 686f 7274 636f   of user shortco
+00023c80: 6465 7320 6966 2069 7420 6973 2070 7265  des if it is pre
+00023c90: 7365 6e74 2e27 2727 0d0a 0d0a 2020 2020  sent.'''....    
+00023ca0: 2020 2020 234c 6f61 6420 7468 6520 5573      #Load the Us
+00023cb0: 6572 7320 6966 2077 6520 6861 7665 6e27  ers if we haven'
+00023cc0: 7420 616c 7265 6164 790d 0a20 2020 2020  t already..     
+00023cd0: 2020 2073 656c 662e 5f6c 617a 795f 6c6f     self._lazy_lo
+00023ce0: 6164 2829 0d0a 2020 2020 2020 2020 7265  ad()..        re
+00023cf0: 7476 616c 203d 2073 656c 662e 5f75 7365  tval = self._use
+00023d00: 7273 2e64 6973 6361 7264 2869 7465 6d29  rs.discard(item)
+00023d10: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00023d20: 7365 745f 6564 6974 6564 2829 0d0a 2020  set_edited()..  
+00023d30: 2020 2020 2020 7265 7475 726e 2072 6574        return ret
+00023d40: 7661 6c0d 0a0d 0a20 2020 2023 706f 7028  val....    #pop(
+00023d50: 290d 0a20 2020 2023 0d0a 2020 2020 2320  )..    #..    # 
+00023d60: 2020 2052 656d 6f76 6520 616e 6420 7265     Remove and re
+00023d70: 7475 726e 2061 6e20 6172 6269 7472 6172  turn an arbitrar
+00023d80: 7920 656c 656d 656e 7420 6672 6f6d 2074  y element from t
+00023d90: 6865 2073 6574 2e20 5261 6973 6573 204b  he set. Raises K
+00023da0: 6579 4572 726f 7220 6966 2074 6865 2073  eyError if the s
+00023db0: 6574 2069 7320 656d 7074 792e 0d0a 2020  et is empty...  
+00023dc0: 2020 230d 0a20 2020 2064 6566 2063 6c65    #..    def cle
+00023dd0: 6172 2873 656c 6629 3a0d 0a20 2020 2020  ar(self):..     
+00023de0: 2020 2027 2727 5265 6d6f 7665 2061 6c6c     '''Remove all
+00023df0: 2075 7365 7273 2073 686f 7274 636f 6465   users shortcode
+00023e00: 7320 6672 6f6d 2074 6865 2073 6574 2e27  s from the set.'
+00023e10: 2727 0d0a 0d0a 2020 2020 2020 2020 234c  ''....        #L
+00023e20: 6f61 6420 7468 6520 5573 6572 7320 6966  oad the Users if
+00023e30: 2077 6520 6861 7665 6e27 7420 616c 7265   we haven't alre
+00023e40: 6164 790d 0a20 2020 2020 2020 2073 656c  ady..        sel
+00023e50: 662e 5f6c 617a 795f 6c6f 6164 2829 0d0a  f._lazy_load()..
+00023e60: 2020 2020 2020 2020 7265 7476 616c 203d          retval =
+00023e70: 2020 7365 6c66 2e5f 7573 6572 732e 636c    self._users.cl
+00023e80: 6561 7228 290d 0a20 2020 2020 2020 2073  ear()..        s
+00023e90: 656c 662e 5f73 6574 5f65 6469 7465 6428  elf._set_edited(
+00023ea0: 290d 0a20 2020 2020 2020 2023 4966 2077  )..        #If w
+00023eb0: 6520 6172 6520 636c 6561 7265 642c 2077  e are cleared, w
+00023ec0: 6520 646f 6e27 7420 7761 6e74 2074 6f20  e don't want to 
+00023ed0: 6163 6369 6465 6e74 616c 6c79 2072 652d  accidentally re-
+00023ee0: 696e 6974 6961 6c69 7a65 2076 6961 2061  initialize via a
+00023ef0: 6e6f 7468 6572 2072 6561 640d 0a20 2020  nother read..   
+00023f00: 2020 2020 2073 656c 662e 5f73 6563 7572       self._secur
+00023f10: 6974 795f 7265 6164 203d 2054 7275 650d  ity_read = True.
+00023f20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00023f30: 7265 7476 616c 0d0a 0d0a 2020 2020 2369  retval....    #i
+00023f40: 7364 6973 6a6f 696e 7428 6f74 6865 7229  sdisjoint(other)
+00023f50: 0d0a 2020 2020 230d 0a20 2020 2023 2020  ..    #..    #  
+00023f60: 2020 5265 7475 726e 2054 7275 6520 6966    Return True if
+00023f70: 2074 6865 2073 6574 2068 6173 206e 6f20   the set has no 
+00023f80: 656c 656d 656e 7473 2069 6e20 636f 6d6d  elements in comm
+00023f90: 6f6e 2077 6974 6820 6f74 6865 722e 2053  on with other. S
+00023fa0: 6574 7320 6172 6520 6469 736a 6f69 6e74  ets are disjoint
+00023fb0: 2069 6620 616e 6420 6f6e 6c79 2069 6620   if and only if 
+00023fc0: 7468 6569 7220 696e 7465 7273 6563 7469  their intersecti
+00023fd0: 6f6e 2069 7320 7468 6520 656d 7074 7920  on is the empty 
+00023fe0: 7365 742e 0d0a 2020 2020 230d 0a20 2020  set...    #..   
+00023ff0: 2023 6973 7375 6273 6574 286f 7468 6572   #issubset(other
+00024000: 290d 0a20 2020 2023 7365 7420 3c3d 206f  )..    #set <= o
+00024010: 7468 6572 0d0a 2020 2020 230d 0a20 2020  ther..    #..   
+00024020: 2023 2020 2020 5465 7374 2077 6865 7468   #    Test wheth
+00024030: 6572 2065 7665 7279 2065 6c65 6d65 6e74  er every element
+00024040: 2069 6e20 7468 6520 7365 7420 6973 2069   in the set is i
+00024050: 6e20 6f74 6865 722e 0d0a 2020 2020 230d  n other...    #.
+00024060: 0a20 2020 2023 7365 7420 3c20 6f74 6865  .    #set < othe
+00024070: 720d 0a20 2020 2023 0d0a 2020 2020 2320  r..    #..    # 
+00024080: 2020 2054 6573 7420 7768 6574 6865 7220     Test whether 
+00024090: 7468 6520 7365 7420 6973 2061 2070 726f  the set is a pro
+000240a0: 7065 7220 7375 6273 6574 206f 6620 6f74  per subset of ot
+000240b0: 6865 722c 2074 6861 7420 6973 2c20 7365  her, that is, se
+000240c0: 7420 3c3d 206f 7468 6572 2061 6e64 2073  t <= other and s
+000240d0: 6574 2021 3d20 6f74 6865 722e 0d0a 2020  et != other...  
+000240e0: 2020 230d 0a20 2020 2023 6973 7375 7065    #..    #issupe
+000240f0: 7273 6574 286f 7468 6572 290d 0a20 2020  rset(other)..   
+00024100: 2023 7365 7420 3e3d 206f 7468 6572 0d0a   #set >= other..
+00024110: 2020 2020 230d 0a20 2020 2023 2020 2020      #..    #    
+00024120: 5465 7374 2077 6865 7468 6572 2065 7665  Test whether eve
+00024130: 7279 2065 6c65 6d65 6e74 2069 6e20 6f74  ry element in ot
+00024140: 6865 7220 6973 2069 6e20 7468 6520 7365  her is in the se
+00024150: 742e 0d0a 2020 2020 230d 0a20 2020 2023  t...    #..    #
+00024160: 7365 7420 3e20 6f74 6865 720d 0a20 2020  set > other..   
+00024170: 2023 0d0a 2020 2020 2320 2020 2054 6573   #..    #    Tes
+00024180: 7420 7768 6574 6865 7220 7468 6520 7365  t whether the se
+00024190: 7420 6973 2061 2070 726f 7065 7220 7375  t is a proper su
+000241a0: 7065 7273 6574 206f 6620 6f74 6865 722c  perset of other,
+000241b0: 2074 6861 7420 6973 2c20 7365 7420 3e3d   that is, set >=
+000241c0: 206f 7468 6572 2061 6e64 2073 6574 2021   other and set !
+000241d0: 3d20 6f74 6865 722e 0d0a 2020 2020 230d  = other...    #.
+000241e0: 0a20 2020 2023 756e 696f 6e28 2a6f 7468  .    #union(*oth
+000241f0: 6572 7329 0d0a 2020 2020 2373 6574 207c  ers)..    #set |
+00024200: 206f 7468 6572 207c 202e 2e2e 0d0a 2020   other | .....  
+00024210: 2020 230d 0a20 2020 2023 2020 2020 5265    #..    #    Re
+00024220: 7475 726e 2061 206e 6577 2073 6574 2077  turn a new set w
+00024230: 6974 6820 656c 656d 656e 7473 2066 726f  ith elements fro
+00024240: 6d20 7468 6520 7365 7420 616e 6420 616c  m the set and al
+00024250: 6c20 6f74 6865 7273 2e0d 0a20 2020 2023  l others...    #
+00024260: 0d0a 2020 2020 2369 6e74 6572 7365 6374  ..    #intersect
+00024270: 696f 6e28 2a6f 7468 6572 7329 0d0a 2020  ion(*others)..  
+00024280: 2020 2373 6574 2026 206f 7468 6572 2026    #set & other &
+00024290: 202e 2e2e 0d0a 2020 2020 230d 0a20 2020   .....    #..   
+000242a0: 2023 2020 2020 5265 7475 726e 2061 206e   #    Return a n
+000242b0: 6577 2073 6574 2077 6974 6820 656c 656d  ew set with elem
+000242c0: 656e 7473 2063 6f6d 6d6f 6e20 746f 2074  ents common to t
+000242d0: 6865 2073 6574 2061 6e64 2061 6c6c 206f  he set and all o
+000242e0: 7468 6572 732e 0d0a 2020 2020 230d 0a20  thers...    #.. 
+000242f0: 2020 2023 6469 6666 6572 656e 6365 282a     #difference(*
+00024300: 6f74 6865 7273 290d 0a20 2020 2023 7365  others)..    #se
+00024310: 7420 2d20 6f74 6865 7220 2d20 2e2e 2e0d  t - other - ....
+00024320: 0a20 2020 2023 0d0a 2020 2020 2320 2020  .    #..    #   
+00024330: 2052 6574 7572 6e20 6120 6e65 7720 7365   Return a new se
+00024340: 7420 7769 7468 2065 6c65 6d65 6e74 7320  t with elements 
+00024350: 696e 2074 6865 2073 6574 2074 6861 7420  in the set that 
+00024360: 6172 6520 6e6f 7420 696e 2074 6865 206f  are not in the o
+00024370: 7468 6572 732e 0d0a 2020 2020 230d 0a20  thers...    #.. 
+00024380: 2020 2023 7379 6d6d 6574 7269 635f 6469     #symmetric_di
+00024390: 6666 6572 656e 6365 286f 7468 6572 290d  fference(other).
+000243a0: 0a20 2020 2023 7365 7420 5e20 6f74 6865  .    #set ^ othe
+000243b0: 720d 0a20 2020 2023 0d0a 2020 2020 2320  r..    #..    # 
+000243c0: 2020 2052 6574 7572 6e20 6120 6e65 7720     Return a new 
+000243d0: 7365 7420 7769 7468 2065 6c65 6d65 6e74  set with element
+000243e0: 7320 696e 2065 6974 6865 7220 7468 6520  s in either the 
+000243f0: 7365 7420 6f72 206f 7468 6572 2062 7574  set or other but
+00024400: 206e 6f74 2062 6f74 682e 0d0a 2020 2020   not both...    
+00024410: 230d 0a0d 0a20 2020 2064 6566 205f 5f6c  #....    def __l
+00024420: 656e 5f5f 2873 656c 6629 3a0d 0a20 2020  en__(self):..   
+00024430: 2020 2020 2023 4c6f 6164 2074 6865 2055       #Load the U
+00024440: 7365 7273 2069 6620 7765 2068 6176 656e  sers if we haven
+00024450: 2774 2061 6c72 6561 6479 0d0a 2020 2020  't already..    
+00024460: 2020 2020 7365 6c66 2e5f 6c61 7a79 5f6c      self._lazy_l
+00024470: 6f61 6428 290d 0a0d 0a20 2020 2020 2020  oad()....       
+00024480: 2072 6574 7572 6e20 6c65 6e28 7365 6c66   return len(self
+00024490: 2e5f 7573 6572 7329 0d0a 0d0a 2020 2020  ._users)....    
+000244a0: 6465 6620 5f5f 7374 725f 5f28 7365 6c66  def __str__(self
+000244b0: 293a 0d0a 2020 2020 2020 2020 234c 6f61  ):..        #Loa
+000244c0: 6420 7468 6520 5573 6572 7320 6966 2077  d the Users if w
+000244d0: 6520 6861 7665 6e27 7420 616c 7265 6164  e haven't alread
+000244e0: 790d 0a20 2020 2020 2020 2073 656c 662e  y..        self.
+000244f0: 5f6c 617a 795f 6c6f 6164 2829 0d0a 0d0a  _lazy_load()....
+00024500: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00024510: 7472 2873 656c 662e 5f75 7365 7273 290d  tr(self._users).
+00024520: 0a0d 0a20 2020 2064 6566 205f 5f72 6570  ...    def __rep
+00024530: 725f 5f28 7365 6c66 293a 0d0a 2020 2020  r__(self):..    
+00024540: 2020 2020 234c 6f61 6420 7468 6520 5573      #Load the Us
+00024550: 6572 7320 6966 2077 6520 6861 7665 6e27  ers if we haven'
+00024560: 7420 616c 7265 6164 790d 0a20 2020 2020  t already..     
+00024570: 2020 2073 656c 662e 5f6c 617a 795f 6c6f     self._lazy_lo
+00024580: 6164 2829 0d0a 0d0a 2020 2020 2020 2020  ad()....        
+00024590: 7265 7475 726e 2027 5573 6572 7320 7b7d  return 'Users {}
+000245a0: 2066 726f 6d20 3c7b 7d20 6f62 6a65 6374   from <{} object
+000245b0: 2061 7420 7b7d 3e27 2e66 6f72 6d61 7428   at {}>'.format(
+000245c0: 277b 272b 2027 2c20 272e 6a6f 696e 285b  '{'+ ', '.join([
+000245d0: 2227 7b7d 2722 2e66 6f72 6d61 7428 7529  "'{}'".format(u)
+000245e0: 2066 6f72 2075 2069 6e20 7365 6c66 2e5f   for u in self._
+000245f0: 7573 6572 735d 292b 2027 7d27 2c73 656c  users])+ '}',sel
+00024600: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
+00024610: 6d65 5f5f 2c68 6578 2869 6428 7365 6c66  me__,hex(id(self
+00024620: 2929 2029 0d0a 0d0a 636c 6173 7320 5f56  )) )....class _V
+00024630: 6965 7770 6f69 6e74 7347 6574 7465 7228  iewpointsGetter(
+00024640: 6f62 6a65 6374 293a 0d0a 2020 2020 2727  object):..    ''
+00024650: 2744 6f65 7320 6120 6269 7420 6f66 206d  'Does a bit of m
+00024660: 6167 6963 2074 6f20 616c 6c6f 7720 5369  agic to allow Si
+00024670: 7465 7320 746f 2068 6176 6520 6120 7669  tes to have a vi
+00024680: 6577 706f 696e 7473 206f 626a 6563 7420  ewpoints object 
+00024690: 7768 6963 6820 6265 6861 7665 7320 6c69  which behaves li
+000246a0: 6b65 2061 206c 617a 7920 6c6f 6164 696e  ke a lazy loadin
+000246b0: 6720 6469 6374 696f 6e61 7279 2727 270d  g dictionary'''.
+000246c0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+000246d0: 5f28 7365 6c66 2c73 6974 6529 3a0d 0a20  _(self,site):.. 
+000246e0: 2020 2020 2020 206c 6f67 2e64 6562 7567         log.debug
+000246f0: 2827 4372 6561 7469 6e67 205f 5669 6577  ('Creating _View
+00024700: 706f 696e 7473 4765 7474 6572 2729 0d0a  pointsGetter')..
+00024710: 2020 2020 2020 2020 7365 6c66 2e73 6974          self.sit
+00024720: 653d 7369 7465 0d0a 2020 2020 2020 2020  e=site..        
+00024730: 7365 6c66 2e5f 7669 6577 706f 696e 7473  self._viewpoints
+00024740: 3d7b 7d0d 0a0d 0a20 2020 2020 2020 2073  ={}....        s
+00024750: 656c 662e 5f5f 7669 6577 706f 696e 7473  elf.__viewpoints
+00024760: 5f72 6561 6420 3d20 4661 6c73 650d 0a20  _read = False.. 
+00024770: 2020 2020 2020 2073 656c 662e 5f5f 7669         self.__vi
+00024780: 6577 706f 696e 7473 5f73 796e 6365 6420  ewpoints_synced 
+00024790: 3d20 5472 7565 0d0a 0d0a 2020 2020 2353  = True....    #S
+000247a0: 6574 2074 6865 7365 2061 7320 7072 6f70  et these as prop
+000247b0: 6572 7469 6573 2066 6f72 2064 6562 7567  erties for debug
+000247c0: 6769 6e67 202d 2077 6865 6e20 616c 6c20  ging - when all 
+000247d0: 6973 2077 6f72 6b69 6e67 206d 616b 6520  is working make 
+000247e0: 7468 656d 206e 6f72 6d61 6c20 6174 7472  them normal attr
+000247f0: 6962 7574 6573 2061 6761 696e 0d0a 2020  ibutes again..  
+00024800: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+00024810: 2064 6566 205f 7669 6577 706f 696e 7473   def _viewpoints
+00024820: 5f72 6561 6428 7365 6c66 293a 0d0a 2020  _read(self):..  
+00024830: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00024840: 662e 5f5f 7669 6577 706f 696e 7473 5f72  f.__viewpoints_r
+00024850: 6561 640d 0a0d 0a20 2020 2040 5f76 6965  ead....    @_vie
+00024860: 7770 6f69 6e74 735f 7265 6164 2e73 6574  wpoints_read.set
+00024870: 7465 720d 0a20 2020 2064 6566 205f 7669  ter..    def _vi
+00024880: 6577 706f 696e 7473 5f72 6561 6428 7365  ewpoints_read(se
+00024890: 6c66 2c76 616c 293a 0d0a 2020 2020 2020  lf,val):..      
+000248a0: 2020 236c 6f67 2e64 6562 7567 2827 5f76    #log.debug('_v
+000248b0: 6965 7770 6f69 6e74 735f 7265 6164 2073  iewpoints_read s
+000248c0: 6574 2074 6f20 7b7d 272e 666f 726d 6174  et to {}'.format
+000248d0: 2876 616c 2929 0d0a 2020 2020 2020 2020  (val))..        
+000248e0: 7365 6c66 2e5f 5f76 6965 7770 6f69 6e74  self.__viewpoint
+000248f0: 735f 7265 6164 203d 2076 616c 0d0a 0d0a  s_read = val....
+00024900: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+00024910: 2020 2064 6566 205f 7669 6577 706f 696e     def _viewpoin
+00024920: 7473 5f73 796e 6365 6428 7365 6c66 293a  ts_synced(self):
+00024930: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00024940: 2073 656c 662e 5f5f 7669 6577 706f 696e   self.__viewpoin
+00024950: 7473 5f73 796e 6365 640d 0a0d 0a20 2020  ts_synced....   
+00024960: 2040 5f76 6965 7770 6f69 6e74 735f 7379   @_viewpoints_sy
+00024970: 6e63 6564 2e73 6574 7465 720d 0a20 2020  nced.setter..   
+00024980: 2064 6566 205f 7669 6577 706f 696e 7473   def _viewpoints
+00024990: 5f73 796e 6365 6428 7365 6c66 2c76 616c  _synced(self,val
+000249a0: 293a 0d0a 2020 2020 2020 2020 236c 6f67  ):..        #log
+000249b0: 2e77 6172 6e69 6e67 2827 5f76 6965 7770  .warning('_viewp
+000249c0: 6f69 6e74 735f 7379 6e63 6564 2073 6574  oints_synced set
+000249d0: 2074 6f20 7b7d 272e 666f 726d 6174 2876   to {}'.format(v
+000249e0: 616c 2929 0d0a 2020 2020 2020 2020 7365  al))..        se
+000249f0: 6c66 2e5f 5f76 6965 7770 6f69 6e74 735f  lf.__viewpoints_
+00024a00: 7379 6e63 6564 203d 2076 616c 0d0a 0d0a  synced = val....
+00024a10: 2020 2020 2355 6e6c 696b 6520 6120 7374      #Unlike a st
+00024a20: 616e 6461 7264 2064 6963 7469 6f6e 6172  andard dictionar
+00024a30: 7920 7768 6963 6820 7265 7475 726e 7320  y which returns 
+00024a40: 6b65 7973 2069 6e20 6974 6572 2c20 7265  keys in iter, re
+00024a50: 7475 726e 2076 616c 7565 7320 2873 696e  turn values (sin
+00024a60: 6365 2074 6861 7427 7320 7768 6174 2077  ce that's what w
+00024a70: 6520 7573 7561 6c6c 7920 7761 6e74 290d  e usually want).
+00024a80: 0a20 2020 2064 6566 205f 5f69 7465 725f  .    def __iter_
+00024a90: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+00024aa0: 2020 6966 206e 6f74 2073 656c 662e 5f76    if not self._v
+00024ab0: 6965 7770 6f69 6e74 735f 7265 6164 3a0d  iewpoints_read:.
+00024ac0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00024ad0: 662e 5f6c 6f61 645f 7669 6577 706f 696e  f._load_viewpoin
+00024ae0: 7473 2829 0d0a 2020 2020 2020 2020 6c6f  ts()..        lo
+00024af0: 672e 6465 6275 6728 2743 616c 6c65 6420  g.debug('Called 
+00024b00: 5f56 6965 7770 6f69 6e74 7347 6574 7465  _ViewpointsGette
+00024b10: 722e 5f5f 6974 6572 5f5f 2729 0d0a 2020  r.__iter__')..  
+00024b20: 2020 2020 2020 7365 6c66 2e5f 6974 6572        self._iter
+00024b30: 6174 6f72 203d 2069 7465 7228 7365 6c66  ator = iter(self
+00024b40: 2e5f 7669 6577 706f 696e 7473 2e76 616c  ._viewpoints.val
+00024b50: 7565 7328 2929 0d0a 2020 2020 2020 2020  ues())..        
+00024b60: 7265 7475 726e 2073 656c 660d 0a0d 0a20  return self.... 
+00024b70: 2020 2064 6566 205f 5f6e 6578 745f 5f28     def __next__(
+00024b80: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00024b90: 6c6f 672e 6465 6275 6728 2743 616c 6c65  log.debug('Calle
+00024ba0: 6420 5f56 6965 7770 6f69 6e74 7347 6574  d _ViewpointsGet
+00024bb0: 7465 722e 5f5f 6e65 7874 5f5f 2729 0d0a  ter.__next__')..
+00024bc0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+00024bd0: 6578 7428 7365 6c66 2e5f 6974 6572 6174  ext(self._iterat
+00024be0: 6f72 290d 0a0d 0a20 2020 2064 6566 205f  or)....    def _
+00024bf0: 5f67 6574 6974 656d 5f5f 2873 656c 662c  _getitem__(self,
+00024c00: 6974 656d 293a 0d0a 2020 2020 2020 2020  item):..        
+00024c10: 234c 6f61 6420 7468 6520 5669 6577 706f  #Load the Viewpo
+00024c20: 696e 7473 2069 6620 7765 2068 6176 656e  ints if we haven
+00024c30: 2774 2061 6c72 6561 6479 0d0a 2020 2020  't already..    
+00024c40: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00024c50: 5f76 6965 7770 6f69 6e74 735f 7265 6164  _viewpoints_read
+00024c60: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00024c70: 656c 662e 5f6c 6f61 645f 7669 6577 706f  elf._load_viewpo
+00024c80: 696e 7473 2829 0d0a 0d0a 2020 2020 2020  ints()....      
+00024c90: 2020 7265 7475 726e 2073 656c 662e 5f76    return self._v
+00024ca0: 6965 7770 6f69 6e74 735b 6974 656d 5d0d  iewpoints[item].
+00024cb0: 0a0d 0a20 2020 2064 6566 205f 6c6f 6164  ...    def _load
+00024cc0: 5f76 6965 7770 6f69 6e74 7328 7365 6c66  _viewpoints(self
+00024cd0: 293a 0d0a 2020 2020 2020 2020 6c6f 672e  ):..        log.
+00024ce0: 7665 7262 6f73 6528 2752 6561 6469 6e67  verbose('Reading
+00024cf0: 2056 6965 7770 6f69 6e74 7327 290d 0a20   Viewpoints').. 
+00024d00: 2020 2020 2020 2073 656c 662e 5f76 6965         self._vie
+00024d10: 7770 6f69 6e74 735f 7265 6164 203d 2054  wpoints_read = T
+00024d20: 7275 650d 0a0d 0a20 2020 2020 2020 2074  rue....        t
+00024d30: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+00024d40: 206d 616a 6f72 5f76 6572 7369 6f6e 2c20   major_version, 
+00024d50: 6d69 6e6f 725f 7665 7273 696f 6e2c 2072  minor_version, r
+00024d60: 656c 6561 7365 2c20 7265 6c65 6173 655f  elease, release_
+00024d70: 6e75 6d62 6572 203d 2073 656c 662e 7369  number = self.si
+00024d80: 7465 2e69 6d70 6f72 7465 725f 7665 7273  te.importer_vers
+00024d90: 696f 6e0d 0a0d 0a20 2020 2020 2020 2020  ion....         
+00024da0: 2020 2069 6620 7365 6c66 2e73 6974 652e     if self.site.
+00024db0: 5f65 6e63 7279 7074 6564 5f75 7365 7220  _encrypted_user 
+00024dc0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00024dd0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00024de0: 6d70 6578 2e45 6d70 6f77 6572 5365 6375  mpex.EmpowerSecu
+00024df0: 7269 7479 4572 726f 7228 2754 6865 2065  rityError('The e
+00024e00: 6e63 7279 7074 6564 5f75 7365 7220 6d75  ncrypted_user mu
+00024e10: 7374 2062 6520 7365 7420 746f 2061 6363  st be set to acc
+00024e20: 6573 7320 7669 6577 706f 696e 7473 2e20  ess viewpoints. 
+00024e30: 5265 6d6f 7665 2068 6172 6463 6f64 6564  Remove hardcoded
+00024e40: 2070 6173 7377 6f72 6473 2061 6e64 2075   passwords and u
+00024e50: 7365 7220 6e61 6d65 7320 696e 2063 616c  ser names in cal
+00024e60: 6c73 2074 6f20 5369 7465 2829 2069 6e20  ls to Site() in 
+00024e70: 796f 7572 2073 6372 6970 742c 2069 6e20  your script, in 
+00024e80: 6f72 6465 7220 746f 2062 6520 7072 6f6d  order to be prom
+00024e90: 7074 6564 2066 6f72 2061 2075 7365 7220  pted for a user 
+00024ea0: 616e 6420 7061 7373 776f 7264 2729 0d0a  and password')..
+00024eb0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00024ec0: 2028 6d61 6a6f 725f 7665 7273 696f 6e20   (major_version 
+00024ed0: 3d3d 2039 2061 6e64 2028 7265 6c65 6173  == 9 and (releas
+00024ee0: 655f 6e75 6d62 6572 203e 3d20 3139 3433  e_number >= 1943
+00024ef0: 206f 7220 6d69 6e6f 725f 7665 7273 696f   or minor_versio
+00024f00: 6e20 3e3d 3729 2920 6f72 206d 616a 6f72  n >=7)) or major
+00024f10: 5f76 6572 7369 6f6e 203e 2039 3a0d 0a0d  _version > 9:...
+00024f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00024f30: 2072 6574 7572 6e5f 6469 6374 3d7b 7d0d   return_dict={}.
+00024f40: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00024f50: 2020 2023 4865 6c70 6572 2066 756e 6374     #Helper funct
+00024f60: 696f 6e20 746f 2063 6f6e 7665 7274 2073  ion to convert s
+00024f70: 7472 696e 6773 2063 6f72 7265 6374 6c79  trings correctly
+00024f80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00024f90: 2020 6465 6620 636f 6e76 6572 745f 7374    def convert_st
+00024fa0: 7269 6e67 2873 293a 0d0a 2020 2020 2020  ring(s):..      
+00024fb0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00024fc0: 2073 203d 3d20 2727 3a0d 0a20 2020 2020   s == '':..     
+00024fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00024fe0: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
+00024ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025000: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00025010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025020: 2020 2072 6574 7572 6e20 730d 0a0d 0a20     return s.... 
+00025030: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00025040: 5468 6520 7669 6577 706f 696e 7420 6c69  The viewpoint li
+00025050: 7374 2074 6861 7420 7769 6c6c 2062 6520  st that will be 
+00025060: 7265 7475 726e 6564 202d 2077 6527 6c6c  returned - we'll
+00025070: 2061 6464 2076 6965 7770 6f69 6e74 7320   add viewpoints 
+00025080: 746f 2074 6869 7320 6c69 7374 0d0a 2020  to this list..  
+00025090: 2020 2020 2020 2020 2020 2020 2020 7669                vi
+000250a0: 6577 706f 696e 745f 6c69 7374 3d5b 5d0d  ewpoint_list=[].
+000250b0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+000250c0: 2020 2023 5468 6973 2069 7320 6e6f 7420     #This is not 
+000250d0: 6120 6261 636b 706f 7274 6564 2063 6f6d  a backported com
+000250e0: 6d61 6e64 2c20 736f 2072 756e 206f 6e6c  mand, so run onl
+000250f0: 7920 7769 7468 2065 6e63 7279 7074 696f  y with encryptio
+00025100: 6e2c 2069 6e20 6f72 6465 7220 746f 206e  n, in order to n
+00025110: 7564 6765 2075 7365 7273 2074 6f77 6172  udge users towar
+00025120: 6420 6265 7374 2070 7261 6374 6963 650d  d best practice.
+00025130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025140: 206c 6f67 2e76 6572 626f 7365 2820 2252   log.verbose( "R
+00025150: 756e 6e69 6e67 2049 4d50 4f52 5445 523a  unning IMPORTER:
+00025160: 2066 726f 6d20 3c73 7464 696e 3e20 7769   from <stdin> wi
+00025170: 7468 2065 6e63 7279 7074 6564 206c 6f67  th encrypted log
+00025180: 6f6e 2074 6f20 6578 706f 7274 2074 6865  on to export the
+00025190: 2045 6d70 6f77 6572 2053 6974 6520 7669   Empower Site vi
+000251a0: 6577 706f 696e 7473 2066 726f 6d20 222b  ewpoints from "+
+000251b0: 7365 6c66 2e73 6974 652e 5f73 6974 655f  self.site._site_
+000251c0: 6c6f 6361 746f 7229 0d0a 0d0a 2020 2020  locator)....    
+000251d0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000251e0: 6d61 6a6f 725f 7665 7273 696f 6e20 3d3d  major_version ==
+000251f0: 2039 2061 6e64 2028 7265 6c65 6173 655f   9 and (release_
+00025200: 6e75 6d62 6572 203e 3d20 3231 3432 206f  number >= 2142 o
+00025210: 7220 6d69 6e6f 725f 7665 7273 696f 6e20  r minor_version 
+00025220: 3e3d 3729 2920 6f72 206d 616a 6f72 5f76  >=7)) or major_v
+00025230: 6572 7369 6f6e 203e 2039 3a0d 0a20 2020  ersion > 9:..   
+00025240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025250: 2072 6573 756c 7420 3d20 7365 6c66 2e73   result = self.s
+00025260: 6974 652e 696d 706f 7274 6572 2e72 756e  ite.importer.run
+00025270: 5f63 6f6d 6d61 6e64 7328 5b27 656d 706f  _commands(['empo
+00025280: 7765 722d 6578 706f 7274 2d76 6965 7770  wer-export-viewp
+00025290: 6f69 6e74 7320 2d70 6879 732d 6964 7320  oints -phys-ids 
+000252a0: 247b 7369 7465 7d20 247b 7573 6572 7d20  ${site} ${user} 
+000252b0: 247b 7061 7373 776f 7264 7d27 2c27 6f75  ${password}','ou
+000252c0: 7470 7574 275d 290d 0a20 2020 2020 2020  tput'])..       
+000252d0: 2020 2020 2020 2020 2020 2020 2070 6879               phy
+000252e0: 7369 6473 5f69 6e63 6c75 6465 6420 3d20  sids_included = 
+000252f0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
+00025300: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00025310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025320: 2072 6573 756c 7420 3d20 7365 6c66 2e73   result = self.s
+00025330: 6974 652e 696d 706f 7274 6572 2e72 756e  ite.importer.run
+00025340: 5f63 6f6d 6d61 6e64 7328 5b27 656d 706f  _commands(['empo
+00025350: 7765 722d 6578 706f 7274 2d76 6965 7770  wer-export-viewp
+00025360: 6f69 6e74 7320 247b 7369 7465 7d20 247b  oints ${site} ${
+00025370: 7573 6572 7d20 247b 7061 7373 776f 7264  user} ${password
+00025380: 7d27 2c27 6f75 7470 7574 275d 290d 0a20  }','output']).. 
+00025390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000253a0: 2020 2070 6879 7369 6473 5f69 6e63 6c75     physids_inclu
+000253b0: 6465 6420 3d20 4661 6c73 650d 0a0d 0a20  ded = False.... 
+000253c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000253d0: 6965 6c64 6e61 6d65 7320 3d20 2020 2072  ieldnames =    r
+000253e0: 6573 756c 745b 305d 2e6b 6579 7328 290d  esult[0].keys().
+000253f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00025400: 2023 5573 6520 6361 6e6f 6e69 6361 6c20   #Use canonical 
+00025410: 5374 7275 6374 7572 6573 2069 6620 7468  Structures if th
+00025420: 6579 2068 6176 6520 6265 656e 206c 6f61  ey have been loa
+00025430: 6465 6420 616c 7265 6164 7920 6f72 2063  ded already or c
+00025440: 7265 6174 6520 7374 7562 7320 2877 6520  reate stubs (we 
+00025450: 646f 6e27 7420 6e65 6564 2065 7665 7279  don't need every
+00025460: 2053 7472 7563 7475 7265 206c 6f61 6465   Structure loade
+00025470: 6420 666f 7220 6576 6572 7920 7669 6577  d for every view
+00025480: 706f 696e 7429 0d0a 2020 2020 2020 2020  point)..        
+00025490: 2020 2020 2020 2020 2343 6865 636b 2066          #Check f
+000254a0: 6f72 2074 6865 2065 7869 7374 696e 6720  or the existing 
+000254b0: 7374 7275 6374 7572 6520 6279 206c 6f6f  structure by loo
+000254c0: 6b69 6e67 2061 7420 7468 6520 6f62 6a65  king at the obje
+000254d0: 6374 2064 6972 6563 746c 7920 2d20 646f  ct directly - do
+000254e0: 6e27 7420 7573 6520 7468 6520 6163 6365  n't use the acce
+000254f0: 7373 6f72 206d 6574 686f 6420 6f72 2077  ssor method or w
+00025500: 6520 7769 6c6c 2070 726f 766f 6b65 2061  e will provoke a
+00025510: 206c 617a 7920 6c6f 6164 0d0a 0d0a 0d0a   lazy load......
+00025520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025530: 2355 7365 2074 6865 2066 6965 6c64 206e  #Use the field n
+00025540: 616d 6573 206f 6620 7468 6520 7669 6577  ames of the view
+00025550: 706f 696e 7473 2074 6f20 7365 7420 7468  points to set th
+00025560: 6520 6c6f 6e67 206e 616d 6573 206f 6620  e long names of 
+00025570: 7468 6520 6469 6d65 6e73 696f 6e73 0d0a  the dimensions..
+00025580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025590: 666f 7220 6e2c 2066 6965 6c64 2069 6e20  for n, field in 
+000255a0: 656e 756d 6572 6174 6528 6669 656c 646e  enumerate(fieldn
+000255b0: 616d 6573 293a 0d0a 2020 2020 2020 2020  ames):..        
+000255c0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000255d0: 2b31 203c 2073 656c 662e 7369 7465 2e6e  +1 < self.site.n
+000255e0: 756d 6265 725f 6f66 5f75 6e69 745f 6469  umber_of_unit_di
+000255f0: 6d65 6e73 696f 6e73 3a0d 0a20 2020 2020  mensions:..     
+00025600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025610: 2020 2073 656c 662e 7369 7465 2e64 696d     self.site.dim
+00025620: 656e 7369 6f6e 735b 6e5d 2e5f 6c6f 6e67  ensions[n]._long
+00025630: 6e61 6d65 203d 2066 6965 6c64 0d0a 0d0a  name = field....
+00025640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025650: 2020 2020 656c 6966 206e 203e 3d20 7365      elif n >= se
 00025660: 6c66 2e73 6974 652e 6e75 6d62 6572 5f6f  lf.site.number_o
 00025670: 665f 756e 6974 5f64 696d 656e 7369 6f6e  f_unit_dimension
-00025680: 7320 2b20 353a 0d0a 2020 2020 2020 2020  s + 5:..        
-00025690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000256a0: 7365 6c66 2e73 6974 652e 6469 6d65 6e73  self.site.dimens
-000256b0: 696f 6e73 5b6e 202b 2028 3820 2d20 7365  ions[n + (8 - se
-000256c0: 6c66 2e73 6974 652e 6e75 6d62 6572 5f6f  lf.site.number_o
-000256d0: 665f 756e 6974 5f64 696d 656e 7369 6f6e  f_unit_dimension
-000256e0: 7329 5d2e 5f6c 6f6e 676e 616d 6520 3d20  s)]._longname = 
-000256f0: 6669 656c 640d 0a0d 0a20 2020 2020 2020  field....       
-00025700: 2020 2020 2020 2020 2023 6578 616d 706c           #exampl
-00025710: 6520 6f66 2074 6865 2073 7472 7563 7475  e of the structu
-00025720: 7265 2077 6520 6172 6520 7472 7969 6e67  re we are trying
-00025730: 2074 6f20 7265 6164 3a0d 0a20 2020 2020   to read:..     
-00025740: 2020 2020 2020 2020 2020 2023 5375 6273             #Subs
-00025750: 6964 6961 7279 2050 726f 6475 6374 2020  idiary Product  
-00025760: 2020 2020 4375 7374 6f6d 6572 2020 2049      Customer   I
-00025770: 7465 6d20 2020 2020 436f 6d70 6172 6973  tem     Comparis
-00025780: 6f6e 2020 2020 2043 7572 7265 6e63 7920  on     Currency 
-00025790: 2020 2020 2050 6572 696f 6420 2020 2020       Period     
-000257a0: 2020 5472 616e 7366 6f72 6d61 7469 6f6e    Transformation
-000257b0: 2020 204c 6f6e 676e 616d 6520 2020 2020     Longname     
-000257c0: 2020 2020 2020 2020 5368 6f72 746e 616d          Shortnam
-000257d0: 6520 2020 4465 7363 7269 7074 696f 6e0d  e   Description.
-000257e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000257f0: 2023 4575 726f 7065 2020 2020 2041 6c6c   #Europe     All
-00025800: 5072 6f64 7320 2020 2020 416c 6c43 7573  Prods     AllCus
-00025810: 7420 2020 2050 264c 2020 2020 2020 4d6f  t    P&L      Mo
-00025820: 6465 4772 6f75 7073 2020 2020 2041 6c6c  deGroups     All
-00025830: 4375 7272 656e 6320 2020 204d 6169 6e54  Currenc    MainT
-00025840: 696d 6520 2020 2020 5472 616e 7366 6f72  ime     Transfor
-00025850: 6d73 2020 2020 2020 2045 7572 6f70 6520  ms       Europe 
-00025860: 5669 6577 706f 696e 7420 2020 2020 4575  Viewpoint     Eu
-00025870: 7256 6965 7770 0d0a 2020 2020 2020 2020  rViewp..        
-00025880: 2020 2020 2020 2020 2341 6d65 7269 6361          #America
-00025890: 7320 2020 416c 6c50 726f 6473 2020 2020  s   AllProds    
-000258a0: 2041 6d43 7573 7420 2020 2020 5026 4c20   AmCust     P&L 
-000258b0: 2020 2020 204d 6f64 6547 726f 7570 7320       ModeGroups 
-000258c0: 2020 2020 5553 4375 7272 2020 2020 2020      USCurr      
-000258d0: 2020 4d61 696e 5469 6d65 2020 2020 2054    MainTime     T
-000258e0: 7261 6e73 666f 726d 7320 2020 2020 2020  ransforms       
-000258f0: 416d 6572 6963 6173 2056 6965 7770 6f69  Americas Viewpoi
-00025900: 6e74 2020 2041 6d56 6965 7770 2020 2020  nt   AmViewp    
-00025910: 2054 6172 6765 7474 6564 2076 6965 7770   Targetted viewp
-00025920: 6f69 6e74 2066 6f72 204e 6f72 7468 2061  oint for North a
-00025930: 6e64 2053 6f75 7468 2041 6d65 7269 6361  nd South America
-00025940: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00025950: 2020 2020 666f 7220 7265 636f 7264 2069      for record i
-00025960: 6e20 7265 7375 6c74 3a0d 0a0d 0a20 2020  n result:....   
+00025680: 7320 616e 6420 6e20 3c20 7365 6c66 2e73  s and n < self.s
+00025690: 6974 652e 6e75 6d62 6572 5f6f 665f 756e  ite.number_of_un
+000256a0: 6974 5f64 696d 656e 7369 6f6e 7320 2b20  it_dimensions + 
+000256b0: 353a 0d0a 2020 2020 2020 2020 2020 2020  5:..            
+000256c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000256d0: 2e73 6974 652e 6469 6d65 6e73 696f 6e73  .site.dimensions
+000256e0: 5b6e 202b 2028 3820 2d20 7365 6c66 2e73  [n + (8 - self.s
+000256f0: 6974 652e 6e75 6d62 6572 5f6f 665f 756e  ite.number_of_un
+00025700: 6974 5f64 696d 656e 7369 6f6e 7329 5d2e  it_dimensions)].
+00025710: 5f6c 6f6e 676e 616d 6520 3d20 6669 656c  _longname = fiel
+00025720: 640d 0a0d 0a20 2020 2020 2020 2020 2020  d....           
+00025730: 2020 2020 2023 6578 616d 706c 6520 6f66       #example of
+00025740: 2074 6865 2073 7472 7563 7475 7265 2077   the structure w
+00025750: 6520 6172 6520 7472 7969 6e67 2074 6f20  e are trying to 
+00025760: 7265 6164 3a0d 0a20 2020 2020 2020 2020  read:..         
+00025770: 2020 2020 2020 2023 5375 6273 6964 6961         #Subsidia
+00025780: 7279 2050 726f 6475 6374 2020 2020 2020  ry Product      
+00025790: 4375 7374 6f6d 6572 2020 2049 7465 6d20  Customer   Item 
+000257a0: 2020 2020 436f 6d70 6172 6973 6f6e 2020      Comparison  
+000257b0: 2020 2043 7572 7265 6e63 7920 2020 2020     Currency     
+000257c0: 2050 6572 696f 6420 2020 2020 2020 5472   Period       Tr
+000257d0: 616e 7366 6f72 6d61 7469 6f6e 2020 204c  ansformation   L
+000257e0: 6f6e 676e 616d 6520 2020 2020 2020 2020  ongname         
+000257f0: 2020 2020 5368 6f72 746e 616d 6520 2020      Shortname   
+00025800: 4465 7363 7269 7074 696f 6e0d 0a20 2020  Description..   
+00025810: 2020 2020 2020 2020 2020 2020 2023 4575               #Eu
+00025820: 726f 7065 2020 2020 2041 6c6c 5072 6f64  rope     AllProd
+00025830: 7320 2020 2020 416c 6c43 7573 7420 2020  s     AllCust   
+00025840: 2050 264c 2020 2020 2020 4d6f 6465 4772   P&L      ModeGr
+00025850: 6f75 7073 2020 2020 2041 6c6c 4375 7272  oups     AllCurr
+00025860: 656e 6320 2020 204d 6169 6e54 696d 6520  enc    MainTime 
+00025870: 2020 2020 5472 616e 7366 6f72 6d73 2020      Transforms  
+00025880: 2020 2020 2045 7572 6f70 6520 5669 6577       Europe View
+00025890: 706f 696e 7420 2020 2020 4575 7256 6965  point     EurVie
+000258a0: 7770 0d0a 2020 2020 2020 2020 2020 2020  wp..            
+000258b0: 2020 2020 2341 6d65 7269 6361 7320 2020      #Americas   
+000258c0: 416c 6c50 726f 6473 2020 2020 2041 6d43  AllProds     AmC
+000258d0: 7573 7420 2020 2020 5026 4c20 2020 2020  ust     P&L     
+000258e0: 204d 6f64 6547 726f 7570 7320 2020 2020   ModeGroups     
+000258f0: 5553 4375 7272 2020 2020 2020 2020 4d61  USCurr        Ma
+00025900: 696e 5469 6d65 2020 2020 2054 7261 6e73  inTime     Trans
+00025910: 666f 726d 7320 2020 2020 2020 416d 6572  forms       Amer
+00025920: 6963 6173 2056 6965 7770 6f69 6e74 2020  icas Viewpoint  
+00025930: 2041 6d56 6965 7770 2020 2020 2054 6172   AmViewp     Tar
+00025940: 6765 7474 6564 2076 6965 7770 6f69 6e74  getted viewpoint
+00025950: 2066 6f72 204e 6f72 7468 2061 6e64 2053   for North and S
+00025960: 6f75 7468 2041 6d65 7269 6361 0d0a 0d0a  outh America....
 00025970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025980: 2073 7472 7563 7475 7265 7320 3d20 7b7d   structures = {}
-00025990: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000259a0: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
-000259b0: 2072 616e 6765 2873 656c 662e 7369 7465   range(self.site
-000259c0: 2e6e 756d 6265 725f 6f66 5f75 6e69 745f  .number_of_unit_
-000259d0: 6469 6d65 6e73 696f 6e73 293a 0d0a 2020  dimensions):..  
-000259e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000259f0: 2020 2020 2020 6469 6d5f 6e5f 6669 656c        dim_n_fiel
-00025a00: 646e 616d 6520 3d20 7365 6c66 2e73 6974  dname = self.sit
-00025a10: 652e 6469 6d65 6e73 696f 6e73 5b6e 5d2e  e.dimensions[n].
-00025a20: 6c6f 6e67 6e61 6d65 0d0a 2020 2020 2020  longname..      
-00025a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025a40: 2020 6469 6d5f 6e5f 7374 7275 6374 7572    dim_n_structur
-00025a50: 6520 3d20 7265 636f 7264 5b64 696d 5f6e  e = record[dim_n
-00025a60: 5f66 6965 6c64 6e61 6d65 5d0d 0a20 2020  _fieldname]..   
-00025a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025a80: 2020 2020 2069 6620 7068 7973 6964 735f       if physids_
-00025a90: 696e 636c 7564 6564 3a0d 0a20 2020 2020  included:..     
+00025980: 666f 7220 7265 636f 7264 2069 6e20 7265  for record in re
+00025990: 7375 6c74 3a0d 0a0d 0a20 2020 2020 2020  sult:....       
+000259a0: 2020 2020 2020 2020 2020 2020 2073 7472               str
+000259b0: 7563 7475 7265 7320 3d20 7b7d 0d0a 0d0a  uctures = {}....
+000259c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000259d0: 2020 2020 666f 7220 6e20 696e 2072 616e      for n in ran
+000259e0: 6765 2873 656c 662e 7369 7465 2e6e 756d  ge(self.site.num
+000259f0: 6265 725f 6f66 5f75 6e69 745f 6469 6d65  ber_of_unit_dime
+00025a00: 6e73 696f 6e73 293a 0d0a 2020 2020 2020  nsions):..      
+00025a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025a20: 2020 6469 6d5f 6e5f 6669 656c 646e 616d    dim_n_fieldnam
+00025a30: 6520 3d20 7365 6c66 2e73 6974 652e 6469  e = self.site.di
+00025a40: 6d65 6e73 696f 6e73 5b6e 5d2e 6c6f 6e67  mensions[n].long
+00025a50: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+00025a60: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00025a70: 6d5f 6e5f 7374 7275 6374 7572 6520 3d20  m_n_structure = 
+00025a80: 7265 636f 7264 5b64 696d 5f6e 5f66 6965  record[dim_n_fie
+00025a90: 6c64 6e61 6d65 5d0d 0a20 2020 2020 2020  ldname]..       
 00025aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ab0: 2020 2020 2020 2023 5374 7269 7020 7468         #Strip th
-00025ac0: 6520 7068 7973 6964 206f 6620 7468 6520  e physid of the 
-00025ad0: 7374 7275 6374 7572 6520 6f66 660d 0a20  structure off.. 
-00025ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025af0: 2020 2020 2020 2020 2020 2064 696d 5f6e             dim_n
-00025b00: 5f73 7472 7563 7475 7265 203d 2064 696d  _structure = dim
-00025b10: 5f6e 5f73 7472 7563 7475 7265 2e73 706c  _n_structure.spl
-00025b20: 6974 2827 2827 295b 305d 2e73 7472 6970  it('(')[0].strip
-00025b30: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00025b40: 2020 2020 2020 2020 2020 2020 7374 7275              stru
-00025b50: 6374 7572 6573 5b6e 5d20 3d20 6469 6d5f  ctures[n] = dim_
-00025b60: 6e5f 7374 7275 6374 7572 650d 0a0d 0a20  n_structure.... 
-00025b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025b80: 2020 2066 6f72 206e 2069 6e20 7261 6e67     for n in rang
-00025b90: 6528 3820 2d20 7365 6c66 2e73 6974 652e  e(8 - self.site.
-00025ba0: 6e75 6d62 6572 5f6f 665f 756e 6974 5f64  number_of_unit_d
-00025bb0: 696d 656e 7369 6f6e 7329 3a0d 0a20 2020  imensions):..   
-00025bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025bd0: 2020 2020 2073 7472 7563 7475 7265 735b       structures[
-00025be0: 6e2b 7365 6c66 2e73 6974 652e 6e75 6d62  n+self.site.numb
-00025bf0: 6572 5f6f 665f 756e 6974 5f64 696d 656e  er_of_unit_dimen
-00025c00: 7369 6f6e 735d 203d 204e 6f6e 650d 0a0d  sions] = None...
-00025c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025c20: 2020 2020 2066 6f72 206e 2069 6e20 7261       for n in ra
-00025c30: 6e67 6528 3529 3a0d 0a20 2020 2020 2020  nge(5):..       
+00025ab0: 2069 6620 7068 7973 6964 735f 696e 636c   if physids_incl
+00025ac0: 7564 6564 3a0d 0a20 2020 2020 2020 2020  uded:..         
+00025ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025ae0: 2020 2023 5374 7269 7020 7468 6520 7068     #Strip the ph
+00025af0: 7973 6964 206f 6620 7468 6520 7374 7275  ysid of the stru
+00025b00: 6374 7572 6520 6f66 660d 0a20 2020 2020  cture off..     
+00025b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025b20: 2020 2020 2020 2064 696d 5f6e 5f73 7472         dim_n_str
+00025b30: 7563 7475 7265 203d 2064 696d 5f6e 5f73  ucture = dim_n_s
+00025b40: 7472 7563 7475 7265 2e73 706c 6974 2827  tructure.split('
+00025b50: 2827 295b 305d 2e73 7472 6970 2829 0d0a  (')[0].strip()..
+00025b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025b70: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+00025b80: 6573 5b6e 5d20 3d20 6469 6d5f 6e5f 7374  es[n] = dim_n_st
+00025b90: 7275 6374 7572 650d 0a0d 0a20 2020 2020  ructure....     
+00025ba0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00025bb0: 6f72 206e 2069 6e20 7261 6e67 6528 3820  or n in range(8 
+00025bc0: 2d20 7365 6c66 2e73 6974 652e 6e75 6d62  - self.site.numb
+00025bd0: 6572 5f6f 665f 756e 6974 5f64 696d 656e  er_of_unit_dimen
+00025be0: 7369 6f6e 7329 3a0d 0a20 2020 2020 2020  sions):..       
+00025bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025c00: 2073 7472 7563 7475 7265 735b 6e2b 7365   structures[n+se
+00025c10: 6c66 2e73 6974 652e 6e75 6d62 6572 5f6f  lf.site.number_o
+00025c20: 665f 756e 6974 5f64 696d 656e 7369 6f6e  f_unit_dimension
+00025c30: 735d 203d 204e 6f6e 650d 0a0d 0a20 2020  s] = None....   
 00025c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025c50: 2064 696d 5f6e 5f66 6965 6c64 6e61 6d65   dim_n_fieldname
-00025c60: 203d 2073 656c 662e 7369 7465 2e64 696d   = self.site.dim
-00025c70: 656e 7369 6f6e 735b 6e2b 385d 2e6c 6f6e  ensions[n+8].lon
-00025c80: 676e 616d 650d 0a20 2020 2020 2020 2020  gname..         
-00025c90: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00025ca0: 696d 5f6e 5f73 7472 7563 7475 7265 203d  im_n_structure =
-00025cb0: 2072 6563 6f72 645b 6469 6d5f 6e5f 6669   record[dim_n_fi
-00025cc0: 656c 646e 616d 655d 0d0a 2020 2020 2020  eldname]..      
-00025cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025ce0: 2020 6966 2070 6879 7369 6473 5f69 6e63    if physids_inc
-00025cf0: 6c75 6465 643a 0d0a 2020 2020 2020 2020  luded:..        
-00025d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025d10: 2020 2020 2353 7472 6970 2074 6865 2070      #Strip the p
-00025d20: 6879 7369 6420 6f66 2074 6865 2073 7472  hysid of the str
-00025d30: 7563 7475 7265 206f 6666 0d0a 2020 2020  ucture off..    
-00025d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025d50: 2020 2020 2020 2020 6469 6d5f 6e5f 7374          dim_n_st
-00025d60: 7275 6374 7572 6520 3d20 6469 6d5f 6e5f  ructure = dim_n_
-00025d70: 7374 7275 6374 7572 652e 7370 6c69 7428  structure.split(
-00025d80: 2728 2729 5b30 5d2e 7374 7269 7028 290d  '(')[0].strip().
-00025d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00025da0: 2020 2020 2020 2020 2073 7472 7563 7475           structu
-00025db0: 7265 735b 6e2b 385d 203d 2064 696d 5f6e  res[n+8] = dim_n
-00025dc0: 5f73 7472 7563 7475 7265 0d0a 0d0a 2020  _structure....  
-00025dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025de0: 2020 7368 6f72 746e 616d 6520 2020 2020    shortname     
-00025df0: 2020 2020 203d 2063 6f6e 7665 7274 5f73       = convert_s
-00025e00: 7472 696e 6728 7265 636f 7264 5b27 5368  tring(record['Sh
-00025e10: 6f72 746e 616d 6527 5d29 0d0a 2020 2020  ortname'])..    
-00025e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00025e30: 6c6f 6e67 6e61 6d65 2020 2020 2020 2020  longname        
-00025e40: 2020 203d 2063 6f6e 7665 7274 5f73 7472     = convert_str
-00025e50: 696e 6728 7265 636f 7264 5b27 4c6f 6e67  ing(record['Long
-00025e60: 6e61 6d65 275d 290d 0a20 2020 2020 2020  name'])..       
-00025e70: 2020 2020 2020 2020 2020 2020 2064 6573               des
-00025e80: 6372 6970 7469 6f6e 2020 2020 2020 2020  cription        
-00025e90: 3d20 636f 6e76 6572 745f 7374 7269 6e67  = convert_string
-00025ea0: 2872 6563 6f72 645b 2744 6573 6372 6970  (record['Descrip
-00025eb0: 7469 6f6e 275d 290d 0a20 2020 2020 2020  tion'])..       
-00025ec0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00025ed0: 7068 7973 6964 735f 696e 636c 7564 6564  physids_included
-00025ee0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00025ef0: 2020 2020 2020 2020 2020 2070 6879 7369             physi
-00025f00: 6420 2020 2020 2020 2020 3d20 696e 7428  d         = int(
-00025f10: 7265 636f 7264 5b27 4944 275d 2e73 7472  record['ID'].str
-00025f20: 6970 2829 290d 0a20 2020 2020 2020 2020  ip())..         
-00025f30: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00025f40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00025f50: 2020 2020 2020 2020 2020 7068 7973 6964            physid
-00025f60: 2020 2020 2020 2020 203d 204e 6f6e 650d           = None.
-00025f70: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00025f80: 2020 2020 2020 2023 544f 444f 202d 2063         #TODO - c
-00025f90: 6f72 7265 6374 2070 6172 616d 6574 6572  orrect parameter
-00025fa0: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-00025fb0: 2020 2020 2020 2076 6965 7770 6f69 6e74         viewpoint
-00025fc0: 203d 2056 6965 7770 6f69 6e74 2873 6974   = Viewpoint(sit
-00025fd0: 6520 2020 2020 2020 2020 3d20 7365 6c66  e         = self
-00025fe0: 2e73 6974 650d 0a20 2020 2020 2020 2020  .site..         
-00025ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026010: 2c73 686f 7274 6e61 6d65 2020 2020 3d20  ,shortname    = 
-00026020: 7368 6f72 746e 616d 650d 0a20 2020 2020  shortname..     
-00026030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026050: 2020 2020 2c6c 6f6e 676e 616d 6520 2020      ,longname   
-00026060: 2020 3d20 6c6f 6e67 6e61 6d65 0d0a 2020    = longname..  
+00025c50: 2066 6f72 206e 2069 6e20 7261 6e67 6528   for n in range(
+00025c60: 3529 3a0d 0a20 2020 2020 2020 2020 2020  5):..           
+00025c70: 2020 2020 2020 2020 2020 2020 2064 696d               dim
+00025c80: 5f6e 5f66 6965 6c64 6e61 6d65 203d 2073  _n_fieldname = s
+00025c90: 656c 662e 7369 7465 2e64 696d 656e 7369  elf.site.dimensi
+00025ca0: 6f6e 735b 6e2b 385d 2e6c 6f6e 676e 616d  ons[n+8].longnam
+00025cb0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00025cc0: 2020 2020 2020 2020 2020 2064 696d 5f6e             dim_n
+00025cd0: 5f73 7472 7563 7475 7265 203d 2072 6563  _structure = rec
+00025ce0: 6f72 645b 6469 6d5f 6e5f 6669 656c 646e  ord[dim_n_fieldn
+00025cf0: 616d 655d 0d0a 2020 2020 2020 2020 2020  ame]..          
+00025d00: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00025d10: 2070 6879 7369 6473 5f69 6e63 6c75 6465   physids_include
+00025d20: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+00025d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025d40: 2353 7472 6970 2074 6865 2070 6879 7369  #Strip the physi
+00025d50: 6420 6f66 2074 6865 2073 7472 7563 7475  d of the structu
+00025d60: 7265 206f 6666 0d0a 2020 2020 2020 2020  re off..        
+00025d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025d80: 2020 2020 6469 6d5f 6e5f 7374 7275 6374      dim_n_struct
+00025d90: 7572 6520 3d20 6469 6d5f 6e5f 7374 7275  ure = dim_n_stru
+00025da0: 6374 7572 652e 7370 6c69 7428 2728 2729  cture.split('(')
+00025db0: 5b30 5d2e 7374 7269 7028 290d 0a20 2020  [0].strip()..   
+00025dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025dd0: 2020 2020 2073 7472 7563 7475 7265 735b       structures[
+00025de0: 6e2b 385d 203d 2064 696d 5f6e 5f73 7472  n+8] = dim_n_str
+00025df0: 7563 7475 7265 0d0a 0d0a 2020 2020 2020  ucture....      
+00025e00: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00025e10: 6f72 746e 616d 6520 2020 2020 2020 2020  ortname         
+00025e20: 203d 2063 6f6e 7665 7274 5f73 7472 696e   = convert_strin
+00025e30: 6728 7265 636f 7264 5b27 5368 6f72 746e  g(record['Shortn
+00025e40: 616d 6527 5d29 0d0a 2020 2020 2020 2020  ame'])..        
+00025e50: 2020 2020 2020 2020 2020 2020 6c6f 6e67              long
+00025e60: 6e61 6d65 2020 2020 2020 2020 2020 203d  name           =
+00025e70: 2063 6f6e 7665 7274 5f73 7472 696e 6728   convert_string(
+00025e80: 7265 636f 7264 5b27 4c6f 6e67 6e61 6d65  record['Longname
+00025e90: 275d 290d 0a20 2020 2020 2020 2020 2020  '])..           
+00025ea0: 2020 2020 2020 2020 2064 6573 6372 6970           descrip
+00025eb0: 7469 6f6e 2020 2020 2020 2020 3d20 636f  tion        = co
+00025ec0: 6e76 6572 745f 7374 7269 6e67 2872 6563  nvert_string(rec
+00025ed0: 6f72 645b 2744 6573 6372 6970 7469 6f6e  ord['Description
+00025ee0: 275d 290d 0a20 2020 2020 2020 2020 2020  '])..           
+00025ef0: 2020 2020 2020 2020 2069 6620 7068 7973           if phys
+00025f00: 6964 735f 696e 636c 7564 6564 3a0d 0a20  ids_included:.. 
+00025f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f20: 2020 2020 2020 2070 6879 7369 6420 2020         physid   
+00025f30: 2020 2020 2020 3d20 696e 7428 7265 636f        = int(reco
+00025f40: 7264 5b27 4944 275d 2e73 7472 6970 2829  rd['ID'].strip()
+00025f50: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00025f60: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00025f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025f80: 2020 2020 2020 7068 7973 6964 2020 2020        physid    
+00025f90: 2020 2020 203d 204e 6f6e 650d 0a0d 0a20       = None.... 
+00025fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025fb0: 2020 2023 544f 444f 202d 2063 6f72 7265     #TODO - corre
+00025fc0: 6374 2070 6172 616d 6574 6572 730d 0a20  ct parameters.. 
+00025fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00025fe0: 2020 2076 6965 7770 6f69 6e74 203d 2056     viewpoint = V
+00025ff0: 6965 7770 6f69 6e74 2873 6974 6520 2020  iewpoint(site   
+00026000: 2020 2020 2020 3d20 7365 6c66 2e73 6974        = self.sit
+00026010: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00026020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026030: 2020 2020 2020 2020 2020 2020 2c73 686f              ,sho
+00026040: 7274 6e61 6d65 2020 2020 3d20 7368 6f72  rtname    = shor
+00026050: 746e 616d 650d 0a20 2020 2020 2020 2020  tname..         
+00026060: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00026070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026090: 2020 2020 2020 202c 6465 7363 7269 7074         ,descript
-000260a0: 696f 6e20 203d 2064 6573 6372 6970 7469  ion  = descripti
-000260b0: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
-000260c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000260d0: 2020 2020 2020 2020 2020 2020 202c 7374               ,st
-000260e0: 7275 6374 7572 655f 3020 203d 2073 7472  ructure_0  = str
-000260f0: 7563 7475 7265 735b 305d 0d0a 2020 2020  uctures[0]..    
-00026100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026120: 2020 2020 202c 7374 7275 6374 7572 655f       ,structure_
-00026130: 3120 203d 2073 7472 7563 7475 7265 735b  1  = structures[
-00026140: 315d 0d0a 2020 2020 2020 2020 2020 2020  1]..            
-00026150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026160: 2020 2020 2020 2020 2020 2020 202c 7374               ,st
-00026170: 7275 6374 7572 655f 3220 203d 2073 7472  ructure_2  = str
-00026180: 7563 7475 7265 735b 325d 0d0a 2020 2020  uctures[2]..    
-00026190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261b0: 2020 2020 202c 7374 7275 6374 7572 655f       ,structure_
-000261c0: 3320 203d 2073 7472 7563 7475 7265 735b  3  = structures[
-000261d0: 335d 0d0a 2020 2020 2020 2020 2020 2020  3]..            
-000261e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000261f0: 2020 2020 2020 2020 2020 2020 202c 7374               ,st
-00026200: 7275 6374 7572 655f 3420 203d 2073 7472  ructure_4  = str
-00026210: 7563 7475 7265 735b 345d 0d0a 2020 2020  uctures[4]..    
-00026220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026240: 2020 2020 202c 7374 7275 6374 7572 655f       ,structure_
-00026250: 3520 203d 2073 7472 7563 7475 7265 735b  5  = structures[
-00026260: 355d 0d0a 2020 2020 2020 2020 2020 2020  5]..            
-00026270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026280: 2020 2020 2020 2020 2020 2020 202c 7374               ,st
-00026290: 7275 6374 7572 655f 3620 203d 2073 7472  ructure_6  = str
-000262a0: 7563 7475 7265 735b 365d 0d0a 2020 2020  uctures[6]..    
-000262b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000262c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000262d0: 2020 2020 202c 7374 7275 6374 7572 655f       ,structure_
-000262e0: 3720 203d 2073 7472 7563 7475 7265 735b  7  = structures[
-000262f0: 375d 0d0a 2020 2020 2020 2020 2020 2020  7]..            
-00026300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026310: 2020 2020 2020 2020 2020 2020 202c 7374               ,st
-00026320: 7275 6374 7572 655f 3820 203d 2073 7472  ructure_8  = str
-00026330: 7563 7475 7265 735b 385d 0d0a 2020 2020  uctures[8]..    
-00026340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026360: 2020 2020 202c 7374 7275 6374 7572 655f       ,structure_
-00026370: 3920 203d 2073 7472 7563 7475 7265 735b  9  = structures[
-00026380: 395d 0d0a 2020 2020 2020 2020 2020 2020  9]..            
-00026390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000263a0: 2020 2020 2020 2020 2020 2020 202c 7374               ,st
-000263b0: 7275 6374 7572 655f 3130 203d 2073 7472  ructure_10 = str
-000263c0: 7563 7475 7265 735b 3130 5d0d 0a20 2020  uctures[10]..   
-000263d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000263e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000263f0: 2020 2020 2020 2c73 7472 7563 7475 7265        ,structure
-00026400: 5f31 3120 3d20 7374 7275 6374 7572 6573  _11 = structures
-00026410: 5b31 315d 0d0a 2020 2020 2020 2020 2020  [11]..          
-00026420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026430: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-00026440: 7374 7275 6374 7572 655f 3132 203d 2073  structure_12 = s
-00026450: 7472 7563 7475 7265 735b 3132 5d0d 0a20  tructures[12].. 
-00026460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026480: 2020 2020 2020 2020 2c70 6879 7369 6420          ,physid 
-00026490: 2020 2020 2020 3d20 7068 7973 6964 0d0a        = physid..
+00026080: 2c6c 6f6e 676e 616d 6520 2020 2020 3d20  ,longname     = 
+00026090: 6c6f 6e67 6e61 6d65 0d0a 2020 2020 2020  longname..      
+000260a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260c0: 2020 202c 6465 7363 7269 7074 696f 6e20     ,description 
+000260d0: 203d 2064 6573 6372 6970 7469 6f6e 0d0a   = description..
+000260e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000260f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026100: 2020 2020 2020 2020 202c 7374 7275 6374           ,struct
+00026110: 7572 655f 3020 203d 2073 7472 7563 7475  ure_0  = structu
+00026120: 7265 735b 305d 0d0a 2020 2020 2020 2020  res[0]..        
+00026130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026150: 202c 7374 7275 6374 7572 655f 3120 203d   ,structure_1  =
+00026160: 2073 7472 7563 7475 7265 735b 315d 0d0a   structures[1]..
+00026170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026190: 2020 2020 2020 2020 202c 7374 7275 6374           ,struct
+000261a0: 7572 655f 3220 203d 2073 7472 7563 7475  ure_2  = structu
+000261b0: 7265 735b 325d 0d0a 2020 2020 2020 2020  res[2]..        
+000261c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000261d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000261e0: 202c 7374 7275 6374 7572 655f 3320 203d   ,structure_3  =
+000261f0: 2073 7472 7563 7475 7265 735b 335d 0d0a   structures[3]..
+00026200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026220: 2020 2020 2020 2020 202c 7374 7275 6374           ,struct
+00026230: 7572 655f 3420 203d 2073 7472 7563 7475  ure_4  = structu
+00026240: 7265 735b 345d 0d0a 2020 2020 2020 2020  res[4]..        
+00026250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026270: 202c 7374 7275 6374 7572 655f 3520 203d   ,structure_5  =
+00026280: 2073 7472 7563 7475 7265 735b 355d 0d0a   structures[5]..
+00026290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262b0: 2020 2020 2020 2020 202c 7374 7275 6374           ,struct
+000262c0: 7572 655f 3620 203d 2073 7472 7563 7475  ure_6  = structu
+000262d0: 7265 735b 365d 0d0a 2020 2020 2020 2020  res[6]..        
+000262e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000262f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026300: 202c 7374 7275 6374 7572 655f 3720 203d   ,structure_7  =
+00026310: 2073 7472 7563 7475 7265 735b 375d 0d0a   structures[7]..
+00026320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026340: 2020 2020 2020 2020 202c 7374 7275 6374           ,struct
+00026350: 7572 655f 3820 203d 2073 7472 7563 7475  ure_8  = structu
+00026360: 7265 735b 385d 0d0a 2020 2020 2020 2020  res[8]..        
+00026370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026390: 202c 7374 7275 6374 7572 655f 3920 203d   ,structure_9  =
+000263a0: 2073 7472 7563 7475 7265 735b 395d 0d0a   structures[9]..
+000263b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000263c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000263d0: 2020 2020 2020 2020 202c 7374 7275 6374           ,struct
+000263e0: 7572 655f 3130 203d 2073 7472 7563 7475  ure_10 = structu
+000263f0: 7265 735b 3130 5d0d 0a20 2020 2020 2020  res[10]..       
+00026400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026420: 2020 2c73 7472 7563 7475 7265 5f31 3120    ,structure_11 
+00026430: 3d20 7374 7275 6374 7572 6573 5b31 315d  = structures[11]
+00026440: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00026450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026460: 2020 2020 2020 2020 2020 202c 7374 7275             ,stru
+00026470: 6374 7572 655f 3132 203d 2073 7472 7563  cture_12 = struc
+00026480: 7475 7265 735b 3132 5d0d 0a20 2020 2020  tures[12]..     
+00026490: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000264a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000264b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000264c0: 2020 2020 2020 2020 2029 0d0a 0d0a 2020           )....  
+000264b0: 2020 2020 2c70 6879 7369 6420 2020 2020      ,physid     
+000264c0: 2020 3d20 7068 7973 6964 0d0a 2020 2020    = physid..    
 000264d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000264e0: 2020 7669 6577 706f 696e 745f 6c69 7374    viewpoint_list
-000264f0: 2e61 7070 656e 6428 7669 6577 706f 696e  .append(viewpoin
-00026500: 7429 0d0a 0d0a 0d0a 2020 2020 2020 2020  t)......        
-00026510: 2020 2020 2020 2020 666f 7220 7669 6577          for view
-00026520: 706f 696e 7420 696e 2076 6965 7770 6f69  point in viewpoi
-00026530: 6e74 5f6c 6973 743a 0d0a 2020 2020 2020  nt_list:..      
-00026540: 2020 2020 2020 2020 2020 2020 2020 2341                #A
-00026550: 7474 656d 7074 2074 6f20 6b65 6570 2074  ttempt to keep t
-00026560: 6865 2073 616d 6520 6f62 6a65 6374 2072  he same object r
-00026570: 6566 6572 656e 6365 7320 666f 7220 7072  eferences for pr
-00026580: 6576 696f 7573 6c79 2075 7365 6420 656c  eviously used el
-00026590: 656d 656e 7473 0d0a 2020 2020 2020 2020  ements..        
-000265a0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-000265b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000265c0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
-000265d0: 745f 7669 6577 706f 696e 7420 3d20 7365  t_viewpoint = se
-000265e0: 6c66 2e5f 7669 6577 706f 696e 7473 5b76  lf._viewpoints[v
-000265f0: 6965 7770 6f69 6e74 2e73 686f 7274 6e61  iewpoint.shortna
-00026600: 6d65 5d0d 0a0d 0a20 2020 2020 2020 2020  me]....         
-00026610: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00026620: 4966 2074 6865 2076 6965 7770 6f69 6e74  If the viewpoint
-00026630: 2061 6c72 6561 6479 2065 7869 7374 732c   already exists,
-00026640: 2073 6574 2074 6865 2076 6965 7770 6f69   set the viewpoi
-00026650: 6e74 2773 2069 6e74 6572 6e61 6c73 2074  nt's internals t
-00026660: 6f20 6265 2074 6865 2073 616d 6520 6173  o be the same as
-00026670: 2074 6865 206e 6577 2076 6965 7770 6f69   the new viewpoi
-00026680: 6e74 2c20 6275 7420 6d61 6b65 2073 7572  nt, but make sur
-00026690: 6520 7765 206b 6565 7020 7468 6520 7361  e we keep the sa
-000266a0: 6d65 206f 626a 6563 7420 7265 6665 7265  me object refere
-000266b0: 6e63 6573 0d0a 2020 2020 2020 2020 2020  nces..          
-000266c0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-000266d0: 7272 656e 745f 7669 6577 706f 696e 742e  rrent_viewpoint.
-000266e0: 6c6f 6e67 6e61 6d65 2020 2020 2020 203d  longname       =
-000266f0: 2076 6965 7770 6f69 6e74 2e6c 6f6e 676e   viewpoint.longn
-00026700: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
-00026710: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00026720: 7265 6e74 5f76 6965 7770 6f69 6e74 2e64  rent_viewpoint.d
-00026730: 6573 6372 6970 7469 6f6e 2020 2020 3d20  escription    = 
-00026740: 7669 6577 706f 696e 742e 6465 7363 7269  viewpoint.descri
-00026750: 7074 696f 6e0d 0a20 2020 2020 2020 2020  ption..         
-00026760: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00026770: 7572 7265 6e74 5f76 6965 7770 6f69 6e74  urrent_viewpoint
-00026780: 2e73 7472 7563 7475 7265 735b 305d 2020  .structures[0]  
-00026790: 3d20 7669 6577 706f 696e 742e 7374 7275  = viewpoint.stru
-000267a0: 6374 7572 6573 5b30 5d0d 0a20 2020 2020  ctures[0]..     
-000267b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000267c0: 2020 2063 7572 7265 6e74 5f76 6965 7770     current_viewp
-000267d0: 6f69 6e74 2e73 7472 7563 7475 7265 735b  oint.structures[
-000267e0: 315d 2020 3d20 7669 6577 706f 696e 742e  1]  = viewpoint.
-000267f0: 7374 7275 6374 7572 6573 5b31 5d0d 0a20  structures[1].. 
-00026800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026810: 2020 2020 2020 2063 7572 7265 6e74 5f76         current_v
-00026820: 6965 7770 6f69 6e74 2e73 7472 7563 7475  iewpoint.structu
-00026830: 7265 735b 325d 2020 3d20 7669 6577 706f  res[2]  = viewpo
-00026840: 696e 742e 7374 7275 6374 7572 6573 5b32  int.structures[2
-00026850: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00026860: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-00026870: 6e74 5f76 6965 7770 6f69 6e74 2e73 7472  nt_viewpoint.str
-00026880: 7563 7475 7265 735b 335d 2020 3d20 7669  uctures[3]  = vi
-00026890: 6577 706f 696e 742e 7374 7275 6374 7572  ewpoint.structur
-000268a0: 6573 5b33 5d0d 0a20 2020 2020 2020 2020  es[3]..         
-000268b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000268c0: 7572 7265 6e74 5f76 6965 7770 6f69 6e74  urrent_viewpoint
-000268d0: 2e73 7472 7563 7475 7265 735b 345d 2020  .structures[4]  
-000268e0: 3d20 7669 6577 706f 696e 742e 7374 7275  = viewpoint.stru
-000268f0: 6374 7572 6573 5b34 5d0d 0a20 2020 2020  ctures[4]..     
-00026900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026910: 2020 2063 7572 7265 6e74 5f76 6965 7770     current_viewp
-00026920: 6f69 6e74 2e73 7472 7563 7475 7265 735b  oint.structures[
-00026930: 355d 2020 3d20 7669 6577 706f 696e 742e  5]  = viewpoint.
-00026940: 7374 7275 6374 7572 6573 5b35 5d0d 0a20  structures[5].. 
-00026950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026960: 2020 2020 2020 2063 7572 7265 6e74 5f76         current_v
-00026970: 6965 7770 6f69 6e74 2e73 7472 7563 7475  iewpoint.structu
-00026980: 7265 735b 365d 2020 3d20 7669 6577 706f  res[6]  = viewpo
-00026990: 696e 742e 7374 7275 6374 7572 6573 5b36  int.structures[6
-000269a0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-000269b0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-000269c0: 6e74 5f76 6965 7770 6f69 6e74 2e73 7472  nt_viewpoint.str
-000269d0: 7563 7475 7265 735b 375d 2020 3d20 7669  uctures[7]  = vi
-000269e0: 6577 706f 696e 742e 7374 7275 6374 7572  ewpoint.structur
-000269f0: 6573 5b37 5d0d 0a20 2020 2020 2020 2020  es[7]..         
-00026a00: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00026a10: 7572 7265 6e74 5f76 6965 7770 6f69 6e74  urrent_viewpoint
-00026a20: 2e73 7472 7563 7475 7265 735b 385d 2020  .structures[8]  
-00026a30: 3d20 7669 6577 706f 696e 742e 7374 7275  = viewpoint.stru
-00026a40: 6374 7572 6573 5b38 5d0d 0a20 2020 2020  ctures[8]..     
-00026a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026a60: 2020 2063 7572 7265 6e74 5f76 6965 7770     current_viewp
-00026a70: 6f69 6e74 2e73 7472 7563 7475 7265 735b  oint.structures[
-00026a80: 395d 2020 3d20 7669 6577 706f 696e 742e  9]  = viewpoint.
-00026a90: 7374 7275 6374 7572 6573 5b39 5d0d 0a20  structures[9].. 
-00026aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026ab0: 2020 2020 2020 2063 7572 7265 6e74 5f76         current_v
-00026ac0: 6965 7770 6f69 6e74 2e73 7472 7563 7475  iewpoint.structu
-00026ad0: 7265 735b 3130 5d20 3d20 7669 6577 706f  res[10] = viewpo
-00026ae0: 696e 742e 7374 7275 6374 7572 6573 5b31  int.structures[1
-00026af0: 305d 0d0a 2020 2020 2020 2020 2020 2020  0]..            
-00026b00: 2020 2020 2020 2020 2020 2020 6375 7272              curr
-00026b10: 656e 745f 7669 6577 706f 696e 742e 7374  ent_viewpoint.st
-00026b20: 7275 6374 7572 6573 5b31 315d 203d 2076  ructures[11] = v
-00026b30: 6965 7770 6f69 6e74 2e73 7472 7563 7475  iewpoint.structu
-00026b40: 7265 735b 3131 5d0d 0a20 2020 2020 2020  res[11]..       
-00026b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026b60: 2063 7572 7265 6e74 5f76 6965 7770 6f69   current_viewpoi
-00026b70: 6e74 2e73 7472 7563 7475 7265 735b 3132  nt.structures[12
-00026b80: 5d20 3d20 7669 6577 706f 696e 742e 7374  ] = viewpoint.st
-00026b90: 7275 6374 7572 6573 5b31 325d 0d0a 0d0a  ructures[12]....
-00026ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026bb0: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-00026bc0: 726f 723a 0d0a 0d0a 2020 2020 2020 2020  ror:....        
+000264e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000264f0: 2020 2020 2029 0d0a 0d0a 2020 2020 2020       )....      
+00026500: 2020 2020 2020 2020 2020 2020 2020 7669                vi
+00026510: 6577 706f 696e 745f 6c69 7374 2e61 7070  ewpoint_list.app
+00026520: 656e 6428 7669 6577 706f 696e 7429 0d0a  end(viewpoint)..
+00026530: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00026540: 2020 2020 666f 7220 7669 6577 706f 696e      for viewpoin
+00026550: 7420 696e 2076 6965 7770 6f69 6e74 5f6c  t in viewpoint_l
+00026560: 6973 743a 0d0a 2020 2020 2020 2020 2020  ist:..          
+00026570: 2020 2020 2020 2020 2020 2341 7474 656d            #Attem
+00026580: 7074 2074 6f20 6b65 6570 2074 6865 2073  pt to keep the s
+00026590: 616d 6520 6f62 6a65 6374 2072 6566 6572  ame object refer
+000265a0: 656e 6365 7320 666f 7220 7072 6576 696f  ences for previo
+000265b0: 7573 6c79 2075 7365 6420 656c 656d 656e  usly used elemen
+000265c0: 7473 0d0a 2020 2020 2020 2020 2020 2020  ts..            
+000265d0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+000265e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000265f0: 2020 2020 2020 6375 7272 656e 745f 7669        current_vi
+00026600: 6577 706f 696e 7420 3d20 7365 6c66 2e5f  ewpoint = self._
+00026610: 7669 6577 706f 696e 7473 5b76 6965 7770  viewpoints[viewp
+00026620: 6f69 6e74 2e73 686f 7274 6e61 6d65 5d0d  oint.shortname].
+00026630: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00026640: 2020 2020 2020 2020 2020 2023 4966 2074             #If t
+00026650: 6865 2076 6965 7770 6f69 6e74 2061 6c72  he viewpoint alr
+00026660: 6561 6479 2065 7869 7374 732c 2073 6574  eady exists, set
+00026670: 2074 6865 2076 6965 7770 6f69 6e74 2773   the viewpoint's
+00026680: 2069 6e74 6572 6e61 6c73 2074 6f20 6265   internals to be
+00026690: 2074 6865 2073 616d 6520 6173 2074 6865   the same as the
+000266a0: 206e 6577 2076 6965 7770 6f69 6e74 2c20   new viewpoint, 
+000266b0: 6275 7420 6d61 6b65 2073 7572 6520 7765  but make sure we
+000266c0: 206b 6565 7020 7468 6520 7361 6d65 206f   keep the same o
+000266d0: 626a 6563 7420 7265 6665 7265 6e63 6573  bject references
+000266e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000266f0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+00026700: 745f 7669 6577 706f 696e 742e 6c6f 6e67  t_viewpoint.long
+00026710: 6e61 6d65 2020 2020 2020 203d 2076 6965  name       = vie
+00026720: 7770 6f69 6e74 2e6c 6f6e 676e 616d 650d  wpoint.longname.
+00026730: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00026740: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00026750: 5f76 6965 7770 6f69 6e74 2e64 6573 6372  _viewpoint.descr
+00026760: 6970 7469 6f6e 2020 2020 3d20 7669 6577  iption    = view
+00026770: 706f 696e 742e 6465 7363 7269 7074 696f  point.descriptio
+00026780: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
+00026790: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+000267a0: 6e74 5f76 6965 7770 6f69 6e74 2e73 7472  nt_viewpoint.str
+000267b0: 7563 7475 7265 735b 305d 2020 3d20 7669  uctures[0]  = vi
+000267c0: 6577 706f 696e 742e 7374 7275 6374 7572  ewpoint.structur
+000267d0: 6573 5b30 5d0d 0a20 2020 2020 2020 2020  es[0]..         
+000267e0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000267f0: 7572 7265 6e74 5f76 6965 7770 6f69 6e74  urrent_viewpoint
+00026800: 2e73 7472 7563 7475 7265 735b 315d 2020  .structures[1]  
+00026810: 3d20 7669 6577 706f 696e 742e 7374 7275  = viewpoint.stru
+00026820: 6374 7572 6573 5b31 5d0d 0a20 2020 2020  ctures[1]..     
+00026830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026840: 2020 2063 7572 7265 6e74 5f76 6965 7770     current_viewp
+00026850: 6f69 6e74 2e73 7472 7563 7475 7265 735b  oint.structures[
+00026860: 325d 2020 3d20 7669 6577 706f 696e 742e  2]  = viewpoint.
+00026870: 7374 7275 6374 7572 6573 5b32 5d0d 0a20  structures[2].. 
+00026880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026890: 2020 2020 2020 2063 7572 7265 6e74 5f76         current_v
+000268a0: 6965 7770 6f69 6e74 2e73 7472 7563 7475  iewpoint.structu
+000268b0: 7265 735b 335d 2020 3d20 7669 6577 706f  res[3]  = viewpo
+000268c0: 696e 742e 7374 7275 6374 7572 6573 5b33  int.structures[3
+000268d0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+000268e0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+000268f0: 6e74 5f76 6965 7770 6f69 6e74 2e73 7472  nt_viewpoint.str
+00026900: 7563 7475 7265 735b 345d 2020 3d20 7669  uctures[4]  = vi
+00026910: 6577 706f 696e 742e 7374 7275 6374 7572  ewpoint.structur
+00026920: 6573 5b34 5d0d 0a20 2020 2020 2020 2020  es[4]..         
+00026930: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00026940: 7572 7265 6e74 5f76 6965 7770 6f69 6e74  urrent_viewpoint
+00026950: 2e73 7472 7563 7475 7265 735b 355d 2020  .structures[5]  
+00026960: 3d20 7669 6577 706f 696e 742e 7374 7275  = viewpoint.stru
+00026970: 6374 7572 6573 5b35 5d0d 0a20 2020 2020  ctures[5]..     
+00026980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026990: 2020 2063 7572 7265 6e74 5f76 6965 7770     current_viewp
+000269a0: 6f69 6e74 2e73 7472 7563 7475 7265 735b  oint.structures[
+000269b0: 365d 2020 3d20 7669 6577 706f 696e 742e  6]  = viewpoint.
+000269c0: 7374 7275 6374 7572 6573 5b36 5d0d 0a20  structures[6].. 
+000269d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000269e0: 2020 2020 2020 2063 7572 7265 6e74 5f76         current_v
+000269f0: 6965 7770 6f69 6e74 2e73 7472 7563 7475  iewpoint.structu
+00026a00: 7265 735b 375d 2020 3d20 7669 6577 706f  res[7]  = viewpo
+00026a10: 696e 742e 7374 7275 6374 7572 6573 5b37  int.structures[7
+00026a20: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00026a30: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+00026a40: 6e74 5f76 6965 7770 6f69 6e74 2e73 7472  nt_viewpoint.str
+00026a50: 7563 7475 7265 735b 385d 2020 3d20 7669  uctures[8]  = vi
+00026a60: 6577 706f 696e 742e 7374 7275 6374 7572  ewpoint.structur
+00026a70: 6573 5b38 5d0d 0a20 2020 2020 2020 2020  es[8]..         
+00026a80: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00026a90: 7572 7265 6e74 5f76 6965 7770 6f69 6e74  urrent_viewpoint
+00026aa0: 2e73 7472 7563 7475 7265 735b 395d 2020  .structures[9]  
+00026ab0: 3d20 7669 6577 706f 696e 742e 7374 7275  = viewpoint.stru
+00026ac0: 6374 7572 6573 5b39 5d0d 0a20 2020 2020  ctures[9]..     
+00026ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026ae0: 2020 2063 7572 7265 6e74 5f76 6965 7770     current_viewp
+00026af0: 6f69 6e74 2e73 7472 7563 7475 7265 735b  oint.structures[
+00026b00: 3130 5d20 3d20 7669 6577 706f 696e 742e  10] = viewpoint.
+00026b10: 7374 7275 6374 7572 6573 5b31 305d 0d0a  structures[10]..
+00026b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00026b30: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+00026b40: 7669 6577 706f 696e 742e 7374 7275 6374  viewpoint.struct
+00026b50: 7572 6573 5b31 315d 203d 2076 6965 7770  ures[11] = viewp
+00026b60: 6f69 6e74 2e73 7472 7563 7475 7265 735b  oint.structures[
+00026b70: 3131 5d0d 0a20 2020 2020 2020 2020 2020  11]..           
+00026b80: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+00026b90: 7265 6e74 5f76 6965 7770 6f69 6e74 2e73  rent_viewpoint.s
+00026ba0: 7472 7563 7475 7265 735b 3132 5d20 3d20  tructures[12] = 
+00026bb0: 7669 6577 706f 696e 742e 7374 7275 6374  viewpoint.struct
+00026bc0: 7572 6573 5b31 325d 0d0a 0d0a 2020 2020  ures[12]....    
 00026bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00026be0: 7365 6c66 2e5f 7669 6577 706f 696e 7473  self._viewpoints
-00026bf0: 5b76 6965 7770 6f69 6e74 2e73 686f 7274  [viewpoint.short
-00026c00: 6e61 6d65 5d20 3d20 7669 6577 706f 696e  name] = viewpoin
-00026c10: 740d 0a0d 0a20 2020 2020 2020 2020 2020  t....           
-00026c20: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00026c30: 2020 2020 2020 2020 7261 6973 6520 6d70          raise mp
-00026c40: 6578 2e45 6d70 6f77 6572 496d 706f 7274  ex.EmpowerImport
-00026c50: 6572 5665 7273 696f 6e45 7272 6f72 2827  erVersionError('
-00026c60: 4675 6e63 7469 6f6e 616c 6974 7920 6e6f  Functionality no
-00026c70: 7420 6176 6169 6c61 626c 6520 696e 2074  t available in t
-00026c80: 6869 7320 456d 706f 7765 7220 496d 706f  his Empower Impo
-00026c90: 7274 6572 2076 6572 7369 6f6e 207b 7d20  rter version {} 
-00026ca0: 6e65 6564 2061 7420 6c65 6173 7420 7b7d  need at least {}
-00026cb0: 272e 666f 726d 6174 2827 2e27 2e6a 6f69  '.format('.'.joi
-00026cc0: 6e28 5b73 7472 2876 2920 666f 7220 7620  n([str(v) for v 
-00026cd0: 696e 2073 656c 662e 6469 6d65 6e73 696f  in self.dimensio
-00026ce0: 6e2e 7369 7465 2e69 6d70 6f72 7465 725f  n.site.importer_
-00026cf0: 7665 7273 696f 6e5d 292c 2027 392e 352e  version]), '9.5.
-00026d00: 3138 2e31 3934 3327 2929 0d0a 0d0a 2020  18.1943'))....  
-00026d10: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00026d20: 6570 7469 6f6e 3a0d 0a20 2020 2020 2020  eption:..       
-00026d30: 2020 2020 2073 656c 662e 5f76 6965 7770       self._viewp
-00026d40: 6f69 6e74 735f 7265 6164 203d 2046 616c  oints_read = Fal
-00026d50: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-00026d60: 7261 6973 650d 0a0d 0a20 2020 2064 6566  raise....    def
-00026d70: 2076 616c 7565 7328 7365 6c66 293a 0d0a   values(self):..
-00026d80: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00026d90: 656c 662e 5f76 6965 7770 6f69 6e74 735f  elf._viewpoints_
-00026da0: 7265 6164 3a0d 0a20 2020 2020 2020 2020  read:..         
-00026db0: 2020 2073 656c 662e 5f6c 6f61 645f 7669     self._load_vi
-00026dc0: 6577 706f 696e 7473 2829 0d0a 0d0a 2020  ewpoints()....  
-00026dd0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00026de0: 662e 5f76 6965 7770 6f69 6e74 732e 7661  f._viewpoints.va
-00026df0: 6c75 6573 2829 0d0a 0d0a 2020 2020 6465  lues()....    de
-00026e00: 6620 6974 656d 7328 7365 6c66 293a 0d0a  f items(self):..
-00026e10: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00026e20: 656c 662e 5f76 6965 7770 6f69 6e74 735f  elf._viewpoints_
-00026e30: 7265 6164 3a0d 0a20 2020 2020 2020 2020  read:..         
-00026e40: 2020 2073 656c 662e 5f6c 6f61 645f 7669     self._load_vi
-00026e50: 6577 706f 696e 7473 2829 0d0a 0d0a 2020  ewpoints()....  
-00026e60: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00026e70: 662e 5f76 6965 7770 6f69 6e74 732e 6974  f._viewpoints.it
-00026e80: 656d 7328 290d 0a0d 0a20 2020 2064 6566  ems()....    def
-00026e90: 206b 6579 7328 7365 6c66 293a 0d0a 2020   keys(self):..  
-00026ea0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00026eb0: 662e 5f76 6965 7770 6f69 6e74 735f 7265  f._viewpoints_re
-00026ec0: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
-00026ed0: 2073 656c 662e 5f6c 6f61 645f 7669 6577   self._load_view
-00026ee0: 706f 696e 7473 2829 0d0a 0d0a 2020 2020  points()....    
-00026ef0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00026f00: 5f76 6965 7770 6f69 6e74 732e 6b65 7973  _viewpoints.keys
-00026f10: 2829 0d0a 0d0a 2020 2020 6465 6620 5f5f  ()....    def __
-00026f20: 6c65 6e5f 5f28 7365 6c66 293a 0d0a 2020  len__(self):..  
-00026f30: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00026f40: 662e 5f76 6965 7770 6f69 6e74 735f 7265  f._viewpoints_re
-00026f50: 6164 3a0d 0a20 2020 2020 2020 2020 2020  ad:..           
-00026f60: 2073 656c 662e 5f6c 6f61 645f 7669 6577   self._load_view
-00026f70: 706f 696e 7473 2829 0d0a 0d0a 2020 2020  points()....    
-00026f80: 2020 2020 7265 7475 726e 206c 656e 2873      return len(s
-00026f90: 656c 662e 5f76 6965 7770 6f69 6e74 7329  elf._viewpoints)
-00026fa0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 7265  ....    def __re
-00026fb0: 7072 5f5f 2873 656c 6629 3a0d 0a20 2020  pr__(self):..   
-00026fc0: 2020 2020 2072 6574 7572 6e20 277b 7d20       return '{} 
-00026fd0: 6672 6f6d 203c 7b7d 206f 626a 6563 7420  from <{} object 
-00026fe0: 6174 207b 7d3e 272e 666f 726d 6174 2827  at {}>'.format('
-00026ff0: 7b27 202b 2027 5c6e 272e 6a6f 696e 285b  {' + '\n'.join([
-00027000: 2022 277b 7d27 3a7b 7d22 2e66 6f72 6d61   "'{}':{}".forma
-00027010: 7428 6b2c 7265 7072 2876 2929 2066 6f72  t(k,repr(v)) for
-00027020: 206b 2c76 2069 6e20 7365 6c66 2e69 7465   k,v in self.ite
-00027030: 6d73 2829 5d29 202b 2027 7d27 2c73 656c  ms()]) + '}',sel
-00027040: 662e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  f.__class__.__na
-00027050: 6d65 5f5f 2c68 6578 2869 6428 7365 6c66  me__,hex(id(self
-00027060: 2929 2029 0d0a 0d0a 636c 6173 7320 4469  )) )....class Di
-00027070: 6d65 6e73 696f 6e28 6f62 6a65 6374 293a  mension(object):
-00027080: 0d0a 2020 2020 2727 270d 0a20 2020 2041  ..    '''..    A
-00027090: 6e20 456d 706f 7765 7220 4469 6d65 6e73  n Empower Dimens
-000270a0: 696f 6e0d 0a0d 0a20 2020 204d 616e 6970  ion....    Manip
-000270b0: 756c 6174 6520 6120 6469 6d65 6e73 696f  ulate a dimensio
-000270c0: 6e27 7320 656c 656d 656e 7473 2c20 7374  n's elements, st
-000270d0: 7275 6374 7572 6573 2061 6e64 2073 6563  ructures and sec
-000270e0: 7572 6974 7920 7573 696e 6720 7468 6973  urity using this
-000270f0: 2063 6c61 7373 2e0d 0a20 2020 2027 2727   class...    '''
-00027100: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
-00027110: 5f5f 2873 656c 660d 0a20 2020 2020 2020  __(self..       
-00027120: 2020 2020 2020 2020 202c 7369 7465 0d0a           ,site..
-00027130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027140: 2c69 6e64 6578 0d0a 2020 2020 2020 2020  ,index..        
-00027150: 2020 2020 2020 2020 293a 0d0a 0d0a 2020          ):....  
-00027160: 2020 2020 2020 7365 6c66 2e73 6974 6520        self.site 
-00027170: 2020 2020 2020 2020 2020 2020 3d20 7369              = si
-00027180: 7465 0d0a 2020 2020 2020 2020 7365 6c66  te..        self
-00027190: 2e69 6e64 6578 2020 2020 2020 2020 2020  .index          
-000271a0: 2020 3d20 696e 6465 780d 0a0d 0a0d 0a20    = index...... 
-000271b0: 2020 2020 2020 2023 2357 6520 7769 6c6c         ##We will
-000271c0: 2067 6574 2074 6865 2066 6965 6c64 206e   get the field n
-000271d0: 616d 6573 2062 7920 6578 706f 7274 696e  ames by exportin
-000271e0: 6720 7468 6520 6469 6d65 6e73 696f 6e20  g the dimension 
-000271f0: 6672 6f6d 2074 6865 2073 6974 650d 0a20  from the site.. 
-00027200: 2020 2020 2020 2023 7365 6c66 2e5f 6669         #self._fi
-00027210: 656c 645f 6e61 6d65 733d 5b5d 0d0a 0d0a  eld_names=[]....
-00027220: 2020 2020 2020 2020 7365 6c66 2e5f 7374          self._st
-00027230: 7275 6374 7572 655f 6765 7474 6572 203d  ructure_getter =
-00027240: 205f 5374 7275 6374 7572 6547 6574 7465   _StructureGette
-00027250: 7228 6469 6d65 6e73 696f 6e20 3d20 7365  r(dimension = se
-00027260: 6c66 290d 0a20 2020 2020 2020 2073 656c  lf)..        sel
-00027270: 662e 5f65 6c65 6d65 6e74 735f 6765 7474  f._elements_gett
-00027280: 6572 2020 3d20 5f45 6c65 6d65 6e74 7347  er  = _ElementsG
-00027290: 6574 7465 7228 2064 696d 656e 7369 6f6e  etter( dimension
-000272a0: 203d 2073 656c 6629 0d0a 0d0a 2020 2020   = self)....    
-000272b0: 2020 2020 2357 6865 6e20 6372 6561 7469      #When creati
-000272c0: 6e67 2065 6c65 6d65 6e74 7320 666f 7220  ng elements for 
-000272d0: 7468 6520 6669 7273 7420 7469 6d65 2077  the first time w
-000272e0: 6520 6d61 7920 7265 6c79 206f 6e0d 0a20  e may rely on.. 
-000272f0: 2020 2020 2020 2073 656c 662e 5f65 6c65         self._ele
-00027300: 6d65 6e74 735f 7769 7468 6f75 745f 7368  ments_without_sh
-00027310: 6f72 746e 616d 6573 203d 205b 5d0d 0a0d  ortnames = []...
-00027320: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
-00027330: 6965 6c64 7320 3d20 5f44 696d 656e 7369  ields = _Dimensi
-00027340: 6f6e 4669 656c 6473 4765 7474 6572 2864  onFieldsGetter(d
-00027350: 696d 656e 7369 6f6e 3d73 656c 6629 0d0a  imension=self)..
-00027360: 0d0a 2020 2020 2020 2020 2344 696d 656e  ..        #Dimen
-00027370: 7369 6f6e 7320 6861 7665 2061 206e 616d  sions have a nam
-00027380: 6520 2d20 6174 2074 6865 2074 696d 6520  e - at the time 
-00027390: 6f66 2077 7269 7469 6e67 2028 3230 3138  of writing (2018
-000273a0: 2d30 382d 3231 2920 7468 6573 6520 6361  -08-21) these ca
-000273b0: 6e27 7420 6265 2072 6561 6420 6672 6f6d  n't be read from
-000273c0: 2045 6d70 6f77 6572 2061 6e64 206d 7573   Empower and mus
-000273d0: 7420 6265 2073 6574 2062 7920 7468 6520  t be set by the 
-000273e0: 7573 6572 0d0a 2020 2020 2020 2020 7365  user..        se
-000273f0: 6c66 2e5f 6c6f 6e67 6e61 6d65 203d 204e  lf._longname = N
-00027400: 6f6e 650d 0a0d 0a20 2020 2040 7072 6f70  one....    @prop
-00027410: 6572 7479 0d0a 2020 2020 6465 6620 6c6f  erty..    def lo
-00027420: 6e67 6e61 6d65 2873 656c 6629 3a0d 0a20  ngname(self):.. 
-00027430: 2020 2020 2020 2027 2727 5468 6520 4469         '''The Di
-00027440: 6d65 6e73 696f 6e27 7320 456d 706f 7765  mension's Empowe
-00027450: 7220 6c6f 6e67 6e61 6d65 2727 270d 0a20  r longname'''.. 
-00027460: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00027470: 6c6f 6e67 6e61 6d65 2069 7320 4e6f 6e65  longname is None
-00027480: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
-00027490: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-000274a0: 2020 2020 2023 7072 6f76 6f6b 6520 6120       #provoke a 
-000274b0: 7374 7275 6374 7572 6573 206c 617a 7920  structures lazy 
-000274c0: 6c6f 6164 2077 6869 6368 2069 7320 7468  load which is th
-000274d0: 6520 6265 7374 2077 6179 206f 6620 6765  e best way of ge
-000274e0: 7474 696e 6720 6469 6d65 6e73 696f 6e20  tting dimension 
-000274f0: 6e61 6d65 7320 6174 2074 6865 206d 6f6d  names at the mom
-00027500: 656e 740d 0a20 2020 2020 2020 2020 2020  ent..           
-00027510: 2020 2020 2073 656c 662e 7374 7275 6374       self.struct
-00027520: 7572 6573 2e76 616c 7565 7328 290d 0a20  ures.values().. 
-00027530: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00027540: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
-00027550: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00027560: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
-00027570: 2072 6574 7572 6e20 7365 6c66 2e5f 6c6f   return self._lo
-00027580: 6e67 6e61 6d65 0d0a 0d0a 2020 2020 406c  ngname....    @l
-00027590: 6f6e 676e 616d 652e 7365 7474 6572 0d0a  ongname.setter..
-000275a0: 2020 2020 6465 6620 6c6f 6e67 6e61 6d65      def longname
-000275b0: 2873 656c 662c 7661 6c29 3a0d 0a20 2020  (self,val):..   
-000275c0: 2020 2020 2073 656c 662e 5f6c 6f6e 676e       self._longn
-000275d0: 616d 653d 7661 6c0d 0a0d 0a20 2020 2040  ame=val....    @
-000275e0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-000275f0: 6620 7374 7275 6374 7572 6573 2873 656c  f structures(sel
-00027600: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
-00027610: 5374 7275 6374 7572 6573 2066 6f72 2074  Structures for t
-00027620: 6865 2064 696d 656e 7369 6f6e 202d 2062  he dimension - b
-00027630: 7920 7368 6f72 746e 616d 650d 0a0d 0a20  y shortname.... 
-00027640: 2020 2020 2020 202e 7374 7275 6374 7572         .structur
-00027650: 6573 2062 6568 6176 6573 206c 696b 6520  es behaves like 
-00027660: 6120 6469 6374 696f 6e61 7279 2028 796f  a dictionary (yo
-00027670: 7520 6361 6e20 6361 6c6c 202e 7661 6c75  u can call .valu
-00027680: 6573 2829 2c20 2e69 7465 6d73 2829 2061  es(), .items() a
-00027690: 6e64 202e 6b65 7973 2829 206f 6e20 6974  nd .keys() on it
-000276a0: 292c 2062 7574 2077 6865 6e20 6974 6572  ), but when iter
-000276b0: 6174 6564 206f 7665 7220 6974 2079 6965  ated over it yie
-000276c0: 6c64 7320 5374 7275 6374 7572 6573 206f  lds Structures o
-000276d0: 6e65 2061 6674 6572 2074 6865 206f 7468  ne after the oth
-000276e0: 6572 2e0d 0a0d 0a20 2020 2020 2020 2041  er.....        A
-000276f0: 2073 696e 676c 6520 5374 7275 6374 7572   single Structur
-00027700: 6520 6361 6e20 6265 2072 6574 7269 6576  e can be retriev
-00027710: 6564 2066 726f 6d20 2e73 7472 7563 7475  ed from .structu
-00027720: 7265 7320 6279 2069 6e64 6578 696e 6720  res by indexing 
-00027730: 6974 206f 6e20 6974 7320 7368 6f72 746e  it on its shortn
-00027740: 616d 652c 2065 2e67 2e3a 0d0a 2020 2020  ame, e.g.:..    
-00027750: 2020 2020 3e3e 3e20 7369 7465 2e64 696d      >>> site.dim
-00027760: 656e 7369 6f6e 5b30 5d2e 7374 7275 6374  ension[0].struct
-00027770: 7572 6573 5b27 5350 414d 275d 0d0a 2020  ures['SPAM']..  
-00027780: 2020 2020 2020 2727 270d 0a20 2020 2020        '''..     
-00027790: 2020 2023 5468 6520 5f73 7472 7563 7475     #The _structu
-000277a0: 7265 5f67 6574 7465 7220 696d 706c 656d  re_getter implem
-000277b0: 656e 7473 205f 5f67 6574 5f69 7465 6d5f  ents __get_item_
-000277c0: 5f28 2920 746f 2070 726f 7669 6465 2074  _() to provide t
-000277d0: 6865 2073 7562 7363 7269 7074 6162 6c65  he subscriptable
-000277e0: 2069 6e74 6572 6661 6365 202d 2061 6e64   interface - and
-000277f0: 2070 726f 7669 6465 206c 617a 7920 6c6f   provide lazy lo
-00027800: 6164 696e 670d 0a20 2020 2020 2020 2072  ading..        r
-00027810: 6574 7572 6e20 7365 6c66 2e5f 7374 7275  eturn self._stru
-00027820: 6374 7572 655f 6765 7474 6572 0d0a 0d0a  cture_getter....
-00027830: 2020 2020 4073 7472 7563 7475 7265 732e      @structures.
-00027840: 7365 7474 6572 0d0a 2020 2020 6465 6620  setter..    def 
-00027850: 7374 7275 6374 7572 6573 2873 656c 662c  structures(self,
-00027860: 7661 6c29 3a0d 0a20 2020 2020 2020 2069  val):..        i
-00027870: 6620 6973 696e 7374 616e 6365 2876 616c  f isinstance(val
-00027880: 2c5f 5374 7275 6374 7572 6547 6574 7465  ,_StructureGette
-00027890: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
-000278a0: 2073 656c 662e 5f73 7472 7563 7475 7265   self._structure
-000278b0: 5f67 6574 7465 7220 3d20 7661 6c0d 0a20  _getter = val.. 
-000278c0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000278d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000278e0: 4174 7472 6962 7574 6545 7272 6f72 2827  AttributeError('
-000278f0: 4469 6d65 6e73 696f 6e2e 7374 7275 6374  Dimension.struct
-00027900: 7572 6573 2063 616e 6e6f 7420 6265 2073  ures cannot be s
-00027910: 6574 2065 7863 6570 7420 6261 636b 2074  et except back t
-00027920: 6f20 6974 7365 6c66 2069 6e20 6120 2b3d  o itself in a +=
-00027930: 206f 7065 7261 7469 6f6e 2729 0d0a 0d0a   operation')....
-00027940: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
-00027950: 2020 2064 6566 2065 6c65 6d65 6e74 7328     def elements(
-00027960: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00027970: 2727 2753 686f 7274 6e61 6d65 2069 6e64  '''Shortname ind
-00027980: 6578 6564 2065 6c65 6d65 6e74 7320 666f  exed elements fo
-00027990: 7220 7468 6520 6469 6d65 6e73 696f 6e0d  r the dimension.
-000279a0: 0a0d 0a20 2020 2020 2020 202e 656c 656d  ...        .elem
-000279b0: 656e 7473 2062 6568 6176 6573 206c 696b  ents behaves lik
-000279c0: 6520 6120 6469 6374 696f 6e61 7279 2028  e a dictionary (
-000279d0: 796f 7520 6361 6e20 6361 6c6c 202e 7661  you can call .va
-000279e0: 6c75 6573 2829 2c20 2e69 7465 6d73 2829  lues(), .items()
-000279f0: 2061 6e64 202e 6b65 7973 2829 206f 6e20   and .keys() on 
-00027a00: 6974 292c 2062 7574 2077 6865 6e20 6974  it), but when it
-00027a10: 6572 6174 6564 206f 7665 7220 6974 2079  erated over it y
-00027a20: 6965 6c64 7320 456c 656d 656e 7473 206f  ields Elements o
-00027a30: 6e65 2061 6674 6572 2074 6865 206f 7468  ne after the oth
-00027a40: 6572 2e0d 0a0d 0a20 2020 2020 2020 2041  er.....        A
-00027a50: 2073 696e 676c 6520 656c 656d 656e 7420   single element 
-00027a60: 6361 6e20 6265 2072 6574 7269 6576 6564  can be retrieved
-00027a70: 2066 726f 6d20 2e65 6c65 6d65 6e74 7320   from .elements 
-00027a80: 6279 2069 6e64 6578 696e 6720 6974 206f  by indexing it o
-00027a90: 6e20 6974 7320 7368 6f72 746e 616d 652c  n its shortname,
-00027aa0: 2065 2e67 2e3a 0d0a 2020 2020 2020 2020   e.g.:..        
-00027ab0: 3e3e 3e20 7369 7465 2e64 696d 656e 7369  >>> site.dimensi
-00027ac0: 6f6e 5b30 5d2e 656c 656d 656e 7473 5b27  on[0].elements['
-00027ad0: 4d59 5348 4f52 5443 4f32 275d 0d0a 2020  MYSHORTCO2']..  
-00027ae0: 2020 2020 2020 2727 270d 0a20 2020 2020        '''..     
-00027af0: 2020 2023 5468 6520 5f65 6c65 6d65 6e74     #The _element
-00027b00: 735f 6765 7474 6572 2069 6d70 6c65 6d65  s_getter impleme
-00027b10: 6e74 7320 5f5f 6765 745f 6974 656d 5f5f  nts __get_item__
-00027b20: 2829 2074 6f20 7072 6f76 6964 6520 7468  () to provide th
-00027b30: 6520 7375 6273 6372 6970 7461 626c 6520  e subscriptable 
-00027b40: 696e 7465 7266 6163 6520 2d20 616e 6420  interface - and 
-00027b50: 7072 6f76 6964 6520 6c61 7a79 206c 6f61  provide lazy loa
-00027b60: 6469 6e67 0d0a 2020 2020 2020 2020 7265  ding..        re
-00027b70: 7475 726e 2073 656c 662e 5f65 6c65 6d65  turn self._eleme
-00027b80: 6e74 735f 6765 7474 6572 0d0a 0d0a 2020  nts_getter....  
-00027b90: 2020 4065 6c65 6d65 6e74 732e 7365 7474    @elements.sett
-00027ba0: 6572 0d0a 2020 2020 6465 6620 656c 656d  er..    def elem
-00027bb0: 656e 7473 2873 656c 662c 7661 6c29 3a0d  ents(self,val):.
-00027bc0: 0a20 2020 2020 2020 2069 6620 7661 6c20  .        if val 
-00027bd0: 3d3d 2073 656c 662e 5f65 6c65 6d65 6e74  == self._element
-00027be0: 735f 6765 7474 6572 3a0d 0a20 2020 2020  s_getter:..     
-00027bf0: 2020 2020 2020 2070 6173 730d 0a20 2020         pass..   
-00027c00: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00027c10: 2020 2020 2020 2020 7261 6973 6520 4174          raise At
-00027c20: 7472 6962 7574 6545 7272 6f72 2822 6361  tributeError("ca
-00027c30: 6e27 7420 7365 7420 6174 7472 6962 7574  n't set attribut
-00027c40: 6522 290d 0a0d 0a20 2020 2040 7072 6f70  e")....    @prop
-00027c50: 6572 7479 0d0a 2020 2020 6465 6620 6669  erty..    def fi
-00027c60: 656c 6473 2873 656c 6629 3a0d 0a20 2020  elds(self):..   
-00027c70: 2020 2020 2027 2727 7265 7475 726e 2061       '''return a
-00027c80: 2074 6865 2066 6965 6c64 2064 6566 696e   the field defin
-00027c90: 6974 696f 6e73 206f 6620 7468 6520 6469  itions of the di
-00027ca0: 6d65 6e73 696f 6e20 6173 2061 6e20 6f72  mension as an or
-00027cb0: 6465 7265 6420 6469 6374 696f 6e61 7279  dered dictionary
-00027cc0: 2727 270d 0a20 2020 2020 2020 2023 6c6f  '''..        #lo
-00027cd0: 6164 2065 6c65 6d65 6e74 7320 746f 2067  ad elements to g
-00027ce0: 6574 2066 6965 6c64 732c 2062 6563 6175  et fields, becau
-00027cf0: 7365 2074 6865 7265 2069 7320 6e6f 2064  se there is no d
-00027d00: 6972 6563 7420 7761 7920 6f66 2067 6574  irect way of get
-00027d10: 7469 6e67 2066 6965 6c64 730d 0a20 2020  ting fields..   
-00027d20: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00027d30: 2e5f 656c 656d 656e 7473 5f67 6574 7465  ._elements_gette
-00027d40: 722e 5f65 6c65 6d65 6e74 735f 7265 6164  r._elements_read
-00027d50: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00027d60: 656c 662e 5f65 6c65 6d65 6e74 735f 6765  elf._elements_ge
-00027d70: 7474 6572 2e5f 6c6f 6164 5f65 6c65 6d65  tter._load_eleme
-00027d80: 6e74 7328 6465 6275 673d 7365 6c66 2e73  nts(debug=self.s
-00027d90: 6974 652e 5f64 6562 7567 290d 0a0d 0a20  ite._debug).... 
-00027da0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00027db0: 6c66 2e5f 6669 656c 6473 0d0a 0d0a 2020  lf._fields....  
-00027dc0: 2020 4066 6965 6c64 732e 7365 7474 6572    @fields.setter
-00027dd0: 0d0a 2020 2020 6465 6620 6669 656c 6473  ..    def fields
-00027de0: 2873 656c 662c 7661 6c29 3a0d 0a20 2020  (self,val):..   
-00027df0: 2020 2020 2070 6173 730d 0a0d 0a20 2020       pass....   
-00027e00: 2023 6465 6620 5f73 796e 6368 726f 6e69   #def _synchroni
-00027e10: 7365 5f65 6c65 6d65 6e74 735f 616e 645f  se_elements_and_
-00027e20: 7374 7275 6374 7572 6573 2873 656c 6629  structures(self)
-00027e30: 3a0d 0a20 2020 2023 2020 2020 7061 7373  :..    #    pass
-00027e40: 0d0a 2020 2020 230d 0a0d 0a20 2020 2064  ..    #....    d
-00027e50: 6566 2067 6574 2873 656c 662c 2070 6174  ef get(self, pat
-00027e60: 6829 3a0d 0a20 2020 2020 2020 2027 2727  h):..        '''
-00027e70: 5265 7475 726e 2061 2053 7472 7563 7475  Return a Structu
-00027e80: 7265 456c 656d 656e 7420 7769 7468 696e  reElement within
-00027e90: 2061 2044 696d 656e 7369 6f6e 2062 7920   a Dimension by 
-00027ea0: 7061 7373 696e 6720 696e 2074 6865 2070  passing in the p
-00027eb0: 6174 6820 6173 2061 2073 7472 696e 670d  ath as a string.
-00027ec0: 0a0d 0a20 2020 2020 2020 203a 7061 7468  ...        :path
-00027ed0: 3a20 4120 7374 7269 6e67 2064 6573 6372  : A string descr
-00027ee0: 6962 696e 6720 7468 6520 7061 7468 2074  ibing the path t
-00027ef0: 6f20 6120 5374 7275 6374 7572 6545 6c65  o a StructureEle
-00027f00: 6d65 6e74 2077 6974 6869 6e20 6120 4469  ment within a Di
-00027f10: 6d65 6e73 696f 6e0d 0a0d 0a20 2020 2020  mension....     
-00027f20: 2020 2065 2e67 2e0d 0a20 2020 2020 2020     e.g...       
-00027f30: 203e 3e3e 2073 6974 652e 6469 6d65 6e73   >>> site.dimens
-00027f40: 696f 6e5b 305d 2e67 6574 2827 5350 414d  ion[0].get('SPAM
-00027f50: 2e45 4747 532f 4241 434f 4e27 290d 0a0d  .EGGS/BACON')...
-00027f60: 0a20 2020 2020 2020 2057 696c 6c20 7265  .        Will re
-00027f70: 7475 726e 2074 6865 2027 4241 434f 4e27  turn the 'BACON'
-00027f80: 2053 7472 7563 7475 7265 2045 6c65 6d65   Structure Eleme
-00027f90: 6e74 2066 726f 6d20 7468 6520 2753 5041  nt from the 'SPA
-00027fa0: 4d27 2053 7472 7563 7475 7265 0d0a 2020  M' Structure..  
-00027fb0: 2020 2020 2020 2727 270d 0a20 2020 2020        '''..     
-00027fc0: 2020 2069 6620 6e6f 7420 272e 2720 696e     if not '.' in
-00027fd0: 2070 6174 683a 0d0a 2020 2020 2020 2020   path:..        
-00027fe0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-00027ff0: 7272 6f72 2827 7061 7468 2070 6172 616d  rror('path param
-00028000: 6574 6572 206d 7573 7420 6265 2061 2076  eter must be a v
-00028010: 616c 6964 2070 6174 6820 746f 2061 2053  alid path to a S
-00028020: 7472 7563 7475 7265 456c 656d 656e 742e  tructureElement.
-00028030: 2050 6174 6820 6d75 7374 2063 6f6e 7461   Path must conta
-00028040: 696e 2061 2022 2e22 2063 6861 7261 6374  in a "." charact
-00028050: 6572 2065 2e67 2e20 5350 414d 2e45 4747  er e.g. SPAM.EGG
-00028060: 532f 4241 434f 4e2d 2066 6f75 6e64 207b  S/BACON- found {
-00028070: 7d27 2e66 6f72 6d61 7428 7061 7468 2929  }'.format(path))
-00028080: 0d0a 0d0a 2020 2020 2020 2020 7061 7468  ....        path
-00028090: 5f70 6172 7473 203d 2070 6174 682e 7370  _parts = path.sp
-000280a0: 6c69 7428 272f 2729 0d0a 2020 2020 2020  lit('/')..      
-000280b0: 2020 7374 7275 6374 7572 655f 616e 645f    structure_and_
-000280c0: 6869 6572 6172 6368 7920 3d20 7061 7468  hierarchy = path
-000280d0: 5f70 6172 7473 5b30 5d0d 0a20 2020 2020  _parts[0]..     
-000280e0: 2020 2072 6573 745f 6f66 5f70 6174 6820     rest_of_path 
-000280f0: 3d20 2727 0d0a 2020 2020 2020 2020 6966  = ''..        if
-00028100: 206c 656e 2870 6174 685f 7061 7274 7329   len(path_parts)
-00028110: 203e 2031 3a0d 0a20 2020 2020 2020 2020   > 1:..         
-00028120: 2020 2072 6573 745f 6f66 5f70 6174 6820     rest_of_path 
-00028130: 3d20 272f 272b 2827 2f27 2e6a 6f69 6e28  = '/'+('/'.join(
-00028140: 7061 7468 5f70 6172 7473 5b31 3a5d 2929  path_parts[1:]))
-00028150: 0d0a 2020 2020 2020 2020 2020 2020 0d0a  ..            ..
-00028160: 2020 2020 2020 2020 2353 706c 6974 206f          #Split o
-00028170: 6e20 2e20 2057 6520 776f 756c 6420 6578  n .  We would ex
-00028180: 7065 6374 2032 2070 6172 7473 2062 7574  pect 2 parts but
-00028190: 206d 6967 6874 2067 6574 206d 6f72 6520   might get more 
-000281a0: 6966 2074 6865 7265 2061 7265 206d 6f72  if there are mor
-000281b0: 652e 2041 7272 616e 6765 2074 6865 7365  e. Arrange these
-000281c0: 2069 6e74 6f20 7468 6520 7661 7269 6f75   into the variou
-000281d0: 7320 636f 6d62 696e 6174 696f 6e73 2065  s combinations e
-000281e0: 2e67 2e20 5465 7374 312e 5465 7374 322e  .g. Test1.Test2.
-000281f0: 5465 7374 3320 636f 756c 6420 6265 2054  Test3 could be T
-00028200: 6573 7431 2061 6e64 2054 6573 7432 2e54  est1 and Test2.T
-00028210: 6573 7433 206f 7220 5465 7374 312e 5465  est3 or Test1.Te
-00028220: 7374 3220 616e 6420 5465 7374 330d 0a20  st2 and Test3.. 
-00028230: 2020 2020 2020 2023 2054 6865 2066 6972         # The fir
-00028240: 7374 2076 616c 6964 2063 6f6d 626f 2077  st valid combo w
-00028250: 696e 730d 0a20 2020 2020 2020 2073 7472  ins..        str
-00028260: 7563 7475 7265 5f61 6e64 5f68 6965 7261  ucture_and_hiera
-00028270: 7263 6879 5f73 706c 6974 5f6f 6e5f 646f  rchy_split_on_do
-00028280: 7473 203d 2073 7472 7563 7475 7265 5f61  ts = structure_a
-00028290: 6e64 5f68 6965 7261 7263 6879 2e73 706c  nd_hierarchy.spl
-000282a0: 6974 2827 2e27 290d 0a20 2020 2020 2020  it('.')..       
-000282b0: 200d 0a20 2020 2020 2020 2066 6f72 206e   ..        for n
-000282c0: 2069 6e20 7261 6e67 6528 6c65 6e28 7374   in range(len(st
-000282d0: 7275 6374 7572 655f 616e 645f 6869 6572  ructure_and_hier
-000282e0: 6172 6368 795f 7370 6c69 745f 6f6e 5f64  archy_split_on_d
-000282f0: 6f74 7329 293a 0d0a 2020 2020 2020 2020  ots)):..        
-00028300: 2020 2020 7374 7275 6374 7572 655f 7374      structure_st
-00028310: 7220 3d20 272e 272e 6a6f 696e 2873 7472  r = '.'.join(str
-00028320: 7563 7475 7265 5f61 6e64 5f68 6965 7261  ucture_and_hiera
-00028330: 7263 6879 5f73 706c 6974 5f6f 6e5f 646f  rchy_split_on_do
-00028340: 7473 5b30 3a6e 5d29 0d0a 2020 2020 2020  ts[0:n])..      
-00028350: 2020 2020 2020 6869 6572 6172 6368 795f        hierarchy_
-00028360: 7374 7220 3d20 272e 272e 6a6f 696e 2873  str = '.'.join(s
-00028370: 7472 7563 7475 7265 5f61 6e64 5f68 6965  tructure_and_hie
-00028380: 7261 7263 6879 5f73 706c 6974 5f6f 6e5f  rarchy_split_on_
-00028390: 646f 7473 5b6e 3a5d 290d 0a20 2020 2020  dots[n:])..     
-000283a0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-000283b0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000283c0: 7572 6e20 7365 6c66 2e73 7472 7563 7475  urn self.structu
-000283d0: 7265 735b 7374 7275 6374 7572 655f 7374  res[structure_st
-000283e0: 725d 2e64 6573 6365 6e64 616e 7473 5b68  r].descendants[h
-000283f0: 6965 7261 7263 6879 5f73 7472 2b72 6573  ierarchy_str+res
-00028400: 745f 6f66 5f70 6174 685d 2020 2020 2020  t_of_path]      
-00028410: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
-00028420: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-00028430: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00028440: 2020 2020 2020 2070 6173 730d 0a20 2020         pass..   
-00028450: 2020 2020 200d 0a0d 0a20 2020 2020 2020       ....       
-00028460: 2072 6169 7365 204b 6579 4572 726f 7228   raise KeyError(
-00028470: 2750 6174 683a 2027 2b70 6174 682b 2720  'Path: '+path+' 
-00028480: 6e6f 7420 666f 756e 6420 696e 2064 696d  not found in dim
-00028490: 656e 7369 6f6e 2027 2b73 7472 2873 656c  ension '+str(sel
-000284a0: 662e 696e 6465 7829 2920 0d0a 0d0a 0d0a  f.index)) ......
-000284b0: 0d0a 2020 2020 6465 6620 6d61 6b65 5f65  ..    def make_e
-000284c0: 6c65 6d65 6e74 735f 6672 6f6d 5f64 6174  lements_from_dat
-000284d0: 6166 7261 6d65 2873 656c 662c 6461 7461  aframe(self,data
-000284e0: 6672 616d 652c 7072 696d 6172 795f 6b65  frame,primary_ke
-000284f0: 795f 636f 6c75 6d6e 733d 5b27 5368 6f72  y_columns=['Shor
-00028500: 7420 4e61 6d65 275d 2c64 6564 7570 6c69  t Name'],dedupli
-00028510: 6361 7465 3d27 6c61 7374 272c 6c6f 6e67  cate='last',long
-00028520: 6e61 6d65 5f73 686f 7274 6e61 6d65 5f72  name_shortname_r
-00028530: 756c 653d 4e6f 6e65 2c73 7562 7365 7175  ule=None,subsequ
-00028540: 656e 745f 7368 6f72 746e 616d 655f 7275  ent_shortname_ru
-00028550: 6c65 3d4e 6f6e 652c 7379 6e63 3d54 7275  le=None,sync=Tru
-00028560: 652c 7374 7275 6374 7572 655f 7368 6f72  e,structure_shor
-00028570: 746e 616d 653d 4e6f 6e65 2c73 7472 7563  tname=None,struc
-00028580: 7475 7265 5f72 6f6f 745f 656c 656d 656e  ture_root_elemen
-00028590: 745f 7368 6f72 746e 616d 653d 4e6f 6e65  t_shortname=None
-000285a0: 2c70 6172 656e 745f 6b65 795f 636f 6c75  ,parent_key_colu
-000285b0: 6d6e 3d4e 6f6e 652c 2070 6172 656e 745f  mn=None, parent_
-000285c0: 6b65 795f 6669 656c 645f 6e61 6d65 3d4e  key_field_name=N
-000285d0: 6f6e 652c 696e 636c 7564 655f 7061 7265  one,include_pare
-000285e0: 6e74 5f6b 6579 5f63 6f6c 756d 6e5f 696e  nt_key_column_in
-000285f0: 5f65 6c65 6d65 6e74 3d46 616c 7365 293a  _element=False):
-00028600: 0d0a 2020 2020 2020 2020 2727 274d 616b  ..        '''Mak
-00028610: 6520 6e65 7720 656c 656d 656e 7473 2066  e new elements f
-00028620: 726f 6d20 6120 7061 6e64 6173 2044 6174  rom a pandas Dat
-00028630: 6166 7261 6d65 0d0a 2020 2020 2020 2020  aframe..        
-00028640: 636f 6c75 6d6e 7320 7368 6f75 6c64 2062  columns should b
-00028650: 6520 5b27 5368 6f72 7420 4e61 6d65 272c  e ['Short Name',
-00028660: 274c 6f6e 6720 4e61 6d65 272c 2744 6573  'Long Name','Des
-00028670: 6372 6970 7469 6f6e 272c 2747 726f 7570  cription','Group
-00028680: 204f 6e6c 7927 2c27 4361 6c63 756c 6174   Only','Calculat
-00028690: 696f 6e20 5374 6174 7573 272c 2743 616c  ion Status','Cal
-000286a0: 6375 6c61 7469 6f6e 272c 2743 6f6c 6f75  culation','Colou
-000286b0: 7227 2c27 4d65 6173 7572 6520 456c 656d  r','Measure Elem
-000286c0: 656e 7427 5d20 666f 6c6c 6f77 6564 2062  ent'] followed b
-000286d0: 7920 6669 656c 6420 7368 6f72 746e 616d  y field shortnam
-000286e0: 6573 0d0a 2020 2020 2020 2020 4966 2073  es..        If s
-000286f0: 686f 7274 6e61 6d65 2069 7320 6d69 7373  hortname is miss
-00028700: 696e 6720 6974 2077 696c 6c20 6265 2067  ing it will be g
-00028710: 656e 6572 6174 6564 2066 726f 6d20 7468  enerated from th
-00028720: 6520 6c6f 6e67 206e 616d 650d 0a20 2020  e long name..   
-00028730: 2020 2020 2041 6c6c 206f 7468 6572 2063       All other c
-00028740: 6f6c 756d 6e73 2073 686f 756c 6420 7265  olumns should re
-00028750: 6c61 7465 2074 6f20 6120 6669 656c 6420  late to a field 
-00028760: 7368 6f72 746e 616d 650d 0a20 2020 2020  shortname..     
-00028770: 2020 2049 6620 7061 7265 6e74 5f6b 6579     If parent_key
-00028780: 5f63 6f6c 756d 6e20 6973 2073 6574 0d0a  _column is set..
-00028790: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-000287a0: 2070 7269 6d61 7279 5f6b 6579 5f63 6f6c   primary_key_col
-000287b0: 756d 6e73 3a20 7468 6520 636f 6c75 6d6e  umns: the column
-000287c0: 7320 746f 2062 6520 7573 6564 2077 6865  s to be used whe
-000287d0: 6e20 6465 6369 6469 6e67 2077 6861 7420  n deciding what 
-000287e0: 6973 2061 2075 6e69 7175 6520 656c 656d  is a unique elem
-000287f0: 656e 742e 2053 686f 756c 6420 6265 2061  ent. Should be a
-00028800: 206c 6973 7420 6f66 2066 6965 6c64 206e   list of field n
-00028810: 616d 6573 206f 6620 7468 6520 656c 656d  ames of the elem
-00028820: 656e 740d 0a20 2020 2020 2020 203a 7061  ent..        :pa
-00028830: 7261 6d20 6465 6475 706c 6963 6174 653a  ram deduplicate:
-00028840: 2072 656d 6f76 6520 6475 706c 6963 6174   remove duplicat
-00028850: 6573 2062 6173 6564 206f 6e20 7468 6520  es based on the 
-00028860: 7072 696d 6172 7920 6b65 7920 6e61 6d65  primary key name
-00028870: 202d 2073 6574 2074 6f20 4661 6c73 6520   - set to False 
-00028880: 6966 2079 6f75 2068 6176 6520 6d61 6e75  if you have manu
-00028890: 616c 6c79 2072 656d 6f76 6564 2064 7570  ally removed dup
-000288a0: 6c69 6361 7465 7320 616c 7265 6164 792e  licates already.
-000288b0: 204f 7468 6572 7769 7365 2063 686f 6f73   Otherwise choos
-000288c0: 6520 2766 6972 7374 2720 6f72 2027 6c61  e 'first' or 'la
-000288d0: 7374 2720 746f 2063 7265 6174 6520 6469  st' to create di
-000288e0: 6d65 6e73 696f 6e20 656c 656d 656e 7473  mension elements
-000288f0: 2066 726f 6d20 7468 6520 7468 6520 6669   from the the fi
-00028900: 7273 7420 6f72 206c 6173 7420 696e 7374  rst or last inst
-00028910: 616e 6365 206f 6620 7468 6520 7072 696d  ance of the prim
-00028920: 6172 795f 6b65 795f 6669 656c 640d 0a20  ary_key_field.. 
-00028930: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-00028940: 7275 6374 7572 655f 7368 6f72 746e 616d  ructure_shortnam
-00028950: 653a 204d 7573 7420 6265 2073 6574 2069  e: Must be set i
-00028960: 6620 7765 2077 616e 7420 746f 2063 7265  f we want to cre
-00028970: 6174 6520 6120 7374 7275 6374 7572 6520  ate a structure 
-00028980: 6672 6f6d 2074 6869 7320 6461 7461 6672  from this datafr
-00028990: 616d 6520 7369 6d75 6c74 616e 656f 7573  ame simultaneous
-000289a0: 6c79 2077 6974 6820 6372 6561 7469 6e67  ly with creating
-000289b0: 2074 6865 2065 6c65 6d65 6e74 732e 0d0a   the elements...
-000289c0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-000289d0: 6172 656e 745f 6b65 795f 636f 6c75 6d6e  arent_key_column
-000289e0: 3a0d 0a20 2020 2020 2020 203a 7061 7261  :..        :para
-000289f0: 6d20 7061 7265 6e74 5f6b 6579 5f66 6965  m parent_key_fie
-00028a00: 6c64 5f6e 616d 653a 0d0a 0d0a 2020 2020  ld_name:....    
-00028a10: 2020 2020 3a70 6172 616d 2069 6e63 6c75      :param inclu
-00028a20: 6465 5f70 6172 656e 745f 6b65 795f 636f  de_parent_key_co
-00028a30: 6c75 6d6e 5f69 6e5f 656c 656d 656e 743a  lumn_in_element:
-00028a40: 2049 6620 7365 7420 746f 2066 616c 7365   If set to false
-00028a50: 2074 6865 2070 6172 656e 745f 6b65 795f   the parent_key_
-00028a60: 636f 6c75 6d6e 2077 696c 6c20 6265 206f  column will be o
-00028a70: 6e6c 7920 7573 6564 2074 6f20 6372 6561  nly used to crea
-00028a80: 7465 2074 6865 206e 6f6d 696e 6174 6564  te the nominated
-00028a90: 2073 7472 7563 7475 7265 2e20 4966 2073   structure. If s
-00028aa0: 6574 2074 6f20 5472 7565 2c20 7468 6520  et to True, the 
-00028ab0: 7061 7265 6e74 206b 6579 2063 6f6c 756d  parent key colum
-00028ac0: 6e20 7769 6c6c 2062 6520 616c 736f 2073  n will be also s
-00028ad0: 6176 6564 2061 7320 6120 6669 656c 6420  aved as a field 
-00028ae0: 696e 2074 6865 2045 6c65 6d65 6e74 0d0a  in the Element..
-00028af0: 2020 2020 2020 2020 2727 270d 0a20 2020          '''..   
-00028b00: 2020 2020 2023 534e 0d0a 2020 2020 2020       #SN..      
-00028b10: 2020 234c 4e0d 0a20 2020 2020 2020 2023    #LN..        #
-00028b20: 5048 5953 4944 0d0a 0d0a 2020 2020 2020  PHYSID....      
-00028b30: 2020 7365 6c66 2e65 6c65 6d65 6e74 732e    self.elements.
-00028b40: 6d65 7267 6528 736f 7572 6365 203d 2064  merge(source = d
-00028b50: 6174 6166 7261 6d65 2c20 6b65 7973 203d  ataframe, keys =
-00028b60: 2070 7269 6d61 7279 5f6b 6579 5f63 6f6c   primary_key_col
-00028b70: 756d 6e73 290d 0a0d 0a0d 0a20 2020 2020  umns)......     
-00028b80: 2020 2023 4966 2077 6520 6172 6520 6d61     #If we are ma
-00028b90: 6b69 6e67 2074 6865 2073 7472 7563 7475  king the structu
-00028ba0: 7265 2c20 6a6f 696e 2069 6e20 7468 6520  re, join in the 
-00028bb0: 7365 6e74 2069 6e20 6461 7461 6672 616d  sent in datafram
-00028bc0: 6520 746f 2074 6865 2064 6174 6166 7261  e to the datafra
-00028bd0: 6d65 2069 6d70 6f72 7465 6420 6672 6f6d  me imported from
-00028be0: 2045 6d70 6f77 6572 2c20 746f 2067 6574   Empower, to get
-00028bf0: 2074 6865 2063 616e 6f6e 6963 616c 2045   the canonical E
-00028c00: 6d70 6f77 6572 2073 686f 7274 6e61 6d65  mpower shortname
-00028c10: 730d 0a20 2020 2020 2020 2023 4a6f 696e  s..        #Join
-00028c20: 206f 6e20 7468 6520 4b65 7920 4669 656c   on the Key Fiel
-00028c30: 6420 7765 2070 7265 7669 6f75 736c 7920  d we previously 
-00028c40: 7573 6564 0d0a 2020 2020 2020 2020 6966  used..        if
-00028c50: 2073 7472 7563 7475 7265 5f73 686f 7274   structure_short
-00028c60: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
-00028c70: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00028c80: 6620 6465 6475 706c 6963 6174 6520 6973  f deduplicate is
-00028c90: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00028ca0: 2020 2020 2020 2020 2357 6520 7769 6c6c          #We will
-00028cb0: 2068 6176 6520 636f 7069 6564 2061 6c72   have copied alr
-00028cc0: 6561 6479 2069 6620 6465 6475 706c 6963  eady if deduplic
-00028cd0: 6174 6520 7761 7320 7365 7420 2d20 6f74  ate was set - ot
-00028ce0: 6865 7277 6973 6520 7765 206e 6565 6420  herwise we need 
-00028cf0: 746f 2063 6f70 7920 666f 7220 7468 6520  to copy for the 
-00028d00: 6669 7273 7420 7469 6d65 0d0a 2020 2020  first time..    
-00028d10: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00028d20: 6672 616d 6520 3d20 6461 7461 6672 616d  frame = datafram
-00028d30: 655b 7072 696d 6172 795f 6b65 795f 636f  e[primary_key_co
-00028d40: 6c75 6d6e 732b 5b70 6172 656e 745f 6b65  lumns+[parent_ke
-00028d50: 795f 636f 6c75 6d6e 5d5d 2e63 6f70 7928  y_column]].copy(
-00028d60: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00028d70: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00028d80: 2020 2020 2020 6461 7461 6672 616d 6520        dataframe 
-00028d90: 3d20 6461 7461 6672 616d 655b 7072 696d  = dataframe[prim
-00028da0: 6172 795f 6b65 795f 636f 6c75 6d6e 732b  ary_key_columns+
-00028db0: 5b70 6172 656e 745f 6b65 795f 636f 6c75  [parent_key_colu
-00028dc0: 6d6e 5d5d 0d0a 0d0a 2020 2020 2020 2020  mn]]....        
-00028dd0: 2020 2020 6368 696c 645f 7061 7265 6e74      child_parent
-00028de0: 5f64 6174 6166 7261 6d65 203d 2070 642e  _dataframe = pd.
-00028df0: 6d65 7267 6528 686f 7720 2020 3d20 2769  merge(how   = 'i
-00028e00: 6e6e 6572 270d 0a20 2020 2020 2020 2020  nner'..         
-00028e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e30: 2020 2020 2c6c 6566 7420 203d 2073 656c      ,left  = sel
-00028e40: 662e 656c 656d 656e 7473 2e64 6174 6166  f.elements.dataf
-00028e50: 7261 6d65 0d0a 2020 2020 2020 2020 2020  rame..          
-00028e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028e80: 2020 202c 7269 6768 7420 3d20 6461 7461     ,right = data
-00028e90: 6672 616d 652e 7265 6e61 6d65 2863 6f6c  frame.rename(col
-00028ea0: 756d 6e73 203d 207b 2070 6172 656e 745f  umns = { parent_
-00028eb0: 6b65 795f 636f 6c75 6d6e 203a 2027 5061  key_column : 'Pa
-00028ec0: 7265 6e74 2053 686f 7274 204e 616d 6527  rent Short Name'
-00028ed0: 207d 290d 0a20 2020 2020 2020 2020 2020   })..           
-00028ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028f00: 2020 2c6f 6e20 2020 203d 2070 7269 6d61    ,on    = prima
-00028f10: 7279 5f6b 6579 5f63 6f6c 756d 6e73 0d0a  ry_key_columns..
-00028f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028f40: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00028f50: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00028f60: 6c66 2e6d 616b 655f 7374 7275 6374 7572  lf.make_structur
-00028f70: 655f 6672 6f6d 5f64 6174 6166 7261 6d65  e_from_dataframe
-00028f80: 2864 6174 6166 7261 6d65 2020 2020 2020  (dataframe      
-00028f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028fa0: 2020 3d20 6368 696c 645f 7061 7265 6e74    = child_parent
-00028fb0: 5f64 6174 6166 7261 6d65 0d0a 2020 2020  _dataframe..    
-00028fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028fe0: 2020 2020 2020 2020 2020 2c73 7472 7563            ,struc
-00028ff0: 7475 7265 5f73 686f 7274 6e61 6d65 2020  ture_shortname  
-00029000: 2020 2020 2020 2020 2020 2020 3d20 7374              = st
-00029010: 7275 6374 7572 655f 7368 6f72 746e 616d  ructure_shortnam
-00029020: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00029030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029050: 202c 7374 7275 6374 7572 655f 726f 6f74   ,structure_root
-00029060: 5f65 6c65 6d65 6e74 5f73 686f 7274 6e61  _element_shortna
-00029070: 6d65 203d 2073 7472 7563 7475 7265 5f72  me = structure_r
-00029080: 6f6f 745f 656c 656d 656e 745f 7368 6f72  oot_element_shor
-00029090: 746e 616d 650d 0a20 2020 2020 2020 2020  tname..         
-000290a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000290b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000290c0: 2020 2020 202c 7061 7265 6e74 5f6b 6579       ,parent_key
-000290d0: 5f63 6f6c 756d 6e20 2020 2020 2020 2020  _column         
-000290e0: 2020 2020 2020 203d 2070 6172 656e 745f         = parent_
-000290f0: 6b65 795f 636f 6c75 6d6e 0d0a 2020 2020  key_column..    
-00029100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029120: 2020 2020 2020 2020 2020 2c70 6172 656e            ,paren
-00029130: 745f 6b65 795f 6669 656c 645f 6e61 6d65  t_key_field_name
-00029140: 2020 2020 2020 2020 2020 2020 3d20 7061              = pa
-00029150: 7265 6e74 5f6b 6579 5f66 6965 6c64 5f6e  rent_key_field_n
-00029160: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
-00029170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029190: 2020 202c 7379 6e63 2020 2020 2020 2020     ,sync        
+00026be0: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
+00026bf0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00026c00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00026c10: 2e5f 7669 6577 706f 696e 7473 5b76 6965  ._viewpoints[vie
+00026c20: 7770 6f69 6e74 2e73 686f 7274 6e61 6d65  wpoint.shortname
+00026c30: 5d20 3d20 7669 6577 706f 696e 740d 0a0d  ] = viewpoint...
+00026c40: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00026c50: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00026c60: 2020 2020 7261 6973 6520 6d70 6578 2e45      raise mpex.E
+00026c70: 6d70 6f77 6572 496d 706f 7274 6572 5665  mpowerImporterVe
+00026c80: 7273 696f 6e45 7272 6f72 2827 4675 6e63  rsionError('Func
+00026c90: 7469 6f6e 616c 6974 7920 6e6f 7420 6176  tionality not av
+00026ca0: 6169 6c61 626c 6520 696e 2074 6869 7320  ailable in this 
+00026cb0: 456d 706f 7765 7220 496d 706f 7274 6572  Empower Importer
+00026cc0: 2076 6572 7369 6f6e 207b 7d20 6e65 6564   version {} need
+00026cd0: 2061 7420 6c65 6173 7420 7b7d 272e 666f   at least {}'.fo
+00026ce0: 726d 6174 2827 2e27 2e6a 6f69 6e28 5b73  rmat('.'.join([s
+00026cf0: 7472 2876 2920 666f 7220 7620 696e 2073  tr(v) for v in s
+00026d00: 656c 662e 6469 6d65 6e73 696f 6e2e 7369  elf.dimension.si
+00026d10: 7465 2e69 6d70 6f72 7465 725f 7665 7273  te.importer_vers
+00026d20: 696f 6e5d 292c 2027 392e 352e 3138 2e31  ion]), '9.5.18.1
+00026d30: 3934 3327 2929 0d0a 0d0a 2020 2020 2020  943'))....      
+00026d40: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00026d50: 6f6e 3a0d 0a20 2020 2020 2020 2020 2020  on:..           
+00026d60: 2073 656c 662e 5f76 6965 7770 6f69 6e74   self._viewpoint
+00026d70: 735f 7265 6164 203d 2046 616c 7365 0d0a  s_read = False..
+00026d80: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00026d90: 650d 0a0d 0a20 2020 2064 6566 2076 616c  e....    def val
+00026da0: 7565 7328 7365 6c66 293a 0d0a 2020 2020  ues(self):..    
+00026db0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00026dc0: 5f76 6965 7770 6f69 6e74 735f 7265 6164  _viewpoints_read
+00026dd0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00026de0: 656c 662e 5f6c 6f61 645f 7669 6577 706f  elf._load_viewpo
+00026df0: 696e 7473 2829 0d0a 0d0a 2020 2020 2020  ints()....      
+00026e00: 2020 7265 7475 726e 2073 656c 662e 5f76    return self._v
+00026e10: 6965 7770 6f69 6e74 732e 7661 6c75 6573  iewpoints.values
+00026e20: 2829 0d0a 0d0a 2020 2020 6465 6620 6974  ()....    def it
+00026e30: 656d 7328 7365 6c66 293a 0d0a 2020 2020  ems(self):..    
+00026e40: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00026e50: 5f76 6965 7770 6f69 6e74 735f 7265 6164  _viewpoints_read
+00026e60: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00026e70: 656c 662e 5f6c 6f61 645f 7669 6577 706f  elf._load_viewpo
+00026e80: 696e 7473 2829 0d0a 0d0a 2020 2020 2020  ints()....      
+00026e90: 2020 7265 7475 726e 2073 656c 662e 5f76    return self._v
+00026ea0: 6965 7770 6f69 6e74 732e 6974 656d 7328  iewpoints.items(
+00026eb0: 290d 0a0d 0a20 2020 2064 6566 206b 6579  )....    def key
+00026ec0: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+00026ed0: 2020 6966 206e 6f74 2073 656c 662e 5f76    if not self._v
+00026ee0: 6965 7770 6f69 6e74 735f 7265 6164 3a0d  iewpoints_read:.
+00026ef0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00026f00: 662e 5f6c 6f61 645f 7669 6577 706f 696e  f._load_viewpoin
+00026f10: 7473 2829 0d0a 0d0a 2020 2020 2020 2020  ts()....        
+00026f20: 7265 7475 726e 2073 656c 662e 5f76 6965  return self._vie
+00026f30: 7770 6f69 6e74 732e 6b65 7973 2829 0d0a  wpoints.keys()..
+00026f40: 0d0a 2020 2020 6465 6620 5f5f 6c65 6e5f  ..    def __len_
+00026f50: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+00026f60: 2020 6966 206e 6f74 2073 656c 662e 5f76    if not self._v
+00026f70: 6965 7770 6f69 6e74 735f 7265 6164 3a0d  iewpoints_read:.
+00026f80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00026f90: 662e 5f6c 6f61 645f 7669 6577 706f 696e  f._load_viewpoin
+00026fa0: 7473 2829 0d0a 0d0a 2020 2020 2020 2020  ts()....        
+00026fb0: 7265 7475 726e 206c 656e 2873 656c 662e  return len(self.
+00026fc0: 5f76 6965 7770 6f69 6e74 7329 0d0a 0d0a  _viewpoints)....
+00026fd0: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
+00026fe0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00026ff0: 2072 6574 7572 6e20 277b 7d20 6672 6f6d   return '{} from
+00027000: 203c 7b7d 206f 626a 6563 7420 6174 207b   <{} object at {
+00027010: 7d3e 272e 666f 726d 6174 2827 7b27 202b  }>'.format('{' +
+00027020: 2027 5c6e 272e 6a6f 696e 285b 2022 277b   '\n'.join([ "'{
+00027030: 7d27 3a7b 7d22 2e66 6f72 6d61 7428 6b2c  }':{}".format(k,
+00027040: 7265 7072 2876 2929 2066 6f72 206b 2c76  repr(v)) for k,v
+00027050: 2069 6e20 7365 6c66 2e69 7465 6d73 2829   in self.items()
+00027060: 5d29 202b 2027 7d27 2c73 656c 662e 5f5f  ]) + '}',self.__
+00027070: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00027080: 2c68 6578 2869 6428 7365 6c66 2929 2029  ,hex(id(self)) )
+00027090: 0d0a 0d0a 636c 6173 7320 4469 6d65 6e73  ....class Dimens
+000270a0: 696f 6e28 6f62 6a65 6374 293a 0d0a 2020  ion(object):..  
+000270b0: 2020 2727 270d 0a20 2020 2041 6e20 456d    '''..    An Em
+000270c0: 706f 7765 7220 4469 6d65 6e73 696f 6e0d  power Dimension.
+000270d0: 0a0d 0a20 2020 204d 616e 6970 756c 6174  ...    Manipulat
+000270e0: 6520 6120 6469 6d65 6e73 696f 6e27 7320  e a dimension's 
+000270f0: 656c 656d 656e 7473 2c20 7374 7275 6374  elements, struct
+00027100: 7572 6573 2061 6e64 2073 6563 7572 6974  ures and securit
+00027110: 7920 7573 696e 6720 7468 6973 2063 6c61  y using this cla
+00027120: 7373 2e0d 0a20 2020 2027 2727 0d0a 2020  ss...    '''..  
+00027130: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
+00027140: 656c 660d 0a20 2020 2020 2020 2020 2020  elf..           
+00027150: 2020 2020 202c 7369 7465 0d0a 2020 2020       ,site..    
+00027160: 2020 2020 2020 2020 2020 2020 2c69 6e64              ,ind
+00027170: 6578 0d0a 2020 2020 2020 2020 2020 2020  ex..            
+00027180: 2020 2020 293a 0d0a 0d0a 2020 2020 2020      ):....      
+00027190: 2020 7365 6c66 2e73 6974 6520 2020 2020    self.site     
+000271a0: 2020 2020 2020 2020 3d20 7369 7465 0d0a          = site..
+000271b0: 2020 2020 2020 2020 7365 6c66 2e69 6e64          self.ind
+000271c0: 6578 2020 2020 2020 2020 2020 2020 3d20  ex            = 
+000271d0: 696e 6465 780d 0a0d 0a0d 0a20 2020 2020  index......     
+000271e0: 2020 2023 2357 6520 7769 6c6c 2067 6574     ##We will get
+000271f0: 2074 6865 2066 6965 6c64 206e 616d 6573   the field names
+00027200: 2062 7920 6578 706f 7274 696e 6720 7468   by exporting th
+00027210: 6520 6469 6d65 6e73 696f 6e20 6672 6f6d  e dimension from
+00027220: 2074 6865 2073 6974 650d 0a20 2020 2020   the site..     
+00027230: 2020 2023 7365 6c66 2e5f 6669 656c 645f     #self._field_
+00027240: 6e61 6d65 733d 5b5d 0d0a 0d0a 2020 2020  names=[]....    
+00027250: 2020 2020 7365 6c66 2e5f 7374 7275 6374      self._struct
+00027260: 7572 655f 6765 7474 6572 203d 205f 5374  ure_getter = _St
+00027270: 7275 6374 7572 6547 6574 7465 7228 6469  ructureGetter(di
+00027280: 6d65 6e73 696f 6e20 3d20 7365 6c66 290d  mension = self).
+00027290: 0a20 2020 2020 2020 2073 656c 662e 5f65  .        self._e
+000272a0: 6c65 6d65 6e74 735f 6765 7474 6572 2020  lements_getter  
+000272b0: 3d20 5f45 6c65 6d65 6e74 7347 6574 7465  = _ElementsGette
+000272c0: 7228 2064 696d 656e 7369 6f6e 203d 2073  r( dimension = s
+000272d0: 656c 6629 0d0a 0d0a 2020 2020 2020 2020  elf)....        
+000272e0: 2357 6865 6e20 6372 6561 7469 6e67 2065  #When creating e
+000272f0: 6c65 6d65 6e74 7320 666f 7220 7468 6520  lements for the 
+00027300: 6669 7273 7420 7469 6d65 2077 6520 6d61  first time we ma
+00027310: 7920 7265 6c79 206f 6e0d 0a20 2020 2020  y rely on..     
+00027320: 2020 2073 656c 662e 5f65 6c65 6d65 6e74     self._element
+00027330: 735f 7769 7468 6f75 745f 7368 6f72 746e  s_without_shortn
+00027340: 616d 6573 203d 205b 5d0d 0a0d 0a20 2020  ames = []....   
+00027350: 2020 2020 2073 656c 662e 5f66 6965 6c64       self._field
+00027360: 7320 3d20 5f44 696d 656e 7369 6f6e 4669  s = _DimensionFi
+00027370: 656c 6473 4765 7474 6572 2864 696d 656e  eldsGetter(dimen
+00027380: 7369 6f6e 3d73 656c 6629 0d0a 0d0a 2020  sion=self)....  
+00027390: 2020 2020 2020 2344 696d 656e 7369 6f6e        #Dimension
+000273a0: 7320 6861 7665 2061 206e 616d 6520 2d20  s have a name - 
+000273b0: 6174 2074 6865 2074 696d 6520 6f66 2077  at the time of w
+000273c0: 7269 7469 6e67 2028 3230 3138 2d30 382d  riting (2018-08-
+000273d0: 3231 2920 7468 6573 6520 6361 6e27 7420  21) these can't 
+000273e0: 6265 2072 6561 6420 6672 6f6d 2045 6d70  be read from Emp
+000273f0: 6f77 6572 2061 6e64 206d 7573 7420 6265  ower and must be
+00027400: 2073 6574 2062 7920 7468 6520 7573 6572   set by the user
+00027410: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00027420: 6c6f 6e67 6e61 6d65 203d 204e 6f6e 650d  longname = None.
+00027430: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+00027440: 0d0a 2020 2020 6465 6620 6c6f 6e67 6e61  ..    def longna
+00027450: 6d65 2873 656c 6629 3a0d 0a20 2020 2020  me(self):..     
+00027460: 2020 2027 2727 5468 6520 4469 6d65 6e73     '''The Dimens
+00027470: 696f 6e27 7320 456d 706f 7765 7220 6c6f  ion's Empower lo
+00027480: 6e67 6e61 6d65 2727 270d 0a20 2020 2020  ngname'''..     
+00027490: 2020 2069 6620 7365 6c66 2e5f 6c6f 6e67     if self._long
+000274a0: 6e61 6d65 2069 7320 4e6f 6e65 3a0d 0a20  name is None:.. 
+000274b0: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+000274c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000274d0: 2023 7072 6f76 6f6b 6520 6120 7374 7275   #provoke a stru
+000274e0: 6374 7572 6573 206c 617a 7920 6c6f 6164  ctures lazy load
+000274f0: 2077 6869 6368 2069 7320 7468 6520 6265   which is the be
+00027500: 7374 2077 6179 206f 6620 6765 7474 696e  st way of gettin
+00027510: 6720 6469 6d65 6e73 696f 6e20 6e61 6d65  g dimension name
+00027520: 7320 6174 2074 6865 206d 6f6d 656e 740d  s at the moment.
+00027530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027540: 2073 656c 662e 7374 7275 6374 7572 6573   self.structures
+00027550: 2e76 616c 7565 7328 290d 0a20 2020 2020  .values()..     
+00027560: 2020 2020 2020 2065 7863 6570 7420 4174         except At
+00027570: 7472 6962 7574 6545 7272 6f72 3a0d 0a20  tributeError:.. 
+00027580: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00027590: 6173 730d 0a20 2020 2020 2020 2072 6574  ass..        ret
+000275a0: 7572 6e20 7365 6c66 2e5f 6c6f 6e67 6e61  urn self._longna
+000275b0: 6d65 0d0a 0d0a 2020 2020 406c 6f6e 676e  me....    @longn
+000275c0: 616d 652e 7365 7474 6572 0d0a 2020 2020  ame.setter..    
+000275d0: 6465 6620 6c6f 6e67 6e61 6d65 2873 656c  def longname(sel
+000275e0: 662c 7661 6c29 3a0d 0a20 2020 2020 2020  f,val):..       
+000275f0: 2073 656c 662e 5f6c 6f6e 676e 616d 653d   self._longname=
+00027600: 7661 6c0d 0a0d 0a20 2020 2040 7072 6f70  val....    @prop
+00027610: 6572 7479 0d0a 2020 2020 6465 6620 7374  erty..    def st
+00027620: 7275 6374 7572 6573 2873 656c 6629 3a0d  ructures(self):.
+00027630: 0a20 2020 2020 2020 2027 2727 5374 7275  .        '''Stru
+00027640: 6374 7572 6573 2066 6f72 2074 6865 2064  ctures for the d
+00027650: 696d 656e 7369 6f6e 202d 2062 7920 7368  imension - by sh
+00027660: 6f72 746e 616d 650d 0a0d 0a20 2020 2020  ortname....     
+00027670: 2020 202e 7374 7275 6374 7572 6573 2062     .structures b
+00027680: 6568 6176 6573 206c 696b 6520 6120 6469  ehaves like a di
+00027690: 6374 696f 6e61 7279 2028 796f 7520 6361  ctionary (you ca
+000276a0: 6e20 6361 6c6c 202e 7661 6c75 6573 2829  n call .values()
+000276b0: 2c20 2e69 7465 6d73 2829 2061 6e64 202e  , .items() and .
+000276c0: 6b65 7973 2829 206f 6e20 6974 292c 2062  keys() on it), b
+000276d0: 7574 2077 6865 6e20 6974 6572 6174 6564  ut when iterated
+000276e0: 206f 7665 7220 6974 2079 6965 6c64 7320   over it yields 
+000276f0: 5374 7275 6374 7572 6573 206f 6e65 2061  Structures one a
+00027700: 6674 6572 2074 6865 206f 7468 6572 2e0d  fter the other..
+00027710: 0a0d 0a20 2020 2020 2020 2041 2073 696e  ...        A sin
+00027720: 676c 6520 5374 7275 6374 7572 6520 6361  gle Structure ca
+00027730: 6e20 6265 2072 6574 7269 6576 6564 2066  n be retrieved f
+00027740: 726f 6d20 2e73 7472 7563 7475 7265 7320  rom .structures 
+00027750: 6279 2069 6e64 6578 696e 6720 6974 206f  by indexing it o
+00027760: 6e20 6974 7320 7368 6f72 746e 616d 652c  n its shortname,
+00027770: 2065 2e67 2e3a 0d0a 2020 2020 2020 2020   e.g.:..        
+00027780: 3e3e 3e20 7369 7465 2e64 696d 656e 7369  >>> site.dimensi
+00027790: 6f6e 5b30 5d2e 7374 7275 6374 7572 6573  on[0].structures
+000277a0: 5b27 5350 414d 275d 0d0a 2020 2020 2020  ['SPAM']..      
+000277b0: 2020 2727 270d 0a20 2020 2020 2020 2023    '''..        #
+000277c0: 5468 6520 5f73 7472 7563 7475 7265 5f67  The _structure_g
+000277d0: 6574 7465 7220 696d 706c 656d 656e 7473  etter implements
+000277e0: 205f 5f67 6574 5f69 7465 6d5f 5f28 2920   __get_item__() 
+000277f0: 746f 2070 726f 7669 6465 2074 6865 2073  to provide the s
+00027800: 7562 7363 7269 7074 6162 6c65 2069 6e74  ubscriptable int
+00027810: 6572 6661 6365 202d 2061 6e64 2070 726f  erface - and pro
+00027820: 7669 6465 206c 617a 7920 6c6f 6164 696e  vide lazy loadin
+00027830: 670d 0a20 2020 2020 2020 2072 6574 7572  g..        retur
+00027840: 6e20 7365 6c66 2e5f 7374 7275 6374 7572  n self._structur
+00027850: 655f 6765 7474 6572 0d0a 0d0a 2020 2020  e_getter....    
+00027860: 4073 7472 7563 7475 7265 732e 7365 7474  @structures.sett
+00027870: 6572 0d0a 2020 2020 6465 6620 7374 7275  er..    def stru
+00027880: 6374 7572 6573 2873 656c 662c 7661 6c29  ctures(self,val)
+00027890: 3a0d 0a20 2020 2020 2020 2069 6620 6973  :..        if is
+000278a0: 696e 7374 616e 6365 2876 616c 2c5f 5374  instance(val,_St
+000278b0: 7275 6374 7572 6547 6574 7465 7229 3a0d  ructureGetter):.
+000278c0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000278d0: 662e 5f73 7472 7563 7475 7265 5f67 6574  f._structure_get
+000278e0: 7465 7220 3d20 7661 6c0d 0a20 2020 2020  ter = val..     
+000278f0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00027900: 2020 2020 2020 7261 6973 6520 4174 7472        raise Attr
+00027910: 6962 7574 6545 7272 6f72 2827 4469 6d65  ibuteError('Dime
+00027920: 6e73 696f 6e2e 7374 7275 6374 7572 6573  nsion.structures
+00027930: 2063 616e 6e6f 7420 6265 2073 6574 2065   cannot be set e
+00027940: 7863 6570 7420 6261 636b 2074 6f20 6974  xcept back to it
+00027950: 7365 6c66 2069 6e20 6120 2b3d 206f 7065  self in a += ope
+00027960: 7261 7469 6f6e 2729 0d0a 0d0a 2020 2020  ration')....    
+00027970: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
+00027980: 6566 2065 6c65 6d65 6e74 7328 7365 6c66  ef elements(self
+00027990: 293a 0d0a 2020 2020 2020 2020 2727 2753  ):..        '''S
+000279a0: 686f 7274 6e61 6d65 2069 6e64 6578 6564  hortname indexed
+000279b0: 2065 6c65 6d65 6e74 7320 666f 7220 7468   elements for th
+000279c0: 6520 6469 6d65 6e73 696f 6e0d 0a0d 0a20  e dimension.... 
+000279d0: 2020 2020 2020 202e 656c 656d 656e 7473         .elements
+000279e0: 2062 6568 6176 6573 206c 696b 6520 6120   behaves like a 
+000279f0: 6469 6374 696f 6e61 7279 2028 796f 7520  dictionary (you 
+00027a00: 6361 6e20 6361 6c6c 202e 7661 6c75 6573  can call .values
+00027a10: 2829 2c20 2e69 7465 6d73 2829 2061 6e64  (), .items() and
+00027a20: 202e 6b65 7973 2829 206f 6e20 6974 292c   .keys() on it),
+00027a30: 2062 7574 2077 6865 6e20 6974 6572 6174   but when iterat
+00027a40: 6564 206f 7665 7220 6974 2079 6965 6c64  ed over it yield
+00027a50: 7320 456c 656d 656e 7473 206f 6e65 2061  s Elements one a
+00027a60: 6674 6572 2074 6865 206f 7468 6572 2e0d  fter the other..
+00027a70: 0a0d 0a20 2020 2020 2020 2041 2073 696e  ...        A sin
+00027a80: 676c 6520 656c 656d 656e 7420 6361 6e20  gle element can 
+00027a90: 6265 2072 6574 7269 6576 6564 2066 726f  be retrieved fro
+00027aa0: 6d20 2e65 6c65 6d65 6e74 7320 6279 2069  m .elements by i
+00027ab0: 6e64 6578 696e 6720 6974 206f 6e20 6974  ndexing it on it
+00027ac0: 7320 7368 6f72 746e 616d 652c 2065 2e67  s shortname, e.g
+00027ad0: 2e3a 0d0a 2020 2020 2020 2020 3e3e 3e20  .:..        >>> 
+00027ae0: 7369 7465 2e64 696d 656e 7369 6f6e 5b30  site.dimension[0
+00027af0: 5d2e 656c 656d 656e 7473 5b27 4d59 5348  ].elements['MYSH
+00027b00: 4f52 5443 4f32 275d 0d0a 2020 2020 2020  ORTCO2']..      
+00027b10: 2020 2727 270d 0a20 2020 2020 2020 2023    '''..        #
+00027b20: 5468 6520 5f65 6c65 6d65 6e74 735f 6765  The _elements_ge
+00027b30: 7474 6572 2069 6d70 6c65 6d65 6e74 7320  tter implements 
+00027b40: 5f5f 6765 745f 6974 656d 5f5f 2829 2074  __get_item__() t
+00027b50: 6f20 7072 6f76 6964 6520 7468 6520 7375  o provide the su
+00027b60: 6273 6372 6970 7461 626c 6520 696e 7465  bscriptable inte
+00027b70: 7266 6163 6520 2d20 616e 6420 7072 6f76  rface - and prov
+00027b80: 6964 6520 6c61 7a79 206c 6f61 6469 6e67  ide lazy loading
+00027b90: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00027ba0: 2073 656c 662e 5f65 6c65 6d65 6e74 735f   self._elements_
+00027bb0: 6765 7474 6572 0d0a 0d0a 2020 2020 4065  getter....    @e
+00027bc0: 6c65 6d65 6e74 732e 7365 7474 6572 0d0a  lements.setter..
+00027bd0: 2020 2020 6465 6620 656c 656d 656e 7473      def elements
+00027be0: 2873 656c 662c 7661 6c29 3a0d 0a20 2020  (self,val):..   
+00027bf0: 2020 2020 2069 6620 7661 6c20 3d3d 2073       if val == s
+00027c00: 656c 662e 5f65 6c65 6d65 6e74 735f 6765  elf._elements_ge
+00027c10: 7474 6572 3a0d 0a20 2020 2020 2020 2020  tter:..         
+00027c20: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
+00027c30: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00027c40: 2020 2020 7261 6973 6520 4174 7472 6962      raise Attrib
+00027c50: 7574 6545 7272 6f72 2822 6361 6e27 7420  uteError("can't 
+00027c60: 7365 7420 6174 7472 6962 7574 6522 290d  set attribute").
+00027c70: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+00027c80: 0d0a 2020 2020 6465 6620 6669 656c 6473  ..    def fields
+00027c90: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00027ca0: 2027 2727 7265 7475 726e 2061 2074 6865   '''return a the
+00027cb0: 2066 6965 6c64 2064 6566 696e 6974 696f   field definitio
+00027cc0: 6e73 206f 6620 7468 6520 6469 6d65 6e73  ns of the dimens
+00027cd0: 696f 6e20 6173 2061 6e20 6f72 6465 7265  ion as an ordere
+00027ce0: 6420 6469 6374 696f 6e61 7279 2727 270d  d dictionary'''.
+00027cf0: 0a20 2020 2020 2020 2023 6c6f 6164 2065  .        #load e
+00027d00: 6c65 6d65 6e74 7320 746f 2067 6574 2066  lements to get f
+00027d10: 6965 6c64 732c 2062 6563 6175 7365 2074  ields, because t
+00027d20: 6865 7265 2069 7320 6e6f 2064 6972 6563  here is no direc
+00027d30: 7420 7761 7920 6f66 2067 6574 7469 6e67  t way of getting
+00027d40: 2066 6965 6c64 730d 0a20 2020 2020 2020   fields..       
+00027d50: 2069 6620 6e6f 7420 7365 6c66 2e5f 656c   if not self._el
+00027d60: 656d 656e 7473 5f67 6574 7465 722e 5f65  ements_getter._e
+00027d70: 6c65 6d65 6e74 735f 7265 6164 3a0d 0a20  lements_read:.. 
+00027d80: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00027d90: 5f65 6c65 6d65 6e74 735f 6765 7474 6572  _elements_getter
+00027da0: 2e5f 6c6f 6164 5f65 6c65 6d65 6e74 7328  ._load_elements(
+00027db0: 6465 6275 673d 7365 6c66 2e73 6974 652e  debug=self.site.
+00027dc0: 5f64 6562 7567 290d 0a0d 0a20 2020 2020  _debug)....     
+00027dd0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00027de0: 6669 656c 6473 0d0a 0d0a 2020 2020 4066  fields....    @f
+00027df0: 6965 6c64 732e 7365 7474 6572 0d0a 2020  ields.setter..  
+00027e00: 2020 6465 6620 6669 656c 6473 2873 656c    def fields(sel
+00027e10: 662c 7661 6c29 3a0d 0a20 2020 2020 2020  f,val):..       
+00027e20: 2070 6173 730d 0a0d 0a20 2020 2023 6465   pass....    #de
+00027e30: 6620 5f73 796e 6368 726f 6e69 7365 5f65  f _synchronise_e
+00027e40: 6c65 6d65 6e74 735f 616e 645f 7374 7275  lements_and_stru
+00027e50: 6374 7572 6573 2873 656c 6629 3a0d 0a20  ctures(self):.. 
+00027e60: 2020 2023 2020 2020 7061 7373 0d0a 2020     #    pass..  
+00027e70: 2020 230d 0a0d 0a20 2020 2064 6566 2067    #....    def g
+00027e80: 6574 2873 656c 662c 2070 6174 6829 3a0d  et(self, path):.
+00027e90: 0a20 2020 2020 2020 2027 2727 5265 7475  .        '''Retu
+00027ea0: 726e 2061 2053 7472 7563 7475 7265 456c  rn a StructureEl
+00027eb0: 656d 656e 7420 7769 7468 696e 2061 2044  ement within a D
+00027ec0: 696d 656e 7369 6f6e 2062 7920 7061 7373  imension by pass
+00027ed0: 696e 6720 696e 2074 6865 2070 6174 6820  ing in the path 
+00027ee0: 6173 2061 2073 7472 696e 670d 0a0d 0a20  as a string.... 
+00027ef0: 2020 2020 2020 203a 7061 7468 3a20 4120         :path: A 
+00027f00: 7374 7269 6e67 2064 6573 6372 6962 696e  string describin
+00027f10: 6720 7468 6520 7061 7468 2074 6f20 6120  g the path to a 
+00027f20: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+00027f30: 2077 6974 6869 6e20 6120 4469 6d65 6e73   within a Dimens
+00027f40: 696f 6e0d 0a0d 0a20 2020 2020 2020 2065  ion....        e
+00027f50: 2e67 2e0d 0a20 2020 2020 2020 203e 3e3e  .g...        >>>
+00027f60: 2073 6974 652e 6469 6d65 6e73 696f 6e5b   site.dimension[
+00027f70: 305d 2e67 6574 2827 5350 414d 2e45 4747  0].get('SPAM.EGG
+00027f80: 532f 4241 434f 4e27 290d 0a0d 0a20 2020  S/BACON')....   
+00027f90: 2020 2020 2057 696c 6c20 7265 7475 726e       Will return
+00027fa0: 2074 6865 2027 4241 434f 4e27 2053 7472   the 'BACON' Str
+00027fb0: 7563 7475 7265 2045 6c65 6d65 6e74 2066  ucture Element f
+00027fc0: 726f 6d20 7468 6520 2753 5041 4d27 2053  rom the 'SPAM' S
+00027fd0: 7472 7563 7475 7265 0d0a 2020 2020 2020  tructure..      
+00027fe0: 2020 2727 270d 0a20 2020 2020 2020 2069    '''..        i
+00027ff0: 6620 6e6f 7420 272e 2720 696e 2070 6174  f not '.' in pat
+00028000: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
+00028010: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00028020: 2827 7061 7468 2070 6172 616d 6574 6572  ('path parameter
+00028030: 206d 7573 7420 6265 2061 2076 616c 6964   must be a valid
+00028040: 2070 6174 6820 746f 2061 2053 7472 7563   path to a Struc
+00028050: 7475 7265 456c 656d 656e 742e 2050 6174  tureElement. Pat
+00028060: 6820 6d75 7374 2063 6f6e 7461 696e 2061  h must contain a
+00028070: 2022 2e22 2063 6861 7261 6374 6572 2065   "." character e
+00028080: 2e67 2e20 5350 414d 2e45 4747 532f 4241  .g. SPAM.EGGS/BA
+00028090: 434f 4e2d 2066 6f75 6e64 207b 7d27 2e66  CON- found {}'.f
+000280a0: 6f72 6d61 7428 7061 7468 2929 0d0a 0d0a  ormat(path))....
+000280b0: 2020 2020 2020 2020 7061 7468 5f70 6172          path_par
+000280c0: 7473 203d 2070 6174 682e 7370 6c69 7428  ts = path.split(
+000280d0: 272f 2729 0d0a 2020 2020 2020 2020 7374  '/')..        st
+000280e0: 7275 6374 7572 655f 616e 645f 6869 6572  ructure_and_hier
+000280f0: 6172 6368 7920 3d20 7061 7468 5f70 6172  archy = path_par
+00028100: 7473 5b30 5d0d 0a20 2020 2020 2020 2072  ts[0]..        r
+00028110: 6573 745f 6f66 5f70 6174 6820 3d20 2727  est_of_path = ''
+00028120: 0d0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+00028130: 2870 6174 685f 7061 7274 7329 203e 2031  (path_parts) > 1
+00028140: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00028150: 6573 745f 6f66 5f70 6174 6820 3d20 272f  est_of_path = '/
+00028160: 272b 2827 2f27 2e6a 6f69 6e28 7061 7468  '+('/'.join(path
+00028170: 5f70 6172 7473 5b31 3a5d 2929 0d0a 2020  _parts[1:]))..  
+00028180: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
+00028190: 2020 2020 2353 706c 6974 206f 6e20 2e20      #Split on . 
+000281a0: 2057 6520 776f 756c 6420 6578 7065 6374   We would expect
+000281b0: 2032 2070 6172 7473 2062 7574 206d 6967   2 parts but mig
+000281c0: 6874 2067 6574 206d 6f72 6520 6966 2074  ht get more if t
+000281d0: 6865 7265 2061 7265 206d 6f72 652e 2041  here are more. A
+000281e0: 7272 616e 6765 2074 6865 7365 2069 6e74  rrange these int
+000281f0: 6f20 7468 6520 7661 7269 6f75 7320 636f  o the various co
+00028200: 6d62 696e 6174 696f 6e73 2065 2e67 2e20  mbinations e.g. 
+00028210: 5465 7374 312e 5465 7374 322e 5465 7374  Test1.Test2.Test
+00028220: 3320 636f 756c 6420 6265 2054 6573 7431  3 could be Test1
+00028230: 2061 6e64 2054 6573 7432 2e54 6573 7433   and Test2.Test3
+00028240: 206f 7220 5465 7374 312e 5465 7374 3220   or Test1.Test2 
+00028250: 616e 6420 5465 7374 330d 0a20 2020 2020  and Test3..     
+00028260: 2020 2023 2054 6865 2066 6972 7374 2076     # The first v
+00028270: 616c 6964 2063 6f6d 626f 2077 696e 730d  alid combo wins.
+00028280: 0a20 2020 2020 2020 2073 7472 7563 7475  .        structu
+00028290: 7265 5f61 6e64 5f68 6965 7261 7263 6879  re_and_hierarchy
+000282a0: 5f73 706c 6974 5f6f 6e5f 646f 7473 203d  _split_on_dots =
+000282b0: 2073 7472 7563 7475 7265 5f61 6e64 5f68   structure_and_h
+000282c0: 6965 7261 7263 6879 2e73 706c 6974 2827  ierarchy.split('
+000282d0: 2e27 290d 0a20 2020 2020 2020 200d 0a20  .')..        .. 
+000282e0: 2020 2020 2020 2066 6f72 206e 2069 6e20         for n in 
+000282f0: 7261 6e67 6528 6c65 6e28 7374 7275 6374  range(len(struct
+00028300: 7572 655f 616e 645f 6869 6572 6172 6368  ure_and_hierarch
+00028310: 795f 7370 6c69 745f 6f6e 5f64 6f74 7329  y_split_on_dots)
+00028320: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00028330: 7374 7275 6374 7572 655f 7374 7220 3d20  structure_str = 
+00028340: 272e 272e 6a6f 696e 2873 7472 7563 7475  '.'.join(structu
+00028350: 7265 5f61 6e64 5f68 6965 7261 7263 6879  re_and_hierarchy
+00028360: 5f73 706c 6974 5f6f 6e5f 646f 7473 5b30  _split_on_dots[0
+00028370: 3a6e 5d29 0d0a 2020 2020 2020 2020 2020  :n])..          
+00028380: 2020 6869 6572 6172 6368 795f 7374 7220    hierarchy_str 
+00028390: 3d20 272e 272e 6a6f 696e 2873 7472 7563  = '.'.join(struc
+000283a0: 7475 7265 5f61 6e64 5f68 6965 7261 7263  ture_and_hierarc
+000283b0: 6879 5f73 706c 6974 5f6f 6e5f 646f 7473  hy_split_on_dots
+000283c0: 5b6e 3a5d 290d 0a20 2020 2020 2020 2020  [n:])..         
+000283d0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+000283e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000283f0: 7365 6c66 2e73 7472 7563 7475 7265 735b  self.structures[
+00028400: 7374 7275 6374 7572 655f 7374 725d 2e64  structure_str].d
+00028410: 6573 6365 6e64 616e 7473 5b68 6965 7261  escendants[hiera
+00028420: 7263 6879 5f73 7472 2b72 6573 745f 6f66  rchy_str+rest_of
+00028430: 5f70 6174 685d 2020 2020 2020 2020 2020  _path]          
+00028440: 2020 200d 0a20 2020 2020 2020 2020 2020     ..           
+00028450: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+00028460: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00028470: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
+00028480: 200d 0a0d 0a20 2020 2020 2020 2072 6169   ....        rai
+00028490: 7365 204b 6579 4572 726f 7228 2750 6174  se KeyError('Pat
+000284a0: 683a 2027 2b70 6174 682b 2720 6e6f 7420  h: '+path+' not 
+000284b0: 666f 756e 6420 696e 2064 696d 656e 7369  found in dimensi
+000284c0: 6f6e 2027 2b73 7472 2873 656c 662e 696e  on '+str(self.in
+000284d0: 6465 7829 2920 0d0a 0d0a 0d0a 0d0a 2020  dex)) ........  
+000284e0: 2020 6465 6620 6d61 6b65 5f65 6c65 6d65    def make_eleme
+000284f0: 6e74 735f 6672 6f6d 5f64 6174 6166 7261  nts_from_datafra
+00028500: 6d65 2873 656c 662c 6461 7461 6672 616d  me(self,datafram
+00028510: 652c 7072 696d 6172 795f 6b65 795f 636f  e,primary_key_co
+00028520: 6c75 6d6e 733d 5b27 5368 6f72 7420 4e61  lumns=['Short Na
+00028530: 6d65 275d 2c64 6564 7570 6c69 6361 7465  me'],deduplicate
+00028540: 3d27 6c61 7374 272c 6c6f 6e67 6e61 6d65  ='last',longname
+00028550: 5f73 686f 7274 6e61 6d65 5f72 756c 653d  _shortname_rule=
+00028560: 4e6f 6e65 2c73 7562 7365 7175 656e 745f  None,subsequent_
+00028570: 7368 6f72 746e 616d 655f 7275 6c65 3d4e  shortname_rule=N
+00028580: 6f6e 652c 7379 6e63 3d54 7275 652c 7374  one,sync=True,st
+00028590: 7275 6374 7572 655f 7368 6f72 746e 616d  ructure_shortnam
+000285a0: 653d 4e6f 6e65 2c73 7472 7563 7475 7265  e=None,structure
+000285b0: 5f72 6f6f 745f 656c 656d 656e 745f 7368  _root_element_sh
+000285c0: 6f72 746e 616d 653d 4e6f 6e65 2c70 6172  ortname=None,par
+000285d0: 656e 745f 6b65 795f 636f 6c75 6d6e 3d4e  ent_key_column=N
+000285e0: 6f6e 652c 2070 6172 656e 745f 6b65 795f  one, parent_key_
+000285f0: 6669 656c 645f 6e61 6d65 3d4e 6f6e 652c  field_name=None,
+00028600: 696e 636c 7564 655f 7061 7265 6e74 5f6b  include_parent_k
+00028610: 6579 5f63 6f6c 756d 6e5f 696e 5f65 6c65  ey_column_in_ele
+00028620: 6d65 6e74 3d46 616c 7365 293a 0d0a 2020  ment=False):..  
+00028630: 2020 2020 2020 2727 274d 616b 6520 6e65        '''Make ne
+00028640: 7720 656c 656d 656e 7473 2066 726f 6d20  w elements from 
+00028650: 6120 7061 6e64 6173 2044 6174 6166 7261  a pandas Datafra
+00028660: 6d65 0d0a 2020 2020 2020 2020 636f 6c75  me..        colu
+00028670: 6d6e 7320 7368 6f75 6c64 2062 6520 5b27  mns should be ['
+00028680: 5368 6f72 7420 4e61 6d65 272c 274c 6f6e  Short Name','Lon
+00028690: 6720 4e61 6d65 272c 2744 6573 6372 6970  g Name','Descrip
+000286a0: 7469 6f6e 272c 2747 726f 7570 204f 6e6c  tion','Group Onl
+000286b0: 7927 2c27 4361 6c63 756c 6174 696f 6e20  y','Calculation 
+000286c0: 5374 6174 7573 272c 2743 616c 6375 6c61  Status','Calcula
+000286d0: 7469 6f6e 272c 2743 6f6c 6f75 7227 2c27  tion','Colour','
+000286e0: 4d65 6173 7572 6520 456c 656d 656e 7427  Measure Element'
+000286f0: 5d20 666f 6c6c 6f77 6564 2062 7920 6669  ] followed by fi
+00028700: 656c 6420 7368 6f72 746e 616d 6573 0d0a  eld shortnames..
+00028710: 2020 2020 2020 2020 4966 2073 686f 7274          If short
+00028720: 6e61 6d65 2069 7320 6d69 7373 696e 6720  name is missing 
+00028730: 6974 2077 696c 6c20 6265 2067 656e 6572  it will be gener
+00028740: 6174 6564 2066 726f 6d20 7468 6520 6c6f  ated from the lo
+00028750: 6e67 206e 616d 650d 0a20 2020 2020 2020  ng name..       
+00028760: 2041 6c6c 206f 7468 6572 2063 6f6c 756d   All other colum
+00028770: 6e73 2073 686f 756c 6420 7265 6c61 7465  ns should relate
+00028780: 2074 6f20 6120 6669 656c 6420 7368 6f72   to a field shor
+00028790: 746e 616d 650d 0a20 2020 2020 2020 2049  tname..        I
+000287a0: 6620 7061 7265 6e74 5f6b 6579 5f63 6f6c  f parent_key_col
+000287b0: 756d 6e20 6973 2073 6574 0d0a 0d0a 2020  umn is set....  
+000287c0: 2020 2020 2020 3a70 6172 616d 2070 7269        :param pri
+000287d0: 6d61 7279 5f6b 6579 5f63 6f6c 756d 6e73  mary_key_columns
+000287e0: 3a20 7468 6520 636f 6c75 6d6e 7320 746f  : the columns to
+000287f0: 2062 6520 7573 6564 2077 6865 6e20 6465   be used when de
+00028800: 6369 6469 6e67 2077 6861 7420 6973 2061  ciding what is a
+00028810: 2075 6e69 7175 6520 656c 656d 656e 742e   unique element.
+00028820: 2053 686f 756c 6420 6265 2061 206c 6973   Should be a lis
+00028830: 7420 6f66 2066 6965 6c64 206e 616d 6573  t of field names
+00028840: 206f 6620 7468 6520 656c 656d 656e 740d   of the element.
+00028850: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00028860: 6465 6475 706c 6963 6174 653a 2072 656d  deduplicate: rem
+00028870: 6f76 6520 6475 706c 6963 6174 6573 2062  ove duplicates b
+00028880: 6173 6564 206f 6e20 7468 6520 7072 696d  ased on the prim
+00028890: 6172 7920 6b65 7920 6e61 6d65 202d 2073  ary key name - s
+000288a0: 6574 2074 6f20 4661 6c73 6520 6966 2079  et to False if y
+000288b0: 6f75 2068 6176 6520 6d61 6e75 616c 6c79  ou have manually
+000288c0: 2072 656d 6f76 6564 2064 7570 6c69 6361   removed duplica
+000288d0: 7465 7320 616c 7265 6164 792e 204f 7468  tes already. Oth
+000288e0: 6572 7769 7365 2063 686f 6f73 6520 2766  erwise choose 'f
+000288f0: 6972 7374 2720 6f72 2027 6c61 7374 2720  irst' or 'last' 
+00028900: 746f 2063 7265 6174 6520 6469 6d65 6e73  to create dimens
+00028910: 696f 6e20 656c 656d 656e 7473 2066 726f  ion elements fro
+00028920: 6d20 7468 6520 7468 6520 6669 7273 7420  m the the first 
+00028930: 6f72 206c 6173 7420 696e 7374 616e 6365  or last instance
+00028940: 206f 6620 7468 6520 7072 696d 6172 795f   of the primary_
+00028950: 6b65 795f 6669 656c 640d 0a20 2020 2020  key_field..     
+00028960: 2020 203a 7061 7261 6d20 7374 7275 6374     :param struct
+00028970: 7572 655f 7368 6f72 746e 616d 653a 204d  ure_shortname: M
+00028980: 7573 7420 6265 2073 6574 2069 6620 7765  ust be set if we
+00028990: 2077 616e 7420 746f 2063 7265 6174 6520   want to create 
+000289a0: 6120 7374 7275 6374 7572 6520 6672 6f6d  a structure from
+000289b0: 2074 6869 7320 6461 7461 6672 616d 6520   this dataframe 
+000289c0: 7369 6d75 6c74 616e 656f 7573 6c79 2077  simultaneously w
+000289d0: 6974 6820 6372 6561 7469 6e67 2074 6865  ith creating the
+000289e0: 2065 6c65 6d65 6e74 732e 0d0a 2020 2020   elements...    
+000289f0: 2020 2020 3a70 6172 616d 2070 6172 656e      :param paren
+00028a00: 745f 6b65 795f 636f 6c75 6d6e 3a0d 0a20  t_key_column:.. 
+00028a10: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+00028a20: 7265 6e74 5f6b 6579 5f66 6965 6c64 5f6e  rent_key_field_n
+00028a30: 616d 653a 0d0a 0d0a 2020 2020 2020 2020  ame:....        
+00028a40: 3a70 6172 616d 2069 6e63 6c75 6465 5f70  :param include_p
+00028a50: 6172 656e 745f 6b65 795f 636f 6c75 6d6e  arent_key_column
+00028a60: 5f69 6e5f 656c 656d 656e 743a 2049 6620  _in_element: If 
+00028a70: 7365 7420 746f 2066 616c 7365 2074 6865  set to false the
+00028a80: 2070 6172 656e 745f 6b65 795f 636f 6c75   parent_key_colu
+00028a90: 6d6e 2077 696c 6c20 6265 206f 6e6c 7920  mn will be only 
+00028aa0: 7573 6564 2074 6f20 6372 6561 7465 2074  used to create t
+00028ab0: 6865 206e 6f6d 696e 6174 6564 2073 7472  he nominated str
+00028ac0: 7563 7475 7265 2e20 4966 2073 6574 2074  ucture. If set t
+00028ad0: 6f20 5472 7565 2c20 7468 6520 7061 7265  o True, the pare
+00028ae0: 6e74 206b 6579 2063 6f6c 756d 6e20 7769  nt key column wi
+00028af0: 6c6c 2062 6520 616c 736f 2073 6176 6564  ll be also saved
+00028b00: 2061 7320 6120 6669 656c 6420 696e 2074   as a field in t
+00028b10: 6865 2045 6c65 6d65 6e74 0d0a 2020 2020  he Element..    
+00028b20: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
+00028b30: 2023 534e 0d0a 2020 2020 2020 2020 234c   #SN..        #L
+00028b40: 4e0d 0a20 2020 2020 2020 2023 5048 5953  N..        #PHYS
+00028b50: 4944 0d0a 0d0a 2020 2020 2020 2020 7365  ID....        se
+00028b60: 6c66 2e65 6c65 6d65 6e74 732e 6d65 7267  lf.elements.merg
+00028b70: 6528 736f 7572 6365 203d 2064 6174 6166  e(source = dataf
+00028b80: 7261 6d65 2c20 6b65 7973 203d 2070 7269  rame, keys = pri
+00028b90: 6d61 7279 5f6b 6579 5f63 6f6c 756d 6e73  mary_key_columns
+00028ba0: 290d 0a0d 0a0d 0a20 2020 2020 2020 2023  )......        #
+00028bb0: 4966 2077 6520 6172 6520 6d61 6b69 6e67  If we are making
+00028bc0: 2074 6865 2073 7472 7563 7475 7265 2c20   the structure, 
+00028bd0: 6a6f 696e 2069 6e20 7468 6520 7365 6e74  join in the sent
+00028be0: 2069 6e20 6461 7461 6672 616d 6520 746f   in dataframe to
+00028bf0: 2074 6865 2064 6174 6166 7261 6d65 2069   the dataframe i
+00028c00: 6d70 6f72 7465 6420 6672 6f6d 2045 6d70  mported from Emp
+00028c10: 6f77 6572 2c20 746f 2067 6574 2074 6865  ower, to get the
+00028c20: 2063 616e 6f6e 6963 616c 2045 6d70 6f77   canonical Empow
+00028c30: 6572 2073 686f 7274 6e61 6d65 730d 0a20  er shortnames.. 
+00028c40: 2020 2020 2020 2023 4a6f 696e 206f 6e20         #Join on 
+00028c50: 7468 6520 4b65 7920 4669 656c 6420 7765  the Key Field we
+00028c60: 2070 7265 7669 6f75 736c 7920 7573 6564   previously used
+00028c70: 0d0a 2020 2020 2020 2020 6966 2073 7472  ..        if str
+00028c80: 7563 7475 7265 5f73 686f 7274 6e61 6d65  ucture_shortname
+00028c90: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+00028ca0: 2020 2020 2020 2020 2020 2069 6620 6465             if de
+00028cb0: 6475 706c 6963 6174 6520 6973 204e 6f6e  duplicate is Non
+00028cc0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00028cd0: 2020 2020 2357 6520 7769 6c6c 2068 6176      #We will hav
+00028ce0: 6520 636f 7069 6564 2061 6c72 6561 6479  e copied already
+00028cf0: 2069 6620 6465 6475 706c 6963 6174 6520   if deduplicate 
+00028d00: 7761 7320 7365 7420 2d20 6f74 6865 7277  was set - otherw
+00028d10: 6973 6520 7765 206e 6565 6420 746f 2063  ise we need to c
+00028d20: 6f70 7920 666f 7220 7468 6520 6669 7273  opy for the firs
+00028d30: 7420 7469 6d65 0d0a 2020 2020 2020 2020  t time..        
+00028d40: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
+00028d50: 6520 3d20 6461 7461 6672 616d 655b 7072  e = dataframe[pr
+00028d60: 696d 6172 795f 6b65 795f 636f 6c75 6d6e  imary_key_column
+00028d70: 732b 5b70 6172 656e 745f 6b65 795f 636f  s+[parent_key_co
+00028d80: 6c75 6d6e 5d5d 2e63 6f70 7928 290d 0a20  lumn]].copy().. 
+00028d90: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00028da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00028db0: 2020 6461 7461 6672 616d 6520 3d20 6461    dataframe = da
+00028dc0: 7461 6672 616d 655b 7072 696d 6172 795f  taframe[primary_
+00028dd0: 6b65 795f 636f 6c75 6d6e 732b 5b70 6172  key_columns+[par
+00028de0: 656e 745f 6b65 795f 636f 6c75 6d6e 5d5d  ent_key_column]]
+00028df0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00028e00: 6368 696c 645f 7061 7265 6e74 5f64 6174  child_parent_dat
+00028e10: 6166 7261 6d65 203d 2070 642e 6d65 7267  aframe = pd.merg
+00028e20: 6528 686f 7720 2020 3d20 2769 6e6e 6572  e(how   = 'inner
+00028e30: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
+00028e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028e60: 2c6c 6566 7420 203d 2073 656c 662e 656c  ,left  = self.el
+00028e70: 656d 656e 7473 2e64 6174 6166 7261 6d65  ements.dataframe
+00028e80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00028e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028ea0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+00028eb0: 7269 6768 7420 3d20 6461 7461 6672 616d  right = datafram
+00028ec0: 652e 7265 6e61 6d65 2863 6f6c 756d 6e73  e.rename(columns
+00028ed0: 203d 207b 2070 6172 656e 745f 6b65 795f   = { parent_key_
+00028ee0: 636f 6c75 6d6e 203a 2027 5061 7265 6e74  column : 'Parent
+00028ef0: 2053 686f 7274 204e 616d 6527 207d 290d   Short Name' }).
+00028f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00028f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f20: 2020 2020 2020 2020 2020 2020 2020 2c6f                ,o
+00028f30: 6e20 2020 203d 2070 7269 6d61 7279 5f6b  n    = primary_k
+00028f40: 6579 5f63 6f6c 756d 6e73 0d0a 2020 2020  ey_columns..    
+00028f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028f70: 2020 2020 2020 2020 2029 0d0a 0d0a 2020           )....  
+00028f80: 2020 2020 2020 2020 2020 7365 6c66 2e6d            self.m
+00028f90: 616b 655f 7374 7275 6374 7572 655f 6672  ake_structure_fr
+00028fa0: 6f6d 5f64 6174 6166 7261 6d65 2864 6174  om_dataframe(dat
+00028fb0: 6166 7261 6d65 2020 2020 2020 2020 2020  aframe          
+00028fc0: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
+00028fd0: 6368 696c 645f 7061 7265 6e74 5f64 6174  child_parent_dat
+00028fe0: 6166 7261 6d65 0d0a 2020 2020 2020 2020  aframe..        
+00028ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029010: 2020 2020 2020 2c73 7472 7563 7475 7265        ,structure
+00029020: 5f73 686f 7274 6e61 6d65 2020 2020 2020  _shortname      
+00029030: 2020 2020 2020 2020 3d20 7374 7275 6374          = struct
+00029040: 7572 655f 7368 6f72 746e 616d 650d 0a20  ure_shortname.. 
+00029050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029070: 2020 2020 2020 2020 2020 2020 202c 7374               ,st
+00029080: 7275 6374 7572 655f 726f 6f74 5f65 6c65  ructure_root_ele
+00029090: 6d65 6e74 5f73 686f 7274 6e61 6d65 203d  ment_shortname =
+000290a0: 2073 7472 7563 7475 7265 5f72 6f6f 745f   structure_root_
+000290b0: 656c 656d 656e 745f 7368 6f72 746e 616d  element_shortnam
+000290c0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+000290d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000290e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000290f0: 202c 7061 7265 6e74 5f6b 6579 5f63 6f6c   ,parent_key_col
+00029100: 756d 6e20 2020 2020 2020 2020 2020 2020  umn             
+00029110: 2020 203d 2070 6172 656e 745f 6b65 795f     = parent_key_
+00029120: 636f 6c75 6d6e 0d0a 2020 2020 2020 2020  column..        
+00029130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029150: 2020 2020 2020 2c70 6172 656e 745f 6b65        ,parent_ke
+00029160: 795f 6669 656c 645f 6e61 6d65 2020 2020  y_field_name    
+00029170: 2020 2020 2020 2020 3d20 7061 7265 6e74          = parent
+00029180: 5f6b 6579 5f66 6965 6c64 5f6e 616d 650d  _key_field_name.
+00029190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 000291a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000291b0: 2020 2020 203d 2073 796e 630d 0a20 2020       = sync..   
-000291c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000291b0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+000291c0: 7379 6e63 2020 2020 2020 2020 2020 2020  sync            
 000291d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000291e0: 2020 2020 2020 2020 2020 2029 0d0a 0d0a             )....
-000291f0: 2020 2020 6465 6620 6d61 6b65 5f73 7472      def make_str
-00029200: 7563 7475 7265 5f66 726f 6d5f 6461 7461  ucture_from_data
-00029210: 6672 616d 6528 7365 6c66 2c64 6174 6166  frame(self,dataf
-00029220: 7261 6d65 2c73 7472 7563 7475 7265 5f73  rame,structure_s
-00029230: 686f 7274 6e61 6d65 2c73 7472 7563 7475  hortname,structu
-00029240: 7265 5f72 6f6f 745f 656c 656d 656e 745f  re_root_element_
-00029250: 7368 6f72 746e 616d 653d 4e6f 6e65 2c70  shortname=None,p
-00029260: 6172 656e 745f 6b65 795f 636f 6c75 6d6e  arent_key_column
-00029270: 3d27 5061 7265 6e74 2053 686f 7274 204e  ='Parent Short N
-00029280: 616d 6527 2c70 6172 656e 745f 6b65 795f  ame',parent_key_
-00029290: 6669 656c 645f 6e61 6d65 3d27 5368 6f72  field_name='Shor
-000292a0: 7420 4e61 6d65 272c 7379 6e63 3d54 7275  t Name',sync=Tru
-000292b0: 6529 3a0d 0a20 2020 2020 2020 2027 2727  e):..        '''
-000292c0: 4d61 6b65 2061 2073 7472 7563 7475 7265  Make a structure
-000292d0: 2066 726f 6d20 6120 7061 6e64 6173 2044   from a pandas D
-000292e0: 6174 6166 7261 6d65 0d0a 2020 2020 2020  ataframe..      
-000292f0: 2020 636f 6c75 6d6e 7320 7368 6f75 6c64    columns should
-00029300: 2062 6520 5b27 5368 6f72 7420 4e61 6d65   be ['Short Name
-00029310: 275d 2061 6e64 2061 2070 6172 656e 7420  '] and a parent 
-00029320: 6b65 7920 636f 6c75 6d6e 2028 6465 6661  key column (defa
-00029330: 756c 7420 2750 6172 656e 7420 5368 6f72  ult 'Parent Shor
-00029340: 7420 4e61 6d65 2729 2e20 5468 6520 6b65  t Name'). The ke
-00029350: 7920 6669 656c 6420 6f66 2074 6865 2070  y field of the p
-00029360: 6172 656e 7420 7368 6f75 6c64 2062 6520  arent should be 
-00029370: 7370 6563 6966 6965 6420 2d20 6465 6661  specified - defa
-00029380: 756c 7420 6973 2027 5368 6f72 7420 4e61  ult is 'Short Na
-00029390: 6d65 270d 0a0d 0a20 2020 2020 2020 203a  me'....        :
-000293a0: 7061 7261 6d20 7374 7275 6374 7572 655f  param structure_
-000293b0: 726f 6f74 5f65 6c65 6d65 6e74 5f73 686f  root_element_sho
-000293c0: 7274 6e61 6d65 3a20 6f6e 6c79 206e 6565  rtname: only nee
-000293d0: 6473 2074 6f20 6265 2073 6574 2069 6620  ds to be set if 
-000293e0: 7468 6572 6520 6172 6520 6d75 6c74 6970  there are multip
-000293f0: 6c65 2072 6f6f 7420 656c 656d 656e 7473  le root elements
-00029400: 2069 6e20 7468 6520 7374 7275 6374 7572   in the structur
-00029410: 650d 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-00029420: 6d20 7061 7265 6e74 5f6b 6579 5f63 6f6c  m parent_key_col
-00029430: 756d 6e3a 2063 6f6c 756d 6e20 6e61 6d65  umn: column name
-00029440: 2028 696e 2064 6174 6166 7261 6d65 2920   (in dataframe) 
-00029450: 7768 6963 6820 7265 6665 7273 2074 6f20  which refers to 
-00029460: 7468 6520 7061 7265 6e74 0d0a 2020 2020  the parent..    
-00029470: 2020 2020 3a70 6172 616d 2070 6172 656e      :param paren
-00029480: 745f 6b65 795f 6669 656c 645f 6e61 6d65  t_key_field_name
-00029490: 3a20 7468 6520 6669 656c 6420 746f 2062  : the field to b
-000294a0: 6520 7573 6564 2028 696e 2074 6865 2070  e used (in the p
-000294b0: 6172 656e 7420 656c 656d 656e 7429 2077  arent element) w
-000294c0: 6865 6e20 6465 6369 6469 6e67 2077 6861  hen deciding wha
-000294d0: 7420 6973 2061 2075 6e69 7175 6520 656c  t is a unique el
-000294e0: 656d 656e 740d 0a20 2020 2020 2020 2027  ement..        '
-000294f0: 2727 0d0a 0d0a 2020 2020 2020 2020 7061  ''....        pa
-00029500: 7265 6e74 5f6b 6579 5f63 6f6c 756d 6e5f  rent_key_column_
-00029510: 6973 5f66 6f75 6e64 203d 2046 616c 7365  is_found = False
-00029520: 0d0a 2020 2020 2020 2020 7368 6f72 745f  ..        short_
-00029530: 6e61 6d65 5f63 6f6c 756d 6e5f 6973 5f66  name_column_is_f
+000291e0: 203d 2073 796e 630d 0a20 2020 2020 2020   = sync..       
+000291f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029210: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
+00029220: 6465 6620 6d61 6b65 5f73 7472 7563 7475  def make_structu
+00029230: 7265 5f66 726f 6d5f 6461 7461 6672 616d  re_from_datafram
+00029240: 6528 7365 6c66 2c64 6174 6166 7261 6d65  e(self,dataframe
+00029250: 2c73 7472 7563 7475 7265 5f73 686f 7274  ,structure_short
+00029260: 6e61 6d65 2c73 7472 7563 7475 7265 5f72  name,structure_r
+00029270: 6f6f 745f 656c 656d 656e 745f 7368 6f72  oot_element_shor
+00029280: 746e 616d 653d 4e6f 6e65 2c70 6172 656e  tname=None,paren
+00029290: 745f 6b65 795f 636f 6c75 6d6e 3d27 5061  t_key_column='Pa
+000292a0: 7265 6e74 2053 686f 7274 204e 616d 6527  rent Short Name'
+000292b0: 2c70 6172 656e 745f 6b65 795f 6669 656c  ,parent_key_fiel
+000292c0: 645f 6e61 6d65 3d27 5368 6f72 7420 4e61  d_name='Short Na
+000292d0: 6d65 272c 7379 6e63 3d54 7275 6529 3a0d  me',sync=True):.
+000292e0: 0a20 2020 2020 2020 2027 2727 4d61 6b65  .        '''Make
+000292f0: 2061 2073 7472 7563 7475 7265 2066 726f   a structure fro
+00029300: 6d20 6120 7061 6e64 6173 2044 6174 6166  m a pandas Dataf
+00029310: 7261 6d65 0d0a 2020 2020 2020 2020 636f  rame..        co
+00029320: 6c75 6d6e 7320 7368 6f75 6c64 2062 6520  lumns should be 
+00029330: 5b27 5368 6f72 7420 4e61 6d65 275d 2061  ['Short Name'] a
+00029340: 6e64 2061 2070 6172 656e 7420 6b65 7920  nd a parent key 
+00029350: 636f 6c75 6d6e 2028 6465 6661 756c 7420  column (default 
+00029360: 2750 6172 656e 7420 5368 6f72 7420 4e61  'Parent Short Na
+00029370: 6d65 2729 2e20 5468 6520 6b65 7920 6669  me'). The key fi
+00029380: 656c 6420 6f66 2074 6865 2070 6172 656e  eld of the paren
+00029390: 7420 7368 6f75 6c64 2062 6520 7370 6563  t should be spec
+000293a0: 6966 6965 6420 2d20 6465 6661 756c 7420  ified - default 
+000293b0: 6973 2027 5368 6f72 7420 4e61 6d65 270d  is 'Short Name'.
+000293c0: 0a0d 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+000293d0: 6d20 7374 7275 6374 7572 655f 726f 6f74  m structure_root
+000293e0: 5f65 6c65 6d65 6e74 5f73 686f 7274 6e61  _element_shortna
+000293f0: 6d65 3a20 6f6e 6c79 206e 6565 6473 2074  me: only needs t
+00029400: 6f20 6265 2073 6574 2069 6620 7468 6572  o be set if ther
+00029410: 6520 6172 6520 6d75 6c74 6970 6c65 2072  e are multiple r
+00029420: 6f6f 7420 656c 656d 656e 7473 2069 6e20  oot elements in 
+00029430: 7468 6520 7374 7275 6374 7572 650d 0a20  the structure.. 
+00029440: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+00029450: 7265 6e74 5f6b 6579 5f63 6f6c 756d 6e3a  rent_key_column:
+00029460: 2063 6f6c 756d 6e20 6e61 6d65 2028 696e   column name (in
+00029470: 2064 6174 6166 7261 6d65 2920 7768 6963   dataframe) whic
+00029480: 6820 7265 6665 7273 2074 6f20 7468 6520  h refers to the 
+00029490: 7061 7265 6e74 0d0a 2020 2020 2020 2020  parent..        
+000294a0: 3a70 6172 616d 2070 6172 656e 745f 6b65  :param parent_ke
+000294b0: 795f 6669 656c 645f 6e61 6d65 3a20 7468  y_field_name: th
+000294c0: 6520 6669 656c 6420 746f 2062 6520 7573  e field to be us
+000294d0: 6564 2028 696e 2074 6865 2070 6172 656e  ed (in the paren
+000294e0: 7420 656c 656d 656e 7429 2077 6865 6e20  t element) when 
+000294f0: 6465 6369 6469 6e67 2077 6861 7420 6973  deciding what is
+00029500: 2061 2075 6e69 7175 6520 656c 656d 656e   a unique elemen
+00029510: 740d 0a20 2020 2020 2020 2027 2727 0d0a  t..        '''..
+00029520: 0d0a 2020 2020 2020 2020 7061 7265 6e74  ..        parent
+00029530: 5f6b 6579 5f63 6f6c 756d 6e5f 6973 5f66  _key_column_is_f
 00029540: 6f75 6e64 203d 2046 616c 7365 0d0a 2020  ound = False..  
-00029550: 2020 2020 2020 666f 7220 6320 696e 2064        for c in d
-00029560: 6174 6166 7261 6d65 2e63 6f6c 756d 6e73  ataframe.columns
-00029570: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00029580: 6620 6320 3d3d 2070 6172 656e 745f 6b65  f c == parent_ke
-00029590: 795f 636f 6c75 6d6e 3a0d 0a20 2020 2020  y_column:..     
-000295a0: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-000295b0: 745f 6b65 795f 636f 6c75 6d6e 5f69 735f  t_key_column_is_
-000295c0: 666f 756e 6420 203d 2054 7275 650d 0a20  found  = True.. 
-000295d0: 2020 2020 2020 2020 2020 2069 6620 6320             if c 
-000295e0: 3d3d 2027 5368 6f72 7420 4e61 6d65 273a  == 'Short Name':
-000295f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00029600: 2020 7368 6f72 745f 6e61 6d65 5f63 6f6c    short_name_col
-00029610: 756d 6e5f 6973 5f66 6f75 6e64 203d 2054  umn_is_found = T
-00029620: 7275 650d 0a0d 0a20 2020 2020 2020 2069  rue....        i
-00029630: 6620 6e6f 7420 7368 6f72 745f 6e61 6d65  f not short_name
-00029640: 5f63 6f6c 756d 6e5f 6973 5f66 6f75 6e64  _column_is_found
-00029650: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00029660: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00029670: 276d 616b 655f 7374 7275 6374 7572 655f  'make_structure_
-00029680: 6672 6f6d 5f64 6174 6166 7261 6d65 2829  from_dataframe()
-00029690: 3a20 5468 6520 6461 7461 6672 616d 6520  : The dataframe 
-000296a0: 7061 7261 6d65 7465 7220 6d75 7374 2063  parameter must c
-000296b0: 6f6e 7461 696e 2061 2064 6174 6166 7261  ontain a datafra
-000296c0: 6d65 2077 6974 6820 6120 2253 686f 7274  me with a "Short
-000296d0: 204e 616d 6522 2063 6f6c 756d 6e2e 2043   Name" column. C
-000296e0: 6f6c 756d 6e73 2069 6e20 7468 6520 6461  olumns in the da
-000296f0: 7461 6672 616d 6520 6172 653a 2027 2b73  taframe are: '+s
-00029700: 7472 2864 6174 6166 7261 6d65 2e63 6f6c  tr(dataframe.col
-00029710: 756d 6e73 2929 0d0a 0d0a 2020 2020 2020  umns))....      
-00029720: 2020 6966 206e 6f74 2070 6172 656e 745f    if not parent_
-00029730: 6b65 795f 636f 6c75 6d6e 5f69 735f 666f  key_column_is_fo
-00029740: 756e 643a 0d0a 2020 2020 2020 2020 2020  und:..          
-00029750: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00029760: 6f72 2827 6d61 6b65 5f73 7472 7563 7475  or('make_structu
-00029770: 7265 5f66 726f 6d5f 6461 7461 6672 616d  re_from_datafram
-00029780: 6528 293a 2054 6865 2064 6174 6166 7261  e(): The datafra
-00029790: 6d65 2070 6172 616d 6574 6572 206d 7573  me parameter mus
-000297a0: 7420 636f 6e74 6169 6e20 6120 6461 7461  t contain a data
-000297b0: 6672 616d 6520 7769 7468 2061 2022 272b  frame with a "'+
-000297c0: 7061 7265 6e74 5f6b 6579 5f63 6f6c 756d  parent_key_colum
-000297d0: 6e2b 2722 2063 6f6c 756d 6e2e 2043 6f6c  n+'" column. Col
-000297e0: 756d 6e73 2069 6e20 7468 6520 6461 7461  umns in the data
-000297f0: 6672 616d 6520 6172 653a 2027 2b73 7472  frame are: '+str
-00029800: 2864 6174 6166 7261 6d65 2e63 6f6c 756d  (dataframe.colum
-00029810: 6e73 292b 275c 6e27 2b27 456e 7375 7265  ns)+'\n'+'Ensure
-00029820: 2074 6869 7320 636f 6c75 6d6e 2069 7320   this column is 
-00029830: 696e 2074 6865 2064 6174 6166 7261 6d65  in the dataframe
-00029840: 206f 7220 7365 7420 7468 6520 7061 7265   or set the pare
-00029850: 6e74 5f6b 6579 5f63 6f6c 756d 6e20 7061  nt_key_column pa
-00029860: 7261 6d65 7465 7220 746f 2061 2063 6f6c  rameter to a col
-00029870: 756d 6e20 7468 6174 2069 7320 696e 2074  umn that is in t
-00029880: 6865 2064 6174 6166 7261 6d65 2c20 616e  he dataframe, an
-00029890: 6420 6465 6e6f 7465 7320 7468 6520 7061  d denotes the pa
-000298a0: 7265 6e74 206b 6579 2729 0d0a 0d0a 2020  rent key')....  
-000298b0: 2020 2020 2020 2350 6172 656e 7473 2061        #Parents a
-000298c0: 7265 206e 6f74 2061 6c77 6179 7320 6465  re not always de
-000298d0: 6e6f 7465 6420 6279 2074 6865 6972 2073  noted by their s
-000298e0: 686f 7274 6e61 6d65 2028 6166 7465 7220  hortname (after 
-000298f0: 616c 6c20 7765 206d 6179 206e 6f74 2068  all we may not h
-00029900: 6176 6520 6b6e 6f77 6e20 6974 2061 7420  ave known it at 
-00029910: 7468 6520 706f 696e 7420 7468 6520 6f72  the point the or
-00029920: 6967 696e 616c 2064 6174 6166 7261 6d65  iginal dataframe
-00029930: 2077 6173 2070 6173 7365 6420 696e 0d0a   was passed in..
-00029940: 2020 2020 2020 2020 7061 7265 6e74 5f6c          parent_l
-00029950: 6f6f 6b75 7020 3d20 7b65 6c2e 6669 656c  ookup = {el.fiel
-00029960: 6473 5b70 6172 656e 745f 6b65 795f 6669  ds[parent_key_fi
-00029970: 656c 645f 6e61 6d65 5d3a 656c 2e73 686f  eld_name]:el.sho
-00029980: 7274 6e61 6d65 2066 6f72 2065 6c20 696e  rtname for el in
-00029990: 2073 656c 662e 656c 656d 656e 7473 2e76   self.elements.v
-000299a0: 616c 7565 7328 297d 0d0a 0d0a 2020 2020  alues()}....    
-000299b0: 2020 2020 2347 6574 2074 6865 2073 7472      #Get the str
-000299c0: 7563 7475 7265 202d 2077 6527 6c6c 2075  ucture - we'll u
-000299d0: 7064 6174 6520 6974 0d0a 2020 2020 2020  pdate it..      
-000299e0: 2020 7374 7275 6374 7572 6520 3d20 7365    structure = se
-000299f0: 6c66 2e73 7472 7563 7475 7265 735b 7374  lf.structures[st
-00029a00: 7275 6374 7572 655f 7368 6f72 746e 616d  ructure_shortnam
-00029a10: 655d 0d0a 0d0a 2020 2020 2020 2020 6966  e]....        if
-00029a20: 2073 7472 7563 7475 7265 2069 7320 4e6f   structure is No
-00029a30: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00029a40: 2072 6169 7365 204b 6579 4572 726f 7228   raise KeyError(
-00029a50: 2754 6865 7265 2069 7320 6e6f 2073 7472  'There is no str
-00029a60: 7563 7475 7265 2077 6974 6820 7368 6f72  ucture with shor
-00029a70: 746e 616d 6520 2227 2b73 7472 7563 7475  tname "'+structu
-00029a80: 7265 5f73 686f 7274 6e61 6d65 2b27 2220  re_shortname+'" 
-00029a90: 696e 2064 696d 656e 7369 6f6e 2729 0d0a  in dimension')..
-00029aa0: 0d0a 2020 2020 2020 2020 2343 6869 6c64  ..        #Child
-00029ab0: 2073 686f 7274 636f 6465 2074 6f20 7061   shortcode to pa
-00029ac0: 7265 6e74 2073 686f 7274 636f 6465 206c  rent shortcode l
-00029ad0: 6f6f 6b75 700d 0a20 2020 2020 2020 2063  ookup..        c
-00029ae0: 6869 6c64 5f70 6172 656e 7473 3d7b 7d0d  hild_parents={}.
-00029af0: 0a0d 0a20 2020 2020 2020 2066 6f72 2064  ...        for d
-00029b00: 2069 6e20 6461 7461 6672 616d 655b 5b27   in dataframe[['
-00029b10: 5368 6f72 7420 4e61 6d65 272c 7061 7265  Short Name',pare
-00029b20: 6e74 5f6b 6579 5f63 6f6c 756d 6e5d 5d2e  nt_key_column]].
-00029b30: 6974 6572 7475 706c 6573 2869 6e64 6578  itertuples(index
-00029b40: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
-00029b50: 2020 2020 2020 2346 6f72 2073 6f6d 6520        #For some 
-00029b60: 7265 6173 6f6e 2069 7465 7274 7570 6c65  reason itertuple
-00029b70: 7320 6973 6e27 7420 636f 6d69 6e67 2062  s isn't coming b
-00029b80: 6163 6b20 7769 7468 2074 6865 2063 6f6c  ack with the col
-00029b90: 756d 6e20 6e61 6d65 7320 2d20 6372 6561  umn names - crea
-00029ba0: 7465 2061 2064 6963 7469 6f6e 6172 7920  te a dictionary 
-00029bb0: 7573 696e 6720 7468 6520 6f72 6967 696e  using the origin
-00029bc0: 616c 2063 6f6c 756d 6e20 616e 6d65 7320  al column anmes 
-00029bd0: 6f66 2074 6865 2064 6963 7469 6f6e 6172  of the dictionar
-00029be0: 790d 0a20 2020 2020 2020 2020 2020 2063  y..            c
-00029bf0: 6869 6c64 5f73 686f 7274 6e61 6d65 2020  hild_shortname  
-00029c00: 3d20 645b 305d 0d0a 0d0a 2020 2020 2020  = d[0]....      
-00029c10: 2020 2020 2020 6966 2064 5b31 5d20 6973        if d[1] is
-00029c20: 206e 6f74 204e 6f6e 6520 616e 6420 645b   not None and d[
-00029c30: 315d 2021 3d20 2727 3a0d 0a20 2020 2020  1] != '':..     
-00029c40: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-00029c50: 745f 7368 6f72 746e 616d 6520 3d20 7061  t_shortname = pa
-00029c60: 7265 6e74 5f6c 6f6f 6b75 705b 645b 315d  rent_lookup[d[1]
-00029c70: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-00029c80: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00029c90: 2020 2020 2020 2020 2020 2020 2070 6172               par
-00029ca0: 656e 745f 656c 656d 656e 7473 203d 2073  ent_elements = s
-00029cb0: 7472 7563 7475 7265 2e67 6574 5f65 6c65  tructure.get_ele
-00029cc0: 6d65 6e74 7328 7061 7265 6e74 5f73 686f  ments(parent_sho
-00029cd0: 7274 6e61 6d65 290d 0a20 2020 2020 2020  rtname)..       
-00029ce0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00029cf0: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
-00029d00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00029d10: 4765 7420 7468 6520 456c 656d 656e 740d  Get the Element.
-00029d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029d30: 2020 2020 2065 6c65 6d65 6e74 203d 2073       element = s
-00029d40: 656c 662e 656c 656d 656e 7473 5b70 6172  elf.elements[par
-00029d50: 656e 745f 7368 6f72 746e 616d 655d 0d0a  ent_shortname]..
-00029d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00029d70: 2020 2020 2343 7265 6174 6520 7468 6520      #Create the 
-00029d80: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-00029d90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00029da0: 2020 2020 2020 7374 7275 6374 7572 652e        structure.
-00029db0: 5f61 6464 5f65 6c65 6d65 6e74 2853 7472  _add_element(Str
-00029dc0: 7563 7475 7265 5f45 6c65 6d65 6e74 2865  ucture_Element(e
-00029dd0: 6c65 6d65 6e74 3d65 6c65 6d65 6e74 2929  lement=element))
-00029de0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00029df0: 2020 2020 2020 7061 7265 6e74 5f65 6c65        parent_ele
-00029e00: 6d65 6e74 7320 3d20 7374 7275 6374 7572  ments = structur
-00029e10: 652e 6765 745f 656c 656d 656e 7473 2870  e.get_elements(p
-00029e20: 6172 656e 745f 7368 6f72 746e 616d 6529  arent_shortname)
-00029e30: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00029e40: 2020 2020 7061 7265 6e74 5f65 6c65 6d65      parent_eleme
-00029e50: 6e74 203d 2070 6172 656e 745f 656c 656d  nt = parent_elem
-00029e60: 656e 7473 5b30 5d0d 0a0d 0a20 2020 2020  ents[0]....     
-00029e70: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00029e80: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00029e90: 7265 6e74 5f65 6c65 6d65 6e74 203d 204e  rent_element = N
-00029ea0: 6f6e 650d 0a0d 0a0d 0a20 2020 2020 2020  one......       
-00029eb0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00029ec0: 2020 2020 2020 2020 2020 2063 6869 6c64             child
-00029ed0: 5f65 6c65 6d65 6e74 7320 3d20 7374 7275  _elements = stru
-00029ee0: 6374 7572 652e 6765 745f 656c 656d 656e  cture.get_elemen
-00029ef0: 7473 2863 6869 6c64 5f73 686f 7274 6e61  ts(child_shortna
-00029f00: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
-00029f10: 2020 2020 2069 6620 6368 696c 645f 656c       if child_el
-00029f20: 656d 656e 7473 2069 7320 4e6f 6e65 206f  ements is None o
-00029f30: 7220 6368 696c 645f 656c 656d 656e 7473  r child_elements
-00029f40: 203d 3d20 5b5d 3a0d 0a20 2020 2020 2020   == []:..       
-00029f50: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
-00029f60: 6e64 5f63 6869 6c64 5f65 6c65 6d65 6e74  nd_child_element
-00029f70: 7320 3d20 4661 6c73 650d 0a20 2020 2020  s = False..     
-00029f80: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00029f90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00029fa0: 2020 2020 2020 666f 756e 645f 6368 696c        found_chil
-00029fb0: 645f 656c 656d 656e 7473 203d 2054 7275  d_elements = Tru
-00029fc0: 650d 0a20 2020 2020 2020 2020 2020 2065  e..            e
-00029fd0: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
-00029fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00029ff0: 2066 6f75 6e64 5f63 6869 6c64 5f65 6c65   found_child_ele
-0002a000: 6d65 6e74 7320 3d20 4661 6c73 650d 0a0d  ments = False...
-0002a010: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0002a020: 6e6f 7420 666f 756e 645f 6368 696c 645f  not found_child_
-0002a030: 656c 656d 656e 7473 3a0d 0a20 2020 2020  elements:..     
-0002a040: 2020 2020 2020 2020 2020 2023 4765 7420             #Get 
-0002a050: 7468 6520 456c 656d 656e 740d 0a20 2020  the Element..   
-0002a060: 2020 2020 2020 2020 2020 2020 2065 6c65               ele
-0002a070: 6d65 6e74 203d 2073 656c 662e 656c 656d  ment = self.elem
-0002a080: 656e 7473 5b63 6869 6c64 5f73 686f 7274  ents[child_short
-0002a090: 6e61 6d65 5d0d 0a20 2020 2020 2020 2020  name]..         
-0002a0a0: 2020 2020 2020 2023 4372 6561 7465 2074         #Create t
-0002a0b0: 6865 2053 7472 7563 7475 7265 456c 656d  he StructureElem
-0002a0c0: 656e 740d 0a20 2020 2020 2020 2020 2020  ent..           
-0002a0d0: 2020 2020 2073 7472 7563 7475 7265 2e5f       structure._
-0002a0e0: 6164 645f 656c 656d 656e 7428 5374 7275  add_element(Stru
-0002a0f0: 6374 7572 6545 6c65 6d65 6e74 2865 6c65  ctureElement(ele
-0002a100: 6d65 6e74 3d65 6c65 6d65 6e74 2929 0d0a  ment=element))..
-0002a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a120: 6368 696c 645f 656c 656d 656e 7473 203d  child_elements =
-0002a130: 2073 7472 7563 7475 7265 2e67 6574 5f65   structure.get_e
-0002a140: 6c65 6d65 6e74 7328 6368 696c 645f 7368  lements(child_sh
-0002a150: 6f72 746e 616d 6529 0d0a 0d0a 2020 2020  ortname)....    
-0002a160: 2020 2020 2020 2020 6966 2070 6172 656e          if paren
-0002a170: 745f 656c 656d 656e 7420 6973 206e 6f74  t_element is not
-0002a180: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0002a190: 2020 2020 2020 2020 7374 7275 6374 7572          structur
-0002a1a0: 652e 7365 745f 6368 696c 645f 656c 656d  e.set_child_elem
-0002a1b0: 656e 745f 7061 7265 6e74 2863 6869 6c64  ent_parent(child
-0002a1c0: 203d 2063 6869 6c64 5f65 6c65 6d65 6e74   = child_element
-0002a1d0: 735b 305d 2c20 7061 7265 6e74 203d 2070  s[0], parent = p
-0002a1e0: 6172 656e 745f 656c 656d 656e 7429 0d0a  arent_element)..
-0002a1f0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0002a200: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0002a210: 2020 2073 7472 7563 7475 7265 2e73 6574     structure.set
-0002a220: 5f72 6f6f 745f 656c 656d 656e 7428 6368  _root_element(ch
-0002a230: 696c 645f 656c 656d 656e 7473 5b30 5d29  ild_elements[0])
-0002a240: 0d0a 0d0a 2020 2020 2020 2020 6966 2073  ....        if s
-0002a250: 796e 633a 0d0a 2020 2020 2020 2020 2020  ync:..          
-0002a260: 2020 7374 7275 6374 7572 652e 7379 6e63    structure.sync
-0002a270: 6872 6f6e 6973 6528 290d 0a0d 0a20 2020  hronise()....   
-0002a280: 2064 6566 2073 796e 6368 726f 6e69 7365   def synchronise
-0002a290: 2873 656c 662c 7265 6578 706f 7274 3d54  (self,reexport=T
-0002a2a0: 7275 652c 7265 696d 706f 7274 3d46 616c  rue,reimport=Fal
-0002a2b0: 7365 2c70 7269 6d61 7279 5f6b 6579 5f66  se,primary_key_f
-0002a2c0: 6965 6c64 733d 5b27 5368 6f72 7420 4e61  ields=['Short Na
-0002a2d0: 6d65 275d 293a 0d0a 2020 2020 2020 2020  me']):..        
-0002a2e0: 2727 2753 796e 6368 726f 6e69 7365 2074  '''Synchronise t
-0002a2f0: 6865 2045 6c65 6d65 6e74 7320 696e 2074  he Elements in t
-0002a300: 6865 2044 696d 656e 7369 6f6e 2077 6974  he Dimension wit
-0002a310: 6820 7468 6520 456d 706f 7765 7220 5369  h the Empower Si
-0002a320: 7465 2e0d 0a0d 0a20 2020 2020 2020 204e  te.....        N
-0002a330: 6577 2065 6c65 6d65 6e74 7320 7769 6c6c  ew elements will
-0002a340: 2062 6520 6372 6561 7465 6420 696e 2045   be created in E
-0002a350: 6d70 6f77 6572 2061 6e64 2063 6861 6e67  mpower and chang
-0002a360: 6564 2066 6965 6c64 2076 616c 7565 7320  ed field values 
-0002a370: 7769 6c6c 2062 6520 7570 6461 7465 6420  will be updated 
-0002a380: 696e 2074 6865 2045 6d70 6f77 6572 2053  in the Empower S
-0002a390: 6974 650d 0a20 2020 2020 2020 2027 2727  ite..        '''
-0002a3a0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-0002a3b0: 2e65 6c65 6d65 6e74 732e 7379 6e63 6872  .elements.synchr
-0002a3c0: 6f6e 6973 6528 7265 6578 706f 7274 3d72  onise(reexport=r
-0002a3d0: 6565 7870 6f72 742c 7265 696d 706f 7274  eexport,reimport
-0002a3e0: 3d72 6569 6d70 6f72 742c 7072 696d 6172  =reimport,primar
-0002a3f0: 795f 6b65 795f 6669 656c 6473 3d70 7269  y_key_fields=pri
-0002a400: 6d61 7279 5f6b 6579 5f66 6965 6c64 7329  mary_key_fields)
-0002a410: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-0002a420: 790d 0a20 2020 2064 6566 2065 6c65 6d65  y..    def eleme
-0002a430: 6e74 5f64 6174 6166 7261 6d65 2873 656c  nt_dataframe(sel
-0002a440: 6629 3a0d 0a20 2020 2020 2020 2072 6169  f):..        rai
-0002a450: 7365 2053 7973 7465 6d45 7272 6f72 2827  se SystemError('
-0002a460: 5468 6973 2070 726f 7065 7274 7920 6973  This property is
-0002a470: 2064 6570 7265 6361 7465 6420 2d20 7573   deprecated - us
-0002a480: 6520 4469 6d65 6e73 696f 6e2e 656c 656d  e Dimension.elem
-0002a490: 656e 7473 2e64 6174 6166 7261 6d65 2069  ents.dataframe i
-0002a4a0: 6e73 7465 6164 2729 0d0a 0d0a 0d0a 2020  nstead')......  
-0002a4b0: 2020 6465 6620 5f67 6574 5f73 696d 706c    def _get_simpl
-0002a4c0: 655f 7472 616e 736c 6174 696f 6e5f 6466  e_translation_df
-0002a4d0: 2873 656c 662c 6f75 7470 7574 5f63 6f6c  (self,output_col
-0002a4e0: 756d 6e5f 6e61 6d65 2c66 6965 6c64 5f73  umn_name,field_s
-0002a4f0: 686f 7274 6e61 6d65 293a 0d0a 2020 2020  hortname):..    
-0002a500: 2020 2020 6966 2066 6965 6c64 5f73 686f      if field_sho
-0002a510: 7274 6e61 6d65 2069 7320 4e6f 6e65 3a0d  rtname is None:.
-0002a520: 0a20 2020 2020 2020 2020 2020 2064 6620  .            df 
-0002a530: 3d20 7365 6c66 2e65 6c65 6d65 6e74 732e  = self.elements.
-0002a540: 6461 7461 6672 616d 655b 5b27 4944 272c  dataframe[['ID',
-0002a550: 2753 686f 7274 204e 616d 6527 2c27 4c6f  'Short Name','Lo
-0002a560: 6e67 204e 616d 6527 5d5d 2e63 6f70 7928  ng Name']].copy(
-0002a570: 290d 0a20 2020 2020 2020 2065 6c73 653a  )..        else:
-0002a580: 0d0a 2020 2020 2020 2020 2020 2020 6466  ..            df
-0002a590: 203d 2073 656c 662e 656c 656d 656e 7473   = self.elements
-0002a5a0: 2e64 6174 6166 7261 6d65 5b5b 2749 4427  .dataframe[['ID'
-0002a5b0: 2c27 5368 6f72 7420 4e61 6d65 272c 274c  ,'Short Name','L
-0002a5c0: 6f6e 6720 4e61 6d65 272c 6669 656c 645f  ong Name',field_
-0002a5d0: 7368 6f72 746e 616d 655d 5d2e 636f 7079  shortname]].copy
-0002a5e0: 2829 0d0a 0d0a 2020 2020 2020 2020 6466  ()....        df
-0002a5f0: 2e72 656e 616d 6528 636f 6c75 6d6e 733d  .rename(columns=
-0002a600: 7b63 6f6c 3a27 4c4b 5550 2027 2b63 6f6c  {col:'LKUP '+col
-0002a610: 2066 6f72 2063 6f6c 2069 6e20 6466 2e63   for col in df.c
-0002a620: 6f6c 756d 6e73 7d2c 696e 706c 6163 653d  olumns},inplace=
-0002a630: 5472 7565 290d 0a20 2020 2020 2020 2064  True)..        d
-0002a640: 665b 6f75 7470 7574 5f63 6f6c 756d 6e5f  f[output_column_
-0002a650: 6e61 6d65 5d3d 6466 5b27 4c4b 5550 2049  name]=df['LKUP I
-0002a660: 4427 5d0d 0a20 2020 2020 2020 2072 6574  D']..        ret
-0002a670: 7572 6e20 6466 0d0a 0d0a 2020 2020 6465  urn df....    de
-0002a680: 6620 5f6c 6f61 645f 7365 6375 7269 7479  f _load_security
-0002a690: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0002a6a0: 2023 5468 6520 5f45 6c65 6d65 6e74 7347   #The _ElementsG
-0002a6b0: 6574 7465 7220 6465 7465 726d 696e 6573  etter determines
-0002a6c0: 2069 6620 7365 6375 7269 7479 2069 7320   if security is 
-0002a6d0: 7265 6164 0d0a 2020 2020 2020 2020 7365  read..        se
-0002a6e0: 6c66 2e65 6c65 6d65 6e74 732e 5f6c 6f61  lf.elements._loa
-0002a6f0: 645f 7365 6375 7269 7479 2829 0d0a 0d0a  d_security()....
-0002a700: 636c 6173 7320 456c 656d 656e 7428 6f62  class Element(ob
-0002a710: 6a65 6374 293a 0d0a 2020 2020 2727 2741  ject):..    '''A
-0002a720: 6e20 456d 706f 7765 7220 456c 656d 656e  n Empower Elemen
-0002a730: 742e 2054 6865 2045 6c65 6d65 6e74 2069  t. The Element i
-0002a740: 7320 6173 2077 6f75 6c64 2062 6520 666f  s as would be fo
-0002a750: 756e 6420 6f6e 2074 6865 205b 416c 6c5d  und on the [All]
-0002a760: 2053 7472 7563 7475 7265 2069 6e20 456d   Structure in Em
-0002a770: 706f 7765 722e 0d0a 0d0a 2020 2020 456c  power.....    El
-0002a780: 656d 656e 7427 7320 646f 6e27 7420 6861  ement's don't ha
-0002a790: 7665 2070 6172 656e 7473 206f 7220 6368  ve parents or ch
-0002a7a0: 696c 6472 656e 202d 2074 6861 7420 6973  ildren - that is
-0002a7b0: 2077 6861 7420 6120 5374 7275 6374 7572   what a Structur
-0002a7c0: 6545 6c65 6d65 6e74 2068 6173 2e0d 0a20  eElement has... 
-0002a7d0: 2020 2027 2727 0d0a 2020 2020 6465 6620     '''..    def 
-0002a7e0: 5f5f 696e 6974 5f5f 2873 656c 660d 0a20  __init__(self.. 
-0002a7f0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-0002a800: 7368 6f72 746e 616d 653d 4e6f 6e65 0d0a  shortname=None..
-0002a810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a820: 2c6c 6f6e 676e 616d 653d 4e6f 6e65 0d0a  ,longname=None..
-0002a830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a840: 2c64 6573 6372 6970 7469 6f6e 3d4e 6f6e  ,description=Non
-0002a850: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0002a860: 2020 202c 7068 7973 6964 3d4e 6f6e 650d     ,physid=None.
-0002a870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002a880: 202c 6772 6f75 705f 6f6e 6c79 3d4e 6f6e   ,group_only=Non
-0002a890: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0002a8a0: 2020 202c 6361 6c63 756c 6174 696f 6e5f     ,calculation_
-0002a8b0: 7374 6174 7573 3d4e 6f6e 650d 0a20 2020  status=None..   
-0002a8c0: 2020 2020 2020 2020 2020 2020 202c 6361               ,ca
-0002a8d0: 6c63 756c 6174 696f 6e3d 4e6f 6e65 0d0a  lculation=None..
-0002a8e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002a8f0: 2c63 6f6c 6f75 723d 4e6f 6e65 0d0a 2020  ,colour=None..  
-0002a900: 2020 2020 2020 2020 2020 2020 2020 2c6d                ,m
-0002a910: 6561 7375 7265 3d4e 6f6e 650d 0a20 2020  easure=None..   
-0002a920: 2020 2020 2020 2020 2020 2020 202c 6669               ,fi
-0002a930: 656c 6473 3d4e 6f6e 650d 0a20 2020 2020  elds=None..     
-0002a940: 2020 2020 2020 2020 2020 202c 6f76 6572             ,over
-0002a950: 7269 6465 5f73 686f 7274 6e61 6d65 5f6c  ride_shortname_l
-0002a960: 656e 6774 685f 7275 6c65 203d 2046 616c  ength_rule = Fal
-0002a970: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
-0002a980: 2020 2020 2c64 696d 656e 7369 6f6e 203d      ,dimension =
-0002a990: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-0002a9a0: 2020 2020 2020 2029 3a0d 0a20 2020 2020         ):..     
-0002a9b0: 2020 2027 2727 4372 6561 7465 2061 206e     '''Create a n
-0002a9c0: 6577 2045 6d70 6f77 6572 2045 6c65 6d65  ew Empower Eleme
-0002a9d0: 6e74 2e0d 0a0d 0a20 2020 2020 2020 203a  nt.....        :
-0002a9e0: 7061 7261 6d20 7368 6f72 746e 616d 653a  param shortname:
-0002a9f0: 2041 2074 656e 2d63 6861 7261 6374 6572   A ten-character
-0002aa00: 2028 6f72 2073 686f 7274 6572 2920 7374   (or shorter) st
-0002aa10: 7269 6e67 2077 6974 6820 7468 6520 7368  ring with the sh
-0002aa20: 6f72 746e 616d 6520 666f 7220 7468 6520  ortname for the 
-0002aa30: 456c 656d 656e 742e 2049 6620 7468 6973  Element. If this
-0002aa40: 2069 7320 6e6f 7420 7365 742c 2045 6d70   is not set, Emp
-0002aa50: 6f77 6572 2077 696c 6c20 6372 6561 7465  ower will create
-0002aa60: 206f 6e65 2077 6865 6e20 7468 6973 2045   one when this E
-0002aa70: 6c65 6d65 6e74 2069 7320 7379 6e63 6872  lement is synchr
-0002aa80: 6f6e 6973 6564 2e0d 0a20 2020 2020 2020  onised...       
-0002aa90: 203a 7061 7261 6d20 6c6f 6e67 6e61 6d65   :param longname
-0002aaa0: 3a20 5468 6520 6e61 6d65 206f 6620 7468  : The name of th
-0002aab0: 6520 456c 656d 656e 742c 2061 7320 7769  e Element, as wi
-0002aac0: 6c6c 2062 6520 6469 7370 6c61 7965 6420  ll be displayed 
-0002aad0: 696e 2064 6173 6862 6f61 7264 730d 0a20  in dashboards.. 
-0002aae0: 2020 2020 2020 203a 7061 7261 6d20 6465         :param de
-0002aaf0: 7363 7269 7074 696f 6e3a 2041 206c 6f6e  scription: A lon
-0002ab00: 6765 7220 6465 7363 7269 7074 696f 6e20  ger description 
-0002ab10: 6f66 2074 6865 2045 6c65 6d65 6e74 2c20  of the Element, 
-0002ab20: 6173 2073 746f 7265 6420 696e 2045 6d70  as stored in Emp
-0002ab30: 6f77 6572 0d0a 2020 2020 2020 2020 3a70  ower..        :p
-0002ab40: 6172 616d 2070 6879 7369 643a 2074 6865  aram physid: the
-0002ab50: 2070 6879 7369 6361 6c20 6964 656e 7469   physical identi
-0002ab60: 6669 6572 206f 6620 7468 6520 456d 706f  fier of the Empo
-0002ab70: 7765 7220 656c 656d 656e 7420 2d20 7468  wer element - th
-0002ab80: 6572 6520 6973 206e 6f20 6e65 6564 2074  ere is no need t
-0002ab90: 6f20 7365 7420 7468 6973 2c20 6173 2045  o set this, as E
-0002aba0: 6d70 6f77 6572 2077 696c 6c20 7365 7420  mpower will set 
-0002abb0: 6974 2061 7574 6f6d 6174 6963 616c 6c79  it automatically
-0002abc0: 2077 6865 6e20 7468 6973 2045 6c65 6d65   when this Eleme
-0002abd0: 6e74 2069 7320 7379 6e63 6872 6f6e 6973  nt is synchronis
-0002abe0: 6564 2e0d 0a20 2020 2020 2020 203a 7061  ed...        :pa
-0002abf0: 7261 6d20 6772 6f75 705f 6f6e 6c79 3a20  ram group_only: 
-0002ac00: 5365 7420 746f 2027 4772 6f75 7027 2069  Set to 'Group' i
-0002ac10: 6620 7468 6973 2069 7320 6120 6772 6f75  f this is a grou
-0002ac20: 702d 6f6e 6c79 2045 6c65 6d65 6e74 0d0a  p-only Element..
-0002ac30: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
-0002ac40: 616c 6375 6c61 7469 6f6e 5f73 7461 7475  alculation_statu
-0002ac50: 733a 2027 5265 616c 2720 6f72 2027 4361  s: 'Real' or 'Ca
-0002ac60: 6c63 756c 6174 6564 270d 0a20 2020 2020  lculated'..     
-0002ac70: 2020 203a 7061 7261 6d20 6361 6c63 756c     :param calcul
-0002ac80: 6174 696f 6e3a 2054 6865 2045 6d70 6f77  ation: The Empow
-0002ac90: 6572 2063 616c 6375 6c61 7469 6f6e 2066  er calculation f
-0002aca0: 6f72 2074 6869 7320 656c 656d 656e 742c  or this element,
-0002acb0: 2061 7320 6120 7374 7269 6e67 2e20 5468   as a string. Th
-0002acc0: 6973 2063 616e 2062 6520 4e6f 6e65 2066  is can be None f
-0002acd0: 6f72 206e 6f6e 2d63 616c 6375 6c61 7465  or non-calculate
-0002ace0: 6420 656c 656d 656e 7473 0d0a 2020 2020  d elements..    
-0002acf0: 2020 2020 3a70 6172 616d 2063 6f6c 6f75      :param colou
-0002ad00: 723a 2045 6d70 6f77 6572 2063 6f6c 6f75  r: Empower colou
-0002ad10: 7220 6f66 2074 6865 2045 6c65 6d65 6e74  r of the Element
-0002ad20: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0002ad30: 206d 6561 7375 7265 3a20 2045 6d70 6f77   measure:  Empow
-0002ad40: 6572 206d 6561 7375 7265 2066 6f72 2074  er measure for t
-0002ad50: 6865 2045 6c65 6d65 6e74 0d0a 2020 2020  he Element..    
-0002ad60: 2020 2020 3a70 6172 616d 2066 6965 6c64      :param field
-0002ad70: 733a 2041 2064 6963 7469 6f6e 6172 7920  s: A dictionary 
-0002ad80: 6f66 2066 6965 6c64 732e 204b 6579 7320  of fields. Keys 
-0002ad90: 6d75 7374 2062 6520 7468 6520 6669 656c  must be the fiel
-0002ada0: 6420 6c6f 6e67 6e61 6d65 2061 7320 7573  d longname as us
-0002adb0: 6564 2069 6e20 456d 706f 7765 722e 0d0a  ed in Empower...
-0002adc0: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-0002add0: 7665 7272 6964 655f 7368 6f72 746e 616d  verride_shortnam
-0002ade0: 655f 6c65 6e67 7468 5f72 756c 653a 2041  e_length_rule: A
-0002adf0: 6c6c 6f77 7320 656c 656d 656e 7473 2074  llows elements t
-0002ae00: 6f20 6265 2063 7265 6174 6564 2069 6e20  o be created in 
-0002ae10: 7079 7468 6f6e 2077 6974 6820 7368 6f72  python with shor
-0002ae20: 746e 616d 6573 206c 6f6e 6765 7220 7468  tnames longer th
-0002ae30: 616e 2031 3020 6368 6172 6163 7465 7273  an 10 characters
-0002ae40: 2e20 5468 6573 6520 7368 6f72 746e 616d  . These shortnam
-0002ae50: 6573 2077 696c 6c20 6265 206f 7665 7277  es will be overw
-0002ae60: 7269 7474 656e 2062 7920 456d 706f 7765  ritten by Empowe
-0002ae70: 7220 7768 656e 2074 6865 2065 6c65 6d65  r when the eleme
-0002ae80: 6e74 7320 6172 6520 7379 6e63 6872 6f6e  nts are synchron
-0002ae90: 6973 6564 2077 6974 6820 456d 706f 7765  ised with Empowe
-0002aea0: 722e 0d0a 2020 2020 2020 2020 3a70 6172  r...        :par
-0002aeb0: 616d 2064 696d 656e 7369 6f6e 3a20 7079  am dimension: py
-0002aec0: 6d70 782e 4469 6d65 6e73 696f 6e20 6f62  mpx.Dimension ob
-0002aed0: 6a65 6374 2074 6861 7420 7468 6973 2065  ject that this e
-0002aee0: 6c65 6d65 6e74 2062 656c 6f6e 6773 2074  lement belongs t
-0002aef0: 6f0d 0a20 2020 2020 2020 2027 2727 0d0a  o..        '''..
-0002af00: 2020 2020 2020 2020 6966 2066 6965 6c64          if field
-0002af10: 7320 6973 204e 6f6e 653a 0d0a 2020 2020  s is None:..    
-0002af20: 2020 2020 2020 2020 6669 656c 6473 203d          fields =
-0002af30: 207b 7d0d 0a20 2020 2020 2020 200d 0a20   {}..        .. 
-0002af40: 2020 2020 2020 2069 6620 7368 6f72 746e         if shortn
-0002af50: 616d 6520 6973 206e 6f74 204e 6f6e 6520  ame is not None 
-0002af60: 616e 6420 6c65 6e28 7368 6f72 746e 616d  and len(shortnam
-0002af70: 6529 203e 206c 6c75 2e73 686f 7274 6e61  e) > llu.shortna
-0002af80: 6d65 5f73 697a 6520 616e 6420 6e6f 7420  me_size and not 
-0002af90: 6f76 6572 7269 6465 5f73 686f 7274 6e61  override_shortna
-0002afa0: 6d65 5f6c 656e 6774 685f 7275 6c65 3a0d  me_length_rule:.
-0002afb0: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
-0002afc0: 3d27 456c 656d 656e 7473 2073 686f 7274  ='Elements short
-0002afd0: 6e61 6d65 7320 6d75 7374 2062 6520 6e6f  names must be no
-0002afe0: 206c 6f6e 6765 7220 7468 616e 206e 6c69   longer than nli
-0002aff0: 6d69 7420 6368 6172 6163 7465 7273 2e20  mit characters. 
-0002b000: 5368 6f72 746e 616d 653a 272b 7374 7228  Shortname:'+str(
-0002b010: 7368 6f72 746e 616d 6529 2b27 2069 7320  shortname)+' is 
-0002b020: 272b 7374 7228 6c65 6e28 7368 6f72 746e  '+str(len(shortn
-0002b030: 616d 6529 292b 2720 6368 6172 6163 7465  ame))+' characte
-0002b040: 7273 206c 6f6e 6727 0d0a 2020 2020 2020  rs long'..      
-0002b050: 2020 2020 2020 6c6f 672e 6572 726f 7228        log.error(
-0002b060: 6d73 6729 0d0a 2020 2020 2020 2020 2020  msg)..          
-0002b070: 2020 7261 6973 6520 6d70 6578 2e43 6f6d    raise mpex.Com
-0002b080: 706c 6574 656c 794c 6f67 6765 6445 7272  pletelyLoggedErr
-0002b090: 6f72 286d 7367 290d 0a0d 0a20 2020 2020  or(msg)....     
-0002b0a0: 2020 2023 7365 7420 7068 7973 6964 2066     #set physid f
-0002b0b0: 6972 7374 2061 7320 6974 2069 7320 6472  irst as it is dr
-0002b0c0: 6976 6573 202e 6d61 7374 6572 6564 2061  ives .mastered a
-0002b0d0: 6e64 2073 6920 6e6f 7420 6120 6669 656c  nd si not a fiel
-0002b0e0: 640d 0a20 2020 2020 2020 2073 656c 662e  d..        self.
-0002b0f0: 7068 7973 6964 2020 2020 2020 2020 2020  physid          
-0002b100: 2020 203d 2070 6879 7369 640d 0a0d 0a20     = physid.... 
-0002b110: 2020 2020 2020 2023 4d75 7374 2073 6574         #Must set
-0002b120: 2064 696d 656e 7369 6f6e 2062 6566 6f72   dimension befor
-0002b130: 6520 6669 656c 6473 202d 206f 7220 7765  e fields - or we
-0002b140: 2063 616e 6e6f 7420 7365 7420 6669 656c   cannot set fiel
-0002b150: 6473 2063 6f72 7265 6374 6c79 0d0a 2020  ds correctly..  
-0002b160: 2020 2020 2020 7365 6c66 2e64 696d 656e        self.dimen
-0002b170: 7369 6f6e 203d 2064 696d 656e 7369 6f6e  sion = dimension
-0002b180: 0d0a 0d0a 2020 2020 2020 2020 2323 696e  ....        ##in
-0002b190: 6974 6961 6c69 7365 2074 6865 2066 6965  itialise the fie
-0002b1a0: 6c64 7320 6469 6374 696f 6e61 7279 0d0a  lds dictionary..
-0002b1b0: 2020 2020 2020 2020 2323 616e 7920 6b65          ##any ke
-0002b1c0: 7973 2072 656c 6174 6564 2074 6f20 7468  ys related to th
-0002b1d0: 6520 6174 7472 6962 7574 6573 206f 6620  e attributes of 
-0002b1e0: 456c 656d 656e 7420 7769 6c6c 2062 6520  Element will be 
-0002b1f0: 6f76 6572 7772 6974 7465 6e20 7768 656e  overwritten when
-0002b200: 2074 6865 2061 7474 7269 6275 7465 7320   the attributes 
-0002b210: 6172 6520 7365 740d 0a20 2020 2020 2020  are set..       
-0002b220: 2023 7072 696e 7428 2773 686f 7274 6e61   #print('shortna
-0002b230: 6d65 2027 2b73 7472 2873 686f 7274 6e61  me '+str(shortna
-0002b240: 6d65 292b 2720 7068 7973 6964 2027 2b73  me)+' physid '+s
-0002b250: 7472 2870 6879 7369 6429 2b20 2720 656c  tr(physid)+ ' el
-0002b260: 656d 656e 7420 272b 7374 7228 7365 6c66  ement '+str(self
-0002b270: 2929 0d0a 2020 2020 2020 2020 2369 6620  ))..        #if 
-0002b280: 7368 6f72 746e 616d 6520 6973 204e 6f6e  shortname is Non
-0002b290: 653a 0d0a 2020 2020 2020 2020 2320 2020  e:..        #   
-0002b2a0: 2072 6169 7365 2053 7973 7465 6d45 7272   raise SystemErr
-0002b2b0: 6f72 2829 0d0a 2020 2020 2020 2020 7365  or()..        se
-0002b2c0: 6c66 2e5f 6669 656c 6473 203d 205f 4669  lf._fields = _Fi
-0002b2d0: 656c 6473 4765 7474 6572 2873 656c 662c  eldsGetter(self,
-0002b2e0: 6669 656c 6473 2c69 6e69 7469 616c 6973  fields,initialis
-0002b2f0: 655f 6173 5f65 6469 7465 6420 3d20 7068  e_as_edited = ph
-0002b300: 7973 6964 2069 7320 4e6f 6e65 290d 0a0d  ysid is None)...
-0002b310: 0a20 2020 2020 2020 2023 5365 7420 7468  .        #Set th
-0002b320: 6520 696e 7465 726e 616c 2065 6c65 6d65  e internal eleme
-0002b330: 6e74 7320 2d20 7468 656e 2077 6520 6361  nts - then we ca
-0002b340: 6e20 7573 6520 7468 6520 7365 7474 6572  n use the setter
-0002b350: 7320 666f 7220 7468 6520 6578 7465 726e  s for the extern
-0002b360: 616c 6c79 2076 6973 6962 6c65 2076 6572  ally visible ver
-0002b370: 7369 6f6e 206f 6620 7468 6520 7361 6d65  sion of the same
-0002b380: 0d0a 2020 2020 2020 2020 2354 6869 7320  ..        #This 
-0002b390: 7761 7920 7765 2063 616e 206b 6565 7020  way we can keep 
-0002b3a0: 7468 6520 6669 656c 6473 2064 6963 7469  the fields dicti
-0002b3b0: 6f6e 6172 7920 696e 2073 796e 6320 7769  onary in sync wi
-0002b3c0: 7468 2074 6865 2069 6e74 6572 6e61 6c20  th the internal 
-0002b3d0: 656c 656d 656e 7473 0d0a 2020 2020 2020  elements..      
-0002b3e0: 2020 7365 6c66 2e5f 7368 6f72 746e 616d    self._shortnam
-0002b3f0: 6520 2020 2020 2020 2020 203d 204e 6f6e  e          = Non
-0002b400: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0002b410: 5f6c 6f6e 676e 616d 6520 2020 2020 2020  _longname       
-0002b420: 2020 2020 3d20 4e6f 6e65 0d0a 2020 2020      = None..    
-0002b430: 2020 2020 7365 6c66 2e5f 6465 7363 7269      self._descri
-0002b440: 7074 696f 6e20 2020 2020 2020 203d 204e  ption        = N
-0002b450: 6f6e 650d 0a20 2020 2020 2020 2073 656c  one..        sel
-0002b460: 662e 5f67 726f 7570 5f6f 6e6c 7920 2020  f._group_only   
-0002b470: 2020 2020 2020 3d20 4e6f 6e65 0d0a 2020        = None..  
-0002b480: 2020 2020 2020 7365 6c66 2e5f 6361 6c63        self._calc
-0002b490: 756c 6174 696f 6e5f 7374 6174 7573 203d  ulation_status =
-0002b4a0: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
-0002b4b0: 656c 662e 5f63 616c 6375 6c61 7469 6f6e  elf._calculation
-0002b4c0: 2020 2020 2020 2020 3d20 4e6f 6e65 0d0a          = None..
-0002b4d0: 2020 2020 2020 2020 2370 6879 7369 6420          #physid 
-0002b4e0: 6361 6c63 756c 6174 696f 6e20 6973 2066  calculation is f
-0002b4f0: 6f72 2063 6f6d 7061 7269 6e67 2074 6f20  or comparing to 
-0002b500: 7468 6520 456d 706f 7765 7220 6578 706f  the Empower expo
-0002b510: 7274 0d0a 2020 2020 2020 2020 7365 6c66  rt..        self
-0002b520: 2e5f 7068 7973 6964 5f63 616c 6375 6c61  ._physid_calcula
-0002b530: 7469 6f6e 203d 204e 6f6e 650d 0a20 2020  tion = None..   
-0002b540: 2020 2020 2073 656c 662e 5f63 6f6c 6f75       self._colou
-0002b550: 7220 2020 2020 2020 2020 2020 2020 3d20  r             = 
-0002b560: 4e6f 6e65 0d0a 2020 2020 2020 2020 7365  None..        se
-0002b570: 6c66 2e5f 6d65 6173 7572 6520 2020 2020  lf._measure     
-0002b580: 2020 2020 2020 203d 204e 6f6e 650d 0a0d         = None...
-0002b590: 0a20 2020 2020 2020 2073 656c 662e 7368  .        self.sh
-0002b5a0: 6f72 746e 616d 6520 203d 2073 686f 7274  ortname  = short
-0002b5b0: 6e61 6d65 0d0a 2020 2020 2020 2020 2369  name..        #i
-0002b5c0: 6620 6c6f 6e67 6e61 6d65 2069 7320 4e6f  f longname is No
-0002b5d0: 6e65 3a0d 0a20 2020 2020 2020 2023 2020  ne:..        #  
-0002b5e0: 2020 7365 6c66 2e6c 6f6e 676e 616d 6520    self.longname 
-0002b5f0: 2020 3d20 7368 6f72 746e 616d 650d 0a20    = shortname.. 
-0002b600: 2020 2020 2020 2023 656c 7365 3a0d 0a20         #else:.. 
-0002b610: 2020 2020 2020 2073 656c 662e 6c6f 6e67         self.long
-0002b620: 6e61 6d65 2020 203d 206c 6f6e 676e 616d  name   = longnam
-0002b630: 650d 0a0d 0a20 2020 2020 2020 2023 6966  e....        #if
-0002b640: 2064 6573 6372 6970 7469 6f6e 2069 7320   description is 
-0002b650: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2023  None:..        #
-0002b660: 2020 2020 7365 6c66 2e64 6573 6372 6970      self.descrip
-0002b670: 7469 6f6e 2020 2020 3d20 7365 6c66 2e5f  tion    = self._
-0002b680: 6c6f 6e67 6e61 6d65 0d0a 2020 2020 2020  longname..      
-0002b690: 2020 2365 6c73 653a 0d0a 2020 2020 2020    #else:..      
-0002b6a0: 2020 7365 6c66 2e64 6573 6372 6970 7469    self.descripti
-0002b6b0: 6f6e 2020 2020 3d20 6465 7363 7269 7074  on    = descript
-0002b6c0: 696f 6e0d 0a0d 0a20 2020 2020 2020 2023  ion....        #
-0002b6d0: 7072 696e 7428 2773 6574 2064 6573 6372  print('set descr
-0002b6e0: 6970 7469 6f6e 2074 6f3a 2022 272b 7365  iption to: "'+se
-0002b6f0: 6c66 2e64 6573 6372 6970 7469 6f6e 2b27  lf.description+'
-0002b700: 2220 6672 6f6d 3a20 2227 2b73 7472 2864  " from: "'+str(d
-0002b710: 6573 6372 6970 7469 6f6e 292b 2722 2729  escription)+'"')
-0002b720: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-0002b730: 2e67 726f 7570 5f6f 6e6c 7920 2020 2020  .group_only     
-0002b740: 2020 2020 3d20 6772 6f75 705f 6f6e 6c79      = group_only
-0002b750: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
-0002b760: 616c 6375 6c61 7469 6f6e 5f73 7461 7475  alculation_statu
-0002b770: 7320 3d20 6361 6c63 756c 6174 696f 6e5f  s = calculation_
-0002b780: 7374 6174 7573 0d0a 2020 2020 2020 2020  status..        
-0002b790: 7365 6c66 2e63 616c 6375 6c61 7469 6f6e  self.calculation
-0002b7a0: 2020 2020 2020 2020 3d20 6361 6c63 756c          = calcul
-0002b7b0: 6174 696f 6e0d 0a20 2020 2020 2020 2073  ation..        s
-0002b7c0: 656c 662e 636f 6c6f 7572 2020 2020 2020  elf.colour      
-0002b7d0: 2020 2020 2020 203d 2063 6f6c 6f75 720d         = colour.
-0002b7e0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0002b7f0: 2e64 696d 656e 7369 6f6e 2069 7320 4e6f  .dimension is No
-0002b800: 6e65 206f 7220 7365 6c66 2e64 696d 656e  ne or self.dimen
-0002b810: 7369 6f6e 2e69 6e64 6578 203c 2038 3a0d  sion.index < 8:.
-0002b820: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0002b830: 662e 6d65 6173 7572 6520 2020 2020 2020  f.measure       
-0002b840: 2020 2020 203d 206d 6561 7375 7265 0d0a       = measure..
-0002b850: 0d0a 2020 2020 2020 2020 2353 6574 2073  ..        #Set s
-0002b860: 656c 662e 7379 6e63 6865 6420 6174 2074  elf.synched at t
-0002b870: 6865 2065 6e64 202d 2077 6865 6e20 6372  he end - when cr
-0002b880: 6561 7469 6e67 2073 796e 6368 6564 2069  eating synched i
-0002b890: 7320 7472 7565 2069 6620 6974 2068 6173  s true if it has
-0002b8a0: 2062 6565 6e20 6d61 7374 6572 6564 0d0a   been mastered..
-0002b8b0: 2020 2020 2020 2020 7365 6c66 2e5f 7379          self._sy
-0002b8c0: 6e63 6865 6420 2020 2020 2020 2020 2020  nched           
-0002b8d0: 3d20 7365 6c66 2e6d 6173 7465 7265 640d  = self.mastered.
-0002b8e0: 0a20 2020 2020 2020 2073 656c 662e 5f65  .        self._e
-0002b8f0: 6469 7465 6420 2020 2020 2020 2020 2020  dited           
-0002b900: 203d 2046 616c 7365 0d0a 0d0a 2020 2020   = False....    
-0002b910: 2020 2020 6966 206e 6f74 2070 6879 7369      if not physi
-0002b920: 6420 6973 204e 6f6e 653a 0d0a 2020 2020  d is None:..    
-0002b930: 2020 2020 2020 2020 7365 6c66 2e5f 6669          self._fi
-0002b940: 656c 6473 2e72 6573 6574 5f65 6469 745f  elds.reset_edit_
-0002b950: 7374 6174 7573 2829 0d0a 0d0a 2020 2020  status()....    
-0002b960: 2020 2020 7365 6c66 2e5f 7365 6375 7269      self._securi
-0002b970: 7479 2020 2020 2020 2020 2020 3d20 4e6f  ty          = No
-0002b980: 6e65 0d0a 0d0a 2020 2020 4070 726f 7065  ne....    @prope
-0002b990: 7274 790d 0a20 2020 2064 6566 206d 6173  rty..    def mas
-0002b9a0: 7465 7265 6428 7365 6c66 293a 0d0a 2020  tered(self):..  
-0002b9b0: 2020 2020 2020 2727 2754 7275 6520 6966        '''True if
-0002b9c0: 2074 6869 7320 656c 656d 656e 7420 6861   this element ha
-0002b9d0: 7320 6265 656e 2063 7265 6174 6564 2069  s been created i
-0002b9e0: 6e20 456d 706f 7765 722c 2046 616c 7365  n Empower, False
-0002b9f0: 206f 7468 6572 7769 7365 2e20 5365 6520   otherwise. See 
-0002ba00: 2e73 796e 6368 6564 2066 6f72 2074 6865  .synched for the
-0002ba10: 2073 796e 6368 726f 6e69 7361 7469 6f6e   synchronisation
-0002ba20: 2028 692e 652e 2073 6176 6564 2920 7374   (i.e. saved) st
-0002ba30: 6174 7573 2727 270d 0a20 2020 2020 2020  atus'''..       
-0002ba40: 2072 6574 7572 6e20 6e6f 7420 7365 6c66   return not self
-0002ba50: 2e70 6879 7369 6420 6973 204e 6f6e 650d  .physid is None.
-0002ba60: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-0002ba70: 0d0a 2020 2020 6465 6620 7379 6e63 6865  ..    def synche
-0002ba80: 6428 7365 6c66 293a 0d0a 2020 2020 2020  d(self):..      
-0002ba90: 2020 2727 2754 7275 6520 6966 2061 6c6c    '''True if all
-0002baa0: 206f 6620 7468 6520 6174 7472 6962 7574   of the attribut
-0002bab0: 6573 206f 6620 7468 6973 2065 6c65 6d65  es of this eleme
-0002bac0: 6e74 2068 6176 6520 6265 656e 2073 796e  nt have been syn
-0002bad0: 6368 726f 6e69 7365 6420 7769 7468 2045  chronised with E
-0002bae0: 6d70 6f77 6572 2e20 5769 6c6c 2062 6520  mpower. Will be 
-0002baf0: 7472 7565 2061 6674 6572 2072 6561 6469  true after readi
-0002bb00: 6e67 2074 6865 2045 6c65 6d65 6e74 2066  ng the Element f
-0002bb10: 726f 6d20 456d 706f 7765 722c 206f 7220  rom Empower, or 
-0002bb20: 6166 7465 7220 7379 6e63 6872 6f6e 6973  after synchronis
-0002bb30: 6174 696f 6e2e 2057 696c 6c20 6265 2046  ation. Will be F
-0002bb40: 616c 7365 2069 6620 7468 6520 456c 656d  alse if the Elem
-0002bb50: 656e 7420 6861 7320 6265 656e 2065 6469  ent has been edi
-0002bb60: 7465 642c 206f 7220 646f 6573 206e 6f74  ted, or does not
-0002bb70: 2065 7869 7374 2069 6e20 456d 706f 7765   exist in Empowe
-0002bb80: 7220 6174 2061 6c6c 2e27 2727 0d0a 2020  r at all.'''..  
-0002bb90: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0002bba0: 662e 6d61 7374 6572 6564 2061 6e64 206e  f.mastered and n
-0002bbb0: 6f74 2073 656c 662e 6564 6974 6564 0d0a  ot self.edited..
-0002bbc0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-0002bbd0: 0a20 2020 2064 6566 2065 6469 7465 6428  .    def edited(
-0002bbe0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0002bbf0: 2727 2754 7275 6520 6966 2074 6869 7320  '''True if this 
-0002bc00: 456c 656d 656e 7420 6861 7320 6265 656e  Element has been
-0002bc10: 2063 6861 6e67 6564 2073 696e 6365 2063   changed since c
-0002bc20: 7265 6174 696f 6e2c 206f 7220 7369 6e63  reation, or sinc
-0002bc30: 6520 7265 6164 696e 6720 6974 2066 726f  e reading it fro
-0002bc40: 6d20 456d 706f 7765 722e 2727 270d 0a20  m Empower.'''.. 
-0002bc50: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0002bc60: 6c66 2e5f 6564 6974 6564 0d0a 0d0a 2020  lf._edited....  
-0002bc70: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-0002bc80: 2064 6566 2073 686f 7274 636f 6465 2873   def shortcode(s
-0002bc90: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
-0002bca0: 2727 5379 6e6f 6e79 6d20 6f66 2073 686f  ''Synonym of sho
-0002bcb0: 7274 6e61 6d65 2c20 7468 6520 456d 706f  rtname, the Empo
-0002bcc0: 7765 7220 7368 6f72 746e 616d 6520 666f  wer shortname fo
-0002bcd0: 7220 7468 6973 2045 6c65 6d65 6e74 2727  r this Element''
-0002bce0: 270d 0a20 2020 2020 2020 2072 6574 7572  '..        retur
-0002bcf0: 6e20 7365 6c66 2e73 686f 7274 6e61 6d65  n self.shortname
-0002bd00: 0d0a 0d0a 2020 2020 4073 686f 7274 636f  ....    @shortco
-0002bd10: 6465 2e73 6574 7465 720d 0a20 2020 2064  de.setter..    d
-0002bd20: 6566 2073 686f 7274 636f 6465 2873 656c  ef shortcode(sel
-0002bd30: 662c 7661 6c29 3a0d 0a20 2020 2020 2020  f,val):..       
-0002bd40: 2073 656c 662e 7368 6f72 746e 616d 653d   self.shortname=
-0002bd50: 7661 6c0d 0a0d 0a20 2020 2040 7072 6f70  val....    @prop
-0002bd60: 6572 7479 0d0a 2020 2020 6465 6620 7368  erty..    def sh
-0002bd70: 6f72 746e 616d 6528 7365 6c66 293a 0d0a  ortname(self):..
-0002bd80: 2020 2020 2020 2020 2727 2754 6865 2045          '''The E
-0002bd90: 6d70 6f77 6572 2027 5368 6f72 7420 4e61  mpower 'Short Na
-0002bda0: 6d65 2720 666f 7220 7468 6973 2045 6c65  me' for this Ele
-0002bdb0: 6d65 6e74 2727 270d 0a20 2020 2020 2020  ment'''..       
-0002bdc0: 2072 6574 7572 6e20 7365 6c66 2e5f 7368   return self._sh
-0002bdd0: 6f72 746e 616d 650d 0a0d 0a20 2020 2040  ortname....    @
-0002bde0: 7368 6f72 746e 616d 652e 7365 7474 6572  shortname.setter
-0002bdf0: 0d0a 2020 2020 6465 6620 7368 6f72 746e  ..    def shortn
-0002be00: 616d 6528 7365 6c66 2c76 616c 293a 0d0a  ame(self,val):..
-0002be10: 2020 2020 2020 2020 7365 6c66 2e5f 7368          self._sh
-0002be20: 6f72 746e 616d 653d 7661 6c0d 0a20 2020  ortname=val..   
-0002be30: 2020 2020 2073 656c 662e 5f66 6965 6c64       self._field
-0002be40: 735b 2753 686f 7274 204e 616d 6527 5d3d  s['Short Name']=
-0002be50: 7365 6c66 2e5f 7368 6f72 746e 616d 650d  self._shortname.
-0002be60: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-0002be70: 0d0a 2020 2020 6465 6620 6c6f 6e67 6e61  ..    def longna
-0002be80: 6d65 2873 656c 6629 3a0d 0a20 2020 2020  me(self):..     
-0002be90: 2020 2027 2727 5468 6520 456d 706f 7765     '''The Empowe
-0002bea0: 7227 204c 6f6e 6720 4e61 6d65 2720 666f  r' Long Name' fo
-0002beb0: 7220 7468 6973 2045 6c65 6d65 6e74 2727  r this Element''
-0002bec0: 270d 0a20 2020 2020 2020 2072 6574 7572  '..        retur
-0002bed0: 6e20 7365 6c66 2e5f 6c6f 6e67 6e61 6d65  n self._longname
-0002bee0: 0d0a 0d0a 2020 2020 406c 6f6e 676e 616d  ....    @longnam
-0002bef0: 652e 7365 7474 6572 0d0a 2020 2020 6465  e.setter..    de
-0002bf00: 6620 6c6f 6e67 6e61 6d65 2873 656c 662c  f longname(self,
-0002bf10: 7661 6c29 3a0d 0a20 2020 2020 2020 2073  val):..        s
-0002bf20: 656c 662e 5f6c 6f6e 676e 616d 653d 7661  elf._longname=va
-0002bf30: 6c0d 0a20 2020 2020 2020 2073 656c 662e  l..        self.
-0002bf40: 5f66 6965 6c64 735b 274c 6f6e 6720 4e61  _fields['Long Na
-0002bf50: 6d65 275d 3d73 656c 662e 5f6c 6f6e 676e  me']=self._longn
-0002bf60: 616d 650d 0a0d 0a20 2020 2040 7072 6f70  ame....    @prop
-0002bf70: 6572 7479 0d0a 2020 2020 6465 6620 6465  erty..    def de
-0002bf80: 7363 7269 7074 696f 6e28 7365 6c66 293a  scription(self):
-0002bf90: 0d0a 2020 2020 2020 2020 2727 2754 6865  ..        '''The
-0002bfa0: 2045 6d70 6f77 6572 2027 4465 7363 7269   Empower 'Descri
-0002bfb0: 7074 696f 6e27 2066 6f72 2074 6869 7320  ption' for this 
-0002bfc0: 456c 656d 656e 7427 2727 0d0a 2020 2020  Element'''..    
-0002bfd0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0002bfe0: 5f64 6573 6372 6970 7469 6f6e 0d0a 0d0a  _description....
-0002bff0: 2020 2020 4064 6573 6372 6970 7469 6f6e      @description
-0002c000: 2e73 6574 7465 720d 0a20 2020 2064 6566  .setter..    def
-0002c010: 2064 6573 6372 6970 7469 6f6e 2873 656c   description(sel
-0002c020: 662c 7661 6c29 3a0d 0a20 2020 2020 2020  f,val):..       
-0002c030: 2073 656c 662e 5f64 6573 6372 6970 7469   self._descripti
-0002c040: 6f6e 3d76 616c 0d0a 2020 2020 2020 2020  on=val..        
-0002c050: 7365 6c66 2e5f 6669 656c 6473 5b27 4465  self._fields['De
-0002c060: 7363 7269 7074 696f 6e27 5d3d 7365 6c66  scription']=self
-0002c070: 2e5f 6465 7363 7269 7074 696f 6e0d 0a0d  ._description...
-0002c080: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
-0002c090: 2020 2020 6465 6620 6772 6f75 705f 6f6e      def group_on
-0002c0a0: 6c79 2873 656c 6629 3a0d 0a20 2020 2020  ly(self):..     
-0002c0b0: 2020 2027 2727 5468 6520 456d 706f 7765     '''The Empowe
-0002c0c0: 7220 2747 726f 7570 204f 6e6c 7927 2066  r 'Group Only' f
-0002c0d0: 6f72 2074 6869 7320 456c 656d 656e 742c  or this Element,
-0002c0e0: 2077 696c 6c20 6265 2027 4772 6f75 7027   will be 'Group'
-0002c0f0: 206f 7220 4e6f 6e65 2727 270d 0a20 2020   or None'''..   
-0002c100: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0002c110: 2e5f 6772 6f75 705f 6f6e 6c79 0d0a 0d0a  ._group_only....
-0002c120: 2020 2020 4067 726f 7570 5f6f 6e6c 792e      @group_only.
-0002c130: 7365 7474 6572 0d0a 2020 2020 6465 6620  setter..    def 
-0002c140: 6772 6f75 705f 6f6e 6c79 2873 656c 662c  group_only(self,
-0002c150: 7661 6c29 3a0d 0a20 2020 2020 2020 2073  val):..        s
-0002c160: 656c 662e 5f67 726f 7570 5f6f 6e6c 793d  elf._group_only=
-0002c170: 7661 6c0d 0a20 2020 2020 2020 2073 656c  val..        sel
-0002c180: 662e 5f66 6965 6c64 735b 2747 726f 7570  f._fields['Group
-0002c190: 204f 6e6c 7927 5d3d 7365 6c66 2e5f 6772   Only']=self._gr
-0002c1a0: 6f75 705f 6f6e 6c79 0d0a 0d0a 2020 2020  oup_only....    
-0002c1b0: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-0002c1c0: 6566 2063 616c 6375 6c61 7469 6f6e 5f73  ef calculation_s
-0002c1d0: 7461 7475 7328 7365 6c66 293a 0d0a 2020  tatus(self):..  
-0002c1e0: 2020 2020 2020 2727 2754 6865 2045 6d70        '''The Emp
-0002c1f0: 6f77 6572 2027 4361 6c63 756c 6174 696f  ower 'Calculatio
-0002c200: 6e20 5374 6174 7573 2720 666f 7220 7468  n Status' for th
-0002c210: 6973 2045 6c65 6d65 6e74 2c20 7769 6c6c  is Element, will
-0002c220: 2062 6520 2752 6561 6c27 206f 7220 2743   be 'Real' or 'C
-0002c230: 616c 6375 6c61 7465 6427 2027 2727 0d0a  alculated' '''..
-0002c240: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0002c250: 656c 662e 5f63 616c 6375 6c61 7469 6f6e  elf._calculation
-0002c260: 5f73 7461 7475 730d 0a0d 0a20 2020 2040  _status....    @
-0002c270: 6361 6c63 756c 6174 696f 6e5f 7374 6174  calculation_stat
-0002c280: 7573 2e73 6574 7465 720d 0a20 2020 2064  us.setter..    d
-0002c290: 6566 2063 616c 6375 6c61 7469 6f6e 5f73  ef calculation_s
-0002c2a0: 7461 7475 7328 7365 6c66 2c76 616c 293a  tatus(self,val):
-0002c2b0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0002c2c0: 6361 6c63 756c 6174 696f 6e5f 7374 6174  calculation_stat
-0002c2d0: 7573 3d76 616c 0d0a 2020 2020 2020 2020  us=val..        
-0002c2e0: 7365 6c66 2e5f 6669 656c 6473 5b27 4361  self._fields['Ca
-0002c2f0: 6c63 756c 6174 696f 6e20 5374 6174 7573  lculation Status
-0002c300: 275d 3d73 656c 662e 5f63 616c 6375 6c61  ']=self._calcula
-0002c310: 7469 6f6e 5f73 7461 7475 730d 0a0d 0a20  tion_status.... 
-0002c320: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-0002c330: 2020 6465 6620 6361 6c63 756c 6174 696f    def calculatio
-0002c340: 6e28 7365 6c66 293a 0d0a 2020 2020 2020  n(self):..      
-0002c350: 2020 2727 2741 2073 7472 696e 6720 636f    '''A string co
-0002c360: 6e74 6169 6e69 6e67 2074 6865 2045 6d70  ntaining the Emp
-0002c370: 6f77 6572 2027 4361 6c63 756c 6174 696f  ower 'Calculatio
-0002c380: 6e27 2066 6f72 2074 6869 7320 456c 656d  n' for this Elem
-0002c390: 656e 742e 204d 6179 2062 6520 4e6f 6e65  ent. May be None
-0002c3a0: 2027 2727 0d0a 2020 2020 2020 2020 7265   '''..        re
-0002c3b0: 7475 726e 2073 656c 662e 5f63 616c 6375  turn self._calcu
-0002c3c0: 6c61 7469 6f6e 0d0a 0d0a 2020 2020 4063  lation....    @c
-0002c3d0: 616c 6375 6c61 7469 6f6e 2e73 6574 7465  alculation.sette
-0002c3e0: 720d 0a20 2020 2064 6566 2063 616c 6375  r..    def calcu
-0002c3f0: 6c61 7469 6f6e 2873 656c 662c 7661 6c29  lation(self,val)
-0002c400: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-0002c410: 5f63 616c 6375 6c61 7469 6f6e 3d76 616c  _calculation=val
-0002c420: 0d0a 2020 2020 2020 2020 2370 7269 6e74  ..        #print
-0002c430: 2873 656c 662e 7368 6f72 746e 616d 6529  (self.shortname)
-0002c440: 0d0a 2020 2020 2020 2020 2374 7279 3a0d  ..        #try:.
-0002c450: 0a20 2020 2020 2020 2023 2020 2020 7072  .        #    pr
-0002c460: 696e 7428 7365 6c66 2e5f 6669 656c 6473  int(self._fields
-0002c470: 2e5f 6669 656c 645f 6564 6974 735b 2743  ._field_edits['C
-0002c480: 616c 6375 6c61 7469 6f6e 275d 290d 0a20  alculation']).. 
-0002c490: 2020 2020 2020 2023 6578 6365 7074 204b         #except K
-0002c4a0: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
-0002c4b0: 2020 2320 2020 2070 7269 6e74 2846 616c    #    print(Fal
-0002c4c0: 7365 290d 0a20 2020 2020 2020 2073 656c  se)..        sel
-0002c4d0: 662e 5f66 6965 6c64 735b 2743 616c 6375  f._fields['Calcu
-0002c4e0: 6c61 7469 6f6e 275d 3d73 656c 662e 5f63  lation']=self._c
-0002c4f0: 616c 6375 6c61 7469 6f6e 0d0a 2020 2020  alculation..    
-0002c500: 2020 2020 2370 7269 6e74 2873 656c 662e      #print(self.
-0002c510: 5f66 6965 6c64 732e 5f66 6965 6c64 5f65  _fields._field_e
-0002c520: 6469 7473 5b27 4361 6c63 756c 6174 696f  dits['Calculatio
-0002c530: 6e27 5d29 0d0a 0d0a 2020 2020 4070 726f  n'])....    @pro
-0002c540: 7065 7274 790d 0a20 2020 2064 6566 2063  perty..    def c
-0002c550: 6f6c 6f75 7228 7365 6c66 293a 0d0a 2020  olour(self):..  
-0002c560: 2020 2020 2020 2727 2754 6865 2045 6d70        '''The Emp
-0002c570: 6f77 6572 2027 436f 6c6f 7572 2720 6f66  ower 'Colour' of
-0002c580: 2074 6869 7320 456c 656d 656e 7427 2727   this Element'''
-0002c590: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0002c5a0: 2073 656c 662e 5f63 6f6c 6f75 720d 0a0d   self._colour...
-0002c5b0: 0a20 2020 2040 636f 6c6f 7572 2e73 6574  .    @colour.set
-0002c5c0: 7465 720d 0a20 2020 2064 6566 2063 6f6c  ter..    def col
-0002c5d0: 6f75 7228 7365 6c66 2c76 616c 293a 0d0a  our(self,val):..
-0002c5e0: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
-0002c5f0: 6c6f 7572 3d76 616c 0d0a 2020 2020 2020  lour=val..      
-0002c600: 2020 7365 6c66 2e5f 6669 656c 6473 5b27    self._fields['
-0002c610: 436f 6c6f 7572 275d 3d73 656c 662e 5f63  Colour']=self._c
-0002c620: 6f6c 6f75 720d 0a0d 0a20 2020 2040 7072  olour....    @pr
-0002c630: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-0002c640: 6d65 6173 7572 6528 7365 6c66 293a 0d0a  measure(self):..
-0002c650: 2020 2020 2020 2020 2727 2754 6865 2045          '''The E
-0002c660: 6d70 6f77 6572 2027 4d65 6173 7572 6527  mpower 'Measure'
-0002c670: 2066 6f72 2074 6869 7320 456c 656d 656e   for this Elemen
-0002c680: 7427 2727 0d0a 2020 2020 2020 2020 7265  t'''..        re
-0002c690: 7475 726e 2073 656c 662e 5f6d 6561 7375  turn self._measu
-0002c6a0: 7265 0d0a 0d0a 2020 2020 406d 6561 7375  re....    @measu
-0002c6b0: 7265 2e73 6574 7465 720d 0a20 2020 2064  re.setter..    d
-0002c6c0: 6566 206d 6561 7375 7265 2873 656c 662c  ef measure(self,
-0002c6d0: 7661 6c29 3a0d 0a20 2020 2020 2020 2073  val):..        s
-0002c6e0: 656c 662e 5f6d 6561 7375 7265 3d76 616c  elf._measure=val
-0002c6f0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0002c700: 6669 656c 6473 5b27 4d65 6173 7572 6520  fields['Measure 
-0002c710: 456c 656d 656e 7427 5d3d 7365 6c66 2e5f  Element']=self._
-0002c720: 6d65 6173 7572 650d 0a0d 0a20 2020 2040  measure....    @
-0002c730: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-0002c740: 6620 6669 656c 6473 2873 656c 6629 3a0d  f fields(self):.
-0002c750: 0a20 2020 2020 2020 2027 2727 5265 7475  .        '''Retu
-0002c760: 726e 7320 6120 6469 6374 696f 6e61 7279  rns a dictionary
-0002c770: 2d6c 696b 6520 6f62 6a65 6374 2063 6f6e  -like object con
-0002c780: 7461 696e 696e 6720 7468 6520 456d 706f  taining the Empo
-0002c790: 7765 7220 6669 656c 6473 2028 612e 6b2e  wer fields (a.k.
-0002c7a0: 612e 2061 7474 7269 6275 7465 7329 2066  a. attributes) f
-0002c7b0: 6f72 2074 6869 7320 456c 656d 656e 742e  or this Element.
-0002c7c0: 2045 6e74 7269 6573 2061 7265 206f 6620   Entries are of 
-0002c7d0: 7468 6520 666f 726d 204c 6f6e 6720 4e61  the form Long Na
-0002c7e0: 6d65 3a53 7472 696e 6720 5661 6c75 6520  me:String Value 
-0002c7f0: 2727 270d 0a20 2020 2020 2020 2023 5265  '''..        #Re
-0002c800: 7475 726e 2061 2073 7065 6369 616c 2066  turn a special f
-0002c810: 6965 6c64 2073 6574 7465 722c 2073 6f20  ield setter, so 
-0002c820: 7468 6174 2063 6861 6e67 696e 6720 7468  that changing th
-0002c830: 6520 7661 6c75 6520 7570 6461 7465 7320  e value updates 
-0002c840: 7468 6520 5f73 796e 6368 6564 2066 6c61  the _synched fla
-0002c850: 670d 0a0d 0a20 2020 2020 2020 2072 6574  g....        ret
-0002c860: 7572 6e20 7365 6c66 2e5f 6669 656c 6473  urn self._fields
-0002c870: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-0002c880: 790d 0a20 2020 2064 6566 2064 6174 6528  y..    def date(
-0002c890: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0002c8a0: 2727 2741 7070 6c69 6573 2074 6f20 7469  '''Applies to ti
-0002c8b0: 6d65 2065 6c65 6d65 6e74 7320 6f6e 6c79  me elements only
-0002c8c0: 2e20 4120 7265 6164 206f 6e6c 7920 7072  . A read only pr
-0002c8d0: 6f70 6572 7479 2074 6861 7420 7265 7475  operty that retu
-0002c8e0: 726e 7320 6120 6461 7465 2062 6173 6564  rns a date based
-0002c8f0: 206f 6e20 7965 6172 2c20 6d6f 6e74 682c   on year, month,
-0002c900: 2064 6179 2061 6e64 2069 6e74 6572 7661   day and interva
-0002c910: 6c5f 7479 7065 2727 270d 0a20 2020 2020  l_type'''..     
-0002c920: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-0002c930: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-0002c940: 0a20 2020 2064 6566 2079 6561 7228 7365  .    def year(se
-0002c950: 6c66 293a 0d0a 2020 2020 2020 2020 6966  lf):..        if
-0002c960: 2073 656c 662e 6461 7465 2069 7320 6e6f   self.date is no
-0002c970: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-0002c980: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0002c990: 2e64 6174 652e 7965 6172 0d0a 2020 2020  .date.year..    
-0002c9a0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0002c9b0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0002c9c0: 6e65 0d0a 0d0a 2020 2020 4070 726f 7065  ne....    @prope
-0002c9d0: 7274 790d 0a20 2020 2064 6566 206d 6f6e  rty..    def mon
-0002c9e0: 7468 2873 656c 6629 3a0d 0a20 2020 2020  th(self):..     
-0002c9f0: 2020 2069 6620 7365 6c66 2e64 6174 6520     if self.date 
-0002ca00: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-0002ca10: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002ca20: 2073 656c 662e 6461 7465 2e6d 6f6e 7468   self.date.month
-0002ca30: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0002ca40: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0002ca50: 7572 6e20 4e6f 6e65 0d0a 0d0a 2020 2020  urn None....    
-0002ca60: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-0002ca70: 6566 2071 7561 7274 6572 2873 656c 6629  ef quarter(self)
-0002ca80: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
-0002ca90: 6c66 2e64 6174 6520 6973 206e 6f74 204e  lf.date is not N
-0002caa0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0002cab0: 2020 7265 7475 726e 2028 7365 6c66 2e64    return (self.d
-0002cac0: 6174 652e 6d6f 6e74 6820 2d31 2920 2f2f  ate.month -1) //
-0002cad0: 2033 202b 310d 0a20 2020 2020 2020 2065   3 +1..        e
-0002cae0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0002caf0: 2020 7265 7475 726e 204e 6f6e 650d 0a0d    return None...
-0002cb00: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
-0002cb10: 2020 2020 6465 6620 6461 7928 7365 6c66      def day(self
-0002cb20: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
-0002cb30: 656c 662e 6461 7465 2069 7320 6e6f 7420  elf.date is not 
-0002cb40: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0002cb50: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
-0002cb60: 6174 652e 6461 790d 0a20 2020 2020 2020  ate.day..       
-0002cb70: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0002cb80: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-0002cb90: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-0002cba0: 0d0a 2020 2020 6465 6620 656d 706f 7765  ..    def empowe
-0002cbb0: 725f 7065 7269 6f64 5f6e 756d 6265 7228  r_period_number(
-0002cbc0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0002cbd0: 7265 7475 726e 204e 6f6e 650d 0a0d 0a20  return None.... 
-0002cbe0: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-0002cbf0: 2020 6465 6620 696e 7465 7276 616c 5f69    def interval_i
-0002cc00: 6e64 6578 2873 656c 6629 3a0d 0a20 2020  ndex(self):..   
-0002cc10: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0002cc20: 0d0a 0d0a 2020 2020 6465 6620 636f 7079  ....    def copy
+00029550: 2020 2020 2020 7368 6f72 745f 6e61 6d65        short_name
+00029560: 5f63 6f6c 756d 6e5f 6973 5f66 6f75 6e64  _column_is_found
+00029570: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
+00029580: 2020 666f 7220 6320 696e 2064 6174 6166    for c in dataf
+00029590: 7261 6d65 2e63 6f6c 756d 6e73 3a0d 0a20  rame.columns:.. 
+000295a0: 2020 2020 2020 2020 2020 2069 6620 6320             if c 
+000295b0: 3d3d 2070 6172 656e 745f 6b65 795f 636f  == parent_key_co
+000295c0: 6c75 6d6e 3a0d 0a20 2020 2020 2020 2020  lumn:..         
+000295d0: 2020 2020 2020 2070 6172 656e 745f 6b65         parent_ke
+000295e0: 795f 636f 6c75 6d6e 5f69 735f 666f 756e  y_column_is_foun
+000295f0: 6420 203d 2054 7275 650d 0a20 2020 2020  d  = True..     
+00029600: 2020 2020 2020 2069 6620 6320 3d3d 2027         if c == '
+00029610: 5368 6f72 7420 4e61 6d65 273a 0d0a 2020  Short Name':..  
+00029620: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00029630: 6f72 745f 6e61 6d65 5f63 6f6c 756d 6e5f  ort_name_column_
+00029640: 6973 5f66 6f75 6e64 203d 2054 7275 650d  is_found = True.
+00029650: 0a0d 0a20 2020 2020 2020 2069 6620 6e6f  ...        if no
+00029660: 7420 7368 6f72 745f 6e61 6d65 5f63 6f6c  t short_name_col
+00029670: 756d 6e5f 6973 5f66 6f75 6e64 3a0d 0a20  umn_is_found:.. 
+00029680: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00029690: 2056 616c 7565 4572 726f 7228 276d 616b   ValueError('mak
+000296a0: 655f 7374 7275 6374 7572 655f 6672 6f6d  e_structure_from
+000296b0: 5f64 6174 6166 7261 6d65 2829 3a20 5468  _dataframe(): Th
+000296c0: 6520 6461 7461 6672 616d 6520 7061 7261  e dataframe para
+000296d0: 6d65 7465 7220 6d75 7374 2063 6f6e 7461  meter must conta
+000296e0: 696e 2061 2064 6174 6166 7261 6d65 2077  in a dataframe w
+000296f0: 6974 6820 6120 2253 686f 7274 204e 616d  ith a "Short Nam
+00029700: 6522 2063 6f6c 756d 6e2e 2043 6f6c 756d  e" column. Colum
+00029710: 6e73 2069 6e20 7468 6520 6461 7461 6672  ns in the datafr
+00029720: 616d 6520 6172 653a 2027 2b73 7472 2864  ame are: '+str(d
+00029730: 6174 6166 7261 6d65 2e63 6f6c 756d 6e73  ataframe.columns
+00029740: 2929 0d0a 0d0a 2020 2020 2020 2020 6966  ))....        if
+00029750: 206e 6f74 2070 6172 656e 745f 6b65 795f   not parent_key_
+00029760: 636f 6c75 6d6e 5f69 735f 666f 756e 643a  column_is_found:
+00029770: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+00029780: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+00029790: 6d61 6b65 5f73 7472 7563 7475 7265 5f66  make_structure_f
+000297a0: 726f 6d5f 6461 7461 6672 616d 6528 293a  rom_dataframe():
+000297b0: 2054 6865 2064 6174 6166 7261 6d65 2070   The dataframe p
+000297c0: 6172 616d 6574 6572 206d 7573 7420 636f  arameter must co
+000297d0: 6e74 6169 6e20 6120 6461 7461 6672 616d  ntain a datafram
+000297e0: 6520 7769 7468 2061 2022 272b 7061 7265  e with a "'+pare
+000297f0: 6e74 5f6b 6579 5f63 6f6c 756d 6e2b 2722  nt_key_column+'"
+00029800: 2063 6f6c 756d 6e2e 2043 6f6c 756d 6e73   column. Columns
+00029810: 2069 6e20 7468 6520 6461 7461 6672 616d   in the datafram
+00029820: 6520 6172 653a 2027 2b73 7472 2864 6174  e are: '+str(dat
+00029830: 6166 7261 6d65 2e63 6f6c 756d 6e73 292b  aframe.columns)+
+00029840: 275c 6e27 2b27 456e 7375 7265 2074 6869  '\n'+'Ensure thi
+00029850: 7320 636f 6c75 6d6e 2069 7320 696e 2074  s column is in t
+00029860: 6865 2064 6174 6166 7261 6d65 206f 7220  he dataframe or 
+00029870: 7365 7420 7468 6520 7061 7265 6e74 5f6b  set the parent_k
+00029880: 6579 5f63 6f6c 756d 6e20 7061 7261 6d65  ey_column parame
+00029890: 7465 7220 746f 2061 2063 6f6c 756d 6e20  ter to a column 
+000298a0: 7468 6174 2069 7320 696e 2074 6865 2064  that is in the d
+000298b0: 6174 6166 7261 6d65 2c20 616e 6420 6465  ataframe, and de
+000298c0: 6e6f 7465 7320 7468 6520 7061 7265 6e74  notes the parent
+000298d0: 206b 6579 2729 0d0a 0d0a 2020 2020 2020   key')....      
+000298e0: 2020 2350 6172 656e 7473 2061 7265 206e    #Parents are n
+000298f0: 6f74 2061 6c77 6179 7320 6465 6e6f 7465  ot always denote
+00029900: 6420 6279 2074 6865 6972 2073 686f 7274  d by their short
+00029910: 6e61 6d65 2028 6166 7465 7220 616c 6c20  name (after all 
+00029920: 7765 206d 6179 206e 6f74 2068 6176 6520  we may not have 
+00029930: 6b6e 6f77 6e20 6974 2061 7420 7468 6520  known it at the 
+00029940: 706f 696e 7420 7468 6520 6f72 6967 696e  point the origin
+00029950: 616c 2064 6174 6166 7261 6d65 2077 6173  al dataframe was
+00029960: 2070 6173 7365 6420 696e 0d0a 2020 2020   passed in..    
+00029970: 2020 2020 7061 7265 6e74 5f6c 6f6f 6b75      parent_looku
+00029980: 7020 3d20 7b65 6c2e 6669 656c 6473 5b70  p = {el.fields[p
+00029990: 6172 656e 745f 6b65 795f 6669 656c 645f  arent_key_field_
+000299a0: 6e61 6d65 5d3a 656c 2e73 686f 7274 6e61  name]:el.shortna
+000299b0: 6d65 2066 6f72 2065 6c20 696e 2073 656c  me for el in sel
+000299c0: 662e 656c 656d 656e 7473 2e76 616c 7565  f.elements.value
+000299d0: 7328 297d 0d0a 0d0a 2020 2020 2020 2020  s()}....        
+000299e0: 2347 6574 2074 6865 2073 7472 7563 7475  #Get the structu
+000299f0: 7265 202d 2077 6527 6c6c 2075 7064 6174  re - we'll updat
+00029a00: 6520 6974 0d0a 2020 2020 2020 2020 7374  e it..        st
+00029a10: 7275 6374 7572 6520 3d20 7365 6c66 2e73  ructure = self.s
+00029a20: 7472 7563 7475 7265 735b 7374 7275 6374  tructures[struct
+00029a30: 7572 655f 7368 6f72 746e 616d 655d 0d0a  ure_shortname]..
+00029a40: 0d0a 2020 2020 2020 2020 6966 2073 7472  ..        if str
+00029a50: 7563 7475 7265 2069 7320 4e6f 6e65 3a0d  ucture is None:.
+00029a60: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00029a70: 7365 204b 6579 4572 726f 7228 2754 6865  se KeyError('The
+00029a80: 7265 2069 7320 6e6f 2073 7472 7563 7475  re is no structu
+00029a90: 7265 2077 6974 6820 7368 6f72 746e 616d  re with shortnam
+00029aa0: 6520 2227 2b73 7472 7563 7475 7265 5f73  e "'+structure_s
+00029ab0: 686f 7274 6e61 6d65 2b27 2220 696e 2064  hortname+'" in d
+00029ac0: 696d 656e 7369 6f6e 2729 0d0a 0d0a 2020  imension')....  
+00029ad0: 2020 2020 2020 2343 6869 6c64 2073 686f        #Child sho
+00029ae0: 7274 636f 6465 2074 6f20 7061 7265 6e74  rtcode to parent
+00029af0: 2073 686f 7274 636f 6465 206c 6f6f 6b75   shortcode looku
+00029b00: 700d 0a20 2020 2020 2020 2063 6869 6c64  p..        child
+00029b10: 5f70 6172 656e 7473 3d7b 7d0d 0a0d 0a20  _parents={}.... 
+00029b20: 2020 2020 2020 2066 6f72 2064 2069 6e20         for d in 
+00029b30: 6461 7461 6672 616d 655b 5b27 5368 6f72  dataframe[['Shor
+00029b40: 7420 4e61 6d65 272c 7061 7265 6e74 5f6b  t Name',parent_k
+00029b50: 6579 5f63 6f6c 756d 6e5d 5d2e 6974 6572  ey_column]].iter
+00029b60: 7475 706c 6573 2869 6e64 6578 3d46 616c  tuples(index=Fal
+00029b70: 7365 293a 0d0a 2020 2020 2020 2020 2020  se):..          
+00029b80: 2020 2346 6f72 2073 6f6d 6520 7265 6173    #For some reas
+00029b90: 6f6e 2069 7465 7274 7570 6c65 7320 6973  on itertuples is
+00029ba0: 6e27 7420 636f 6d69 6e67 2062 6163 6b20  n't coming back 
+00029bb0: 7769 7468 2074 6865 2063 6f6c 756d 6e20  with the column 
+00029bc0: 6e61 6d65 7320 2d20 6372 6561 7465 2061  names - create a
+00029bd0: 2064 6963 7469 6f6e 6172 7920 7573 696e   dictionary usin
+00029be0: 6720 7468 6520 6f72 6967 696e 616c 2063  g the original c
+00029bf0: 6f6c 756d 6e20 616e 6d65 7320 6f66 2074  olumn anmes of t
+00029c00: 6865 2064 6963 7469 6f6e 6172 790d 0a20  he dictionary.. 
+00029c10: 2020 2020 2020 2020 2020 2063 6869 6c64             child
+00029c20: 5f73 686f 7274 6e61 6d65 2020 3d20 645b  _shortname  = d[
+00029c30: 305d 0d0a 0d0a 2020 2020 2020 2020 2020  0]....          
+00029c40: 2020 6966 2064 5b31 5d20 6973 206e 6f74    if d[1] is not
+00029c50: 204e 6f6e 6520 616e 6420 645b 315d 2021   None and d[1] !
+00029c60: 3d20 2727 3a0d 0a20 2020 2020 2020 2020  = '':..         
+00029c70: 2020 2020 2020 2070 6172 656e 745f 7368         parent_sh
+00029c80: 6f72 746e 616d 6520 3d20 7061 7265 6e74  ortname = parent
+00029c90: 5f6c 6f6f 6b75 705b 645b 315d 5d0d 0a20  _lookup[d[1]].. 
+00029ca0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00029cb0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+00029cc0: 2020 2020 2020 2020 2070 6172 656e 745f           parent_
+00029cd0: 656c 656d 656e 7473 203d 2073 7472 7563  elements = struc
+00029ce0: 7475 7265 2e67 6574 5f65 6c65 6d65 6e74  ture.get_element
+00029cf0: 7328 7061 7265 6e74 5f73 686f 7274 6e61  s(parent_shortna
+00029d00: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
+00029d10: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+00029d20: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+00029d30: 2020 2020 2020 2020 2020 2023 4765 7420             #Get 
+00029d40: 7468 6520 456c 656d 656e 740d 0a20 2020  the Element..   
+00029d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029d60: 2065 6c65 6d65 6e74 203d 2073 656c 662e   element = self.
+00029d70: 656c 656d 656e 7473 5b70 6172 656e 745f  elements[parent_
+00029d80: 7368 6f72 746e 616d 655d 0d0a 2020 2020  shortname]..    
+00029d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029da0: 2343 7265 6174 6520 7468 6520 5374 7275  #Create the Stru
+00029db0: 6374 7572 6545 6c65 6d65 6e74 0d0a 2020  ctureElement..  
+00029dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029dd0: 2020 7374 7275 6374 7572 652e 5f61 6464    structure._add
+00029de0: 5f65 6c65 6d65 6e74 2853 7472 7563 7475  _element(Structu
+00029df0: 7265 5f45 6c65 6d65 6e74 2865 6c65 6d65  re_Element(eleme
+00029e00: 6e74 3d65 6c65 6d65 6e74 2929 0d0a 2020  nt=element))..  
+00029e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029e20: 2020 7061 7265 6e74 5f65 6c65 6d65 6e74    parent_element
+00029e30: 7320 3d20 7374 7275 6374 7572 652e 6765  s = structure.ge
+00029e40: 745f 656c 656d 656e 7473 2870 6172 656e  t_elements(paren
+00029e50: 745f 7368 6f72 746e 616d 6529 0d0a 0d0a  t_shortname)....
+00029e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029e70: 7061 7265 6e74 5f65 6c65 6d65 6e74 203d  parent_element =
+00029e80: 2070 6172 656e 745f 656c 656d 656e 7473   parent_elements
+00029e90: 5b30 5d0d 0a0d 0a20 2020 2020 2020 2020  [0]....         
+00029ea0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00029eb0: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
+00029ec0: 5f65 6c65 6d65 6e74 203d 204e 6f6e 650d  _element = None.
+00029ed0: 0a0d 0a0d 0a20 2020 2020 2020 2020 2020  .....           
+00029ee0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00029ef0: 2020 2020 2020 2063 6869 6c64 5f65 6c65         child_ele
+00029f00: 6d65 6e74 7320 3d20 7374 7275 6374 7572  ments = structur
+00029f10: 652e 6765 745f 656c 656d 656e 7473 2863  e.get_elements(c
+00029f20: 6869 6c64 5f73 686f 7274 6e61 6d65 290d  hild_shortname).
+00029f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00029f40: 2069 6620 6368 696c 645f 656c 656d 656e   if child_elemen
+00029f50: 7473 2069 7320 4e6f 6e65 206f 7220 6368  ts is None or ch
+00029f60: 696c 645f 656c 656d 656e 7473 203d 3d20  ild_elements == 
+00029f70: 5b5d 3a0d 0a20 2020 2020 2020 2020 2020  []:..           
+00029f80: 2020 2020 2020 2020 2066 6f75 6e64 5f63           found_c
+00029f90: 6869 6c64 5f65 6c65 6d65 6e74 7320 3d20  hild_elements = 
+00029fa0: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+00029fb0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00029fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00029fd0: 2020 666f 756e 645f 6368 696c 645f 656c    found_child_el
+00029fe0: 656d 656e 7473 203d 2054 7275 650d 0a20  ements = True.. 
+00029ff0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0002a000: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
+0002a010: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
+0002a020: 6e64 5f63 6869 6c64 5f65 6c65 6d65 6e74  nd_child_element
+0002a030: 7320 3d20 4661 6c73 650d 0a0d 0a20 2020  s = False....   
+0002a040: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0002a050: 666f 756e 645f 6368 696c 645f 656c 656d  found_child_elem
+0002a060: 656e 7473 3a0d 0a20 2020 2020 2020 2020  ents:..         
+0002a070: 2020 2020 2020 2023 4765 7420 7468 6520         #Get the 
+0002a080: 456c 656d 656e 740d 0a20 2020 2020 2020  Element..       
+0002a090: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
+0002a0a0: 203d 2073 656c 662e 656c 656d 656e 7473   = self.elements
+0002a0b0: 5b63 6869 6c64 5f73 686f 7274 6e61 6d65  [child_shortname
+0002a0c0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0002a0d0: 2020 2023 4372 6561 7465 2074 6865 2053     #Create the S
+0002a0e0: 7472 7563 7475 7265 456c 656d 656e 740d  tructureElement.
+0002a0f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002a100: 2073 7472 7563 7475 7265 2e5f 6164 645f   structure._add_
+0002a110: 656c 656d 656e 7428 5374 7275 6374 7572  element(Structur
+0002a120: 6545 6c65 6d65 6e74 2865 6c65 6d65 6e74  eElement(element
+0002a130: 3d65 6c65 6d65 6e74 2929 0d0a 2020 2020  =element))..    
+0002a140: 2020 2020 2020 2020 2020 2020 6368 696c              chil
+0002a150: 645f 656c 656d 656e 7473 203d 2073 7472  d_elements = str
+0002a160: 7563 7475 7265 2e67 6574 5f65 6c65 6d65  ucture.get_eleme
+0002a170: 6e74 7328 6368 696c 645f 7368 6f72 746e  nts(child_shortn
+0002a180: 616d 6529 0d0a 0d0a 2020 2020 2020 2020  ame)....        
+0002a190: 2020 2020 6966 2070 6172 656e 745f 656c      if parent_el
+0002a1a0: 656d 656e 7420 6973 206e 6f74 204e 6f6e  ement is not Non
+0002a1b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0002a1c0: 2020 2020 7374 7275 6374 7572 652e 7365      structure.se
+0002a1d0: 745f 6368 696c 645f 656c 656d 656e 745f  t_child_element_
+0002a1e0: 7061 7265 6e74 2863 6869 6c64 203d 2063  parent(child = c
+0002a1f0: 6869 6c64 5f65 6c65 6d65 6e74 735b 305d  hild_elements[0]
+0002a200: 2c20 7061 7265 6e74 203d 2070 6172 656e  , parent = paren
+0002a210: 745f 656c 656d 656e 7429 0d0a 2020 2020  t_element)..    
+0002a220: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0002a230: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0002a240: 7472 7563 7475 7265 2e73 6574 5f72 6f6f  tructure.set_roo
+0002a250: 745f 656c 656d 656e 7428 6368 696c 645f  t_element(child_
+0002a260: 656c 656d 656e 7473 5b30 5d29 0d0a 0d0a  elements[0])....
+0002a270: 2020 2020 2020 2020 6966 2073 796e 633a          if sync:
+0002a280: 0d0a 2020 2020 2020 2020 2020 2020 7374  ..            st
+0002a290: 7275 6374 7572 652e 7379 6e63 6872 6f6e  ructure.synchron
+0002a2a0: 6973 6528 290d 0a0d 0a20 2020 2064 6566  ise()....    def
+0002a2b0: 2073 796e 6368 726f 6e69 7365 2873 656c   synchronise(sel
+0002a2c0: 662c 7265 6578 706f 7274 3d54 7275 652c  f,reexport=True,
+0002a2d0: 7265 696d 706f 7274 3d46 616c 7365 2c70  reimport=False,p
+0002a2e0: 7269 6d61 7279 5f6b 6579 5f66 6965 6c64  rimary_key_field
+0002a2f0: 733d 5b27 5368 6f72 7420 4e61 6d65 275d  s=['Short Name']
+0002a300: 293a 0d0a 2020 2020 2020 2020 2727 2753  ):..        '''S
+0002a310: 796e 6368 726f 6e69 7365 2074 6865 2045  ynchronise the E
+0002a320: 6c65 6d65 6e74 7320 696e 2074 6865 2044  lements in the D
+0002a330: 696d 656e 7369 6f6e 2077 6974 6820 7468  imension with th
+0002a340: 6520 456d 706f 7765 7220 5369 7465 2e0d  e Empower Site..
+0002a350: 0a0d 0a20 2020 2020 2020 204e 6577 2065  ...        New e
+0002a360: 6c65 6d65 6e74 7320 7769 6c6c 2062 6520  lements will be 
+0002a370: 6372 6561 7465 6420 696e 2045 6d70 6f77  created in Empow
+0002a380: 6572 2061 6e64 2063 6861 6e67 6564 2066  er and changed f
+0002a390: 6965 6c64 2076 616c 7565 7320 7769 6c6c  ield values will
+0002a3a0: 2062 6520 7570 6461 7465 6420 696e 2074   be updated in t
+0002a3b0: 6865 2045 6d70 6f77 6572 2053 6974 650d  he Empower Site.
+0002a3c0: 0a20 2020 2020 2020 2027 2727 0d0a 0d0a  .        '''....
+0002a3d0: 2020 2020 2020 2020 7365 6c66 2e65 6c65          self.ele
+0002a3e0: 6d65 6e74 732e 7379 6e63 6872 6f6e 6973  ments.synchronis
+0002a3f0: 6528 7265 6578 706f 7274 3d72 6565 7870  e(reexport=reexp
+0002a400: 6f72 742c 7265 696d 706f 7274 3d72 6569  ort,reimport=rei
+0002a410: 6d70 6f72 742c 7072 696d 6172 795f 6b65  mport,primary_ke
+0002a420: 795f 6669 656c 6473 3d70 7269 6d61 7279  y_fields=primary
+0002a430: 5f6b 6579 5f66 6965 6c64 7329 0d0a 0d0a  _key_fields)....
+0002a440: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+0002a450: 2020 2064 6566 2065 6c65 6d65 6e74 5f64     def element_d
+0002a460: 6174 6166 7261 6d65 2873 656c 6629 3a0d  ataframe(self):.
+0002a470: 0a20 2020 2020 2020 2072 6169 7365 2053  .        raise S
+0002a480: 7973 7465 6d45 7272 6f72 2827 5468 6973  ystemError('This
+0002a490: 2070 726f 7065 7274 7920 6973 2064 6570   property is dep
+0002a4a0: 7265 6361 7465 6420 2d20 7573 6520 4469  recated - use Di
+0002a4b0: 6d65 6e73 696f 6e2e 656c 656d 656e 7473  mension.elements
+0002a4c0: 2e64 6174 6166 7261 6d65 2069 6e73 7465  .dataframe inste
+0002a4d0: 6164 2729 0d0a 0d0a 0d0a 2020 2020 6465  ad')......    de
+0002a4e0: 6620 5f67 6574 5f73 696d 706c 655f 7472  f _get_simple_tr
+0002a4f0: 616e 736c 6174 696f 6e5f 6466 2873 656c  anslation_df(sel
+0002a500: 662c 6f75 7470 7574 5f63 6f6c 756d 6e5f  f,output_column_
+0002a510: 6e61 6d65 2c66 6965 6c64 5f73 686f 7274  name,field_short
+0002a520: 6e61 6d65 293a 0d0a 2020 2020 2020 2020  name):..        
+0002a530: 6966 2066 6965 6c64 5f73 686f 7274 6e61  if field_shortna
+0002a540: 6d65 2069 7320 4e6f 6e65 3a0d 0a20 2020  me is None:..   
+0002a550: 2020 2020 2020 2020 2064 6620 3d20 7365           df = se
+0002a560: 6c66 2e65 6c65 6d65 6e74 732e 6461 7461  lf.elements.data
+0002a570: 6672 616d 655b 5b27 4944 272c 2753 686f  frame[['ID','Sho
+0002a580: 7274 204e 616d 6527 2c27 4c6f 6e67 204e  rt Name','Long N
+0002a590: 616d 6527 5d5d 2e63 6f70 7928 290d 0a20  ame']].copy().. 
+0002a5a0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0002a5b0: 2020 2020 2020 2020 2020 6466 203d 2073            df = s
+0002a5c0: 656c 662e 656c 656d 656e 7473 2e64 6174  elf.elements.dat
+0002a5d0: 6166 7261 6d65 5b5b 2749 4427 2c27 5368  aframe[['ID','Sh
+0002a5e0: 6f72 7420 4e61 6d65 272c 274c 6f6e 6720  ort Name','Long 
+0002a5f0: 4e61 6d65 272c 6669 656c 645f 7368 6f72  Name',field_shor
+0002a600: 746e 616d 655d 5d2e 636f 7079 2829 0d0a  tname]].copy()..
+0002a610: 0d0a 2020 2020 2020 2020 6466 2e72 656e  ..        df.ren
+0002a620: 616d 6528 636f 6c75 6d6e 733d 7b63 6f6c  ame(columns={col
+0002a630: 3a27 4c4b 5550 2027 2b63 6f6c 2066 6f72  :'LKUP '+col for
+0002a640: 2063 6f6c 2069 6e20 6466 2e63 6f6c 756d   col in df.colum
+0002a650: 6e73 7d2c 696e 706c 6163 653d 5472 7565  ns},inplace=True
+0002a660: 290d 0a20 2020 2020 2020 2064 665b 6f75  )..        df[ou
+0002a670: 7470 7574 5f63 6f6c 756d 6e5f 6e61 6d65  tput_column_name
+0002a680: 5d3d 6466 5b27 4c4b 5550 2049 4427 5d0d  ]=df['LKUP ID'].
+0002a690: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002a6a0: 6466 0d0a 0d0a 2020 2020 6465 6620 5f6c  df....    def _l
+0002a6b0: 6f61 645f 7365 6375 7269 7479 2873 656c  oad_security(sel
+0002a6c0: 6629 3a0d 0a20 2020 2020 2020 2023 5468  f):..        #Th
+0002a6d0: 6520 5f45 6c65 6d65 6e74 7347 6574 7465  e _ElementsGette
+0002a6e0: 7220 6465 7465 726d 696e 6573 2069 6620  r determines if 
+0002a6f0: 7365 6375 7269 7479 2069 7320 7265 6164  security is read
+0002a700: 0d0a 2020 2020 2020 2020 7365 6c66 2e65  ..        self.e
+0002a710: 6c65 6d65 6e74 732e 5f6c 6f61 645f 7365  lements._load_se
+0002a720: 6375 7269 7479 2829 0d0a 0d0a 636c 6173  curity()....clas
+0002a730: 7320 456c 656d 656e 7428 6f62 6a65 6374  s Element(object
+0002a740: 293a 0d0a 2020 2020 2727 2741 6e20 456d  ):..    '''An Em
+0002a750: 706f 7765 7220 456c 656d 656e 742e 2054  power Element. T
+0002a760: 6865 2045 6c65 6d65 6e74 2069 7320 6173  he Element is as
+0002a770: 2077 6f75 6c64 2062 6520 666f 756e 6420   would be found 
+0002a780: 6f6e 2074 6865 205b 416c 6c5d 2053 7472  on the [All] Str
+0002a790: 7563 7475 7265 2069 6e20 456d 706f 7765  ucture in Empowe
+0002a7a0: 722e 0d0a 0d0a 2020 2020 456c 656d 656e  r.....    Elemen
+0002a7b0: 7427 7320 646f 6e27 7420 6861 7665 2070  t's don't have p
+0002a7c0: 6172 656e 7473 206f 7220 6368 696c 6472  arents or childr
+0002a7d0: 656e 202d 2074 6861 7420 6973 2077 6861  en - that is wha
+0002a7e0: 7420 6120 5374 7275 6374 7572 6545 6c65  t a StructureEle
+0002a7f0: 6d65 6e74 2068 6173 2e0d 0a20 2020 2027  ment has...    '
+0002a800: 2727 0d0a 2020 2020 6465 6620 5f5f 696e  ''..    def __in
+0002a810: 6974 5f5f 2873 656c 660d 0a20 2020 2020  it__(self..     
+0002a820: 2020 2020 2020 2020 2020 202c 7368 6f72             ,shor
+0002a830: 746e 616d 653d 4e6f 6e65 0d0a 2020 2020  tname=None..    
+0002a840: 2020 2020 2020 2020 2020 2020 2c6c 6f6e              ,lon
+0002a850: 676e 616d 653d 4e6f 6e65 0d0a 2020 2020  gname=None..    
+0002a860: 2020 2020 2020 2020 2020 2020 2c64 6573              ,des
+0002a870: 6372 6970 7469 6f6e 3d4e 6f6e 650d 0a20  cription=None.. 
+0002a880: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0002a890: 7068 7973 6964 3d4e 6f6e 650d 0a20 2020  physid=None..   
+0002a8a0: 2020 2020 2020 2020 2020 2020 202c 6772               ,gr
+0002a8b0: 6f75 705f 6f6e 6c79 3d4e 6f6e 650d 0a20  oup_only=None.. 
+0002a8c0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0002a8d0: 6361 6c63 756c 6174 696f 6e5f 7374 6174  calculation_stat
+0002a8e0: 7573 3d4e 6f6e 650d 0a20 2020 2020 2020  us=None..       
+0002a8f0: 2020 2020 2020 2020 202c 6361 6c63 756c           ,calcul
+0002a900: 6174 696f 6e3d 4e6f 6e65 0d0a 2020 2020  ation=None..    
+0002a910: 2020 2020 2020 2020 2020 2020 2c63 6f6c              ,col
+0002a920: 6f75 723d 4e6f 6e65 0d0a 2020 2020 2020  our=None..      
+0002a930: 2020 2020 2020 2020 2020 2c6d 6561 7375            ,measu
+0002a940: 7265 3d4e 6f6e 650d 0a20 2020 2020 2020  re=None..       
+0002a950: 2020 2020 2020 2020 202c 6669 656c 6473           ,fields
+0002a960: 3d4e 6f6e 650d 0a20 2020 2020 2020 2020  =None..         
+0002a970: 2020 2020 2020 202c 6f76 6572 7269 6465         ,override
+0002a980: 5f73 686f 7274 6e61 6d65 5f6c 656e 6774  _shortname_lengt
+0002a990: 685f 7275 6c65 203d 2046 616c 7365 0d0a  h_rule = False..
+0002a9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002a9b0: 2c64 696d 656e 7369 6f6e 203d 204e 6f6e  ,dimension = Non
+0002a9c0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0002a9d0: 2020 2029 3a0d 0a20 2020 2020 2020 2027     ):..        '
+0002a9e0: 2727 4372 6561 7465 2061 206e 6577 2045  ''Create a new E
+0002a9f0: 6d70 6f77 6572 2045 6c65 6d65 6e74 2e0d  mpower Element..
+0002aa00: 0a0d 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0002aa10: 6d20 7368 6f72 746e 616d 653a 2041 2074  m shortname: A t
+0002aa20: 656e 2d63 6861 7261 6374 6572 2028 6f72  en-character (or
+0002aa30: 2073 686f 7274 6572 2920 7374 7269 6e67   shorter) string
+0002aa40: 2077 6974 6820 7468 6520 7368 6f72 746e   with the shortn
+0002aa50: 616d 6520 666f 7220 7468 6520 456c 656d  ame for the Elem
+0002aa60: 656e 742e 2049 6620 7468 6973 2069 7320  ent. If this is 
+0002aa70: 6e6f 7420 7365 742c 2045 6d70 6f77 6572  not set, Empower
+0002aa80: 2077 696c 6c20 6372 6561 7465 206f 6e65   will create one
+0002aa90: 2077 6865 6e20 7468 6973 2045 6c65 6d65   when this Eleme
+0002aaa0: 6e74 2069 7320 7379 6e63 6872 6f6e 6973  nt is synchronis
+0002aab0: 6564 2e0d 0a20 2020 2020 2020 203a 7061  ed...        :pa
+0002aac0: 7261 6d20 6c6f 6e67 6e61 6d65 3a20 5468  ram longname: Th
+0002aad0: 6520 6e61 6d65 206f 6620 7468 6520 456c  e name of the El
+0002aae0: 656d 656e 742c 2061 7320 7769 6c6c 2062  ement, as will b
+0002aaf0: 6520 6469 7370 6c61 7965 6420 696e 2064  e displayed in d
+0002ab00: 6173 6862 6f61 7264 730d 0a20 2020 2020  ashboards..     
+0002ab10: 2020 203a 7061 7261 6d20 6465 7363 7269     :param descri
+0002ab20: 7074 696f 6e3a 2041 206c 6f6e 6765 7220  ption: A longer 
+0002ab30: 6465 7363 7269 7074 696f 6e20 6f66 2074  description of t
+0002ab40: 6865 2045 6c65 6d65 6e74 2c20 6173 2073  he Element, as s
+0002ab50: 746f 7265 6420 696e 2045 6d70 6f77 6572  tored in Empower
+0002ab60: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0002ab70: 2070 6879 7369 643a 2074 6865 2070 6879   physid: the phy
+0002ab80: 7369 6361 6c20 6964 656e 7469 6669 6572  sical identifier
+0002ab90: 206f 6620 7468 6520 456d 706f 7765 7220   of the Empower 
+0002aba0: 656c 656d 656e 7420 2d20 7468 6572 6520  element - there 
+0002abb0: 6973 206e 6f20 6e65 6564 2074 6f20 7365  is no need to se
+0002abc0: 7420 7468 6973 2c20 6173 2045 6d70 6f77  t this, as Empow
+0002abd0: 6572 2077 696c 6c20 7365 7420 6974 2061  er will set it a
+0002abe0: 7574 6f6d 6174 6963 616c 6c79 2077 6865  utomatically whe
+0002abf0: 6e20 7468 6973 2045 6c65 6d65 6e74 2069  n this Element i
+0002ac00: 7320 7379 6e63 6872 6f6e 6973 6564 2e0d  s synchronised..
+0002ac10: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0002ac20: 6772 6f75 705f 6f6e 6c79 3a20 5365 7420  group_only: Set 
+0002ac30: 746f 2027 4772 6f75 7027 2069 6620 7468  to 'Group' if th
+0002ac40: 6973 2069 7320 6120 6772 6f75 702d 6f6e  is is a group-on
+0002ac50: 6c79 2045 6c65 6d65 6e74 0d0a 2020 2020  ly Element..    
+0002ac60: 2020 2020 3a70 6172 616d 2063 616c 6375      :param calcu
+0002ac70: 6c61 7469 6f6e 5f73 7461 7475 733a 2027  lation_status: '
+0002ac80: 5265 616c 2720 6f72 2027 4361 6c63 756c  Real' or 'Calcul
+0002ac90: 6174 6564 270d 0a20 2020 2020 2020 203a  ated'..        :
+0002aca0: 7061 7261 6d20 6361 6c63 756c 6174 696f  param calculatio
+0002acb0: 6e3a 2054 6865 2045 6d70 6f77 6572 2063  n: The Empower c
+0002acc0: 616c 6375 6c61 7469 6f6e 2066 6f72 2074  alculation for t
+0002acd0: 6869 7320 656c 656d 656e 742c 2061 7320  his element, as 
+0002ace0: 6120 7374 7269 6e67 2e20 5468 6973 2063  a string. This c
+0002acf0: 616e 2062 6520 4e6f 6e65 2066 6f72 206e  an be None for n
+0002ad00: 6f6e 2d63 616c 6375 6c61 7465 6420 656c  on-calculated el
+0002ad10: 656d 656e 7473 0d0a 2020 2020 2020 2020  ements..        
+0002ad20: 3a70 6172 616d 2063 6f6c 6f75 723a 2045  :param colour: E
+0002ad30: 6d70 6f77 6572 2063 6f6c 6f75 7220 6f66  mpower colour of
+0002ad40: 2074 6865 2045 6c65 6d65 6e74 0d0a 2020   the Element..  
+0002ad50: 2020 2020 2020 3a70 6172 616d 206d 6561        :param mea
+0002ad60: 7375 7265 3a20 2045 6d70 6f77 6572 206d  sure:  Empower m
+0002ad70: 6561 7375 7265 2066 6f72 2074 6865 2045  easure for the E
+0002ad80: 6c65 6d65 6e74 0d0a 2020 2020 2020 2020  lement..        
+0002ad90: 3a70 6172 616d 2066 6965 6c64 733a 2041  :param fields: A
+0002ada0: 2064 6963 7469 6f6e 6172 7920 6f66 2066   dictionary of f
+0002adb0: 6965 6c64 732e 204b 6579 7320 6d75 7374  ields. Keys must
+0002adc0: 2062 6520 7468 6520 6669 656c 6420 6c6f   be the field lo
+0002add0: 6e67 6e61 6d65 2061 7320 7573 6564 2069  ngname as used i
+0002ade0: 6e20 456d 706f 7765 722e 0d0a 2020 2020  n Empower...    
+0002adf0: 2020 2020 3a70 6172 616d 206f 7665 7272      :param overr
+0002ae00: 6964 655f 7368 6f72 746e 616d 655f 6c65  ide_shortname_le
+0002ae10: 6e67 7468 5f72 756c 653a 2041 6c6c 6f77  ngth_rule: Allow
+0002ae20: 7320 656c 656d 656e 7473 2074 6f20 6265  s elements to be
+0002ae30: 2063 7265 6174 6564 2069 6e20 7079 7468   created in pyth
+0002ae40: 6f6e 2077 6974 6820 7368 6f72 746e 616d  on with shortnam
+0002ae50: 6573 206c 6f6e 6765 7220 7468 616e 2031  es longer than 1
+0002ae60: 3020 6368 6172 6163 7465 7273 2e20 5468  0 characters. Th
+0002ae70: 6573 6520 7368 6f72 746e 616d 6573 2077  ese shortnames w
+0002ae80: 696c 6c20 6265 206f 7665 7277 7269 7474  ill be overwritt
+0002ae90: 656e 2062 7920 456d 706f 7765 7220 7768  en by Empower wh
+0002aea0: 656e 2074 6865 2065 6c65 6d65 6e74 7320  en the elements 
+0002aeb0: 6172 6520 7379 6e63 6872 6f6e 6973 6564  are synchronised
+0002aec0: 2077 6974 6820 456d 706f 7765 722e 0d0a   with Empower...
+0002aed0: 2020 2020 2020 2020 3a70 6172 616d 2064          :param d
+0002aee0: 696d 656e 7369 6f6e 3a20 7079 6d70 782e  imension: pympx.
+0002aef0: 4469 6d65 6e73 696f 6e20 6f62 6a65 6374  Dimension object
+0002af00: 2074 6861 7420 7468 6973 2065 6c65 6d65   that this eleme
+0002af10: 6e74 2062 656c 6f6e 6773 2074 6f0d 0a20  nt belongs to.. 
+0002af20: 2020 2020 2020 2027 2727 0d0a 2020 2020         '''..    
+0002af30: 2020 2020 6966 2066 6965 6c64 7320 6973      if fields is
+0002af40: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0002af50: 2020 2020 6669 656c 6473 203d 207b 7d0d      fields = {}.
+0002af60: 0a20 2020 2020 2020 200d 0a20 2020 2020  .        ..     
+0002af70: 2020 2069 6620 7368 6f72 746e 616d 6520     if shortname 
+0002af80: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+0002af90: 6c65 6e28 7368 6f72 746e 616d 6529 203e  len(shortname) >
+0002afa0: 206c 6c75 2e73 686f 7274 6e61 6d65 5f73   llu.shortname_s
+0002afb0: 697a 6520 616e 6420 6e6f 7420 6f76 6572  ize and not over
+0002afc0: 7269 6465 5f73 686f 7274 6e61 6d65 5f6c  ride_shortname_l
+0002afd0: 656e 6774 685f 7275 6c65 3a0d 0a20 2020  ength_rule:..   
+0002afe0: 2020 2020 2020 2020 206d 7367 3d27 456c           msg='El
+0002aff0: 656d 656e 7473 2073 686f 7274 6e61 6d65  ements shortname
+0002b000: 7320 6d75 7374 2062 6520 6e6f 206c 6f6e  s must be no lon
+0002b010: 6765 7220 7468 616e 206e 6c69 6d69 7420  ger than nlimit 
+0002b020: 6368 6172 6163 7465 7273 2e20 5368 6f72  characters. Shor
+0002b030: 746e 616d 653a 272b 7374 7228 7368 6f72  tname:'+str(shor
+0002b040: 746e 616d 6529 2b27 2069 7320 272b 7374  tname)+' is '+st
+0002b050: 7228 6c65 6e28 7368 6f72 746e 616d 6529  r(len(shortname)
+0002b060: 292b 2720 6368 6172 6163 7465 7273 206c  )+' characters l
+0002b070: 6f6e 6727 0d0a 2020 2020 2020 2020 2020  ong'..          
+0002b080: 2020 6c6f 672e 6572 726f 7228 6d73 6729    log.error(msg)
+0002b090: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0002b0a0: 6973 6520 6d70 6578 2e43 6f6d 706c 6574  ise mpex.Complet
+0002b0b0: 656c 794c 6f67 6765 6445 7272 6f72 286d  elyLoggedError(m
+0002b0c0: 7367 290d 0a0d 0a20 2020 2020 2020 2023  sg)....        #
+0002b0d0: 7365 7420 7068 7973 6964 2066 6972 7374  set physid first
+0002b0e0: 2061 7320 6974 2069 7320 6472 6976 6573   as it is drives
+0002b0f0: 202e 6d61 7374 6572 6564 2061 6e64 2073   .mastered and s
+0002b100: 6920 6e6f 7420 6120 6669 656c 640d 0a20  i not a field.. 
+0002b110: 2020 2020 2020 2073 656c 662e 7068 7973         self.phys
+0002b120: 6964 2020 2020 2020 2020 2020 2020 203d  id             =
+0002b130: 2070 6879 7369 640d 0a0d 0a20 2020 2020   physid....     
+0002b140: 2020 2023 4d75 7374 2073 6574 2064 696d     #Must set dim
+0002b150: 656e 7369 6f6e 2062 6566 6f72 6520 6669  ension before fi
+0002b160: 656c 6473 202d 206f 7220 7765 2063 616e  elds - or we can
+0002b170: 6e6f 7420 7365 7420 6669 656c 6473 2063  not set fields c
+0002b180: 6f72 7265 6374 6c79 0d0a 2020 2020 2020  orrectly..      
+0002b190: 2020 7365 6c66 2e64 696d 656e 7369 6f6e    self.dimension
+0002b1a0: 203d 2064 696d 656e 7369 6f6e 0d0a 0d0a   = dimension....
+0002b1b0: 2020 2020 2020 2020 2323 696e 6974 6961          ##initia
+0002b1c0: 6c69 7365 2074 6865 2066 6965 6c64 7320  lise the fields 
+0002b1d0: 6469 6374 696f 6e61 7279 0d0a 2020 2020  dictionary..    
+0002b1e0: 2020 2020 2323 616e 7920 6b65 7973 2072      ##any keys r
+0002b1f0: 656c 6174 6564 2074 6f20 7468 6520 6174  elated to the at
+0002b200: 7472 6962 7574 6573 206f 6620 456c 656d  tributes of Elem
+0002b210: 656e 7420 7769 6c6c 2062 6520 6f76 6572  ent will be over
+0002b220: 7772 6974 7465 6e20 7768 656e 2074 6865  written when the
+0002b230: 2061 7474 7269 6275 7465 7320 6172 6520   attributes are 
+0002b240: 7365 740d 0a20 2020 2020 2020 2023 7072  set..        #pr
+0002b250: 696e 7428 2773 686f 7274 6e61 6d65 2027  int('shortname '
+0002b260: 2b73 7472 2873 686f 7274 6e61 6d65 292b  +str(shortname)+
+0002b270: 2720 7068 7973 6964 2027 2b73 7472 2870  ' physid '+str(p
+0002b280: 6879 7369 6429 2b20 2720 656c 656d 656e  hysid)+ ' elemen
+0002b290: 7420 272b 7374 7228 7365 6c66 2929 0d0a  t '+str(self))..
+0002b2a0: 2020 2020 2020 2020 2369 6620 7368 6f72          #if shor
+0002b2b0: 746e 616d 6520 6973 204e 6f6e 653a 0d0a  tname is None:..
+0002b2c0: 2020 2020 2020 2020 2320 2020 2072 6169          #    rai
+0002b2d0: 7365 2053 7973 7465 6d45 7272 6f72 2829  se SystemError()
+0002b2e0: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0002b2f0: 6669 656c 6473 203d 205f 4669 656c 6473  fields = _Fields
+0002b300: 4765 7474 6572 2873 656c 662c 6669 656c  Getter(self,fiel
+0002b310: 6473 2c69 6e69 7469 616c 6973 655f 6173  ds,initialise_as
+0002b320: 5f65 6469 7465 6420 3d20 7068 7973 6964  _edited = physid
+0002b330: 2069 7320 4e6f 6e65 290d 0a0d 0a20 2020   is None)....   
+0002b340: 2020 2020 2023 5365 7420 7468 6520 696e       #Set the in
+0002b350: 7465 726e 616c 2065 6c65 6d65 6e74 7320  ternal elements 
+0002b360: 2d20 7468 656e 2077 6520 6361 6e20 7573  - then we can us
+0002b370: 6520 7468 6520 7365 7474 6572 7320 666f  e the setters fo
+0002b380: 7220 7468 6520 6578 7465 726e 616c 6c79  r the externally
+0002b390: 2076 6973 6962 6c65 2076 6572 7369 6f6e   visible version
+0002b3a0: 206f 6620 7468 6520 7361 6d65 0d0a 2020   of the same..  
+0002b3b0: 2020 2020 2020 2354 6869 7320 7761 7920        #This way 
+0002b3c0: 7765 2063 616e 206b 6565 7020 7468 6520  we can keep the 
+0002b3d0: 6669 656c 6473 2064 6963 7469 6f6e 6172  fields dictionar
+0002b3e0: 7920 696e 2073 796e 6320 7769 7468 2074  y in sync with t
+0002b3f0: 6865 2069 6e74 6572 6e61 6c20 656c 656d  he internal elem
+0002b400: 656e 7473 0d0a 2020 2020 2020 2020 7365  ents..        se
+0002b410: 6c66 2e5f 7368 6f72 746e 616d 6520 2020  lf._shortname   
+0002b420: 2020 2020 2020 203d 204e 6f6e 650d 0a20         = None.. 
+0002b430: 2020 2020 2020 2073 656c 662e 5f6c 6f6e         self._lon
+0002b440: 676e 616d 6520 2020 2020 2020 2020 2020  gname           
+0002b450: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+0002b460: 7365 6c66 2e5f 6465 7363 7269 7074 696f  self._descriptio
+0002b470: 6e20 2020 2020 2020 203d 204e 6f6e 650d  n        = None.
+0002b480: 0a20 2020 2020 2020 2073 656c 662e 5f67  .        self._g
+0002b490: 726f 7570 5f6f 6e6c 7920 2020 2020 2020  roup_only       
+0002b4a0: 2020 3d20 4e6f 6e65 0d0a 2020 2020 2020    = None..      
+0002b4b0: 2020 7365 6c66 2e5f 6361 6c63 756c 6174    self._calculat
+0002b4c0: 696f 6e5f 7374 6174 7573 203d 204e 6f6e  ion_status = Non
+0002b4d0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+0002b4e0: 5f63 616c 6375 6c61 7469 6f6e 2020 2020  _calculation    
+0002b4f0: 2020 2020 3d20 4e6f 6e65 0d0a 2020 2020      = None..    
+0002b500: 2020 2020 2370 6879 7369 6420 6361 6c63      #physid calc
+0002b510: 756c 6174 696f 6e20 6973 2066 6f72 2063  ulation is for c
+0002b520: 6f6d 7061 7269 6e67 2074 6f20 7468 6520  omparing to the 
+0002b530: 456d 706f 7765 7220 6578 706f 7274 0d0a  Empower export..
+0002b540: 2020 2020 2020 2020 7365 6c66 2e5f 7068          self._ph
+0002b550: 7973 6964 5f63 616c 6375 6c61 7469 6f6e  ysid_calculation
+0002b560: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+0002b570: 2073 656c 662e 5f63 6f6c 6f75 7220 2020   self._colour   
+0002b580: 2020 2020 2020 2020 2020 3d20 4e6f 6e65            = None
+0002b590: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0002b5a0: 6d65 6173 7572 6520 2020 2020 2020 2020  measure         
+0002b5b0: 2020 203d 204e 6f6e 650d 0a0d 0a20 2020     = None....   
+0002b5c0: 2020 2020 2073 656c 662e 7368 6f72 746e       self.shortn
+0002b5d0: 616d 6520 203d 2073 686f 7274 6e61 6d65  ame  = shortname
+0002b5e0: 0d0a 2020 2020 2020 2020 2369 6620 6c6f  ..        #if lo
+0002b5f0: 6e67 6e61 6d65 2069 7320 4e6f 6e65 3a0d  ngname is None:.
+0002b600: 0a20 2020 2020 2020 2023 2020 2020 7365  .        #    se
+0002b610: 6c66 2e6c 6f6e 676e 616d 6520 2020 3d20  lf.longname   = 
+0002b620: 7368 6f72 746e 616d 650d 0a20 2020 2020  shortname..     
+0002b630: 2020 2023 656c 7365 3a0d 0a20 2020 2020     #else:..     
+0002b640: 2020 2073 656c 662e 6c6f 6e67 6e61 6d65     self.longname
+0002b650: 2020 203d 206c 6f6e 676e 616d 650d 0a0d     = longname...
+0002b660: 0a20 2020 2020 2020 2023 6966 2064 6573  .        #if des
+0002b670: 6372 6970 7469 6f6e 2069 7320 4e6f 6e65  cription is None
+0002b680: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
+0002b690: 7365 6c66 2e64 6573 6372 6970 7469 6f6e  self.description
+0002b6a0: 2020 2020 3d20 7365 6c66 2e5f 6c6f 6e67      = self._long
+0002b6b0: 6e61 6d65 0d0a 2020 2020 2020 2020 2365  name..        #e
+0002b6c0: 6c73 653a 0d0a 2020 2020 2020 2020 7365  lse:..        se
+0002b6d0: 6c66 2e64 6573 6372 6970 7469 6f6e 2020  lf.description  
+0002b6e0: 2020 3d20 6465 7363 7269 7074 696f 6e0d    = description.
+0002b6f0: 0a0d 0a20 2020 2020 2020 2023 7072 696e  ...        #prin
+0002b700: 7428 2773 6574 2064 6573 6372 6970 7469  t('set descripti
+0002b710: 6f6e 2074 6f3a 2022 272b 7365 6c66 2e64  on to: "'+self.d
+0002b720: 6573 6372 6970 7469 6f6e 2b27 2220 6672  escription+'" fr
+0002b730: 6f6d 3a20 2227 2b73 7472 2864 6573 6372  om: "'+str(descr
+0002b740: 6970 7469 6f6e 292b 2722 2729 0d0a 0d0a  iption)+'"')....
+0002b750: 2020 2020 2020 2020 7365 6c66 2e67 726f          self.gro
+0002b760: 7570 5f6f 6e6c 7920 2020 2020 2020 2020  up_only         
+0002b770: 3d20 6772 6f75 705f 6f6e 6c79 0d0a 2020  = group_only..  
+0002b780: 2020 2020 2020 7365 6c66 2e63 616c 6375        self.calcu
+0002b790: 6c61 7469 6f6e 5f73 7461 7475 7320 3d20  lation_status = 
+0002b7a0: 6361 6c63 756c 6174 696f 6e5f 7374 6174  calculation_stat
+0002b7b0: 7573 0d0a 2020 2020 2020 2020 7365 6c66  us..        self
+0002b7c0: 2e63 616c 6375 6c61 7469 6f6e 2020 2020  .calculation    
+0002b7d0: 2020 2020 3d20 6361 6c63 756c 6174 696f      = calculatio
+0002b7e0: 6e0d 0a20 2020 2020 2020 2073 656c 662e  n..        self.
+0002b7f0: 636f 6c6f 7572 2020 2020 2020 2020 2020  colour          
+0002b800: 2020 203d 2063 6f6c 6f75 720d 0a20 2020     = colour..   
+0002b810: 2020 2020 2069 6620 7365 6c66 2e64 696d       if self.dim
+0002b820: 656e 7369 6f6e 2069 7320 4e6f 6e65 206f  ension is None o
+0002b830: 7220 7365 6c66 2e64 696d 656e 7369 6f6e  r self.dimension
+0002b840: 2e69 6e64 6578 203c 2038 3a0d 0a20 2020  .index < 8:..   
+0002b850: 2020 2020 2020 2020 2073 656c 662e 6d65           self.me
+0002b860: 6173 7572 6520 2020 2020 2020 2020 2020  asure           
+0002b870: 203d 206d 6561 7375 7265 0d0a 0d0a 2020   = measure....  
+0002b880: 2020 2020 2020 2353 6574 2073 656c 662e        #Set self.
+0002b890: 7379 6e63 6865 6420 6174 2074 6865 2065  synched at the e
+0002b8a0: 6e64 202d 2077 6865 6e20 6372 6561 7469  nd - when creati
+0002b8b0: 6e67 2073 796e 6368 6564 2069 7320 7472  ng synched is tr
+0002b8c0: 7565 2069 6620 6974 2068 6173 2062 6565  ue if it has bee
+0002b8d0: 6e20 6d61 7374 6572 6564 0d0a 2020 2020  n mastered..    
+0002b8e0: 2020 2020 7365 6c66 2e5f 7379 6e63 6865      self._synche
+0002b8f0: 6420 2020 2020 2020 2020 2020 3d20 7365  d           = se
+0002b900: 6c66 2e6d 6173 7465 7265 640d 0a20 2020  lf.mastered..   
+0002b910: 2020 2020 2073 656c 662e 5f65 6469 7465       self._edite
+0002b920: 6420 2020 2020 2020 2020 2020 203d 2046  d            = F
+0002b930: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
+0002b940: 6966 206e 6f74 2070 6879 7369 6420 6973  if not physid is
+0002b950: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0002b960: 2020 2020 7365 6c66 2e5f 6669 656c 6473      self._fields
+0002b970: 2e72 6573 6574 5f65 6469 745f 7374 6174  .reset_edit_stat
+0002b980: 7573 2829 0d0a 0d0a 2020 2020 2020 2020  us()....        
+0002b990: 7365 6c66 2e5f 7365 6375 7269 7479 2020  self._security  
+0002b9a0: 2020 2020 2020 2020 3d20 4e6f 6e65 0d0a          = None..
+0002b9b0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
+0002b9c0: 0a20 2020 2064 6566 206d 6173 7465 7265  .    def mastere
+0002b9d0: 6428 7365 6c66 293a 0d0a 2020 2020 2020  d(self):..      
+0002b9e0: 2020 2727 2754 7275 6520 6966 2074 6869    '''True if thi
+0002b9f0: 7320 656c 656d 656e 7420 6861 7320 6265  s element has be
+0002ba00: 656e 2063 7265 6174 6564 2069 6e20 456d  en created in Em
+0002ba10: 706f 7765 722c 2046 616c 7365 206f 7468  power, False oth
+0002ba20: 6572 7769 7365 2e20 5365 6520 2e73 796e  erwise. See .syn
+0002ba30: 6368 6564 2066 6f72 2074 6865 2073 796e  ched for the syn
+0002ba40: 6368 726f 6e69 7361 7469 6f6e 2028 692e  chronisation (i.
+0002ba50: 652e 2073 6176 6564 2920 7374 6174 7573  e. saved) status
+0002ba60: 2727 270d 0a20 2020 2020 2020 2072 6574  '''..        ret
+0002ba70: 7572 6e20 6e6f 7420 7365 6c66 2e70 6879  urn not self.phy
+0002ba80: 7369 6420 6973 204e 6f6e 650d 0a0d 0a20  sid is None.... 
+0002ba90: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+0002baa0: 2020 6465 6620 7379 6e63 6865 6428 7365    def synched(se
+0002bab0: 6c66 293a 0d0a 2020 2020 2020 2020 2727  lf):..        ''
+0002bac0: 2754 7275 6520 6966 2061 6c6c 206f 6620  'True if all of 
+0002bad0: 7468 6520 6174 7472 6962 7574 6573 206f  the attributes o
+0002bae0: 6620 7468 6973 2065 6c65 6d65 6e74 2068  f this element h
+0002baf0: 6176 6520 6265 656e 2073 796e 6368 726f  ave been synchro
+0002bb00: 6e69 7365 6420 7769 7468 2045 6d70 6f77  nised with Empow
+0002bb10: 6572 2e20 5769 6c6c 2062 6520 7472 7565  er. Will be true
+0002bb20: 2061 6674 6572 2072 6561 6469 6e67 2074   after reading t
+0002bb30: 6865 2045 6c65 6d65 6e74 2066 726f 6d20  he Element from 
+0002bb40: 456d 706f 7765 722c 206f 7220 6166 7465  Empower, or afte
+0002bb50: 7220 7379 6e63 6872 6f6e 6973 6174 696f  r synchronisatio
+0002bb60: 6e2e 2057 696c 6c20 6265 2046 616c 7365  n. Will be False
+0002bb70: 2069 6620 7468 6520 456c 656d 656e 7420   if the Element 
+0002bb80: 6861 7320 6265 656e 2065 6469 7465 642c  has been edited,
+0002bb90: 206f 7220 646f 6573 206e 6f74 2065 7869   or does not exi
+0002bba0: 7374 2069 6e20 456d 706f 7765 7220 6174  st in Empower at
+0002bbb0: 2061 6c6c 2e27 2727 0d0a 2020 2020 2020   all.'''..      
+0002bbc0: 2020 7265 7475 726e 2073 656c 662e 6d61    return self.ma
+0002bbd0: 7374 6572 6564 2061 6e64 206e 6f74 2073  stered and not s
+0002bbe0: 656c 662e 6564 6974 6564 0d0a 0d0a 2020  elf.edited....  
+0002bbf0: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+0002bc00: 2064 6566 2065 6469 7465 6428 7365 6c66   def edited(self
+0002bc10: 293a 0d0a 2020 2020 2020 2020 2727 2754  ):..        '''T
+0002bc20: 7275 6520 6966 2074 6869 7320 456c 656d  rue if this Elem
+0002bc30: 656e 7420 6861 7320 6265 656e 2063 6861  ent has been cha
+0002bc40: 6e67 6564 2073 696e 6365 2063 7265 6174  nged since creat
+0002bc50: 696f 6e2c 206f 7220 7369 6e63 6520 7265  ion, or since re
+0002bc60: 6164 696e 6720 6974 2066 726f 6d20 456d  ading it from Em
+0002bc70: 706f 7765 722e 2727 270d 0a20 2020 2020  power.'''..     
+0002bc80: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0002bc90: 6564 6974 6564 0d0a 0d0a 2020 2020 4070  edited....    @p
+0002bca0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+0002bcb0: 2073 686f 7274 636f 6465 2873 656c 6629   shortcode(self)
+0002bcc0: 3a0d 0a20 2020 2020 2020 2027 2727 5379  :..        '''Sy
+0002bcd0: 6e6f 6e79 6d20 6f66 2073 686f 7274 6e61  nonym of shortna
+0002bce0: 6d65 2c20 7468 6520 456d 706f 7765 7220  me, the Empower 
+0002bcf0: 7368 6f72 746e 616d 6520 666f 7220 7468  shortname for th
+0002bd00: 6973 2045 6c65 6d65 6e74 2727 270d 0a20  is Element'''.. 
+0002bd10: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0002bd20: 6c66 2e73 686f 7274 6e61 6d65 0d0a 0d0a  lf.shortname....
+0002bd30: 2020 2020 4073 686f 7274 636f 6465 2e73      @shortcode.s
+0002bd40: 6574 7465 720d 0a20 2020 2064 6566 2073  etter..    def s
+0002bd50: 686f 7274 636f 6465 2873 656c 662c 7661  hortcode(self,va
+0002bd60: 6c29 3a0d 0a20 2020 2020 2020 2073 656c  l):..        sel
+0002bd70: 662e 7368 6f72 746e 616d 653d 7661 6c0d  f.shortname=val.
+0002bd80: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+0002bd90: 0d0a 2020 2020 6465 6620 7368 6f72 746e  ..    def shortn
+0002bda0: 616d 6528 7365 6c66 293a 0d0a 2020 2020  ame(self):..    
+0002bdb0: 2020 2020 2727 2754 6865 2045 6d70 6f77      '''The Empow
+0002bdc0: 6572 2027 5368 6f72 7420 4e61 6d65 2720  er 'Short Name' 
+0002bdd0: 666f 7220 7468 6973 2045 6c65 6d65 6e74  for this Element
+0002bde0: 2727 270d 0a20 2020 2020 2020 2072 6574  '''..        ret
+0002bdf0: 7572 6e20 7365 6c66 2e5f 7368 6f72 746e  urn self._shortn
+0002be00: 616d 650d 0a0d 0a20 2020 2040 7368 6f72  ame....    @shor
+0002be10: 746e 616d 652e 7365 7474 6572 0d0a 2020  tname.setter..  
+0002be20: 2020 6465 6620 7368 6f72 746e 616d 6528    def shortname(
+0002be30: 7365 6c66 2c76 616c 293a 0d0a 2020 2020  self,val):..    
+0002be40: 2020 2020 7365 6c66 2e5f 7368 6f72 746e      self._shortn
+0002be50: 616d 653d 7661 6c0d 0a20 2020 2020 2020  ame=val..       
+0002be60: 2073 656c 662e 5f66 6965 6c64 735b 2753   self._fields['S
+0002be70: 686f 7274 204e 616d 6527 5d3d 7365 6c66  hort Name']=self
+0002be80: 2e5f 7368 6f72 746e 616d 650d 0a0d 0a20  ._shortname.... 
+0002be90: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+0002bea0: 2020 6465 6620 6c6f 6e67 6e61 6d65 2873    def longname(s
+0002beb0: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
+0002bec0: 2727 5468 6520 456d 706f 7765 7227 204c  ''The Empower' L
+0002bed0: 6f6e 6720 4e61 6d65 2720 666f 7220 7468  ong Name' for th
+0002bee0: 6973 2045 6c65 6d65 6e74 2727 270d 0a20  is Element'''.. 
+0002bef0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0002bf00: 6c66 2e5f 6c6f 6e67 6e61 6d65 0d0a 0d0a  lf._longname....
+0002bf10: 2020 2020 406c 6f6e 676e 616d 652e 7365      @longname.se
+0002bf20: 7474 6572 0d0a 2020 2020 6465 6620 6c6f  tter..    def lo
+0002bf30: 6e67 6e61 6d65 2873 656c 662c 7661 6c29  ngname(self,val)
+0002bf40: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+0002bf50: 5f6c 6f6e 676e 616d 653d 7661 6c0d 0a20  _longname=val.. 
+0002bf60: 2020 2020 2020 2073 656c 662e 5f66 6965         self._fie
+0002bf70: 6c64 735b 274c 6f6e 6720 4e61 6d65 275d  lds['Long Name']
+0002bf80: 3d73 656c 662e 5f6c 6f6e 676e 616d 650d  =self._longname.
+0002bf90: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+0002bfa0: 0d0a 2020 2020 6465 6620 6465 7363 7269  ..    def descri
+0002bfb0: 7074 696f 6e28 7365 6c66 293a 0d0a 2020  ption(self):..  
+0002bfc0: 2020 2020 2020 2727 2754 6865 2045 6d70        '''The Emp
+0002bfd0: 6f77 6572 2027 4465 7363 7269 7074 696f  ower 'Descriptio
+0002bfe0: 6e27 2066 6f72 2074 6869 7320 456c 656d  n' for this Elem
+0002bff0: 656e 7427 2727 0d0a 2020 2020 2020 2020  ent'''..        
+0002c000: 7265 7475 726e 2073 656c 662e 5f64 6573  return self._des
+0002c010: 6372 6970 7469 6f6e 0d0a 0d0a 2020 2020  cription....    
+0002c020: 4064 6573 6372 6970 7469 6f6e 2e73 6574  @description.set
+0002c030: 7465 720d 0a20 2020 2064 6566 2064 6573  ter..    def des
+0002c040: 6372 6970 7469 6f6e 2873 656c 662c 7661  cription(self,va
+0002c050: 6c29 3a0d 0a20 2020 2020 2020 2073 656c  l):..        sel
+0002c060: 662e 5f64 6573 6372 6970 7469 6f6e 3d76  f._description=v
+0002c070: 616c 0d0a 2020 2020 2020 2020 7365 6c66  al..        self
+0002c080: 2e5f 6669 656c 6473 5b27 4465 7363 7269  ._fields['Descri
+0002c090: 7074 696f 6e27 5d3d 7365 6c66 2e5f 6465  ption']=self._de
+0002c0a0: 7363 7269 7074 696f 6e0d 0a0d 0a20 2020  scription....   
+0002c0b0: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
+0002c0c0: 6465 6620 6772 6f75 705f 6f6e 6c79 2873  def group_only(s
+0002c0d0: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
+0002c0e0: 2727 5468 6520 456d 706f 7765 7220 2747  ''The Empower 'G
+0002c0f0: 726f 7570 204f 6e6c 7927 2066 6f72 2074  roup Only' for t
+0002c100: 6869 7320 456c 656d 656e 742c 2077 696c  his Element, wil
+0002c110: 6c20 6265 2027 4772 6f75 7027 206f 7220  l be 'Group' or 
+0002c120: 4e6f 6e65 2727 270d 0a20 2020 2020 2020  None'''..       
+0002c130: 2072 6574 7572 6e20 7365 6c66 2e5f 6772   return self._gr
+0002c140: 6f75 705f 6f6e 6c79 0d0a 0d0a 2020 2020  oup_only....    
+0002c150: 4067 726f 7570 5f6f 6e6c 792e 7365 7474  @group_only.sett
+0002c160: 6572 0d0a 2020 2020 6465 6620 6772 6f75  er..    def grou
+0002c170: 705f 6f6e 6c79 2873 656c 662c 7661 6c29  p_only(self,val)
+0002c180: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+0002c190: 5f67 726f 7570 5f6f 6e6c 793d 7661 6c0d  _group_only=val.
+0002c1a0: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
+0002c1b0: 6965 6c64 735b 2747 726f 7570 204f 6e6c  ields['Group Onl
+0002c1c0: 7927 5d3d 7365 6c66 2e5f 6772 6f75 705f  y']=self._group_
+0002c1d0: 6f6e 6c79 0d0a 0d0a 2020 2020 4070 726f  only....    @pro
+0002c1e0: 7065 7274 790d 0a20 2020 2064 6566 2063  perty..    def c
+0002c1f0: 616c 6375 6c61 7469 6f6e 5f73 7461 7475  alculation_statu
+0002c200: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+0002c210: 2020 2727 2754 6865 2045 6d70 6f77 6572    '''The Empower
+0002c220: 2027 4361 6c63 756c 6174 696f 6e20 5374   'Calculation St
+0002c230: 6174 7573 2720 666f 7220 7468 6973 2045  atus' for this E
+0002c240: 6c65 6d65 6e74 2c20 7769 6c6c 2062 6520  lement, will be 
+0002c250: 2752 6561 6c27 206f 7220 2743 616c 6375  'Real' or 'Calcu
+0002c260: 6c61 7465 6427 2027 2727 0d0a 2020 2020  lated' '''..    
+0002c270: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0002c280: 5f63 616c 6375 6c61 7469 6f6e 5f73 7461  _calculation_sta
+0002c290: 7475 730d 0a0d 0a20 2020 2040 6361 6c63  tus....    @calc
+0002c2a0: 756c 6174 696f 6e5f 7374 6174 7573 2e73  ulation_status.s
+0002c2b0: 6574 7465 720d 0a20 2020 2064 6566 2063  etter..    def c
+0002c2c0: 616c 6375 6c61 7469 6f6e 5f73 7461 7475  alculation_statu
+0002c2d0: 7328 7365 6c66 2c76 616c 293a 0d0a 2020  s(self,val):..  
+0002c2e0: 2020 2020 2020 7365 6c66 2e5f 6361 6c63        self._calc
+0002c2f0: 756c 6174 696f 6e5f 7374 6174 7573 3d76  ulation_status=v
+0002c300: 616c 0d0a 2020 2020 2020 2020 7365 6c66  al..        self
+0002c310: 2e5f 6669 656c 6473 5b27 4361 6c63 756c  ._fields['Calcul
+0002c320: 6174 696f 6e20 5374 6174 7573 275d 3d73  ation Status']=s
+0002c330: 656c 662e 5f63 616c 6375 6c61 7469 6f6e  elf._calculation
+0002c340: 5f73 7461 7475 730d 0a0d 0a20 2020 2040  _status....    @
+0002c350: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+0002c360: 6620 6361 6c63 756c 6174 696f 6e28 7365  f calculation(se
+0002c370: 6c66 293a 0d0a 2020 2020 2020 2020 2727  lf):..        ''
+0002c380: 2741 2073 7472 696e 6720 636f 6e74 6169  'A string contai
+0002c390: 6e69 6e67 2074 6865 2045 6d70 6f77 6572  ning the Empower
+0002c3a0: 2027 4361 6c63 756c 6174 696f 6e27 2066   'Calculation' f
+0002c3b0: 6f72 2074 6869 7320 456c 656d 656e 742e  or this Element.
+0002c3c0: 204d 6179 2062 6520 4e6f 6e65 2027 2727   May be None '''
+0002c3d0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0002c3e0: 2073 656c 662e 5f63 616c 6375 6c61 7469   self._calculati
+0002c3f0: 6f6e 0d0a 0d0a 2020 2020 4063 616c 6375  on....    @calcu
+0002c400: 6c61 7469 6f6e 2e73 6574 7465 720d 0a20  lation.setter.. 
+0002c410: 2020 2064 6566 2063 616c 6375 6c61 7469     def calculati
+0002c420: 6f6e 2873 656c 662c 7661 6c29 3a0d 0a20  on(self,val):.. 
+0002c430: 2020 2020 2020 2073 656c 662e 5f63 616c         self._cal
+0002c440: 6375 6c61 7469 6f6e 3d76 616c 0d0a 2020  culation=val..  
+0002c450: 2020 2020 2020 2370 7269 6e74 2873 656c        #print(sel
+0002c460: 662e 7368 6f72 746e 616d 6529 0d0a 2020  f.shortname)..  
+0002c470: 2020 2020 2020 2374 7279 3a0d 0a20 2020        #try:..   
+0002c480: 2020 2020 2023 2020 2020 7072 696e 7428       #    print(
+0002c490: 7365 6c66 2e5f 6669 656c 6473 2e5f 6669  self._fields._fi
+0002c4a0: 656c 645f 6564 6974 735b 2743 616c 6375  eld_edits['Calcu
+0002c4b0: 6c61 7469 6f6e 275d 290d 0a20 2020 2020  lation'])..     
+0002c4c0: 2020 2023 6578 6365 7074 204b 6579 4572     #except KeyEr
+0002c4d0: 726f 723a 0d0a 2020 2020 2020 2020 2320  ror:..        # 
+0002c4e0: 2020 2070 7269 6e74 2846 616c 7365 290d     print(False).
+0002c4f0: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
+0002c500: 6965 6c64 735b 2743 616c 6375 6c61 7469  ields['Calculati
+0002c510: 6f6e 275d 3d73 656c 662e 5f63 616c 6375  on']=self._calcu
+0002c520: 6c61 7469 6f6e 0d0a 2020 2020 2020 2020  lation..        
+0002c530: 2370 7269 6e74 2873 656c 662e 5f66 6965  #print(self._fie
+0002c540: 6c64 732e 5f66 6965 6c64 5f65 6469 7473  lds._field_edits
+0002c550: 5b27 4361 6c63 756c 6174 696f 6e27 5d29  ['Calculation'])
+0002c560: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+0002c570: 790d 0a20 2020 2064 6566 2063 6f6c 6f75  y..    def colou
+0002c580: 7228 7365 6c66 293a 0d0a 2020 2020 2020  r(self):..      
+0002c590: 2020 2727 2754 6865 2045 6d70 6f77 6572    '''The Empower
+0002c5a0: 2027 436f 6c6f 7572 2720 6f66 2074 6869   'Colour' of thi
+0002c5b0: 7320 456c 656d 656e 7427 2727 0d0a 2020  s Element'''..  
+0002c5c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0002c5d0: 662e 5f63 6f6c 6f75 720d 0a0d 0a20 2020  f._colour....   
+0002c5e0: 2040 636f 6c6f 7572 2e73 6574 7465 720d   @colour.setter.
+0002c5f0: 0a20 2020 2064 6566 2063 6f6c 6f75 7228  .    def colour(
+0002c600: 7365 6c66 2c76 616c 293a 0d0a 2020 2020  self,val):..    
+0002c610: 2020 2020 7365 6c66 2e5f 636f 6c6f 7572      self._colour
+0002c620: 3d76 616c 0d0a 2020 2020 2020 2020 7365  =val..        se
+0002c630: 6c66 2e5f 6669 656c 6473 5b27 436f 6c6f  lf._fields['Colo
+0002c640: 7572 275d 3d73 656c 662e 5f63 6f6c 6f75  ur']=self._colou
+0002c650: 720d 0a0d 0a20 2020 2040 7072 6f70 6572  r....    @proper
+0002c660: 7479 0d0a 2020 2020 6465 6620 6d65 6173  ty..    def meas
+0002c670: 7572 6528 7365 6c66 293a 0d0a 2020 2020  ure(self):..    
+0002c680: 2020 2020 2727 2754 6865 2045 6d70 6f77      '''The Empow
+0002c690: 6572 2027 4d65 6173 7572 6527 2066 6f72  er 'Measure' for
+0002c6a0: 2074 6869 7320 456c 656d 656e 7427 2727   this Element'''
+0002c6b0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0002c6c0: 2073 656c 662e 5f6d 6561 7375 7265 0d0a   self._measure..
+0002c6d0: 0d0a 2020 2020 406d 6561 7375 7265 2e73  ..    @measure.s
+0002c6e0: 6574 7465 720d 0a20 2020 2064 6566 206d  etter..    def m
+0002c6f0: 6561 7375 7265 2873 656c 662c 7661 6c29  easure(self,val)
+0002c700: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+0002c710: 5f6d 6561 7375 7265 3d76 616c 0d0a 2020  _measure=val..  
+0002c720: 2020 2020 2020 7365 6c66 2e5f 6669 656c        self._fiel
+0002c730: 6473 5b27 4d65 6173 7572 6520 456c 656d  ds['Measure Elem
+0002c740: 656e 7427 5d3d 7365 6c66 2e5f 6d65 6173  ent']=self._meas
+0002c750: 7572 650d 0a0d 0a20 2020 2040 7072 6f70  ure....    @prop
+0002c760: 6572 7479 0d0a 2020 2020 6465 6620 6669  erty..    def fi
+0002c770: 656c 6473 2873 656c 6629 3a0d 0a20 2020  elds(self):..   
+0002c780: 2020 2020 2027 2727 5265 7475 726e 7320       '''Returns 
+0002c790: 6120 6469 6374 696f 6e61 7279 2d6c 696b  a dictionary-lik
+0002c7a0: 6520 6f62 6a65 6374 2063 6f6e 7461 696e  e object contain
+0002c7b0: 696e 6720 7468 6520 456d 706f 7765 7220  ing the Empower 
+0002c7c0: 6669 656c 6473 2028 612e 6b2e 612e 2061  fields (a.k.a. a
+0002c7d0: 7474 7269 6275 7465 7329 2066 6f72 2074  ttributes) for t
+0002c7e0: 6869 7320 456c 656d 656e 742e 2045 6e74  his Element. Ent
+0002c7f0: 7269 6573 2061 7265 206f 6620 7468 6520  ries are of the 
+0002c800: 666f 726d 204c 6f6e 6720 4e61 6d65 3a53  form Long Name:S
+0002c810: 7472 696e 6720 5661 6c75 6520 2727 270d  tring Value '''.
+0002c820: 0a20 2020 2020 2020 2023 5265 7475 726e  .        #Return
+0002c830: 2061 2073 7065 6369 616c 2066 6965 6c64   a special field
+0002c840: 2073 6574 7465 722c 2073 6f20 7468 6174   setter, so that
+0002c850: 2063 6861 6e67 696e 6720 7468 6520 7661   changing the va
+0002c860: 6c75 6520 7570 6461 7465 7320 7468 6520  lue updates the 
+0002c870: 5f73 796e 6368 6564 2066 6c61 670d 0a0d  _synched flag...
+0002c880: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002c890: 7365 6c66 2e5f 6669 656c 6473 0d0a 0d0a  self._fields....
+0002c8a0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+0002c8b0: 2020 2064 6566 2064 6174 6528 7365 6c66     def date(self
+0002c8c0: 293a 0d0a 2020 2020 2020 2020 2727 2741  ):..        '''A
+0002c8d0: 7070 6c69 6573 2074 6f20 7469 6d65 2065  pplies to time e
+0002c8e0: 6c65 6d65 6e74 7320 6f6e 6c79 2e20 4120  lements only. A 
+0002c8f0: 7265 6164 206f 6e6c 7920 7072 6f70 6572  read only proper
+0002c900: 7479 2074 6861 7420 7265 7475 726e 7320  ty that returns 
+0002c910: 6120 6461 7465 2062 6173 6564 206f 6e20  a date based on 
+0002c920: 7965 6172 2c20 6d6f 6e74 682c 2064 6179  year, month, day
+0002c930: 2061 6e64 2069 6e74 6572 7661 6c5f 7479   and interval_ty
+0002c940: 7065 2727 270d 0a20 2020 2020 2020 2072  pe'''..        r
+0002c950: 6574 7572 6e20 4e6f 6e65 0d0a 0d0a 2020  eturn None....  
+0002c960: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+0002c970: 2064 6566 2079 6561 7228 7365 6c66 293a   def year(self):
+0002c980: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0002c990: 662e 6461 7465 2069 7320 6e6f 7420 4e6f  f.date is not No
+0002c9a0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0002c9b0: 2072 6574 7572 6e20 7365 6c66 2e64 6174   return self.dat
+0002c9c0: 652e 7965 6172 0d0a 2020 2020 2020 2020  e.year..        
+0002c9d0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0002c9e0: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
+0002c9f0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
+0002ca00: 0a20 2020 2064 6566 206d 6f6e 7468 2873  .    def month(s
+0002ca10: 656c 6629 3a0d 0a20 2020 2020 2020 2069  elf):..        i
+0002ca20: 6620 7365 6c66 2e64 6174 6520 6973 206e  f self.date is n
+0002ca30: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
+0002ca40: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0002ca50: 662e 6461 7465 2e6d 6f6e 7468 0d0a 2020  f.date.month..  
+0002ca60: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0002ca70: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0002ca80: 4e6f 6e65 0d0a 0d0a 2020 2020 4070 726f  None....    @pro
+0002ca90: 7065 7274 790d 0a20 2020 2064 6566 2071  perty..    def q
+0002caa0: 7561 7274 6572 2873 656c 6629 3a0d 0a20  uarter(self):.. 
+0002cab0: 2020 2020 2020 2069 6620 7365 6c66 2e64         if self.d
+0002cac0: 6174 6520 6973 206e 6f74 204e 6f6e 653a  ate is not None:
+0002cad0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0002cae0: 7475 726e 2028 7365 6c66 2e64 6174 652e  turn (self.date.
+0002caf0: 6d6f 6e74 6820 2d31 2920 2f2f 2033 202b  month -1) // 3 +
+0002cb00: 310d 0a20 2020 2020 2020 2065 6c73 653a  1..        else:
+0002cb10: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0002cb20: 7475 726e 204e 6f6e 650d 0a0d 0a20 2020  turn None....   
+0002cb30: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
+0002cb40: 6465 6620 6461 7928 7365 6c66 293a 0d0a  def day(self):..
+0002cb50: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0002cb60: 6461 7465 2069 7320 6e6f 7420 4e6f 6e65  date is not None
+0002cb70: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0002cb80: 6574 7572 6e20 7365 6c66 2e64 6174 652e  eturn self.date.
+0002cb90: 6461 790d 0a20 2020 2020 2020 2065 6c73  day..        els
+0002cba0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0002cbb0: 7265 7475 726e 204e 6f6e 650d 0a0d 0a20  return None.... 
+0002cbc0: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+0002cbd0: 2020 6465 6620 656d 706f 7765 725f 7065    def empower_pe
+0002cbe0: 7269 6f64 5f6e 756d 6265 7228 7365 6c66  riod_number(self
+0002cbf0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+0002cc00: 726e 204e 6f6e 650d 0a0d 0a20 2020 2040  rn None....    @
+0002cc10: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+0002cc20: 6620 696e 7465 7276 616c 5f69 6e64 6578  f interval_index
 0002cc30: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0002cc40: 2027 2727 4372 6561 7465 2061 2063 6f70   '''Create a cop
-0002cc50: 7920 6f66 2073 656c 662c 206e 6f74 2069  y of self, not i
-0002cc60: 6e63 6c75 6469 6e67 2074 6865 2070 6879  ncluding the phy
-0002cc70: 7369 6420 6f72 2073 686f 7274 6e61 6d65  sid or shortname
-0002cc80: 2727 270d 0a20 2020 2020 2020 2072 6574  '''..        ret
-0002cc90: 7572 6e20 456c 656d 656e 7428 6c6f 6e67  urn Element(long
-0002cca0: 6e61 6d65 2020 2020 2020 2020 2020 2020  name            
-0002ccb0: 203d 2073 656c 662e 6c6f 6e67 6e61 6d65   = self.longname
-0002ccc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002ccd0: 2020 2020 2020 2020 2c73 686f 7274 6e61          ,shortna
-0002cce0: 6d65 2020 2020 2020 2020 2020 2020 3d20  me            = 
-0002ccf0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-0002cd00: 2020 2020 2020 2020 2020 2020 2c64 6573              ,des
-0002cd10: 6372 6970 7469 6f6e 2020 2020 2020 2020  cription        
-0002cd20: 2020 3d20 7365 6c66 2e64 6573 6372 6970    = self.descrip
-0002cd30: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
-0002cd40: 2020 2020 2020 2020 2020 2020 2c67 726f              ,gro
-0002cd50: 7570 5f6f 6e6c 7920 2020 2020 2020 2020  up_only         
-0002cd60: 2020 3d20 7365 6c66 2e67 726f 7570 5f6f    = self.group_o
-0002cd70: 6e6c 790d 0a20 2020 2020 2020 2020 2020  nly..           
-0002cd80: 2020 2020 2020 2020 2020 202c 6361 6c63             ,calc
-0002cd90: 756c 6174 696f 6e5f 7374 6174 7573 2020  ulation_status  
-0002cda0: 203d 2073 656c 662e 6361 6c63 756c 6174   = self.calculat
-0002cdb0: 696f 6e5f 7374 6174 7573 0d0a 2020 2020  ion_status..    
-0002cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002cdd0: 2020 2c63 616c 6375 6c61 7469 6f6e 2020    ,calculation  
-0002cde0: 2020 2020 2020 2020 3d20 7365 6c66 2e63          = self.c
-0002cdf0: 616c 6375 6c61 7469 6f6e 0d0a 2020 2020  alculation..    
-0002ce00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002ce10: 2020 2c63 6f6c 6f75 7220 2020 2020 2020    ,colour       
-0002ce20: 2020 2020 2020 2020 3d20 7365 6c66 2e63          = self.c
-0002ce30: 6f6c 6f75 720d 0a20 2020 2020 2020 2020  olour..         
-0002ce40: 2020 2020 2020 2020 2020 2020 202c 6d65               ,me
-0002ce50: 6173 7572 6520 2020 2020 2020 2020 2020  asure           
-0002ce60: 2020 203d 2073 656c 662e 6d65 6173 7572     = self.measur
-0002ce70: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0002ce80: 2020 2020 2020 2020 202c 6669 656c 6473           ,fields
-0002ce90: 2020 2020 2020 2020 2020 2020 2020 203d                 =
-0002cea0: 2064 6963 7428 7365 6c66 2e66 6965 6c64   dict(self.field
-0002ceb0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0002cec0: 2020 2020 2020 2020 2020 2c64 696d 656e            ,dimen
-0002ced0: 7369 6f6e 2020 2020 2020 2020 2020 2020  sion            
-0002cee0: 3d20 7365 6c66 2e64 696d 656e 7369 6f6e  = self.dimension
-0002cef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002cf00: 2020 2020 2020 2020 290d 0a0d 0a20 2020          )....   
-0002cf10: 2064 6566 206d 6572 6765 2873 656c 662c   def merge(self,
-0002cf20: 6f74 6865 722c 6669 656c 6473 5f74 6f5f  other,fields_to_
-0002cf30: 6d65 7267 653d 4e6f 6e65 293a 0d0a 2020  merge=None):..  
-0002cf40: 2020 2020 2020 2727 274d 6572 6765 2061        '''Merge a
-0002cf50: 6e6f 7468 6572 2065 6c65 6d65 6e74 2069  nother element i
-0002cf60: 6e74 6f20 7468 6973 206f 6e65 2727 270d  nto this one'''.
-0002cf70: 0a0d 0a20 2020 2020 2020 2069 6620 6f74  ...        if ot
-0002cf80: 6865 722e 7068 7973 6964 2069 7320 6e6f  her.physid is no
-0002cf90: 7420 4e6f 6e65 2061 6e64 2073 656c 662e  t None and self.
-0002cfa0: 7068 7973 6964 2069 7320 6e6f 7420 4e6f  physid is not No
-0002cfb0: 6e65 2061 6e64 2073 656c 662e 7068 7973  ne and self.phys
-0002cfc0: 6964 2021 3d20 6f74 6865 722e 7068 7973  id != other.phys
-0002cfd0: 6964 3a0d 0a20 2020 2020 2020 2020 2020  id:..           
-0002cfe0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0002cff0: 7228 2243 616e 6e6f 7420 6d65 7267 6520  r("Cannot merge 
-0002d000: 7477 6f20 656c 656d 656e 7473 2077 6974  two elements wit
-0002d010: 6820 6469 6666 6572 656e 7420 7068 7973  h different phys
-0002d020: 6964 733a 207b 7d20 696e 746f 207b 7d2c  ids: {} into {},
-0002d030: 206f 6e20 6469 6d65 6e73 696f 6e20 7b7d   on dimension {}
-0002d040: 2c20 7a65 726f 2062 6173 6564 2069 6e64  , zero based ind
-0002d050: 6578 207b 7d2e 2043 6865 636b 2074 6865  ex {}. Check the
-0002d060: 7365 2065 6c65 6d65 6e74 7320 646f 6e27  se elements don'
-0002d070: 7420 6861 7665 2065 6d70 7479 2073 686f  t have empty sho
-0002d080: 7274 6e61 6d65 7322 2e66 6f72 6d61 7428  rtnames".format(
-0002d090: 6f74 6865 722e 7068 7973 6964 2c73 656c  other.physid,sel
-0002d0a0: 662e 7068 7973 6964 2c73 656c 662e 6469  f.physid,self.di
-0002d0b0: 6d65 6e73 696f 6e2e 6c6f 6e67 6e61 6d65  mension.longname
-0002d0c0: 2c73 656c 662e 6469 6d65 6e73 696f 6e2e  ,self.dimension.
-0002d0d0: 696e 6465 7829 290d 0a0d 0a20 2020 2020  index))....     
-0002d0e0: 2020 2069 6620 7365 6c66 2e70 6879 7369     if self.physi
-0002d0f0: 6420 6973 204e 6f6e 653a 0d0a 0d0a 2020  d is None:....  
-0002d100: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0002d110: 6879 7369 6420 3d20 6f74 6865 722e 7068  hysid = other.ph
-0002d120: 7973 6964 0d0a 2020 2020 2020 2020 2020  ysid..          
-0002d130: 2020 2347 6574 2074 6865 2063 616e 6f6e    #Get the canon
-0002d140: 6963 616c 2073 686f 7274 6e61 6d65 2077  ical shortname w
-0002d150: 6865 6e20 6d65 7267 696e 6720 696e 2074  hen merging in t
-0002d160: 6865 2070 6879 7369 640d 0a20 2020 2020  he physid..     
-0002d170: 2020 2020 2020 2073 656c 662e 7368 6f72         self.shor
-0002d180: 746e 616d 6520 3d20 6f74 6865 722e 7368  tname = other.sh
-0002d190: 6f72 746e 616d 650d 0a0d 0a20 2020 2020  ortname....     
-0002d1a0: 2020 2069 6620 7365 6c66 2e73 686f 7274     if self.short
-0002d1b0: 6e61 6d65 2069 7320 4e6f 6e65 3a0d 0a20  name is None:.. 
-0002d1c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0002d1d0: 7368 6f72 746e 616d 6520 3d20 6f74 6865  shortname = othe
-0002d1e0: 722e 7368 6f72 746e 616d 650d 0a0d 0a20  r.shortname.... 
-0002d1f0: 2020 2020 2020 2069 6620 6f74 6865 722e         if other.
-0002d200: 6c6f 6e67 6e61 6d65 2069 7320 6e6f 7420  longname is not 
-0002d210: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0002d220: 2020 2073 656c 662e 6c6f 6e67 6e61 6d65     self.longname
-0002d230: 2020 2020 2020 2020 2020 2020 203d 206f               = o
-0002d240: 7468 6572 2e6c 6f6e 676e 616d 650d 0a20  ther.longname.. 
-0002d250: 2020 2020 2020 2069 6620 6f74 6865 722e         if other.
-0002d260: 6465 7363 7269 7074 696f 6e20 6973 206e  description is n
-0002d270: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-0002d280: 2020 2020 2020 7365 6c66 2e64 6573 6372        self.descr
-0002d290: 6970 7469 6f6e 2020 2020 2020 2020 2020  iption          
-0002d2a0: 3d20 6f74 6865 722e 6465 7363 7269 7074  = other.descript
-0002d2b0: 696f 6e0d 0a20 2020 2020 2020 2069 6620  ion..        if 
-0002d2c0: 6f74 6865 722e 6772 6f75 705f 6f6e 6c79  other.group_only
-0002d2d0: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-0002d2e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0002d2f0: 6772 6f75 705f 6f6e 6c79 2020 2020 2020  group_only      
-0002d300: 2020 2020 203d 206f 7468 6572 2e67 726f       = other.gro
-0002d310: 7570 5f6f 6e6c 790d 0a20 2020 2020 2020  up_only..       
-0002d320: 2069 6620 6f74 6865 722e 6361 6c63 756c   if other.calcul
-0002d330: 6174 696f 6e5f 7374 6174 7573 2069 7320  ation_status is 
-0002d340: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-0002d350: 2020 2020 2020 2073 656c 662e 6361 6c63         self.calc
-0002d360: 756c 6174 696f 6e5f 7374 6174 7573 2020  ulation_status  
-0002d370: 203d 206f 7468 6572 2e63 616c 6375 6c61   = other.calcula
-0002d380: 7469 6f6e 5f73 7461 7475 730d 0a20 2020  tion_status..   
-0002d390: 2020 2020 2069 6620 6f74 6865 722e 6361       if other.ca
-0002d3a0: 6c63 756c 6174 696f 6e20 6973 206e 6f74  lculation is not
-0002d3b0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0002d3c0: 2020 2020 7365 6c66 2e63 616c 6375 6c61      self.calcula
-0002d3d0: 7469 6f6e 2020 2020 2020 2020 2020 3d20  tion          = 
-0002d3e0: 6f74 6865 722e 6361 6c63 756c 6174 696f  other.calculatio
-0002d3f0: 6e0d 0a20 2020 2020 2020 2069 6620 6f74  n..        if ot
-0002d400: 6865 722e 636f 6c6f 7572 2069 7320 6e6f  her.colour is no
-0002d410: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-0002d420: 2020 2020 2073 656c 662e 636f 6c6f 7572       self.colour
-0002d430: 2020 2020 2020 2020 2020 2020 2020 203d                 =
-0002d440: 206f 7468 6572 2e63 6f6c 6f75 720d 0a20   other.colour.. 
-0002d450: 2020 2020 2020 2069 6620 6f74 6865 722e         if other.
-0002d460: 6d65 6173 7572 6520 6973 206e 6f74 204e  measure is not N
-0002d470: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0002d480: 2020 7365 6c66 2e6d 6561 7375 7265 2020    self.measure  
-0002d490: 2020 2020 2020 2020 2020 2020 3d20 6f74              = ot
-0002d4a0: 6865 722e 6d65 6173 7572 650d 0a20 2020  her.measure..   
-0002d4b0: 2020 2020 2066 6f72 206b 2c76 2069 6e20       for k,v in 
-0002d4c0: 6f74 6865 722e 6669 656c 6473 2e69 7465  other.fields.ite
-0002d4d0: 6d73 2829 3a0d 0a20 2020 2020 2020 2020  ms():..         
-0002d4e0: 2020 2023 4d65 7267 6520 696e 2066 6965     #Merge in fie
-0002d4f0: 6c64 7320 7468 6174 2077 6520 7761 6e74  lds that we want
-0002d500: 2074 6f20 6578 706c 6963 6974 6c79 2063   to explicitly c
-0002d510: 6861 6e67 652c 2075 6e6c 6573 7320 7765  hange, unless we
-0002d520: 2068 6176 6520 6e6f 7420 7370 6563 6966   have not specif
-0002d530: 6965 6420 6669 656c 6473 2065 7870 6c69  ied fields expli
-0002d540: 6369 746c 792c 2069 6e20 7768 6963 6820  citly, in which 
-0002d550: 6361 7365 206d 6572 6765 2069 6e20 6e6f  case merge in no
-0002d560: 6e2d 4e55 4c4c 2066 6965 6c64 730d 0a20  n-NULL fields.. 
-0002d570: 2020 2020 2020 2020 2020 2069 6620 2866             if (f
-0002d580: 6965 6c64 735f 746f 5f6d 6572 6765 2069  ields_to_merge i
-0002d590: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206b  s not None and k
-0002d5a0: 2069 6e20 6669 656c 6473 5f74 6f5f 6d65   in fields_to_me
-0002d5b0: 7267 6529 206f 7220 2866 6965 6c64 735f  rge) or (fields_
-0002d5c0: 746f 5f6d 6572 6765 2069 7320 4e6f 6e65  to_merge is None
-0002d5d0: 2061 6e64 2076 2069 7320 6e6f 7420 4e6f   and v is not No
-0002d5e0: 6e65 293a 0d0a 2020 2020 2020 2020 2020  ne):..          
-0002d5f0: 2020 2020 2020 7365 6c66 2e66 6965 6c64        self.field
-0002d600: 735b 6b5d 203d 2076 0d0a 0d0a 2020 2020  s[k] = v....    
-0002d610: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-0002d620: 6566 2073 6563 7572 6974 7928 7365 6c66  ef security(self
-0002d630: 293a 0d0a 2020 2020 2020 2020 2727 2752  ):..        '''R
-0002d640: 6574 7572 6e73 2061 2053 6563 7572 6974  eturns a Securit
-0002d650: 7920 6f62 6a65 6374 2c20 7768 6963 6820  y object, which 
-0002d660: 6861 7320 7079 7468 6f6e 2073 6574 7320  has python sets 
-0002d670: 6f66 2075 7365 7273 2073 686f 7274 6e61  of users shortna
-0002d680: 6d65 7320 666f 7220 2e76 6965 7765 7273  mes for .viewers
-0002d690: 2c20 2e6d 6f64 6966 6965 7273 2061 6e64  , .modifiers and
-0002d6a0: 202e 6461 7461 5f76 6965 7765 7273 2727   .data_viewers''
-0002d6b0: 270d 0a0d 0a20 2020 2020 2020 2023 5365  '....        #Se
-0002d6c0: 6375 7269 7479 2069 7320 6c61 7a69 6c79  curity is lazily
-0002d6d0: 206c 6f61 6465 640d 0a20 2020 2020 2020   loaded..       
-0002d6e0: 2069 6620 7365 6c66 2e5f 7365 6375 7269   if self._securi
-0002d6f0: 7479 2069 7320 4e6f 6e65 3a0d 0a20 2020  ty is None:..   
-0002d700: 2020 2020 2020 2020 2023 4372 6561 7465           #Create
-0002d710: 2061 206e 6577 2065 6c65 6d65 6e74 2073   a new element s
-0002d720: 6563 7572 6974 7920 6f62 6a65 6374 0d0a  ecurity object..
-0002d730: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0002d740: 2e5f 7365 6375 7269 7479 203d 2045 6c65  ._security = Ele
-0002d750: 6d65 6e74 5365 6375 7269 7479 2865 6c65  mentSecurity(ele
-0002d760: 6d65 6e74 203d 2073 656c 6629 0d0a 2020  ment = self)..  
-0002d770: 2020 2020 2020 2020 2020 234c 6f61 6420            #Load 
-0002d780: 7365 6375 7269 7479 2074 6f20 6f76 6572  security to over
-0002d790: 7772 6974 6520 7769 7468 2063 6f72 7265  write with corre
-0002d7a0: 6374 2076 616c 7565 7320 2869 6620 7468  ct values (if th
-0002d7b0: 6579 2065 7869 7374 290d 0a20 2020 2020  ey exist)..     
-0002d7c0: 2020 2020 2020 2023 5468 6973 2077 696c         #This wil
-0002d7d0: 6c20 6f6e 6c79 206c 616f 6420 6966 206e  l only laod if n
-0002d7e0: 6f74 2061 6c72 6561 6479 206c 6f61 6465  ot already loade
-0002d7f0: 640d 0a20 2020 2020 2020 2020 2020 2073  d..            s
-0002d800: 656c 662e 6469 6d65 6e73 696f 6e2e 656c  elf.dimension.el
-0002d810: 656d 656e 7473 2e5f 6c6f 6164 5f73 6563  ements._load_sec
-0002d820: 7572 6974 7928 290d 0a0d 0a20 2020 2020  urity()....     
-0002d830: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0002d840: 7365 6375 7269 7479 0d0a 0d0a 2020 2020  security....    
-0002d850: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
-0002d860: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-0002d870: 7572 6e20 273c 7b7d 206f 626a 6563 742c  urn '<{} object,
-0002d880: 2073 686f 7274 6e61 6d65 207b 7d2c 206c   shortname {}, l
-0002d890: 6f6e 676e 616d 6520 7b7d 2061 7420 7b7d  ongname {} at {}
-0002d8a0: 3e27 2e66 6f72 6d61 7428 7365 6c66 2e5f  >'.format(self._
-0002d8b0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-0002d8c0: 5f2c 7365 6c66 2e73 686f 7274 6e61 6d65  _,self.shortname
-0002d8d0: 2c73 656c 662e 6c6f 6e67 6e61 6d65 2c68  ,self.longname,h
-0002d8e0: 6578 2869 6428 7365 6c66 2929 290d 0a0d  ex(id(self)))...
-0002d8f0: 0a20 2020 2064 6566 205f 5f65 715f 5f28  .    def __eq__(
-0002d900: 7365 6c66 2c6f 7468 6572 293a 0d0a 2020  self,other):..  
-0002d910: 2020 2020 2020 2350 594d 2d33 3620 6669        #PYM-36 fi
-0002d920: 7820 656c 656d 656e 7420 7368 6f75 6c64  x element should
-0002d930: 206f 6e6c 7920 6265 2065 7175 616c 2074   only be equal t
-0002d940: 6f20 616e 6f74 6865 7220 656c 656d 656e  o another elemen
-0002d950: 7420 7769 7468 2073 616d 6520 6469 6d65  t with same dime
-0002d960: 6e73 696f 6e20 616e 6420 7368 6f72 746e  nsion and shortn
-0002d970: 616d 652c 2065 7863 6c75 6469 6e67 204e  ame, excluding N
-0002d980: 6f6e 6520 756e 6c65 7373 2073 616d 6520  one unless same 
-0002d990: 6f62 6a65 6374 2069 640d 0a20 2020 2020  object id..     
-0002d9a0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-0002d9b0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0002d9c0: 2e73 686f 7274 6e61 6d65 3d3d 6f74 6865  .shortname==othe
-0002d9d0: 722e 7368 6f72 746e 616d 6520 616e 6420  r.shortname and 
-0002d9e0: 2869 6428 7365 6c66 2920 3d3d 2069 6428  (id(self) == id(
-0002d9f0: 6f74 6865 7229 206f 7220 2873 656c 662e  other) or (self.
-0002da00: 6469 6d65 6e73 696f 6e20 3d3d 206f 7468  dimension == oth
-0002da10: 6572 2e64 696d 656e 7369 6f6e 2061 6e64  er.dimension and
-0002da20: 2069 7369 6e73 7461 6e63 6528 6f74 6865   isinstance(othe
-0002da30: 722c 2045 6c65 6d65 6e74 2920 616e 6420  r, Element) and 
-0002da40: 7365 6c66 2e73 686f 7274 6e61 6d65 2069  self.shortname i
-0002da50: 7320 6e6f 7420 4e6f 6e65 2929 0d0a 2020  s not None))..  
-0002da60: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
-0002da70: 7269 6275 7465 4572 726f 723a 0d0a 2020  ributeError:..  
-0002da80: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002da90: 2046 616c 7365 0d0a 0d0a 2020 2020 6465   False....    de
-0002daa0: 6620 5f5f 6861 7368 5f5f 2873 656c 6629  f __hash__(self)
-0002dab0: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-0002dac0: 6e20 6861 7368 2873 656c 662e 7368 6f72  n hash(self.shor
-0002dad0: 746e 616d 6529 0d0a 0d0a 636c 6173 7320  tname)....class 
-0002dae0: 5469 6d65 456c 656d 656e 7428 456c 656d  TimeElement(Elem
-0002daf0: 656e 7429 3a0d 0a0d 0a20 2020 2064 6566  ent):....    def
-0002db00: 205f 5f69 6e69 745f 5f28 7365 6c66 2c69   __init__(self,i
-0002db10: 6e74 6572 7661 6c5f 696e 6465 782c 7368  nterval_index,sh
-0002db20: 6f72 746e 616d 652c 7965 6172 2c6d 6f6e  ortname,year,mon
-0002db30: 7468 3d4e 6f6e 652c 6461 793d 4e6f 6e65  th=None,day=None
-0002db40: 2c6c 6f6e 676e 616d 653d 4e6f 6e65 2c64  ,longname=None,d
-0002db50: 6573 6372 6970 7469 6f6e 3d4e 6f6e 652c  escription=None,
-0002db60: 7068 7973 6964 3d4e 6f6e 652c 6469 6d65  physid=None,dime
-0002db70: 6e73 696f 6e3d 4e6f 6e65 293a 0d0a 0d0a  nsion=None):....
-0002db80: 2020 2020 2020 2020 6966 2069 6e74 6572          if inter
-0002db90: 7661 6c5f 696e 6465 7820 6e6f 7420 696e  val_index not in
-0002dba0: 205b 6c6c 752e 454d 504f 5745 525f 5945   [llu.EMPOWER_YE
-0002dbb0: 4152 5f43 4f4e 5354 414e 542c 6c6c 752e  AR_CONSTANT,llu.
-0002dbc0: 454d 504f 5745 525f 4841 4c46 5945 4152  EMPOWER_HALFYEAR
-0002dbd0: 5f43 4f4e 5354 414e 542c 6c6c 752e 454d  _CONSTANT,llu.EM
-0002dbe0: 504f 5745 525f 5155 4152 5445 525f 434f  POWER_QUARTER_CO
-0002dbf0: 4e53 5441 4e54 2c6c 6c75 2e45 4d50 4f57  NSTANT,llu.EMPOW
-0002dc00: 4552 5f4d 4f4e 5448 5f43 4f4e 5354 414e  ER_MONTH_CONSTAN
-0002dc10: 542c 6c6c 752e 454d 504f 5745 525f 5745  T,llu.EMPOWER_WE
-0002dc20: 454b 5f43 4f4e 5354 414e 542c 6c6c 752e  EK_CONSTANT,llu.
-0002dc30: 454d 504f 5745 525f 4441 595f 434f 4e53  EMPOWER_DAY_CONS
-0002dc40: 5441 4e54 2c27 5927 2c27 4827 2c27 5127  TANT,'Y','H','Q'
-0002dc50: 2c27 4d27 2c27 5727 2c27 4427 5d3a 0d0a  ,'M','W','D']:..
-0002dc60: 2020 2020 2020 2020 2020 2020 2350 726f              #Pro
-0002dc70: 6772 616d 6d69 6e67 2065 7272 6f72 0d0a  gramming error..
-0002dc80: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0002dc90: 6520 4174 7472 6962 7574 6545 7272 6f72  e AttributeError
-0002dca0: 2822 696e 7465 7276 616c 5f69 6e64 6578  ("interval_index
-0002dcb0: 206d 7573 7420 6265 2069 6e20 7468 6520   must be in the 
-0002dcc0: 456d 706f 7765 7220 696e 7465 7276 616c  Empower interval
-0002dcd0: 2069 6e64 6578 2072 616e 6765 2066 726f   index range fro
-0002dce0: 6d20 3020 746f 2035 206f 7220 6f6e 6520  m 0 to 5 or one 
-0002dcf0: 6f66 2027 5927 2c27 4827 2c27 5127 2c27  of 'Y','H','Q','
-0002dd00: 4d2c 2757 2720 6f72 2027 4427 202d 2067  M,'W' or 'D' - g
-0002dd10: 6f74 3a22 2b73 7472 2869 6e74 6572 7661  ot:"+str(interva
-0002dd20: 6c5f 696e 6465 7829 290d 0a20 2020 2020  l_index))..     
-0002dd30: 2020 2023 544f 444f 2061 6464 2065 7874     #TODO add ext
-0002dd40: 7261 2063 6865 636b 696e 672c 2061 6464  ra checking, add
-0002dd50: 206c 6f67 6963 2028 656c 7365 7768 6565   logic (elsewhee
-0002dd60: 7220 666f 7220 6372 6561 7469 6e67 2077  r for creating w
-0002dd70: 6565 6b73 2061 6e64 2064 6179 730d 0a0d  eeks and days...
-0002dd80: 0a20 2020 2020 2020 2023 5472 616e 7366  .        #Transf
-0002dd90: 6f72 6d20 696e 7465 7276 616c 5f69 6e64  orm interval_ind
-0002dda0: 6578 2074 6f20 6120 6e75 6d62 6572 0d0a  ex to a number..
-0002ddb0: 2020 2020 2020 2020 696e 7465 7276 616c          interval
-0002ddc0: 5f69 6e64 6578 203d 207b 6c6c 752e 454d  _index = {llu.EM
-0002ddd0: 504f 5745 525f 5945 4152 5f43 4f4e 5354  POWER_YEAR_CONST
-0002dde0: 414e 543a 2020 2020 206c 6c75 2e45 4d50  ANT:     llu.EMP
-0002ddf0: 4f57 4552 5f59 4541 525f 434f 4e53 5441  OWER_YEAR_CONSTA
-0002de00: 4e54 0d0a 2020 2020 2020 2020 2020 2020  NT..            
-0002de10: 2020 2020 2020 2020 2020 2020 202c 6c6c               ,ll
-0002de20: 752e 454d 504f 5745 525f 4841 4c46 5945  u.EMPOWER_HALFYE
-0002de30: 4152 5f43 4f4e 5354 414e 543a 206c 6c75  AR_CONSTANT: llu
-0002de40: 2e45 4d50 4f57 4552 5f48 414c 4659 4541  .EMPOWER_HALFYEA
-0002de50: 525f 434f 4e53 5441 4e54 0d0a 2020 2020  R_CONSTANT..    
-0002de60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002de70: 2020 2020 202c 6c6c 752e 454d 504f 5745       ,llu.EMPOWE
-0002de80: 525f 5155 4152 5445 525f 434f 4e53 5441  R_QUARTER_CONSTA
-0002de90: 4e54 3a20 206c 6c75 2e45 4d50 4f57 4552  NT:  llu.EMPOWER
-0002dea0: 5f51 5541 5254 4552 5f43 4f4e 5354 414e  _QUARTER_CONSTAN
-0002deb0: 540d 0a20 2020 2020 2020 2020 2020 2020  T..             
-0002dec0: 2020 2020 2020 2020 2020 2020 2c6c 6c75              ,llu
-0002ded0: 2e45 4d50 4f57 4552 5f4d 4f4e 5448 5f43  .EMPOWER_MONTH_C
-0002dee0: 4f4e 5354 414e 543a 2020 2020 6c6c 752e  ONSTANT:    llu.
-0002def0: 454d 504f 5745 525f 4d4f 4e54 485f 434f  EMPOWER_MONTH_CO
-0002df00: 4e53 5441 4e54 0d0a 2020 2020 2020 2020  NSTANT..        
-0002df10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002df20: 202c 6c6c 752e 454d 504f 5745 525f 5745   ,llu.EMPOWER_WE
-0002df30: 454b 5f43 4f4e 5354 414e 543a 2020 2020  EK_CONSTANT:    
-0002df40: 206c 6c75 2e45 4d50 4f57 4552 5f57 4545   llu.EMPOWER_WEE
-0002df50: 4b5f 434f 4e53 5441 4e54 0d0a 2020 2020  K_CONSTANT..    
-0002df60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002df70: 2020 2020 202c 6c6c 752e 454d 504f 5745       ,llu.EMPOWE
-0002df80: 525f 4441 595f 434f 4e53 5441 4e54 3a20  R_DAY_CONSTANT: 
-0002df90: 2020 2020 206c 6c75 2e45 4d50 4f57 4552       llu.EMPOWER
-0002dfa0: 5f44 4159 5f43 4f4e 5354 414e 540d 0a20  _DAY_CONSTANT.. 
-0002dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002dfc0: 2020 2020 2020 2020 2c27 5927 3a20 6c6c          ,'Y': ll
-0002dfd0: 752e 454d 504f 5745 525f 5945 4152 5f43  u.EMPOWER_YEAR_C
-0002dfe0: 4f4e 5354 414e 540d 0a20 2020 2020 2020  ONSTANT..       
-0002dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e000: 2020 2c27 4827 3a20 6c6c 752e 454d 504f    ,'H': llu.EMPO
-0002e010: 5745 525f 4841 4c46 5945 4152 5f43 4f4e  WER_HALFYEAR_CON
-0002e020: 5354 414e 540d 0a20 2020 2020 2020 2020  STANT..         
-0002e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e040: 2c27 5127 3a20 6c6c 752e 454d 504f 5745  ,'Q': llu.EMPOWE
-0002e050: 525f 5155 4152 5445 525f 434f 4e53 5441  R_QUARTER_CONSTA
-0002e060: 4e54 0d0a 2020 2020 2020 2020 2020 2020  NT..            
-0002e070: 2020 2020 2020 2020 2020 2020 202c 274d               ,'M
-0002e080: 273a 206c 6c75 2e45 4d50 4f57 4552 5f4d  ': llu.EMPOWER_M
-0002e090: 4f4e 5448 5f43 4f4e 5354 414e 540d 0a20  ONTH_CONSTANT.. 
-0002e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e0b0: 2020 2020 2020 2020 2c27 5727 3a20 6c6c          ,'W': ll
-0002e0c0: 752e 454d 504f 5745 525f 5745 454b 5f43  u.EMPOWER_WEEK_C
-0002e0d0: 4f4e 5354 414e 540d 0a20 2020 2020 2020  ONSTANT..       
-0002e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e0f0: 2020 2c27 4427 3a20 6c6c 752e 454d 504f    ,'D': llu.EMPO
-0002e100: 5745 525f 4441 595f 434f 4e53 5441 4e54  WER_DAY_CONSTANT
-0002e110: 7d5b 696e 7465 7276 616c 5f69 6e64 6578  }[interval_index
-0002e120: 5d0d 0a0d 0a20 2020 2020 2020 2073 7570  ]....        sup
-0002e130: 6572 2854 696d 6545 6c65 6d65 6e74 2c20  er(TimeElement, 
-0002e140: 7365 6c66 292e 5f5f 696e 6974 5f5f 2873  self).__init__(s
-0002e150: 686f 7274 6e61 6d65 3d73 686f 7274 6e61  hortname=shortna
-0002e160: 6d65 2c6c 6f6e 676e 616d 653d 6c6f 6e67  me,longname=long
-0002e170: 6e61 6d65 2c64 6573 6372 6970 7469 6f6e  name,description
-0002e180: 3d64 6573 6372 6970 7469 6f6e 2c70 6879  =description,phy
-0002e190: 7369 643d 7068 7973 6964 2c64 696d 656e  sid=physid,dimen
-0002e1a0: 7369 6f6e 3d64 696d 656e 7369 6f6e 290d  sion=dimension).
-0002e1b0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0002e1c0: 5f79 6561 7220 2020 2020 2020 2020 2020  _year           
-0002e1d0: 3d20 7965 6172 0d0a 2020 2020 2020 2020  = year..        
-0002e1e0: 7365 6c66 2e5f 6d6f 6e74 6820 2020 2020  self._month     
-0002e1f0: 2020 2020 203d 206d 6f6e 7468 0d0a 2020       = month..  
-0002e200: 2020 2020 2020 7365 6c66 2e5f 6461 7920        self._day 
-0002e210: 2020 2020 2020 2020 2020 203d 2064 6179             = day
-0002e220: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0002e230: 696e 7465 7276 616c 5f69 6e64 6578 203d  interval_index =
-0002e240: 2069 6e74 6572 7661 6c5f 696e 6465 780d   interval_index.
-0002e250: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0002e260: 5f69 6e74 6572 7661 6c5f 616d 6f75 6e74  _interval_amount
-0002e270: 203d 2031 2023 2044 6566 6175 6c74 0d0a   = 1 # Default..
-0002e280: 2020 2020 2020 2020 7365 6c66 2e5f 7265          self._re
-0002e290: 736f 6c75 7469 6f6e 2020 2020 2020 3d20  solution      = 
-0002e2a0: 3120 2320 4465 6661 756c 740d 0a20 2020  1 # Default..   
-0002e2b0: 2020 2020 2073 656c 662e 5f6f 6666 7365       self._offse
-0002e2c0: 7420 2020 2020 2020 2020 203d 204e 6f6e  t          = Non
-0002e2d0: 650d 0a0d 0a20 2020 2020 2020 2069 6620  e....        if 
-0002e2e0: 7365 6c66 2e5f 6d6f 6e74 6820 6973 204e  self._month is N
-0002e2f0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0002e300: 2020 7365 6c66 2e5f 6d6f 6e74 6820 3d20    self._month = 
-0002e310: 310d 0a0d 0a20 2020 2020 2020 2069 6620  1....        if 
-0002e320: 7365 6c66 2e5f 6461 7920 6973 204e 6f6e  self._day is Non
-0002e330: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0002e340: 7365 6c66 2e5f 6461 7920 3d20 310d 0a20  self._day = 1.. 
-0002e350: 2020 200d 0a20 2020 2020 2020 2073 656c     ..        sel
-0002e360: 662e 5f64 6174 6520 3d20 6461 7465 7469  f._date = dateti
-0002e370: 6d65 2e64 6174 6574 696d 6528 7365 6c66  me.datetime(self
-0002e380: 2e5f 7965 6172 2c20 7365 6c66 2e5f 6d6f  ._year, self._mo
-0002e390: 6e74 682c 2073 656c 662e 5f64 6179 290d  nth, self._day).
-0002e3a0: 0a20 2020 2020 2020 200d 0a20 2020 2040  .        ..    @
-0002e3b0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-0002e3c0: 6620 6461 7465 2873 656c 6629 3a0d 0a20  f date(self):.. 
-0002e3d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0002e3e0: 6c66 2e5f 6461 7465 0d0a 0d0a 2020 2020  lf._date....    
-0002e3f0: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-0002e400: 6566 2069 6e74 6572 7661 6c5f 696e 6465  ef interval_inde
-0002e410: 7828 7365 6c66 293a 0d0a 2020 2020 2020  x(self):..      
-0002e420: 2020 7265 7475 726e 2073 656c 662e 5f69    return self._i
-0002e430: 6e74 6572 7661 6c5f 696e 6465 780d 0a0d  nterval_index...
-0002e440: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
-0002e450: 2020 2020 6465 6620 696e 7465 7276 616c      def interval
-0002e460: 2873 656c 6629 3a0d 0a0d 0a20 2020 2020  (self):....     
-0002e470: 2020 2072 6574 7572 6e20 7b6c 6c75 2e45     return {llu.E
-0002e480: 4d50 4f57 4552 5f59 4541 525f 434f 4e53  MPOWER_YEAR_CONS
-0002e490: 5441 4e54 3a20 2020 2027 5965 6172 270d  TANT:    'Year'.
-0002e4a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002e4b0: 2c6c 6c75 2e45 4d50 4f57 4552 5f48 414c  ,llu.EMPOWER_HAL
-0002e4c0: 4659 4541 525f 434f 4e53 5441 4e54 3a27  FYEAR_CONSTANT:'
-0002e4d0: 4861 6c66 2d79 6561 7227 0d0a 2020 2020  Half-year'..    
-0002e4e0: 2020 2020 2020 2020 2020 202c 6c6c 752e             ,llu.
-0002e4f0: 454d 504f 5745 525f 5155 4152 5445 525f  EMPOWER_QUARTER_
-0002e500: 434f 4e53 5441 4e54 3a20 2751 7561 7274  CONSTANT: 'Quart
-0002e510: 6572 270d 0a20 2020 2020 2020 2020 2020  er'..           
-0002e520: 2020 2020 2c6c 6c75 2e45 4d50 4f57 4552      ,llu.EMPOWER
-0002e530: 5f4d 4f4e 5448 5f43 4f4e 5354 414e 543a  _MONTH_CONSTANT:
-0002e540: 2020 2027 4d6f 6e74 6827 0d0a 2020 2020     'Month'..    
-0002e550: 2020 2020 2020 2020 2020 202c 6c6c 752e             ,llu.
-0002e560: 454d 504f 5745 525f 5745 454b 5f43 4f4e  EMPOWER_WEEK_CON
-0002e570: 5354 414e 543a 2020 2020 2757 6565 6b27  STANT:    'Week'
-0002e580: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002e590: 202c 6c6c 752e 454d 504f 5745 525f 4441   ,llu.EMPOWER_DA
-0002e5a0: 595f 434f 4e53 5441 4e54 3a20 2020 2020  Y_CONSTANT:     
-0002e5b0: 2744 6179 270d 0a20 2020 2020 2020 2020  'Day'..         
-0002e5c0: 2020 2020 2020 7d5b 7365 6c66 2e69 6e74        }[self.int
-0002e5d0: 6572 7661 6c5f 696e 6465 785d 0d0a 0d0a  erval_index]....
-0002e5e0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-0002e5f0: 0a20 2020 2064 6566 2069 6e74 6572 7661  .    def interva
-0002e600: 6c5f 616d 6f75 6e74 2873 656c 6629 3a0d  l_amount(self):.
-0002e610: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0002e620: 7365 6c66 2e5f 696e 7465 7276 616c 5f61  self._interval_a
-0002e630: 6d6f 756e 740d 0a0d 0a20 2020 2040 7072  mount....    @pr
-0002e640: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-0002e650: 7265 736f 6c75 7469 6f6e 2873 656c 6629  resolution(self)
-0002e660: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-0002e670: 6e20 7365 6c66 2e5f 7265 736f 6c75 7469  n self._resoluti
-0002e680: 6f6e 0d0a 0d0a 2020 2020 4070 726f 7065  on....    @prope
-0002e690: 7274 790d 0a20 2020 2064 6566 206f 6666  rty..    def off
-0002e6a0: 7365 7428 7365 6c66 293a 0d0a 2020 2020  set(self):..    
-0002e6b0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0002e6c0: 5f6f 6666 7365 740d 0a0d 0a0d 0a20 2020  _offset......   
-0002e6d0: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-0002e6e0: 6465 6620 656d 706f 7765 725f 7065 7269  def empower_peri
-0002e6f0: 6f64 5f6e 756d 6265 7228 7365 6c66 293a  od_number(self):
-0002e700: 0d0a 2020 2020 2020 2020 2727 2741 7070  ..        '''App
-0002e710: 6c69 6573 2074 6f20 7469 6d65 2065 6c65  lies to time ele
-0002e720: 6d65 6e74 7320 6f6e 6c79 2e20 4120 7265  ments only. A re
-0002e730: 6164 206f 6e6c 7920 7072 6f70 6572 7479  ad only property
-0002e740: 2074 6861 7420 7265 7475 726e 7320 7468   that returns th
-0002e750: 6520 456d 706f 7765 7220 5065 7269 6f64  e Empower Period
-0002e760: 2074 7970 6520 6e75 6d62 6572 2028 652e   type number (e.
-0002e770: 672e 2033 2066 6f72 2061 204d 6f6e 7468  g. 3 for a Month
-0002e780: 2927 2727 0d0a 2020 2020 2020 2020 7265  )'''..        re
-0002e790: 7475 726e 2073 656c 662e 696e 7465 7276  turn self.interv
-0002e7a0: 616c 5f69 6e64 6578 0d0a 0d0a 2020 2020  al_index....    
-0002e7b0: 6465 6620 636f 7079 2873 656c 6629 3a0d  def copy(self):.
-0002e7c0: 0a20 2020 2020 2020 2027 2727 4372 6561  .        '''Crea
-0002e7d0: 7465 2061 2063 6f70 7920 6f66 2073 656c  te a copy of sel
-0002e7e0: 662c 206e 6f74 2069 6e63 6c75 6469 6e67  f, not including
-0002e7f0: 2074 6865 2070 6879 7369 6420 6f72 2073   the physid or s
-0002e800: 686f 7274 6e61 6d65 2727 270d 0a20 2020  hortname'''..   
-0002e810: 2020 2020 2072 6574 7572 6e20 5469 6d65       return Time
-0002e820: 456c 656d 656e 7428 6c6f 6e67 6e61 6d65  Element(longname
-0002e830: 2020 2020 2020 2020 2020 2020 203d 2073               = s
-0002e840: 656c 662e 6c6f 6e67 6e61 6d65 0d0a 2020  elf.longname..  
-0002e850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e860: 2020 2020 2c73 686f 7274 6e61 6d65 2020      ,shortname  
-0002e870: 2020 2020 2020 2020 2020 3d20 4e6f 6e65            = None
-0002e880: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002e890: 2020 2020 2020 2020 2c64 6573 6372 6970          ,descrip
-0002e8a0: 7469 6f6e 2020 2020 2020 2020 2020 3d20  tion          = 
-0002e8b0: 7365 6c66 2e64 6573 6372 6970 7469 6f6e  self.description
-0002e8c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0002e8d0: 2020 2020 2020 2020 2c69 6e74 6572 7661          ,interva
-0002e8e0: 6c5f 696e 6465 7820 2020 2020 2020 2020  l_index         
-0002e8f0: 2020 3d20 7365 6c66 2e69 6e74 6572 7661    = self.interva
-0002e900: 6c5f 696e 6465 780d 0a20 2020 2020 2020  l_index..       
-0002e910: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-0002e920: 7965 6172 2020 203d 2073 656c 662e 7965  year   = self.ye
-0002e930: 6172 0d0a 2020 2020 2020 2020 2020 2020  ar..            
-0002e940: 2020 2020 2020 2020 2020 2c6d 6f6e 7468            ,month
-0002e950: 2020 2020 2020 2020 2020 3d20 7365 6c66            = self
-0002e960: 2e6d 6f6e 7468 0d0a 2020 2020 2020 2020  .month..        
-0002e970: 2020 2020 2020 2020 2020 2020 2020 2c64                ,d
-0002e980: 6179 2020 2020 2020 2020 2020 2020 2020  ay              
-0002e990: 203d 2073 656c 662e 6461 790d 0a20 2020   = self.day..   
-0002e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002e9b0: 2020 202c 7765 656b 2020 2020 2020 2020     ,week        
-0002e9c0: 2020 2020 2020 203d 2073 656c 662e 7765         = self.we
-0002e9d0: 656b 0d0a 2020 2020 2020 2020 2020 2020  ek..            
-0002e9e0: 2020 2020 2020 2020 2020 2c71 7561 7274            ,quart
-0002e9f0: 6572 2020 2020 2020 2020 2020 2020 2020  er              
-0002ea00: 203d 2073 656c 662e 7175 6172 7465 720d   = self.quarter.
-0002ea10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002ea20: 2020 2020 2020 202c 6861 6c66 2020 2020         ,half    
-0002ea30: 2020 2020 2020 2020 2020 203d 2073 656c             = sel
-0002ea40: 662e 6861 6c66 0d0a 2020 2020 2020 2020  f.half..        
-0002ea50: 2020 2020 2020 2020 2020 2020 2020 2c64                ,d
-0002ea60: 696d 656e 7369 6f6e 2020 2020 2020 2020  imension        
-0002ea70: 2020 2020 3d20 7365 6c66 2e64 696d 656e      = self.dimen
-0002ea80: 7369 6f6e 0d0a 2020 2020 2020 2020 2020  sion..          
-0002ea90: 2020 2020 2020 2020 2020 2020 290d 0a0d              )...
-0002eaa0: 0a63 6c61 7373 2053 7472 7563 7475 7265  .class Structure
-0002eab0: 286f 626a 6563 7429 3a0d 0a0d 0a20 2020  (object):....   
-0002eac0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-0002ead0: 6c66 2c73 686f 7274 6e61 6d65 3d4e 6f6e  lf,shortname=Non
-0002eae0: 652c 6c6f 6e67 6e61 6d65 3d4e 6f6e 652c  e,longname=None,
-0002eaf0: 6469 6d65 6e73 696f 6e5f 696e 6465 783d  dimension_index=
-0002eb00: 4e6f 6e65 2c64 696d 656e 7369 6f6e 3d4e  None,dimension=N
-0002eb10: 6f6e 652c 6465 7363 7269 7074 696f 6e3d  one,description=
-0002eb20: 4e6f 6e65 293a 0d0a 0d0a 2020 2020 2020  None):....      
-0002eb30: 2020 7365 6c66 2e5f 7368 6f72 746e 616d    self._shortnam
-0002eb40: 653d 7368 6f72 746e 616d 650d 0a20 2020  e=shortname..   
-0002eb50: 2020 2020 2073 656c 662e 5f6c 6f6e 676e       self._longn
-0002eb60: 616d 6520 3d6c 6f6e 676e 616d 650d 0a20  ame =longname.. 
-0002eb70: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-0002eb80: 6c6f 6e67 6e61 6d65 2069 7320 4e6f 6e65  longname is None
-0002eb90: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0002eba0: 656c 662e 5f6c 6f6e 676e 616d 6520 3d20  elf._longname = 
-0002ebb0: 7365 6c66 2e5f 7368 6f72 746e 616d 650d  self._shortname.
-0002ebc0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0002ebd0: 6469 6d65 6e73 696f 6e20 3d20 6469 6d65  dimension = dime
-0002ebe0: 6e73 696f 6e0d 0a20 2020 2020 2020 2069  nsion..        i
-0002ebf0: 6620 7365 6c66 2e64 696d 656e 7369 6f6e  f self.dimension
-0002ec00: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0002ec10: 656c 662e 6469 6d65 6e73 696f 6e5f 696e  elf.dimension_in
-0002ec20: 6465 7820 3d20 7365 6c66 2e64 696d 656e  dex = self.dimen
-0002ec30: 7369 6f6e 2e69 6e64 6578 0d0a 2020 2020  sion.index..    
-0002ec40: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0002ec50: 2020 2020 2020 2073 656c 662e 6469 6d65         self.dime
-0002ec60: 6e73 696f 6e5f 696e 6465 7820 3d20 6469  nsion_index = di
-0002ec70: 6d65 6e73 696f 6e5f 696e 6465 780d 0a0d  mension_index...
-0002ec80: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
-0002ec90: 6573 6372 6970 7469 6f6e 203d 2064 6573  escription = des
-0002eca0: 6372 6970 7469 6f6e 0d0a 0d0a 2020 2020  cription....    
-0002ecb0: 2020 2020 2344 6963 7469 6f6e 6172 7920      #Dictionary 
-0002ecc0: 6f66 2073 686f 7274 6e61 6d65 2c20 656c  of shortname, el
-0002ecd0: 656d 656e 7420 7061 6972 730d 0a20 2020  ement pairs..   
-0002ece0: 2020 2020 2023 616c 6c6f 7720 726f 6f74       #allow root
-0002ecf0: 2065 6c65 6d65 6e74 7320 746f 2062 6568   elements to beh
-0002ed00: 6176 6520 6c69 6b65 2061 2064 6963 7469  ave like a dicti
-0002ed10: 6f6e 6172 7920 2d20 652e 672e 2073 7472  onary - e.g. str
-0002ed20: 7563 7475 7265 2e68 6965 7261 7263 6869  ucture.hierarchi
-0002ed30: 6573 5b27 4547 4753 275d 0d0a 2020 2020  es['EGGS']..    
-0002ed40: 2020 2020 7365 6c66 2e5f 6869 6572 6172      self._hierar
-0002ed50: 6368 6965 7320 3d20 5f48 6965 7261 7263  chies = _Hierarc
-0002ed60: 6869 6573 4765 7474 6572 2873 7472 7563  hiesGetter(struc
-0002ed70: 7475 7265 203d 2073 656c 6629 0d0a 2020  ture = self)..  
-0002ed80: 2020 2020 2020 236c 6f67 2e69 6e66 6f28        #log.info(
-0002ed90: 2753 6574 205f 6869 6572 6172 6368 6965  'Set _hierarchie
-0002eda0: 7327 290d 0a20 2020 2020 2020 2023 6c6f  s')..        #lo
-0002edb0: 672e 696e 666f 2873 7472 2873 656c 662e  g.info(str(self.
-0002edc0: 5f68 6965 7261 7263 6869 6573 2029 290d  _hierarchies )).
-0002edd0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0002ede0: 5f64 6573 6365 6e64 616e 7473 203d 205f  _descendants = _
-0002edf0: 5374 7275 6374 7572 6544 6573 6365 6e64  StructureDescend
-0002ee00: 616e 7473 4765 7474 6572 2873 7472 7563  antsGetter(struc
-0002ee10: 7475 7265 203d 2073 656c 6629 0d0a 0d0a  ture = self)....
-0002ee20: 2020 2020 2020 2020 7365 6c66 2e5f 6869          self._hi
-0002ee30: 6572 6172 6368 6965 735f 7265 6164 203d  erarchies_read =
-0002ee40: 2046 616c 7365 0d0a 0d0a 2020 2020 2020   False....      
-0002ee50: 2020 7365 6c66 2e5f 6578 6973 7473 5f69    self._exists_i
-0002ee60: 6e5f 656d 706f 7765 7220 3d20 4661 6c73  n_empower = Fals
-0002ee70: 650d 0a0d 0a0d 0a20 2020 2040 7072 6f70  e......    @prop
-0002ee80: 6572 7479 0d0a 2020 2020 6465 6620 6869  erty..    def hi
-0002ee90: 6572 6172 6368 6965 7328 7365 6c66 293a  erarchies(self):
-0002eea0: 0d0a 2020 2020 2020 2020 2727 2747 6574  ..        '''Get
-0002eeb0: 2061 2064 6963 7469 6f6e 6172 792d 6c69   a dictionary-li
-0002eec0: 6b65 206f 626a 6563 7420 636f 6e74 6961  ke object contia
-0002eed0: 6e69 6e67 2061 6c6c 206f 6620 7468 6520  ning all of the 
-0002eee0: 6869 6572 6172 6368 6965 7320 2874 6f70  hierarchies (top
-0002eef0: 206c 6576 656c 2053 7472 7563 7475 7265   level Structure
-0002ef00: 456c 656d 656e 7473 2920 696e 2074 6869  Elements) in thi
-0002ef10: 7320 5374 7275 6374 7572 650d 0a0d 0a20  s Structure.... 
-0002ef20: 2020 2020 2020 2045 2e67 2e20 746f 2067         E.g. to g
-0002ef30: 6574 2074 6865 2072 6f6f 7420 5374 7275  et the root Stru
-0002ef40: 6374 7572 6545 6c65 6d65 6e74 2066 6f72  ctureElement for
-0002ef50: 2053 7472 7563 7475 7265 206d 795f 7374   Structure my_st
-0002ef60: 7275 6374 7572 652c 2077 6974 6820 7368  ructure, with sh
-0002ef70: 6f72 7463 6f64 6520 2753 5041 4d27 3a0d  ortcode 'SPAM':.
-0002ef80: 0a0d 0a20 2020 2020 2020 203e 3e3e 206d  ...        >>> m
-0002ef90: 795f 7374 7275 6374 7572 652e 6869 6572  y_structure.hier
-0002efa0: 6172 6368 6965 735b 2753 5041 4d27 5d0d  archies['SPAM'].
-0002efb0: 0a20 2020 2020 2020 2027 2727 0d0a 0d0a  .        '''....
-0002efc0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0002efd0: 656c 662e 5f68 6965 7261 7263 6869 6573  elf._hierarchies
-0002efe0: 5f72 6561 643a 0d0a 2020 2020 2020 2020  _read:..        
-0002eff0: 2020 2020 236c 6f67 2e69 6e66 6f28 275f      #log.info('_
-0002f000: 6c6f 6164 5f73 7472 7563 7475 7265 2033  load_structure 3
-0002f010: 3033 3527 290d 0a20 2020 2020 2020 2020  035')..         
-0002f020: 2020 2069 6620 7365 6c66 2e64 696d 656e     if self.dimen
-0002f030: 7369 6f6e 2069 7320 6e6f 7420 4e6f 6e65  sion is not None
-0002f040: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0002f050: 2020 2069 6620 6e6f 7420 7365 6c66 2e73     if not self.s
-0002f060: 686f 7274 636f 6465 3a20 7072 696e 7428  hortcode: print(
-0002f070: 2773 686f 7274 636f 6465 2069 7320 4e6f  'shortcode is No
-0002f080: 6e65 2729 0d0a 2020 2020 2020 2020 2020  ne')..          
-0002f090: 2020 2020 2020 6173 7365 7274 2073 656c        assert sel
-0002f0a0: 662e 7368 6f72 7463 6f64 6520 6973 206e  f.shortcode is n
-0002f0b0: 6f74 204e 6f6e 650d 0a0d 0a20 2020 2020  ot None....     
-0002f0c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0002f0d0: 6469 6d65 6e73 696f 6e2e 7374 7275 6374  dimension.struct
-0002f0e0: 7572 6573 2e5f 6c6f 6164 5f73 7472 7563  ures._load_struc
-0002f0f0: 7475 7265 2873 656c 662e 7368 6f72 7463  ture(self.shortc
-0002f100: 6f64 652c 6f6c 645f 7374 7275 6374 7572  ode,old_structur
-0002f110: 6520 3d20 7365 6c66 290d 0a0d 0a20 2020  e = self)....   
-0002f120: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0002f130: 2e5f 6869 6572 6172 6368 6965 730d 0a0d  ._hierarchies...
-0002f140: 0a20 2020 2040 6869 6572 6172 6368 6965  .    @hierarchie
-0002f150: 732e 7365 7474 6572 0d0a 2020 2020 6465  s.setter..    de
-0002f160: 6620 6869 6572 6172 6368 6965 7328 7365  f hierarchies(se
-0002f170: 6c66 2c76 616c 293a 0d0a 2020 2020 2020  lf,val):..      
-0002f180: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0002f190: 7661 6c2c 5f48 6965 7261 7263 6869 6573  val,_Hierarchies
-0002f1a0: 4765 7474 6572 293a 0d0a 2020 2020 2020  Getter):..      
-0002f1b0: 2020 2020 2020 7365 6c66 2e5f 6869 6572        self._hier
-0002f1c0: 6172 6368 6965 7320 3d20 7661 6c0d 0a20  archies = val.. 
-0002f1d0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0002f1e0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0002f1f0: 6869 6572 6172 6368 6965 732e 636c 6561  hierarchies.clea
-0002f200: 7228 290d 0a20 2020 2020 2020 2020 2020  r()..           
-0002f210: 2023 6c6f 672e 696e 666f 2827 5365 7474   #log.info('Sett
-0002f220: 696e 6720 6869 6572 6172 6368 6965 7320  ing hierarchies 
-0002f230: 746f 207b 7d27 2e66 6f72 6d61 7428 7661  to {}'.format(va
-0002f240: 6c29 290d 0a20 2020 2020 2020 2020 2020  l))..           
-0002f250: 2073 656c 662e 5f68 6965 7261 7263 6869   self._hierarchi
-0002f260: 6573 2e61 7070 656e 6428 7661 6c29 0d0a  es.append(val)..
-0002f270: 0d0a 2020 2020 6465 6620 5f67 6574 5f65  ..    def _get_e
-0002f280: 6c65 6d65 6e74 735f 6765 6e65 7261 746f  lements_generato
-0002f290: 7228 7365 6c66 2c73 686f 7274 6e61 6d65  r(self,shortname
-0002f2a0: 293a 0d0a 2020 2020 2020 2020 2727 2747  ):..        '''G
-0002f2b0: 6574 2061 6c6c 206f 6620 7468 6520 656c  et all of the el
-0002f2c0: 656d 656e 7473 2069 6e20 7468 6973 2073  ements in this s
-0002f2d0: 7472 7563 7475 7265 2077 6974 6820 7468  tructure with th
-0002f2e0: 6520 6769 7665 6e20 7368 6f72 746e 616d  e given shortnam
-0002f2f0: 6527 2727 0d0a 2020 2020 2020 2020 234b  e'''..        #K
-0002f300: 6565 7020 7472 6163 6b20 6f66 2077 6865  eep track of whe
-0002f310: 7468 6572 2061 6e20 656c 656d 656e 7420  ther an element 
-0002f320: 7761 7320 7061 7373 6564 2069 6e20 746f  was passed in to
-0002f330: 2068 656c 7020 7769 7468 2064 6562 7567   help with debug
-0002f340: 6769 6e67 0d0a 2020 2020 2020 2020 656c  ging..        el
-0002f350: 656d 656e 745f 7761 735f 7061 7373 6564  ement_was_passed
-0002f360: 5f69 6e3d 4661 6c73 650d 0a0d 0a20 2020  _in=False....   
-0002f370: 2020 2020 2023 4966 2061 6e20 656c 656d       #If an elem
-0002f380: 656e 7420 6861 7320 6265 656e 2070 6173  ent has been pas
-0002f390: 7365 6420 696e 2c20 7573 6520 7468 6520  sed in, use the 
-0002f3a0: 656c 656d 656e 7427 7320 7368 6f72 746e  element's shortn
-0002f3b0: 616d 650d 0a20 2020 2020 2020 2074 7279  ame..        try
-0002f3c0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0002f3d0: 686f 7274 6e61 6d65 3d73 686f 7274 6e61  hortname=shortna
-0002f3e0: 6d65 2e73 686f 7274 6e61 6d65 0d0a 2020  me.shortname..  
-0002f3f0: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-0002f400: 745f 7761 735f 7061 7373 6564 5f69 6e3d  t_was_passed_in=
-0002f410: 5472 7565 0d0a 2020 2020 2020 2020 6578  True..        ex
-0002f420: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
-0002f430: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-0002f440: 2020 7061 7373 0d0a 0d0a 2020 2020 2020    pass....      
-0002f450: 2020 2354 4f44 4f20 2d63 6865 636b 2074    #TODO -check t
-0002f460: 6861 7420 7368 6f72 746e 616d 6520 6973  hat shortname is
-0002f470: 206e 6f74 204e 6f6e 650d 0a20 2020 2020   not None..     
-0002f480: 2020 2069 6620 7368 6f72 746e 616d 6520     if shortname 
-0002f490: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-0002f4a0: 2020 2020 2020 2350 726f 6772 616d 6d69        #Programmi
-0002f4b0: 6e67 2065 7272 6f72 0d0a 2020 2020 2020  ng error..      
-0002f4c0: 2020 2020 2020 6966 2065 6c65 6d65 6e74        if element
-0002f4d0: 5f77 6173 5f70 6173 7365 645f 696e 3a0d  _was_passed_in:.
-0002f4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002f4f0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0002f500: 7228 2765 6c65 6d65 6e74 2e73 686f 7274  r('element.short
-0002f510: 6e61 6d65 206d 7573 7420 6861 7665 2061  name must have a
-0002f520: 2076 616c 7565 2e20 4e6f 6e65 2077 6173   value. None was
-0002f530: 2073 7570 706c 6965 642e 2064 6562 7567   supplied. debug
-0002f540: 6769 6e67 2069 6e66 6f72 6d61 7469 6f6e  ging information
-0002f550: 3a20 416e 2075 7469 6c73 2e45 6c65 6d65  : An utils.Eleme
-0002f560: 6e74 2069 6e73 7461 6e63 6520 7761 7320  nt instance was 
-0002f570: 7061 7373 6564 2069 6e20 6173 2074 6865  passed in as the
-0002f580: 2073 686f 7274 6e61 6d65 2070 6172 616d   shortname param
-0002f590: 6574 6572 2074 6f20 6675 6e63 7469 6f6e  eter to function
-0002f5a0: 2067 6574 5f65 6c65 6d65 6e74 2829 2729   get_element()')
-0002f5b0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-0002f5c0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0002f5d0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0002f5e0: 4572 726f 7228 2773 686f 7274 6e61 6d65  Error('shortname
-0002f5f0: 206d 7573 7420 6861 7665 2061 2076 616c   must have a val
-0002f600: 7565 2e20 4e6f 6e65 2077 6173 2073 7570  ue. None was sup
-0002f610: 706c 6965 642e 2729 0d0a 2020 2020 2020  plied.')..      
-0002f620: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-0002f630: 2020 2020 7368 6f72 746e 616d 653d 7368      shortname=sh
-0002f640: 6f72 746e 616d 652e 7368 6f72 746e 616d  ortname.shortnam
-0002f650: 650d 0a20 2020 2020 2020 2065 7863 6570  e..        excep
-0002f660: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
-0002f670: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-0002f680: 6173 730d 0a0d 0a20 2020 2020 2020 2066  ass....        f
-0002f690: 6f72 2068 2069 6e20 7365 6c66 2e68 6965  or h in self.hie
-0002f6a0: 7261 7263 6869 6573 3a0d 0a20 2020 2020  rarchies:..     
-0002f6b0: 2020 2020 2020 2079 6965 6c64 2066 726f         yield fro
-0002f6c0: 6d20 682e 6765 745f 656c 656d 656e 7473  m h.get_elements
-0002f6d0: 2873 686f 7274 6e61 6d65 290d 0a0d 0a20  (shortname).... 
-0002f6e0: 2020 2064 6566 2067 6574 5f65 6c65 6d65     def get_eleme
-0002f6f0: 6e74 7328 7365 6c66 2c73 686f 7274 6e61  nts(self,shortna
-0002f700: 6d65 293a 0d0a 2020 2020 2020 2020 2727  me):..        ''
-0002f710: 2747 6574 2061 6c6c 206f 6620 7468 6520  'Get all of the 
-0002f720: 656c 656d 656e 7473 2069 6e20 7468 6973  elements in this
-0002f730: 2073 7472 7563 7475 7265 2077 6974 6820   structure with 
-0002f740: 7468 6520 6769 7665 6e20 7368 6f72 746e  the given shortn
-0002f750: 616d 6527 2727 0d0a 2020 2020 2020 2020  ame'''..        
-0002f760: 2350 594d 2d36 372c 2067 6574 5f65 6c65  #PYM-67, get_ele
-0002f770: 6d65 6e74 7320 6f6e 2061 2068 6965 7261  ments on a hiera
-0002f780: 7263 6879 2063 616e 2062 6520 696e 6465  rchy can be inde
-0002f790: 7865 6420 2d20 7065 6f70 6c65 2061 7373  xed - people ass
-0002f7a0: 756d 6520 7468 6520 7361 6d65 2066 6f72  ume the same for
-0002f7b0: 2061 2073 7472 7563 7475 7265 0d0a 2020   a structure..  
-0002f7c0: 2020 2020 2020 7265 7475 726e 206c 6973        return lis
-0002f7d0: 7428 7365 6c66 2e5f 6765 745f 656c 656d  t(self._get_elem
-0002f7e0: 656e 7473 5f67 656e 6572 6174 6f72 2873  ents_generator(s
-0002f7f0: 686f 7274 6e61 6d65 2929 0d0a 0d0a 2020  hortname))....  
-0002f800: 2020 6465 6620 6765 745f 656c 656d 656e    def get_elemen
-0002f810: 7428 7365 6c66 2c73 686f 7274 6e61 6d65  t(self,shortname
-0002f820: 293a 0d0a 2020 2020 2020 2020 2727 2744  ):..        '''D
-0002f830: 6570 7265 6361 7465 642c 2044 6f6e 2774  eprecated, Don't
-0002f840: 2075 7365 2074 6869 7320 6675 6e63 7469   use this functi
-0002f850: 6f6e 2c20 596f 7520 7072 6f62 6162 6c79  on, You probably
-0002f860: 2077 616e 7420 2e67 6574 5f72 6f6f 745f   want .get_root_
-0002f870: 656c 656d 656e 7428 292c 2046 6169 6c69  element(), Faili
-0002f880: 6e67 2074 6861 7420 796f 7520 6d61 7920  ng that you may 
-0002f890: 7761 6e74 202e 6765 745f 656c 656d 656e  want .get_elemen
-0002f8a0: 7473 2827 736f 6d65 5f73 6e27 295b 305d  ts('some_sn')[0]
-0002f8b0: 2e27 2727 0d0a 2020 2020 2020 2020 7261  .'''..        ra
-0002f8c0: 6973 6520 5479 7065 4572 726f 7228 2244  ise TypeError("D
-0002f8d0: 6f6e 2774 2075 7365 2074 6869 7320 6675  on't use this fu
-0002f8e0: 6e63 7469 6f6e 2e20 596f 7520 7072 6f62  nction. You prob
-0002f8f0: 6162 6c79 2077 616e 7420 6765 745f 726f  ably want get_ro
-0002f900: 6f74 5f65 6c65 6d65 6e74 2e20 4661 696c  ot_element. Fail
-0002f910: 696e 6720 7468 6174 2079 6f75 206d 6179  ing that you may
-0002f920: 2077 616e 7420 6765 745f 656c 656d 656e   want get_elemen
-0002f930: 7473 2229 0d0a 2020 2020 2020 2020 2354  ts")..        #T
-0002f940: 6865 2069 7373 7565 2069 7320 7468 6174  he issue is that
-0002f950: 2074 6865 7265 2063 616e 2062 6520 6d75   there can be mu
-0002f960: 6c74 6970 6c65 2053 7472 7563 7475 7265  ltiple Structure
-0002f970: 456c 656d 656e 7473 2069 6e20 6120 6769  Elements in a gi
-0002f980: 7665 6e20 7374 7275 6374 7572 6520 7769  ven structure wi
-0002f990: 7468 2074 6865 2073 616d 6520 7368 6f72  th the same shor
-0002f9a0: 746e 616d 650d 0a0d 0a20 2020 2064 6566  tname....    def
-0002f9b0: 2067 6574 5f72 6f6f 745f 656c 656d 656e   get_root_elemen
-0002f9c0: 7428 7365 6c66 2c73 686f 7274 6e61 6d65  t(self,shortname
-0002f9d0: 293a 0d0a 2020 2020 2020 2020 2727 2747  ):..        '''G
-0002f9e0: 6574 2074 6865 2072 6f6f 7420 656c 656d  et the root elem
-0002f9f0: 656e 7420 696e 2074 6869 7320 7374 7275  ent in this stru
-0002fa00: 6374 7572 6520 7769 7468 2074 6865 2067  cture with the g
-0002fa10: 6976 656e 2073 686f 7274 6e61 6d65 2727  iven shortname''
-0002fa20: 270d 0a20 2020 2020 2020 2023 4b65 6570  '..        #Keep
-0002fa30: 2074 7261 636b 206f 6620 7768 6574 6865   track of whethe
-0002fa40: 7220 616e 2065 6c65 6d65 6e74 2077 6173  r an element was
-0002fa50: 2070 6173 7365 6420 696e 2074 6f20 6865   passed in to he
-0002fa60: 6c70 2077 6974 6820 6465 6275 6767 696e  lp with debuggin
-0002fa70: 670d 0a20 2020 2020 2020 2065 6c65 6d65  g..        eleme
-0002fa80: 6e74 5f77 6173 5f70 6173 7365 645f 696e  nt_was_passed_in
-0002fa90: 3d46 616c 7365 0d0a 0d0a 2020 2020 2020  =False....      
-0002faa0: 2020 2349 6620 616e 2065 6c65 6d65 6e74    #If an element
-0002fab0: 2068 6173 2062 6565 6e20 7061 7373 6564   has been passed
-0002fac0: 2069 6e2c 2075 7365 2074 6865 2065 6c65   in, use the ele
-0002fad0: 6d65 6e74 2773 2073 686f 7274 6e61 6d65  ment's shortname
-0002fae0: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
-0002faf0: 2020 2020 2020 2020 2020 2020 7368 6f72              shor
-0002fb00: 746e 616d 653d 7368 6f72 746e 616d 652e  tname=shortname.
-0002fb10: 7368 6f72 746e 616d 650d 0a20 2020 2020  shortname..     
-0002fb20: 2020 2020 2020 2065 6c65 6d65 6e74 5f77         element_w
-0002fb30: 6173 5f70 6173 7365 645f 696e 3d54 7275  as_passed_in=Tru
-0002fb40: 650d 0a20 2020 2020 2020 2065 7863 6570  e..        excep
-0002fb50: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
-0002fb60: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-0002fb70: 6173 730d 0a0d 0a20 2020 2020 2020 2023  ass....        #
-0002fb80: 544f 444f 202d 6368 6563 6b20 7468 6174  TODO -check that
-0002fb90: 2073 686f 7274 6e61 6d65 2069 7320 6e6f   shortname is no
-0002fba0: 7420 4e6f 6e65 0d0a 2020 2020 2020 2020  t None..        
-0002fbb0: 6966 2073 686f 7274 6e61 6d65 2069 7320  if shortname is 
-0002fbc0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0002fbd0: 2020 2023 5072 6f67 7261 6d6d 696e 6720     #Programming 
-0002fbe0: 6572 726f 720d 0a20 2020 2020 2020 2020  error..         
-0002fbf0: 2020 2069 6620 656c 656d 656e 745f 7761     if element_wa
-0002fc00: 735f 7061 7373 6564 5f69 6e3a 0d0a 2020  s_passed_in:..  
-0002fc10: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0002fc20: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
-0002fc30: 656c 656d 656e 742e 7368 6f72 746e 616d  element.shortnam
-0002fc40: 6520 6d75 7374 2068 6176 6520 6120 7661  e must have a va
-0002fc50: 6c75 652e 204e 6f6e 6520 7761 7320 7375  lue. None was su
-0002fc60: 7070 6c69 6564 2e20 6465 6275 6767 696e  pplied. debuggin
-0002fc70: 6720 696e 666f 726d 6174 696f 6e3a 2041  g information: A
-0002fc80: 6e20 7574 696c 732e 456c 656d 656e 7420  n utils.Element 
-0002fc90: 696e 7374 616e 6365 2077 6173 2070 6173  instance was pas
-0002fca0: 7365 6420 696e 2061 7320 7468 6520 7368  sed in as the sh
-0002fcb0: 6f72 746e 616d 6520 7061 7261 6d65 7465  ortname paramete
-0002fcc0: 7220 746f 2066 756e 6374 696f 6e20 6765  r to function ge
-0002fcd0: 745f 726f 6f74 5f65 6c65 6d65 6e74 2829  t_root_element()
-0002fce0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-0002fcf0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-0002fd00: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-0002fd10: 7565 4572 726f 7228 2773 686f 7274 6e61  ueError('shortna
-0002fd20: 6d65 206d 7573 7420 6861 7665 2061 2076  me must have a v
-0002fd30: 616c 7565 2e20 4e6f 6e65 2077 6173 2073  alue. None was s
-0002fd40: 7570 706c 6965 642e 2729 0d0a 2020 2020  upplied.')..    
-0002fd50: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-0002fd60: 2020 2020 2020 7368 6f72 746e 616d 653d        shortname=
-0002fd70: 7368 6f72 746e 616d 652e 7368 6f72 746e  shortname.shortn
-0002fd80: 616d 650d 0a20 2020 2020 2020 2065 7863  ame..        exc
-0002fd90: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
-0002fda0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-0002fdb0: 2070 6173 730d 0a0d 0a20 2020 2020 2020   pass....       
-0002fdc0: 2023 5265 7475 726e 2074 6865 2066 6972   #Return the fir
-0002fdd0: 7374 2072 6f6f 7420 656c 656d 656e 7420  st root element 
-0002fde0: 7769 7468 2074 6865 2067 6976 656e 2073  with the given s
-0002fdf0: 686f 7274 6e61 6d65 0d0a 2020 2020 2020  hortname..      
-0002fe00: 2020 666f 7220 7374 7275 6374 7572 655f    for structure_
-0002fe10: 656c 656d 656e 7420 696e 2073 656c 662e  element in self.
-0002fe20: 6869 6572 6172 6368 6965 732e 7661 6c75  hierarchies.valu
-0002fe30: 6573 2829 3a0d 0a20 2020 2020 2020 2020  es():..         
-0002fe40: 2020 2069 6620 7374 7275 6374 7572 655f     if structure_
-0002fe50: 656c 656d 656e 742e 7368 6f72 746e 616d  element.shortnam
-0002fe60: 6520 3d3d 2073 686f 7274 6e61 6d65 3a0d  e == shortname:.
-0002fe70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0002fe80: 2072 6574 7572 6e20 7374 7275 6374 7572   return structur
-0002fe90: 655f 656c 656d 656e 740d 0a0d 0a20 2020  e_element....   
-0002fea0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0002feb0: 0d0a 0d0a 2020 2020 6465 6620 5f61 6464  ....    def _add
-0002fec0: 5f65 6c65 6d65 6e74 2873 656c 662c 7374  _element(self,st
-0002fed0: 7275 6374 7572 655f 656c 656d 656e 7429  ructure_element)
-0002fee0: 3a0d 0a20 2020 2020 2020 2027 2727 4465  :..        '''De
-0002fef0: 7072 6563 6174 6564 2e20 4164 6420 616e  precated. Add an
-0002ff00: 2065 6c65 6d65 6e74 2074 6f20 7468 6520   element to the 
-0002ff10: 7374 7275 6374 7572 652c 2062 7574 2064  structure, but d
-0002ff20: 6f6e 2774 2073 7065 6369 6679 2077 6865  on't specify whe
-0002ff30: 7265 2e0d 0a20 2020 2020 2020 2027 2727  re...        '''
-0002ff40: 0d0a 2020 2020 2020 2020 6966 2073 7472  ..        if str
-0002ff50: 7563 7475 7265 5f65 6c65 6d65 6e74 2e69  ucture_element.i
-0002ff60: 735f 726f 6f74 3a0d 0a20 2020 2020 2020  s_root:..       
-0002ff70: 2020 2020 2073 656c 662e 5f68 6965 7261       self._hiera
-0002ff80: 7263 6869 6573 2e61 7070 656e 6428 7374  rchies.append(st
-0002ff90: 7275 6374 7572 655f 656c 656d 656e 7429  ructure_element)
-0002ffa0: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6966  ......        if
-0002ffb0: 2073 7472 7563 7475 7265 5f65 6c65 6d65   structure_eleme
-0002ffc0: 6e74 2e73 7472 7563 7475 7265 2069 7320  nt.structure is 
-0002ffd0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0002ffe0: 2020 2073 7472 7563 7475 7265 5f65 6c65     structure_ele
-0002fff0: 6d65 6e74 2e73 7472 7563 7475 7265 203d  ment.structure =
-00030000: 2073 656c 660d 0a0d 0a20 2020 2020 2020   self....       
-00030010: 206c 6f67 2e64 6562 7567 2827 4164 6465   log.debug('Adde
-00030020: 6420 5374 7275 6374 7572 6545 6c65 6d65  d StructureEleme
-00030030: 6e74 2027 2b73 7472 7563 7475 7265 5f65  nt '+structure_e
-00030040: 6c65 6d65 6e74 2e73 686f 7274 6e61 6d65  lement.shortname
-00030050: 2b27 2074 6f20 5374 7275 6374 7572 6527  +' to Structure'
-00030060: 290d 0a0d 0a20 2020 2064 6566 205f 7265  )....    def _re
-00030070: 6d6f 7665 5f65 6c65 6d65 6e74 2873 656c  move_element(sel
-00030080: 662c 7374 7275 6374 7572 655f 656c 656d  f,structure_elem
-00030090: 656e 7429 3a0d 0a20 2020 2020 2020 2027  ent):..        '
-000300a0: 2727 4465 7072 6563 6174 6564 2e0d 0a20  ''Deprecated... 
-000300b0: 2020 2020 2020 2052 656d 6f76 6520 6120         Remove a 
-000300c0: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-000300d0: 2069 6e20 7468 6973 2053 7472 7563 7475   in this Structu
-000300e0: 7265 2066 726f 6d20 6974 7320 7061 7265  re from its pare
-000300f0: 6e74 0d0a 0d0a 2020 2020 2020 2020 5374  nt....        St
-00030100: 7275 6374 7572 6545 6c65 6d65 6e74 2e63  ructureElement.c
-00030110: 7574 2829 2064 6f65 7320 7468 6520 7361  ut() does the sa
-00030120: 6d65 2c20 616e 6420 7265 7475 726e 7320  me, and returns 
-00030130: 7468 6520 5374 7275 6374 7572 6545 6c65  the StructureEle
-00030140: 6d65 6e74 2074 6f20 6265 2075 7365 6420  ment to be used 
-00030150: 656c 7365 7768 6572 652e 0d0a 2020 2020  elsewhere...    
-00030160: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
-00030170: 2069 6620 7374 7275 6374 7572 655f 656c   if structure_el
-00030180: 656d 656e 742e 6973 5f72 6f6f 743a 0d0a  ement.is_root:..
-00030190: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000301a0: 6520 5479 7065 4572 726f 7228 2243 616e  e TypeError("Can
-000301b0: 2774 2072 656d 6f76 6520 7468 6520 726f  't remove the ro
-000301c0: 6f74 2065 6c65 6d65 6e74 2e20 4368 616e  ot element. Chan
-000301d0: 6765 2074 6865 2072 6f6f 7420 656c 656d  ge the root elem
-000301e0: 656e 7420 6966 2079 6f75 206e 6565 6420  ent if you need 
-000301f0: 746f 2072 656d 6f76 6520 7468 6973 2065  to remove this e
-00030200: 6c65 6d65 6e74 2229 0d0a 2020 2020 2020  lement")..      
-00030210: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00030220: 2020 2020 2073 7472 7563 7475 7265 5f65       structure_e
-00030230: 6c65 6d65 6e74 2e70 6172 656e 742e 7265  lement.parent.re
-00030240: 6d6f 7665 5f63 6869 6c64 2873 7472 7563  move_child(struc
-00030250: 7475 7265 5f65 6c65 6d65 6e74 290d 0a0d  ture_element)...
-00030260: 0a20 2020 2064 6566 205f 7365 745f 736f  .    def _set_so
-00030270: 7274 5f66 756e 6374 696f 6e28 7365 6c66  rt_function(self
-00030280: 2c73 6f72 745f 6675 6e63 7469 6f6e 293a  ,sort_function):
-00030290: 0d0a 2020 2020 2020 2020 2727 2744 6570  ..        '''Dep
-000302a0: 7265 6361 7465 642e 2054 6865 2073 6f72  recated. The sor
-000302b0: 7420 6675 6e63 7469 6f6e 2069 7320 6e6f  t function is no
-000302c0: 206c 6f6e 6765 7220 7573 6564 2727 270d   longer used'''.
-000302d0: 0a20 2020 2020 2020 2072 6169 7365 2054  .        raise T
-000302e0: 7970 6545 7272 6f72 2822 446f 6e27 7420  ypeError("Don't 
-000302f0: 7573 6520 7468 6973 2066 756e 6374 696f  use this functio
-00030300: 6e2e 2053 6574 2074 6865 2073 6f72 7420  n. Set the sort 
-00030310: 6675 6e63 7469 6f6e 206f 6e20 7468 6520  function on the 
-00030320: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-00030330: 2069 6e73 7465 6164 2229 0d0a 0d0a 2020   instead")....  
-00030340: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-00030350: 2064 6566 2064 6573 6365 6e64 616e 7473   def descendants
-00030360: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00030370: 2027 2727 4465 7072 6563 6174 6564 2c20   '''Deprecated, 
-00030380: 446f 6e27 7420 7573 6520 7468 6973 2066  Don't use this f
-00030390: 756e 6374 696f 6e2c 2054 6f20 7669 7369  unction, To visi
-000303a0: 7420 616c 6c20 6f66 2074 6865 2064 6573  t all of the des
-000303b0: 6365 6e64 616e 7473 2c20 7369 6d70 6c79  cendants, simply
-000303c0: 2075 7365 202e 7761 6c6b 2829 0d0a 2020   use .walk()..  
-000303d0: 2020 2020 2020 2727 270d 0a20 2020 2020        '''..     
-000303e0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-000303f0: 6465 7363 656e 6461 6e74 730d 0a0d 0a20  descendants.... 
-00030400: 2020 2023 4070 726f 7065 7274 790d 0a20     #@property.. 
-00030410: 2020 2023 6465 6620 6465 7363 656e 6461     #def descenda
-00030420: 6e74 2873 656c 662c 6974 656d 293a 0d0a  nt(self,item):..
-00030430: 2020 2020 2320 2020 2072 6574 7572 6e20      #    return 
-00030440: 7365 6c66 2e64 6573 6365 6e64 616e 7473  self.descendants
-00030450: 5b69 7465 6d5d 5b30 5d0d 0a0d 0a0d 0a20  [item][0]...... 
-00030460: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-00030470: 2020 6465 6620 656c 656d 656e 7473 2873    def elements(s
-00030480: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
-00030490: 2727 4465 7072 6563 6174 6564 2e20 446f  ''Deprecated. Do
-000304a0: 6e27 7420 7573 6520 7468 6973 2066 756e  n't use this fun
-000304b0: 6374 696f 6e20 2d20 7573 6520 7761 6c6b  ction - use walk
-000304c0: 2829 2069 6e73 7465 6164 2727 270d 0a20  () instead'''.. 
-000304d0: 2020 2020 2020 2023 656c 656d 656e 7473         #elements
-000304e0: 2073 6f75 6e64 7320 6c69 6b65 2061 2064   sounds like a d
-000304f0: 6963 7469 6f6e 6172 7920 2875 7365 2067  ictionary (use g
-00030500: 6574 5f65 6c65 6d65 6e74 7320 746f 2064  et_elements to d
-00030510: 6f20 7468 6174 2920 6f72 2061 206c 6973  o that) or a lis
-00030520: 7420 2875 7365 2077 616c 6b20 656c 656d  t (use walk elem
-00030530: 656e 7473 2066 6f72 2074 6861 7429 290d  ents for that)).
-00030540: 0a20 2020 2020 2020 2072 6169 7365 2054  .        raise T
-00030550: 7970 6545 7272 6f72 2822 446f 6e27 7420  ypeError("Don't 
-00030560: 7573 6520 7468 6973 2066 756e 6374 696f  use this functio
-00030570: 6e20 2d20 7573 6520 7761 6c6b 2829 2069  n - use walk() i
-00030580: 6e73 7465 6164 2229 0d0a 0d0a 2020 2020  nstead")....    
-00030590: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-000305a0: 6566 2072 6f6f 745f 656c 656d 656e 7473  ef root_elements
-000305b0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-000305c0: 2027 2727 4974 6572 6174 6520 6f76 6572   '''Iterate over
-000305d0: 2061 6c6c 206f 6620 7468 6520 6869 6572   all of the hier
-000305e0: 6172 6368 6965 7320 2872 6f6f 7420 6c65  archies (root le
-000305f0: 7665 6c20 7374 7275 6374 7572 6520 656c  vel structure el
-00030600: 656d 656e 7473 2920 696e 2074 7572 6e2e  ements) in turn.
-00030610: 0d0a 0d0a 2020 2020 2020 2020 5468 6973  ....        This
-00030620: 2070 726f 7072 7479 2064 6f65 7320 6e6f   proprty does no
-00030630: 7420 6465 7363 656e 6420 696e 746f 2074  t descend into t
-00030640: 686f 7365 2068 6965 7261 7263 6869 6573  hose hierarchies
-00030650: 202d 2075 7365 202e 7761 6c6b 2829 2074   - use .walk() t
-00030660: 6f20 646f 2074 6861 742e 0d0a 0d0a 2020  o do that.....  
-00030670: 2020 2020 2020 446f 6573 2074 6865 2073        Does the s
-00030680: 616d 6520 7468 696e 6720 6173 202e 6869  ame thing as .hi
-00030690: 6572 6172 6368 6965 732e 7661 6c75 6573  erarchies.values
-000306a0: 2829 0d0a 2020 2020 2020 2020 2727 270d  ()..        '''.
-000306b0: 0a20 2020 2020 2020 2066 6f72 2065 2069  .        for e i
-000306c0: 6e20 7365 6c66 2e68 6965 7261 7263 6869  n self.hierarchi
-000306d0: 6573 2e76 616c 7565 7328 293a 0d0a 2020  es.values():..  
-000306e0: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
-000306f0: 650d 0a0d 0a20 2020 2040 7072 6f70 6572  e....    @proper
-00030700: 7479 0d0a 2020 2020 6465 6620 7368 6f72  ty..    def shor
-00030710: 7463 6f64 6528 7365 6c66 293a 0d0a 2020  tcode(self):..  
-00030720: 2020 2020 2020 2727 2754 6865 2073 686f        '''The sho
-00030730: 7274 6e61 6d65 2066 6f72 2074 6869 7320  rtname for this 
-00030740: 5374 7275 6374 7572 652e 2053 796e 6f6e  Structure. Synon
-00030750: 796d 2066 6f72 202e 7368 6f72 746e 616d  ym for .shortnam
-00030760: 6527 2727 0d0a 2020 2020 2020 2020 7265  e'''..        re
-00030770: 7475 726e 2073 656c 662e 5f73 686f 7274  turn self._short
-00030780: 6e61 6d65 0d0a 0d0a 2020 2020 4070 726f  name....    @pro
-00030790: 7065 7274 790d 0a20 2020 2064 6566 2073  perty..    def s
-000307a0: 686f 7274 6e61 6d65 2873 656c 6629 3a0d  hortname(self):.
-000307b0: 0a20 2020 2020 2020 2027 2727 5468 6520  .        '''The 
-000307c0: 7368 6f72 746e 616d 6520 666f 7220 7468  shortname for th
-000307d0: 6973 2053 7472 7563 7475 7265 2e27 2727  is Structure.'''
-000307e0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000307f0: 2073 656c 662e 5f73 686f 7274 6e61 6d65   self._shortname
-00030800: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-00030810: 790d 0a20 2020 2064 6566 206c 6f6e 676e  y..    def longn
-00030820: 616d 6528 7365 6c66 293a 0d0a 2020 2020  ame(self):..    
-00030830: 2020 2020 2727 2754 6865 206c 6f6e 676e      '''The longn
-00030840: 616d 6520 666f 7220 7468 6973 2053 7472  ame for this Str
-00030850: 7563 7475 7265 2e27 2727 0d0a 2020 2020  ucture.'''..    
-00030860: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00030870: 5f6c 6f6e 676e 616d 650d 0a0d 0a20 2020  _longname....   
-00030880: 2040 6c6f 6e67 6e61 6d65 2e73 6574 7465   @longname.sette
-00030890: 720d 0a20 2020 2064 6566 206c 6f6e 676e  r..    def longn
-000308a0: 616d 6528 7365 6c66 2c76 616c 293a 0d0a  ame(self,val):..
-000308b0: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-000308c0: 6e67 6e61 6d65 203d 2076 616c 0d0a 0d0a  ngname = val....
-000308d0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
-000308e0: 2020 2064 6566 2064 6573 6372 6970 7469     def descripti
-000308f0: 6f6e 2873 656c 6629 3a0d 0a20 2020 2020  on(self):..     
-00030900: 2020 2027 2727 5468 6520 456d 706f 7765     '''The Empowe
-00030910: 7220 6465 7363 7269 7074 696f 6e20 666f  r description fo
-00030920: 7220 7468 6973 2053 7472 7563 7475 7265  r this Structure
-00030930: 2e27 2727 0d0a 0d0a 2020 2020 2020 2020  .'''....        
-00030940: 7265 7475 726e 2073 656c 662e 5f64 6573  return self._des
-00030950: 6372 6970 7469 6f6e 0d0a 0d0a 2020 2020  cription....    
-00030960: 4064 6573 6372 6970 7469 6f6e 2e73 6574  @description.set
-00030970: 7465 720d 0a20 2020 2064 6566 2064 6573  ter..    def des
-00030980: 6372 6970 7469 6f6e 2873 656c 662c 7661  cription(self,va
-00030990: 6c29 3a0d 0a20 2020 2020 2020 2027 2727  l):..        '''
-000309a0: 5468 6520 6465 7363 7269 7074 696f 6e20  The description 
-000309b0: 666f 7220 7468 6973 2053 7472 7563 7475  for this Structu
-000309c0: 7265 2e27 2727 0d0a 2020 2020 2020 2020  re.'''..        
-000309d0: 7365 6c66 2e5f 6465 7363 7269 7074 696f  self._descriptio
-000309e0: 6e20 3d20 7661 6c0d 0a0d 0a20 2020 2064  n = val....    d
-000309f0: 6566 2061 6464 5f63 6869 6c64 5f65 6c65  ef add_child_ele
-00030a00: 6d65 6e74 5f70 6172 656e 7428 7365 6c66  ment_parent(self
-00030a10: 2c63 6869 6c64 2c70 6172 656e 7429 3a0d  ,child,parent):.
-00030a20: 0a20 2020 2020 2020 2027 2727 4164 6420  .        '''Add 
-00030a30: 7468 6520 6368 696c 6420 656c 656d 656e  the child elemen
-00030a40: 7420 746f 2068 6176 6520 6120 6769 7665  t to have a give
-00030a50: 6e20 7061 7265 6e74 2e20 5468 6973 2069  n parent. This i
-00030a60: 7320 7468 6520 6f6e 6520 7761 7920 7765  s the one way we
-00030a70: 2063 616e 2073 6574 2065 6c65 6d65 6e74   can set element
-00030a80: 7320 696e 2061 2073 7472 7563 7475 7265  s in a structure
-00030a90: 2e0d 0a0d 0a20 2020 2020 2020 2041 206d  .....        A m
-00030aa0: 6f72 6520 636f 6d6d 6f6e 2077 6179 2028  ore common way (
-00030ab0: 616e 6420 7468 6520 7072 6566 6572 7265  and the preferre
-00030ac0: 6420 7761 7929 2074 6f20 7365 7420 6120  d way) to set a 
-00030ad0: 6368 696c 6420 656c 656d 656e 7420 776f  child element wo
-00030ae0: 756c 6420 6265 2074 6f20 7573 6520 7468  uld be to use th
-00030af0: 6520 5374 7275 6374 7572 6545 6c65 6d65  e StructureEleme
-00030b00: 6e74 2064 6972 6563 746c 7920 7573 696e  nt directly usin
-00030b10: 6720 5374 7275 6374 7572 6545 6c65 6d65  g StructureEleme
-00030b20: 6e74 2e63 6869 6c64 7265 6e20 2e0d 0a0d  nt.children ....
-00030b30: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00030b40: 6368 696c 643a 2043 6869 6c64 2065 6c65  child: Child ele
-00030b50: 6d65 6e74 2e20 5374 7275 6374 7572 6545  ment. StructureE
-00030b60: 6c65 6d65 6e74 0d0a 2020 2020 2020 2020  lement..        
-00030b70: 3a70 6172 616d 2070 6172 656e 743a 2050  :param parent: P
-00030b80: 6172 656e 7420 656c 656d 656e 742e 2053  arent element. S
-00030b90: 7472 7563 7475 7265 456c 656d 656e 740d  tructureElement.
-00030ba0: 0a20 2020 2020 2020 2027 2727 0d0a 0d0a  .        '''....
-00030bb0: 2020 2020 2020 2020 6966 2063 6869 6c64          if child
-00030bc0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00030bd0: 2020 2020 2020 2023 5072 6f67 7261 6d6d         #Programm
-00030be0: 696e 6720 6572 726f 720d 0a20 2020 2020  ing error..     
-00030bf0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00030c00: 7565 4572 726f 7228 2763 6869 6c64 2069  ueError('child i
-00030c10: 7320 4e6f 6e65 2e20 4368 696c 6420 7368  s None. Child sh
-00030c20: 6f75 6c64 2062 6520 6120 7661 6c69 6420  ould be a valid 
-00030c30: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-00030c40: 2729 0d0a 0d0a 2020 2020 2020 2020 6368  ')....        ch
-00030c50: 696c 645f 656c 656d 656e 743d 6368 696c  ild_element=chil
-00030c60: 640d 0a20 2020 2020 2020 2070 6172 656e  d..        paren
-00030c70: 745f 656c 656d 656e 743d 7061 7265 6e74  t_element=parent
-00030c80: 0d0a 0d0a 2020 2020 2020 2020 7472 793a  ....        try:
-00030c90: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
-00030ca0: 696c 645f 656c 656d 656e 742e 6164 645f  ild_element.add_
-00030cb0: 7061 7265 6e74 2870 6172 656e 745f 656c  parent(parent_el
-00030cc0: 656d 656e 7429 0d0a 2020 2020 2020 2020  ement)..        
-00030cd0: 2020 2020 6966 2063 6869 6c64 5f65 6c65      if child_ele
-00030ce0: 6d65 6e74 2e70 6172 656e 7420 6973 206e  ment.parent is n
-00030cf0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00030d00: 2020 2020 2020 2020 2020 6c6f 672e 7665            log.ve
-00030d10: 7262 6f73 6528 6368 696c 645f 656c 656d  rbose(child_elem
-00030d20: 656e 742e 7368 6f72 746e 616d 6520 2b20  ent.shortname + 
-00030d30: 272d 3e27 202b 2073 7472 2863 6869 6c64  '->' + str(child
-00030d40: 5f65 6c65 6d65 6e74 2e70 6172 656e 742e  _element.parent.
-00030d50: 7368 6f72 746e 616d 6529 290d 0a20 2020  shortname))..   
-00030d60: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00030d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00030d80: 6c6f 672e 7665 7262 6f73 6528 6368 696c  log.verbose(chil
-00030d90: 645f 656c 656d 656e 742e 7368 6f72 746e  d_element.shortn
-00030da0: 616d 6520 2b20 272d 3e4e 6f6e 6527 290d  ame + '->None').
-00030db0: 0a0d 0a20 2020 2020 2020 2065 7863 6570  ...        excep
-00030dc0: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
-00030dd0: 2061 7320 653a 0d0a 2020 2020 2020 2020   as e:..        
-00030de0: 2020 2020 6c6f 672e 6572 726f 7228 2743      log.error('C
-00030df0: 6f75 6c64 206e 6f74 2066 696e 6420 7468  ould not find th
-00030e00: 6520 6368 696c 645f 656c 656d 656e 7420  e child_element 
-00030e10: 696e 2074 6865 2068 6965 7261 7263 6879  in the hierarchy
-00030e20: 3a27 2b73 7472 2863 6869 6c64 5f65 6c65  :'+str(child_ele
-00030e30: 6d65 6e74 2929 0d0a 2020 2020 2020 2020  ment))..        
-00030e40: 2020 2020 7261 6973 6520 6d70 6578 2e43      raise mpex.C
-00030e50: 6f6d 706c 6574 656c 794c 6f67 6765 6445  ompletelyLoggedE
-00030e60: 7272 6f72 2865 290d 0a0d 0a20 2020 2064  rror(e)....    d
-00030e70: 6566 2073 6574 5f63 6869 6c64 5f65 6c65  ef set_child_ele
-00030e80: 6d65 6e74 5f70 6172 656e 7428 7365 6c66  ment_parent(self
-00030e90: 2c63 6869 6c64 2c70 6172 656e 7429 3a0d  ,child,parent):.
-00030ea0: 0a20 2020 2020 2020 2027 2727 5379 6e6f  .        '''Syno
-00030eb0: 6e79 6d20 666f 7220 6164 645f 6368 696c  nym for add_chil
-00030ec0: 645f 656c 656d 656e 745f 7061 7265 6e74  d_element_parent
-00030ed0: 2829 0d0a 2020 2020 2020 2020 5468 6973  ()..        This
-00030ee0: 2066 756e 6374 696f 6e20 7769 6c6c 2062   function will b
-00030ef0: 6520 6465 7072 6563 6174 6564 2069 6e20  e deprecated in 
-00030f00: 6120 6675 7475 7265 2072 656c 6561 7365  a future release
-00030f10: 206f 6620 7079 6d70 780d 0a20 2020 2020   of pympx..     
-00030f20: 2020 2027 2727 0d0a 0d0a 2020 2020 2020     '''....      
-00030f30: 2020 6966 2063 6869 6c64 2069 7320 4e6f    if child is No
-00030f40: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00030f50: 2023 5072 6f67 7261 6d6d 696e 6720 6572   #Programming er
-00030f60: 726f 720d 0a20 2020 2020 2020 2020 2020  ror..           
-00030f70: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00030f80: 7228 2763 6869 6c64 2069 7320 4e6f 6e65  r('child is None
-00030f90: 2e20 4368 696c 6420 7368 6f75 6c64 2062  . Child should b
-00030fa0: 6520 6120 7661 6c69 6420 656c 656d 656e  e a valid elemen
-00030fb0: 7420 7368 6f72 746e 616d 6527 290d 0a0d  t shortname')...
-00030fc0: 0a20 2020 2020 2020 2063 6869 6c64 5f65  .        child_e
-00030fd0: 6c65 6d65 6e74 3d63 6869 6c64 0d0a 2020  lement=child..  
-00030fe0: 2020 2020 2020 7061 7265 6e74 5f65 6c65        parent_ele
-00030ff0: 6d65 6e74 3d70 6172 656e 740d 0a0d 0a20  ment=parent.... 
-00031000: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00031010: 2020 2020 2020 2020 2063 6869 6c64 5f65           child_e
-00031020: 6c65 6d65 6e74 2e73 6574 5f70 6172 656e  lement.set_paren
-00031030: 7428 7061 7265 6e74 5f65 6c65 6d65 6e74  t(parent_element
-00031040: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
-00031050: 6620 6368 696c 645f 656c 656d 656e 742e  f child_element.
-00031060: 7061 7265 6e74 2069 7320 6e6f 7420 4e6f  parent is not No
-00031070: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00031080: 2020 2020 206c 6f67 2e76 6572 626f 7365       log.verbose
-00031090: 2863 6869 6c64 5f65 6c65 6d65 6e74 2e73  (child_element.s
-000310a0: 686f 7274 6e61 6d65 202b 2027 2d3e 2720  hortname + '->' 
-000310b0: 2b20 7374 7228 6368 696c 645f 656c 656d  + str(child_elem
-000310c0: 656e 742e 7061 7265 6e74 2e73 686f 7274  ent.parent.short
-000310d0: 6e61 6d65 2929 0d0a 2020 2020 2020 2020  name))..        
-000310e0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-000310f0: 2020 2020 2020 2020 2020 206c 6f67 2e76             log.v
-00031100: 6572 626f 7365 2863 6869 6c64 5f65 6c65  erbose(child_ele
-00031110: 6d65 6e74 2e73 686f 7274 6e61 6d65 202b  ment.shortname +
-00031120: 2027 2d3e 4e6f 6e65 2729 0d0a 0d0a 2020   '->None')....  
-00031130: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
-00031140: 7269 6275 7465 4572 726f 7220 6173 2065  ributeError as e
-00031150: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00031160: 5072 6f67 7261 6d6d 696e 6720 4572 726f  Programming Erro
-00031170: 720d 0a20 2020 2020 2020 2020 2020 206c  r..            l
-00031180: 6f67 2e65 7272 6f72 2827 436f 756c 6420  og.error('Could 
-00031190: 6e6f 7420 6669 6e64 2074 6865 2063 6869  not find the chi
-000311a0: 6c64 5f65 6c65 6d65 6e74 2069 6e20 7468  ld_element in th
-000311b0: 6520 6869 6572 6172 6368 793a 272b 7374  e hierarchy:'+st
-000311c0: 7228 6368 696c 645f 656c 656d 656e 7429  r(child_element)
-000311d0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-000311e0: 6169 7365 2065 0d0a 0d0a 2020 2020 6465  aise e....    de
-000311f0: 6620 7761 6c6b 5f65 6c65 6d65 6e74 7328  f walk_elements(
-00031200: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00031210: 2727 2744 6570 7265 6361 7465 642c 2055  '''Deprecated, U
-00031220: 7365 202e 7761 6c6b 2829 2069 6e73 7465  se .walk() inste
-00031230: 6164 2e27 2727 0d0a 2020 2020 2020 2020  ad.'''..        
-00031240: 7969 656c 6420 6672 6f6d 2073 656c 662e  yield from self.
-00031250: 7761 6c6b 2829 0d0a 0d0a 2020 2020 6465  walk()....    de
-00031260: 6620 7761 6c6b 2873 656c 6629 3a0d 0a20  f walk(self):.. 
-00031270: 2020 2020 2020 2027 2727 5374 6570 2074         '''Step t
-00031280: 6872 6f75 6768 2065 7665 7279 2065 6c65  hrough every ele
-00031290: 6d65 6e74 2069 6e20 7468 6520 7374 7275  ment in the stru
-000312a0: 6374 7572 6520 696e 2074 7572 6e2e 2053  cture in turn. S
-000312b0: 7461 7274 2077 6974 6820 7468 6520 6669  tart with the fi
-000312c0: 7273 7420 726f 6f74 2065 6c65 6d65 6e74  rst root element
-000312d0: 2061 6e64 2077 616c 6b20 7472 756e 6b20   and walk trunk 
-000312e0: 746f 206c 6561 662c 2061 6e64 2074 6865  to leaf, and the
-000312f0: 6e20 6f6e 2074 6f20 6e65 7874 206c 6561  n on to next lea
-00031300: 660d 0a20 2020 2020 2020 2059 6965 6c64  f..        Yield
-00031310: 2065 6c65 6d65 6e74 7320 6173 2074 6865   elements as the
-00031320: 2077 616c 6b20 676f 6573 206f 6e2e 0d0a   walk goes on...
-00031330: 2020 2020 2020 2020 2727 270d 0a20 2020          '''..   
-00031340: 2020 2020 2066 6f72 2065 2069 6e20 6c69       for e in li
-00031350: 7374 2873 656c 662e 726f 6f74 5f65 6c65  st(self.root_ele
-00031360: 6d65 6e74 7329 3a0d 0a20 2020 2020 2020  ments):..       
-00031370: 2020 2020 2079 6965 6c64 2066 726f 6d20       yield from 
-00031380: 652e 7761 6c6b 2870 6572 6d69 7373 6976  e.walk(permissiv
-00031390: 653d 4661 6c73 6529 0d0a 0d0a 2020 2020  e=False)....    
-000313a0: 6465 6620 7072 696e 745f 6869 6572 6172  def print_hierar
-000313b0: 6368 7928 7365 6c66 293a 0d0a 2020 2020  chy(self):..    
-000313c0: 2020 2020 2727 2744 6570 7265 6361 7465      '''Deprecate
-000313d0: 642c 2055 7365 2074 6865 2070 7974 686f  d, Use the pytho
-000313e0: 6e20 7072 696e 7428 2920 6675 6e63 7469  n print() functi
-000313f0: 6f6e 2069 6e73 7465 6164 2e0d 0a20 2020  on instead...   
-00031400: 2020 2020 2050 7269 6e74 7320 6f75 7420       Prints out 
-00031410: 7468 6520 5374 7275 6374 7572 6520 696e  the Structure in
-00031420: 2074 6578 7420 666f 726d 2e0d 0a0d 0a20   text form..... 
-00031430: 2020 2020 2020 203e 3e3e 2070 7269 6e74         >>> print
-00031440: 2873 6974 652e 6469 6d65 6e73 696f 6e73  (site.dimensions
-00031450: 5b30 5d2e 7374 7275 6374 7572 6573 5b27  [0].structures['
-00031460: 5350 414d 275d 290d 0a20 2020 2020 2020  SPAM'])..       
-00031470: 2053 5041 4d0d 0a20 2020 2020 2020 202b   SPAM..        +
-00031480: 2d45 4747 530d 0a20 2020 2020 2020 2020  -EGGS..         
-00031490: 202b 2d42 4143 4f4e 0d0a 2020 2020 2020   +-BACON..      
-000314a0: 2020 2727 270d 0a20 2020 2020 2020 2066    '''..        f
-000314b0: 6f72 2065 2069 6e20 6c69 7374 2873 656c  or e in list(sel
-000314c0: 662e 726f 6f74 5f65 6c65 6d65 6e74 7329  f.root_elements)
-000314d0: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
-000314e0: 2e70 7269 6e74 5f68 6965 7261 7263 6879  .print_hierarchy
-000314f0: 2829 0d0a 0d0a 2020 2020 6465 6620 7379  ()....    def sy
-00031500: 6e63 6872 6f6e 6973 6528 7365 6c66 293a  nchronise(self):
-00031510: 0d0a 2020 2020 2020 2020 2727 2753 796e  ..        '''Syn
-00031520: 6368 726f 6e69 7365 2074 6869 7320 7374  chronise this st
-00031530: 7275 6374 7572 6520 7769 7468 2074 6865  ructure with the
-00031540: 2045 6d70 6f77 6572 2073 6974 652e 0d0a   Empower site...
-00031550: 2020 2020 2020 2020 4368 616e 6765 7320          Changes 
-00031560: 6d61 6465 2074 6f20 7468 6973 2073 7472  made to this str
-00031570: 7563 7475 7265 2077 696c 6c20 6265 2077  ucture will be w
-00031580: 7269 7474 656e 2062 6163 6b20 746f 2074  ritten back to t
-00031590: 6865 2045 6d70 6f77 6572 2073 6974 6520  he Empower site 
-000315a0: 7468 6174 2074 6869 7320 7374 7275 6374  that this struct
-000315b0: 7572 6520 6265 6c6f 6e67 7320 746f 2e0d  ure belongs to..
-000315c0: 0a20 2020 2020 2020 2027 2727 0d0a 0d0a  .        '''....
-000315d0: 2020 2020 2020 2020 2364 6562 7567 2066          #debug f
-000315e0: 6c61 6720 6465 7465 726d 696e 6573 2077  lag determines w
-000315f0: 6865 7468 6572 2077 6520 7769 7368 2074  hether we wish t
-00031600: 6f20 7361 7665 2074 6f20 6669 6c65 2069  o save to file i
-00031610: 6e20 6f72 6465 7220 746f 2064 6562 7567  n order to debug
-00031620: 2077 6861 7420 6861 7320 676f 6e65 2077   what has gone w
-00031630: 726f 6e67 2077 6968 2061 6e20 696d 706f  rong wih an impo
-00031640: 7274 0d0a 2020 2020 2020 2020 6465 6275  rt..        debu
-00031650: 6720 3d20 7365 6c66 2e64 696d 656e 7369  g = self.dimensi
-00031660: 6f6e 2e73 6974 652e 5f64 6562 7567 0d0a  on.site._debug..
-00031670: 0d0a 2020 2020 2020 2020 2349 6e20 6465  ..        #In de
-00031680: 6275 6720 6d6f 6465 2c20 7772 6974 6520  bug mode, write 
-00031690: 7468 6520 6f75 7470 7574 2065 6c65 6d65  the output eleme
-000316a0: 6e74 7320 746f 2061 2077 6f72 6b69 6e67  nts to a working
-000316b0: 2066 696c 6520 666f 7220 696d 706f 7274   file for import
-000316c0: 696e 6720 696e 746f 2065 6d70 6f77 6572  ing into empower
-000316d0: 0d0a 2020 2020 2020 2020 6966 2064 6562  ..        if deb
-000316e0: 7567 3a0d 0a20 2020 2020 2020 2020 2020  ug:..           
-000316f0: 2066 6f72 2064 6972 2069 6e20 5b73 656c   for dir in [sel
-00031700: 662e 6469 6d65 6e73 696f 6e2e 7369 7465  f.dimension.site
-00031710: 2e5f 656d 706f 7765 725f 6469 6d5f 696d  ._empower_dim_im
-00031720: 706f 7274 5f64 6972 5d3a 0d0a 0d0a 2020  port_dir]:....  
-00031730: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00031740: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00031750: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
-00031760: 6972 7328 6469 7229 0d0a 2020 2020 2020  irs(dir)..      
-00031770: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00031780: 2046 696c 6545 7869 7374 7345 7272 6f72   FileExistsError
-00031790: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000317a0: 2020 2020 2020 2070 6173 730d 0a20 2020         pass..   
-000317b0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-000317c0: 6570 7420 4f53 4572 726f 7220 6173 2065  ept OSError as e
-000317d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000317e0: 2020 2020 2020 2069 6620 652e 7769 6e65         if e.wine
-000317f0: 7272 6f72 203d 3d20 3132 333a 0d0a 2020  rror == 123:..  
+0002cc40: 2072 6574 7572 6e20 4e6f 6e65 0d0a 0d0a   return None....
+0002cc50: 2020 2020 6465 6620 636f 7079 2873 656c      def copy(sel
+0002cc60: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
+0002cc70: 4372 6561 7465 2061 2063 6f70 7920 6f66  Create a copy of
+0002cc80: 2073 656c 662c 206e 6f74 2069 6e63 6c75   self, not inclu
+0002cc90: 6469 6e67 2074 6865 2070 6879 7369 6420  ding the physid 
+0002cca0: 6f72 2073 686f 7274 6e61 6d65 2727 270d  or shortname'''.
+0002ccb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002ccc0: 456c 656d 656e 7428 6c6f 6e67 6e61 6d65  Element(longname
+0002ccd0: 2020 2020 2020 2020 2020 2020 203d 2073               = s
+0002cce0: 656c 662e 6c6f 6e67 6e61 6d65 0d0a 2020  elf.longname..  
+0002ccf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cd00: 2020 2020 2c73 686f 7274 6e61 6d65 2020      ,shortname  
+0002cd10: 2020 2020 2020 2020 2020 3d20 4e6f 6e65            = None
+0002cd20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002cd30: 2020 2020 2020 2020 2c64 6573 6372 6970          ,descrip
+0002cd40: 7469 6f6e 2020 2020 2020 2020 2020 3d20  tion          = 
+0002cd50: 7365 6c66 2e64 6573 6372 6970 7469 6f6e  self.description
+0002cd60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002cd70: 2020 2020 2020 2020 2c67 726f 7570 5f6f          ,group_o
+0002cd80: 6e6c 7920 2020 2020 2020 2020 2020 3d20  nly           = 
+0002cd90: 7365 6c66 2e67 726f 7570 5f6f 6e6c 790d  self.group_only.
+0002cda0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002cdb0: 2020 2020 2020 202c 6361 6c63 756c 6174         ,calculat
+0002cdc0: 696f 6e5f 7374 6174 7573 2020 203d 2073  ion_status   = s
+0002cdd0: 656c 662e 6361 6c63 756c 6174 696f 6e5f  elf.calculation_
+0002cde0: 7374 6174 7573 0d0a 2020 2020 2020 2020  status..        
+0002cdf0: 2020 2020 2020 2020 2020 2020 2020 2c63                ,c
+0002ce00: 616c 6375 6c61 7469 6f6e 2020 2020 2020  alculation      
+0002ce10: 2020 2020 3d20 7365 6c66 2e63 616c 6375      = self.calcu
+0002ce20: 6c61 7469 6f6e 0d0a 2020 2020 2020 2020  lation..        
+0002ce30: 2020 2020 2020 2020 2020 2020 2020 2c63                ,c
+0002ce40: 6f6c 6f75 7220 2020 2020 2020 2020 2020  olour           
+0002ce50: 2020 2020 3d20 7365 6c66 2e63 6f6c 6f75      = self.colou
+0002ce60: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
+0002ce70: 2020 2020 2020 2020 202c 6d65 6173 7572           ,measur
+0002ce80: 6520 2020 2020 2020 2020 2020 2020 203d  e              =
+0002ce90: 2073 656c 662e 6d65 6173 7572 650d 0a20   self.measure.. 
+0002cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ceb0: 2020 2020 202c 6669 656c 6473 2020 2020       ,fields    
+0002cec0: 2020 2020 2020 2020 2020 203d 2064 6963             = dic
+0002ced0: 7428 7365 6c66 2e66 6965 6c64 7329 0d0a  t(self.fields)..
+0002cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cef0: 2020 2020 2020 2c64 696d 656e 7369 6f6e        ,dimension
+0002cf00: 2020 2020 2020 2020 2020 2020 3d20 7365              = se
+0002cf10: 6c66 2e64 696d 656e 7369 6f6e 0d0a 2020  lf.dimension..  
+0002cf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002cf30: 2020 2020 290d 0a0d 0a20 2020 2064 6566      )....    def
+0002cf40: 206d 6572 6765 2873 656c 662c 6f74 6865   merge(self,othe
+0002cf50: 722c 6669 656c 6473 5f74 6f5f 6d65 7267  r,fields_to_merg
+0002cf60: 653d 4e6f 6e65 293a 0d0a 2020 2020 2020  e=None):..      
+0002cf70: 2020 2727 274d 6572 6765 2061 6e6f 7468    '''Merge anoth
+0002cf80: 6572 2065 6c65 6d65 6e74 2069 6e74 6f20  er element into 
+0002cf90: 7468 6973 206f 6e65 2727 270d 0a0d 0a20  this one'''.... 
+0002cfa0: 2020 2020 2020 2069 6620 6f74 6865 722e         if other.
+0002cfb0: 7068 7973 6964 2069 7320 6e6f 7420 4e6f  physid is not No
+0002cfc0: 6e65 2061 6e64 2073 656c 662e 7068 7973  ne and self.phys
+0002cfd0: 6964 2069 7320 6e6f 7420 4e6f 6e65 2061  id is not None a
+0002cfe0: 6e64 2073 656c 662e 7068 7973 6964 2021  nd self.physid !
+0002cff0: 3d20 6f74 6865 722e 7068 7973 6964 3a0d  = other.physid:.
+0002d000: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0002d010: 7365 2056 616c 7565 4572 726f 7228 2243  se ValueError("C
+0002d020: 616e 6e6f 7420 6d65 7267 6520 7477 6f20  annot merge two 
+0002d030: 656c 656d 656e 7473 2077 6974 6820 6469  elements with di
+0002d040: 6666 6572 656e 7420 7068 7973 6964 733a  fferent physids:
+0002d050: 207b 7d20 696e 746f 207b 7d2c 206f 6e20   {} into {}, on 
+0002d060: 6469 6d65 6e73 696f 6e20 7b7d 2c20 7a65  dimension {}, ze
+0002d070: 726f 2062 6173 6564 2069 6e64 6578 207b  ro based index {
+0002d080: 7d2e 2043 6865 636b 2074 6865 7365 2065  }. Check these e
+0002d090: 6c65 6d65 6e74 7320 646f 6e27 7420 6861  lements don't ha
+0002d0a0: 7665 2065 6d70 7479 2073 686f 7274 6e61  ve empty shortna
+0002d0b0: 6d65 7322 2e66 6f72 6d61 7428 6f74 6865  mes".format(othe
+0002d0c0: 722e 7068 7973 6964 2c73 656c 662e 7068  r.physid,self.ph
+0002d0d0: 7973 6964 2c73 656c 662e 6469 6d65 6e73  ysid,self.dimens
+0002d0e0: 696f 6e2e 6c6f 6e67 6e61 6d65 2c73 656c  ion.longname,sel
+0002d0f0: 662e 6469 6d65 6e73 696f 6e2e 696e 6465  f.dimension.inde
+0002d100: 7829 290d 0a0d 0a20 2020 2020 2020 2069  x))....        i
+0002d110: 6620 7365 6c66 2e70 6879 7369 6420 6973  f self.physid is
+0002d120: 204e 6f6e 653a 0d0a 0d0a 2020 2020 2020   None:....      
+0002d130: 2020 2020 2020 7365 6c66 2e70 6879 7369        self.physi
+0002d140: 6420 3d20 6f74 6865 722e 7068 7973 6964  d = other.physid
+0002d150: 0d0a 2020 2020 2020 2020 2020 2020 2347  ..            #G
+0002d160: 6574 2074 6865 2063 616e 6f6e 6963 616c  et the canonical
+0002d170: 2073 686f 7274 6e61 6d65 2077 6865 6e20   shortname when 
+0002d180: 6d65 7267 696e 6720 696e 2074 6865 2070  merging in the p
+0002d190: 6879 7369 640d 0a20 2020 2020 2020 2020  hysid..         
+0002d1a0: 2020 2073 656c 662e 7368 6f72 746e 616d     self.shortnam
+0002d1b0: 6520 3d20 6f74 6865 722e 7368 6f72 746e  e = other.shortn
+0002d1c0: 616d 650d 0a0d 0a20 2020 2020 2020 2069  ame....        i
+0002d1d0: 6620 7365 6c66 2e73 686f 7274 6e61 6d65  f self.shortname
+0002d1e0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+0002d1f0: 2020 2020 2020 2073 656c 662e 7368 6f72         self.shor
+0002d200: 746e 616d 6520 3d20 6f74 6865 722e 7368  tname = other.sh
+0002d210: 6f72 746e 616d 650d 0a0d 0a20 2020 2020  ortname....     
+0002d220: 2020 2069 6620 6f74 6865 722e 6c6f 6e67     if other.long
+0002d230: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
+0002d240: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0002d250: 656c 662e 6c6f 6e67 6e61 6d65 2020 2020  elf.longname    
+0002d260: 2020 2020 2020 2020 203d 206f 7468 6572           = other
+0002d270: 2e6c 6f6e 676e 616d 650d 0a20 2020 2020  .longname..     
+0002d280: 2020 2069 6620 6f74 6865 722e 6465 7363     if other.desc
+0002d290: 7269 7074 696f 6e20 6973 206e 6f74 204e  ription is not N
+0002d2a0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0002d2b0: 2020 7365 6c66 2e64 6573 6372 6970 7469    self.descripti
+0002d2c0: 6f6e 2020 2020 2020 2020 2020 3d20 6f74  on          = ot
+0002d2d0: 6865 722e 6465 7363 7269 7074 696f 6e0d  her.description.
+0002d2e0: 0a20 2020 2020 2020 2069 6620 6f74 6865  .        if othe
+0002d2f0: 722e 6772 6f75 705f 6f6e 6c79 2069 7320  r.group_only is 
+0002d300: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0002d310: 2020 2020 2020 2073 656c 662e 6772 6f75         self.grou
+0002d320: 705f 6f6e 6c79 2020 2020 2020 2020 2020  p_only          
+0002d330: 203d 206f 7468 6572 2e67 726f 7570 5f6f   = other.group_o
+0002d340: 6e6c 790d 0a20 2020 2020 2020 2069 6620  nly..        if 
+0002d350: 6f74 6865 722e 6361 6c63 756c 6174 696f  other.calculatio
+0002d360: 6e5f 7374 6174 7573 2069 7320 6e6f 7420  n_status is not 
+0002d370: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0002d380: 2020 2073 656c 662e 6361 6c63 756c 6174     self.calculat
+0002d390: 696f 6e5f 7374 6174 7573 2020 203d 206f  ion_status   = o
+0002d3a0: 7468 6572 2e63 616c 6375 6c61 7469 6f6e  ther.calculation
+0002d3b0: 5f73 7461 7475 730d 0a20 2020 2020 2020  _status..       
+0002d3c0: 2069 6620 6f74 6865 722e 6361 6c63 756c   if other.calcul
+0002d3d0: 6174 696f 6e20 6973 206e 6f74 204e 6f6e  ation is not Non
+0002d3e0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0002d3f0: 7365 6c66 2e63 616c 6375 6c61 7469 6f6e  self.calculation
+0002d400: 2020 2020 2020 2020 2020 3d20 6f74 6865            = othe
+0002d410: 722e 6361 6c63 756c 6174 696f 6e0d 0a20  r.calculation.. 
+0002d420: 2020 2020 2020 2069 6620 6f74 6865 722e         if other.
+0002d430: 636f 6c6f 7572 2069 7320 6e6f 7420 4e6f  colour is not No
+0002d440: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0002d450: 2073 656c 662e 636f 6c6f 7572 2020 2020   self.colour    
+0002d460: 2020 2020 2020 2020 2020 203d 206f 7468             = oth
+0002d470: 6572 2e63 6f6c 6f75 720d 0a20 2020 2020  er.colour..     
+0002d480: 2020 2069 6620 6f74 6865 722e 6d65 6173     if other.meas
+0002d490: 7572 6520 6973 206e 6f74 204e 6f6e 653a  ure is not None:
+0002d4a0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0002d4b0: 6c66 2e6d 6561 7375 7265 2020 2020 2020  lf.measure      
+0002d4c0: 2020 2020 2020 2020 3d20 6f74 6865 722e          = other.
+0002d4d0: 6d65 6173 7572 650d 0a20 2020 2020 2020  measure..       
+0002d4e0: 2066 6f72 206b 2c76 2069 6e20 6f74 6865   for k,v in othe
+0002d4f0: 722e 6669 656c 6473 2e69 7465 6d73 2829  r.fields.items()
+0002d500: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0002d510: 4d65 7267 6520 696e 2066 6965 6c64 7320  Merge in fields 
+0002d520: 7468 6174 2077 6520 7761 6e74 2074 6f20  that we want to 
+0002d530: 6578 706c 6963 6974 6c79 2063 6861 6e67  explicitly chang
+0002d540: 652c 2075 6e6c 6573 7320 7765 2068 6176  e, unless we hav
+0002d550: 6520 6e6f 7420 7370 6563 6966 6965 6420  e not specified 
+0002d560: 6669 656c 6473 2065 7870 6c69 6369 746c  fields explicitl
+0002d570: 792c 2069 6e20 7768 6963 6820 6361 7365  y, in which case
+0002d580: 206d 6572 6765 2069 6e20 6e6f 6e2d 4e55   merge in non-NU
+0002d590: 4c4c 2066 6965 6c64 730d 0a20 2020 2020  LL fields..     
+0002d5a0: 2020 2020 2020 2069 6620 2866 6965 6c64         if (field
+0002d5b0: 735f 746f 5f6d 6572 6765 2069 7320 6e6f  s_to_merge is no
+0002d5c0: 7420 4e6f 6e65 2061 6e64 206b 2069 6e20  t None and k in 
+0002d5d0: 6669 656c 6473 5f74 6f5f 6d65 7267 6529  fields_to_merge)
+0002d5e0: 206f 7220 2866 6965 6c64 735f 746f 5f6d   or (fields_to_m
+0002d5f0: 6572 6765 2069 7320 4e6f 6e65 2061 6e64  erge is None and
+0002d600: 2076 2069 7320 6e6f 7420 4e6f 6e65 293a   v is not None):
+0002d610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002d620: 2020 7365 6c66 2e66 6965 6c64 735b 6b5d    self.fields[k]
+0002d630: 203d 2076 0d0a 0d0a 2020 2020 4070 726f   = v....    @pro
+0002d640: 7065 7274 790d 0a20 2020 2064 6566 2073  perty..    def s
+0002d650: 6563 7572 6974 7928 7365 6c66 293a 0d0a  ecurity(self):..
+0002d660: 2020 2020 2020 2020 2727 2752 6574 7572          '''Retur
+0002d670: 6e73 2061 2053 6563 7572 6974 7920 6f62  ns a Security ob
+0002d680: 6a65 6374 2c20 7768 6963 6820 6861 7320  ject, which has 
+0002d690: 7079 7468 6f6e 2073 6574 7320 6f66 2075  python sets of u
+0002d6a0: 7365 7273 2073 686f 7274 6e61 6d65 7320  sers shortnames 
+0002d6b0: 666f 7220 2e76 6965 7765 7273 2c20 2e6d  for .viewers, .m
+0002d6c0: 6f64 6966 6965 7273 2061 6e64 202e 6461  odifiers and .da
+0002d6d0: 7461 5f76 6965 7765 7273 2727 270d 0a0d  ta_viewers'''...
+0002d6e0: 0a20 2020 2020 2020 2023 5365 6375 7269  .        #Securi
+0002d6f0: 7479 2069 7320 6c61 7a69 6c79 206c 6f61  ty is lazily loa
+0002d700: 6465 640d 0a20 2020 2020 2020 2069 6620  ded..        if 
+0002d710: 7365 6c66 2e5f 7365 6375 7269 7479 2069  self._security i
+0002d720: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0002d730: 2020 2020 2023 4372 6561 7465 2061 206e       #Create a n
+0002d740: 6577 2065 6c65 6d65 6e74 2073 6563 7572  ew element secur
+0002d750: 6974 7920 6f62 6a65 6374 0d0a 2020 2020  ity object..    
+0002d760: 2020 2020 2020 2020 7365 6c66 2e5f 7365          self._se
+0002d770: 6375 7269 7479 203d 2045 6c65 6d65 6e74  curity = Element
+0002d780: 5365 6375 7269 7479 2865 6c65 6d65 6e74  Security(element
+0002d790: 203d 2073 656c 6629 0d0a 2020 2020 2020   = self)..      
+0002d7a0: 2020 2020 2020 234c 6f61 6420 7365 6375        #Load secu
+0002d7b0: 7269 7479 2074 6f20 6f76 6572 7772 6974  rity to overwrit
+0002d7c0: 6520 7769 7468 2063 6f72 7265 6374 2076  e with correct v
+0002d7d0: 616c 7565 7320 2869 6620 7468 6579 2065  alues (if they e
+0002d7e0: 7869 7374 290d 0a20 2020 2020 2020 2020  xist)..         
+0002d7f0: 2020 2023 5468 6973 2077 696c 6c20 6f6e     #This will on
+0002d800: 6c79 206c 616f 6420 6966 206e 6f74 2061  ly laod if not a
+0002d810: 6c72 6561 6479 206c 6f61 6465 640d 0a20  lready loaded.. 
+0002d820: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0002d830: 6469 6d65 6e73 696f 6e2e 656c 656d 656e  dimension.elemen
+0002d840: 7473 2e5f 6c6f 6164 5f73 6563 7572 6974  ts._load_securit
+0002d850: 7928 290d 0a0d 0a20 2020 2020 2020 2072  y()....        r
+0002d860: 6574 7572 6e20 7365 6c66 2e5f 7365 6375  eturn self._secu
+0002d870: 7269 7479 0d0a 0d0a 2020 2020 6465 6620  rity....    def 
+0002d880: 5f5f 7265 7072 5f5f 2873 656c 6629 3a0d  __repr__(self):.
+0002d890: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002d8a0: 273c 7b7d 206f 626a 6563 742c 2073 686f  '<{} object, sho
+0002d8b0: 7274 6e61 6d65 207b 7d2c 206c 6f6e 676e  rtname {}, longn
+0002d8c0: 616d 6520 7b7d 2061 7420 7b7d 3e27 2e66  ame {} at {}>'.f
+0002d8d0: 6f72 6d61 7428 7365 6c66 2e5f 5f63 6c61  ormat(self.__cla
+0002d8e0: 7373 5f5f 2e5f 5f6e 616d 655f 5f2c 7365  ss__.__name__,se
+0002d8f0: 6c66 2e73 686f 7274 6e61 6d65 2c73 656c  lf.shortname,sel
+0002d900: 662e 6c6f 6e67 6e61 6d65 2c68 6578 2869  f.longname,hex(i
+0002d910: 6428 7365 6c66 2929 290d 0a0d 0a20 2020  d(self)))....   
+0002d920: 2064 6566 205f 5f65 715f 5f28 7365 6c66   def __eq__(self
+0002d930: 2c6f 7468 6572 293a 0d0a 2020 2020 2020  ,other):..      
+0002d940: 2020 2350 594d 2d33 3620 6669 7820 656c    #PYM-36 fix el
+0002d950: 656d 656e 7420 7368 6f75 6c64 206f 6e6c  ement should onl
+0002d960: 7920 6265 2065 7175 616c 2074 6f20 616e  y be equal to an
+0002d970: 6f74 6865 7220 656c 656d 656e 7420 7769  other element wi
+0002d980: 7468 2073 616d 6520 6469 6d65 6e73 696f  th same dimensio
+0002d990: 6e20 616e 6420 7368 6f72 746e 616d 652c  n and shortname,
+0002d9a0: 2065 7863 6c75 6469 6e67 204e 6f6e 6520   excluding None 
+0002d9b0: 756e 6c65 7373 2073 616d 6520 6f62 6a65  unless same obje
+0002d9c0: 6374 2069 640d 0a20 2020 2020 2020 2074  ct id..        t
+0002d9d0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0002d9e0: 2072 6574 7572 6e20 7365 6c66 2e73 686f   return self.sho
+0002d9f0: 7274 6e61 6d65 3d3d 6f74 6865 722e 7368  rtname==other.sh
+0002da00: 6f72 746e 616d 6520 616e 6420 2869 6428  ortname and (id(
+0002da10: 7365 6c66 2920 3d3d 2069 6428 6f74 6865  self) == id(othe
+0002da20: 7229 206f 7220 2873 656c 662e 6469 6d65  r) or (self.dime
+0002da30: 6e73 696f 6e20 3d3d 206f 7468 6572 2e64  nsion == other.d
+0002da40: 696d 656e 7369 6f6e 2061 6e64 2069 7369  imension and isi
+0002da50: 6e73 7461 6e63 6528 6f74 6865 722c 2045  nstance(other, E
+0002da60: 6c65 6d65 6e74 2920 616e 6420 7365 6c66  lement) and self
+0002da70: 2e73 686f 7274 6e61 6d65 2069 7320 6e6f  .shortname is no
+0002da80: 7420 4e6f 6e65 2929 0d0a 2020 2020 2020  t None))..      
+0002da90: 2020 6578 6365 7074 2041 7474 7269 6275    except Attribu
+0002daa0: 7465 4572 726f 723a 0d0a 2020 2020 2020  teError:..      
+0002dab0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0002dac0: 7365 0d0a 0d0a 2020 2020 6465 6620 5f5f  se....    def __
+0002dad0: 6861 7368 5f5f 2873 656c 6629 3a0d 0a20  hash__(self):.. 
+0002dae0: 2020 2020 2020 2072 6574 7572 6e20 6861         return ha
+0002daf0: 7368 2873 656c 662e 7368 6f72 746e 616d  sh(self.shortnam
+0002db00: 6529 0d0a 0d0a 636c 6173 7320 5469 6d65  e)....class Time
+0002db10: 456c 656d 656e 7428 456c 656d 656e 7429  Element(Element)
+0002db20: 3a0d 0a0d 0a20 2020 2064 6566 205f 5f69  :....    def __i
+0002db30: 6e69 745f 5f28 7365 6c66 2c69 6e74 6572  nit__(self,inter
+0002db40: 7661 6c5f 696e 6465 782c 7368 6f72 746e  val_index,shortn
+0002db50: 616d 652c 7965 6172 2c6d 6f6e 7468 3d4e  ame,year,month=N
+0002db60: 6f6e 652c 6461 793d 4e6f 6e65 2c6c 6f6e  one,day=None,lon
+0002db70: 676e 616d 653d 4e6f 6e65 2c64 6573 6372  gname=None,descr
+0002db80: 6970 7469 6f6e 3d4e 6f6e 652c 7068 7973  iption=None,phys
+0002db90: 6964 3d4e 6f6e 652c 6469 6d65 6e73 696f  id=None,dimensio
+0002dba0: 6e3d 4e6f 6e65 293a 0d0a 0d0a 2020 2020  n=None):....    
+0002dbb0: 2020 2020 6966 2069 6e74 6572 7661 6c5f      if interval_
+0002dbc0: 696e 6465 7820 6e6f 7420 696e 205b 6c6c  index not in [ll
+0002dbd0: 752e 454d 504f 5745 525f 5945 4152 5f43  u.EMPOWER_YEAR_C
+0002dbe0: 4f4e 5354 414e 542c 6c6c 752e 454d 504f  ONSTANT,llu.EMPO
+0002dbf0: 5745 525f 4841 4c46 5945 4152 5f43 4f4e  WER_HALFYEAR_CON
+0002dc00: 5354 414e 542c 6c6c 752e 454d 504f 5745  STANT,llu.EMPOWE
+0002dc10: 525f 5155 4152 5445 525f 434f 4e53 5441  R_QUARTER_CONSTA
+0002dc20: 4e54 2c6c 6c75 2e45 4d50 4f57 4552 5f4d  NT,llu.EMPOWER_M
+0002dc30: 4f4e 5448 5f43 4f4e 5354 414e 542c 6c6c  ONTH_CONSTANT,ll
+0002dc40: 752e 454d 504f 5745 525f 5745 454b 5f43  u.EMPOWER_WEEK_C
+0002dc50: 4f4e 5354 414e 542c 6c6c 752e 454d 504f  ONSTANT,llu.EMPO
+0002dc60: 5745 525f 4441 595f 434f 4e53 5441 4e54  WER_DAY_CONSTANT
+0002dc70: 2c27 5927 2c27 4827 2c27 5127 2c27 4d27  ,'Y','H','Q','M'
+0002dc80: 2c27 5727 2c27 4427 5d3a 0d0a 2020 2020  ,'W','D']:..    
+0002dc90: 2020 2020 2020 2020 2350 726f 6772 616d          #Program
+0002dca0: 6d69 6e67 2065 7272 6f72 0d0a 2020 2020  ming error..    
+0002dcb0: 2020 2020 2020 2020 7261 6973 6520 4174          raise At
+0002dcc0: 7472 6962 7574 6545 7272 6f72 2822 696e  tributeError("in
+0002dcd0: 7465 7276 616c 5f69 6e64 6578 206d 7573  terval_index mus
+0002dce0: 7420 6265 2069 6e20 7468 6520 456d 706f  t be in the Empo
+0002dcf0: 7765 7220 696e 7465 7276 616c 2069 6e64  wer interval ind
+0002dd00: 6578 2072 616e 6765 2066 726f 6d20 3020  ex range from 0 
+0002dd10: 746f 2035 206f 7220 6f6e 6520 6f66 2027  to 5 or one of '
+0002dd20: 5927 2c27 4827 2c27 5127 2c27 4d2c 2757  Y','H','Q','M,'W
+0002dd30: 2720 6f72 2027 4427 202d 2067 6f74 3a22  ' or 'D' - got:"
+0002dd40: 2b73 7472 2869 6e74 6572 7661 6c5f 696e  +str(interval_in
+0002dd50: 6465 7829 290d 0a20 2020 2020 2020 2023  dex))..        #
+0002dd60: 544f 444f 2061 6464 2065 7874 7261 2063  TODO add extra c
+0002dd70: 6865 636b 696e 672c 2061 6464 206c 6f67  hecking, add log
+0002dd80: 6963 2028 656c 7365 7768 6565 7220 666f  ic (elsewheer fo
+0002dd90: 7220 6372 6561 7469 6e67 2077 6565 6b73  r creating weeks
+0002dda0: 2061 6e64 2064 6179 730d 0a0d 0a20 2020   and days....   
+0002ddb0: 2020 2020 2023 5472 616e 7366 6f72 6d20       #Transform 
+0002ddc0: 696e 7465 7276 616c 5f69 6e64 6578 2074  interval_index t
+0002ddd0: 6f20 6120 6e75 6d62 6572 0d0a 2020 2020  o a number..    
+0002dde0: 2020 2020 696e 7465 7276 616c 5f69 6e64      interval_ind
+0002ddf0: 6578 203d 207b 6c6c 752e 454d 504f 5745  ex = {llu.EMPOWE
+0002de00: 525f 5945 4152 5f43 4f4e 5354 414e 543a  R_YEAR_CONSTANT:
+0002de10: 2020 2020 206c 6c75 2e45 4d50 4f57 4552       llu.EMPOWER
+0002de20: 5f59 4541 525f 434f 4e53 5441 4e54 0d0a  _YEAR_CONSTANT..
+0002de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002de40: 2020 2020 2020 2020 202c 6c6c 752e 454d           ,llu.EM
+0002de50: 504f 5745 525f 4841 4c46 5945 4152 5f43  POWER_HALFYEAR_C
+0002de60: 4f4e 5354 414e 543a 206c 6c75 2e45 4d50  ONSTANT: llu.EMP
+0002de70: 4f57 4552 5f48 414c 4659 4541 525f 434f  OWER_HALFYEAR_CO
+0002de80: 4e53 5441 4e54 0d0a 2020 2020 2020 2020  NSTANT..        
+0002de90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dea0: 202c 6c6c 752e 454d 504f 5745 525f 5155   ,llu.EMPOWER_QU
+0002deb0: 4152 5445 525f 434f 4e53 5441 4e54 3a20  ARTER_CONSTANT: 
+0002dec0: 206c 6c75 2e45 4d50 4f57 4552 5f51 5541   llu.EMPOWER_QUA
+0002ded0: 5254 4552 5f43 4f4e 5354 414e 540d 0a20  RTER_CONSTANT.. 
+0002dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002def0: 2020 2020 2020 2020 2c6c 6c75 2e45 4d50          ,llu.EMP
+0002df00: 4f57 4552 5f4d 4f4e 5448 5f43 4f4e 5354  OWER_MONTH_CONST
+0002df10: 414e 543a 2020 2020 6c6c 752e 454d 504f  ANT:    llu.EMPO
+0002df20: 5745 525f 4d4f 4e54 485f 434f 4e53 5441  WER_MONTH_CONSTA
+0002df30: 4e54 0d0a 2020 2020 2020 2020 2020 2020  NT..            
+0002df40: 2020 2020 2020 2020 2020 2020 202c 6c6c               ,ll
+0002df50: 752e 454d 504f 5745 525f 5745 454b 5f43  u.EMPOWER_WEEK_C
+0002df60: 4f4e 5354 414e 543a 2020 2020 206c 6c75  ONSTANT:     llu
+0002df70: 2e45 4d50 4f57 4552 5f57 4545 4b5f 434f  .EMPOWER_WEEK_CO
+0002df80: 4e53 5441 4e54 0d0a 2020 2020 2020 2020  NSTANT..        
+0002df90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dfa0: 202c 6c6c 752e 454d 504f 5745 525f 4441   ,llu.EMPOWER_DA
+0002dfb0: 595f 434f 4e53 5441 4e54 3a20 2020 2020  Y_CONSTANT:     
+0002dfc0: 206c 6c75 2e45 4d50 4f57 4552 5f44 4159   llu.EMPOWER_DAY
+0002dfd0: 5f43 4f4e 5354 414e 540d 0a20 2020 2020  _CONSTANT..     
+0002dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002dff0: 2020 2020 2c27 5927 3a20 6c6c 752e 454d      ,'Y': llu.EM
+0002e000: 504f 5745 525f 5945 4152 5f43 4f4e 5354  POWER_YEAR_CONST
+0002e010: 414e 540d 0a20 2020 2020 2020 2020 2020  ANT..           
+0002e020: 2020 2020 2020 2020 2020 2020 2020 2c27                ,'
+0002e030: 4827 3a20 6c6c 752e 454d 504f 5745 525f  H': llu.EMPOWER_
+0002e040: 4841 4c46 5945 4152 5f43 4f4e 5354 414e  HALFYEAR_CONSTAN
+0002e050: 540d 0a20 2020 2020 2020 2020 2020 2020  T..             
+0002e060: 2020 2020 2020 2020 2020 2020 2c27 5127              ,'Q'
+0002e070: 3a20 6c6c 752e 454d 504f 5745 525f 5155  : llu.EMPOWER_QU
+0002e080: 4152 5445 525f 434f 4e53 5441 4e54 0d0a  ARTER_CONSTANT..
+0002e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e0a0: 2020 2020 2020 2020 202c 274d 273a 206c           ,'M': l
+0002e0b0: 6c75 2e45 4d50 4f57 4552 5f4d 4f4e 5448  lu.EMPOWER_MONTH
+0002e0c0: 5f43 4f4e 5354 414e 540d 0a20 2020 2020  _CONSTANT..     
+0002e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e0e0: 2020 2020 2c27 5727 3a20 6c6c 752e 454d      ,'W': llu.EM
+0002e0f0: 504f 5745 525f 5745 454b 5f43 4f4e 5354  POWER_WEEK_CONST
+0002e100: 414e 540d 0a20 2020 2020 2020 2020 2020  ANT..           
+0002e110: 2020 2020 2020 2020 2020 2020 2020 2c27                ,'
+0002e120: 4427 3a20 6c6c 752e 454d 504f 5745 525f  D': llu.EMPOWER_
+0002e130: 4441 595f 434f 4e53 5441 4e54 7d5b 696e  DAY_CONSTANT}[in
+0002e140: 7465 7276 616c 5f69 6e64 6578 5d0d 0a0d  terval_index]...
+0002e150: 0a20 2020 2020 2020 2073 7570 6572 2854  .        super(T
+0002e160: 696d 6545 6c65 6d65 6e74 2c20 7365 6c66  imeElement, self
+0002e170: 292e 5f5f 696e 6974 5f5f 2873 686f 7274  ).__init__(short
+0002e180: 6e61 6d65 3d73 686f 7274 6e61 6d65 2c6c  name=shortname,l
+0002e190: 6f6e 676e 616d 653d 6c6f 6e67 6e61 6d65  ongname=longname
+0002e1a0: 2c64 6573 6372 6970 7469 6f6e 3d64 6573  ,description=des
+0002e1b0: 6372 6970 7469 6f6e 2c70 6879 7369 643d  cription,physid=
+0002e1c0: 7068 7973 6964 2c64 696d 656e 7369 6f6e  physid,dimension
+0002e1d0: 3d64 696d 656e 7369 6f6e 290d 0a0d 0a20  =dimension).... 
+0002e1e0: 2020 2020 2020 2073 656c 662e 5f79 6561         self._yea
+0002e1f0: 7220 2020 2020 2020 2020 2020 3d20 7965  r           = ye
+0002e200: 6172 0d0a 2020 2020 2020 2020 7365 6c66  ar..        self
+0002e210: 2e5f 6d6f 6e74 6820 2020 2020 2020 2020  ._month         
+0002e220: 203d 206d 6f6e 7468 0d0a 2020 2020 2020   = month..      
+0002e230: 2020 7365 6c66 2e5f 6461 7920 2020 2020    self._day     
+0002e240: 2020 2020 2020 203d 2064 6179 0d0a 2020         = day..  
+0002e250: 2020 2020 2020 7365 6c66 2e5f 696e 7465        self._inte
+0002e260: 7276 616c 5f69 6e64 6578 203d 2069 6e74  rval_index = int
+0002e270: 6572 7661 6c5f 696e 6465 780d 0a0d 0a20  erval_index.... 
+0002e280: 2020 2020 2020 2073 656c 662e 5f69 6e74         self._int
+0002e290: 6572 7661 6c5f 616d 6f75 6e74 203d 2031  erval_amount = 1
+0002e2a0: 2023 2044 6566 6175 6c74 0d0a 2020 2020   # Default..    
+0002e2b0: 2020 2020 7365 6c66 2e5f 7265 736f 6c75      self._resolu
+0002e2c0: 7469 6f6e 2020 2020 2020 3d20 3120 2320  tion      = 1 # 
+0002e2d0: 4465 6661 756c 740d 0a20 2020 2020 2020  Default..       
+0002e2e0: 2073 656c 662e 5f6f 6666 7365 7420 2020   self._offset   
+0002e2f0: 2020 2020 2020 203d 204e 6f6e 650d 0a0d         = None...
+0002e300: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0002e310: 2e5f 6d6f 6e74 6820 6973 204e 6f6e 653a  ._month is None:
+0002e320: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+0002e330: 6c66 2e5f 6d6f 6e74 6820 3d20 310d 0a0d  lf._month = 1...
+0002e340: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0002e350: 2e5f 6461 7920 6973 204e 6f6e 653a 0d0a  ._day is None:..
+0002e360: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0002e370: 2e5f 6461 7920 3d20 310d 0a20 2020 200d  ._day = 1..    .
+0002e380: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
+0002e390: 6174 6520 3d20 6461 7465 7469 6d65 2e64  ate = datetime.d
+0002e3a0: 6174 6574 696d 6528 7365 6c66 2e5f 7965  atetime(self._ye
+0002e3b0: 6172 2c20 7365 6c66 2e5f 6d6f 6e74 682c  ar, self._month,
+0002e3c0: 2073 656c 662e 5f64 6179 290d 0a20 2020   self._day)..   
+0002e3d0: 2020 2020 200d 0a20 2020 2040 7072 6f70       ..    @prop
+0002e3e0: 6572 7479 0d0a 2020 2020 6465 6620 6461  erty..    def da
+0002e3f0: 7465 2873 656c 6629 3a0d 0a20 2020 2020  te(self):..     
+0002e400: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0002e410: 6461 7465 0d0a 0d0a 2020 2020 4070 726f  date....    @pro
+0002e420: 7065 7274 790d 0a20 2020 2064 6566 2069  perty..    def i
+0002e430: 6e74 6572 7661 6c5f 696e 6465 7828 7365  nterval_index(se
+0002e440: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
+0002e450: 7475 726e 2073 656c 662e 5f69 6e74 6572  turn self._inter
+0002e460: 7661 6c5f 696e 6465 780d 0a0d 0a20 2020  val_index....   
+0002e470: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
+0002e480: 6465 6620 696e 7465 7276 616c 2873 656c  def interval(sel
+0002e490: 6629 3a0d 0a0d 0a20 2020 2020 2020 2072  f):....        r
+0002e4a0: 6574 7572 6e20 7b6c 6c75 2e45 4d50 4f57  eturn {llu.EMPOW
+0002e4b0: 4552 5f59 4541 525f 434f 4e53 5441 4e54  ER_YEAR_CONSTANT
+0002e4c0: 3a20 2020 2027 5965 6172 270d 0a20 2020  :    'Year'..   
+0002e4d0: 2020 2020 2020 2020 2020 2020 2c6c 6c75              ,llu
+0002e4e0: 2e45 4d50 4f57 4552 5f48 414c 4659 4541  .EMPOWER_HALFYEA
+0002e4f0: 525f 434f 4e53 5441 4e54 3a27 4861 6c66  R_CONSTANT:'Half
+0002e500: 2d79 6561 7227 0d0a 2020 2020 2020 2020  -year'..        
+0002e510: 2020 2020 2020 202c 6c6c 752e 454d 504f         ,llu.EMPO
+0002e520: 5745 525f 5155 4152 5445 525f 434f 4e53  WER_QUARTER_CONS
+0002e530: 5441 4e54 3a20 2751 7561 7274 6572 270d  TANT: 'Quarter'.
+0002e540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002e550: 2c6c 6c75 2e45 4d50 4f57 4552 5f4d 4f4e  ,llu.EMPOWER_MON
+0002e560: 5448 5f43 4f4e 5354 414e 543a 2020 2027  TH_CONSTANT:   '
+0002e570: 4d6f 6e74 6827 0d0a 2020 2020 2020 2020  Month'..        
+0002e580: 2020 2020 2020 202c 6c6c 752e 454d 504f         ,llu.EMPO
+0002e590: 5745 525f 5745 454b 5f43 4f4e 5354 414e  WER_WEEK_CONSTAN
+0002e5a0: 543a 2020 2020 2757 6565 6b27 0d0a 2020  T:    'Week'..  
+0002e5b0: 2020 2020 2020 2020 2020 2020 202c 6c6c               ,ll
+0002e5c0: 752e 454d 504f 5745 525f 4441 595f 434f  u.EMPOWER_DAY_CO
+0002e5d0: 4e53 5441 4e54 3a20 2020 2020 2744 6179  NSTANT:     'Day
+0002e5e0: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
+0002e5f0: 2020 7d5b 7365 6c66 2e69 6e74 6572 7661    }[self.interva
+0002e600: 6c5f 696e 6465 785d 0d0a 0d0a 0d0a 2020  l_index]......  
+0002e610: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+0002e620: 2064 6566 2069 6e74 6572 7661 6c5f 616d   def interval_am
+0002e630: 6f75 6e74 2873 656c 6629 3a0d 0a20 2020  ount(self):..   
+0002e640: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0002e650: 2e5f 696e 7465 7276 616c 5f61 6d6f 756e  ._interval_amoun
+0002e660: 740d 0a0d 0a20 2020 2040 7072 6f70 6572  t....    @proper
+0002e670: 7479 0d0a 2020 2020 6465 6620 7265 736f  ty..    def reso
+0002e680: 6c75 7469 6f6e 2873 656c 6629 3a0d 0a20  lution(self):.. 
+0002e690: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0002e6a0: 6c66 2e5f 7265 736f 6c75 7469 6f6e 0d0a  lf._resolution..
+0002e6b0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
+0002e6c0: 0a20 2020 2064 6566 206f 6666 7365 7428  .    def offset(
+0002e6d0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0002e6e0: 7265 7475 726e 2073 656c 662e 5f6f 6666  return self._off
+0002e6f0: 7365 740d 0a0d 0a0d 0a20 2020 2040 7072  set......    @pr
+0002e700: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+0002e710: 656d 706f 7765 725f 7065 7269 6f64 5f6e  empower_period_n
+0002e720: 756d 6265 7228 7365 6c66 293a 0d0a 2020  umber(self):..  
+0002e730: 2020 2020 2020 2727 2741 7070 6c69 6573        '''Applies
+0002e740: 2074 6f20 7469 6d65 2065 6c65 6d65 6e74   to time element
+0002e750: 7320 6f6e 6c79 2e20 4120 7265 6164 206f  s only. A read o
+0002e760: 6e6c 7920 7072 6f70 6572 7479 2074 6861  nly property tha
+0002e770: 7420 7265 7475 726e 7320 7468 6520 456d  t returns the Em
+0002e780: 706f 7765 7220 5065 7269 6f64 2074 7970  power Period typ
+0002e790: 6520 6e75 6d62 6572 2028 652e 672e 2033  e number (e.g. 3
+0002e7a0: 2066 6f72 2061 204d 6f6e 7468 2927 2727   for a Month)'''
+0002e7b0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0002e7c0: 2073 656c 662e 696e 7465 7276 616c 5f69   self.interval_i
+0002e7d0: 6e64 6578 0d0a 0d0a 2020 2020 6465 6620  ndex....    def 
+0002e7e0: 636f 7079 2873 656c 6629 3a0d 0a20 2020  copy(self):..   
+0002e7f0: 2020 2020 2027 2727 4372 6561 7465 2061       '''Create a
+0002e800: 2063 6f70 7920 6f66 2073 656c 662c 206e   copy of self, n
+0002e810: 6f74 2069 6e63 6c75 6469 6e67 2074 6865  ot including the
+0002e820: 2070 6879 7369 6420 6f72 2073 686f 7274   physid or short
+0002e830: 6e61 6d65 2727 270d 0a20 2020 2020 2020  name'''..       
+0002e840: 2072 6574 7572 6e20 5469 6d65 456c 656d   return TimeElem
+0002e850: 656e 7428 6c6f 6e67 6e61 6d65 2020 2020  ent(longname    
+0002e860: 2020 2020 2020 2020 203d 2073 656c 662e           = self.
+0002e870: 6c6f 6e67 6e61 6d65 0d0a 2020 2020 2020  longname..      
+0002e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e890: 2c73 686f 7274 6e61 6d65 2020 2020 2020  ,shortname      
+0002e8a0: 2020 2020 2020 3d20 4e6f 6e65 0d0a 2020        = None..  
+0002e8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e8c0: 2020 2020 2c64 6573 6372 6970 7469 6f6e      ,description
+0002e8d0: 2020 2020 2020 2020 2020 3d20 7365 6c66            = self
+0002e8e0: 2e64 6573 6372 6970 7469 6f6e 0d0a 2020  .description..  
+0002e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e900: 2020 2020 2c69 6e74 6572 7661 6c5f 696e      ,interval_in
+0002e910: 6465 7820 2020 2020 2020 2020 2020 3d20  dex           = 
+0002e920: 7365 6c66 2e69 6e74 6572 7661 6c5f 696e  self.interval_in
+0002e930: 6465 780d 0a20 2020 2020 2020 2020 2020  dex..           
+0002e940: 2020 2020 2020 2020 2020 202c 7965 6172             ,year
+0002e950: 2020 203d 2073 656c 662e 7965 6172 0d0a     = self.year..
+0002e960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002e970: 2020 2020 2020 2c6d 6f6e 7468 2020 2020        ,month    
+0002e980: 2020 2020 2020 3d20 7365 6c66 2e6d 6f6e        = self.mon
+0002e990: 7468 0d0a 2020 2020 2020 2020 2020 2020  th..            
+0002e9a0: 2020 2020 2020 2020 2020 2c64 6179 2020            ,day  
+0002e9b0: 2020 2020 2020 2020 2020 2020 203d 2073               = s
+0002e9c0: 656c 662e 6461 790d 0a20 2020 2020 2020  elf.day..       
+0002e9d0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0002e9e0: 7765 656b 2020 2020 2020 2020 2020 2020  week            
+0002e9f0: 2020 203d 2073 656c 662e 7765 656b 0d0a     = self.week..
+0002ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ea10: 2020 2020 2020 2c71 7561 7274 6572 2020        ,quarter  
+0002ea20: 2020 2020 2020 2020 2020 2020 203d 2073               = s
+0002ea30: 656c 662e 7175 6172 7465 720d 0a20 2020  elf.quarter..   
+0002ea40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002ea50: 2020 202c 6861 6c66 2020 2020 2020 2020     ,half        
+0002ea60: 2020 2020 2020 203d 2073 656c 662e 6861         = self.ha
+0002ea70: 6c66 0d0a 2020 2020 2020 2020 2020 2020  lf..            
+0002ea80: 2020 2020 2020 2020 2020 2c64 696d 656e            ,dimen
+0002ea90: 7369 6f6e 2020 2020 2020 2020 2020 2020  sion            
+0002eaa0: 3d20 7365 6c66 2e64 696d 656e 7369 6f6e  = self.dimension
+0002eab0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002eac0: 2020 2020 2020 2020 290d 0a0d 0a63 6c61          )....cla
+0002ead0: 7373 2053 7472 7563 7475 7265 286f 626a  ss Structure(obj
+0002eae0: 6563 7429 3a0d 0a0d 0a20 2020 2064 6566  ect):....    def
+0002eaf0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c73   __init__(self,s
+0002eb00: 686f 7274 6e61 6d65 3d4e 6f6e 652c 6c6f  hortname=None,lo
+0002eb10: 6e67 6e61 6d65 3d4e 6f6e 652c 6469 6d65  ngname=None,dime
+0002eb20: 6e73 696f 6e5f 696e 6465 783d 4e6f 6e65  nsion_index=None
+0002eb30: 2c64 696d 656e 7369 6f6e 3d4e 6f6e 652c  ,dimension=None,
+0002eb40: 6465 7363 7269 7074 696f 6e3d 4e6f 6e65  description=None
+0002eb50: 293a 0d0a 0d0a 2020 2020 2020 2020 7365  ):....        se
+0002eb60: 6c66 2e5f 7368 6f72 746e 616d 653d 7368  lf._shortname=sh
+0002eb70: 6f72 746e 616d 650d 0a20 2020 2020 2020  ortname..       
+0002eb80: 2073 656c 662e 5f6c 6f6e 676e 616d 6520   self._longname 
+0002eb90: 3d6c 6f6e 676e 616d 650d 0a20 2020 2020  =longname..     
+0002eba0: 2020 2069 6620 7365 6c66 2e5f 6c6f 6e67     if self._long
+0002ebb0: 6e61 6d65 2069 7320 4e6f 6e65 3a0d 0a20  name is None:.. 
+0002ebc0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0002ebd0: 5f6c 6f6e 676e 616d 6520 3d20 7365 6c66  _longname = self
+0002ebe0: 2e5f 7368 6f72 746e 616d 650d 0a0d 0a20  ._shortname.... 
+0002ebf0: 2020 2020 2020 2073 656c 662e 6469 6d65         self.dime
+0002ec00: 6e73 696f 6e20 3d20 6469 6d65 6e73 696f  nsion = dimensio
+0002ec10: 6e0d 0a20 2020 2020 2020 2069 6620 7365  n..        if se
+0002ec20: 6c66 2e64 696d 656e 7369 6f6e 3a0d 0a20  lf.dimension:.. 
+0002ec30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0002ec40: 6469 6d65 6e73 696f 6e5f 696e 6465 7820  dimension_index 
+0002ec50: 3d20 7365 6c66 2e64 696d 656e 7369 6f6e  = self.dimension
+0002ec60: 2e69 6e64 6578 0d0a 2020 2020 2020 2020  .index..        
+0002ec70: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0002ec80: 2020 2073 656c 662e 6469 6d65 6e73 696f     self.dimensio
+0002ec90: 6e5f 696e 6465 7820 3d20 6469 6d65 6e73  n_index = dimens
+0002eca0: 696f 6e5f 696e 6465 780d 0a0d 0a20 2020  ion_index....   
+0002ecb0: 2020 2020 2073 656c 662e 5f64 6573 6372       self._descr
+0002ecc0: 6970 7469 6f6e 203d 2064 6573 6372 6970  iption = descrip
+0002ecd0: 7469 6f6e 0d0a 0d0a 2020 2020 2020 2020  tion....        
+0002ece0: 2344 6963 7469 6f6e 6172 7920 6f66 2073  #Dictionary of s
+0002ecf0: 686f 7274 6e61 6d65 2c20 656c 656d 656e  hortname, elemen
+0002ed00: 7420 7061 6972 730d 0a20 2020 2020 2020  t pairs..       
+0002ed10: 2023 616c 6c6f 7720 726f 6f74 2065 6c65   #allow root ele
+0002ed20: 6d65 6e74 7320 746f 2062 6568 6176 6520  ments to behave 
+0002ed30: 6c69 6b65 2061 2064 6963 7469 6f6e 6172  like a dictionar
+0002ed40: 7920 2d20 652e 672e 2073 7472 7563 7475  y - e.g. structu
+0002ed50: 7265 2e68 6965 7261 7263 6869 6573 5b27  re.hierarchies['
+0002ed60: 4547 4753 275d 0d0a 2020 2020 2020 2020  EGGS']..        
+0002ed70: 7365 6c66 2e5f 6869 6572 6172 6368 6965  self._hierarchie
+0002ed80: 7320 3d20 5f48 6965 7261 7263 6869 6573  s = _Hierarchies
+0002ed90: 4765 7474 6572 2873 7472 7563 7475 7265  Getter(structure
+0002eda0: 203d 2073 656c 6629 0d0a 2020 2020 2020   = self)..      
+0002edb0: 2020 236c 6f67 2e69 6e66 6f28 2753 6574    #log.info('Set
+0002edc0: 205f 6869 6572 6172 6368 6965 7327 290d   _hierarchies').
+0002edd0: 0a20 2020 2020 2020 2023 6c6f 672e 696e  .        #log.in
+0002ede0: 666f 2873 7472 2873 656c 662e 5f68 6965  fo(str(self._hie
+0002edf0: 7261 7263 6869 6573 2029 290d 0a0d 0a20  rarchies )).... 
+0002ee00: 2020 2020 2020 2073 656c 662e 5f64 6573         self._des
+0002ee10: 6365 6e64 616e 7473 203d 205f 5374 7275  cendants = _Stru
+0002ee20: 6374 7572 6544 6573 6365 6e64 616e 7473  ctureDescendants
+0002ee30: 4765 7474 6572 2873 7472 7563 7475 7265  Getter(structure
+0002ee40: 203d 2073 656c 6629 0d0a 0d0a 2020 2020   = self)....    
+0002ee50: 2020 2020 7365 6c66 2e5f 6869 6572 6172      self._hierar
+0002ee60: 6368 6965 735f 7265 6164 203d 2046 616c  chies_read = Fal
+0002ee70: 7365 0d0a 0d0a 2020 2020 2020 2020 7365  se....        se
+0002ee80: 6c66 2e5f 6578 6973 7473 5f69 6e5f 656d  lf._exists_in_em
+0002ee90: 706f 7765 7220 3d20 4661 6c73 650d 0a0d  power = False...
+0002eea0: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+0002eeb0: 0d0a 2020 2020 6465 6620 6869 6572 6172  ..    def hierar
+0002eec0: 6368 6965 7328 7365 6c66 293a 0d0a 2020  chies(self):..  
+0002eed0: 2020 2020 2020 2727 2747 6574 2061 2064        '''Get a d
+0002eee0: 6963 7469 6f6e 6172 792d 6c69 6b65 206f  ictionary-like o
+0002eef0: 626a 6563 7420 636f 6e74 6961 6e69 6e67  bject contianing
+0002ef00: 2061 6c6c 206f 6620 7468 6520 6869 6572   all of the hier
+0002ef10: 6172 6368 6965 7320 2874 6f70 206c 6576  archies (top lev
+0002ef20: 656c 2053 7472 7563 7475 7265 456c 656d  el StructureElem
+0002ef30: 656e 7473 2920 696e 2074 6869 7320 5374  ents) in this St
+0002ef40: 7275 6374 7572 650d 0a0d 0a20 2020 2020  ructure....     
+0002ef50: 2020 2045 2e67 2e20 746f 2067 6574 2074     E.g. to get t
+0002ef60: 6865 2072 6f6f 7420 5374 7275 6374 7572  he root Structur
+0002ef70: 6545 6c65 6d65 6e74 2066 6f72 2053 7472  eElement for Str
+0002ef80: 7563 7475 7265 206d 795f 7374 7275 6374  ucture my_struct
+0002ef90: 7572 652c 2077 6974 6820 7368 6f72 7463  ure, with shortc
+0002efa0: 6f64 6520 2753 5041 4d27 3a0d 0a0d 0a20  ode 'SPAM':.... 
+0002efb0: 2020 2020 2020 203e 3e3e 206d 795f 7374         >>> my_st
+0002efc0: 7275 6374 7572 652e 6869 6572 6172 6368  ructure.hierarch
+0002efd0: 6965 735b 2753 5041 4d27 5d0d 0a20 2020  ies['SPAM']..   
+0002efe0: 2020 2020 2027 2727 0d0a 0d0a 2020 2020       '''....    
+0002eff0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0002f000: 5f68 6965 7261 7263 6869 6573 5f72 6561  _hierarchies_rea
+0002f010: 643a 0d0a 2020 2020 2020 2020 2020 2020  d:..            
+0002f020: 236c 6f67 2e69 6e66 6f28 275f 6c6f 6164  #log.info('_load
+0002f030: 5f73 7472 7563 7475 7265 2033 3033 3527  _structure 3035'
+0002f040: 290d 0a20 2020 2020 2020 2020 2020 2069  )..            i
+0002f050: 6620 7365 6c66 2e64 696d 656e 7369 6f6e  f self.dimension
+0002f060: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+0002f070: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0002f080: 6620 6e6f 7420 7365 6c66 2e73 686f 7274  f not self.short
+0002f090: 636f 6465 3a20 7072 696e 7428 2773 686f  code: print('sho
+0002f0a0: 7274 636f 6465 2069 7320 4e6f 6e65 2729  rtcode is None')
+0002f0b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0002f0c0: 2020 6173 7365 7274 2073 656c 662e 7368    assert self.sh
+0002f0d0: 6f72 7463 6f64 6520 6973 206e 6f74 204e  ortcode is not N
+0002f0e0: 6f6e 650d 0a0d 0a20 2020 2020 2020 2020  one....         
+0002f0f0: 2020 2020 2020 2073 656c 662e 6469 6d65         self.dime
+0002f100: 6e73 696f 6e2e 7374 7275 6374 7572 6573  nsion.structures
+0002f110: 2e5f 6c6f 6164 5f73 7472 7563 7475 7265  ._load_structure
+0002f120: 2873 656c 662e 7368 6f72 7463 6f64 652c  (self.shortcode,
+0002f130: 6f6c 645f 7374 7275 6374 7572 6520 3d20  old_structure = 
+0002f140: 7365 6c66 290d 0a0d 0a20 2020 2020 2020  self)....       
+0002f150: 2072 6574 7572 6e20 7365 6c66 2e5f 6869   return self._hi
+0002f160: 6572 6172 6368 6965 730d 0a0d 0a20 2020  erarchies....   
+0002f170: 2040 6869 6572 6172 6368 6965 732e 7365   @hierarchies.se
+0002f180: 7474 6572 0d0a 2020 2020 6465 6620 6869  tter..    def hi
+0002f190: 6572 6172 6368 6965 7328 7365 6c66 2c76  erarchies(self,v
+0002f1a0: 616c 293a 0d0a 2020 2020 2020 2020 6966  al):..        if
+0002f1b0: 2069 7369 6e73 7461 6e63 6528 7661 6c2c   isinstance(val,
+0002f1c0: 5f48 6965 7261 7263 6869 6573 4765 7474  _HierarchiesGett
+0002f1d0: 6572 293a 0d0a 2020 2020 2020 2020 2020  er):..          
+0002f1e0: 2020 7365 6c66 2e5f 6869 6572 6172 6368    self._hierarch
+0002f1f0: 6965 7320 3d20 7661 6c0d 0a20 2020 2020  ies = val..     
+0002f200: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0002f210: 2020 2020 2020 7365 6c66 2e5f 6869 6572        self._hier
+0002f220: 6172 6368 6965 732e 636c 6561 7228 290d  archies.clear().
+0002f230: 0a20 2020 2020 2020 2020 2020 2023 6c6f  .            #lo
+0002f240: 672e 696e 666f 2827 5365 7474 696e 6720  g.info('Setting 
+0002f250: 6869 6572 6172 6368 6965 7320 746f 207b  hierarchies to {
+0002f260: 7d27 2e66 6f72 6d61 7428 7661 6c29 290d  }'.format(val)).
+0002f270: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0002f280: 662e 5f68 6965 7261 7263 6869 6573 2e61  f._hierarchies.a
+0002f290: 7070 656e 6428 7661 6c29 0d0a 0d0a 2020  ppend(val)....  
+0002f2a0: 2020 6465 6620 5f67 6574 5f65 6c65 6d65    def _get_eleme
+0002f2b0: 6e74 735f 6765 6e65 7261 746f 7228 7365  nts_generator(se
+0002f2c0: 6c66 2c73 686f 7274 6e61 6d65 293a 0d0a  lf,shortname):..
+0002f2d0: 2020 2020 2020 2020 2727 2747 6574 2061          '''Get a
+0002f2e0: 6c6c 206f 6620 7468 6520 656c 656d 656e  ll of the elemen
+0002f2f0: 7473 2069 6e20 7468 6973 2073 7472 7563  ts in this struc
+0002f300: 7475 7265 2077 6974 6820 7468 6520 6769  ture with the gi
+0002f310: 7665 6e20 7368 6f72 746e 616d 6527 2727  ven shortname'''
+0002f320: 0d0a 2020 2020 2020 2020 234b 6565 7020  ..        #Keep 
+0002f330: 7472 6163 6b20 6f66 2077 6865 7468 6572  track of whether
+0002f340: 2061 6e20 656c 656d 656e 7420 7761 7320   an element was 
+0002f350: 7061 7373 6564 2069 6e20 746f 2068 656c  passed in to hel
+0002f360: 7020 7769 7468 2064 6562 7567 6769 6e67  p with debugging
+0002f370: 0d0a 2020 2020 2020 2020 656c 656d 656e  ..        elemen
+0002f380: 745f 7761 735f 7061 7373 6564 5f69 6e3d  t_was_passed_in=
+0002f390: 4661 6c73 650d 0a0d 0a20 2020 2020 2020  False....       
+0002f3a0: 2023 4966 2061 6e20 656c 656d 656e 7420   #If an element 
+0002f3b0: 6861 7320 6265 656e 2070 6173 7365 6420  has been passed 
+0002f3c0: 696e 2c20 7573 6520 7468 6520 656c 656d  in, use the elem
+0002f3d0: 656e 7427 7320 7368 6f72 746e 616d 650d  ent's shortname.
+0002f3e0: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
+0002f3f0: 2020 2020 2020 2020 2020 2073 686f 7274             short
+0002f400: 6e61 6d65 3d73 686f 7274 6e61 6d65 2e73  name=shortname.s
+0002f410: 686f 7274 6e61 6d65 0d0a 2020 2020 2020  hortname..      
+0002f420: 2020 2020 2020 656c 656d 656e 745f 7761        element_wa
+0002f430: 735f 7061 7373 6564 5f69 6e3d 5472 7565  s_passed_in=True
+0002f440: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+0002f450: 2041 7474 7269 6275 7465 4572 726f 723a   AttributeError:
+0002f460: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+0002f470: 7373 0d0a 0d0a 2020 2020 2020 2020 2354  ss....        #T
+0002f480: 4f44 4f20 2d63 6865 636b 2074 6861 7420  ODO -check that 
+0002f490: 7368 6f72 746e 616d 6520 6973 206e 6f74  shortname is not
+0002f4a0: 204e 6f6e 650d 0a20 2020 2020 2020 2069   None..        i
+0002f4b0: 6620 7368 6f72 746e 616d 6520 6973 204e  f shortname is N
+0002f4c0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0002f4d0: 2020 2350 726f 6772 616d 6d69 6e67 2065    #Programming e
+0002f4e0: 7272 6f72 0d0a 2020 2020 2020 2020 2020  rror..          
+0002f4f0: 2020 6966 2065 6c65 6d65 6e74 5f77 6173    if element_was
+0002f500: 5f70 6173 7365 645f 696e 3a0d 0a20 2020  _passed_in:..   
+0002f510: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0002f520: 7365 2056 616c 7565 4572 726f 7228 2765  se ValueError('e
+0002f530: 6c65 6d65 6e74 2e73 686f 7274 6e61 6d65  lement.shortname
+0002f540: 206d 7573 7420 6861 7665 2061 2076 616c   must have a val
+0002f550: 7565 2e20 4e6f 6e65 2077 6173 2073 7570  ue. None was sup
+0002f560: 706c 6965 642e 2064 6562 7567 6769 6e67  plied. debugging
+0002f570: 2069 6e66 6f72 6d61 7469 6f6e 3a20 416e   information: An
+0002f580: 2075 7469 6c73 2e45 6c65 6d65 6e74 2069   utils.Element i
+0002f590: 6e73 7461 6e63 6520 7761 7320 7061 7373  nstance was pass
+0002f5a0: 6564 2069 6e20 6173 2074 6865 2073 686f  ed in as the sho
+0002f5b0: 7274 6e61 6d65 2070 6172 616d 6574 6572  rtname parameter
+0002f5c0: 2074 6f20 6675 6e63 7469 6f6e 2067 6574   to function get
+0002f5d0: 5f65 6c65 6d65 6e74 2829 2729 0d0a 2020  _element()')..  
+0002f5e0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+0002f5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002f600: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0002f610: 7228 2773 686f 7274 6e61 6d65 206d 7573  r('shortname mus
+0002f620: 7420 6861 7665 2061 2076 616c 7565 2e20  t have a value. 
+0002f630: 4e6f 6e65 2077 6173 2073 7570 706c 6965  None was supplie
+0002f640: 642e 2729 0d0a 2020 2020 2020 2020 7472  d.')..        tr
+0002f650: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+0002f660: 7368 6f72 746e 616d 653d 7368 6f72 746e  shortname=shortn
+0002f670: 616d 652e 7368 6f72 746e 616d 650d 0a20  ame.shortname.. 
+0002f680: 2020 2020 2020 2065 7863 6570 7420 4174         except At
+0002f690: 7472 6962 7574 6545 7272 6f72 3a0d 0a20  tributeError:.. 
+0002f6a0: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+0002f6b0: 0a0d 0a20 2020 2020 2020 2066 6f72 2068  ...        for h
+0002f6c0: 2069 6e20 7365 6c66 2e68 6965 7261 7263   in self.hierarc
+0002f6d0: 6869 6573 3a0d 0a20 2020 2020 2020 2020  hies:..         
+0002f6e0: 2020 2079 6965 6c64 2066 726f 6d20 682e     yield from h.
+0002f6f0: 6765 745f 656c 656d 656e 7473 2873 686f  get_elements(sho
+0002f700: 7274 6e61 6d65 290d 0a0d 0a20 2020 2064  rtname)....    d
+0002f710: 6566 2067 6574 5f65 6c65 6d65 6e74 7328  ef get_elements(
+0002f720: 7365 6c66 2c73 686f 7274 6e61 6d65 293a  self,shortname):
+0002f730: 0d0a 2020 2020 2020 2020 2727 2747 6574  ..        '''Get
+0002f740: 2061 6c6c 206f 6620 7468 6520 656c 656d   all of the elem
+0002f750: 656e 7473 2069 6e20 7468 6973 2073 7472  ents in this str
+0002f760: 7563 7475 7265 2077 6974 6820 7468 6520  ucture with the 
+0002f770: 6769 7665 6e20 7368 6f72 746e 616d 6527  given shortname'
+0002f780: 2727 0d0a 2020 2020 2020 2020 2350 594d  ''..        #PYM
+0002f790: 2d36 372c 2067 6574 5f65 6c65 6d65 6e74  -67, get_element
+0002f7a0: 7320 6f6e 2061 2068 6965 7261 7263 6879  s on a hierarchy
+0002f7b0: 2063 616e 2062 6520 696e 6465 7865 6420   can be indexed 
+0002f7c0: 2d20 7065 6f70 6c65 2061 7373 756d 6520  - people assume 
+0002f7d0: 7468 6520 7361 6d65 2066 6f72 2061 2073  the same for a s
+0002f7e0: 7472 7563 7475 7265 0d0a 2020 2020 2020  tructure..      
+0002f7f0: 2020 7265 7475 726e 206c 6973 7428 7365    return list(se
+0002f800: 6c66 2e5f 6765 745f 656c 656d 656e 7473  lf._get_elements
+0002f810: 5f67 656e 6572 6174 6f72 2873 686f 7274  _generator(short
+0002f820: 6e61 6d65 2929 0d0a 0d0a 2020 2020 6465  name))....    de
+0002f830: 6620 6765 745f 656c 656d 656e 7428 7365  f get_element(se
+0002f840: 6c66 2c73 686f 7274 6e61 6d65 293a 0d0a  lf,shortname):..
+0002f850: 2020 2020 2020 2020 2727 2744 6570 7265          '''Depre
+0002f860: 6361 7465 642c 2044 6f6e 2774 2075 7365  cated, Don't use
+0002f870: 2074 6869 7320 6675 6e63 7469 6f6e 2c20   this function, 
+0002f880: 596f 7520 7072 6f62 6162 6c79 2077 616e  You probably wan
+0002f890: 7420 2e67 6574 5f72 6f6f 745f 656c 656d  t .get_root_elem
+0002f8a0: 656e 7428 292c 2046 6169 6c69 6e67 2074  ent(), Failing t
+0002f8b0: 6861 7420 796f 7520 6d61 7920 7761 6e74  hat you may want
+0002f8c0: 202e 6765 745f 656c 656d 656e 7473 2827   .get_elements('
+0002f8d0: 736f 6d65 5f73 6e27 295b 305d 2e27 2727  some_sn')[0].'''
+0002f8e0: 0d0a 2020 2020 2020 2020 7261 6973 6520  ..        raise 
+0002f8f0: 5479 7065 4572 726f 7228 2244 6f6e 2774  TypeError("Don't
+0002f900: 2075 7365 2074 6869 7320 6675 6e63 7469   use this functi
+0002f910: 6f6e 2e20 596f 7520 7072 6f62 6162 6c79  on. You probably
+0002f920: 2077 616e 7420 6765 745f 726f 6f74 5f65   want get_root_e
+0002f930: 6c65 6d65 6e74 2e20 4661 696c 696e 6720  lement. Failing 
+0002f940: 7468 6174 2079 6f75 206d 6179 2077 616e  that you may wan
+0002f950: 7420 6765 745f 656c 656d 656e 7473 2229  t get_elements")
+0002f960: 0d0a 2020 2020 2020 2020 2354 6865 2069  ..        #The i
+0002f970: 7373 7565 2069 7320 7468 6174 2074 6865  ssue is that the
+0002f980: 7265 2063 616e 2062 6520 6d75 6c74 6970  re can be multip
+0002f990: 6c65 2053 7472 7563 7475 7265 456c 656d  le StructureElem
+0002f9a0: 656e 7473 2069 6e20 6120 6769 7665 6e20  ents in a given 
+0002f9b0: 7374 7275 6374 7572 6520 7769 7468 2074  structure with t
+0002f9c0: 6865 2073 616d 6520 7368 6f72 746e 616d  he same shortnam
+0002f9d0: 650d 0a0d 0a20 2020 2064 6566 2067 6574  e....    def get
+0002f9e0: 5f72 6f6f 745f 656c 656d 656e 7428 7365  _root_element(se
+0002f9f0: 6c66 2c73 686f 7274 6e61 6d65 293a 0d0a  lf,shortname):..
+0002fa00: 2020 2020 2020 2020 2727 2747 6574 2074          '''Get t
+0002fa10: 6865 2072 6f6f 7420 656c 656d 656e 7420  he root element 
+0002fa20: 696e 2074 6869 7320 7374 7275 6374 7572  in this structur
+0002fa30: 6520 7769 7468 2074 6865 2067 6976 656e  e with the given
+0002fa40: 2073 686f 7274 6e61 6d65 2727 270d 0a20   shortname'''.. 
+0002fa50: 2020 2020 2020 2023 4b65 6570 2074 7261         #Keep tra
+0002fa60: 636b 206f 6620 7768 6574 6865 7220 616e  ck of whether an
+0002fa70: 2065 6c65 6d65 6e74 2077 6173 2070 6173   element was pas
+0002fa80: 7365 6420 696e 2074 6f20 6865 6c70 2077  sed in to help w
+0002fa90: 6974 6820 6465 6275 6767 696e 670d 0a20  ith debugging.. 
+0002faa0: 2020 2020 2020 2065 6c65 6d65 6e74 5f77         element_w
+0002fab0: 6173 5f70 6173 7365 645f 696e 3d46 616c  as_passed_in=Fal
+0002fac0: 7365 0d0a 0d0a 2020 2020 2020 2020 2349  se....        #I
+0002fad0: 6620 616e 2065 6c65 6d65 6e74 2068 6173  f an element has
+0002fae0: 2062 6565 6e20 7061 7373 6564 2069 6e2c   been passed in,
+0002faf0: 2075 7365 2074 6865 2065 6c65 6d65 6e74   use the element
+0002fb00: 2773 2073 686f 7274 6e61 6d65 0d0a 2020  's shortname..  
+0002fb10: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+0002fb20: 2020 2020 2020 2020 7368 6f72 746e 616d          shortnam
+0002fb30: 653d 7368 6f72 746e 616d 652e 7368 6f72  e=shortname.shor
+0002fb40: 746e 616d 650d 0a20 2020 2020 2020 2020  tname..         
+0002fb50: 2020 2065 6c65 6d65 6e74 5f77 6173 5f70     element_was_p
+0002fb60: 6173 7365 645f 696e 3d54 7275 650d 0a20  assed_in=True.. 
+0002fb70: 2020 2020 2020 2065 7863 6570 7420 4174         except At
+0002fb80: 7472 6962 7574 6545 7272 6f72 3a0d 0a20  tributeError:.. 
+0002fb90: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+0002fba0: 0a0d 0a20 2020 2020 2020 2023 544f 444f  ...        #TODO
+0002fbb0: 202d 6368 6563 6b20 7468 6174 2073 686f   -check that sho
+0002fbc0: 7274 6e61 6d65 2069 7320 6e6f 7420 4e6f  rtname is not No
+0002fbd0: 6e65 0d0a 2020 2020 2020 2020 6966 2073  ne..        if s
+0002fbe0: 686f 7274 6e61 6d65 2069 7320 4e6f 6e65  hortname is None
+0002fbf0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+0002fc00: 5072 6f67 7261 6d6d 696e 6720 6572 726f  Programming erro
+0002fc10: 720d 0a20 2020 2020 2020 2020 2020 2069  r..            i
+0002fc20: 6620 656c 656d 656e 745f 7761 735f 7061  f element_was_pa
+0002fc30: 7373 6564 5f69 6e3a 0d0a 2020 2020 2020  ssed_in:..      
+0002fc40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0002fc50: 5661 6c75 6545 7272 6f72 2827 656c 656d  ValueError('elem
+0002fc60: 656e 742e 7368 6f72 746e 616d 6520 6d75  ent.shortname mu
+0002fc70: 7374 2068 6176 6520 6120 7661 6c75 652e  st have a value.
+0002fc80: 204e 6f6e 6520 7761 7320 7375 7070 6c69   None was suppli
+0002fc90: 6564 2e20 6465 6275 6767 696e 6720 696e  ed. debugging in
+0002fca0: 666f 726d 6174 696f 6e3a 2041 6e20 7574  formation: An ut
+0002fcb0: 696c 732e 456c 656d 656e 7420 696e 7374  ils.Element inst
+0002fcc0: 616e 6365 2077 6173 2070 6173 7365 6420  ance was passed 
+0002fcd0: 696e 2061 7320 7468 6520 7368 6f72 746e  in as the shortn
+0002fce0: 616d 6520 7061 7261 6d65 7465 7220 746f  ame parameter to
+0002fcf0: 2066 756e 6374 696f 6e20 6765 745f 726f   function get_ro
+0002fd00: 6f74 5f65 6c65 6d65 6e74 2829 2729 0d0a  ot_element()')..
+0002fd10: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0002fd20: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0002fd30: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+0002fd40: 726f 7228 2773 686f 7274 6e61 6d65 206d  ror('shortname m
+0002fd50: 7573 7420 6861 7665 2061 2076 616c 7565  ust have a value
+0002fd60: 2e20 4e6f 6e65 2077 6173 2073 7570 706c  . None was suppl
+0002fd70: 6965 642e 2729 0d0a 2020 2020 2020 2020  ied.')..        
+0002fd80: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0002fd90: 2020 7368 6f72 746e 616d 653d 7368 6f72    shortname=shor
+0002fda0: 746e 616d 652e 7368 6f72 746e 616d 650d  tname.shortname.
+0002fdb0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0002fdc0: 4174 7472 6962 7574 6545 7272 6f72 3a0d  AttributeError:.
+0002fdd0: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+0002fde0: 730d 0a0d 0a20 2020 2020 2020 2023 5265  s....        #Re
+0002fdf0: 7475 726e 2074 6865 2066 6972 7374 2072  turn the first r
+0002fe00: 6f6f 7420 656c 656d 656e 7420 7769 7468  oot element with
+0002fe10: 2074 6865 2067 6976 656e 2073 686f 7274   the given short
+0002fe20: 6e61 6d65 0d0a 2020 2020 2020 2020 666f  name..        fo
+0002fe30: 7220 7374 7275 6374 7572 655f 656c 656d  r structure_elem
+0002fe40: 656e 7420 696e 2073 656c 662e 6869 6572  ent in self.hier
+0002fe50: 6172 6368 6965 732e 7661 6c75 6573 2829  archies.values()
+0002fe60: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0002fe70: 6620 7374 7275 6374 7572 655f 656c 656d  f structure_elem
+0002fe80: 656e 742e 7368 6f72 746e 616d 6520 3d3d  ent.shortname ==
+0002fe90: 2073 686f 7274 6e61 6d65 3a0d 0a20 2020   shortname:..   
+0002fea0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0002feb0: 7572 6e20 7374 7275 6374 7572 655f 656c  urn structure_el
+0002fec0: 656d 656e 740d 0a0d 0a20 2020 2020 2020  ement....       
+0002fed0: 2072 6574 7572 6e20 4e6f 6e65 0d0a 0d0a   return None....
+0002fee0: 2020 2020 6465 6620 5f61 6464 5f65 6c65      def _add_ele
+0002fef0: 6d65 6e74 2873 656c 662c 7374 7275 6374  ment(self,struct
+0002ff00: 7572 655f 656c 656d 656e 7429 3a0d 0a20  ure_element):.. 
+0002ff10: 2020 2020 2020 2027 2727 4465 7072 6563         '''Deprec
+0002ff20: 6174 6564 2e20 4164 6420 616e 2065 6c65  ated. Add an ele
+0002ff30: 6d65 6e74 2074 6f20 7468 6520 7374 7275  ment to the stru
+0002ff40: 6374 7572 652c 2062 7574 2064 6f6e 2774  cture, but don't
+0002ff50: 2073 7065 6369 6679 2077 6865 7265 2e0d   specify where..
+0002ff60: 0a20 2020 2020 2020 2027 2727 0d0a 2020  .        '''..  
+0002ff70: 2020 2020 2020 6966 2073 7472 7563 7475        if structu
+0002ff80: 7265 5f65 6c65 6d65 6e74 2e69 735f 726f  re_element.is_ro
+0002ff90: 6f74 3a0d 0a20 2020 2020 2020 2020 2020  ot:..           
+0002ffa0: 2073 656c 662e 5f68 6965 7261 7263 6869   self._hierarchi
+0002ffb0: 6573 2e61 7070 656e 6428 7374 7275 6374  es.append(struct
+0002ffc0: 7572 655f 656c 656d 656e 7429 0d0a 0d0a  ure_element)....
+0002ffd0: 0d0a 2020 2020 2020 2020 6966 2073 7472  ..        if str
+0002ffe0: 7563 7475 7265 5f65 6c65 6d65 6e74 2e73  ucture_element.s
+0002fff0: 7472 7563 7475 7265 2069 7320 4e6f 6e65  tructure is None
+00030000: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+00030010: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+00030020: 2e73 7472 7563 7475 7265 203d 2073 656c  .structure = sel
+00030030: 660d 0a0d 0a20 2020 2020 2020 206c 6f67  f....        log
+00030040: 2e64 6562 7567 2827 4164 6465 6420 5374  .debug('Added St
+00030050: 7275 6374 7572 6545 6c65 6d65 6e74 2027  ructureElement '
+00030060: 2b73 7472 7563 7475 7265 5f65 6c65 6d65  +structure_eleme
+00030070: 6e74 2e73 686f 7274 6e61 6d65 2b27 2074  nt.shortname+' t
+00030080: 6f20 5374 7275 6374 7572 6527 290d 0a0d  o Structure')...
+00030090: 0a20 2020 2064 6566 205f 7265 6d6f 7665  .    def _remove
+000300a0: 5f65 6c65 6d65 6e74 2873 656c 662c 7374  _element(self,st
+000300b0: 7275 6374 7572 655f 656c 656d 656e 7429  ructure_element)
+000300c0: 3a0d 0a20 2020 2020 2020 2027 2727 4465  :..        '''De
+000300d0: 7072 6563 6174 6564 2e0d 0a20 2020 2020  precated...     
+000300e0: 2020 2052 656d 6f76 6520 6120 5374 7275     Remove a Stru
+000300f0: 6374 7572 6545 6c65 6d65 6e74 2069 6e20  ctureElement in 
+00030100: 7468 6973 2053 7472 7563 7475 7265 2066  this Structure f
+00030110: 726f 6d20 6974 7320 7061 7265 6e74 0d0a  rom its parent..
+00030120: 0d0a 2020 2020 2020 2020 5374 7275 6374  ..        Struct
+00030130: 7572 6545 6c65 6d65 6e74 2e63 7574 2829  ureElement.cut()
+00030140: 2064 6f65 7320 7468 6520 7361 6d65 2c20   does the same, 
+00030150: 616e 6420 7265 7475 726e 7320 7468 6520  and returns the 
+00030160: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+00030170: 2074 6f20 6265 2075 7365 6420 656c 7365   to be used else
+00030180: 7768 6572 652e 0d0a 2020 2020 2020 2020  where...        
+00030190: 2727 270d 0a20 2020 2020 2020 2069 6620  '''..        if 
+000301a0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+000301b0: 742e 6973 5f72 6f6f 743a 0d0a 2020 2020  t.is_root:..    
+000301c0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
+000301d0: 7065 4572 726f 7228 2243 616e 2774 2072  peError("Can't r
+000301e0: 656d 6f76 6520 7468 6520 726f 6f74 2065  emove the root e
+000301f0: 6c65 6d65 6e74 2e20 4368 616e 6765 2074  lement. Change t
+00030200: 6865 2072 6f6f 7420 656c 656d 656e 7420  he root element 
+00030210: 6966 2079 6f75 206e 6565 6420 746f 2072  if you need to r
+00030220: 656d 6f76 6520 7468 6973 2065 6c65 6d65  emove this eleme
+00030230: 6e74 2229 0d0a 2020 2020 2020 2020 656c  nt")..        el
+00030240: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00030250: 2073 7472 7563 7475 7265 5f65 6c65 6d65   structure_eleme
+00030260: 6e74 2e70 6172 656e 742e 7265 6d6f 7665  nt.parent.remove
+00030270: 5f63 6869 6c64 2873 7472 7563 7475 7265  _child(structure
+00030280: 5f65 6c65 6d65 6e74 290d 0a0d 0a20 2020  _element)....   
+00030290: 2064 6566 205f 7365 745f 736f 7274 5f66   def _set_sort_f
+000302a0: 756e 6374 696f 6e28 7365 6c66 2c73 6f72  unction(self,sor
+000302b0: 745f 6675 6e63 7469 6f6e 293a 0d0a 2020  t_function):..  
+000302c0: 2020 2020 2020 2727 2744 6570 7265 6361        '''Depreca
+000302d0: 7465 642e 2054 6865 2073 6f72 7420 6675  ted. The sort fu
+000302e0: 6e63 7469 6f6e 2069 7320 6e6f 206c 6f6e  nction is no lon
+000302f0: 6765 7220 7573 6564 2727 270d 0a20 2020  ger used'''..   
+00030300: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+00030310: 7272 6f72 2822 446f 6e27 7420 7573 6520  rror("Don't use 
+00030320: 7468 6973 2066 756e 6374 696f 6e2e 2053  this function. S
+00030330: 6574 2074 6865 2073 6f72 7420 6675 6e63  et the sort func
+00030340: 7469 6f6e 206f 6e20 7468 6520 5374 7275  tion on the Stru
+00030350: 6374 7572 6545 6c65 6d65 6e74 2069 6e73  ctureElement ins
+00030360: 7465 6164 2229 0d0a 0d0a 2020 2020 4070  tead")....    @p
+00030370: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+00030380: 2064 6573 6365 6e64 616e 7473 2873 656c   descendants(sel
+00030390: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
+000303a0: 4465 7072 6563 6174 6564 2c20 446f 6e27  Deprecated, Don'
+000303b0: 7420 7573 6520 7468 6973 2066 756e 6374  t use this funct
+000303c0: 696f 6e2c 2054 6f20 7669 7369 7420 616c  ion, To visit al
+000303d0: 6c20 6f66 2074 6865 2064 6573 6365 6e64  l of the descend
+000303e0: 616e 7473 2c20 7369 6d70 6c79 2075 7365  ants, simply use
+000303f0: 202e 7761 6c6b 2829 0d0a 2020 2020 2020   .walk()..      
+00030400: 2020 2727 270d 0a20 2020 2020 2020 2072    '''..        r
+00030410: 6574 7572 6e20 7365 6c66 2e5f 6465 7363  eturn self._desc
+00030420: 656e 6461 6e74 730d 0a0d 0a20 2020 2023  endants....    #
+00030430: 4070 726f 7065 7274 790d 0a20 2020 2023  @property..    #
+00030440: 6465 6620 6465 7363 656e 6461 6e74 2873  def descendant(s
+00030450: 656c 662c 6974 656d 293a 0d0a 2020 2020  elf,item):..    
+00030460: 2320 2020 2072 6574 7572 6e20 7365 6c66  #    return self
+00030470: 2e64 6573 6365 6e64 616e 7473 5b69 7465  .descendants[ite
+00030480: 6d5d 5b30 5d0d 0a0d 0a0d 0a20 2020 2040  m][0]......    @
+00030490: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+000304a0: 6620 656c 656d 656e 7473 2873 656c 6629  f elements(self)
+000304b0: 3a0d 0a20 2020 2020 2020 2027 2727 4465  :..        '''De
+000304c0: 7072 6563 6174 6564 2e20 446f 6e27 7420  precated. Don't 
+000304d0: 7573 6520 7468 6973 2066 756e 6374 696f  use this functio
+000304e0: 6e20 2d20 7573 6520 7761 6c6b 2829 2069  n - use walk() i
+000304f0: 6e73 7465 6164 2727 270d 0a20 2020 2020  nstead'''..     
+00030500: 2020 2023 656c 656d 656e 7473 2073 6f75     #elements sou
+00030510: 6e64 7320 6c69 6b65 2061 2064 6963 7469  nds like a dicti
+00030520: 6f6e 6172 7920 2875 7365 2067 6574 5f65  onary (use get_e
+00030530: 6c65 6d65 6e74 7320 746f 2064 6f20 7468  lements to do th
+00030540: 6174 2920 6f72 2061 206c 6973 7420 2875  at) or a list (u
+00030550: 7365 2077 616c 6b20 656c 656d 656e 7473  se walk elements
+00030560: 2066 6f72 2074 6861 7429 290d 0a20 2020   for that))..   
+00030570: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+00030580: 7272 6f72 2822 446f 6e27 7420 7573 6520  rror("Don't use 
+00030590: 7468 6973 2066 756e 6374 696f 6e20 2d20  this function - 
+000305a0: 7573 6520 7761 6c6b 2829 2069 6e73 7465  use walk() inste
+000305b0: 6164 2229 0d0a 0d0a 2020 2020 4070 726f  ad")....    @pro
+000305c0: 7065 7274 790d 0a20 2020 2064 6566 2072  perty..    def r
+000305d0: 6f6f 745f 656c 656d 656e 7473 2873 656c  oot_elements(sel
+000305e0: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
+000305f0: 4974 6572 6174 6520 6f76 6572 2061 6c6c  Iterate over all
+00030600: 206f 6620 7468 6520 6869 6572 6172 6368   of the hierarch
+00030610: 6965 7320 2872 6f6f 7420 6c65 7665 6c20  ies (root level 
+00030620: 7374 7275 6374 7572 6520 656c 656d 656e  structure elemen
+00030630: 7473 2920 696e 2074 7572 6e2e 0d0a 0d0a  ts) in turn.....
+00030640: 2020 2020 2020 2020 5468 6973 2070 726f          This pro
+00030650: 7072 7479 2064 6f65 7320 6e6f 7420 6465  prty does not de
+00030660: 7363 656e 6420 696e 746f 2074 686f 7365  scend into those
+00030670: 2068 6965 7261 7263 6869 6573 202d 2075   hierarchies - u
+00030680: 7365 202e 7761 6c6b 2829 2074 6f20 646f  se .walk() to do
+00030690: 2074 6861 742e 0d0a 0d0a 2020 2020 2020   that.....      
+000306a0: 2020 446f 6573 2074 6865 2073 616d 6520    Does the same 
+000306b0: 7468 696e 6720 6173 202e 6869 6572 6172  thing as .hierar
+000306c0: 6368 6965 732e 7661 6c75 6573 2829 0d0a  chies.values()..
+000306d0: 2020 2020 2020 2020 2727 270d 0a20 2020          '''..   
+000306e0: 2020 2020 2066 6f72 2065 2069 6e20 7365       for e in se
+000306f0: 6c66 2e68 6965 7261 7263 6869 6573 2e76  lf.hierarchies.v
+00030700: 616c 7565 7328 293a 0d0a 2020 2020 2020  alues():..      
+00030710: 2020 2020 2020 7969 656c 6420 650d 0a0d        yield e...
+00030720: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+00030730: 2020 2020 6465 6620 7368 6f72 7463 6f64      def shortcod
+00030740: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
+00030750: 2020 2727 2754 6865 2073 686f 7274 6e61    '''The shortna
+00030760: 6d65 2066 6f72 2074 6869 7320 5374 7275  me for this Stru
+00030770: 6374 7572 652e 2053 796e 6f6e 796d 2066  cture. Synonym f
+00030780: 6f72 202e 7368 6f72 746e 616d 6527 2727  or .shortname'''
+00030790: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000307a0: 2073 656c 662e 5f73 686f 7274 6e61 6d65   self._shortname
+000307b0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+000307c0: 790d 0a20 2020 2064 6566 2073 686f 7274  y..    def short
+000307d0: 6e61 6d65 2873 656c 6629 3a0d 0a20 2020  name(self):..   
+000307e0: 2020 2020 2027 2727 5468 6520 7368 6f72       '''The shor
+000307f0: 746e 616d 6520 666f 7220 7468 6973 2053  tname for this S
+00030800: 7472 7563 7475 7265 2e27 2727 0d0a 2020  tructure.'''..  
+00030810: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00030820: 662e 5f73 686f 7274 6e61 6d65 0d0a 0d0a  f._shortname....
+00030830: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+00030840: 2020 2064 6566 206c 6f6e 676e 616d 6528     def longname(
+00030850: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00030860: 2727 2754 6865 206c 6f6e 676e 616d 6520  '''The longname 
+00030870: 666f 7220 7468 6973 2053 7472 7563 7475  for this Structu
+00030880: 7265 2e27 2727 0d0a 2020 2020 2020 2020  re.'''..        
+00030890: 7265 7475 726e 2073 656c 662e 5f6c 6f6e  return self._lon
+000308a0: 676e 616d 650d 0a0d 0a20 2020 2040 6c6f  gname....    @lo
+000308b0: 6e67 6e61 6d65 2e73 6574 7465 720d 0a20  ngname.setter.. 
+000308c0: 2020 2064 6566 206c 6f6e 676e 616d 6528     def longname(
+000308d0: 7365 6c66 2c76 616c 293a 0d0a 2020 2020  self,val):..    
+000308e0: 2020 2020 7365 6c66 2e5f 6c6f 6e67 6e61      self._longna
+000308f0: 6d65 203d 2076 616c 0d0a 0d0a 2020 2020  me = val....    
+00030900: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
+00030910: 6566 2064 6573 6372 6970 7469 6f6e 2873  ef description(s
+00030920: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
+00030930: 2727 5468 6520 456d 706f 7765 7220 6465  ''The Empower de
+00030940: 7363 7269 7074 696f 6e20 666f 7220 7468  scription for th
+00030950: 6973 2053 7472 7563 7475 7265 2e27 2727  is Structure.'''
+00030960: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
+00030970: 726e 2073 656c 662e 5f64 6573 6372 6970  rn self._descrip
+00030980: 7469 6f6e 0d0a 0d0a 2020 2020 4064 6573  tion....    @des
+00030990: 6372 6970 7469 6f6e 2e73 6574 7465 720d  cription.setter.
+000309a0: 0a20 2020 2064 6566 2064 6573 6372 6970  .    def descrip
+000309b0: 7469 6f6e 2873 656c 662c 7661 6c29 3a0d  tion(self,val):.
+000309c0: 0a20 2020 2020 2020 2027 2727 5468 6520  .        '''The 
+000309d0: 6465 7363 7269 7074 696f 6e20 666f 7220  description for 
+000309e0: 7468 6973 2053 7472 7563 7475 7265 2e27  this Structure.'
+000309f0: 2727 0d0a 2020 2020 2020 2020 7365 6c66  ''..        self
+00030a00: 2e5f 6465 7363 7269 7074 696f 6e20 3d20  ._description = 
+00030a10: 7661 6c0d 0a0d 0a20 2020 2064 6566 2061  val....    def a
+00030a20: 6464 5f63 6869 6c64 5f65 6c65 6d65 6e74  dd_child_element
+00030a30: 5f70 6172 656e 7428 7365 6c66 2c63 6869  _parent(self,chi
+00030a40: 6c64 2c70 6172 656e 7429 3a0d 0a20 2020  ld,parent):..   
+00030a50: 2020 2020 2027 2727 4164 6420 7468 6520       '''Add the 
+00030a60: 6368 696c 6420 656c 656d 656e 7420 746f  child element to
+00030a70: 2068 6176 6520 6120 6769 7665 6e20 7061   have a given pa
+00030a80: 7265 6e74 2e20 5468 6973 2069 7320 7468  rent. This is th
+00030a90: 6520 6f6e 6520 7761 7920 7765 2063 616e  e one way we can
+00030aa0: 2073 6574 2065 6c65 6d65 6e74 7320 696e   set elements in
+00030ab0: 2061 2073 7472 7563 7475 7265 2e0d 0a0d   a structure....
+00030ac0: 0a20 2020 2020 2020 2041 206d 6f72 6520  .        A more 
+00030ad0: 636f 6d6d 6f6e 2077 6179 2028 616e 6420  common way (and 
+00030ae0: 7468 6520 7072 6566 6572 7265 6420 7761  the preferred wa
+00030af0: 7929 2074 6f20 7365 7420 6120 6368 696c  y) to set a chil
+00030b00: 6420 656c 656d 656e 7420 776f 756c 6420  d element would 
+00030b10: 6265 2074 6f20 7573 6520 7468 6520 5374  be to use the St
+00030b20: 7275 6374 7572 6545 6c65 6d65 6e74 2064  ructureElement d
+00030b30: 6972 6563 746c 7920 7573 696e 6720 5374  irectly using St
+00030b40: 7275 6374 7572 6545 6c65 6d65 6e74 2e63  ructureElement.c
+00030b50: 6869 6c64 7265 6e20 2e0d 0a0d 0a20 2020  hildren .....   
+00030b60: 2020 2020 203a 7061 7261 6d20 6368 696c       :param chil
+00030b70: 643a 2043 6869 6c64 2065 6c65 6d65 6e74  d: Child element
+00030b80: 2e20 5374 7275 6374 7572 6545 6c65 6d65  . StructureEleme
+00030b90: 6e74 0d0a 2020 2020 2020 2020 3a70 6172  nt..        :par
+00030ba0: 616d 2070 6172 656e 743a 2050 6172 656e  am parent: Paren
+00030bb0: 7420 656c 656d 656e 742e 2053 7472 7563  t element. Struc
+00030bc0: 7475 7265 456c 656d 656e 740d 0a20 2020  tureElement..   
+00030bd0: 2020 2020 2027 2727 0d0a 0d0a 2020 2020       '''....    
+00030be0: 2020 2020 6966 2063 6869 6c64 2069 7320      if child is 
+00030bf0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00030c00: 2020 2023 5072 6f67 7261 6d6d 696e 6720     #Programming 
+00030c10: 6572 726f 720d 0a20 2020 2020 2020 2020  error..         
+00030c20: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00030c30: 726f 7228 2763 6869 6c64 2069 7320 4e6f  ror('child is No
+00030c40: 6e65 2e20 4368 696c 6420 7368 6f75 6c64  ne. Child should
+00030c50: 2062 6520 6120 7661 6c69 6420 5374 7275   be a valid Stru
+00030c60: 6374 7572 6545 6c65 6d65 6e74 2729 0d0a  ctureElement')..
+00030c70: 0d0a 2020 2020 2020 2020 6368 696c 645f  ..        child_
+00030c80: 656c 656d 656e 743d 6368 696c 640d 0a20  element=child.. 
+00030c90: 2020 2020 2020 2070 6172 656e 745f 656c         parent_el
+00030ca0: 656d 656e 743d 7061 7265 6e74 0d0a 0d0a  ement=parent....
+00030cb0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00030cc0: 2020 2020 2020 2020 2020 6368 696c 645f            child_
+00030cd0: 656c 656d 656e 742e 6164 645f 7061 7265  element.add_pare
+00030ce0: 6e74 2870 6172 656e 745f 656c 656d 656e  nt(parent_elemen
+00030cf0: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+00030d00: 6966 2063 6869 6c64 5f65 6c65 6d65 6e74  if child_element
+00030d10: 2e70 6172 656e 7420 6973 206e 6f74 204e  .parent is not N
+00030d20: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00030d30: 2020 2020 2020 6c6f 672e 7665 7262 6f73        log.verbos
+00030d40: 6528 6368 696c 645f 656c 656d 656e 742e  e(child_element.
+00030d50: 7368 6f72 746e 616d 6520 2b20 272d 3e27  shortname + '->'
+00030d60: 202b 2073 7472 2863 6869 6c64 5f65 6c65   + str(child_ele
+00030d70: 6d65 6e74 2e70 6172 656e 742e 7368 6f72  ment.parent.shor
+00030d80: 746e 616d 6529 290d 0a20 2020 2020 2020  tname))..       
+00030d90: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00030da0: 2020 2020 2020 2020 2020 2020 6c6f 672e              log.
+00030db0: 7665 7262 6f73 6528 6368 696c 645f 656c  verbose(child_el
+00030dc0: 656d 656e 742e 7368 6f72 746e 616d 6520  ement.shortname 
+00030dd0: 2b20 272d 3e4e 6f6e 6527 290d 0a0d 0a20  + '->None').... 
+00030de0: 2020 2020 2020 2065 7863 6570 7420 4174         except At
+00030df0: 7472 6962 7574 6545 7272 6f72 2061 7320  tributeError as 
+00030e00: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00030e10: 6c6f 672e 6572 726f 7228 2743 6f75 6c64  log.error('Could
+00030e20: 206e 6f74 2066 696e 6420 7468 6520 6368   not find the ch
+00030e30: 696c 645f 656c 656d 656e 7420 696e 2074  ild_element in t
+00030e40: 6865 2068 6965 7261 7263 6879 3a27 2b73  he hierarchy:'+s
+00030e50: 7472 2863 6869 6c64 5f65 6c65 6d65 6e74  tr(child_element
+00030e60: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00030e70: 7261 6973 6520 6d70 6578 2e43 6f6d 706c  raise mpex.Compl
+00030e80: 6574 656c 794c 6f67 6765 6445 7272 6f72  etelyLoggedError
+00030e90: 2865 290d 0a0d 0a20 2020 2064 6566 2073  (e)....    def s
+00030ea0: 6574 5f63 6869 6c64 5f65 6c65 6d65 6e74  et_child_element
+00030eb0: 5f70 6172 656e 7428 7365 6c66 2c63 6869  _parent(self,chi
+00030ec0: 6c64 2c70 6172 656e 7429 3a0d 0a20 2020  ld,parent):..   
+00030ed0: 2020 2020 2027 2727 5379 6e6f 6e79 6d20       '''Synonym 
+00030ee0: 666f 7220 6164 645f 6368 696c 645f 656c  for add_child_el
+00030ef0: 656d 656e 745f 7061 7265 6e74 2829 0d0a  ement_parent()..
+00030f00: 2020 2020 2020 2020 5468 6973 2066 756e          This fun
+00030f10: 6374 696f 6e20 7769 6c6c 2062 6520 6465  ction will be de
+00030f20: 7072 6563 6174 6564 2069 6e20 6120 6675  precated in a fu
+00030f30: 7475 7265 2072 656c 6561 7365 206f 6620  ture release of 
+00030f40: 7079 6d70 780d 0a20 2020 2020 2020 2027  pympx..        '
+00030f50: 2727 0d0a 0d0a 2020 2020 2020 2020 6966  ''....        if
+00030f60: 2063 6869 6c64 2069 7320 4e6f 6e65 3a0d   child is None:.
+00030f70: 0a20 2020 2020 2020 2020 2020 2023 5072  .            #Pr
+00030f80: 6f67 7261 6d6d 696e 6720 6572 726f 720d  ogramming error.
+00030f90: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00030fa0: 7365 2056 616c 7565 4572 726f 7228 2763  se ValueError('c
+00030fb0: 6869 6c64 2069 7320 4e6f 6e65 2e20 4368  hild is None. Ch
+00030fc0: 696c 6420 7368 6f75 6c64 2062 6520 6120  ild should be a 
+00030fd0: 7661 6c69 6420 656c 656d 656e 7420 7368  valid element sh
+00030fe0: 6f72 746e 616d 6527 290d 0a0d 0a20 2020  ortname')....   
+00030ff0: 2020 2020 2063 6869 6c64 5f65 6c65 6d65       child_eleme
+00031000: 6e74 3d63 6869 6c64 0d0a 2020 2020 2020  nt=child..      
+00031010: 2020 7061 7265 6e74 5f65 6c65 6d65 6e74    parent_element
+00031020: 3d70 6172 656e 740d 0a0d 0a20 2020 2020  =parent....     
+00031030: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00031040: 2020 2020 2063 6869 6c64 5f65 6c65 6d65       child_eleme
+00031050: 6e74 2e73 6574 5f70 6172 656e 7428 7061  nt.set_parent(pa
+00031060: 7265 6e74 5f65 6c65 6d65 6e74 290d 0a20  rent_element).. 
+00031070: 2020 2020 2020 2020 2020 2069 6620 6368             if ch
+00031080: 696c 645f 656c 656d 656e 742e 7061 7265  ild_element.pare
+00031090: 6e74 2069 7320 6e6f 7420 4e6f 6e65 3a0d  nt is not None:.
+000310a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000310b0: 206c 6f67 2e76 6572 626f 7365 2863 6869   log.verbose(chi
+000310c0: 6c64 5f65 6c65 6d65 6e74 2e73 686f 7274  ld_element.short
+000310d0: 6e61 6d65 202b 2027 2d3e 2720 2b20 7374  name + '->' + st
+000310e0: 7228 6368 696c 645f 656c 656d 656e 742e  r(child_element.
+000310f0: 7061 7265 6e74 2e73 686f 7274 6e61 6d65  parent.shortname
+00031100: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00031110: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00031120: 2020 2020 2020 206c 6f67 2e76 6572 626f         log.verbo
+00031130: 7365 2863 6869 6c64 5f65 6c65 6d65 6e74  se(child_element
+00031140: 2e73 686f 7274 6e61 6d65 202b 2027 2d3e  .shortname + '->
+00031150: 4e6f 6e65 2729 0d0a 0d0a 2020 2020 2020  None')....      
+00031160: 2020 6578 6365 7074 2041 7474 7269 6275    except Attribu
+00031170: 7465 4572 726f 7220 6173 2065 3a0d 0a20  teError as e:.. 
+00031180: 2020 2020 2020 2020 2020 2023 5072 6f67             #Prog
+00031190: 7261 6d6d 696e 6720 4572 726f 720d 0a20  ramming Error.. 
+000311a0: 2020 2020 2020 2020 2020 206c 6f67 2e65             log.e
+000311b0: 7272 6f72 2827 436f 756c 6420 6e6f 7420  rror('Could not 
+000311c0: 6669 6e64 2074 6865 2063 6869 6c64 5f65  find the child_e
+000311d0: 6c65 6d65 6e74 2069 6e20 7468 6520 6869  lement in the hi
+000311e0: 6572 6172 6368 793a 272b 7374 7228 6368  erarchy:'+str(ch
+000311f0: 696c 645f 656c 656d 656e 7429 290d 0a20  ild_element)).. 
+00031200: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00031210: 2065 0d0a 0d0a 2020 2020 6465 6620 7761   e....    def wa
+00031220: 6c6b 5f65 6c65 6d65 6e74 7328 7365 6c66  lk_elements(self
+00031230: 293a 0d0a 2020 2020 2020 2020 2727 2744  ):..        '''D
+00031240: 6570 7265 6361 7465 642c 2055 7365 202e  eprecated, Use .
+00031250: 7761 6c6b 2829 2069 6e73 7465 6164 2e27  walk() instead.'
+00031260: 2727 0d0a 2020 2020 2020 2020 7969 656c  ''..        yiel
+00031270: 6420 6672 6f6d 2073 656c 662e 7761 6c6b  d from self.walk
+00031280: 2829 0d0a 0d0a 2020 2020 6465 6620 7761  ()....    def wa
+00031290: 6c6b 2873 656c 6629 3a0d 0a20 2020 2020  lk(self):..     
+000312a0: 2020 2027 2727 5374 6570 2074 6872 6f75     '''Step throu
+000312b0: 6768 2065 7665 7279 2065 6c65 6d65 6e74  gh every element
+000312c0: 2069 6e20 7468 6520 7374 7275 6374 7572   in the structur
+000312d0: 6520 696e 2074 7572 6e2e 2053 7461 7274  e in turn. Start
+000312e0: 2077 6974 6820 7468 6520 6669 7273 7420   with the first 
+000312f0: 726f 6f74 2065 6c65 6d65 6e74 2061 6e64  root element and
+00031300: 2077 616c 6b20 7472 756e 6b20 746f 206c   walk trunk to l
+00031310: 6561 662c 2061 6e64 2074 6865 6e20 6f6e  eaf, and then on
+00031320: 2074 6f20 6e65 7874 206c 6561 660d 0a20   to next leaf.. 
+00031330: 2020 2020 2020 2059 6965 6c64 2065 6c65         Yield ele
+00031340: 6d65 6e74 7320 6173 2074 6865 2077 616c  ments as the wal
+00031350: 6b20 676f 6573 206f 6e2e 0d0a 2020 2020  k goes on...    
+00031360: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
+00031370: 2066 6f72 2065 2069 6e20 6c69 7374 2873   for e in list(s
+00031380: 656c 662e 726f 6f74 5f65 6c65 6d65 6e74  elf.root_element
+00031390: 7329 3a0d 0a20 2020 2020 2020 2020 2020  s):..           
+000313a0: 2079 6965 6c64 2066 726f 6d20 652e 7761   yield from e.wa
+000313b0: 6c6b 2870 6572 6d69 7373 6976 653d 4661  lk(permissive=Fa
+000313c0: 6c73 6529 0d0a 0d0a 2020 2020 6465 6620  lse)....    def 
+000313d0: 7072 696e 745f 6869 6572 6172 6368 7928  print_hierarchy(
+000313e0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+000313f0: 2727 2744 6570 7265 6361 7465 642c 2055  '''Deprecated, U
+00031400: 7365 2074 6865 2070 7974 686f 6e20 7072  se the python pr
+00031410: 696e 7428 2920 6675 6e63 7469 6f6e 2069  int() function i
+00031420: 6e73 7465 6164 2e0d 0a20 2020 2020 2020  nstead...       
+00031430: 2050 7269 6e74 7320 6f75 7420 7468 6520   Prints out the 
+00031440: 5374 7275 6374 7572 6520 696e 2074 6578  Structure in tex
+00031450: 7420 666f 726d 2e0d 0a0d 0a20 2020 2020  t form.....     
+00031460: 2020 203e 3e3e 2070 7269 6e74 2873 6974     >>> print(sit
+00031470: 652e 6469 6d65 6e73 696f 6e73 5b30 5d2e  e.dimensions[0].
+00031480: 7374 7275 6374 7572 6573 5b27 5350 414d  structures['SPAM
+00031490: 275d 290d 0a20 2020 2020 2020 2053 5041  '])..        SPA
+000314a0: 4d0d 0a20 2020 2020 2020 202b 2d45 4747  M..        +-EGG
+000314b0: 530d 0a20 2020 2020 2020 2020 202b 2d42  S..          +-B
+000314c0: 4143 4f4e 0d0a 2020 2020 2020 2020 2727  ACON..        ''
+000314d0: 270d 0a20 2020 2020 2020 2066 6f72 2065  '..        for e
+000314e0: 2069 6e20 6c69 7374 2873 656c 662e 726f   in list(self.ro
+000314f0: 6f74 5f65 6c65 6d65 6e74 7329 3a0d 0a20  ot_elements):.. 
+00031500: 2020 2020 2020 2020 2020 2065 2e70 7269             e.pri
+00031510: 6e74 5f68 6965 7261 7263 6879 2829 0d0a  nt_hierarchy()..
+00031520: 0d0a 2020 2020 6465 6620 7379 6e63 6872  ..    def synchr
+00031530: 6f6e 6973 6528 7365 6c66 293a 0d0a 2020  onise(self):..  
+00031540: 2020 2020 2020 2727 2753 796e 6368 726f        '''Synchro
+00031550: 6e69 7365 2074 6869 7320 7374 7275 6374  nise this struct
+00031560: 7572 6520 7769 7468 2074 6865 2045 6d70  ure with the Emp
+00031570: 6f77 6572 2073 6974 652e 0d0a 2020 2020  ower site...    
+00031580: 2020 2020 4368 616e 6765 7320 6d61 6465      Changes made
+00031590: 2074 6f20 7468 6973 2073 7472 7563 7475   to this structu
+000315a0: 7265 2077 696c 6c20 6265 2077 7269 7474  re will be writt
+000315b0: 656e 2062 6163 6b20 746f 2074 6865 2045  en back to the E
+000315c0: 6d70 6f77 6572 2073 6974 6520 7468 6174  mpower site that
+000315d0: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
+000315e0: 6265 6c6f 6e67 7320 746f 2e0d 0a20 2020  belongs to...   
+000315f0: 2020 2020 2027 2727 0d0a 0d0a 2020 2020       '''....    
+00031600: 2020 2020 2364 6562 7567 2066 6c61 6720      #debug flag 
+00031610: 6465 7465 726d 696e 6573 2077 6865 7468  determines wheth
+00031620: 6572 2077 6520 7769 7368 2074 6f20 7361  er we wish to sa
+00031630: 7665 2074 6f20 6669 6c65 2069 6e20 6f72  ve to file in or
+00031640: 6465 7220 746f 2064 6562 7567 2077 6861  der to debug wha
+00031650: 7420 6861 7320 676f 6e65 2077 726f 6e67  t has gone wrong
+00031660: 2077 6968 2061 6e20 696d 706f 7274 0d0a   wih an import..
+00031670: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
+00031680: 7365 6c66 2e64 696d 656e 7369 6f6e 2e73  self.dimension.s
+00031690: 6974 652e 5f64 6562 7567 0d0a 0d0a 2020  ite._debug....  
+000316a0: 2020 2020 2020 2349 6e20 6465 6275 6720        #In debug 
+000316b0: 6d6f 6465 2c20 7772 6974 6520 7468 6520  mode, write the 
+000316c0: 6f75 7470 7574 2065 6c65 6d65 6e74 7320  output elements 
+000316d0: 746f 2061 2077 6f72 6b69 6e67 2066 696c  to a working fil
+000316e0: 6520 666f 7220 696d 706f 7274 696e 6720  e for importing 
+000316f0: 696e 746f 2065 6d70 6f77 6572 0d0a 2020  into empower..  
+00031700: 2020 2020 2020 6966 2064 6562 7567 3a0d        if debug:.
+00031710: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00031720: 2064 6972 2069 6e20 5b73 656c 662e 6469   dir in [self.di
+00031730: 6d65 6e73 696f 6e2e 7369 7465 2e5f 656d  mension.site._em
+00031740: 706f 7765 725f 6469 6d5f 696d 706f 7274  power_dim_import
+00031750: 5f64 6972 5d3a 0d0a 0d0a 2020 2020 2020  _dir]:....      
+00031760: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
+00031770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031780: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
+00031790: 6469 7229 0d0a 2020 2020 2020 2020 2020  dir)..          
+000317a0: 2020 2020 2020 6578 6365 7074 2046 696c        except Fil
+000317b0: 6545 7869 7374 7345 7272 6f72 3a0d 0a20  eExistsError:.. 
+000317c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000317d0: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
+000317e0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+000317f0: 4f53 4572 726f 7220 6173 2065 3a0d 0a20  OSError as e:.. 
 00031800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031810: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00031820: 6545 7272 6f72 2827 4469 7265 6374 6f72  eError('Director
-00031830: 7920 227b 7d22 2068 6173 2061 6e20 696e  y "{}" has an in
-00031840: 7661 6c69 6420 6e61 6d65 2e20 4469 6420  valid name. Did 
-00031850: 796f 7520 7061 7373 2061 2073 6974 655f  you pass a site_
-00031860: 6c6f 6361 746f 7220 7061 7468 2022 7b7d  locator path "{}
-00031870: 2220 7769 7468 6f75 7420 646f 7562 6c65  " without double
-00031880: 2d65 7363 6170 696e 6720 6261 636b 736c  -escaping backsl
-00031890: 6173 6865 7320 6f72 2070 7265 6669 7869  ashes or prefixi
-000318a0: 6e67 2074 6865 2073 7472 696e 6720 7769  ng the string wi
-000318b0: 7468 2061 6e20 2272 2220 666f 7220 7261  th an "r" for ra
-000318c0: 773f 272e 666f 726d 6174 2864 6972 2c72  w?'.format(dir,r
-000318d0: 6570 7228 7369 7465 5f6c 6f63 6174 6f72  epr(site_locator
-000318e0: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
-000318f0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00031900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031910: 2020 2020 2020 2020 7261 6973 6520 650d          raise e.
-00031920: 0a20 2020 2020 2020 2020 2020 2069 6d70  .            imp
-00031930: 6f72 7465 645f 7374 7275 6374 7572 655f  orted_structure_
-00031940: 6669 6c65 7061 7468 3d6f 732e 7061 7468  filepath=os.path
-00031950: 2e6a 6f69 6e28 7365 6c66 2e64 696d 656e  .join(self.dimen
-00031960: 7369 6f6e 2e73 6974 652e 5f65 6d70 6f77  sion.site._empow
-00031970: 6572 5f64 696d 5f69 6d70 6f72 745f 6469  er_dim_import_di
-00031980: 722c 2749 6d70 6f72 7465 6444 696d 656e  r,'ImportedDimen
-00031990: 7369 6f6e 5374 7275 6374 7572 655f 272b  sionStructure_'+
-000319a0: 7374 7228 7365 6c66 2e64 696d 656e 7369  str(self.dimensi
-000319b0: 6f6e 5f69 6e64 6578 292b 275f 272b 7374  on_index)+'_'+st
-000319c0: 7228 7365 6c66 2e73 686f 7274 6e61 6d65  r(self.shortname
-000319d0: 292b 272e 7473 7627 290d 0a20 2020 2020  )+'.tsv')..     
-000319e0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-000319f0: 2020 2020 2020 2343 7265 6174 6520 756e        #Create un
-00031a00: 6971 7565 206e 616d 6564 2070 6970 6573  ique named pipes
-00031a10: 2074 6f20 7265 6164 2061 6e64 2077 7269   to read and wri
-00031a20: 7465 2074 6f0d 0a20 2020 2020 2020 2020  te to..         
-00031a30: 2020 2069 6d70 6f72 7465 645f 7374 7275     imported_stru
-00031a40: 6374 7572 655f 6669 6c65 7061 7468 2020  cture_filepath  
-00031a50: 2020 2020 3d20 7227 5c5c 2e5c 7069 7065      = r'\\.\pipe
-00031a60: 5c7b 7d27 2e66 6f72 6d61 7428 7575 6964  \{}'.format(uuid
-00031a70: 2e75 7569 6434 2829 290d 0a0d 0a20 2020  .uuid4())....   
-00031a80: 2020 2020 2023 496d 706f 7274 2074 6865       #Import the
-00031a90: 2073 7472 7563 7475 7265 2066 726f 6d20   structure from 
-00031aa0: 7468 6520 776f 726b 696e 675f 6469 7265  the working_dire
-00031ab0: 6374 6f72 7920 6f72 2066 726f 6d20 7069  ctory or from pi
-00031ac0: 7065 0d0a 2020 2020 2020 2020 636f 6d6d  pe..        comm
-00031ad0: 616e 645f 6c69 7374 203d 2073 656c 662e  and_list = self.
-00031ae0: 6469 6d65 6e73 696f 6e2e 7369 7465 2e5f  dimension.site._
-00031af0: 6c6f 676f 6e5f 7061 7261 6d65 7465 725f  logon_parameter_
-00031b00: 696d 706f 7274 6572 5f63 6f6d 6d61 6e64  importer_command
-00031b10: 7320 2b20 5c0d 0a20 2020 2020 2020 2020  s + \..         
-00031b20: 2020 2020 2020 2020 2020 2020 2020 5b27                ['
-00031b30: 7365 742d 7061 7261 6d65 7465 7220 6469  set-parameter di
-00031b40: 6d65 6e73 696f 6e5f 696e 6465 783d 2720  mension_index=' 
-00031b50: 2020 2b20 7374 7228 7365 6c66 2e64 696d    + str(self.dim
-00031b60: 656e 7369 6f6e 5f69 6e64 6578 290d 0a20  ension_index).. 
-00031b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031b80: 2020 2020 2020 2c27 7365 742d 7061 7261        ,'set-para
-00031b90: 6d65 7465 7220 7374 7275 6374 7572 655f  meter structure_
-00031ba0: 7368 6f72 746e 616d 653d 272b 2073 656c  shortname='+ sel
-00031bb0: 662e 7368 6f72 746e 616d 650d 0a20 2020  f.shortname..   
-00031bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031bd0: 2020 2020 2c27 6c6f 6164 2d66 696c 652d      ,'load-file-
-00031be0: 7473 7620 2227 2b69 6d70 6f72 7465 645f  tsv "'+imported_
-00031bf0: 7374 7275 6374 7572 655f 6669 6c65 7061  structure_filepa
-00031c00: 7468 2b27 2227 0d0a 2020 2020 2020 2020  th+'"'..        
-00031c10: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-00031c20: 2765 6d70 6f77 6572 2d69 6d70 6f72 742d  'empower-import-
-00031c30: 7374 7275 6374 7572 6520 2224 7b73 6974  structure "${sit
-00031c40: 657d 2220 2224 7b75 7365 727d 2220 2224  e}" "${user}" "$
-00031c50: 7b70 6173 7377 6f72 647d 2220 247b 6469  {password}" ${di
-00031c60: 6d65 6e73 696f 6e5f 696e 6465 787d 2024  mension_index} $
-00031c70: 7b73 7472 7563 7475 7265 5f73 686f 7274  {structure_short
-00031c80: 6e61 6d65 7d27 0d0a 2020 2020 2020 2020  name}'..        
-00031c90: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-00031ca0: 0d0a 0d0a 2020 2020 2020 2020 2349 6e20  ....        #In 
-00031cb0: 6465 6275 6720 6d6f 6465 2077 7269 7465  debug mode write
-00031cc0: 2074 6865 2064 6174 6120 696e 746f 2061   the data into a
-00031cd0: 2074 7376 2066 696c 6520 616e 6420 7265   tsv file and re
-00031ce0: 6164 2069 7420 7769 7468 2049 6d70 6f72  ad it with Impor
-00031cf0: 7465 722c 2070 7574 7469 6e67 2074 6865  ter, putting the
-00031d00: 2073 7472 7563 7475 7265 2069 6e74 6f20   structure into 
-00031d10: 456d 706f 7765 720d 0a20 2020 2020 2020  Empower..       
-00031d20: 2069 6620 6465 6275 673a 0d0a 2020 2020   if debug:..    
-00031d30: 2020 2020 2020 2020 234e 6f6e 2074 696d          #Non tim
-00031d40: 6520 6469 6d65 6e73 696f 6e73 206d 6179  e dimensions may
-00031d50: 2068 6176 6520 6669 656c 6473 202d 2077   have fields - w
-00031d60: 7269 7465 2074 6865 2073 7461 6e64 6172  rite the standar
-00031d70: 6420 616e 6420 6e6f 6e20 7374 616e 6461  d and non standa
-00031d80: 7264 2066 6965 6c64 7320 746f 2066 696c  rd fields to fil
-00031d90: 6520 616e 6420 696d 706f 7274 2074 6865  e and import the
-00031da0: 6d0d 0a20 2020 2020 2020 2020 2020 2077  m..            w
-00031db0: 6974 6820 6f70 656e 2869 6d70 6f72 7465  ith open(importe
-00031dc0: 645f 7374 7275 6374 7572 655f 6669 6c65  d_structure_file
-00031dd0: 7061 7468 2c27 7727 2c65 6e63 6f64 696e  path,'w',encodin
-00031de0: 673d 2775 7466 3827 2920 6173 2074 6172  g='utf8') as tar
-00031df0: 6765 745f 6669 6c65 3a0d 0a20 2020 2020  get_file:..     
-00031e00: 2020 2020 2020 2020 2020 2066 6f72 2065             for e
-00031e10: 2069 6e20 7365 6c66 2e77 616c 6b5f 656c   in self.walk_el
-00031e20: 656d 656e 7473 2829 3a0d 0a20 2020 2020  ements():..     
-00031e30: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00031e40: 6172 6765 745f 6669 6c65 2e77 7269 7465  arget_file.write
-00031e50: 2865 2e73 686f 7274 6e61 6d65 290d 0a20  (e.shortname).. 
-00031e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031e70: 2020 2074 6172 6765 745f 6669 6c65 2e77     target_file.w
-00031e80: 7269 7465 2827 5c74 2729 0d0a 2020 2020  rite('\t')..    
-00031e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00031ea0: 7461 7267 6574 5f66 696c 652e 7772 6974  target_file.writ
-00031eb0: 6528 7374 7228 652e 6c65 7665 6c29 290d  e(str(e.level)).
-00031ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00031ed0: 2020 2020 2074 6172 6765 745f 6669 6c65       target_file
-00031ee0: 2e77 7269 7465 2827 5c6e 2729 0d0a 0d0a  .write('\n')....
-00031ef0: 2020 2020 2020 2020 2020 2020 6c6c 752e              llu.
-00031f00: 7275 6e5f 7369 6e67 6c65 5f6f 7574 7075  run_single_outpu
-00031f10: 745f 696d 706f 7274 6572 5f63 6f6d 6d61  t_importer_comma
-00031f20: 6e64 7328 636f 6d6d 616e 645f 6c69 7374  nds(command_list
-00031f30: 2c65 6d70 6f77 6572 5f69 6d70 6f72 7465  ,empower_importe
-00031f40: 725f 6578 6563 7574 6162 6c65 3d73 656c  r_executable=sel
-00031f50: 662e 6469 6d65 6e73 696f 6e2e 7369 7465  f.dimension.site
-00031f60: 2e65 6d70 6f77 6572 5f69 6d70 6f72 7465  .empower_importe
-00031f70: 725f 6578 6563 7574 6162 6c65 290d 0a0d  r_executable)...
-00031f80: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-00031f90: 2020 2020 2020 2020 2020 2020 2349 6e20              #In 
-00031fa0: 276e 6f72 6d61 6c27 206d 6f64 6520 646f  'normal' mode do
-00031fb0: 2061 206d 6572 7279 2064 616e 6365 2077   a merry dance w
-00031fc0: 6974 6820 5769 6e64 6f77 7320 6e61 6d65  ith Windows name
-00031fd0: 6420 7069 7065 732e 2054 6869 7320 6176  d pipes. This av
-00031fe0: 6f69 6473 2077 7269 7469 6e67 2074 6865  oids writing the
-00031ff0: 2064 6174 6120 746f 2066 696c 6520 666f   data to file fo
-00032000: 7220 7365 6375 7269 7479 2061 6e64 2070  r security and p
-00032010: 7261 6374 6963 616c 6974 7920 7265 6173  racticality reas
-00032020: 6f6e 730d 0a20 2020 2020 2020 2020 2020  ons..           
-00032030: 2023 696d 706f 7274 6564 5f73 7472 7563   #imported_struc
-00032040: 7475 7265 5f66 696c 6570 6174 6820 6973  ture_filepath is
-00032050: 2074 6865 206e 616d 6520 6f66 2074 6865   the name of the
-00032060: 206e 616d 6564 2070 6970 6520 652e 672e   named pipe e.g.
-00032070: 205c 5c2e 5c70 6970 655c 3964 6363 6661   \\.\pipe\9dccfa
-00032080: 3038 2d34 3063 312d 3435 6635 2d38 6530  08-40c1-45f5-8e0
-00032090: 652d 6636 3463 3138 3530 3262 6364 0d0a  e-f64c18502bcd..
-000320a0: 2020 2020 2020 2020 2020 2020 2354 6865              #The
-000320b0: 206d 6572 7279 2064 616e 6365 206d 6561   merry dance mea
-000320c0: 6e73 2073 7461 7274 696e 6720 496d 706f  ns starting Impo
-000320d0: 7274 6572 2c20 7265 6665 7265 6e63 696e  rter, referencin
-000320e0: 6720 7468 6520 7069 7065 2c20 6f70 656e  g the pipe, open
-000320f0: 696e 6720 7468 6520 7069 7065 2062 6566  ing the pipe bef
-00032100: 6f72 6520 496d 706f 7274 6572 2069 7320  ore Importer is 
-00032110: 7072 6f70 6572 6c79 2073 7461 7274 6564  properly started
-00032120: 0d0a 2020 2020 2020 2020 2020 2020 2373  ..            #s
-00032130: 6574 7469 6e67 2075 7020 7468 6520 6e61  etting up the na
-00032140: 6d65 6420 7069 7065 206f 6e20 7468 6973  med pipe on this
-00032150: 2074 6872 6561 642c 2061 6e64 2077 7269   thread, and wri
-00032160: 7469 6e67 2074 6f20 6974 2028 6173 2073  ting to it (as s
-00032170: 6f6f 6e20 6173 2049 6d70 6f72 7465 7220  oon as Importer 
-00032180: 636f 6e6e 6563 7473 2061 7420 6974 7320  connects at its 
-00032190: 656e 6429 0d0a 2020 2020 2020 2020 2020  end)..          
-000321a0: 2020 2354 6865 2064 6966 6669 6375 6c74    #The difficult
-000321b0: 792c 2069 7320 7468 6174 2077 6520 6861  y, is that we ha
-000321c0: 7665 2074 6f20 7061 7373 2074 6865 206e  ve to pass the n
-000321d0: 616d 6520 6f66 2074 6865 2070 6970 6520  ame of the pipe 
-000321e0: 746f 2049 6d70 6f72 7465 722c 2061 6e64  to Importer, and
-000321f0: 2072 656c 7920 6f6e 2074 6865 2066 6163   rely on the fac
-00032200: 7420 7468 6174 2069 7420 776f 6e27 7420  t that it won't 
-00032210: 6861 7665 2074 696d 6520 746f 206f 7065  have time to ope
-00032220: 6e20 6974 0d0a 2020 2020 2020 2020 2020  n it..          
-00032230: 2020 2362 6566 6f72 6520 7765 2068 6176    #before we hav
-00032240: 6520 6372 6561 7465 6420 6974 2e20 4275  e created it. Bu
-00032250: 7420 7765 2077 696c 6c20 626c 6f63 6b20  t we will block 
-00032260: 6f6e 206f 7572 2073 6964 6520 756e 7469  on our side unti
-00032270: 6c20 496d 706f 7274 6572 2068 6173 2063  l Importer has c
-00032280: 6f6e 6e65 6374 6564 0d0a 2020 2020 2020  onnected..      
-00032290: 2020 2020 2020 7072 6f63 203d 204e 6f6e        proc = Non
-000322a0: 650d 0a20 2020 2020 2020 2020 2020 2074  e..            t
-000322b0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-000322c0: 2020 2020 2070 726f 6320 3d20 6c6c 752e       proc = llu.
-000322d0: 7374 6172 745f 6e6f 5f6f 7574 7075 745f  start_no_output_
-000322e0: 696d 706f 7274 6572 5f63 6f6d 6d61 6e64  importer_command
-000322f0: 7328 636f 6d6d 616e 645f 6c69 7374 2c65  s(command_list,e
-00032300: 6d70 6f77 6572 5f69 6d70 6f72 7465 725f  mpower_importer_
-00032310: 6578 6563 7574 6162 6c65 3d73 656c 662e  executable=self.
-00032320: 6469 6d65 6e73 696f 6e2e 7369 7465 2e65  dimension.site.e
-00032330: 6d70 6f77 6572 5f69 6d70 6f72 7465 725f  mpower_importer_
-00032340: 6578 6563 7574 6162 6c65 290d 0a0d 0a20  executable).... 
-00032350: 2020 2020 2020 2020 2020 2020 2020 2077                 w
-00032360: 6974 6820 6c6c 752e 6f75 7462 6f75 6e64  ith llu.outbound
-00032370: 5f70 6970 6528 696d 706f 7274 6564 5f73  _pipe(imported_s
-00032380: 7472 7563 7475 7265 5f66 696c 6570 6174  tructure_filepat
-00032390: 6829 2061 7320 7069 7065 3a0d 0a0d 0a20  h) as pipe:.... 
-000323a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000323b0: 2020 2066 6f72 2065 2069 6e20 7365 6c66     for e in self
-000323c0: 2e77 616c 6b5f 656c 656d 656e 7473 2829  .walk_elements()
-000323d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000323e0: 2020 2020 2020 2020 2020 2077 696e 3332             win32
-000323f0: 6669 6c65 2e57 7269 7465 4669 6c65 2870  file.WriteFile(p
-00032400: 6970 652c 2073 7472 2e65 6e63 6f64 6528  ipe, str.encode(
-00032410: 652e 7368 6f72 746e 616d 6529 290d 0a20  e.shortname)).. 
-00032420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032430: 2020 2020 2020 2077 696e 3332 6669 6c65         win32file
-00032440: 2e57 7269 7465 4669 6c65 2870 6970 652c  .WriteFile(pipe,
-00032450: 2054 4142 4259 5445 5329 0d0a 2020 2020   TABBYTES)..    
-00032460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032470: 2020 2020 7769 6e33 3266 696c 652e 5772      win32file.Wr
-00032480: 6974 6546 696c 6528 7069 7065 2c20 7374  iteFile(pipe, st
-00032490: 722e 656e 636f 6465 2873 7472 2865 2e6c  r.encode(str(e.l
-000324a0: 6576 656c 2929 290d 0a20 2020 2020 2020  evel)))..       
-000324b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000324c0: 2077 696e 3332 6669 6c65 2e57 7269 7465   win32file.Write
-000324d0: 4669 6c65 2870 6970 652c 204e 4557 4c49  File(pipe, NEWLI
-000324e0: 4e45 4259 5445 5329 0d0a 0d0a 2020 2020  NEBYTES)....    
-000324f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00032500: 6c6f 672e 6465 6275 6728 2250 6970 6520  log.debug("Pipe 
-00032510: 7b7d 2066 696e 6973 6865 6420 7772 6974  {} finished writ
-00032520: 696e 6722 2e66 6f72 6d61 7428 696d 706f  ing".format(impo
-00032530: 7274 6564 5f73 7472 7563 7475 7265 5f66  rted_structure_f
-00032540: 696c 6570 6174 6829 290d 0a0d 0a20 2020  ilepath))....   
-00032550: 2020 2020 2020 2020 2066 696e 616c 6c79           finally
-00032560: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
-00032570: 2020 2020 2023 4368 6563 6b20 6966 2049       #Check if I
-00032580: 6d70 6f72 7465 7220 7265 7475 726e 6564  mporter returned
-00032590: 2061 6e20 6572 726f 7220 616e 6420 7261   an error and ra
-000325a0: 6973 6520 6974 2061 7320 6120 7079 7468  ise it as a pyth
-000325b0: 6f6e 2069 6620 6974 2064 6964 0d0a 2020  on if it did..  
-000325c0: 2020 2020 2020 2020 2020 2020 2020 6c6c                ll
-000325d0: 752e 636f 6d70 6c65 7465 5f6e 6f5f 6f75  u.complete_no_ou
-000325e0: 7470 7574 5f69 6d70 6f72 7465 725f 7072  tput_importer_pr
-000325f0: 6f63 6573 7328 7072 6f63 290d 0a0d 0a20  ocess(proc).... 
-00032600: 2020 2020 2020 206c 6f67 2e76 6572 626f         log.verbo
-00032610: 7365 2827 5772 6f74 6520 5374 7275 6374  se('Wrote Struct
-00032620: 7572 653a 2027 2b73 656c 662e 7368 6f72  ure: '+self.shor
-00032630: 746e 616d 6529 0d0a 0d0a 2020 2020 6465  tname)....    de
-00032640: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
-00032650: 0d0a 0d0a 2020 2020 2020 2020 7265 7375  ....        resu
-00032660: 6c74 203d 2027 270d 0a20 2020 2020 2020  lt = ''..       
-00032670: 2066 6f72 2068 2069 6e20 7365 6c66 2e68   for h in self.h
-00032680: 6965 7261 7263 6869 6573 3a0d 0a20 2020  ierarchies:..   
-00032690: 2020 2020 2020 2020 2072 6573 756c 742b           result+
-000326a0: 3d20 7374 7228 6829 0d0a 0d0a 2020 2020  = str(h)....    
-000326b0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
-000326c0: 740d 0a0d 0a0d 0a20 2020 2064 6566 205f  t......    def _
-000326d0: 5f6c 656e 5f5f 2873 656c 6629 3a0d 0a20  _len__(self):.. 
-000326e0: 2020 2020 2020 2072 6574 7572 6e20 6c65         return le
-000326f0: 6e28 5b78 2066 6f72 2078 2069 6e20 7365  n([x for x in se
-00032700: 6c66 2e77 616c 6b28 295d 290d 0a0d 0a0d  lf.walk()]).....
-00032710: 0a63 6c61 7373 2053 7472 7563 7475 7265  .class Structure
-00032720: 456c 656d 656e 7428 6f62 6a65 6374 293a  Element(object):
-00032730: 0d0a 2020 2020 2727 2741 6e20 456c 656d  ..    '''An Elem
-00032740: 656e 7420 7769 7468 696e 2061 2053 7472  ent within a Str
-00032750: 7563 7475 7265 2e0d 0a0d 0a20 2020 2053  ucture.....    S
-00032760: 7472 7563 7475 7265 456c 656d 656e 7420  tructureElement 
-00032770: 6973 206f 6e65 206f 6620 7468 6520 6d6f  is one of the mo
-00032780: 7374 2070 6f77 6572 6675 6c20 5079 4d50  st powerful PyMP
-00032790: 5820 636c 6173 7365 732c 2061 6c6c 6f77  X classes, allow
-000327a0: 696e 6720 5374 7275 6374 7572 6573 2074  ing Structures t
-000327b0: 6f20 6265 206d 616e 6970 756c 6174 6564  o be manipulated
-000327c0: 2069 6e20 6d75 6c74 6970 6c65 2077 6179   in multiple way
-000327d0: 732e 200d 0a20 2020 2045 6163 6820 5374  s. ..    Each St
-000327e0: 7275 6374 7572 6545 6c65 6d65 6e74 2068  ructureElement h
-000327f0: 6173 2061 202e 7061 7265 6e74 2061 6e64  as a .parent and
-00032800: 202e 6368 696c 6472 656e 2077 6869 6368   .children which
-00032810: 2064 6566 696e 6520 7768 6572 6520 6974   define where it
-00032820: 2069 7320 696e 2074 6865 2053 7472 7563   is in the Struc
-00032830: 7475 7265 0d0a 2020 2020 2727 270d 0a0d  ture..    '''...
-00032840: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00032850: 5f28 7365 6c66 2c70 6172 656e 745f 7374  _(self,parent_st
-00032860: 7275 6374 7572 655f 656c 656d 656e 743d  ructure_element=
-00032870: 4e6f 6e65 2c73 7472 7563 7475 7265 3d4e  None,structure=N
-00032880: 6f6e 652c 656c 656d 656e 743d 4e6f 6e65  one,element=None
-00032890: 2c73 686f 7274 6e61 6d65 3d4e 6f6e 652c  ,shortname=None,
-000328a0: 6c6f 6e67 6e61 6d65 3d4e 6f6e 652c 7068  longname=None,ph
-000328b0: 7973 6964 3d4e 6f6e 652c 7965 6172 3d4e  ysid=None,year=N
-000328c0: 6f6e 652c 6d6f 6e74 683d 4e6f 6e65 2c64  one,month=None,d
-000328d0: 6179 3d4e 6f6e 652c 696e 7465 7276 616c  ay=None,interval
-000328e0: 5f69 6e64 6578 3d4e 6f6e 652c 6973 5f72  _index=None,is_r
-000328f0: 6f6f 743d 4661 6c73 6529 3a0d 0a20 2020  oot=False):..   
-00032900: 2020 2020 2027 2727 4372 6561 7465 2061       '''Create a
-00032910: 206e 6577 2053 7472 7563 7475 7265 456c   new StructureEl
-00032920: 656d 656e 742e 0d0a 0d0a 2020 2020 2020  ement.....      
-00032930: 2020 5374 7275 6374 7572 6545 6c65 6d65    StructureEleme
-00032940: 6e74 2069 7320 6f6e 6520 6f66 2074 6865  nt is one of the
-00032950: 206d 6f73 7420 706f 7765 7266 756c 2050   most powerful P
-00032960: 794d 5058 2063 6c61 7373 6573 2c20 616c  yMPX classes, al
-00032970: 6c6f 7769 6e67 2053 7472 7563 7475 7265  lowing Structure
-00032980: 7320 746f 2062 6520 6d61 6e69 7075 6c61  s to be manipula
-00032990: 7465 6420 696e 206d 756c 7469 706c 6520  ted in multiple 
-000329a0: 7761 7973 2e20 0d0a 2020 2020 2020 2020  ways. ..        
-000329b0: 4561 6368 2053 7472 7563 7475 7265 456c  Each StructureEl
-000329c0: 656d 656e 7420 6861 7320 6120 2e70 6172  ement has a .par
-000329d0: 656e 7420 616e 6420 2e63 6869 6c64 7265  ent and .childre
-000329e0: 6e20 7768 6963 6820 6465 6669 6e65 2077  n which define w
-000329f0: 6865 7265 2069 7420 6973 2069 6e20 7468  here it is in th
-00032a00: 6520 5374 7275 6374 7572 650d 0a0d 0a20  e Structure.... 
-00032a10: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-00032a20: 7265 6e74 5f73 7472 7563 7475 7265 5f65  rent_structure_e
-00032a30: 6c65 6d65 6e74 3a20 5468 6520 5374 7275  lement: The Stru
-00032a40: 6374 7572 6545 6c65 6d65 6e74 2074 6861  ctureElement tha
-00032a50: 7420 6973 2074 6865 2070 6172 656e 7420  t is the parent 
-00032a60: 6f66 2074 6869 7320 5374 7275 6374 7572  of this Structur
-00032a70: 6545 6c65 6d65 6e74 0d0a 2020 2020 2020  eElement..      
-00032a80: 2020 3a70 6172 616d 2073 7472 7563 7475    :param structu
-00032a90: 7265 3a20 5468 6520 456d 706f 7765 7220  re: The Empower 
-00032aa0: 5374 7275 6374 7572 6520 7468 6973 2053  Structure this S
-00032ab0: 7472 7563 7475 7265 456c 656d 656e 7420  tructureElement 
-00032ac0: 6265 6c6f 6e67 7320 746f 2e20 446f 6573  belongs to. Does
-00032ad0: 6e27 7420 6e65 6564 2074 6f20 6265 2073  n't need to be s
-00032ae0: 6574 2069 6620 7061 7265 6e74 5f73 7472  et if parent_str
-00032af0: 7563 7475 7265 5f65 6c65 6d65 6e74 2068  ucture_element h
-00032b00: 6173 2069 7473 2073 7472 7563 7475 7265  as its structure
-00032b10: 2073 6574 0d0a 2020 2020 2020 2020 3a70   set..        :p
-00032b20: 6172 616d 2065 6c65 6d65 6e74 3a20 5468  aram element: Th
-00032b30: 6520 456d 706f 7765 7220 456c 656d 656e  e Empower Elemen
-00032b40: 7420 7265 6665 7272 6564 2074 6f2e 2041  t referred to. A
-00032b50: 6e20 456c 656d 656e 7420 6361 6e20 6170  n Element can ap
-00032b60: 6570 6172 2069 6e20 6d61 6e79 2053 7472  epar in many Str
-00032b70: 7563 7475 7265 456c 656d 656e 7473 0d0a  uctureElements..
-00032b80: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-00032b90: 686f 7274 6e61 6d65 3a20 4966 2065 6c65  hortname: If ele
-00032ba0: 6d65 6e74 2069 7320 6e6f 7420 7365 742c  ment is not set,
-00032bb0: 2074 6865 6e20 7468 6520 7368 6f72 746e   then the shortn
-00032bc0: 616d 6520 6f66 2074 6865 2075 6e64 6572  ame of the under
-00032bd0: 6c79 696e 6720 656c 656d 656e 742e 2053  lying element. S
-00032be0: 6565 2045 6c65 6d65 6e74 2e73 686f 7274  ee Element.short
-00032bf0: 6e61 6d65 2061 7069 2064 6f63 756d 656e  name api documen
-00032c00: 7461 7469 6f6e 2066 6f72 2064 6574 6169  tation for detai
-00032c10: 6c73 2e0d 0a20 2020 2020 2020 203a 7061  ls...        :pa
-00032c20: 7261 6d20 6c6f 6e67 6e61 6d65 3a20 4966  ram longname: If
-00032c30: 2065 6c65 6d65 6e74 2069 7320 6e6f 7420   element is not 
-00032c40: 7365 742c 2074 6865 6e20 7468 6520 6c6f  set, then the lo
-00032c50: 6e67 6e61 6d65 206f 6620 7468 6520 756e  ngname of the un
-00032c60: 6465 726c 7969 6e67 2065 6c65 6d65 6e74  derlying element
-00032c70: 2e20 5365 6520 456c 656d 656e 742e 6c6f  . See Element.lo
-00032c80: 6e67 6e61 6d65 2061 7069 2064 6f63 756d  ngname api docum
-00032c90: 656e 7461 7469 6f6e 2066 6f72 2064 6574  entation for det
-00032ca0: 6169 6c73 2e0d 0a20 2020 2020 2020 203a  ails...        :
-00032cb0: 7061 7261 6d20 7068 7973 6964 3a20 4966  param physid: If
-00032cc0: 2065 6c65 6d65 6e74 2069 7320 6e6f 7420   element is not 
-00032cd0: 7365 742c 2074 6865 6e20 7468 6520 7068  set, then the ph
-00032ce0: 7973 6963 616c 2049 4420 6f66 2074 6865  ysical ID of the
-00032cf0: 2075 6e64 6572 6c79 696e 6720 656c 656d   underlying elem
-00032d00: 656e 742e 2053 6565 2045 6c65 6d65 6e74  ent. See Element
-00032d10: 2e70 6879 7369 6420 6170 6920 646f 6375  .physid api docu
-00032d20: 6d65 6e74 6174 696f 6e20 666f 7220 6465  mentation for de
-00032d30: 7461 696c 732e 0d0a 2020 2020 2020 2020  tails...        
-00032d40: 3a70 6172 616d 2079 6561 723a 2049 6620  :param year: If 
-00032d50: 656c 656d 656e 7420 6973 206e 6f74 2073  element is not s
-00032d60: 6574 2c20 616e 6420 7468 6973 2068 6173  et, and this has
-00032d70: 2061 2054 696d 6520 5374 7275 6374 7572   a Time Structur
-00032d80: 6545 6c65 6d65 6e74 2c20 7468 656e 2074  eElement, then t
-00032d90: 6865 2079 6561 7220 6f66 2074 6865 2075  he year of the u
-00032da0: 6e64 6572 6c79 696e 6720 656c 656d 656e  nderlying elemen
-00032db0: 742e 2053 6565 2045 6c65 6d65 6e74 2e79  t. See Element.y
-00032dc0: 6561 7220 6170 6920 646f 6375 6d65 6e74  ear api document
-00032dd0: 6174 696f 6e20 666f 7220 6465 7461 696c  ation for detail
-00032de0: 732e 0d0a 2020 2020 2020 2020 3a70 6172  s...        :par
-00032df0: 616d 206d 6f6e 7468 3a20 4966 2065 6c65  am month: If ele
-00032e00: 6d65 6e74 2069 7320 6e6f 7420 7365 742c  ment is not set,
-00032e10: 2061 6e64 2074 6869 7320 6861 7320 6120   and this has a 
-00032e20: 5469 6d65 2053 7472 7563 7475 7265 456c  Time StructureEl
-00032e30: 656d 656e 742c 2074 6865 6e20 7468 6520  ement, then the 
-00032e40: 6d6f 6e74 6820 6f66 2074 6865 2075 6e64  month of the und
-00032e50: 6572 6c79 696e 6720 656c 656d 656e 742e  erlying element.
-00032e60: 2053 6565 2045 6c65 6d65 6e74 2e6d 6f6e   See Element.mon
-00032e70: 7468 2061 7069 2064 6f63 756d 656e 7461  th api documenta
-00032e80: 7469 6f6e 2066 6f72 2064 6574 6169 6c73  tion for details
-00032e90: 2e0d 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00032ea0: 6d20 6461 793a 2049 6620 656c 656d 656e  m day: If elemen
-00032eb0: 7420 6973 206e 6f74 2073 6574 2c20 616e  t is not set, an
-00032ec0: 6420 7468 6973 2068 6173 2061 2054 696d  d this has a Tim
-00032ed0: 6520 5374 7275 6374 7572 6545 6c65 6d65  e StructureEleme
-00032ee0: 6e74 2c20 7468 656e 2074 6865 2064 6179  nt, then the day
-00032ef0: 206f 6620 7468 6520 756e 6465 726c 7969   of the underlyi
-00032f00: 6e67 2065 6c65 6d65 6e74 2e20 5365 6520  ng element. See 
-00032f10: 456c 656d 656e 742e 6461 7920 6170 6920  Element.day api 
-00032f20: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
-00032f30: 7220 6465 7461 696c 732e 0d0a 2020 2020  r details...    
-00032f40: 2020 2020 3a70 6172 616d 2069 6e74 6572      :param inter
-00032f50: 7661 6c5f 696e 6465 783a 2049 6620 656c  val_index: If el
-00032f60: 656d 656e 7420 6973 206e 6f74 2073 6574  ement is not set
-00032f70: 2c20 616e 6420 7468 6973 2068 6173 2061  , and this has a
-00032f80: 2054 696d 6520 5374 7275 6374 7572 6545   Time StructureE
-00032f90: 6c65 6d65 6e74 2c20 7468 656e 2074 6865  lement, then the
-00032fa0: 2069 6e74 6572 7661 6c5f 696e 6465 7820   interval_index 
-00032fb0: 6f66 2074 6865 2075 6e64 6572 6c79 696e  of the underlyin
-00032fc0: 6720 656c 656d 656e 742e 2053 6565 2045  g element. See E
-00032fd0: 6c65 6d65 6e74 2e69 6e74 6572 7661 6c5f  lement.interval_
-00032fe0: 696e 6465 7820 6170 6920 646f 6375 6d65  index api docume
-00032ff0: 6e74 6174 696f 6e20 666f 7220 6465 7461  ntation for deta
-00033000: 696c 732e 0d0a 2020 2020 2020 2020 3a70  ils...        :p
-00033010: 6172 616d 2069 735f 726f 6f74 3a20 5365  aram is_root: Se
-00033020: 7420 7468 6973 2074 6f20 5472 7565 2069  t this to True i
-00033030: 6620 7468 6520 5374 7275 6374 7572 6545  f the StructureE
-00033040: 6c65 6d65 6e74 2069 7320 6120 726f 6f74  lement is a root
-00033050: 2065 6c65 6d65 6e74 2069 6e20 7468 6520   element in the 
-00033060: 6869 6572 6172 6368 792e 2054 6869 7320  hierarchy. This 
-00033070: 7769 6c6c 2061 7574 6f6d 6174 6963 616c  will automatical
-00033080: 6c79 2067 6574 2073 6574 2074 6f20 4661  ly get set to Fa
-00033090: 6c73 6520 6f6e 6365 2061 2070 6172 656e  lse once a paren
-000330a0: 7420 6973 2073 6574 206f 6e20 7468 6973  t is set on this
-000330b0: 2045 6c65 6d65 6e74 2e0d 0a0d 0a20 2020   Element.....   
-000330c0: 2020 2020 2027 2727 0d0a 2020 2020 2020       '''..      
-000330d0: 2020 6173 7365 7274 2073 686f 7274 6e61    assert shortna
-000330e0: 6d65 2069 7320 6e6f 7420 4e6f 6e65 206f  me is not None o
-000330f0: 7220 656c 656d 656e 7420 6973 206e 6f74  r element is not
-00033100: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
-00033110: 2073 656c 662e 5f73 7472 7563 7475 7265   self._structure
-00033120: 203d 204e 6f6e 650d 0a0d 0a20 2020 2020   = None....     
-00033130: 2020 2073 656c 662e 5f70 6172 656e 745f     self._parent_
-00033140: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-00033150: 743d 4e6f 6e65 0d0a 2020 2020 2020 2020  t=None..        
-00033160: 7365 6c66 2e5f 6368 696c 645f 7374 7275  self._child_stru
-00033170: 6374 7572 655f 656c 656d 656e 7473 203d  cture_elements =
-00033180: 205b 5d0d 0a0d 0a0d 0a20 2020 2020 2020   []......       
-00033190: 2023 6164 6420 7365 6c66 2074 6f20 7374   #add self to st
-000331a0: 7275 6374 7572 650d 0a20 2020 2020 2020  ructure..       
-000331b0: 2069 6620 7061 7265 6e74 5f73 7472 7563   if parent_struc
-000331c0: 7475 7265 5f65 6c65 6d65 6e74 2069 7320  ture_element is 
-000331d0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-000331e0: 2020 2020 2020 2073 656c 662e 7374 7275         self.stru
-000331f0: 6374 7572 653d 7061 7265 6e74 5f73 7472  cture=parent_str
-00033200: 7563 7475 7265 5f65 6c65 6d65 6e74 2e73  ucture_element.s
-00033210: 7472 7563 7475 7265 0d0a 2020 2020 2020  tructure..      
-00033220: 2020 656c 6966 2073 7472 7563 7475 7265    elif structure
-00033230: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-00033240: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00033250: 7374 7275 6374 7572 653d 7374 7275 6374  structure=struct
-00033260: 7572 650d 0a0d 0a20 2020 2020 2020 2073  ure....        s
-00033270: 656c 662e 5f65 6c65 6d65 6e74 203d 204e  elf._element = N
-00033280: 6f6e 650d 0a0d 0a20 2020 2020 2020 2069  one....        i
-00033290: 6620 656c 656d 656e 7420 6973 206e 6f74  f element is not
-000332a0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-000332b0: 2020 2020 7365 6c66 2e65 6c65 6d65 6e74      self.element
-000332c0: 3d65 6c65 6d65 6e74 0d0a 2020 2020 2020  =element..      
-000332d0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-000332e0: 2020 2020 2023 696e 6974 6961 6c69 7365       #initialise
-000332f0: 2074 6865 2045 6c65 6d65 6e74 0d0a 2020   the Element..  
-00033300: 2020 2020 2020 2020 2020 6966 2079 6561            if yea
-00033310: 7220 6973 206e 6f74 204e 6f6e 653a 0d0a  r is not None:..
-00033320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033330: 7365 6c66 2e65 6c65 6d65 6e74 3d54 696d  self.element=Tim
-00033340: 6545 6c65 6d65 6e74 286c 6f6e 676e 616d  eElement(longnam
-00033350: 653d 6c6f 6e67 6e61 6d65 0d0a 2020 2020  e=longname..    
-00033360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033380: 2020 2020 2c79 6561 723d 7965 6172 0d0a      ,year=year..
+00031810: 2020 2069 6620 652e 7769 6e65 7272 6f72     if e.winerror
+00031820: 203d 3d20 3132 333a 0d0a 2020 2020 2020   == 123:..      
+00031830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031840: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00031850: 6f72 2827 4469 7265 6374 6f72 7920 227b  or('Directory "{
+00031860: 7d22 2068 6173 2061 6e20 696e 7661 6c69  }" has an invali
+00031870: 6420 6e61 6d65 2e20 4469 6420 796f 7520  d name. Did you 
+00031880: 7061 7373 2061 2073 6974 655f 6c6f 6361  pass a site_loca
+00031890: 746f 7220 7061 7468 2022 7b7d 2220 7769  tor path "{}" wi
+000318a0: 7468 6f75 7420 646f 7562 6c65 2d65 7363  thout double-esc
+000318b0: 6170 696e 6720 6261 636b 736c 6173 6865  aping backslashe
+000318c0: 7320 6f72 2070 7265 6669 7869 6e67 2074  s or prefixing t
+000318d0: 6865 2073 7472 696e 6720 7769 7468 2061  he string with a
+000318e0: 6e20 2272 2220 666f 7220 7261 773f 272e  n "r" for raw?'.
+000318f0: 666f 726d 6174 2864 6972 2c72 6570 7228  format(dir,repr(
+00031900: 7369 7465 5f6c 6f63 6174 6f72 2929 290d  site_locator))).
+00031910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00031920: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00031930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031940: 2020 2020 7261 6973 6520 650d 0a20 2020      raise e..   
+00031950: 2020 2020 2020 2020 2069 6d70 6f72 7465           importe
+00031960: 645f 7374 7275 6374 7572 655f 6669 6c65  d_structure_file
+00031970: 7061 7468 3d6f 732e 7061 7468 2e6a 6f69  path=os.path.joi
+00031980: 6e28 7365 6c66 2e64 696d 656e 7369 6f6e  n(self.dimension
+00031990: 2e73 6974 652e 5f65 6d70 6f77 6572 5f64  .site._empower_d
+000319a0: 696d 5f69 6d70 6f72 745f 6469 722c 2749  im_import_dir,'I
+000319b0: 6d70 6f72 7465 6444 696d 656e 7369 6f6e  mportedDimension
+000319c0: 5374 7275 6374 7572 655f 272b 7374 7228  Structure_'+str(
+000319d0: 7365 6c66 2e64 696d 656e 7369 6f6e 5f69  self.dimension_i
+000319e0: 6e64 6578 292b 275f 272b 7374 7228 7365  ndex)+'_'+str(se
+000319f0: 6c66 2e73 686f 7274 6e61 6d65 292b 272e  lf.shortname)+'.
+00031a00: 7473 7627 290d 0a20 2020 2020 2020 2065  tsv')..        e
+00031a10: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00031a20: 2020 2343 7265 6174 6520 756e 6971 7565    #Create unique
+00031a30: 206e 616d 6564 2070 6970 6573 2074 6f20   named pipes to 
+00031a40: 7265 6164 2061 6e64 2077 7269 7465 2074  read and write t
+00031a50: 6f0d 0a20 2020 2020 2020 2020 2020 2069  o..            i
+00031a60: 6d70 6f72 7465 645f 7374 7275 6374 7572  mported_structur
+00031a70: 655f 6669 6c65 7061 7468 2020 2020 2020  e_filepath      
+00031a80: 3d20 7227 5c5c 2e5c 7069 7065 5c7b 7d27  = r'\\.\pipe\{}'
+00031a90: 2e66 6f72 6d61 7428 7575 6964 2e75 7569  .format(uuid.uui
+00031aa0: 6434 2829 290d 0a0d 0a20 2020 2020 2020  d4())....       
+00031ab0: 2023 496d 706f 7274 2074 6865 2073 7472   #Import the str
+00031ac0: 7563 7475 7265 2066 726f 6d20 7468 6520  ucture from the 
+00031ad0: 776f 726b 696e 675f 6469 7265 6374 6f72  working_director
+00031ae0: 7920 6f72 2066 726f 6d20 7069 7065 0d0a  y or from pipe..
+00031af0: 2020 2020 2020 2020 636f 6d6d 616e 645f          command_
+00031b00: 6c69 7374 203d 2073 656c 662e 6469 6d65  list = self.dime
+00031b10: 6e73 696f 6e2e 7369 7465 2e5f 6c6f 676f  nsion.site._logo
+00031b20: 6e5f 7061 7261 6d65 7465 725f 696d 706f  n_parameter_impo
+00031b30: 7274 6572 5f63 6f6d 6d61 6e64 7320 2b20  rter_commands + 
+00031b40: 5c0d 0a20 2020 2020 2020 2020 2020 2020  \..             
+00031b50: 2020 2020 2020 2020 2020 5b27 7365 742d            ['set-
+00031b60: 7061 7261 6d65 7465 7220 6469 6d65 6e73  parameter dimens
+00031b70: 696f 6e5f 696e 6465 783d 2720 2020 2b20  ion_index='   + 
+00031b80: 7374 7228 7365 6c66 2e64 696d 656e 7369  str(self.dimensi
+00031b90: 6f6e 5f69 6e64 6578 290d 0a20 2020 2020  on_index)..     
+00031ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031bb0: 2020 2c27 7365 742d 7061 7261 6d65 7465    ,'set-paramete
+00031bc0: 7220 7374 7275 6374 7572 655f 7368 6f72  r structure_shor
+00031bd0: 746e 616d 653d 272b 2073 656c 662e 7368  tname='+ self.sh
+00031be0: 6f72 746e 616d 650d 0a20 2020 2020 2020  ortname..       
+00031bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031c00: 2c27 6c6f 6164 2d66 696c 652d 7473 7620  ,'load-file-tsv 
+00031c10: 2227 2b69 6d70 6f72 7465 645f 7374 7275  "'+imported_stru
+00031c20: 6374 7572 655f 6669 6c65 7061 7468 2b27  cture_filepath+'
+00031c30: 2227 0d0a 2020 2020 2020 2020 2020 2020  "'..            
+00031c40: 2020 2020 2020 2020 2020 202c 2765 6d70             ,'emp
+00031c50: 6f77 6572 2d69 6d70 6f72 742d 7374 7275  ower-import-stru
+00031c60: 6374 7572 6520 2224 7b73 6974 657d 2220  cture "${site}" 
+00031c70: 2224 7b75 7365 727d 2220 2224 7b70 6173  "${user}" "${pas
+00031c80: 7377 6f72 647d 2220 247b 6469 6d65 6e73  sword}" ${dimens
+00031c90: 696f 6e5f 696e 6465 787d 2024 7b73 7472  ion_index} ${str
+00031ca0: 7563 7475 7265 5f73 686f 7274 6e61 6d65  ucture_shortname
+00031cb0: 7d27 0d0a 2020 2020 2020 2020 2020 2020  }'..            
+00031cc0: 2020 2020 2020 2020 2020 205d 0d0a 0d0a             ]....
+00031cd0: 2020 2020 2020 2020 2349 6e20 6465 6275          #In debu
+00031ce0: 6720 6d6f 6465 2077 7269 7465 2074 6865  g mode write the
+00031cf0: 2064 6174 6120 696e 746f 2061 2074 7376   data into a tsv
+00031d00: 2066 696c 6520 616e 6420 7265 6164 2069   file and read i
+00031d10: 7420 7769 7468 2049 6d70 6f72 7465 722c  t with Importer,
+00031d20: 2070 7574 7469 6e67 2074 6865 2073 7472   putting the str
+00031d30: 7563 7475 7265 2069 6e74 6f20 456d 706f  ucture into Empo
+00031d40: 7765 720d 0a20 2020 2020 2020 2069 6620  wer..        if 
+00031d50: 6465 6275 673a 0d0a 2020 2020 2020 2020  debug:..        
+00031d60: 2020 2020 234e 6f6e 2074 696d 6520 6469      #Non time di
+00031d70: 6d65 6e73 696f 6e73 206d 6179 2068 6176  mensions may hav
+00031d80: 6520 6669 656c 6473 202d 2077 7269 7465  e fields - write
+00031d90: 2074 6865 2073 7461 6e64 6172 6420 616e   the standard an
+00031da0: 6420 6e6f 6e20 7374 616e 6461 7264 2066  d non standard f
+00031db0: 6965 6c64 7320 746f 2066 696c 6520 616e  ields to file an
+00031dc0: 6420 696d 706f 7274 2074 6865 6d0d 0a20  d import them.. 
+00031dd0: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00031de0: 6f70 656e 2869 6d70 6f72 7465 645f 7374  open(imported_st
+00031df0: 7275 6374 7572 655f 6669 6c65 7061 7468  ructure_filepath
+00031e00: 2c27 7727 2c65 6e63 6f64 696e 673d 2775  ,'w',encoding='u
+00031e10: 7466 3827 2920 6173 2074 6172 6765 745f  tf8') as target_
+00031e20: 6669 6c65 3a0d 0a20 2020 2020 2020 2020  file:..         
+00031e30: 2020 2020 2020 2066 6f72 2065 2069 6e20         for e in 
+00031e40: 7365 6c66 2e77 616c 6b5f 656c 656d 656e  self.walk_elemen
+00031e50: 7473 2829 3a0d 0a20 2020 2020 2020 2020  ts():..         
+00031e60: 2020 2020 2020 2020 2020 2074 6172 6765             targe
+00031e70: 745f 6669 6c65 2e77 7269 7465 2865 2e73  t_file.write(e.s
+00031e80: 686f 7274 6e61 6d65 290d 0a20 2020 2020  hortname)..     
+00031e90: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00031ea0: 6172 6765 745f 6669 6c65 2e77 7269 7465  arget_file.write
+00031eb0: 2827 5c74 2729 0d0a 2020 2020 2020 2020  ('\t')..        
+00031ec0: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+00031ed0: 6574 5f66 696c 652e 7772 6974 6528 7374  et_file.write(st
+00031ee0: 7228 652e 6c65 7665 6c29 290d 0a20 2020  r(e.level))..   
+00031ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00031f00: 2074 6172 6765 745f 6669 6c65 2e77 7269   target_file.wri
+00031f10: 7465 2827 5c6e 2729 0d0a 0d0a 2020 2020  te('\n')....    
+00031f20: 2020 2020 2020 2020 6c6c 752e 7275 6e5f          llu.run_
+00031f30: 7369 6e67 6c65 5f6f 7574 7075 745f 696d  single_output_im
+00031f40: 706f 7274 6572 5f63 6f6d 6d61 6e64 7328  porter_commands(
+00031f50: 636f 6d6d 616e 645f 6c69 7374 2c65 6d70  command_list,emp
+00031f60: 6f77 6572 5f69 6d70 6f72 7465 725f 6578  ower_importer_ex
+00031f70: 6563 7574 6162 6c65 3d73 656c 662e 6469  ecutable=self.di
+00031f80: 6d65 6e73 696f 6e2e 7369 7465 2e65 6d70  mension.site.emp
+00031f90: 6f77 6572 5f69 6d70 6f72 7465 725f 6578  ower_importer_ex
+00031fa0: 6563 7574 6162 6c65 290d 0a0d 0a20 2020  ecutable)....   
+00031fb0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00031fc0: 2020 2020 2020 2020 2349 6e20 276e 6f72          #In 'nor
+00031fd0: 6d61 6c27 206d 6f64 6520 646f 2061 206d  mal' mode do a m
+00031fe0: 6572 7279 2064 616e 6365 2077 6974 6820  erry dance with 
+00031ff0: 5769 6e64 6f77 7320 6e61 6d65 6420 7069  Windows named pi
+00032000: 7065 732e 2054 6869 7320 6176 6f69 6473  pes. This avoids
+00032010: 2077 7269 7469 6e67 2074 6865 2064 6174   writing the dat
+00032020: 6120 746f 2066 696c 6520 666f 7220 7365  a to file for se
+00032030: 6375 7269 7479 2061 6e64 2070 7261 6374  curity and pract
+00032040: 6963 616c 6974 7920 7265 6173 6f6e 730d  icality reasons.
+00032050: 0a20 2020 2020 2020 2020 2020 2023 696d  .            #im
+00032060: 706f 7274 6564 5f73 7472 7563 7475 7265  ported_structure
+00032070: 5f66 696c 6570 6174 6820 6973 2074 6865  _filepath is the
+00032080: 206e 616d 6520 6f66 2074 6865 206e 616d   name of the nam
+00032090: 6564 2070 6970 6520 652e 672e 205c 5c2e  ed pipe e.g. \\.
+000320a0: 5c70 6970 655c 3964 6363 6661 3038 2d34  \pipe\9dccfa08-4
+000320b0: 3063 312d 3435 6635 2d38 6530 652d 6636  0c1-45f5-8e0e-f6
+000320c0: 3463 3138 3530 3262 6364 0d0a 2020 2020  4c18502bcd..    
+000320d0: 2020 2020 2020 2020 2354 6865 206d 6572          #The mer
+000320e0: 7279 2064 616e 6365 206d 6561 6e73 2073  ry dance means s
+000320f0: 7461 7274 696e 6720 496d 706f 7274 6572  tarting Importer
+00032100: 2c20 7265 6665 7265 6e63 696e 6720 7468  , referencing th
+00032110: 6520 7069 7065 2c20 6f70 656e 696e 6720  e pipe, opening 
+00032120: 7468 6520 7069 7065 2062 6566 6f72 6520  the pipe before 
+00032130: 496d 706f 7274 6572 2069 7320 7072 6f70  Importer is prop
+00032140: 6572 6c79 2073 7461 7274 6564 0d0a 2020  erly started..  
+00032150: 2020 2020 2020 2020 2020 2373 6574 7469            #setti
+00032160: 6e67 2075 7020 7468 6520 6e61 6d65 6420  ng up the named 
+00032170: 7069 7065 206f 6e20 7468 6973 2074 6872  pipe on this thr
+00032180: 6561 642c 2061 6e64 2077 7269 7469 6e67  ead, and writing
+00032190: 2074 6f20 6974 2028 6173 2073 6f6f 6e20   to it (as soon 
+000321a0: 6173 2049 6d70 6f72 7465 7220 636f 6e6e  as Importer conn
+000321b0: 6563 7473 2061 7420 6974 7320 656e 6429  ects at its end)
+000321c0: 0d0a 2020 2020 2020 2020 2020 2020 2354  ..            #T
+000321d0: 6865 2064 6966 6669 6375 6c74 792c 2069  he difficulty, i
+000321e0: 7320 7468 6174 2077 6520 6861 7665 2074  s that we have t
+000321f0: 6f20 7061 7373 2074 6865 206e 616d 6520  o pass the name 
+00032200: 6f66 2074 6865 2070 6970 6520 746f 2049  of the pipe to I
+00032210: 6d70 6f72 7465 722c 2061 6e64 2072 656c  mporter, and rel
+00032220: 7920 6f6e 2074 6865 2066 6163 7420 7468  y on the fact th
+00032230: 6174 2069 7420 776f 6e27 7420 6861 7665  at it won't have
+00032240: 2074 696d 6520 746f 206f 7065 6e20 6974   time to open it
+00032250: 0d0a 2020 2020 2020 2020 2020 2020 2362  ..            #b
+00032260: 6566 6f72 6520 7765 2068 6176 6520 6372  efore we have cr
+00032270: 6561 7465 6420 6974 2e20 4275 7420 7765  eated it. But we
+00032280: 2077 696c 6c20 626c 6f63 6b20 6f6e 206f   will block on o
+00032290: 7572 2073 6964 6520 756e 7469 6c20 496d  ur side until Im
+000322a0: 706f 7274 6572 2068 6173 2063 6f6e 6e65  porter has conne
+000322b0: 6374 6564 0d0a 2020 2020 2020 2020 2020  cted..          
+000322c0: 2020 7072 6f63 203d 204e 6f6e 650d 0a20    proc = None.. 
+000322d0: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+000322e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000322f0: 2070 726f 6320 3d20 6c6c 752e 7374 6172   proc = llu.star
+00032300: 745f 6e6f 5f6f 7574 7075 745f 696d 706f  t_no_output_impo
+00032310: 7274 6572 5f63 6f6d 6d61 6e64 7328 636f  rter_commands(co
+00032320: 6d6d 616e 645f 6c69 7374 2c65 6d70 6f77  mmand_list,empow
+00032330: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
+00032340: 7574 6162 6c65 3d73 656c 662e 6469 6d65  utable=self.dime
+00032350: 6e73 696f 6e2e 7369 7465 2e65 6d70 6f77  nsion.site.empow
+00032360: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
+00032370: 7574 6162 6c65 290d 0a0d 0a20 2020 2020  utable)....     
+00032380: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+00032390: 6c6c 752e 6f75 7462 6f75 6e64 5f70 6970  llu.outbound_pip
+000323a0: 6528 696d 706f 7274 6564 5f73 7472 7563  e(imported_struc
+000323b0: 7475 7265 5f66 696c 6570 6174 6829 2061  ture_filepath) a
+000323c0: 7320 7069 7065 3a0d 0a0d 0a20 2020 2020  s pipe:....     
+000323d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000323e0: 6f72 2065 2069 6e20 7365 6c66 2e77 616c  or e in self.wal
+000323f0: 6b5f 656c 656d 656e 7473 2829 3a0d 0a20  k_elements():.. 
+00032400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032410: 2020 2020 2020 2077 696e 3332 6669 6c65         win32file
+00032420: 2e57 7269 7465 4669 6c65 2870 6970 652c  .WriteFile(pipe,
+00032430: 2073 7472 2e65 6e63 6f64 6528 652e 7368   str.encode(e.sh
+00032440: 6f72 746e 616d 6529 290d 0a20 2020 2020  ortname))..     
+00032450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00032460: 2020 2077 696e 3332 6669 6c65 2e57 7269     win32file.Wri
+00032470: 7465 4669 6c65 2870 6970 652c 2054 4142  teFile(pipe, TAB
+00032480: 4259 5445 5329 0d0a 2020 2020 2020 2020  BYTES)..        
+00032490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000324a0: 7769 6e33 3266 696c 652e 5772 6974 6546  win32file.WriteF
+000324b0: 696c 6528 7069 7065 2c20 7374 722e 656e  ile(pipe, str.en
+000324c0: 636f 6465 2873 7472 2865 2e6c 6576 656c  code(str(e.level
+000324d0: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
+000324e0: 2020 2020 2020 2020 2020 2020 2077 696e               win
+000324f0: 3332 6669 6c65 2e57 7269 7465 4669 6c65  32file.WriteFile
+00032500: 2870 6970 652c 204e 4557 4c49 4e45 4259  (pipe, NEWLINEBY
+00032510: 5445 5329 0d0a 0d0a 2020 2020 2020 2020  TES)....        
+00032520: 2020 2020 2020 2020 2020 2020 6c6f 672e              log.
+00032530: 6465 6275 6728 2250 6970 6520 7b7d 2066  debug("Pipe {} f
+00032540: 696e 6973 6865 6420 7772 6974 696e 6722  inished writing"
+00032550: 2e66 6f72 6d61 7428 696d 706f 7274 6564  .format(imported
+00032560: 5f73 7472 7563 7475 7265 5f66 696c 6570  _structure_filep
+00032570: 6174 6829 290d 0a0d 0a20 2020 2020 2020  ath))....       
+00032580: 2020 2020 2066 696e 616c 6c79 3a0d 0a0d       finally:...
+00032590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000325a0: 2023 4368 6563 6b20 6966 2049 6d70 6f72   #Check if Impor
+000325b0: 7465 7220 7265 7475 726e 6564 2061 6e20  ter returned an 
+000325c0: 6572 726f 7220 616e 6420 7261 6973 6520  error and raise 
+000325d0: 6974 2061 7320 6120 7079 7468 6f6e 2069  it as a python i
+000325e0: 6620 6974 2064 6964 0d0a 2020 2020 2020  f it did..      
+000325f0: 2020 2020 2020 2020 2020 6c6c 752e 636f            llu.co
+00032600: 6d70 6c65 7465 5f6e 6f5f 6f75 7470 7574  mplete_no_output
+00032610: 5f69 6d70 6f72 7465 725f 7072 6f63 6573  _importer_proces
+00032620: 7328 7072 6f63 290d 0a0d 0a20 2020 2020  s(proc)....     
+00032630: 2020 206c 6f67 2e76 6572 626f 7365 2827     log.verbose('
+00032640: 5772 6f74 6520 5374 7275 6374 7572 653a  Wrote Structure:
+00032650: 2027 2b73 656c 662e 7368 6f72 746e 616d   '+self.shortnam
+00032660: 6529 0d0a 0d0a 2020 2020 6465 6620 5f5f  e)....    def __
+00032670: 7374 725f 5f28 7365 6c66 293a 0d0a 0d0a  str__(self):....
+00032680: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00032690: 2027 270d 0a20 2020 2020 2020 2066 6f72   ''..        for
+000326a0: 2068 2069 6e20 7365 6c66 2e68 6965 7261   h in self.hiera
+000326b0: 7263 6869 6573 3a0d 0a20 2020 2020 2020  rchies:..       
+000326c0: 2020 2020 2072 6573 756c 742b 3d20 7374       result+= st
+000326d0: 7228 6829 0d0a 0d0a 2020 2020 2020 2020  r(h)....        
+000326e0: 7265 7475 726e 2072 6573 756c 740d 0a0d  return result...
+000326f0: 0a0d 0a20 2020 2064 6566 205f 5f6c 656e  ...    def __len
+00032700: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
+00032710: 2020 2072 6574 7572 6e20 6c65 6e28 5b78     return len([x
+00032720: 2066 6f72 2078 2069 6e20 7365 6c66 2e77   for x in self.w
+00032730: 616c 6b28 295d 290d 0a0d 0a0d 0a63 6c61  alk()])......cla
+00032740: 7373 2053 7472 7563 7475 7265 456c 656d  ss StructureElem
+00032750: 656e 7428 6f62 6a65 6374 293a 0d0a 2020  ent(object):..  
+00032760: 2020 2727 2741 6e20 456c 656d 656e 7420    '''An Element 
+00032770: 7769 7468 696e 2061 2053 7472 7563 7475  within a Structu
+00032780: 7265 2e0d 0a0d 0a20 2020 2053 7472 7563  re.....    Struc
+00032790: 7475 7265 456c 656d 656e 7420 6973 206f  tureElement is o
+000327a0: 6e65 206f 6620 7468 6520 6d6f 7374 2070  ne of the most p
+000327b0: 6f77 6572 6675 6c20 5079 4d50 5820 636c  owerful PyMPX cl
+000327c0: 6173 7365 732c 2061 6c6c 6f77 696e 6720  asses, allowing 
+000327d0: 5374 7275 6374 7572 6573 2074 6f20 6265  Structures to be
+000327e0: 206d 616e 6970 756c 6174 6564 2069 6e20   manipulated in 
+000327f0: 6d75 6c74 6970 6c65 2077 6179 732e 200d  multiple ways. .
+00032800: 0a20 2020 2045 6163 6820 5374 7275 6374  .    Each Struct
+00032810: 7572 6545 6c65 6d65 6e74 2068 6173 2061  ureElement has a
+00032820: 202e 7061 7265 6e74 2061 6e64 202e 6368   .parent and .ch
+00032830: 696c 6472 656e 2077 6869 6368 2064 6566  ildren which def
+00032840: 696e 6520 7768 6572 6520 6974 2069 7320  ine where it is 
+00032850: 696e 2074 6865 2053 7472 7563 7475 7265  in the Structure
+00032860: 0d0a 2020 2020 2727 270d 0a0d 0a20 2020  ..    '''....   
+00032870: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00032880: 6c66 2c70 6172 656e 745f 7374 7275 6374  lf,parent_struct
+00032890: 7572 655f 656c 656d 656e 743d 4e6f 6e65  ure_element=None
+000328a0: 2c73 7472 7563 7475 7265 3d4e 6f6e 652c  ,structure=None,
+000328b0: 656c 656d 656e 743d 4e6f 6e65 2c73 686f  element=None,sho
+000328c0: 7274 6e61 6d65 3d4e 6f6e 652c 6c6f 6e67  rtname=None,long
+000328d0: 6e61 6d65 3d4e 6f6e 652c 7068 7973 6964  name=None,physid
+000328e0: 3d4e 6f6e 652c 7965 6172 3d4e 6f6e 652c  =None,year=None,
+000328f0: 6d6f 6e74 683d 4e6f 6e65 2c64 6179 3d4e  month=None,day=N
+00032900: 6f6e 652c 696e 7465 7276 616c 5f69 6e64  one,interval_ind
+00032910: 6578 3d4e 6f6e 652c 6973 5f72 6f6f 743d  ex=None,is_root=
+00032920: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+00032930: 2027 2727 4372 6561 7465 2061 206e 6577   '''Create a new
+00032940: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
+00032950: 742e 0d0a 0d0a 2020 2020 2020 2020 5374  t.....        St
+00032960: 7275 6374 7572 6545 6c65 6d65 6e74 2069  ructureElement i
+00032970: 7320 6f6e 6520 6f66 2074 6865 206d 6f73  s one of the mos
+00032980: 7420 706f 7765 7266 756c 2050 794d 5058  t powerful PyMPX
+00032990: 2063 6c61 7373 6573 2c20 616c 6c6f 7769   classes, allowi
+000329a0: 6e67 2053 7472 7563 7475 7265 7320 746f  ng Structures to
+000329b0: 2062 6520 6d61 6e69 7075 6c61 7465 6420   be manipulated 
+000329c0: 696e 206d 756c 7469 706c 6520 7761 7973  in multiple ways
+000329d0: 2e20 0d0a 2020 2020 2020 2020 4561 6368  . ..        Each
+000329e0: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
+000329f0: 7420 6861 7320 6120 2e70 6172 656e 7420  t has a .parent 
+00032a00: 616e 6420 2e63 6869 6c64 7265 6e20 7768  and .children wh
+00032a10: 6963 6820 6465 6669 6e65 2077 6865 7265  ich define where
+00032a20: 2069 7420 6973 2069 6e20 7468 6520 5374   it is in the St
+00032a30: 7275 6374 7572 650d 0a0d 0a20 2020 2020  ructure....     
+00032a40: 2020 203a 7061 7261 6d20 7061 7265 6e74     :param parent
+00032a50: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00032a60: 6e74 3a20 5468 6520 5374 7275 6374 7572  nt: The Structur
+00032a70: 6545 6c65 6d65 6e74 2074 6861 7420 6973  eElement that is
+00032a80: 2074 6865 2070 6172 656e 7420 6f66 2074   the parent of t
+00032a90: 6869 7320 5374 7275 6374 7572 6545 6c65  his StructureEle
+00032aa0: 6d65 6e74 0d0a 2020 2020 2020 2020 3a70  ment..        :p
+00032ab0: 6172 616d 2073 7472 7563 7475 7265 3a20  aram structure: 
+00032ac0: 5468 6520 456d 706f 7765 7220 5374 7275  The Empower Stru
+00032ad0: 6374 7572 6520 7468 6973 2053 7472 7563  cture this Struc
+00032ae0: 7475 7265 456c 656d 656e 7420 6265 6c6f  tureElement belo
+00032af0: 6e67 7320 746f 2e20 446f 6573 6e27 7420  ngs to. Doesn't 
+00032b00: 6e65 6564 2074 6f20 6265 2073 6574 2069  need to be set i
+00032b10: 6620 7061 7265 6e74 5f73 7472 7563 7475  f parent_structu
+00032b20: 7265 5f65 6c65 6d65 6e74 2068 6173 2069  re_element has i
+00032b30: 7473 2073 7472 7563 7475 7265 2073 6574  ts structure set
+00032b40: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00032b50: 2065 6c65 6d65 6e74 3a20 5468 6520 456d   element: The Em
+00032b60: 706f 7765 7220 456c 656d 656e 7420 7265  power Element re
+00032b70: 6665 7272 6564 2074 6f2e 2041 6e20 456c  ferred to. An El
+00032b80: 656d 656e 7420 6361 6e20 6170 6570 6172  ement can apepar
+00032b90: 2069 6e20 6d61 6e79 2053 7472 7563 7475   in many Structu
+00032ba0: 7265 456c 656d 656e 7473 0d0a 2020 2020  reElements..    
+00032bb0: 2020 2020 3a70 6172 616d 2073 686f 7274      :param short
+00032bc0: 6e61 6d65 3a20 4966 2065 6c65 6d65 6e74  name: If element
+00032bd0: 2069 7320 6e6f 7420 7365 742c 2074 6865   is not set, the
+00032be0: 6e20 7468 6520 7368 6f72 746e 616d 6520  n the shortname 
+00032bf0: 6f66 2074 6865 2075 6e64 6572 6c79 696e  of the underlyin
+00032c00: 6720 656c 656d 656e 742e 2053 6565 2045  g element. See E
+00032c10: 6c65 6d65 6e74 2e73 686f 7274 6e61 6d65  lement.shortname
+00032c20: 2061 7069 2064 6f63 756d 656e 7461 7469   api documentati
+00032c30: 6f6e 2066 6f72 2064 6574 6169 6c73 2e0d  on for details..
+00032c40: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00032c50: 6c6f 6e67 6e61 6d65 3a20 4966 2065 6c65  longname: If ele
+00032c60: 6d65 6e74 2069 7320 6e6f 7420 7365 742c  ment is not set,
+00032c70: 2074 6865 6e20 7468 6520 6c6f 6e67 6e61   then the longna
+00032c80: 6d65 206f 6620 7468 6520 756e 6465 726c  me of the underl
+00032c90: 7969 6e67 2065 6c65 6d65 6e74 2e20 5365  ying element. Se
+00032ca0: 6520 456c 656d 656e 742e 6c6f 6e67 6e61  e Element.longna
+00032cb0: 6d65 2061 7069 2064 6f63 756d 656e 7461  me api documenta
+00032cc0: 7469 6f6e 2066 6f72 2064 6574 6169 6c73  tion for details
+00032cd0: 2e0d 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+00032ce0: 6d20 7068 7973 6964 3a20 4966 2065 6c65  m physid: If ele
+00032cf0: 6d65 6e74 2069 7320 6e6f 7420 7365 742c  ment is not set,
+00032d00: 2074 6865 6e20 7468 6520 7068 7973 6963   then the physic
+00032d10: 616c 2049 4420 6f66 2074 6865 2075 6e64  al ID of the und
+00032d20: 6572 6c79 696e 6720 656c 656d 656e 742e  erlying element.
+00032d30: 2053 6565 2045 6c65 6d65 6e74 2e70 6879   See Element.phy
+00032d40: 7369 6420 6170 6920 646f 6375 6d65 6e74  sid api document
+00032d50: 6174 696f 6e20 666f 7220 6465 7461 696c  ation for detail
+00032d60: 732e 0d0a 2020 2020 2020 2020 3a70 6172  s...        :par
+00032d70: 616d 2079 6561 723a 2049 6620 656c 656d  am year: If elem
+00032d80: 656e 7420 6973 206e 6f74 2073 6574 2c20  ent is not set, 
+00032d90: 616e 6420 7468 6973 2068 6173 2061 2054  and this has a T
+00032da0: 696d 6520 5374 7275 6374 7572 6545 6c65  ime StructureEle
+00032db0: 6d65 6e74 2c20 7468 656e 2074 6865 2079  ment, then the y
+00032dc0: 6561 7220 6f66 2074 6865 2075 6e64 6572  ear of the under
+00032dd0: 6c79 696e 6720 656c 656d 656e 742e 2053  lying element. S
+00032de0: 6565 2045 6c65 6d65 6e74 2e79 6561 7220  ee Element.year 
+00032df0: 6170 6920 646f 6375 6d65 6e74 6174 696f  api documentatio
+00032e00: 6e20 666f 7220 6465 7461 696c 732e 0d0a  n for details...
+00032e10: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
+00032e20: 6f6e 7468 3a20 4966 2065 6c65 6d65 6e74  onth: If element
+00032e30: 2069 7320 6e6f 7420 7365 742c 2061 6e64   is not set, and
+00032e40: 2074 6869 7320 6861 7320 6120 5469 6d65   this has a Time
+00032e50: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
+00032e60: 742c 2074 6865 6e20 7468 6520 6d6f 6e74  t, then the mont
+00032e70: 6820 6f66 2074 6865 2075 6e64 6572 6c79  h of the underly
+00032e80: 696e 6720 656c 656d 656e 742e 2053 6565  ing element. See
+00032e90: 2045 6c65 6d65 6e74 2e6d 6f6e 7468 2061   Element.month a
+00032ea0: 7069 2064 6f63 756d 656e 7461 7469 6f6e  pi documentation
+00032eb0: 2066 6f72 2064 6574 6169 6c73 2e0d 0a20   for details... 
+00032ec0: 2020 2020 2020 203a 7061 7261 6d20 6461         :param da
+00032ed0: 793a 2049 6620 656c 656d 656e 7420 6973  y: If element is
+00032ee0: 206e 6f74 2073 6574 2c20 616e 6420 7468   not set, and th
+00032ef0: 6973 2068 6173 2061 2054 696d 6520 5374  is has a Time St
+00032f00: 7275 6374 7572 6545 6c65 6d65 6e74 2c20  ructureElement, 
+00032f10: 7468 656e 2074 6865 2064 6179 206f 6620  then the day of 
+00032f20: 7468 6520 756e 6465 726c 7969 6e67 2065  the underlying e
+00032f30: 6c65 6d65 6e74 2e20 5365 6520 456c 656d  lement. See Elem
+00032f40: 656e 742e 6461 7920 6170 6920 646f 6375  ent.day api docu
+00032f50: 6d65 6e74 6174 696f 6e20 666f 7220 6465  mentation for de
+00032f60: 7461 696c 732e 0d0a 2020 2020 2020 2020  tails...        
+00032f70: 3a70 6172 616d 2069 6e74 6572 7661 6c5f  :param interval_
+00032f80: 696e 6465 783a 2049 6620 656c 656d 656e  index: If elemen
+00032f90: 7420 6973 206e 6f74 2073 6574 2c20 616e  t is not set, an
+00032fa0: 6420 7468 6973 2068 6173 2061 2054 696d  d this has a Tim
+00032fb0: 6520 5374 7275 6374 7572 6545 6c65 6d65  e StructureEleme
+00032fc0: 6e74 2c20 7468 656e 2074 6865 2069 6e74  nt, then the int
+00032fd0: 6572 7661 6c5f 696e 6465 7820 6f66 2074  erval_index of t
+00032fe0: 6865 2075 6e64 6572 6c79 696e 6720 656c  he underlying el
+00032ff0: 656d 656e 742e 2053 6565 2045 6c65 6d65  ement. See Eleme
+00033000: 6e74 2e69 6e74 6572 7661 6c5f 696e 6465  nt.interval_inde
+00033010: 7820 6170 6920 646f 6375 6d65 6e74 6174  x api documentat
+00033020: 696f 6e20 666f 7220 6465 7461 696c 732e  ion for details.
+00033030: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00033040: 2069 735f 726f 6f74 3a20 5365 7420 7468   is_root: Set th
+00033050: 6973 2074 6f20 5472 7565 2069 6620 7468  is to True if th
+00033060: 6520 5374 7275 6374 7572 6545 6c65 6d65  e StructureEleme
+00033070: 6e74 2069 7320 6120 726f 6f74 2065 6c65  nt is a root ele
+00033080: 6d65 6e74 2069 6e20 7468 6520 6869 6572  ment in the hier
+00033090: 6172 6368 792e 2054 6869 7320 7769 6c6c  archy. This will
+000330a0: 2061 7574 6f6d 6174 6963 616c 6c79 2067   automatically g
+000330b0: 6574 2073 6574 2074 6f20 4661 6c73 6520  et set to False 
+000330c0: 6f6e 6365 2061 2070 6172 656e 7420 6973  once a parent is
+000330d0: 2073 6574 206f 6e20 7468 6973 2045 6c65   set on this Ele
+000330e0: 6d65 6e74 2e0d 0a0d 0a20 2020 2020 2020  ment.....       
+000330f0: 2027 2727 0d0a 2020 2020 2020 2020 6173   '''..        as
+00033100: 7365 7274 2073 686f 7274 6e61 6d65 2069  sert shortname i
+00033110: 7320 6e6f 7420 4e6f 6e65 206f 7220 656c  s not None or el
+00033120: 656d 656e 7420 6973 206e 6f74 204e 6f6e  ement is not Non
+00033130: 650d 0a0d 0a20 2020 2020 2020 2073 656c  e....        sel
+00033140: 662e 5f73 7472 7563 7475 7265 203d 204e  f._structure = N
+00033150: 6f6e 650d 0a0d 0a20 2020 2020 2020 2073  one....        s
+00033160: 656c 662e 5f70 6172 656e 745f 7374 7275  elf._parent_stru
+00033170: 6374 7572 655f 656c 656d 656e 743d 4e6f  cture_element=No
+00033180: 6e65 0d0a 2020 2020 2020 2020 7365 6c66  ne..        self
+00033190: 2e5f 6368 696c 645f 7374 7275 6374 7572  ._child_structur
+000331a0: 655f 656c 656d 656e 7473 203d 205b 5d0d  e_elements = [].
+000331b0: 0a0d 0a0d 0a20 2020 2020 2020 2023 6164  .....        #ad
+000331c0: 6420 7365 6c66 2074 6f20 7374 7275 6374  d self to struct
+000331d0: 7572 650d 0a20 2020 2020 2020 2069 6620  ure..        if 
+000331e0: 7061 7265 6e74 5f73 7472 7563 7475 7265  parent_structure
+000331f0: 5f65 6c65 6d65 6e74 2069 7320 6e6f 7420  _element is not 
+00033200: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00033210: 2020 2073 656c 662e 7374 7275 6374 7572     self.structur
+00033220: 653d 7061 7265 6e74 5f73 7472 7563 7475  e=parent_structu
+00033230: 7265 5f65 6c65 6d65 6e74 2e73 7472 7563  re_element.struc
+00033240: 7475 7265 0d0a 2020 2020 2020 2020 656c  ture..        el
+00033250: 6966 2073 7472 7563 7475 7265 2069 7320  if structure is 
+00033260: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+00033270: 2020 2020 2020 2073 656c 662e 7374 7275         self.stru
+00033280: 6374 7572 653d 7374 7275 6374 7572 650d  cture=structure.
+00033290: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+000332a0: 5f65 6c65 6d65 6e74 203d 204e 6f6e 650d  _element = None.
+000332b0: 0a0d 0a20 2020 2020 2020 2069 6620 656c  ...        if el
+000332c0: 656d 656e 7420 6973 206e 6f74 204e 6f6e  ement is not Non
+000332d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000332e0: 7365 6c66 2e65 6c65 6d65 6e74 3d65 6c65  self.element=ele
+000332f0: 6d65 6e74 0d0a 2020 2020 2020 2020 656c  ment..        el
+00033300: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00033310: 2023 696e 6974 6961 6c69 7365 2074 6865   #initialise the
+00033320: 2045 6c65 6d65 6e74 0d0a 2020 2020 2020   Element..      
+00033330: 2020 2020 2020 6966 2079 6561 7220 6973        if year is
+00033340: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+00033350: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00033360: 2e65 6c65 6d65 6e74 3d54 696d 6545 6c65  .element=TimeEle
+00033370: 6d65 6e74 286c 6f6e 676e 616d 653d 6c6f  ment(longname=lo
+00033380: 6e67 6e61 6d65 0d0a 2020 2020 2020 2020  ngname..        
 00033390: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000333a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000333b0: 2020 2020 2020 2020 2c6d 6f6e 7468 3d6d          ,month=m
-000333c0: 6f6e 7468 0d0a 2020 2020 2020 2020 2020  onth..          
+000333b0: 2c79 6561 723d 7965 6172 0d0a 2020 2020  ,year=year..    
+000333c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000333d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000333e0: 2020 2020 2020 2020 2020 2020 2020 2c64                ,d
-000333f0: 6179 3d64 6179 0d0a 2020 2020 2020 2020  ay=day..        
+000333e0: 2020 2020 2c6d 6f6e 7468 3d6d 6f6e 7468      ,month=month
+000333f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 00033400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033420: 2c69 6e74 6572 7661 6c5f 696e 6465 783d  ,interval_index=
-00033430: 696e 7465 7276 616c 5f69 6e64 6578 0d0a  interval_index..
-00033440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033460: 2020 2020 2020 2020 2c64 696d 656e 7369          ,dimensi
-00033470: 6f6e 3d73 656c 662e 6469 6d65 6e73 696f  on=self.dimensio
-00033480: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
-00033490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000334a0: 2020 2020 2020 2020 2020 2029 0d0a 2020             )..  
-000334b0: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
-000334c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000334d0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-000334e0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000334f0: 656c 656d 656e 7420 3d20 7365 6c66 2e73  element = self.s
-00033500: 7472 7563 7475 7265 2e64 696d 656e 7369  tructure.dimensi
-00033510: 6f6e 2e65 6c65 6d65 6e74 735b 7368 6f72  on.elements[shor
-00033520: 746e 616d 655d 0d0a 2020 2020 2020 2020  tname]..        
-00033530: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-00033540: 6579 4572 726f 723a 0d0a 0d0a 2020 2020  eyError:....    
-00033550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033560: 7365 6c66 2e65 6c65 6d65 6e74 3d45 6c65  self.element=Ele
-00033570: 6d65 6e74 2873 686f 7274 6e61 6d65 3d73  ment(shortname=s
-00033580: 686f 7274 6e61 6d65 0d0a 2020 2020 2020  hortname..      
-00033590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000335a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000335b0: 2020 2c6c 6f6e 676e 616d 653d 6c6f 6e67    ,longname=long
-000335c0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-000335d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000335e0: 2020 2020 2020 2020 2020 2020 2020 2c70                ,p
-000335f0: 6879 7369 643d 7068 7973 6964 0d0a 2020  hysid=physid..  
+00033410: 2020 2020 2020 2020 2020 2c64 6179 3d64            ,day=d
+00033420: 6179 0d0a 2020 2020 2020 2020 2020 2020  ay..            
+00033430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033440: 2020 2020 2020 2020 2020 2020 2c69 6e74              ,int
+00033450: 6572 7661 6c5f 696e 6465 783d 696e 7465  erval_index=inte
+00033460: 7276 616c 5f69 6e64 6578 0d0a 2020 2020  rval_index..    
+00033470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033490: 2020 2020 2c64 696d 656e 7369 6f6e 3d73      ,dimension=s
+000334a0: 656c 662e 6469 6d65 6e73 696f 6e0d 0a20  elf.dimension.. 
+000334b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000334c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000334d0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
+000334e0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000334f0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00033500: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00033510: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
+00033520: 656e 7420 3d20 7365 6c66 2e73 7472 7563  ent = self.struc
+00033530: 7475 7265 2e64 696d 656e 7369 6f6e 2e65  ture.dimension.e
+00033540: 6c65 6d65 6e74 735b 7368 6f72 746e 616d  lements[shortnam
+00033550: 655d 0d0a 2020 2020 2020 2020 2020 2020  e]..            
+00033560: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+00033570: 726f 723a 0d0a 0d0a 2020 2020 2020 2020  ror:....        
+00033580: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00033590: 2e65 6c65 6d65 6e74 3d45 6c65 6d65 6e74  .element=Element
+000335a0: 2873 686f 7274 6e61 6d65 3d73 686f 7274  (shortname=short
+000335b0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+000335c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000335d0: 2020 2020 2020 2020 2020 2020 2020 2c6c                ,l
+000335e0: 6f6e 676e 616d 653d 6c6f 6e67 6e61 6d65  ongname=longname
+000335f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 00033600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033620: 2020 2020 2020 2c64 696d 656e 7369 6f6e        ,dimension
-00033630: 3d73 656c 662e 7374 7275 6374 7572 652e  =self.structure.
-00033640: 6469 6d65 6e73 696f 6e0d 0a20 2020 2020  dimension..     
-00033650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033670: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
-00033680: 7365 6c66 2e69 735f 726f 6f74 3d69 735f  self.is_root=is_
-00033690: 726f 6f74 0d0a 0d0a 2020 2020 2020 2020  root....        
-000336a0: 2353 6574 2070 6172 656e 7420 6166 7465  #Set parent afte
-000336b0: 7220 7765 2068 6176 6520 6372 6561 7465  r we have create
-000336c0: 6420 7468 6520 456c 656d 656e 7420 2d20  d the Element - 
-000336d0: 6f74 6865 7277 6973 6520 6974 2064 6f65  otherwise it doe
-000336e0: 736e 2774 2077 6f72 6b0d 0a20 2020 2020  sn't work..     
-000336f0: 2020 2073 656c 662e 7365 745f 7061 7265     self.set_pare
-00033700: 6e74 2870 6172 656e 745f 7374 7275 6374  nt(parent_struct
-00033710: 7572 655f 656c 656d 656e 7429 0d0a 0d0a  ure_element)....
-00033720: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00033730: 7374 7275 6374 7572 6520 6973 206e 6f74  structure is not
-00033740: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00033750: 2020 2020 7365 6c66 2e73 7472 7563 7475      self.structu
-00033760: 7265 2e5f 6164 645f 656c 656d 656e 7428  re._add_element(
-00033770: 7365 6c66 290d 0a0d 0a20 2020 2020 2020  self)....       
-00033780: 2023 4d61 6769 6320 6f62 6a65 6374 2077   #Magic object w
-00033790: 6869 6368 206d 616b 6573 2063 6869 6c64  hich makes child
-000337a0: 7265 6e20 6265 6861 7665 2061 7320 7765  ren behave as we
-000337b0: 2077 6f75 6c64 2077 616e 7420 7468 656d   would want them
-000337c0: 2074 6f0d 0a20 2020 2020 2020 2073 656c   to..        sel
-000337d0: 662e 5f63 6869 6c64 7265 6e20 3d20 5374  f._children = St
-000337e0: 7275 6374 7572 6545 6c65 6d65 6e74 4368  ructureElementCh
-000337f0: 696c 6472 656e 2873 656c 6629 0d0a 0d0a  ildren(self)....
-00033800: 2020 2020 2020 2020 234d 6167 6963 206f          #Magic o
-00033810: 626a 6563 7420 7768 6963 6820 6d61 6b65  bject which make
-00033820: 7320 6465 7363 656e 6461 6e74 7320 6265  s descendants be
-00033830: 6861 7665 2061 7320 7765 2077 6f75 6c64  have as we would
-00033840: 2077 616e 7420 7468 656d 2074 6f0d 0a20   want them to.. 
-00033850: 2020 2020 2020 2073 656c 662e 5f64 6573         self._des
-00033860: 6365 6e64 616e 7473 203d 205f 5374 7275  cendants = _Stru
-00033870: 6374 7572 6545 6c65 6d65 6e74 4465 7363  ctureElementDesc
-00033880: 656e 6461 6e74 7347 6574 7465 7228 7365  endantsGetter(se
-00033890: 6c66 290d 0a0d 0a20 2020 2020 2020 2073  lf)....        s
-000338a0: 656c 662e 736f 7274 5f66 756e 6374 696f  elf.sort_functio
-000338b0: 6e3d 4e6f 6e65 0d0a 0d0a 0d0a 2020 2020  n=None......    
-000338c0: 6465 6620 7365 745f 736f 7274 5f66 756e  def set_sort_fun
-000338d0: 6374 696f 6e28 7365 6c66 2c73 6f72 745f  ction(self,sort_
-000338e0: 6675 6e63 7469 6f6e 293a 0d0a 2020 2020  function):..    
-000338f0: 2020 2020 2727 2744 6570 7265 6361 7465      '''Deprecate
-00033900: 6420 2d20 7468 6520 736f 7274 2066 756e  d - the sort fun
-00033910: 6374 696f 6e20 6973 206e 6f20 6c6f 6e67  ction is no long
-00033920: 6572 2075 7365 6427 2727 0d0a 2020 2020  er used'''..    
-00033930: 2020 2020 7365 6c66 2e73 6f72 745f 6675      self.sort_fu
-00033940: 6e63 7469 6f6e 3d73 6f72 745f 6675 6e63  nction=sort_func
-00033950: 7469 6f6e 0d0a 0d0a 2020 2020 4070 726f  tion....    @pro
-00033960: 7065 7274 790d 0a20 2020 2064 6566 2073  perty..    def s
-00033970: 7472 7563 7475 7265 2873 656c 6629 3a0d  tructure(self):.
-00033980: 0a20 2020 2020 2020 2027 2727 5468 6520  .        '''The 
-00033990: 456d 706f 7765 7220 5374 7275 6374 7572  Empower Structur
-000339a0: 6520 7468 6174 2074 6869 7320 5374 7275  e that this Stru
-000339b0: 6374 7572 6545 6c65 6d74 6e20 6265 6c6f  ctureElemtn belo
-000339c0: 6e67 7320 746f 2e20 5768 656e 2074 6869  ngs to. When thi
-000339d0: 7320 6973 2073 6574 2c20 616c 6c20 6368  s is set, all ch
-000339e0: 696c 6472 656e 2068 6176 6520 7468 6569  ildren have thei
-000339f0: 7220 7374 7275 6374 7572 6520 7365 7420  r structure set 
-00033a00: 746f 2074 6865 2073 616d 6520 5374 7275  to the same Stru
-00033a10: 6374 7572 6527 2727 0d0a 2020 2020 2020  cture'''..      
-00033a20: 2020 7265 7475 726e 2073 656c 662e 5f73    return self._s
-00033a30: 7472 7563 7475 7265 0d0a 0d0a 2020 2020  tructure....    
-00033a40: 4073 7472 7563 7475 7265 2e73 6574 7465  @structure.sette
-00033a50: 720d 0a20 2020 2064 6566 2073 7472 7563  r..    def struc
-00033a60: 7475 7265 2873 656c 662c 7661 6c29 3a0d  ture(self,val):.
-00033a70: 0a20 2020 2020 2020 2073 656c 662e 5f73  .        self._s
-00033a80: 7472 7563 7475 7265 203d 2076 616c 0d0a  tructure = val..
-00033a90: 0d0a 2020 2020 2020 2020 2349 6620 7765  ..        #If we
-00033aa0: 2068 6176 6520 7365 7420 7570 2063 6869   have set up chi
-00033ab0: 6c64 7265 6e20 616c 7265 6164 792c 2074  ldren already, t
-00033ac0: 6865 6e20 6368 616e 6765 2074 6865 6972  hen change their
-00033ad0: 2073 7472 7563 7475 7265 0d0a 2020 2020   structure..    
-00033ae0: 2020 2020 2349 6620 6e6f 742c 2077 6520      #If not, we 
-00033af0: 7769 6c6c 2063 6861 6e67 6520 7468 6520  will change the 
-00033b00: 6368 696c 6472 656e 2773 2073 7472 7563  children's struc
-00033b10: 7475 7265 2077 6865 6e20 7468 6579 2067  ture when they g
-00033b20: 6574 2073 6574 0d0a 2020 2020 2020 2020  et set..        
-00033b30: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-00033b40: 2020 666f 7220 6368 2069 6e20 7365 6c66    for ch in self
-00033b50: 2e63 6869 6c64 7265 6e3a 0d0a 2020 2020  .children:..    
-00033b60: 2020 2020 2020 2020 2020 2020 6368 2e73              ch.s
-00033b70: 7472 7563 7475 7265 203d 2076 616c 0d0a  tructure = val..
-00033b80: 2020 2020 2020 2020 6578 6365 7074 2041          except A
-00033b90: 7474 7269 6275 7465 4572 726f 723a 0d0a  ttributeError:..
-00033ba0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00033bb0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-00033bc0: 790d 0a20 2020 2064 6566 2065 6c65 6d65  y..    def eleme
-00033bd0: 6e74 2873 656c 6629 3a0d 0a20 2020 2020  nt(self):..     
-00033be0: 2020 2027 2727 5468 6520 456d 706f 7765     '''The Empowe
-00033bf0: 7220 456c 656d 656e 7420 756e 6465 7270  r Element underp
-00033c00: 696e 6e69 6e67 2074 6869 7320 5374 7275  inning this Stru
-00033c10: 6374 7572 6545 6c65 6d65 6e74 2727 270d  ctureElement'''.
-00033c20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00033c30: 7365 6c66 2e5f 656c 656d 656e 740d 0a0d  self._element...
-00033c40: 0a20 2020 2040 656c 656d 656e 742e 7365  .    @element.se
-00033c50: 7474 6572 0d0a 2020 2020 6465 6620 656c  tter..    def el
-00033c60: 656d 656e 7428 7365 6c66 2c76 616c 293a  ement(self,val):
-00033c70: 0d0a 0d0a 2020 2020 2020 2020 7472 793a  ....        try:
-00033c80: 0d0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-00033c90: 6c20 3d20 7365 6c66 2e73 7472 7563 7475  l = self.structu
-00033ca0: 7265 2e64 696d 656e 7369 6f6e 2e65 6c65  re.dimension.ele
-00033cb0: 6d65 6e74 735b 7661 6c2e 7368 6f72 7463  ments[val.shortc
-00033cc0: 6f64 655d 0d0a 2020 2020 2020 2020 6578  ode]..        ex
-00033cd0: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
-00033ce0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00033610: 2020 2020 2020 2020 2020 2c70 6879 7369            ,physi
+00033620: 643d 7068 7973 6964 0d0a 2020 2020 2020  d=physid..      
+00033630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033650: 2020 2c64 696d 656e 7369 6f6e 3d73 656c    ,dimension=sel
+00033660: 662e 7374 7275 6374 7572 652e 6469 6d65  f.structure.dime
+00033670: 6e73 696f 6e0d 0a20 2020 2020 2020 2020  nsion..         
+00033680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033690: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000336a0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+000336b0: 2e69 735f 726f 6f74 3d69 735f 726f 6f74  .is_root=is_root
+000336c0: 0d0a 0d0a 2020 2020 2020 2020 2353 6574  ....        #Set
+000336d0: 2070 6172 656e 7420 6166 7465 7220 7765   parent after we
+000336e0: 2068 6176 6520 6372 6561 7465 6420 7468   have created th
+000336f0: 6520 456c 656d 656e 7420 2d20 6f74 6865  e Element - othe
+00033700: 7277 6973 6520 6974 2064 6f65 736e 2774  rwise it doesn't
+00033710: 2077 6f72 6b0d 0a20 2020 2020 2020 2073   work..        s
+00033720: 656c 662e 7365 745f 7061 7265 6e74 2870  elf.set_parent(p
+00033730: 6172 656e 745f 7374 7275 6374 7572 655f  arent_structure_
+00033740: 656c 656d 656e 7429 0d0a 0d0a 2020 2020  element)....    
+00033750: 2020 2020 6966 2073 656c 662e 7374 7275      if self.stru
+00033760: 6374 7572 6520 6973 206e 6f74 204e 6f6e  cture is not Non
+00033770: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00033780: 7365 6c66 2e73 7472 7563 7475 7265 2e5f  self.structure._
+00033790: 6164 645f 656c 656d 656e 7428 7365 6c66  add_element(self
+000337a0: 290d 0a0d 0a20 2020 2020 2020 2023 4d61  )....        #Ma
+000337b0: 6769 6320 6f62 6a65 6374 2077 6869 6368  gic object which
+000337c0: 206d 616b 6573 2063 6869 6c64 7265 6e20   makes children 
+000337d0: 6265 6861 7665 2061 7320 7765 2077 6f75  behave as we wou
+000337e0: 6c64 2077 616e 7420 7468 656d 2074 6f0d  ld want them to.
+000337f0: 0a20 2020 2020 2020 2073 656c 662e 5f63  .        self._c
+00033800: 6869 6c64 7265 6e20 3d20 5374 7275 6374  hildren = Struct
+00033810: 7572 6545 6c65 6d65 6e74 4368 696c 6472  ureElementChildr
+00033820: 656e 2873 656c 6629 0d0a 0d0a 2020 2020  en(self)....    
+00033830: 2020 2020 234d 6167 6963 206f 626a 6563      #Magic objec
+00033840: 7420 7768 6963 6820 6d61 6b65 7320 6465  t which makes de
+00033850: 7363 656e 6461 6e74 7320 6265 6861 7665  scendants behave
+00033860: 2061 7320 7765 2077 6f75 6c64 2077 616e   as we would wan
+00033870: 7420 7468 656d 2074 6f0d 0a20 2020 2020  t them to..     
+00033880: 2020 2073 656c 662e 5f64 6573 6365 6e64     self._descend
+00033890: 616e 7473 203d 205f 5374 7275 6374 7572  ants = _Structur
+000338a0: 6545 6c65 6d65 6e74 4465 7363 656e 6461  eElementDescenda
+000338b0: 6e74 7347 6574 7465 7228 7365 6c66 290d  ntsGetter(self).
+000338c0: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+000338d0: 736f 7274 5f66 756e 6374 696f 6e3d 4e6f  sort_function=No
+000338e0: 6e65 0d0a 0d0a 0d0a 2020 2020 6465 6620  ne......    def 
+000338f0: 7365 745f 736f 7274 5f66 756e 6374 696f  set_sort_functio
+00033900: 6e28 7365 6c66 2c73 6f72 745f 6675 6e63  n(self,sort_func
+00033910: 7469 6f6e 293a 0d0a 2020 2020 2020 2020  tion):..        
+00033920: 2727 2744 6570 7265 6361 7465 6420 2d20  '''Deprecated - 
+00033930: 7468 6520 736f 7274 2066 756e 6374 696f  the sort functio
+00033940: 6e20 6973 206e 6f20 6c6f 6e67 6572 2075  n is no longer u
+00033950: 7365 6427 2727 0d0a 2020 2020 2020 2020  sed'''..        
+00033960: 7365 6c66 2e73 6f72 745f 6675 6e63 7469  self.sort_functi
+00033970: 6f6e 3d73 6f72 745f 6675 6e63 7469 6f6e  on=sort_function
+00033980: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+00033990: 790d 0a20 2020 2064 6566 2073 7472 7563  y..    def struc
+000339a0: 7475 7265 2873 656c 6629 3a0d 0a20 2020  ture(self):..   
+000339b0: 2020 2020 2027 2727 5468 6520 456d 706f       '''The Empo
+000339c0: 7765 7220 5374 7275 6374 7572 6520 7468  wer Structure th
+000339d0: 6174 2074 6869 7320 5374 7275 6374 7572  at this Structur
+000339e0: 6545 6c65 6d74 6e20 6265 6c6f 6e67 7320  eElemtn belongs 
+000339f0: 746f 2e20 5768 656e 2074 6869 7320 6973  to. When this is
+00033a00: 2073 6574 2c20 616c 6c20 6368 696c 6472   set, all childr
+00033a10: 656e 2068 6176 6520 7468 6569 7220 7374  en have their st
+00033a20: 7275 6374 7572 6520 7365 7420 746f 2074  ructure set to t
+00033a30: 6865 2073 616d 6520 5374 7275 6374 7572  he same Structur
+00033a40: 6527 2727 0d0a 2020 2020 2020 2020 7265  e'''..        re
+00033a50: 7475 726e 2073 656c 662e 5f73 7472 7563  turn self._struc
+00033a60: 7475 7265 0d0a 0d0a 2020 2020 4073 7472  ture....    @str
+00033a70: 7563 7475 7265 2e73 6574 7465 720d 0a20  ucture.setter.. 
+00033a80: 2020 2064 6566 2073 7472 7563 7475 7265     def structure
+00033a90: 2873 656c 662c 7661 6c29 3a0d 0a20 2020  (self,val):..   
+00033aa0: 2020 2020 2073 656c 662e 5f73 7472 7563       self._struc
+00033ab0: 7475 7265 203d 2076 616c 0d0a 0d0a 2020  ture = val....  
+00033ac0: 2020 2020 2020 2349 6620 7765 2068 6176        #If we hav
+00033ad0: 6520 7365 7420 7570 2063 6869 6c64 7265  e set up childre
+00033ae0: 6e20 616c 7265 6164 792c 2074 6865 6e20  n already, then 
+00033af0: 6368 616e 6765 2074 6865 6972 2073 7472  change their str
+00033b00: 7563 7475 7265 0d0a 2020 2020 2020 2020  ucture..        
+00033b10: 2349 6620 6e6f 742c 2077 6520 7769 6c6c  #If not, we will
+00033b20: 2063 6861 6e67 6520 7468 6520 6368 696c   change the chil
+00033b30: 6472 656e 2773 2073 7472 7563 7475 7265  dren's structure
+00033b40: 2077 6865 6e20 7468 6579 2067 6574 2073   when they get s
+00033b50: 6574 0d0a 2020 2020 2020 2020 7472 793a  et..        try:
+00033b60: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00033b70: 7220 6368 2069 6e20 7365 6c66 2e63 6869  r ch in self.chi
+00033b80: 6c64 7265 6e3a 0d0a 2020 2020 2020 2020  ldren:..        
+00033b90: 2020 2020 2020 2020 6368 2e73 7472 7563          ch.struc
+00033ba0: 7475 7265 203d 2076 616c 0d0a 2020 2020  ture = val..    
+00033bb0: 2020 2020 6578 6365 7074 2041 7474 7269      except Attri
+00033bc0: 6275 7465 4572 726f 723a 0d0a 2020 2020  buteError:..    
+00033bd0: 2020 2020 2020 2020 7061 7373 0d0a 0d0a          pass....
+00033be0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+00033bf0: 2020 2064 6566 2065 6c65 6d65 6e74 2873     def element(s
+00033c00: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
+00033c10: 2727 5468 6520 456d 706f 7765 7220 456c  ''The Empower El
+00033c20: 656d 656e 7420 756e 6465 7270 696e 6e69  ement underpinni
+00033c30: 6e67 2074 6869 7320 5374 7275 6374 7572  ng this Structur
+00033c40: 6545 6c65 6d65 6e74 2727 270d 0a20 2020  eElement'''..   
+00033c50: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00033c60: 2e5f 656c 656d 656e 740d 0a0d 0a20 2020  ._element....   
+00033c70: 2040 656c 656d 656e 742e 7365 7474 6572   @element.setter
+00033c80: 0d0a 2020 2020 6465 6620 656c 656d 656e  ..    def elemen
+00033c90: 7428 7365 6c66 2c76 616c 293a 0d0a 0d0a  t(self,val):....
+00033ca0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00033cb0: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
+00033cc0: 7365 6c66 2e73 7472 7563 7475 7265 2e64  self.structure.d
+00033cd0: 696d 656e 7369 6f6e 2e65 6c65 6d65 6e74  imension.element
+00033ce0: 735b 7661 6c2e 7368 6f72 7463 6f64 655d  s[val.shortcode]
 00033cf0: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-00033d00: 2041 7474 7269 6275 7465 4572 726f 723a   AttributeError:
-00033d10: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-00033d20: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00033d30: 2020 2020 7661 6c20 3d20 7661 6c2e 6469      val = val.di
-00033d40: 6d65 6e73 696f 6e2e 656c 656d 656e 7473  mension.elements
-00033d50: 5b76 616c 2e73 686f 7274 636f 6465 5d0d  [val.shortcode].
-00033d60: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-00033d70: 6570 7420 4b65 7945 7272 6f72 3a0d 0a20  ept KeyError:.. 
-00033d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00033d90: 2020 2070 6173 730d 0a0d 0a20 2020 2020     pass....     
-00033da0: 2020 2069 6620 6e6f 7420 7661 6c2e 6d61     if not val.ma
-00033db0: 7374 6572 6564 3a0d 0a20 2020 2020 2020  stered:..       
-00033dc0: 2020 2020 2072 6169 7365 2041 7474 7269       raise Attri
-00033dd0: 6275 7465 4572 726f 7228 2243 616e 6e6f  buteError("Canno
-00033de0: 7420 7365 7420 6120 5374 7275 6374 7572  t set a Structur
-00033df0: 6545 6c65 6d65 6e74 2773 202e 656c 656d  eElement's .elem
-00033e00: 656e 7420 756e 7469 6c20 7468 6174 2045  ent until that E
-00033e10: 6c65 6d65 6e74 2068 6173 2062 6565 6e20  lement has been 
-00033e20: 7379 6e63 6872 6f6e 6973 6564 2e20 5573  synchronised. Us
-00033e30: 6520 4469 6d65 6e73 696f 6e2e 656c 656d  e Dimension.elem
-00033e40: 656e 7473 2e73 796e 6368 726f 6e69 7365  ents.synchronise
-00033e50: 2829 2062 6566 6f72 6520 6164 6469 6e67  () before adding
-00033e60: 2074 6865 2065 6c65 6d65 6e74 2073 686f   the element sho
-00033e70: 7274 6e61 6d65 3a7b 7d2c 206c 6f6e 676e  rtname:{}, longn
-00033e80: 616d 653a 207b 7d20 6d61 7374 6572 6564  ame: {} mastered
-00033e90: 3a20 7b7d 2c20 6669 656c 6473 3a20 7b7d  : {}, fields: {}
-00033ea0: 222e 666f 726d 6174 2876 616c 2e73 686f  ".format(val.sho
-00033eb0: 7274 636f 6465 2c76 616c 2e6c 6f6e 676e  rtcode,val.longn
-00033ec0: 616d 652c 7661 6c2e 6d61 7374 6572 6564  ame,val.mastered
-00033ed0: 2c64 6963 7428 7661 6c2e 6669 656c 6473  ,dict(val.fields
-00033ee0: 2929 290d 0a0d 0a20 2020 2020 2020 2073  )))....        s
-00033ef0: 656c 662e 5f65 6c65 6d65 6e74 203d 7661  elf._element =va
-00033f00: 6c0d 0a0d 0a20 2020 2040 7072 6f70 6572  l....    @proper
-00033f10: 7479 0d0a 2020 2020 6465 6620 7368 6f72  ty..    def shor
-00033f20: 7463 6f64 6528 7365 6c66 293a 0d0a 2020  tcode(self):..  
-00033f30: 2020 2020 2020 2727 2754 6865 2073 686f        '''The sho
-00033f40: 7274 6e61 6d65 206f 6620 7468 6520 456d  rtname of the Em
-00033f50: 706f 7765 7220 456c 656d 656e 7420 756e  power Element un
-00033f60: 6465 7270 696e 6e69 6e67 2074 6869 7320  derpinning this 
-00033f70: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-00033f80: 2727 270d 0a20 2020 2020 2020 2072 6574  '''..        ret
-00033f90: 7572 6e20 7365 6c66 2e65 6c65 6d65 6e74  urn self.element
-00033fa0: 2e73 686f 7274 6e61 6d65 0d0a 0d0a 2020  .shortname....  
-00033fb0: 2020 4073 686f 7274 636f 6465 2e73 6574    @shortcode.set
-00033fc0: 7465 720d 0a20 2020 2064 6566 2073 686f  ter..    def sho
-00033fd0: 7274 636f 6465 2873 656c 662c 7661 6c29  rtcode(self,val)
-00033fe0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-00033ff0: 656c 656d 656e 742e 7368 6f72 746e 616d  element.shortnam
-00034000: 653d 7661 6c0d 0a0d 0a20 2020 2040 7072  e=val....    @pr
-00034010: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-00034020: 7368 6f72 746e 616d 6528 7365 6c66 293a  shortname(self):
-00034030: 0d0a 2020 2020 2020 2020 2727 2754 6865  ..        '''The
-00034040: 2073 686f 7274 6e61 6d65 206f 6620 7468   shortname of th
-00034050: 6520 456d 706f 7765 7220 456c 656d 656e  e Empower Elemen
-00034060: 7420 756e 6465 7270 696e 6e69 6e67 2074  t underpinning t
-00034070: 6869 7320 5374 7275 6374 7572 6545 6c65  his StructureEle
-00034080: 6d65 6e74 2727 270d 0a20 2020 2020 2020  ment'''..       
-00034090: 2072 6574 7572 6e20 7365 6c66 2e65 6c65   return self.ele
-000340a0: 6d65 6e74 2e73 686f 7274 6e61 6d65 0d0a  ment.shortname..
-000340b0: 0d0a 2020 2020 4073 686f 7274 6e61 6d65  ..    @shortname
-000340c0: 2e73 6574 7465 720d 0a20 2020 2064 6566  .setter..    def
-000340d0: 2073 686f 7274 6e61 6d65 2873 656c 662c   shortname(self,
-000340e0: 7661 6c29 3a0d 0a20 2020 2020 2020 2073  val):..        s
-000340f0: 656c 662e 656c 656d 656e 742e 7368 6f72  elf.element.shor
-00034100: 746e 616d 653d 7661 6c0d 0a0d 0a20 2020  tname=val....   
-00034110: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-00034120: 6465 6620 6c6f 6e67 6e61 6d65 2873 656c  def longname(sel
-00034130: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
-00034140: 5468 6520 6c6f 6e67 6e61 6d65 206f 6620  The longname of 
-00034150: 7468 6520 456d 706f 7765 7220 456c 656d  the Empower Elem
-00034160: 656e 7420 756e 6465 7270 696e 6e69 6e67  ent underpinning
-00034170: 2074 6869 7320 5374 7275 6374 7572 6545   this StructureE
-00034180: 6c65 6d65 6e74 2727 270d 0a20 2020 2020  lement'''..     
-00034190: 2020 2072 6574 7572 6e20 7365 6c66 2e65     return self.e
-000341a0: 6c65 6d65 6e74 2e6c 6f6e 676e 616d 650d  lement.longname.
-000341b0: 0a0d 0a20 2020 2040 6c6f 6e67 6e61 6d65  ...    @longname
-000341c0: 2e73 6574 7465 720d 0a20 2020 2064 6566  .setter..    def
-000341d0: 206c 6f6e 676e 616d 6528 7365 6c66 2c76   longname(self,v
-000341e0: 616c 293a 0d0a 2020 2020 2020 2020 7365  al):..        se
-000341f0: 6c66 2e65 6c65 6d65 6e74 2e6c 6f6e 676e  lf.element.longn
-00034200: 616d 653d 7661 6c0d 0a0d 0a20 2020 2040  ame=val....    @
-00034210: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-00034220: 6620 6465 7363 7269 7074 696f 6e28 7365  f description(se
-00034230: 6c66 293a 0d0a 2020 2020 2020 2020 2727  lf):..        ''
-00034240: 2754 6865 2064 6573 6372 6970 7469 6f6e  'The description
-00034250: 206f 6620 7468 6520 456d 706f 7765 7220   of the Empower 
-00034260: 456c 656d 656e 7420 756e 6465 7270 696e  Element underpin
-00034270: 6e69 6e67 2074 6869 7320 5374 7275 6374  ning this Struct
-00034280: 7572 6545 6c65 6d65 6e74 2727 270d 0a20  ureElement'''.. 
-00034290: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000342a0: 6c66 2e65 6c65 6d65 6e74 2e64 6573 6372  lf.element.descr
-000342b0: 6970 7469 6f6e 0d0a 0d0a 2020 2020 4064  iption....    @d
-000342c0: 6573 6372 6970 7469 6f6e 2e73 6574 7465  escription.sette
-000342d0: 720d 0a20 2020 2064 6566 2064 6573 6372  r..    def descr
-000342e0: 6970 7469 6f6e 2873 656c 662c 7661 6c29  iption(self,val)
-000342f0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
-00034300: 656c 656d 656e 742e 6465 7363 7269 7074  element.descript
-00034310: 696f 6e3d 7661 6c0d 0a0d 0a20 2020 2040  ion=val....    @
-00034320: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-00034330: 6620 6772 6f75 705f 6f6e 6c79 2873 656c  f group_only(sel
-00034340: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
-00034350: 2747 726f 7570 2720 6966 2074 6869 7320  'Group' if this 
-00034360: 6973 2061 2047 726f 7570 204f 6e6c 7920  is a Group Only 
-00034370: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-00034380: 2e20 4120 4772 6f75 704f 6e6c 7920 656c  . A GroupOnly el
-00034390: 656d 656e 7420 646f 6573 206e 6f74 2068  ement does not h
-000343a0: 6176 6520 6120 6361 6c63 756c 6174 696f  ave a calculatio
-000343b0: 6e2c 2061 6e64 2063 616e 6e6f 7420 6861  n, and cannot ha
-000343c0: 7665 2064 6174 6120 6173 736f 6369 6174  ve data associat
-000343d0: 6564 2077 6974 6820 6974 2727 270d 0a20  ed with it'''.. 
-000343e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000343f0: 6c66 2e65 6c65 6d65 6e74 2e67 726f 7570  lf.element.group
-00034400: 5f6f 6e6c 790d 0a0d 0a20 2020 2040 6772  _only....    @gr
-00034410: 6f75 705f 6f6e 6c79 2e73 6574 7465 720d  oup_only.setter.
-00034420: 0a20 2020 2064 6566 2067 726f 7570 5f6f  .    def group_o
-00034430: 6e6c 7928 7365 6c66 2c76 616c 293a 0d0a  nly(self,val):..
-00034440: 2020 2020 2020 2020 7365 6c66 2e65 6c65          self.ele
-00034450: 6d65 6e74 2e67 726f 7570 5f6f 6e6c 793d  ment.group_only=
-00034460: 7661 6c0d 0a0d 0a20 2020 2040 7072 6f70  val....    @prop
-00034470: 6572 7479 0d0a 2020 2020 6465 6620 6361  erty..    def ca
-00034480: 6c63 756c 6174 696f 6e5f 7374 6174 7573  lculation_status
-00034490: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-000344a0: 2027 2727 5468 6520 6361 6c63 756c 6174   '''The calculat
-000344b0: 696f 6e5f 7374 6174 7573 206f 6620 7468  ion_status of th
-000344c0: 6520 456d 706f 7765 7220 456c 656d 656e  e Empower Elemen
-000344d0: 7420 756e 6465 7270 696e 6e69 6e67 2074  t underpinning t
-000344e0: 6869 7320 5374 7275 6374 7572 6545 6c65  his StructureEle
-000344f0: 6d65 6e74 2e20 4361 6e20 6265 206f 6e65  ment. Can be one
-00034500: 206f 6620 2752 6561 6c27 206f 7220 2743   of 'Real' or 'C
-00034510: 616c 6375 6c61 7465 6427 2028 692e 652e  alculated' (i.e.
-00034520: 2076 6972 7475 616c 292e 2727 270d 0a20   virtual).'''.. 
-00034530: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00034540: 6c66 2e65 6c65 6d65 6e74 2e63 616c 6375  lf.element.calcu
-00034550: 6c61 7469 6f6e 5f73 7461 7475 730d 0a0d  lation_status...
-00034560: 0a20 2020 2040 6361 6c63 756c 6174 696f  .    @calculatio
-00034570: 6e5f 7374 6174 7573 2e73 6574 7465 720d  n_status.setter.
-00034580: 0a20 2020 2064 6566 2063 616c 6375 6c61  .    def calcula
-00034590: 7469 6f6e 5f73 7461 7475 7328 7365 6c66  tion_status(self
-000345a0: 2c76 616c 293a 0d0a 2020 2020 2020 2020  ,val):..        
-000345b0: 7365 6c66 2e65 6c65 6d65 6e74 2e63 616c  self.element.cal
-000345c0: 6375 6c61 7469 6f6e 5f73 7461 7475 733d  culation_status=
-000345d0: 7661 6c0d 0a0d 0a20 2020 2040 7072 6f70  val....    @prop
-000345e0: 6572 7479 0d0a 2020 2020 6465 6620 6361  erty..    def ca
-000345f0: 6c63 756c 6174 696f 6e28 7365 6c66 293a  lculation(self):
-00034600: 0d0a 2020 2020 2020 2020 2727 2754 6865  ..        '''The
-00034610: 2063 616c 6375 6c61 7469 6f6e 206f 6620   calculation of 
-00034620: 7468 6520 456d 706f 7765 7220 456c 656d  the Empower Elem
-00034630: 656e 7420 756e 6465 7270 696e 6e69 6e67  ent underpinning
-00034640: 2074 6869 7320 5374 7275 6374 7572 6545   this StructureE
-00034650: 6c65 6d65 6e74 2e27 2727 0d0a 2020 2020  lement.'''..    
-00034660: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00034670: 656c 656d 656e 742e 6361 6c63 756c 6174  element.calculat
-00034680: 696f 6e0d 0a0d 0a20 2020 2040 6361 6c63  ion....    @calc
-00034690: 756c 6174 696f 6e2e 7365 7474 6572 0d0a  ulation.setter..
-000346a0: 2020 2020 6465 6620 6361 6c63 756c 6174      def calculat
-000346b0: 696f 6e28 7365 6c66 2c76 616c 293a 0d0a  ion(self,val):..
-000346c0: 2020 2020 2020 2020 7365 6c66 2e65 6c65          self.ele
-000346d0: 6d65 6e74 2e63 616c 6375 6c61 7469 6f6e  ment.calculation
-000346e0: 3d76 616c 0d0a 0d0a 2020 2020 4070 726f  =val....    @pro
-000346f0: 7065 7274 790d 0a20 2020 2064 6566 2063  perty..    def c
-00034700: 6f6c 6f75 7228 7365 6c66 293a 0d0a 2020  olour(self):..  
-00034710: 2020 2020 2020 2727 2754 6865 2063 6f6c        '''The col
-00034720: 6f75 7220 6f66 2074 6865 2045 6d70 6f77  our of the Empow
-00034730: 6572 2045 6c65 6d65 6e74 2075 6e64 6572  er Element under
-00034740: 7069 6e6e 696e 6720 7468 6973 2053 7472  pinning this Str
-00034750: 7563 7475 7265 456c 656d 656e 742e 2727  uctureElement.''
-00034760: 270d 0a20 2020 2020 2020 2072 6574 7572  '..        retur
-00034770: 6e20 7365 6c66 2e65 6c65 6d65 6e74 2e63  n self.element.c
-00034780: 6f6c 6f75 720d 0a0d 0a20 2020 2040 636f  olour....    @co
-00034790: 6c6f 7572 2e73 6574 7465 720d 0a20 2020  lour.setter..   
-000347a0: 2064 6566 2063 6f6c 6f75 7228 7365 6c66   def colour(self
-000347b0: 2c76 616c 293a 0d0a 2020 2020 2020 2020  ,val):..        
-000347c0: 7365 6c66 2e65 6c65 6d65 6e74 2e63 6f6c  self.element.col
-000347d0: 6f75 723d 7661 6c0d 0a0d 0a20 2020 2040  our=val....    @
-000347e0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-000347f0: 6620 6669 656c 6473 2873 656c 6629 3a0d  f fields(self):.
-00034800: 0a20 2020 2020 2020 2027 2727 4120 6469  .        '''A di
-00034810: 6374 696f 6e61 7279 206c 696b 6520 6f62  ctionary like ob
-00034820: 6a65 6374 2067 6976 696e 6720 6163 6365  ject giving acce
-00034830: 7373 2074 6f20 7468 6520 756e 6465 726c  ss to the underl
-00034840: 7969 6e67 2065 6c65 6d65 6e74 2773 2066  ying element's f
-00034850: 6965 6c64 732e 2053 6565 2074 6865 2061  ields. See the a
-00034860: 7069 2064 6f63 756d 656e 7461 7469 6f6e  pi documentation
-00034870: 2066 6f72 2045 6c65 6d65 6e74 2e66 6965   for Element.fie
-00034880: 6c64 7327 2727 0d0a 2020 2020 2020 2020  lds'''..        
-00034890: 7265 7475 726e 2073 656c 662e 656c 656d  return self.elem
-000348a0: 656e 742e 6669 656c 6473 0d0a 0d0a 2020  ent.fields....  
-000348b0: 2020 2344 6f6e 2774 206e 6565 6420 6120    #Don't need a 
-000348c0: 7365 7474 6572 2066 6f72 2066 6965 6c64  setter for field
-000348d0: 7320 6265 6361 7573 6520 6669 656c 6473  s because fields
-000348e0: 2069 7320 6120 6469 6374 696f 6e61 7279   is a dictionary
-000348f0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
-00034900: 790d 0a20 2020 2064 6566 2073 6563 7572  y..    def secur
-00034910: 6974 7928 7365 6c66 293a 0d0a 2020 2020  ity(self):..    
-00034920: 2020 2020 2727 2754 6865 2073 6563 7572      '''The secur
-00034930: 6974 7920 6f66 2074 6865 2075 6e64 6572  ity of the under
-00034940: 6c79 696e 6720 456c 656d 656e 742e 2053  lying Element. S
-00034950: 6565 2074 6865 2061 7069 2064 6f63 756d  ee the api docum
-00034960: 656e 7461 7469 6f6e 2066 6f72 2045 6c65  entation for Ele
-00034970: 6d65 6e74 2e73 6563 7572 6974 7920 666f  ment.security fo
-00034980: 7220 696e 666f 726d 6174 696f 6e27 2727  r information'''
-00034990: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000349a0: 2073 656c 662e 656c 656d 656e 742e 7365   self.element.se
-000349b0: 6375 7269 7479 0d0a 0d0a 2020 2020 4070  curity....    @p
-000349c0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-000349d0: 2070 6879 7369 6428 7365 6c66 293a 0d0a   physid(self):..
-000349e0: 2020 2020 2020 2020 2727 2754 6865 2070          '''The p
-000349f0: 6879 7369 6361 6c20 6964 656e 7469 7479  hysical identity
-00034a00: 206f 6620 7468 6520 756e 6465 726c 7969   of the underlyi
-00034a10: 6e67 2045 6c65 6d65 6e74 2e20 5365 6520  ng Element. See 
-00034a20: 7468 6520 6170 6920 646f 6375 6d65 6e74  the api document
-00034a30: 6174 696f 6e20 666f 7220 456c 656d 656e  ation for Elemen
-00034a40: 742e 7068 7973 6964 2066 6f72 2069 6e66  t.physid for inf
-00034a50: 6f72 6d61 7469 6f6e 2727 270d 0a20 2020  ormation'''..   
-00034a60: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00034a70: 2e65 6c65 6d65 6e74 2e70 6879 7369 640d  .element.physid.
-00034a80: 0a0d 0a20 2020 2040 7068 7973 6964 2e73  ...    @physid.s
-00034a90: 6574 7465 720d 0a20 2020 2064 6566 2070  etter..    def p
-00034aa0: 6879 7369 6428 7365 6c66 2c76 616c 293a  hysid(self,val):
-00034ab0: 0d0a 2020 2020 2020 2020 7365 6c66 2e65  ..        self.e
-00034ac0: 6c65 6d65 6e74 2e70 6879 7369 643d 7661  lement.physid=va
-00034ad0: 6c0d 0a0d 0a20 2020 2040 7072 6f70 6572  l....    @proper
-00034ae0: 7479 0d0a 2020 2020 6465 6620 7965 6172  ty..    def year
-00034af0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-00034b00: 2027 2727 466f 7220 5469 6d65 2053 7472   '''For Time Str
-00034b10: 7563 7475 7265 456c 656d 656e 7473 206f  uctureElements o
-00034b20: 6e6c 792e 2054 6865 2079 6561 7220 6f66  nly. The year of
-00034b30: 2074 6865 2075 6e64 6572 6c79 696e 6720   the underlying 
-00034b40: 5469 6d65 2045 6c65 6d65 6e74 2e20 5365  Time Element. Se
-00034b50: 6520 456c 656d 656e 742e 7965 6172 2066  e Element.year f
-00034b60: 6f72 2069 6e66 6f72 6d61 7469 6f6e 2727  or information''
-00034b70: 270d 0a20 2020 2020 2020 2072 6574 7572  '..        retur
-00034b80: 6e20 7365 6c66 2e65 6c65 6d65 6e74 2e79  n self.element.y
-00034b90: 6561 720d 0a0d 0a20 2020 2040 7965 6172  ear....    @year
-00034ba0: 2e73 6574 7465 720d 0a20 2020 2064 6566  .setter..    def
-00034bb0: 2079 6561 7228 7365 6c66 2c76 616c 293a   year(self,val):
-00034bc0: 0d0a 2020 2020 2020 2020 7365 6c66 2e65  ..        self.e
-00034bd0: 6c65 6d65 6e74 2e79 6561 723d 7661 6c0d  lement.year=val.
-00034be0: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-00034bf0: 0d0a 2020 2020 6465 6620 6d6f 6e74 6828  ..    def month(
-00034c00: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00034c10: 2727 2746 6f72 2054 696d 6520 5374 7275  '''For Time Stru
-00034c20: 6374 7572 6545 6c65 6d65 6e74 7320 6f6e  ctureElements on
-00034c30: 6c79 2e20 5468 6520 6d6f 6e74 6820 6f66  ly. The month of
-00034c40: 2074 6865 2075 6e64 6572 6c79 696e 6720   the underlying 
-00034c50: 5469 6d65 2045 6c65 6d65 6e74 2e20 5365  Time Element. Se
-00034c60: 6520 456c 656d 656e 742e 6d6f 6e74 6820  e Element.month 
-00034c70: 666f 7220 696e 666f 726d 6174 696f 6e27  for information'
-00034c80: 2727 0d0a 2020 2020 2020 2020 7265 7475  ''..        retu
-00034c90: 726e 2073 656c 662e 656c 656d 656e 742e  rn self.element.
-00034ca0: 6d6f 6e74 680d 0a0d 0a20 2020 2040 6d6f  month....    @mo
-00034cb0: 6e74 682e 7365 7474 6572 0d0a 2020 2020  nth.setter..    
-00034cc0: 6465 6620 6d6f 6e74 6828 7365 6c66 2c76  def month(self,v
-00034cd0: 616c 293a 0d0a 2020 2020 2020 2020 7365  al):..        se
-00034ce0: 6c66 2e65 6c65 6d65 6e74 2e6d 6f6e 7468  lf.element.month
-00034cf0: 3d76 616c 0d0a 0d0a 2020 2020 4070 726f  =val....    @pro
-00034d00: 7065 7274 790d 0a20 2020 2064 6566 2064  perty..    def d
-00034d10: 6179 2873 656c 6629 3a0d 0a20 2020 2020  ay(self):..     
-00034d20: 2020 2027 2727 466f 7220 5469 6d65 2053     '''For Time S
-00034d30: 7472 7563 7475 7265 456c 656d 656e 7473  tructureElements
-00034d40: 206f 6e6c 792e 2054 6865 2064 6179 206f   only. The day o
-00034d50: 6620 7468 6520 756e 6465 726c 7969 6e67  f the underlying
-00034d60: 2054 696d 6520 456c 656d 656e 742e 2053   Time Element. S
-00034d70: 6565 2045 6c65 6d65 6e74 2e64 6179 2066  ee Element.day f
-00034d80: 6f72 2069 6e66 6f72 6d61 7469 6f6e 2727  or information''
-00034d90: 270d 0a20 2020 2020 2020 2072 6574 7572  '..        retur
-00034da0: 6e20 7365 6c66 2e65 6c65 6d65 6e74 2e64  n self.element.d
-00034db0: 6179 0d0a 0d0a 2020 2020 4064 6179 2e73  ay....    @day.s
-00034dc0: 6574 7465 720d 0a20 2020 2064 6566 2064  etter..    def d
-00034dd0: 6179 2873 656c 662c 7661 6c29 3a0d 0a20  ay(self,val):.. 
-00034de0: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
-00034df0: 656e 742e 6461 793d 7661 6c0d 0a0d 0a20  ent.day=val.... 
-00034e00: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-00034e10: 2020 6465 6620 696e 7465 7276 616c 5f69    def interval_i
-00034e20: 6e64 6578 2873 656c 6629 3a0d 0a20 2020  ndex(self):..   
-00034e30: 2020 2020 2027 2727 466f 7220 5469 6d65       '''For Time
-00034e40: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
-00034e50: 7473 206f 6e6c 792e 2054 6865 2069 6e74  ts only. The int
-00034e60: 6572 7661 6c5f 696e 6465 7820 6f66 2074  erval_index of t
-00034e70: 6865 2075 6e64 6572 6c79 696e 6720 5469  he underlying Ti
-00034e80: 6d65 2045 6c65 6d65 6e74 2e20 5365 6520  me Element. See 
-00034e90: 456c 656d 656e 742e 696e 7465 7276 616c  Element.interval
-00034ea0: 5f69 6e64 6578 2066 6f72 2069 6e66 6f72  _index for infor
-00034eb0: 6d61 7469 6f6e 2727 270d 0a20 2020 2020  mation'''..     
-00034ec0: 2020 2072 6574 7572 6e20 7365 6c66 2e65     return self.e
-00034ed0: 6c65 6d65 6e74 2e69 6e74 6572 7661 6c5f  lement.interval_
-00034ee0: 696e 6465 780d 0a0d 0a20 2020 2040 696e  index....    @in
-00034ef0: 7465 7276 616c 5f69 6e64 6578 2e73 6574  terval_index.set
-00034f00: 7465 720d 0a20 2020 2064 6566 2069 6e74  ter..    def int
-00034f10: 6572 7661 6c5f 696e 6465 7828 7365 6c66  erval_index(self
-00034f20: 2c76 616c 293a 0d0a 2020 2020 2020 2020  ,val):..        
-00034f30: 7365 6c66 2e65 6c65 6d65 6e74 2e69 6e74  self.element.int
-00034f40: 6572 7661 6c5f 696e 6465 783d 7661 6c0d  erval_index=val.
-00034f50: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-00034f60: 0d0a 2020 2020 6465 6620 696e 7465 7276  ..    def interv
-00034f70: 616c 2873 656c 6629 3a0d 0a20 2020 2020  al(self):..     
-00034f80: 2020 2027 2727 466f 7220 5469 6d65 2053     '''For Time S
-00034f90: 7472 7563 7475 7265 456c 656d 656e 7473  tructureElements
-00034fa0: 206f 6e6c 792e 2054 6865 2069 6e74 6572   only. The inter
-00034fb0: 7661 6c20 6f66 2074 6865 2075 6e64 6572  val of the under
-00034fc0: 6c79 696e 6720 5469 6d65 2045 6c65 6d65  lying Time Eleme
-00034fd0: 6e74 2e20 5365 6520 456c 656d 656e 742e  nt. See Element.
-00034fe0: 696e 7465 7276 616c 2066 6f72 2069 6e66  interval for inf
-00034ff0: 6f72 6d61 7469 6f6e 2727 270d 0a20 2020  ormation'''..   
-00035000: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00035010: 2e65 6c65 6d65 6e74 2e69 6e74 6572 7661  .element.interva
-00035020: 6c0d 0a0d 0a20 2020 2040 7072 6f70 6572  l....    @proper
-00035030: 7479 0d0a 2020 2020 6465 6620 696e 7465  ty..    def inte
-00035040: 7276 616c 5f61 6d6f 756e 7428 7365 6c66  rval_amount(self
-00035050: 293a 0d0a 2020 2020 2020 2020 2727 2746  ):..        '''F
-00035060: 6f72 2054 696d 6520 5374 7275 6374 7572  or Time Structur
-00035070: 6545 6c65 6d65 6e74 7320 6f6e 6c79 2e20  eElements only. 
-00035080: 5468 6520 696e 7465 7276 616c 5f61 6d6f  The interval_amo
-00035090: 756e 7420 6f66 2074 6865 2075 6e64 6572  unt of the under
-000350a0: 6c79 696e 6720 5469 6d65 2045 6c65 6d65  lying Time Eleme
-000350b0: 6e74 2e20 5365 6520 456c 656d 656e 742e  nt. See Element.
-000350c0: 696e 7465 7276 616c 5f61 6d6f 756e 7420  interval_amount 
-000350d0: 666f 7220 696e 666f 726d 6174 696f 6e27  for information'
-000350e0: 2727 0d0a 2020 2020 2020 2020 7265 7475  ''..        retu
-000350f0: 726e 2073 656c 662e 656c 656d 656e 742e  rn self.element.
-00035100: 696e 7465 7276 616c 5f61 6d6f 756e 740d  interval_amount.
-00035110: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-00035120: 0d0a 2020 2020 6465 6620 7265 736f 6c75  ..    def resolu
-00035130: 7469 6f6e 2873 656c 6629 3a0d 0a20 2020  tion(self):..   
-00035140: 2020 2020 2027 2727 466f 7220 5469 6d65       '''For Time
-00035150: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
-00035160: 7473 206f 6e6c 792e 2054 6865 2072 6573  ts only. The res
-00035170: 6f6c 7574 696f 6e20 6f66 2074 6865 2075  olution of the u
-00035180: 6e64 6572 6c79 696e 6720 5469 6d65 2045  nderlying Time E
-00035190: 6c65 6d65 6e74 2e20 5365 6520 456c 656d  lement. See Elem
-000351a0: 656e 742e 7265 736f 6c75 7469 6f6e 2066  ent.resolution f
-000351b0: 6f72 2069 6e66 6f72 6d61 7469 6f6e 2727  or information''
-000351c0: 270d 0a20 2020 2020 2020 2072 6574 7572  '..        retur
-000351d0: 6e20 7365 6c66 2e65 6c65 6d65 6e74 2e72  n self.element.r
-000351e0: 6573 6f6c 7574 696f 6e0d 0a0d 0a20 2020  esolution....   
-000351f0: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-00035200: 6465 6620 6f66 6673 6574 2873 656c 6629  def offset(self)
-00035210: 3a0d 0a20 2020 2020 2020 2027 2727 466f  :..        '''Fo
-00035220: 7220 5469 6d65 2053 7472 7563 7475 7265  r Time Structure
-00035230: 456c 656d 656e 7473 206f 6e6c 792e 2054  Elements only. T
-00035240: 6865 206f 6666 7365 7420 6f66 2074 6865  he offset of the
-00035250: 2075 6e64 6572 6c79 696e 6720 5469 6d65   underlying Time
-00035260: 2045 6c65 6d65 6e74 2e20 5365 6520 456c   Element. See El
-00035270: 656d 656e 742e 6f66 6673 6574 2066 6f72  ement.offset for
-00035280: 2069 6e66 6f72 6d61 7469 6f6e 2727 270d   information'''.
-00035290: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000352a0: 7365 6c66 2e65 6c65 6d65 6e74 2e6f 6666  self.element.off
-000352b0: 7365 740d 0a0d 0a20 2020 2040 7072 6f70  set....    @prop
-000352c0: 6572 7479 0d0a 2020 2020 6465 6620 5f73  erty..    def _s
-000352d0: 7461 7274 5f64 6174 6528 7365 6c66 293a  tart_date(self):
-000352e0: 0d0a 2020 2020 2020 2020 2727 2746 6f72  ..        '''For
-000352f0: 2054 696d 6520 5374 7275 6374 7572 6545   Time StructureE
-00035300: 6c65 6d65 6e74 7320 6f6e 6c79 2e20 5468  lements only. Th
-00035310: 6520 2870 7269 7661 7465 2920 5f73 7461  e (private) _sta
-00035320: 7274 5f64 6174 6520 6f66 2074 6865 2075  rt_date of the u
-00035330: 6e64 6572 6c79 696e 6720 5469 6d65 2045  nderlying Time E
-00035340: 6c65 6d65 6e74 2e27 2727 0d0a 2020 2020  lement.'''..    
-00035350: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00035360: 656c 656d 656e 742e 5f73 7461 7274 5f64  element._start_d
-00035370: 6174 650d 0a0d 0a20 2020 2040 7072 6f70  ate....    @prop
-00035380: 6572 7479 0d0a 2020 2020 6465 6620 656d  erty..    def em
-00035390: 706f 7765 725f 7065 7269 6f64 5f6e 756d  power_period_num
-000353a0: 6265 7228 7365 6c66 293a 0d0a 2020 2020  ber(self):..    
-000353b0: 2020 2020 2727 2741 7070 6c69 6573 2074      '''Applies t
-000353c0: 6f20 7469 6d65 2065 6c65 6d65 6e74 7320  o time elements 
-000353d0: 6f6e 6c79 2e20 4120 7265 6164 206f 6e6c  only. A read onl
-000353e0: 7920 7072 6f70 6572 7479 2074 6861 7420  y property that 
-000353f0: 7265 7475 726e 7320 7468 6520 456d 706f  returns the Empo
-00035400: 7765 7220 5065 7269 6f64 2074 7970 6520  wer Period type 
-00035410: 6e75 6d62 6572 2028 652e 672e 2033 2066  number (e.g. 3 f
-00035420: 6f72 2061 204d 6f6e 7468 2927 2727 0d0a  or a Month)'''..
-00035430: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00035440: 656c 662e 656c 656d 656e 742e 696e 7465  elf.element.inte
-00035450: 7276 616c 5f69 6e64 6578 0d0a 0d0a 2020  rval_index....  
-00035460: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-00035470: 2064 6566 2064 696d 656e 7369 6f6e 2873   def dimension(s
-00035480: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
-00035490: 2727 5468 6520 456d 706f 7765 7220 4469  ''The Empower Di
-000354a0: 6d65 6e73 696f 6e20 7468 6973 2053 7472  mension this Str
-000354b0: 7563 7475 7265 456c 656d 656e 7420 6265  uctureElement be
-000354c0: 6c6f 6e67 7320 746f 2727 270d 0a20 2020  longs to'''..   
-000354d0: 2020 2020 2069 6620 7365 6c66 2e73 7472       if self.str
-000354e0: 7563 7475 7265 2069 7320 6e6f 7420 4e6f  ucture is not No
-000354f0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00035500: 2072 6574 7572 6e20 7365 6c66 2e73 7472   return self.str
-00035510: 7563 7475 7265 2e64 696d 656e 7369 6f6e  ucture.dimension
-00035520: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00035530: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00035540: 7572 6e20 7365 6c66 2e65 6c65 6d65 6e74  urn self.element
-00035550: 2e64 696d 656e 7369 6f6e 0d0a 0d0a 2020  .dimension....  
-00035560: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-00035570: 2064 6566 2073 6974 6528 7365 6c66 293a   def site(self):
-00035580: 0d0a 2020 2020 2020 2020 2727 2754 6865  ..        '''The
-00035590: 2073 6974 6520 7468 6973 2053 7472 7563   site this Struc
-000355a0: 7475 7265 456c 656d 656e 7420 6265 6c6f  tureElement belo
-000355b0: 6e67 7320 746f 2727 270d 0a20 2020 2020  ngs to'''..     
-000355c0: 2020 2072 6574 7572 6e20 7365 6c66 2e64     return self.d
-000355d0: 696d 656e 7369 6f6e 2e73 6974 650d 0a0d  imension.site...
-000355e0: 0a20 2020 2064 6566 2061 6464 5f70 6172  .    def add_par
-000355f0: 656e 7428 7365 6c66 2c70 6172 656e 745f  ent(self,parent_
-00035600: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-00035610: 7429 3a0d 0a0d 0a20 2020 2020 2020 2023  t):....        #
-00035620: 4f6e 6c79 2061 6464 2073 656c 6620 746f  Only add self to
-00035630: 2070 6172 656e 7420 7768 656e 2063 6861   parent when cha
-00035640: 6e67 696e 6720 7061 7265 6e74 5f73 7472  nging parent_str
-00035650: 7563 7475 7265 5f65 6c65 6d65 6e74 2074  ucture_element t
-00035660: 6f20 6176 6f69 6420 616e 2069 6e66 696e  o avoid an infin
-00035670: 6974 6520 6c6f 6f70 0d0a 2020 2020 2020  ite loop..      
-00035680: 2020 6966 2073 656c 662e 5f70 6172 656e    if self._paren
-00035690: 745f 7374 7275 6374 7572 655f 656c 656d  t_structure_elem
-000356a0: 656e 7420 6973 204e 6f6e 6520 6f72 2073  ent is None or s
-000356b0: 656c 662e 5f70 6172 656e 745f 7374 7275  elf._parent_stru
-000356c0: 6374 7572 655f 656c 656d 656e 7421 3d70  cture_element!=p
-000356d0: 6172 656e 745f 7374 7275 6374 7572 655f  arent_structure_
-000356e0: 656c 656d 656e 743a 0d0a 2020 2020 2020  element:..      
-000356f0: 2020 2020 2020 7365 6c66 2e5f 7061 7265        self._pare
-00035700: 6e74 5f73 7472 7563 7475 7265 5f65 6c65  nt_structure_ele
-00035710: 6d65 6e74 3d70 6172 656e 745f 7374 7275  ment=parent_stru
-00035720: 6374 7572 655f 656c 656d 656e 740d 0a20  cture_element.. 
-00035730: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00035740: 6973 5f72 6f6f 7420 3d20 4661 6c73 650d  is_root = False.
-00035750: 0a0d 0a20 2020 2020 2020 2070 6172 656e  ...        paren
-00035760: 745f 7374 7275 6374 7572 655f 656c 656d  t_structure_elem
-00035770: 656e 742e 5f61 6464 5f63 6869 6c64 2873  ent._add_child(s
-00035780: 656c 6629 0d0a 0d0a 2020 2020 6465 6620  elf)....    def 
-00035790: 7365 745f 7061 7265 6e74 2873 656c 662c  set_parent(self,
-000357a0: 7061 7265 6e74 5f73 7472 7563 7475 7265  parent_structure
-000357b0: 5f65 6c65 6d65 6e74 293a 0d0a 0d0a 2020  _element):....  
-000357c0: 2020 2020 2020 6966 2073 656c 663d 3d70        if self==p
-000357d0: 6172 656e 745f 7374 7275 6374 7572 655f  arent_structure_
-000357e0: 656c 656d 656e 743a 0d0a 2020 2020 2020  element:..      
-000357f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00035800: 6545 7272 6f72 2827 5472 6965 6420 746f  eError('Tried to
-00035810: 2073 6574 2053 7472 7563 7475 7265 456c   set StructureEl
-00035820: 656d 656e 742e 7061 7265 6e74 2074 6f20  ement.parent to 
-00035830: 7365 6c66 2e20 7365 6c66 2e73 686f 7274  self. self.short
-00035840: 6e61 6d65 3d27 2b73 7472 2873 656c 662e  name='+str(self.
-00035850: 7368 6f72 746e 616d 6529 290d 0a0d 0a20  shortname)).... 
-00035860: 2020 2020 2020 2023 5265 6d6f 7665 2074         #Remove t
-00035870: 6865 2063 7572 7265 6e74 2070 6172 656e  he current paren
-00035880: 7420 6966 2069 7420 6469 6666 6572 7320  t if it differs 
-00035890: 6672 6f6d 2074 6865 206f 6e65 2062 6569  from the one bei
-000358a0: 6e67 2073 6574 0d0a 2020 2020 2020 2020  ng set..        
-000358b0: 6966 2073 656c 662e 5f70 6172 656e 745f  if self._parent_
-000358c0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-000358d0: 7420 6973 206e 6f74 204e 6f6e 6520 616e  t is not None an
-000358e0: 6420 7365 6c66 2e5f 7061 7265 6e74 5f73  d self._parent_s
-000358f0: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00035900: 213d 7061 7265 6e74 5f73 7472 7563 7475  !=parent_structu
-00035910: 7265 5f65 6c65 6d65 6e74 3a0d 0a20 2020  re_element:..   
-00035920: 2020 2020 2020 2020 2073 656c 662e 5f70           self._p
-00035930: 6172 656e 745f 7374 7275 6374 7572 655f  arent_structure_
-00035940: 656c 656d 656e 742e 7265 6d6f 7665 5f63  element.remove_c
-00035950: 6869 6c64 2873 656c 6629 0d0a 2020 2020  hild(self)..    
-00035960: 2020 2020 2020 2020 7365 6c66 2e5f 7061          self._pa
-00035970: 7265 6e74 5f73 7472 7563 7475 7265 5f65  rent_structure_e
-00035980: 6c65 6d65 6e74 3d4e 6f6e 650d 0a0d 0a20  lement=None.... 
-00035990: 2020 2020 2020 2023 4f6e 6c79 2061 6464         #Only add
-000359a0: 2073 656c 6620 746f 2070 6172 656e 7420   self to parent 
-000359b0: 7768 656e 2063 6861 6e67 696e 6720 7061  when changing pa
-000359c0: 7265 6e74 5f73 7472 7563 7475 7265 5f65  rent_structure_e
-000359d0: 6c65 6d65 6e74 2074 6f20 6176 6f69 6420  lement to avoid 
-000359e0: 616e 2069 6e66 696e 6974 6520 6c6f 6f70  an infinite loop
-000359f0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00035a00: 662e 5f70 6172 656e 745f 7374 7275 6374  f._parent_struct
-00035a10: 7572 655f 656c 656d 656e 7420 6973 204e  ure_element is N
-00035a20: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00035a30: 2020 7365 6c66 2e5f 7061 7265 6e74 5f73    self._parent_s
-00035a40: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00035a50: 3d70 6172 656e 745f 7374 7275 6374 7572  =parent_structur
-00035a60: 655f 656c 656d 656e 740d 0a0d 0a20 2020  e_element....   
-00035a70: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00035a80: 2e5f 7061 7265 6e74 5f73 7472 7563 7475  ._parent_structu
-00035a90: 7265 5f65 6c65 6d65 6e74 2069 7320 6e6f  re_element is no
-00035aa0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00035ab0: 2020 2020 2020 2020 2073 656c 662e 5f70           self._p
-00035ac0: 6172 656e 745f 7374 7275 6374 7572 655f  arent_structure_
-00035ad0: 656c 656d 656e 742e 5f61 6464 5f63 6869  element._add_chi
-00035ae0: 6c64 2873 656c 6629 0d0a 0d0a 2020 2020  ld(self)....    
-00035af0: 6465 6620 6375 7428 7365 6c66 293a 0d0a  def cut(self):..
-00035b00: 2020 2020 2020 2020 2727 270d 0a20 2020          '''..   
-00035b10: 2020 2020 2052 656d 6f76 6520 7468 6973       Remove this
-00035b20: 2073 7472 7563 7475 7265 2065 6c65 6d65   structure eleme
-00035b30: 6e74 2066 726f 6d20 6974 7320 7061 7265  nt from its pare
-00035b40: 6e74 2061 6e64 2072 6574 7572 6e20 6974  nt and return it
-00035b50: 2e0d 0a20 2020 2020 2020 2054 6869 7320  ...        This 
-00035b60: 6675 6e63 7469 6f6e 2069 7320 7573 6566  function is usef
-00035b70: 756c 2077 6865 6e20 7765 2061 7265 2061  ul when we are a
-00035b80: 626f 7574 2074 6f20 2770 6173 7465 2720  bout to 'paste' 
-00035b90: 7468 6520 656c 656d 656e 7420 696e 746f  the element into
-00035ba0: 2061 6e6f 7468 6572 2073 706f 740d 0a20   another spot.. 
-00035bb0: 2020 2020 2020 2027 2727 0d0a 2020 2020         '''..    
-00035bc0: 2020 2020 2352 656d 6f76 6520 7468 6520      #Remove the 
-00035bd0: 6375 7272 656e 7420 7061 7265 6e74 2069  current parent i
-00035be0: 6620 6974 2064 6966 6665 7273 2066 726f  f it differs fro
-00035bf0: 6d20 7468 6520 6f6e 6520 6265 696e 6720  m the one being 
-00035c00: 7365 740d 0a20 2020 2020 2020 2069 6620  set..        if 
-00035c10: 7365 6c66 2e5f 7061 7265 6e74 5f73 7472  self._parent_str
-00035c20: 7563 7475 7265 5f65 6c65 6d65 6e74 2069  ucture_element i
-00035c30: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00035c40: 2020 2020 2020 2020 2073 656c 662e 5f70           self._p
-00035c50: 6172 656e 745f 7374 7275 6374 7572 655f  arent_structure_
-00035c60: 656c 656d 656e 742e 7265 6d6f 7665 5f63  element.remove_c
-00035c70: 6869 6c64 2873 656c 6629 0d0a 2020 2020  hild(self)..    
-00035c80: 2020 2020 2020 2020 7365 6c66 2e5f 7061          self._pa
-00035c90: 7265 6e74 5f73 7472 7563 7475 7265 5f65  rent_structure_e
-00035ca0: 6c65 6d65 6e74 3d4e 6f6e 650d 0a0d 0a20  lement=None.... 
-00035cb0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00035cc0: 6c66 0d0a 0d0a 2020 2020 6465 6620 5f61  lf....    def _a
-00035cd0: 6464 5f63 6869 6c64 2873 656c 662c 6368  dd_child(self,ch
-00035ce0: 696c 645f 7374 7275 6374 7572 655f 656c  ild_structure_el
-00035cf0: 656d 656e 7429 3a0d 0a20 2020 2020 2020  ement):..       
-00035d00: 2073 656c 662e 5f63 6869 6c64 5f73 7472   self._child_str
-00035d10: 7563 7475 7265 5f65 6c65 6d65 6e74 732e  ucture_elements.
-00035d20: 6170 7065 6e64 2863 6869 6c64 5f73 7472  append(child_str
-00035d30: 7563 7475 7265 5f65 6c65 6d65 6e74 290d  ucture_element).
-00035d40: 0a20 2020 2020 2020 2069 6620 6368 696c  .        if chil
-00035d50: 645f 7374 7275 6374 7572 655f 656c 656d  d_structure_elem
-00035d60: 656e 742e 7061 7265 6e74 2069 7320 4e6f  ent.parent is No
-00035d70: 6e65 206f 7220 6368 696c 645f 7374 7275  ne or child_stru
-00035d80: 6374 7572 655f 656c 656d 656e 742e 7061  cture_element.pa
-00035d90: 7265 6e74 2021 3d20 7365 6c66 3a0d 0a20  rent != self:.. 
-00035da0: 2020 2020 2020 2020 2020 2063 6869 6c64             child
-00035db0: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
-00035dc0: 6e74 2e5f 7061 7265 6e74 5f73 7472 7563  nt._parent_struc
-00035dd0: 7475 7265 5f65 6c65 6d65 6e74 3d73 656c  ture_element=sel
-00035de0: 660d 0a20 2020 2020 2020 2020 2020 2063  f..            c
-00035df0: 6869 6c64 5f73 7472 7563 7475 7265 5f65  hild_structure_e
-00035e00: 6c65 6d65 6e74 2e69 735f 726f 6f74 203d  lement.is_root =
-00035e10: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00035e20: 2020 2020 6368 696c 645f 7374 7275 6374      child_struct
-00035e30: 7572 655f 656c 656d 656e 742e 7374 7275  ure_element.stru
-00035e40: 6374 7572 653d 7365 6c66 2e73 7472 7563  cture=self.struc
-00035e50: 7475 7265 0d0a 2020 2020 2020 2020 6c6f  ture..        lo
-00035e60: 672e 6465 6275 6728 2741 6464 6564 2043  g.debug('Added C
-00035e70: 6869 6c64 2027 2b63 6869 6c64 5f73 7472  hild '+child_str
-00035e80: 7563 7475 7265 5f65 6c65 6d65 6e74 2e73  ucture_element.s
-00035e90: 686f 7274 6e61 6d65 2b27 2074 6f20 272b  hortname+' to '+
-00035ea0: 7365 6c66 2e73 686f 7274 6e61 6d65 290d  self.shortname).
-00035eb0: 0a0d 0a20 2020 2064 6566 2061 6464 5f63  ...    def add_c
-00035ec0: 6869 6c64 2873 656c 662c 6368 696c 645f  hild(self,child_
-00035ed0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-00035ee0: 7429 3a0d 0a20 2020 2020 2020 2027 2727  t):..        '''
-00035ef0: 4164 6420 6120 6368 696c 6420 5374 7275  Add a child Stru
-00035f00: 6374 7572 6545 6c65 6d65 6e74 2074 6f20  ctureElement to 
-00035f10: 2e63 6869 6c64 7265 6e2e 0d0a 0d0a 2020  .children.....  
-00035f20: 2020 2020 2020 3a70 6172 616d 2063 6869        :param chi
-00035f30: 6c64 5f73 7472 7563 7475 7265 5f65 6c65  ld_structure_ele
-00035f40: 6d65 6e74 3a20 5374 7275 6374 7572 6545  ment: StructureE
-00035f50: 6c65 6d65 6e74 2c20 456c 656d 656e 7420  lement, Element 
-00035f60: 6f72 2073 686f 7274 636f 6465 2073 7472  or shortcode str
-00035f70: 696e 6720 7265 6665 7272 696e 6720 746f  ing referring to
-00035f80: 2061 6e20 656c 656d 656e 742e 2054 6865   an element. The
-00035f90: 2063 6869 6c64 2077 6520 7769 7368 2074   child we wish t
-00035fa0: 6f20 6164 6420 746f 2074 6869 7320 5374  o add to this St
-00035fb0: 7275 6374 7572 6545 6c65 6d65 6e74 2e0d  ructureElement..
-00035fc0: 0a20 2020 2020 2020 2027 2727 0d0a 2020  .        '''..  
-00035fd0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00035fe0: 6e63 6528 6368 696c 645f 7374 7275 6374  nce(child_struct
-00035ff0: 7572 655f 656c 656d 656e 742c 5374 7275  ure_element,Stru
-00036000: 6374 7572 6545 6c65 6d65 6e74 293a 0d0a  ctureElement):..
-00036010: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00036020: 2e5f 6164 645f 6368 696c 6428 6368 696c  ._add_child(chil
-00036030: 645f 7374 7275 6374 7572 655f 656c 656d  d_structure_elem
-00036040: 656e 7429 0d0a 2020 2020 2020 2020 656c  ent)..        el
-00036050: 6966 2069 7369 6e73 7461 6e63 6528 6368  if isinstance(ch
-00036060: 696c 645f 7374 7275 6374 7572 655f 656c  ild_structure_el
-00036070: 656d 656e 742c 456c 656d 656e 7429 3a0d  ement,Element):.
-00036080: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00036090: 662e 5f61 6464 5f63 6869 6c64 2853 7472  f._add_child(Str
-000360a0: 7563 7475 7265 456c 656d 656e 7428 656c  uctureElement(el
-000360b0: 656d 656e 743d 6368 696c 645f 7374 7275  ement=child_stru
-000360c0: 6374 7572 655f 656c 656d 656e 7429 290d  cture_element)).
-000360d0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
-000360e0: 696e 7374 616e 6365 2863 6869 6c64 5f73  instance(child_s
-000360f0: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00036100: 2c73 7472 293a 0d0a 2020 2020 2020 2020  ,str):..        
-00036110: 2020 2020 2343 7265 6174 6520 6120 5374      #Create a St
-00036120: 7275 6374 7572 6545 6c65 6d65 6e74 2062  ructureElement b
-00036130: 7920 6c6f 6f6b 696e 6720 7570 2074 6865  y looking up the
-00036140: 2065 6c65 6d65 6e74 2073 686f 7274 6e61   element shortna
-00036150: 6d65 2066 726f 6d20 7468 6520 7374 7269  me from the stri
-00036160: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
-00036170: 7365 6c66 2e5f 6164 645f 6368 696c 6428  self._add_child(
-00036180: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-00036190: 2865 6c65 6d65 6e74 3d73 656c 662e 6469  (element=self.di
-000361a0: 6d65 6e73 696f 6e2e 656c 656d 656e 7473  mension.elements
-000361b0: 5b63 6869 6c64 5f73 7472 7563 7475 7265  [child_structure
-000361c0: 5f65 6c65 6d65 6e74 5d29 290d 0a0d 0a0d  _element])).....
-000361d0: 0a20 2020 2064 6566 2072 656d 6f76 655f  .    def remove_
-000361e0: 6368 696c 6472 656e 2873 656c 6629 3a0d  children(self):.
-000361f0: 0a20 2020 2020 2020 2027 2727 5265 6d6f  .        '''Remo
-00036200: 7665 2061 6c6c 2063 6869 6c64 7265 6e20  ve all children 
-00036210: 6672 6f6d 2074 6869 7320 7374 7275 6374  from this struct
-00036220: 7572 6520 656c 656d 656e 742f 2053 616d  ure element/ Sam
-00036230: 6520 6173 202e 6368 696c 6472 656e 2e63  e as .children.c
-00036240: 6c65 6172 2829 2727 270d 0a20 2020 2020  lear()'''..     
-00036250: 2020 2023 7265 7365 7420 7468 6520 5f63     #reset the _c
-00036260: 6869 6c64 5f73 7472 7563 7475 7265 5f65  hild_structure_e
-00036270: 6c65 6d65 6e74 7320 746f 2061 6e20 656d  lements to an em
-00036280: 7074 7920 4f72 6465 7265 6444 6963 740d  pty OrderedDict.
-00036290: 0a20 2020 2020 2020 2066 6f72 2063 6820  .        for ch 
-000362a0: 696e 2073 656c 662e 6368 696c 6472 656e  in self.children
-000362b0: 2e76 616c 7565 7328 293a 0d0a 2020 2020  .values():..    
-000362c0: 2020 2020 2020 2020 6368 2e5f 7061 7265          ch._pare
-000362d0: 6e74 5f73 7472 7563 7475 7265 5f65 6c65  nt_structure_ele
-000362e0: 6d65 6e74 3d4e 6f6e 650d 0a20 2020 2020  ment=None..     
-000362f0: 2020 2073 656c 662e 5f63 6869 6c64 5f73     self._child_s
+00033d00: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
+00033d10: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
+00033d20: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
+00033d30: 7269 6275 7465 4572 726f 723a 0d0a 2020  ributeError:..  
+00033d40: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
+00033d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00033d60: 7661 6c20 3d20 7661 6c2e 6469 6d65 6e73  val = val.dimens
+00033d70: 696f 6e2e 656c 656d 656e 7473 5b76 616c  ion.elements[val
+00033d80: 2e73 686f 7274 636f 6465 5d0d 0a20 2020  .shortcode]..   
+00033d90: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00033da0: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
+00033db0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00033dc0: 6173 730d 0a0d 0a20 2020 2020 2020 2069  ass....        i
+00033dd0: 6620 6e6f 7420 7661 6c2e 6d61 7374 6572  f not val.master
+00033de0: 6564 3a0d 0a20 2020 2020 2020 2020 2020  ed:..           
+00033df0: 2072 6169 7365 2041 7474 7269 6275 7465   raise Attribute
+00033e00: 4572 726f 7228 2243 616e 6e6f 7420 7365  Error("Cannot se
+00033e10: 7420 6120 5374 7275 6374 7572 6545 6c65  t a StructureEle
+00033e20: 6d65 6e74 2773 202e 656c 656d 656e 7420  ment's .element 
+00033e30: 756e 7469 6c20 7468 6174 2045 6c65 6d65  until that Eleme
+00033e40: 6e74 2068 6173 2062 6565 6e20 7379 6e63  nt has been sync
+00033e50: 6872 6f6e 6973 6564 2e20 5573 6520 4469  hronised. Use Di
+00033e60: 6d65 6e73 696f 6e2e 656c 656d 656e 7473  mension.elements
+00033e70: 2e73 796e 6368 726f 6e69 7365 2829 2062  .synchronise() b
+00033e80: 6566 6f72 6520 6164 6469 6e67 2074 6865  efore adding the
+00033e90: 2065 6c65 6d65 6e74 2073 686f 7274 6e61   element shortna
+00033ea0: 6d65 3a7b 7d2c 206c 6f6e 676e 616d 653a  me:{}, longname:
+00033eb0: 207b 7d20 6d61 7374 6572 6564 3a20 7b7d   {} mastered: {}
+00033ec0: 2c20 6669 656c 6473 3a20 7b7d 222e 666f  , fields: {}".fo
+00033ed0: 726d 6174 2876 616c 2e73 686f 7274 636f  rmat(val.shortco
+00033ee0: 6465 2c76 616c 2e6c 6f6e 676e 616d 652c  de,val.longname,
+00033ef0: 7661 6c2e 6d61 7374 6572 6564 2c64 6963  val.mastered,dic
+00033f00: 7428 7661 6c2e 6669 656c 6473 2929 290d  t(val.fields))).
+00033f10: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+00033f20: 5f65 6c65 6d65 6e74 203d 7661 6c0d 0a0d  _element =val...
+00033f30: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+00033f40: 2020 2020 6465 6620 7368 6f72 7463 6f64      def shortcod
+00033f50: 6528 7365 6c66 293a 0d0a 2020 2020 2020  e(self):..      
+00033f60: 2020 2727 2754 6865 2073 686f 7274 6e61    '''The shortna
+00033f70: 6d65 206f 6620 7468 6520 456d 706f 7765  me of the Empowe
+00033f80: 7220 456c 656d 656e 7420 756e 6465 7270  r Element underp
+00033f90: 696e 6e69 6e67 2074 6869 7320 5374 7275  inning this Stru
+00033fa0: 6374 7572 6545 6c65 6d65 6e74 2727 270d  ctureElement'''.
+00033fb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00033fc0: 7365 6c66 2e65 6c65 6d65 6e74 2e73 686f  self.element.sho
+00033fd0: 7274 6e61 6d65 0d0a 0d0a 2020 2020 4073  rtname....    @s
+00033fe0: 686f 7274 636f 6465 2e73 6574 7465 720d  hortcode.setter.
+00033ff0: 0a20 2020 2064 6566 2073 686f 7274 636f  .    def shortco
+00034000: 6465 2873 656c 662c 7661 6c29 3a0d 0a20  de(self,val):.. 
+00034010: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
+00034020: 656e 742e 7368 6f72 746e 616d 653d 7661  ent.shortname=va
+00034030: 6c0d 0a0d 0a20 2020 2040 7072 6f70 6572  l....    @proper
+00034040: 7479 0d0a 2020 2020 6465 6620 7368 6f72  ty..    def shor
+00034050: 746e 616d 6528 7365 6c66 293a 0d0a 2020  tname(self):..  
+00034060: 2020 2020 2020 2727 2754 6865 2073 686f        '''The sho
+00034070: 7274 6e61 6d65 206f 6620 7468 6520 456d  rtname of the Em
+00034080: 706f 7765 7220 456c 656d 656e 7420 756e  power Element un
+00034090: 6465 7270 696e 6e69 6e67 2074 6869 7320  derpinning this 
+000340a0: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+000340b0: 2727 270d 0a20 2020 2020 2020 2072 6574  '''..        ret
+000340c0: 7572 6e20 7365 6c66 2e65 6c65 6d65 6e74  urn self.element
+000340d0: 2e73 686f 7274 6e61 6d65 0d0a 0d0a 2020  .shortname....  
+000340e0: 2020 4073 686f 7274 6e61 6d65 2e73 6574    @shortname.set
+000340f0: 7465 720d 0a20 2020 2064 6566 2073 686f  ter..    def sho
+00034100: 7274 6e61 6d65 2873 656c 662c 7661 6c29  rtname(self,val)
+00034110: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+00034120: 656c 656d 656e 742e 7368 6f72 746e 616d  element.shortnam
+00034130: 653d 7661 6c0d 0a0d 0a20 2020 2040 7072  e=val....    @pr
+00034140: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+00034150: 6c6f 6e67 6e61 6d65 2873 656c 6629 3a0d  longname(self):.
+00034160: 0a20 2020 2020 2020 2027 2727 5468 6520  .        '''The 
+00034170: 6c6f 6e67 6e61 6d65 206f 6620 7468 6520  longname of the 
+00034180: 456d 706f 7765 7220 456c 656d 656e 7420  Empower Element 
+00034190: 756e 6465 7270 696e 6e69 6e67 2074 6869  underpinning thi
+000341a0: 7320 5374 7275 6374 7572 6545 6c65 6d65  s StructureEleme
+000341b0: 6e74 2727 270d 0a20 2020 2020 2020 2072  nt'''..        r
+000341c0: 6574 7572 6e20 7365 6c66 2e65 6c65 6d65  eturn self.eleme
+000341d0: 6e74 2e6c 6f6e 676e 616d 650d 0a0d 0a20  nt.longname.... 
+000341e0: 2020 2040 6c6f 6e67 6e61 6d65 2e73 6574     @longname.set
+000341f0: 7465 720d 0a20 2020 2064 6566 206c 6f6e  ter..    def lon
+00034200: 676e 616d 6528 7365 6c66 2c76 616c 293a  gname(self,val):
+00034210: 0d0a 2020 2020 2020 2020 7365 6c66 2e65  ..        self.e
+00034220: 6c65 6d65 6e74 2e6c 6f6e 676e 616d 653d  lement.longname=
+00034230: 7661 6c0d 0a0d 0a20 2020 2040 7072 6f70  val....    @prop
+00034240: 6572 7479 0d0a 2020 2020 6465 6620 6465  erty..    def de
+00034250: 7363 7269 7074 696f 6e28 7365 6c66 293a  scription(self):
+00034260: 0d0a 2020 2020 2020 2020 2727 2754 6865  ..        '''The
+00034270: 2064 6573 6372 6970 7469 6f6e 206f 6620   description of 
+00034280: 7468 6520 456d 706f 7765 7220 456c 656d  the Empower Elem
+00034290: 656e 7420 756e 6465 7270 696e 6e69 6e67  ent underpinning
+000342a0: 2074 6869 7320 5374 7275 6374 7572 6545   this StructureE
+000342b0: 6c65 6d65 6e74 2727 270d 0a20 2020 2020  lement'''..     
+000342c0: 2020 2072 6574 7572 6e20 7365 6c66 2e65     return self.e
+000342d0: 6c65 6d65 6e74 2e64 6573 6372 6970 7469  lement.descripti
+000342e0: 6f6e 0d0a 0d0a 2020 2020 4064 6573 6372  on....    @descr
+000342f0: 6970 7469 6f6e 2e73 6574 7465 720d 0a20  iption.setter.. 
+00034300: 2020 2064 6566 2064 6573 6372 6970 7469     def descripti
+00034310: 6f6e 2873 656c 662c 7661 6c29 3a0d 0a20  on(self,val):.. 
+00034320: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
+00034330: 656e 742e 6465 7363 7269 7074 696f 6e3d  ent.description=
+00034340: 7661 6c0d 0a0d 0a20 2020 2040 7072 6f70  val....    @prop
+00034350: 6572 7479 0d0a 2020 2020 6465 6620 6772  erty..    def gr
+00034360: 6f75 705f 6f6e 6c79 2873 656c 6629 3a0d  oup_only(self):.
+00034370: 0a20 2020 2020 2020 2027 2727 2747 726f  .        ''''Gro
+00034380: 7570 2720 6966 2074 6869 7320 6973 2061  up' if this is a
+00034390: 2047 726f 7570 204f 6e6c 7920 5374 7275   Group Only Stru
+000343a0: 6374 7572 6545 6c65 6d65 6e74 2e20 4120  ctureElement. A 
+000343b0: 4772 6f75 704f 6e6c 7920 656c 656d 656e  GroupOnly elemen
+000343c0: 7420 646f 6573 206e 6f74 2068 6176 6520  t does not have 
+000343d0: 6120 6361 6c63 756c 6174 696f 6e2c 2061  a calculation, a
+000343e0: 6e64 2063 616e 6e6f 7420 6861 7665 2064  nd cannot have d
+000343f0: 6174 6120 6173 736f 6369 6174 6564 2077  ata associated w
+00034400: 6974 6820 6974 2727 270d 0a20 2020 2020  ith it'''..     
+00034410: 2020 2072 6574 7572 6e20 7365 6c66 2e65     return self.e
+00034420: 6c65 6d65 6e74 2e67 726f 7570 5f6f 6e6c  lement.group_onl
+00034430: 790d 0a0d 0a20 2020 2040 6772 6f75 705f  y....    @group_
+00034440: 6f6e 6c79 2e73 6574 7465 720d 0a20 2020  only.setter..   
+00034450: 2064 6566 2067 726f 7570 5f6f 6e6c 7928   def group_only(
+00034460: 7365 6c66 2c76 616c 293a 0d0a 2020 2020  self,val):..    
+00034470: 2020 2020 7365 6c66 2e65 6c65 6d65 6e74      self.element
+00034480: 2e67 726f 7570 5f6f 6e6c 793d 7661 6c0d  .group_only=val.
+00034490: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+000344a0: 0d0a 2020 2020 6465 6620 6361 6c63 756c  ..    def calcul
+000344b0: 6174 696f 6e5f 7374 6174 7573 2873 656c  ation_status(sel
+000344c0: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
+000344d0: 5468 6520 6361 6c63 756c 6174 696f 6e5f  The calculation_
+000344e0: 7374 6174 7573 206f 6620 7468 6520 456d  status of the Em
+000344f0: 706f 7765 7220 456c 656d 656e 7420 756e  power Element un
+00034500: 6465 7270 696e 6e69 6e67 2074 6869 7320  derpinning this 
+00034510: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+00034520: 2e20 4361 6e20 6265 206f 6e65 206f 6620  . Can be one of 
+00034530: 2752 6561 6c27 206f 7220 2743 616c 6375  'Real' or 'Calcu
+00034540: 6c61 7465 6427 2028 692e 652e 2076 6972  lated' (i.e. vir
+00034550: 7475 616c 292e 2727 270d 0a20 2020 2020  tual).'''..     
+00034560: 2020 2072 6574 7572 6e20 7365 6c66 2e65     return self.e
+00034570: 6c65 6d65 6e74 2e63 616c 6375 6c61 7469  lement.calculati
+00034580: 6f6e 5f73 7461 7475 730d 0a0d 0a20 2020  on_status....   
+00034590: 2040 6361 6c63 756c 6174 696f 6e5f 7374   @calculation_st
+000345a0: 6174 7573 2e73 6574 7465 720d 0a20 2020  atus.setter..   
+000345b0: 2064 6566 2063 616c 6375 6c61 7469 6f6e   def calculation
+000345c0: 5f73 7461 7475 7328 7365 6c66 2c76 616c  _status(self,val
+000345d0: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+000345e0: 2e65 6c65 6d65 6e74 2e63 616c 6375 6c61  .element.calcula
+000345f0: 7469 6f6e 5f73 7461 7475 733d 7661 6c0d  tion_status=val.
+00034600: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+00034610: 0d0a 2020 2020 6465 6620 6361 6c63 756c  ..    def calcul
+00034620: 6174 696f 6e28 7365 6c66 293a 0d0a 2020  ation(self):..  
+00034630: 2020 2020 2020 2727 2754 6865 2063 616c        '''The cal
+00034640: 6375 6c61 7469 6f6e 206f 6620 7468 6520  culation of the 
+00034650: 456d 706f 7765 7220 456c 656d 656e 7420  Empower Element 
+00034660: 756e 6465 7270 696e 6e69 6e67 2074 6869  underpinning thi
+00034670: 7320 5374 7275 6374 7572 6545 6c65 6d65  s StructureEleme
+00034680: 6e74 2e27 2727 0d0a 2020 2020 2020 2020  nt.'''..        
+00034690: 7265 7475 726e 2073 656c 662e 656c 656d  return self.elem
+000346a0: 656e 742e 6361 6c63 756c 6174 696f 6e0d  ent.calculation.
+000346b0: 0a0d 0a20 2020 2040 6361 6c63 756c 6174  ...    @calculat
+000346c0: 696f 6e2e 7365 7474 6572 0d0a 2020 2020  ion.setter..    
+000346d0: 6465 6620 6361 6c63 756c 6174 696f 6e28  def calculation(
+000346e0: 7365 6c66 2c76 616c 293a 0d0a 2020 2020  self,val):..    
+000346f0: 2020 2020 7365 6c66 2e65 6c65 6d65 6e74      self.element
+00034700: 2e63 616c 6375 6c61 7469 6f6e 3d76 616c  .calculation=val
+00034710: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+00034720: 790d 0a20 2020 2064 6566 2063 6f6c 6f75  y..    def colou
+00034730: 7228 7365 6c66 293a 0d0a 2020 2020 2020  r(self):..      
+00034740: 2020 2727 2754 6865 2063 6f6c 6f75 7220    '''The colour 
+00034750: 6f66 2074 6865 2045 6d70 6f77 6572 2045  of the Empower E
+00034760: 6c65 6d65 6e74 2075 6e64 6572 7069 6e6e  lement underpinn
+00034770: 696e 6720 7468 6973 2053 7472 7563 7475  ing this Structu
+00034780: 7265 456c 656d 656e 742e 2727 270d 0a20  reElement.'''.. 
+00034790: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000347a0: 6c66 2e65 6c65 6d65 6e74 2e63 6f6c 6f75  lf.element.colou
+000347b0: 720d 0a0d 0a20 2020 2040 636f 6c6f 7572  r....    @colour
+000347c0: 2e73 6574 7465 720d 0a20 2020 2064 6566  .setter..    def
+000347d0: 2063 6f6c 6f75 7228 7365 6c66 2c76 616c   colour(self,val
+000347e0: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+000347f0: 2e65 6c65 6d65 6e74 2e63 6f6c 6f75 723d  .element.colour=
+00034800: 7661 6c0d 0a0d 0a20 2020 2040 7072 6f70  val....    @prop
+00034810: 6572 7479 0d0a 2020 2020 6465 6620 6669  erty..    def fi
+00034820: 656c 6473 2873 656c 6629 3a0d 0a20 2020  elds(self):..   
+00034830: 2020 2020 2027 2727 4120 6469 6374 696f       '''A dictio
+00034840: 6e61 7279 206c 696b 6520 6f62 6a65 6374  nary like object
+00034850: 2067 6976 696e 6720 6163 6365 7373 2074   giving access t
+00034860: 6f20 7468 6520 756e 6465 726c 7969 6e67  o the underlying
+00034870: 2065 6c65 6d65 6e74 2773 2066 6965 6c64   element's field
+00034880: 732e 2053 6565 2074 6865 2061 7069 2064  s. See the api d
+00034890: 6f63 756d 656e 7461 7469 6f6e 2066 6f72  ocumentation for
+000348a0: 2045 6c65 6d65 6e74 2e66 6965 6c64 7327   Element.fields'
+000348b0: 2727 0d0a 2020 2020 2020 2020 7265 7475  ''..        retu
+000348c0: 726e 2073 656c 662e 656c 656d 656e 742e  rn self.element.
+000348d0: 6669 656c 6473 0d0a 0d0a 2020 2020 2344  fields....    #D
+000348e0: 6f6e 2774 206e 6565 6420 6120 7365 7474  on't need a sett
+000348f0: 6572 2066 6f72 2066 6965 6c64 7320 6265  er for fields be
+00034900: 6361 7573 6520 6669 656c 6473 2069 7320  cause fields is 
+00034910: 6120 6469 6374 696f 6e61 7279 0d0a 0d0a  a dictionary....
+00034920: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
+00034930: 2020 2064 6566 2073 6563 7572 6974 7928     def security(
+00034940: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00034950: 2727 2754 6865 2073 6563 7572 6974 7920  '''The security 
+00034960: 6f66 2074 6865 2075 6e64 6572 6c79 696e  of the underlyin
+00034970: 6720 456c 656d 656e 742e 2053 6565 2074  g Element. See t
+00034980: 6865 2061 7069 2064 6f63 756d 656e 7461  he api documenta
+00034990: 7469 6f6e 2066 6f72 2045 6c65 6d65 6e74  tion for Element
+000349a0: 2e73 6563 7572 6974 7920 666f 7220 696e  .security for in
+000349b0: 666f 726d 6174 696f 6e27 2727 0d0a 2020  formation'''..  
+000349c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000349d0: 662e 656c 656d 656e 742e 7365 6375 7269  f.element.securi
+000349e0: 7479 0d0a 0d0a 2020 2020 4070 726f 7065  ty....    @prope
+000349f0: 7274 790d 0a20 2020 2064 6566 2070 6879  rty..    def phy
+00034a00: 7369 6428 7365 6c66 293a 0d0a 2020 2020  sid(self):..    
+00034a10: 2020 2020 2727 2754 6865 2070 6879 7369      '''The physi
+00034a20: 6361 6c20 6964 656e 7469 7479 206f 6620  cal identity of 
+00034a30: 7468 6520 756e 6465 726c 7969 6e67 2045  the underlying E
+00034a40: 6c65 6d65 6e74 2e20 5365 6520 7468 6520  lement. See the 
+00034a50: 6170 6920 646f 6375 6d65 6e74 6174 696f  api documentatio
+00034a60: 6e20 666f 7220 456c 656d 656e 742e 7068  n for Element.ph
+00034a70: 7973 6964 2066 6f72 2069 6e66 6f72 6d61  ysid for informa
+00034a80: 7469 6f6e 2727 270d 0a20 2020 2020 2020  tion'''..       
+00034a90: 2072 6574 7572 6e20 7365 6c66 2e65 6c65   return self.ele
+00034aa0: 6d65 6e74 2e70 6879 7369 640d 0a0d 0a20  ment.physid.... 
+00034ab0: 2020 2040 7068 7973 6964 2e73 6574 7465     @physid.sette
+00034ac0: 720d 0a20 2020 2064 6566 2070 6879 7369  r..    def physi
+00034ad0: 6428 7365 6c66 2c76 616c 293a 0d0a 2020  d(self,val):..  
+00034ae0: 2020 2020 2020 7365 6c66 2e65 6c65 6d65        self.eleme
+00034af0: 6e74 2e70 6879 7369 643d 7661 6c0d 0a0d  nt.physid=val...
+00034b00: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+00034b10: 2020 2020 6465 6620 7965 6172 2873 656c      def year(sel
+00034b20: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
+00034b30: 466f 7220 5469 6d65 2053 7472 7563 7475  For Time Structu
+00034b40: 7265 456c 656d 656e 7473 206f 6e6c 792e  reElements only.
+00034b50: 2054 6865 2079 6561 7220 6f66 2074 6865   The year of the
+00034b60: 2075 6e64 6572 6c79 696e 6720 5469 6d65   underlying Time
+00034b70: 2045 6c65 6d65 6e74 2e20 5365 6520 456c   Element. See El
+00034b80: 656d 656e 742e 7965 6172 2066 6f72 2069  ement.year for i
+00034b90: 6e66 6f72 6d61 7469 6f6e 2727 270d 0a20  nformation'''.. 
+00034ba0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00034bb0: 6c66 2e65 6c65 6d65 6e74 2e79 6561 720d  lf.element.year.
+00034bc0: 0a0d 0a20 2020 2040 7965 6172 2e73 6574  ...    @year.set
+00034bd0: 7465 720d 0a20 2020 2064 6566 2079 6561  ter..    def yea
+00034be0: 7228 7365 6c66 2c76 616c 293a 0d0a 2020  r(self,val):..  
+00034bf0: 2020 2020 2020 7365 6c66 2e65 6c65 6d65        self.eleme
+00034c00: 6e74 2e79 6561 723d 7661 6c0d 0a0d 0a20  nt.year=val.... 
+00034c10: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+00034c20: 2020 6465 6620 6d6f 6e74 6828 7365 6c66    def month(self
+00034c30: 293a 0d0a 2020 2020 2020 2020 2727 2746  ):..        '''F
+00034c40: 6f72 2054 696d 6520 5374 7275 6374 7572  or Time Structur
+00034c50: 6545 6c65 6d65 6e74 7320 6f6e 6c79 2e20  eElements only. 
+00034c60: 5468 6520 6d6f 6e74 6820 6f66 2074 6865  The month of the
+00034c70: 2075 6e64 6572 6c79 696e 6720 5469 6d65   underlying Time
+00034c80: 2045 6c65 6d65 6e74 2e20 5365 6520 456c   Element. See El
+00034c90: 656d 656e 742e 6d6f 6e74 6820 666f 7220  ement.month for 
+00034ca0: 696e 666f 726d 6174 696f 6e27 2727 0d0a  information'''..
+00034cb0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00034cc0: 656c 662e 656c 656d 656e 742e 6d6f 6e74  elf.element.mont
+00034cd0: 680d 0a0d 0a20 2020 2040 6d6f 6e74 682e  h....    @month.
+00034ce0: 7365 7474 6572 0d0a 2020 2020 6465 6620  setter..    def 
+00034cf0: 6d6f 6e74 6828 7365 6c66 2c76 616c 293a  month(self,val):
+00034d00: 0d0a 2020 2020 2020 2020 7365 6c66 2e65  ..        self.e
+00034d10: 6c65 6d65 6e74 2e6d 6f6e 7468 3d76 616c  lement.month=val
+00034d20: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+00034d30: 790d 0a20 2020 2064 6566 2064 6179 2873  y..    def day(s
+00034d40: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
+00034d50: 2727 466f 7220 5469 6d65 2053 7472 7563  ''For Time Struc
+00034d60: 7475 7265 456c 656d 656e 7473 206f 6e6c  tureElements onl
+00034d70: 792e 2054 6865 2064 6179 206f 6620 7468  y. The day of th
+00034d80: 6520 756e 6465 726c 7969 6e67 2054 696d  e underlying Tim
+00034d90: 6520 456c 656d 656e 742e 2053 6565 2045  e Element. See E
+00034da0: 6c65 6d65 6e74 2e64 6179 2066 6f72 2069  lement.day for i
+00034db0: 6e66 6f72 6d61 7469 6f6e 2727 270d 0a20  nformation'''.. 
+00034dc0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00034dd0: 6c66 2e65 6c65 6d65 6e74 2e64 6179 0d0a  lf.element.day..
+00034de0: 0d0a 2020 2020 4064 6179 2e73 6574 7465  ..    @day.sette
+00034df0: 720d 0a20 2020 2064 6566 2064 6179 2873  r..    def day(s
+00034e00: 656c 662c 7661 6c29 3a0d 0a20 2020 2020  elf,val):..     
+00034e10: 2020 2073 656c 662e 656c 656d 656e 742e     self.element.
+00034e20: 6461 793d 7661 6c0d 0a0d 0a20 2020 2040  day=val....    @
+00034e30: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+00034e40: 6620 696e 7465 7276 616c 5f69 6e64 6578  f interval_index
+00034e50: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00034e60: 2027 2727 466f 7220 5469 6d65 2053 7472   '''For Time Str
+00034e70: 7563 7475 7265 456c 656d 656e 7473 206f  uctureElements o
+00034e80: 6e6c 792e 2054 6865 2069 6e74 6572 7661  nly. The interva
+00034e90: 6c5f 696e 6465 7820 6f66 2074 6865 2075  l_index of the u
+00034ea0: 6e64 6572 6c79 696e 6720 5469 6d65 2045  nderlying Time E
+00034eb0: 6c65 6d65 6e74 2e20 5365 6520 456c 656d  lement. See Elem
+00034ec0: 656e 742e 696e 7465 7276 616c 5f69 6e64  ent.interval_ind
+00034ed0: 6578 2066 6f72 2069 6e66 6f72 6d61 7469  ex for informati
+00034ee0: 6f6e 2727 270d 0a20 2020 2020 2020 2072  on'''..        r
+00034ef0: 6574 7572 6e20 7365 6c66 2e65 6c65 6d65  eturn self.eleme
+00034f00: 6e74 2e69 6e74 6572 7661 6c5f 696e 6465  nt.interval_inde
+00034f10: 780d 0a0d 0a20 2020 2040 696e 7465 7276  x....    @interv
+00034f20: 616c 5f69 6e64 6578 2e73 6574 7465 720d  al_index.setter.
+00034f30: 0a20 2020 2064 6566 2069 6e74 6572 7661  .    def interva
+00034f40: 6c5f 696e 6465 7828 7365 6c66 2c76 616c  l_index(self,val
+00034f50: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+00034f60: 2e65 6c65 6d65 6e74 2e69 6e74 6572 7661  .element.interva
+00034f70: 6c5f 696e 6465 783d 7661 6c0d 0a0d 0a20  l_index=val.... 
+00034f80: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+00034f90: 2020 6465 6620 696e 7465 7276 616c 2873    def interval(s
+00034fa0: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
+00034fb0: 2727 466f 7220 5469 6d65 2053 7472 7563  ''For Time Struc
+00034fc0: 7475 7265 456c 656d 656e 7473 206f 6e6c  tureElements onl
+00034fd0: 792e 2054 6865 2069 6e74 6572 7661 6c20  y. The interval 
+00034fe0: 6f66 2074 6865 2075 6e64 6572 6c79 696e  of the underlyin
+00034ff0: 6720 5469 6d65 2045 6c65 6d65 6e74 2e20  g Time Element. 
+00035000: 5365 6520 456c 656d 656e 742e 696e 7465  See Element.inte
+00035010: 7276 616c 2066 6f72 2069 6e66 6f72 6d61  rval for informa
+00035020: 7469 6f6e 2727 270d 0a20 2020 2020 2020  tion'''..       
+00035030: 2072 6574 7572 6e20 7365 6c66 2e65 6c65   return self.ele
+00035040: 6d65 6e74 2e69 6e74 6572 7661 6c0d 0a0d  ment.interval...
+00035050: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+00035060: 2020 2020 6465 6620 696e 7465 7276 616c      def interval
+00035070: 5f61 6d6f 756e 7428 7365 6c66 293a 0d0a  _amount(self):..
+00035080: 2020 2020 2020 2020 2727 2746 6f72 2054          '''For T
+00035090: 696d 6520 5374 7275 6374 7572 6545 6c65  ime StructureEle
+000350a0: 6d65 6e74 7320 6f6e 6c79 2e20 5468 6520  ments only. The 
+000350b0: 696e 7465 7276 616c 5f61 6d6f 756e 7420  interval_amount 
+000350c0: 6f66 2074 6865 2075 6e64 6572 6c79 696e  of the underlyin
+000350d0: 6720 5469 6d65 2045 6c65 6d65 6e74 2e20  g Time Element. 
+000350e0: 5365 6520 456c 656d 656e 742e 696e 7465  See Element.inte
+000350f0: 7276 616c 5f61 6d6f 756e 7420 666f 7220  rval_amount for 
+00035100: 696e 666f 726d 6174 696f 6e27 2727 0d0a  information'''..
+00035110: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00035120: 656c 662e 656c 656d 656e 742e 696e 7465  elf.element.inte
+00035130: 7276 616c 5f61 6d6f 756e 740d 0a0d 0a20  rval_amount.... 
+00035140: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+00035150: 2020 6465 6620 7265 736f 6c75 7469 6f6e    def resolution
+00035160: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+00035170: 2027 2727 466f 7220 5469 6d65 2053 7472   '''For Time Str
+00035180: 7563 7475 7265 456c 656d 656e 7473 206f  uctureElements o
+00035190: 6e6c 792e 2054 6865 2072 6573 6f6c 7574  nly. The resolut
+000351a0: 696f 6e20 6f66 2074 6865 2075 6e64 6572  ion of the under
+000351b0: 6c79 696e 6720 5469 6d65 2045 6c65 6d65  lying Time Eleme
+000351c0: 6e74 2e20 5365 6520 456c 656d 656e 742e  nt. See Element.
+000351d0: 7265 736f 6c75 7469 6f6e 2066 6f72 2069  resolution for i
+000351e0: 6e66 6f72 6d61 7469 6f6e 2727 270d 0a20  nformation'''.. 
+000351f0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00035200: 6c66 2e65 6c65 6d65 6e74 2e72 6573 6f6c  lf.element.resol
+00035210: 7574 696f 6e0d 0a0d 0a20 2020 2040 7072  ution....    @pr
+00035220: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+00035230: 6f66 6673 6574 2873 656c 6629 3a0d 0a20  offset(self):.. 
+00035240: 2020 2020 2020 2027 2727 466f 7220 5469         '''For Ti
+00035250: 6d65 2053 7472 7563 7475 7265 456c 656d  me StructureElem
+00035260: 656e 7473 206f 6e6c 792e 2054 6865 206f  ents only. The o
+00035270: 6666 7365 7420 6f66 2074 6865 2075 6e64  ffset of the und
+00035280: 6572 6c79 696e 6720 5469 6d65 2045 6c65  erlying Time Ele
+00035290: 6d65 6e74 2e20 5365 6520 456c 656d 656e  ment. See Elemen
+000352a0: 742e 6f66 6673 6574 2066 6f72 2069 6e66  t.offset for inf
+000352b0: 6f72 6d61 7469 6f6e 2727 270d 0a20 2020  ormation'''..   
+000352c0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000352d0: 2e65 6c65 6d65 6e74 2e6f 6666 7365 740d  .element.offset.
+000352e0: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+000352f0: 0d0a 2020 2020 6465 6620 5f73 7461 7274  ..    def _start
+00035300: 5f64 6174 6528 7365 6c66 293a 0d0a 2020  _date(self):..  
+00035310: 2020 2020 2020 2727 2746 6f72 2054 696d        '''For Tim
+00035320: 6520 5374 7275 6374 7572 6545 6c65 6d65  e StructureEleme
+00035330: 6e74 7320 6f6e 6c79 2e20 5468 6520 2870  nts only. The (p
+00035340: 7269 7661 7465 2920 5f73 7461 7274 5f64  rivate) _start_d
+00035350: 6174 6520 6f66 2074 6865 2075 6e64 6572  ate of the under
+00035360: 6c79 696e 6720 5469 6d65 2045 6c65 6d65  lying Time Eleme
+00035370: 6e74 2e27 2727 0d0a 2020 2020 2020 2020  nt.'''..        
+00035380: 7265 7475 726e 2073 656c 662e 656c 656d  return self.elem
+00035390: 656e 742e 5f73 7461 7274 5f64 6174 650d  ent._start_date.
+000353a0: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+000353b0: 0d0a 2020 2020 6465 6620 656d 706f 7765  ..    def empowe
+000353c0: 725f 7065 7269 6f64 5f6e 756d 6265 7228  r_period_number(
+000353d0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+000353e0: 2727 2741 7070 6c69 6573 2074 6f20 7469  '''Applies to ti
+000353f0: 6d65 2065 6c65 6d65 6e74 7320 6f6e 6c79  me elements only
+00035400: 2e20 4120 7265 6164 206f 6e6c 7920 7072  . A read only pr
+00035410: 6f70 6572 7479 2074 6861 7420 7265 7475  operty that retu
+00035420: 726e 7320 7468 6520 456d 706f 7765 7220  rns the Empower 
+00035430: 5065 7269 6f64 2074 7970 6520 6e75 6d62  Period type numb
+00035440: 6572 2028 652e 672e 2033 2066 6f72 2061  er (e.g. 3 for a
+00035450: 204d 6f6e 7468 2927 2727 0d0a 2020 2020   Month)'''..    
+00035460: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00035470: 656c 656d 656e 742e 696e 7465 7276 616c  element.interval
+00035480: 5f69 6e64 6578 0d0a 0d0a 2020 2020 4070  _index....    @p
+00035490: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+000354a0: 2064 696d 656e 7369 6f6e 2873 656c 6629   dimension(self)
+000354b0: 3a0d 0a20 2020 2020 2020 2027 2727 5468  :..        '''Th
+000354c0: 6520 456d 706f 7765 7220 4469 6d65 6e73  e Empower Dimens
+000354d0: 696f 6e20 7468 6973 2053 7472 7563 7475  ion this Structu
+000354e0: 7265 456c 656d 656e 7420 6265 6c6f 6e67  reElement belong
+000354f0: 7320 746f 2727 270d 0a20 2020 2020 2020  s to'''..       
+00035500: 2069 6620 7365 6c66 2e73 7472 7563 7475   if self.structu
+00035510: 7265 2069 7320 6e6f 7420 4e6f 6e65 3a0d  re is not None:.
+00035520: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00035530: 7572 6e20 7365 6c66 2e73 7472 7563 7475  urn self.structu
+00035540: 7265 2e64 696d 656e 7369 6f6e 0d0a 2020  re.dimension..  
+00035550: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00035560: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00035570: 7365 6c66 2e65 6c65 6d65 6e74 2e64 696d  self.element.dim
+00035580: 656e 7369 6f6e 0d0a 0d0a 2020 2020 4070  ension....    @p
+00035590: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+000355a0: 2073 6974 6528 7365 6c66 293a 0d0a 2020   site(self):..  
+000355b0: 2020 2020 2020 2727 2754 6865 2073 6974        '''The sit
+000355c0: 6520 7468 6973 2053 7472 7563 7475 7265  e this Structure
+000355d0: 456c 656d 656e 7420 6265 6c6f 6e67 7320  Element belongs 
+000355e0: 746f 2727 270d 0a20 2020 2020 2020 2072  to'''..        r
+000355f0: 6574 7572 6e20 7365 6c66 2e64 696d 656e  eturn self.dimen
+00035600: 7369 6f6e 2e73 6974 650d 0a0d 0a20 2020  sion.site....   
+00035610: 2064 6566 2061 6464 5f70 6172 656e 7428   def add_parent(
+00035620: 7365 6c66 2c70 6172 656e 745f 7374 7275  self,parent_stru
+00035630: 6374 7572 655f 656c 656d 656e 7429 3a0d  cture_element):.
+00035640: 0a0d 0a20 2020 2020 2020 2023 4f6e 6c79  ...        #Only
+00035650: 2061 6464 2073 656c 6620 746f 2070 6172   add self to par
+00035660: 656e 7420 7768 656e 2063 6861 6e67 696e  ent when changin
+00035670: 6720 7061 7265 6e74 5f73 7472 7563 7475  g parent_structu
+00035680: 7265 5f65 6c65 6d65 6e74 2074 6f20 6176  re_element to av
+00035690: 6f69 6420 616e 2069 6e66 696e 6974 6520  oid an infinite 
+000356a0: 6c6f 6f70 0d0a 2020 2020 2020 2020 6966  loop..        if
+000356b0: 2073 656c 662e 5f70 6172 656e 745f 7374   self._parent_st
+000356c0: 7275 6374 7572 655f 656c 656d 656e 7420  ructure_element 
+000356d0: 6973 204e 6f6e 6520 6f72 2073 656c 662e  is None or self.
+000356e0: 5f70 6172 656e 745f 7374 7275 6374 7572  _parent_structur
+000356f0: 655f 656c 656d 656e 7421 3d70 6172 656e  e_element!=paren
+00035700: 745f 7374 7275 6374 7572 655f 656c 656d  t_structure_elem
+00035710: 656e 743a 0d0a 2020 2020 2020 2020 2020  ent:..          
+00035720: 2020 7365 6c66 2e5f 7061 7265 6e74 5f73    self._parent_s
+00035730: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+00035740: 3d70 6172 656e 745f 7374 7275 6374 7572  =parent_structur
+00035750: 655f 656c 656d 656e 740d 0a20 2020 2020  e_element..     
+00035760: 2020 2020 2020 2073 656c 662e 6973 5f72         self.is_r
+00035770: 6f6f 7420 3d20 4661 6c73 650d 0a0d 0a20  oot = False.... 
+00035780: 2020 2020 2020 2070 6172 656e 745f 7374         parent_st
+00035790: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
+000357a0: 5f61 6464 5f63 6869 6c64 2873 656c 6629  _add_child(self)
+000357b0: 0d0a 0d0a 2020 2020 6465 6620 7365 745f  ....    def set_
+000357c0: 7061 7265 6e74 2873 656c 662c 7061 7265  parent(self,pare
+000357d0: 6e74 5f73 7472 7563 7475 7265 5f65 6c65  nt_structure_ele
+000357e0: 6d65 6e74 293a 0d0a 0d0a 2020 2020 2020  ment):....      
+000357f0: 2020 6966 2073 656c 663d 3d70 6172 656e    if self==paren
+00035800: 745f 7374 7275 6374 7572 655f 656c 656d  t_structure_elem
+00035810: 656e 743a 0d0a 2020 2020 2020 2020 2020  ent:..          
+00035820: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00035830: 6f72 2827 5472 6965 6420 746f 2073 6574  or('Tried to set
+00035840: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
+00035850: 742e 7061 7265 6e74 2074 6f20 7365 6c66  t.parent to self
+00035860: 2e20 7365 6c66 2e73 686f 7274 6e61 6d65  . self.shortname
+00035870: 3d27 2b73 7472 2873 656c 662e 7368 6f72  ='+str(self.shor
+00035880: 746e 616d 6529 290d 0a0d 0a20 2020 2020  tname))....     
+00035890: 2020 2023 5265 6d6f 7665 2074 6865 2063     #Remove the c
+000358a0: 7572 7265 6e74 2070 6172 656e 7420 6966  urrent parent if
+000358b0: 2069 7420 6469 6666 6572 7320 6672 6f6d   it differs from
+000358c0: 2074 6865 206f 6e65 2062 6569 6e67 2073   the one being s
+000358d0: 6574 0d0a 2020 2020 2020 2020 6966 2073  et..        if s
+000358e0: 656c 662e 5f70 6172 656e 745f 7374 7275  elf._parent_stru
+000358f0: 6374 7572 655f 656c 656d 656e 7420 6973  cture_element is
+00035900: 206e 6f74 204e 6f6e 6520 616e 6420 7365   not None and se
+00035910: 6c66 2e5f 7061 7265 6e74 5f73 7472 7563  lf._parent_struc
+00035920: 7475 7265 5f65 6c65 6d65 6e74 213d 7061  ture_element!=pa
+00035930: 7265 6e74 5f73 7472 7563 7475 7265 5f65  rent_structure_e
+00035940: 6c65 6d65 6e74 3a0d 0a20 2020 2020 2020  lement:..       
+00035950: 2020 2020 2073 656c 662e 5f70 6172 656e       self._paren
+00035960: 745f 7374 7275 6374 7572 655f 656c 656d  t_structure_elem
+00035970: 656e 742e 7265 6d6f 7665 5f63 6869 6c64  ent.remove_child
+00035980: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
+00035990: 2020 2020 7365 6c66 2e5f 7061 7265 6e74      self._parent
+000359a0: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+000359b0: 6e74 3d4e 6f6e 650d 0a0d 0a20 2020 2020  nt=None....     
+000359c0: 2020 2023 4f6e 6c79 2061 6464 2073 656c     #Only add sel
+000359d0: 6620 746f 2070 6172 656e 7420 7768 656e  f to parent when
+000359e0: 2063 6861 6e67 696e 6720 7061 7265 6e74   changing parent
+000359f0: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00035a00: 6e74 2074 6f20 6176 6f69 6420 616e 2069  nt to avoid an i
+00035a10: 6e66 696e 6974 6520 6c6f 6f70 0d0a 2020  nfinite loop..  
+00035a20: 2020 2020 2020 6966 2073 656c 662e 5f70        if self._p
+00035a30: 6172 656e 745f 7374 7275 6374 7572 655f  arent_structure_
+00035a40: 656c 656d 656e 7420 6973 204e 6f6e 653a  element is None:
+00035a50: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00035a60: 6c66 2e5f 7061 7265 6e74 5f73 7472 7563  lf._parent_struc
+00035a70: 7475 7265 5f65 6c65 6d65 6e74 3d70 6172  ture_element=par
+00035a80: 656e 745f 7374 7275 6374 7572 655f 656c  ent_structure_el
+00035a90: 656d 656e 740d 0a0d 0a20 2020 2020 2020  ement....       
+00035aa0: 2020 2020 2069 6620 7365 6c66 2e5f 7061       if self._pa
+00035ab0: 7265 6e74 5f73 7472 7563 7475 7265 5f65  rent_structure_e
+00035ac0: 6c65 6d65 6e74 2069 7320 6e6f 7420 4e6f  lement is not No
+00035ad0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00035ae0: 2020 2020 2073 656c 662e 5f70 6172 656e       self._paren
+00035af0: 745f 7374 7275 6374 7572 655f 656c 656d  t_structure_elem
+00035b00: 656e 742e 5f61 6464 5f63 6869 6c64 2873  ent._add_child(s
+00035b10: 656c 6629 0d0a 0d0a 2020 2020 6465 6620  elf)....    def 
+00035b20: 6375 7428 7365 6c66 293a 0d0a 2020 2020  cut(self):..    
+00035b30: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
+00035b40: 2052 656d 6f76 6520 7468 6973 2073 7472   Remove this str
+00035b50: 7563 7475 7265 2065 6c65 6d65 6e74 2066  ucture element f
+00035b60: 726f 6d20 6974 7320 7061 7265 6e74 2061  rom its parent a
+00035b70: 6e64 2072 6574 7572 6e20 6974 2e0d 0a20  nd return it... 
+00035b80: 2020 2020 2020 2054 6869 7320 6675 6e63         This func
+00035b90: 7469 6f6e 2069 7320 7573 6566 756c 2077  tion is useful w
+00035ba0: 6865 6e20 7765 2061 7265 2061 626f 7574  hen we are about
+00035bb0: 2074 6f20 2770 6173 7465 2720 7468 6520   to 'paste' the 
+00035bc0: 656c 656d 656e 7420 696e 746f 2061 6e6f  element into ano
+00035bd0: 7468 6572 2073 706f 740d 0a20 2020 2020  ther spot..     
+00035be0: 2020 2027 2727 0d0a 2020 2020 2020 2020     '''..        
+00035bf0: 2352 656d 6f76 6520 7468 6520 6375 7272  #Remove the curr
+00035c00: 656e 7420 7061 7265 6e74 2069 6620 6974  ent parent if it
+00035c10: 2064 6966 6665 7273 2066 726f 6d20 7468   differs from th
+00035c20: 6520 6f6e 6520 6265 696e 6720 7365 740d  e one being set.
+00035c30: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00035c40: 2e5f 7061 7265 6e74 5f73 7472 7563 7475  ._parent_structu
+00035c50: 7265 5f65 6c65 6d65 6e74 2069 7320 6e6f  re_element is no
+00035c60: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00035c70: 2020 2020 2073 656c 662e 5f70 6172 656e       self._paren
+00035c80: 745f 7374 7275 6374 7572 655f 656c 656d  t_structure_elem
+00035c90: 656e 742e 7265 6d6f 7665 5f63 6869 6c64  ent.remove_child
+00035ca0: 2873 656c 6629 0d0a 2020 2020 2020 2020  (self)..        
+00035cb0: 2020 2020 7365 6c66 2e5f 7061 7265 6e74      self._parent
+00035cc0: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00035cd0: 6e74 3d4e 6f6e 650d 0a0d 0a20 2020 2020  nt=None....     
+00035ce0: 2020 2072 6574 7572 6e20 7365 6c66 0d0a     return self..
+00035cf0: 0d0a 2020 2020 6465 6620 5f61 6464 5f63  ..    def _add_c
+00035d00: 6869 6c64 2873 656c 662c 6368 696c 645f  hild(self,child_
+00035d10: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+00035d20: 7429 3a0d 0a20 2020 2020 2020 2073 656c  t):..        sel
+00035d30: 662e 5f63 6869 6c64 5f73 7472 7563 7475  f._child_structu
+00035d40: 7265 5f65 6c65 6d65 6e74 732e 6170 7065  re_elements.appe
+00035d50: 6e64 2863 6869 6c64 5f73 7472 7563 7475  nd(child_structu
+00035d60: 7265 5f65 6c65 6d65 6e74 290d 0a20 2020  re_element)..   
+00035d70: 2020 2020 2069 6620 6368 696c 645f 7374       if child_st
+00035d80: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
+00035d90: 7061 7265 6e74 2069 7320 4e6f 6e65 206f  parent is None o
+00035da0: 7220 6368 696c 645f 7374 7275 6374 7572  r child_structur
+00035db0: 655f 656c 656d 656e 742e 7061 7265 6e74  e_element.parent
+00035dc0: 2021 3d20 7365 6c66 3a0d 0a20 2020 2020   != self:..     
+00035dd0: 2020 2020 2020 2063 6869 6c64 5f73 7472         child_str
+00035de0: 7563 7475 7265 5f65 6c65 6d65 6e74 2e5f  ucture_element._
+00035df0: 7061 7265 6e74 5f73 7472 7563 7475 7265  parent_structure
+00035e00: 5f65 6c65 6d65 6e74 3d73 656c 660d 0a20  _element=self.. 
+00035e10: 2020 2020 2020 2020 2020 2063 6869 6c64             child
+00035e20: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00035e30: 6e74 2e69 735f 726f 6f74 203d 2046 616c  nt.is_root = Fal
+00035e40: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00035e50: 6368 696c 645f 7374 7275 6374 7572 655f  child_structure_
+00035e60: 656c 656d 656e 742e 7374 7275 6374 7572  element.structur
+00035e70: 653d 7365 6c66 2e73 7472 7563 7475 7265  e=self.structure
+00035e80: 0d0a 2020 2020 2020 2020 6c6f 672e 6465  ..        log.de
+00035e90: 6275 6728 2741 6464 6564 2043 6869 6c64  bug('Added Child
+00035ea0: 2027 2b63 6869 6c64 5f73 7472 7563 7475   '+child_structu
+00035eb0: 7265 5f65 6c65 6d65 6e74 2e73 686f 7274  re_element.short
+00035ec0: 6e61 6d65 2b27 2074 6f20 272b 7365 6c66  name+' to '+self
+00035ed0: 2e73 686f 7274 6e61 6d65 290d 0a0d 0a20  .shortname).... 
+00035ee0: 2020 2064 6566 2061 6464 5f63 6869 6c64     def add_child
+00035ef0: 2873 656c 662c 6368 696c 645f 7374 7275  (self,child_stru
+00035f00: 6374 7572 655f 656c 656d 656e 7429 3a0d  cture_element):.
+00035f10: 0a20 2020 2020 2020 2027 2727 4164 6420  .        '''Add 
+00035f20: 6120 6368 696c 6420 5374 7275 6374 7572  a child Structur
+00035f30: 6545 6c65 6d65 6e74 2074 6f20 2e63 6869  eElement to .chi
+00035f40: 6c64 7265 6e2e 0d0a 0d0a 2020 2020 2020  ldren.....      
+00035f50: 2020 3a70 6172 616d 2063 6869 6c64 5f73    :param child_s
+00035f60: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+00035f70: 3a20 5374 7275 6374 7572 6545 6c65 6d65  : StructureEleme
+00035f80: 6e74 2c20 456c 656d 656e 7420 6f72 2073  nt, Element or s
+00035f90: 686f 7274 636f 6465 2073 7472 696e 6720  hortcode string 
+00035fa0: 7265 6665 7272 696e 6720 746f 2061 6e20  referring to an 
+00035fb0: 656c 656d 656e 742e 2054 6865 2063 6869  element. The chi
+00035fc0: 6c64 2077 6520 7769 7368 2074 6f20 6164  ld we wish to ad
+00035fd0: 6420 746f 2074 6869 7320 5374 7275 6374  d to this Struct
+00035fe0: 7572 6545 6c65 6d65 6e74 2e0d 0a20 2020  ureElement...   
+00035ff0: 2020 2020 2027 2727 0d0a 2020 2020 2020       '''..      
+00036000: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00036010: 6368 696c 645f 7374 7275 6374 7572 655f  child_structure_
+00036020: 656c 656d 656e 742c 5374 7275 6374 7572  element,Structur
+00036030: 6545 6c65 6d65 6e74 293a 0d0a 2020 2020  eElement):..    
+00036040: 2020 2020 2020 2020 7365 6c66 2e5f 6164          self._ad
+00036050: 645f 6368 696c 6428 6368 696c 645f 7374  d_child(child_st
+00036060: 7275 6374 7572 655f 656c 656d 656e 7429  ructure_element)
+00036070: 0d0a 2020 2020 2020 2020 656c 6966 2069  ..        elif i
+00036080: 7369 6e73 7461 6e63 6528 6368 696c 645f  sinstance(child_
+00036090: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+000360a0: 742c 456c 656d 656e 7429 3a0d 0a20 2020  t,Element):..   
+000360b0: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
+000360c0: 6464 5f63 6869 6c64 2853 7472 7563 7475  dd_child(Structu
+000360d0: 7265 456c 656d 656e 7428 656c 656d 656e  reElement(elemen
+000360e0: 743d 6368 696c 645f 7374 7275 6374 7572  t=child_structur
+000360f0: 655f 656c 656d 656e 7429 290d 0a20 2020  e_element))..   
+00036100: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+00036110: 616e 6365 2863 6869 6c64 5f73 7472 7563  ance(child_struc
+00036120: 7475 7265 5f65 6c65 6d65 6e74 2c73 7472  ture_element,str
+00036130: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00036140: 2343 7265 6174 6520 6120 5374 7275 6374  #Create a Struct
+00036150: 7572 6545 6c65 6d65 6e74 2062 7920 6c6f  ureElement by lo
+00036160: 6f6b 696e 6720 7570 2074 6865 2065 6c65  oking up the ele
+00036170: 6d65 6e74 2073 686f 7274 6e61 6d65 2066  ment shortname f
+00036180: 726f 6d20 7468 6520 7374 7269 6e67 0d0a  rom the string..
+00036190: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000361a0: 2e5f 6164 645f 6368 696c 6428 5374 7275  ._add_child(Stru
+000361b0: 6374 7572 6545 6c65 6d65 6e74 2865 6c65  ctureElement(ele
+000361c0: 6d65 6e74 3d73 656c 662e 6469 6d65 6e73  ment=self.dimens
+000361d0: 696f 6e2e 656c 656d 656e 7473 5b63 6869  ion.elements[chi
+000361e0: 6c64 5f73 7472 7563 7475 7265 5f65 6c65  ld_structure_ele
+000361f0: 6d65 6e74 5d29 290d 0a0d 0a0d 0a20 2020  ment]))......   
+00036200: 2064 6566 2072 656d 6f76 655f 6368 696c   def remove_chil
+00036210: 6472 656e 2873 656c 6629 3a0d 0a20 2020  dren(self):..   
+00036220: 2020 2020 2027 2727 5265 6d6f 7665 2061       '''Remove a
+00036230: 6c6c 2063 6869 6c64 7265 6e20 6672 6f6d  ll children from
+00036240: 2074 6869 7320 7374 7275 6374 7572 6520   this structure 
+00036250: 656c 656d 656e 742f 2053 616d 6520 6173  element/ Same as
+00036260: 202e 6368 696c 6472 656e 2e63 6c65 6172   .children.clear
+00036270: 2829 2727 270d 0a20 2020 2020 2020 2023  ()'''..        #
+00036280: 7265 7365 7420 7468 6520 5f63 6869 6c64  reset the _child
+00036290: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+000362a0: 6e74 7320 746f 2061 6e20 656d 7074 7920  nts to an empty 
+000362b0: 4f72 6465 7265 6444 6963 740d 0a20 2020  OrderedDict..   
+000362c0: 2020 2020 2066 6f72 2063 6820 696e 2073       for ch in s
+000362d0: 656c 662e 6368 696c 6472 656e 2e76 616c  elf.children.val
+000362e0: 7565 7328 293a 0d0a 2020 2020 2020 2020  ues():..        
+000362f0: 2020 2020 6368 2e5f 7061 7265 6e74 5f73      ch._parent_s
 00036300: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00036310: 733d 5b5d 0d0a 0d0a 2020 2020 6465 6620  s=[]....    def 
-00036320: 7265 6d6f 7665 5f63 6869 6c64 2873 656c  remove_child(sel
-00036330: 662c 6368 696c 645f 7374 7275 6374 7572  f,child_structur
-00036340: 655f 656c 656d 656e 7429 3a0d 0a20 2020  e_element):..   
-00036350: 2020 2020 2027 2727 5265 6d6f 7665 2061       '''Remove a
-00036360: 2043 6869 6c64 2053 7472 7563 7475 7265   Child Structure
-00036370: 456c 656d 656e 742e 2049 6620 6120 7368  Element. If a sh
-00036380: 6f72 7463 6f64 6520 6973 2070 6173 7365  ortcode is passe
-00036390: 6420 696e 2c20 7265 6d6f 7665 2074 6865  d in, remove the
-000363a0: 2066 696e 616c 2063 6869 6c64 2053 7472   final child Str
-000363b0: 7563 7475 7265 456c 656d 656e 7420 7769  uctureElement wi
-000363c0: 7468 2074 6861 7420 7368 6f72 7463 6f64  th that shortcod
-000363d0: 6527 2727 0d0a 0d0a 2020 2020 2020 2020  e'''....        
-000363e0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-000363f0: 2020 2354 6573 7420 6966 2077 6520 6172    #Test if we ar
-00036400: 6520 6c6f 6f6b 6769 6e20 6174 2061 2073  e lookgin at a s
-00036410: 686f 7274 6e61 6d65 206f 7220 616e 2065  hortname or an e
-00036420: 6c65 6d65 6e74 2062 7920 7072 6f76 6f6b  lement by provok
-00036430: 696e 6720 6120 7479 7065 2065 7272 6f72  ing a type error
-00036440: 0d0a 2020 2020 2020 2020 2020 2020 7368  ..            sh
-00036450: 6f72 746e 616d 6520 3d20 6368 696c 645f  ortname = child_
-00036460: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-00036470: 7420 2b20 2727 0d0a 0d0a 2020 2020 2020  t + ''....      
-00036480: 2020 6578 6365 7074 2054 7970 6545 7272    except TypeErr
-00036490: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-000364a0: 2073 686f 7274 6e61 6d65 203d 204e 6f6e   shortname = Non
-000364b0: 650d 0a0d 0a20 2020 2020 2020 2069 6620  e....        if 
-000364c0: 7368 6f72 746e 616d 6520 6973 204e 6f6e  shortname is Non
-000364d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000364e0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-000364f0: 2020 2020 2020 2349 6620 7468 6520 656c        #If the el
-00036500: 656d 656e 7420 646f 6573 6e27 7420 6578  ement doesn't ex
-00036510: 6973 7420 7468 6174 2773 2066 696e 652c  ist that's fine,
-00036520: 206d 616b 696e 6720 7265 6d6f 7665 5f63   making remove_c
-00036530: 6869 6c64 2069 6465 6d70 6f74 656e 740d  hild idempotent.
-00036540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036550: 2073 656c 662e 5f63 6869 6c64 5f73 7472   self._child_str
-00036560: 7563 7475 7265 5f65 6c65 6d65 6e74 732e  ucture_elements.
-00036570: 7265 6d6f 7665 2863 6869 6c64 5f73 7472  remove(child_str
-00036580: 7563 7475 7265 5f65 6c65 6d65 6e74 290d  ucture_element).
-00036590: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-000365a0: 6570 7420 5661 6c75 6545 7272 6f72 3a0d  ept ValueError:.
-000365b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000365c0: 2072 6574 7572 6e0d 0a20 2020 2020 2020   return..       
-000365d0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000365e0: 2020 2020 656c 656d 656e 745f 746f 5f72      element_to_r
-000365f0: 656d 6f76 6520 3d20 4e6f 6e65 0d0a 2020  emove = None..  
-00036600: 2020 2020 2020 2020 2020 2352 656d 6f76            #Remov
-00036610: 6520 7468 6520 6c61 7374 2065 6c65 6d65  e the last eleme
-00036620: 6e74 2077 6974 6820 7468 6174 2073 686f  nt with that sho
-00036630: 7274 636f 6465 0d0a 2020 2020 2020 2020  rtcode..        
-00036640: 2020 2020 666f 7220 6e2c 656c 2069 6e20      for n,el in 
-00036650: 656e 756d 6572 6174 6528 7365 6c66 2e5f  enumerate(self._
-00036660: 6368 696c 645f 7374 7275 6374 7572 655f  child_structure_
-00036670: 656c 656d 656e 7473 5b3a 3a2d 315d 293a  elements[::-1]):
-00036680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00036690: 2020 6966 2065 6c2e 7368 6f72 746e 616d    if el.shortnam
-000366a0: 6520 3d3d 2073 686f 7274 6e61 6d65 3a0d  e == shortname:.
-000366b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000366c0: 2020 2020 2065 6c65 6d65 6e74 5f74 6f5f       element_to_
-000366d0: 7265 6d6f 7665 203d 2065 6c0d 0a20 2020  remove = el..   
+00036310: 3d4e 6f6e 650d 0a20 2020 2020 2020 2073  =None..        s
+00036320: 656c 662e 5f63 6869 6c64 5f73 7472 7563  elf._child_struc
+00036330: 7475 7265 5f65 6c65 6d65 6e74 733d 5b5d  ture_elements=[]
+00036340: 0d0a 0d0a 2020 2020 6465 6620 7265 6d6f  ....    def remo
+00036350: 7665 5f63 6869 6c64 2873 656c 662c 6368  ve_child(self,ch
+00036360: 696c 645f 7374 7275 6374 7572 655f 656c  ild_structure_el
+00036370: 656d 656e 7429 3a0d 0a20 2020 2020 2020  ement):..       
+00036380: 2027 2727 5265 6d6f 7665 2061 2043 6869   '''Remove a Chi
+00036390: 6c64 2053 7472 7563 7475 7265 456c 656d  ld StructureElem
+000363a0: 656e 742e 2049 6620 6120 7368 6f72 7463  ent. If a shortc
+000363b0: 6f64 6520 6973 2070 6173 7365 6420 696e  ode is passed in
+000363c0: 2c20 7265 6d6f 7665 2074 6865 2066 696e  , remove the fin
+000363d0: 616c 2063 6869 6c64 2053 7472 7563 7475  al child Structu
+000363e0: 7265 456c 656d 656e 7420 7769 7468 2074  reElement with t
+000363f0: 6861 7420 7368 6f72 7463 6f64 6527 2727  hat shortcode'''
+00036400: 0d0a 0d0a 2020 2020 2020 2020 7472 793a  ....        try:
+00036410: 0d0a 2020 2020 2020 2020 2020 2020 2354  ..            #T
+00036420: 6573 7420 6966 2077 6520 6172 6520 6c6f  est if we are lo
+00036430: 6f6b 6769 6e20 6174 2061 2073 686f 7274  okgin at a short
+00036440: 6e61 6d65 206f 7220 616e 2065 6c65 6d65  name or an eleme
+00036450: 6e74 2062 7920 7072 6f76 6f6b 696e 6720  nt by provoking 
+00036460: 6120 7479 7065 2065 7272 6f72 0d0a 2020  a type error..  
+00036470: 2020 2020 2020 2020 2020 7368 6f72 746e            shortn
+00036480: 616d 6520 3d20 6368 696c 645f 7374 7275  ame = child_stru
+00036490: 6374 7572 655f 656c 656d 656e 7420 2b20  cture_element + 
+000364a0: 2727 0d0a 0d0a 2020 2020 2020 2020 6578  ''....        ex
+000364b0: 6365 7074 2054 7970 6545 7272 6f72 3a0d  cept TypeError:.
+000364c0: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+000364d0: 7274 6e61 6d65 203d 204e 6f6e 650d 0a0d  rtname = None...
+000364e0: 0a20 2020 2020 2020 2069 6620 7368 6f72  .        if shor
+000364f0: 746e 616d 6520 6973 204e 6f6e 653a 0d0a  tname is None:..
+00036500: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00036510: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00036520: 2020 2349 6620 7468 6520 656c 656d 656e    #If the elemen
+00036530: 7420 646f 6573 6e27 7420 6578 6973 7420  t doesn't exist 
+00036540: 7468 6174 2773 2066 696e 652c 206d 616b  that's fine, mak
+00036550: 696e 6720 7265 6d6f 7665 5f63 6869 6c64  ing remove_child
+00036560: 2069 6465 6d70 6f74 656e 740d 0a20 2020   idempotent..   
+00036570: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00036580: 662e 5f63 6869 6c64 5f73 7472 7563 7475  f._child_structu
+00036590: 7265 5f65 6c65 6d65 6e74 732e 7265 6d6f  re_elements.remo
+000365a0: 7665 2863 6869 6c64 5f73 7472 7563 7475  ve(child_structu
+000365b0: 7265 5f65 6c65 6d65 6e74 290d 0a20 2020  re_element)..   
+000365c0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+000365d0: 5661 6c75 6545 7272 6f72 3a0d 0a20 2020  ValueError:..   
+000365e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000365f0: 7572 6e0d 0a20 2020 2020 2020 2065 6c73  urn..        els
+00036600: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00036610: 656c 656d 656e 745f 746f 5f72 656d 6f76  element_to_remov
+00036620: 6520 3d20 4e6f 6e65 0d0a 2020 2020 2020  e = None..      
+00036630: 2020 2020 2020 2352 656d 6f76 6520 7468        #Remove th
+00036640: 6520 6c61 7374 2065 6c65 6d65 6e74 2077  e last element w
+00036650: 6974 6820 7468 6174 2073 686f 7274 636f  ith that shortco
+00036660: 6465 0d0a 2020 2020 2020 2020 2020 2020  de..            
+00036670: 666f 7220 6e2c 656c 2069 6e20 656e 756d  for n,el in enum
+00036680: 6572 6174 6528 7365 6c66 2e5f 6368 696c  erate(self._chil
+00036690: 645f 7374 7275 6374 7572 655f 656c 656d  d_structure_elem
+000366a0: 656e 7473 5b3a 3a2d 315d 293a 0d0a 2020  ents[::-1]):..  
+000366b0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000366c0: 2065 6c2e 7368 6f72 746e 616d 6520 3d3d   el.shortname ==
+000366d0: 2073 686f 7274 6e61 6d65 3a0d 0a20 2020   shortname:..   
 000366e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000366f0: 2023 6c6f 672e 696e 666f 2827 5265 6d6f   #log.info('Remo
-00036700: 7669 6e67 2063 6869 6c64 207b 7d27 2e66  ving child {}'.f
-00036710: 6f72 6d61 7428 2d28 6e2b 3129 2929 0d0a  ormat(-(n+1)))..
-00036720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036730: 2020 2020 6272 6561 6b0d 0a20 2020 2020      break..     
-00036740: 2020 2020 2020 2069 6620 656c 656d 656e         if elemen
-00036750: 745f 746f 5f72 656d 6f76 6520 6973 206e  t_to_remove is n
-00036760: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00036770: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00036780: 6368 696c 645f 7374 7275 6374 7572 655f  child_structure_
-00036790: 656c 656d 656e 7473 2e72 656d 6f76 6528  elements.remove(
-000367a0: 656c 656d 656e 745f 746f 5f72 656d 6f76  element_to_remov
-000367b0: 6529 0d0a 0d0a 2020 2020 6465 6620 7265  e)....    def re
-000367c0: 706c 6163 655f 6368 696c 6428 7365 6c66  place_child(self
-000367d0: 2c63 6869 6c64 5f73 7472 7563 7475 7265  ,child_structure
-000367e0: 5f65 6c65 6d65 6e74 2c72 6570 6c61 6365  _element,replace
-000367f0: 6d65 6e74 733d 4e6f 6e65 293a 0d0a 2020  ments=None):..  
-00036800: 2020 2020 2020 2727 2752 6570 6c61 6365        '''Replace
-00036810: 206f 6e65 206f 6620 7468 6520 6368 696c   one of the chil
-00036820: 6420 7374 7275 6374 7572 6520 656c 656d  d structure elem
-00036830: 656e 7473 2077 6974 6820 6f6e 6520 6f72  ents with one or
-00036840: 206d 6f72 6520 7374 7275 6374 7572 6520   more structure 
-00036850: 656c 656d 656e 7473 2069 6e20 7468 6520  elements in the 
-00036860: 7361 6d65 2073 706f 740d 0a20 2020 2020  same spot..     
-00036870: 2020 2049 6620 7468 6572 6520 6172 6520     If there are 
-00036880: 6e6f 2072 6570 6c61 6365 6d65 6e74 732c  no replacements,
-00036890: 2074 6869 7320 6675 6e63 7469 6f6e 2077   this function w
-000368a0: 696c 6c20 6265 6861 7665 2069 6e20 7468  ill behave in th
-000368b0: 6520 7361 6d65 2077 6179 2061 7320 6072  e same way as `r
-000368c0: 656d 6f76 655f 6368 696c 6460 202d 206f  emove_child` - o
-000368d0: 6e6c 7920 6974 2077 696c 6c20 7468 726f  nly it will thro
-000368e0: 7720 6120 4b65 7945 7272 6f72 2069 6620  w a KeyError if 
-000368f0: 7468 6520 6368 696c 6420 646f 6573 206e  the child does n
-00036900: 6f74 2065 7869 7374 0d0a 2020 2020 2020  ot exist..      
-00036910: 2020 3a70 6172 616d 2063 6869 6c64 5f73    :param child_s
-00036920: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00036930: 3a20 5374 7275 6374 7572 6520 656c 656d  : Structure elem
-00036940: 656e 7420 696e 2063 6869 6c64 7265 6e20  ent in children 
-00036950: 746f 2072 6570 6c61 6365 202d 2069 6620  to replace - if 
-00036960: 6e6f 7420 666f 756e 6420 6120 4b65 7945  not found a KeyE
-00036970: 7272 6f72 2077 696c 6c20 6265 2072 6169  rror will be rai
-00036980: 7365 640d 0a20 2020 2020 2020 203a 7061  sed..        :pa
-00036990: 7261 6d20 7265 706c 6163 656d 656e 7473  ram replacements
-000369a0: 3a20 6120 5374 7275 6374 7572 6545 6c65  : a StructureEle
-000369b0: 6d65 6e74 206f 7220 6c69 7374 206f 6620  ment or list of 
-000369c0: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-000369d0: 7320 746f 2072 6570 6c61 6365 0d0a 2020  s to replace..  
-000369e0: 2020 2020 2020 2727 270d 0a0d 0a20 2020        '''....   
-000369f0: 2020 2020 2069 6620 6e6f 7420 6368 696c       if not chil
-00036a00: 645f 7374 7275 6374 7572 655f 656c 656d  d_structure_elem
-00036a10: 656e 7420 696e 2073 656c 662e 6368 696c  ent in self.chil
-00036a20: 6472 656e 3a0d 0a20 2020 2020 2020 2020  dren:..         
-00036a30: 2020 2072 6169 7365 204b 6579 4572 726f     raise KeyErro
-00036a40: 7228 2743 6869 6c64 2053 7472 7563 7475  r('Child Structu
-00036a50: 7265 456c 656d 656e 7428 7b7d 2c20 7b7d  reElement({}, {}
-00036a60: 2920 6469 6420 6e6f 7420 6578 6973 7420  ) did not exist 
-00036a70: 696e 2053 7472 7563 7475 7265 456c 656d  in StructureElem
-00036a80: 656e 7428 7b7d 2c20 7b7d 2927 2e66 6f72  ent({}, {})'.for
-00036a90: 6d61 7428 6368 696c 645f 7374 7275 6374  mat(child_struct
-00036aa0: 7572 655f 656c 656d 656e 742e 7368 6f72  ure_element.shor
-00036ab0: 746e 616d 652c 2063 6869 6c64 5f73 7472  tname, child_str
-00036ac0: 7563 7475 7265 5f65 6c65 6d65 6e74 2e6c  ucture_element.l
-00036ad0: 6f6e 676e 616d 652c 7365 6c66 2e73 686f  ongname,self.sho
-00036ae0: 7274 6e61 6d65 2c73 656c 662e 6c6f 6e67  rtname,self.long
-00036af0: 6e61 6d65 2929 0d0a 0d0a 2020 2020 2020  name))....      
-00036b00: 2020 6966 2072 6570 6c61 6365 6d65 6e74    if replacement
-00036b10: 7320 6973 204e 6f6e 6520 6f72 206c 656e  s is None or len
-00036b20: 2872 6570 6c61 6365 6d65 6e74 7329 203d  (replacements) =
-00036b30: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
-00036b40: 2020 7365 6c66 2e72 656d 6f76 655f 6368    self.remove_ch
-00036b50: 696c 6428 6368 696c 645f 7374 7275 6374  ild(child_struct
-00036b60: 7572 655f 656c 656d 656e 7429 0d0a 2020  ure_element)..  
-00036b70: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00036b80: 2020 2020 2020 2020 2023 4d61 6b65 2073           #Make s
-00036b90: 7572 6520 7265 706c 6163 656d 656e 7473  ure replacements
-00036ba0: 2069 7320 6120 6c69 7374 206f 6620 7374   is a list of st
-00036bb0: 7275 6374 7572 6520 656c 656d 656e 7473  ructure elements
-00036bc0: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-00036bd0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00036be0: 2020 2020 2346 6972 7374 2069 7320 6974      #First is it
-00036bf0: 2061 206c 6f6e 6520 5374 7275 6374 7572   a lone Structur
-00036c00: 6545 6c65 6d65 6e74 3f20 4966 2073 6f20  eElement? If so 
-00036c10: 7075 7420 6974 2069 6e20 6120 6c69 7374  put it in a list
-00036c20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00036c30: 2020 7265 706c 6163 656d 656e 7473 2e73    replacements.s
-00036c40: 686f 7274 6e61 6d65 0d0a 2020 2020 2020  hortname..      
-00036c50: 2020 2020 2020 2020 2020 7265 706c 6163            replac
-00036c60: 656d 656e 7473 203d 205b 7265 706c 6163  ements = [replac
-00036c70: 656d 656e 7473 5d0d 0a20 2020 2020 2020  ements]..       
-00036c80: 2020 2020 2065 7863 6570 7420 4174 7472       except Attr
-00036c90: 6962 7574 6545 7272 6f72 3a0d 0a20 2020  ibuteError:..   
-00036ca0: 2020 2020 2020 2020 2020 2020 2023 4173               #As
-00036cb0: 7375 6d65 2072 6570 6c61 6365 6d65 6e74  sume replacement
-00036cc0: 7320 6973 2061 6c72 6561 6479 2061 206c  s is already a l
-00036cd0: 6973 7420 286f 7220 6974 6572 6162 6c65  ist (or iterable
-00036ce0: 2920 6f66 2072 6570 6c61 636d 656e 7420  ) of replacment 
-00036cf0: 7661 6c75 6573 0d0a 2020 2020 2020 2020  values..        
-00036d00: 2020 2020 2020 2020 7061 7373 0d0a 0d0a          pass....
-00036d10: 2020 2020 2020 2020 2020 2020 6265 666f              befo
-00036d20: 7265 5f63 6869 6c64 7265 6e5f 7368 6f72  re_children_shor
-00036d30: 7463 6f64 6573 203d 205b 5d0d 0a20 2020  tcodes = []..   
-00036d40: 2020 2020 2020 2020 2061 6674 6572 5f63           after_c
+000366f0: 2065 6c65 6d65 6e74 5f74 6f5f 7265 6d6f   element_to_remo
+00036700: 7665 203d 2065 6c0d 0a20 2020 2020 2020  ve = el..       
+00036710: 2020 2020 2020 2020 2020 2020 2023 6c6f               #lo
+00036720: 672e 696e 666f 2827 5265 6d6f 7669 6e67  g.info('Removing
+00036730: 2063 6869 6c64 207b 7d27 2e66 6f72 6d61   child {}'.forma
+00036740: 7428 2d28 6e2b 3129 2929 0d0a 2020 2020  t(-(n+1)))..    
+00036750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036760: 6272 6561 6b0d 0a20 2020 2020 2020 2020  break..         
+00036770: 2020 2069 6620 656c 656d 656e 745f 746f     if element_to
+00036780: 5f72 656d 6f76 6520 6973 206e 6f74 204e  _remove is not N
+00036790: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+000367a0: 2020 2020 2020 7365 6c66 2e5f 6368 696c        self._chil
+000367b0: 645f 7374 7275 6374 7572 655f 656c 656d  d_structure_elem
+000367c0: 656e 7473 2e72 656d 6f76 6528 656c 656d  ents.remove(elem
+000367d0: 656e 745f 746f 5f72 656d 6f76 6529 0d0a  ent_to_remove)..
+000367e0: 0d0a 2020 2020 6465 6620 7265 706c 6163  ..    def replac
+000367f0: 655f 6368 696c 6428 7365 6c66 2c63 6869  e_child(self,chi
+00036800: 6c64 5f73 7472 7563 7475 7265 5f65 6c65  ld_structure_ele
+00036810: 6d65 6e74 2c72 6570 6c61 6365 6d65 6e74  ment,replacement
+00036820: 733d 4e6f 6e65 293a 0d0a 2020 2020 2020  s=None):..      
+00036830: 2020 2727 2752 6570 6c61 6365 206f 6e65    '''Replace one
+00036840: 206f 6620 7468 6520 6368 696c 6420 7374   of the child st
+00036850: 7275 6374 7572 6520 656c 656d 656e 7473  ructure elements
+00036860: 2077 6974 6820 6f6e 6520 6f72 206d 6f72   with one or mor
+00036870: 6520 7374 7275 6374 7572 6520 656c 656d  e structure elem
+00036880: 656e 7473 2069 6e20 7468 6520 7361 6d65  ents in the same
+00036890: 2073 706f 740d 0a20 2020 2020 2020 2049   spot..        I
+000368a0: 6620 7468 6572 6520 6172 6520 6e6f 2072  f there are no r
+000368b0: 6570 6c61 6365 6d65 6e74 732c 2074 6869  eplacements, thi
+000368c0: 7320 6675 6e63 7469 6f6e 2077 696c 6c20  s function will 
+000368d0: 6265 6861 7665 2069 6e20 7468 6520 7361  behave in the sa
+000368e0: 6d65 2077 6179 2061 7320 6072 656d 6f76  me way as `remov
+000368f0: 655f 6368 696c 6460 202d 206f 6e6c 7920  e_child` - only 
+00036900: 6974 2077 696c 6c20 7468 726f 7720 6120  it will throw a 
+00036910: 4b65 7945 7272 6f72 2069 6620 7468 6520  KeyError if the 
+00036920: 6368 696c 6420 646f 6573 206e 6f74 2065  child does not e
+00036930: 7869 7374 0d0a 2020 2020 2020 2020 3a70  xist..        :p
+00036940: 6172 616d 2063 6869 6c64 5f73 7472 7563  aram child_struc
+00036950: 7475 7265 5f65 6c65 6d65 6e74 3a20 5374  ture_element: St
+00036960: 7275 6374 7572 6520 656c 656d 656e 7420  ructure element 
+00036970: 696e 2063 6869 6c64 7265 6e20 746f 2072  in children to r
+00036980: 6570 6c61 6365 202d 2069 6620 6e6f 7420  eplace - if not 
+00036990: 666f 756e 6420 6120 4b65 7945 7272 6f72  found a KeyError
+000369a0: 2077 696c 6c20 6265 2072 6169 7365 640d   will be raised.
+000369b0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000369c0: 7265 706c 6163 656d 656e 7473 3a20 6120  replacements: a 
+000369d0: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+000369e0: 206f 7220 6c69 7374 206f 6620 5374 7275   or list of Stru
+000369f0: 6374 7572 6545 6c65 6d65 6e74 7320 746f  ctureElements to
+00036a00: 2072 6570 6c61 6365 0d0a 2020 2020 2020   replace..      
+00036a10: 2020 2727 270d 0a0d 0a20 2020 2020 2020    '''....       
+00036a20: 2069 6620 6e6f 7420 6368 696c 645f 7374   if not child_st
+00036a30: 7275 6374 7572 655f 656c 656d 656e 7420  ructure_element 
+00036a40: 696e 2073 656c 662e 6368 696c 6472 656e  in self.children
+00036a50: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00036a60: 6169 7365 204b 6579 4572 726f 7228 2743  aise KeyError('C
+00036a70: 6869 6c64 2053 7472 7563 7475 7265 456c  hild StructureEl
+00036a80: 656d 656e 7428 7b7d 2c20 7b7d 2920 6469  ement({}, {}) di
+00036a90: 6420 6e6f 7420 6578 6973 7420 696e 2053  d not exist in S
+00036aa0: 7472 7563 7475 7265 456c 656d 656e 7428  tructureElement(
+00036ab0: 7b7d 2c20 7b7d 2927 2e66 6f72 6d61 7428  {}, {})'.format(
+00036ac0: 6368 696c 645f 7374 7275 6374 7572 655f  child_structure_
+00036ad0: 656c 656d 656e 742e 7368 6f72 746e 616d  element.shortnam
+00036ae0: 652c 2063 6869 6c64 5f73 7472 7563 7475  e, child_structu
+00036af0: 7265 5f65 6c65 6d65 6e74 2e6c 6f6e 676e  re_element.longn
+00036b00: 616d 652c 7365 6c66 2e73 686f 7274 6e61  ame,self.shortna
+00036b10: 6d65 2c73 656c 662e 6c6f 6e67 6e61 6d65  me,self.longname
+00036b20: 2929 0d0a 0d0a 2020 2020 2020 2020 6966  ))....        if
+00036b30: 2072 6570 6c61 6365 6d65 6e74 7320 6973   replacements is
+00036b40: 204e 6f6e 6520 6f72 206c 656e 2872 6570   None or len(rep
+00036b50: 6c61 6365 6d65 6e74 7329 203d 3d20 303a  lacements) == 0:
+00036b60: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00036b70: 6c66 2e72 656d 6f76 655f 6368 696c 6428  lf.remove_child(
+00036b80: 6368 696c 645f 7374 7275 6374 7572 655f  child_structure_
+00036b90: 656c 656d 656e 7429 0d0a 2020 2020 2020  element)..      
+00036ba0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00036bb0: 2020 2020 2023 4d61 6b65 2073 7572 6520       #Make sure 
+00036bc0: 7265 706c 6163 656d 656e 7473 2069 7320  replacements is 
+00036bd0: 6120 6c69 7374 206f 6620 7374 7275 6374  a list of struct
+00036be0: 7572 6520 656c 656d 656e 7473 0d0a 2020  ure elements..  
+00036bf0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
+00036c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036c10: 2346 6972 7374 2069 7320 6974 2061 206c  #First is it a l
+00036c20: 6f6e 6520 5374 7275 6374 7572 6545 6c65  one StructureEle
+00036c30: 6d65 6e74 3f20 4966 2073 6f20 7075 7420  ment? If so put 
+00036c40: 6974 2069 6e20 6120 6c69 7374 0d0a 2020  it in a list..  
+00036c50: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00036c60: 706c 6163 656d 656e 7473 2e73 686f 7274  placements.short
+00036c70: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+00036c80: 2020 2020 2020 7265 706c 6163 656d 656e        replacemen
+00036c90: 7473 203d 205b 7265 706c 6163 656d 656e  ts = [replacemen
+00036ca0: 7473 5d0d 0a20 2020 2020 2020 2020 2020  ts]..           
+00036cb0: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
+00036cc0: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
+00036cd0: 2020 2020 2020 2020 2023 4173 7375 6d65           #Assume
+00036ce0: 2072 6570 6c61 6365 6d65 6e74 7320 6973   replacements is
+00036cf0: 2061 6c72 6561 6479 2061 206c 6973 7420   already a list 
+00036d00: 286f 7220 6974 6572 6162 6c65 2920 6f66  (or iterable) of
+00036d10: 2072 6570 6c61 636d 656e 7420 7661 6c75   replacment valu
+00036d20: 6573 0d0a 2020 2020 2020 2020 2020 2020  es..            
+00036d30: 2020 2020 7061 7373 0d0a 0d0a 2020 2020      pass....    
+00036d40: 2020 2020 2020 2020 6265 666f 7265 5f63          before_c
 00036d50: 6869 6c64 7265 6e5f 7368 6f72 7463 6f64  hildren_shortcod
 00036d60: 6573 203d 205b 5d0d 0a20 2020 2020 2020  es = []..       
-00036d70: 2020 2020 2072 6570 6c61 6365 6d65 6e74       replacement
-00036d80: 5f63 6869 6c64 5f66 6f75 6e64 203d 2046  _child_found = F
-00036d90: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
-00036da0: 2020 2020 234a 4154 2032 3031 392d 3038      #JAT 2019-08
-00036db0: 2d31 3620 7265 6d6f 7665 6420 636f 7079  -16 removed copy
-00036dc0: 2063 6f6d 6d61 6e64 2066 6f72 2073 7065   command for spe
-00036dd0: 6564 0d0a 2020 2020 2020 2020 2020 2020  ed..            
-00036de0: 6f72 6967 696e 616c 5f63 6869 6c64 5f73  original_child_s
-00036df0: 7472 7563 7475 7265 7320 3d20 7365 6c66  tructures = self
-00036e00: 2e5f 6368 696c 645f 7374 7275 6374 7572  ._child_structur
-00036e10: 655f 656c 656d 656e 7473 2e63 6f70 7928  e_elements.copy(
-00036e20: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-00036e30: 656c 662e 5f63 6869 6c64 5f73 7472 7563  elf._child_struc
-00036e40: 7475 7265 5f65 6c65 6d65 6e74 7320 3d20  ture_elements = 
-00036e50: 5b5d 0d0a 2020 2020 2020 2020 2020 2020  []..            
-00036e60: 666f 7220 6368 696c 6420 696e 206f 7269  for child in ori
-00036e70: 6769 6e61 6c5f 6368 696c 645f 7374 7275  ginal_child_stru
-00036e80: 6374 7572 6573 3a0d 0a20 2020 2020 2020  ctures:..       
-00036e90: 2020 2020 2020 2020 2069 6620 6368 696c           if chil
-00036ea0: 6420 3d3d 2063 6869 6c64 5f73 7472 7563  d == child_struc
-00036eb0: 7475 7265 5f65 6c65 6d65 6e74 3a0d 0a20  ture_element:.. 
-00036ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036ed0: 2020 2072 6570 6c61 6365 6d65 6e74 5f63     replacement_c
-00036ee0: 6869 6c64 5f66 6f75 6e64 203d 2054 7275  hild_found = Tru
-00036ef0: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
-00036f00: 2020 2020 2020 2020 2066 6f72 2072 6570           for rep
-00036f10: 6c61 6365 6d65 6e74 5f63 6869 6c64 2069  lacement_child i
-00036f20: 6e20 7265 706c 6163 656d 656e 7473 3a0d  n replacements:.
-00036f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00036f40: 2020 2020 2020 2020 2073 656c 662e 5f61           self._a
-00036f50: 6464 5f63 6869 6c64 2872 6570 6c61 6365  dd_child(replace
-00036f60: 6d65 6e74 5f63 6869 6c64 290d 0a20 2020  ment_child)..   
-00036f70: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00036f80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00036f90: 2020 2020 2020 2020 7365 6c66 2e5f 6368          self._ch
-00036fa0: 696c 645f 7374 7275 6374 7572 655f 656c  ild_structure_el
-00036fb0: 656d 656e 7473 2e61 7070 656e 6428 6368  ements.append(ch
-00036fc0: 696c 6429 0d0a 0d0a 2020 2020 6465 6620  ild)....    def 
-00036fd0: 656d 6265 6c6c 6973 6828 7365 6c66 0d0a  embellish(self..
-00036fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00036ff0: 202c 206d 6170 7069 6e67 730d 0a20 2020   , mappings..   
-00037000: 2020 2020 2020 2020 2020 2020 2020 2c20                , 
-00037010: 656c 656d 656e 745f 7479 7065 5f66 6965  element_type_fie
-00037020: 6c64 2020 2020 2020 2020 2020 203d 204e  ld           = N
-00037030: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-00037040: 2020 2020 2020 2c20 7061 7265 6e74 5f74        , parent_t
-00037050: 7970 6520 2020 2020 2020 2020 2020 2020  ype             
-00037060: 2020 2020 203d 204e 6f6e 650d 0a20 2020       = None..   
-00037070: 2020 2020 2020 2020 2020 2020 2020 2c20                , 
-00037080: 7061 7265 6e74 5f65 6c65 6d65 6e74 5f69  parent_element_i
-00037090: 645f 6669 656c 6473 2020 2020 203d 205b  d_fields     = [
-000370a0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-000370b0: 2020 2020 2c20 7061 7265 6e74 5f65 6c65      , parent_ele
-000370c0: 6d65 6e74 5f69 645f 6d61 7070 696e 6773  ment_id_mappings
-000370d0: 2020 203d 205b 5d0d 0a20 2020 2020 2020     = []..       
-000370e0: 2020 2020 2020 2020 2020 2c20 6368 696c            , chil
-000370f0: 645f 7479 7065 2020 2020 2020 2020 2020  d_type          
-00037100: 2020 2020 2020 2020 203d 204e 6f6e 650d           = None.
-00037110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00037120: 2020 2c20 6368 696c 645f 656c 656d 656e    , child_elemen
-00037130: 745f 6964 5f66 6965 6c64 7320 2020 2020  t_id_fields     
-00037140: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
-00037150: 2020 2020 2020 2020 2c20 6368 696c 645f          , child_
-00037160: 656c 656d 656e 745f 6964 5f6d 6170 7069  element_id_mappi
-00037170: 6e67 7320 2020 203d 205b 5d0d 0a20 2020  ngs    = []..   
-00037180: 2020 2020 2020 2020 2020 2020 2020 2c20                , 
-00037190: 6368 696c 645f 6c6f 6e67 6e61 6d65 5f6d  child_longname_m
-000371a0: 6170 7069 6e67 2020 2020 2020 203d 204e  apping       = N
-000371b0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-000371c0: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
-000371d0: 2020 2727 2741 6464 206e 6577 2065 6c65    '''Add new ele
-000371e0: 6d65 6e74 7320 696e 2061 206c 6179 6572  ments in a layer
-000371f0: 2074 6f20 6120 5374 7275 6374 7572 6545   to a StructureE
-00037200: 6c65 6d65 6e74 2e20 5468 6973 2077 6179  lement. This way
-00037210: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
-00037220: 7420 7472 6565 7320 6361 6e20 6265 2062  t trees can be b
-00037230: 7569 6c74 2069 6e63 7265 6d65 6e74 616c  uilt incremental
-00037240: 6c79 2c20 7261 7468 6572 2074 6861 6e20  ly, rather than 
-00037250: 7365 7474 696e 6720 7468 6520 7265 6c61  setting the rela
-00037260: 7469 6f6e 7368 6970 7320 6174 206f 6e63  tionships at onc
-00037270: 650d 0a0d 0a20 2020 2020 2020 203a 7061  e....        :pa
-00037280: 7261 6d20 6d61 7070 696e 6773 3a20 4120  ram mappings: A 
-00037290: 7061 6e64 6173 2044 6174 6146 7261 6d65  pandas DataFrame
-000372a0: 206f 7220 6469 6374 696f 6e61 7279 2063   or dictionary c
-000372b0: 6f6e 7461 696e 696e 6720 7468 6520 7061  ontaining the pa
-000372c0: 7265 6e74 2d63 6869 6c64 206d 6170 7069  rent-child mappi
-000372d0: 6e67 730d 0a20 2020 2020 2020 203a 7061  ngs..        :pa
-000372e0: 7261 6d20 656c 656d 656e 745f 7479 7065  ram element_type
-000372f0: 5f66 6965 6c64 3a20 6966 2073 6574 2c20  _field: if set, 
-00037300: 7468 6520 4469 6d65 6e73 696f 6e20 6669  the Dimension fi
-00037310: 656c 6420 7468 6174 2068 6f6c 6473 2074  eld that holds t
-00037320: 6865 2074 7970 6520 6f66 2065 6c65 6d65  he type of eleme
-00037330: 6e74 2077 6520 7769 7368 2074 6f20 696e  nt we wish to in
-00037340: 636c 7564 6520 6173 2065 6974 6865 7220  clude as either 
-00037350: 7061 7265 6e74 206f 7220 6368 696c 6420  parent or child 
-00037360: 656c 656d 656e 7473 2e20 5479 7069 6361  elements. Typica
-00037370: 6c6c 7920 7468 6973 2064 696d 656e 7369  lly this dimensi
-00037380: 6f6e 2066 6965 6c64 2069 7320 6361 6c6c  on field is call
-00037390: 6564 2027 5479 7065 270d 0a20 2020 2020  ed 'Type'..     
-000373a0: 2020 203a 7061 7261 6d20 7061 7265 6e74     :param parent
-000373b0: 5f74 7970 653a 2054 6865 2076 616c 7565  _type: The value
-000373c0: 2069 6e20 7468 6520 7479 7065 2066 6965   in the type fie
-000373d0: 6c64 2066 6f72 2070 6172 656e 7420 656c  ld for parent el
-000373e0: 656d 656e 7473 2e20 4966 2073 6574 2c20  ements. If set, 
-000373f0: 6f6e 6c79 2065 6c65 6d65 6e74 7320 696e  only elements in
-00037400: 2074 6865 2074 7265 6520 7769 7468 2074   the tree with t
-00037410: 6865 2020 656c 656d 656e 745f 7479 7065  he  element_type
-00037420: 5f66 6965 6c64 2073 6574 2074 6f20 7061  _field set to pa
-00037430: 7265 6e74 5f66 6965 6c64 2077 696c 6c20  rent_field will 
-00037440: 6861 7665 2063 6869 6c64 7265 6e20 6174  have children at
-00037450: 7461 6368 6564 2074 6f20 7468 656d 2e0d  tached to them..
-00037460: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00037470: 7061 7265 6e74 5f65 6c65 6d65 6e74 5f69  parent_element_i
-00037480: 645f 6669 656c 6473 3a20 5468 6520 6469  d_fields: The di
-00037490: 6d65 6e73 696f 6e20 456c 656d 656e 7420  mension Element 
-000374a0: 6669 656c 6428 7329 2074 6861 7420 686f  field(s) that ho
-000374b0: 6c64 7320 7468 6520 6964 656e 7469 7479  lds the identity
-000374c0: 206f 6620 7468 6520 7061 7265 6e74 7320   of the parents 
-000374d0: 7765 2077 616e 7420 746f 2061 7474 6163  we want to attac
-000374e0: 6820 746f 0d0a 2020 2020 2020 2020 3a70  h to..        :p
-000374f0: 6172 616d 2070 6172 656e 745f 656c 656d  aram parent_elem
-00037500: 656e 745f 6964 5f6d 6170 7069 6e67 733a  ent_id_mappings:
-00037510: 2054 6865 2063 6f6c 756d 6e73 2069 6e20   The columns in 
-00037520: 6120 7061 6e64 6173 2e44 6174 6146 7261  a pandas.DataFra
-00037530: 6d65 206f 7220 6b65 7973 2069 6e20 6120  me or keys in a 
-00037540: 4469 6374 696f 6e61 7279 2074 6861 7420  Dictionary that 
-00037550: 6964 656e 7469 6679 2074 6865 2070 6172  identify the par
-00037560: 656e 7420 656c 656d 656e 7473 2c20 616e  ent elements, an
-00037570: 6420 636f 7272 6573 706f 6e64 2074 6f20  d correspond to 
-00037580: 7468 6520 7061 7265 6e74 5f65 6c65 6d65  the parent_eleme
-00037590: 6e74 5f69 645f 6669 656c 6473 0d0a 2020  nt_id_fields..  
-000375a0: 2020 2020 2020 3a70 6172 616d 2063 6869        :param chi
-000375b0: 6c64 5f74 7970 653a 2054 6865 2076 616c  ld_type: The val
-000375c0: 7565 2069 6e20 7468 6520 7479 7065 2066  ue in the type f
-000375d0: 6965 6c64 2066 6f72 2063 6869 6c64 2065  ield for child e
-000375e0: 6c65 6d65 6e74 732e 2045 6c65 6d65 6e74  lements. Element
-000375f0: 7320 7769 7468 2074 6869 7320 656c 656d  s with this elem
-00037600: 656e 745f 7479 7065 5f66 6965 6c64 2073  ent_type_field s
-00037610: 6574 2074 6f20 6368 696c 645f 6669 656c  et to child_fiel
-00037620: 6420 7769 6c6c 2062 6520 6361 6e64 6964  d will be candid
-00037630: 6174 6573 2066 6f72 2061 7474 6163 6869  ates for attachi
-00037640: 6e67 2074 6f20 7468 6520 7472 6565 2e20  ng to the tree. 
-00037650: 4966 206e 6f74 2066 6f75 6e64 2069 6e20  If not found in 
-00037660: 7468 6520 7265 6c65 7661 6e74 2064 696d  the relevant dim
-00037670: 656e 7369 6f6e 2c20 6e65 7720 656c 656d  ension, new elem
-00037680: 656e 7473 2077 696c 6c20 6265 2063 7265  ents will be cre
-00037690: 6174 6564 2077 6974 6820 656c 656d 656e  ated with elemen
-000376a0: 745f 7479 7065 5f66 6965 6c64 2073 6574  t_type_field set
-000376b0: 2074 6f20 7468 6973 2076 616c 7565 0d0a   to this value..
-000376c0: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
-000376d0: 6869 6c64 5f65 6c65 6d65 6e74 5f69 645f  hild_element_id_
-000376e0: 6669 656c 6473 3a20 5468 6520 6469 6d65  fields: The dime
-000376f0: 6e73 696f 6e20 456c 656d 656e 7420 6669  nsion Element fi
-00037700: 656c 6428 7329 2074 6861 7420 686f 6c64  eld(s) that hold
-00037710: 7320 7468 6520 6964 656e 7469 7479 206f  s the identity o
-00037720: 6620 7468 6520 6368 696c 6472 656e 2077  f the children w
-00037730: 6520 7761 6e74 2074 6f20 6174 7461 6368  e want to attach
-00037740: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00037750: 2063 6869 6c64 5f65 6c65 6d65 6e74 5f69   child_element_i
-00037760: 645f 6d61 7070 696e 6773 3a20 5468 6520  d_mappings: The 
-00037770: 636f 6c75 6d6e 7320 696e 2061 2070 616e  columns in a pan
-00037780: 6461 732e 4461 7461 4672 616d 6520 6f72  das.DataFrame or
-00037790: 206b 6579 7320 696e 2061 2044 6963 7469   keys in a Dicti
-000377a0: 6f6e 6172 7920 7468 6174 2069 6465 6e74  onary that ident
-000377b0: 6966 7920 7468 6520 6368 696c 6420 656c  ify the child el
-000377c0: 656d 656e 7473 2c20 616e 6420 636f 7272  ements, and corr
-000377d0: 6573 706f 6e64 2074 6f20 7468 6520 6368  espond to the ch
-000377e0: 696c 645f 656c 656d 656e 745f 6964 5f66  ild_element_id_f
-000377f0: 6965 6c64 730d 0a20 2020 2020 2020 203a  ields..        :
-00037800: 7061 7261 6d20 6368 696c 645f 6c6f 6e67  param child_long
-00037810: 6e61 6d65 5f6d 6170 7069 6e67 3a20 5468  name_mapping: Th
-00037820: 6520 6c6f 6e67 6e61 6d65 206f 6620 7468  e longname of th
-00037830: 6520 6368 696c 642c 2061 7320 666f 756e  e child, as foun
-00037840: 6420 696e 2074 6865 206d 6170 7069 6e67  d in the mapping
-00037850: 7320 4461 7461 4672 616d 6520 6f72 2044  s DataFrame or D
-00037860: 6963 7469 6f6e 6172 7920 2d20 7573 6564  ictionary - used
-00037870: 2074 6f20 6372 6561 7465 206e 6577 2045   to create new E
-00037880: 6c65 6d65 6e74 7320 7768 656e 2074 6865  lements when the
-00037890: 7920 646f 206e 6f74 2065 7869 7374 2069  y do not exist i
-000378a0: 6e20 7468 6520 7265 6c65 7661 6e74 2044  n the relevant D
-000378b0: 696d 656e 7369 6f6e 0d0a 0d0a 2020 2020  imension....    
-000378c0: 2020 2020 4966 2070 6172 656e 745f 7479      If parent_ty
-000378d0: 7065 2c20 2070 6172 656e 745f 656c 656d  pe,  parent_elem
-000378e0: 656e 745f 6964 5f66 6965 6c64 7320 616e  ent_id_fields an
-000378f0: 6420 7061 7265 6e74 5f65 6c65 6d65 6e74  d parent_element
-00037900: 5f69 645f 6d61 7070 696e 6773 2061 7265  _id_mappings are
-00037910: 206e 6f74 2073 6574 2c20 7468 656e 2063   not set, then c
-00037920: 6869 6c64 7265 6e20 7769 6c6c 2062 6520  hildren will be 
-00037930: 6174 7461 6368 6564 2074 6f20 616c 6c20  attached to all 
-00037940: 6e6f 6465 7320 696e 2074 6865 2074 7265  nodes in the tre
-00037950: 652e 0d0a 2020 2020 2020 2020 5468 6973  e...        This
-00037960: 2062 6568 6176 696f 7572 2069 7320 6d6f   behaviour is mo
-00037970: 7374 2075 7365 6675 6c20 7768 656e 2061  st useful when a
-00037980: 6464 696e 6720 7468 6520 6669 7273 7420  dding the first 
-00037990: 6c61 7965 7220 746f 2061 6e20 414c 4c20  layer to an ALL 
-000379a0: 6f72 2054 4f54 414c 206e 6f64 652e 0d0a  or TOTAL node...
-000379b0: 0d0a 2020 2020 2020 2020 3e3e 3e0d 0a0d  ..        >>>...
-000379c0: 0a0d 0a0d 0a20 2020 2020 2020 2027 2727  .....        '''
-000379d0: 0d0a 0d0a 2020 2020 2020 2020 2343 7265  ....        #Cre
-000379e0: 6174 6520 6120 6669 656c 642f 6368 696c  ate a field/chil
-000379f0: 6420 656c 656d 656e 7420 6c6f 6f6b 7570  d element lookup
-00037a00: 0d0a 2020 2020 2020 2020 6368 696c 645f  ..        child_
-00037a10: 6c6f 6f6b 7570 203d 207b 7d0d 0a20 2020  lookup = {}..   
-00037a20: 2020 2020 2066 6f72 2065 6c20 696e 2073       for el in s
-00037a30: 656c 662e 6469 6d65 6e73 696f 6e2e 656c  elf.dimension.el
-00037a40: 656d 656e 7473 2e76 616c 7565 7328 293a  ements.values():
-00037a50: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00037a60: 2065 6c65 6d65 6e74 5f74 7970 655f 6669   element_type_fi
-00037a70: 656c 6420 6973 204e 6f6e 6520 6f72 2065  eld is None or e
-00037a80: 6c2e 6669 656c 6473 5b65 6c65 6d65 6e74  l.fields[element
-00037a90: 5f74 7970 655f 6669 656c 645d 203d 3d20  _type_field] == 
-00037aa0: 2063 6869 6c64 5f74 7970 653a 0d0a 2020   child_type:..  
-00037ab0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
-00037ac0: 696c 645f 6c6f 6f6b 7570 5b74 7570 6c65  ild_lookup[tuple
-00037ad0: 2865 6c2e 6669 656c 6473 5b66 5d20 666f  (el.fields[f] fo
-00037ae0: 7220 6620 696e 2063 6869 6c64 5f65 6c65  r f in child_ele
-00037af0: 6d65 6e74 5f69 645f 6669 656c 6473 295d  ment_id_fields)]
-00037b00: 203d 2065 6c0d 0a0d 0a20 2020 2020 2020   = el....       
-00037b10: 2069 735f 6461 7461 6672 616d 6520 3d20   is_dataframe = 
-00037b20: 4661 6c73 650d 0a20 2020 2020 2020 2069  False..        i
-00037b30: 735f 6469 6374 2020 2020 2020 3d20 4661  s_dict      = Fa
-00037b40: 6c73 650d 0a20 2020 2020 2020 2069 735f  lse..        is_
-00037b50: 6c69 7374 2020 2020 2020 3d20 4661 6c73  list      = Fals
-00037b60: 650d 0a0d 0a0d 0a20 2020 2020 2020 2023  e......        #
-00037b70: 5265 7665 7273 6520 6475 636b 7479 7065  Reverse ducktype
-00037b80: 2074 6865 206d 6170 7069 6e67 7320 7061   the mappings pa
-00037b90: 7261 6d65 7465 720d 0a20 2020 2020 2020  rameter..       
-00037ba0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-00037bb0: 2020 206d 6170 7069 6e67 732e 6178 6573     mappings.axes
-00037bc0: 0d0a 2020 2020 2020 2020 2020 2020 6973  ..            is
-00037bd0: 5f64 6174 6166 7261 6d65 203d 2054 7275  _dataframe = Tru
-00037be0: 650d 0a0d 0a20 2020 2020 2020 2065 7863  e....        exc
-00037bf0: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
-00037c00: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-00037c10: 2023 7472 793a 0d0a 2020 2020 2020 2020   #try:..        
-00037c20: 2020 2020 2320 2020 206d 6170 7069 6e67      #    mapping
-00037c30: 732e 7661 6c75 6573 2829 0d0a 2020 2020  s.values()..    
-00037c40: 2020 2020 2020 2020 2320 2020 2069 735f          #    is_
-00037c50: 6469 6374 203d 2054 7275 650d 0a20 2020  dict = True..   
-00037c60: 2020 2020 2020 2020 2023 2020 2020 5f72           #    _r
-00037c70: 656c 6174 696f 6e73 6869 705f 6469 6374  elationship_dict
-00037c80: 203d 207b 7d0d 0a20 2020 2020 2020 2020   = {}..         
-00037c90: 2020 2023 2020 2020 666f 7220 6368 696c     #    for chil
-00037ca0: 645f 7368 6f72 746e 616d 652c 7061 7265  d_shortname,pare
-00037cb0: 6e74 5f73 686f 7274 6e61 6d65 2069 6e20  nt_shortname in 
-00037cc0: 6d61 7070 696e 6773 2e69 7465 6d73 2829  mappings.items()
-00037cd0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00037ce0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-00037cf0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-00037d00: 2020 2020 2020 205f 7265 6c61 7469 6f6e         _relation
-00037d10: 7368 6970 5f64 6963 745b 7061 7265 6e74  ship_dict[parent
-00037d20: 5f73 686f 7274 6e61 6d65 5d2e 6170 7065  _shortname].appe
-00037d30: 6e64 2863 6869 6c64 5f73 686f 7274 6e61  nd(child_shortna
-00037d40: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
-00037d50: 2023 2020 2020 2020 2020 6578 6365 7074   #        except
-00037d60: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
-00037d70: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00037d80: 2020 2020 205f 7265 6c61 7469 6f6e 7368       _relationsh
-00037d90: 6970 5f64 6963 745b 7061 7265 6e74 5f73  ip_dict[parent_s
-00037da0: 686f 7274 6e61 6d65 5d20 3d20 5b63 6869  hortname] = [chi
-00037db0: 6c64 5f73 686f 7274 6e61 6d65 5d0d 0a20  ld_shortname].. 
-00037dc0: 2020 2020 2020 2020 2020 2023 6578 6365             #exce
-00037dd0: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
-00037de0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-00037df0: 2320 2020 2069 735f 6c69 7374 203d 2054  #    is_list = T
-00037e00: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-00037e10: 2023 2020 2020 5f72 656c 6174 696f 6e73   #    _relations
-00037e20: 6869 705f 6469 6374 203d 207b 7d0d 0a20  hip_dict = {}.. 
-00037e30: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00037e40: 666f 7220 6368 696c 645f 7368 6f72 746e  for child_shortn
-00037e50: 616d 652c 7061 7265 6e74 5f73 686f 7274  ame,parent_short
-00037e60: 6e61 6d65 2069 6e20 6d61 7070 696e 6773  name in mappings
-00037e70: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00037e80: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-00037e90: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-00037ea0: 2020 2020 2020 205f 7265 6c61 7469 6f6e         _relation
-00037eb0: 7368 6970 5f64 6963 745b 7061 7265 6e74  ship_dict[parent
-00037ec0: 5f73 686f 7274 6e61 6d65 5d2e 6170 7065  _shortname].appe
-00037ed0: 6e64 2863 6869 6c64 5f73 686f 7274 6e61  nd(child_shortna
-00037ee0: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
-00037ef0: 2023 2020 2020 2020 2020 6578 6365 7074   #        except
-00037f00: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
-00037f10: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00037f20: 2020 2020 205f 7265 6c61 7469 6f6e 7368       _relationsh
-00037f30: 6970 5f64 6963 745b 7061 7265 6e74 5f73  ip_dict[parent_s
-00037f40: 686f 7274 6e61 6d65 5d20 3d20 5b63 6869  hortname] = [chi
-00037f50: 6c64 5f73 686f 7274 6e61 6d65 5d0d 0a20  ld_shortname].. 
-00037f60: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
-00037f70: 0a0d 0a20 2020 2020 2020 2023 5468 6520  ...        #The 
-00037f80: 6361 6e6f 6e69 6361 6c20 6669 656c 6420  canonical field 
-00037f90: 746f 2068 6f6c 6420 7468 6520 7479 7065  to hold the type
-00037fa0: 206f 6620 5374 7275 6374 7572 6545 6c65   of StructureEle
-00037fb0: 6d65 6e74 2069 7320 2754 7970 6527 202d  ment is 'Type' -
-00037fc0: 2075 7365 2074 6869 7320 6966 0d0a 2020   use this if..  
-00037fd0: 2020 2020 2020 6966 2028 7061 7265 6e74        if (parent
-00037fe0: 5f74 7970 6520 6973 206e 6f74 204e 6f6e  _type is not Non
-00037ff0: 6520 6f72 2063 6869 6c64 5f74 7970 6520  e or child_type 
-00038000: 6973 206e 6f74 204e 6f6e 6529 2061 6e64  is not None) and
-00038010: 2065 6c65 6d65 6e74 5f74 7970 655f 6669   element_type_fi
-00038020: 656c 6420 6973 204e 6f6e 653a 0d0a 2020  eld is None:..  
-00038030: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-00038040: 745f 7479 7065 5f66 6965 6c64 203d 2027  t_type_field = '
-00038050: 5479 7065 270d 0a0d 0a20 2020 2020 2020  Type'....       
-00038060: 2063 6869 6c64 5f65 6c65 6d65 6e74 735f   child_elements_
-00038070: 746f 5f63 7265 6174 6520 3d20 5b5d 0d0a  to_create = []..
-00038080: 0d0a 2020 2020 2020 2020 6966 2069 735f  ..        if is_
-00038090: 6461 7461 6672 616d 653a 0d0a 2020 2020  dataframe:..    
-000380a0: 2020 2020 2020 2020 2345 6e73 7572 6520          #Ensure 
-000380b0: 7468 6520 636f 7272 6563 7420 636f 6c75  the correct colu
-000380c0: 6d6e 7320 6172 6520 696e 2074 6865 2044  mns are in the D
-000380d0: 6174 6146 7261 6d65 2c20 6f74 6865 7277  ataFrame, otherw
-000380e0: 6973 6520 4b65 7945 7272 6f72 7320 6172  ise KeyErrors ar
-000380f0: 6520 676f 696e 6720 746f 2062 6520 7468  e going to be th
-00038100: 726f 776e 2069 6e20 7468 6520 6f64 6465  rown in the odde
-00038110: 7374 206f 6620 706c 6163 6573 2061 6e64  st of places and
-00038120: 206d 616b 6520 6465 6275 6767 696e 6720   make debugging 
-00038130: 6120 6e69 6768 746d 6172 650d 0a0d 0a20  a nightmare.... 
-00038140: 2020 2020 2020 2020 2020 2023 4372 6561             #Crea
-00038150: 7465 2061 2064 6963 7469 6f6e 6172 7920  te a dictionary 
-00038160: 6f66 2072 656c 6174 696f 6e73 6869 7073  of relationships
-00038170: 2062 6574 7765 656e 2070 6172 656e 7420   between parent 
-00038180: 746f 2061 6c6c 206f 6620 7468 6569 7220  to all of their 
-00038190: 6368 696c 6472 656e 0d0a 2020 2020 2020  children..      
-000381a0: 2020 2020 2020 5f72 656c 6174 696f 6e73        _relations
-000381b0: 6869 705f 6469 6374 203d 207b 7d0d 0a0d  hip_dict = {}...
-000381c0: 0a20 2020 2020 2020 2020 2020 2023 4765  .            #Ge
-000381d0: 7420 756e 6971 7565 2063 6f6c 756d 6e73  t unique columns
-000381e0: 2c20 736f 2074 6861 7420 7765 2063 616e  , so that we can
-000381f0: 2064 726f 7020 6475 706c 6963 6174 6573   drop duplicates
-00038200: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
-00038210: 6c75 6d6e 7320 3d20 6368 696c 645f 656c  lumns = child_el
-00038220: 656d 656e 745f 6964 5f6d 6170 7069 6e67  ement_id_mapping
-00038230: 732b 7061 7265 6e74 5f65 6c65 6d65 6e74  s+parent_element
-00038240: 5f69 645f 6d61 7070 696e 6773 0d0a 2020  _id_mappings..  
-00038250: 2020 2020 2020 2020 2020 6966 2063 6869            if chi
-00038260: 6c64 5f6c 6f6e 676e 616d 655f 6d61 7070  ld_longname_mapp
-00038270: 696e 6720 6973 206e 6f74 204e 6f6e 653a  ing is not None:
-00038280: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00038290: 2020 636f 6c75 6d6e 732e 6170 7065 6e64    columns.append
-000382a0: 2863 6869 6c64 5f6c 6f6e 676e 616d 655f  (child_longname_
-000382b0: 6d61 7070 696e 6729 0d0a 0d0a 2020 2020  mapping)....    
-000382c0: 2020 2020 2020 2020 636f 6c75 6d6e 7320          columns 
-000382d0: 3d6c 6973 7428 7365 7428 636f 6c75 6d6e  =list(set(column
-000382e0: 7329 290d 0a0d 0a20 2020 2020 2020 2020  s))....         
-000382f0: 2020 2066 6f72 2069 6e64 6578 2c20 726f     for index, ro
-00038300: 7720 696e 206d 6170 7069 6e67 735b 636f  w in mappings[co
-00038310: 6c75 6d6e 735d 2e64 726f 706e 6128 292e  lumns].dropna().
-00038320: 6472 6f70 5f64 7570 6c69 6361 7465 7328  drop_duplicates(
-00038330: 6b65 6570 3d27 6669 7273 7427 292e 6974  keep='first').it
-00038340: 6572 726f 7773 2829 3a0d 0a0d 0a20 2020  errows():....   
-00038350: 2020 2020 2020 2020 2020 2020 2023 2020               #  
-00038360: 2020 2346 696c 7465 7220 7061 7265 6e74    #Filter parent
-00038370: 7320 6966 2074 6861 7427 7320 7768 6174  s if that's what
-00038380: 2077 6520 6172 6520 646f 696e 670d 0a20   we are doing.. 
-00038390: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000383a0: 6966 2070 6172 656e 745f 7479 7065 2069  if parent_type i
-000383b0: 7320 6e6f 7420 4e6f 6e65 2061 6e64 2072  s not None and r
-000383c0: 6f77 5b65 6c65 6d65 6e74 5f74 7970 655f  ow[element_type_
-000383d0: 6669 656c 645d 2021 3d20 7061 7265 6e74  field] != parent
-000383e0: 5f74 7970 653a 0d0a 2020 2020 2020 2020  _type:..        
-000383f0: 2020 2020 2020 2020 2320 2020 2063 6f6e          #    con
-00038400: 7469 6e75 650d 0a0d 0a20 2020 2020 2020  tinue....       
-00038410: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-00038420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038430: 2020 2063 6869 6c64 5f65 6c65 6d65 6e74     child_element
-00038440: 203d 2063 6869 6c64 5f6c 6f6f 6b75 705b   = child_lookup[
-00038450: 7475 706c 6528 726f 775b 6d61 7070 696e  tuple(row[mappin
-00038460: 675f 636f 6c75 6d6e 5d20 666f 7220 6d61  g_column] for ma
-00038470: 7070 696e 675f 636f 6c75 6d6e 2069 6e20  pping_column in 
-00038480: 6368 696c 645f 656c 656d 656e 745f 6964  child_element_id
-00038490: 5f6d 6170 7069 6e67 7329 5d0d 0a20 2020  _mappings)]..   
-000384a0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-000384b0: 6570 7420 4b65 7945 7272 6f72 3a0d 0a20  ept KeyError:.. 
-000384c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000384d0: 2020 2023 6d61 6b65 2074 6865 2063 6869     #make the chi
-000384e0: 6c64 0d0a 2020 2020 2020 2020 2020 2020  ld..            
-000384f0: 2020 2020 2020 2020 6966 2063 6869 6c64          if child
-00038500: 5f6c 6f6e 676e 616d 655f 6d61 7070 696e  _longname_mappin
-00038510: 6720 6973 204e 6f6e 653a 0d0a 2020 2020  g is None:..    
-00038520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038530: 2020 2020 2352 6169 7365 2061 6e20 6572      #Raise an er
-00038540: 726f 722c 2073 696e 6365 2077 6520 6361  ror, since we ca
-00038550: 6e27 7420 6372 6561 7465 2074 6865 2063  n't create the c
-00038560: 6869 6c64 0d0a 2020 2020 2020 2020 2020  hild..          
-00038570: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00038580: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
-00038590: 4368 696c 6420 656c 656d 656e 7473 2063  Child elements c
-000385a0: 616e 6e6f 7420 6265 2063 7265 6174 6564  annot be created
-000385b0: 2077 6974 686f 7574 2061 2063 6869 6c64   without a child
-000385c0: 5f6c 6f6e 676e 616d 655f 6d61 7070 696e  _longname_mappin
-000385d0: 672e 2043 6869 6c64 207b 7d20 7761 7320  g. Child {} was 
-000385e0: 6e6f 7420 666f 756e 6420 7768 656e 2063  not found when c
-000385f0: 7265 6174 696e 6720 7468 6520 5374 7275  reating the Stru
-00038600: 6374 7572 6545 6c65 6d65 6e74 2074 7265  ctureElement tre
-00038610: 6527 2e66 6f72 6d61 7428 2872 6f77 5b6d  e'.format((row[m
-00038620: 6170 7069 6e67 5f63 6f6c 756d 6e5d 2066  apping_column] f
-00038630: 6f72 206d 6170 7069 6e67 5f63 6f6c 756d  or mapping_colum
-00038640: 6e20 696e 2063 6869 6c64 5f65 6c65 6d65  n in child_eleme
-00038650: 6e74 5f69 645f 6d61 7070 696e 6773 2929  nt_id_mappings))
-00038660: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00038670: 2020 2020 2020 2020 2066 6965 6c64 733d           fields=
-00038680: 7b6b 3a76 2066 6f72 206b 2c76 2069 6e20  {k:v for k,v in 
-00038690: 7a69 7028 6368 696c 645f 656c 656d 656e  zip(child_elemen
-000386a0: 745f 6964 5f66 6965 6c64 732c 7475 706c  t_id_fields,tupl
-000386b0: 6528 726f 775b 6d5d 2066 6f72 206d 2069  e(row[m] for m i
-000386c0: 6e20 6368 696c 645f 656c 656d 656e 745f  n child_element_
-000386d0: 6964 5f6d 6170 7069 6e67 7329 297d 0d0a  id_mappings))}..
-000386e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000386f0: 2020 2020 2020 6c6f 6e67 6e61 6d65 203d        longname =
-00038700: 2072 6f77 5b63 6869 6c64 5f6c 6f6e 676e   row[child_longn
-00038710: 616d 655f 6d61 7070 696e 675d 0d0a 2020  ame_mapping]..  
-00038720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038730: 2020 6368 696c 645f 656c 656d 656e 7420    child_element 
-00038740: 3d20 456c 656d 656e 7428 6469 6d65 6e73  = Element(dimens
-00038750: 696f 6e20 3d20 7365 6c66 2e64 696d 656e  ion = self.dimen
-00038760: 7369 6f6e 2c20 7368 6f72 746e 616d 6520  sion, shortname 
-00038770: 3d20 4e6f 6e65 2c20 6c6f 6e67 6e61 6d65  = None, longname
-00038780: 203d 206c 6f6e 676e 616d 652c 2066 6965   = longname, fie
-00038790: 6c64 733d 7b6b 3a76 2066 6f72 206b 2c76  lds={k:v for k,v
-000387a0: 2069 6e20 7a69 7028 6368 696c 645f 656c   in zip(child_el
-000387b0: 656d 656e 745f 6964 5f66 6965 6c64 732c  ement_id_fields,
-000387c0: 5b72 6f77 5b6d 5d20 666f 7220 6d20 696e  [row[m] for m in
-000387d0: 2063 6869 6c64 5f65 6c65 6d65 6e74 5f69   child_element_i
-000387e0: 645f 6d61 7070 696e 6773 5d29 7d29 0d0a  d_mappings])})..
-000387f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038800: 2020 2020 6966 2065 6c65 6d65 6e74 5f74      if element_t
-00038810: 7970 655f 6669 656c 6420 6973 206e 6f74  ype_field is not
-00038820: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00038830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00038840: 6368 696c 645f 656c 656d 656e 742e 6669  child_element.fi
-00038850: 656c 6473 5b65 6c65 6d65 6e74 5f74 7970  elds[element_typ
-00038860: 655f 6669 656c 645d 203d 2063 6869 6c64  e_field] = child
-00038870: 5f74 7970 650d 0a20 2020 2020 2020 2020  _type..         
-00038880: 2020 2020 2020 2020 2020 2023 6d65 7267             #merg
-00038890: 6520 696e 746f 2064 696d 656e 7369 6f6e  e into dimension
-000388a0: 2e65 6c65 6d65 6e74 730d 0a20 2020 2020  .elements..     
-000388b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000388c0: 6869 6c64 5f65 6c65 6d65 6e74 735f 746f  hild_elements_to
-000388d0: 5f63 7265 6174 652e 6170 7065 6e64 2863  _create.append(c
-000388e0: 6869 6c64 5f65 6c65 6d65 6e74 290d 0a0d  hild_element)...
-000388f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038900: 2020 2020 2023 4164 6420 746f 2074 6865       #Add to the
-00038910: 206c 6f6f 6b75 702c 2073 6f20 7765 2064   lookup, so we d
-00038920: 6f6e 2774 2063 7265 6174 6520 6974 2061  on't create it a
-00038930: 6761 696e 0d0a 2020 2020 2020 2020 2020  gain..          
-00038940: 2020 2020 2020 2020 2020 6368 696c 645f            child_
-00038950: 6c6f 6f6b 7570 5b74 7570 6c65 2872 6f77  lookup[tuple(row
-00038960: 5b6d 6170 7069 6e67 5f63 6f6c 756d 6e5d  [mapping_column]
-00038970: 2066 6f72 206d 6170 7069 6e67 5f63 6f6c   for mapping_col
-00038980: 756d 6e20 696e 2063 6869 6c64 5f65 6c65  umn in child_ele
-00038990: 6d65 6e74 5f69 645f 6d61 7070 696e 6773  ment_id_mappings
-000389a0: 295d 203d 2063 6869 6c64 5f65 6c65 6d65  )] = child_eleme
-000389b0: 6e74 0d0a 0d0a 2020 2020 2020 2020 2020  nt....          
-000389c0: 2020 2020 2020 2341 7070 656e 6420 746f        #Append to
-000389d0: 2074 6865 206c 6973 7420 6f66 2061 6c6c   the list of all
-000389e0: 2063 6869 6c64 2065 6c65 6d65 6e74 7320   child elements 
-000389f0: 7765 2077 696c 6c20 6265 2070 7574 7469  we will be putti
-00038a00: 6e67 2075 6e64 6572 2074 6869 7320 7061  ng under this pa
-00038a10: 7265 6e74 2065 6c65 6d65 6e74 0d0a 2020  rent element..  
-00038a20: 2020 2020 2020 2020 2020 2020 2020 234e                #N
-00038a30: 6f74 6520 6368 696c 6472 656e 2077 696c  ote children wil
-00038a40: 6c20 6265 2070 6c61 6365 6420 696e 2074  l be placed in t
-00038a50: 6865 206f 7264 6572 2074 6865 7920 6170  he order they ap
-00038a60: 7065 6172 2069 6e20 7468 6520 736f 7572  pear in the sour
-00038a70: 6365 0d0a 2020 2020 2020 2020 2020 2020  ce..            
-00038a80: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-00038a90: 2020 2020 2020 2020 2020 2020 2020 5f63                _c
-00038aa0: 6869 6c64 5f65 6c65 6d65 6e74 5f6c 6973  hild_element_lis
-00038ab0: 7420 3d20 5f72 656c 6174 696f 6e73 6869  t = _relationshi
-00038ac0: 705f 6469 6374 5b74 7570 6c65 2872 6f77  p_dict[tuple(row
-00038ad0: 5b6d 6170 7069 6e67 5f63 6f6c 756d 6e5d  [mapping_column]
-00038ae0: 2066 6f72 206d 6170 7069 6e67 5f63 6f6c   for mapping_col
-00038af0: 756d 6e20 696e 2070 6172 656e 745f 656c  umn in parent_el
-00038b00: 656d 656e 745f 6964 5f6d 6170 7069 6e67  ement_id_mapping
-00038b10: 7329 5d0d 0a20 2020 2020 2020 2020 2020  s)]..           
-00038b20: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-00038b30: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00038b40: 2020 2020 2020 2020 2020 205f 6368 696c             _chil
-00038b50: 645f 656c 656d 656e 745f 6c69 7374 203d  d_element_list =
-00038b60: 205b 5d0d 0a20 2020 2020 2020 2020 2020   []..           
-00038b70: 2020 2020 2020 2020 205f 7265 6c61 7469           _relati
-00038b80: 6f6e 7368 6970 5f64 6963 745b 7475 706c  onship_dict[tupl
-00038b90: 6528 726f 775b 6d61 7070 696e 675f 636f  e(row[mapping_co
-00038ba0: 6c75 6d6e 5d20 666f 7220 6d61 7070 696e  lumn] for mappin
-00038bb0: 675f 636f 6c75 6d6e 2069 6e20 7061 7265  g_column in pare
-00038bc0: 6e74 5f65 6c65 6d65 6e74 5f69 645f 6d61  nt_element_id_ma
-00038bd0: 7070 696e 6773 295d 203d 205f 6368 696c  ppings)] = _chil
-00038be0: 645f 656c 656d 656e 745f 6c69 7374 0d0a  d_element_list..
-00038bf0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00038c00: 2020 5f63 6869 6c64 5f65 6c65 6d65 6e74    _child_element
-00038c10: 5f6c 6973 742e 6170 7065 6e64 2863 6869  _list.append(chi
-00038c20: 6c64 5f65 6c65 6d65 6e74 290d 0a0d 0a20  ld_element).... 
-00038c30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00038c40: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-00038c50: 2020 2020 2020 2320 2020 205f 7265 6c61        #    _rela
-00038c60: 7469 6f6e 7368 6970 5f64 6963 745b 7061  tionship_dict[pa
-00038c70: 7265 6e74 5f73 686f 7274 6e61 6d65 5d2e  rent_shortname].
-00038c80: 6170 7065 6e64 2863 6869 6c64 5f73 686f  append(child_sho
-00038c90: 7274 6e61 6d65 290d 0a20 2020 2020 2020  rtname)..       
-00038ca0: 2020 2020 2020 2020 2023 6578 6365 7074           #except
-00038cb0: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
-00038cc0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-00038cd0: 205f 7265 6c61 7469 6f6e 7368 6970 5f64   _relationship_d
-00038ce0: 6963 745b 7061 7265 6e74 5f73 686f 7274  ict[parent_short
-00038cf0: 6e61 6d65 5d20 3d20 5b63 6869 6c64 5f73  name] = [child_s
-00038d00: 686f 7274 6e61 6d65 5d0d 0a0d 0a20 2020  hortname]....   
-00038d10: 2020 2020 2020 2020 2063 7265 6174 6564           created
-00038d20: 5f65 6c65 6d65 6e74 5f6c 6f6f 6b75 7020  _element_lookup 
-00038d30: 3d20 7b7d 0d0a 2020 2020 2020 2020 2020  = {}..          
-00038d40: 2020 234d 6572 6765 2061 6e64 2073 796e    #Merge and syn
-00038d50: 6368 726f 6e69 7365 2061 6e79 206e 6577  chronise any new
-00038d60: 2063 6869 6c64 2065 6c65 6d65 6e74 732c   child elements,
-00038d70: 2062 6563 6175 7365 2053 7472 7563 7475   because Structu
-00038d80: 7265 456c 656d 656e 7473 2063 616e 6e6f  reElements canno
-00038d90: 7420 6265 206d 6164 6520 7769 7468 2075  t be made with u
-00038da0: 6e73 796e 6368 726f 6e69 7365 6420 6368  nsynchronised ch
-00038db0: 696c 6472 656e 0d0a 2020 2020 2020 2020  ildren..        
-00038dc0: 2020 2020 6966 206c 656e 2863 6869 6c64      if len(child
-00038dd0: 5f65 6c65 6d65 6e74 735f 746f 5f63 7265  _elements_to_cre
-00038de0: 6174 6529 2020 3e20 303a 0d0a 2020 2020  ate)  > 0:..    
-00038df0: 2020 2020 2020 2020 2020 2020 6b65 795f              key_
-00038e00: 6669 656c 6473 203d 2063 6869 6c64 5f65  fields = child_e
-00038e10: 6c65 6d65 6e74 5f69 645f 6669 656c 6473  lement_id_fields
-00038e20: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00038e30: 2020 2020 6966 2065 6c65 6d65 6e74 5f74      if element_t
-00038e40: 7970 655f 6669 656c 6420 6973 206e 6f74  ype_field is not
-00038e50: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00038e60: 2020 2020 2020 2020 2020 2020 6b65 795f              key_
-00038e70: 6669 656c 6473 2e61 7070 656e 6428 656c  fields.append(el
-00038e80: 656d 656e 745f 7479 7065 5f66 6965 6c64  ement_type_field
-00038e90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00038ea0: 2020 2063 7265 6174 6564 5f65 6c65 6d65     created_eleme
-00038eb0: 6e74 7320 3d20 7365 6c66 2e64 696d 656e  nts = self.dimen
-00038ec0: 7369 6f6e 2e65 6c65 6d65 6e74 732e 6d65  sion.elements.me
-00038ed0: 7267 6528 6368 696c 645f 656c 656d 656e  rge(child_elemen
-00038ee0: 7473 5f74 6f5f 6372 6561 7465 2c6b 6579  ts_to_create,key
-00038ef0: 733d 6b65 795f 6669 656c 6473 290d 0a0d  s=key_fields)...
-00038f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00038f10: 2063 7265 6174 6564 5f65 6c65 6d65 6e74   created_element
-00038f20: 5f6c 6f6f 6b75 7020 3d20 7b6b 3a76 2066  _lookup = {k:v f
-00038f30: 6f72 206b 2c76 2069 6e20 7a69 7028 6368  or k,v in zip(ch
-00038f40: 696c 645f 656c 656d 656e 7473 5f74 6f5f  ild_elements_to_
-00038f50: 6372 6561 7465 2c63 7265 6174 6564 5f65  create,created_e
-00038f60: 6c65 6d65 6e74 7329 7d0d 0a20 2020 2020  lements)}..     
-00038f70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00038f80: 6469 6d65 6e73 696f 6e2e 656c 656d 656e  dimension.elemen
-00038f90: 7473 2e73 796e 6368 726f 6e69 7365 2829  ts.synchronise()
-00038fa0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00038fb0: 2020 2020 666f 7220 5f63 6869 6c64 5f65      for _child_e
-00038fc0: 6c65 6d65 6e74 5f6c 6973 7420 696e 205f  lement_list in _
-00038fd0: 7265 6c61 7469 6f6e 7368 6970 5f64 6963  relationship_dic
-00038fe0: 742e 7661 6c75 6573 2829 3a0d 0a20 2020  t.values():..   
-00038ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039000: 2066 6f72 206e 2c20 656c 2069 6e20 656e   for n, el in en
-00039010: 756d 6572 6174 6528 5f63 6869 6c64 5f65  umerate(_child_e
-00039020: 6c65 6d65 6e74 5f6c 6973 7429 3a0d 0a20  lement_list):.. 
-00039030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039040: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00039050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039060: 2020 2020 2020 2020 2023 7472 7920 746f           #try to
-00039070: 2072 6570 6c61 6365 2075 6e2d 6372 6561   replace un-crea
-00039080: 7465 6420 656c 656d 656e 7473 2077 6974  ted elements wit
-00039090: 6820 7468 6569 7220 6372 6561 7465 6420  h their created 
-000390a0: 2863 616e 6f6e 6963 616c 2920 7265 706c  (canonical) repl
-000390b0: 6163 656d 656e 7473 0d0a 2020 2020 2020  acements..      
-000390c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000390d0: 2020 2020 2020 5f63 6869 6c64 5f65 6c65        _child_ele
-000390e0: 6d65 6e74 5f6c 6973 745b 6e5d 203d 2063  ment_list[n] = c
-000390f0: 7265 6174 6564 5f65 6c65 6d65 6e74 5f6c  reated_element_l
-00039100: 6f6f 6b75 705b 656c 5d0d 0a20 2020 2020  ookup[el]..     
-00039110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039120: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
-00039130: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-00039140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039150: 2070 6173 730d 0a0d 0a20 2020 2020 2020   pass....       
-00039160: 2023 6c69 7374 2074 6865 2073 7472 7563   #list the struc
-00039170: 7475 7265 2c20 7369 6e63 6520 7765 2061  ture, since we a
-00039180: 7265 2069 7465 7261 7469 6e67 206f 7665  re iterating ove
-00039190: 7220 6974 2061 6e64 2063 6861 6e67 696e  r it and changin
-000391a0: 6720 6974 2061 7420 7465 6820 7361 6d65  g it at teh same
-000391b0: 2074 696d 650d 0a20 2020 2020 2020 2066   time..        f
-000391c0: 6f72 2073 6520 696e 206c 6973 7428 7365  or se in list(se
-000391d0: 6c66 2e77 616c 6b28 2929 3a0d 0a20 2020  lf.walk()):..   
-000391e0: 2020 2020 2020 2020 2023 4669 6c74 6572           #Filter
-000391f0: 2070 6172 656e 7473 2069 6620 7468 6174   parents if that
-00039200: 2773 2077 6861 7420 7765 2061 7265 2064  's what we are d
-00039210: 6f69 6e67 0d0a 2020 2020 2020 2020 2020  oing..          
-00039220: 2020 6966 2070 6172 656e 745f 7479 7065    if parent_type
-00039230: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-00039240: 2073 652e 656c 656d 656e 742e 6669 656c   se.element.fiel
-00039250: 6473 5b65 6c65 6d65 6e74 5f74 7970 655f  ds[element_type_
-00039260: 6669 656c 645d 2021 3d20 7061 7265 6e74  field] != parent
-00039270: 5f74 7970 653a 0d0a 2020 2020 2020 2020  _type:..        
-00039280: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00039290: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000392a0: 234c 6f6f 6b75 7020 7468 6520 6368 696c  #Lookup the chil
-000392b0: 6472 656e 2074 6f20 6170 7065 6e64 202d  dren to append -
-000392c0: 2077 6527 7665 2064 6f6e 6520 7468 6520   we've done the 
-000392d0: 776f 726b 2074 6f20 6761 7468 6572 2074  work to gather t
-000392e0: 6865 6d20 616c 7265 6164 790d 0a20 2020  hem already..   
-000392f0: 2020 2020 2020 2020 2023 2052 6570 6c61           # Repla
-00039300: 6365 2074 6865 206c 6f6f 6b65 6420 7570  ce the looked up
-00039310: 2063 6869 6c64 7265 6e20 7769 7468 2074   children with t
-00039320: 6865 6972 206d 6173 7465 7265 6420 6571  heir mastered eq
-00039330: 7569 7661 6c65 6e74 730d 0a20 2020 2020  uivalents..     
-00039340: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00039350: 2020 2020 2020 2020 2020 2020 2063 6869               chi
-00039360: 6c64 7265 6e5f 746f 5f61 7070 656e 6420  ldren_to_append 
-00039370: 3d20 5f72 656c 6174 696f 6e73 6869 705f  = _relationship_
-00039380: 6469 6374 5b74 7570 6c65 285b 7365 2e66  dict[tuple([se.f
-00039390: 6965 6c64 735b 665d 2066 6f72 2066 2069  ields[f] for f i
-000393a0: 6e20 7061 7265 6e74 5f65 6c65 6d65 6e74  n parent_element
-000393b0: 5f69 645f 6669 656c 6473 5d29 5d0d 0a20  _id_fields])].. 
-000393c0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000393d0: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
-000393e0: 2020 2020 2020 2020 2020 2020 2023 4e6f               #No
-000393f0: 2063 6869 6c64 7265 6e20 666f 7220 7468   children for th
-00039400: 6973 2072 6167 6765 6420 6869 6572 6172  is ragged hierar
-00039410: 6368 7920 2d20 636f 6e74 696e 7565 206f  chy - continue o
-00039420: 6e20 746f 206e 6578 7420 656c 656d 656e  n to next elemen
-00039430: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-00039440: 2020 2063 6f6e 7469 6e75 650d 0a0d 0a20     continue.... 
-00039450: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00039460: 6e28 6372 6561 7465 645f 656c 656d 656e  n(created_elemen
-00039470: 745f 6c6f 6f6b 7570 2920 3e20 303a 0d0a  t_lookup) > 0:..
-00039480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039490: 6d61 7374 6572 6564 5f63 6869 6c64 7265  mastered_childre
-000394a0: 6e5f 746f 5f61 7070 656e 6420 3d20 5b5d  n_to_append = []
-000394b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000394c0: 2020 666f 7220 6368 2069 6e20 6368 696c    for ch in chil
-000394d0: 6472 656e 5f74 6f5f 6170 7065 6e64 3a0d  dren_to_append:.
-000394e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000394f0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00039500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039510: 2020 206d 6173 7465 7265 645f 6368 696c     mastered_chil
-00039520: 6472 656e 5f74 6f5f 6170 7065 6e64 2e61  dren_to_append.a
-00039530: 7070 656e 6428 6372 6561 7465 645f 656c  ppend(created_el
-00039540: 656d 656e 745f 6c6f 6f6b 7570 5b63 685d  ement_lookup[ch]
-00039550: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00039560: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-00039570: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
+00036d70: 2020 2020 2061 6674 6572 5f63 6869 6c64       after_child
+00036d80: 7265 6e5f 7368 6f72 7463 6f64 6573 203d  ren_shortcodes =
+00036d90: 205b 5d0d 0a20 2020 2020 2020 2020 2020   []..           
+00036da0: 2072 6570 6c61 6365 6d65 6e74 5f63 6869   replacement_chi
+00036db0: 6c64 5f66 6f75 6e64 203d 2046 616c 7365  ld_found = False
+00036dc0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00036dd0: 234a 4154 2032 3031 392d 3038 2d31 3620  #JAT 2019-08-16 
+00036de0: 7265 6d6f 7665 6420 636f 7079 2063 6f6d  removed copy com
+00036df0: 6d61 6e64 2066 6f72 2073 7065 6564 0d0a  mand for speed..
+00036e00: 2020 2020 2020 2020 2020 2020 6f72 6967              orig
+00036e10: 696e 616c 5f63 6869 6c64 5f73 7472 7563  inal_child_struc
+00036e20: 7475 7265 7320 3d20 7365 6c66 2e5f 6368  tures = self._ch
+00036e30: 696c 645f 7374 7275 6374 7572 655f 656c  ild_structure_el
+00036e40: 656d 656e 7473 2e63 6f70 7928 290d 0a20  ements.copy().. 
+00036e50: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00036e60: 5f63 6869 6c64 5f73 7472 7563 7475 7265  _child_structure
+00036e70: 5f65 6c65 6d65 6e74 7320 3d20 5b5d 0d0a  _elements = []..
+00036e80: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00036e90: 6368 696c 6420 696e 206f 7269 6769 6e61  child in origina
+00036ea0: 6c5f 6368 696c 645f 7374 7275 6374 7572  l_child_structur
+00036eb0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+00036ec0: 2020 2020 2069 6620 6368 696c 6420 3d3d       if child ==
+00036ed0: 2063 6869 6c64 5f73 7472 7563 7475 7265   child_structure
+00036ee0: 5f65 6c65 6d65 6e74 3a0d 0a20 2020 2020  _element:..     
+00036ef0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00036f00: 6570 6c61 6365 6d65 6e74 5f63 6869 6c64  eplacement_child
+00036f10: 5f66 6f75 6e64 203d 2054 7275 650d 0a0d  _found = True...
+00036f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00036f30: 2020 2020 2066 6f72 2072 6570 6c61 6365       for replace
+00036f40: 6d65 6e74 5f63 6869 6c64 2069 6e20 7265  ment_child in re
+00036f50: 706c 6163 656d 656e 7473 3a0d 0a20 2020  placements:..   
+00036f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036f70: 2020 2020 2073 656c 662e 5f61 6464 5f63       self._add_c
+00036f80: 6869 6c64 2872 6570 6c61 6365 6d65 6e74  hild(replacement
+00036f90: 5f63 6869 6c64 290d 0a20 2020 2020 2020  _child)..       
+00036fa0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+00036fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00036fc0: 2020 2020 7365 6c66 2e5f 6368 696c 645f      self._child_
+00036fd0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+00036fe0: 7473 2e61 7070 656e 6428 6368 696c 6429  ts.append(child)
+00036ff0: 0d0a 0d0a 2020 2020 6465 6620 656d 6265  ....    def embe
+00037000: 6c6c 6973 6828 7365 6c66 0d0a 2020 2020  llish(self..    
+00037010: 2020 2020 2020 2020 2020 2020 202c 206d               , m
+00037020: 6170 7069 6e67 730d 0a20 2020 2020 2020  appings..       
+00037030: 2020 2020 2020 2020 2020 2c20 656c 656d            , elem
+00037040: 656e 745f 7479 7065 5f66 6965 6c64 2020  ent_type_field  
+00037050: 2020 2020 2020 2020 203d 204e 6f6e 650d           = None.
+00037060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00037070: 2020 2c20 7061 7265 6e74 5f74 7970 6520    , parent_type 
+00037080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00037090: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+000370a0: 2020 2020 2020 2020 2020 2c20 7061 7265            , pare
+000370b0: 6e74 5f65 6c65 6d65 6e74 5f69 645f 6669  nt_element_id_fi
+000370c0: 656c 6473 2020 2020 203d 205b 5d0d 0a20  elds     = [].. 
+000370d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000370e0: 2c20 7061 7265 6e74 5f65 6c65 6d65 6e74  , parent_element
+000370f0: 5f69 645f 6d61 7070 696e 6773 2020 203d  _id_mappings   =
+00037100: 205b 5d0d 0a20 2020 2020 2020 2020 2020   []..           
+00037110: 2020 2020 2020 2c20 6368 696c 645f 7479        , child_ty
+00037120: 7065 2020 2020 2020 2020 2020 2020 2020  pe              
+00037130: 2020 2020 203d 204e 6f6e 650d 0a20 2020       = None..   
+00037140: 2020 2020 2020 2020 2020 2020 2020 2c20                , 
+00037150: 6368 696c 645f 656c 656d 656e 745f 6964  child_element_id
+00037160: 5f66 6965 6c64 7320 2020 2020 203d 205b  _fields      = [
+00037170: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00037180: 2020 2020 2c20 6368 696c 645f 656c 656d      , child_elem
+00037190: 656e 745f 6964 5f6d 6170 7069 6e67 7320  ent_id_mappings 
+000371a0: 2020 203d 205b 5d0d 0a20 2020 2020 2020     = []..       
+000371b0: 2020 2020 2020 2020 2020 2c20 6368 696c            , chil
+000371c0: 645f 6c6f 6e67 6e61 6d65 5f6d 6170 7069  d_longname_mappi
+000371d0: 6e67 2020 2020 2020 203d 204e 6f6e 650d  ng       = None.
+000371e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000371f0: 2020 293a 0d0a 2020 2020 2020 2020 2727    ):..        ''
+00037200: 2741 6464 206e 6577 2065 6c65 6d65 6e74  'Add new element
+00037210: 7320 696e 2061 206c 6179 6572 2074 6f20  s in a layer to 
+00037220: 6120 5374 7275 6374 7572 6545 6c65 6d65  a StructureEleme
+00037230: 6e74 2e20 5468 6973 2077 6179 2053 7472  nt. This way Str
+00037240: 7563 7475 7265 456c 656d 656e 7420 7472  uctureElement tr
+00037250: 6565 7320 6361 6e20 6265 2062 7569 6c74  ees can be built
+00037260: 2069 6e63 7265 6d65 6e74 616c 6c79 2c20   incrementally, 
+00037270: 7261 7468 6572 2074 6861 6e20 7365 7474  rather than sett
+00037280: 696e 6720 7468 6520 7265 6c61 7469 6f6e  ing the relation
+00037290: 7368 6970 7320 6174 206f 6e63 650d 0a0d  ships at once...
+000372a0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000372b0: 6d61 7070 696e 6773 3a20 4120 7061 6e64  mappings: A pand
+000372c0: 6173 2044 6174 6146 7261 6d65 206f 7220  as DataFrame or 
+000372d0: 6469 6374 696f 6e61 7279 2063 6f6e 7461  dictionary conta
+000372e0: 696e 696e 6720 7468 6520 7061 7265 6e74  ining the parent
+000372f0: 2d63 6869 6c64 206d 6170 7069 6e67 730d  -child mappings.
+00037300: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00037310: 656c 656d 656e 745f 7479 7065 5f66 6965  element_type_fie
+00037320: 6c64 3a20 6966 2073 6574 2c20 7468 6520  ld: if set, the 
+00037330: 4469 6d65 6e73 696f 6e20 6669 656c 6420  Dimension field 
+00037340: 7468 6174 2068 6f6c 6473 2074 6865 2074  that holds the t
+00037350: 7970 6520 6f66 2065 6c65 6d65 6e74 2077  ype of element w
+00037360: 6520 7769 7368 2074 6f20 696e 636c 7564  e wish to includ
+00037370: 6520 6173 2065 6974 6865 7220 7061 7265  e as either pare
+00037380: 6e74 206f 7220 6368 696c 6420 656c 656d  nt or child elem
+00037390: 656e 7473 2e20 5479 7069 6361 6c6c 7920  ents. Typically 
+000373a0: 7468 6973 2064 696d 656e 7369 6f6e 2066  this dimension f
+000373b0: 6965 6c64 2069 7320 6361 6c6c 6564 2027  ield is called '
+000373c0: 5479 7065 270d 0a20 2020 2020 2020 203a  Type'..        :
+000373d0: 7061 7261 6d20 7061 7265 6e74 5f74 7970  param parent_typ
+000373e0: 653a 2054 6865 2076 616c 7565 2069 6e20  e: The value in 
+000373f0: 7468 6520 7479 7065 2066 6965 6c64 2066  the type field f
+00037400: 6f72 2070 6172 656e 7420 656c 656d 656e  or parent elemen
+00037410: 7473 2e20 4966 2073 6574 2c20 6f6e 6c79  ts. If set, only
+00037420: 2065 6c65 6d65 6e74 7320 696e 2074 6865   elements in the
+00037430: 2074 7265 6520 7769 7468 2074 6865 2020   tree with the  
+00037440: 656c 656d 656e 745f 7479 7065 5f66 6965  element_type_fie
+00037450: 6c64 2073 6574 2074 6f20 7061 7265 6e74  ld set to parent
+00037460: 5f66 6965 6c64 2077 696c 6c20 6861 7665  _field will have
+00037470: 2063 6869 6c64 7265 6e20 6174 7461 6368   children attach
+00037480: 6564 2074 6f20 7468 656d 2e0d 0a20 2020  ed to them...   
+00037490: 2020 2020 203a 7061 7261 6d20 7061 7265       :param pare
+000374a0: 6e74 5f65 6c65 6d65 6e74 5f69 645f 6669  nt_element_id_fi
+000374b0: 656c 6473 3a20 5468 6520 6469 6d65 6e73  elds: The dimens
+000374c0: 696f 6e20 456c 656d 656e 7420 6669 656c  ion Element fiel
+000374d0: 6428 7329 2074 6861 7420 686f 6c64 7320  d(s) that holds 
+000374e0: 7468 6520 6964 656e 7469 7479 206f 6620  the identity of 
+000374f0: 7468 6520 7061 7265 6e74 7320 7765 2077  the parents we w
+00037500: 616e 7420 746f 2061 7474 6163 6820 746f  ant to attach to
+00037510: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00037520: 2070 6172 656e 745f 656c 656d 656e 745f   parent_element_
+00037530: 6964 5f6d 6170 7069 6e67 733a 2054 6865  id_mappings: The
+00037540: 2063 6f6c 756d 6e73 2069 6e20 6120 7061   columns in a pa
+00037550: 6e64 6173 2e44 6174 6146 7261 6d65 206f  ndas.DataFrame o
+00037560: 7220 6b65 7973 2069 6e20 6120 4469 6374  r keys in a Dict
+00037570: 696f 6e61 7279 2074 6861 7420 6964 656e  ionary that iden
+00037580: 7469 6679 2074 6865 2070 6172 656e 7420  tify the parent 
+00037590: 656c 656d 656e 7473 2c20 616e 6420 636f  elements, and co
+000375a0: 7272 6573 706f 6e64 2074 6f20 7468 6520  rrespond to the 
+000375b0: 7061 7265 6e74 5f65 6c65 6d65 6e74 5f69  parent_element_i
+000375c0: 645f 6669 656c 6473 0d0a 2020 2020 2020  d_fields..      
+000375d0: 2020 3a70 6172 616d 2063 6869 6c64 5f74    :param child_t
+000375e0: 7970 653a 2054 6865 2076 616c 7565 2069  ype: The value i
+000375f0: 6e20 7468 6520 7479 7065 2066 6965 6c64  n the type field
+00037600: 2066 6f72 2063 6869 6c64 2065 6c65 6d65   for child eleme
+00037610: 6e74 732e 2045 6c65 6d65 6e74 7320 7769  nts. Elements wi
+00037620: 7468 2074 6869 7320 656c 656d 656e 745f  th this element_
+00037630: 7479 7065 5f66 6965 6c64 2073 6574 2074  type_field set t
+00037640: 6f20 6368 696c 645f 6669 656c 6420 7769  o child_field wi
+00037650: 6c6c 2062 6520 6361 6e64 6964 6174 6573  ll be candidates
+00037660: 2066 6f72 2061 7474 6163 6869 6e67 2074   for attaching t
+00037670: 6f20 7468 6520 7472 6565 2e20 4966 206e  o the tree. If n
+00037680: 6f74 2066 6f75 6e64 2069 6e20 7468 6520  ot found in the 
+00037690: 7265 6c65 7661 6e74 2064 696d 656e 7369  relevant dimensi
+000376a0: 6f6e 2c20 6e65 7720 656c 656d 656e 7473  on, new elements
+000376b0: 2077 696c 6c20 6265 2063 7265 6174 6564   will be created
+000376c0: 2077 6974 6820 656c 656d 656e 745f 7479   with element_ty
+000376d0: 7065 5f66 6965 6c64 2073 6574 2074 6f20  pe_field set to 
+000376e0: 7468 6973 2076 616c 7565 0d0a 2020 2020  this value..    
+000376f0: 2020 2020 3a70 6172 616d 2063 6869 6c64      :param child
+00037700: 5f65 6c65 6d65 6e74 5f69 645f 6669 656c  _element_id_fiel
+00037710: 6473 3a20 5468 6520 6469 6d65 6e73 696f  ds: The dimensio
+00037720: 6e20 456c 656d 656e 7420 6669 656c 6428  n Element field(
+00037730: 7329 2074 6861 7420 686f 6c64 7320 7468  s) that holds th
+00037740: 6520 6964 656e 7469 7479 206f 6620 7468  e identity of th
+00037750: 6520 6368 696c 6472 656e 2077 6520 7761  e children we wa
+00037760: 6e74 2074 6f20 6174 7461 6368 0d0a 2020  nt to attach..  
+00037770: 2020 2020 2020 3a70 6172 616d 2063 6869        :param chi
+00037780: 6c64 5f65 6c65 6d65 6e74 5f69 645f 6d61  ld_element_id_ma
+00037790: 7070 696e 6773 3a20 5468 6520 636f 6c75  ppings: The colu
+000377a0: 6d6e 7320 696e 2061 2070 616e 6461 732e  mns in a pandas.
+000377b0: 4461 7461 4672 616d 6520 6f72 206b 6579  DataFrame or key
+000377c0: 7320 696e 2061 2044 6963 7469 6f6e 6172  s in a Dictionar
+000377d0: 7920 7468 6174 2069 6465 6e74 6966 7920  y that identify 
+000377e0: 7468 6520 6368 696c 6420 656c 656d 656e  the child elemen
+000377f0: 7473 2c20 616e 6420 636f 7272 6573 706f  ts, and correspo
+00037800: 6e64 2074 6f20 7468 6520 6368 696c 645f  nd to the child_
+00037810: 656c 656d 656e 745f 6964 5f66 6965 6c64  element_id_field
+00037820: 730d 0a20 2020 2020 2020 203a 7061 7261  s..        :para
+00037830: 6d20 6368 696c 645f 6c6f 6e67 6e61 6d65  m child_longname
+00037840: 5f6d 6170 7069 6e67 3a20 5468 6520 6c6f  _mapping: The lo
+00037850: 6e67 6e61 6d65 206f 6620 7468 6520 6368  ngname of the ch
+00037860: 696c 642c 2061 7320 666f 756e 6420 696e  ild, as found in
+00037870: 2074 6865 206d 6170 7069 6e67 7320 4461   the mappings Da
+00037880: 7461 4672 616d 6520 6f72 2044 6963 7469  taFrame or Dicti
+00037890: 6f6e 6172 7920 2d20 7573 6564 2074 6f20  onary - used to 
+000378a0: 6372 6561 7465 206e 6577 2045 6c65 6d65  create new Eleme
+000378b0: 6e74 7320 7768 656e 2074 6865 7920 646f  nts when they do
+000378c0: 206e 6f74 2065 7869 7374 2069 6e20 7468   not exist in th
+000378d0: 6520 7265 6c65 7661 6e74 2044 696d 656e  e relevant Dimen
+000378e0: 7369 6f6e 0d0a 0d0a 2020 2020 2020 2020  sion....        
+000378f0: 4966 2070 6172 656e 745f 7479 7065 2c20  If parent_type, 
+00037900: 2070 6172 656e 745f 656c 656d 656e 745f   parent_element_
+00037910: 6964 5f66 6965 6c64 7320 616e 6420 7061  id_fields and pa
+00037920: 7265 6e74 5f65 6c65 6d65 6e74 5f69 645f  rent_element_id_
+00037930: 6d61 7070 696e 6773 2061 7265 206e 6f74  mappings are not
+00037940: 2073 6574 2c20 7468 656e 2063 6869 6c64   set, then child
+00037950: 7265 6e20 7769 6c6c 2062 6520 6174 7461  ren will be atta
+00037960: 6368 6564 2074 6f20 616c 6c20 6e6f 6465  ched to all node
+00037970: 7320 696e 2074 6865 2074 7265 652e 0d0a  s in the tree...
+00037980: 2020 2020 2020 2020 5468 6973 2062 6568          This beh
+00037990: 6176 696f 7572 2069 7320 6d6f 7374 2075  aviour is most u
+000379a0: 7365 6675 6c20 7768 656e 2061 6464 696e  seful when addin
+000379b0: 6720 7468 6520 6669 7273 7420 6c61 7965  g the first laye
+000379c0: 7220 746f 2061 6e20 414c 4c20 6f72 2054  r to an ALL or T
+000379d0: 4f54 414c 206e 6f64 652e 0d0a 0d0a 2020  OTAL node.....  
+000379e0: 2020 2020 2020 3e3e 3e0d 0a0d 0a0d 0a0d        >>>.......
+000379f0: 0a20 2020 2020 2020 2027 2727 0d0a 0d0a  .        '''....
+00037a00: 2020 2020 2020 2020 2343 7265 6174 6520          #Create 
+00037a10: 6120 6669 656c 642f 6368 696c 6420 656c  a field/child el
+00037a20: 656d 656e 7420 6c6f 6f6b 7570 0d0a 2020  ement lookup..  
+00037a30: 2020 2020 2020 6368 696c 645f 6c6f 6f6b        child_look
+00037a40: 7570 203d 207b 7d0d 0a20 2020 2020 2020  up = {}..       
+00037a50: 2066 6f72 2065 6c20 696e 2073 656c 662e   for el in self.
+00037a60: 6469 6d65 6e73 696f 6e2e 656c 656d 656e  dimension.elemen
+00037a70: 7473 2e76 616c 7565 7328 293a 0d0a 2020  ts.values():..  
+00037a80: 2020 2020 2020 2020 2020 6966 2065 6c65            if ele
+00037a90: 6d65 6e74 5f74 7970 655f 6669 656c 6420  ment_type_field 
+00037aa0: 6973 204e 6f6e 6520 6f72 2065 6c2e 6669  is None or el.fi
+00037ab0: 656c 6473 5b65 6c65 6d65 6e74 5f74 7970  elds[element_typ
+00037ac0: 655f 6669 656c 645d 203d 3d20 2063 6869  e_field] ==  chi
+00037ad0: 6c64 5f74 7970 653a 0d0a 2020 2020 2020  ld_type:..      
+00037ae0: 2020 2020 2020 2020 2020 6368 696c 645f            child_
+00037af0: 6c6f 6f6b 7570 5b74 7570 6c65 2865 6c2e  lookup[tuple(el.
+00037b00: 6669 656c 6473 5b66 5d20 666f 7220 6620  fields[f] for f 
+00037b10: 696e 2063 6869 6c64 5f65 6c65 6d65 6e74  in child_element
+00037b20: 5f69 645f 6669 656c 6473 295d 203d 2065  _id_fields)] = e
+00037b30: 6c0d 0a0d 0a20 2020 2020 2020 2069 735f  l....        is_
+00037b40: 6461 7461 6672 616d 6520 3d20 4661 6c73  dataframe = Fals
+00037b50: 650d 0a20 2020 2020 2020 2069 735f 6469  e..        is_di
+00037b60: 6374 2020 2020 2020 3d20 4661 6c73 650d  ct      = False.
+00037b70: 0a20 2020 2020 2020 2069 735f 6c69 7374  .        is_list
+00037b80: 2020 2020 2020 3d20 4661 6c73 650d 0a0d        = False...
+00037b90: 0a0d 0a20 2020 2020 2020 2023 5265 7665  ...        #Reve
+00037ba0: 7273 6520 6475 636b 7479 7065 2074 6865  rse ducktype the
+00037bb0: 206d 6170 7069 6e67 7320 7061 7261 6d65   mappings parame
+00037bc0: 7465 720d 0a20 2020 2020 2020 2074 7279  ter..        try
+00037bd0: 3a0d 0a20 2020 2020 2020 2020 2020 206d  :..            m
+00037be0: 6170 7069 6e67 732e 6178 6573 0d0a 2020  appings.axes..  
+00037bf0: 2020 2020 2020 2020 2020 6973 5f64 6174            is_dat
+00037c00: 6166 7261 6d65 203d 2054 7275 650d 0a0d  aframe = True...
+00037c10: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00037c20: 4174 7472 6962 7574 6545 7272 6f72 3a0d  AttributeError:.
+00037c30: 0a20 2020 2020 2020 2020 2020 2023 7472  .            #tr
+00037c40: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00037c50: 2320 2020 206d 6170 7069 6e67 732e 7661  #    mappings.va
+00037c60: 6c75 6573 2829 0d0a 2020 2020 2020 2020  lues()..        
+00037c70: 2020 2020 2320 2020 2069 735f 6469 6374      #    is_dict
+00037c80: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+00037c90: 2020 2020 2023 2020 2020 5f72 656c 6174       #    _relat
+00037ca0: 696f 6e73 6869 705f 6469 6374 203d 207b  ionship_dict = {
+00037cb0: 7d0d 0a20 2020 2020 2020 2020 2020 2023  }..            #
+00037cc0: 2020 2020 666f 7220 6368 696c 645f 7368      for child_sh
+00037cd0: 6f72 746e 616d 652c 7061 7265 6e74 5f73  ortname,parent_s
+00037ce0: 686f 7274 6e61 6d65 2069 6e20 6d61 7070  hortname in mapp
+00037cf0: 696e 6773 2e69 7465 6d73 2829 3a0d 0a20  ings.items():.. 
+00037d00: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00037d10: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+00037d20: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00037d30: 2020 205f 7265 6c61 7469 6f6e 7368 6970     _relationship
+00037d40: 5f64 6963 745b 7061 7265 6e74 5f73 686f  _dict[parent_sho
+00037d50: 7274 6e61 6d65 5d2e 6170 7065 6e64 2863  rtname].append(c
+00037d60: 6869 6c64 5f73 686f 7274 6e61 6d65 290d  hild_shortname).
+00037d70: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00037d80: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+00037d90: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+00037da0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00037db0: 205f 7265 6c61 7469 6f6e 7368 6970 5f64   _relationship_d
+00037dc0: 6963 745b 7061 7265 6e74 5f73 686f 7274  ict[parent_short
+00037dd0: 6e61 6d65 5d20 3d20 5b63 6869 6c64 5f73  name] = [child_s
+00037de0: 686f 7274 6e61 6d65 5d0d 0a20 2020 2020  hortname]..     
+00037df0: 2020 2020 2020 2023 6578 6365 7074 2041         #except A
+00037e00: 7474 7269 6275 7465 4572 726f 723a 0d0a  ttributeError:..
+00037e10: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+00037e20: 2069 735f 6c69 7374 203d 2054 7275 650d   is_list = True.
+00037e30: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00037e40: 2020 5f72 656c 6174 696f 6e73 6869 705f    _relationship_
+00037e50: 6469 6374 203d 207b 7d0d 0a20 2020 2020  dict = {}..     
+00037e60: 2020 2020 2020 2023 2020 2020 666f 7220         #    for 
+00037e70: 6368 696c 645f 7368 6f72 746e 616d 652c  child_shortname,
+00037e80: 7061 7265 6e74 5f73 686f 7274 6e61 6d65  parent_shortname
+00037e90: 2069 6e20 6d61 7070 696e 6773 3a0d 0a20   in mappings:.. 
+00037ea0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00037eb0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+00037ec0: 2020 2020 2020 2320 2020 2020 2020 2020        #         
+00037ed0: 2020 205f 7265 6c61 7469 6f6e 7368 6970     _relationship
+00037ee0: 5f64 6963 745b 7061 7265 6e74 5f73 686f  _dict[parent_sho
+00037ef0: 7274 6e61 6d65 5d2e 6170 7065 6e64 2863  rtname].append(c
+00037f00: 6869 6c64 5f73 686f 7274 6e61 6d65 290d  hild_shortname).
+00037f10: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00037f20: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+00037f30: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+00037f40: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+00037f50: 205f 7265 6c61 7469 6f6e 7368 6970 5f64   _relationship_d
+00037f60: 6963 745b 7061 7265 6e74 5f73 686f 7274  ict[parent_short
+00037f70: 6e61 6d65 5d20 3d20 5b63 6869 6c64 5f73  name] = [child_s
+00037f80: 686f 7274 6e61 6d65 5d0d 0a20 2020 2020  hortname]..     
+00037f90: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
+00037fa0: 2020 2020 2020 2023 5468 6520 6361 6e6f         #The cano
+00037fb0: 6e69 6361 6c20 6669 656c 6420 746f 2068  nical field to h
+00037fc0: 6f6c 6420 7468 6520 7479 7065 206f 6620  old the type of 
+00037fd0: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+00037fe0: 2069 7320 2754 7970 6527 202d 2075 7365   is 'Type' - use
+00037ff0: 2074 6869 7320 6966 0d0a 2020 2020 2020   this if..      
+00038000: 2020 6966 2028 7061 7265 6e74 5f74 7970    if (parent_typ
+00038010: 6520 6973 206e 6f74 204e 6f6e 6520 6f72  e is not None or
+00038020: 2063 6869 6c64 5f74 7970 6520 6973 206e   child_type is n
+00038030: 6f74 204e 6f6e 6529 2061 6e64 2065 6c65  ot None) and ele
+00038040: 6d65 6e74 5f74 7970 655f 6669 656c 6420  ment_type_field 
+00038050: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00038060: 2020 2020 2020 656c 656d 656e 745f 7479        element_ty
+00038070: 7065 5f66 6965 6c64 203d 2027 5479 7065  pe_field = 'Type
+00038080: 270d 0a0d 0a20 2020 2020 2020 2063 6869  '....        chi
+00038090: 6c64 5f65 6c65 6d65 6e74 735f 746f 5f63  ld_elements_to_c
+000380a0: 7265 6174 6520 3d20 5b5d 0d0a 0d0a 2020  reate = []....  
+000380b0: 2020 2020 2020 6966 2069 735f 6461 7461        if is_data
+000380c0: 6672 616d 653a 0d0a 2020 2020 2020 2020  frame:..        
+000380d0: 2020 2020 2345 6e73 7572 6520 7468 6520      #Ensure the 
+000380e0: 636f 7272 6563 7420 636f 6c75 6d6e 7320  correct columns 
+000380f0: 6172 6520 696e 2074 6865 2044 6174 6146  are in the DataF
+00038100: 7261 6d65 2c20 6f74 6865 7277 6973 6520  rame, otherwise 
+00038110: 4b65 7945 7272 6f72 7320 6172 6520 676f  KeyErrors are go
+00038120: 696e 6720 746f 2062 6520 7468 726f 776e  ing to be thrown
+00038130: 2069 6e20 7468 6520 6f64 6465 7374 206f   in the oddest o
+00038140: 6620 706c 6163 6573 2061 6e64 206d 616b  f places and mak
+00038150: 6520 6465 6275 6767 696e 6720 6120 6e69  e debugging a ni
+00038160: 6768 746d 6172 650d 0a0d 0a20 2020 2020  ghtmare....     
+00038170: 2020 2020 2020 2023 4372 6561 7465 2061         #Create a
+00038180: 2064 6963 7469 6f6e 6172 7920 6f66 2072   dictionary of r
+00038190: 656c 6174 696f 6e73 6869 7073 2062 6574  elationships bet
+000381a0: 7765 656e 2070 6172 656e 7420 746f 2061  ween parent to a
+000381b0: 6c6c 206f 6620 7468 6569 7220 6368 696c  ll of their chil
+000381c0: 6472 656e 0d0a 2020 2020 2020 2020 2020  dren..          
+000381d0: 2020 5f72 656c 6174 696f 6e73 6869 705f    _relationship_
+000381e0: 6469 6374 203d 207b 7d0d 0a0d 0a20 2020  dict = {}....   
+000381f0: 2020 2020 2020 2020 2023 4765 7420 756e           #Get un
+00038200: 6971 7565 2063 6f6c 756d 6e73 2c20 736f  ique columns, so
+00038210: 2074 6861 7420 7765 2063 616e 2064 726f   that we can dro
+00038220: 7020 6475 706c 6963 6174 6573 0d0a 2020  p duplicates..  
+00038230: 2020 2020 2020 2020 2020 636f 6c75 6d6e            column
+00038240: 7320 3d20 6368 696c 645f 656c 656d 656e  s = child_elemen
+00038250: 745f 6964 5f6d 6170 7069 6e67 732b 7061  t_id_mappings+pa
+00038260: 7265 6e74 5f65 6c65 6d65 6e74 5f69 645f  rent_element_id_
+00038270: 6d61 7070 696e 6773 0d0a 2020 2020 2020  mappings..      
+00038280: 2020 2020 2020 6966 2063 6869 6c64 5f6c        if child_l
+00038290: 6f6e 676e 616d 655f 6d61 7070 696e 6720  ongname_mapping 
+000382a0: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+000382b0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000382c0: 6c75 6d6e 732e 6170 7065 6e64 2863 6869  lumns.append(chi
+000382d0: 6c64 5f6c 6f6e 676e 616d 655f 6d61 7070  ld_longname_mapp
+000382e0: 696e 6729 0d0a 0d0a 2020 2020 2020 2020  ing)....        
+000382f0: 2020 2020 636f 6c75 6d6e 7320 3d6c 6973      columns =lis
+00038300: 7428 7365 7428 636f 6c75 6d6e 7329 290d  t(set(columns)).
+00038310: 0a0d 0a20 2020 2020 2020 2020 2020 2066  ...            f
+00038320: 6f72 2069 6e64 6578 2c20 726f 7720 696e  or index, row in
+00038330: 206d 6170 7069 6e67 735b 636f 6c75 6d6e   mappings[column
+00038340: 735d 2e64 726f 706e 6128 292e 6472 6f70  s].dropna().drop
+00038350: 5f64 7570 6c69 6361 7465 7328 6b65 6570  _duplicates(keep
+00038360: 3d27 6669 7273 7427 292e 6974 6572 726f  ='first').iterro
+00038370: 7773 2829 3a0d 0a0d 0a20 2020 2020 2020  ws():....       
+00038380: 2020 2020 2020 2020 2023 2020 2020 2346           #    #F
+00038390: 696c 7465 7220 7061 7265 6e74 7320 6966  ilter parents if
+000383a0: 2074 6861 7427 7320 7768 6174 2077 6520   that's what we 
+000383b0: 6172 6520 646f 696e 670d 0a20 2020 2020  are doing..     
+000383c0: 2020 2020 2020 2020 2020 2023 6966 2070             #if p
+000383d0: 6172 656e 745f 7479 7065 2069 7320 6e6f  arent_type is no
+000383e0: 7420 4e6f 6e65 2061 6e64 2072 6f77 5b65  t None and row[e
+000383f0: 6c65 6d65 6e74 5f74 7970 655f 6669 656c  lement_type_fiel
+00038400: 645d 2021 3d20 7061 7265 6e74 5f74 7970  d] != parent_typ
+00038410: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00038420: 2020 2020 2320 2020 2063 6f6e 7469 6e75      #    continu
+00038430: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+00038440: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00038450: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00038460: 6869 6c64 5f65 6c65 6d65 6e74 203d 2063  hild_element = c
+00038470: 6869 6c64 5f6c 6f6f 6b75 705b 7475 706c  hild_lookup[tupl
+00038480: 6528 726f 775b 6d61 7070 696e 675f 636f  e(row[mapping_co
+00038490: 6c75 6d6e 5d20 666f 7220 6d61 7070 696e  lumn] for mappin
+000384a0: 675f 636f 6c75 6d6e 2069 6e20 6368 696c  g_column in chil
+000384b0: 645f 656c 656d 656e 745f 6964 5f6d 6170  d_element_id_map
+000384c0: 7069 6e67 7329 5d0d 0a20 2020 2020 2020  pings)]..       
+000384d0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+000384e0: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
+000384f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00038500: 6d61 6b65 2074 6865 2063 6869 6c64 0d0a  make the child..
+00038510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038520: 2020 2020 6966 2063 6869 6c64 5f6c 6f6e      if child_lon
+00038530: 676e 616d 655f 6d61 7070 696e 6720 6973  gname_mapping is
+00038540: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00038550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038560: 2352 6169 7365 2061 6e20 6572 726f 722c  #Raise an error,
+00038570: 2073 696e 6365 2077 6520 6361 6e27 7420   since we can't 
+00038580: 6372 6561 7465 2074 6865 2063 6869 6c64  create the child
+00038590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000385a0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000385b0: 5661 6c75 6545 7272 6f72 2827 4368 696c  ValueError('Chil
+000385c0: 6420 656c 656d 656e 7473 2063 616e 6e6f  d elements canno
+000385d0: 7420 6265 2063 7265 6174 6564 2077 6974  t be created wit
+000385e0: 686f 7574 2061 2063 6869 6c64 5f6c 6f6e  hout a child_lon
+000385f0: 676e 616d 655f 6d61 7070 696e 672e 2043  gname_mapping. C
+00038600: 6869 6c64 207b 7d20 7761 7320 6e6f 7420  hild {} was not 
+00038610: 666f 756e 6420 7768 656e 2063 7265 6174  found when creat
+00038620: 696e 6720 7468 6520 5374 7275 6374 7572  ing the Structur
+00038630: 6545 6c65 6d65 6e74 2074 7265 6527 2e66  eElement tree'.f
+00038640: 6f72 6d61 7428 2872 6f77 5b6d 6170 7069  ormat((row[mappi
+00038650: 6e67 5f63 6f6c 756d 6e5d 2066 6f72 206d  ng_column] for m
+00038660: 6170 7069 6e67 5f63 6f6c 756d 6e20 696e  apping_column in
+00038670: 2063 6869 6c64 5f65 6c65 6d65 6e74 5f69   child_element_i
+00038680: 645f 6d61 7070 696e 6773 2929 290d 0a0d  d_mappings)))...
+00038690: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000386a0: 2020 2020 2066 6965 6c64 733d 7b6b 3a76       fields={k:v
+000386b0: 2066 6f72 206b 2c76 2069 6e20 7a69 7028   for k,v in zip(
+000386c0: 6368 696c 645f 656c 656d 656e 745f 6964  child_element_id
+000386d0: 5f66 6965 6c64 732c 7475 706c 6528 726f  _fields,tuple(ro
+000386e0: 775b 6d5d 2066 6f72 206d 2069 6e20 6368  w[m] for m in ch
+000386f0: 696c 645f 656c 656d 656e 745f 6964 5f6d  ild_element_id_m
+00038700: 6170 7069 6e67 7329 297d 0d0a 0d0a 2020  appings))}....  
+00038710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038720: 2020 6c6f 6e67 6e61 6d65 203d 2072 6f77    longname = row
+00038730: 5b63 6869 6c64 5f6c 6f6e 676e 616d 655f  [child_longname_
+00038740: 6d61 7070 696e 675d 0d0a 2020 2020 2020  mapping]..      
+00038750: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+00038760: 696c 645f 656c 656d 656e 7420 3d20 456c  ild_element = El
+00038770: 656d 656e 7428 6469 6d65 6e73 696f 6e20  ement(dimension 
+00038780: 3d20 7365 6c66 2e64 696d 656e 7369 6f6e  = self.dimension
+00038790: 2c20 7368 6f72 746e 616d 6520 3d20 4e6f  , shortname = No
+000387a0: 6e65 2c20 6c6f 6e67 6e61 6d65 203d 206c  ne, longname = l
+000387b0: 6f6e 676e 616d 652c 2066 6965 6c64 733d  ongname, fields=
+000387c0: 7b6b 3a76 2066 6f72 206b 2c76 2069 6e20  {k:v for k,v in 
+000387d0: 7a69 7028 6368 696c 645f 656c 656d 656e  zip(child_elemen
+000387e0: 745f 6964 5f66 6965 6c64 732c 5b72 6f77  t_id_fields,[row
+000387f0: 5b6d 5d20 666f 7220 6d20 696e 2063 6869  [m] for m in chi
+00038800: 6c64 5f65 6c65 6d65 6e74 5f69 645f 6d61  ld_element_id_ma
+00038810: 7070 696e 6773 5d29 7d29 0d0a 2020 2020  ppings])})..    
+00038820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038830: 6966 2065 6c65 6d65 6e74 5f74 7970 655f  if element_type_
+00038840: 6669 656c 6420 6973 206e 6f74 204e 6f6e  field is not Non
+00038850: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00038860: 2020 2020 2020 2020 2020 2020 6368 696c              chil
+00038870: 645f 656c 656d 656e 742e 6669 656c 6473  d_element.fields
+00038880: 5b65 6c65 6d65 6e74 5f74 7970 655f 6669  [element_type_fi
+00038890: 656c 645d 203d 2063 6869 6c64 5f74 7970  eld] = child_typ
+000388a0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+000388b0: 2020 2020 2020 2023 6d65 7267 6520 696e         #merge in
+000388c0: 746f 2064 696d 656e 7369 6f6e 2e65 6c65  to dimension.ele
+000388d0: 6d65 6e74 730d 0a20 2020 2020 2020 2020  ments..         
+000388e0: 2020 2020 2020 2020 2020 2063 6869 6c64             child
+000388f0: 5f65 6c65 6d65 6e74 735f 746f 5f63 7265  _elements_to_cre
+00038900: 6174 652e 6170 7065 6e64 2863 6869 6c64  ate.append(child
+00038910: 5f65 6c65 6d65 6e74 290d 0a0d 0a20 2020  _element)....   
+00038920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038930: 2023 4164 6420 746f 2074 6865 206c 6f6f   #Add to the loo
+00038940: 6b75 702c 2073 6f20 7765 2064 6f6e 2774  kup, so we don't
+00038950: 2063 7265 6174 6520 6974 2061 6761 696e   create it again
+00038960: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00038970: 2020 2020 2020 6368 696c 645f 6c6f 6f6b        child_look
+00038980: 7570 5b74 7570 6c65 2872 6f77 5b6d 6170  up[tuple(row[map
+00038990: 7069 6e67 5f63 6f6c 756d 6e5d 2066 6f72  ping_column] for
+000389a0: 206d 6170 7069 6e67 5f63 6f6c 756d 6e20   mapping_column 
+000389b0: 696e 2063 6869 6c64 5f65 6c65 6d65 6e74  in child_element
+000389c0: 5f69 645f 6d61 7070 696e 6773 295d 203d  _id_mappings)] =
+000389d0: 2063 6869 6c64 5f65 6c65 6d65 6e74 0d0a   child_element..
+000389e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000389f0: 2020 2341 7070 656e 6420 746f 2074 6865    #Append to the
+00038a00: 206c 6973 7420 6f66 2061 6c6c 2063 6869   list of all chi
+00038a10: 6c64 2065 6c65 6d65 6e74 7320 7765 2077  ld elements we w
+00038a20: 696c 6c20 6265 2070 7574 7469 6e67 2075  ill be putting u
+00038a30: 6e64 6572 2074 6869 7320 7061 7265 6e74  nder this parent
+00038a40: 2065 6c65 6d65 6e74 0d0a 2020 2020 2020   element..      
+00038a50: 2020 2020 2020 2020 2020 234e 6f74 6520            #Note 
+00038a60: 6368 696c 6472 656e 2077 696c 6c20 6265  children will be
+00038a70: 2070 6c61 6365 6420 696e 2074 6865 206f   placed in the o
+00038a80: 7264 6572 2074 6865 7920 6170 7065 6172  rder they appear
+00038a90: 2069 6e20 7468 6520 736f 7572 6365 0d0a   in the source..
+00038aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038ab0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00038ac0: 2020 2020 2020 2020 2020 5f63 6869 6c64            _child
+00038ad0: 5f65 6c65 6d65 6e74 5f6c 6973 7420 3d20  _element_list = 
+00038ae0: 5f72 656c 6174 696f 6e73 6869 705f 6469  _relationship_di
+00038af0: 6374 5b74 7570 6c65 2872 6f77 5b6d 6170  ct[tuple(row[map
+00038b00: 7069 6e67 5f63 6f6c 756d 6e5d 2066 6f72  ping_column] for
+00038b10: 206d 6170 7069 6e67 5f63 6f6c 756d 6e20   mapping_column 
+00038b20: 696e 2070 6172 656e 745f 656c 656d 656e  in parent_elemen
+00038b30: 745f 6964 5f6d 6170 7069 6e67 7329 5d0d  t_id_mappings)].
+00038b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00038b50: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+00038b60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00038b70: 2020 2020 2020 205f 6368 696c 645f 656c         _child_el
+00038b80: 656d 656e 745f 6c69 7374 203d 205b 5d0d  ement_list = [].
+00038b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00038ba0: 2020 2020 205f 7265 6c61 7469 6f6e 7368       _relationsh
+00038bb0: 6970 5f64 6963 745b 7475 706c 6528 726f  ip_dict[tuple(ro
+00038bc0: 775b 6d61 7070 696e 675f 636f 6c75 6d6e  w[mapping_column
+00038bd0: 5d20 666f 7220 6d61 7070 696e 675f 636f  ] for mapping_co
+00038be0: 6c75 6d6e 2069 6e20 7061 7265 6e74 5f65  lumn in parent_e
+00038bf0: 6c65 6d65 6e74 5f69 645f 6d61 7070 696e  lement_id_mappin
+00038c00: 6773 295d 203d 205f 6368 696c 645f 656c  gs)] = _child_el
+00038c10: 656d 656e 745f 6c69 7374 0d0a 0d0a 2020  ement_list....  
+00038c20: 2020 2020 2020 2020 2020 2020 2020 5f63                _c
+00038c30: 6869 6c64 5f65 6c65 6d65 6e74 5f6c 6973  hild_element_lis
+00038c40: 742e 6170 7065 6e64 2863 6869 6c64 5f65  t.append(child_e
+00038c50: 6c65 6d65 6e74 290d 0a0d 0a20 2020 2020  lement)....     
+00038c60: 2020 2020 2020 2020 2020 2023 7472 793a             #try:
+00038c70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00038c80: 2020 2320 2020 205f 7265 6c61 7469 6f6e    #    _relation
+00038c90: 7368 6970 5f64 6963 745b 7061 7265 6e74  ship_dict[parent
+00038ca0: 5f73 686f 7274 6e61 6d65 5d2e 6170 7065  _shortname].appe
+00038cb0: 6e64 2863 6869 6c64 5f73 686f 7274 6e61  nd(child_shortna
+00038cc0: 6d65 290d 0a20 2020 2020 2020 2020 2020  me)..           
+00038cd0: 2020 2020 2023 6578 6365 7074 204b 6579       #except Key
+00038ce0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+00038cf0: 2020 2020 2020 2020 2320 2020 205f 7265          #    _re
+00038d00: 6c61 7469 6f6e 7368 6970 5f64 6963 745b  lationship_dict[
+00038d10: 7061 7265 6e74 5f73 686f 7274 6e61 6d65  parent_shortname
+00038d20: 5d20 3d20 5b63 6869 6c64 5f73 686f 7274  ] = [child_short
+00038d30: 6e61 6d65 5d0d 0a0d 0a20 2020 2020 2020  name]....       
+00038d40: 2020 2020 2063 7265 6174 6564 5f65 6c65       created_ele
+00038d50: 6d65 6e74 5f6c 6f6f 6b75 7020 3d20 7b7d  ment_lookup = {}
+00038d60: 0d0a 2020 2020 2020 2020 2020 2020 234d  ..            #M
+00038d70: 6572 6765 2061 6e64 2073 796e 6368 726f  erge and synchro
+00038d80: 6e69 7365 2061 6e79 206e 6577 2063 6869  nise any new chi
+00038d90: 6c64 2065 6c65 6d65 6e74 732c 2062 6563  ld elements, bec
+00038da0: 6175 7365 2053 7472 7563 7475 7265 456c  ause StructureEl
+00038db0: 656d 656e 7473 2063 616e 6e6f 7420 6265  ements cannot be
+00038dc0: 206d 6164 6520 7769 7468 2075 6e73 796e   made with unsyn
+00038dd0: 6368 726f 6e69 7365 6420 6368 696c 6472  chronised childr
+00038de0: 656e 0d0a 2020 2020 2020 2020 2020 2020  en..            
+00038df0: 6966 206c 656e 2863 6869 6c64 5f65 6c65  if len(child_ele
+00038e00: 6d65 6e74 735f 746f 5f63 7265 6174 6529  ments_to_create)
+00038e10: 2020 3e20 303a 0d0a 2020 2020 2020 2020    > 0:..        
+00038e20: 2020 2020 2020 2020 6b65 795f 6669 656c          key_fiel
+00038e30: 6473 203d 2063 6869 6c64 5f65 6c65 6d65  ds = child_eleme
+00038e40: 6e74 5f69 645f 6669 656c 6473 0d0a 0d0a  nt_id_fields....
+00038e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038e60: 6966 2065 6c65 6d65 6e74 5f74 7970 655f  if element_type_
+00038e70: 6669 656c 6420 6973 206e 6f74 204e 6f6e  field is not Non
+00038e80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00038e90: 2020 2020 2020 2020 6b65 795f 6669 656c          key_fiel
+00038ea0: 6473 2e61 7070 656e 6428 656c 656d 656e  ds.append(elemen
+00038eb0: 745f 7479 7065 5f66 6965 6c64 290d 0a20  t_type_field).. 
+00038ec0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00038ed0: 7265 6174 6564 5f65 6c65 6d65 6e74 7320  reated_elements 
+00038ee0: 3d20 7365 6c66 2e64 696d 656e 7369 6f6e  = self.dimension
+00038ef0: 2e65 6c65 6d65 6e74 732e 6d65 7267 6528  .elements.merge(
+00038f00: 6368 696c 645f 656c 656d 656e 7473 5f74  child_elements_t
+00038f10: 6f5f 6372 6561 7465 2c6b 6579 733d 6b65  o_create,keys=ke
+00038f20: 795f 6669 656c 6473 290d 0a0d 0a20 2020  y_fields)....   
+00038f30: 2020 2020 2020 2020 2020 2020 2063 7265               cre
+00038f40: 6174 6564 5f65 6c65 6d65 6e74 5f6c 6f6f  ated_element_loo
+00038f50: 6b75 7020 3d20 7b6b 3a76 2066 6f72 206b  kup = {k:v for k
+00038f60: 2c76 2069 6e20 7a69 7028 6368 696c 645f  ,v in zip(child_
+00038f70: 656c 656d 656e 7473 5f74 6f5f 6372 6561  elements_to_crea
+00038f80: 7465 2c63 7265 6174 6564 5f65 6c65 6d65  te,created_eleme
+00038f90: 6e74 7329 7d0d 0a20 2020 2020 2020 2020  nts)}..         
+00038fa0: 2020 2020 2020 2073 656c 662e 6469 6d65         self.dime
+00038fb0: 6e73 696f 6e2e 656c 656d 656e 7473 2e73  nsion.elements.s
+00038fc0: 796e 6368 726f 6e69 7365 2829 0d0a 0d0a  ynchronise()....
+00038fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00038fe0: 666f 7220 5f63 6869 6c64 5f65 6c65 6d65  for _child_eleme
+00038ff0: 6e74 5f6c 6973 7420 696e 205f 7265 6c61  nt_list in _rela
+00039000: 7469 6f6e 7368 6970 5f64 6963 742e 7661  tionship_dict.va
+00039010: 6c75 6573 2829 3a0d 0a20 2020 2020 2020  lues():..       
+00039020: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00039030: 206e 2c20 656c 2069 6e20 656e 756d 6572   n, el in enumer
+00039040: 6174 6528 5f63 6869 6c64 5f65 6c65 6d65  ate(_child_eleme
+00039050: 6e74 5f6c 6973 7429 3a0d 0a20 2020 2020  nt_list):..     
+00039060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039070: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00039080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039090: 2020 2020 2023 7472 7920 746f 2072 6570       #try to rep
+000390a0: 6c61 6365 2075 6e2d 6372 6561 7465 6420  lace un-created 
+000390b0: 656c 656d 656e 7473 2077 6974 6820 7468  elements with th
+000390c0: 6569 7220 6372 6561 7465 6420 2863 616e  eir created (can
+000390d0: 6f6e 6963 616c 2920 7265 706c 6163 656d  onical) replacem
+000390e0: 656e 7473 0d0a 2020 2020 2020 2020 2020  ents..          
+000390f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039100: 2020 5f63 6869 6c64 5f65 6c65 6d65 6e74    _child_element
+00039110: 5f6c 6973 745b 6e5d 203d 2063 7265 6174  _list[n] = creat
+00039120: 6564 5f65 6c65 6d65 6e74 5f6c 6f6f 6b75  ed_element_looku
+00039130: 705b 656c 5d0d 0a20 2020 2020 2020 2020  p[el]..         
+00039140: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00039150: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
+00039160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00039170: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00039180: 730d 0a0d 0a20 2020 2020 2020 2023 6c69  s....        #li
+00039190: 7374 2074 6865 2073 7472 7563 7475 7265  st the structure
+000391a0: 2c20 7369 6e63 6520 7765 2061 7265 2069  , since we are i
+000391b0: 7465 7261 7469 6e67 206f 7665 7220 6974  terating over it
+000391c0: 2061 6e64 2063 6861 6e67 696e 6720 6974   and changing it
+000391d0: 2061 7420 7465 6820 7361 6d65 2074 696d   at teh same tim
+000391e0: 650d 0a20 2020 2020 2020 2066 6f72 2073  e..        for s
+000391f0: 6520 696e 206c 6973 7428 7365 6c66 2e77  e in list(self.w
+00039200: 616c 6b28 2929 3a0d 0a20 2020 2020 2020  alk()):..       
+00039210: 2020 2020 2023 4669 6c74 6572 2070 6172       #Filter par
+00039220: 656e 7473 2069 6620 7468 6174 2773 2077  ents if that's w
+00039230: 6861 7420 7765 2061 7265 2064 6f69 6e67  hat we are doing
+00039240: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00039250: 2070 6172 656e 745f 7479 7065 2069 7320   parent_type is 
+00039260: 6e6f 7420 4e6f 6e65 2061 6e64 2073 652e  not None and se.
+00039270: 656c 656d 656e 742e 6669 656c 6473 5b65  element.fields[e
+00039280: 6c65 6d65 6e74 5f74 7970 655f 6669 656c  lement_type_fiel
+00039290: 645d 2021 3d20 7061 7265 6e74 5f74 7970  d] != parent_typ
+000392a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000392b0: 2020 2020 636f 6e74 696e 7565 0d0a 0d0a      continue....
+000392c0: 2020 2020 2020 2020 2020 2020 234c 6f6f              #Loo
+000392d0: 6b75 7020 7468 6520 6368 696c 6472 656e  kup the children
+000392e0: 2074 6f20 6170 7065 6e64 202d 2077 6527   to append - we'
+000392f0: 7665 2064 6f6e 6520 7468 6520 776f 726b  ve done the work
+00039300: 2074 6f20 6761 7468 6572 2074 6865 6d20   to gather them 
+00039310: 616c 7265 6164 790d 0a20 2020 2020 2020  already..       
+00039320: 2020 2020 2023 2052 6570 6c61 6365 2074       # Replace t
+00039330: 6865 206c 6f6f 6b65 6420 7570 2063 6869  he looked up chi
+00039340: 6c64 7265 6e20 7769 7468 2074 6865 6972  ldren with their
+00039350: 206d 6173 7465 7265 6420 6571 7569 7661   mastered equiva
+00039360: 6c65 6e74 730d 0a20 2020 2020 2020 2020  lents..         
+00039370: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00039380: 2020 2020 2020 2020 2063 6869 6c64 7265           childre
+00039390: 6e5f 746f 5f61 7070 656e 6420 3d20 5f72  n_to_append = _r
+000393a0: 656c 6174 696f 6e73 6869 705f 6469 6374  elationship_dict
+000393b0: 5b74 7570 6c65 285b 7365 2e66 6965 6c64  [tuple([se.field
+000393c0: 735b 665d 2066 6f72 2066 2069 6e20 7061  s[f] for f in pa
+000393d0: 7265 6e74 5f65 6c65 6d65 6e74 5f69 645f  rent_element_id_
+000393e0: 6669 656c 6473 5d29 5d0d 0a20 2020 2020  fields])]..     
+000393f0: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
+00039400: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
+00039410: 2020 2020 2020 2020 2023 4e6f 2063 6869           #No chi
+00039420: 6c64 7265 6e20 666f 7220 7468 6973 2072  ldren for this r
+00039430: 6167 6765 6420 6869 6572 6172 6368 7920  agged hierarchy 
+00039440: 2d20 636f 6e74 696e 7565 206f 6e20 746f  - continue on to
+00039450: 206e 6578 7420 656c 656d 656e 740d 0a20   next element.. 
+00039460: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00039470: 6f6e 7469 6e75 650d 0a0d 0a20 2020 2020  ontinue....     
+00039480: 2020 2020 2020 2069 6620 6c65 6e28 6372         if len(cr
+00039490: 6561 7465 645f 656c 656d 656e 745f 6c6f  eated_element_lo
+000394a0: 6f6b 7570 2920 3e20 303a 0d0a 2020 2020  okup) > 0:..    
+000394b0: 2020 2020 2020 2020 2020 2020 6d61 7374              mast
+000394c0: 6572 6564 5f63 6869 6c64 7265 6e5f 746f  ered_children_to
+000394d0: 5f61 7070 656e 6420 3d20 5b5d 0d0a 2020  _append = []..  
+000394e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+000394f0: 7220 6368 2069 6e20 6368 696c 6472 656e  r ch in children
+00039500: 5f74 6f5f 6170 7065 6e64 3a0d 0a20 2020  _to_append:..   
+00039510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039520: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00039530: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00039540: 6173 7465 7265 645f 6368 696c 6472 656e  astered_children
+00039550: 5f74 6f5f 6170 7065 6e64 2e61 7070 656e  _to_append.appen
+00039560: 6428 6372 6561 7465 645f 656c 656d 656e  d(created_elemen
+00039570: 745f 6c6f 6f6b 7570 5b63 685d 290d 0a20  t_lookup[ch]).. 
 00039580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039590: 206d 6173 7465 7265 645f 6368 696c 6472   mastered_childr
-000395a0: 656e 5f74 6f5f 6170 7065 6e64 2e61 7070  en_to_append.app
-000395b0: 656e 6428 6368 290d 0a20 2020 2020 2020  end(ch)..       
-000395c0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-000395d0: 2020 2020 2020 2020 2020 2020 2349 6620              #If 
-000395e0: 6e6f 2065 6c65 6d65 6e74 7320 7765 7265  no elements were
-000395f0: 2063 7265 6174 6564 2061 7420 616c 6c2c   created at all,
-00039600: 2064 6f6e 7427 2073 7065 6e64 2074 696d   dont' spend tim
-00039610: 6520 646f 696e 6720 616e 7920 6c6f 6f6b  e doing any look
-00039620: 7570 0d0a 2020 2020 2020 2020 2020 2020  up..            
-00039630: 2020 2020 6d61 7374 6572 6564 5f63 6869      mastered_chi
-00039640: 6c64 7265 6e5f 746f 5f61 7070 656e 6420  ldren_to_append 
-00039650: 3d20 6368 696c 6472 656e 5f74 6f5f 6170  = children_to_ap
-00039660: 7065 6e64 0d0a 2020 2020 2020 2020 2020  pend..          
-00039670: 2020 7365 2e63 6869 6c64 7265 6e20 2b3d    se.children +=
-00039680: 206d 6173 7465 7265 645f 6368 696c 6472   mastered_childr
-00039690: 656e 5f74 6f5f 6170 7065 6e64 0d0a 0d0a  en_to_append....
-000396a0: 0d0a 2020 2020 6465 6620 7365 745f 7472  ..    def set_tr
-000396b0: 6565 2873 656c 662c 7265 6c61 7469 6f6e  ee(self,relation
-000396c0: 7368 6970 732c 7570 6461 7465 3d46 616c  ships,update=Fal
-000396d0: 7365 293a 0d0a 2020 2020 2020 2020 2727  se):..        ''
-000396e0: 270d 0a20 2020 2020 2020 2053 6574 2061  '..        Set a
-000396f0: 6c6c 206f 6620 7468 6520 7265 6c61 7469  ll of the relati
-00039700: 6f6e 7368 6970 7320 696e 2074 6865 2074  onships in the t
-00039710: 7265 6520 6265 6c6f 7720 7468 6973 2053  ree below this S
-00039720: 7472 7563 7475 7265 456c 656d 656e 742e  tructureElement.
-00039730: 204f 6c64 2072 656c 6174 696f 6e73 6869   Old relationshi
-00039740: 7073 2077 696c 6c20 6765 7420 7468 726f  ps will get thro
-00039750: 776e 2061 7761 790d 0a0d 0a20 2020 2020  wn away....     
-00039760: 2020 203a 7061 7261 6d20 7265 6c61 7469     :param relati
-00039770: 6f6e 7368 6970 733a 2061 206c 6973 7420  onships: a list 
-00039780: 6f66 2070 6172 656e 7420 6368 696c 6420  of parent child 
-00039790: 7475 706c 6573 2c20 6120 6469 6374 696f  tuples, a dictio
-000397a0: 6e61 7279 206f 6620 7b63 6869 6c64 3a70  nary of {child:p
-000397b0: 6172 656e 747d 206f 7220 6120 6461 7461  arent} or a data
-000397c0: 6672 616d 6520 7769 7468 2063 6f6c 756d  frame with colum
-000397d0: 6e73 2027 5368 6f72 7420 4e61 6d65 2720  ns 'Short Name' 
-000397e0: 6f72 2027 5068 7973 4944 2720 616e 6420  or 'PhysID' and 
-000397f0: 2750 6172 656e 7420 5368 6f72 7420 4e61  'Parent Short Na
-00039800: 6d65 2720 6f72 2027 5061 7265 6e74 2050  me' or 'Parent P
-00039810: 6879 7349 4427 0d0a 2020 2020 2020 2020  hysID'..        
-00039820: 3a70 6172 616d 2075 7064 6174 653a 2069  :param update: i
-00039830: 6620 7365 7420 746f 2054 7275 652c 2074  f set to True, t
-00039840: 6865 2073 7472 7563 7475 7265 2069 7320  he structure is 
-00039850: 7570 6461 7465 642c 206f 7468 6572 7769  updated, otherwi
-00039860: 7365 2069 7420 6973 2072 6570 6c61 6365  se it is replace
-00039870: 6420 2864 6566 6175 6c74 290d 0a20 2020  d (default)..   
-00039880: 2020 2020 2027 2727 0d0a 0d0a 2020 2020       '''....    
-00039890: 2020 2020 6973 5f64 6174 6166 7261 6d65      is_dataframe
-000398a0: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-000398b0: 2020 6973 5f64 6963 7420 2020 2020 203d    is_dict      =
-000398c0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-000398d0: 6973 5f6c 6973 7420 2020 2020 203d 2046  is_list      = F
-000398e0: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
-000398f0: 2352 6576 6572 7365 2064 7563 6b74 7970  #Reverse ducktyp
-00039900: 6520 7468 6520 7265 6c61 7469 6f6e 7368  e the relationsh
-00039910: 6970 7320 7061 7261 6d65 7465 720d 0a20  ips parameter.. 
-00039920: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00039930: 2020 2020 2020 2020 2072 656c 6174 696f           relatio
-00039940: 6e73 6869 7073 2e61 7865 730d 0a20 2020  nships.axes..   
-00039950: 2020 2020 2020 2020 2069 735f 6461 7461           is_data
-00039960: 6672 616d 6520 3d20 5472 7565 0d0a 2020  frame = True..  
-00039970: 2020 2020 2020 6578 6365 7074 2041 7474        except Att
-00039980: 7269 6275 7465 4572 726f 723a 0d0a 2020  ributeError:..  
-00039990: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-000399a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000399b0: 7265 6c61 7469 6f6e 7368 6970 732e 7661  relationships.va
-000399c0: 6c75 6573 2829 0d0a 2020 2020 2020 2020  lues()..        
-000399d0: 2020 2020 2020 2020 6973 5f64 6963 7420          is_dict 
-000399e0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-000399f0: 2020 2020 2020 2020 5f72 656c 6174 696f          _relatio
-00039a00: 6e73 6869 705f 6469 6374 203d 207b 7d0d  nship_dict = {}.
-00039a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039a20: 2066 6f72 2063 6869 6c64 5f73 686f 7274   for child_short
-00039a30: 6e61 6d65 2c70 6172 656e 745f 7368 6f72  name,parent_shor
-00039a40: 746e 616d 6520 696e 2072 656c 6174 696f  tname in relatio
-00039a50: 6e73 6869 7073 2e69 7465 6d73 2829 3a0d  nships.items():.
-00039a60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039a70: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00039a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039a90: 2020 205f 7265 6c61 7469 6f6e 7368 6970     _relationship
-00039aa0: 5f64 6963 745b 7061 7265 6e74 5f73 686f  _dict[parent_sho
-00039ab0: 7274 6e61 6d65 5d2e 6170 7065 6e64 2863  rtname].append(c
-00039ac0: 6869 6c64 5f73 686f 7274 6e61 6d65 290d  hild_shortname).
-00039ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00039ae0: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-00039af0: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00039b00: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-00039b10: 7265 6c61 7469 6f6e 7368 6970 5f64 6963  relationship_dic
-00039b20: 745b 7061 7265 6e74 5f73 686f 7274 6e61  t[parent_shortna
-00039b30: 6d65 5d20 3d20 5b63 6869 6c64 5f73 686f  me] = [child_sho
-00039b40: 7274 6e61 6d65 5d0d 0a20 2020 2020 2020  rtname]..       
-00039b50: 2020 2020 2065 7863 6570 7420 4174 7472       except Attr
-00039b60: 6962 7574 6545 7272 6f72 3a0d 0a20 2020  ibuteError:..   
-00039b70: 2020 2020 2020 2020 2020 2020 2069 735f               is_
-00039b80: 6c69 7374 203d 2054 7275 650d 0a20 2020  list = True..   
-00039b90: 2020 2020 2020 2020 2020 2020 205f 7265               _re
-00039ba0: 6c61 7469 6f6e 7368 6970 5f64 6963 7420  lationship_dict 
-00039bb0: 3d20 7b7d 0d0a 2020 2020 2020 2020 2020  = {}..          
-00039bc0: 2020 2020 2020 666f 7220 6368 696c 645f        for child_
-00039bd0: 7368 6f72 746e 616d 652c 7061 7265 6e74  shortname,parent
-00039be0: 5f73 686f 7274 6e61 6d65 2069 6e20 7265  _shortname in re
-00039bf0: 6c61 7469 6f6e 7368 6970 733a 0d0a 2020  lationships:..  
-00039c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039c10: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00039c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039c30: 5f72 656c 6174 696f 6e73 6869 705f 6469  _relationship_di
-00039c40: 6374 5b70 6172 656e 745f 7368 6f72 746e  ct[parent_shortn
-00039c50: 616d 655d 2e61 7070 656e 6428 6368 696c  ame].append(chil
-00039c60: 645f 7368 6f72 746e 616d 6529 0d0a 2020  d_shortname)..  
-00039c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039c80: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-00039c90: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-00039ca0: 2020 2020 2020 2020 2020 2020 5f72 656c              _rel
-00039cb0: 6174 696f 6e73 6869 705f 6469 6374 5b70  ationship_dict[p
-00039cc0: 6172 656e 745f 7368 6f72 746e 616d 655d  arent_shortname]
-00039cd0: 203d 205b 6368 696c 645f 7368 6f72 746e   = [child_shortn
-00039ce0: 616d 655d 0d0a 0d0a 2020 2020 2020 2020  ame]....        
-00039cf0: 6966 2069 735f 6461 7461 6672 616d 653a  if is_dataframe:
-00039d00: 0d0a 2020 2020 2020 2020 2020 2020 5f72  ..            _r
-00039d10: 656c 6174 696f 6e73 6869 705f 6469 6374  elationship_dict
-00039d20: 203d 207b 7d0d 0a20 2020 2020 2020 2020   = {}..         
-00039d30: 2020 2066 6f72 2069 6e64 6578 2c20 6368     for index, ch
-00039d40: 696c 645f 7368 6f72 746e 616d 652c 7061  ild_shortname,pa
-00039d50: 7265 6e74 5f73 686f 7274 6e61 6d65 2069  rent_shortname i
-00039d60: 6e20 7265 6c61 7469 6f6e 7368 6970 735b  n relationships[
-00039d70: 5b27 5368 6f72 7420 4e61 6d65 272c 2750  ['Short Name','P
-00039d80: 6172 656e 7420 5368 6f72 7420 4e61 6d65  arent Short Name
-00039d90: 275d 5d2e 6974 6572 7475 706c 6573 2829  ']].itertuples()
-00039da0: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
-00039db0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00039dc0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-00039dd0: 7265 6c61 7469 6f6e 7368 6970 5f64 6963  relationship_dic
-00039de0: 745b 7061 7265 6e74 5f73 686f 7274 6e61  t[parent_shortna
-00039df0: 6d65 5d2e 6170 7065 6e64 2863 6869 6c64  me].append(child
-00039e00: 5f73 686f 7274 6e61 6d65 290d 0a20 2020  _shortname)..   
-00039e10: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00039e20: 6570 7420 4b65 7945 7272 6f72 3a0d 0a20  ept KeyError:.. 
-00039e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00039e40: 2020 205f 7265 6c61 7469 6f6e 7368 6970     _relationship
-00039e50: 5f64 6963 745b 7061 7265 6e74 5f73 686f  _dict[parent_sho
-00039e60: 7274 6e61 6d65 5d20 3d20 5b63 6869 6c64  rtname] = [child
-00039e70: 5f73 686f 7274 6e61 6d65 5d0d 0a0d 0a20  _shortname].... 
-00039e80: 2020 2020 2020 2023 7072 696e 7428 5f72         #print(_r
-00039e90: 656c 6174 696f 6e73 6869 705f 6469 6374  elationship_dict
-00039ea0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00039eb0: 5f73 6574 5f74 7265 6528 7265 6c61 7469  _set_tree(relati
-00039ec0: 6f6e 7368 6970 5f64 6963 7420 3d20 5f72  onship_dict = _r
-00039ed0: 656c 6174 696f 6e73 6869 705f 6469 6374  elationship_dict
-00039ee0: 2c75 7064 6174 653d 7570 6461 7465 290d  ,update=update).
-00039ef0: 0a0d 0a20 2020 2064 6566 205f 7365 745f  ...    def _set_
-00039f00: 7472 6565 2873 656c 662c 7265 6c61 7469  tree(self,relati
-00039f10: 6f6e 7368 6970 5f64 6963 742c 7570 6461  onship_dict,upda
-00039f20: 7465 293a 0d0a 0d0a 2020 2020 2020 2020  te):....        
-00039f30: 2370 7269 6e74 2827 5f73 6574 5f74 7265  #print('_set_tre
-00039f40: 6520 7b7d 272e 666f 726d 6174 2873 656c  e {}'.format(sel
-00039f50: 662e 7368 6f72 7463 6f64 6529 290d 0a0d  f.shortcode))...
-00039f60: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
-00039f70: 2020 2020 2020 2020 2020 2063 6869 6c64             child
-00039f80: 7265 6e5f 6c69 7374 203d 2072 656c 6174  ren_list = relat
-00039f90: 696f 6e73 6869 705f 6469 6374 5b73 656c  ionship_dict[sel
-00039fa0: 662e 7368 6f72 746e 616d 655d 0d0a 0d0a  f.shortname]....
-00039fb0: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-00039fc0: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
-00039fd0: 2020 2020 2020 7265 7475 726e 0d0a 0d0a        return....
-00039fe0: 2020 2020 2020 2020 6966 206e 6f74 2075          if not u
-00039ff0: 7064 6174 653a 0d0a 2020 2020 2020 2020  pdate:..        
-0003a000: 2020 2020 7365 6c66 2e72 656d 6f76 655f      self.remove_
-0003a010: 6368 696c 6472 656e 2829 0d0a 0d0a 2020  children()....  
-0003a020: 2020 2020 2020 666f 7220 6368 696c 645f        for child_
-0003a030: 7368 6f72 7463 6f64 6520 696e 2063 6869  shortcode in chi
-0003a040: 6c64 7265 6e5f 6c69 7374 3a0d 0a20 2020  ldren_list:..   
-0003a050: 2020 2020 2020 2020 2063 6869 6c64 5f73           child_s
-0003a060: 6520 3d20 5374 7275 6374 7572 6545 6c65  e = StructureEle
-0003a070: 6d65 6e74 2870 6172 656e 745f 7374 7275  ment(parent_stru
-0003a080: 6374 7572 655f 656c 656d 656e 743d 7365  cture_element=se
-0003a090: 6c66 0d0a 2020 2020 2020 2020 2020 2020  lf..            
-0003a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a0b0: 2020 2020 2020 2020 2020 202c 656c 656d             ,elem
-0003a0c0: 656e 7420 3d20 7365 6c66 2e64 696d 656e  ent = self.dimen
-0003a0d0: 7369 6f6e 2e65 6c65 6d65 6e74 735b 6368  sion.elements[ch
-0003a0e0: 696c 645f 7368 6f72 7463 6f64 655d 0d0a  ild_shortcode]..
-0003a0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a110: 2020 2020 2020 202c 6973 5f72 6f6f 743d         ,is_root=
-0003a120: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+00039590: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
+000395a0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+000395b0: 2020 2020 2020 2020 2020 2020 206d 6173               mas
+000395c0: 7465 7265 645f 6368 696c 6472 656e 5f74  tered_children_t
+000395d0: 6f5f 6170 7065 6e64 2e61 7070 656e 6428  o_append.append(
+000395e0: 6368 290d 0a20 2020 2020 2020 2020 2020  ch)..           
+000395f0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00039600: 2020 2020 2020 2020 2349 6620 6e6f 2065          #If no e
+00039610: 6c65 6d65 6e74 7320 7765 7265 2063 7265  lements were cre
+00039620: 6174 6564 2061 7420 616c 6c2c 2064 6f6e  ated at all, don
+00039630: 7427 2073 7065 6e64 2074 696d 6520 646f  t' spend time do
+00039640: 696e 6720 616e 7920 6c6f 6f6b 7570 0d0a  ing any lookup..
+00039650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039660: 6d61 7374 6572 6564 5f63 6869 6c64 7265  mastered_childre
+00039670: 6e5f 746f 5f61 7070 656e 6420 3d20 6368  n_to_append = ch
+00039680: 696c 6472 656e 5f74 6f5f 6170 7065 6e64  ildren_to_append
+00039690: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+000396a0: 2e63 6869 6c64 7265 6e20 2b3d 206d 6173  .children += mas
+000396b0: 7465 7265 645f 6368 696c 6472 656e 5f74  tered_children_t
+000396c0: 6f5f 6170 7065 6e64 0d0a 0d0a 0d0a 2020  o_append......  
+000396d0: 2020 6465 6620 7365 745f 7472 6565 2873    def set_tree(s
+000396e0: 656c 662c 7265 6c61 7469 6f6e 7368 6970  elf,relationship
+000396f0: 732c 7570 6461 7465 3d46 616c 7365 293a  s,update=False):
+00039700: 0d0a 2020 2020 2020 2020 2727 270d 0a20  ..        '''.. 
+00039710: 2020 2020 2020 2053 6574 2061 6c6c 206f         Set all o
+00039720: 6620 7468 6520 7265 6c61 7469 6f6e 7368  f the relationsh
+00039730: 6970 7320 696e 2074 6865 2074 7265 6520  ips in the tree 
+00039740: 6265 6c6f 7720 7468 6973 2053 7472 7563  below this Struc
+00039750: 7475 7265 456c 656d 656e 742e 204f 6c64  tureElement. Old
+00039760: 2072 656c 6174 696f 6e73 6869 7073 2077   relationships w
+00039770: 696c 6c20 6765 7420 7468 726f 776e 2061  ill get thrown a
+00039780: 7761 790d 0a0d 0a20 2020 2020 2020 203a  way....        :
+00039790: 7061 7261 6d20 7265 6c61 7469 6f6e 7368  param relationsh
+000397a0: 6970 733a 2061 206c 6973 7420 6f66 2070  ips: a list of p
+000397b0: 6172 656e 7420 6368 696c 6420 7475 706c  arent child tupl
+000397c0: 6573 2c20 6120 6469 6374 696f 6e61 7279  es, a dictionary
+000397d0: 206f 6620 7b63 6869 6c64 3a70 6172 656e   of {child:paren
+000397e0: 747d 206f 7220 6120 6461 7461 6672 616d  t} or a datafram
+000397f0: 6520 7769 7468 2063 6f6c 756d 6e73 2027  e with columns '
+00039800: 5368 6f72 7420 4e61 6d65 2720 6f72 2027  Short Name' or '
+00039810: 5068 7973 4944 2720 616e 6420 2750 6172  PhysID' and 'Par
+00039820: 656e 7420 5368 6f72 7420 4e61 6d65 2720  ent Short Name' 
+00039830: 6f72 2027 5061 7265 6e74 2050 6879 7349  or 'Parent PhysI
+00039840: 4427 0d0a 2020 2020 2020 2020 3a70 6172  D'..        :par
+00039850: 616d 2075 7064 6174 653a 2069 6620 7365  am update: if se
+00039860: 7420 746f 2054 7275 652c 2074 6865 2073  t to True, the s
+00039870: 7472 7563 7475 7265 2069 7320 7570 6461  tructure is upda
+00039880: 7465 642c 206f 7468 6572 7769 7365 2069  ted, otherwise i
+00039890: 7420 6973 2072 6570 6c61 6365 6420 2864  t is replaced (d
+000398a0: 6566 6175 6c74 290d 0a20 2020 2020 2020  efault)..       
+000398b0: 2027 2727 0d0a 0d0a 2020 2020 2020 2020   '''....        
+000398c0: 6973 5f64 6174 6166 7261 6d65 203d 2046  is_dataframe = F
+000398d0: 616c 7365 0d0a 2020 2020 2020 2020 6973  alse..        is
+000398e0: 5f64 6963 7420 2020 2020 203d 2046 616c  _dict      = Fal
+000398f0: 7365 0d0a 2020 2020 2020 2020 6973 5f6c  se..        is_l
+00039900: 6973 7420 2020 2020 203d 2046 616c 7365  ist      = False
+00039910: 0d0a 0d0a 2020 2020 2020 2020 2352 6576  ....        #Rev
+00039920: 6572 7365 2064 7563 6b74 7970 6520 7468  erse ducktype th
+00039930: 6520 7265 6c61 7469 6f6e 7368 6970 7320  e relationships 
+00039940: 7061 7261 6d65 7465 720d 0a20 2020 2020  parameter..     
+00039950: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00039960: 2020 2020 2072 656c 6174 696f 6e73 6869       relationshi
+00039970: 7073 2e61 7865 730d 0a20 2020 2020 2020  ps.axes..       
+00039980: 2020 2020 2069 735f 6461 7461 6672 616d       is_datafram
+00039990: 6520 3d20 5472 7565 0d0a 2020 2020 2020  e = True..      
+000399a0: 2020 6578 6365 7074 2041 7474 7269 6275    except Attribu
+000399b0: 7465 4572 726f 723a 0d0a 2020 2020 2020  teError:..      
+000399c0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+000399d0: 2020 2020 2020 2020 2020 2020 7265 6c61              rela
+000399e0: 7469 6f6e 7368 6970 732e 7661 6c75 6573  tionships.values
+000399f0: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
+00039a00: 2020 2020 6973 5f64 6963 7420 3d20 5472      is_dict = Tr
+00039a10: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00039a20: 2020 2020 5f72 656c 6174 696f 6e73 6869      _relationshi
+00039a30: 705f 6469 6374 203d 207b 7d0d 0a20 2020  p_dict = {}..   
+00039a40: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00039a50: 2063 6869 6c64 5f73 686f 7274 6e61 6d65   child_shortname
+00039a60: 2c70 6172 656e 745f 7368 6f72 746e 616d  ,parent_shortnam
+00039a70: 6520 696e 2072 656c 6174 696f 6e73 6869  e in relationshi
+00039a80: 7073 2e69 7465 6d73 2829 3a0d 0a20 2020  ps.items():..   
+00039a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039aa0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00039ab0: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00039ac0: 7265 6c61 7469 6f6e 7368 6970 5f64 6963  relationship_dic
+00039ad0: 745b 7061 7265 6e74 5f73 686f 7274 6e61  t[parent_shortna
+00039ae0: 6d65 5d2e 6170 7065 6e64 2863 6869 6c64  me].append(child
+00039af0: 5f73 686f 7274 6e61 6d65 290d 0a20 2020  _shortname)..   
+00039b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039b10: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+00039b20: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00039b30: 2020 2020 2020 2020 2020 205f 7265 6c61             _rela
+00039b40: 7469 6f6e 7368 6970 5f64 6963 745b 7061  tionship_dict[pa
+00039b50: 7265 6e74 5f73 686f 7274 6e61 6d65 5d20  rent_shortname] 
+00039b60: 3d20 5b63 6869 6c64 5f73 686f 7274 6e61  = [child_shortna
+00039b70: 6d65 5d0d 0a20 2020 2020 2020 2020 2020  me]..           
+00039b80: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
+00039b90: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
+00039ba0: 2020 2020 2020 2020 2069 735f 6c69 7374           is_list
+00039bb0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+00039bc0: 2020 2020 2020 2020 205f 7265 6c61 7469           _relati
+00039bd0: 6f6e 7368 6970 5f64 6963 7420 3d20 7b7d  onship_dict = {}
+00039be0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00039bf0: 2020 666f 7220 6368 696c 645f 7368 6f72    for child_shor
+00039c00: 746e 616d 652c 7061 7265 6e74 5f73 686f  tname,parent_sho
+00039c10: 7274 6e61 6d65 2069 6e20 7265 6c61 7469  rtname in relati
+00039c20: 6f6e 7368 6970 733a 0d0a 2020 2020 2020  onships:..      
+00039c30: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00039c40: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00039c50: 2020 2020 2020 2020 2020 2020 5f72 656c              _rel
+00039c60: 6174 696f 6e73 6869 705f 6469 6374 5b70  ationship_dict[p
+00039c70: 6172 656e 745f 7368 6f72 746e 616d 655d  arent_shortname]
+00039c80: 2e61 7070 656e 6428 6368 696c 645f 7368  .append(child_sh
+00039c90: 6f72 746e 616d 6529 0d0a 2020 2020 2020  ortname)..      
+00039ca0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00039cb0: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
+00039cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00039cd0: 2020 2020 2020 2020 5f72 656c 6174 696f          _relatio
+00039ce0: 6e73 6869 705f 6469 6374 5b70 6172 656e  nship_dict[paren
+00039cf0: 745f 7368 6f72 746e 616d 655d 203d 205b  t_shortname] = [
+00039d00: 6368 696c 645f 7368 6f72 746e 616d 655d  child_shortname]
+00039d10: 0d0a 0d0a 2020 2020 2020 2020 6966 2069  ....        if i
+00039d20: 735f 6461 7461 6672 616d 653a 0d0a 2020  s_dataframe:..  
+00039d30: 2020 2020 2020 2020 2020 5f72 656c 6174            _relat
+00039d40: 696f 6e73 6869 705f 6469 6374 203d 207b  ionship_dict = {
+00039d50: 7d0d 0a20 2020 2020 2020 2020 2020 2066  }..            f
+00039d60: 6f72 2069 6e64 6578 2c20 6368 696c 645f  or index, child_
+00039d70: 7368 6f72 746e 616d 652c 7061 7265 6e74  shortname,parent
+00039d80: 5f73 686f 7274 6e61 6d65 2069 6e20 7265  _shortname in re
+00039d90: 6c61 7469 6f6e 7368 6970 735b 5b27 5368  lationships[['Sh
+00039da0: 6f72 7420 4e61 6d65 272c 2750 6172 656e  ort Name','Paren
+00039db0: 7420 5368 6f72 7420 4e61 6d65 275d 5d2e  t Short Name']].
+00039dc0: 6974 6572 7475 706c 6573 2829 3a0d 0a0d  itertuples():...
+00039dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00039de0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00039df0: 2020 2020 2020 2020 2020 205f 7265 6c61             _rela
+00039e00: 7469 6f6e 7368 6970 5f64 6963 745b 7061  tionship_dict[pa
+00039e10: 7265 6e74 5f73 686f 7274 6e61 6d65 5d2e  rent_shortname].
+00039e20: 6170 7065 6e64 2863 6869 6c64 5f73 686f  append(child_sho
+00039e30: 7274 6e61 6d65 290d 0a20 2020 2020 2020  rtname)..       
+00039e40: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00039e50: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
+00039e60: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+00039e70: 7265 6c61 7469 6f6e 7368 6970 5f64 6963  relationship_dic
+00039e80: 745b 7061 7265 6e74 5f73 686f 7274 6e61  t[parent_shortna
+00039e90: 6d65 5d20 3d20 5b63 6869 6c64 5f73 686f  me] = [child_sho
+00039ea0: 7274 6e61 6d65 5d0d 0a0d 0a20 2020 2020  rtname]....     
+00039eb0: 2020 2023 7072 696e 7428 5f72 656c 6174     #print(_relat
+00039ec0: 696f 6e73 6869 705f 6469 6374 290d 0a20  ionship_dict).. 
+00039ed0: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
+00039ee0: 5f74 7265 6528 7265 6c61 7469 6f6e 7368  _tree(relationsh
+00039ef0: 6970 5f64 6963 7420 3d20 5f72 656c 6174  ip_dict = _relat
+00039f00: 696f 6e73 6869 705f 6469 6374 2c75 7064  ionship_dict,upd
+00039f10: 6174 653d 7570 6461 7465 290d 0a0d 0a20  ate=update).... 
+00039f20: 2020 2064 6566 205f 7365 745f 7472 6565     def _set_tree
+00039f30: 2873 656c 662c 7265 6c61 7469 6f6e 7368  (self,relationsh
+00039f40: 6970 5f64 6963 742c 7570 6461 7465 293a  ip_dict,update):
+00039f50: 0d0a 0d0a 2020 2020 2020 2020 2370 7269  ....        #pri
+00039f60: 6e74 2827 5f73 6574 5f74 7265 6520 7b7d  nt('_set_tree {}
+00039f70: 272e 666f 726d 6174 2873 656c 662e 7368  '.format(self.sh
+00039f80: 6f72 7463 6f64 6529 290d 0a0d 0a20 2020  ortcode))....   
+00039f90: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00039fa0: 2020 2020 2020 2063 6869 6c64 7265 6e5f         children_
+00039fb0: 6c69 7374 203d 2072 656c 6174 696f 6e73  list = relations
+00039fc0: 6869 705f 6469 6374 5b73 656c 662e 7368  hip_dict[self.sh
+00039fd0: 6f72 746e 616d 655d 0d0a 0d0a 2020 2020  ortname]....    
+00039fe0: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+00039ff0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+0003a000: 2020 7265 7475 726e 0d0a 0d0a 2020 2020    return....    
+0003a010: 2020 2020 6966 206e 6f74 2075 7064 6174      if not updat
+0003a020: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0003a030: 7365 6c66 2e72 656d 6f76 655f 6368 696c  self.remove_chil
+0003a040: 6472 656e 2829 0d0a 0d0a 2020 2020 2020  dren()....      
+0003a050: 2020 666f 7220 6368 696c 645f 7368 6f72    for child_shor
+0003a060: 7463 6f64 6520 696e 2063 6869 6c64 7265  tcode in childre
+0003a070: 6e5f 6c69 7374 3a0d 0a20 2020 2020 2020  n_list:..       
+0003a080: 2020 2020 2063 6869 6c64 5f73 6520 3d20       child_se = 
+0003a090: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+0003a0a0: 2870 6172 656e 745f 7374 7275 6374 7572  (parent_structur
+0003a0b0: 655f 656c 656d 656e 743d 7365 6c66 0d0a  e_element=self..
+0003a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a0e0: 2020 2020 2020 202c 656c 656d 656e 7420         ,element 
+0003a0f0: 3d20 7365 6c66 2e64 696d 656e 7369 6f6e  = self.dimension
+0003a100: 2e65 6c65 6d65 6e74 735b 6368 696c 645f  .elements[child_
+0003a110: 7368 6f72 7463 6f64 655d 0d0a 2020 2020  shortcode]..    
+0003a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0003a130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003a140: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-0003a150: 0a0d 0a20 2020 2020 2020 2066 6f72 2063  ...        for c
-0003a160: 6820 696e 2073 656c 662e 6368 696c 6472  h in self.childr
-0003a170: 656e 3a0d 0a20 2020 2020 2020 2020 2020  en:..           
-0003a180: 2063 682e 5f73 6574 5f74 7265 6528 7265   ch._set_tree(re
-0003a190: 6c61 7469 6f6e 7368 6970 5f64 6963 743d  lationship_dict=
-0003a1a0: 7265 6c61 7469 6f6e 7368 6970 5f64 6963  relationship_dic
-0003a1b0: 742c 7570 6461 7465 203d 2075 7064 6174  t,update = updat
-0003a1c0: 6529 0d0a 0d0a 2020 2020 6465 6620 7570  e)....    def up
-0003a1d0: 6461 7465 5f74 7265 6528 7365 6c66 2c72  date_tree(self,r
-0003a1e0: 656c 6174 696f 6e73 6869 7073 293a 0d0a  elationships):..
-0003a1f0: 2020 2020 2020 2020 2727 270d 0a20 2020          '''..   
-0003a200: 2020 2020 2041 6464 206e 6577 2072 656c       Add new rel
-0003a210: 6174 696f 6e73 6869 7073 2069 6e20 7468  ationships in th
-0003a220: 6520 7472 6565 2062 656c 6f77 2074 6869  e tree below thi
-0003a230: 7320 5374 7275 6374 7572 6545 6c65 6d65  s StructureEleme
-0003a240: 6e74 2e20 4368 696c 6472 656e 2077 696c  nt. Children wil
-0003a250: 6c20 6265 206d 6f76 6564 2074 6f20 6e65  l be moved to ne
-0003a260: 7720 7061 7265 6e74 732e 204f 7264 6572  w parents. Order
-0003a270: 2077 696c 6c20 6265 2070 7265 7365 7276   will be preserv
-0003a280: 6564 0d0a 0d0a 2020 2020 2020 2020 3a70  ed....        :p
-0003a290: 6172 616d 2072 656c 6174 696f 6e73 6869  aram relationshi
-0003a2a0: 7073 3a20 6120 6c69 7374 206f 6620 7061  ps: a list of pa
-0003a2b0: 7265 6e74 2063 6869 6c64 2074 7570 6c65  rent child tuple
-0003a2c0: 732c 2061 2064 6963 7469 6f6e 6172 7920  s, a dictionary 
-0003a2d0: 6f66 207b 6368 696c 643a 7061 7265 6e74  of {child:parent
-0003a2e0: 7d20 6f72 2061 2064 6174 6166 7261 6d65  } or a dataframe
-0003a2f0: 2077 6974 6820 636f 6c75 6d6e 7320 2753   with columns 'S
-0003a300: 686f 7274 204e 616d 6527 206f 7220 2750  hort Name' or 'P
-0003a310: 6879 7349 4427 2061 6e64 2027 5061 7265  hysID' and 'Pare
-0003a320: 6e74 2053 686f 7274 204e 616d 6527 206f  nt Short Name' o
-0003a330: 7220 2750 6172 656e 7420 5068 7973 4944  r 'Parent PhysID
-0003a340: 270d 0a20 2020 2020 2020 2027 2727 0d0a  '..        '''..
-0003a350: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-0003a360: 6574 5f74 7265 6528 7265 6c61 7469 6f6e  et_tree(relation
-0003a370: 7368 6970 732c 7570 6461 7465 3d54 7275  ships,update=Tru
-0003a380: 6529 0d0a 0d0a 0d0a 2020 2020 6465 6620  e)......    def 
-0003a390: 6162 6469 6361 7465 2873 656c 6629 3a0d  abdicate(self):.
-0003a3a0: 0a20 2020 2020 2020 2027 2727 5265 6d6f  .        '''Remo
-0003a3b0: 7665 2073 656c 6620 6672 6f6d 2061 2068  ve self from a h
-0003a3c0: 6965 7261 7263 6879 2061 6e64 2072 6570  ierarchy and rep
-0003a3d0: 6c61 6365 2073 656c 6620 7769 7468 2063  lace self with c
-0003a3e0: 6869 6c64 7265 6e20 696e 2074 6865 2073  hildren in the s
-0003a3f0: 616d 6520 7370 6f74 0d0a 2020 2020 2020  ame spot..      
-0003a400: 2020 5468 6973 2069 7320 7665 7279 2069    This is very i
-0003a410: 6d70 6f72 7461 6e74 2066 6f72 2066 696c  mportant for fil
-0003a420: 7465 7269 6e67 2c20 6265 6361 7573 6520  tering, because 
-0003a430: 7765 206d 7573 7420 6c65 6176 6520 616e  we must leave an
-0003a440: 2069 6e74 6163 7420 6869 6572 6172 6368   intact hierarch
-0003a450: 7920 7768 656e 2066 696c 7465 7269 6e67  y when filtering
-0003a460: 2c20 616e 6420 7375 6363 6573 7369 7665  , and successive
-0003a470: 6c79 2061 6264 6963 6174 696e 6720 656c  ly abdicating el
-0003a480: 656d 656e 7473 2077 696c 6c20 616c 6c6f  ements will allo
-0003a490: 7720 6368 696c 6472 656e 2074 6f20 7368  w children to sh
-0003a4a0: 7566 666c 6520 7570 0d0a 2020 2020 2020  uffle up..      
-0003a4b0: 2020 2727 270d 0a20 2020 2020 2020 2023    '''..        #
-0003a4c0: 5265 706c 6163 6520 7365 6c66 2077 6974  Replace self wit
-0003a4d0: 6820 6368 696c 6472 656e 2069 6e20 7061  h children in pa
-0003a4e0: 7265 6e74 2065 6c65 6d65 6e74 0d0a 2020  rent element..  
-0003a4f0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0003a500: 662e 6861 735f 6368 696c 6472 656e 3a0d  f.has_children:.
-0003a510: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003a520: 662e 7061 7265 6e74 2e72 656d 6f76 655f  f.parent.remove_
-0003a530: 6368 696c 6428 7365 6c66 290d 0a20 2020  child(self)..   
-0003a540: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-0003a550: 2020 2020 2020 2020 7365 6c66 2e70 6172          self.par
-0003a560: 656e 742e 7265 706c 6163 655f 6368 696c  ent.replace_chil
-0003a570: 6428 6368 696c 645f 7374 7275 6374 7572  d(child_structur
-0003a580: 655f 656c 656d 656e 743d 7365 6c66 2c72  e_element=self,r
-0003a590: 6570 6c61 6365 6d65 6e74 733d 7365 6c66  eplacements=self
-0003a5a0: 2e63 6869 6c64 7265 6e29 0d0a 0d0a 2020  .children)....  
-0003a5b0: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-0003a5c0: 2064 6566 2068 6173 5f63 6869 6c64 7265   def has_childre
-0003a5d0: 6e28 7365 6c66 293a 0d0a 2020 2020 2020  n(self):..      
-0003a5e0: 2020 2727 2749 6620 7468 6973 2053 7472    '''If this Str
-0003a5f0: 7563 7475 7265 456c 656d 656e 7420 6861  uctureElement ha
-0003a600: 7320 6174 206c 6561 7374 206f 6e65 2063  s at least one c
-0003a610: 6869 6c64 5374 7275 6374 7572 6545 6c65  hildStructureEle
-0003a620: 6d65 6e74 2c20 7468 656e 2072 6574 7572  ment, then retur
-0003a630: 6e20 5472 7565 2c20 6f74 6865 7277 6973  n True, otherwis
-0003a640: 6520 7265 7475 726e 7320 4661 6c73 6527  e returns False'
-0003a650: 2727 0d0a 2020 2020 2020 2020 7265 7475  ''..        retu
-0003a660: 726e 206c 656e 2873 656c 662e 5f63 6869  rn len(self._chi
-0003a670: 6c64 5f73 7472 7563 7475 7265 5f65 6c65  ld_structure_ele
-0003a680: 6d65 6e74 7329 203e 2030 0d0a 0d0a 2020  ments) > 0....  
-0003a690: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-0003a6a0: 2064 6566 2069 735f 6c65 6166 2873 656c   def is_leaf(sel
-0003a6b0: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
-0003a6c0: 4966 2074 6869 7320 5374 7275 6374 7572  If this Structur
-0003a6d0: 6545 6c65 6d65 6e74 2068 6173 206e 6f20  eElement has no 
-0003a6e0: 6368 696c 6472 656e 2069 7420 6973 2061  children it is a
-0003a6f0: 2027 6c65 6166 2065 6c65 6d65 6e74 272c   'leaf element',
-0003a700: 2073 6f20 7265 7475 726e 2054 7275 652c   so return True,
-0003a710: 206f 7468 6572 7769 7365 2072 6574 7572   otherwise retur
-0003a720: 6e73 2046 616c 7365 2727 270d 0a20 2020  ns False'''..   
-0003a730: 2020 2020 2072 6574 7572 6e20 6e6f 7420       return not 
-0003a740: 7365 6c66 2e68 6173 5f63 6869 6c64 7265  self.has_childre
-0003a750: 6e0d 0a0d 0a20 2020 2040 7072 6f70 6572  n....    @proper
-0003a760: 7479 0d0a 2020 2020 6465 6620 7061 7265  ty..    def pare
-0003a770: 6e74 2873 656c 6629 3a0d 0a20 2020 2020  nt(self):..     
-0003a780: 2020 2027 2727 5468 6520 5061 7265 6e74     '''The Parent
-0003a790: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
-0003a7a0: 7420 6f66 2074 6869 7320 5374 7275 6374  t of this Struct
-0003a7b0: 7572 6545 6c65 6d65 6e74 2e0d 0a0d 0a20  ureElement..... 
-0003a7c0: 2020 2020 2020 2057 696c 6c20 7265 7475         Will retu
-0003a7d0: 726e 204e 6f6e 6520 6966 2074 6869 7320  rn None if this 
-0003a7e0: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-0003a7f0: 2068 6173 206e 6f20 7061 7265 6e74 2727   has no parent''
-0003a800: 270d 0a0d 0a20 2020 2020 2020 2069 6620  '....        if 
-0003a810: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
-0003a820: 5f70 6172 656e 745f 7374 7275 6374 7572  _parent_structur
-0003a830: 655f 656c 656d 656e 742c 7374 7229 3a0d  e_element,str):.
-0003a840: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0003a850: 7365 2056 616c 7565 4572 726f 720d 0a20  se ValueError.. 
-0003a860: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0003a870: 6c66 2e5f 7061 7265 6e74 5f73 7472 7563  lf._parent_struc
-0003a880: 7475 7265 5f65 6c65 6d65 6e74 0d0a 0d0a  ture_element....
-0003a890: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
-0003a8a0: 2020 2064 6566 2061 6e63 6573 746f 7273     def ancestors
-0003a8b0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0003a8c0: 2027 2727 4765 6e65 7261 746f 7220 7768   '''Generator wh
-0003a8d0: 6963 6820 7969 656c 6473 2065 7665 7279  ich yields every
-0003a8e0: 2070 6172 656e 7420 7570 2074 6f20 7468   parent up to th
-0003a8f0: 6520 726f 6f74 2066 726f 6d20 7468 6973  e root from this
-0003a900: 2065 6c65 6d65 6e74 2727 270d 0a0d 0a20   element'''.... 
-0003a910: 2020 2020 2020 205f 6e65 7874 5f61 6e63         _next_anc
-0003a920: 6573 746f 7220 3d20 7365 6c66 2e70 6172  estor = self.par
-0003a930: 656e 740d 0a20 2020 2020 2020 2069 6620  ent..        if 
-0003a940: 5f6e 6578 745f 616e 6365 7374 6f72 2069  _next_ancestor i
-0003a950: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-0003a960: 2020 2020 2020 2020 2079 6965 6c64 205f           yield _
-0003a970: 6e65 7874 5f61 6e63 6573 746f 720d 0a20  next_ancestor.. 
-0003a980: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-0003a990: 2066 726f 6d20 5f6e 6578 745f 616e 6365   from _next_ance
-0003a9a0: 7374 6f72 2e61 6e63 6573 746f 7273 0d0a  stor.ancestors..
-0003a9b0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-0003a9c0: 0a20 2020 2064 6566 2061 6e63 6573 746f  .    def ancesto
-0003a9d0: 7273 5f73 7472 696e 6728 7365 6c66 293a  rs_string(self):
-0003a9e0: 0d0a 2020 2020 2020 2020 2727 2741 2073  ..        '''A s
-0003a9f0: 7472 696e 672c 2073 696d 696c 6172 2074  tring, similar t
-0003aa00: 6f20 2e70 6174 682c 206f 6620 616c 6c20  o .path, of all 
-0003aa10: 616e 6365 7374 6f72 2053 7472 7563 7475  ancestor Structu
-0003aa20: 7265 456c 656d 656e 7473 2073 686f 7274  reElements short
-0003aa30: 6e61 6d65 7320 7374 6172 7469 6e67 2061  names starting a
-0003aa40: 7420 7468 6520 726f 6f74 2061 6e63 6573  t the root ances
-0003aa50: 746f 7220 5374 7275 6374 7572 6545 6c65  tor StructureEle
-0003aa60: 6d65 6e74 2061 6e64 2073 6570 6572 6174  ment and seperat
-0003aa70: 6564 2077 6974 6820 2720 2d3e 2027 2e20  ed with ' -> '. 
-0003aa80: 446f 6573 206e 6f74 2069 6e63 6c75 6465  Does not include
-0003aa90: 2074 6869 7320 5374 7275 6374 7572 6545   this StructureE
-0003aaa0: 6c65 6d65 6e74 2773 2073 686f 7274 6e61  lement's shortna
-0003aab0: 6d65 2027 2727 0d0a 2020 2020 2020 2020  me '''..        
-0003aac0: 7265 7475 726e 2027 202d 3e20 272e 6a6f  return ' -> '.jo
-0003aad0: 696e 285b 612e 7368 6f72 746e 616d 6520  in([a.shortname 
-0003aae0: 666f 7220 6120 696e 2073 656c 662e 616e  for a in self.an
-0003aaf0: 6365 7374 6f72 735d 5b3a 3a2d 315d 290d  cestors][::-1]).
-0003ab00: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-0003ab10: 0d0a 2020 2020 6465 6620 616e 6365 7374  ..    def ancest
-0003ab20: 6f72 735f 6c6f 6e67 6e61 6d65 5f73 7472  ors_longname_str
-0003ab30: 696e 6728 7365 6c66 293a 0d0a 2020 2020  ing(self):..    
-0003ab40: 2020 2020 2727 2741 2073 7472 696e 672c      '''A string,
-0003ab50: 2073 696d 696c 6172 2074 6f20 2e70 6174   similar to .pat
-0003ab60: 682c 206f 6620 616c 6c20 616e 6365 7374  h, of all ancest
-0003ab70: 6f72 2053 7472 7563 7475 7265 456c 656d  or StructureElem
-0003ab80: 656e 7473 206c 6f6e 676e 616d 6573 2073  ents longnames s
-0003ab90: 7461 7274 696e 6720 6174 2074 6865 2072  tarting at the r
-0003aba0: 6f6f 7420 616e 6365 7374 6f72 2053 7472  oot ancestor Str
-0003abb0: 7563 7475 7265 456c 656d 656e 7420 616e  uctureElement an
-0003abc0: 6420 7365 7065 7261 7465 6420 7769 7468  d seperated with
-0003abd0: 2027 202d 3e20 2720 2727 270d 0a20 2020   ' -> ' '''..   
-0003abe0: 2020 2020 2072 6574 7572 6e20 2720 2d3e       return ' ->
-0003abf0: 2027 2e6a 6f69 6e28 5b61 2e6c 6f6e 676e   '.join([a.longn
-0003ac00: 616d 6520 666f 7220 6120 696e 2073 656c  ame for a in sel
-0003ac10: 662e 616e 6365 7374 6f72 735d 5b3a 3a2d  f.ancestors][::-
-0003ac20: 315d 290d 0a0d 0a20 2020 2040 7072 6f70  1])....    @prop
-0003ac30: 6572 7479 0d0a 2020 2020 6465 6620 7374  erty..    def st
-0003ac40: 7269 6e67 5f74 6f5f 726f 6f74 2873 656c  ring_to_root(sel
-0003ac50: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
-0003ac60: 4120 7374 7269 6e67 2c20 7369 6d69 6c61  A string, simila
-0003ac70: 7220 746f 202e 7061 7468 2c20 6f66 2061  r to .path, of a
-0003ac80: 6c6c 2061 6e63 6573 746f 7220 5374 7275  ll ancestor Stru
-0003ac90: 6374 7572 6545 6c65 6d65 6e74 7320 7368  ctureElements sh
-0003aca0: 6f72 746e 616d 6573 2073 7461 7274 696e  ortnames startin
-0003acb0: 6720 6174 2074 6865 2072 6f6f 7420 616e  g at the root an
-0003acc0: 6365 7374 6f72 2053 7472 7563 7475 7265  cestor Structure
-0003acd0: 456c 656d 656e 7420 616e 6420 7365 7065  Element and sepe
-0003ace0: 7261 7465 6420 7769 7468 2027 202d 3e20  rated with ' -> 
-0003acf0: 272e 204c 6173 7420 7368 6f72 746e 616d  '. Last shortnam
-0003ad00: 6520 6973 2020 7468 6973 2053 7472 7563  e is  this Struc
-0003ad10: 7475 7265 456c 656d 656e 7427 7320 7368  tureElement's sh
-0003ad20: 6f72 746e 616d 6520 2727 270d 0a20 2020  ortname '''..   
-0003ad30: 2020 2020 2072 6574 7572 6e20 2720 2d3e       return ' ->
-0003ad40: 2027 2e6a 6f69 6e28 5b61 2e73 686f 7274   '.join([a.short
-0003ad50: 6e61 6d65 2066 6f72 2061 2069 6e20 7365  name for a in se
-0003ad60: 6c66 2e61 6e63 6573 746f 7273 5d5b 3a3a  lf.ancestors][::
-0003ad70: 2d31 5d2b 5b73 656c 662e 7368 6f72 746e  -1]+[self.shortn
-0003ad80: 616d 655d 290d 0a0d 0a20 2020 2040 7072  ame])....    @pr
-0003ad90: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-0003ada0: 6368 696c 6472 656e 2873 656c 6629 3a0d  children(self):.
-0003adb0: 0a20 2020 2020 2020 2027 2727 5468 6520  .        '''The 
-0003adc0: 6368 696c 6472 656e 206f 6620 7468 6973  children of this
-0003add0: 2027 2727 0d0a 2020 2020 2020 2020 2372   '''..        #r
-0003ade0: 6574 7572 6e20 7468 6520 6d61 6769 6320  eturn the magic 
-0003adf0: 6f62 6a65 6374 2077 6869 6368 2061 6c6c  object which all
-0003ae00: 6f77 7320 6368 696c 6472 656e 2074 6f20  ows children to 
-0003ae10: 6265 2069 6e64 6578 6564 2061 6e64 2069  be indexed and i
-0003ae20: 7465 7261 7465 6420 6f76 6572 0d0a 2020  terated over..  
-0003ae30: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0003ae40: 662e 5f63 6869 6c64 7265 6e0d 0a0d 0a20  f._children.... 
-0003ae50: 2020 2040 6368 696c 6472 656e 2e73 6574     @children.set
-0003ae60: 7465 720d 0a20 2020 2064 6566 2063 6869  ter..    def chi
-0003ae70: 6c64 7265 6e28 7365 6c66 2c76 616c 293a  ldren(self,val):
-0003ae80: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0003ae90: 6e73 7461 6e63 6528 7661 6c2c 5374 7275  nstance(val,Stru
-0003aea0: 6374 7572 6545 6c65 6d65 6e74 4368 696c  ctureElementChil
-0003aeb0: 6472 656e 2920 616e 6420 2876 616c 2e5f  dren) and (val._
-0003aec0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-0003aed0: 7420 6973 204e 6f6e 6520 6f72 2076 616c  t is None or val
-0003aee0: 2e5f 7374 7275 6374 7572 655f 656c 656d  ._structure_elem
-0003aef0: 656e 7420 6973 2073 656c 6629 3a0d 0a20  ent is self):.. 
-0003af00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003af10: 5f63 6869 6c64 7265 6e20 3d20 7661 6c0d  _children = val.
-0003af20: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0003af30: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003af40: 2e5f 6368 696c 6472 656e 2e63 6c65 6172  ._children.clear
-0003af50: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-0003af60: 7365 6c66 2e5f 6368 696c 6472 656e 2e61  self._children.a
-0003af70: 7070 656e 6428 7661 6c29 0d0a 0d0a 2020  ppend(val)....  
-0003af80: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-0003af90: 2064 6566 2064 6573 6365 6e64 616e 7473   def descendants
-0003afa0: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0003afb0: 2027 2727 7265 7475 726e 2061 206d 6167   '''return a mag
-0003afc0: 6963 206f 626a 6563 7420 7768 6963 6820  ic object which 
-0003afd0: 616c 6c6f 7773 2064 6573 6365 6e64 616e  allows descendan
-0003afe0: 7473 2074 6f20 6265 2069 6e64 6578 6564  ts to be indexed
-0003aff0: 2062 7920 7368 6f72 746e 616d 6527 2727   by shortname'''
-0003b000: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003b010: 2073 656c 662e 5f64 6573 6365 6e64 616e   self._descendan
-0003b020: 7473 0d0a 0d0a 2020 2020 4064 6573 6365  ts....    @desce
-0003b030: 6e64 616e 7473 2e73 6574 7465 720d 0a20  ndants.setter.. 
-0003b040: 2020 2064 6566 2064 6573 6365 6e64 616e     def descendan
-0003b050: 7473 2873 656c 662c 7661 6c29 3a0d 0a20  ts(self,val):.. 
-0003b060: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0003b070: 616e 6365 2876 616c 2c5f 5374 7275 6374  ance(val,_Struct
-0003b080: 7572 6545 6c65 6d65 6e74 4465 7363 656e  ureElementDescen
-0003b090: 6461 6e74 7347 6574 7465 7229 3a0d 0a20  dantsGetter):.. 
-0003b0a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0003b0b0: 5f64 6573 6365 6e64 616e 7473 203d 2076  _descendants = v
-0003b0c0: 616c 0d0a 2020 2020 2020 2020 656c 7365  al..        else
-0003b0d0: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-0003b0e0: 5768 656e 2073 6f6d 656f 6e65 2073 6574  When someone set
-0003b0f0: 7320 6465 7363 656e 6461 6e74 7320 746f  s descendants to
-0003b100: 2062 6520 6120 7374 7275 6374 7572 6520   be a structure 
-0003b110: 656c 656d 656e 7420 6f72 206c 6973 7420  element or list 
-0003b120: 6f66 2073 7472 7563 7475 7265 2065 6c65  of structure ele
-0003b130: 6d65 6e74 732c 2074 6865 7920 6172 6520  ments, they are 
-0003b140: 636c 6561 726c 7920 7468 696e 6b69 6e67  clearly thinking
-0003b150: 2061 626f 7574 2073 6574 7469 6e67 2074   about setting t
-0003b160: 6865 2063 6869 6c64 7265 6e0d 0a20 2020  he children..   
-0003b170: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
-0003b180: 6869 6c64 7265 6e2e 636c 6561 7228 290d  hildren.clear().
-0003b190: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0003b1a0: 662e 5f63 6869 6c64 7265 6e2e 6170 7065  f._children.appe
-0003b1b0: 6e64 2876 616c 290d 0a0d 0a20 2020 2023  nd(val)....    #
-0003b1c0: 4070 726f 7065 7274 790d 0a20 2020 2023  @property..    #
-0003b1d0: 6465 6620 6465 7363 656e 6461 6e74 2873  def descendant(s
-0003b1e0: 656c 662c 6974 656d 293a 0d0a 2020 2020  elf,item):..    
-0003b1f0: 2320 2020 2072 6574 7572 6e20 7365 6c66  #    return self
-0003b200: 2e64 6573 6365 6e64 616e 7473 5b69 7465  .descendants[ite
-0003b210: 6d5d 5b30 5d0d 0a0d 0a20 2020 2040 7072  m][0]....    @pr
-0003b220: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-0003b230: 7061 7468 2873 656c 6629 3a0d 0a20 2020  path(self):..   
-0003b240: 2020 2020 2027 2727 526f 7574 6520 6672       '''Route fr
-0003b250: 6f6d 2074 6865 2073 7472 7563 7475 7265  om the structure
-0003b260: 2074 6f20 7468 6973 2053 7472 7563 7475   to this Structu
-0003b270: 7265 456c 656d 656e 740d 0a0d 0a20 2020  reElement....   
-0003b280: 2020 2020 2052 6574 7572 6e73 2061 2073       Returns a s
-0003b290: 7472 696e 6720 7769 7468 2074 6865 2053  tring with the S
-0003b2a0: 7472 7563 7475 7265 2073 686f 7274 6e61  tructure shortna
-0003b2b0: 6d65 2c20 7468 656e 2061 2064 6f74 2c20  me, then a dot, 
-0003b2c0: 666f 6c6c 6f77 6564 2062 7920 456c 656d  followed by Elem
-0003b2d0: 656e 7420 7368 6f72 746e 616d 6573 2064  ent shortnames d
-0003b2e0: 6f77 6e20 7468 6520 6869 6572 6172 6368  own the hierarch
-0003b2f0: 7920 7365 7061 7261 7465 6420 6279 2066  y separated by f
-0003b300: 6f72 7761 7264 2073 6c61 7368 6573 2e0d  orward slashes..
-0003b310: 0a20 2020 2020 2020 203e 3e3e 206d 795f  .        >>> my_
-0003b320: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-0003b330: 742e 7061 7468 2829 0d0a 2020 2020 2020  t.path()..      
-0003b340: 2020 2753 5041 4d2e 4241 434f 4e2f 4547    'SPAM.BACON/EG
-0003b350: 4753 270d 0a20 2020 2020 2020 2027 2727  GS'..        '''
-0003b360: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0003b370: 662e 7374 7275 6374 7572 6520 6973 204e  f.structure is N
-0003b380: 6f6e 6520 6f72 2073 656c 662e 7374 7275  one or self.stru
-0003b390: 6374 7572 652e 7368 6f72 7463 6f64 6520  cture.shortcode 
-0003b3a0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-0003b3b0: 2020 2020 2020 7265 7475 726e 2027 2e27        return '.'
-0003b3c0: 202b 2027 2f27 2e6a 6f69 6e28 5b61 2e73   + '/'.join([a.s
-0003b3d0: 686f 7274 636f 6465 2066 6f72 2061 2069  hortcode for a i
-0003b3e0: 6e20 7365 6c66 2e61 6e63 6573 746f 7273  n self.ancestors
-0003b3f0: 5d5b 3a3a 2d31 5d2b 5b73 656c 662e 7368  ][::-1]+[self.sh
-0003b400: 6f72 746e 616d 655d 290d 0a20 2020 2020  ortname])..     
-0003b410: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0003b420: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0003b430: 662e 7374 7275 6374 7572 652e 7368 6f72  f.structure.shor
-0003b440: 7463 6f64 6520 2b20 2027 2e27 202b 2027  tcode +  '.' + '
-0003b450: 2f27 2e6a 6f69 6e28 5b61 2e73 686f 7274  /'.join([a.short
-0003b460: 636f 6465 2066 6f72 2061 2069 6e20 7365  code for a in se
-0003b470: 6c66 2e61 6e63 6573 746f 7273 5d5b 3a3a  lf.ancestors][::
-0003b480: 2d31 5d2b 5b73 656c 662e 7368 6f72 746e  -1]+[self.shortn
-0003b490: 616d 655d 290d 0a0d 0a20 2020 2040 7072  ame])....    @pr
-0003b4a0: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-0003b4b0: 6c65 7665 6c28 7365 6c66 293a 0d0a 2020  level(self):..  
-0003b4c0: 2020 2020 2020 2727 2772 6574 7572 6e20        '''return 
-0003b4d0: 7468 6520 7a65 726f 2d62 6173 6564 2064  the zero-based d
-0003b4e0: 6570 7468 206f 6620 7468 6973 2073 7472  epth of this str
-0003b4f0: 7563 7475 7265 2066 726f 6d20 7468 6520  ucture from the 
-0003b500: 726f 6f74 2727 270d 0a20 2020 2020 2020  root'''..       
-0003b510: 2072 6574 7572 6e20 6c65 6e28 6c69 7374   return len(list
-0003b520: 2873 656c 662e 616e 6365 7374 6f72 7329  (self.ancestors)
-0003b530: 290d 0a0d 0a20 2020 2040 7072 6f70 6572  )....    @proper
-0003b540: 7479 0d0a 2020 2020 6465 6620 6465 7074  ty..    def dept
-0003b550: 6873 2873 656c 6629 3a0d 0a20 2020 2020  hs(self):..     
-0003b560: 2020 2027 2727 7265 7475 726e 2061 2064     '''return a d
-0003b570: 6963 7469 6f6e 6172 7920 6f66 2064 6570  ictionary of dep
-0003b580: 7468 7320 2866 726f 6d20 726f 6f74 2920  ths (from root) 
-0003b590: 616e 6420 6c69 7374 206f 6620 5374 7275  and list of Stru
-0003b5a0: 6374 7572 6545 6c65 6d65 6e74 7320 6174  ctureElements at
-0003b5b0: 2074 6861 7420 6465 7074 6827 2727 0d0a   that depth'''..
-0003b5c0: 2020 2020 2020 2020 5f64 6570 7468 7320          _depths 
-0003b5d0: 3d20 7b7d 0d0a 0d0a 2020 2020 2020 2020  = {}....        
-0003b5e0: 666f 7220 7365 2c20 6c65 7665 6c20 696e  for se, level in
-0003b5f0: 2073 656c 662e 7761 6c6b 5f77 6974 685f   self.walk_with_
-0003b600: 6c65 7665 6c73 2829 3a0d 0a20 2020 2020  levels():..     
-0003b610: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-0003b620: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-0003b630: 7265 6e74 5f65 6c65 6d65 6e74 735f 6174  rent_elements_at
-0003b640: 5f74 6869 735f 6465 7074 6820 203d 205f  _this_depth  = _
-0003b650: 6465 7074 6873 5b6c 6576 656c 5d0d 0a20  depths[level].. 
-0003b660: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0003b670: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
-0003b680: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-0003b690: 7265 6e74 5f65 6c65 6d65 6e74 735f 6174  rent_elements_at
-0003b6a0: 5f74 6869 735f 6465 7074 6820 203d 205b  _this_depth  = [
-0003b6b0: 5d0d 0a0d 0a20 2020 2020 2020 2020 2020  ]....           
-0003b6c0: 2063 7572 7265 6e74 5f65 6c65 6d65 6e74   current_element
-0003b6d0: 735f 6174 5f74 6869 735f 6465 7074 682e  s_at_this_depth.
-0003b6e0: 6170 7065 6e64 2873 6529 0d0a 2020 2020  append(se)..    
-0003b6f0: 2020 2020 2020 2020 5f64 6570 7468 735b          _depths[
-0003b700: 6c65 7665 6c5d 203d 2063 7572 7265 6e74  level] = current
-0003b710: 5f65 6c65 6d65 6e74 735f 6174 5f74 6869  _elements_at_thi
-0003b720: 735f 6465 7074 680d 0a0d 0a20 2020 2020  s_depth....     
-0003b730: 2020 2072 6574 7572 6e20 5f64 6570 7468     return _depth
-0003b740: 730d 0a0d 0a20 2020 2040 7072 6f70 6572  s....    @proper
-0003b750: 7479 0d0a 2020 2020 6465 6620 7368 616c  ty..    def shal
-0003b760: 6c6f 776e 6573 7365 7328 7365 6c66 293a  lownesses(self):
-0003b770: 0d0a 2020 2020 2020 2020 2727 2772 6574  ..        '''ret
-0003b780: 7572 6e20 6120 6469 6374 696f 6e61 7279  urn a dictionary
-0003b790: 206f 6620 7368 616c 6c6f 776e 6573 7365   of shallownesse
-0003b7a0: 7320 2866 726f 6d20 6c65 6166 2920 616e  s (from leaf) an
-0003b7b0: 6420 6c69 7374 206f 6620 5374 7275 6374  d list of Struct
-0003b7c0: 7572 6545 6c65 6d65 6e74 7320 6174 2074  ureElements at t
-0003b7d0: 6861 7420 6465 7074 6827 2727 0d0a 0d0a  hat depth'''....
-0003b7e0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0003b7f0: 662e 6973 5f6c 6561 663a 0d0a 2020 2020  f.is_leaf:..    
-0003b800: 2020 2020 2020 2020 2352 6574 7572 6e20          #Return 
-0003b810: 7368 616c 6c6f 776e 6573 7320 6f66 2073  shallowness of s
-0003b820: 656c 6620 2869 2e65 2e20 3029 2061 6e64  elf (i.e. 0) and
-0003b830: 2061 206c 6973 7420 6f66 2073 7472 7563   a list of struc
-0003b840: 7475 7265 2065 6c65 6d65 6e74 7320 6174  ture elements at
-0003b850: 2074 6869 7320 7368 616c 6c6f 776e 6573   this shallownes
-0003b860: 7320 2869 2e65 2e20 5b73 656c 665d 2920  s (i.e. [self]) 
-0003b870: 696e 2061 2064 6963 7469 6f6e 6172 790d  in a dictionary.
-0003b880: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0003b890: 7572 6e20 7b30 3a5b 7365 6c66 5d7d 0d0a  urn {0:[self]}..
-0003b8a0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0003b8b0: 2020 2020 2020 2020 2020 205f 7368 616c             _shal
-0003b8c0: 6c6f 776e 6573 7365 7320 3d20 7b7d 0d0a  lownesses = {}..
-0003b8d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0003b8e0: 6368 2069 6e20 7365 6c66 2e63 6869 6c64  ch in self.child
-0003b8f0: 7265 6e3a 0d0a 2020 2020 2020 2020 2020  ren:..          
-0003b900: 2020 2020 2020 666f 7220 7368 616c 6c6f        for shallo
-0003b910: 776e 6573 732c 206c 6973 745f 6f66 5f73  wness, list_of_s
-0003b920: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-0003b930: 7320 696e 2063 682e 7368 616c 6c6f 776e  s in ch.shallown
-0003b940: 6573 7365 732e 6974 656d 7328 293a 0d0a  esses.items():..
-0003b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b960: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-0003b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003b980: 2020 6375 7272 656e 745f 656c 656d 656e    current_elemen
-0003b990: 7473 5f61 745f 7468 6973 5f73 6861 6c6c  ts_at_this_shall
-0003b9a0: 6f77 6e65 7373 2020 3d20 5f73 6861 6c6c  owness  = _shall
-0003b9b0: 6f77 6e65 7373 6573 5b73 6861 6c6c 6f77  ownesses[shallow
-0003b9c0: 6e65 7373 5d0d 0a20 2020 2020 2020 2020  ness]..         
-0003b9d0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0003b9e0: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
-0003b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ba00: 2020 2020 2063 7572 7265 6e74 5f65 6c65       current_ele
-0003ba10: 6d65 6e74 735f 6174 5f74 6869 735f 7368  ments_at_this_sh
-0003ba20: 616c 6c6f 776e 6573 7320 203d 205b 5d0d  allowness  = [].
-0003ba30: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0003ba40: 2020 2020 2020 2063 7572 7265 6e74 5f65         current_e
-0003ba50: 6c65 6d65 6e74 735f 6174 5f74 6869 735f  lements_at_this_
-0003ba60: 7368 616c 6c6f 776e 6573 7320 2b3d 206c  shallowness += l
-0003ba70: 6973 745f 6f66 5f73 7472 7563 7475 7265  ist_of_structure
-0003ba80: 5f65 6c65 6d65 6e74 730d 0a20 2020 2020  _elements..     
-0003ba90: 2020 2020 2020 2020 2020 2020 2020 205f                 _
-0003baa0: 7368 616c 6c6f 776e 6573 7365 735b 7368  shallownesses[sh
-0003bab0: 616c 6c6f 776e 6573 735d 203d 2063 7572  allowness] = cur
-0003bac0: 7265 6e74 5f65 6c65 6d65 6e74 735f 6174  rent_elements_at
-0003bad0: 5f74 6869 735f 7368 616c 6c6f 776e 6573  _this_shallownes
-0003bae0: 730d 0a0d 0a20 2020 2020 2020 2020 2020  s....           
-0003baf0: 2023 576f 726b 206f 7574 2073 6861 6c6c   #Work out shall
-0003bb00: 6f77 6e65 7373 206f 6620 7365 6c66 0d0a  owness of self..
-0003bb10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0003bb20: 5f73 6861 6c6c 6f77 6e65 7373 203d 206c  _shallowness = l
-0003bb30: 656e 285f 7368 616c 6c6f 776e 6573 7365  en(_shallownesse
-0003bb40: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-0003bb50: 2341 6464 2073 656c 6620 746f 205f 7368  #Add self to _sh
-0003bb60: 616c 6c6f 776e 6573 7365 730d 0a20 2020  allownesses..   
-0003bb70: 2020 2020 2020 2020 205f 7368 616c 6c6f           _shallo
-0003bb80: 776e 6573 7365 735b 7365 6c66 5f73 6861  wnesses[self_sha
-0003bb90: 6c6c 6f77 6e65 7373 5d20 3d20 5b73 656c  llowness] = [sel
-0003bba0: 665d 0d0a 0d0a 2020 2020 2020 2020 2020  f]....          
-0003bbb0: 2020 7265 7475 726e 205f 7368 616c 6c6f    return _shallo
-0003bbc0: 776e 6573 7365 730d 0a0d 0a20 2020 2064  wnesses....    d
-0003bbd0: 6566 2077 616c 6b28 7365 6c66 2c6c 6576  ef walk(self,lev
-0003bbe0: 656c 3d4e 6f6e 652c 7065 726d 6973 7369  el=None,permissi
-0003bbf0: 7665 3d54 7275 6529 3a0d 0a20 2020 2020  ve=True):..     
-0003bc00: 2020 2027 2727 0d0a 2020 2020 2020 2020     '''..        
-0003bc10: 5669 7369 7420 6576 6572 7920 6465 7363  Visit every desc
-0003bc20: 656e 6461 6e74 2065 6c65 6d65 6e74 2069  endant element i
-0003bc30: 6e20 6120 5374 7275 6374 7572 6520 656c  n a Structure el
-0003bc40: 656d 656e 7420 696e 2074 7572 6e2e 0d0a  ement in turn...
-0003bc50: 2020 2020 2020 2020 5468 6520 7472 6565          The tree
-0003bc60: 2069 7320 7472 6176 6572 7365 6420 6465   is traversed de
-0003bc70: 7074 682d 6669 7273 742c 2077 6974 6820  pth-first, with 
-0003bc80: 7468 6520 6669 7273 7420 6368 696c 6420  the first child 
-0003bc90: 6f66 2074 6865 2066 6972 7374 2063 6869  of the first chi
-0003bca0: 6c64 206f 6620 7468 6520 6669 7273 7420  ld of the first 
-0003bcb0: 6368 696c 6420 6265 696e 6720 7669 7369  child being visi
-0003bcc0: 7465 6420 6265 666f 7265 2074 6865 2073  ted before the s
-0003bcd0: 6563 6f6e 6420 6368 696c 6420 6f66 2074  econd child of t
-0003bce0: 6865 2066 6972 7374 2063 6869 6c64 206f  he first child o
-0003bcf0: 6620 7468 6520 6669 7273 7420 6368 696c  f the first chil
-0003bd00: 6420 6973 2076 6973 6974 6564 0d0a 0d0a  d is visited....
-0003bd10: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
-0003bd20: 6576 656c 3a20 4465 7072 6563 6174 6564  evel: Deprecated
-0003bd30: 202d 2064 6f20 6e6f 7420 7365 7420 7468   - do not set th
-0003bd40: 6973 0d0a 2020 2020 2020 2020 3a70 6172  is..        :par
-0003bd50: 616d 2070 6572 6d69 7373 6976 653a 2044  am permissive: D
-0003bd60: 6570 7265 6361 7465 640d 0a20 2020 2020  eprecated..     
-0003bd70: 2020 2027 2727 0d0a 2020 2020 2020 2020     '''..        
-0003bd80: 6966 206c 6576 656c 3d3d 4e6f 6e65 3a0d  if level==None:.
-0003bd90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0003bda0: 6e6f 7420 7065 726d 6973 7369 7665 3a0d  not permissive:.
-0003bdb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003bdc0: 2061 7373 6572 7420 7365 6c66 2e69 735f   assert self.is_
-0003bdd0: 726f 6f74 0d0a 0d0a 2020 2020 2020 2020  root....        
-0003bde0: 2020 2020 6c65 7665 6c3d 300d 0a0d 0a20      level=0.... 
-0003bdf0: 2020 2020 2020 2079 6965 6c64 2073 656c         yield sel
-0003be00: 660d 0a0d 0a20 2020 2020 2020 2023 5059  f....        #PY
-0003be10: 4d2d 3635 202d 2069 6620 7765 2064 6f6e  M-65 - if we don
-0003be20: 2774 2063 7265 6174 6520 6120 6c69 7374  't create a list
-0003be30: 2068 6572 652c 2063 616c 6c73 2074 6f20   here, calls to 
-0003be40: 6765 745f 656c 656d 656e 7473 2077 6974  get_elements wit
-0003be50: 6869 6e20 7468 6520 7761 6c6b 2063 6175  hin the walk cau
-0003be60: 7365 2065 6172 6c79 2074 6572 6d69 6e61  se early termina
-0003be70: 7469 6f6e 202d 206e 6f74 2073 7572 6520  tion - not sure 
-0003be80: 7768 7920 7468 6973 2066 6978 6573 2069  why this fixes i
-0003be90: 740d 0a20 2020 2020 2020 2066 6f72 2065  t..        for e
-0003bea0: 2069 6e20 6c69 7374 2873 656c 662e 6368   in list(self.ch
-0003beb0: 696c 6472 656e 293a 0d0a 2020 2020 2020  ildren):..      
-0003bec0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-0003bed0: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
-0003bee0: 6420 6672 6f6d 2065 2e77 616c 6b28 6c65  d from e.walk(le
-0003bef0: 7665 6c3d 6c65 7665 6c2b 312c 7065 726d  vel=level+1,perm
-0003bf00: 6973 7369 7665 3d70 6572 6d69 7373 6976  issive=permissiv
-0003bf10: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0003bf20: 6578 6365 7074 2052 6563 7572 7369 6f6e  except Recursion
-0003bf30: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-0003bf40: 2020 2020 2020 2020 2357 6527 7665 2067          #We've g
-0003bf50: 6f6e 6520 746f 6f20 6465 6570 2c20 7468  one too deep, th
-0003bf60: 6572 6520 6d75 7374 2062 6520 736f 6d65  ere must be some
-0003bf70: 2073 6f72 7420 6f66 206c 6f6f 7020 696e   sort of loop in
-0003bf80: 2074 6865 2068 6965 7261 7263 6879 0d0a   the hierarchy..
-0003bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003bfa0: 2370 7269 6e74 206f 7574 2074 6865 2070  #print out the p
-0003bfb0: 6172 656e 7473 0d0a 2020 2020 2020 2020  arents..        
-0003bfc0: 2020 2020 2020 2020 656c 3d73 656c 660d          el=self.
-0003bfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003bfe0: 206c 6f67 2e65 7272 6f72 2827 5265 6375   log.error('Recu
-0003bff0: 7273 696f 6e20 6572 726f 722e 2053 686f  rsion error. Sho
-0003c000: 7769 6e67 2065 6c65 6d65 6e74 7320 6d6f  wing elements mo
-0003c010: 7669 6e67 2075 7020 7468 6520 6869 6572  ving up the hier
-0003c020: 6172 6368 792c 2070 6c65 6173 6520 7472  archy, please tr
-0003c030: 7920 746f 2064 6574 6563 7420 6c6f 6f70  y to detect loop
-0003c040: 2c20 616e 6420 6669 7820 6974 2e27 290d  , and fix it.').
-0003c050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0003c060: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0003c070: 3230 293a 0d0a 2020 2020 2020 2020 2020  20):..          
-0003c080: 2020 2020 2020 2020 2020 6c6f 672e 6572            log.er
-0003c090: 726f 7228 2752 6563 7572 7369 6f6e 2065  ror('Recursion e
-0003c0a0: 7272 6f72 2e20 456e 7469 7479 2073 686f  rror. Entity sho
-0003c0b0: 7274 6e61 6d65 3d27 2b65 6c2e 7368 6f72  rtname='+el.shor
-0003c0c0: 746e 616d 652b 2720 7061 7265 6e74 3d27  tname+' parent='
-0003c0d0: 2b72 6570 7228 656c 2e70 6172 656e 7429  +repr(el.parent)
-0003c0e0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0003c0f0: 2020 2020 2020 2065 6c3d 656c 2e70 6172         el=el.par
-0003c100: 656e 740d 0a20 2020 2020 2020 2020 2020  ent..           
-0003c110: 2020 2020 2023 4361 6e27 7420 6a75 7374       #Can't just
-0003c120: 2072 6572 6169 7365 2c20 6f72 2077 6520   reraise, or we 
-0003c130: 7769 6c6c 2072 652d 6361 7463 6820 7468  will re-catch th
-0003c140: 6520 7361 6d65 2072 6563 7572 7369 6f6e  e same recursion
-0003c150: 2065 7272 6f72 2067 6f69 6e67 2062 6163   error going bac
-0003c160: 6b20 7570 2074 6865 2074 7265 6521 0d0a  k up the tree!..
-0003c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c180: 7261 6973 6520 5379 7374 656d 4572 726f  raise SystemErro
-0003c190: 7228 290d 0a0d 0a20 2020 2064 6566 2077  r()....    def w
-0003c1a0: 616c 6b5f 7769 7468 5f6c 6576 656c 7328  alk_with_levels(
-0003c1b0: 7365 6c66 2c6c 6576 656c 3d30 2c70 6572  self,level=0,per
-0003c1c0: 6d69 7373 6976 653d 5472 7565 293a 0d0a  missive=True):..
-0003c1d0: 2020 2020 2020 2020 2727 2759 6965 6c64          '''Yield
-0003c1e0: 2061 6c6c 2065 6c65 6d65 6e74 7320 696e   all elements in
-0003c1f0: 2061 2073 7472 7563 7475 7265 2c20 6265   a structure, be
-0003c200: 6769 6e6e 696e 6720 7769 7468 2074 6865  ginning with the
-0003c210: 2072 6f6f 742e 2041 7420 7468 6520 7361   root. At the sa
-0003c220: 6d65 2074 696d 6520 7969 656c 6420 7468  me time yield th
-0003c230: 6520 6c65 7665 6c20 7468 6174 2077 6520  e level that we 
-0003c240: 6172 6520 696e 2069 6e20 7468 6520 6869  are in in the hi
-0003c250: 6572 6172 6368 792e 0d0a 0d0a 2020 2020  erarchy.....    
-0003c260: 2020 2020 3a70 6172 616d 206c 6576 656c      :param level
-0003c270: 3a20 496e 6974 6961 6c20 6c65 7665 6c20  : Initial level 
-0003c280: 7765 2061 7265 2063 6f75 6e74 696e 6720  we are counting 
-0003c290: 6672 6f6d 2e20 4465 6661 756c 7473 2074  from. Defaults t
-0003c2a0: 6f20 300d 0a20 2020 2020 2020 203a 7061  o 0..        :pa
-0003c2b0: 7261 6d20 7065 726d 6973 7369 7665 3a20  ram permissive: 
-0003c2c0: 4465 7072 6563 6174 6564 0d0a 2020 2020  Deprecated..    
-0003c2d0: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
-0003c2e0: 2079 6965 6c64 2073 656c 662c 206c 6576   yield self, lev
-0003c2f0: 656c 0d0a 0d0a 2020 2020 2020 2020 2350  el....        #P
-0003c300: 594d 2d36 3520 2d20 6966 2077 6520 646f  YM-65 - if we do
-0003c310: 6e27 7420 6372 6561 7465 2061 206c 6973  n't create a lis
-0003c320: 7420 6865 7265 2c20 6361 6c6c 7320 746f  t here, calls to
-0003c330: 2067 6574 5f65 6c65 6d65 6e74 7320 7769   get_elements wi
-0003c340: 7468 696e 2074 6865 2077 616c 6b20 6361  thin the walk ca
-0003c350: 7573 6520 6561 726c 7920 7465 726d 696e  use early termin
-0003c360: 6174 696f 6e20 2d20 6e6f 7420 7375 7265  ation - not sure
-0003c370: 2077 6879 2074 6869 7320 6669 7865 7320   why this fixes 
-0003c380: 6974 0d0a 2020 2020 2020 2020 666f 7220  it..        for 
-0003c390: 6520 696e 206c 6973 7428 7365 6c66 2e63  e in list(self.c
-0003c3a0: 6869 6c64 7265 6e29 3a0d 0a20 2020 2020  hildren):..     
-0003c3b0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-0003c3c0: 2020 2020 2020 2020 2020 2020 2079 6965               yie
-0003c3d0: 6c64 2066 726f 6d20 652e 7761 6c6b 5f77  ld from e.walk_w
-0003c3e0: 6974 685f 6c65 7665 6c73 286c 6576 656c  ith_levels(level
-0003c3f0: 3d6c 6576 656c 2b31 2c70 6572 6d69 7373  =level+1,permiss
-0003c400: 6976 653d 7065 726d 6973 7369 7665 290d  ive=permissive).
-0003c410: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-0003c420: 6570 7420 5265 6375 7273 696f 6e45 7272  ept RecursionErr
-0003c430: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-0003c440: 2020 2020 2023 5765 2776 6520 676f 6e65       #We've gone
-0003c450: 2074 6f6f 2064 6565 702c 2074 6865 7265   too deep, there
-0003c460: 206d 7573 7420 6265 2073 6f6d 6520 736f   must be some so
-0003c470: 7274 206f 6620 6c6f 6f70 2069 6e20 7468  rt of loop in th
-0003c480: 6520 6869 6572 6172 6368 790d 0a20 2020  e hierarchy..   
-0003c490: 2020 2020 2020 2020 2020 2020 2023 7072               #pr
-0003c4a0: 696e 7420 6f75 7420 7468 6520 7061 7265  int out the pare
-0003c4b0: 6e74 730d 0a20 2020 2020 2020 2020 2020  nts..           
-0003c4c0: 2020 2020 2065 6c3d 7365 6c66 0d0a 2020       el=self..  
-0003c4d0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0003c4e0: 672e 6572 726f 7228 2752 6563 7572 7369  g.error('Recursi
-0003c4f0: 6f6e 2065 7272 6f72 2e20 5368 6f77 696e  on error. Showin
-0003c500: 6720 656c 656d 656e 7473 206d 6f76 696e  g elements movin
-0003c510: 6720 7570 2074 6865 2068 6965 7261 7263  g up the hierarc
-0003c520: 6879 2c20 706c 6561 7365 2074 7279 2074  hy, please try t
-0003c530: 6f20 6465 7465 6374 206c 6f6f 702c 2061  o detect loop, a
-0003c540: 6e64 2066 6978 2069 742e 2729 0d0a 2020  nd fix it.')..  
-0003c550: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0003c560: 7220 6920 696e 2072 616e 6765 2832 3029  r i in range(20)
-0003c570: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0003c580: 2020 2020 2020 206c 6f67 2e65 7272 6f72         log.error
-0003c590: 2827 5265 6375 7273 696f 6e20 6572 726f  ('Recursion erro
-0003c5a0: 722e 2045 6e74 6974 7920 7368 6f72 746e  r. Entity shortn
-0003c5b0: 616d 653d 272b 656c 2e73 686f 7274 6e61  ame='+el.shortna
-0003c5c0: 6d65 2b27 2070 6172 656e 743d 272b 7265  me+' parent='+re
-0003c5d0: 7072 2865 6c2e 7061 7265 6e74 2929 0d0a  pr(el.parent))..
-0003c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003c5f0: 2020 2020 656c 3d65 6c2e 7061 7265 6e74      el=el.parent
-0003c600: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003c610: 2020 2343 616e 2774 206a 7573 7420 7265    #Can't just re
-0003c620: 7261 6973 652c 206f 7220 7765 2077 696c  raise, or we wil
-0003c630: 6c20 7265 2d63 6174 6368 2074 6865 2073  l re-catch the s
-0003c640: 616d 6520 7265 6375 7273 696f 6e20 6572  ame recursion er
-0003c650: 726f 7220 676f 696e 6720 6261 636b 2075  ror going back u
-0003c660: 7020 7468 6520 7472 6565 210d 0a20 2020  p the tree!..   
-0003c670: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0003c680: 7365 2053 7973 7465 6d45 7272 6f72 2829  se SystemError()
-0003c690: 0d0a 0d0a 2020 2020 6465 6620 7761 6c6b  ....    def walk
-0003c6a0: 5f73 7562 7472 6565 2873 656c 662c 7375  _subtree(self,su
-0003c6b0: 6274 7265 655f 7368 6f72 746e 616d 652c  btree_shortname,
-0003c6c0: 2070 6572 6d69 7373 6976 653d 5472 7565   permissive=True
-0003c6d0: 293a 0d0a 2020 2020 2020 2020 2727 2757  ):..        '''W
-0003c6e0: 616c 6b20 6120 7472 6565 2073 7461 7274  alk a tree start
-0003c6f0: 696e 6720 6174 2073 656c 6620 2861 2072  ing at self (a r
-0003c700: 6f6f 7420 6e6f 6465 2920 7265 7475 726e  oot node) return
-0003c710: 696e 6720 6f6e 6c79 2074 6865 2073 7562  ing only the sub
-0003c720: 2d74 7265 6520 7370 6563 6966 6965 6420  -tree specified 
-0003c730: 6279 2074 6865 2073 686f 7274 6e61 6d65  by the shortname
-0003c740: 0d0a 0d0a 2020 2020 2020 2020 3a70 6172  ....        :par
-0003c750: 616d 2073 7562 7472 6565 5f73 686f 7274  am subtree_short
-0003c760: 6e61 6d65 3a20 456d 706f 7765 7220 5368  name: Empower Sh
-0003c770: 6f72 7420 4e61 6d65 206f 6620 7468 6520  ort Name of the 
-0003c780: 5374 7275 6374 7572 6520 456c 656d 656e  Structure Elemen
-0003c790: 7420 7765 2077 616e 7420 746f 2073 7461  t we want to sta
-0003c7a0: 7274 2079 6965 6c64 696e 6720 6974 656d  rt yielding item
-0003c7b0: 7320 6672 6f6d 0d0a 2020 2020 2020 2020  s from..        
-0003c7c0: 3a70 6172 616d 2070 6572 6d69 7373 6976  :param permissiv
-0003c7d0: 653a 2049 6620 7765 206b 6e6f 7720 7468  e: If we know th
-0003c7e0: 6174 2077 6520 6861 7665 2061 6e20 756e  at we have an un
-0003c7f0: 616d 6269 6775 6f75 7320 656c 656d 656e  ambiguous elemen
-0003c800: 7420 7468 656e 2064 6f20 6e6f 7420 6173  t then do not as
-0003c810: 7365 7274 2074 6861 7420 7765 2061 7265  sert that we are
-0003c820: 2075 7369 6e67 2061 2072 6f6f 7420 6e6f   using a root no
-0003c830: 6465 202d 2074 6869 7320 6973 2065 7370  de - this is esp
-0003c840: 6563 6961 6c6c 7920 676f 6f64 2069 6e20  ecially good in 
-0003c850: 6765 745f 6c65 6176 6573 2829 2077 6865  get_leaves() whe
-0003c860: 6e20 7765 2064 6f6e 2774 2063 6172 650d  n we don't care.
-0003c870: 0a20 2020 2020 2020 2027 2727 0d0a 0d0a  .        '''....
-0003c880: 2020 2020 2020 2020 2343 616e 206f 6e6c          #Can onl
-0003c890: 7920 6265 2063 616c 6c65 6420 6672 6f6d  y be called from
-0003c8a0: 2061 2072 6f6f 7420 6e6f 6465 202d 2074   a root node - t
-0003c8b0: 6869 7320 6176 6f69 6473 2074 6865 2072  his avoids the r
-0003c8c0: 6574 7572 6e65 6420 7375 6274 7265 6520  eturned subtree 
-0003c8d0: 6265 696e 6720 616d 6269 6775 6f75 732c  being ambiguous,
-0003c8e0: 2073 696e 6365 2073 686f 7274 6e61 6d65   since shortname
-0003c8f0: 7320 6d61 7920 6170 7065 6172 2069 6e20  s may appear in 
-0003c900: 6d6f 7265 2074 6861 6e20 6120 7369 6e67  more than a sing
-0003c910: 6c65 2074 7265 6520 696e 2074 6865 2073  le tree in the s
-0003c920: 7472 7563 7475 7265 0d0a 2020 2020 2020  tructure..      
-0003c930: 2020 2348 6f77 6576 6572 2073 696e 6365    #However since
-0003c940: 2077 6520 736f 6d65 7469 6d65 7320 6b6e   we sometimes kn
-0003c950: 6f77 2074 6865 2073 7472 7563 7475 7265  ow the structure
-0003c960: 2065 6c65 6d65 6e74 2077 6520 6172 6520   element we are 
-0003c970: 6361 6c6c 696e 6720 6672 6f6d 2c20 7765  calling from, we
-0003c980: 2061 6c6c 6f77 2074 6869 7320 746f 2062   allow this to b
-0003c990: 6520 7065 726d 6973 7369 7665 0d0a 2020  e permissive..  
-0003c9a0: 2020 2020 2020 6966 206e 6f74 2070 6572        if not per
-0003c9b0: 6d69 7373 6976 653a 0d0a 2020 2020 2020  missive:..      
-0003c9c0: 2020 2020 2020 6173 7365 7274 2073 656c        assert sel
-0003c9d0: 662e 6973 5f72 6f6f 740d 0a0d 0a20 2020  f.is_root....   
-0003c9e0: 2020 2020 2073 7562 7472 6565 5f73 7461       subtree_sta
-0003c9f0: 7274 5f73 7472 7563 7475 7265 5f65 6c65  rt_structure_ele
-0003ca00: 6d65 6e74 3d4e 6f6e 650d 0a0d 0a20 2020  ment=None....   
-0003ca10: 2020 2020 2066 6f72 2073 6520 696e 2073       for se in s
-0003ca20: 656c 662e 7761 6c6b 2870 6572 6d69 7373  elf.walk(permiss
-0003ca30: 6976 653d 7065 726d 6973 7369 7665 293a  ive=permissive):
-0003ca40: 0d0a 2020 2020 2020 2020 2020 2020 6c6f  ..            lo
-0003ca50: 672e 6465 6275 6728 2777 616c 6b5f 7375  g.debug('walk_su
-0003ca60: 6274 7265 6520 666f 756e 6420 5b27 2b73  btree found ['+s
-0003ca70: 652e 7368 6f72 746e 616d 652b 275d 2069  e.shortname+'] i
-0003ca80: 6e20 7365 6c66 2e77 616c 6b27 290d 0a20  n self.walk').. 
-0003ca90: 2020 2020 2020 2020 2020 2023 4465 7465             #Dete
-0003caa0: 6374 2074 6865 2073 7461 7274 206f 6620  ct the start of 
-0003cab0: 7468 6520 7375 6274 7265 652c 2061 6e64  the subtree, and
-0003cac0: 2072 6563 6f72 6420 7468 6520 6c65 7665   record the leve
-0003cad0: 6c2c 2073 6f20 7765 206b 6e6f 7720 7768  l, so we know wh
-0003cae0: 656e 2077 6520 6172 6520 6578 6974 696e  en we are exitin
-0003caf0: 6720 7468 6520 7375 6274 7265 650d 0a20  g the subtree.. 
-0003cb00: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0003cb10: 2e73 686f 7274 6e61 6d65 3d3d 7375 6274  .shortname==subt
-0003cb20: 7265 655f 7368 6f72 746e 616d 653a 0d0a  ree_shortname:..
-0003cb30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cb40: 6c6f 672e 6465 6275 6728 2777 616c 6b5f  log.debug('walk_
-0003cb50: 7375 6274 7265 6520 666f 756e 6420 5b27  subtree found ['
-0003cb60: 2b73 652e 7368 6f72 746e 616d 652b 275d  +se.shortname+']
-0003cb70: 206d 6174 6368 696e 6720 7061 7261 6d65   matching parame
-0003cb80: 7465 7220 7375 6274 7265 655f 5368 6f72  ter subtree_Shor
-0003cb90: 746e 616d 6520 696e 2073 656c 662e 7761  tname in self.wa
-0003cba0: 6c6b 2729 0d0a 0d0a 2020 2020 2020 2020  lk')....        
-0003cbb0: 2020 2020 2020 2020 6966 2073 7562 7472          if subtr
-0003cbc0: 6565 5f73 7461 7274 5f73 7472 7563 7475  ee_start_structu
-0003cbd0: 7265 5f65 6c65 6d65 6e74 2069 7320 4e6f  re_element is No
-0003cbe0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0003cbf0: 2020 2020 2020 2020 2073 7562 7472 6565           subtree
-0003cc00: 5f73 7461 7274 5f73 7472 7563 7475 7265  _start_structure
-0003cc10: 5f65 6c65 6d65 6e74 3d73 650d 0a20 2020  _element=se..   
-0003cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003cc30: 206c 6f67 2e64 6562 7567 2827 7761 6c6b   log.debug('walk
-0003cc40: 5f73 7562 7472 6565 2073 6574 7469 6e67  _subtree setting
-0003cc50: 2073 7562 7472 6565 2073 7461 7274 2065   subtree start e
-0003cc60: 6c65 6d65 6e74 3a27 2b73 7472 2873 7562  lement:'+str(sub
-0003cc70: 7472 6565 5f73 7461 7274 5f73 7472 7563  tree_start_struc
-0003cc80: 7475 7265 5f65 6c65 6d65 6e74 2929 0d0a  ture_element))..
-0003cc90: 0d0a 2020 2020 2020 2020 2020 2020 2357  ..            #W
-0003cca0: 6869 6c65 2077 6520 6172 6520 7769 7468  hile we are with
-0003ccb0: 696e 2061 2073 7562 7472 6565 2c20 7969  in a subtree, yi
-0003ccc0: 656c 6420 7468 6520 5374 7275 6374 7572  eld the Structur
-0003ccd0: 6545 6c65 6d65 6e74 7320 7769 7468 696e  eElements within
-0003cce0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0003ccf0: 2073 7562 7472 6565 5f73 7461 7274 5f73   subtree_start_s
-0003cd00: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-0003cd10: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-0003cd20: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0003cd30: 5768 656e 2077 6520 7265 7475 726e 2074  When we return t
-0003cd40: 6f20 7468 6520 6c65 7665 6c20 6f66 2074  o the level of t
-0003cd50: 6865 2073 7461 7274 206f 6620 7468 6520  he start of the 
-0003cd60: 7375 6274 7265 6520 286f 7220 6265 6c6f  subtree (or belo
-0003cd70: 7729 2077 6520 6861 7665 2065 7869 7465  w) we have exite
-0003cd80: 6420 7468 6520 7375 6274 7265 652c 2061  d the subtree, a
-0003cd90: 6e64 206d 6179 2073 746f 700d 0a20 2020  nd may stop..   
-0003cda0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0003cdb0: 7365 2e6c 6576 656c 3c3d 7375 6274 7265  se.level<=subtre
-0003cdc0: 655f 7374 6172 745f 7374 7275 6374 7572  e_start_structur
-0003cdd0: 655f 656c 656d 656e 742e 6c65 7665 6c20  e_element.level 
-0003cde0: 616e 6420 7365 2021 3d20 7375 6274 7265  and se != subtre
-0003cdf0: 655f 7374 6172 745f 7374 7275 6374 7572  e_start_structur
-0003ce00: 655f 656c 656d 656e 743a 0d0a 2020 2020  e_element:..    
-0003ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003ce20: 6c6f 672e 6465 6275 6728 2777 616c 6b5f  log.debug('walk_
-0003ce30: 7375 6274 7265 6520 6272 6561 6b69 6e67  subtree breaking
-0003ce40: 2061 7420 7365 3a5b 272b 7365 2e73 686f   at se:['+se.sho
-0003ce50: 7274 6e61 6d65 2b27 5d20 6c65 7665 6c3a  rtname+'] level:
-0003ce60: 272b 7374 7228 7365 2e6c 6576 656c 2929  '+str(se.level))
-0003ce70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0003ce80: 2020 2020 2020 6272 6561 6b0d 0a20 2020        break..   
-0003ce90: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-0003cea0: 2e64 6562 7567 2827 7761 6c6b 5f73 7562  .debug('walk_sub
-0003ceb0: 7472 6565 2079 6965 6c64 696e 6720 5b27  tree yielding ['
-0003cec0: 2b73 652e 7368 6f72 746e 616d 652b 275d  +se.shortname+']
-0003ced0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-0003cee0: 2020 2020 7969 656c 6420 7365 0d0a 0d0a      yield se....
-0003cef0: 0d0a 2020 2020 6465 6620 6173 6365 6e64  ..    def ascend
-0003cf00: 2873 656c 662c 2062 795f 6465 7074 6820  (self, by_depth 
-0003cf10: 3d20 5472 7565 293a 0d0a 2020 2020 2020  = True):..      
-0003cf20: 2020 2727 2754 7261 7665 7273 6520 7472    '''Traverse tr
-0003cf30: 6565 2066 726f 6d20 6c65 6176 6573 2074  ee from leaves t
-0003cf40: 6f20 7472 756e 6b20 2872 6f6f 7429 0d0a  o trunk (root)..
-0003cf50: 0d0a 2020 2020 2020 2020 4279 2064 6570  ..        By dep
-0003cf60: 7468 2064 6574 6572 6d69 6e65 7320 6966  th determines if
-0003cf70: 2074 6865 2070 7269 6d61 7279 2063 6f6e   the primary con
-0003cf80: 7369 6465 7261 7469 6f6e 2069 7320 7468  sideration is th
-0003cf90: 6520 6465 7074 6820 6672 6f6d 2074 6865  e depth from the
-0003cfa0: 2072 6f6f 7420 2862 795f 6465 7074 6820   root (by_depth 
-0003cfb0: 3d20 5472 7565 2920 6f72 2074 6865 2073  = True) or the s
-0003cfc0: 6861 6c6c 6f77 6e65 7373 2066 726f 6d20  hallowness from 
-0003cfd0: 7468 6520 6c65 6176 6573 0d0a 0d0a 2020  the leaves....  
-0003cfe0: 2020 2020 2020 4368 696c 6472 656e 2061        Children a
-0003cff0: 6c77 6179 7320 6765 7420 7265 7475 726e  lways get return
-0003d000: 6564 2062 6566 6f72 6520 7061 7265 6e74  ed before parent
-0003d010: 732c 2062 7574 2069 6620 6279 5f64 6570  s, but if by_dep
-0003d020: 7468 2069 7320 5472 7565 2c20 6120 6c65  th is True, a le
-0003d030: 6166 206e 6578 7420 746f 2074 6865 2072  af next to the r
-0003d040: 6f6f 7420 6765 7473 2072 6574 7572 6e65  oot gets returne
-0003d050: 6420 6c61 7465 722c 2069 6620 4661 6c73  d later, if Fals
-0003d060: 6520 6120 6c65 6166 206e 6578 7420 746f  e a leaf next to
-0003d070: 2074 6865 2072 6f6f 7420 7769 6c6c 2062   the root will b
-0003d080: 6520 7265 7475 726e 6564 2065 6172 6c69  e returned earli
-0003d090: 6572 0d0a 0d0a 2020 2020 2020 2020 3a70  er....        :p
-0003d0a0: 6172 616d 2062 795f 6465 7074 683a 2054  aram by_depth: T
-0003d0b0: 7275 6520 6966 2074 6865 2064 6973 7461  rue if the dista
-0003d0c0: 6e63 6520 6672 6f6d 2074 6865 2072 6f6f  nce from the roo
-0003d0d0: 7420 6973 2075 7365 6420 746f 2064 6574  t is used to det
-0003d0e0: 6572 6d69 6e65 206f 7264 6572 696e 672c  ermine ordering,
-0003d0f0: 2046 616c 7365 2069 6620 6469 7374 616e   False if distan
-0003d100: 6365 2066 726f 6d20 7468 6520 6c65 6166  ce from the leaf
-0003d110: 2028 692e 652e 2073 6861 6c6c 6f77 6e65   (i.e. shallowne
-0003d120: 7373 2920 6973 2075 7365 6420 746f 2064  ss) is used to d
-0003d130: 6574 6572 6d69 6e65 206f 7264 6572 696e  etermine orderin
-0003d140: 670d 0a20 2020 2020 2020 2027 2727 0d0a  g..        '''..
-0003d150: 2020 2020 2020 2020 6966 2062 795f 6465          if by_de
-0003d160: 7074 683a 0d0a 2020 2020 2020 2020 2020  pth:..          
-0003d170: 2020 6465 7074 6873 5f61 735f 6c69 7374    depths_as_list
-0003d180: 5f6f 665f 7475 706c 6573 203d 205b 286b  _of_tuples = [(k
-0003d190: 2c76 2920 666f 7220 6b2c 7620 696e 2073  ,v) for k,v in s
-0003d1a0: 656c 662e 6465 7074 6873 2e69 7465 6d73  elf.depths.items
-0003d1b0: 2829 205d 0d0a 2020 2020 2020 2020 2020  () ]..          
-0003d1c0: 2020 6465 7074 6873 5f61 735f 6c69 7374    depths_as_list
-0003d1d0: 5f6f 665f 7475 706c 6573 2e73 6f72 7428  _of_tuples.sort(
-0003d1e0: 7265 7665 7273 6520 3d20 5472 7565 290d  reverse = True).
-0003d1f0: 0a0d 0a20 2020 2020 2020 2020 2020 2066  ...            f
-0003d200: 6f72 2064 6570 7468 2c20 7374 7275 6374  or depth, struct
-0003d210: 7572 655f 656c 656d 656e 7473 2069 6e20  ure_elements in 
-0003d220: 6465 7074 6873 5f61 735f 6c69 7374 5f6f  depths_as_list_o
-0003d230: 665f 7475 706c 6573 3a0d 0a20 2020 2020  f_tuples:..     
-0003d240: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-0003d250: 6520 696e 2073 7472 7563 7475 7265 5f65  e in structure_e
-0003d260: 6c65 6d65 6e74 733a 0d0a 2020 2020 2020  lements:..      
-0003d270: 2020 2020 2020 2020 2020 2020 2020 7969                yi
-0003d280: 656c 6420 7365 0d0a 0d0a 2020 2020 2020  eld se....      
-0003d290: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-0003d2a0: 2020 2020 2064 6570 7468 735f 6173 5f6c       depths_as_l
-0003d2b0: 6973 745f 6f66 5f74 7570 6c65 7320 3d20  ist_of_tuples = 
-0003d2c0: 5b28 6b2c 7629 2066 6f72 206b 2c76 2069  [(k,v) for k,v i
-0003d2d0: 6e20 7365 6c66 2e73 6861 6c6c 6f77 6e65  n self.shallowne
-0003d2e0: 7373 6573 2e69 7465 6d73 2829 205d 0d0a  sses.items() ]..
-0003d2f0: 2020 2020 2020 2020 2020 2020 6465 7074              dept
-0003d300: 6873 5f61 735f 6c69 7374 5f6f 665f 7475  hs_as_list_of_tu
-0003d310: 706c 6573 2e73 6f72 7428 290d 0a0d 0a20  ples.sort().... 
-0003d320: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-0003d330: 6861 6c6c 6f77 6e65 7373 2c20 7374 7275  hallowness, stru
-0003d340: 6374 7572 655f 656c 656d 656e 7473 2069  cture_elements i
-0003d350: 6e20 6465 7074 6873 5f61 735f 6c69 7374  n depths_as_list
-0003d360: 5f6f 665f 7475 706c 6573 3a0d 0a20 2020  _of_tuples:..   
-0003d370: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0003d380: 2073 6520 696e 2073 7472 7563 7475 7265   se in structure
-0003d390: 5f65 6c65 6d65 6e74 733a 0d0a 2020 2020  _elements:..    
-0003d3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003d3b0: 7969 656c 6420 7365 0d0a 0d0a 2020 2020  yield se....    
-0003d3c0: 6465 6620 6465 7363 656e 6428 7365 6c66  def descend(self
-0003d3d0: 2c20 6279 5f64 6570 7468 203d 2054 7275  , by_depth = Tru
-0003d3e0: 6529 3a0d 0a20 2020 2020 2020 2027 2727  e):..        '''
-0003d3f0: 5472 6176 6572 7365 2074 7265 6520 6672  Traverse tree fr
-0003d400: 6f6d 2074 7275 6e6b 2028 726f 6f74 2920  om trunk (root) 
-0003d410: 746f 206c 6561 7665 730d 0a0d 0a20 2020  to leaves....   
-0003d420: 2020 2020 2042 7920 6465 7074 6820 6465       By depth de
-0003d430: 7465 726d 696e 6573 2069 6620 7468 6520  termines if the 
-0003d440: 7072 696d 6172 7920 636f 6e73 6964 6572  primary consider
-0003d450: 6174 696f 6e20 6973 2074 6865 2064 6570  ation is the dep
-0003d460: 7468 2066 726f 6d20 7468 6520 726f 6f74  th from the root
-0003d470: 2028 6279 5f64 6570 7468 203d 2054 7275   (by_depth = Tru
-0003d480: 6529 206f 7220 7468 6520 7368 616c 6c6f  e) or the shallo
-0003d490: 776e 6573 7320 6672 6f6d 2074 6865 206c  wness from the l
-0003d4a0: 6561 7665 730d 0a0d 0a20 2020 2020 2020  eaves....       
-0003d4b0: 2050 6172 656e 7473 2061 6c77 6179 7320   Parents always 
-0003d4c0: 6765 7420 7265 7475 726e 6564 2062 6566  get returned bef
-0003d4d0: 6f72 6520 6368 696c 6472 656e 2c20 6275  ore children, bu
-0003d4e0: 7420 6966 2062 795f 6465 7074 6820 6973  t if by_depth is
-0003d4f0: 2054 7275 652c 2061 206c 6561 6620 6e65   True, a leaf ne
-0003d500: 7874 2074 6f20 7468 6520 726f 6f74 2067  xt to the root g
-0003d510: 6574 7320 7265 7475 726e 6564 2066 6972  ets returned fir
-0003d520: 7374 2c20 6966 2046 616c 7365 2061 206c  st, if False a l
-0003d530: 6561 6620 6e65 7874 2074 6f20 7468 6520  eaf next to the 
-0003d540: 726f 6f74 2077 696c 6c20 6265 2072 6574  root will be ret
-0003d550: 7572 6e65 6420 6c61 7374 0d0a 0d0a 2020  urned last....  
-0003d560: 2020 2020 2020 3a70 6172 616d 2062 795f        :param by_
-0003d570: 6465 7074 683a 2054 7275 6520 6966 2074  depth: True if t
-0003d580: 6865 2064 6973 7461 6e63 6520 6672 6f6d  he distance from
-0003d590: 2074 6865 2072 6f6f 7420 6973 2075 7365   the root is use
-0003d5a0: 6420 746f 2064 6574 6572 6d69 6e65 206f  d to determine o
-0003d5b0: 7264 6572 696e 672c 2046 616c 7365 2069  rdering, False i
-0003d5c0: 6620 6469 7374 616e 6365 2066 726f 6d20  f distance from 
-0003d5d0: 7468 6520 6c65 6166 2028 692e 652e 2073  the leaf (i.e. s
-0003d5e0: 6861 6c6c 6f77 6e65 7373 2920 6973 2075  hallowness) is u
-0003d5f0: 7365 6420 746f 2064 6574 6572 6d69 6e65  sed to determine
-0003d600: 206f 7264 6572 696e 670d 0a20 2020 2020   ordering..     
-0003d610: 2020 2027 2727 0d0a 2020 2020 2020 2020     '''..        
-0003d620: 6966 2062 795f 6465 7074 683a 0d0a 2020  if by_depth:..  
-0003d630: 2020 2020 2020 2020 2020 6465 7074 6873            depths
-0003d640: 5f61 735f 6c69 7374 5f6f 665f 7475 706c  _as_list_of_tupl
-0003d650: 6573 203d 205b 286b 2c76 2920 666f 7220  es = [(k,v) for 
-0003d660: 6b2c 7620 696e 2073 656c 662e 6465 7074  k,v in self.dept
-0003d670: 6873 2e69 7465 6d73 2829 205d 0d0a 2020  hs.items() ]..  
-0003d680: 2020 2020 2020 2020 2020 6465 7074 6873            depths
-0003d690: 5f61 735f 6c69 7374 5f6f 665f 7475 706c  _as_list_of_tupl
-0003d6a0: 6573 2e73 6f72 7428 290d 0a0d 0a20 2020  es.sort()....   
-0003d6b0: 2020 2020 2020 2020 2066 6f72 2064 6570           for dep
-0003d6c0: 7468 2c20 7374 7275 6374 7572 655f 656c  th, structure_el
-0003d6d0: 656d 656e 7473 2069 6e20 6465 7074 6873  ements in depths
-0003d6e0: 5f61 735f 6c69 7374 5f6f 665f 7475 706c  _as_list_of_tupl
-0003d6f0: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
-0003d700: 2020 2020 2066 6f72 2073 6520 696e 2073       for se in s
-0003d710: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-0003d720: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-0003d730: 2020 2020 2020 2020 7969 656c 6420 7365          yield se
-0003d740: 0d0a 0d0a 2020 2020 2020 2020 656c 7365  ....        else
-0003d750: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0003d760: 6861 6c6c 6f77 6e65 7373 6573 5f61 735f  hallownesses_as_
-0003d770: 6c69 7374 5f6f 665f 7475 706c 6573 203d  list_of_tuples =
-0003d780: 205b 286b 2c76 2920 666f 7220 6b2c 7620   [(k,v) for k,v 
-0003d790: 696e 2073 656c 662e 7368 616c 6c6f 776e  in self.shallown
-0003d7a0: 6573 7365 732e 6974 656d 7328 2920 5d0d  esses.items() ].
-0003d7b0: 0a20 2020 2020 2020 2020 2020 2073 6861  .            sha
-0003d7c0: 6c6c 6f77 6e65 7373 6573 5f61 735f 6c69  llownesses_as_li
-0003d7d0: 7374 5f6f 665f 7475 706c 6573 2e73 6f72  st_of_tuples.sor
-0003d7e0: 7428 7265 7665 7273 6520 3d20 5472 7565  t(reverse = True
-0003d7f0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-0003d800: 2066 6f72 2073 6861 6c6c 6f77 6e65 7373   for shallowness
-0003d810: 2c20 7374 7275 6374 7572 655f 656c 656d  , structure_elem
-0003d820: 656e 7473 2069 6e20 7368 616c 6c6f 776e  ents in shallown
-0003d830: 6573 7365 735f 6173 5f6c 6973 745f 6f66  esses_as_list_of
-0003d840: 5f74 7570 6c65 733a 0d0a 2020 2020 2020  _tuples:..      
-0003d850: 2020 2020 2020 2020 2020 666f 7220 7365            for se
-0003d860: 2069 6e20 7374 7275 6374 7572 655f 656c   in structure_el
-0003d870: 656d 656e 7473 3a0d 0a20 2020 2020 2020  ements:..       
-0003d880: 2020 2020 2020 2020 2020 2020 2079 6965               yie
-0003d890: 6c64 2073 650d 0a0d 0a20 2020 2064 6566  ld se....    def
-0003d8a0: 2067 6574 5f73 7562 7472 6565 5f74 7261   get_subtree_tra
-0003d8b0: 6e73 6c61 7469 6f6e 5f64 6628 7365 6c66  nslation_df(self
-0003d8c0: 2c73 7562 7472 6565 5f73 686f 7274 6e61  ,subtree_shortna
-0003d8d0: 6d65 2c63 6f6c 756d 6e5f 7072 6566 6978  me,column_prefix
-0003d8e0: 3d4e 6f6e 652c 2066 6965 6c64 5f73 686f  =None, field_sho
-0003d8f0: 7274 6e61 6d65 3d4e 6f6e 6529 3a0d 0a20  rtname=None):.. 
-0003d900: 2020 2020 2020 2027 2727 5374 6172 7469         '''Starti
-0003d910: 6e67 2061 7420 7365 6c66 2028 6120 726f  ng at self (a ro
-0003d920: 6f74 206e 6f64 6529 2072 6574 7572 6e20  ot node) return 
-0003d930: 6120 7061 6e64 6173 2044 6174 6146 7261  a pandas DataFra
-0003d940: 6d65 206f 6620 7368 6f72 746e 616d 6520  me of shortname 
-0003d950: 616e 6420 7068 7973 6964 7320 666f 7220  and physids for 
-0003d960: 7472 616e 736c 6174 696e 6720 726f 6c6c  translating roll
-0003d970: 7570 7320 666f 7220 7468 6520 7375 622d  ups for the sub-
-0003d980: 7472 6565 2073 7065 6369 6669 6564 2062  tree specified b
-0003d990: 7920 7468 6520 7368 6f72 746e 616d 650d  y the shortname.
-0003d9a0: 0a0d 0a20 2020 2020 2020 2054 6865 2072  ...        The r
-0003d9b0: 6574 7572 6e65 6420 4461 7461 4672 616d  eturned DataFram
-0003d9c0: 6520 7769 6c6c 2068 6176 6520 636f 6c75  e will have colu
-0003d9d0: 6d6e 7320 5b27 5368 6f72 7420 4e61 6d65  mns ['Short Name
-0003d9e0: 272c 2749 4427 2c27 6c65 7665 6c20 6e20  ','ID','level n 
-0003d9f0: 7068 7973 6964 272c 2e2e 2e2c 276c 6576  physid',...,'lev
-0003da00: 656c 206d 2070 6879 7369 6427 5d20 7768  el m physid'] wh
-0003da10: 6572 6520 6c65 7665 6c20 6e20 6973 2074  ere level n is t
-0003da20: 6865 206c 6576 656c 206f 6620 7468 6520  he level of the 
-0003da30: 7375 7070 6c69 6564 2073 7562 7472 6565  supplied subtree
-0003da40: 5f73 686f 7274 6e61 6d65 2070 6172 616d  _shortname param
-0003da50: 6574 6572 0d0a 2020 2020 2020 2020 466f  eter..        Fo
-0003da60: 7220 7368 6f72 746e 616d 6573 2077 6869  r shortnames whi
-0003da70: 6368 2061 7265 206e 6f74 2061 7420 7468  ch are not at th
-0003da80: 6520 6578 7472 656d 6520 6c65 6176 6573  e extreme leaves
-0003da90: 206f 6620 7468 6520 7472 6565 2c20 7468   of the tree, th
-0003daa0: 6520 5b27 6c65 7665 6c20 6d27 5d20 636f  e ['level m'] co
-0003dab0: 6c75 6d6e 2070 6c75 7320 736f 6d65 2068  lumn plus some h
-0003dac0: 6967 6865 7220 6c65 7665 6c73 2077 696c  igher levels wil
-0003dad0: 6c20 6861 7665 2070 6879 7369 6420 3d20  l have physid = 
-0003dae0: 2d32 0d0a 2020 2020 2020 2020 4a6f 696e  -2..        Join
-0003daf0: 696e 6720 7468 6520 4461 7461 4672 616d  ing the DataFram
-0003db00: 6520 7468 6174 2074 6869 7320 6675 6e63  e that this func
-0003db10: 7469 6f6e 2072 6574 7572 6e73 2074 6f20  tion returns to 
-0003db20: 7472 616e 7361 6374 696f 6e61 6c20 6461  transactional da
-0003db30: 7461 2077 696c 6c20 6372 6561 7465 2061  ta will create a
-0003db40: 2064 6174 6166 7261 6d65 2074 6861 7420   dataframe that 
-0003db50: 6361 6e20 6265 2075 7365 6420 6173 2074  can be used as t
-0003db60: 6865 2062 6173 6973 206f 6620 6120 7374  he basis of a st
-0003db70: 616e 6461 7264 2065 7870 6c6f 6465 2061  andard explode a
-0003db80: 6e64 206c 6f61 640d 0a20 2020 2020 2020  nd load..       
-0003db90: 2057 6520 6361 6e20 7573 6520 2753 686f   We can use 'Sho
-0003dba0: 7274 204e 616d 6527 206f 7220 2749 4427  rt Name' or 'ID'
-0003dbb0: 2074 6f20 646f 206f 7572 206a 6f69 6e0d   to do our join.
-0003dbc0: 0a0d 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-0003dbd0: 6d20 7375 6274 7265 655f 7368 6f72 746e  m subtree_shortn
-0003dbe0: 616d 653a 2045 6d70 6f77 6572 2053 686f  ame: Empower Sho
-0003dbf0: 7274 204e 616d 6520 6f66 2074 6865 2053  rt Name of the S
-0003dc00: 7472 7563 7475 7265 2045 6c65 6d65 6e74  tructure Element
-0003dc10: 2077 6520 7761 6e74 2074 6f20 6372 6561   we want to crea
-0003dc20: 7465 2061 2066 6c61 7474 656e 6564 2074  te a flattened t
-0003dc30: 7261 6e73 6c61 7469 6f6e 2062 656c 6f77  ranslation below
-0003dc40: 0d0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
-0003dc50: 6e73 3a20 7061 6e64 6173 2044 6174 6146  ns: pandas DataF
-0003dc60: 7261 6d65 2020 5b27 5368 6f72 7420 4e61  rame  ['Short Na
-0003dc70: 6d65 272c 2749 4427 2c27 6c65 7665 6c20  me','ID','level 
-0003dc80: 6e20 7068 7973 6964 272c 2e2e 2e2c 276c  n physid',...,'l
-0003dc90: 6576 656c 206d 2070 6879 7369 6427 5d0d  evel m physid'].
-0003dca0: 0a20 2020 2020 2020 2027 2727 0d0a 0d0a  .        '''....
-0003dcb0: 2020 2020 2020 2020 2341 206c 6973 7420          #A list 
-0003dcc0: 6f66 2074 7570 6c65 732c 2028 7374 7269  of tuples, (stri
-0003dcd0: 6e67 2c20 6c69 7374 2920 7768 6572 6520  ng, list) where 
-0003dce0: 7468 6520 7374 7269 6e67 2069 7320 7468  the string is th
-0003dcf0: 6520 7368 6f72 746e 616d 6520 616e 6420  e shortname and 
-0003dd00: 7468 6520 6c69 7374 2069 7320 7468 6520  the list is the 
-0003dd10: 7068 7973 6964 7320 6c65 6164 696e 6720  physids leading 
-0003dd20: 6672 6f6d 2074 6865 2072 6f6f 740d 0a20  from the root.. 
-0003dd30: 2020 2020 2020 2023 5468 6973 2077 696c         #This wil
-0003dd40: 6c20 6265 2061 2072 6167 6765 6420 6869  l be a ragged hi
-0003dd50: 6572 6172 6368 7920 2d20 7765 276c 6c20  erarchy - we'll 
-0003dd60: 756e 7261 6720 6974 206c 6174 6572 2062  unrag it later b
-0003dd70: 7920 6164 6469 6e67 202d 3273 2062 6579  y adding -2s bey
-0003dd80: 6f6e 6420 7468 6520 6c65 6176 6573 0d0a  ond the leaves..
-0003dd90: 2020 2020 2020 2020 616c 6c5f 7068 7973          all_phys
-0003dda0: 6964 5f72 6f6f 745f 746f 5f74 6970 5f6c  id_root_to_tip_l
-0003ddb0: 6973 7473 3d5b 5d0d 0a0d 0a20 2020 2020  ists=[]....     
-0003ddc0: 2020 2023 5468 6520 6375 7272 656e 7420     #The current 
-0003ddd0: 726f 6f74 2074 6f20 7469 7020 7068 7973  root to tip phys
-0003dde0: 6964 206c 6973 7420 6973 206d 6169 6e74  id list is maint
-0003ddf0: 6169 6e65 642c 2062 7920 6368 7563 6b69  ained, by chucki
-0003de00: 6e67 206c 6561 7665 7320 6177 6179 2077  ng leaves away w
-0003de10: 6865 6e20 7765 2067 6f20 7570 2074 6865  hen we go up the
-0003de20: 2068 6965 7261 7263 6879 2c20 616e 6420   hierarchy, and 
-0003de30: 6164 6469 6e67 206c 6561 7665 7320 7768  adding leaves wh
-0003de40: 656e 2077 6520 676f 2064 6f77 6e0d 0a20  en we go down.. 
-0003de50: 2020 2020 2020 2023 6375 7272 656e 745f         #current_
-0003de60: 726f 6f74 5f74 6f5f 7469 705f 7068 7973  root_to_tip_phys
-0003de70: 6964 733d 5b5d 0d0a 2020 2020 2020 2020  ids=[]..        
-0003de80: 6375 7272 656e 745f 726f 6f74 5f74 6f5f  current_root_to_
-0003de90: 7469 705f 7374 7275 6374 7572 655f 656c  tip_structure_el
-0003dea0: 656d 656e 7473 3d5b 5d0d 0a20 2020 2020  ements=[]..     
-0003deb0: 2020 2063 7572 7265 6e74 5f6c 6576 656c     current_level
-0003dec0: 3d4e 6f6e 650d 0a20 2020 2020 2020 2070  =None..        p
-0003ded0: 7265 7669 6f75 735f 6c65 7665 6c3d 4e6f  revious_level=No
-0003dee0: 6e65 0d0a 2020 2020 2020 2020 7375 6274  ne..        subt
-0003def0: 7265 655f 7374 6172 745f 6c65 7665 6c3d  ree_start_level=
-0003df00: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
-0003df10: 6c6f 6e67 6573 745f 6c69 7374 5f6c 656e  longest_list_len
-0003df20: 203d 2030 0d0a 0d0a 2020 2020 2020 2020   = 0....        
-0003df30: 2377 616c 6b5f 7375 6274 7265 6520 6361  #walk_subtree ca
-0003df40: 6e20 6f6e 6c79 2062 6520 6361 6c6c 6564  n only be called
-0003df50: 2066 726f 6d20 6120 726f 6f74 206e 6f64   from a root nod
-0003df60: 6520 756e 6c65 7373 2077 6520 6172 6520  e unless we are 
-0003df70: 7265 7475 726e 696e 6720 7468 6520 7768  returning the wh
-0003df80: 6f6c 6520 6f66 2074 6865 2074 7265 6520  ole of the tree 
-0003df90: 2d20 7468 6973 2061 766f 6964 7320 7468  - this avoids th
-0003dfa0: 6520 7265 7475 726e 6564 2073 7562 7472  e returned subtr
-0003dfb0: 6565 2062 6569 6e67 2061 6d62 6967 756f  ee being ambiguo
-0003dfc0: 7573 2c20 7369 6e63 6520 7368 6f72 746e  us, since shortn
-0003dfd0: 616d 6573 206d 6179 2061 7070 6561 7220  ames may appear 
-0003dfe0: 696e 206d 6f72 6520 7468 616e 2061 2073  in more than a s
-0003dff0: 696e 676c 6520 7472 6565 2069 6e20 7468  ingle tree in th
-0003e000: 6520 7374 7275 6374 7572 650d 0a20 2020  e structure..   
-0003e010: 2020 2020 2070 6572 6d69 7373 6976 6520       permissive 
-0003e020: 3d20 7375 6274 7265 655f 7368 6f72 746e  = subtree_shortn
-0003e030: 616d 6520 3d3d 2073 656c 662e 7368 6f72  ame == self.shor
-0003e040: 746e 616d 650d 0a0d 0a20 2020 2020 2020  tname....       
-0003e050: 2066 6f72 2073 6520 696e 2073 656c 662e   for se in self.
-0003e060: 7761 6c6b 5f73 7562 7472 6565 2873 7562  walk_subtree(sub
-0003e070: 7472 6565 5f73 686f 7274 6e61 6d65 2c70  tree_shortname,p
-0003e080: 6572 6d69 7373 6976 653d 7065 726d 6973  ermissive=permis
-0003e090: 7369 7665 293a 0d0a 0d0a 2020 2020 2020  sive):....      
-0003e0a0: 2020 2020 2020 6966 2073 7562 7472 6565        if subtree
-0003e0b0: 5f73 7461 7274 5f6c 6576 656c 2069 7320  _start_level is 
-0003e0c0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0003e0d0: 2020 2020 2020 2073 7562 7472 6565 5f73         subtree_s
-0003e0e0: 7461 7274 5f6c 6576 656c 3d73 652e 6c65  tart_level=se.le
-0003e0f0: 7665 6c0d 0a0d 0a20 2020 2020 2020 2020  vel....         
-0003e100: 2020 2023 5472 696d 2074 6865 206c 6973     #Trim the lis
-0003e110: 7420 6f66 2073 7472 7563 7475 7265 2065  t of structure e
-0003e120: 6c65 6d65 6e74 732c 2074 6f20 6f6e 6c79  lements, to only
-0003e130: 2069 6e63 6c75 6465 2074 6869 7320 6f6e   include this on
-0003e140: 6527 7320 7061 7265 6e74 730d 0a20 2020  e's parents..   
-0003e150: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0003e160: 5f72 6f6f 745f 746f 5f74 6970 5f73 7472  _root_to_tip_str
-0003e170: 7563 7475 7265 5f65 6c65 6d65 6e74 733d  ucture_elements=
-0003e180: 6375 7272 656e 745f 726f 6f74 5f74 6f5f  current_root_to_
-0003e190: 7469 705f 7374 7275 6374 7572 655f 656c  tip_structure_el
-0003e1a0: 656d 656e 7473 5b3a 7365 2e6c 6576 656c  ements[:se.level
-0003e1b0: 2d73 7562 7472 6565 5f73 7461 7274 5f6c  -subtree_start_l
-0003e1c0: 6576 656c 5d0d 0a0d 0a20 2020 2020 2020  evel]....       
-0003e1d0: 2020 2020 2023 6578 7465 6e64 2074 6865       #extend the
-0003e1e0: 206c 6973 7420 6f66 2063 7572 7265 6e74   list of current
-0003e1f0: 5f72 6f6f 745f 746f 5f74 6970 5f73 7472  _root_to_tip_str
-0003e200: 7563 7475 7265 5f65 6c65 6d65 6e74 7320  ucture_elements 
-0003e210: 746f 2069 6e63 6c75 6465 2074 6865 2074  to include the t
-0003e220: 6865 2063 7572 7265 6e74 2065 6c65 6d65  he current eleme
-0003e230: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-0003e240: 6375 7272 656e 745f 726f 6f74 5f74 6f5f  current_root_to_
-0003e250: 7469 705f 7374 7275 6374 7572 655f 656c  tip_structure_el
-0003e260: 656d 656e 7473 2e61 7070 656e 6428 7365  ements.append(se
-0003e270: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-0003e280: 2023 4a41 5420 2d20 636f 6d6d 656e 7465   #JAT - commente
-0003e290: 6420 7468 6973 206f 7574 2032 3031 382d  d this out 2018-
-0003e2a0: 3132 2d31 3420 6265 6361 7573 6520 6669  12-14 because fi
-0003e2b0: 656c 6476 616c 7565 2064 6f65 736e 2774  eldvalue doesn't
-0003e2c0: 2067 6574 2075 7365 640d 0a20 2020 2020   get used..     
-0003e2d0: 2020 2020 2020 2023 6966 2066 6965 6c64         #if field
-0003e2e0: 5f73 686f 7274 6e61 6d65 3a0d 0a20 2020  _shortname:..   
-0003e2f0: 2020 2020 2020 2020 2023 2020 2020 6966           #    if
-0003e300: 2066 6965 6c64 5f73 686f 7274 6e61 6d65   field_shortname
-0003e310: 2069 6e20 5b27 5368 6f72 7420 4e61 6d65   in ['Short Name
-0003e320: 272c 274c 6f6e 6720 4e61 6d65 272c 2749  ','Long Name','I
-0003e330: 4427 5d3a 0d0a 2020 2020 2020 2020 2020  D']:..          
-0003e340: 2020 2320 2020 2020 2020 2023 7765 276c    #        #we'l
-0003e350: 6c20 616c 7265 6164 7920 6861 7665 2074  l already have t
-0003e360: 6865 7365 2066 6965 6c64 7320 7072 6573  hese fields pres
-0003e370: 656e 742c 2064 6f6e 2774 2064 7570 6c69  ent, don't dupli
-0003e380: 6361 7465 2074 6865 6d0d 0a20 2020 2020  cate them..     
-0003e390: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-0003e3a0: 6669 656c 6476 616c 7565 203d 204e 6f6e  fieldvalue = Non
-0003e3b0: 650d 0a20 2020 2020 2020 2020 2020 2023  e..            #
-0003e3c0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-0003e3d0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-0003e3e0: 6669 656c 6476 616c 7565 203d 2073 652e  fieldvalue = se.
-0003e3f0: 6669 656c 6473 5b66 6965 6c64 5f73 686f  fields[field_sho
-0003e400: 7274 6e61 6d65 5d0d 0a20 2020 2020 2020  rtname]..       
-0003e410: 2020 2020 2023 656c 7365 3a0d 0a20 2020       #else:..   
-0003e420: 2020 2020 2020 2020 2023 2020 2020 6669           #    fi
-0003e430: 656c 6476 616c 7565 203d 204e 6f6e 650d  eldvalue = None.
-0003e440: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-0003e450: 4261 7569 6c64 2061 206c 6973 7420 6f66  Bauild a list of
-0003e460: 2072 6f6f 7420 746f 2074 6970 2069 6473   root to tip ids
-0003e470: 2061 6e64 2061 6464 2074 6f20 7468 6520   and add to the 
-0003e480: 7768 6f6c 6520 6c69 7374 2c20 7472 696d  whole list, trim
-0003e490: 6d69 6e67 2074 6f20 6f6e 6c79 2069 6e63  ming to only inc
-0003e4a0: 6c75 6465 2069 6473 206f 6620 6e6f 6e2d  lude ids of non-
-0003e4b0: 7669 7274 7561 6c2c 206e 6f6e 2d67 726f  virtual, non-gro
-0003e4c0: 7570 2065 6c65 6d65 6e74 730d 0a20 2020  up elements..   
-0003e4d0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-0003e4e0: 5f72 6f6f 745f 746f 5f74 6970 5f70 6879  _root_to_tip_phy
-0003e4f0: 7369 6473 203d 205b 5d0d 0a20 2020 2020  sids = []..     
-0003e500: 2020 2020 2020 2066 6f72 2073 655f 6368         for se_ch
-0003e510: 696c 6420 696e 2063 7572 7265 6e74 5f72  ild in current_r
-0003e520: 6f6f 745f 746f 5f74 6970 5f73 7472 7563  oot_to_tip_struc
-0003e530: 7475 7265 5f65 6c65 6d65 6e74 733a 0d0a  ture_elements:..
-0003e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003e550: 234f 6e6c 7920 6164 6420 6e6f 6e2d 6772  #Only add non-gr
-0003e560: 6f75 7020 6e6f 6e20 6361 6c63 756c 6174  oup non calculat
-0003e570: 6564 2065 6c65 6d65 6e74 732c 206f 7220  ed elements, or 
-0003e580: 7765 2065 6e64 2075 7020 6164 6469 6e67  we end up adding
-0003e590: 2075 7020 6120 7768 6f6c 6520 6c6f 6164   up a whole load
-0003e5a0: 206f 6620 6361 6c63 756c 6174 6564 2065   of calculated e
-0003e5b0: 6c65 6d65 6e74 730d 0a20 2020 2020 2020  lements..       
-0003e5c0: 2020 2020 2020 2020 2069 6620 2873 655f           if (se_
-0003e5d0: 6368 696c 642e 6669 656c 6473 5b27 4361  child.fields['Ca
-0003e5e0: 6c63 756c 6174 696f 6e27 5d20 6973 204e  lculation'] is N
-0003e5f0: 6f6e 6520 6f72 2073 655f 6368 696c 642e  one or se_child.
-0003e600: 6669 656c 6473 5b27 4361 6c63 756c 6174  fields['Calculat
-0003e610: 696f 6e20 5374 6174 7573 275d 203d 3d20  ion Status'] == 
-0003e620: 2752 6561 6c27 2920 616e 6420 7365 5f63  'Real') and se_c
-0003e630: 6869 6c64 2e66 6965 6c64 735b 2747 726f  hild.fields['Gro
-0003e640: 7570 204f 6e6c 7927 5d20 6973 204e 6f6e  up Only'] is Non
-0003e650: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0003e660: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-0003e670: 726f 6f74 5f74 6f5f 7469 705f 7068 7973  root_to_tip_phys
-0003e680: 6964 732e 6170 7065 6e64 2873 655f 6368  ids.append(se_ch
-0003e690: 696c 642e 7068 7973 6964 290d 0a20 2020  ild.physid)..   
-0003e6a0: 2020 2020 2020 2020 2061 6c6c 5f70 6879           all_phy
-0003e6b0: 7369 645f 726f 6f74 5f74 6f5f 7469 705f  sid_root_to_tip_
-0003e6c0: 6c69 7374 732e 6170 7065 6e64 2828 6375  lists.append((cu
-0003e6d0: 7272 656e 745f 726f 6f74 5f74 6f5f 7469  rrent_root_to_ti
-0003e6e0: 705f 7068 7973 6964 7329 290d 0a0d 0a20  p_physids)).... 
-0003e6f0: 2020 2020 2020 2020 2020 2023 4b65 6570             #Keep
-0003e700: 2074 7261 636b 206f 6620 7468 6520 6c6f   track of the lo
-0003e710: 6e67 6573 7420 6c69 7374 206c 656e 6774  ngest list lengt
-0003e720: 6820 2d20 7765 276c 6c20 6e65 6564 2074  h - we'll need t
-0003e730: 6869 7320 746f 2070 6164 2074 6865 206f  his to pad the o
-0003e740: 7468 6572 730d 0a20 2020 2020 2020 2020  thers..         
-0003e750: 2020 2069 6620 6c6f 6e67 6573 745f 6c69     if longest_li
-0003e760: 7374 5f6c 656e 203c 206c 656e 2863 7572  st_len < len(cur
-0003e770: 7265 6e74 5f72 6f6f 745f 746f 5f74 6970  rent_root_to_tip
-0003e780: 5f70 6879 7369 6473 293a 0d0a 2020 2020  _physids):..    
-0003e790: 2020 2020 2020 2020 2020 2020 6c6f 6e67              long
-0003e7a0: 6573 745f 6c69 7374 5f6c 656e 203d 206c  est_list_len = l
-0003e7b0: 656e 2863 7572 7265 6e74 5f72 6f6f 745f  en(current_root_
-0003e7c0: 746f 5f74 6970 5f70 6879 7369 6473 290d  to_tip_physids).
-0003e7d0: 0a0d 0a20 2020 2020 2020 2023 4e6f 7720  ...        #Now 
-0003e7e0: 7765 206e 6565 6420 746f 2074 616b 6520  we need to take 
-0003e7f0: 7468 6520 7261 6767 6564 2068 6965 7261  the ragged hiera
-0003e800: 7263 6879 2c20 736f 6d65 7468 696e 6720  rchy, something 
-0003e810: 6c69 6b65 2074 6869 733a 0d0a 2020 2020  like this:..    
-0003e820: 2020 2020 2320 2827 414c 4c27 2c5b 315d      # ('ALL',[1]
-0003e830: 290d 0a20 2020 2020 2020 2023 2028 2758  )..        # ('X
-0003e840: 3032 272c 5b31 2c20 325d 290d 0a20 2020  02',[1, 2])..   
-0003e850: 2020 2020 2023 2028 2758 3033 272c 5b31       # ('X03',[1
-0003e860: 2c20 322c 2033 5d29 0d0a 2020 2020 2020  , 2, 3])..      
-0003e870: 2020 2320 2827 5830 3427 2c5b 312c 2032    # ('X04',[1, 2
-0003e880: 2c20 332c 2034 5d29 0d0a 2020 2020 2020  , 3, 4])..      
-0003e890: 2020 2320 2827 5830 3527 2c5b 312c 2035    # ('X05',[1, 5
-0003e8a0: 5d29 0d0a 2020 2020 2020 2020 2320 2827  ])..        # ('
-0003e8b0: 5830 3627 2c5b 312c 2035 2c20 365d 290d  X06',[1, 5, 6]).
-0003e8c0: 0a20 2020 2020 2020 2023 2028 2758 3037  .        # ('X07
-0003e8d0: 272c 5b31 2c20 352c 2037 5d29 0d0a 2020  ',[1, 5, 7])..  
-0003e8e0: 2020 2020 2020 230d 0a20 2020 2020 2020        #..       
-0003e8f0: 2023 2061 6e64 2074 7572 6e20 6974 2069   # and turn it i
-0003e900: 6e74 6f20 736f 6d65 7468 696e 6720 6c69  nto something li
-0003e910: 6b65 2074 6869 730d 0a20 2020 2020 2020  ke this..       
-0003e920: 2023 0d0a 2020 2020 2020 2020 2320 2827   #..        # ('
-0003e930: 414c 4c27 2c5b 312c 2d32 2c2d 322c 2d32  ALL',[1,-2,-2,-2
-0003e940: 5d29 0d0a 2020 2020 2020 2020 2320 2827  ])..        # ('
-0003e950: 5830 3227 2c5b 312c 2032 2c2d 322c 2d32  X02',[1, 2,-2,-2
-0003e960: 5d29 0d0a 2020 2020 2020 2020 2320 2827  ])..        # ('
-0003e970: 5830 3327 2c5b 312c 2032 2c20 332c 2d32  X03',[1, 2, 3,-2
-0003e980: 5d29 0d0a 2020 2020 2020 2020 2320 2827  ])..        # ('
-0003e990: 5830 3427 2c5b 312c 2032 2c20 332c 2034  X04',[1, 2, 3, 4
-0003e9a0: 5d29 0d0a 2020 2020 2020 2020 2320 2827  ])..        # ('
-0003e9b0: 5830 3527 2c5b 312c 2035 2c2d 322c 2d32  X05',[1, 5,-2,-2
-0003e9c0: 5d29 0d0a 2020 2020 2020 2020 2320 2827  ])..        # ('
-0003e9d0: 5830 3627 2c5b 312c 2035 2c20 362c 2d32  X06',[1, 5, 6,-2
-0003e9e0: 5d29 0d0a 2020 2020 2020 2020 2320 2827  ])..        # ('
-0003e9f0: 5830 3727 2c5b 312c 2035 2c20 372c 2d32  X07',[1, 5, 7,-2
-0003ea00: 5d29 0d0a 2020 2020 2020 2020 230d 0a20  ])..        #.. 
-0003ea10: 2020 2020 2020 2023 2054 6869 7320 6869         # This hi
-0003ea20: 6572 6172 6368 7920 6361 6e20 7468 656e  erarchy can then
-0003ea30: 2062 6520 7475 726e 6564 2069 6e74 6f20   be turned into 
-0003ea40: 736f 6d65 7468 696e 6720 6c69 6b65 2074  something like t
-0003ea50: 6869 732c 2061 6e64 2066 726f 6d20 7468  his, and from th
-0003ea60: 6572 6520 696e 746f 206f 7572 2064 6174  ere into our dat
-0003ea70: 6166 7261 6d65 0d0a 2020 2020 2020 2020  aframe..        
-0003ea80: 230d 0a20 2020 2020 2020 2023 207b 2753  #..        # {'S
-0003ea90: 686f 7274 204e 616d 6527 3a27 414c 4c2c  hort Name':'ALL,
-0003eaa0: 2027 6c65 7665 6c20 3027 3a31 2c20 276c   'level 0':1, 'l
-0003eab0: 6576 656c 2031 273a 2d32 2c20 276c 6576  evel 1':-2, 'lev
-0003eac0: 656c 2032 273a 2d32 2c20 276c 6576 656c  el 2':-2, 'level
-0003ead0: 2033 273a 2d32 207d 0d0a 2020 2020 2020   3':-2 }..      
-0003eae0: 2020 2320 2e2e 2e0d 0a20 2020 2020 2020    # .....       
-0003eaf0: 2023 207b 2753 686f 7274 204e 616d 6527   # {'Short Name'
-0003eb00: 3a27 414c 4c2c 2027 6c65 7665 6c20 3027  :'ALL, 'level 0'
-0003eb10: 3a31 2c20 276c 6576 656c 2031 273a 352c  :1, 'level 1':5,
-0003eb20: 2020 276c 6576 656c 2032 273a 372c 2020    'level 2':7,  
-0003eb30: 276c 6576 656c 2033 273a 2d32 207d 0d0a  'level 3':-2 }..
-0003eb40: 0d0a 2020 2020 2020 2020 2343 7265 6174  ..        #Creat
-0003eb50: 6520 6120 6c69 7374 206f 6620 6469 6374  e a list of dict
-0003eb60: 696f 6e61 7269 6573 2c20 7265 6164 7920  ionaries, ready 
-0003eb70: 666f 7220 7472 616e 7366 6f72 6d61 7469  for transformati
-0003eb80: 6f6e 2069 6e74 6f20 6120 7061 6e64 6173  on into a pandas
-0003eb90: 2044 6174 6146 7261 6d65 0d0a 2020 2020   DataFrame..    
-0003eba0: 2020 2020 6c69 7374 5f6f 665f 6469 6374      list_of_dict
-0003ebb0: 733d 5b5d 0d0a 0d0a 2020 2020 2020 2020  s=[]....        
-0003ebc0: 2357 6520 6e65 6564 2074 6f20 6d61 696e  #We need to main
-0003ebd0: 7461 696e 2061 2072 6563 6f72 6420 6f66  tain a record of
-0003ebe0: 2074 6865 206c 6f77 6573 7420 6c65 7665   the lowest leve
-0003ebf0: 6c2c 2073 6f20 7468 6174 2077 6520 6361  l, so that we ca
-0003ec00: 6e20 6372 6561 7465 2074 6865 206e 616d  n create the nam
-0003ec10: 6573 2077 6974 6820 616e 2061 6363 7572  es with an accur
-0003ec20: 6174 6520 6f72 6465 7269 6e67 0d0a 2020  ate ordering..  
-0003ec30: 2020 2020 2020 6c6f 7765 7374 5f6c 6576        lowest_lev
-0003ec40: 656c 3d4e 6f6e 650d 0a0d 0a20 2020 2020  el=None....     
-0003ec50: 2020 2023 4669 7273 7420 5061 6420 7468     #First Pad th
-0003ec60: 6520 6c69 7374 7320 7769 7468 202d 3220  e lists with -2 
-0003ec70: 2d20 7570 2074 6f20 7468 6520 6c6f 6e67  - up to the long
-0003ec80: 6573 7420 6c65 6e67 7468 0d0a 2020 2020  est length..    
-0003ec90: 2020 2020 666f 7220 7068 7973 6964 5f6c      for physid_l
-0003eca0: 6973 7420 696e 2061 6c6c 5f70 6879 7369  ist in all_physi
-0003ecb0: 645f 726f 6f74 5f74 6f5f 7469 705f 6c69  d_root_to_tip_li
-0003ecc0: 7374 733a 0d0a 2020 2020 2020 2020 2020  sts:..          
-0003ecd0: 2020 2352 6f6f 7420 656c 656d 656e 7473    #Root elements
-0003ece0: 2077 6869 6368 2061 7265 2067 726f 7570   which are group
-0003ecf0: 2077 696c 6c20 6861 7665 2065 6d70 7479   will have empty
-0003ed00: 2070 6879 7369 6420 6c69 7374 7320 2d20   physid lists - 
-0003ed10: 6967 6e6f 7265 2074 6865 7365 0d0a 2020  ignore these..  
-0003ed20: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-0003ed30: 2870 6879 7369 645f 6c69 7374 293d 3d30  (physid_list)==0
-0003ed40: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0003ed50: 2020 2063 6f6e 7469 6e75 650d 0a20 2020     continue..   
-0003ed60: 2020 2020 2020 2020 2023 5265 636f 7264           #Record
-0003ed70: 2074 6865 2070 6879 7369 6420 666f 7220   the physid for 
-0003ed80: 7468 6520 6c65 6166 2065 6c65 6d65 6e74  the leaf element
-0003ed90: 202d 2074 6869 7320 6973 2074 6865 206f   - this is the o
-0003eda0: 6e65 2077 6520 7769 6c6c 2075 7365 2074  ne we will use t
-0003edb0: 6f20 646f 2074 6865 206c 6f6f 6b75 700d  o do the lookup.
-0003edc0: 0a20 2020 2020 2020 2020 2020 2064 6963  .            dic
-0003edd0: 745f 666f 725f 6466 3d7b 2749 4427 3a70  t_for_df={'ID':p
-0003ede0: 6879 7369 645f 6c69 7374 5b2d 315d 7d0d  hysid_list[-1]}.
-0003edf0: 0a0d 0a20 2020 2020 2020 2020 2020 2070  ...            p
-0003ee00: 6879 7369 645f 6c69 7374 2e65 7874 656e  hysid_list.exten
-0003ee10: 6428 5b2d 325d 202a 2028 6c6f 6e67 6573  d([-2] * (longes
-0003ee20: 745f 6c69 7374 5f6c 656e 202d 206c 656e  t_list_len - len
-0003ee30: 2870 6879 7369 645f 6c69 7374 2929 290d  (physid_list))).
-0003ee40: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-0003ee50: 5468 656e 2074 7572 6e20 7468 6520 6c69  Then turn the li
-0003ee60: 7374 2069 6e74 6f20 6120 6469 6374 696f  st into a dictio
-0003ee70: 6e61 7279 2c20 7265 6164 7920 746f 2074  nary, ready to t
-0003ee80: 7572 6e20 696e 746f 2061 2070 616e 6461  urn into a panda
-0003ee90: 7320 4461 7461 4672 616d 650d 0a20 2020  s DataFrame..   
-0003eea0: 2020 2020 2020 2020 2066 6f72 206c 6576           for lev
-0003eeb0: 656c 5f6f 6666 7365 742c 2070 6879 7369  el_offset, physi
-0003eec0: 6420 696e 2065 6e75 6d65 7261 7465 2870  d in enumerate(p
-0003eed0: 6879 7369 645f 6c69 7374 293a 0d0a 2020  hysid_list):..  
-0003eee0: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-0003eef0: 7665 6c5f 746f 5f62 655f 7573 6564 5f69  vel_to_be_used_i
-0003ef00: 6e5f 6e61 6d65 3d6c 6576 656c 5f6f 6666  n_name=level_off
-0003ef10: 7365 742b 7375 6274 7265 655f 7374 6172  set+subtree_star
-0003ef20: 745f 6c65 7665 6c0d 0a0d 0a20 2020 2020  t_level....     
-0003ef30: 2020 2020 2020 2020 2020 2023 4b65 6570             #Keep
-0003ef40: 2074 7261 636b 206f 6620 7468 6520 6c6f   track of the lo
-0003ef50: 7765 7374 206c 6576 656c 2c20 736f 2074  west level, so t
-0003ef60: 6861 7420 7765 2063 616e 2072 6563 7265  hat we can recre
-0003ef70: 6174 6520 636f 6c75 6d6e 206e 616d 6573  ate column names
-0003ef80: 2c20 616e 6420 7468 656e 2067 6574 2074  , and then get t
-0003ef90: 6865 2064 6620 636f 6c75 6d6e 206e 616d  he df column nam
-0003efa0: 6573 2069 6e20 7468 6520 636f 7272 6563  es in the correc
-0003efb0: 7420 6f72 6465 720d 0a20 2020 2020 2020  t order..       
-0003efc0: 2020 2020 2020 2020 2069 6620 6c6f 7765           if lowe
-0003efd0: 7374 5f6c 6576 656c 2069 7320 4e6f 6e65  st_level is None
-0003efe0: 206f 7220 6c65 7665 6c5f 746f 5f62 655f   or level_to_be_
-0003eff0: 7573 6564 5f69 6e5f 6e61 6d65 203c 206c  used_in_name < l
-0003f000: 6f77 6573 745f 6c65 7665 6c3a 0d0a 2020  owest_level:..  
-0003f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0003f020: 2020 6c6f 7765 7374 5f6c 6576 656c 3d6c    lowest_level=l
-0003f030: 6576 656c 5f74 6f5f 6265 5f75 7365 645f  evel_to_be_used_
-0003f040: 696e 5f6e 616d 650d 0a0d 0a20 2020 2020  in_name....     
-0003f050: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
-0003f060: 6e5f 6e61 6d65 3d27 6c65 7665 6c20 272b  n_name='level '+
-0003f070: 7374 7228 6c65 7665 6c5f 746f 5f62 655f  str(level_to_be_
-0003f080: 7573 6564 5f69 6e5f 6e61 6d65 292b 2720  used_in_name)+' 
-0003f090: 7068 7973 6964 270d 0a20 2020 2020 2020  physid'..       
-0003f0a0: 2020 2020 2020 2020 2064 6963 745f 666f           dict_fo
-0003f0b0: 725f 6466 5b63 6f6c 756d 6e5f 6e61 6d65  r_df[column_name
-0003f0c0: 5d3d 7068 7973 6964 0d0a 0d0a 2020 2020  ]=physid....    
-0003f0d0: 2020 2020 2020 2020 6c69 7374 5f6f 665f          list_of_
-0003f0e0: 6469 6374 732e 6170 7065 6e64 2864 6963  dicts.append(dic
-0003f0f0: 745f 666f 725f 6466 290d 0a0d 0a20 2020  t_for_df)....   
-0003f100: 2020 2020 2023 4372 6561 7465 2061 206c       #Create a l
-0003f110: 6973 7420 6f66 2063 6f6c 756d 6e20 6e61  ist of column na
-0003f120: 6d65 7320 696e 2074 6865 2063 6f72 7265  mes in the corre
-0003f130: 6374 206f 7264 6572 202d 2077 6974 686f  ct order - witho
-0003f140: 7574 2074 6869 732c 2074 6865 2064 6174  ut this, the dat
-0003f150: 6166 7261 6d65 2068 6173 2074 6865 2063  aframe has the c
-0003f160: 6f6c 756d 6e20 6e61 6d65 7320 696e 2074  olumn names in t
-0003f170: 6865 2077 726f 6e67 206f 7264 6572 2077  he wrong order w
-0003f180: 6869 6368 2062 7265 616b 7320 6578 706c  hich breaks expl
-0003f190: 6f73 696f 6e20 6c6f 6769 630d 0a20 2020  osion logic..   
-0003f1a0: 2020 2020 206c 6973 745f 6f66 5f63 6f6c       list_of_col
-0003f1b0: 756d 6e73 5f69 6e5f 636f 7272 6563 745f  umns_in_correct_
-0003f1c0: 6f72 6465 723d 5b5d 0d0a 2020 2020 2020  order=[]..      
-0003f1d0: 2020 666f 7220 6e20 696e 2072 616e 6765    for n in range
-0003f1e0: 286c 6f6e 6765 7374 5f6c 6973 745f 6c65  (longest_list_le
-0003f1f0: 6e29 3a0d 0a20 2020 2020 2020 2020 2020  n):..           
-0003f200: 206c 6576 656c 5f74 6f5f 6265 5f75 7365   level_to_be_use
-0003f210: 645f 696e 5f6e 616d 653d 6c6f 7765 7374  d_in_name=lowest
-0003f220: 5f6c 6576 656c 2b6e 0d0a 2020 2020 2020  _level+n..      
-0003f230: 2020 2020 2020 636f 6c75 6d6e 5f6e 616d        column_nam
-0003f240: 653d 276c 6576 656c 2027 2b73 7472 286c  e='level '+str(l
-0003f250: 6576 656c 5f74 6f5f 6265 5f75 7365 645f  evel_to_be_used_
-0003f260: 696e 5f6e 616d 6529 2b27 2070 6879 7369  in_name)+' physi
-0003f270: 6427 0d0a 2020 2020 2020 2020 2020 2020  d'..            
-0003f280: 6c69 7374 5f6f 665f 636f 6c75 6d6e 735f  list_of_columns_
-0003f290: 696e 5f63 6f72 7265 6374 5f6f 7264 6572  in_correct_order
-0003f2a0: 2e61 7070 656e 6428 636f 6c75 6d6e 5f6e  .append(column_n
-0003f2b0: 616d 6529 0d0a 0d0a 2020 2020 2020 2020  ame)....        
-0003f2c0: 6c69 7374 5f6f 665f 636f 6c75 6d6e 735f  list_of_columns_
-0003f2d0: 696e 5f63 6f72 7265 6374 5f6f 7264 6572  in_correct_order
-0003f2e0: 2e72 6576 6572 7365 2829 0d0a 0d0a 2020  .reverse()....  
-0003f2f0: 2020 2020 2020 2347 6574 2061 6e79 2073        #Get any s
-0003f300: 686f 7274 6e61 6d65 2066 6f72 2066 6965  hortname for fie
-0003f310: 6c64 2070 6173 7365 6420 696e 202d 2074  ld passed in - t
-0003f320: 6869 7320 6e65 6564 7320 746f 2062 6520  his needs to be 
-0003f330: 636f 6e76 6572 7465 6420 746f 2061 206c  converted to a l
-0003f340: 6973 7420 746f 206d 616b 6520 6974 2065  ist to make it e
-0003f350: 6173 7920 746f 2063 6f6d 6269 6e65 2077  asy to combine w
-0003f360: 6974 6820 616e 6f74 6865 7220 6c69 7374  ith another list
-0003f370: 202d 2074 6865 2064 6566 6175 6c74 2069   - the default i
-0003f380: 7320 616e 2065 6d70 7479 206c 6973 7420  s an empty list 
-0003f390: 2869 2e65 2e20 6e6f 7468 696e 6720 7761  (i.e. nothing wa
-0003f3a0: 7320 7061 7373 6564 2069 6e29 0d0a 2020  s passed in)..  
-0003f3b0: 2020 2020 2020 6669 656c 6473 686f 7274        fieldshort
-0003f3c0: 6e61 6d65 5f6c 6973 743d 5b5d 0d0a 2020  name_list=[]..  
-0003f3d0: 2020 2020 2020 6966 2066 6965 6c64 5f73        if field_s
-0003f3e0: 686f 7274 6e61 6d65 2061 6e64 2066 6965  hortname and fie
-0003f3f0: 6c64 5f73 686f 7274 6e61 6d65 206e 6f74  ld_shortname not
-0003f400: 2069 6e20 5b27 5368 6f72 7420 4e61 6d65   in ['Short Name
-0003f410: 272c 274c 6f6e 6720 4e61 6d65 272c 2749  ','Long Name','I
-0003f420: 4427 5d3a 0d0a 2020 2020 2020 2020 2020  D']:..          
-0003f430: 2020 6669 656c 6473 686f 7274 6e61 6d65    fieldshortname
-0003f440: 5f6c 6973 743d 5b66 6965 6c64 5f73 686f  _list=[field_sho
-0003f450: 7274 6e61 6d65 5d0d 0a0d 0a20 2020 2020  rtname]....     
-0003f460: 2020 2023 4669 6e61 6c6c 7920 636f 6e76     #Finally conv
-0003f470: 6572 7420 7468 6520 6c69 7374 206f 6620  ert the list of 
-0003f480: 6469 6374 696f 6e61 7269 6573 2069 6e74  dictionaries int
-0003f490: 6f20 6120 7061 6e64 6173 2044 6174 6146  o a pandas DataF
-0003f4a0: 7261 6d65 2c20 6f72 6465 7220 7468 6520  rame, order the 
-0003f4b0: 636f 6c75 6d6e 7320 636f 7272 6563 746c  columns correctl
-0003f4c0: 792c 2072 656e 616d 6520 6173 206e 6563  y, rename as nec
-0003f4d0: 6573 7361 7279 2c20 616e 6420 7265 7475  essary, and retu
-0003f4e0: 726e 0d0a 2020 2020 2020 2020 7265 7475  rn..        retu
-0003f4f0: 726e 5f64 663d 2070 642e 4461 7461 4672  rn_df= pd.DataFr
-0003f500: 616d 6528 6c69 7374 5f6f 665f 6469 6374  ame(list_of_dict
-0003f510: 7329 0d0a 0d0a 2020 2020 2020 2020 2347  s)....        #G
-0003f520: 6574 2073 686f 7274 6e61 6d65 7320 616e  et shortnames an
-0003f530: 6420 736f 206f 6e20 6672 6f6d 2074 6865  d so on from the
-0003f540: 2073 7461 6e64 6172 6420 6461 7461 6672   standard datafr
-0003f550: 616d 650d 0a20 2020 2020 2020 2072 6574  ame..        ret
-0003f560: 7572 6e5f 6466 3d70 642e 6d65 7267 6528  urn_df=pd.merge(
-0003f570: 686f 773d 276c 6566 7427 2c6c 6566 743d  how='left',left=
-0003f580: 7265 7475 726e 5f64 662c 7269 6768 743d  return_df,right=
-0003f590: 7365 6c66 2e73 7472 7563 7475 7265 2e64  self.structure.d
-0003f5a0: 696d 656e 7369 6f6e 2e65 6c65 6d65 6e74  imension.element
-0003f5b0: 732e 6461 7461 6672 616d 652c 6c65 6674  s.dataframe,left
-0003f5c0: 5f6f 6e3d 2749 4427 2c72 6967 6874 5f6f  _on='ID',right_o
-0003f5d0: 6e3d 2749 4427 290d 0a0d 0a20 2020 2020  n='ID')....     
-0003f5e0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-0003f5f0: 2020 2020 2072 6574 7572 6e5f 6466 3d72       return_df=r
-0003f600: 6574 7572 6e5f 6466 5b5b 2749 4427 2c27  eturn_df[['ID','
-0003f610: 5368 6f72 7420 4e61 6d65 272c 274c 6f6e  Short Name','Lon
-0003f620: 6720 4e61 6d65 275d 2b66 6965 6c64 7368  g Name']+fieldsh
-0003f630: 6f72 746e 616d 655f 6c69 7374 2b6c 6973  ortname_list+lis
-0003f640: 745f 6f66 5f63 6f6c 756d 6e73 5f69 6e5f  t_of_columns_in_
-0003f650: 636f 7272 6563 745f 6f72 6465 725d 0d0a  correct_order]..
-0003f660: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-0003f670: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
-0003f680: 2020 2020 2020 7072 696e 7428 7265 7475        print(retu
-0003f690: 726e 5f64 662e 6865 6164 2829 290d 0a20  rn_df.head()).. 
-0003f6a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0003f6b0: 0d0a 0d0a 2020 2020 2020 2020 2357 6520  ....        #We 
-0003f6c0: 7769 6c6c 2068 6176 6520 6120 6c6f 7420  will have a lot 
-0003f6d0: 6f66 2064 6174 6166 7261 6d65 7320 7769  of dataframes wi
-0003f6e0: 7468 2074 6865 2073 616d 6520 636f 6c75  th the same colu
-0003f6f0: 6d6e 206e 616d 6573 2028 6c65 7665 6c20  mn names (level 
-0003f700: 3020 7068 7973 6964 2e2e 2e29 2061 6e64  0 physid...) and
-0003f710: 2073 6f20 6f6e 2c20 736f 2074 6865 7265   so on, so there
-0003f720: 2069 7320 6120 7061 7261 6d65 7465 7220   is a parameter 
-0003f730: 666f 7220 616e 206f 7074 696f 6e61 6c20  for an optional 
-0003f740: 7072 6566 6978 2074 6f20 6469 7361 6d62  prefix to disamb
-0003f750: 6967 7561 7465 206a 6f69 6e65 6420 636f  iguate joined co
-0003f760: 6c75 6d6e 206e 616d 6573 206c 6174 6572  lumn names later
-0003f770: 0d0a 2020 2020 2020 2020 7265 6e61 6d65  ..        rename
-0003f780: 5f64 6963 743d 7b7d 0d0a 2020 2020 2020  _dict={}..      
-0003f790: 2020 6966 2063 6f6c 756d 6e5f 7072 6566    if column_pref
-0003f7a0: 6978 2069 7320 6e6f 7420 4e6f 6e65 3a0d  ix is not None:.
-0003f7b0: 0a20 2020 2020 2020 2020 2020 2023 5265  .            #Re
-0003f7c0: 6e61 6d65 2074 6865 2063 6f6c 756d 6e73  name the columns
-0003f7d0: 2077 6974 6820 7468 6520 7375 7070 6c69   with the suppli
-0003f7e0: 6564 2070 7265 6669 7820 6966 2074 6865  ed prefix if the
-0003f7f0: 7265 2069 7320 6f6e 650d 0a20 2020 2020  re is one..     
-0003f800: 2020 2020 2020 2066 6f72 2063 6f6c 2069         for col i
-0003f810: 6e20 7265 7475 726e 5f64 662e 636f 6c75  n return_df.colu
-0003f820: 6d6e 733a 0d0a 2020 2020 2020 2020 2020  mns:..          
-0003f830: 2020 2020 2020 7265 6e61 6d65 5f64 6963        rename_dic
-0003f840: 745b 636f 6c5d 3d63 6f6c 756d 6e5f 7072  t[col]=column_pr
-0003f850: 6566 6978 2b63 6f6c 0d0a 0d0a 2020 2020  efix+col....    
-0003f860: 2020 2020 7265 7475 726e 5f64 662e 7265      return_df.re
-0003f870: 6e61 6d65 2863 6f6c 756d 6e73 3d72 656e  name(columns=ren
-0003f880: 616d 655f 6469 6374 2c69 6e70 6c61 6365  ame_dict,inplace
-0003f890: 3d54 7275 6529 0d0a 0d0a 2020 2020 2020  =True)....      
-0003f8a0: 2020 7265 7475 726e 2072 6574 7572 6e5f    return return_
-0003f8b0: 6466 0d0a 0d0a 2020 2020 6465 6620 7072  df....    def pr
-0003f8c0: 696e 745f 6869 6572 6172 6368 7928 7365  int_hierarchy(se
-0003f8d0: 6c66 2c70 7265 6669 785f 7374 7269 6e67  lf,prefix_string
-0003f8e0: 203d 2027 272c 636f 756e 7465 7220 3d20   = '',counter = 
-0003f8f0: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
-0003f900: 2727 2744 6570 7265 6361 7465 642c 2055  '''Deprecated, U
-0003f910: 7365 2074 6865 2070 7974 686f 6e20 7072  se the python pr
-0003f920: 696e 7428 2920 6675 6e63 7469 6f6e 2069  int() function i
-0003f930: 6e73 7465 6164 2e0d 0a20 2020 2020 2020  nstead...       
-0003f940: 2050 7269 6e74 7320 6f75 7420 7468 6520   Prints out the 
-0003f950: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-0003f960: 2069 6e20 7465 7874 2066 6f72 6d2e 0d0a   in text form...
-0003f970: 0d0a 2020 2020 2020 2020 3e3e 3e20 7072  ..        >>> pr
-0003f980: 696e 7428 7369 7465 2e64 696d 656e 7369  int(site.dimensi
-0003f990: 6f6e 735b 305d 2e73 7472 7563 7475 7265  ons[0].structure
-0003f9a0: 735b 2753 5041 4d27 5d2e 6869 6572 6172  s['SPAM'].hierar
-0003f9b0: 6368 6965 735b 2745 4747 5327 5d29 0d0a  chies['EGGS'])..
-0003f9c0: 2020 2020 2020 2020 4547 4753 0d0a 2020          EGGS..  
-0003f9d0: 2020 2020 2020 2b2d 4241 434f 4e0d 0a20        +-BACON.. 
-0003f9e0: 2020 2020 2020 2027 2727 0d0a 2020 2020         '''..    
-0003f9f0: 2020 2020 7072 696e 7428 7365 6c66 2e5f      print(self._
-0003fa00: 7265 7072 6573 656e 745f 6869 6572 6172  represent_hierar
-0003fa10: 6368 7928 7072 6566 6978 5f73 7472 696e  chy(prefix_strin
-0003fa20: 6720 3d20 7072 6566 6978 5f73 7472 696e  g = prefix_strin
-0003fa30: 672c 636f 756e 7465 7220 3d20 636f 756e  g,counter = coun
-0003fa40: 7465 7229 290d 0a0d 0a20 2020 2064 6566  ter))....    def
-0003fa50: 205f 5f72 6570 725f 5f28 7365 6c66 293a   __repr__(self):
-0003fa60: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0003fa70: 2027 3c7b 7d20 6f62 6a65 6374 2c20 7368   '<{} object, sh
-0003fa80: 6f72 746e 616d 6520 7b7d 2c20 6c6f 6e67  ortname {}, long
-0003fa90: 6e61 6d65 207b 7d20 6174 207b 7d3e 272e  name {} at {}>'.
-0003faa0: 666f 726d 6174 2873 656c 662e 5f5f 636c  format(self.__cl
-0003fab0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c73  ass__.__name__,s
-0003fac0: 656c 662e 7368 6f72 746e 616d 652c 7365  elf.shortname,se
-0003fad0: 6c66 2e6c 6f6e 676e 616d 652c 6865 7828  lf.longname,hex(
-0003fae0: 6964 2873 656c 6629 2929 0d0a 0d0a 2020  id(self)))....  
-0003faf0: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
-0003fb00: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
-0003fb10: 7475 726e 2073 656c 662e 5f72 6570 7265  turn self._repre
-0003fb20: 7365 6e74 5f68 6965 7261 7263 6879 2829  sent_hierarchy()
-0003fb30: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6c65  ....    def __le
-0003fb40: 6e5f 5f28 7365 6c66 293a 0d0a 2020 2020  n__(self):..    
-0003fb50: 2020 2020 7265 7475 726e 206c 656e 285b      return len([
-0003fb60: 7820 666f 7220 7820 696e 2073 656c 662e  x for x in self.
-0003fb70: 7761 6c6b 2829 5d29 0d0a 0d0a 0d0a 2020  walk()])......  
-0003fb80: 2020 6465 6620 5f72 6570 7265 7365 6e74    def _represent
-0003fb90: 5f68 6965 7261 7263 6879 2873 656c 662c  _hierarchy(self,
-0003fba0: 7072 6566 6978 5f73 7472 696e 6720 3d20  prefix_string = 
-0003fbb0: 2727 2c63 6f75 6e74 6572 203d 204e 6f6e  '',counter = Non
-0003fbc0: 6529 3a0d 0a0d 0a20 2020 2020 2020 2072  e):....        r
-0003fbd0: 6573 756c 7420 3d20 2727 0d0a 0d0a 2020  esult = ''....  
-0003fbe0: 2020 2020 2020 6966 2063 6f75 6e74 6572        if counter
-0003fbf0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-0003fc00: 2020 2020 2020 2063 6f75 6e74 6572 203d         counter =
-0003fc10: 205f 436f 756e 7465 7228 290d 0a0d 0a20   _Counter().... 
-0003fc20: 2020 2020 2020 2069 6620 7072 6566 6978         if prefix
-0003fc30: 5f73 7472 696e 673d 3d27 273a 0d0a 2020  _string=='':..  
-0003fc40: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-0003fc50: 202b 3d20 277b 3a31 317d 7b3a 3139 7d7b   += '{:11}{:19}{
-0003fc60: 7d5c 6e27 2e66 6f72 6d61 7428 7365 6c66  }\n'.format(self
-0003fc70: 2e73 686f 7274 6e61 6d65 2c73 7472 2863  .shortname,str(c
-0003fc80: 6f75 6e74 6572 292c 2073 656c 662e 6c6f  ounter), self.lo
-0003fc90: 6e67 6e61 6d65 290d 0a0d 0a20 2020 2020  ngname)....     
-0003fca0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0003fcb0: 2020 2020 2020 7265 7375 6c74 202b 3d20        result += 
-0003fcc0: 277b 7d2b 2d7b 3a31 317d 7b3a 3139 7d7b  '{}+-{:11}{:19}{
-0003fcd0: 7d5c 6e27 2e66 6f72 6d61 7428 7072 6566  }\n'.format(pref
-0003fce0: 6978 5f73 7472 696e 675b 3a2d 325d 2c20  ix_string[:-2], 
-0003fcf0: 7365 6c66 2e73 686f 7274 6e61 6d65 2c73  self.shortname,s
-0003fd00: 7472 2863 6f75 6e74 6572 292c 7365 6c66  tr(counter),self
-0003fd10: 2e6c 6f6e 676e 616d 6529 0d0a 0d0a 2020  .longname)....  
-0003fd20: 2020 2020 2020 6b69 6473 203d 205b 6320        kids = [c 
-0003fd30: 666f 7220 6320 696e 2073 656c 662e 6368  for c in self.ch
-0003fd40: 696c 6472 656e 5d0d 0a20 2020 2020 2020  ildren]..       
-0003fd50: 2066 6f72 206e 2c20 6520 696e 2065 6e75   for n, e in enu
-0003fd60: 6d65 7261 7465 286b 6964 7329 3a0d 0a20  merate(kids):.. 
-0003fd70: 2020 2020 2020 2020 2020 2069 6620 6e2b             if n+
-0003fd80: 313d 3d6c 656e 286b 6964 7329 3a0d 0a20  1==len(kids):.. 
-0003fd90: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0003fda0: 6464 656e 6475 6d20 3d20 2720 2027 0d0a  ddendum = '  '..
-0003fdb0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0003fdc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0003fdd0: 2020 2061 6464 656e 6475 6d20 3d20 277c     addendum = '|
-0003fde0: 2027 0d0a 2020 2020 2020 2020 2020 2020   '..            
-0003fdf0: 7265 7375 6c74 202b 3d20 652e 5f72 6570  result += e._rep
-0003fe00: 7265 7365 6e74 5f68 6965 7261 7263 6879  resent_hierarchy
-0003fe10: 2870 7265 6669 785f 7374 7269 6e67 203d  (prefix_string =
-0003fe20: 2070 7265 6669 785f 7374 7269 6e67 2b61   prefix_string+a
-0003fe30: 6464 656e 6475 6d2c 636f 756e 7465 7220  ddendum,counter 
-0003fe40: 3d20 636f 756e 7465 7229 0d0a 0d0a 2020  = counter)....  
-0003fe50: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-0003fe60: 756c 740d 0a0d 0a20 2020 2064 6566 2067  ult....    def g
-0003fe70: 6574 5f6c 6561 7665 7328 7365 6c66 2c73  et_leaves(self,s
-0003fe80: 7562 7472 6565 5f73 686f 7274 6e61 6d65  ubtree_shortname
-0003fe90: 3d4e 6f6e 652c 7065 726d 6973 7369 7665  =None,permissive
-0003fea0: 3d54 7275 6529 3a0d 0a20 2020 2020 2020  =True):..       
-0003feb0: 2027 2727 5969 656c 6420 7468 6520 6c65   '''Yield the le
-0003fec0: 6166 2053 7472 7563 7475 7265 456c 656d  af StructureElem
-0003fed0: 656e 7473 2069 6e20 6120 7261 6767 6564  ents in a ragged
-0003fee0: 2068 6965 7261 7263 6879 2c20 6265 6c6f   hierarchy, belo
-0003fef0: 7720 7468 6520 6769 7665 6e20 7368 6f72  w the given shor
-0003ff00: 746e 616d 650d 0a20 2020 2020 2020 203a  tname..        :
-0003ff10: 7061 7261 6d20 7375 6274 7265 655f 7368  param subtree_sh
-0003ff20: 6f72 746e 616d 653a 2045 6d70 6f77 6572  ortname: Empower
-0003ff30: 2053 686f 7274 204e 616d 6520 6f66 2074   Short Name of t
-0003ff40: 6865 2053 7472 7563 7475 7265 2045 6c65  he Structure Ele
-0003ff50: 6d65 6e74 2077 6520 7761 6e74 2074 6f20  ment we want to 
-0003ff60: 7374 6172 7420 7969 656c 6469 6e67 2069  start yielding i
-0003ff70: 7465 6d73 2066 726f 6d2e 2044 6566 6175  tems from. Defau
-0003ff80: 6c74 7320 746f 2074 6865 2072 6f6f 7420  lts to the root 
-0003ff90: 6f66 2074 6865 2074 7265 652e 0d0a 2020  of the tree...  
-0003ffa0: 2020 2020 2020 2727 270d 0a0d 0a20 2020        '''....   
-0003ffb0: 2020 2020 2069 6620 7375 6274 7265 655f       if subtree_
-0003ffc0: 7368 6f72 746e 616d 6520 6973 204e 6f6e  shortname is Non
-0003ffd0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0003ffe0: 7375 6274 7265 655f 7368 6f72 746e 616d  subtree_shortnam
-0003fff0: 653d 7365 6c66 2e73 686f 7274 6e61 6d65  e=self.shortname
-00040000: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
-00040010: 6520 696e 2073 656c 662e 7761 6c6b 5f73  e in self.walk_s
-00040020: 7562 7472 6565 2873 7562 7472 6565 5f73  ubtree(subtree_s
-00040030: 686f 7274 6e61 6d65 3d73 7562 7472 6565  hortname=subtree
-00040040: 5f73 686f 7274 6e61 6d65 2c70 6572 6d69  _shortname,permi
-00040050: 7373 6976 653d 7065 726d 6973 7369 7665  ssive=permissive
-00040060: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00040070: 6966 2065 2e69 735f 6c65 6166 3a0d 0a20  if e.is_leaf:.. 
-00040080: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-00040090: 6965 6c64 2065 0d0a 0d0a 2020 2020 4070  ield e....    @p
-000400a0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-000400b0: 206c 6561 7665 7328 7365 6c66 293a 0d0a   leaves(self):..
-000400c0: 2020 2020 2020 2020 2727 2759 6965 6c64          '''Yield
-000400d0: 2074 6865 206c 6561 6620 5374 7275 6374   the leaf Struct
-000400e0: 7572 6545 6c65 6d65 6e74 7320 696e 2061  ureElements in a
-000400f0: 2072 6167 6765 6420 6869 6572 6172 6368   ragged hierarch
-00040100: 792c 2062 656c 6f77 2074 6865 2067 6976  y, below the giv
-00040110: 656e 2073 686f 7274 6e61 6d65 2727 270d  en shortname'''.
-00040120: 0a0d 0a20 2020 2020 2020 2079 6965 6c64  ...        yield
-00040130: 2066 726f 6d20 7365 6c66 2e67 6574 5f6c   from self.get_l
-00040140: 6561 7665 7328 7375 6274 7265 655f 7368  eaves(subtree_sh
-00040150: 6f72 746e 616d 653d 4e6f 6e65 2c70 6572  ortname=None,per
-00040160: 6d69 7373 6976 653d 5472 7565 290d 0a0d  missive=True)...
-00040170: 0a20 2020 2064 6566 2067 6574 5f75 6e69  .    def get_uni
-00040180: 7175 655f 6c65 6176 6573 2873 656c 662c  que_leaves(self,
-00040190: 7375 6274 7265 655f 7368 6f72 746e 616d  subtree_shortnam
-000401a0: 653d 4e6f 6e65 293a 0d0a 2020 2020 2020  e=None):..      
-000401b0: 2020 2727 2759 6965 6c64 2075 6e69 7175    '''Yield uniqu
-000401c0: 6520 6c65 6166 2044 696d 656e 7369 6f6e  e leaf Dimension
-000401d0: 456c 656d 656e 7473 2069 6e20 6120 7261  Elements in a ra
-000401e0: 6767 6564 2068 6965 7261 7263 6879 2c20  gged hierarchy, 
-000401f0: 6265 6c6f 7720 7468 6520 6769 7665 6e20  below the given 
-00040200: 7368 6f72 746e 616d 650d 0a20 2020 2020  shortname..     
-00040210: 2020 203a 7061 7261 6d20 7375 6274 7265     :param subtre
-00040220: 655f 7368 6f72 746e 616d 653a 2045 6d70  e_shortname: Emp
-00040230: 6f77 6572 2053 686f 7274 204e 616d 6520  ower Short Name 
-00040240: 6f66 2074 6865 2053 7472 7563 7475 7265  of the Structure
-00040250: 2045 6c65 6d65 6e74 2077 6520 7761 6e74   Element we want
-00040260: 2074 6f20 7374 6172 7420 7969 656c 6469   to start yieldi
-00040270: 6e67 2069 7465 6d73 2066 726f 6d2e 2044  ng items from. D
-00040280: 6566 6175 6c74 7320 746f 2074 6865 2072  efaults to the r
-00040290: 6f6f 7420 6f66 2074 6865 2074 7265 652e  oot of the tree.
-000402a0: 0d0a 2020 2020 2020 2020 2727 270d 0a0d  ..        '''...
-000402b0: 0a20 2020 2020 2020 2069 6620 7375 6274  .        if subt
-000402c0: 7265 655f 7368 6f72 746e 616d 6520 6973  ree_shortname is
-000402d0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-000402e0: 2020 2020 7375 6274 7265 655f 7368 6f72      subtree_shor
-000402f0: 746e 616d 653d 7365 6c66 2e73 686f 7274  tname=self.short
-00040300: 6e61 6d65 0d0a 0d0a 2020 2020 2020 2020  name....        
-00040310: 7969 656c 6465 645f 7368 6f72 746e 616d  yielded_shortnam
-00040320: 6573 203d 205b 5d0d 0a0d 0a20 2020 2020  es = []....     
-00040330: 2020 2066 6f72 2065 2069 6e20 7365 6c66     for e in self
-00040340: 2e77 616c 6b5f 7375 6274 7265 6528 7375  .walk_subtree(su
-00040350: 6274 7265 655f 7368 6f72 746e 616d 653d  btree_shortname=
-00040360: 7375 6274 7265 655f 7368 6f72 746e 616d  subtree_shortnam
-00040370: 652c 7065 726d 6973 7369 7665 3d54 7275  e,permissive=Tru
-00040380: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
-00040390: 2069 6620 652e 6973 5f6c 6561 663a 0d0a   if e.is_leaf:..
-000403a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000403b0: 6966 2065 2e73 686f 7274 6e61 6d65 206e  if e.shortname n
-000403c0: 6f74 2069 6e20 7969 656c 6465 645f 7368  ot in yielded_sh
-000403d0: 6f72 746e 616d 6573 3a0d 0a20 2020 2020  ortnames:..     
-000403e0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-000403f0: 6965 6c64 6564 5f73 686f 7274 6e61 6d65  ielded_shortname
-00040400: 732e 6170 7065 6e64 2865 2e73 686f 7274  s.append(e.short
-00040410: 6e61 6d65 290d 0a20 2020 2020 2020 2020  name)..         
-00040420: 2020 2020 2020 2020 2020 2023 5969 656c             #Yiel
-00040430: 6420 7468 6520 6469 6d65 6e73 696f 6e20  d the dimension 
-00040440: 656c 656d 656e 7420 696e 2071 7565 7374  element in quest
-00040450: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
-00040460: 2020 2020 2020 2020 2079 6965 6c64 2065           yield e
-00040470: 2e65 6c65 6d65 6e74 0d0a 0d0a 2020 2020  .element....    
-00040480: 6465 6620 6765 745f 656c 656d 656e 7473  def get_elements
-00040490: 2873 656c 662c 7368 6f72 746e 616d 6529  (self,shortname)
-000404a0: 3a0d 0a20 2020 2020 2020 2027 2727 4765  :..        '''Ge
-000404b0: 7420 616c 6c20 6f66 2074 6865 2065 6c65  t all of the ele
-000404c0: 6d65 6e74 7320 696e 2074 6869 7320 6869  ments in this hi
-000404d0: 6572 6172 6368 7920 7769 7468 2074 6865  erarchy with the
-000404e0: 2067 6976 656e 2073 686f 7274 6e61 6d65   given shortname
-000404f0: 2727 270d 0a20 2020 2020 2020 2023 4b65  '''..        #Ke
-00040500: 6570 2074 7261 636b 206f 6620 7768 6574  ep track of whet
-00040510: 6865 7220 616e 2065 6c65 6d65 6e74 2077  her an element w
-00040520: 6173 2070 6173 7365 6420 696e 2074 6f20  as passed in to 
-00040530: 6865 6c70 2077 6974 6820 6465 6275 6767  help with debugg
-00040540: 696e 670d 0a20 2020 2020 2020 2065 6c65  ing..        ele
-00040550: 6d65 6e74 5f77 6173 5f70 6173 7365 645f  ment_was_passed_
-00040560: 696e 3d46 616c 7365 0d0a 0d0a 2020 2020  in=False....    
-00040570: 2020 2020 2349 6620 616e 2065 6c65 6d65      #If an eleme
-00040580: 6e74 2068 6173 2062 6565 6e20 7061 7373  nt has been pass
-00040590: 6564 2069 6e2c 2075 7365 2074 6865 2065  ed in, use the e
-000405a0: 6c65 6d65 6e74 2773 2073 686f 7274 6e61  lement's shortna
-000405b0: 6d65 0d0a 2020 2020 2020 2020 7472 793a  me..        try:
-000405c0: 0d0a 2020 2020 2020 2020 2020 2020 7368  ..            sh
-000405d0: 6f72 746e 616d 653d 7368 6f72 746e 616d  ortname=shortnam
-000405e0: 652e 7368 6f72 746e 616d 650d 0a20 2020  e.shortname..   
-000405f0: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
-00040600: 5f77 6173 5f70 6173 7365 645f 696e 3d54  _was_passed_in=T
-00040610: 7275 650d 0a20 2020 2020 2020 2065 7863  rue..        exc
-00040620: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
-00040630: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-00040640: 2070 6173 730d 0a0d 0a20 2020 2020 2020   pass....       
-00040650: 2023 4368 6563 6b20 7468 6174 2073 686f   #Check that sho
-00040660: 7274 6e61 6d65 2069 7320 6e6f 7420 4e6f  rtname is not No
-00040670: 6e65 0d0a 2020 2020 2020 2020 6966 2073  ne..        if s
-00040680: 686f 7274 6e61 6d65 2069 7320 4e6f 6e65  hortname is None
-00040690: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-000406a0: 5072 6f67 7261 6d6d 696e 6720 6572 726f  Programming erro
-000406b0: 720d 0a20 2020 2020 2020 2020 2020 2069  r..            i
-000406c0: 6620 656c 656d 656e 745f 7761 735f 7061  f element_was_pa
-000406d0: 7373 6564 5f69 6e3a 0d0a 2020 2020 2020  ssed_in:..      
-000406e0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000406f0: 5661 6c75 6545 7272 6f72 2827 656c 656d  ValueError('elem
-00040700: 656e 742e 7368 6f72 746e 616d 6520 6d75  ent.shortname mu
-00040710: 7374 2068 6176 6520 6120 7661 6c75 652e  st have a value.
-00040720: 204e 6f6e 6520 7761 7320 7375 7070 6c69   None was suppli
-00040730: 6564 2e20 6465 6275 6767 696e 6720 696e  ed. debugging in
-00040740: 666f 726d 6174 696f 6e3a 2041 2070 796d  formation: A pym
-00040750: 7078 2e45 6c65 6d65 6e74 2069 6e73 7461  px.Element insta
-00040760: 6e63 6520 7761 7320 7061 7373 6564 2069  nce was passed i
-00040770: 6e20 6173 2074 6865 2073 686f 7274 6e61  n as the shortna
-00040780: 6d65 2070 6172 616d 6574 6572 2074 6f20  me parameter to 
-00040790: 6675 6e63 7469 6f6e 2067 6574 5f65 6c65  function get_ele
-000407a0: 6d65 6e74 2829 2729 0d0a 2020 2020 2020  ment()')..      
-000407b0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-000407c0: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-000407d0: 7365 2056 616c 7565 4572 726f 7228 2773  se ValueError('s
-000407e0: 686f 7274 6e61 6d65 206d 7573 7420 6861  hortname must ha
-000407f0: 7665 2061 2076 616c 7565 2e20 4e6f 6e65  ve a value. None
-00040800: 2077 6173 2073 7570 706c 6965 642e 2729   was supplied.')
-00040810: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
-00040820: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00040830: 7375 6c74 203d 205b 5d0d 0a20 2020 2020  sult = []..     
-00040840: 2020 2020 2020 2066 6f72 2073 6520 696e         for se in
-00040850: 2073 656c 662e 7761 6c6b 2870 6572 6d69   self.walk(permi
-00040860: 7373 6976 653d 5472 7565 293a 0d0a 2020  ssive=True):..  
-00040870: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00040880: 2073 652e 7368 6f72 746e 616d 6520 3d3d   se.shortname ==
-00040890: 2073 686f 7274 6e61 6d65 3a0d 0a20 2020   shortname:..   
-000408a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000408b0: 2072 6573 756c 742e 6170 7065 6e64 2873   result.append(s
-000408c0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-000408d0: 7265 7475 726e 2072 6573 756c 740d 0a0d  return result...
-000408e0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-000408f0: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
-00040900: 2020 2020 2020 2072 6574 7572 6e20 5b5d         return []
-00040910: 0d0a 0d0a 2020 2020 6465 6620 5f67 6574  ....    def _get
-00040920: 5f66 6972 7374 5f65 6c65 6d65 6e74 5f77  _first_element_w
-00040930: 6974 685f 7368 6f72 746e 616d 6528 7365  ith_shortname(se
-00040940: 6c66 2c73 686f 7274 6e61 6d65 293a 0d0a  lf,shortname):..
-00040950: 2020 2020 2020 2020 2727 2747 6574 2074          '''Get t
-00040960: 6865 2066 6972 7374 2065 6c65 6d65 6e74  he first element
-00040970: 2069 6e20 7468 6973 2068 6569 7261 7263   in this heirarc
-00040980: 6879 2077 6974 6820 7468 6520 6769 7665  hy with the give
-00040990: 6e20 7368 6f72 746e 616d 6520 2d20 7573  n shortname - us
-000409a0: 6564 2069 6e74 6572 6e61 6c6c 792c 2077  ed internally, w
-000409b0: 6974 6820 6361 7265 2c20 666f 7220 7369  ith care, for si
-000409c0: 7475 6174 696f 6e73 2077 6865 6e20 7765  tuations when we
-000409d0: 206b 6e6f 7720 7468 6174 2073 7563 6820   know that such 
-000409e0: 616e 2065 6c65 6d65 6e74 2073 686f 756c  an element shoul
-000409f0: 6420 6578 6973 7420 696e 2074 6865 2073  d exist in the s
-00040a00: 7562 7472 6565 206f 6e63 6527 2727 0d0a  ubtree once'''..
-00040a10: 0d0a 2020 2020 2020 2020 2349 6620 616e  ..        #If an
-00040a20: 2065 6c65 6d65 6e74 2068 6173 2062 6565   element has bee
-00040a30: 6e20 7061 7373 6564 2069 6e2c 2075 7365  n passed in, use
-00040a40: 2074 6865 2065 6c65 6d65 6e74 2773 2073   the element's s
-00040a50: 686f 7274 6e61 6d65 0d0a 2020 2020 2020  hortname..      
-00040a60: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00040a70: 2020 2020 7368 6f72 746e 616d 653d 7368      shortname=sh
-00040a80: 6f72 746e 616d 652e 7368 6f72 746e 616d  ortname.shortnam
-00040a90: 650d 0a20 2020 2020 2020 2065 7863 6570  e..        excep
-00040aa0: 7420 4174 7472 6962 7574 6545 7272 6f72  t AttributeError
-00040ab0: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-00040ac0: 6173 730d 0a0d 0a20 2020 2020 2020 2023  ass....        #
-00040ad0: 4368 6563 6b20 7468 6174 2073 686f 7274  Check that short
-00040ae0: 6e61 6d65 2069 7320 6e6f 7420 4e6f 6e65  name is not None
-00040af0: 0d0a 2020 2020 2020 2020 6966 2073 686f  ..        if sho
-00040b00: 7274 6e61 6d65 2069 7320 4e6f 6e65 3a0d  rtname is None:.
-00040b10: 0a20 2020 2020 2020 2020 2020 2023 5072  .            #Pr
-00040b20: 6f67 7261 6d6d 696e 6720 6572 726f 720d  ogramming error.
-00040b30: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00040b40: 7365 2056 616c 7565 4572 726f 7228 2773  se ValueError('s
-00040b50: 686f 7274 6e61 6d65 206d 7573 7420 6861  hortname must ha
-00040b60: 7665 2061 2076 616c 7565 2e20 4e6f 6e65  ve a value. None
-00040b70: 2077 6173 2073 7570 706c 6965 642e 2729   was supplied.')
-00040b80: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
-00040b90: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00040ba0: 7375 6c74 203d 205b 5d0d 0a20 2020 2020  sult = []..     
-00040bb0: 2020 2020 2020 2066 6f72 2073 6520 696e         for se in
-00040bc0: 2073 656c 662e 7761 6c6b 2870 6572 6d69   self.walk(permi
-00040bd0: 7373 6976 653d 5472 7565 293a 0d0a 2020  ssive=True):..  
-00040be0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00040bf0: 2073 652e 7368 6f72 746e 616d 6520 3d3d   se.shortname ==
-00040c00: 2073 686f 7274 6e61 6d65 3a0d 0a20 2020   shortname:..   
-00040c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040c20: 2072 6574 7572 6e20 7365 0d0a 0d0a 2020   return se....  
-00040c30: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-00040c40: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-00040c50: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-00040c60: 0a0d 0a20 2020 2023 2323 2323 2323 2323  ...    #########
-00040c70: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00040c80: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00040c90: 2323 2323 0d0a 2020 2020 230d 0a20 2020  ####..    #..   
-00040ca0: 2023 2053 7472 7563 7475 7265 206d 616e   # Structure man
-00040cb0: 6970 756c 6174 696f 6e20 6675 6e63 7469  ipulation functi
-00040cc0: 6f6e 730d 0a20 2020 2023 0d0a 2020 2020  ons..    #..    
-00040cd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00040ce0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00040cf0: 2323 2323 2323 2323 2323 2323 230d 0a0d  #############...
-00040d00: 0a20 2020 2064 6566 2063 6f70 7928 7365  .    def copy(se
-00040d10: 6c66 2c20 656c 656d 656e 745f 7368 6f72  lf, element_shor
-00040d20: 746e 616d 655f 6669 6c74 6572 5f6f 7574  tname_filter_out
-00040d30: 5f6c 6973 7420 3d20 5b5d 293a 0d0a 2020  _list = []):..  
-00040d40: 2020 2020 2020 2727 2752 6574 7572 6e20        '''Return 
-00040d50: 6120 636f 7079 206f 6620 7468 6520 6869  a copy of the hi
-00040d60: 6572 6172 6368 7927 2727 0d0a 2020 2020  erarchy'''..    
-00040d70: 2020 2020 636f 7079 5f73 656c 6620 3d20      copy_self = 
-00040d80: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-00040d90: 2865 6c65 6d65 6e74 203d 2073 656c 662e  (element = self.
-00040da0: 656c 656d 656e 742c 2069 735f 726f 6f74  element, is_root
-00040db0: 203d 2073 656c 662e 6973 5f72 6f6f 7429   = self.is_root)
-00040dc0: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
-00040dd0: 6520 696e 2073 656c 662e 6368 696c 6472  e in self.childr
-00040de0: 656e 3a0d 0a20 2020 2020 2020 2020 2020  en:..           
-00040df0: 2069 6620 6e6f 7420 2865 2e65 6c65 6d65   if not (e.eleme
-00040e00: 6e74 2e73 686f 7274 6e61 6d65 2069 6e20  nt.shortname in 
-00040e10: 656c 656d 656e 745f 7368 6f72 746e 616d  element_shortnam
-00040e20: 655f 6669 6c74 6572 5f6f 7574 5f6c 6973  e_filter_out_lis
-00040e30: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
-00040e40: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00040e50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00040e60: 6f70 795f 7365 6c66 2e5f 6164 645f 6368  opy_self._add_ch
-00040e70: 696c 6428 652e 636f 7079 2865 6c65 6d65  ild(e.copy(eleme
-00040e80: 6e74 5f73 686f 7274 6e61 6d65 5f66 696c  nt_shortname_fil
-00040e90: 7465 725f 6f75 745f 6c69 7374 3d65 6c65  ter_out_list=ele
-00040ea0: 6d65 6e74 5f73 686f 7274 6e61 6d65 5f66  ment_shortname_f
-00040eb0: 696c 7465 725f 6f75 745f 6c69 7374 2929  ilter_out_list))
-00040ec0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00040ed0: 2020 6578 6365 7074 2052 6563 7572 7369    except Recursi
-00040ee0: 6f6e 4572 726f 723a 0d0a 2020 2020 2020  onError:..      
-00040ef0: 2020 2020 2020 2020 2020 2020 2020 2357                #W
-00040f00: 6527 7665 2067 6f6e 6520 746f 6f20 6465  e've gone too de
-00040f10: 6570 2c20 7468 6572 6520 6d75 7374 2062  ep, there must b
-00040f20: 6520 736f 6d65 2073 6f72 7420 6f66 206c  e some sort of l
-00040f30: 6f6f 7020 696e 2074 6865 2068 6965 7261  oop in the hiera
-00040f40: 7263 6879 0d0a 2020 2020 2020 2020 2020  rchy..          
-00040f50: 2020 2020 2020 2020 2020 2370 7269 6e74            #print
-00040f60: 206f 7574 2074 6865 2070 6172 656e 7473   out the parents
+0003a140: 2020 202c 6973 5f72 6f6f 743d 4661 6c73     ,is_root=Fals
+0003a150: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0003a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003a170: 2020 2020 2020 2020 2020 290d 0a0d 0a20            ).... 
+0003a180: 2020 2020 2020 2066 6f72 2063 6820 696e         for ch in
+0003a190: 2073 656c 662e 6368 696c 6472 656e 3a0d   self.children:.
+0003a1a0: 0a20 2020 2020 2020 2020 2020 2063 682e  .            ch.
+0003a1b0: 5f73 6574 5f74 7265 6528 7265 6c61 7469  _set_tree(relati
+0003a1c0: 6f6e 7368 6970 5f64 6963 743d 7265 6c61  onship_dict=rela
+0003a1d0: 7469 6f6e 7368 6970 5f64 6963 742c 7570  tionship_dict,up
+0003a1e0: 6461 7465 203d 2075 7064 6174 6529 0d0a  date = update)..
+0003a1f0: 0d0a 2020 2020 6465 6620 7570 6461 7465  ..    def update
+0003a200: 5f74 7265 6528 7365 6c66 2c72 656c 6174  _tree(self,relat
+0003a210: 696f 6e73 6869 7073 293a 0d0a 2020 2020  ionships):..    
+0003a220: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
+0003a230: 2041 6464 206e 6577 2072 656c 6174 696f   Add new relatio
+0003a240: 6e73 6869 7073 2069 6e20 7468 6520 7472  nships in the tr
+0003a250: 6565 2062 656c 6f77 2074 6869 7320 5374  ee below this St
+0003a260: 7275 6374 7572 6545 6c65 6d65 6e74 2e20  ructureElement. 
+0003a270: 4368 696c 6472 656e 2077 696c 6c20 6265  Children will be
+0003a280: 206d 6f76 6564 2074 6f20 6e65 7720 7061   moved to new pa
+0003a290: 7265 6e74 732e 204f 7264 6572 2077 696c  rents. Order wil
+0003a2a0: 6c20 6265 2070 7265 7365 7276 6564 0d0a  l be preserved..
+0003a2b0: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0003a2c0: 2072 656c 6174 696f 6e73 6869 7073 3a20   relationships: 
+0003a2d0: 6120 6c69 7374 206f 6620 7061 7265 6e74  a list of parent
+0003a2e0: 2063 6869 6c64 2074 7570 6c65 732c 2061   child tuples, a
+0003a2f0: 2064 6963 7469 6f6e 6172 7920 6f66 207b   dictionary of {
+0003a300: 6368 696c 643a 7061 7265 6e74 7d20 6f72  child:parent} or
+0003a310: 2061 2064 6174 6166 7261 6d65 2077 6974   a dataframe wit
+0003a320: 6820 636f 6c75 6d6e 7320 2753 686f 7274  h columns 'Short
+0003a330: 204e 616d 6527 206f 7220 2750 6879 7349   Name' or 'PhysI
+0003a340: 4427 2061 6e64 2027 5061 7265 6e74 2053  D' and 'Parent S
+0003a350: 686f 7274 204e 616d 6527 206f 7220 2750  hort Name' or 'P
+0003a360: 6172 656e 7420 5068 7973 4944 270d 0a20  arent PhysID'.. 
+0003a370: 2020 2020 2020 2027 2727 0d0a 0d0a 2020         '''....  
+0003a380: 2020 2020 2020 7365 6c66 2e73 6574 5f74        self.set_t
+0003a390: 7265 6528 7265 6c61 7469 6f6e 7368 6970  ree(relationship
+0003a3a0: 732c 7570 6461 7465 3d54 7275 6529 0d0a  s,update=True)..
+0003a3b0: 0d0a 0d0a 2020 2020 6465 6620 6162 6469  ....    def abdi
+0003a3c0: 6361 7465 2873 656c 6629 3a0d 0a20 2020  cate(self):..   
+0003a3d0: 2020 2020 2027 2727 5265 6d6f 7665 2073       '''Remove s
+0003a3e0: 656c 6620 6672 6f6d 2061 2068 6965 7261  elf from a hiera
+0003a3f0: 7263 6879 2061 6e64 2072 6570 6c61 6365  rchy and replace
+0003a400: 2073 656c 6620 7769 7468 2063 6869 6c64   self with child
+0003a410: 7265 6e20 696e 2074 6865 2073 616d 6520  ren in the same 
+0003a420: 7370 6f74 0d0a 2020 2020 2020 2020 5468  spot..        Th
+0003a430: 6973 2069 7320 7665 7279 2069 6d70 6f72  is is very impor
+0003a440: 7461 6e74 2066 6f72 2066 696c 7465 7269  tant for filteri
+0003a450: 6e67 2c20 6265 6361 7573 6520 7765 206d  ng, because we m
+0003a460: 7573 7420 6c65 6176 6520 616e 2069 6e74  ust leave an int
+0003a470: 6163 7420 6869 6572 6172 6368 7920 7768  act hierarchy wh
+0003a480: 656e 2066 696c 7465 7269 6e67 2c20 616e  en filtering, an
+0003a490: 6420 7375 6363 6573 7369 7665 6c79 2061  d successively a
+0003a4a0: 6264 6963 6174 696e 6720 656c 656d 656e  bdicating elemen
+0003a4b0: 7473 2077 696c 6c20 616c 6c6f 7720 6368  ts will allow ch
+0003a4c0: 696c 6472 656e 2074 6f20 7368 7566 666c  ildren to shuffl
+0003a4d0: 6520 7570 0d0a 2020 2020 2020 2020 2727  e up..        ''
+0003a4e0: 270d 0a20 2020 2020 2020 2023 5265 706c  '..        #Repl
+0003a4f0: 6163 6520 7365 6c66 2077 6974 6820 6368  ace self with ch
+0003a500: 696c 6472 656e 2069 6e20 7061 7265 6e74  ildren in parent
+0003a510: 2065 6c65 6d65 6e74 0d0a 2020 2020 2020   element..      
+0003a520: 2020 6966 206e 6f74 2073 656c 662e 6861    if not self.ha
+0003a530: 735f 6368 696c 6472 656e 3a0d 0a20 2020  s_children:..   
+0003a540: 2020 2020 2020 2020 2073 656c 662e 7061           self.pa
+0003a550: 7265 6e74 2e72 656d 6f76 655f 6368 696c  rent.remove_chil
+0003a560: 6428 7365 6c66 290d 0a20 2020 2020 2020  d(self)..       
+0003a570: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0003a580: 2020 2020 7365 6c66 2e70 6172 656e 742e      self.parent.
+0003a590: 7265 706c 6163 655f 6368 696c 6428 6368  replace_child(ch
+0003a5a0: 696c 645f 7374 7275 6374 7572 655f 656c  ild_structure_el
+0003a5b0: 656d 656e 743d 7365 6c66 2c72 6570 6c61  ement=self,repla
+0003a5c0: 6365 6d65 6e74 733d 7365 6c66 2e63 6869  cements=self.chi
+0003a5d0: 6c64 7265 6e29 0d0a 0d0a 2020 2020 4070  ldren)....    @p
+0003a5e0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+0003a5f0: 2068 6173 5f63 6869 6c64 7265 6e28 7365   has_children(se
+0003a600: 6c66 293a 0d0a 2020 2020 2020 2020 2727  lf):..        ''
+0003a610: 2749 6620 7468 6973 2053 7472 7563 7475  'If this Structu
+0003a620: 7265 456c 656d 656e 7420 6861 7320 6174  reElement has at
+0003a630: 206c 6561 7374 206f 6e65 2063 6869 6c64   least one child
+0003a640: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+0003a650: 2c20 7468 656e 2072 6574 7572 6e20 5472  , then return Tr
+0003a660: 7565 2c20 6f74 6865 7277 6973 6520 7265  ue, otherwise re
+0003a670: 7475 726e 7320 4661 6c73 6527 2727 0d0a  turns False'''..
+0003a680: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+0003a690: 656e 2873 656c 662e 5f63 6869 6c64 5f73  en(self._child_s
+0003a6a0: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+0003a6b0: 7329 203e 2030 0d0a 0d0a 2020 2020 4070  s) > 0....    @p
+0003a6c0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+0003a6d0: 2069 735f 6c65 6166 2873 656c 6629 3a0d   is_leaf(self):.
+0003a6e0: 0a20 2020 2020 2020 2027 2727 4966 2074  .        '''If t
+0003a6f0: 6869 7320 5374 7275 6374 7572 6545 6c65  his StructureEle
+0003a700: 6d65 6e74 2068 6173 206e 6f20 6368 696c  ment has no chil
+0003a710: 6472 656e 2069 7420 6973 2061 2027 6c65  dren it is a 'le
+0003a720: 6166 2065 6c65 6d65 6e74 272c 2073 6f20  af element', so 
+0003a730: 7265 7475 726e 2054 7275 652c 206f 7468  return True, oth
+0003a740: 6572 7769 7365 2072 6574 7572 6e73 2046  erwise returns F
+0003a750: 616c 7365 2727 270d 0a20 2020 2020 2020  alse'''..       
+0003a760: 2072 6574 7572 6e20 6e6f 7420 7365 6c66   return not self
+0003a770: 2e68 6173 5f63 6869 6c64 7265 6e0d 0a0d  .has_children...
+0003a780: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+0003a790: 2020 2020 6465 6620 7061 7265 6e74 2873      def parent(s
+0003a7a0: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
+0003a7b0: 2727 5468 6520 5061 7265 6e74 2053 7472  ''The Parent Str
+0003a7c0: 7563 7475 7265 456c 656d 656e 7420 6f66  uctureElement of
+0003a7d0: 2074 6869 7320 5374 7275 6374 7572 6545   this StructureE
+0003a7e0: 6c65 6d65 6e74 2e0d 0a0d 0a20 2020 2020  lement.....     
+0003a7f0: 2020 2057 696c 6c20 7265 7475 726e 204e     Will return N
+0003a800: 6f6e 6520 6966 2074 6869 7320 5374 7275  one if this Stru
+0003a810: 6374 7572 6545 6c65 6d65 6e74 2068 6173  ctureElement has
+0003a820: 206e 6f20 7061 7265 6e74 2727 270d 0a0d   no parent'''...
+0003a830: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0003a840: 7374 616e 6365 2873 656c 662e 5f70 6172  stance(self._par
+0003a850: 656e 745f 7374 7275 6374 7572 655f 656c  ent_structure_el
+0003a860: 656d 656e 742c 7374 7229 3a0d 0a20 2020  ement,str):..   
+0003a870: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0003a880: 616c 7565 4572 726f 720d 0a20 2020 2020  alueError..     
+0003a890: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0003a8a0: 7061 7265 6e74 5f73 7472 7563 7475 7265  parent_structure
+0003a8b0: 5f65 6c65 6d65 6e74 0d0a 0d0a 2020 2020  _element....    
+0003a8c0: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
+0003a8d0: 6566 2061 6e63 6573 746f 7273 2873 656c  ef ancestors(sel
+0003a8e0: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
+0003a8f0: 4765 6e65 7261 746f 7220 7768 6963 6820  Generator which 
+0003a900: 7969 656c 6473 2065 7665 7279 2070 6172  yields every par
+0003a910: 656e 7420 7570 2074 6f20 7468 6520 726f  ent up to the ro
+0003a920: 6f74 2066 726f 6d20 7468 6973 2065 6c65  ot from this ele
+0003a930: 6d65 6e74 2727 270d 0a0d 0a20 2020 2020  ment'''....     
+0003a940: 2020 205f 6e65 7874 5f61 6e63 6573 746f     _next_ancesto
+0003a950: 7220 3d20 7365 6c66 2e70 6172 656e 740d  r = self.parent.
+0003a960: 0a20 2020 2020 2020 2069 6620 5f6e 6578  .        if _nex
+0003a970: 745f 616e 6365 7374 6f72 2069 7320 6e6f  t_ancestor is no
+0003a980: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0003a990: 2020 2020 2079 6965 6c64 205f 6e65 7874       yield _next
+0003a9a0: 5f61 6e63 6573 746f 720d 0a20 2020 2020  _ancestor..     
+0003a9b0: 2020 2020 2020 2079 6965 6c64 2066 726f         yield fro
+0003a9c0: 6d20 5f6e 6578 745f 616e 6365 7374 6f72  m _next_ancestor
+0003a9d0: 2e61 6e63 6573 746f 7273 0d0a 0d0a 2020  .ancestors....  
+0003a9e0: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+0003a9f0: 2064 6566 2061 6e63 6573 746f 7273 5f73   def ancestors_s
+0003aa00: 7472 696e 6728 7365 6c66 293a 0d0a 2020  tring(self):..  
+0003aa10: 2020 2020 2020 2727 2741 2073 7472 696e        '''A strin
+0003aa20: 672c 2073 696d 696c 6172 2074 6f20 2e70  g, similar to .p
+0003aa30: 6174 682c 206f 6620 616c 6c20 616e 6365  ath, of all ance
+0003aa40: 7374 6f72 2053 7472 7563 7475 7265 456c  stor StructureEl
+0003aa50: 656d 656e 7473 2073 686f 7274 6e61 6d65  ements shortname
+0003aa60: 7320 7374 6172 7469 6e67 2061 7420 7468  s starting at th
+0003aa70: 6520 726f 6f74 2061 6e63 6573 746f 7220  e root ancestor 
+0003aa80: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+0003aa90: 2061 6e64 2073 6570 6572 6174 6564 2077   and seperated w
+0003aaa0: 6974 6820 2720 2d3e 2027 2e20 446f 6573  ith ' -> '. Does
+0003aab0: 206e 6f74 2069 6e63 6c75 6465 2074 6869   not include thi
+0003aac0: 7320 5374 7275 6374 7572 6545 6c65 6d65  s StructureEleme
+0003aad0: 6e74 2773 2073 686f 7274 6e61 6d65 2027  nt's shortname '
+0003aae0: 2727 0d0a 2020 2020 2020 2020 7265 7475  ''..        retu
+0003aaf0: 726e 2027 202d 3e20 272e 6a6f 696e 285b  rn ' -> '.join([
+0003ab00: 612e 7368 6f72 746e 616d 6520 666f 7220  a.shortname for 
+0003ab10: 6120 696e 2073 656c 662e 616e 6365 7374  a in self.ancest
+0003ab20: 6f72 735d 5b3a 3a2d 315d 290d 0a0d 0a20  ors][::-1]).... 
+0003ab30: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+0003ab40: 2020 6465 6620 616e 6365 7374 6f72 735f    def ancestors_
+0003ab50: 6c6f 6e67 6e61 6d65 5f73 7472 696e 6728  longname_string(
+0003ab60: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0003ab70: 2727 2741 2073 7472 696e 672c 2073 696d  '''A string, sim
+0003ab80: 696c 6172 2074 6f20 2e70 6174 682c 206f  ilar to .path, o
+0003ab90: 6620 616c 6c20 616e 6365 7374 6f72 2053  f all ancestor S
+0003aba0: 7472 7563 7475 7265 456c 656d 656e 7473  tructureElements
+0003abb0: 206c 6f6e 676e 616d 6573 2073 7461 7274   longnames start
+0003abc0: 696e 6720 6174 2074 6865 2072 6f6f 7420  ing at the root 
+0003abd0: 616e 6365 7374 6f72 2053 7472 7563 7475  ancestor Structu
+0003abe0: 7265 456c 656d 656e 7420 616e 6420 7365  reElement and se
+0003abf0: 7065 7261 7465 6420 7769 7468 2027 202d  perated with ' -
+0003ac00: 3e20 2720 2727 270d 0a20 2020 2020 2020  > ' '''..       
+0003ac10: 2072 6574 7572 6e20 2720 2d3e 2027 2e6a   return ' -> '.j
+0003ac20: 6f69 6e28 5b61 2e6c 6f6e 676e 616d 6520  oin([a.longname 
+0003ac30: 666f 7220 6120 696e 2073 656c 662e 616e  for a in self.an
+0003ac40: 6365 7374 6f72 735d 5b3a 3a2d 315d 290d  cestors][::-1]).
+0003ac50: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+0003ac60: 0d0a 2020 2020 6465 6620 7374 7269 6e67  ..    def string
+0003ac70: 5f74 6f5f 726f 6f74 2873 656c 6629 3a0d  _to_root(self):.
+0003ac80: 0a20 2020 2020 2020 2027 2727 4120 7374  .        '''A st
+0003ac90: 7269 6e67 2c20 7369 6d69 6c61 7220 746f  ring, similar to
+0003aca0: 202e 7061 7468 2c20 6f66 2061 6c6c 2061   .path, of all a
+0003acb0: 6e63 6573 746f 7220 5374 7275 6374 7572  ncestor Structur
+0003acc0: 6545 6c65 6d65 6e74 7320 7368 6f72 746e  eElements shortn
+0003acd0: 616d 6573 2073 7461 7274 696e 6720 6174  ames starting at
+0003ace0: 2074 6865 2072 6f6f 7420 616e 6365 7374   the root ancest
+0003acf0: 6f72 2053 7472 7563 7475 7265 456c 656d  or StructureElem
+0003ad00: 656e 7420 616e 6420 7365 7065 7261 7465  ent and seperate
+0003ad10: 6420 7769 7468 2027 202d 3e20 272e 204c  d with ' -> '. L
+0003ad20: 6173 7420 7368 6f72 746e 616d 6520 6973  ast shortname is
+0003ad30: 2020 7468 6973 2053 7472 7563 7475 7265    this Structure
+0003ad40: 456c 656d 656e 7427 7320 7368 6f72 746e  Element's shortn
+0003ad50: 616d 6520 2727 270d 0a20 2020 2020 2020  ame '''..       
+0003ad60: 2072 6574 7572 6e20 2720 2d3e 2027 2e6a   return ' -> '.j
+0003ad70: 6f69 6e28 5b61 2e73 686f 7274 6e61 6d65  oin([a.shortname
+0003ad80: 2066 6f72 2061 2069 6e20 7365 6c66 2e61   for a in self.a
+0003ad90: 6e63 6573 746f 7273 5d5b 3a3a 2d31 5d2b  ncestors][::-1]+
+0003ada0: 5b73 656c 662e 7368 6f72 746e 616d 655d  [self.shortname]
+0003adb0: 290d 0a0d 0a20 2020 2040 7072 6f70 6572  )....    @proper
+0003adc0: 7479 0d0a 2020 2020 6465 6620 6368 696c  ty..    def chil
+0003add0: 6472 656e 2873 656c 6629 3a0d 0a20 2020  dren(self):..   
+0003ade0: 2020 2020 2027 2727 5468 6520 6368 696c       '''The chil
+0003adf0: 6472 656e 206f 6620 7468 6973 2027 2727  dren of this '''
+0003ae00: 0d0a 2020 2020 2020 2020 2372 6574 7572  ..        #retur
+0003ae10: 6e20 7468 6520 6d61 6769 6320 6f62 6a65  n the magic obje
+0003ae20: 6374 2077 6869 6368 2061 6c6c 6f77 7320  ct which allows 
+0003ae30: 6368 696c 6472 656e 2074 6f20 6265 2069  children to be i
+0003ae40: 6e64 6578 6564 2061 6e64 2069 7465 7261  ndexed and itera
+0003ae50: 7465 6420 6f76 6572 0d0a 2020 2020 2020  ted over..      
+0003ae60: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
+0003ae70: 6869 6c64 7265 6e0d 0a0d 0a20 2020 2040  hildren....    @
+0003ae80: 6368 696c 6472 656e 2e73 6574 7465 720d  children.setter.
+0003ae90: 0a20 2020 2064 6566 2063 6869 6c64 7265  .    def childre
+0003aea0: 6e28 7365 6c66 2c76 616c 293a 0d0a 2020  n(self,val):..  
+0003aeb0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0003aec0: 6e63 6528 7661 6c2c 5374 7275 6374 7572  nce(val,Structur
+0003aed0: 6545 6c65 6d65 6e74 4368 696c 6472 656e  eElementChildren
+0003aee0: 2920 616e 6420 2876 616c 2e5f 7374 7275  ) and (val._stru
+0003aef0: 6374 7572 655f 656c 656d 656e 7420 6973  cture_element is
+0003af00: 204e 6f6e 6520 6f72 2076 616c 2e5f 7374   None or val._st
+0003af10: 7275 6374 7572 655f 656c 656d 656e 7420  ructure_element 
+0003af20: 6973 2073 656c 6629 3a0d 0a20 2020 2020  is self):..     
+0003af30: 2020 2020 2020 2073 656c 662e 5f63 6869         self._chi
+0003af40: 6c64 7265 6e20 3d20 7661 6c0d 0a20 2020  ldren = val..   
+0003af50: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0003af60: 2020 2020 2020 2020 7365 6c66 2e5f 6368          self._ch
+0003af70: 696c 6472 656e 2e63 6c65 6172 2829 0d0a  ildren.clear()..
+0003af80: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0003af90: 2e5f 6368 696c 6472 656e 2e61 7070 656e  ._children.appen
+0003afa0: 6428 7661 6c29 0d0a 0d0a 2020 2020 4070  d(val)....    @p
+0003afb0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+0003afc0: 2064 6573 6365 6e64 616e 7473 2873 656c   descendants(sel
+0003afd0: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
+0003afe0: 7265 7475 726e 2061 206d 6167 6963 206f  return a magic o
+0003aff0: 626a 6563 7420 7768 6963 6820 616c 6c6f  bject which allo
+0003b000: 7773 2064 6573 6365 6e64 616e 7473 2074  ws descendants t
+0003b010: 6f20 6265 2069 6e64 6578 6564 2062 7920  o be indexed by 
+0003b020: 7368 6f72 746e 616d 6527 2727 0d0a 2020  shortname'''..  
+0003b030: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0003b040: 662e 5f64 6573 6365 6e64 616e 7473 0d0a  f._descendants..
+0003b050: 0d0a 2020 2020 4064 6573 6365 6e64 616e  ..    @descendan
+0003b060: 7473 2e73 6574 7465 720d 0a20 2020 2064  ts.setter..    d
+0003b070: 6566 2064 6573 6365 6e64 616e 7473 2873  ef descendants(s
+0003b080: 656c 662c 7661 6c29 3a0d 0a20 2020 2020  elf,val):..     
+0003b090: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0003b0a0: 2876 616c 2c5f 5374 7275 6374 7572 6545  (val,_StructureE
+0003b0b0: 6c65 6d65 6e74 4465 7363 656e 6461 6e74  lementDescendant
+0003b0c0: 7347 6574 7465 7229 3a0d 0a20 2020 2020  sGetter):..     
+0003b0d0: 2020 2020 2020 2073 656c 662e 5f64 6573         self._des
+0003b0e0: 6365 6e64 616e 7473 203d 2076 616c 0d0a  cendants = val..
+0003b0f0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0003b100: 2020 2020 2020 2020 2020 2023 5768 656e             #When
+0003b110: 2073 6f6d 656f 6e65 2073 6574 7320 6465   someone sets de
+0003b120: 7363 656e 6461 6e74 7320 746f 2062 6520  scendants to be 
+0003b130: 6120 7374 7275 6374 7572 6520 656c 656d  a structure elem
+0003b140: 656e 7420 6f72 206c 6973 7420 6f66 2073  ent or list of s
+0003b150: 7472 7563 7475 7265 2065 6c65 6d65 6e74  tructure element
+0003b160: 732c 2074 6865 7920 6172 6520 636c 6561  s, they are clea
+0003b170: 726c 7920 7468 696e 6b69 6e67 2061 626f  rly thinking abo
+0003b180: 7574 2073 6574 7469 6e67 2074 6865 2063  ut setting the c
+0003b190: 6869 6c64 7265 6e0d 0a20 2020 2020 2020  hildren..       
+0003b1a0: 2020 2020 2073 656c 662e 5f63 6869 6c64       self._child
+0003b1b0: 7265 6e2e 636c 6561 7228 290d 0a20 2020  ren.clear()..   
+0003b1c0: 2020 2020 2020 2020 2073 656c 662e 5f63           self._c
+0003b1d0: 6869 6c64 7265 6e2e 6170 7065 6e64 2876  hildren.append(v
+0003b1e0: 616c 290d 0a0d 0a20 2020 2023 4070 726f  al)....    #@pro
+0003b1f0: 7065 7274 790d 0a20 2020 2023 6465 6620  perty..    #def 
+0003b200: 6465 7363 656e 6461 6e74 2873 656c 662c  descendant(self,
+0003b210: 6974 656d 293a 0d0a 2020 2020 2320 2020  item):..    #   
+0003b220: 2072 6574 7572 6e20 7365 6c66 2e64 6573   return self.des
+0003b230: 6365 6e64 616e 7473 5b69 7465 6d5d 5b30  cendants[item][0
+0003b240: 5d0d 0a0d 0a20 2020 2040 7072 6f70 6572  ]....    @proper
+0003b250: 7479 0d0a 2020 2020 6465 6620 7061 7468  ty..    def path
+0003b260: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
+0003b270: 2027 2727 526f 7574 6520 6672 6f6d 2074   '''Route from t
+0003b280: 6865 2073 7472 7563 7475 7265 2074 6f20  he structure to 
+0003b290: 7468 6973 2053 7472 7563 7475 7265 456c  this StructureEl
+0003b2a0: 656d 656e 740d 0a0d 0a20 2020 2020 2020  ement....       
+0003b2b0: 2052 6574 7572 6e73 2061 2073 7472 696e   Returns a strin
+0003b2c0: 6720 7769 7468 2074 6865 2053 7472 7563  g with the Struc
+0003b2d0: 7475 7265 2073 686f 7274 6e61 6d65 2c20  ture shortname, 
+0003b2e0: 7468 656e 2061 2064 6f74 2c20 666f 6c6c  then a dot, foll
+0003b2f0: 6f77 6564 2062 7920 456c 656d 656e 7420  owed by Element 
+0003b300: 7368 6f72 746e 616d 6573 2064 6f77 6e20  shortnames down 
+0003b310: 7468 6520 6869 6572 6172 6368 7920 7365  the hierarchy se
+0003b320: 7061 7261 7465 6420 6279 2066 6f72 7761  parated by forwa
+0003b330: 7264 2073 6c61 7368 6573 2e0d 0a20 2020  rd slashes...   
+0003b340: 2020 2020 203e 3e3e 206d 795f 7374 7275       >>> my_stru
+0003b350: 6374 7572 655f 656c 656d 656e 742e 7061  cture_element.pa
+0003b360: 7468 2829 0d0a 2020 2020 2020 2020 2753  th()..        'S
+0003b370: 5041 4d2e 4241 434f 4e2f 4547 4753 270d  PAM.BACON/EGGS'.
+0003b380: 0a20 2020 2020 2020 2027 2727 0d0a 2020  .        '''..  
+0003b390: 2020 2020 2020 6966 2073 656c 662e 7374        if self.st
+0003b3a0: 7275 6374 7572 6520 6973 204e 6f6e 6520  ructure is None 
+0003b3b0: 6f72 2073 656c 662e 7374 7275 6374 7572  or self.structur
+0003b3c0: 652e 7368 6f72 7463 6f64 6520 6973 204e  e.shortcode is N
+0003b3d0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0003b3e0: 2020 7265 7475 726e 2027 2e27 202b 2027    return '.' + '
+0003b3f0: 2f27 2e6a 6f69 6e28 5b61 2e73 686f 7274  /'.join([a.short
+0003b400: 636f 6465 2066 6f72 2061 2069 6e20 7365  code for a in se
+0003b410: 6c66 2e61 6e63 6573 746f 7273 5d5b 3a3a  lf.ancestors][::
+0003b420: 2d31 5d2b 5b73 656c 662e 7368 6f72 746e  -1]+[self.shortn
+0003b430: 616d 655d 290d 0a20 2020 2020 2020 2065  ame])..        e
+0003b440: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0003b450: 2020 7265 7475 726e 2073 656c 662e 7374    return self.st
+0003b460: 7275 6374 7572 652e 7368 6f72 7463 6f64  ructure.shortcod
+0003b470: 6520 2b20 2027 2e27 202b 2027 2f27 2e6a  e +  '.' + '/'.j
+0003b480: 6f69 6e28 5b61 2e73 686f 7274 636f 6465  oin([a.shortcode
+0003b490: 2066 6f72 2061 2069 6e20 7365 6c66 2e61   for a in self.a
+0003b4a0: 6e63 6573 746f 7273 5d5b 3a3a 2d31 5d2b  ncestors][::-1]+
+0003b4b0: 5b73 656c 662e 7368 6f72 746e 616d 655d  [self.shortname]
+0003b4c0: 290d 0a0d 0a20 2020 2040 7072 6f70 6572  )....    @proper
+0003b4d0: 7479 0d0a 2020 2020 6465 6620 6c65 7665  ty..    def leve
+0003b4e0: 6c28 7365 6c66 293a 0d0a 2020 2020 2020  l(self):..      
+0003b4f0: 2020 2727 2772 6574 7572 6e20 7468 6520    '''return the 
+0003b500: 7a65 726f 2d62 6173 6564 2064 6570 7468  zero-based depth
+0003b510: 206f 6620 7468 6973 2073 7472 7563 7475   of this structu
+0003b520: 7265 2066 726f 6d20 7468 6520 726f 6f74  re from the root
+0003b530: 2727 270d 0a20 2020 2020 2020 2072 6574  '''..        ret
+0003b540: 7572 6e20 6c65 6e28 6c69 7374 2873 656c  urn len(list(sel
+0003b550: 662e 616e 6365 7374 6f72 7329 290d 0a0d  f.ancestors))...
+0003b560: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+0003b570: 2020 2020 6465 6620 6465 7074 6873 2873      def depths(s
+0003b580: 656c 6629 3a0d 0a20 2020 2020 2020 2027  elf):..        '
+0003b590: 2727 7265 7475 726e 2061 2064 6963 7469  ''return a dicti
+0003b5a0: 6f6e 6172 7920 6f66 2064 6570 7468 7320  onary of depths 
+0003b5b0: 2866 726f 6d20 726f 6f74 2920 616e 6420  (from root) and 
+0003b5c0: 6c69 7374 206f 6620 5374 7275 6374 7572  list of Structur
+0003b5d0: 6545 6c65 6d65 6e74 7320 6174 2074 6861  eElements at tha
+0003b5e0: 7420 6465 7074 6827 2727 0d0a 2020 2020  t depth'''..    
+0003b5f0: 2020 2020 5f64 6570 7468 7320 3d20 7b7d      _depths = {}
+0003b600: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
+0003b610: 7365 2c20 6c65 7665 6c20 696e 2073 656c  se, level in sel
+0003b620: 662e 7761 6c6b 5f77 6974 685f 6c65 7665  f.walk_with_leve
+0003b630: 6c73 2829 3a0d 0a20 2020 2020 2020 2020  ls():..         
+0003b640: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+0003b650: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0003b660: 5f65 6c65 6d65 6e74 735f 6174 5f74 6869  _elements_at_thi
+0003b670: 735f 6465 7074 6820 203d 205f 6465 7074  s_depth  = _dept
+0003b680: 6873 5b6c 6576 656c 5d0d 0a20 2020 2020  hs[level]..     
+0003b690: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
+0003b6a0: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
+0003b6b0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+0003b6c0: 5f65 6c65 6d65 6e74 735f 6174 5f74 6869  _elements_at_thi
+0003b6d0: 735f 6465 7074 6820 203d 205b 5d0d 0a0d  s_depth  = []...
+0003b6e0: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
+0003b6f0: 7265 6e74 5f65 6c65 6d65 6e74 735f 6174  rent_elements_at
+0003b700: 5f74 6869 735f 6465 7074 682e 6170 7065  _this_depth.appe
+0003b710: 6e64 2873 6529 0d0a 2020 2020 2020 2020  nd(se)..        
+0003b720: 2020 2020 5f64 6570 7468 735b 6c65 7665      _depths[leve
+0003b730: 6c5d 203d 2063 7572 7265 6e74 5f65 6c65  l] = current_ele
+0003b740: 6d65 6e74 735f 6174 5f74 6869 735f 6465  ments_at_this_de
+0003b750: 7074 680d 0a0d 0a20 2020 2020 2020 2072  pth....        r
+0003b760: 6574 7572 6e20 5f64 6570 7468 730d 0a0d  eturn _depths...
+0003b770: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+0003b780: 2020 2020 6465 6620 7368 616c 6c6f 776e      def shallown
+0003b790: 6573 7365 7328 7365 6c66 293a 0d0a 2020  esses(self):..  
+0003b7a0: 2020 2020 2020 2727 2772 6574 7572 6e20        '''return 
+0003b7b0: 6120 6469 6374 696f 6e61 7279 206f 6620  a dictionary of 
+0003b7c0: 7368 616c 6c6f 776e 6573 7365 7320 2866  shallownesses (f
+0003b7d0: 726f 6d20 6c65 6166 2920 616e 6420 6c69  rom leaf) and li
+0003b7e0: 7374 206f 6620 5374 7275 6374 7572 6545  st of StructureE
+0003b7f0: 6c65 6d65 6e74 7320 6174 2074 6861 7420  lements at that 
+0003b800: 6465 7074 6827 2727 0d0a 0d0a 0d0a 2020  depth'''......  
+0003b810: 2020 2020 2020 6966 2073 656c 662e 6973        if self.is
+0003b820: 5f6c 6561 663a 0d0a 2020 2020 2020 2020  _leaf:..        
+0003b830: 2020 2020 2352 6574 7572 6e20 7368 616c      #Return shal
+0003b840: 6c6f 776e 6573 7320 6f66 2073 656c 6620  lowness of self 
+0003b850: 2869 2e65 2e20 3029 2061 6e64 2061 206c  (i.e. 0) and a l
+0003b860: 6973 7420 6f66 2073 7472 7563 7475 7265  ist of structure
+0003b870: 2065 6c65 6d65 6e74 7320 6174 2074 6869   elements at thi
+0003b880: 7320 7368 616c 6c6f 776e 6573 7320 2869  s shallowness (i
+0003b890: 2e65 2e20 5b73 656c 665d 2920 696e 2061  .e. [self]) in a
+0003b8a0: 2064 6963 7469 6f6e 6172 790d 0a20 2020   dictionary..   
+0003b8b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0003b8c0: 7b30 3a5b 7365 6c66 5d7d 0d0a 2020 2020  {0:[self]}..    
+0003b8d0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0003b8e0: 2020 2020 2020 205f 7368 616c 6c6f 776e         _shallown
+0003b8f0: 6573 7365 7320 3d20 7b7d 0d0a 2020 2020  esses = {}..    
+0003b900: 2020 2020 2020 2020 666f 7220 6368 2069          for ch i
+0003b910: 6e20 7365 6c66 2e63 6869 6c64 7265 6e3a  n self.children:
+0003b920: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003b930: 2020 666f 7220 7368 616c 6c6f 776e 6573    for shallownes
+0003b940: 732c 206c 6973 745f 6f66 5f73 7472 7563  s, list_of_struc
+0003b950: 7475 7265 5f65 6c65 6d65 6e74 7320 696e  ture_elements in
+0003b960: 2063 682e 7368 616c 6c6f 776e 6573 7365   ch.shallownesse
+0003b970: 732e 6974 656d 7328 293a 0d0a 2020 2020  s.items():..    
+0003b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003b990: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0003b9a0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
+0003b9b0: 7272 656e 745f 656c 656d 656e 7473 5f61  rrent_elements_a
+0003b9c0: 745f 7468 6973 5f73 6861 6c6c 6f77 6e65  t_this_shallowne
+0003b9d0: 7373 2020 3d20 5f73 6861 6c6c 6f77 6e65  ss  = _shallowne
+0003b9e0: 7373 6573 5b73 6861 6c6c 6f77 6e65 7373  sses[shallowness
+0003b9f0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0003ba00: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
+0003ba10: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
+0003ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ba30: 2063 7572 7265 6e74 5f65 6c65 6d65 6e74   current_element
+0003ba40: 735f 6174 5f74 6869 735f 7368 616c 6c6f  s_at_this_shallo
+0003ba50: 776e 6573 7320 203d 205b 5d0d 0a0d 0a20  wness  = [].... 
+0003ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ba70: 2020 2063 7572 7265 6e74 5f65 6c65 6d65     current_eleme
+0003ba80: 6e74 735f 6174 5f74 6869 735f 7368 616c  nts_at_this_shal
+0003ba90: 6c6f 776e 6573 7320 2b3d 206c 6973 745f  lowness += list_
+0003baa0: 6f66 5f73 7472 7563 7475 7265 5f65 6c65  of_structure_ele
+0003bab0: 6d65 6e74 730d 0a20 2020 2020 2020 2020  ments..         
+0003bac0: 2020 2020 2020 2020 2020 205f 7368 616c             _shal
+0003bad0: 6c6f 776e 6573 7365 735b 7368 616c 6c6f  lownesses[shallo
+0003bae0: 776e 6573 735d 203d 2063 7572 7265 6e74  wness] = current
+0003baf0: 5f65 6c65 6d65 6e74 735f 6174 5f74 6869  _elements_at_thi
+0003bb00: 735f 7368 616c 6c6f 776e 6573 730d 0a0d  s_shallowness...
+0003bb10: 0a20 2020 2020 2020 2020 2020 2023 576f  .            #Wo
+0003bb20: 726b 206f 7574 2073 6861 6c6c 6f77 6e65  rk out shallowne
+0003bb30: 7373 206f 6620 7365 6c66 0d0a 2020 2020  ss of self..    
+0003bb40: 2020 2020 2020 2020 7365 6c66 5f73 6861          self_sha
+0003bb50: 6c6c 6f77 6e65 7373 203d 206c 656e 285f  llowness = len(_
+0003bb60: 7368 616c 6c6f 776e 6573 7365 7329 0d0a  shallownesses)..
+0003bb70: 2020 2020 2020 2020 2020 2020 2341 6464              #Add
+0003bb80: 2073 656c 6620 746f 205f 7368 616c 6c6f   self to _shallo
+0003bb90: 776e 6573 7365 730d 0a20 2020 2020 2020  wnesses..       
+0003bba0: 2020 2020 205f 7368 616c 6c6f 776e 6573       _shallownes
+0003bbb0: 7365 735b 7365 6c66 5f73 6861 6c6c 6f77  ses[self_shallow
+0003bbc0: 6e65 7373 5d20 3d20 5b73 656c 665d 0d0a  ness] = [self]..
+0003bbd0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0003bbe0: 7475 726e 205f 7368 616c 6c6f 776e 6573  turn _shallownes
+0003bbf0: 7365 730d 0a0d 0a20 2020 2064 6566 2077  ses....    def w
+0003bc00: 616c 6b28 7365 6c66 2c6c 6576 656c 3d4e  alk(self,level=N
+0003bc10: 6f6e 652c 7065 726d 6973 7369 7665 3d54  one,permissive=T
+0003bc20: 7275 6529 3a0d 0a20 2020 2020 2020 2027  rue):..        '
+0003bc30: 2727 0d0a 2020 2020 2020 2020 5669 7369  ''..        Visi
+0003bc40: 7420 6576 6572 7920 6465 7363 656e 6461  t every descenda
+0003bc50: 6e74 2065 6c65 6d65 6e74 2069 6e20 6120  nt element in a 
+0003bc60: 5374 7275 6374 7572 6520 656c 656d 656e  Structure elemen
+0003bc70: 7420 696e 2074 7572 6e2e 0d0a 2020 2020  t in turn...    
+0003bc80: 2020 2020 5468 6520 7472 6565 2069 7320      The tree is 
+0003bc90: 7472 6176 6572 7365 6420 6465 7074 682d  traversed depth-
+0003bca0: 6669 7273 742c 2077 6974 6820 7468 6520  first, with the 
+0003bcb0: 6669 7273 7420 6368 696c 6420 6f66 2074  first child of t
+0003bcc0: 6865 2066 6972 7374 2063 6869 6c64 206f  he first child o
+0003bcd0: 6620 7468 6520 6669 7273 7420 6368 696c  f the first chil
+0003bce0: 6420 6265 696e 6720 7669 7369 7465 6420  d being visited 
+0003bcf0: 6265 666f 7265 2074 6865 2073 6563 6f6e  before the secon
+0003bd00: 6420 6368 696c 6420 6f66 2074 6865 2066  d child of the f
+0003bd10: 6972 7374 2063 6869 6c64 206f 6620 7468  irst child of th
+0003bd20: 6520 6669 7273 7420 6368 696c 6420 6973  e first child is
+0003bd30: 2076 6973 6974 6564 0d0a 0d0a 2020 2020   visited....    
+0003bd40: 2020 2020 3a70 6172 616d 206c 6576 656c      :param level
+0003bd50: 3a20 4465 7072 6563 6174 6564 202d 2064  : Deprecated - d
+0003bd60: 6f20 6e6f 7420 7365 7420 7468 6973 0d0a  o not set this..
+0003bd70: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+0003bd80: 6572 6d69 7373 6976 653a 2044 6570 7265  ermissive: Depre
+0003bd90: 6361 7465 640d 0a20 2020 2020 2020 2027  cated..        '
+0003bda0: 2727 0d0a 2020 2020 2020 2020 6966 206c  ''..        if l
+0003bdb0: 6576 656c 3d3d 4e6f 6e65 3a0d 0a20 2020  evel==None:..   
+0003bdc0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0003bdd0: 7065 726d 6973 7369 7665 3a0d 0a20 2020  permissive:..   
+0003bde0: 2020 2020 2020 2020 2020 2020 2061 7373               ass
+0003bdf0: 6572 7420 7365 6c66 2e69 735f 726f 6f74  ert self.is_root
+0003be00: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0003be10: 6c65 7665 6c3d 300d 0a0d 0a20 2020 2020  level=0....     
+0003be20: 2020 2079 6965 6c64 2073 656c 660d 0a0d     yield self...
+0003be30: 0a20 2020 2020 2020 2023 5059 4d2d 3635  .        #PYM-65
+0003be40: 202d 2069 6620 7765 2064 6f6e 2774 2063   - if we don't c
+0003be50: 7265 6174 6520 6120 6c69 7374 2068 6572  reate a list her
+0003be60: 652c 2063 616c 6c73 2074 6f20 6765 745f  e, calls to get_
+0003be70: 656c 656d 656e 7473 2077 6974 6869 6e20  elements within 
+0003be80: 7468 6520 7761 6c6b 2063 6175 7365 2065  the walk cause e
+0003be90: 6172 6c79 2074 6572 6d69 6e61 7469 6f6e  arly termination
+0003bea0: 202d 206e 6f74 2073 7572 6520 7768 7920   - not sure why 
+0003beb0: 7468 6973 2066 6978 6573 2069 740d 0a20  this fixes it.. 
+0003bec0: 2020 2020 2020 2066 6f72 2065 2069 6e20         for e in 
+0003bed0: 6c69 7374 2873 656c 662e 6368 696c 6472  list(self.childr
+0003bee0: 656e 293a 0d0a 2020 2020 2020 2020 2020  en):..          
+0003bef0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+0003bf00: 2020 2020 2020 2020 7969 656c 6420 6672          yield fr
+0003bf10: 6f6d 2065 2e77 616c 6b28 6c65 7665 6c3d  om e.walk(level=
+0003bf20: 6c65 7665 6c2b 312c 7065 726d 6973 7369  level+1,permissi
+0003bf30: 7665 3d70 6572 6d69 7373 6976 6529 0d0a  ve=permissive)..
+0003bf40: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0003bf50: 7074 2052 6563 7572 7369 6f6e 4572 726f  pt RecursionErro
+0003bf60: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+0003bf70: 2020 2020 2357 6527 7665 2067 6f6e 6520      #We've gone 
+0003bf80: 746f 6f20 6465 6570 2c20 7468 6572 6520  too deep, there 
+0003bf90: 6d75 7374 2062 6520 736f 6d65 2073 6f72  must be some sor
+0003bfa0: 7420 6f66 206c 6f6f 7020 696e 2074 6865  t of loop in the
+0003bfb0: 2068 6965 7261 7263 6879 0d0a 2020 2020   hierarchy..    
+0003bfc0: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+0003bfd0: 6e74 206f 7574 2074 6865 2070 6172 656e  nt out the paren
+0003bfe0: 7473 0d0a 2020 2020 2020 2020 2020 2020  ts..            
+0003bff0: 2020 2020 656c 3d73 656c 660d 0a20 2020      el=self..   
+0003c000: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+0003c010: 2e65 7272 6f72 2827 5265 6375 7273 696f  .error('Recursio
+0003c020: 6e20 6572 726f 722e 2053 686f 7769 6e67  n error. Showing
+0003c030: 2065 6c65 6d65 6e74 7320 6d6f 7669 6e67   elements moving
+0003c040: 2075 7020 7468 6520 6869 6572 6172 6368   up the hierarch
+0003c050: 792c 2070 6c65 6173 6520 7472 7920 746f  y, please try to
+0003c060: 2064 6574 6563 7420 6c6f 6f70 2c20 616e   detect loop, an
+0003c070: 6420 6669 7820 6974 2e27 290d 0a20 2020  d fix it.')..   
+0003c080: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0003c090: 2069 2069 6e20 7261 6e67 6528 3230 293a   i in range(20):
+0003c0a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003c0b0: 2020 2020 2020 6c6f 672e 6572 726f 7228        log.error(
+0003c0c0: 2752 6563 7572 7369 6f6e 2065 7272 6f72  'Recursion error
+0003c0d0: 2e20 456e 7469 7479 2073 686f 7274 6e61  . Entity shortna
+0003c0e0: 6d65 3d27 2b65 6c2e 7368 6f72 746e 616d  me='+el.shortnam
+0003c0f0: 652b 2720 7061 7265 6e74 3d27 2b72 6570  e+' parent='+rep
+0003c100: 7228 656c 2e70 6172 656e 7429 290d 0a20  r(el.parent)).. 
+0003c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c120: 2020 2065 6c3d 656c 2e70 6172 656e 740d     el=el.parent.
+0003c130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c140: 2023 4361 6e27 7420 6a75 7374 2072 6572   #Can't just rer
+0003c150: 6169 7365 2c20 6f72 2077 6520 7769 6c6c  aise, or we will
+0003c160: 2072 652d 6361 7463 6820 7468 6520 7361   re-catch the sa
+0003c170: 6d65 2072 6563 7572 7369 6f6e 2065 7272  me recursion err
+0003c180: 6f72 2067 6f69 6e67 2062 6163 6b20 7570  or going back up
+0003c190: 2074 6865 2074 7265 6521 0d0a 2020 2020   the tree!..    
+0003c1a0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0003c1b0: 6520 5379 7374 656d 4572 726f 7228 290d  e SystemError().
+0003c1c0: 0a0d 0a20 2020 2064 6566 2077 616c 6b5f  ...    def walk_
+0003c1d0: 7769 7468 5f6c 6576 656c 7328 7365 6c66  with_levels(self
+0003c1e0: 2c6c 6576 656c 3d30 2c70 6572 6d69 7373  ,level=0,permiss
+0003c1f0: 6976 653d 5472 7565 293a 0d0a 2020 2020  ive=True):..    
+0003c200: 2020 2020 2727 2759 6965 6c64 2061 6c6c      '''Yield all
+0003c210: 2065 6c65 6d65 6e74 7320 696e 2061 2073   elements in a s
+0003c220: 7472 7563 7475 7265 2c20 6265 6769 6e6e  tructure, beginn
+0003c230: 696e 6720 7769 7468 2074 6865 2072 6f6f  ing with the roo
+0003c240: 742e 2041 7420 7468 6520 7361 6d65 2074  t. At the same t
+0003c250: 696d 6520 7969 656c 6420 7468 6520 6c65  ime yield the le
+0003c260: 7665 6c20 7468 6174 2077 6520 6172 6520  vel that we are 
+0003c270: 696e 2069 6e20 7468 6520 6869 6572 6172  in in the hierar
+0003c280: 6368 792e 0d0a 0d0a 2020 2020 2020 2020  chy.....        
+0003c290: 3a70 6172 616d 206c 6576 656c 3a20 496e  :param level: In
+0003c2a0: 6974 6961 6c20 6c65 7665 6c20 7765 2061  itial level we a
+0003c2b0: 7265 2063 6f75 6e74 696e 6720 6672 6f6d  re counting from
+0003c2c0: 2e20 4465 6661 756c 7473 2074 6f20 300d  . Defaults to 0.
+0003c2d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0003c2e0: 7065 726d 6973 7369 7665 3a20 4465 7072  permissive: Depr
+0003c2f0: 6563 6174 6564 0d0a 2020 2020 2020 2020  ecated..        
+0003c300: 2727 270d 0a20 2020 2020 2020 2079 6965  '''..        yie
+0003c310: 6c64 2073 656c 662c 206c 6576 656c 0d0a  ld self, level..
+0003c320: 0d0a 2020 2020 2020 2020 2350 594d 2d36  ..        #PYM-6
+0003c330: 3520 2d20 6966 2077 6520 646f 6e27 7420  5 - if we don't 
+0003c340: 6372 6561 7465 2061 206c 6973 7420 6865  create a list he
+0003c350: 7265 2c20 6361 6c6c 7320 746f 2067 6574  re, calls to get
+0003c360: 5f65 6c65 6d65 6e74 7320 7769 7468 696e  _elements within
+0003c370: 2074 6865 2077 616c 6b20 6361 7573 6520   the walk cause 
+0003c380: 6561 726c 7920 7465 726d 696e 6174 696f  early terminatio
+0003c390: 6e20 2d20 6e6f 7420 7375 7265 2077 6879  n - not sure why
+0003c3a0: 2074 6869 7320 6669 7865 7320 6974 0d0a   this fixes it..
+0003c3b0: 2020 2020 2020 2020 666f 7220 6520 696e          for e in
+0003c3c0: 206c 6973 7428 7365 6c66 2e63 6869 6c64   list(self.child
+0003c3d0: 7265 6e29 3a0d 0a20 2020 2020 2020 2020  ren):..         
+0003c3e0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+0003c3f0: 2020 2020 2020 2020 2079 6965 6c64 2066           yield f
+0003c400: 726f 6d20 652e 7761 6c6b 5f77 6974 685f  rom e.walk_with_
+0003c410: 6c65 7665 6c73 286c 6576 656c 3d6c 6576  levels(level=lev
+0003c420: 656c 2b31 2c70 6572 6d69 7373 6976 653d  el+1,permissive=
+0003c430: 7065 726d 6973 7369 7665 290d 0a20 2020  permissive)..   
+0003c440: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0003c450: 5265 6375 7273 696f 6e45 7272 6f72 3a0d  RecursionError:.
+0003c460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c470: 2023 5765 2776 6520 676f 6e65 2074 6f6f   #We've gone too
+0003c480: 2064 6565 702c 2074 6865 7265 206d 7573   deep, there mus
+0003c490: 7420 6265 2073 6f6d 6520 736f 7274 206f  t be some sort o
+0003c4a0: 6620 6c6f 6f70 2069 6e20 7468 6520 6869  f loop in the hi
+0003c4b0: 6572 6172 6368 790d 0a20 2020 2020 2020  erarchy..       
+0003c4c0: 2020 2020 2020 2020 2023 7072 696e 7420           #print 
+0003c4d0: 6f75 7420 7468 6520 7061 7265 6e74 730d  out the parents.
+0003c4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003c4f0: 2065 6c3d 7365 6c66 0d0a 2020 2020 2020   el=self..      
+0003c500: 2020 2020 2020 2020 2020 6c6f 672e 6572            log.er
+0003c510: 726f 7228 2752 6563 7572 7369 6f6e 2065  ror('Recursion e
+0003c520: 7272 6f72 2e20 5368 6f77 696e 6720 656c  rror. Showing el
+0003c530: 656d 656e 7473 206d 6f76 696e 6720 7570  ements moving up
+0003c540: 2074 6865 2068 6965 7261 7263 6879 2c20   the hierarchy, 
+0003c550: 706c 6561 7365 2074 7279 2074 6f20 6465  please try to de
+0003c560: 7465 6374 206c 6f6f 702c 2061 6e64 2066  tect loop, and f
+0003c570: 6978 2069 742e 2729 0d0a 2020 2020 2020  ix it.')..      
+0003c580: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
+0003c590: 696e 2072 616e 6765 2832 3029 3a0d 0a20  in range(20):.. 
+0003c5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c5b0: 2020 206c 6f67 2e65 7272 6f72 2827 5265     log.error('Re
+0003c5c0: 6375 7273 696f 6e20 6572 726f 722e 2045  cursion error. E
+0003c5d0: 6e74 6974 7920 7368 6f72 746e 616d 653d  ntity shortname=
+0003c5e0: 272b 656c 2e73 686f 7274 6e61 6d65 2b27  '+el.shortname+'
+0003c5f0: 2070 6172 656e 743d 272b 7265 7072 2865   parent='+repr(e
+0003c600: 6c2e 7061 7265 6e74 2929 0d0a 2020 2020  l.parent))..    
+0003c610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003c620: 656c 3d65 6c2e 7061 7265 6e74 0d0a 2020  el=el.parent..  
+0003c630: 2020 2020 2020 2020 2020 2020 2020 2343                #C
+0003c640: 616e 2774 206a 7573 7420 7265 7261 6973  an't just rerais
+0003c650: 652c 206f 7220 7765 2077 696c 6c20 7265  e, or we will re
+0003c660: 2d63 6174 6368 2074 6865 2073 616d 6520  -catch the same 
+0003c670: 7265 6375 7273 696f 6e20 6572 726f 7220  recursion error 
+0003c680: 676f 696e 6720 6261 636b 2075 7020 7468  going back up th
+0003c690: 6520 7472 6565 210d 0a20 2020 2020 2020  e tree!..       
+0003c6a0: 2020 2020 2020 2020 2072 6169 7365 2053           raise S
+0003c6b0: 7973 7465 6d45 7272 6f72 2829 0d0a 0d0a  ystemError()....
+0003c6c0: 2020 2020 6465 6620 7761 6c6b 5f73 7562      def walk_sub
+0003c6d0: 7472 6565 2873 656c 662c 7375 6274 7265  tree(self,subtre
+0003c6e0: 655f 7368 6f72 746e 616d 652c 2070 6572  e_shortname, per
+0003c6f0: 6d69 7373 6976 653d 5472 7565 293a 0d0a  missive=True):..
+0003c700: 2020 2020 2020 2020 2727 2757 616c 6b20          '''Walk 
+0003c710: 6120 7472 6565 2073 7461 7274 696e 6720  a tree starting 
+0003c720: 6174 2073 656c 6620 2861 2072 6f6f 7420  at self (a root 
+0003c730: 6e6f 6465 2920 7265 7475 726e 696e 6720  node) returning 
+0003c740: 6f6e 6c79 2074 6865 2073 7562 2d74 7265  only the sub-tre
+0003c750: 6520 7370 6563 6966 6965 6420 6279 2074  e specified by t
+0003c760: 6865 2073 686f 7274 6e61 6d65 0d0a 0d0a  he shortname....
+0003c770: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+0003c780: 7562 7472 6565 5f73 686f 7274 6e61 6d65  ubtree_shortname
+0003c790: 3a20 456d 706f 7765 7220 5368 6f72 7420  : Empower Short 
+0003c7a0: 4e61 6d65 206f 6620 7468 6520 5374 7275  Name of the Stru
+0003c7b0: 6374 7572 6520 456c 656d 656e 7420 7765  cture Element we
+0003c7c0: 2077 616e 7420 746f 2073 7461 7274 2079   want to start y
+0003c7d0: 6965 6c64 696e 6720 6974 656d 7320 6672  ielding items fr
+0003c7e0: 6f6d 0d0a 2020 2020 2020 2020 3a70 6172  om..        :par
+0003c7f0: 616d 2070 6572 6d69 7373 6976 653a 2049  am permissive: I
+0003c800: 6620 7765 206b 6e6f 7720 7468 6174 2077  f we know that w
+0003c810: 6520 6861 7665 2061 6e20 756e 616d 6269  e have an unambi
+0003c820: 6775 6f75 7320 656c 656d 656e 7420 7468  guous element th
+0003c830: 656e 2064 6f20 6e6f 7420 6173 7365 7274  en do not assert
+0003c840: 2074 6861 7420 7765 2061 7265 2075 7369   that we are usi
+0003c850: 6e67 2061 2072 6f6f 7420 6e6f 6465 202d  ng a root node -
+0003c860: 2074 6869 7320 6973 2065 7370 6563 6961   this is especia
+0003c870: 6c6c 7920 676f 6f64 2069 6e20 6765 745f  lly good in get_
+0003c880: 6c65 6176 6573 2829 2077 6865 6e20 7765  leaves() when we
+0003c890: 2064 6f6e 2774 2063 6172 650d 0a20 2020   don't care..   
+0003c8a0: 2020 2020 2027 2727 0d0a 0d0a 2020 2020       '''....    
+0003c8b0: 2020 2020 2343 616e 206f 6e6c 7920 6265      #Can only be
+0003c8c0: 2063 616c 6c65 6420 6672 6f6d 2061 2072   called from a r
+0003c8d0: 6f6f 7420 6e6f 6465 202d 2074 6869 7320  oot node - this 
+0003c8e0: 6176 6f69 6473 2074 6865 2072 6574 7572  avoids the retur
+0003c8f0: 6e65 6420 7375 6274 7265 6520 6265 696e  ned subtree bein
+0003c900: 6720 616d 6269 6775 6f75 732c 2073 696e  g ambiguous, sin
+0003c910: 6365 2073 686f 7274 6e61 6d65 7320 6d61  ce shortnames ma
+0003c920: 7920 6170 7065 6172 2069 6e20 6d6f 7265  y appear in more
+0003c930: 2074 6861 6e20 6120 7369 6e67 6c65 2074   than a single t
+0003c940: 7265 6520 696e 2074 6865 2073 7472 7563  ree in the struc
+0003c950: 7475 7265 0d0a 2020 2020 2020 2020 2348  ture..        #H
+0003c960: 6f77 6576 6572 2073 696e 6365 2077 6520  owever since we 
+0003c970: 736f 6d65 7469 6d65 7320 6b6e 6f77 2074  sometimes know t
+0003c980: 6865 2073 7472 7563 7475 7265 2065 6c65  he structure ele
+0003c990: 6d65 6e74 2077 6520 6172 6520 6361 6c6c  ment we are call
+0003c9a0: 696e 6720 6672 6f6d 2c20 7765 2061 6c6c  ing from, we all
+0003c9b0: 6f77 2074 6869 7320 746f 2062 6520 7065  ow this to be pe
+0003c9c0: 726d 6973 7369 7665 0d0a 2020 2020 2020  rmissive..      
+0003c9d0: 2020 6966 206e 6f74 2070 6572 6d69 7373    if not permiss
+0003c9e0: 6976 653a 0d0a 2020 2020 2020 2020 2020  ive:..          
+0003c9f0: 2020 6173 7365 7274 2073 656c 662e 6973    assert self.is
+0003ca00: 5f72 6f6f 740d 0a0d 0a20 2020 2020 2020  _root....       
+0003ca10: 2073 7562 7472 6565 5f73 7461 7274 5f73   subtree_start_s
+0003ca20: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+0003ca30: 3d4e 6f6e 650d 0a0d 0a20 2020 2020 2020  =None....       
+0003ca40: 2066 6f72 2073 6520 696e 2073 656c 662e   for se in self.
+0003ca50: 7761 6c6b 2870 6572 6d69 7373 6976 653d  walk(permissive=
+0003ca60: 7065 726d 6973 7369 7665 293a 0d0a 2020  permissive):..  
+0003ca70: 2020 2020 2020 2020 2020 6c6f 672e 6465            log.de
+0003ca80: 6275 6728 2777 616c 6b5f 7375 6274 7265  bug('walk_subtre
+0003ca90: 6520 666f 756e 6420 5b27 2b73 652e 7368  e found ['+se.sh
+0003caa0: 6f72 746e 616d 652b 275d 2069 6e20 7365  ortname+'] in se
+0003cab0: 6c66 2e77 616c 6b27 290d 0a20 2020 2020  lf.walk')..     
+0003cac0: 2020 2020 2020 2023 4465 7465 6374 2074         #Detect t
+0003cad0: 6865 2073 7461 7274 206f 6620 7468 6520  he start of the 
+0003cae0: 7375 6274 7265 652c 2061 6e64 2072 6563  subtree, and rec
+0003caf0: 6f72 6420 7468 6520 6c65 7665 6c2c 2073  ord the level, s
+0003cb00: 6f20 7765 206b 6e6f 7720 7768 656e 2077  o we know when w
+0003cb10: 6520 6172 6520 6578 6974 696e 6720 7468  e are exiting th
+0003cb20: 6520 7375 6274 7265 650d 0a20 2020 2020  e subtree..     
+0003cb30: 2020 2020 2020 2069 6620 7365 2e73 686f         if se.sho
+0003cb40: 7274 6e61 6d65 3d3d 7375 6274 7265 655f  rtname==subtree_
+0003cb50: 7368 6f72 746e 616d 653a 0d0a 2020 2020  shortname:..    
+0003cb60: 2020 2020 2020 2020 2020 2020 6c6f 672e              log.
+0003cb70: 6465 6275 6728 2777 616c 6b5f 7375 6274  debug('walk_subt
+0003cb80: 7265 6520 666f 756e 6420 5b27 2b73 652e  ree found ['+se.
+0003cb90: 7368 6f72 746e 616d 652b 275d 206d 6174  shortname+'] mat
+0003cba0: 6368 696e 6720 7061 7261 6d65 7465 7220  ching parameter 
+0003cbb0: 7375 6274 7265 655f 5368 6f72 746e 616d  subtree_Shortnam
+0003cbc0: 6520 696e 2073 656c 662e 7761 6c6b 2729  e in self.walk')
+0003cbd0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+0003cbe0: 2020 2020 6966 2073 7562 7472 6565 5f73      if subtree_s
+0003cbf0: 7461 7274 5f73 7472 7563 7475 7265 5f65  tart_structure_e
+0003cc00: 6c65 6d65 6e74 2069 7320 4e6f 6e65 3a0d  lement is None:.
+0003cc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003cc20: 2020 2020 2073 7562 7472 6565 5f73 7461       subtree_sta
+0003cc30: 7274 5f73 7472 7563 7475 7265 5f65 6c65  rt_structure_ele
+0003cc40: 6d65 6e74 3d73 650d 0a20 2020 2020 2020  ment=se..       
+0003cc50: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+0003cc60: 2e64 6562 7567 2827 7761 6c6b 5f73 7562  .debug('walk_sub
+0003cc70: 7472 6565 2073 6574 7469 6e67 2073 7562  tree setting sub
+0003cc80: 7472 6565 2073 7461 7274 2065 6c65 6d65  tree start eleme
+0003cc90: 6e74 3a27 2b73 7472 2873 7562 7472 6565  nt:'+str(subtree
+0003cca0: 5f73 7461 7274 5f73 7472 7563 7475 7265  _start_structure
+0003ccb0: 5f65 6c65 6d65 6e74 2929 0d0a 0d0a 2020  _element))....  
+0003ccc0: 2020 2020 2020 2020 2020 2357 6869 6c65            #While
+0003ccd0: 2077 6520 6172 6520 7769 7468 696e 2061   we are within a
+0003cce0: 2073 7562 7472 6565 2c20 7969 656c 6420   subtree, yield 
+0003ccf0: 7468 6520 5374 7275 6374 7572 6545 6c65  the StructureEle
+0003cd00: 6d65 6e74 7320 7769 7468 696e 0d0a 2020  ments within..  
+0003cd10: 2020 2020 2020 2020 2020 6966 2073 7562            if sub
+0003cd20: 7472 6565 5f73 7461 7274 5f73 7472 7563  tree_start_struc
+0003cd30: 7475 7265 5f65 6c65 6d65 6e74 2069 7320  ture_element is 
+0003cd40: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0003cd50: 2020 2020 2020 2020 2020 2023 5768 656e             #When
+0003cd60: 2077 6520 7265 7475 726e 2074 6f20 7468   we return to th
+0003cd70: 6520 6c65 7665 6c20 6f66 2074 6865 2073  e level of the s
+0003cd80: 7461 7274 206f 6620 7468 6520 7375 6274  tart of the subt
+0003cd90: 7265 6520 286f 7220 6265 6c6f 7729 2077  ree (or below) w
+0003cda0: 6520 6861 7665 2065 7869 7465 6420 7468  e have exited th
+0003cdb0: 6520 7375 6274 7265 652c 2061 6e64 206d  e subtree, and m
+0003cdc0: 6179 2073 746f 700d 0a20 2020 2020 2020  ay stop..       
+0003cdd0: 2020 2020 2020 2020 2069 6620 7365 2e6c           if se.l
+0003cde0: 6576 656c 3c3d 7375 6274 7265 655f 7374  evel<=subtree_st
+0003cdf0: 6172 745f 7374 7275 6374 7572 655f 656c  art_structure_el
+0003ce00: 656d 656e 742e 6c65 7665 6c20 616e 6420  ement.level and 
+0003ce10: 7365 2021 3d20 7375 6274 7265 655f 7374  se != subtree_st
+0003ce20: 6172 745f 7374 7275 6374 7572 655f 656c  art_structure_el
+0003ce30: 656d 656e 743a 0d0a 2020 2020 2020 2020  ement:..        
+0003ce40: 2020 2020 2020 2020 2020 2020 6c6f 672e              log.
+0003ce50: 6465 6275 6728 2777 616c 6b5f 7375 6274  debug('walk_subt
+0003ce60: 7265 6520 6272 6561 6b69 6e67 2061 7420  ree breaking at 
+0003ce70: 7365 3a5b 272b 7365 2e73 686f 7274 6e61  se:['+se.shortna
+0003ce80: 6d65 2b27 5d20 6c65 7665 6c3a 272b 7374  me+'] level:'+st
+0003ce90: 7228 7365 2e6c 6576 656c 2929 0d0a 2020  r(se.level))..  
+0003cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003ceb0: 2020 6272 6561 6b0d 0a20 2020 2020 2020    break..       
+0003cec0: 2020 2020 2020 2020 206c 6f67 2e64 6562           log.deb
+0003ced0: 7567 2827 7761 6c6b 5f73 7562 7472 6565  ug('walk_subtree
+0003cee0: 2079 6965 6c64 696e 6720 5b27 2b73 652e   yielding ['+se.
+0003cef0: 7368 6f72 746e 616d 652b 275d 2729 0d0a  shortname+']')..
+0003cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003cf10: 7969 656c 6420 7365 0d0a 0d0a 0d0a 2020  yield se......  
+0003cf20: 2020 6465 6620 6173 6365 6e64 2873 656c    def ascend(sel
+0003cf30: 662c 2062 795f 6465 7074 6820 3d20 5472  f, by_depth = Tr
+0003cf40: 7565 293a 0d0a 2020 2020 2020 2020 2727  ue):..        ''
+0003cf50: 2754 7261 7665 7273 6520 7472 6565 2066  'Traverse tree f
+0003cf60: 726f 6d20 6c65 6176 6573 2074 6f20 7472  rom leaves to tr
+0003cf70: 756e 6b20 2872 6f6f 7429 0d0a 0d0a 2020  unk (root)....  
+0003cf80: 2020 2020 2020 4279 2064 6570 7468 2064        By depth d
+0003cf90: 6574 6572 6d69 6e65 7320 6966 2074 6865  etermines if the
+0003cfa0: 2070 7269 6d61 7279 2063 6f6e 7369 6465   primary conside
+0003cfb0: 7261 7469 6f6e 2069 7320 7468 6520 6465  ration is the de
+0003cfc0: 7074 6820 6672 6f6d 2074 6865 2072 6f6f  pth from the roo
+0003cfd0: 7420 2862 795f 6465 7074 6820 3d20 5472  t (by_depth = Tr
+0003cfe0: 7565 2920 6f72 2074 6865 2073 6861 6c6c  ue) or the shall
+0003cff0: 6f77 6e65 7373 2066 726f 6d20 7468 6520  owness from the 
+0003d000: 6c65 6176 6573 0d0a 0d0a 2020 2020 2020  leaves....      
+0003d010: 2020 4368 696c 6472 656e 2061 6c77 6179    Children alway
+0003d020: 7320 6765 7420 7265 7475 726e 6564 2062  s get returned b
+0003d030: 6566 6f72 6520 7061 7265 6e74 732c 2062  efore parents, b
+0003d040: 7574 2069 6620 6279 5f64 6570 7468 2069  ut if by_depth i
+0003d050: 7320 5472 7565 2c20 6120 6c65 6166 206e  s True, a leaf n
+0003d060: 6578 7420 746f 2074 6865 2072 6f6f 7420  ext to the root 
+0003d070: 6765 7473 2072 6574 7572 6e65 6420 6c61  gets returned la
+0003d080: 7465 722c 2069 6620 4661 6c73 6520 6120  ter, if False a 
+0003d090: 6c65 6166 206e 6578 7420 746f 2074 6865  leaf next to the
+0003d0a0: 2072 6f6f 7420 7769 6c6c 2062 6520 7265   root will be re
+0003d0b0: 7475 726e 6564 2065 6172 6c69 6572 0d0a  turned earlier..
+0003d0c0: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0003d0d0: 2062 795f 6465 7074 683a 2054 7275 6520   by_depth: True 
+0003d0e0: 6966 2074 6865 2064 6973 7461 6e63 6520  if the distance 
+0003d0f0: 6672 6f6d 2074 6865 2072 6f6f 7420 6973  from the root is
+0003d100: 2075 7365 6420 746f 2064 6574 6572 6d69   used to determi
+0003d110: 6e65 206f 7264 6572 696e 672c 2046 616c  ne ordering, Fal
+0003d120: 7365 2069 6620 6469 7374 616e 6365 2066  se if distance f
+0003d130: 726f 6d20 7468 6520 6c65 6166 2028 692e  rom the leaf (i.
+0003d140: 652e 2073 6861 6c6c 6f77 6e65 7373 2920  e. shallowness) 
+0003d150: 6973 2075 7365 6420 746f 2064 6574 6572  is used to deter
+0003d160: 6d69 6e65 206f 7264 6572 696e 670d 0a20  mine ordering.. 
+0003d170: 2020 2020 2020 2027 2727 0d0a 2020 2020         '''..    
+0003d180: 2020 2020 6966 2062 795f 6465 7074 683a      if by_depth:
+0003d190: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+0003d1a0: 7074 6873 5f61 735f 6c69 7374 5f6f 665f  pths_as_list_of_
+0003d1b0: 7475 706c 6573 203d 205b 286b 2c76 2920  tuples = [(k,v) 
+0003d1c0: 666f 7220 6b2c 7620 696e 2073 656c 662e  for k,v in self.
+0003d1d0: 6465 7074 6873 2e69 7465 6d73 2829 205d  depths.items() ]
+0003d1e0: 0d0a 2020 2020 2020 2020 2020 2020 6465  ..            de
+0003d1f0: 7074 6873 5f61 735f 6c69 7374 5f6f 665f  pths_as_list_of_
+0003d200: 7475 706c 6573 2e73 6f72 7428 7265 7665  tuples.sort(reve
+0003d210: 7273 6520 3d20 5472 7565 290d 0a0d 0a20  rse = True).... 
+0003d220: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
+0003d230: 6570 7468 2c20 7374 7275 6374 7572 655f  epth, structure_
+0003d240: 656c 656d 656e 7473 2069 6e20 6465 7074  elements in dept
+0003d250: 6873 5f61 735f 6c69 7374 5f6f 665f 7475  hs_as_list_of_tu
+0003d260: 706c 6573 3a0d 0a20 2020 2020 2020 2020  ples:..         
+0003d270: 2020 2020 2020 2066 6f72 2073 6520 696e         for se in
+0003d280: 2073 7472 7563 7475 7265 5f65 6c65 6d65   structure_eleme
+0003d290: 6e74 733a 0d0a 2020 2020 2020 2020 2020  nts:..          
+0003d2a0: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
+0003d2b0: 7365 0d0a 0d0a 2020 2020 2020 2020 656c  se....        el
+0003d2c0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+0003d2d0: 2064 6570 7468 735f 6173 5f6c 6973 745f   depths_as_list_
+0003d2e0: 6f66 5f74 7570 6c65 7320 3d20 5b28 6b2c  of_tuples = [(k,
+0003d2f0: 7629 2066 6f72 206b 2c76 2069 6e20 7365  v) for k,v in se
+0003d300: 6c66 2e73 6861 6c6c 6f77 6e65 7373 6573  lf.shallownesses
+0003d310: 2e69 7465 6d73 2829 205d 0d0a 2020 2020  .items() ]..    
+0003d320: 2020 2020 2020 2020 6465 7074 6873 5f61          depths_a
+0003d330: 735f 6c69 7374 5f6f 665f 7475 706c 6573  s_list_of_tuples
+0003d340: 2e73 6f72 7428 290d 0a0d 0a20 2020 2020  .sort()....     
+0003d350: 2020 2020 2020 2066 6f72 2073 6861 6c6c         for shall
+0003d360: 6f77 6e65 7373 2c20 7374 7275 6374 7572  owness, structur
+0003d370: 655f 656c 656d 656e 7473 2069 6e20 6465  e_elements in de
+0003d380: 7074 6873 5f61 735f 6c69 7374 5f6f 665f  pths_as_list_of_
+0003d390: 7475 706c 6573 3a0d 0a20 2020 2020 2020  tuples:..       
+0003d3a0: 2020 2020 2020 2020 2066 6f72 2073 6520           for se 
+0003d3b0: 696e 2073 7472 7563 7475 7265 5f65 6c65  in structure_ele
+0003d3c0: 6d65 6e74 733a 0d0a 2020 2020 2020 2020  ments:..        
+0003d3d0: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+0003d3e0: 6420 7365 0d0a 0d0a 2020 2020 6465 6620  d se....    def 
+0003d3f0: 6465 7363 656e 6428 7365 6c66 2c20 6279  descend(self, by
+0003d400: 5f64 6570 7468 203d 2054 7275 6529 3a0d  _depth = True):.
+0003d410: 0a20 2020 2020 2020 2027 2727 5472 6176  .        '''Trav
+0003d420: 6572 7365 2074 7265 6520 6672 6f6d 2074  erse tree from t
+0003d430: 7275 6e6b 2028 726f 6f74 2920 746f 206c  runk (root) to l
+0003d440: 6561 7665 730d 0a0d 0a20 2020 2020 2020  eaves....       
+0003d450: 2042 7920 6465 7074 6820 6465 7465 726d   By depth determ
+0003d460: 696e 6573 2069 6620 7468 6520 7072 696d  ines if the prim
+0003d470: 6172 7920 636f 6e73 6964 6572 6174 696f  ary consideratio
+0003d480: 6e20 6973 2074 6865 2064 6570 7468 2066  n is the depth f
+0003d490: 726f 6d20 7468 6520 726f 6f74 2028 6279  rom the root (by
+0003d4a0: 5f64 6570 7468 203d 2054 7275 6529 206f  _depth = True) o
+0003d4b0: 7220 7468 6520 7368 616c 6c6f 776e 6573  r the shallownes
+0003d4c0: 7320 6672 6f6d 2074 6865 206c 6561 7665  s from the leave
+0003d4d0: 730d 0a0d 0a20 2020 2020 2020 2050 6172  s....        Par
+0003d4e0: 656e 7473 2061 6c77 6179 7320 6765 7420  ents always get 
+0003d4f0: 7265 7475 726e 6564 2062 6566 6f72 6520  returned before 
+0003d500: 6368 696c 6472 656e 2c20 6275 7420 6966  children, but if
+0003d510: 2062 795f 6465 7074 6820 6973 2054 7275   by_depth is Tru
+0003d520: 652c 2061 206c 6561 6620 6e65 7874 2074  e, a leaf next t
+0003d530: 6f20 7468 6520 726f 6f74 2067 6574 7320  o the root gets 
+0003d540: 7265 7475 726e 6564 2066 6972 7374 2c20  returned first, 
+0003d550: 6966 2046 616c 7365 2061 206c 6561 6620  if False a leaf 
+0003d560: 6e65 7874 2074 6f20 7468 6520 726f 6f74  next to the root
+0003d570: 2077 696c 6c20 6265 2072 6574 7572 6e65   will be returne
+0003d580: 6420 6c61 7374 0d0a 0d0a 2020 2020 2020  d last....      
+0003d590: 2020 3a70 6172 616d 2062 795f 6465 7074    :param by_dept
+0003d5a0: 683a 2054 7275 6520 6966 2074 6865 2064  h: True if the d
+0003d5b0: 6973 7461 6e63 6520 6672 6f6d 2074 6865  istance from the
+0003d5c0: 2072 6f6f 7420 6973 2075 7365 6420 746f   root is used to
+0003d5d0: 2064 6574 6572 6d69 6e65 206f 7264 6572   determine order
+0003d5e0: 696e 672c 2046 616c 7365 2069 6620 6469  ing, False if di
+0003d5f0: 7374 616e 6365 2066 726f 6d20 7468 6520  stance from the 
+0003d600: 6c65 6166 2028 692e 652e 2073 6861 6c6c  leaf (i.e. shall
+0003d610: 6f77 6e65 7373 2920 6973 2075 7365 6420  owness) is used 
+0003d620: 746f 2064 6574 6572 6d69 6e65 206f 7264  to determine ord
+0003d630: 6572 696e 670d 0a20 2020 2020 2020 2027  ering..        '
+0003d640: 2727 0d0a 2020 2020 2020 2020 6966 2062  ''..        if b
+0003d650: 795f 6465 7074 683a 0d0a 2020 2020 2020  y_depth:..      
+0003d660: 2020 2020 2020 6465 7074 6873 5f61 735f        depths_as_
+0003d670: 6c69 7374 5f6f 665f 7475 706c 6573 203d  list_of_tuples =
+0003d680: 205b 286b 2c76 2920 666f 7220 6b2c 7620   [(k,v) for k,v 
+0003d690: 696e 2073 656c 662e 6465 7074 6873 2e69  in self.depths.i
+0003d6a0: 7465 6d73 2829 205d 0d0a 2020 2020 2020  tems() ]..      
+0003d6b0: 2020 2020 2020 6465 7074 6873 5f61 735f        depths_as_
+0003d6c0: 6c69 7374 5f6f 665f 7475 706c 6573 2e73  list_of_tuples.s
+0003d6d0: 6f72 7428 290d 0a0d 0a20 2020 2020 2020  ort()....       
+0003d6e0: 2020 2020 2066 6f72 2064 6570 7468 2c20       for depth, 
+0003d6f0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+0003d700: 7473 2069 6e20 6465 7074 6873 5f61 735f  ts in depths_as_
+0003d710: 6c69 7374 5f6f 665f 7475 706c 6573 3a0d  list_of_tuples:.
+0003d720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0003d730: 2066 6f72 2073 6520 696e 2073 7472 7563   for se in struc
+0003d740: 7475 7265 5f65 6c65 6d65 6e74 733a 0d0a  ture_elements:..
+0003d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003d760: 2020 2020 7969 656c 6420 7365 0d0a 0d0a      yield se....
+0003d770: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0003d780: 2020 2020 2020 2020 2020 2073 6861 6c6c             shall
+0003d790: 6f77 6e65 7373 6573 5f61 735f 6c69 7374  ownesses_as_list
+0003d7a0: 5f6f 665f 7475 706c 6573 203d 205b 286b  _of_tuples = [(k
+0003d7b0: 2c76 2920 666f 7220 6b2c 7620 696e 2073  ,v) for k,v in s
+0003d7c0: 656c 662e 7368 616c 6c6f 776e 6573 7365  elf.shallownesse
+0003d7d0: 732e 6974 656d 7328 2920 5d0d 0a20 2020  s.items() ]..   
+0003d7e0: 2020 2020 2020 2020 2073 6861 6c6c 6f77           shallow
+0003d7f0: 6e65 7373 6573 5f61 735f 6c69 7374 5f6f  nesses_as_list_o
+0003d800: 665f 7475 706c 6573 2e73 6f72 7428 7265  f_tuples.sort(re
+0003d810: 7665 7273 6520 3d20 5472 7565 290d 0a0d  verse = True)...
+0003d820: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0003d830: 2073 6861 6c6c 6f77 6e65 7373 2c20 7374   shallowness, st
+0003d840: 7275 6374 7572 655f 656c 656d 656e 7473  ructure_elements
+0003d850: 2069 6e20 7368 616c 6c6f 776e 6573 7365   in shallownesse
+0003d860: 735f 6173 5f6c 6973 745f 6f66 5f74 7570  s_as_list_of_tup
+0003d870: 6c65 733a 0d0a 2020 2020 2020 2020 2020  les:..          
+0003d880: 2020 2020 2020 666f 7220 7365 2069 6e20        for se in 
+0003d890: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+0003d8a0: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
+0003d8b0: 2020 2020 2020 2020 2079 6965 6c64 2073           yield s
+0003d8c0: 650d 0a0d 0a20 2020 2064 6566 2067 6574  e....    def get
+0003d8d0: 5f73 7562 7472 6565 5f74 7261 6e73 6c61  _subtree_transla
+0003d8e0: 7469 6f6e 5f64 6628 7365 6c66 2c73 7562  tion_df(self,sub
+0003d8f0: 7472 6565 5f73 686f 7274 6e61 6d65 2c63  tree_shortname,c
+0003d900: 6f6c 756d 6e5f 7072 6566 6978 3d4e 6f6e  olumn_prefix=Non
+0003d910: 652c 2066 6965 6c64 5f73 686f 7274 6e61  e, field_shortna
+0003d920: 6d65 3d4e 6f6e 6529 3a0d 0a20 2020 2020  me=None):..     
+0003d930: 2020 2027 2727 5374 6172 7469 6e67 2061     '''Starting a
+0003d940: 7420 7365 6c66 2028 6120 726f 6f74 206e  t self (a root n
+0003d950: 6f64 6529 2072 6574 7572 6e20 6120 7061  ode) return a pa
+0003d960: 6e64 6173 2044 6174 6146 7261 6d65 206f  ndas DataFrame o
+0003d970: 6620 7368 6f72 746e 616d 6520 616e 6420  f shortname and 
+0003d980: 7068 7973 6964 7320 666f 7220 7472 616e  physids for tran
+0003d990: 736c 6174 696e 6720 726f 6c6c 7570 7320  slating rollups 
+0003d9a0: 666f 7220 7468 6520 7375 622d 7472 6565  for the sub-tree
+0003d9b0: 2073 7065 6369 6669 6564 2062 7920 7468   specified by th
+0003d9c0: 6520 7368 6f72 746e 616d 650d 0a0d 0a20  e shortname.... 
+0003d9d0: 2020 2020 2020 2054 6865 2072 6574 7572         The retur
+0003d9e0: 6e65 6420 4461 7461 4672 616d 6520 7769  ned DataFrame wi
+0003d9f0: 6c6c 2068 6176 6520 636f 6c75 6d6e 7320  ll have columns 
+0003da00: 5b27 5368 6f72 7420 4e61 6d65 272c 2749  ['Short Name','I
+0003da10: 4427 2c27 6c65 7665 6c20 6e20 7068 7973  D','level n phys
+0003da20: 6964 272c 2e2e 2e2c 276c 6576 656c 206d  id',...,'level m
+0003da30: 2070 6879 7369 6427 5d20 7768 6572 6520   physid'] where 
+0003da40: 6c65 7665 6c20 6e20 6973 2074 6865 206c  level n is the l
+0003da50: 6576 656c 206f 6620 7468 6520 7375 7070  evel of the supp
+0003da60: 6c69 6564 2073 7562 7472 6565 5f73 686f  lied subtree_sho
+0003da70: 7274 6e61 6d65 2070 6172 616d 6574 6572  rtname parameter
+0003da80: 0d0a 2020 2020 2020 2020 466f 7220 7368  ..        For sh
+0003da90: 6f72 746e 616d 6573 2077 6869 6368 2061  ortnames which a
+0003daa0: 7265 206e 6f74 2061 7420 7468 6520 6578  re not at the ex
+0003dab0: 7472 656d 6520 6c65 6176 6573 206f 6620  treme leaves of 
+0003dac0: 7468 6520 7472 6565 2c20 7468 6520 5b27  the tree, the ['
+0003dad0: 6c65 7665 6c20 6d27 5d20 636f 6c75 6d6e  level m'] column
+0003dae0: 2070 6c75 7320 736f 6d65 2068 6967 6865   plus some highe
+0003daf0: 7220 6c65 7665 6c73 2077 696c 6c20 6861  r levels will ha
+0003db00: 7665 2070 6879 7369 6420 3d20 2d32 0d0a  ve physid = -2..
+0003db10: 2020 2020 2020 2020 4a6f 696e 696e 6720          Joining 
+0003db20: 7468 6520 4461 7461 4672 616d 6520 7468  the DataFrame th
+0003db30: 6174 2074 6869 7320 6675 6e63 7469 6f6e  at this function
+0003db40: 2072 6574 7572 6e73 2074 6f20 7472 616e   returns to tran
+0003db50: 7361 6374 696f 6e61 6c20 6461 7461 2077  sactional data w
+0003db60: 696c 6c20 6372 6561 7465 2061 2064 6174  ill create a dat
+0003db70: 6166 7261 6d65 2074 6861 7420 6361 6e20  aframe that can 
+0003db80: 6265 2075 7365 6420 6173 2074 6865 2062  be used as the b
+0003db90: 6173 6973 206f 6620 6120 7374 616e 6461  asis of a standa
+0003dba0: 7264 2065 7870 6c6f 6465 2061 6e64 206c  rd explode and l
+0003dbb0: 6f61 640d 0a20 2020 2020 2020 2057 6520  oad..        We 
+0003dbc0: 6361 6e20 7573 6520 2753 686f 7274 204e  can use 'Short N
+0003dbd0: 616d 6527 206f 7220 2749 4427 2074 6f20  ame' or 'ID' to 
+0003dbe0: 646f 206f 7572 206a 6f69 6e0d 0a0d 0a20  do our join.... 
+0003dbf0: 2020 2020 2020 203a 7061 7261 6d20 7375         :param su
+0003dc00: 6274 7265 655f 7368 6f72 746e 616d 653a  btree_shortname:
+0003dc10: 2045 6d70 6f77 6572 2053 686f 7274 204e   Empower Short N
+0003dc20: 616d 6520 6f66 2074 6865 2053 7472 7563  ame of the Struc
+0003dc30: 7475 7265 2045 6c65 6d65 6e74 2077 6520  ture Element we 
+0003dc40: 7761 6e74 2074 6f20 6372 6561 7465 2061  want to create a
+0003dc50: 2066 6c61 7474 656e 6564 2074 7261 6e73   flattened trans
+0003dc60: 6c61 7469 6f6e 2062 656c 6f77 0d0a 2020  lation below..  
+0003dc70: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
+0003dc80: 7061 6e64 6173 2044 6174 6146 7261 6d65  pandas DataFrame
+0003dc90: 2020 5b27 5368 6f72 7420 4e61 6d65 272c    ['Short Name',
+0003dca0: 2749 4427 2c27 6c65 7665 6c20 6e20 7068  'ID','level n ph
+0003dcb0: 7973 6964 272c 2e2e 2e2c 276c 6576 656c  ysid',...,'level
+0003dcc0: 206d 2070 6879 7369 6427 5d0d 0a20 2020   m physid']..   
+0003dcd0: 2020 2020 2027 2727 0d0a 0d0a 2020 2020       '''....    
+0003dce0: 2020 2020 2341 206c 6973 7420 6f66 2074      #A list of t
+0003dcf0: 7570 6c65 732c 2028 7374 7269 6e67 2c20  uples, (string, 
+0003dd00: 6c69 7374 2920 7768 6572 6520 7468 6520  list) where the 
+0003dd10: 7374 7269 6e67 2069 7320 7468 6520 7368  string is the sh
+0003dd20: 6f72 746e 616d 6520 616e 6420 7468 6520  ortname and the 
+0003dd30: 6c69 7374 2069 7320 7468 6520 7068 7973  list is the phys
+0003dd40: 6964 7320 6c65 6164 696e 6720 6672 6f6d  ids leading from
+0003dd50: 2074 6865 2072 6f6f 740d 0a20 2020 2020   the root..     
+0003dd60: 2020 2023 5468 6973 2077 696c 6c20 6265     #This will be
+0003dd70: 2061 2072 6167 6765 6420 6869 6572 6172   a ragged hierar
+0003dd80: 6368 7920 2d20 7765 276c 6c20 756e 7261  chy - we'll unra
+0003dd90: 6720 6974 206c 6174 6572 2062 7920 6164  g it later by ad
+0003dda0: 6469 6e67 202d 3273 2062 6579 6f6e 6420  ding -2s beyond 
+0003ddb0: 7468 6520 6c65 6176 6573 0d0a 2020 2020  the leaves..    
+0003ddc0: 2020 2020 616c 6c5f 7068 7973 6964 5f72      all_physid_r
+0003ddd0: 6f6f 745f 746f 5f74 6970 5f6c 6973 7473  oot_to_tip_lists
+0003dde0: 3d5b 5d0d 0a0d 0a20 2020 2020 2020 2023  =[]....        #
+0003ddf0: 5468 6520 6375 7272 656e 7420 726f 6f74  The current root
+0003de00: 2074 6f20 7469 7020 7068 7973 6964 206c   to tip physid l
+0003de10: 6973 7420 6973 206d 6169 6e74 6169 6e65  ist is maintaine
+0003de20: 642c 2062 7920 6368 7563 6b69 6e67 206c  d, by chucking l
+0003de30: 6561 7665 7320 6177 6179 2077 6865 6e20  eaves away when 
+0003de40: 7765 2067 6f20 7570 2074 6865 2068 6965  we go up the hie
+0003de50: 7261 7263 6879 2c20 616e 6420 6164 6469  rarchy, and addi
+0003de60: 6e67 206c 6561 7665 7320 7768 656e 2077  ng leaves when w
+0003de70: 6520 676f 2064 6f77 6e0d 0a20 2020 2020  e go down..     
+0003de80: 2020 2023 6375 7272 656e 745f 726f 6f74     #current_root
+0003de90: 5f74 6f5f 7469 705f 7068 7973 6964 733d  _to_tip_physids=
+0003dea0: 5b5d 0d0a 2020 2020 2020 2020 6375 7272  []..        curr
+0003deb0: 656e 745f 726f 6f74 5f74 6f5f 7469 705f  ent_root_to_tip_
+0003dec0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+0003ded0: 7473 3d5b 5d0d 0a20 2020 2020 2020 2063  ts=[]..        c
+0003dee0: 7572 7265 6e74 5f6c 6576 656c 3d4e 6f6e  urrent_level=Non
+0003def0: 650d 0a20 2020 2020 2020 2070 7265 7669  e..        previ
+0003df00: 6f75 735f 6c65 7665 6c3d 4e6f 6e65 0d0a  ous_level=None..
+0003df10: 2020 2020 2020 2020 7375 6274 7265 655f          subtree_
+0003df20: 7374 6172 745f 6c65 7665 6c3d 4e6f 6e65  start_level=None
+0003df30: 0d0a 0d0a 2020 2020 2020 2020 6c6f 6e67  ....        long
+0003df40: 6573 745f 6c69 7374 5f6c 656e 203d 2030  est_list_len = 0
+0003df50: 0d0a 0d0a 2020 2020 2020 2020 2377 616c  ....        #wal
+0003df60: 6b5f 7375 6274 7265 6520 6361 6e20 6f6e  k_subtree can on
+0003df70: 6c79 2062 6520 6361 6c6c 6564 2066 726f  ly be called fro
+0003df80: 6d20 6120 726f 6f74 206e 6f64 6520 756e  m a root node un
+0003df90: 6c65 7373 2077 6520 6172 6520 7265 7475  less we are retu
+0003dfa0: 726e 696e 6720 7468 6520 7768 6f6c 6520  rning the whole 
+0003dfb0: 6f66 2074 6865 2074 7265 6520 2d20 7468  of the tree - th
+0003dfc0: 6973 2061 766f 6964 7320 7468 6520 7265  is avoids the re
+0003dfd0: 7475 726e 6564 2073 7562 7472 6565 2062  turned subtree b
+0003dfe0: 6569 6e67 2061 6d62 6967 756f 7573 2c20  eing ambiguous, 
+0003dff0: 7369 6e63 6520 7368 6f72 746e 616d 6573  since shortnames
+0003e000: 206d 6179 2061 7070 6561 7220 696e 206d   may appear in m
+0003e010: 6f72 6520 7468 616e 2061 2073 696e 676c  ore than a singl
+0003e020: 6520 7472 6565 2069 6e20 7468 6520 7374  e tree in the st
+0003e030: 7275 6374 7572 650d 0a20 2020 2020 2020  ructure..       
+0003e040: 2070 6572 6d69 7373 6976 6520 3d20 7375   permissive = su
+0003e050: 6274 7265 655f 7368 6f72 746e 616d 6520  btree_shortname 
+0003e060: 3d3d 2073 656c 662e 7368 6f72 746e 616d  == self.shortnam
+0003e070: 650d 0a0d 0a20 2020 2020 2020 2066 6f72  e....        for
+0003e080: 2073 6520 696e 2073 656c 662e 7761 6c6b   se in self.walk
+0003e090: 5f73 7562 7472 6565 2873 7562 7472 6565  _subtree(subtree
+0003e0a0: 5f73 686f 7274 6e61 6d65 2c70 6572 6d69  _shortname,permi
+0003e0b0: 7373 6976 653d 7065 726d 6973 7369 7665  ssive=permissive
+0003e0c0: 293a 0d0a 0d0a 2020 2020 2020 2020 2020  ):....          
+0003e0d0: 2020 6966 2073 7562 7472 6565 5f73 7461    if subtree_sta
+0003e0e0: 7274 5f6c 6576 656c 2069 7320 4e6f 6e65  rt_level is None
+0003e0f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0003e100: 2020 2073 7562 7472 6565 5f73 7461 7274     subtree_start
+0003e110: 5f6c 6576 656c 3d73 652e 6c65 7665 6c0d  _level=se.level.
+0003e120: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
+0003e130: 5472 696d 2074 6865 206c 6973 7420 6f66  Trim the list of
+0003e140: 2073 7472 7563 7475 7265 2065 6c65 6d65   structure eleme
+0003e150: 6e74 732c 2074 6f20 6f6e 6c79 2069 6e63  nts, to only inc
+0003e160: 6c75 6465 2074 6869 7320 6f6e 6527 7320  lude this one's 
+0003e170: 7061 7265 6e74 730d 0a20 2020 2020 2020  parents..       
+0003e180: 2020 2020 2063 7572 7265 6e74 5f72 6f6f       current_roo
+0003e190: 745f 746f 5f74 6970 5f73 7472 7563 7475  t_to_tip_structu
+0003e1a0: 7265 5f65 6c65 6d65 6e74 733d 6375 7272  re_elements=curr
+0003e1b0: 656e 745f 726f 6f74 5f74 6f5f 7469 705f  ent_root_to_tip_
+0003e1c0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+0003e1d0: 7473 5b3a 7365 2e6c 6576 656c 2d73 7562  ts[:se.level-sub
+0003e1e0: 7472 6565 5f73 7461 7274 5f6c 6576 656c  tree_start_level
+0003e1f0: 5d0d 0a0d 0a20 2020 2020 2020 2020 2020  ]....           
+0003e200: 2023 6578 7465 6e64 2074 6865 206c 6973   #extend the lis
+0003e210: 7420 6f66 2063 7572 7265 6e74 5f72 6f6f  t of current_roo
+0003e220: 745f 746f 5f74 6970 5f73 7472 7563 7475  t_to_tip_structu
+0003e230: 7265 5f65 6c65 6d65 6e74 7320 746f 2069  re_elements to i
+0003e240: 6e63 6c75 6465 2074 6865 2074 6865 2063  nclude the the c
+0003e250: 7572 7265 6e74 2065 6c65 6d65 6e74 0d0a  urrent element..
+0003e260: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0003e270: 656e 745f 726f 6f74 5f74 6f5f 7469 705f  ent_root_to_tip_
+0003e280: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+0003e290: 7473 2e61 7070 656e 6428 7365 290d 0a0d  ts.append(se)...
+0003e2a0: 0a20 2020 2020 2020 2020 2020 2023 4a41  .            #JA
+0003e2b0: 5420 2d20 636f 6d6d 656e 7465 6420 7468  T - commented th
+0003e2c0: 6973 206f 7574 2032 3031 382d 3132 2d31  is out 2018-12-1
+0003e2d0: 3420 6265 6361 7573 6520 6669 656c 6476  4 because fieldv
+0003e2e0: 616c 7565 2064 6f65 736e 2774 2067 6574  alue doesn't get
+0003e2f0: 2075 7365 640d 0a20 2020 2020 2020 2020   used..         
+0003e300: 2020 2023 6966 2066 6965 6c64 5f73 686f     #if field_sho
+0003e310: 7274 6e61 6d65 3a0d 0a20 2020 2020 2020  rtname:..       
+0003e320: 2020 2020 2023 2020 2020 6966 2066 6965       #    if fie
+0003e330: 6c64 5f73 686f 7274 6e61 6d65 2069 6e20  ld_shortname in 
+0003e340: 5b27 5368 6f72 7420 4e61 6d65 272c 274c  ['Short Name','L
+0003e350: 6f6e 6720 4e61 6d65 272c 2749 4427 5d3a  ong Name','ID']:
+0003e360: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+0003e370: 2020 2020 2020 2023 7765 276c 6c20 616c         #we'll al
+0003e380: 7265 6164 7920 6861 7665 2074 6865 7365  ready have these
+0003e390: 2066 6965 6c64 7320 7072 6573 656e 742c   fields present,
+0003e3a0: 2064 6f6e 2774 2064 7570 6c69 6361 7465   don't duplicate
+0003e3b0: 2074 6865 6d0d 0a20 2020 2020 2020 2020   them..         
+0003e3c0: 2020 2023 2020 2020 2020 2020 6669 656c     #        fiel
+0003e3d0: 6476 616c 7565 203d 204e 6f6e 650d 0a20  dvalue = None.. 
+0003e3e0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0003e3f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+0003e400: 2020 2023 2020 2020 2020 2020 6669 656c     #        fiel
+0003e410: 6476 616c 7565 203d 2073 652e 6669 656c  dvalue = se.fiel
+0003e420: 6473 5b66 6965 6c64 5f73 686f 7274 6e61  ds[field_shortna
+0003e430: 6d65 5d0d 0a20 2020 2020 2020 2020 2020  me]..           
+0003e440: 2023 656c 7365 3a0d 0a20 2020 2020 2020   #else:..       
+0003e450: 2020 2020 2023 2020 2020 6669 656c 6476       #    fieldv
+0003e460: 616c 7565 203d 204e 6f6e 650d 0a0d 0a20  alue = None.... 
+0003e470: 2020 2020 2020 2020 2020 2023 4261 7569             #Baui
+0003e480: 6c64 2061 206c 6973 7420 6f66 2072 6f6f  ld a list of roo
+0003e490: 7420 746f 2074 6970 2069 6473 2061 6e64  t to tip ids and
+0003e4a0: 2061 6464 2074 6f20 7468 6520 7768 6f6c   add to the whol
+0003e4b0: 6520 6c69 7374 2c20 7472 696d 6d69 6e67  e list, trimming
+0003e4c0: 2074 6f20 6f6e 6c79 2069 6e63 6c75 6465   to only include
+0003e4d0: 2069 6473 206f 6620 6e6f 6e2d 7669 7274   ids of non-virt
+0003e4e0: 7561 6c2c 206e 6f6e 2d67 726f 7570 2065  ual, non-group e
+0003e4f0: 6c65 6d65 6e74 730d 0a20 2020 2020 2020  lements..       
+0003e500: 2020 2020 2063 7572 7265 6e74 5f72 6f6f       current_roo
+0003e510: 745f 746f 5f74 6970 5f70 6879 7369 6473  t_to_tip_physids
+0003e520: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
+0003e530: 2020 2066 6f72 2073 655f 6368 696c 6420     for se_child 
+0003e540: 696e 2063 7572 7265 6e74 5f72 6f6f 745f  in current_root_
+0003e550: 746f 5f74 6970 5f73 7472 7563 7475 7265  to_tip_structure
+0003e560: 5f65 6c65 6d65 6e74 733a 0d0a 2020 2020  _elements:..    
+0003e570: 2020 2020 2020 2020 2020 2020 234f 6e6c              #Onl
+0003e580: 7920 6164 6420 6e6f 6e2d 6772 6f75 7020  y add non-group 
+0003e590: 6e6f 6e20 6361 6c63 756c 6174 6564 2065  non calculated e
+0003e5a0: 6c65 6d65 6e74 732c 206f 7220 7765 2065  lements, or we e
+0003e5b0: 6e64 2075 7020 6164 6469 6e67 2075 7020  nd up adding up 
+0003e5c0: 6120 7768 6f6c 6520 6c6f 6164 206f 6620  a whole load of 
+0003e5d0: 6361 6c63 756c 6174 6564 2065 6c65 6d65  calculated eleme
+0003e5e0: 6e74 730d 0a20 2020 2020 2020 2020 2020  nts..           
+0003e5f0: 2020 2020 2069 6620 2873 655f 6368 696c       if (se_chil
+0003e600: 642e 6669 656c 6473 5b27 4361 6c63 756c  d.fields['Calcul
+0003e610: 6174 696f 6e27 5d20 6973 204e 6f6e 6520  ation'] is None 
+0003e620: 6f72 2073 655f 6368 696c 642e 6669 656c  or se_child.fiel
+0003e630: 6473 5b27 4361 6c63 756c 6174 696f 6e20  ds['Calculation 
+0003e640: 5374 6174 7573 275d 203d 3d20 2752 6561  Status'] == 'Rea
+0003e650: 6c27 2920 616e 6420 7365 5f63 6869 6c64  l') and se_child
+0003e660: 2e66 6965 6c64 735b 2747 726f 7570 204f  .fields['Group O
+0003e670: 6e6c 7927 5d20 6973 204e 6f6e 653a 0d0a  nly'] is None:..
+0003e680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0003e690: 2020 2020 6375 7272 656e 745f 726f 6f74      current_root
+0003e6a0: 5f74 6f5f 7469 705f 7068 7973 6964 732e  _to_tip_physids.
+0003e6b0: 6170 7065 6e64 2873 655f 6368 696c 642e  append(se_child.
+0003e6c0: 7068 7973 6964 290d 0a20 2020 2020 2020  physid)..       
+0003e6d0: 2020 2020 2061 6c6c 5f70 6879 7369 645f       all_physid_
+0003e6e0: 726f 6f74 5f74 6f5f 7469 705f 6c69 7374  root_to_tip_list
+0003e6f0: 732e 6170 7065 6e64 2828 6375 7272 656e  s.append((curren
+0003e700: 745f 726f 6f74 5f74 6f5f 7469 705f 7068  t_root_to_tip_ph
+0003e710: 7973 6964 7329 290d 0a0d 0a20 2020 2020  ysids))....     
+0003e720: 2020 2020 2020 2023 4b65 6570 2074 7261         #Keep tra
+0003e730: 636b 206f 6620 7468 6520 6c6f 6e67 6573  ck of the longes
+0003e740: 7420 6c69 7374 206c 656e 6774 6820 2d20  t list length - 
+0003e750: 7765 276c 6c20 6e65 6564 2074 6869 7320  we'll need this 
+0003e760: 746f 2070 6164 2074 6865 206f 7468 6572  to pad the other
+0003e770: 730d 0a20 2020 2020 2020 2020 2020 2069  s..            i
+0003e780: 6620 6c6f 6e67 6573 745f 6c69 7374 5f6c  f longest_list_l
+0003e790: 656e 203c 206c 656e 2863 7572 7265 6e74  en < len(current
+0003e7a0: 5f72 6f6f 745f 746f 5f74 6970 5f70 6879  _root_to_tip_phy
+0003e7b0: 7369 6473 293a 0d0a 2020 2020 2020 2020  sids):..        
+0003e7c0: 2020 2020 2020 2020 6c6f 6e67 6573 745f          longest_
+0003e7d0: 6c69 7374 5f6c 656e 203d 206c 656e 2863  list_len = len(c
+0003e7e0: 7572 7265 6e74 5f72 6f6f 745f 746f 5f74  urrent_root_to_t
+0003e7f0: 6970 5f70 6879 7369 6473 290d 0a0d 0a20  ip_physids).... 
+0003e800: 2020 2020 2020 2023 4e6f 7720 7765 206e         #Now we n
+0003e810: 6565 6420 746f 2074 616b 6520 7468 6520  eed to take the 
+0003e820: 7261 6767 6564 2068 6965 7261 7263 6879  ragged hierarchy
+0003e830: 2c20 736f 6d65 7468 696e 6720 6c69 6b65  , something like
+0003e840: 2074 6869 733a 0d0a 2020 2020 2020 2020   this:..        
+0003e850: 2320 2827 414c 4c27 2c5b 315d 290d 0a20  # ('ALL',[1]).. 
+0003e860: 2020 2020 2020 2023 2028 2758 3032 272c         # ('X02',
+0003e870: 5b31 2c20 325d 290d 0a20 2020 2020 2020  [1, 2])..       
+0003e880: 2023 2028 2758 3033 272c 5b31 2c20 322c   # ('X03',[1, 2,
+0003e890: 2033 5d29 0d0a 2020 2020 2020 2020 2320   3])..        # 
+0003e8a0: 2827 5830 3427 2c5b 312c 2032 2c20 332c  ('X04',[1, 2, 3,
+0003e8b0: 2034 5d29 0d0a 2020 2020 2020 2020 2320   4])..        # 
+0003e8c0: 2827 5830 3527 2c5b 312c 2035 5d29 0d0a  ('X05',[1, 5])..
+0003e8d0: 2020 2020 2020 2020 2320 2827 5830 3627          # ('X06'
+0003e8e0: 2c5b 312c 2035 2c20 365d 290d 0a20 2020  ,[1, 5, 6])..   
+0003e8f0: 2020 2020 2023 2028 2758 3037 272c 5b31       # ('X07',[1
+0003e900: 2c20 352c 2037 5d29 0d0a 2020 2020 2020  , 5, 7])..      
+0003e910: 2020 230d 0a20 2020 2020 2020 2023 2061    #..        # a
+0003e920: 6e64 2074 7572 6e20 6974 2069 6e74 6f20  nd turn it into 
+0003e930: 736f 6d65 7468 696e 6720 6c69 6b65 2074  something like t
+0003e940: 6869 730d 0a20 2020 2020 2020 2023 0d0a  his..        #..
+0003e950: 2020 2020 2020 2020 2320 2827 414c 4c27          # ('ALL'
+0003e960: 2c5b 312c 2d32 2c2d 322c 2d32 5d29 0d0a  ,[1,-2,-2,-2])..
+0003e970: 2020 2020 2020 2020 2320 2827 5830 3227          # ('X02'
+0003e980: 2c5b 312c 2032 2c2d 322c 2d32 5d29 0d0a  ,[1, 2,-2,-2])..
+0003e990: 2020 2020 2020 2020 2320 2827 5830 3327          # ('X03'
+0003e9a0: 2c5b 312c 2032 2c20 332c 2d32 5d29 0d0a  ,[1, 2, 3,-2])..
+0003e9b0: 2020 2020 2020 2020 2320 2827 5830 3427          # ('X04'
+0003e9c0: 2c5b 312c 2032 2c20 332c 2034 5d29 0d0a  ,[1, 2, 3, 4])..
+0003e9d0: 2020 2020 2020 2020 2320 2827 5830 3527          # ('X05'
+0003e9e0: 2c5b 312c 2035 2c2d 322c 2d32 5d29 0d0a  ,[1, 5,-2,-2])..
+0003e9f0: 2020 2020 2020 2020 2320 2827 5830 3627          # ('X06'
+0003ea00: 2c5b 312c 2035 2c20 362c 2d32 5d29 0d0a  ,[1, 5, 6,-2])..
+0003ea10: 2020 2020 2020 2020 2320 2827 5830 3727          # ('X07'
+0003ea20: 2c5b 312c 2035 2c20 372c 2d32 5d29 0d0a  ,[1, 5, 7,-2])..
+0003ea30: 2020 2020 2020 2020 230d 0a20 2020 2020          #..     
+0003ea40: 2020 2023 2054 6869 7320 6869 6572 6172     # This hierar
+0003ea50: 6368 7920 6361 6e20 7468 656e 2062 6520  chy can then be 
+0003ea60: 7475 726e 6564 2069 6e74 6f20 736f 6d65  turned into some
+0003ea70: 7468 696e 6720 6c69 6b65 2074 6869 732c  thing like this,
+0003ea80: 2061 6e64 2066 726f 6d20 7468 6572 6520   and from there 
+0003ea90: 696e 746f 206f 7572 2064 6174 6166 7261  into our datafra
+0003eaa0: 6d65 0d0a 2020 2020 2020 2020 230d 0a20  me..        #.. 
+0003eab0: 2020 2020 2020 2023 207b 2753 686f 7274         # {'Short
+0003eac0: 204e 616d 6527 3a27 414c 4c2c 2027 6c65   Name':'ALL, 'le
+0003ead0: 7665 6c20 3027 3a31 2c20 276c 6576 656c  vel 0':1, 'level
+0003eae0: 2031 273a 2d32 2c20 276c 6576 656c 2032   1':-2, 'level 2
+0003eaf0: 273a 2d32 2c20 276c 6576 656c 2033 273a  ':-2, 'level 3':
+0003eb00: 2d32 207d 0d0a 2020 2020 2020 2020 2320  -2 }..        # 
+0003eb10: 2e2e 2e0d 0a20 2020 2020 2020 2023 207b  .....        # {
+0003eb20: 2753 686f 7274 204e 616d 6527 3a27 414c  'Short Name':'AL
+0003eb30: 4c2c 2027 6c65 7665 6c20 3027 3a31 2c20  L, 'level 0':1, 
+0003eb40: 276c 6576 656c 2031 273a 352c 2020 276c  'level 1':5,  'l
+0003eb50: 6576 656c 2032 273a 372c 2020 276c 6576  evel 2':7,  'lev
+0003eb60: 656c 2033 273a 2d32 207d 0d0a 0d0a 2020  el 3':-2 }....  
+0003eb70: 2020 2020 2020 2343 7265 6174 6520 6120        #Create a 
+0003eb80: 6c69 7374 206f 6620 6469 6374 696f 6e61  list of dictiona
+0003eb90: 7269 6573 2c20 7265 6164 7920 666f 7220  ries, ready for 
+0003eba0: 7472 616e 7366 6f72 6d61 7469 6f6e 2069  transformation i
+0003ebb0: 6e74 6f20 6120 7061 6e64 6173 2044 6174  nto a pandas Dat
+0003ebc0: 6146 7261 6d65 0d0a 2020 2020 2020 2020  aFrame..        
+0003ebd0: 6c69 7374 5f6f 665f 6469 6374 733d 5b5d  list_of_dicts=[]
+0003ebe0: 0d0a 0d0a 2020 2020 2020 2020 2357 6520  ....        #We 
+0003ebf0: 6e65 6564 2074 6f20 6d61 696e 7461 696e  need to maintain
+0003ec00: 2061 2072 6563 6f72 6420 6f66 2074 6865   a record of the
+0003ec10: 206c 6f77 6573 7420 6c65 7665 6c2c 2073   lowest level, s
+0003ec20: 6f20 7468 6174 2077 6520 6361 6e20 6372  o that we can cr
+0003ec30: 6561 7465 2074 6865 206e 616d 6573 2077  eate the names w
+0003ec40: 6974 6820 616e 2061 6363 7572 6174 6520  ith an accurate 
+0003ec50: 6f72 6465 7269 6e67 0d0a 2020 2020 2020  ordering..      
+0003ec60: 2020 6c6f 7765 7374 5f6c 6576 656c 3d4e    lowest_level=N
+0003ec70: 6f6e 650d 0a0d 0a20 2020 2020 2020 2023  one....        #
+0003ec80: 4669 7273 7420 5061 6420 7468 6520 6c69  First Pad the li
+0003ec90: 7374 7320 7769 7468 202d 3220 2d20 7570  sts with -2 - up
+0003eca0: 2074 6f20 7468 6520 6c6f 6e67 6573 7420   to the longest 
+0003ecb0: 6c65 6e67 7468 0d0a 2020 2020 2020 2020  length..        
+0003ecc0: 666f 7220 7068 7973 6964 5f6c 6973 7420  for physid_list 
+0003ecd0: 696e 2061 6c6c 5f70 6879 7369 645f 726f  in all_physid_ro
+0003ece0: 6f74 5f74 6f5f 7469 705f 6c69 7374 733a  ot_to_tip_lists:
+0003ecf0: 0d0a 2020 2020 2020 2020 2020 2020 2352  ..            #R
+0003ed00: 6f6f 7420 656c 656d 656e 7473 2077 6869  oot elements whi
+0003ed10: 6368 2061 7265 2067 726f 7570 2077 696c  ch are group wil
+0003ed20: 6c20 6861 7665 2065 6d70 7479 2070 6879  l have empty phy
+0003ed30: 7369 6420 6c69 7374 7320 2d20 6967 6e6f  sid lists - igno
+0003ed40: 7265 2074 6865 7365 0d0a 2020 2020 2020  re these..      
+0003ed50: 2020 2020 2020 6966 206c 656e 2870 6879        if len(phy
+0003ed60: 7369 645f 6c69 7374 293d 3d30 3a0d 0a20  sid_list)==0:.. 
+0003ed70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0003ed80: 6f6e 7469 6e75 650d 0a20 2020 2020 2020  ontinue..       
+0003ed90: 2020 2020 2023 5265 636f 7264 2074 6865       #Record the
+0003eda0: 2070 6879 7369 6420 666f 7220 7468 6520   physid for the 
+0003edb0: 6c65 6166 2065 6c65 6d65 6e74 202d 2074  leaf element - t
+0003edc0: 6869 7320 6973 2074 6865 206f 6e65 2077  his is the one w
+0003edd0: 6520 7769 6c6c 2075 7365 2074 6f20 646f  e will use to do
+0003ede0: 2074 6865 206c 6f6f 6b75 700d 0a20 2020   the lookup..   
+0003edf0: 2020 2020 2020 2020 2064 6963 745f 666f           dict_fo
+0003ee00: 725f 6466 3d7b 2749 4427 3a70 6879 7369  r_df={'ID':physi
+0003ee10: 645f 6c69 7374 5b2d 315d 7d0d 0a0d 0a20  d_list[-1]}.... 
+0003ee20: 2020 2020 2020 2020 2020 2070 6879 7369             physi
+0003ee30: 645f 6c69 7374 2e65 7874 656e 6428 5b2d  d_list.extend([-
+0003ee40: 325d 202a 2028 6c6f 6e67 6573 745f 6c69  2] * (longest_li
+0003ee50: 7374 5f6c 656e 202d 206c 656e 2870 6879  st_len - len(phy
+0003ee60: 7369 645f 6c69 7374 2929 290d 0a0d 0a20  sid_list))).... 
+0003ee70: 2020 2020 2020 2020 2020 2023 5468 656e             #Then
+0003ee80: 2074 7572 6e20 7468 6520 6c69 7374 2069   turn the list i
+0003ee90: 6e74 6f20 6120 6469 6374 696f 6e61 7279  nto a dictionary
+0003eea0: 2c20 7265 6164 7920 746f 2074 7572 6e20  , ready to turn 
+0003eeb0: 696e 746f 2061 2070 616e 6461 7320 4461  into a pandas Da
+0003eec0: 7461 4672 616d 650d 0a20 2020 2020 2020  taFrame..       
+0003eed0: 2020 2020 2066 6f72 206c 6576 656c 5f6f       for level_o
+0003eee0: 6666 7365 742c 2070 6879 7369 6420 696e  ffset, physid in
+0003eef0: 2065 6e75 6d65 7261 7465 2870 6879 7369   enumerate(physi
+0003ef00: 645f 6c69 7374 293a 0d0a 2020 2020 2020  d_list):..      
+0003ef10: 2020 2020 2020 2020 2020 6c65 7665 6c5f            level_
+0003ef20: 746f 5f62 655f 7573 6564 5f69 6e5f 6e61  to_be_used_in_na
+0003ef30: 6d65 3d6c 6576 656c 5f6f 6666 7365 742b  me=level_offset+
+0003ef40: 7375 6274 7265 655f 7374 6172 745f 6c65  subtree_start_le
+0003ef50: 7665 6c0d 0a0d 0a20 2020 2020 2020 2020  vel....         
+0003ef60: 2020 2020 2020 2023 4b65 6570 2074 7261         #Keep tra
+0003ef70: 636b 206f 6620 7468 6520 6c6f 7765 7374  ck of the lowest
+0003ef80: 206c 6576 656c 2c20 736f 2074 6861 7420   level, so that 
+0003ef90: 7765 2063 616e 2072 6563 7265 6174 6520  we can recreate 
+0003efa0: 636f 6c75 6d6e 206e 616d 6573 2c20 616e  column names, an
+0003efb0: 6420 7468 656e 2067 6574 2074 6865 2064  d then get the d
+0003efc0: 6620 636f 6c75 6d6e 206e 616d 6573 2069  f column names i
+0003efd0: 6e20 7468 6520 636f 7272 6563 7420 6f72  n the correct or
+0003efe0: 6465 720d 0a20 2020 2020 2020 2020 2020  der..           
+0003eff0: 2020 2020 2069 6620 6c6f 7765 7374 5f6c       if lowest_l
+0003f000: 6576 656c 2069 7320 4e6f 6e65 206f 7220  evel is None or 
+0003f010: 6c65 7665 6c5f 746f 5f62 655f 7573 6564  level_to_be_used
+0003f020: 5f69 6e5f 6e61 6d65 203c 206c 6f77 6573  _in_name < lowes
+0003f030: 745f 6c65 7665 6c3a 0d0a 2020 2020 2020  t_level:..      
+0003f040: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+0003f050: 7765 7374 5f6c 6576 656c 3d6c 6576 656c  west_level=level
+0003f060: 5f74 6f5f 6265 5f75 7365 645f 696e 5f6e  _to_be_used_in_n
+0003f070: 616d 650d 0a0d 0a20 2020 2020 2020 2020  ame....         
+0003f080: 2020 2020 2020 2063 6f6c 756d 6e5f 6e61         column_na
+0003f090: 6d65 3d27 6c65 7665 6c20 272b 7374 7228  me='level '+str(
+0003f0a0: 6c65 7665 6c5f 746f 5f62 655f 7573 6564  level_to_be_used
+0003f0b0: 5f69 6e5f 6e61 6d65 292b 2720 7068 7973  _in_name)+' phys
+0003f0c0: 6964 270d 0a20 2020 2020 2020 2020 2020  id'..           
+0003f0d0: 2020 2020 2064 6963 745f 666f 725f 6466       dict_for_df
+0003f0e0: 5b63 6f6c 756d 6e5f 6e61 6d65 5d3d 7068  [column_name]=ph
+0003f0f0: 7973 6964 0d0a 0d0a 2020 2020 2020 2020  ysid....        
+0003f100: 2020 2020 6c69 7374 5f6f 665f 6469 6374      list_of_dict
+0003f110: 732e 6170 7065 6e64 2864 6963 745f 666f  s.append(dict_fo
+0003f120: 725f 6466 290d 0a0d 0a20 2020 2020 2020  r_df)....       
+0003f130: 2023 4372 6561 7465 2061 206c 6973 7420   #Create a list 
+0003f140: 6f66 2063 6f6c 756d 6e20 6e61 6d65 7320  of column names 
+0003f150: 696e 2074 6865 2063 6f72 7265 6374 206f  in the correct o
+0003f160: 7264 6572 202d 2077 6974 686f 7574 2074  rder - without t
+0003f170: 6869 732c 2074 6865 2064 6174 6166 7261  his, the datafra
+0003f180: 6d65 2068 6173 2074 6865 2063 6f6c 756d  me has the colum
+0003f190: 6e20 6e61 6d65 7320 696e 2074 6865 2077  n names in the w
+0003f1a0: 726f 6e67 206f 7264 6572 2077 6869 6368  rong order which
+0003f1b0: 2062 7265 616b 7320 6578 706c 6f73 696f   breaks explosio
+0003f1c0: 6e20 6c6f 6769 630d 0a20 2020 2020 2020  n logic..       
+0003f1d0: 206c 6973 745f 6f66 5f63 6f6c 756d 6e73   list_of_columns
+0003f1e0: 5f69 6e5f 636f 7272 6563 745f 6f72 6465  _in_correct_orde
+0003f1f0: 723d 5b5d 0d0a 2020 2020 2020 2020 666f  r=[]..        fo
+0003f200: 7220 6e20 696e 2072 616e 6765 286c 6f6e  r n in range(lon
+0003f210: 6765 7374 5f6c 6973 745f 6c65 6e29 3a0d  gest_list_len):.
+0003f220: 0a20 2020 2020 2020 2020 2020 206c 6576  .            lev
+0003f230: 656c 5f74 6f5f 6265 5f75 7365 645f 696e  el_to_be_used_in
+0003f240: 5f6e 616d 653d 6c6f 7765 7374 5f6c 6576  _name=lowest_lev
+0003f250: 656c 2b6e 0d0a 2020 2020 2020 2020 2020  el+n..          
+0003f260: 2020 636f 6c75 6d6e 5f6e 616d 653d 276c    column_name='l
+0003f270: 6576 656c 2027 2b73 7472 286c 6576 656c  evel '+str(level
+0003f280: 5f74 6f5f 6265 5f75 7365 645f 696e 5f6e  _to_be_used_in_n
+0003f290: 616d 6529 2b27 2070 6879 7369 6427 0d0a  ame)+' physid'..
+0003f2a0: 2020 2020 2020 2020 2020 2020 6c69 7374              list
+0003f2b0: 5f6f 665f 636f 6c75 6d6e 735f 696e 5f63  _of_columns_in_c
+0003f2c0: 6f72 7265 6374 5f6f 7264 6572 2e61 7070  orrect_order.app
+0003f2d0: 656e 6428 636f 6c75 6d6e 5f6e 616d 6529  end(column_name)
+0003f2e0: 0d0a 0d0a 2020 2020 2020 2020 6c69 7374  ....        list
+0003f2f0: 5f6f 665f 636f 6c75 6d6e 735f 696e 5f63  _of_columns_in_c
+0003f300: 6f72 7265 6374 5f6f 7264 6572 2e72 6576  orrect_order.rev
+0003f310: 6572 7365 2829 0d0a 0d0a 2020 2020 2020  erse()....      
+0003f320: 2020 2347 6574 2061 6e79 2073 686f 7274    #Get any short
+0003f330: 6e61 6d65 2066 6f72 2066 6965 6c64 2070  name for field p
+0003f340: 6173 7365 6420 696e 202d 2074 6869 7320  assed in - this 
+0003f350: 6e65 6564 7320 746f 2062 6520 636f 6e76  needs to be conv
+0003f360: 6572 7465 6420 746f 2061 206c 6973 7420  erted to a list 
+0003f370: 746f 206d 616b 6520 6974 2065 6173 7920  to make it easy 
+0003f380: 746f 2063 6f6d 6269 6e65 2077 6974 6820  to combine with 
+0003f390: 616e 6f74 6865 7220 6c69 7374 202d 2074  another list - t
+0003f3a0: 6865 2064 6566 6175 6c74 2069 7320 616e  he default is an
+0003f3b0: 2065 6d70 7479 206c 6973 7420 2869 2e65   empty list (i.e
+0003f3c0: 2e20 6e6f 7468 696e 6720 7761 7320 7061  . nothing was pa
+0003f3d0: 7373 6564 2069 6e29 0d0a 2020 2020 2020  ssed in)..      
+0003f3e0: 2020 6669 656c 6473 686f 7274 6e61 6d65    fieldshortname
+0003f3f0: 5f6c 6973 743d 5b5d 0d0a 2020 2020 2020  _list=[]..      
+0003f400: 2020 6966 2066 6965 6c64 5f73 686f 7274    if field_short
+0003f410: 6e61 6d65 2061 6e64 2066 6965 6c64 5f73  name and field_s
+0003f420: 686f 7274 6e61 6d65 206e 6f74 2069 6e20  hortname not in 
+0003f430: 5b27 5368 6f72 7420 4e61 6d65 272c 274c  ['Short Name','L
+0003f440: 6f6e 6720 4e61 6d65 272c 2749 4427 5d3a  ong Name','ID']:
+0003f450: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+0003f460: 656c 6473 686f 7274 6e61 6d65 5f6c 6973  eldshortname_lis
+0003f470: 743d 5b66 6965 6c64 5f73 686f 7274 6e61  t=[field_shortna
+0003f480: 6d65 5d0d 0a0d 0a20 2020 2020 2020 2023  me]....        #
+0003f490: 4669 6e61 6c6c 7920 636f 6e76 6572 7420  Finally convert 
+0003f4a0: 7468 6520 6c69 7374 206f 6620 6469 6374  the list of dict
+0003f4b0: 696f 6e61 7269 6573 2069 6e74 6f20 6120  ionaries into a 
+0003f4c0: 7061 6e64 6173 2044 6174 6146 7261 6d65  pandas DataFrame
+0003f4d0: 2c20 6f72 6465 7220 7468 6520 636f 6c75  , order the colu
+0003f4e0: 6d6e 7320 636f 7272 6563 746c 792c 2072  mns correctly, r
+0003f4f0: 656e 616d 6520 6173 206e 6563 6573 7361  ename as necessa
+0003f500: 7279 2c20 616e 6420 7265 7475 726e 0d0a  ry, and return..
+0003f510: 2020 2020 2020 2020 7265 7475 726e 5f64          return_d
+0003f520: 663d 2070 642e 4461 7461 4672 616d 6528  f= pd.DataFrame(
+0003f530: 6c69 7374 5f6f 665f 6469 6374 7329 0d0a  list_of_dicts)..
+0003f540: 0d0a 2020 2020 2020 2020 2347 6574 2073  ..        #Get s
+0003f550: 686f 7274 6e61 6d65 7320 616e 6420 736f  hortnames and so
+0003f560: 206f 6e20 6672 6f6d 2074 6865 2073 7461   on from the sta
+0003f570: 6e64 6172 6420 6461 7461 6672 616d 650d  ndard dataframe.
+0003f580: 0a20 2020 2020 2020 2072 6574 7572 6e5f  .        return_
+0003f590: 6466 3d70 642e 6d65 7267 6528 686f 773d  df=pd.merge(how=
+0003f5a0: 276c 6566 7427 2c6c 6566 743d 7265 7475  'left',left=retu
+0003f5b0: 726e 5f64 662c 7269 6768 743d 7365 6c66  rn_df,right=self
+0003f5c0: 2e73 7472 7563 7475 7265 2e64 696d 656e  .structure.dimen
+0003f5d0: 7369 6f6e 2e65 6c65 6d65 6e74 732e 6461  sion.elements.da
+0003f5e0: 7461 6672 616d 652c 6c65 6674 5f6f 6e3d  taframe,left_on=
+0003f5f0: 2749 4427 2c72 6967 6874 5f6f 6e3d 2749  'ID',right_on='I
+0003f600: 4427 290d 0a0d 0a20 2020 2020 2020 2074  D')....        t
+0003f610: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0003f620: 2072 6574 7572 6e5f 6466 3d72 6574 7572   return_df=retur
+0003f630: 6e5f 6466 5b5b 2749 4427 2c27 5368 6f72  n_df[['ID','Shor
+0003f640: 7420 4e61 6d65 272c 274c 6f6e 6720 4e61  t Name','Long Na
+0003f650: 6d65 275d 2b66 6965 6c64 7368 6f72 746e  me']+fieldshortn
+0003f660: 616d 655f 6c69 7374 2b6c 6973 745f 6f66  ame_list+list_of
+0003f670: 5f63 6f6c 756d 6e73 5f69 6e5f 636f 7272  _columns_in_corr
+0003f680: 6563 745f 6f72 6465 725d 0d0a 2020 2020  ect_order]..    
+0003f690: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+0003f6a0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+0003f6b0: 2020 7072 696e 7428 7265 7475 726e 5f64    print(return_d
+0003f6c0: 662e 6865 6164 2829 290d 0a20 2020 2020  f.head())..     
+0003f6d0: 2020 2020 2020 2072 6169 7365 0d0a 0d0a         raise....
+0003f6e0: 2020 2020 2020 2020 2357 6520 7769 6c6c          #We will
+0003f6f0: 2068 6176 6520 6120 6c6f 7420 6f66 2064   have a lot of d
+0003f700: 6174 6166 7261 6d65 7320 7769 7468 2074  ataframes with t
+0003f710: 6865 2073 616d 6520 636f 6c75 6d6e 206e  he same column n
+0003f720: 616d 6573 2028 6c65 7665 6c20 3020 7068  ames (level 0 ph
+0003f730: 7973 6964 2e2e 2e29 2061 6e64 2073 6f20  ysid...) and so 
+0003f740: 6f6e 2c20 736f 2074 6865 7265 2069 7320  on, so there is 
+0003f750: 6120 7061 7261 6d65 7465 7220 666f 7220  a parameter for 
+0003f760: 616e 206f 7074 696f 6e61 6c20 7072 6566  an optional pref
+0003f770: 6978 2074 6f20 6469 7361 6d62 6967 7561  ix to disambigua
+0003f780: 7465 206a 6f69 6e65 6420 636f 6c75 6d6e  te joined column
+0003f790: 206e 616d 6573 206c 6174 6572 0d0a 2020   names later..  
+0003f7a0: 2020 2020 2020 7265 6e61 6d65 5f64 6963        rename_dic
+0003f7b0: 743d 7b7d 0d0a 2020 2020 2020 2020 6966  t={}..        if
+0003f7c0: 2063 6f6c 756d 6e5f 7072 6566 6978 2069   column_prefix i
+0003f7d0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+0003f7e0: 2020 2020 2020 2020 2023 5265 6e61 6d65           #Rename
+0003f7f0: 2074 6865 2063 6f6c 756d 6e73 2077 6974   the columns wit
+0003f800: 6820 7468 6520 7375 7070 6c69 6564 2070  h the supplied p
+0003f810: 7265 6669 7820 6966 2074 6865 7265 2069  refix if there i
+0003f820: 7320 6f6e 650d 0a20 2020 2020 2020 2020  s one..         
+0003f830: 2020 2066 6f72 2063 6f6c 2069 6e20 7265     for col in re
+0003f840: 7475 726e 5f64 662e 636f 6c75 6d6e 733a  turn_df.columns:
+0003f850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0003f860: 2020 7265 6e61 6d65 5f64 6963 745b 636f    rename_dict[co
+0003f870: 6c5d 3d63 6f6c 756d 6e5f 7072 6566 6978  l]=column_prefix
+0003f880: 2b63 6f6c 0d0a 0d0a 2020 2020 2020 2020  +col....        
+0003f890: 7265 7475 726e 5f64 662e 7265 6e61 6d65  return_df.rename
+0003f8a0: 2863 6f6c 756d 6e73 3d72 656e 616d 655f  (columns=rename_
+0003f8b0: 6469 6374 2c69 6e70 6c61 6365 3d54 7275  dict,inplace=Tru
+0003f8c0: 6529 0d0a 0d0a 2020 2020 2020 2020 7265  e)....        re
+0003f8d0: 7475 726e 2072 6574 7572 6e5f 6466 0d0a  turn return_df..
+0003f8e0: 0d0a 2020 2020 6465 6620 7072 696e 745f  ..    def print_
+0003f8f0: 6869 6572 6172 6368 7928 7365 6c66 2c70  hierarchy(self,p
+0003f900: 7265 6669 785f 7374 7269 6e67 203d 2027  refix_string = '
+0003f910: 272c 636f 756e 7465 7220 3d20 4e6f 6e65  ',counter = None
+0003f920: 293a 0d0a 2020 2020 2020 2020 2727 2744  ):..        '''D
+0003f930: 6570 7265 6361 7465 642c 2055 7365 2074  eprecated, Use t
+0003f940: 6865 2070 7974 686f 6e20 7072 696e 7428  he python print(
+0003f950: 2920 6675 6e63 7469 6f6e 2069 6e73 7465  ) function inste
+0003f960: 6164 2e0d 0a20 2020 2020 2020 2050 7269  ad...        Pri
+0003f970: 6e74 7320 6f75 7420 7468 6520 5374 7275  nts out the Stru
+0003f980: 6374 7572 6545 6c65 6d65 6e74 2069 6e20  ctureElement in 
+0003f990: 7465 7874 2066 6f72 6d2e 0d0a 0d0a 2020  text form.....  
+0003f9a0: 2020 2020 2020 3e3e 3e20 7072 696e 7428        >>> print(
+0003f9b0: 7369 7465 2e64 696d 656e 7369 6f6e 735b  site.dimensions[
+0003f9c0: 305d 2e73 7472 7563 7475 7265 735b 2753  0].structures['S
+0003f9d0: 5041 4d27 5d2e 6869 6572 6172 6368 6965  PAM'].hierarchie
+0003f9e0: 735b 2745 4747 5327 5d29 0d0a 2020 2020  s['EGGS'])..    
+0003f9f0: 2020 2020 4547 4753 0d0a 2020 2020 2020      EGGS..      
+0003fa00: 2020 2b2d 4241 434f 4e0d 0a20 2020 2020    +-BACON..     
+0003fa10: 2020 2027 2727 0d0a 2020 2020 2020 2020     '''..        
+0003fa20: 7072 696e 7428 7365 6c66 2e5f 7265 7072  print(self._repr
+0003fa30: 6573 656e 745f 6869 6572 6172 6368 7928  esent_hierarchy(
+0003fa40: 7072 6566 6978 5f73 7472 696e 6720 3d20  prefix_string = 
+0003fa50: 7072 6566 6978 5f73 7472 696e 672c 636f  prefix_string,co
+0003fa60: 756e 7465 7220 3d20 636f 756e 7465 7229  unter = counter)
+0003fa70: 290d 0a0d 0a20 2020 2064 6566 205f 5f72  )....    def __r
+0003fa80: 6570 725f 5f28 7365 6c66 293a 0d0a 2020  epr__(self):..  
+0003fa90: 2020 2020 2020 7265 7475 726e 2027 3c7b        return '<{
+0003faa0: 7d20 6f62 6a65 6374 2c20 7368 6f72 746e  } object, shortn
+0003fab0: 616d 6520 7b7d 2c20 6c6f 6e67 6e61 6d65  ame {}, longname
+0003fac0: 207b 7d20 6174 207b 7d3e 272e 666f 726d   {} at {}>'.form
+0003fad0: 6174 2873 656c 662e 5f5f 636c 6173 735f  at(self.__class_
+0003fae0: 5f2e 5f5f 6e61 6d65 5f5f 2c73 656c 662e  _.__name__,self.
+0003faf0: 7368 6f72 746e 616d 652c 7365 6c66 2e6c  shortname,self.l
+0003fb00: 6f6e 676e 616d 652c 6865 7828 6964 2873  ongname,hex(id(s
+0003fb10: 656c 6629 2929 0d0a 0d0a 2020 2020 6465  elf)))....    de
+0003fb20: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
+0003fb30: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0003fb40: 2073 656c 662e 5f72 6570 7265 7365 6e74   self._represent
+0003fb50: 5f68 6965 7261 7263 6879 2829 0d0a 0d0a  _hierarchy()....
+0003fb60: 2020 2020 6465 6620 5f5f 6c65 6e5f 5f28      def __len__(
+0003fb70: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0003fb80: 7265 7475 726e 206c 656e 285b 7820 666f  return len([x fo
+0003fb90: 7220 7820 696e 2073 656c 662e 7761 6c6b  r x in self.walk
+0003fba0: 2829 5d29 0d0a 0d0a 0d0a 2020 2020 6465  ()])......    de
+0003fbb0: 6620 5f72 6570 7265 7365 6e74 5f68 6965  f _represent_hie
+0003fbc0: 7261 7263 6879 2873 656c 662c 7072 6566  rarchy(self,pref
+0003fbd0: 6978 5f73 7472 696e 6720 3d20 2727 2c63  ix_string = '',c
+0003fbe0: 6f75 6e74 6572 203d 204e 6f6e 6529 3a0d  ounter = None):.
+0003fbf0: 0a0d 0a20 2020 2020 2020 2072 6573 756c  ...        resul
+0003fc00: 7420 3d20 2727 0d0a 0d0a 2020 2020 2020  t = ''....      
+0003fc10: 2020 6966 2063 6f75 6e74 6572 2069 7320    if counter is 
+0003fc20: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0003fc30: 2020 2063 6f75 6e74 6572 203d 205f 436f     counter = _Co
+0003fc40: 756e 7465 7228 290d 0a0d 0a20 2020 2020  unter()....     
+0003fc50: 2020 2069 6620 7072 6566 6978 5f73 7472     if prefix_str
+0003fc60: 696e 673d 3d27 273a 0d0a 2020 2020 2020  ing=='':..      
+0003fc70: 2020 2020 2020 7265 7375 6c74 202b 3d20        result += 
+0003fc80: 277b 3a31 317d 7b3a 3139 7d7b 7d5c 6e27  '{:11}{:19}{}\n'
+0003fc90: 2e66 6f72 6d61 7428 7365 6c66 2e73 686f  .format(self.sho
+0003fca0: 7274 6e61 6d65 2c73 7472 2863 6f75 6e74  rtname,str(count
+0003fcb0: 6572 292c 2073 656c 662e 6c6f 6e67 6e61  er), self.longna
+0003fcc0: 6d65 290d 0a0d 0a20 2020 2020 2020 2065  me)....        e
+0003fcd0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0003fce0: 2020 7265 7375 6c74 202b 3d20 277b 7d2b    result += '{}+
+0003fcf0: 2d7b 3a31 317d 7b3a 3139 7d7b 7d5c 6e27  -{:11}{:19}{}\n'
+0003fd00: 2e66 6f72 6d61 7428 7072 6566 6978 5f73  .format(prefix_s
+0003fd10: 7472 696e 675b 3a2d 325d 2c20 7365 6c66  tring[:-2], self
+0003fd20: 2e73 686f 7274 6e61 6d65 2c73 7472 2863  .shortname,str(c
+0003fd30: 6f75 6e74 6572 292c 7365 6c66 2e6c 6f6e  ounter),self.lon
+0003fd40: 676e 616d 6529 0d0a 0d0a 2020 2020 2020  gname)....      
+0003fd50: 2020 6b69 6473 203d 205b 6320 666f 7220    kids = [c for 
+0003fd60: 6320 696e 2073 656c 662e 6368 696c 6472  c in self.childr
+0003fd70: 656e 5d0d 0a20 2020 2020 2020 2066 6f72  en]..        for
+0003fd80: 206e 2c20 6520 696e 2065 6e75 6d65 7261   n, e in enumera
+0003fd90: 7465 286b 6964 7329 3a0d 0a20 2020 2020  te(kids):..     
+0003fda0: 2020 2020 2020 2069 6620 6e2b 313d 3d6c         if n+1==l
+0003fdb0: 656e 286b 6964 7329 3a0d 0a20 2020 2020  en(kids):..     
+0003fdc0: 2020 2020 2020 2020 2020 2061 6464 656e             adden
+0003fdd0: 6475 6d20 3d20 2720 2027 0d0a 2020 2020  dum = '  '..    
+0003fde0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+0003fdf0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0003fe00: 6464 656e 6475 6d20 3d20 277c 2027 0d0a  ddendum = '| '..
+0003fe10: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0003fe20: 6c74 202b 3d20 652e 5f72 6570 7265 7365  lt += e._represe
+0003fe30: 6e74 5f68 6965 7261 7263 6879 2870 7265  nt_hierarchy(pre
+0003fe40: 6669 785f 7374 7269 6e67 203d 2070 7265  fix_string = pre
+0003fe50: 6669 785f 7374 7269 6e67 2b61 6464 656e  fix_string+adden
+0003fe60: 6475 6d2c 636f 756e 7465 7220 3d20 636f  dum,counter = co
+0003fe70: 756e 7465 7229 0d0a 0d0a 2020 2020 2020  unter)....      
+0003fe80: 2020 7265 7475 726e 2072 6573 756c 740d    return result.
+0003fe90: 0a0d 0a20 2020 2064 6566 2067 6574 5f6c  ...    def get_l
+0003fea0: 6561 7665 7328 7365 6c66 2c73 7562 7472  eaves(self,subtr
+0003feb0: 6565 5f73 686f 7274 6e61 6d65 3d4e 6f6e  ee_shortname=Non
+0003fec0: 652c 7065 726d 6973 7369 7665 3d54 7275  e,permissive=Tru
+0003fed0: 6529 3a0d 0a20 2020 2020 2020 2027 2727  e):..        '''
+0003fee0: 5969 656c 6420 7468 6520 6c65 6166 2053  Yield the leaf S
+0003fef0: 7472 7563 7475 7265 456c 656d 656e 7473  tructureElements
+0003ff00: 2069 6e20 6120 7261 6767 6564 2068 6965   in a ragged hie
+0003ff10: 7261 7263 6879 2c20 6265 6c6f 7720 7468  rarchy, below th
+0003ff20: 6520 6769 7665 6e20 7368 6f72 746e 616d  e given shortnam
+0003ff30: 650d 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+0003ff40: 6d20 7375 6274 7265 655f 7368 6f72 746e  m subtree_shortn
+0003ff50: 616d 653a 2045 6d70 6f77 6572 2053 686f  ame: Empower Sho
+0003ff60: 7274 204e 616d 6520 6f66 2074 6865 2053  rt Name of the S
+0003ff70: 7472 7563 7475 7265 2045 6c65 6d65 6e74  tructure Element
+0003ff80: 2077 6520 7761 6e74 2074 6f20 7374 6172   we want to star
+0003ff90: 7420 7969 656c 6469 6e67 2069 7465 6d73  t yielding items
+0003ffa0: 2066 726f 6d2e 2044 6566 6175 6c74 7320   from. Defaults 
+0003ffb0: 746f 2074 6865 2072 6f6f 7420 6f66 2074  to the root of t
+0003ffc0: 6865 2074 7265 652e 0d0a 2020 2020 2020  he tree...      
+0003ffd0: 2020 2727 270d 0a0d 0a20 2020 2020 2020    '''....       
+0003ffe0: 2069 6620 7375 6274 7265 655f 7368 6f72   if subtree_shor
+0003fff0: 746e 616d 6520 6973 204e 6f6e 653a 0d0a  tname is None:..
+00040000: 2020 2020 2020 2020 2020 2020 7375 6274              subt
+00040010: 7265 655f 7368 6f72 746e 616d 653d 7365  ree_shortname=se
+00040020: 6c66 2e73 686f 7274 6e61 6d65 0d0a 0d0a  lf.shortname....
+00040030: 2020 2020 2020 2020 666f 7220 6520 696e          for e in
+00040040: 2073 656c 662e 7761 6c6b 5f73 7562 7472   self.walk_subtr
+00040050: 6565 2873 7562 7472 6565 5f73 686f 7274  ee(subtree_short
+00040060: 6e61 6d65 3d73 7562 7472 6565 5f73 686f  name=subtree_sho
+00040070: 7274 6e61 6d65 2c70 6572 6d69 7373 6976  rtname,permissiv
+00040080: 653d 7065 726d 6973 7369 7665 293a 0d0a  e=permissive):..
+00040090: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+000400a0: 2e69 735f 6c65 6166 3a0d 0a20 2020 2020  .is_leaf:..     
+000400b0: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+000400c0: 2065 0d0a 0d0a 2020 2020 4070 726f 7065   e....    @prope
+000400d0: 7274 790d 0a20 2020 2064 6566 206c 6561  rty..    def lea
+000400e0: 7665 7328 7365 6c66 293a 0d0a 2020 2020  ves(self):..    
+000400f0: 2020 2020 2727 2759 6965 6c64 2074 6865      '''Yield the
+00040100: 206c 6561 6620 5374 7275 6374 7572 6545   leaf StructureE
+00040110: 6c65 6d65 6e74 7320 696e 2061 2072 6167  lements in a rag
+00040120: 6765 6420 6869 6572 6172 6368 792c 2062  ged hierarchy, b
+00040130: 656c 6f77 2074 6865 2067 6976 656e 2073  elow the given s
+00040140: 686f 7274 6e61 6d65 2727 270d 0a0d 0a20  hortname'''.... 
+00040150: 2020 2020 2020 2079 6965 6c64 2066 726f         yield fro
+00040160: 6d20 7365 6c66 2e67 6574 5f6c 6561 7665  m self.get_leave
+00040170: 7328 7375 6274 7265 655f 7368 6f72 746e  s(subtree_shortn
+00040180: 616d 653d 4e6f 6e65 2c70 6572 6d69 7373  ame=None,permiss
+00040190: 6976 653d 5472 7565 290d 0a0d 0a20 2020  ive=True)....   
+000401a0: 2064 6566 2067 6574 5f75 6e69 7175 655f   def get_unique_
+000401b0: 6c65 6176 6573 2873 656c 662c 7375 6274  leaves(self,subt
+000401c0: 7265 655f 7368 6f72 746e 616d 653d 4e6f  ree_shortname=No
+000401d0: 6e65 293a 0d0a 2020 2020 2020 2020 2727  ne):..        ''
+000401e0: 2759 6965 6c64 2075 6e69 7175 6520 6c65  'Yield unique le
+000401f0: 6166 2044 696d 656e 7369 6f6e 456c 656d  af DimensionElem
+00040200: 656e 7473 2069 6e20 6120 7261 6767 6564  ents in a ragged
+00040210: 2068 6965 7261 7263 6879 2c20 6265 6c6f   hierarchy, belo
+00040220: 7720 7468 6520 6769 7665 6e20 7368 6f72  w the given shor
+00040230: 746e 616d 650d 0a20 2020 2020 2020 203a  tname..        :
+00040240: 7061 7261 6d20 7375 6274 7265 655f 7368  param subtree_sh
+00040250: 6f72 746e 616d 653a 2045 6d70 6f77 6572  ortname: Empower
+00040260: 2053 686f 7274 204e 616d 6520 6f66 2074   Short Name of t
+00040270: 6865 2053 7472 7563 7475 7265 2045 6c65  he Structure Ele
+00040280: 6d65 6e74 2077 6520 7761 6e74 2074 6f20  ment we want to 
+00040290: 7374 6172 7420 7969 656c 6469 6e67 2069  start yielding i
+000402a0: 7465 6d73 2066 726f 6d2e 2044 6566 6175  tems from. Defau
+000402b0: 6c74 7320 746f 2074 6865 2072 6f6f 7420  lts to the root 
+000402c0: 6f66 2074 6865 2074 7265 652e 0d0a 2020  of the tree...  
+000402d0: 2020 2020 2020 2727 270d 0a0d 0a20 2020        '''....   
+000402e0: 2020 2020 2069 6620 7375 6274 7265 655f       if subtree_
+000402f0: 7368 6f72 746e 616d 6520 6973 204e 6f6e  shortname is Non
+00040300: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00040310: 7375 6274 7265 655f 7368 6f72 746e 616d  subtree_shortnam
+00040320: 653d 7365 6c66 2e73 686f 7274 6e61 6d65  e=self.shortname
+00040330: 0d0a 0d0a 2020 2020 2020 2020 7969 656c  ....        yiel
+00040340: 6465 645f 7368 6f72 746e 616d 6573 203d  ded_shortnames =
+00040350: 205b 5d0d 0a0d 0a20 2020 2020 2020 2066   []....        f
+00040360: 6f72 2065 2069 6e20 7365 6c66 2e77 616c  or e in self.wal
+00040370: 6b5f 7375 6274 7265 6528 7375 6274 7265  k_subtree(subtre
+00040380: 655f 7368 6f72 746e 616d 653d 7375 6274  e_shortname=subt
+00040390: 7265 655f 7368 6f72 746e 616d 652c 7065  ree_shortname,pe
+000403a0: 726d 6973 7369 7665 3d54 7275 6529 3a0d  rmissive=True):.
+000403b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000403c0: 652e 6973 5f6c 6561 663a 0d0a 2020 2020  e.is_leaf:..    
+000403d0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+000403e0: 2e73 686f 7274 6e61 6d65 206e 6f74 2069  .shortname not i
+000403f0: 6e20 7969 656c 6465 645f 7368 6f72 746e  n yielded_shortn
+00040400: 616d 6573 3a0d 0a20 2020 2020 2020 2020  ames:..         
+00040410: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
+00040420: 6564 5f73 686f 7274 6e61 6d65 732e 6170  ed_shortnames.ap
+00040430: 7065 6e64 2865 2e73 686f 7274 6e61 6d65  pend(e.shortname
+00040440: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00040450: 2020 2020 2020 2023 5969 656c 6420 7468         #Yield th
+00040460: 6520 6469 6d65 6e73 696f 6e20 656c 656d  e dimension elem
+00040470: 656e 7420 696e 2071 7565 7374 696f 6e0d  ent in question.
+00040480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040490: 2020 2020 2079 6965 6c64 2065 2e65 6c65       yield e.ele
+000404a0: 6d65 6e74 0d0a 0d0a 2020 2020 6465 6620  ment....    def 
+000404b0: 6765 745f 656c 656d 656e 7473 2873 656c  get_elements(sel
+000404c0: 662c 7368 6f72 746e 616d 6529 3a0d 0a20  f,shortname):.. 
+000404d0: 2020 2020 2020 2027 2727 4765 7420 616c         '''Get al
+000404e0: 6c20 6f66 2074 6865 2065 6c65 6d65 6e74  l of the element
+000404f0: 7320 696e 2074 6869 7320 6869 6572 6172  s in this hierar
+00040500: 6368 7920 7769 7468 2074 6865 2067 6976  chy with the giv
+00040510: 656e 2073 686f 7274 6e61 6d65 2727 270d  en shortname'''.
+00040520: 0a20 2020 2020 2020 2023 4b65 6570 2074  .        #Keep t
+00040530: 7261 636b 206f 6620 7768 6574 6865 7220  rack of whether 
+00040540: 616e 2065 6c65 6d65 6e74 2077 6173 2070  an element was p
+00040550: 6173 7365 6420 696e 2074 6f20 6865 6c70  assed in to help
+00040560: 2077 6974 6820 6465 6275 6767 696e 670d   with debugging.
+00040570: 0a20 2020 2020 2020 2065 6c65 6d65 6e74  .        element
+00040580: 5f77 6173 5f70 6173 7365 645f 696e 3d46  _was_passed_in=F
+00040590: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
+000405a0: 2349 6620 616e 2065 6c65 6d65 6e74 2068  #If an element h
+000405b0: 6173 2062 6565 6e20 7061 7373 6564 2069  as been passed i
+000405c0: 6e2c 2075 7365 2074 6865 2065 6c65 6d65  n, use the eleme
+000405d0: 6e74 2773 2073 686f 7274 6e61 6d65 0d0a  nt's shortname..
+000405e0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+000405f0: 2020 2020 2020 2020 2020 7368 6f72 746e            shortn
+00040600: 616d 653d 7368 6f72 746e 616d 652e 7368  ame=shortname.sh
+00040610: 6f72 746e 616d 650d 0a20 2020 2020 2020  ortname..       
+00040620: 2020 2020 2065 6c65 6d65 6e74 5f77 6173       element_was
+00040630: 5f70 6173 7365 645f 696e 3d54 7275 650d  _passed_in=True.
+00040640: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00040650: 4174 7472 6962 7574 6545 7272 6f72 3a0d  AttributeError:.
+00040660: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+00040670: 730d 0a0d 0a20 2020 2020 2020 2023 4368  s....        #Ch
+00040680: 6563 6b20 7468 6174 2073 686f 7274 6e61  eck that shortna
+00040690: 6d65 2069 7320 6e6f 7420 4e6f 6e65 0d0a  me is not None..
+000406a0: 2020 2020 2020 2020 6966 2073 686f 7274          if short
+000406b0: 6e61 6d65 2069 7320 4e6f 6e65 3a0d 0a20  name is None:.. 
+000406c0: 2020 2020 2020 2020 2020 2023 5072 6f67             #Prog
+000406d0: 7261 6d6d 696e 6720 6572 726f 720d 0a20  ramming error.. 
+000406e0: 2020 2020 2020 2020 2020 2069 6620 656c             if el
+000406f0: 656d 656e 745f 7761 735f 7061 7373 6564  ement_was_passed
+00040700: 5f69 6e3a 0d0a 2020 2020 2020 2020 2020  _in:..          
+00040710: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00040720: 6545 7272 6f72 2827 656c 656d 656e 742e  eError('element.
+00040730: 7368 6f72 746e 616d 6520 6d75 7374 2068  shortname must h
+00040740: 6176 6520 6120 7661 6c75 652e 204e 6f6e  ave a value. Non
+00040750: 6520 7761 7320 7375 7070 6c69 6564 2e20  e was supplied. 
+00040760: 6465 6275 6767 696e 6720 696e 666f 726d  debugging inform
+00040770: 6174 696f 6e3a 2041 2070 796d 7078 2e45  ation: A pympx.E
+00040780: 6c65 6d65 6e74 2069 6e73 7461 6e63 6520  lement instance 
+00040790: 7761 7320 7061 7373 6564 2069 6e20 6173  was passed in as
+000407a0: 2074 6865 2073 686f 7274 6e61 6d65 2070   the shortname p
+000407b0: 6172 616d 6574 6572 2074 6f20 6675 6e63  arameter to func
+000407c0: 7469 6f6e 2067 6574 5f65 6c65 6d65 6e74  tion get_element
+000407d0: 2829 2729 0d0a 2020 2020 2020 2020 2020  ()')..          
+000407e0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000407f0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00040800: 616c 7565 4572 726f 7228 2773 686f 7274  alueError('short
+00040810: 6e61 6d65 206d 7573 7420 6861 7665 2061  name must have a
+00040820: 2076 616c 7565 2e20 4e6f 6e65 2077 6173   value. None was
+00040830: 2073 7570 706c 6965 642e 2729 0d0a 2020   supplied.')..  
+00040840: 2020 2020 2020 7472 793a 0d0a 0d0a 2020        try:....  
+00040850: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00040860: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
+00040870: 2020 2066 6f72 2073 6520 696e 2073 656c     for se in sel
+00040880: 662e 7761 6c6b 2870 6572 6d69 7373 6976  f.walk(permissiv
+00040890: 653d 5472 7565 293a 0d0a 2020 2020 2020  e=True):..      
+000408a0: 2020 2020 2020 2020 2020 6966 2073 652e            if se.
+000408b0: 7368 6f72 746e 616d 6520 3d3d 2073 686f  shortname == sho
+000408c0: 7274 6e61 6d65 3a0d 0a20 2020 2020 2020  rtname:..       
+000408d0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+000408e0: 756c 742e 6170 7065 6e64 2873 6529 0d0a  ult.append(se)..
+000408f0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00040900: 726e 2072 6573 756c 740d 0a0d 0a20 2020  rn result....   
+00040910: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+00040920: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+00040930: 2020 2072 6574 7572 6e20 5b5d 0d0a 0d0a     return []....
+00040940: 2020 2020 6465 6620 5f67 6574 5f66 6972      def _get_fir
+00040950: 7374 5f65 6c65 6d65 6e74 5f77 6974 685f  st_element_with_
+00040960: 7368 6f72 746e 616d 6528 7365 6c66 2c73  shortname(self,s
+00040970: 686f 7274 6e61 6d65 293a 0d0a 2020 2020  hortname):..    
+00040980: 2020 2020 2727 2747 6574 2074 6865 2066      '''Get the f
+00040990: 6972 7374 2065 6c65 6d65 6e74 2069 6e20  irst element in 
+000409a0: 7468 6973 2068 6569 7261 7263 6879 2077  this heirarchy w
+000409b0: 6974 6820 7468 6520 6769 7665 6e20 7368  ith the given sh
+000409c0: 6f72 746e 616d 6520 2d20 7573 6564 2069  ortname - used i
+000409d0: 6e74 6572 6e61 6c6c 792c 2077 6974 6820  nternally, with 
+000409e0: 6361 7265 2c20 666f 7220 7369 7475 6174  care, for situat
+000409f0: 696f 6e73 2077 6865 6e20 7765 206b 6e6f  ions when we kno
+00040a00: 7720 7468 6174 2073 7563 6820 616e 2065  w that such an e
+00040a10: 6c65 6d65 6e74 2073 686f 756c 6420 6578  lement should ex
+00040a20: 6973 7420 696e 2074 6865 2073 7562 7472  ist in the subtr
+00040a30: 6565 206f 6e63 6527 2727 0d0a 0d0a 2020  ee once'''....  
+00040a40: 2020 2020 2020 2349 6620 616e 2065 6c65        #If an ele
+00040a50: 6d65 6e74 2068 6173 2062 6565 6e20 7061  ment has been pa
+00040a60: 7373 6564 2069 6e2c 2075 7365 2074 6865  ssed in, use the
+00040a70: 2065 6c65 6d65 6e74 2773 2073 686f 7274   element's short
+00040a80: 6e61 6d65 0d0a 2020 2020 2020 2020 7472  name..        tr
+00040a90: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00040aa0: 7368 6f72 746e 616d 653d 7368 6f72 746e  shortname=shortn
+00040ab0: 616d 652e 7368 6f72 746e 616d 650d 0a20  ame.shortname.. 
+00040ac0: 2020 2020 2020 2065 7863 6570 7420 4174         except At
+00040ad0: 7472 6962 7574 6545 7272 6f72 3a0d 0a20  tributeError:.. 
+00040ae0: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+00040af0: 0a0d 0a20 2020 2020 2020 2023 4368 6563  ...        #Chec
+00040b00: 6b20 7468 6174 2073 686f 7274 6e61 6d65  k that shortname
+00040b10: 2069 7320 6e6f 7420 4e6f 6e65 0d0a 2020   is not None..  
+00040b20: 2020 2020 2020 6966 2073 686f 7274 6e61        if shortna
+00040b30: 6d65 2069 7320 4e6f 6e65 3a0d 0a20 2020  me is None:..   
+00040b40: 2020 2020 2020 2020 2023 5072 6f67 7261           #Progra
+00040b50: 6d6d 696e 6720 6572 726f 720d 0a20 2020  mming error..   
+00040b60: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+00040b70: 616c 7565 4572 726f 7228 2773 686f 7274  alueError('short
+00040b80: 6e61 6d65 206d 7573 7420 6861 7665 2061  name must have a
+00040b90: 2076 616c 7565 2e20 4e6f 6e65 2077 6173   value. None was
+00040ba0: 2073 7570 706c 6965 642e 2729 0d0a 2020   supplied.')..  
+00040bb0: 2020 2020 2020 7472 793a 0d0a 0d0a 2020        try:....  
+00040bc0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+00040bd0: 203d 205b 5d0d 0a20 2020 2020 2020 2020   = []..         
+00040be0: 2020 2066 6f72 2073 6520 696e 2073 656c     for se in sel
+00040bf0: 662e 7761 6c6b 2870 6572 6d69 7373 6976  f.walk(permissiv
+00040c00: 653d 5472 7565 293a 0d0a 2020 2020 2020  e=True):..      
+00040c10: 2020 2020 2020 2020 2020 6966 2073 652e            if se.
+00040c20: 7368 6f72 746e 616d 6520 3d3d 2073 686f  shortname == sho
+00040c30: 7274 6e61 6d65 3a0d 0a20 2020 2020 2020  rtname:..       
+00040c40: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00040c50: 7572 6e20 7365 0d0a 0d0a 2020 2020 2020  urn se....      
+00040c60: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+00040c70: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+00040c80: 7265 7475 726e 204e 6f6e 650d 0a0d 0a20  return None.... 
+00040c90: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+00040ca0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00040cb0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00040cc0: 0d0a 2020 2020 230d 0a20 2020 2023 2053  ..    #..    # S
+00040cd0: 7472 7563 7475 7265 206d 616e 6970 756c  tructure manipul
+00040ce0: 6174 696f 6e20 6675 6e63 7469 6f6e 730d  ation functions.
+00040cf0: 0a20 2020 2023 0d0a 2020 2020 2323 2323  .    #..    ####
+00040d00: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00040d10: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00040d20: 2323 2323 2323 2323 230d 0a0d 0a20 2020  #########....   
+00040d30: 2064 6566 2063 6f70 7928 7365 6c66 2c20   def copy(self, 
+00040d40: 656c 656d 656e 745f 7368 6f72 746e 616d  element_shortnam
+00040d50: 655f 6669 6c74 6572 5f6f 7574 5f6c 6973  e_filter_out_lis
+00040d60: 7420 3d20 5b5d 293a 0d0a 2020 2020 2020  t = []):..      
+00040d70: 2020 2727 2752 6574 7572 6e20 6120 636f    '''Return a co
+00040d80: 7079 206f 6620 7468 6520 6869 6572 6172  py of the hierar
+00040d90: 6368 7927 2727 0d0a 2020 2020 2020 2020  chy'''..        
+00040da0: 636f 7079 5f73 656c 6620 3d20 5374 7275  copy_self = Stru
+00040db0: 6374 7572 6545 6c65 6d65 6e74 2865 6c65  ctureElement(ele
+00040dc0: 6d65 6e74 203d 2073 656c 662e 656c 656d  ment = self.elem
+00040dd0: 656e 742c 2069 735f 726f 6f74 203d 2073  ent, is_root = s
+00040de0: 656c 662e 6973 5f72 6f6f 7429 0d0a 0d0a  elf.is_root)....
+00040df0: 2020 2020 2020 2020 666f 7220 6520 696e          for e in
+00040e00: 2073 656c 662e 6368 696c 6472 656e 3a0d   self.children:.
+00040e10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00040e20: 6e6f 7420 2865 2e65 6c65 6d65 6e74 2e73  not (e.element.s
+00040e30: 686f 7274 6e61 6d65 2069 6e20 656c 656d  hortname in elem
+00040e40: 656e 745f 7368 6f72 746e 616d 655f 6669  ent_shortname_fi
+00040e50: 6c74 6572 5f6f 7574 5f6c 6973 7429 3a0d  lter_out_list):.
+00040e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00040e70: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00040e80: 2020 2020 2020 2020 2020 2063 6f70 795f             copy_
+00040e90: 7365 6c66 2e5f 6164 645f 6368 696c 6428  self._add_child(
+00040ea0: 652e 636f 7079 2865 6c65 6d65 6e74 5f73  e.copy(element_s
+00040eb0: 686f 7274 6e61 6d65 5f66 696c 7465 725f  hortname_filter_
+00040ec0: 6f75 745f 6c69 7374 3d65 6c65 6d65 6e74  out_list=element
+00040ed0: 5f73 686f 7274 6e61 6d65 5f66 696c 7465  _shortname_filte
+00040ee0: 725f 6f75 745f 6c69 7374 2929 0d0a 2020  r_out_list))..  
+00040ef0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00040f00: 6365 7074 2052 6563 7572 7369 6f6e 4572  cept RecursionEr
+00040f10: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+00040f20: 2020 2020 2020 2020 2020 2357 6527 7665            #We've
+00040f30: 2067 6f6e 6520 746f 6f20 6465 6570 2c20   gone too deep, 
+00040f40: 7468 6572 6520 6d75 7374 2062 6520 736f  there must be so
+00040f50: 6d65 2073 6f72 7420 6f66 206c 6f6f 7020  me sort of loop 
+00040f60: 696e 2074 6865 2068 6965 7261 7263 6879  in the hierarchy
 00040f70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00040f80: 2020 2020 2020 656c 3d73 656c 660d 0a20        el=self.. 
-00040f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00040fa0: 2020 206c 6f67 2e65 7272 6f72 2827 5265     log.error('Re
-00040fb0: 6375 7273 696f 6e20 6572 726f 722e 2053  cursion error. S
-00040fc0: 686f 7769 6e67 2065 6c65 6d65 6e74 7320  howing elements 
-00040fd0: 6d6f 7669 6e67 2075 7020 7468 6520 6869  moving up the hi
-00040fe0: 6572 6172 6368 792c 2070 6c65 6173 6520  erarchy, please 
-00040ff0: 7472 7920 746f 2064 6574 6563 7420 6c6f  try to detect lo
-00041000: 6f70 2c20 616e 6420 6669 7820 6974 2e27  op, and fix it.'
-00041010: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00041020: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00041030: 7261 6e67 6528 3230 293a 0d0a 2020 2020  range(20):..    
+00040f80: 2020 2020 2020 2370 7269 6e74 206f 7574        #print out
+00040f90: 2074 6865 2070 6172 656e 7473 0d0a 2020   the parents..  
+00040fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00040fb0: 2020 656c 3d73 656c 660d 0a20 2020 2020    el=self..     
+00040fc0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00040fd0: 6f67 2e65 7272 6f72 2827 5265 6375 7273  og.error('Recurs
+00040fe0: 696f 6e20 6572 726f 722e 2053 686f 7769  ion error. Showi
+00040ff0: 6e67 2065 6c65 6d65 6e74 7320 6d6f 7669  ng elements movi
+00041000: 6e67 2075 7020 7468 6520 6869 6572 6172  ng up the hierar
+00041010: 6368 792c 2070 6c65 6173 6520 7472 7920  chy, please try 
+00041020: 746f 2064 6574 6563 7420 6c6f 6f70 2c20  to detect loop, 
+00041030: 616e 6420 6669 7820 6974 2e27 290d 0a20  and fix it.').. 
 00041040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00041050: 2020 2020 6c6f 672e 6572 726f 7228 2752      log.error('R
-00041060: 6563 7572 7369 6f6e 2065 7272 6f72 2e20  ecursion error. 
-00041070: 456e 7469 7479 2073 686f 7274 6e61 6d65  Entity shortname
-00041080: 3d27 2b65 6c2e 7368 6f72 746e 616d 652b  ='+el.shortname+
-00041090: 2720 7061 7265 6e74 3d27 2b72 6570 7228  ' parent='+repr(
-000410a0: 656c 2e70 6172 656e 7429 290d 0a20 2020  el.parent))..   
-000410b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000410c0: 2020 2020 2065 6c3d 656c 2e70 6172 656e       el=el.paren
-000410d0: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-000410e0: 2020 2020 2020 2023 4361 6e27 7420 6a75         #Can't ju
-000410f0: 7374 2072 6572 6169 7365 2c20 6f72 2077  st reraise, or w
-00041100: 6520 7769 6c6c 2072 652d 6361 7463 6820  e will re-catch 
-00041110: 7468 6520 7361 6d65 2072 6563 7572 7369  the same recursi
-00041120: 6f6e 2065 7272 6f72 2067 6f69 6e67 2062  on error going b
-00041130: 6163 6b20 7570 2074 6865 2074 7265 6521  ack up the tree!
-00041140: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00041150: 2020 2020 2020 7261 6973 6520 5379 7374        raise Syst
-00041160: 656d 4572 726f 7228 290d 0a0d 0a20 2020  emError()....   
-00041170: 2020 2020 2072 6574 7572 6e20 636f 7079       return copy
-00041180: 5f73 656c 660d 0a0d 0a20 2020 2064 6566  _self....    def
-00041190: 2061 7070 6c79 2873 656c 662c 2066 756e   apply(self, fun
-000411a0: 6374 696f 6e29 3a0d 0a20 2020 2020 2020  ction):..       
-000411b0: 2027 2727 7265 6375 7273 6976 656c 7920   '''recursively 
-000411c0: 6170 706c 7920 6120 6675 6e63 7469 6f6e  apply a function
-000411d0: 2074 6f20 7468 6520 6869 6572 6172 6368   to the hierarch
-000411e0: 7927 2727 0d0a 0d0a 2020 2020 2020 2020  y'''....        
-000411f0: 2341 7070 6c79 2074 6865 2066 756e 6374  #Apply the funct
-00041200: 696f 6e20 746f 2074 6865 2063 6869 6c64  ion to the child
-00041210: 7265 6e0d 0a20 2020 2020 2020 206e 6577  ren..        new
-00041220: 5f63 6869 6c64 7265 6e20 3d20 5b5d 0d0a  _children = []..
-00041230: 2020 2020 2020 2020 666f 7220 6368 2069          for ch i
-00041240: 6e20 6c69 7374 2873 656c 662e 6368 696c  n list(self.chil
-00041250: 6472 656e 293a 0d0a 2020 2020 2020 2020  dren):..        
-00041260: 2020 2020 6e65 775f 6368 696c 6420 3d20      new_child = 
-00041270: 6368 2e61 7070 6c79 2866 756e 6374 696f  ch.apply(functio
-00041280: 6e29 0d0a 2020 2020 2020 2020 2020 2020  n)..            
-00041290: 6966 206e 6f74 206e 6577 5f63 6869 6c64  if not new_child
-000412a0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-000412b0: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
-000412c0: 6869 6c64 7265 6e2e 6170 7065 6e64 286e  hildren.append(n
-000412d0: 6577 5f63 6869 6c64 290d 0a0d 0a20 2020  ew_child)....   
-000412e0: 2020 2020 2023 4170 706c 7920 7468 6520       #Apply the 
-000412f0: 6675 6e63 7469 6f6e 2074 6f20 7365 6c66  function to self
-00041300: 0d0a 2020 2020 2020 2020 6f75 7470 7574  ..        output
-00041310: 5f73 6520 3d20 6675 6e63 7469 6f6e 2873  _se = function(s
-00041320: 656c 6629 0d0a 0d0a 2020 2020 2020 2020  elf)....        
-00041330: 6966 206f 7574 7075 745f 7365 2069 7320  if output_se is 
-00041340: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00041350: 2020 2072 6574 7572 6e20 4e6f 6e65 0d0a     return None..
-00041360: 0d0a 2020 2020 2020 2020 2352 6570 6c61  ..        #Repla
-00041370: 6365 2063 6869 6c64 7265 6e20 7769 7468  ce children with
-00041380: 2074 6865 206e 6577 2063 6869 6c64 7265   the new childre
-00041390: 6e0d 0a20 2020 2020 2020 206f 7574 7075  n..        outpu
-000413a0: 745f 7365 2e63 6869 6c64 7265 6e2e 636c  t_se.children.cl
-000413b0: 6561 7228 290d 0a20 2020 2020 2020 206f  ear()..        o
-000413c0: 7574 7075 745f 7365 2e63 6869 6c64 7265  utput_se.childre
-000413d0: 6e20 2b3d 206e 6577 5f63 6869 6c64 7265  n += new_childre
-000413e0: 6e0d 0a20 2020 2020 2020 2023 6c6f 672e  n..        #log.
-000413f0: 696e 666f 2873 7472 2864 6963 7428 6f75  info(str(dict(ou
-00041400: 7470 7574 5f73 652e 6368 696c 6472 656e  tput_se.children
-00041410: 2929 290d 0a0d 0a20 2020 2020 2020 2072  )))....        r
-00041420: 6574 7572 6e20 6f75 7470 7574 5f73 650d  eturn output_se.
-00041430: 0a0d 0a20 2020 2064 6566 2073 7761 705f  ...    def swap_
-00041440: 656c 656d 656e 7473 2873 656c 662c 2073  elements(self, s
-00041450: 686f 7274 636f 6465 5f65 6c65 6d65 6e74  hortcode_element
-00041460: 5f64 6963 7469 6f6e 6172 7929 3a0d 0a20  _dictionary):.. 
-00041470: 2020 2020 2020 2027 2727 5377 6170 206f         '''Swap o
-00041480: 7574 2065 6c65 6d65 6e74 7320 696e 2074  ut elements in t
-00041490: 6865 2074 7265 6520 666f 7220 6e65 7720  he tree for new 
-000414a0: 6f6e 6573 0d0a 2020 2020 2020 2020 4966  ones..        If
-000414b0: 2073 656c 6620 6e6f 7420 696e 2074 6865   self not in the
-000414c0: 2073 686f 7274 636f 6465 5f65 6c65 6d65   shortcode_eleme
-000414d0: 6e74 5f64 6963 7469 6f6e 6172 792c 2074  nt_dictionary, t
-000414e0: 6865 6e20 7265 7475 726e 2061 2063 6f70  hen return a cop
-000414f0: 7920 6f66 2073 656c 660d 0a20 2020 2020  y of self..     
-00041500: 2020 2027 2727 0d0a 0d0a 2020 2020 2020     '''....      
-00041510: 2020 2343 7265 6174 6520 6120 6675 6e63    #Create a func
-00041520: 7469 6f6e 2074 6861 7420 7377 6170 2065  tion that swap e
-00041530: 6c65 6d65 6e74 730d 0a20 2020 2020 2020  lements..       
-00041540: 2064 6566 205f 7377 6170 5f65 6c65 6d65   def _swap_eleme
-00041550: 6e74 2873 7472 7563 7475 7265 5f65 6c65  nt(structure_ele
-00041560: 6d65 6e74 293a 0d0a 2020 2020 2020 2020  ment):..        
-00041570: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-00041580: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-00041590: 7420 3d20 7368 6f72 7463 6f64 655f 656c  t = shortcode_el
-000415a0: 656d 656e 745f 6469 6374 696f 6e61 7279  ement_dictionary
-000415b0: 5b73 7472 7563 7475 7265 5f65 6c65 6d65  [structure_eleme
-000415c0: 6e74 2e73 686f 7274 636f 6465 5d0d 0a20  nt.shortcode].. 
-000415d0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000415e0: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
-000415f0: 2020 2020 2020 2020 2020 2020 2065 6c65               ele
-00041600: 6d65 6e74 203d 2073 7472 7563 7475 7265  ment = structure
-00041610: 5f65 6c65 6d65 6e74 2e64 696d 656e 7369  _element.dimensi
-00041620: 6f6e 2e65 6c65 6d65 6e74 735b 7374 7275  on.elements[stru
-00041630: 6374 7572 655f 656c 656d 656e 742e 7368  cture_element.sh
-00041640: 6f72 7463 6f64 655d 0d0a 0d0a 2020 2020  ortcode]....    
-00041650: 2020 2020 2020 2020 7265 7475 726e 2053          return S
-00041660: 7472 7563 7475 7265 456c 656d 656e 7428  tructureElement(
-00041670: 656c 656d 656e 7420 3d20 656c 656d 656e  element = elemen
-00041680: 742c 7374 7275 6374 7572 6520 3d20 7365  t,structure = se
-00041690: 6c66 2e73 7472 7563 7475 7265 290d 0a0d  lf.structure)...
-000416a0: 0a20 2020 2020 2020 2023 4170 706c 7920  .        #Apply 
-000416b0: 7468 6520 7377 6170 7069 6e67 2066 756e  the swapping fun
-000416c0: 6374 696f 6e20 746f 2073 656c 660d 0a20  ction to self.. 
-000416d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000416e0: 6c66 2e61 7070 6c79 285f 7377 6170 5f65  lf.apply(_swap_e
-000416f0: 6c65 6d65 6e74 290d 0a0d 0a20 2020 2064  lement)....    d
-00041700: 6566 2067 7261 6674 5f6f 6e28 7365 6c66  ef graft_on(self
-00041710: 2c20 7363 696f 6e5f 6869 6572 6172 6368  , scion_hierarch
-00041720: 792c 2065 6c65 6d65 6e74 5f67 7261 6674  y, element_graft
-00041730: 5f72 756c 6520 3d20 6c61 6d62 6461 2078  _rule = lambda x
-00041740: 2c79 3a4e 6f6e 652c 2020 7363 696f 6e5f  ,y:None,  scion_
-00041750: 636f 7069 6564 5f6f 6e63 655f 6f6e 6c79  copied_once_only
-00041760: 3d46 616c 7365 2c20 7265 7475 726e 5f63  =False, return_c
-00041770: 6f70 793d 4661 6c73 652c 2074 7261 6365  opy=False, trace
-00041780: 5f65 6c65 6d65 6e74 203d 204e 6f6e 6529  _element = None)
-00041790: 3a0d 0a20 2020 2020 2020 2027 2727 0d0a  :..        '''..
-000417a0: 2020 2020 2020 2020 5768 656e 2067 7261          When gra
-000417b0: 6674 696e 6720 6170 706c 6520 7472 6565  fting apple tree
-000417c0: 7320 746f 6765 7468 6572 2c20 796f 7520  s together, you 
-000417d0: 6772 6166 7420 6120 7363 696f 6e20 2874  graft a scion (t
-000417e0: 7769 6720 6f72 2062 7261 6e63 6829 206f  wig or branch) o
-000417f0: 6e74 6f20 6120 726f 6f74 7374 6f63 6b20  nto a rootstock 
-00041800: 7472 6565 2e20 5468 6973 2066 756e 6374  tree. This funct
-00041810: 696f 6e20 7573 6573 2074 6861 7420 7465  ion uses that te
-00041820: 726d 696e 6f6c 6f67 792e 0d0a 2020 2020  rminology...    
-00041830: 2020 2020 4372 6561 7465 2061 6e20 6f75      Create an ou
-00041840: 7470 7574 2068 6965 7261 7263 6879 2074  tput hierarchy t
-00041850: 6861 7420 7461 6b65 7320 7468 6520 726f  hat takes the ro
-00041860: 6f74 7374 6f63 6b20 6869 6572 6172 6368  otstock hierarch
-00041870: 7920 616e 6420 6772 6166 7473 206f 6e20  y and grafts on 
-00041880: 7375 6274 7265 6573 2066 726f 6d20 7468  subtrees from th
-00041890: 6520 7363 696f 6e20 6869 6572 6172 6368  e scion hierarch
-000418a0: 792e 0d0a 2020 2020 2020 2020 5363 696f  y...        Scio
-000418b0: 6e20 5374 7275 6374 7572 6545 6c65 6d65  n StructureEleme
-000418c0: 6e74 206e 6f64 6573 2061 7265 2067 7261  nt nodes are gra
-000418d0: 6674 6564 206f 6e20 6163 636f 7264 696e  fted on accordin
-000418e0: 6720 746f 2061 2072 756c 6520 7768 6963  g to a rule whic
-000418f0: 6820 6973 2070 6173 7365 6420 696e 2061  h is passed in a
-00041900: 7320 6120 7061 7261 6d65 7465 723a 2065  s a parameter: e
-00041910: 6c65 6d65 6e74 5f67 7261 6674 5f72 756c  lement_graft_rul
-00041920: 652e 0d0a 2020 2020 2020 2020 416e 2065  e...        An e
-00041930: 7861 6d70 6c65 206f 6620 616e 2061 7070  xample of an app
-00041940: 726f 7072 6961 7465 2066 756e 6374 696f  ropriate functio
-00041950: 6e20 746f 2070 6173 7320 696e 2c20 6973  n to pass in, is
-00041960: 206f 6e65 2074 6861 7420 6c6f 6f6b 7320   one that looks 
-00041970: 6174 2074 6865 2075 6e64 6572 6c79 696e  at the underlyin
-00041980: 6720 6669 656c 6473 2069 6e20 7468 6520  g fields in the 
-00041990: 4469 6d65 6e73 696f 6e45 6c65 6d65 6e74  DimensionElement
-000419a0: 7320 6f66 2062 6f74 6820 6869 6572 6172  s of both hierar
-000419b0: 6368 6965 7320 616e 6420 6465 6369 6465  chies and decide
-000419c0: 7320 6261 7365 6420 6f6e 2074 6865 2066  s based on the f
-000419d0: 6965 6c64 7320 7768 6574 6865 7220 6120  ields whether a 
-000419e0: 7375 6274 7265 6520 6973 2067 7261 6674  subtree is graft
-000419f0: 6564 206f 6e20 746f 2074 6865 206d 6173  ed on to the mas
-00041a00: 7465 7220 7472 6565 0d0a 0d0a 2020 2020  ter tree....    
-00041a10: 2020 2020 3a70 6172 616d 2073 6369 6f6e      :param scion
-00041a20: 5f68 6965 7261 7263 6879 3a20 4120 5374  _hierarchy: A St
-00041a30: 7275 6374 7572 6545 6c65 6d65 6e74 2077  ructureElement w
-00041a40: 6869 6368 2069 7320 7468 6520 726f 6f74  hich is the root
-00041a50: 206f 6620 7468 6520 7363 696f 6e20 6869   of the scion hi
-00041a60: 6572 6172 6368 790d 0a20 2020 2020 2020  erarchy..       
-00041a70: 203a 7061 7261 6d20 656c 656d 656e 745f   :param element_
-00041a80: 6772 6166 745f 7275 6c65 3a20 4120 6675  graft_rule: A fu
-00041a90: 6e63 7469 6f6e 2077 6869 6368 2068 6173  nction which has
-00041aa0: 2032 2070 6172 616d 6574 6572 7320 2d20   2 parameters - 
-00041ab0: 726f 6f74 7374 6f63 6b20 656c 656d 656e  rootstock elemen
-00041ac0: 742c 2073 6369 6f6e 2065 6c65 6d65 6e74  t, scion element
-00041ad0: 2061 6e64 2072 6574 7572 6e20 5472 7565   and return True
-00041ae0: 2069 6620 7468 6520 7363 696f 6e20 656c   if the scion el
-00041af0: 656d 656e 7420 6265 6c6f 6e67 7320 756e  ement belongs un
-00041b00: 6465 7220 7468 6520 726f 6f74 7374 6f63  der the rootstoc
-00041b10: 6b20 656c 656d 656e 7420 616e 6420 4661  k element and Fa
-00041b20: 6c73 6520 6f74 6865 7277 6973 650d 0a20  lse otherwise.. 
-00041b30: 2020 2020 2020 203a 7061 7261 6d20 7363         :param sc
-00041b40: 696f 6e5f 636f 7069 6564 5f6f 6e63 655f  ion_copied_once_
-00041b50: 6f6e 6c79 3a20 426f 6f6c 6561 6e20 2d20  only: Boolean - 
-00041b60: 646f 6573 2074 6865 2065 6c65 6d65 6e74  does the element
-00041b70: 206d 6572 6765 2072 756c 6520 6f6e 6c79   merge rule only
-00041b80: 2063 6f70 7920 7369 6e67 6c65 2063 6f70   copy single cop
-00041b90: 6965 7320 6f66 2074 6865 2073 6369 6f6e  ies of the scion
-00041ba0: 2065 6c65 6d65 6e74 733f 2049 6620 736f   elements? If so
-00041bb0: 2077 6520 6361 6e20 6f70 7469 6d69 7a65   we can optimize
-00041bc0: 2062 7920 6d61 726b 696e 6720 6e6f 6465   by marking node
-00041bd0: 7320 6173 2066 756c 6c79 2074 7261 6e73  s as fully trans
-00041be0: 6372 6962 6564 2066 726f 6d20 7468 6520  cribed from the 
-00041bf0: 7363 696f 6e20 746f 2074 6865 206f 7574  scion to the out
-00041c00: 7075 7420 6869 6572 6172 6368 792c 2061  put hierarchy, a
-00041c10: 6e64 2061 766f 6964 2076 6973 6974 696e  nd avoid visitin
-00041c20: 6720 7468 656d 2061 6761 696e 0d0a 2020  g them again..  
-00041c30: 2020 2020 2020 3a70 6172 616d 2072 6574        :param ret
-00041c40: 7572 6e5f 636f 7079 3a20 426f 6f6c 6561  urn_copy: Boolea
-00041c50: 6e20 2d20 646f 6e27 7420 6772 6166 7420  n - don't graft 
-00041c60: 7468 6520 7363 696f 6e20 6f6e 746f 2073  the scion onto s
-00041c70: 656c 6620 2d20 7261 7468 6572 2072 6574  elf - rather ret
-00041c80: 7572 6e20 6120 636f 7079 206f 6620 7365  urn a copy of se
-00041c90: 6c66 2c20 7769 7468 2074 6865 2073 6369  lf, with the sci
-00041ca0: 6f6e 2067 7261 6674 6564 206f 6e0d 0a20  on grafted on.. 
-00041cb0: 2020 2020 2020 203a 7061 7261 6d20 7472         :param tr
-00041cc0: 6163 655f 656c 656d 656e 743a 2073 686f  ace_element: sho
-00041cd0: 7274 636f 6465 206f 7220 5374 7275 6374  rtcode or Struct
-00041ce0: 7572 6545 6c65 6d65 6e74 2e20 5768 656e  ureElement. When
-00041cf0: 2074 6865 2067 7261 6674 6564 2074 7265   the grafted tre
-00041d00: 6520 6973 2063 6f6d 696e 6720 6f75 7420  e is coming out 
-00041d10: 7769 7468 2075 6e65 7870 6563 7465 6420  with unexpected 
-00041d20: 7265 7375 6c74 7320 796f 7520 6d61 7920  results you may 
-00041d30: 7769 7368 2074 6f20 7475 726e 206f 6e20  wish to turn on 
-00041d40: 6c6f 6720 7472 6163 696e 6720 666f 7220  log tracing for 
-00041d50: 6f6e 6520 6f66 2074 6865 2072 6f6f 7473  one of the roots
-00041d60: 746f 636b 2065 6c65 6d65 6e74 7320 2861  tock elements (a
-00041d70: 6e64 2069 7473 2073 7562 7472 6565 290d  nd its subtree).
-00041d80: 0a20 2020 2020 2020 2027 2727 0d0a 2020  .        '''..  
-00041d90: 2020 2020 2020 234e 6f74 6520 2d20 6f72        #Note - or
-00041da0: 6967 696e 616c 6c79 2074 6865 7265 2077  iginally there w
-00041db0: 6173 2061 2070 6c61 6e20 746f 2063 6f6c  as a plan to col
-00041dc0: 6c61 7073 6520 6c6f 6e67 206f 6e65 2064  lapse long one d
-00041dd0: 696d 656e 7369 6f6e 616c 2073 7562 2d68  imensional sub-h
-00041de0: 6965 7261 7263 6869 6573 2069 6e20 7468  ierarchies in th
-00041df0: 6973 2066 756e 6374 696f 6e2e 2054 6865  is function. The
-00041e00: 7265 2069 7320 6e6f 206e 6565 6420 746f  re is no need to
-00041e10: 2064 6f20 7468 6174 2068 6572 6520 2d20   do that here - 
-00041e20: 7765 2063 616e 2074 6964 7920 7570 2068  we can tidy up h
-00041e30: 6965 7261 7263 6869 6573 2069 6e20 6120  ierarchies in a 
-00041e40: 7375 6273 6571 7565 6e74 2073 7465 700d  subsequent step.
-00041e50: 0a0d 0a0d 0a20 2020 2020 2020 2023 496e  .....        #In
-00041e60: 2061 206e 6573 7465 6420 6c6f 6f70 0d0a   a nested loop..
-00041e70: 2020 2020 2020 2020 2357 616c 6b20 7468          #Walk th
-00041e80: 6520 726f 6f74 7374 6f63 6b20 6869 6572  e rootstock hier
-00041e90: 6172 6368 790d 0a20 2020 2020 2020 2020  archy..         
-00041ea0: 2020 2023 5761 6c6b 2074 6865 2073 6369     #Walk the sci
-00041eb0: 6f6e 2068 6965 7261 7263 6879 0d0a 2020  on hierarchy..  
-00041ec0: 2020 2020 2020 2020 2020 2020 2020 2349                #I
-00041ed0: 6620 7468 6520 7275 6c65 2073 6179 7320  f the rule says 
-00041ee0: 746f 2067 7261 6674 2074 6865 2073 6369  to graft the sci
-00041ef0: 6f6e 2065 6c65 6d65 6e74 206f 6e20 7468  on element on th
-00041f00: 656e 2063 7265 6174 6520 6120 636f 7079  en create a copy
-00041f10: 2065 6c65 6d65 6e74 2061 6e64 2067 7261   element and gra
-00041f20: 6674 2069 7420 746f 2074 6865 206f 7574  ft it to the out
-00041f30: 7075 742c 2069 6e63 7265 6d65 6e74 696e  put, incrementin
-00041f40: 6720 7468 6520 696e 6465 6e74 2069 6620  g the indent if 
-00041f50: 7468 6520 7363 696f 6e20 6869 6572 6172  the scion hierar
-00041f60: 6368 7920 7265 7175 6972 6573 2069 740d  chy requires it.
-00041f70: 0a20 2020 2020 2020 2020 2020 2023 4166  .            #Af
-00041f80: 7465 7220 7468 6520 7768 6f6c 6520 6f66  ter the whole of
-00041f90: 2074 6865 2073 6369 6f6e 2068 6965 7261   the scion hiera
-00041fa0: 7263 6879 2069 7320 7761 6c6b 6564 2c20  rchy is walked, 
-00041fb0: 6174 7461 6368 2074 6865 206e 6578 7420  attach the next 
-00041fc0: 656c 656d 656e 7420 6f66 2074 6865 2072  element of the r
-00041fd0: 6f6f 7473 746f 636b 2068 6965 7261 7263  ootstock hierarc
-00041fe0: 6879 2074 6f20 7468 6520 6f75 7470 7574  hy to the output
-00041ff0: 2068 6965 7261 7263 6879 0d0a 0d0a 0d0a   hierarchy......
-00042000: 2020 2020 2020 2020 636f 7069 6564 5f73          copied_s
-00042010: 6369 6f6e 5f73 7472 7563 7475 7265 5f65  cion_structure_e
-00042020: 6c65 6d65 6e74 733d 7b7d 0d0a 0d0a 2020  lements={}....  
-00042030: 2020 2020 2020 2343 7265 6174 6520 7468        #Create th
-00042040: 6520 726f 6f74 2065 6c65 6d65 6e74 206f  e root element o
-00042050: 6620 7468 6520 6f75 7470 7574 2074 7265  f the output tre
-00042060: 650d 0a20 2020 2020 2020 2063 7572 7265  e..        curre
-00042070: 6e74 5f6f 7574 7075 745f 6e6f 6465 203d  nt_output_node =
-00042080: 204e 6f6e 650d 0a20 2020 2020 2020 2023   None..        #
-00042090: 726f 6f74 5f6f 7574 7075 745f 6e6f 6465  root_output_node
-000420a0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-000420b0: 206e 6577 5f72 6f6f 7473 746f 636b 5f6f   new_rootstock_o
-000420c0: 7574 7075 745f 6e6f 6465 203d 204e 6f6e  utput_node = Non
-000420d0: 650d 0a20 2020 2020 2020 2070 7265 7669  e..        previ
-000420e0: 6f75 735f 726f 6f74 7374 6f63 6b5f 6e6f  ous_rootstock_no
-000420f0: 6465 203d 204e 6f6e 650d 0a20 2020 2020  de = None..     
-00042100: 2020 2070 7265 7669 6f75 735f 726f 6f74     previous_root
-00042110: 7374 6f63 6b5f 6c65 7665 6c20 3d20 300d  stock_level = 0.
-00042120: 0a0d 0a20 2020 2020 2020 2069 6620 7472  ...        if tr
-00042130: 6163 655f 656c 656d 656e 7420 6973 204e  ace_element is N
-00042140: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00042150: 2020 7472 6163 655f 656c 656d 656e 745f    trace_element_
-00042160: 7368 6f72 7463 6f64 6520 3d20 4e6f 6e65  shortcode = None
-00042170: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00042180: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00042190: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000421a0: 2020 2023 7472 6163 655f 656c 656d 656e     #trace_elemen
-000421b0: 7420 6973 2061 2053 7472 7563 7475 7265  t is a Structure
-000421c0: 456c 656d 656e 7420 6f72 2045 6c65 6d65  Element or Eleme
-000421d0: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-000421e0: 2020 2020 2364 7563 6b74 7970 696e 6720      #ducktyping 
-000421f0: 696e 2061 6374 696f 6e20 2d20 626f 7468  in action - both
-00042200: 2068 6176 6520 6120 7368 6f72 7463 6f64   have a shortcod
-00042210: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00042220: 2020 2074 7261 6365 5f65 6c65 6d65 6e74     trace_element
-00042230: 5f73 686f 7274 636f 6465 203d 2074 7261  _shortcode = tra
-00042240: 6365 5f65 6c65 6d65 6e74 2e73 686f 7274  ce_element.short
-00042250: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-00042260: 2020 6578 6365 7074 2041 7474 7269 6275    except Attribu
-00042270: 7465 4572 726f 723a 0d0a 2020 2020 2020  teError:..      
-00042280: 2020 2020 2020 2020 2020 2349 7420 6469            #It di
-00042290: 646e 2774 2071 7561 636b 206c 696b 6520  dn't quack like 
-000422a0: 6120 5374 7275 6374 7572 6545 6c65 6d65  a StructureEleme
-000422b0: 6e74 206f 7220 456c 656d 656e 7420 736f  nt or Element so
-000422c0: 2069 7427 7320 6120 7374 7269 6e67 0d0a   it's a string..
-000422d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000422e0: 2341 6464 2069 7420 746f 2061 6e6f 7468  #Add it to anoth
-000422f0: 6572 2073 7472 696e 672c 206a 7573 7420  er string, just 
-00042300: 746f 2062 6520 7375 7265 0d0a 2020 2020  to be sure..    
-00042310: 2020 2020 2020 2020 2020 2020 7472 6163              trac
-00042320: 655f 656c 656d 656e 745f 7368 6f72 7463  e_element_shortc
-00042330: 6f64 6520 3d20 7472 6163 655f 656c 656d  ode = trace_elem
-00042340: 656e 7420 2b20 2727 0d0a 0d0a 2020 2020  ent + ''....    
-00042350: 2020 2020 2020 2020 6c6f 672e 696e 666f          log.info
-00042360: 2827 7472 6163 655f 656c 656d 656e 745f  ('trace_element_
-00042370: 7368 6f72 7463 6f64 6520 3d20 7b7d 272e  shortcode = {}'.
-00042380: 666f 726d 6174 2874 7261 6365 5f65 6c65  format(trace_ele
-00042390: 6d65 6e74 5f73 686f 7274 636f 6465 2929  ment_shortcode))
-000423a0: 0d0a 0d0a 2020 2020 2020 2020 2354 7261  ....        #Tra
-000423b0: 6369 6e67 2077 696c 6c20 6765 7420 7475  cing will get tu
-000423c0: 726e 6564 206f 6e20 6279 2073 7769 7463  rned on by switc
-000423d0: 6869 6e67 2074 6865 206c 6f67 2066 756e  hing the log fun
-000423e0: 6374 696f 6e0d 0a20 2020 2020 2020 2023  ction..        #
-000423f0: 5374 6172 7420 6f6e 2064 6562 7567 2075  Start on debug u
-00042400: 6e74 696c 2077 6520 7061 7373 2074 6865  ntil we pass the
-00042410: 2074 7261 6365 2065 6c65 6d65 6e74 0d0a   trace element..
-00042420: 2020 2020 2020 2020 7472 6163 655f 6c6f          trace_lo
-00042430: 675f 666e 203d 206c 6f67 2e64 6562 7567  g_fn = log.debug
-00042440: 0d0a 2020 2020 2020 2020 2374 7261 6369  ..        #traci
-00042450: 6e67 5f6c 6576 656c 2068 656c 7073 2075  ng_level helps u
-00042460: 7320 776f 726b 206f 7574 2069 6620 7765  s work out if we
-00042470: 2068 6176 6520 676f 6e65 2066 6172 2065   have gone far e
-00042480: 6e6f 7567 6820 7570 2074 6865 2068 6965  nough up the hie
-00042490: 7261 7263 6879 0d0a 2020 2020 2020 2020  rarchy..        
-000424a0: 7472 6163 696e 675f 6c65 7665 6c20 3d20  tracing_level = 
-000424b0: 300d 0a20 2020 2020 2020 2074 7261 6369  0..        traci
-000424c0: 6e67 5f70 6174 6820 3d20 4e6f 6e65 0d0a  ng_path = None..
-000424d0: 0d0a 2020 2020 2020 2020 2343 6f70 7920  ..        #Copy 
-000424e0: 746f 2061 206c 6973 7420 6265 666f 7265  to a list before
-000424f0: 2077 616c 6b69 6e67 2c20 6f74 6865 7277   walking, otherw
-00042500: 6973 6520 7468 6520 6c65 7665 6c73 2063  ise the levels c
-00042510: 6861 6e67 6520 6475 7269 6e67 2070 726f  hange during pro
-00042520: 6365 7373 696e 6720 7768 656e 2067 7261  cessing when gra
-00042530: 6674 696e 6720 746f 2073 656c 660d 0a20  fting to self.. 
-00042540: 2020 2020 2020 2066 6f72 2072 6f6f 7473         for roots
-00042550: 746f 636b 5f73 7472 7563 7475 7265 5f65  tock_structure_e
-00042560: 6c65 6d65 6e74 2c20 726f 6f74 7374 6f63  lement, rootstoc
-00042570: 6b5f 6c65 7665 6c20 696e 205b 2865 2c20  k_level in [(e, 
-00042580: 6c29 2066 6f72 2065 2c20 6c20 696e 2073  l) for e, l in s
-00042590: 656c 662e 7761 6c6b 5f77 6974 685f 6c65  elf.walk_with_le
-000425a0: 7665 6c73 2829 5d3a 0d0a 0d0a 2020 2020  vels()]:....    
-000425b0: 2020 2020 2020 2020 2354 7261 6369 6e67          #Tracing
-000425c0: 2077 696c 6c20 6765 7420 7475 726e 6564   will get turned
-000425d0: 206f 6e20 6279 2073 7769 7463 6869 6e67   on by switching
-000425e0: 2074 6865 206c 6f67 2066 756e 6374 696f   the log functio
-000425f0: 6e0d 0a20 2020 2020 2020 2020 2020 2023  n..            #
-00042600: 5374 6172 7420 6f6e 2064 6562 7567 2075  Start on debug u
-00042610: 6e74 696c 2077 6520 7061 7373 2074 6865  ntil we pass the
-00042620: 2074 7261 6365 2065 6c65 6d65 6e74 0d0a   trace element..
-00042630: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-00042640: 6f6f 7473 746f 636b 5f73 7472 7563 7475  ootstock_structu
-00042650: 7265 5f65 6c65 6d65 6e74 2e73 686f 7274  re_element.short
-00042660: 6e61 6d65 203d 3d20 7472 6163 655f 656c  name == trace_el
-00042670: 656d 656e 745f 7368 6f72 7463 6f64 653a  ement_shortcode:
-00042680: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00042690: 2020 7472 6163 655f 6c6f 675f 666e 203d    trace_log_fn =
-000426a0: 206c 6f67 2e69 6e66 6f0d 0a20 2020 2020   log.info..     
-000426b0: 2020 2020 2020 2020 2020 2074 7261 6369             traci
-000426c0: 6e67 5f6c 6576 656c 203d 2072 6f6f 7473  ng_level = roots
-000426d0: 746f 636b 5f6c 6576 656c 0d0a 0d0a 2020  tock_level....  
-000426e0: 2020 2020 2020 2020 2020 6966 2072 6f6f            if roo
-000426f0: 7473 746f 636b 5f6c 6576 656c 2069 7320  tstock_level is 
-00042700: 4e6f 6e65 206f 7220 726f 6f74 7374 6f63  None or rootstoc
-00042710: 6b5f 6c65 7665 6c20 3c20 7472 6163 696e  k_level < tracin
-00042720: 675f 6c65 7665 6c3a 0d0a 2020 2020 2020  g_level:..      
-00042730: 2020 2020 2020 2020 2020 2349 6620 7765            #If we
-00042740: 2068 6176 6520 6d6f 7665 6420 6261 636b   have moved back
-00042750: 2075 7020 6265 796f 6e64 2074 6865 2074   up beyond the t
-00042760: 7261 6369 6e67 206c 6576 656c 2c20 7374  racing level, st
-00042770: 6f70 2074 7261 6369 6e67 0d0a 2020 2020  op tracing..    
-00042780: 2020 2020 2020 2020 2020 2020 7472 6163              trac
-00042790: 655f 6c6f 675f 666e 203d 206c 6f67 2e64  e_log_fn = log.d
-000427a0: 6562 7567 0d0a 2020 2020 2020 2020 2020  ebug..          
-000427b0: 2020 2020 2020 7472 6163 696e 675f 6c65        tracing_le
-000427c0: 7665 6c20 3d20 300d 0a0d 0a20 2020 2020  vel = 0....     
-000427d0: 2020 2020 2020 2074 7261 6365 5f6c 6f67         trace_log
-000427e0: 5f66 6e28 2752 6f6f 7473 746f 636b 2077  _fn('Rootstock w
-000427f0: 616c 6b20 6174 207b 7d2c 7b7d 272e 666f  alk at {},{}'.fo
-00042800: 726d 6174 2872 6f6f 7473 746f 636b 5f73  rmat(rootstock_s
-00042810: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00042820: 2e73 686f 7274 6e61 6d65 2c72 6f6f 7473  .shortname,roots
-00042830: 746f 636b 5f6c 6576 656c 2929 0d0a 0d0a  tock_level))....
-00042840: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00042850: 6577 5f72 6f6f 7473 746f 636b 5f6f 7574  ew_rootstock_out
-00042860: 7075 745f 6e6f 6465 2069 7320 6e6f 7420  put_node is not 
-00042870: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00042880: 2020 2020 2020 2023 5365 7420 7468 6520         #Set the 
-00042890: 6375 7272 656e 7420 726f 6f74 2062 6163  current root bac
-000428a0: 6b20 746f 2074 6865 2070 7265 7669 6f75  k to the previou
-000428b0: 7320 726f 6f74 7374 6f63 6b20 6f75 7470  s rootstock outp
-000428c0: 7574 206e 6f64 650d 0a20 2020 2020 2020  ut node..       
-000428d0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
-000428e0: 5f6f 7574 7075 745f 6e6f 6465 203d 206e  _output_node = n
-000428f0: 6577 5f72 6f6f 7473 746f 636b 5f6f 7574  ew_rootstock_out
-00042900: 7075 745f 6e6f 6465 0d0a 0d0a 2020 2020  put_node....    
-00042910: 2020 2020 2020 2020 2369 6620 7765 2061          #if we a
-00042920: 7265 2072 6574 7572 6e69 6e67 2061 2063  re returning a c
-00042930: 6f70 7920 7468 656e 2077 6520 7769 6c6c  opy then we will
-00042940: 206e 6565 6420 6120 6e65 775f 726f 6f74   need a new_root
-00042950: 7374 6f63 6b5f 6f75 7470 7574 5f6e 6f64  stock_output_nod
-00042960: 650d 0a20 2020 2020 2020 2020 2020 2023  e..            #
-00042970: 6966 2077 6520 6172 6520 6772 6166 7469  if we are grafti
-00042980: 6e67 206f 6e20 746f 2073 656c 6620 7769  ng on to self wi
-00042990: 7468 6f75 7420 636f 7079 696e 6720 7765  thout copying we
-000429a0: 206e 6565 6420 746f 2073 6574 2074 6869   need to set thi
-000429b0: 7320 6e65 7720 6e6f 6465 2074 6f20 7365  s new node to se
-000429c0: 6c66 0d0a 2020 2020 2020 2020 2020 2020  lf..            
-000429d0: 6966 206e 6f74 2072 6574 7572 6e5f 636f  if not return_co
-000429e0: 7079 3a0d 0a20 2020 2020 2020 2020 2020  py:..           
-000429f0: 2020 2020 206e 6577 5f72 6f6f 7473 746f       new_rootsto
-00042a00: 636b 5f6f 7574 7075 745f 6e6f 6465 203d  ck_output_node =
-00042a10: 2072 6f6f 7473 746f 636b 5f73 7472 7563   rootstock_struc
-00042a20: 7475 7265 5f65 6c65 6d65 6e74 0d0a 2020  ture_element..  
-00042a30: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00042a40: 6f74 7374 6f63 6b5f 7374 7275 6374 7572  otstock_structur
-00042a50: 655f 656c 656d 656e 742e 7365 745f 7061  e_element.set_pa
-00042a60: 7265 6e74 284e 6f6e 6529 0d0a 2020 2020  rent(None)..    
-00042a70: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00042a80: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00042a90: 6577 5f72 6f6f 7473 746f 636b 5f6f 7574  ew_rootstock_out
-00042aa0: 7075 745f 6e6f 6465 203d 2053 7472 7563  put_node = Struc
-00042ab0: 7475 7265 456c 656d 656e 7428 656c 656d  tureElement(elem
-00042ac0: 656e 7420 3d20 726f 6f74 7374 6f63 6b5f  ent = rootstock_
-00042ad0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-00042ae0: 742e 656c 656d 656e 7429 0d0a 0d0a 2020  t.element)....  
-00042af0: 2020 2020 2020 2020 2020 6c6f 672e 6465            log.de
-00042b00: 6275 6728 2772 6f6f 7473 746f 636b 5f6c  bug('rootstock_l
-00042b10: 6576 656c 2020 2020 2020 2020 2020 3d20  evel          = 
-00042b20: 272b 7374 7228 726f 6f74 7374 6f63 6b5f  '+str(rootstock_
-00042b30: 6c65 7665 6c29 290d 0a20 2020 2020 2020  level))..       
-00042b40: 2020 2020 206c 6f67 2e64 6562 7567 2827       log.debug('
-00042b50: 7072 6576 696f 7573 5f72 6f6f 7473 746f  previous_rootsto
-00042b60: 636b 5f6c 6576 656c 203d 2027 2b73 7472  ck_level = '+str
-00042b70: 2870 7265 7669 6f75 735f 726f 6f74 7374  (previous_rootst
-00042b80: 6f63 6b5f 6c65 7665 6c29 290d 0a0d 0a20  ock_level)).... 
-00042b90: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
-00042ba0: 6576 696f 7573 5f72 6f6f 7473 746f 636b  evious_rootstock
-00042bb0: 5f6e 6f64 6520 6973 206e 6f74 204e 6f6e  _node is not Non
-00042bc0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00042bd0: 2020 2020 6c6f 672e 6465 6275 6728 2773      log.debug('s
-00042be0: 6369 6f6e 5f6c 6576 656c 2020 2020 203d  cion_level     =
-00042bf0: 2027 2b73 7472 2873 6369 6f6e 5f6c 6576   '+str(scion_lev
-00042c00: 656c 2929 0d0a 0d0a 2020 2020 2020 2020  el))....        
-00042c10: 2020 2020 2020 2020 6966 2070 7265 7669          if previ
-00042c20: 6f75 735f 726f 6f74 7374 6f63 6b5f 6c65  ous_rootstock_le
-00042c30: 7665 6c20 6973 206e 6f74 204e 6f6e 653a  vel is not None:
-00042c40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00042c50: 2020 2020 2020 234c 6f6f 7020 6261 636b        #Loop back
-00042c60: 2075 7020 746f 2074 6865 2063 6f72 7265   up to the corre
-00042c70: 6374 2070 6172 656e 7420 6c65 7665 6c0d  ct parent level.
-00042c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042c90: 2020 2020 2066 6f72 206e 2069 6e20 7261       for n in ra
-00042ca0: 6e67 6528 3120 2b20 7072 6576 696f 7573  nge(1 + previous
-00042cb0: 5f72 6f6f 7473 746f 636b 5f6c 6576 656c  _rootstock_level
-00042cc0: 2d72 6f6f 7473 746f 636b 5f6c 6576 656c  -rootstock_level
-00042cd0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00042ce0: 2020 2020 2020 2020 2020 2020 7472 6163              trac
-00042cf0: 655f 6c6f 675f 666e 2827 726f 6f74 7374  e_log_fn('rootst
-00042d00: 6f63 6b20 6869 6572 6172 6368 7920 7374  ock hierarchy st
-00042d10: 6570 7069 6e67 2075 7020 746f 2070 7265  epping up to pre
-00042d20: 7669 6f75 733a 2027 202b 2073 7472 2870  vious: ' + str(p
-00042d30: 7265 7669 6f75 735f 726f 6f74 7374 6f63  revious_rootstoc
-00042d40: 6b5f 6e6f 6465 2e73 686f 7274 6e61 6d65  k_node.shortname
-00042d50: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
-00042d60: 2020 2020 2020 2020 2020 2020 2020 2350                #P
-00042d70: 6172 656e 7420 7368 6f75 6c64 206e 6576  arent should nev
-00042d80: 6572 2062 6520 4e6f 6e65 2069 6620 7468  er be None if th
-00042d90: 6520 6c6f 6769 6320 6973 2077 6f72 6b69  e logic is worki
-00042da0: 6e67 0d0a 2020 2020 2020 2020 2020 2020  ng..            
-00042db0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00042dc0: 7265 7669 6f75 735f 726f 6f74 7374 6f63  revious_rootstoc
-00042dd0: 6b5f 6e6f 6465 2e70 6172 656e 7420 6973  k_node.parent is
-00042de0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00042df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042e00: 2020 2020 7261 6973 6520 5379 7374 656d      raise System
-00042e10: 4572 726f 7228 274d 6f76 696e 6720 6672  Error('Moving fr
-00042e20: 6f6d 206c 6576 656c 207b 7d20 746f 207b  om level {} to {
-00042e30: 7d20 6174 2069 7465 7261 7469 6f6e 207b  } at iteration {
-00042e40: 7d2e 2070 7265 7669 6f75 735f 726f 6f74  }. previous_root
-00042e50: 7374 6f63 6b5f 6e6f 6465 207b 7d20 6861  stock_node {} ha
-00042e60: 7320 6e6f 2070 6172 656e 7427 2e66 6f72  s no parent'.for
-00042e70: 6d61 7428 726f 6f74 7374 6f63 6b5f 6c65  mat(rootstock_le
-00042e80: 7665 6c2c 7072 6576 696f 7573 5f72 6f6f  vel,previous_roo
-00042e90: 7473 746f 636b 5f6c 6576 656c 2c6e 2c70  tstock_level,n,p
-00042ea0: 7265 7669 6f75 735f 726f 6f74 7374 6f63  revious_rootstoc
-00042eb0: 6b5f 6e6f 6465 2e73 686f 7274 6e61 6d65  k_node.shortname
-00042ec0: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
-00042ed0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00042ee0: 6163 655f 6c6f 675f 666e 2827 726f 6f74  ace_log_fn('root
-00042ef0: 7374 6f63 6b20 6869 6572 6172 6368 7920  stock hierarchy 
-00042f00: 7374 6570 7069 6e67 2075 7020 746f 2070  stepping up to p
-00042f10: 6172 656e 743a 2027 202b 2073 7472 2870  arent: ' + str(p
-00042f20: 7265 7669 6f75 735f 726f 6f74 7374 6f63  revious_rootstoc
-00042f30: 6b5f 6e6f 6465 2e70 6172 656e 742e 7368  k_node.parent.sh
-00042f40: 6f72 746e 616d 6529 290d 0a0d 0a20 2020  ortname))....   
-00042f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00042f60: 2020 2020 2070 7265 7669 6f75 735f 726f       previous_ro
-00042f70: 6f74 7374 6f63 6b5f 6e6f 6465 203d 2070  otstock_node = p
-00042f80: 7265 7669 6f75 735f 726f 6f74 7374 6f63  revious_rootstoc
-00042f90: 6b5f 6e6f 6465 2e70 6172 656e 740d 0a0d  k_node.parent...
-00042fa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00042fb0: 2074 7261 6365 5f6c 6f67 5f66 6e28 2761   trace_log_fn('a
-00042fc0: 6464 696e 6720 6e65 775f 726f 6f74 7374  dding new_rootst
-00042fd0: 6f63 6b5f 6f75 7470 7574 5f6e 6f64 653a  ock_output_node:
-00042fe0: 207b 7d20 6173 2063 6869 6c64 2074 6f20   {} as child to 
-00042ff0: 7061 7265 6e74 2070 7265 7669 6f75 735f  parent previous_
-00043000: 726f 6f74 7374 6f63 6b5f 6e6f 6465 3a20  rootstock_node: 
-00043010: 7b7d 272e 666f 726d 6174 286e 6577 5f72  {}'.format(new_r
-00043020: 6f6f 7473 746f 636b 5f6f 7574 7075 745f  ootstock_output_
-00043030: 6e6f 6465 2e73 686f 7274 6e61 6d65 2c70  node.shortname,p
-00043040: 7265 7669 6f75 735f 726f 6f74 7374 6f63  revious_rootstoc
-00043050: 6b5f 6e6f 6465 2e73 686f 7274 6e61 6d65  k_node.shortname
-00043060: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00043070: 2020 2020 7072 6576 696f 7573 5f72 6f6f      previous_roo
-00043080: 7473 746f 636b 5f6e 6f64 652e 5f61 6464  tstock_node._add
-00043090: 5f63 6869 6c64 286e 6577 5f72 6f6f 7473  _child(new_roots
-000430a0: 746f 636b 5f6f 7574 7075 745f 6e6f 6465  tock_output_node
-000430b0: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-000430c0: 6c73 653a 0d0a 0d0a 2020 2020 2020 2020  lse:....        
-000430d0: 2020 2020 2020 2020 726f 6f74 5f6f 7574          root_out
-000430e0: 7075 745f 6e6f 6465 203d 206e 6577 5f72  put_node = new_r
-000430f0: 6f6f 7473 746f 636b 5f6f 7574 7075 745f  ootstock_output_
-00043100: 6e6f 6465 0d0a 0d0a 2020 2020 2020 2020  node....        
-00043110: 2020 2020 7072 6576 696f 7573 5f72 6f6f      previous_roo
-00043120: 7473 746f 636b 5f6e 6f64 6520 3d20 6e65  tstock_node = ne
-00043130: 775f 726f 6f74 7374 6f63 6b5f 6f75 7470  w_rootstock_outp
-00043140: 7574 5f6e 6f64 650d 0a20 2020 2020 2020  ut_node..       
-00043150: 2020 2020 2070 7265 7669 6f75 735f 726f       previous_ro
-00043160: 6f74 7374 6f63 6b5f 6c65 7665 6c20 3d20  otstock_level = 
-00043170: 726f 6f74 7374 6f63 6b5f 6c65 7665 6c0d  rootstock_level.
-00043180: 0a0d 0a20 2020 2020 2020 2020 2020 2063  ...            c
-00043190: 7572 7265 6e74 5f6f 7574 7075 745f 6e6f  urrent_output_no
-000431a0: 6465 203d 206e 6577 5f72 6f6f 7473 746f  de = new_rootsto
-000431b0: 636b 5f6f 7574 7075 745f 6e6f 6465 0d0a  ck_output_node..
-000431c0: 2020 2020 2020 2020 2020 2020 7472 6163              trac
-000431d0: 655f 6c6f 675f 666e 2827 2852 6529 5374  e_log_fn('(Re)St
-000431e0: 6172 7469 6e67 2073 6369 6f6e 206c 6f6f  arting scion loo
-000431f0: 7020 6375 7272 656e 7420 526f 6f74 7374  p current Rootst
-00043200: 6f63 6b20 4f75 7470 7574 204e 6f64 6520  ock Output Node 
-00043210: 3d20 272b 7374 7228 6375 7272 656e 745f  = '+str(current_
-00043220: 6f75 7470 7574 5f6e 6f64 652e 7368 6f72  output_node.shor
-00043230: 746e 616d 6529 290d 0a0d 0a20 2020 2020  tname))....     
-00043240: 2020 2020 2020 206e 203d 202d 310d 0a20         n = -1.. 
-00043250: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
-00043260: 6369 6f6e 5f73 7472 7563 7475 7265 5f65  cion_structure_e
-00043270: 6c65 6d65 6e74 2c20 7363 696f 6e5f 6c65  lement, scion_le
-00043280: 7665 6c20 696e 2073 6369 6f6e 5f68 6965  vel in scion_hie
-00043290: 7261 7263 6879 2e77 616c 6b5f 7769 7468  rarchy.walk_with
-000432a0: 5f6c 6576 656c 7328 7065 726d 6973 7369  _levels(permissi
-000432b0: 7665 3d54 7275 6529 3a0d 0a20 2020 2020  ve=True):..     
-000432c0: 2020 2020 2020 2020 2020 206e 2b3d 310d             n+=1.
-000432d0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-000432e0: 2020 2069 6620 7363 696f 6e5f 636f 7069     if scion_copi
-000432f0: 6564 5f6f 6e63 655f 6f6e 6c79 3a0d 0a20  ed_once_only:.. 
-00043300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043310: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00043320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043330: 2063 6f70 6965 645f 7363 696f 6e5f 7374   copied_scion_st
-00043340: 7275 6374 7572 655f 656c 656d 656e 7473  ructure_elements
-00043350: 5b73 6369 6f6e 5f73 7472 7563 7475 7265  [scion_structure
-00043360: 5f65 6c65 6d65 6e74 2e73 686f 7274 6e61  _element.shortna
-00043370: 6d65 5d0d 0a20 2020 2020 2020 2020 2020  me]..           
-00043380: 2020 2020 2020 2020 2020 2020 2023 7761               #wa
-00043390: 6c6b 206f 6e20 746f 2074 6865 206e 6578  lk on to the nex
-000433a0: 7420 7363 696f 6e20 656c 656d 656e 740d  t scion element.
-000433b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000433c0: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-000433d0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-000433e0: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-000433f0: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
+00041050: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00041060: 6528 3230 293a 0d0a 2020 2020 2020 2020  e(20):..        
+00041070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041080: 6c6f 672e 6572 726f 7228 2752 6563 7572  log.error('Recur
+00041090: 7369 6f6e 2065 7272 6f72 2e20 456e 7469  sion error. Enti
+000410a0: 7479 2073 686f 7274 6e61 6d65 3d27 2b65  ty shortname='+e
+000410b0: 6c2e 7368 6f72 746e 616d 652b 2720 7061  l.shortname+' pa
+000410c0: 7265 6e74 3d27 2b72 6570 7228 656c 2e70  rent='+repr(el.p
+000410d0: 6172 656e 7429 290d 0a20 2020 2020 2020  arent))..       
+000410e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000410f0: 2065 6c3d 656c 2e70 6172 656e 740d 0a20   el=el.parent.. 
+00041100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041110: 2020 2023 4361 6e27 7420 6a75 7374 2072     #Can't just r
+00041120: 6572 6169 7365 2c20 6f72 2077 6520 7769  eraise, or we wi
+00041130: 6c6c 2072 652d 6361 7463 6820 7468 6520  ll re-catch the 
+00041140: 7361 6d65 2072 6563 7572 7369 6f6e 2065  same recursion e
+00041150: 7272 6f72 2067 6f69 6e67 2062 6163 6b20  rror going back 
+00041160: 7570 2074 6865 2074 7265 6521 0d0a 2020  up the tree!..  
+00041170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00041180: 2020 7261 6973 6520 5379 7374 656d 4572    raise SystemEr
+00041190: 726f 7228 290d 0a0d 0a20 2020 2020 2020  ror()....       
+000411a0: 2072 6574 7572 6e20 636f 7079 5f73 656c   return copy_sel
+000411b0: 660d 0a0d 0a20 2020 2064 6566 2061 7070  f....    def app
+000411c0: 6c79 2873 656c 662c 2066 756e 6374 696f  ly(self, functio
+000411d0: 6e29 3a0d 0a20 2020 2020 2020 2027 2727  n):..        '''
+000411e0: 7265 6375 7273 6976 656c 7920 6170 706c  recursively appl
+000411f0: 7920 6120 6675 6e63 7469 6f6e 2074 6f20  y a function to 
+00041200: 7468 6520 6869 6572 6172 6368 7927 2727  the hierarchy'''
+00041210: 0d0a 0d0a 2020 2020 2020 2020 2341 7070  ....        #App
+00041220: 6c79 2074 6865 2066 756e 6374 696f 6e20  ly the function 
+00041230: 746f 2074 6865 2063 6869 6c64 7265 6e0d  to the children.
+00041240: 0a20 2020 2020 2020 206e 6577 5f63 6869  .        new_chi
+00041250: 6c64 7265 6e20 3d20 5b5d 0d0a 2020 2020  ldren = []..    
+00041260: 2020 2020 666f 7220 6368 2069 6e20 6c69      for ch in li
+00041270: 7374 2873 656c 662e 6368 696c 6472 656e  st(self.children
+00041280: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00041290: 6e65 775f 6368 696c 6420 3d20 6368 2e61  new_child = ch.a
+000412a0: 7070 6c79 2866 756e 6374 696f 6e29 0d0a  pply(function)..
+000412b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+000412c0: 6f74 206e 6577 5f63 6869 6c64 2069 7320  ot new_child is 
+000412d0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+000412e0: 2020 2020 2020 206e 6577 5f63 6869 6c64         new_child
+000412f0: 7265 6e2e 6170 7065 6e64 286e 6577 5f63  ren.append(new_c
+00041300: 6869 6c64 290d 0a0d 0a20 2020 2020 2020  hild)....       
+00041310: 2023 4170 706c 7920 7468 6520 6675 6e63   #Apply the func
+00041320: 7469 6f6e 2074 6f20 7365 6c66 0d0a 2020  tion to self..  
+00041330: 2020 2020 2020 6f75 7470 7574 5f73 6520        output_se 
+00041340: 3d20 6675 6e63 7469 6f6e 2873 656c 6629  = function(self)
+00041350: 0d0a 0d0a 2020 2020 2020 2020 6966 206f  ....        if o
+00041360: 7574 7075 745f 7365 2069 7320 4e6f 6e65  utput_se is None
+00041370: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+00041380: 6574 7572 6e20 4e6f 6e65 0d0a 0d0a 2020  eturn None....  
+00041390: 2020 2020 2020 2352 6570 6c61 6365 2063        #Replace c
+000413a0: 6869 6c64 7265 6e20 7769 7468 2074 6865  hildren with the
+000413b0: 206e 6577 2063 6869 6c64 7265 6e0d 0a20   new children.. 
+000413c0: 2020 2020 2020 206f 7574 7075 745f 7365         output_se
+000413d0: 2e63 6869 6c64 7265 6e2e 636c 6561 7228  .children.clear(
+000413e0: 290d 0a20 2020 2020 2020 206f 7574 7075  )..        outpu
+000413f0: 745f 7365 2e63 6869 6c64 7265 6e20 2b3d  t_se.children +=
+00041400: 206e 6577 5f63 6869 6c64 7265 6e0d 0a20   new_children.. 
+00041410: 2020 2020 2020 2023 6c6f 672e 696e 666f         #log.info
+00041420: 2873 7472 2864 6963 7428 6f75 7470 7574  (str(dict(output
+00041430: 5f73 652e 6368 696c 6472 656e 2929 290d  _se.children))).
+00041440: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
+00041450: 6e20 6f75 7470 7574 5f73 650d 0a0d 0a20  n output_se.... 
+00041460: 2020 2064 6566 2073 7761 705f 656c 656d     def swap_elem
+00041470: 656e 7473 2873 656c 662c 2073 686f 7274  ents(self, short
+00041480: 636f 6465 5f65 6c65 6d65 6e74 5f64 6963  code_element_dic
+00041490: 7469 6f6e 6172 7929 3a0d 0a20 2020 2020  tionary):..     
+000414a0: 2020 2027 2727 5377 6170 206f 7574 2065     '''Swap out e
+000414b0: 6c65 6d65 6e74 7320 696e 2074 6865 2074  lements in the t
+000414c0: 7265 6520 666f 7220 6e65 7720 6f6e 6573  ree for new ones
+000414d0: 0d0a 2020 2020 2020 2020 4966 2073 656c  ..        If sel
+000414e0: 6620 6e6f 7420 696e 2074 6865 2073 686f  f not in the sho
+000414f0: 7274 636f 6465 5f65 6c65 6d65 6e74 5f64  rtcode_element_d
+00041500: 6963 7469 6f6e 6172 792c 2074 6865 6e20  ictionary, then 
+00041510: 7265 7475 726e 2061 2063 6f70 7920 6f66  return a copy of
+00041520: 2073 656c 660d 0a20 2020 2020 2020 2027   self..        '
+00041530: 2727 0d0a 0d0a 2020 2020 2020 2020 2343  ''....        #C
+00041540: 7265 6174 6520 6120 6675 6e63 7469 6f6e  reate a function
+00041550: 2074 6861 7420 7377 6170 2065 6c65 6d65   that swap eleme
+00041560: 6e74 730d 0a20 2020 2020 2020 2064 6566  nts..        def
+00041570: 205f 7377 6170 5f65 6c65 6d65 6e74 2873   _swap_element(s
+00041580: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+00041590: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000415a0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+000415b0: 2020 2020 2020 656c 656d 656e 7420 3d20        element = 
+000415c0: 7368 6f72 7463 6f64 655f 656c 656d 656e  shortcode_elemen
+000415d0: 745f 6469 6374 696f 6e61 7279 5b73 7472  t_dictionary[str
+000415e0: 7563 7475 7265 5f65 6c65 6d65 6e74 2e73  ucture_element.s
+000415f0: 686f 7274 636f 6465 5d0d 0a20 2020 2020  hortcode]..     
+00041600: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
+00041610: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
+00041620: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
+00041630: 203d 2073 7472 7563 7475 7265 5f65 6c65   = structure_ele
+00041640: 6d65 6e74 2e64 696d 656e 7369 6f6e 2e65  ment.dimension.e
+00041650: 6c65 6d65 6e74 735b 7374 7275 6374 7572  lements[structur
+00041660: 655f 656c 656d 656e 742e 7368 6f72 7463  e_element.shortc
+00041670: 6f64 655d 0d0a 0d0a 2020 2020 2020 2020  ode]....        
+00041680: 2020 2020 7265 7475 726e 2053 7472 7563      return Struc
+00041690: 7475 7265 456c 656d 656e 7428 656c 656d  tureElement(elem
+000416a0: 656e 7420 3d20 656c 656d 656e 742c 7374  ent = element,st
+000416b0: 7275 6374 7572 6520 3d20 7365 6c66 2e73  ructure = self.s
+000416c0: 7472 7563 7475 7265 290d 0a0d 0a20 2020  tructure)....   
+000416d0: 2020 2020 2023 4170 706c 7920 7468 6520       #Apply the 
+000416e0: 7377 6170 7069 6e67 2066 756e 6374 696f  swapping functio
+000416f0: 6e20 746f 2073 656c 660d 0a20 2020 2020  n to self..     
+00041700: 2020 2072 6574 7572 6e20 7365 6c66 2e61     return self.a
+00041710: 7070 6c79 285f 7377 6170 5f65 6c65 6d65  pply(_swap_eleme
+00041720: 6e74 290d 0a0d 0a20 2020 2064 6566 2067  nt)....    def g
+00041730: 7261 6674 5f6f 6e28 7365 6c66 2c20 7363  raft_on(self, sc
+00041740: 696f 6e5f 6869 6572 6172 6368 792c 2065  ion_hierarchy, e
+00041750: 6c65 6d65 6e74 5f67 7261 6674 5f72 756c  lement_graft_rul
+00041760: 6520 3d20 6c61 6d62 6461 2078 2c79 3a4e  e = lambda x,y:N
+00041770: 6f6e 652c 2020 7363 696f 6e5f 636f 7069  one,  scion_copi
+00041780: 6564 5f6f 6e63 655f 6f6e 6c79 3d46 616c  ed_once_only=Fal
+00041790: 7365 2c20 7265 7475 726e 5f63 6f70 793d  se, return_copy=
+000417a0: 4661 6c73 652c 2074 7261 6365 5f65 6c65  False, trace_ele
+000417b0: 6d65 6e74 203d 204e 6f6e 6529 3a0d 0a20  ment = None):.. 
+000417c0: 2020 2020 2020 2027 2727 0d0a 2020 2020         '''..    
+000417d0: 2020 2020 5768 656e 2067 7261 6674 696e      When graftin
+000417e0: 6720 6170 706c 6520 7472 6565 7320 746f  g apple trees to
+000417f0: 6765 7468 6572 2c20 796f 7520 6772 6166  gether, you graf
+00041800: 7420 6120 7363 696f 6e20 2874 7769 6720  t a scion (twig 
+00041810: 6f72 2062 7261 6e63 6829 206f 6e74 6f20  or branch) onto 
+00041820: 6120 726f 6f74 7374 6f63 6b20 7472 6565  a rootstock tree
+00041830: 2e20 5468 6973 2066 756e 6374 696f 6e20  . This function 
+00041840: 7573 6573 2074 6861 7420 7465 726d 696e  uses that termin
+00041850: 6f6c 6f67 792e 0d0a 2020 2020 2020 2020  ology...        
+00041860: 4372 6561 7465 2061 6e20 6f75 7470 7574  Create an output
+00041870: 2068 6965 7261 7263 6879 2074 6861 7420   hierarchy that 
+00041880: 7461 6b65 7320 7468 6520 726f 6f74 7374  takes the rootst
+00041890: 6f63 6b20 6869 6572 6172 6368 7920 616e  ock hierarchy an
+000418a0: 6420 6772 6166 7473 206f 6e20 7375 6274  d grafts on subt
+000418b0: 7265 6573 2066 726f 6d20 7468 6520 7363  rees from the sc
+000418c0: 696f 6e20 6869 6572 6172 6368 792e 0d0a  ion hierarchy...
+000418d0: 2020 2020 2020 2020 5363 696f 6e20 5374          Scion St
+000418e0: 7275 6374 7572 6545 6c65 6d65 6e74 206e  ructureElement n
+000418f0: 6f64 6573 2061 7265 2067 7261 6674 6564  odes are grafted
+00041900: 206f 6e20 6163 636f 7264 696e 6720 746f   on according to
+00041910: 2061 2072 756c 6520 7768 6963 6820 6973   a rule which is
+00041920: 2070 6173 7365 6420 696e 2061 7320 6120   passed in as a 
+00041930: 7061 7261 6d65 7465 723a 2065 6c65 6d65  parameter: eleme
+00041940: 6e74 5f67 7261 6674 5f72 756c 652e 0d0a  nt_graft_rule...
+00041950: 2020 2020 2020 2020 416e 2065 7861 6d70          An examp
+00041960: 6c65 206f 6620 616e 2061 7070 726f 7072  le of an appropr
+00041970: 6961 7465 2066 756e 6374 696f 6e20 746f  iate function to
+00041980: 2070 6173 7320 696e 2c20 6973 206f 6e65   pass in, is one
+00041990: 2074 6861 7420 6c6f 6f6b 7320 6174 2074   that looks at t
+000419a0: 6865 2075 6e64 6572 6c79 696e 6720 6669  he underlying fi
+000419b0: 656c 6473 2069 6e20 7468 6520 4469 6d65  elds in the Dime
+000419c0: 6e73 696f 6e45 6c65 6d65 6e74 7320 6f66  nsionElements of
+000419d0: 2062 6f74 6820 6869 6572 6172 6368 6965   both hierarchie
+000419e0: 7320 616e 6420 6465 6369 6465 7320 6261  s and decides ba
+000419f0: 7365 6420 6f6e 2074 6865 2066 6965 6c64  sed on the field
+00041a00: 7320 7768 6574 6865 7220 6120 7375 6274  s whether a subt
+00041a10: 7265 6520 6973 2067 7261 6674 6564 206f  ree is grafted o
+00041a20: 6e20 746f 2074 6865 206d 6173 7465 7220  n to the master 
+00041a30: 7472 6565 0d0a 0d0a 2020 2020 2020 2020  tree....        
+00041a40: 3a70 6172 616d 2073 6369 6f6e 5f68 6965  :param scion_hie
+00041a50: 7261 7263 6879 3a20 4120 5374 7275 6374  rarchy: A Struct
+00041a60: 7572 6545 6c65 6d65 6e74 2077 6869 6368  ureElement which
+00041a70: 2069 7320 7468 6520 726f 6f74 206f 6620   is the root of 
+00041a80: 7468 6520 7363 696f 6e20 6869 6572 6172  the scion hierar
+00041a90: 6368 790d 0a20 2020 2020 2020 203a 7061  chy..        :pa
+00041aa0: 7261 6d20 656c 656d 656e 745f 6772 6166  ram element_graf
+00041ab0: 745f 7275 6c65 3a20 4120 6675 6e63 7469  t_rule: A functi
+00041ac0: 6f6e 2077 6869 6368 2068 6173 2032 2070  on which has 2 p
+00041ad0: 6172 616d 6574 6572 7320 2d20 726f 6f74  arameters - root
+00041ae0: 7374 6f63 6b20 656c 656d 656e 742c 2073  stock element, s
+00041af0: 6369 6f6e 2065 6c65 6d65 6e74 2061 6e64  cion element and
+00041b00: 2072 6574 7572 6e20 5472 7565 2069 6620   return True if 
+00041b10: 7468 6520 7363 696f 6e20 656c 656d 656e  the scion elemen
+00041b20: 7420 6265 6c6f 6e67 7320 756e 6465 7220  t belongs under 
+00041b30: 7468 6520 726f 6f74 7374 6f63 6b20 656c  the rootstock el
+00041b40: 656d 656e 7420 616e 6420 4661 6c73 6520  ement and False 
+00041b50: 6f74 6865 7277 6973 650d 0a20 2020 2020  otherwise..     
+00041b60: 2020 203a 7061 7261 6d20 7363 696f 6e5f     :param scion_
+00041b70: 636f 7069 6564 5f6f 6e63 655f 6f6e 6c79  copied_once_only
+00041b80: 3a20 426f 6f6c 6561 6e20 2d20 646f 6573  : Boolean - does
+00041b90: 2074 6865 2065 6c65 6d65 6e74 206d 6572   the element mer
+00041ba0: 6765 2072 756c 6520 6f6e 6c79 2063 6f70  ge rule only cop
+00041bb0: 7920 7369 6e67 6c65 2063 6f70 6965 7320  y single copies 
+00041bc0: 6f66 2074 6865 2073 6369 6f6e 2065 6c65  of the scion ele
+00041bd0: 6d65 6e74 733f 2049 6620 736f 2077 6520  ments? If so we 
+00041be0: 6361 6e20 6f70 7469 6d69 7a65 2062 7920  can optimize by 
+00041bf0: 6d61 726b 696e 6720 6e6f 6465 7320 6173  marking nodes as
+00041c00: 2066 756c 6c79 2074 7261 6e73 6372 6962   fully transcrib
+00041c10: 6564 2066 726f 6d20 7468 6520 7363 696f  ed from the scio
+00041c20: 6e20 746f 2074 6865 206f 7574 7075 7420  n to the output 
+00041c30: 6869 6572 6172 6368 792c 2061 6e64 2061  hierarchy, and a
+00041c40: 766f 6964 2076 6973 6974 696e 6720 7468  void visiting th
+00041c50: 656d 2061 6761 696e 0d0a 2020 2020 2020  em again..      
+00041c60: 2020 3a70 6172 616d 2072 6574 7572 6e5f    :param return_
+00041c70: 636f 7079 3a20 426f 6f6c 6561 6e20 2d20  copy: Boolean - 
+00041c80: 646f 6e27 7420 6772 6166 7420 7468 6520  don't graft the 
+00041c90: 7363 696f 6e20 6f6e 746f 2073 656c 6620  scion onto self 
+00041ca0: 2d20 7261 7468 6572 2072 6574 7572 6e20  - rather return 
+00041cb0: 6120 636f 7079 206f 6620 7365 6c66 2c20  a copy of self, 
+00041cc0: 7769 7468 2074 6865 2073 6369 6f6e 2067  with the scion g
+00041cd0: 7261 6674 6564 206f 6e0d 0a20 2020 2020  rafted on..     
+00041ce0: 2020 203a 7061 7261 6d20 7472 6163 655f     :param trace_
+00041cf0: 656c 656d 656e 743a 2073 686f 7274 636f  element: shortco
+00041d00: 6465 206f 7220 5374 7275 6374 7572 6545  de or StructureE
+00041d10: 6c65 6d65 6e74 2e20 5768 656e 2074 6865  lement. When the
+00041d20: 2067 7261 6674 6564 2074 7265 6520 6973   grafted tree is
+00041d30: 2063 6f6d 696e 6720 6f75 7420 7769 7468   coming out with
+00041d40: 2075 6e65 7870 6563 7465 6420 7265 7375   unexpected resu
+00041d50: 6c74 7320 796f 7520 6d61 7920 7769 7368  lts you may wish
+00041d60: 2074 6f20 7475 726e 206f 6e20 6c6f 6720   to turn on log 
+00041d70: 7472 6163 696e 6720 666f 7220 6f6e 6520  tracing for one 
+00041d80: 6f66 2074 6865 2072 6f6f 7473 746f 636b  of the rootstock
+00041d90: 2065 6c65 6d65 6e74 7320 2861 6e64 2069   elements (and i
+00041da0: 7473 2073 7562 7472 6565 290d 0a20 2020  ts subtree)..   
+00041db0: 2020 2020 2027 2727 0d0a 2020 2020 2020       '''..      
+00041dc0: 2020 234e 6f74 6520 2d20 6f72 6967 696e    #Note - origin
+00041dd0: 616c 6c79 2074 6865 7265 2077 6173 2061  ally there was a
+00041de0: 2070 6c61 6e20 746f 2063 6f6c 6c61 7073   plan to collaps
+00041df0: 6520 6c6f 6e67 206f 6e65 2064 696d 656e  e long one dimen
+00041e00: 7369 6f6e 616c 2073 7562 2d68 6965 7261  sional sub-hiera
+00041e10: 7263 6869 6573 2069 6e20 7468 6973 2066  rchies in this f
+00041e20: 756e 6374 696f 6e2e 2054 6865 7265 2069  unction. There i
+00041e30: 7320 6e6f 206e 6565 6420 746f 2064 6f20  s no need to do 
+00041e40: 7468 6174 2068 6572 6520 2d20 7765 2063  that here - we c
+00041e50: 616e 2074 6964 7920 7570 2068 6965 7261  an tidy up hiera
+00041e60: 7263 6869 6573 2069 6e20 6120 7375 6273  rchies in a subs
+00041e70: 6571 7565 6e74 2073 7465 700d 0a0d 0a0d  equent step.....
+00041e80: 0a20 2020 2020 2020 2023 496e 2061 206e  .        #In a n
+00041e90: 6573 7465 6420 6c6f 6f70 0d0a 2020 2020  ested loop..    
+00041ea0: 2020 2020 2357 616c 6b20 7468 6520 726f      #Walk the ro
+00041eb0: 6f74 7374 6f63 6b20 6869 6572 6172 6368  otstock hierarch
+00041ec0: 790d 0a20 2020 2020 2020 2020 2020 2023  y..            #
+00041ed0: 5761 6c6b 2074 6865 2073 6369 6f6e 2068  Walk the scion h
+00041ee0: 6965 7261 7263 6879 0d0a 2020 2020 2020  ierarchy..      
+00041ef0: 2020 2020 2020 2020 2020 2349 6620 7468            #If th
+00041f00: 6520 7275 6c65 2073 6179 7320 746f 2067  e rule says to g
+00041f10: 7261 6674 2074 6865 2073 6369 6f6e 2065  raft the scion e
+00041f20: 6c65 6d65 6e74 206f 6e20 7468 656e 2063  lement on then c
+00041f30: 7265 6174 6520 6120 636f 7079 2065 6c65  reate a copy ele
+00041f40: 6d65 6e74 2061 6e64 2067 7261 6674 2069  ment and graft i
+00041f50: 7420 746f 2074 6865 206f 7574 7075 742c  t to the output,
+00041f60: 2069 6e63 7265 6d65 6e74 696e 6720 7468   incrementing th
+00041f70: 6520 696e 6465 6e74 2069 6620 7468 6520  e indent if the 
+00041f80: 7363 696f 6e20 6869 6572 6172 6368 7920  scion hierarchy 
+00041f90: 7265 7175 6972 6573 2069 740d 0a20 2020  requires it..   
+00041fa0: 2020 2020 2020 2020 2023 4166 7465 7220           #After 
+00041fb0: 7468 6520 7768 6f6c 6520 6f66 2074 6865  the whole of the
+00041fc0: 2073 6369 6f6e 2068 6965 7261 7263 6879   scion hierarchy
+00041fd0: 2069 7320 7761 6c6b 6564 2c20 6174 7461   is walked, atta
+00041fe0: 6368 2074 6865 206e 6578 7420 656c 656d  ch the next elem
+00041ff0: 656e 7420 6f66 2074 6865 2072 6f6f 7473  ent of the roots
+00042000: 746f 636b 2068 6965 7261 7263 6879 2074  tock hierarchy t
+00042010: 6f20 7468 6520 6f75 7470 7574 2068 6965  o the output hie
+00042020: 7261 7263 6879 0d0a 0d0a 0d0a 2020 2020  rarchy......    
+00042030: 2020 2020 636f 7069 6564 5f73 6369 6f6e      copied_scion
+00042040: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00042050: 6e74 733d 7b7d 0d0a 0d0a 2020 2020 2020  nts={}....      
+00042060: 2020 2343 7265 6174 6520 7468 6520 726f    #Create the ro
+00042070: 6f74 2065 6c65 6d65 6e74 206f 6620 7468  ot element of th
+00042080: 6520 6f75 7470 7574 2074 7265 650d 0a20  e output tree.. 
+00042090: 2020 2020 2020 2063 7572 7265 6e74 5f6f         current_o
+000420a0: 7574 7075 745f 6e6f 6465 203d 204e 6f6e  utput_node = Non
+000420b0: 650d 0a20 2020 2020 2020 2023 726f 6f74  e..        #root
+000420c0: 5f6f 7574 7075 745f 6e6f 6465 203d 204e  _output_node = N
+000420d0: 6f6e 650d 0a20 2020 2020 2020 206e 6577  one..        new
+000420e0: 5f72 6f6f 7473 746f 636b 5f6f 7574 7075  _rootstock_outpu
+000420f0: 745f 6e6f 6465 203d 204e 6f6e 650d 0a20  t_node = None.. 
+00042100: 2020 2020 2020 2070 7265 7669 6f75 735f         previous_
+00042110: 726f 6f74 7374 6f63 6b5f 6e6f 6465 203d  rootstock_node =
+00042120: 204e 6f6e 650d 0a20 2020 2020 2020 2070   None..        p
+00042130: 7265 7669 6f75 735f 726f 6f74 7374 6f63  revious_rootstoc
+00042140: 6b5f 6c65 7665 6c20 3d20 300d 0a0d 0a20  k_level = 0.... 
+00042150: 2020 2020 2020 2069 6620 7472 6163 655f         if trace_
+00042160: 656c 656d 656e 7420 6973 204e 6f6e 653a  element is None:
+00042170: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+00042180: 6163 655f 656c 656d 656e 745f 7368 6f72  ace_element_shor
+00042190: 7463 6f64 6520 3d20 4e6f 6e65 0d0a 2020  tcode = None..  
+000421a0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+000421b0: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+000421c0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000421d0: 7472 6163 655f 656c 656d 656e 7420 6973  trace_element is
+000421e0: 2061 2053 7472 7563 7475 7265 456c 656d   a StructureElem
+000421f0: 656e 7420 6f72 2045 6c65 6d65 6e74 0d0a  ent or Element..
+00042200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042210: 2364 7563 6b74 7970 696e 6720 696e 2061  #ducktyping in a
+00042220: 6374 696f 6e20 2d20 626f 7468 2068 6176  ction - both hav
+00042230: 6520 6120 7368 6f72 7463 6f64 650d 0a20  e a shortcode.. 
+00042240: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00042250: 7261 6365 5f65 6c65 6d65 6e74 5f73 686f  race_element_sho
+00042260: 7274 636f 6465 203d 2074 7261 6365 5f65  rtcode = trace_e
+00042270: 6c65 6d65 6e74 2e73 686f 7274 6e61 6d65  lement.shortname
+00042280: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
+00042290: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
+000422a0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+000422b0: 2020 2020 2020 2349 7420 6469 646e 2774        #It didn't
+000422c0: 2071 7561 636b 206c 696b 6520 6120 5374   quack like a St
+000422d0: 7275 6374 7572 6545 6c65 6d65 6e74 206f  ructureElement o
+000422e0: 7220 456c 656d 656e 7420 736f 2069 7427  r Element so it'
+000422f0: 7320 6120 7374 7269 6e67 0d0a 2020 2020  s a string..    
+00042300: 2020 2020 2020 2020 2020 2020 2341 6464              #Add
+00042310: 2069 7420 746f 2061 6e6f 7468 6572 2073   it to another s
+00042320: 7472 696e 672c 206a 7573 7420 746f 2062  tring, just to b
+00042330: 6520 7375 7265 0d0a 2020 2020 2020 2020  e sure..        
+00042340: 2020 2020 2020 2020 7472 6163 655f 656c          trace_el
+00042350: 656d 656e 745f 7368 6f72 7463 6f64 6520  ement_shortcode 
+00042360: 3d20 7472 6163 655f 656c 656d 656e 7420  = trace_element 
+00042370: 2b20 2727 0d0a 0d0a 2020 2020 2020 2020  + ''....        
+00042380: 2020 2020 6c6f 672e 696e 666f 2827 7472      log.info('tr
+00042390: 6163 655f 656c 656d 656e 745f 7368 6f72  ace_element_shor
+000423a0: 7463 6f64 6520 3d20 7b7d 272e 666f 726d  tcode = {}'.form
+000423b0: 6174 2874 7261 6365 5f65 6c65 6d65 6e74  at(trace_element
+000423c0: 5f73 686f 7274 636f 6465 2929 0d0a 0d0a  _shortcode))....
+000423d0: 2020 2020 2020 2020 2354 7261 6369 6e67          #Tracing
+000423e0: 2077 696c 6c20 6765 7420 7475 726e 6564   will get turned
+000423f0: 206f 6e20 6279 2073 7769 7463 6869 6e67   on by switching
+00042400: 2074 6865 206c 6f67 2066 756e 6374 696f   the log functio
+00042410: 6e0d 0a20 2020 2020 2020 2023 5374 6172  n..        #Star
+00042420: 7420 6f6e 2064 6562 7567 2075 6e74 696c  t on debug until
+00042430: 2077 6520 7061 7373 2074 6865 2074 7261   we pass the tra
+00042440: 6365 2065 6c65 6d65 6e74 0d0a 2020 2020  ce element..    
+00042450: 2020 2020 7472 6163 655f 6c6f 675f 666e      trace_log_fn
+00042460: 203d 206c 6f67 2e64 6562 7567 0d0a 2020   = log.debug..  
+00042470: 2020 2020 2020 2374 7261 6369 6e67 5f6c        #tracing_l
+00042480: 6576 656c 2068 656c 7073 2075 7320 776f  evel helps us wo
+00042490: 726b 206f 7574 2069 6620 7765 2068 6176  rk out if we hav
+000424a0: 6520 676f 6e65 2066 6172 2065 6e6f 7567  e gone far enoug
+000424b0: 6820 7570 2074 6865 2068 6965 7261 7263  h up the hierarc
+000424c0: 6879 0d0a 2020 2020 2020 2020 7472 6163  hy..        trac
+000424d0: 696e 675f 6c65 7665 6c20 3d20 300d 0a20  ing_level = 0.. 
+000424e0: 2020 2020 2020 2074 7261 6369 6e67 5f70         tracing_p
+000424f0: 6174 6820 3d20 4e6f 6e65 0d0a 0d0a 2020  ath = None....  
+00042500: 2020 2020 2020 2343 6f70 7920 746f 2061        #Copy to a
+00042510: 206c 6973 7420 6265 666f 7265 2077 616c   list before wal
+00042520: 6b69 6e67 2c20 6f74 6865 7277 6973 6520  king, otherwise 
+00042530: 7468 6520 6c65 7665 6c73 2063 6861 6e67  the levels chang
+00042540: 6520 6475 7269 6e67 2070 726f 6365 7373  e during process
+00042550: 696e 6720 7768 656e 2067 7261 6674 696e  ing when graftin
+00042560: 6720 746f 2073 656c 660d 0a20 2020 2020  g to self..     
+00042570: 2020 2066 6f72 2072 6f6f 7473 746f 636b     for rootstock
+00042580: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00042590: 6e74 2c20 726f 6f74 7374 6f63 6b5f 6c65  nt, rootstock_le
+000425a0: 7665 6c20 696e 205b 2865 2c20 6c29 2066  vel in [(e, l) f
+000425b0: 6f72 2065 2c20 6c20 696e 2073 656c 662e  or e, l in self.
+000425c0: 7761 6c6b 5f77 6974 685f 6c65 7665 6c73  walk_with_levels
+000425d0: 2829 5d3a 0d0a 0d0a 2020 2020 2020 2020  ()]:....        
+000425e0: 2020 2020 2354 7261 6369 6e67 2077 696c      #Tracing wil
+000425f0: 6c20 6765 7420 7475 726e 6564 206f 6e20  l get turned on 
+00042600: 6279 2073 7769 7463 6869 6e67 2074 6865  by switching the
+00042610: 206c 6f67 2066 756e 6374 696f 6e0d 0a20   log function.. 
+00042620: 2020 2020 2020 2020 2020 2023 5374 6172             #Star
+00042630: 7420 6f6e 2064 6562 7567 2075 6e74 696c  t on debug until
+00042640: 2077 6520 7061 7373 2074 6865 2074 7261   we pass the tra
+00042650: 6365 2065 6c65 6d65 6e74 0d0a 2020 2020  ce element..    
+00042660: 2020 2020 2020 2020 6966 2072 6f6f 7473          if roots
+00042670: 746f 636b 5f73 7472 7563 7475 7265 5f65  tock_structure_e
+00042680: 6c65 6d65 6e74 2e73 686f 7274 6e61 6d65  lement.shortname
+00042690: 203d 3d20 7472 6163 655f 656c 656d 656e   == trace_elemen
+000426a0: 745f 7368 6f72 7463 6f64 653a 0d0a 2020  t_shortcode:..  
+000426b0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+000426c0: 6163 655f 6c6f 675f 666e 203d 206c 6f67  ace_log_fn = log
+000426d0: 2e69 6e66 6f0d 0a20 2020 2020 2020 2020  .info..         
+000426e0: 2020 2020 2020 2074 7261 6369 6e67 5f6c         tracing_l
+000426f0: 6576 656c 203d 2072 6f6f 7473 746f 636b  evel = rootstock
+00042700: 5f6c 6576 656c 0d0a 0d0a 2020 2020 2020  _level....      
+00042710: 2020 2020 2020 6966 2072 6f6f 7473 746f        if rootsto
+00042720: 636b 5f6c 6576 656c 2069 7320 4e6f 6e65  ck_level is None
+00042730: 206f 7220 726f 6f74 7374 6f63 6b5f 6c65   or rootstock_le
+00042740: 7665 6c20 3c20 7472 6163 696e 675f 6c65  vel < tracing_le
+00042750: 7665 6c3a 0d0a 2020 2020 2020 2020 2020  vel:..          
+00042760: 2020 2020 2020 2349 6620 7765 2068 6176        #If we hav
+00042770: 6520 6d6f 7665 6420 6261 636b 2075 7020  e moved back up 
+00042780: 6265 796f 6e64 2074 6865 2074 7261 6369  beyond the traci
+00042790: 6e67 206c 6576 656c 2c20 7374 6f70 2074  ng level, stop t
+000427a0: 7261 6369 6e67 0d0a 2020 2020 2020 2020  racing..        
+000427b0: 2020 2020 2020 2020 7472 6163 655f 6c6f          trace_lo
+000427c0: 675f 666e 203d 206c 6f67 2e64 6562 7567  g_fn = log.debug
+000427d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000427e0: 2020 7472 6163 696e 675f 6c65 7665 6c20    tracing_level 
+000427f0: 3d20 300d 0a0d 0a20 2020 2020 2020 2020  = 0....         
+00042800: 2020 2074 7261 6365 5f6c 6f67 5f66 6e28     trace_log_fn(
+00042810: 2752 6f6f 7473 746f 636b 2077 616c 6b20  'Rootstock walk 
+00042820: 6174 207b 7d2c 7b7d 272e 666f 726d 6174  at {},{}'.format
+00042830: 2872 6f6f 7473 746f 636b 5f73 7472 7563  (rootstock_struc
+00042840: 7475 7265 5f65 6c65 6d65 6e74 2e73 686f  ture_element.sho
+00042850: 7274 6e61 6d65 2c72 6f6f 7473 746f 636b  rtname,rootstock
+00042860: 5f6c 6576 656c 2929 0d0a 0d0a 2020 2020  _level))....    
+00042870: 2020 2020 2020 2020 6966 206e 6577 5f72          if new_r
+00042880: 6f6f 7473 746f 636b 5f6f 7574 7075 745f  ootstock_output_
+00042890: 6e6f 6465 2069 7320 6e6f 7420 4e6f 6e65  node is not None
+000428a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000428b0: 2020 2023 5365 7420 7468 6520 6375 7272     #Set the curr
+000428c0: 656e 7420 726f 6f74 2062 6163 6b20 746f  ent root back to
+000428d0: 2074 6865 2070 7265 7669 6f75 7320 726f   the previous ro
+000428e0: 6f74 7374 6f63 6b20 6f75 7470 7574 206e  otstock output n
+000428f0: 6f64 650d 0a20 2020 2020 2020 2020 2020  ode..           
+00042900: 2020 2020 2063 7572 7265 6e74 5f6f 7574       current_out
+00042910: 7075 745f 6e6f 6465 203d 206e 6577 5f72  put_node = new_r
+00042920: 6f6f 7473 746f 636b 5f6f 7574 7075 745f  ootstock_output_
+00042930: 6e6f 6465 0d0a 0d0a 2020 2020 2020 2020  node....        
+00042940: 2020 2020 2369 6620 7765 2061 7265 2072      #if we are r
+00042950: 6574 7572 6e69 6e67 2061 2063 6f70 7920  eturning a copy 
+00042960: 7468 656e 2077 6520 7769 6c6c 206e 6565  then we will nee
+00042970: 6420 6120 6e65 775f 726f 6f74 7374 6f63  d a new_rootstoc
+00042980: 6b5f 6f75 7470 7574 5f6e 6f64 650d 0a20  k_output_node.. 
+00042990: 2020 2020 2020 2020 2020 2023 6966 2077             #if w
+000429a0: 6520 6172 6520 6772 6166 7469 6e67 206f  e are grafting o
+000429b0: 6e20 746f 2073 656c 6620 7769 7468 6f75  n to self withou
+000429c0: 7420 636f 7079 696e 6720 7765 206e 6565  t copying we nee
+000429d0: 6420 746f 2073 6574 2074 6869 7320 6e65  d to set this ne
+000429e0: 7720 6e6f 6465 2074 6f20 7365 6c66 0d0a  w node to self..
+000429f0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00042a00: 6f74 2072 6574 7572 6e5f 636f 7079 3a0d  ot return_copy:.
+00042a10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00042a20: 206e 6577 5f72 6f6f 7473 746f 636b 5f6f   new_rootstock_o
+00042a30: 7574 7075 745f 6e6f 6465 203d 2072 6f6f  utput_node = roo
+00042a40: 7473 746f 636b 5f73 7472 7563 7475 7265  tstock_structure
+00042a50: 5f65 6c65 6d65 6e74 0d0a 2020 2020 2020  _element..      
+00042a60: 2020 2020 2020 2020 2020 726f 6f74 7374            rootst
+00042a70: 6f63 6b5f 7374 7275 6374 7572 655f 656c  ock_structure_el
+00042a80: 656d 656e 742e 7365 745f 7061 7265 6e74  ement.set_parent
+00042a90: 284e 6f6e 6529 0d0a 2020 2020 2020 2020  (None)..        
+00042aa0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00042ab0: 2020 2020 2020 2020 2020 206e 6577 5f72             new_r
+00042ac0: 6f6f 7473 746f 636b 5f6f 7574 7075 745f  ootstock_output_
+00042ad0: 6e6f 6465 203d 2053 7472 7563 7475 7265  node = Structure
+00042ae0: 456c 656d 656e 7428 656c 656d 656e 7420  Element(element 
+00042af0: 3d20 726f 6f74 7374 6f63 6b5f 7374 7275  = rootstock_stru
+00042b00: 6374 7572 655f 656c 656d 656e 742e 656c  cture_element.el
+00042b10: 656d 656e 7429 0d0a 0d0a 2020 2020 2020  ement)....      
+00042b20: 2020 2020 2020 6c6f 672e 6465 6275 6728        log.debug(
+00042b30: 2772 6f6f 7473 746f 636b 5f6c 6576 656c  'rootstock_level
+00042b40: 2020 2020 2020 2020 2020 3d20 272b 7374            = '+st
+00042b50: 7228 726f 6f74 7374 6f63 6b5f 6c65 7665  r(rootstock_leve
+00042b60: 6c29 290d 0a20 2020 2020 2020 2020 2020  l))..           
+00042b70: 206c 6f67 2e64 6562 7567 2827 7072 6576   log.debug('prev
+00042b80: 696f 7573 5f72 6f6f 7473 746f 636b 5f6c  ious_rootstock_l
+00042b90: 6576 656c 203d 2027 2b73 7472 2870 7265  evel = '+str(pre
+00042ba0: 7669 6f75 735f 726f 6f74 7374 6f63 6b5f  vious_rootstock_
+00042bb0: 6c65 7665 6c29 290d 0a0d 0a20 2020 2020  level))....     
+00042bc0: 2020 2020 2020 2069 6620 7072 6576 696f         if previo
+00042bd0: 7573 5f72 6f6f 7473 746f 636b 5f6e 6f64  us_rootstock_nod
+00042be0: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
+00042bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c00: 6c6f 672e 6465 6275 6728 2773 6369 6f6e  log.debug('scion
+00042c10: 5f6c 6576 656c 2020 2020 203d 2027 2b73  _level     = '+s
+00042c20: 7472 2873 6369 6f6e 5f6c 6576 656c 2929  tr(scion_level))
+00042c30: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00042c40: 2020 2020 6966 2070 7265 7669 6f75 735f      if previous_
+00042c50: 726f 6f74 7374 6f63 6b5f 6c65 7665 6c20  rootstock_level 
+00042c60: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00042c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042c80: 2020 234c 6f6f 7020 6261 636b 2075 7020    #Loop back up 
+00042c90: 746f 2074 6865 2063 6f72 7265 6374 2070  to the correct p
+00042ca0: 6172 656e 7420 6c65 7665 6c0d 0a20 2020  arent level..   
+00042cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042cc0: 2066 6f72 206e 2069 6e20 7261 6e67 6528   for n in range(
+00042cd0: 3120 2b20 7072 6576 696f 7573 5f72 6f6f  1 + previous_roo
+00042ce0: 7473 746f 636b 5f6c 6576 656c 2d72 6f6f  tstock_level-roo
+00042cf0: 7473 746f 636b 5f6c 6576 656c 293a 0d0a  tstock_level):..
+00042d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042d10: 2020 2020 2020 2020 7472 6163 655f 6c6f          trace_lo
+00042d20: 675f 666e 2827 726f 6f74 7374 6f63 6b20  g_fn('rootstock 
+00042d30: 6869 6572 6172 6368 7920 7374 6570 7069  hierarchy steppi
+00042d40: 6e67 2075 7020 746f 2070 7265 7669 6f75  ng up to previou
+00042d50: 733a 2027 202b 2073 7472 2870 7265 7669  s: ' + str(previ
+00042d60: 6f75 735f 726f 6f74 7374 6f63 6b5f 6e6f  ous_rootstock_no
+00042d70: 6465 2e73 686f 7274 6e61 6d65 2929 0d0a  de.shortname))..
+00042d80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00042d90: 2020 2020 2020 2020 2020 2350 6172 656e            #Paren
+00042da0: 7420 7368 6f75 6c64 206e 6576 6572 2062  t should never b
+00042db0: 6520 4e6f 6e65 2069 6620 7468 6520 6c6f  e None if the lo
+00042dc0: 6769 6320 6973 2077 6f72 6b69 6e67 0d0a  gic is working..
+00042dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042de0: 2020 2020 2020 2020 6966 2070 7265 7669          if previ
+00042df0: 6f75 735f 726f 6f74 7374 6f63 6b5f 6e6f  ous_rootstock_no
+00042e00: 6465 2e70 6172 656e 7420 6973 204e 6f6e  de.parent is Non
+00042e10: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00042e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042e30: 7261 6973 6520 5379 7374 656d 4572 726f  raise SystemErro
+00042e40: 7228 274d 6f76 696e 6720 6672 6f6d 206c  r('Moving from l
+00042e50: 6576 656c 207b 7d20 746f 207b 7d20 6174  evel {} to {} at
+00042e60: 2069 7465 7261 7469 6f6e 207b 7d2e 2070   iteration {}. p
+00042e70: 7265 7669 6f75 735f 726f 6f74 7374 6f63  revious_rootstoc
+00042e80: 6b5f 6e6f 6465 207b 7d20 6861 7320 6e6f  k_node {} has no
+00042e90: 2070 6172 656e 7427 2e66 6f72 6d61 7428   parent'.format(
+00042ea0: 726f 6f74 7374 6f63 6b5f 6c65 7665 6c2c  rootstock_level,
+00042eb0: 7072 6576 696f 7573 5f72 6f6f 7473 746f  previous_rootsto
+00042ec0: 636b 5f6c 6576 656c 2c6e 2c70 7265 7669  ck_level,n,previ
+00042ed0: 6f75 735f 726f 6f74 7374 6f63 6b5f 6e6f  ous_rootstock_no
+00042ee0: 6465 2e73 686f 7274 6e61 6d65 2929 0d0a  de.shortname))..
+00042ef0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00042f00: 2020 2020 2020 2020 2020 7472 6163 655f            trace_
+00042f10: 6c6f 675f 666e 2827 726f 6f74 7374 6f63  log_fn('rootstoc
+00042f20: 6b20 6869 6572 6172 6368 7920 7374 6570  k hierarchy step
+00042f30: 7069 6e67 2075 7020 746f 2070 6172 656e  ping up to paren
+00042f40: 743a 2027 202b 2073 7472 2870 7265 7669  t: ' + str(previ
+00042f50: 6f75 735f 726f 6f74 7374 6f63 6b5f 6e6f  ous_rootstock_no
+00042f60: 6465 2e70 6172 656e 742e 7368 6f72 746e  de.parent.shortn
+00042f70: 616d 6529 290d 0a0d 0a20 2020 2020 2020  ame))....       
+00042f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00042f90: 2070 7265 7669 6f75 735f 726f 6f74 7374   previous_rootst
+00042fa0: 6f63 6b5f 6e6f 6465 203d 2070 7265 7669  ock_node = previ
+00042fb0: 6f75 735f 726f 6f74 7374 6f63 6b5f 6e6f  ous_rootstock_no
+00042fc0: 6465 2e70 6172 656e 740d 0a0d 0a20 2020  de.parent....   
+00042fd0: 2020 2020 2020 2020 2020 2020 2074 7261               tra
+00042fe0: 6365 5f6c 6f67 5f66 6e28 2761 6464 696e  ce_log_fn('addin
+00042ff0: 6720 6e65 775f 726f 6f74 7374 6f63 6b5f  g new_rootstock_
+00043000: 6f75 7470 7574 5f6e 6f64 653a 207b 7d20  output_node: {} 
+00043010: 6173 2063 6869 6c64 2074 6f20 7061 7265  as child to pare
+00043020: 6e74 2070 7265 7669 6f75 735f 726f 6f74  nt previous_root
+00043030: 7374 6f63 6b5f 6e6f 6465 3a20 7b7d 272e  stock_node: {}'.
+00043040: 666f 726d 6174 286e 6577 5f72 6f6f 7473  format(new_roots
+00043050: 746f 636b 5f6f 7574 7075 745f 6e6f 6465  tock_output_node
+00043060: 2e73 686f 7274 6e61 6d65 2c70 7265 7669  .shortname,previ
+00043070: 6f75 735f 726f 6f74 7374 6f63 6b5f 6e6f  ous_rootstock_no
+00043080: 6465 2e73 686f 7274 6e61 6d65 2929 0d0a  de.shortname))..
+00043090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000430a0: 7072 6576 696f 7573 5f72 6f6f 7473 746f  previous_rootsto
+000430b0: 636b 5f6e 6f64 652e 5f61 6464 5f63 6869  ck_node._add_chi
+000430c0: 6c64 286e 6577 5f72 6f6f 7473 746f 636b  ld(new_rootstock
+000430d0: 5f6f 7574 7075 745f 6e6f 6465 290d 0a20  _output_node).. 
+000430e0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000430f0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00043100: 2020 2020 726f 6f74 5f6f 7574 7075 745f      root_output_
+00043110: 6e6f 6465 203d 206e 6577 5f72 6f6f 7473  node = new_roots
+00043120: 746f 636b 5f6f 7574 7075 745f 6e6f 6465  tock_output_node
+00043130: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00043140: 7072 6576 696f 7573 5f72 6f6f 7473 746f  previous_rootsto
+00043150: 636b 5f6e 6f64 6520 3d20 6e65 775f 726f  ck_node = new_ro
+00043160: 6f74 7374 6f63 6b5f 6f75 7470 7574 5f6e  otstock_output_n
+00043170: 6f64 650d 0a20 2020 2020 2020 2020 2020  ode..           
+00043180: 2070 7265 7669 6f75 735f 726f 6f74 7374   previous_rootst
+00043190: 6f63 6b5f 6c65 7665 6c20 3d20 726f 6f74  ock_level = root
+000431a0: 7374 6f63 6b5f 6c65 7665 6c0d 0a0d 0a20  stock_level.... 
+000431b0: 2020 2020 2020 2020 2020 2063 7572 7265             curre
+000431c0: 6e74 5f6f 7574 7075 745f 6e6f 6465 203d  nt_output_node =
+000431d0: 206e 6577 5f72 6f6f 7473 746f 636b 5f6f   new_rootstock_o
+000431e0: 7574 7075 745f 6e6f 6465 0d0a 2020 2020  utput_node..    
+000431f0: 2020 2020 2020 2020 7472 6163 655f 6c6f          trace_lo
+00043200: 675f 666e 2827 2852 6529 5374 6172 7469  g_fn('(Re)Starti
+00043210: 6e67 2073 6369 6f6e 206c 6f6f 7020 6375  ng scion loop cu
+00043220: 7272 656e 7420 526f 6f74 7374 6f63 6b20  rrent Rootstock 
+00043230: 4f75 7470 7574 204e 6f64 6520 3d20 272b  Output Node = '+
+00043240: 7374 7228 6375 7272 656e 745f 6f75 7470  str(current_outp
+00043250: 7574 5f6e 6f64 652e 7368 6f72 746e 616d  ut_node.shortnam
+00043260: 6529 290d 0a0d 0a20 2020 2020 2020 2020  e))....         
+00043270: 2020 206e 203d 202d 310d 0a20 2020 2020     n = -1..     
+00043280: 2020 2020 2020 2066 6f72 2073 6369 6f6e         for scion
+00043290: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+000432a0: 6e74 2c20 7363 696f 6e5f 6c65 7665 6c20  nt, scion_level 
+000432b0: 696e 2073 6369 6f6e 5f68 6965 7261 7263  in scion_hierarc
+000432c0: 6879 2e77 616c 6b5f 7769 7468 5f6c 6576  hy.walk_with_lev
+000432d0: 656c 7328 7065 726d 6973 7369 7665 3d54  els(permissive=T
+000432e0: 7275 6529 3a0d 0a20 2020 2020 2020 2020  rue):..         
+000432f0: 2020 2020 2020 206e 2b3d 310d 0a0d 0a20         n+=1.... 
+00043300: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00043310: 6620 7363 696f 6e5f 636f 7069 6564 5f6f  f scion_copied_o
+00043320: 6e63 655f 6f6e 6c79 3a0d 0a20 2020 2020  nce_only:..     
+00043330: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00043340: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+00043350: 2020 2020 2020 2020 2020 2020 2063 6f70               cop
+00043360: 6965 645f 7363 696f 6e5f 7374 7275 6374  ied_scion_struct
+00043370: 7572 655f 656c 656d 656e 7473 5b73 6369  ure_elements[sci
+00043380: 6f6e 5f73 7472 7563 7475 7265 5f65 6c65  on_structure_ele
+00043390: 6d65 6e74 2e73 686f 7274 6e61 6d65 5d0d  ment.shortname].
+000433a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000433b0: 2020 2020 2020 2020 2023 7761 6c6b 206f           #walk o
+000433c0: 6e20 746f 2074 6865 206e 6578 7420 7363  n to the next sc
+000433d0: 696f 6e20 656c 656d 656e 740d 0a20 2020  ion element..   
+000433e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000433f0: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
 00043400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043410: 2070 6173 730d 0a0d 0a20 2020 2020 2020   pass....       
-00043420: 2020 2020 2020 2020 2023 536f 6d65 7469           #Someti
-00043430: 6d65 7320 6120 5374 7275 6374 7572 6520  mes a Structure 
-00043440: 456c 656d 656e 7420 7769 6c6c 2061 7070  Element will app
-00043450: 6561 7220 626f 7468 2069 6e20 7468 6520  ear both in the 
-00043460: 726f 6f74 7374 6f63 6b20 616e 6420 7468  rootstock and th
-00043470: 6520 7363 696f 6e20 2d20 646f 6e27 7420  e scion - don't 
-00043480: 6174 7461 6368 2074 6f20 7365 6c66 0d0a  attach to self..
-00043490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000434a0: 6966 2063 7572 7265 6e74 5f6f 7574 7075  if current_outpu
-000434b0: 745f 6e6f 6465 2e65 6c65 6d65 6e74 203d  t_node.element =
-000434c0: 3d20 7363 696f 6e5f 7374 7275 6374 7572  = scion_structur
-000434d0: 655f 656c 656d 656e 742e 656c 656d 656e  e_element.elemen
-000434e0: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-000434f0: 2020 2020 2020 2020 7472 6163 655f 6c6f          trace_lo
-00043500: 675f 666e 2827 436f 756e 7469 6e67 2073  g_fn('Counting s
-00043510: 6369 6f6e 2061 7320 636f 7069 6564 2073  cion as copied s
-00043520: 696e 6365 2072 6f6f 7473 746f 636b 2061  ince rootstock a
-00043530: 6e64 2073 6369 6f6e 2065 6c65 6d65 6e74  nd scion element
-00043540: 7320 6172 6520 6571 7561 6c3a 207b 7d20  s are equal: {} 
-00043550: 287b 7d29 272e 666f 726d 6174 2863 7572  ({})'.format(cur
-00043560: 7265 6e74 5f6f 7574 7075 745f 6e6f 6465  rent_output_node
-00043570: 2e65 6c65 6d65 6e74 2e73 686f 7274 6e61  .element.shortna
-00043580: 6d65 2c6e 2929 0d0a 2020 2020 2020 2020  me,n))..        
-00043590: 2020 2020 2020 2020 2020 2020 636f 7069              copi
-000435a0: 6564 5f73 6369 6f6e 5f73 7472 7563 7475  ed_scion_structu
-000435b0: 7265 5f65 6c65 6d65 6e74 735b 7363 696f  re_elements[scio
-000435c0: 6e5f 7374 7275 6374 7572 655f 656c 656d  n_structure_elem
-000435d0: 656e 742e 7368 6f72 746e 616d 655d 203d  ent.shortname] =
-000435e0: 2073 6369 6f6e 5f73 7472 7563 7475 7265   scion_structure
-000435f0: 5f65 6c65 6d65 6e74 0d0a 2020 2020 2020  _element..      
-00043600: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00043610: 6e74 696e 7565 0d0a 0d0a 2020 2020 2020  ntinue....      
-00043620: 2020 2020 2020 2020 2020 6b65 6570 5f74            keep_t
-00043630: 7279 696e 675f 746f 5f67 7261 6674 203d  rying_to_graft =
-00043640: 2065 6c65 6d65 6e74 5f67 7261 6674 5f72   element_graft_r
-00043650: 756c 6528 726f 6f74 7374 6f63 6b5f 7374  ule(rootstock_st
-00043660: 7275 6374 7572 655f 656c 656d 656e 742c  ructure_element,
-00043670: 2073 6369 6f6e 5f73 7472 7563 7475 7265   scion_structure
-00043680: 5f65 6c65 6d65 6e74 290d 0a0d 0a20 2020  _element)....   
-00043690: 2020 2020 2020 2020 2020 2020 2077 6869               whi
-000436a0: 6c65 206b 6565 705f 7472 7969 6e67 5f74  le keep_trying_t
-000436b0: 6f5f 6772 6166 7420 616e 6420 6375 7272  o_graft and curr
-000436c0: 656e 745f 6f75 7470 7574 5f6e 6f64 6520  ent_output_node 
-000436d0: 6973 206e 6f74 204e 6f6e 653a 0d0a 0d0a  is not None:....
-000436e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000436f0: 2020 2020 2341 7474 6163 6820 7468 6520      #Attach the 
-00043700: 7363 696f 6e20 6966 2074 6865 2063 7572  scion if the cur
-00043710: 7265 6e74 206f 7574 7075 7420 6e6f 6465  rent output node
-00043720: 2069 7320 7468 6520 6375 7272 656e 7420   is the current 
-00043730: 6e65 775f 726f 6f74 7374 6f63 6b5f 6f75  new_rootstock_ou
-00043740: 7470 7574 5f6e 6f64 6520 2d20 692e 652e  tput_node - i.e.
-00043750: 2069 6620 7765 2061 7265 2061 7420 726f   if we are at ro
-00043760: 6f74 7374 6f63 6b20 6c65 7665 6c0d 0a20  otstock level.. 
-00043770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043780: 2020 2023 446f 6e27 7420 6c69 6e6b 2069     #Don't link i
-00043790: 7420 6966 2069 7420 6973 2074 6865 2073  t if it is the s
-000437a0: 616d 6520 7468 696e 6720 2d20 736f 6d65  ame thing - some
-000437b0: 7469 6d65 7320 7468 6520 726f 6f74 7374  times the rootst
-000437c0: 6f63 6b20 656c 656d 656e 7420 6973 2061  ock element is a
-000437d0: 6c73 6f20 696e 2074 6865 2073 6369 6f6e  lso in the scion
-000437e0: 2074 7265 6520 2d20 6a75 7374 2075 7365   tree - just use
-000437f0: 2074 6865 2072 6f6f 7473 746f 636b 2076   the rootstock v
-00043800: 6572 7369 6f6e 0d0a 2020 2020 2020 2020  ersion..        
-00043810: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00043820: 7572 7265 6e74 5f6f 7574 7075 745f 6e6f  urrent_output_no
-00043830: 6465 203d 3d20 6e65 775f 726f 6f74 7374  de == new_rootst
-00043840: 6f63 6b5f 6f75 7470 7574 5f6e 6f64 653a  ock_output_node:
-00043850: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00043860: 2020 2020 2020 2020 2020 6e65 775f 7363            new_sc
-00043870: 696f 6e5f 6f75 7470 7574 5f6e 6f64 6520  ion_output_node 
-00043880: 3d20 5374 7275 6374 7572 6545 6c65 6d65  = StructureEleme
-00043890: 6e74 2865 6c65 6d65 6e74 203d 2073 6369  nt(element = sci
-000438a0: 6f6e 5f73 7472 7563 7475 7265 5f65 6c65  on_structure_ele
-000438b0: 6d65 6e74 2e65 6c65 6d65 6e74 290d 0a20  ment.element).. 
-000438c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000438d0: 2020 2020 2020 2074 7261 6365 5f6c 6f67         trace_log
-000438e0: 5f66 6e28 2752 6574 7572 6e65 6420 746f  _fn('Returned to
-000438f0: 2072 6f6f 7473 746f 636b 2e20 4164 6469   rootstock. Addi
-00043900: 6e67 207b 7d20 287b 7d29 2074 6f20 7b7d  ng {} ({}) to {}
-00043910: 2027 2e66 6f72 6d61 7428 7363 696f 6e5f   '.format(scion_
-00043920: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-00043930: 742e 7374 7269 6e67 5f74 6f5f 726f 6f74  t.string_to_root
-00043940: 2c6e 2c20 6375 7272 656e 745f 6f75 7470  ,n, current_outp
-00043950: 7574 5f6e 6f64 652e 7368 6f72 746e 616d  ut_node.shortnam
-00043960: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
-00043970: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00043980: 7265 6e74 5f6f 7574 7075 745f 6e6f 6465  rent_output_node
-00043990: 2e5f 6164 645f 6368 696c 6428 6e65 775f  ._add_child(new_
-000439a0: 7363 696f 6e5f 6f75 7470 7574 5f6e 6f64  scion_output_nod
-000439b0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-000439c0: 2020 2020 2020 2020 2020 2020 2372 6563              #rec
-000439d0: 6f72 6420 7468 6520 636f 7069 6564 2073  ord the copied s
-000439e0: 6369 6f6e 2065 6c65 6d65 6e74 2069 6e20  cion element in 
-000439f0: 6f75 7220 6469 6374 696f 6e61 7279 2c20  our dictionary, 
-00043a00: 736f 2074 6861 7420 7765 2063 616e 2073  so that we can s
-00043a10: 686f 7274 6375 7420 6772 6166 7469 6e67  hortcut grafting
-00043a20: 206f 6620 6475 706c 6963 6174 6520 656c   of duplicate el
-00043a30: 656d 656e 7473 0d0a 0d0a 2020 2020 2020  ements....      
-00043a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043a50: 2020 636f 7069 6564 5f73 6369 6f6e 5f73    copied_scion_s
-00043a60: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00043a70: 735b 6e65 775f 7363 696f 6e5f 6f75 7470  s[new_scion_outp
-00043a80: 7574 5f6e 6f64 652e 7368 6f72 746e 616d  ut_node.shortnam
-00043a90: 655d 203d 206e 6577 5f73 6369 6f6e 5f6f  e] = new_scion_o
-00043aa0: 7574 7075 745f 6e6f 6465 0d0a 0d0a 2020  utput_node....  
-00043ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043ac0: 2020 2020 2020 6375 7272 656e 745f 6f75        current_ou
-00043ad0: 7470 7574 5f6e 6f64 6520 3d20 6e65 775f  tput_node = new_
-00043ae0: 7363 696f 6e5f 6f75 7470 7574 5f6e 6f64  scion_output_nod
-00043af0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00043b00: 2020 2020 2020 2020 2020 2074 7261 6365             trace
-00043b10: 5f6c 6f67 5f66 6e28 272d 2d2d 2d53 6369  _log_fn('----Sci
-00043b20: 6f6e 2067 7261 6674 6564 2e20 2043 7572  on grafted.  Cur
-00043b30: 7265 6e74 204f 7574 7075 7420 6e6f 6465  rent Output node
-00043b40: 2073 6574 2074 6f20 7363 696f 6e3a 2027   set to scion: '
-00043b50: 2b73 7472 2863 7572 7265 6e74 5f6f 7574  +str(current_out
-00043b60: 7075 745f 6e6f 6465 2e73 686f 7274 6e61  put_node.shortna
-00043b70: 6d65 292b 2720 2827 2b73 7472 286e 292b  me)+' ('+str(n)+
-00043b80: 2729 2729 0d0a 0d0a 2020 2020 2020 2020  ')')....        
-00043b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043ba0: 2353 6574 206b 6565 705f 7472 7969 6e67  #Set keep_trying
-00043bb0: 5f74 6f5f 6772 6166 7420 746f 2046 616c  _to_graft to Fal
-00043bc0: 7365 2069 6e20 6f72 6465 7220 746f 2062  se in order to b
-00043bd0: 7265 616b 206f 7574 206f 6620 7468 6520  reak out of the 
-00043be0: 7768 696c 6520 6c6f 6f70 2c20 7768 6963  while loop, whic
-00043bf0: 6820 7769 6c6c 2074 7279 2074 6f20 7461  h will try to ta
-00043c00: 6b65 2075 7320 6261 636b 2075 7020 7468  ke us back up th
-00043c10: 6520 6869 6572 6172 6368 7920 756e 7469  e hierarchy unti
-00043c20: 6c20 7765 2063 616e 2067 7261 6674 0d0a  l we can graft..
-00043c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043c40: 2020 2020 2020 2020 6b65 6570 5f74 7279          keep_try
-00043c50: 696e 675f 746f 5f67 7261 6674 203d 2046  ing_to_graft = F
-00043c60: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
-00043c70: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00043c80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00043c90: 2020 2020 2020 2020 2020 2023 4174 7461             #Atta
-00043ca0: 6368 2074 6865 2073 6369 6f6e 2069 6620  ch the scion if 
-00043cb0: 7468 6520 6375 7272 656e 7420 6f75 7470  the current outp
-00043cc0: 7574 206e 6f64 6520 7761 7320 6372 6561  ut node was crea
-00043cd0: 7465 6420 6672 6f6d 2061 6e20 616e 6365  ted from an ance
-00043ce0: 7374 6f72 206f 6620 7468 6520 7363 696f  stor of the scio
-00043cf0: 6e5f 7374 7275 6374 7572 655f 656c 656d  n_structure_elem
-00043d00: 656e 740d 0a20 2020 2020 2020 2020 2020  ent..           
-00043d10: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00043d20: 2070 2069 6e20 7363 696f 6e5f 7374 7275   p in scion_stru
-00043d30: 6374 7572 655f 656c 656d 656e 742e 616e  cture_element.an
-00043d40: 6365 7374 6f72 733a 0d0a 0d0a 2020 2020  cestors:....    
-00043d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043d60: 2020 2020 2020 2020 6966 2070 2069 7320          if p is 
-00043d70: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00043410: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
+00043420: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00043430: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00043440: 730d 0a0d 0a20 2020 2020 2020 2020 2020  s....           
+00043450: 2020 2020 2023 536f 6d65 7469 6d65 7320       #Sometimes 
+00043460: 6120 5374 7275 6374 7572 6520 456c 656d  a Structure Elem
+00043470: 656e 7420 7769 6c6c 2061 7070 6561 7220  ent will appear 
+00043480: 626f 7468 2069 6e20 7468 6520 726f 6f74  both in the root
+00043490: 7374 6f63 6b20 616e 6420 7468 6520 7363  stock and the sc
+000434a0: 696f 6e20 2d20 646f 6e27 7420 6174 7461  ion - don't atta
+000434b0: 6368 2074 6f20 7365 6c66 0d0a 2020 2020  ch to self..    
+000434c0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+000434d0: 7572 7265 6e74 5f6f 7574 7075 745f 6e6f  urrent_output_no
+000434e0: 6465 2e65 6c65 6d65 6e74 203d 3d20 7363  de.element == sc
+000434f0: 696f 6e5f 7374 7275 6374 7572 655f 656c  ion_structure_el
+00043500: 656d 656e 742e 656c 656d 656e 743a 0d0a  ement.element:..
+00043510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043520: 2020 2020 7472 6163 655f 6c6f 675f 666e      trace_log_fn
+00043530: 2827 436f 756e 7469 6e67 2073 6369 6f6e  ('Counting scion
+00043540: 2061 7320 636f 7069 6564 2073 696e 6365   as copied since
+00043550: 2072 6f6f 7473 746f 636b 2061 6e64 2073   rootstock and s
+00043560: 6369 6f6e 2065 6c65 6d65 6e74 7320 6172  cion elements ar
+00043570: 6520 6571 7561 6c3a 207b 7d20 287b 7d29  e equal: {} ({})
+00043580: 272e 666f 726d 6174 2863 7572 7265 6e74  '.format(current
+00043590: 5f6f 7574 7075 745f 6e6f 6465 2e65 6c65  _output_node.ele
+000435a0: 6d65 6e74 2e73 686f 7274 6e61 6d65 2c6e  ment.shortname,n
+000435b0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+000435c0: 2020 2020 2020 2020 636f 7069 6564 5f73          copied_s
+000435d0: 6369 6f6e 5f73 7472 7563 7475 7265 5f65  cion_structure_e
+000435e0: 6c65 6d65 6e74 735b 7363 696f 6e5f 7374  lements[scion_st
+000435f0: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
+00043600: 7368 6f72 746e 616d 655d 203d 2073 6369  shortname] = sci
+00043610: 6f6e 5f73 7472 7563 7475 7265 5f65 6c65  on_structure_ele
+00043620: 6d65 6e74 0d0a 2020 2020 2020 2020 2020  ment..          
+00043630: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00043640: 7565 0d0a 0d0a 2020 2020 2020 2020 2020  ue....          
+00043650: 2020 2020 2020 6b65 6570 5f74 7279 696e        keep_tryin
+00043660: 675f 746f 5f67 7261 6674 203d 2065 6c65  g_to_graft = ele
+00043670: 6d65 6e74 5f67 7261 6674 5f72 756c 6528  ment_graft_rule(
+00043680: 726f 6f74 7374 6f63 6b5f 7374 7275 6374  rootstock_struct
+00043690: 7572 655f 656c 656d 656e 742c 2073 6369  ure_element, sci
+000436a0: 6f6e 5f73 7472 7563 7475 7265 5f65 6c65  on_structure_ele
+000436b0: 6d65 6e74 290d 0a0d 0a20 2020 2020 2020  ment)....       
+000436c0: 2020 2020 2020 2020 2077 6869 6c65 206b           while k
+000436d0: 6565 705f 7472 7969 6e67 5f74 6f5f 6772  eep_trying_to_gr
+000436e0: 6166 7420 616e 6420 6375 7272 656e 745f  aft and current_
+000436f0: 6f75 7470 7574 5f6e 6f64 6520 6973 206e  output_node is n
+00043700: 6f74 204e 6f6e 653a 0d0a 0d0a 2020 2020  ot None:....    
+00043710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043720: 2341 7474 6163 6820 7468 6520 7363 696f  #Attach the scio
+00043730: 6e20 6966 2074 6865 2063 7572 7265 6e74  n if the current
+00043740: 206f 7574 7075 7420 6e6f 6465 2069 7320   output node is 
+00043750: 7468 6520 6375 7272 656e 7420 6e65 775f  the current new_
+00043760: 726f 6f74 7374 6f63 6b5f 6f75 7470 7574  rootstock_output
+00043770: 5f6e 6f64 6520 2d20 692e 652e 2069 6620  _node - i.e. if 
+00043780: 7765 2061 7265 2061 7420 726f 6f74 7374  we are at rootst
+00043790: 6f63 6b20 6c65 7665 6c0d 0a20 2020 2020  ock level..     
+000437a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000437b0: 446f 6e27 7420 6c69 6e6b 2069 7420 6966  Don't link it if
+000437c0: 2069 7420 6973 2074 6865 2073 616d 6520   it is the same 
+000437d0: 7468 696e 6720 2d20 736f 6d65 7469 6d65  thing - sometime
+000437e0: 7320 7468 6520 726f 6f74 7374 6f63 6b20  s the rootstock 
+000437f0: 656c 656d 656e 7420 6973 2061 6c73 6f20  element is also 
+00043800: 696e 2074 6865 2073 6369 6f6e 2074 7265  in the scion tre
+00043810: 6520 2d20 6a75 7374 2075 7365 2074 6865  e - just use the
+00043820: 2072 6f6f 7473 746f 636b 2076 6572 7369   rootstock versi
+00043830: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+00043840: 2020 2020 2020 2020 6966 2063 7572 7265          if curre
+00043850: 6e74 5f6f 7574 7075 745f 6e6f 6465 203d  nt_output_node =
+00043860: 3d20 6e65 775f 726f 6f74 7374 6f63 6b5f  = new_rootstock_
+00043870: 6f75 7470 7574 5f6e 6f64 653a 0d0a 2020  output_node:..  
+00043880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043890: 2020 2020 2020 6e65 775f 7363 696f 6e5f        new_scion_
+000438a0: 6f75 7470 7574 5f6e 6f64 6520 3d20 5374  output_node = St
+000438b0: 7275 6374 7572 6545 6c65 6d65 6e74 2865  ructureElement(e
+000438c0: 6c65 6d65 6e74 203d 2073 6369 6f6e 5f73  lement = scion_s
+000438d0: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+000438e0: 2e65 6c65 6d65 6e74 290d 0a20 2020 2020  .element)..     
+000438f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043900: 2020 2074 7261 6365 5f6c 6f67 5f66 6e28     trace_log_fn(
+00043910: 2752 6574 7572 6e65 6420 746f 2072 6f6f  'Returned to roo
+00043920: 7473 746f 636b 2e20 4164 6469 6e67 207b  tstock. Adding {
+00043930: 7d20 287b 7d29 2074 6f20 7b7d 2027 2e66  } ({}) to {} '.f
+00043940: 6f72 6d61 7428 7363 696f 6e5f 7374 7275  ormat(scion_stru
+00043950: 6374 7572 655f 656c 656d 656e 742e 7374  cture_element.st
+00043960: 7269 6e67 5f74 6f5f 726f 6f74 2c6e 2c20  ring_to_root,n, 
+00043970: 6375 7272 656e 745f 6f75 7470 7574 5f6e  current_output_n
+00043980: 6f64 652e 7368 6f72 746e 616d 6529 290d  ode.shortname)).
+00043990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000439a0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+000439b0: 5f6f 7574 7075 745f 6e6f 6465 2e5f 6164  _output_node._ad
+000439c0: 645f 6368 696c 6428 6e65 775f 7363 696f  d_child(new_scio
+000439d0: 6e5f 6f75 7470 7574 5f6e 6f64 6529 0d0a  n_output_node)..
+000439e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000439f0: 2020 2020 2020 2020 2372 6563 6f72 6420          #record 
+00043a00: 7468 6520 636f 7069 6564 2073 6369 6f6e  the copied scion
+00043a10: 2065 6c65 6d65 6e74 2069 6e20 6f75 7220   element in our 
+00043a20: 6469 6374 696f 6e61 7279 2c20 736f 2074  dictionary, so t
+00043a30: 6861 7420 7765 2063 616e 2073 686f 7274  hat we can short
+00043a40: 6375 7420 6772 6166 7469 6e67 206f 6620  cut grafting of 
+00043a50: 6475 706c 6963 6174 6520 656c 656d 656e  duplicate elemen
+00043a60: 7473 0d0a 0d0a 2020 2020 2020 2020 2020  ts....          
+00043a70: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00043a80: 7069 6564 5f73 6369 6f6e 5f73 7472 7563  pied_scion_struc
+00043a90: 7475 7265 5f65 6c65 6d65 6e74 735b 6e65  ture_elements[ne
+00043aa0: 775f 7363 696f 6e5f 6f75 7470 7574 5f6e  w_scion_output_n
+00043ab0: 6f64 652e 7368 6f72 746e 616d 655d 203d  ode.shortname] =
+00043ac0: 206e 6577 5f73 6369 6f6e 5f6f 7574 7075   new_scion_outpu
+00043ad0: 745f 6e6f 6465 0d0a 0d0a 2020 2020 2020  t_node....      
+00043ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043af0: 2020 6375 7272 656e 745f 6f75 7470 7574    current_output
+00043b00: 5f6e 6f64 6520 3d20 6e65 775f 7363 696f  _node = new_scio
+00043b10: 6e5f 6f75 7470 7574 5f6e 6f64 650d 0a20  n_output_node.. 
+00043b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043b30: 2020 2020 2020 2074 7261 6365 5f6c 6f67         trace_log
+00043b40: 5f66 6e28 272d 2d2d 2d53 6369 6f6e 2067  _fn('----Scion g
+00043b50: 7261 6674 6564 2e20 2043 7572 7265 6e74  rafted.  Current
+00043b60: 204f 7574 7075 7420 6e6f 6465 2073 6574   Output node set
+00043b70: 2074 6f20 7363 696f 6e3a 2027 2b73 7472   to scion: '+str
+00043b80: 2863 7572 7265 6e74 5f6f 7574 7075 745f  (current_output_
+00043b90: 6e6f 6465 2e73 686f 7274 6e61 6d65 292b  node.shortname)+
+00043ba0: 2720 2827 2b73 7472 286e 292b 2729 2729  ' ('+str(n)+')')
+00043bb0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00043bc0: 2020 2020 2020 2020 2020 2020 2353 6574              #Set
+00043bd0: 206b 6565 705f 7472 7969 6e67 5f74 6f5f   keep_trying_to_
+00043be0: 6772 6166 7420 746f 2046 616c 7365 2069  graft to False i
+00043bf0: 6e20 6f72 6465 7220 746f 2062 7265 616b  n order to break
+00043c00: 206f 7574 206f 6620 7468 6520 7768 696c   out of the whil
+00043c10: 6520 6c6f 6f70 2c20 7768 6963 6820 7769  e loop, which wi
+00043c20: 6c6c 2074 7279 2074 6f20 7461 6b65 2075  ll try to take u
+00043c30: 7320 6261 636b 2075 7020 7468 6520 6869  s back up the hi
+00043c40: 6572 6172 6368 7920 756e 7469 6c20 7765  erarchy until we
+00043c50: 2063 616e 2067 7261 6674 0d0a 2020 2020   can graft..    
+00043c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043c70: 2020 2020 6b65 6570 5f74 7279 696e 675f      keep_trying_
+00043c80: 746f 5f67 7261 6674 203d 2046 616c 7365  to_graft = False
+00043c90: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00043ca0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00043cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043cc0: 2020 2020 2020 2023 4174 7461 6368 2074         #Attach t
+00043cd0: 6865 2073 6369 6f6e 2069 6620 7468 6520  he scion if the 
+00043ce0: 6375 7272 656e 7420 6f75 7470 7574 206e  current output n
+00043cf0: 6f64 6520 7761 7320 6372 6561 7465 6420  ode was created 
+00043d00: 6672 6f6d 2061 6e20 616e 6365 7374 6f72  from an ancestor
+00043d10: 206f 6620 7468 6520 7363 696f 6e5f 7374   of the scion_st
+00043d20: 7275 6374 7572 655f 656c 656d 656e 740d  ructure_element.
+00043d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00043d40: 2020 2020 2020 2020 2066 6f72 2070 2069           for p i
+00043d50: 6e20 7363 696f 6e5f 7374 7275 6374 7572  n scion_structur
+00043d60: 655f 656c 656d 656e 742e 616e 6365 7374  e_element.ancest
+00043d70: 6f72 733a 0d0a 0d0a 2020 2020 2020 2020  ors:....        
 00043d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043d90: 2020 2020 2020 2062 7265 616b 0d0a 0d0a         break....
-00043da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043db0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00043dc0: 2e73 686f 7274 6e61 6d65 203d 3d20 6375  .shortname == cu
-00043dd0: 7272 656e 745f 6f75 7470 7574 5f6e 6f64  rrent_output_nod
-00043de0: 652e 7368 6f72 746e 616d 653a 0d0a 0d0a  e.shortname:....
-00043df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043e10: 6e65 775f 7363 696f 6e5f 6f75 7470 7574  new_scion_output
-00043e20: 5f6e 6f64 6520 3d20 5374 7275 6374 7572  _node = Structur
-00043e30: 6545 6c65 6d65 6e74 2865 6c65 6d65 6e74  eElement(element
-00043e40: 203d 2073 6369 6f6e 5f73 7472 7563 7475   = scion_structu
-00043e50: 7265 5f65 6c65 6d65 6e74 2e65 6c65 6d65  re_element.eleme
-00043e60: 6e74 290d 0a20 2020 2020 2020 2020 2020  nt)..           
-00043e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043e80: 2020 2020 2074 7261 6365 5f6c 6f67 5f66       trace_log_f
-00043e90: 6e28 2753 6369 6f6e 2067 7261 6674 696e  n('Scion graftin
-00043ea0: 6720 746f 2061 6e63 6573 746f 7220 6f66  g to ancestor of
-00043eb0: 207b 7d2e 207b 7d28 7b7d 2920 6164 6465   {}. {}({}) adde
-00043ec0: 6420 746f 207b 7d27 2e66 6f72 6d61 7428  d to {}'.format(
-00043ed0: 7363 696f 6e5f 7374 7275 6374 7572 655f  scion_structure_
-00043ee0: 656c 656d 656e 742e 7368 6f72 746e 616d  element.shortnam
-00043ef0: 652c 6e65 775f 7363 696f 6e5f 6f75 7470  e,new_scion_outp
-00043f00: 7574 5f6e 6f64 652e 7368 6f72 746e 616d  ut_node.shortnam
-00043f10: 652c 6e2c 6375 7272 656e 745f 6f75 7470  e,n,current_outp
-00043f20: 7574 5f6e 6f64 652e 7368 6f72 746e 616d  ut_node.shortnam
-00043f30: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
-00043f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043f50: 2020 2020 2063 7572 7265 6e74 5f6f 7574       current_out
-00043f60: 7075 745f 6e6f 6465 2e5f 6164 645f 6368  put_node._add_ch
-00043f70: 696c 6428 6e65 775f 7363 696f 6e5f 6f75  ild(new_scion_ou
-00043f80: 7470 7574 5f6e 6f64 6529 0d0a 2020 2020  tput_node)..    
-00043f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00043fa0: 2020 2020 2020 2020 2020 2020 2372 6563              #rec
-00043fb0: 6f72 6420 7468 6520 636f 7069 6564 2073  ord the copied s
-00043fc0: 6369 6f6e 2065 6c65 6d65 6e74 2069 6e20  cion element in 
-00043fd0: 6f75 7220 6469 6374 696f 6e61 7279 2c20  our dictionary, 
-00043fe0: 736f 2074 6861 7420 7765 2063 616e 2073  so that we can s
-00043ff0: 686f 7274 6375 7420 6772 6166 7469 6e67  hortcut grafting
-00044000: 206f 6620 6475 706c 6963 6174 6520 656c   of duplicate el
-00044010: 656d 656e 7473 0d0a 2020 2020 2020 2020  ements..        
-00044020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044030: 2020 2020 2020 2020 636f 7069 6564 5f73          copied_s
-00044040: 6369 6f6e 5f73 7472 7563 7475 7265 5f65  cion_structure_e
-00044050: 6c65 6d65 6e74 735b 6e65 775f 7363 696f  lements[new_scio
-00044060: 6e5f 6f75 7470 7574 5f6e 6f64 652e 7368  n_output_node.sh
-00044070: 6f72 746e 616d 655d 203d 206e 6577 5f73  ortname] = new_s
-00044080: 6369 6f6e 5f6f 7574 7075 745f 6e6f 6465  cion_output_node
-00044090: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000440a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000440b0: 2020 7472 6163 655f 6c6f 675f 666e 2827    trace_log_fn('
-000440c0: 2d2d 2d2d 4375 7272 656e 7420 4f75 7470  ----Current Outp
-000440d0: 7574 206e 6f64 6520 7365 7420 746f 2027  ut node set to '
-000440e0: 2b73 7472 2863 7572 7265 6e74 5f6f 7574  +str(current_out
-000440f0: 7075 745f 6e6f 6465 2e73 686f 7274 6e61  put_node.shortna
-00044100: 6d65 2929 0d0a 0d0a 2020 2020 2020 2020  me))....        
-00044110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044120: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-00044130: 6f75 7470 7574 5f6e 6f64 6520 3d20 6e65  output_node = ne
-00044140: 775f 7363 696f 6e5f 6f75 7470 7574 5f6e  w_scion_output_n
-00044150: 6f64 650d 0a0d 0a20 2020 2020 2020 2020  ode....         
-00044160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044170: 2020 2020 2020 2023 5365 7420 6b65 6570         #Set keep
-00044180: 5f74 7279 696e 675f 746f 5f67 7261 6674  _trying_to_graft
-00044190: 2074 6f20 4661 6c73 6520 696e 206f 7264   to False in ord
-000441a0: 6572 2074 6f20 6272 6561 6b20 6f75 7420  er to break out 
-000441b0: 6f66 2074 6865 2077 6869 6c65 206c 6f6f  of the while loo
-000441c0: 702c 2077 6869 6368 2077 696c 6c20 7472  p, which will tr
-000441d0: 7920 746f 2074 616b 6520 7573 2062 6163  y to take us bac
-000441e0: 6b20 7570 2074 6865 2068 6965 7261 7263  k up the hierarc
-000441f0: 6879 2075 6e74 696c 2077 6520 6361 6e20  hy until we can 
-00044200: 6772 6166 740d 0a20 2020 2020 2020 2020  graft..         
-00044210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044220: 2020 2020 2020 2023 4279 2062 7265 616b         #By break
-00044230: 696e 6720 6f75 7420 6f66 2074 6865 2077  ing out of the w
-00044240: 6869 6c65 206c 6f6f 7020 7765 2077 696c  hile loop we wil
-00044250: 6c20 7374 6172 7420 7472 7969 6e67 2074  l start trying t
-00044260: 6f20 6772 6166 7420 7468 6520 6e65 7874  o graft the next
-00044270: 2073 6369 6f6e 206e 6f64 650d 0a20 2020   scion node..   
-00044280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044290: 2020 2020 2020 2020 2020 2020 206b 6565               kee
-000442a0: 705f 7472 7969 6e67 5f74 6f5f 6772 6166  p_trying_to_graf
-000442b0: 7420 3d20 4661 6c73 650d 0a20 2020 2020  t = False..     
-000442c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000442d0: 2020 2020 2020 2020 2020 2062 7265 616b             break
-000442e0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000442f0: 2020 2020 2020 2020 6966 206b 6565 705f          if keep_
-00044300: 7472 7969 6e67 5f74 6f5f 6772 6166 743a  trying_to_graft:
-00044310: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00044320: 2020 2020 2020 2020 2020 2349 6620 7765            #If we
-00044330: 2067 6f74 2074 6869 7320 6661 7220 7769   got this far wi
-00044340: 7468 6f75 7420 6772 6166 7469 6e67 2c20  thout grafting, 
-00044350: 7468 656e 2077 6520 636f 756c 646e 2774  then we couldn't
-00044360: 2067 7261 6674 2074 6865 2073 6369 6f6e   graft the scion
-00044370: 206e 6f64 6520 746f 2074 6869 7320 6375   node to this cu
-00044380: 7272 656e 7420 6f75 7470 7574 206e 6f64  rrent output nod
-00044390: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-000443a0: 2020 2020 2020 2020 2020 2023 536f 2067             #So g
-000443b0: 6f20 7570 2061 206c 6576 656c 2c20 616e  o up a level, an
-000443c0: 6420 7472 7920 746f 2067 7261 6674 2074  d try to graft t
-000443d0: 6865 7265 0d0a 2020 2020 2020 2020 2020  here..          
-000443e0: 2020 2020 2020 2020 2020 2020 2020 2345                #E
-000443f0: 7665 6e74 7561 6c6c 7920 7765 276c 6c20  ventually we'll 
-00044400: 6d65 6574 2061 6e20 616e 6365 7374 6f72  meet an ancestor
-00044410: 206f 6620 7468 6520 6375 7272 656e 7420   of the current 
-00044420: 7363 696f 6e2c 206f 7220 7468 6520 6e65  scion, or the ne
-00044430: 775f 726f 6f74 7374 6f63 6b5f 6f75 7470  w_rootstock_outp
-00044440: 7574 5f6e 6f64 652c 0d0a 2020 2020 2020  ut_node,..      
-00044450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044460: 2020 2320 616e 6420 7765 276c 6c20 6174    # and we'll at
-00044470: 7461 6368 2074 6f20 7468 6174 0d0a 2020  tach to that..  
-00044480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044490: 2020 2020 2020 2374 7261 6365 5f6c 6f67        #trace_log
-000444a0: 5f66 6e28 2742 6f74 746f 6d20 6f66 2069  _fn('Bottom of i
-000444b0: 6e6e 6572 206c 6f6f 7020 6375 7272 656e  nner loop curren
-000444c0: 7420 4f75 7470 7574 204e 6f64 6520 7b7d  t Output Node {}
-000444d0: 206d 6f76 6564 2075 7020 746f 2070 6172   moved up to par
-000444e0: 656e 742e 2049 7320 6e6f 7720 7365 7420  ent. Is now set 
-000444f0: 746f 207b 7d27 2e66 6f72 6d61 7428 6375  to {}'.format(cu
-00044500: 7272 656e 745f 6f75 7470 7574 5f6e 6f64  rrent_output_nod
-00044510: 652e 7061 7265 6e74 2e73 686f 7274 6e61  e.parent.shortna
-00044520: 6d65 2c20 6375 7272 656e 745f 6f75 7470  me, current_outp
-00044530: 7574 5f6e 6f64 652e 7368 6f72 746e 616d  ut_node.shortnam
-00044540: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
-00044550: 2020 2020 2020 2020 2020 2020 2063 7572               cur
-00044560: 7265 6e74 5f6f 7574 7075 745f 6e6f 6465  rent_output_node
-00044570: 203d 2063 7572 7265 6e74 5f6f 7574 7075   = current_outpu
-00044580: 745f 6e6f 6465 2e70 6172 656e 740d 0a0d  t_node.parent...
-00044590: 0a0d 0a20 2020 2020 2020 2023 5265 7475  ...        #Retu
-000445a0: 726e 2074 6865 2072 6f6f 7420 6e6f 6465  rn the root node
-000445b0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000445c0: 2072 6f6f 745f 6f75 7470 7574 5f6e 6f64   root_output_nod
-000445d0: 650d 0a0d 0a0d 0a20 2020 2023 6465 6620  e......    #def 
-000445e0: 636f 6e63 6572 7469 6e61 2873 656c 662c  concertina(self,
-000445f0: 2029 3a0d 0a0d 0a20 2020 2064 6566 2066   ):....    def f
-00044600: 696c 7465 7228 7365 6c66 2c20 6669 6c74  ilter(self, filt
-00044610: 6572 5f72 756c 6520 3d20 4e6f 6e65 2c73  er_rule = None,s
-00044620: 686f 7274 636f 6465 5f6c 6973 743d 4e6f  hortcode_list=No
-00044630: 6e65 2c66 696c 7465 725f 696e 203d 2054  ne,filter_in = T
-00044640: 7275 6529 3a0d 0a20 2020 2020 2020 2027  rue):..        '
-00044650: 2727 4669 6c74 6572 206f 7574 2028 6f72  ''Filter out (or
-00044660: 2066 696c 7465 7220 696e 2920 616c 6c20   filter in) all 
-00044670: 656c 656d 656e 7473 206f 6620 7468 6520  elements of the 
-00044680: 7375 6274 7265 6520 7468 6174 2064 6f20  subtree that do 
-00044690: 6e6f 7420 286f 7220 646f 2920 636f 6e66  not (or do) conf
-000446a0: 6f72 6d20 746f 2074 6865 2066 696c 7465  orm to the filte
-000446b0: 7220 7275 6c65 206f 7220 6172 6520 6e6f  r rule or are no
-000446c0: 7420 286f 7220 6172 6529 2069 6e20 7468  t (or are) in th
-000446d0: 6520 7368 6f72 7463 6f64 655f 6c69 7374  e shortcode_list
-000446e0: 2e0d 0a20 2020 2020 2020 2066 696c 7465  ...        filte
-000446f0: 725f 696e 2064 6574 6572 6d69 6e65 7320  r_in determines 
-00044700: 7768 6574 6865 7220 7468 6520 656c 656d  whether the elem
-00044710: 656e 7473 2061 7070 6561 7269 6e67 2069  ents appearing i
-00044720: 6e20 7468 6520 6c69 7374 206f 7220 636f  n the list or co
-00044730: 6e66 6f72 6d69 6e67 2074 6f20 7468 6520  nforming to the 
-00044740: 7275 6c65 2067 6574 2066 696c 7465 7265  rule get filtere
-00044750: 6420 696e 206f 7220 6f75 740d 0a0d 0a20  d in or out.... 
-00044760: 2020 2020 2020 2054 6865 2073 686f 7274         The short
-00044770: 636f 6465 206c 6973 7420 6973 2061 7070  code list is app
-00044780: 6c69 6564 2066 6972 7374 2c20 666f 6c6c  lied first, foll
-00044790: 6f77 6564 2062 7920 7468 6520 6669 6c74  owed by the filt
-000447a0: 6572 2072 756c 650d 0a0d 0a20 2020 2020  er rule....     
-000447b0: 2020 203a 7061 7261 6d20 6669 6c74 6572     :param filter
-000447c0: 5f72 756c 653a 2061 2066 756e 6374 696f  _rule: a functio
-000447d0: 6e20 7468 6174 2074 616b 6573 2061 2053  n that takes a S
-000447e0: 7472 7563 7475 7265 456c 656d 656e 7420  tructureElement 
-000447f0: 616e 6420 7265 7475 726e 7320 5472 7565  and returns True
-00044800: 2069 6620 6974 2069 7320 746f 2062 6520   if it is to be 
-00044810: 6b65 7074 2c20 4661 6c73 652c 206f 7468  kept, False, oth
-00044820: 6572 7769 7365 0d0a 2020 2020 2020 2020  erwise..        
-00044830: 3a70 6172 616d 2073 686f 7274 636f 6465  :param shortcode
-00044840: 5f6c 6973 743a 206c 6973 7420 6f66 2073  _list: list of s
-00044850: 686f 7274 636f 6465 7320 746f 2062 6520  hortcodes to be 
-00044860: 7573 6564 2074 6f20 6669 6c74 6572 2074  used to filter t
-00044870: 6865 2074 7265 652c 2061 6c74 6572 6e61  he tree, alterna
-00044880: 7469 7665 2074 6f20 7573 696e 6720 6120  tive to using a 
-00044890: 6669 6c74 6572 2072 756c 650d 0a20 2020  filter rule..   
-000448a0: 2020 2020 203a 7061 7261 6d20 6669 6c74       :param filt
-000448b0: 6572 5f69 6e3a 2020 2054 7275 6520 6966  er_in:   True if
-000448c0: 2077 6520 7769 7368 2074 6f20 696e 636c   we wish to incl
-000448d0: 7564 6520 7368 6f72 7463 6f64 6573 2069  ude shortcodes i
-000448e0: 6e20 7468 6520 7368 6f72 7463 6f64 655f  n the shortcode_
-000448f0: 6c69 7374 2c20 4661 6c73 6520 6966 2077  list, False if w
-00044900: 6520 7769 7368 2074 6f20 6578 636c 7564  e wish to exclud
-00044910: 6520 7468 656d 2066 726f 6d20 7468 6520  e them from the 
-00044920: 7472 6565 0d0a 2020 2020 2020 2020 2727  tree..        ''
-00044930: 270d 0a0d 0a0d 0a20 2020 2020 2020 2066  '......        f
-00044940: 696c 7465 7265 645f 636f 756e 7420 3d20  iltered_count = 
-00044950: 2d31 0d0a 2020 2020 2020 2020 234b 6565  -1..        #Kee
-00044960: 7020 6669 6c74 6572 696e 6720 7468 6520  p filtering the 
-00044970: 6368 696c 6472 656e 2075 6e74 696c 2074  children until t
-00044980: 6865 7265 2061 7265 206e 6f20 6669 6c74  here are no filt
-00044990: 6572 696e 6720 6576 656e 7473 206c 6566  ering events lef
-000449a0: 742c 2062 6566 6f72 6520 6d6f 7669 6e67  t, before moving
-000449b0: 206f 6e74 6f20 7468 6520 6368 696c 6472   onto the childr
-000449c0: 656e 2074 6861 7420 7265 6d61 696e 0d0a  en that remain..
-000449d0: 2020 2020 2020 2020 7768 696c 6520 6669          while fi
-000449e0: 6c74 6572 6564 5f63 6f75 6e74 2021 3d20  ltered_count != 
-000449f0: 303a 0d0a 2020 2020 2020 2020 2020 2020  0:..            
-00044a00: 2372 6573 7461 7274 2074 6865 2063 6f75  #restart the cou
-00044a10: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-00044a20: 6669 6c74 6572 6564 5f63 6f75 6e74 203d  filtered_count =
-00044a30: 2030 0d0a 2020 2020 2020 2020 2020 2020   0..            
-00044a40: 2354 7572 6e20 2e63 6869 6c64 7265 6e20  #Turn .children 
-00044a50: 696e 746f 2061 206c 6973 7420 6265 6361  into a list beca
-00044a60: 7573 6520 7765 2061 7265 2063 6861 6e67  use we are chang
-00044a70: 696e 6720 7468 6520 6368 696c 6472 656e  ing the children
-00044a80: 2061 7320 7765 206c 6f6f 7020 6f76 6572   as we loop over
-00044a90: 2074 6865 6d0d 0a20 2020 2020 2020 2020   them..         
-00044aa0: 2020 2066 6f72 2063 6820 696e 206c 6973     for ch in lis
-00044ab0: 7428 7365 6c66 2e63 6869 6c64 7265 6e29  t(self.children)
-00044ac0: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
-00044ad0: 2020 2020 2069 6620 7368 6f72 7463 6f64       if shortcod
-00044ae0: 655f 6c69 7374 2069 7320 6e6f 7420 4e6f  e_list is not No
-00044af0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00044b00: 2020 2020 2020 2020 206c 6973 745f 7265           list_re
-00044b10: 7375 6c74 203d 2063 682e 7368 6f72 746e  sult = ch.shortn
-00044b20: 616d 6520 696e 2073 686f 7274 636f 6465  ame in shortcode
-00044b30: 5f6c 6973 740d 0a20 2020 2020 2020 2020  _list..         
-00044b40: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-00044b50: 6c74 6572 5f69 6e3a 0d0a 2020 2020 2020  lter_in:..      
-00044b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044b70: 2020 646f 5f66 696c 7465 725f 6f75 7420    do_filter_out 
-00044b80: 3d20 206e 6f74 206c 6973 745f 7265 7375  =  not list_resu
-00044b90: 6c74 0d0a 2020 2020 2020 2020 2020 2020  lt..            
-00044ba0: 2020 2020 2020 2020 2020 2020 236c 6f67              #log
-00044bb0: 2e69 6e66 6f28 6368 2e73 686f 7274 6e61  .info(ch.shortna
-00044bc0: 6d65 202b 2027 2027 2b73 7472 2864 6f5f  me + ' '+str(do_
-00044bd0: 6669 6c74 6572 5f6f 7574 292b 7374 7228  filter_out)+str(
-00044be0: 3138 3834 2929 0d0a 2020 2020 2020 2020  1884))..        
-00044bf0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00044c00: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00044c10: 2020 2020 2020 2020 2020 2064 6f5f 6669             do_fi
-00044c20: 6c74 6572 5f6f 7574 203d 2020 6c69 7374  lter_out =  list
-00044c30: 5f72 6573 756c 740d 0a20 2020 2020 2020  _result..       
-00044c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044c50: 2023 6c6f 672e 696e 666f 2863 682e 7368   #log.info(ch.sh
-00044c60: 6f72 746e 616d 6520 2b20 2720 272b 7374  ortname + ' '+st
-00044c70: 7228 646f 5f66 696c 7465 725f 6f75 7429  r(do_filter_out)
-00044c80: 2b73 7472 2831 3838 3629 290d 0a0d 0a20  +str(1886)).... 
-00044c90: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00044ca0: 6620 6669 6c74 6572 5f72 756c 6520 6973  f filter_rule is
-00044cb0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00044cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044cd0: 7275 6c65 5f72 6573 756c 7420 3d20 6669  rule_result = fi
-00044ce0: 6c74 6572 5f72 756c 6528 6368 290d 0a20  lter_rule(ch).. 
-00044cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044d00: 2020 2069 6620 6669 6c74 6572 5f69 6e3a     if filter_in:
-00044d10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00044d20: 2020 2020 2020 2020 2020 646f 5f66 696c            do_fil
-00044d30: 7465 725f 6f75 7420 3d20 6e6f 7420 7275  ter_out = not ru
-00044d40: 6c65 5f72 6573 756c 740d 0a20 2020 2020  le_result..     
-00044d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044d60: 2020 2023 6c6f 672e 696e 666f 2863 682e     #log.info(ch.
-00044d70: 7368 6f72 746e 616d 6520 2b20 2720 272b  shortname + ' '+
-00044d80: 7374 7228 646f 5f66 696c 7465 725f 6f75  str(do_filter_ou
-00044d90: 7429 2b73 7472 2831 3839 3229 290d 0a20  t)+str(1892)).. 
-00044da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044db0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00044dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044dd0: 2020 646f 5f66 696c 7465 725f 6f75 7420    do_filter_out 
-00044de0: 3d20 7275 6c65 5f72 6573 756c 740d 0a20  = rule_result.. 
-00044df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044e00: 2020 2020 2020 2023 6c6f 672e 696e 666f         #log.info
-00044e10: 2863 682e 7368 6f72 746e 616d 6520 2b20  (ch.shortname + 
-00044e20: 2720 272b 7374 7228 646f 5f66 696c 7465  ' '+str(do_filte
-00044e30: 725f 6f75 7429 2b73 7472 2831 3839 3629  r_out)+str(1896)
-00044e40: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00044e50: 2020 2020 2023 4669 6c74 6572 696e 6720       #Filtering 
-00044e60: 7468 6520 6368 696c 6472 656e 2069 7320  the children is 
-00044e70: 646f 6e65 2062 7920 6162 6469 6361 7469  done by abdicati
-00044e80: 6e67 2074 6865 6d2c 2077 6869 6368 206d  ng them, which m
-00044e90: 6561 6e73 2072 656d 6f76 696e 6720 7468  eans removing th
-00044ea0: 656d 2066 726f 6d20 7365 6c66 2028 692e  em from self (i.
-00044eb0: 652e 2074 6865 2063 6869 6c64 2773 2070  e. the child's p
-00044ec0: 6172 656e 7429 2061 6e64 2070 7574 7469  arent) and putti
-00044ed0: 6e67 2063 6869 6c64 7265 6e20 696e 2069  ng children in i
-00044ee0: 7473 2070 6c61 6365 0d0a 2020 2020 2020  ts place..      
-00044ef0: 2020 2020 2020 2020 2020 6966 2064 6f5f            if do_
-00044f00: 6669 6c74 6572 5f6f 7574 3a0d 0a20 2020  filter_out:..   
-00044f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00044f20: 2066 696c 7465 7265 645f 636f 756e 742b   filtered_count+
-00044f30: 3d31 0d0a 2020 2020 2020 2020 2020 2020  =1..            
-00044f40: 2020 2020 2020 2020 236c 6f67 2e69 6e66          #log.inf
-00044f50: 6f28 2761 6264 6963 6174 696e 6720 272b  o('abdicating '+
-00044f60: 7365 6c66 2e73 686f 7274 6e61 6d65 2b27  self.shortname+'
-00044f70: 3a27 2b73 7472 2863 682e 7368 6f72 746e  :'+str(ch.shortn
-00044f80: 616d 6529 290d 0a20 2020 2020 2020 2020  ame))..         
-00044f90: 2020 2020 2020 2020 2020 2063 682e 6162             ch.ab
-00044fa0: 6469 6361 7465 2829 0d0a 0d0a 2020 2020  dicate()....    
-00044fb0: 2020 2020 2353 656c 662e 6368 696c 6472      #Self.childr
-00044fc0: 656e 2068 6173 2062 6565 6e20 6669 6c74  en has been filt
-00044fd0: 6572 6564 206e 6f77 202d 2073 6f20 6669  ered now - so fi
-00044fe0: 6c74 6572 2074 6865 206e 6577 2063 6869  lter the new chi
-00044ff0: 6c64 7265 6e27 7320 6368 696c 6472 656e  ldren's children
-00045000: 0d0a 2020 2020 2020 2020 666f 7220 6368  ..        for ch
-00045010: 2069 6e20 7365 6c66 2e63 6869 6c64 7265   in self.childre
-00045020: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00045030: 6368 2e66 696c 7465 7228 6669 6c74 6572  ch.filter(filter
-00045040: 5f72 756c 6520 3d20 6669 6c74 6572 5f72  _rule = filter_r
-00045050: 756c 652c 7368 6f72 7463 6f64 655f 6c69  ule,shortcode_li
-00045060: 7374 3d73 686f 7274 636f 6465 5f6c 6973  st=shortcode_lis
-00045070: 742c 6669 6c74 6572 5f69 6e20 3d20 6669  t,filter_in = fi
-00045080: 6c74 6572 5f69 6e29 0d0a 0d0a 2020 2020  lter_in)....    
-00045090: 2020 2020 7265 7475 726e 2073 656c 660d      return self.
-000450a0: 0a0d 0a20 2020 2064 6566 2062 7573 6869  ...    def bushi
-000450b0: 6679 2873 656c 662c 6275 7368 6966 795f  fy(self,bushify_
-000450c0: 6164 6469 7469 6f6e 616c 5f72 756c 653d  additional_rule=
-000450d0: 6c61 6d62 6461 2073 653a 5472 7565 293a  lambda se:True):
-000450e0: 0d0a 2020 2020 2020 2020 2727 274d 616b  ..        '''Mak
-000450f0: 6520 7468 6520 7472 6565 2062 7573 6869  e the tree bushi
-00045100: 6572 2061 6e64 206c 6573 7320 7374 7261  er and less stra
-00045110: 6767 6c79 2062 7920 7075 7474 696e 6720  ggly by putting 
-00045120: 7369 6e67 6c65 2063 6869 6c64 7265 6e20  single children 
-00045130: 696e 2070 6c61 6365 206f 6620 7468 6569  in place of thei
-00045140: 7220 7061 7265 6e74 730d 0a0d 0a20 2020  r parents....   
-00045150: 2020 2020 203a 7061 7261 6d20 6275 7368       :param bush
-00045160: 6966 795f 6164 6469 7469 6f6e 616c 5f72  ify_additional_r
-00045170: 756c 653a 2045 7874 7261 2072 756c 6520  ule: Extra rule 
-00045180: 746f 2061 7070 6c79 2074 6f20 6465 6369  to apply to deci
-00045190: 6465 2069 6620 6120 5374 7275 6374 7572  de if a Structur
-000451a0: 6545 6c65 6d65 6e74 2069 7320 656c 696d  eElement is elim
-000451b0: 696e 6174 6564 206f 7220 6e6f 740d 0a20  inated or not.. 
-000451c0: 2020 2020 2020 2065 2e67 2e0d 0a0d 0a20         e.g..... 
-000451d0: 2020 2020 2020 2041 0d0a 2020 2020 2020         A..      
-000451e0: 2020 2b2d 420d 0a20 2020 2020 2020 207c    +-B..        |
-000451f0: 202b 2d43 0d0a 2020 2020 2020 2020 7c20   +-C..        | 
-00045200: 2020 2b2d 440d 0a20 2020 2020 2020 202b    +-D..        +
-00045210: 2d45 0d0a 2020 2020 2020 2020 2020 2b2d  -E..          +-
-00045220: 460d 0a20 2020 2020 2020 2020 202b 2d47  F..          +-G
-00045230: 0d0a 0d0a 2020 2020 2020 2020 6265 636f  ....        beco
-00045240: 6d65 732e 2e2e 0d0a 0d0a 2020 2020 2020  mes.......      
-00045250: 2020 410d 0a20 2020 2020 2020 202b 2d44    A..        +-D
-00045260: 0d0a 2020 2020 2020 2020 2b2d 450d 0a20  ..        +-E.. 
-00045270: 2020 2020 2020 2020 202b 2d46 0d0a 2020           +-F..  
-00045280: 2020 2020 2020 2020 2b2d 470d 0a0d 0a20          +-G.... 
-00045290: 2020 2020 2020 2065 6c69 6d69 6e61 7469         eliminati
-000452a0: 6e67 2074 6865 2075 6e6e 6563 6573 7361  ng the unnecessa
-000452b0: 7279 2074 6f74 616c 2065 6c65 6d65 6e74  ry total element
-000452c0: 7320 4220 616e 6420 430d 0a20 2020 2020  s B and C..     
-000452d0: 2020 2027 2727 0d0a 0d0a 2020 2020 2020     '''....      
-000452e0: 2020 6966 2073 656c 662e 6973 5f6c 6561    if self.is_lea
-000452f0: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
-00045300: 7265 7475 726e 2073 656c 660d 0a0d 0a20  return self.... 
-00045310: 2020 2020 2020 2023 6d61 6b65 2063 6869         #make chi
-00045320: 6c64 7265 6e20 696e 746f 2061 206c 6973  ldren into a lis
-00045330: 7420 6265 6361 7573 6520 7765 2061 7265  t because we are
-00045340: 2061 626f 7574 2074 6f20 6368 616e 6765   about to change
-00045350: 2074 6865 6d0d 0a20 2020 2020 2020 2066   them..        f
-00045360: 6f72 2063 6820 696e 206c 6973 7428 7365  or ch in list(se
-00045370: 6c66 2e63 6869 6c64 7265 6e29 3a0d 0a20  lf.children):.. 
-00045380: 2020 2020 2020 2020 2020 2063 682e 6275             ch.bu
-00045390: 7368 6966 7928 6275 7368 6966 795f 6164  shify(bushify_ad
-000453a0: 6469 7469 6f6e 616c 5f72 756c 653d 6275  ditional_rule=bu
-000453b0: 7368 6966 795f 6164 6469 7469 6f6e 616c  shify_additional
-000453c0: 5f72 756c 6529 0d0a 0d0a 2020 2020 2020  _rule)....      
-000453d0: 2020 2361 6264 6963 6174 6520 2872 656d    #abdicate (rem
-000453e0: 6f76 6520 7365 6c66 2066 726f 6d20 7472  ove self from tr
-000453f0: 6565 2920 6966 2079 6f75 2068 6176 6520  ee) if you have 
-00045400: 6a75 7374 206f 6e65 2063 6869 6c64 2061  just one child a
-00045410: 6e64 2068 6176 6520 6120 7061 7265 6e74  nd have a parent
-00045420: 0d0a 2020 2020 2020 2020 6966 2062 7573  ..        if bus
-00045430: 6869 6679 5f61 6464 6974 696f 6e61 6c5f  hify_additional_
-00045440: 7275 6c65 2873 656c 6629 2061 6e64 206c  rule(self) and l
-00045450: 656e 286c 6973 7428 7365 6c66 2e63 6869  en(list(self.chi
-00045460: 6c64 7265 6e29 2920 3d3d 2031 2061 6e64  ldren)) == 1 and
-00045470: 2073 656c 662e 7061 7265 6e74 2069 7320   self.parent is 
-00045480: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-00045490: 2020 2020 2020 2070 6172 656e 7420 3d20         parent = 
-000454a0: 7365 6c66 2e70 6172 656e 740d 0a20 2020  self.parent..   
-000454b0: 2020 2020 2020 2020 2073 656c 662e 6162           self.ab
-000454c0: 6469 6361 7465 2829 0d0a 2020 2020 2020  dicate()..      
-000454d0: 2020 2020 2020 7265 7475 726e 2070 6172        return par
-000454e0: 656e 740d 0a20 2020 2020 2020 2065 6c73  ent..        els
-000454f0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00045500: 7265 7475 726e 2073 656c 660d 0a0d 0a20  return self.... 
-00045510: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-00045520: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00045530: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00045540: 0d0a 2020 2020 230d 0a20 2020 2023 2044  ..    #..    # D
-00045550: 696d 656e 7369 6f6e 456c 656d 656e 7420  imensionElement 
-00045560: 6d61 6e69 7075 6c61 7469 6f6e 2066 756e  manipulation fun
-00045570: 6374 696f 6e73 0d0a 2020 2020 230d 0a20  ctions..    #.. 
-00045580: 2020 2023 2323 2323 2323 2323 2323 2323     #############
-00045590: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000455a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000455b0: 0d0a 0d0a 2020 2020 6465 6620 636f 6e73  ....    def cons
-000455c0: 6f6c 6964 6174 6528 7365 6c66 293a 0d0a  olidate(self):..
-000455d0: 2020 2020 2020 2020 2727 2743 7265 6174          '''Creat
-000455e0: 6520 6120 636f 6e73 6f6c 6964 6174 696f  e a consolidatio
-000455f0: 6e20 6361 6c63 756c 6174 696f 6e2c 2061  n calculation, a
-00045600: 6e64 2073 6574 2074 6865 2075 6e64 6572  nd set the under
-00045610: 6c79 696e 6720 456c 656d 656e 7427 7320  lying Element's 
-00045620: 6361 6c63 756c 6174 696f 6e20 746f 2074  calculation to t
-00045630: 6865 2073 7061 7273 6520 7375 6d20 6f66  he sparse sum of
-00045640: 2074 6865 2063 6869 6c64 7265 6e0d 0a20   the children.. 
-00045650: 2020 2020 2020 2027 2727 0d0a 0d0a 2020         '''....  
-00045660: 2020 2020 2020 666f 7220 656c 2069 6e20        for el in 
-00045670: 7365 6c66 2e63 6869 6c64 7265 6e3a 0d0a  self.children:..
-00045680: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-00045690: 6c2e 7068 7973 6964 2069 7320 4e6f 6e65  l.physid is None
-000456a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000456b0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-000456c0: 726f 7228 272e 636f 6e73 6f6c 6964 6174  ror('.consolidat
-000456d0: 6520 6361 6e6e 6f74 2062 6520 7275 6e20  e cannot be run 
-000456e0: 756e 7469 6c20 6368 696c 6420 7068 7973  until child phys
-000456f0: 6964 7320 6861 7665 2062 6565 6e20 7365  ids have been se
-00045700: 7427 290d 0a0d 0a20 2020 2020 2020 2063  t')....        c
-00045710: 6f6e 736f 6c69 6461 7469 6f6e 5f63 616c  onsolidation_cal
-00045720: 6375 6c61 7469 6f6e 5f73 7472 696e 6720  culation_string 
-00045730: 3d20 2720 7c20 272e 6a6f 696e 285b 7374  = ' | '.join([st
-00045740: 7228 656c 2e73 686f 7274 6e61 6d65 2920  r(el.shortname) 
-00045750: 666f 7220 656c 2069 6e20 7365 6c66 2e63  for el in self.c
-00045760: 6869 6c64 7265 6e5d 290d 0a20 2020 2020  hildren])..     
-00045770: 2020 2023 4372 6561 7465 2061 2070 6879     #Create a phy
-00045780: 7369 6420 6361 6c63 756c 6174 696f 6e20  sid calculation 
-00045790: 2d20 7765 2063 616e 2774 2075 706c 6f61  - we can't uploa
-000457a0: 6420 7468 6973 2c20 6275 7420 7765 2063  d this, but we c
-000457b0: 616e 2063 6f6d 7061 7265 2074 6f20 7468  an compare to th
-000457c0: 6520 456d 706f 7765 7220 7665 7273 696f  e Empower versio
-000457d0: 6e2c 2074 6f20 7374 6f70 2075 6e6e 6563  n, to stop unnec
-000457e0: 6573 7361 7279 2063 616c 6375 6c61 7469  essary calculati
-000457f0: 6f6e 2075 7064 6174 6573 0d0a 2020 2020  on updates..    
-00045800: 2020 2020 7068 7973 6964 5f63 6f6e 736f      physid_conso
-00045810: 6c69 6461 7469 6f6e 5f63 616c 6375 6c61  lidation_calcula
-00045820: 7469 6f6e 5f73 7472 696e 6720 3d20 2720  tion_string = ' 
-00045830: 7c20 272e 6a6f 696e 285b 2740 272b 7374  | '.join(['@'+st
-00045840: 7228 656c 2e70 6879 7369 6429 2066 6f72  r(el.physid) for
-00045850: 2065 6c20 696e 2073 656c 662e 6368 696c   el in self.chil
-00045860: 6472 656e 5d29 0d0a 0d0a 2020 2020 2020  dren])....      
-00045870: 2020 2353 6574 2074 6865 2070 6879 7369    #Set the physi
-00045880: 6420 6361 6c63 756c 6174 696f 6e20 7374  d calculation st
-00045890: 7269 6e67 2c20 7768 6963 6820 7769 6c6c  ring, which will
-000458a0: 2062 6520 7468 6520 6f6e 6520 7468 6174   be the one that
-000458b0: 2045 6d70 6f77 6572 2065 7870 6f72 7473   Empower exports
-000458c0: 2d20 7468 6973 2077 6173 7920 7765 2064  - this wasy we d
-000458d0: 6f6e 2774 2068 6176 6520 746f 2074 7269  on't have to tri
-000458e0: 6767 6572 2061 6e20 7570 6461 7465 0d0a  gger an update..
-000458f0: 2020 2020 2020 2020 2369 6620 7468 650d          #if the.
-00045900: 0a20 2020 2020 2020 2073 656c 662e 656c  .        self.el
-00045910: 656d 656e 742e 5f70 6879 7369 645f 6361  ement._physid_ca
-00045920: 6c63 756c 6174 696f 6e20 3d20 7068 7973  lculation = phys
-00045930: 6964 5f63 6f6e 736f 6c69 6461 7469 6f6e  id_consolidation
-00045940: 5f63 616c 6375 6c61 7469 6f6e 5f73 7472  _calculation_str
-00045950: 696e 670d 0a20 2020 2020 2020 2073 656c  ing..        sel
-00045960: 662e 656c 656d 656e 742e 6361 6c63 756c  f.element.calcul
-00045970: 6174 696f 6e20 3d20 636f 6e73 6f6c 6964  ation = consolid
-00045980: 6174 696f 6e5f 6361 6c63 756c 6174 696f  ation_calculatio
-00045990: 6e5f 7374 7269 6e67 0d0a 0d0a 0d0a 2020  n_string......  
-000459a0: 2020 6465 6620 7472 6963 6b6c 655f 646f    def trickle_do
-000459b0: 776e 5f66 6965 6c64 2873 656c 662c 6669  wn_field(self,fi
-000459c0: 656c 646e 616d 652c 7661 6c75 6529 3a0d  eldname,value):.
-000459d0: 0a20 2020 2020 2020 2027 2727 5365 7420  .        '''Set 
-000459e0: 7468 6520 7661 6c75 6520 6f66 2061 2066  the value of a f
-000459f0: 6965 6c64 206f 6e20 7468 6973 2053 7472  ield on this Str
-00045a00: 7563 7475 7265 456c 656d 656e 7420 616e  uctureElement an
-00045a10: 6420 616c 6c20 6974 7320 6465 7363 656e  d all its descen
-00045a20: 6465 6e74 730d 0a0d 0a20 2020 2020 2020  dents....       
-00045a30: 203a 7061 7261 6d20 6669 656c 646e 616d   :param fieldnam
-00045a40: 653a 204e 616d 6520 6f66 2074 6865 2045  e: Name of the E
-00045a50: 6c65 6d65 6e74 2066 6965 6c64 2074 6861  lement field tha
-00045a60: 7420 7765 2077 616e 7420 746f 2073 6574  t we want to set
-00045a70: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00045a80: 2076 616c 7565 3a20 5661 6c75 6520 7765   value: Value we
-00045a90: 2077 616e 7420 746f 2073 6574 2074 6865   want to set the
-00045aa0: 2065 6c65 6d65 6e74 2066 6965 6c64 2074   element field t
-00045ab0: 6f0d 0a20 2020 2020 2020 2027 2727 0d0a  o..        '''..
-00045ac0: 2020 2020 2020 2020 666f 7220 6368 2069          for ch i
-00045ad0: 6e20 7365 6c66 2e63 6869 6c64 7265 6e3a  n self.children:
-00045ae0: 0d0a 2020 2020 2020 2020 2020 2020 6368  ..            ch
-00045af0: 2e65 6c65 6d65 6e74 2e66 6965 6c64 735b  .element.fields[
-00045b00: 6669 656c 646e 616d 655d 203d 2076 616c  fieldname] = val
-00045b10: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00045b20: 6368 2e74 7269 636b 6c65 5f64 6f77 6e5f  ch.trickle_down_
-00045b30: 6669 656c 6428 6669 656c 646e 616d 653d  field(fieldname=
-00045b40: 6669 656c 646e 616d 652c 7661 6c75 653d  fieldname,value=
-00045b50: 7661 6c75 6529 0d0a 0d0a 2020 2020 234f  value)....    #O
-00045b60: 6c64 2073 796e 6f6e 796d 0d0a 2020 2020  ld synonym..    
-00045b70: 6465 6620 7472 6963 6b6c 655f 646f 776e  def trickle_down
-00045b80: 5f66 6965 6c64 7328 7365 6c66 2c66 6965  _fields(self,fie
-00045b90: 6c64 6e61 6d65 2c76 616c 7565 293a 0d0a  ldname,value):..
-00045ba0: 2020 2020 2020 2020 2727 2744 6570 7265          '''Depre
-00045bb0: 6361 7465 642e 2055 7365 2074 7269 636b  cated. Use trick
-00045bc0: 6c65 5f64 6f77 6e5f 6669 656c 6428 2920  le_down_field() 
-00045bd0: 696e 7374 6561 6427 2727 0d0a 2020 2020  instead'''..    
-00045be0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00045bf0: 7472 6963 6b6c 655f 646f 776e 5f66 6965  trickle_down_fie
-00045c00: 6c64 2866 6965 6c64 6e61 6d65 2c76 616c  ld(fieldname,val
-00045c10: 7565 290d 0a0d 0a20 2020 2064 6566 205f  ue)....    def _
-00045c20: 646f 5f73 696e 676c 655f 736c 7572 7028  do_single_slurp(
-00045c30: 7365 6c66 2c66 6965 6c64 6e61 6d65 2c6f  self,fieldname,o
-00045c40: 7074 696d 6973 6174 696f 6e5f 6c6f 6f6b  ptimisation_look
-00045c50: 7570 293a 0d0a 2020 2020 2020 2020 6966  up):..        if
-00045c60: 206e 6f74 2073 656c 662e 6973 5f6c 6561   not self.is_lea
-00045c70: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
-00045c80: 2370 7269 6e74 2827 536c 7572 7069 6e67  #print('Slurping
-00045c90: 2043 6869 6c64 7265 6e27 290d 0a20 2020   Children')..   
-00045ca0: 2020 2020 2020 2020 2063 6869 6c64 6669           childfi
-00045cb0: 656c 6473 203d 205b 6368 2e73 6c75 7270  elds = [ch.slurp
-00045cc0: 5f75 705f 6669 656c 6428 6669 656c 646e  _up_field(fieldn
-00045cd0: 616d 653d 6669 656c 646e 616d 652c 6f70  ame=fieldname,op
-00045ce0: 7469 6d69 7361 7469 6f6e 5f6c 6f6f 6b75  timisation_looku
-00045cf0: 703d 6f70 7469 6d69 7361 7469 6f6e 5f6c  p=optimisation_l
-00045d00: 6f6f 6b75 7029 2066 6f72 2063 6820 696e  ookup) for ch in
-00045d10: 2073 656c 662e 6368 696c 6472 656e 5d0d   self.children].
-00045d20: 0a20 2020 2020 2020 2020 2020 2023 2346  .            ##F
-00045d30: 696c 7465 7220 6669 656c 6473 2073 6574  ilter fields set
-00045d40: 2074 6f20 4e6f 6e65 0d0a 2020 2020 2020   to None..      
-00045d50: 2020 2020 2020 2363 6869 6c64 6669 656c        #childfiel
-00045d60: 6473 203d 205b 736c 7572 705f 6368 696c  ds = [slurp_chil
-00045d70: 6466 6965 6c64 2066 6f72 2073 6c75 7270  dfield for slurp
-00045d80: 5f63 6869 6c64 6669 656c 6420 696e 2063  _childfield in c
-00045d90: 6869 6c64 6669 656c 6473 2069 6620 736c  hildfields if sl
-00045da0: 7572 705f 6368 696c 6466 6965 6c64 2069  urp_childfield i
-00045db0: 7320 6e6f 7420 4e6f 6e65 5d0d 0a20 2020  s not None]..   
-00045dc0: 2020 2020 2020 2020 2023 5265 7475 726e           #Return
-00045dd0: 204e 6f6e 6520 6966 2066 6965 6c64 2076   None if field v
-00045de0: 616c 7565 7320 696e 2063 6869 6c64 7265  alues in childre
-00045df0: 6e20 646f 6e27 7420 6d61 7463 680d 0a20  n don't match.. 
-00045e00: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00045e10: 6e28 7365 7428 6368 696c 6466 6965 6c64  n(set(childfield
-00045e20: 7329 2920 3d3d 2031 3a0d 0a20 2020 2020  s)) == 1:..     
-00045e30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00045e40: 6669 656c 6473 5b66 6965 6c64 6e61 6d65  fields[fieldname
-00045e50: 5d20 3d20 6368 696c 6466 6965 6c64 735b  ] = childfields[
-00045e60: 305d 0d0a 2020 2020 2020 2020 2020 2020  0]..            
-00045e70: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00045e80: 2020 2020 2020 2073 656c 662e 6669 656c         self.fiel
-00045e90: 6473 5b66 6965 6c64 6e61 6d65 5d20 3d20  ds[fieldname] = 
-00045ea0: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
-00045eb0: 2020 2020 2369 6620 7365 6c66 2e73 686f      #if self.sho
-00045ec0: 7274 636f 6465 2069 6e20 5b27 4f4e 554b  rtcode in ['ONUK
-00045ed0: 4327 2c27 4f4e 4456 4127 2c27 4f4e 5348  C','ONDVA','ONSH
-00045ee0: 4249 275d 3a0d 0a20 2020 2020 2020 2020  BI']:..         
-00045ef0: 2020 2023 2020 2020 7072 696e 7428 2753     #    print('S
-00045f00: 4554 5449 4e47 3a20 2027 2c73 656c 662e  ETTING:  ',self.
-00045f10: 616e 6365 7374 6f72 735f 7374 7269 6e67  ancestors_string
-00045f20: 2c73 656c 662e 6669 656c 6473 5b66 6965  ,self.fields[fie
-00045f30: 6c64 6e61 6d65 5d29 0d0a 0d0a 2020 2020  ldname])....    
-00045f40: 2020 2020 2369 6620 7365 6c66 2e73 686f      #if self.sho
-00045f50: 7274 636f 6465 2069 6e20 5b27 4f4e 554b  rtcode in ['ONUK
-00045f60: 4327 2c27 4f4e 4456 4127 2c27 4f4e 5348  C','ONDVA','ONSH
-00045f70: 4249 275d 3a0d 0a20 2020 2020 2020 2023  BI']:..        #
-00045f80: 2020 2020 7072 696e 7428 2753 4554 3a20      print('SET: 
-00045f90: 2027 2c73 656c 662e 616e 6365 7374 6f72   ',self.ancestor
-00045fa0: 735f 7374 7269 6e67 2c73 656c 662e 6669  s_string,self.fi
-00045fb0: 656c 6473 5b66 6965 6c64 6e61 6d65 5d29  elds[fieldname])
-00045fc0: 0d0a 0d0a 0d0a 2020 2020 6465 6620 736c  ......    def sl
-00045fd0: 7572 705f 7570 5f66 6965 6c64 2873 656c  urp_up_field(sel
-00045fe0: 662c 6669 656c 646e 616d 652c 6f70 7469  f,fieldname,opti
-00045ff0: 6d69 7361 7469 6f6e 5f6c 6f6f 6b75 703d  misation_lookup=
-00046000: 7b7d 293a 0d0a 2020 2020 2020 2020 2727  {}):..        ''
-00046010: 2746 726f 6d20 7468 6520 6c65 6176 6573  'From the leaves
-00046020: 206f 6620 6120 5374 7275 6374 7572 6545   of a StructureE
-00046030: 6c65 6d65 6e74 2074 6f20 7468 6174 2053  lement to that S
-00046040: 7472 7563 7475 7265 456c 656d 656e 742c  tructureElement,
-00046050: 2063 6f70 7920 7468 6520 7661 6c75 6520   copy the value 
-00046060: 696e 2074 6865 2063 6869 6c64 7265 6e27  in the children'
-00046070: 7320 6669 656c 6420 746f 2074 6865 2070  s field to the p
-00046080: 6172 656e 7420 5374 7275 6374 7572 6545  arent StructureE
-00046090: 6c65 6d65 6e74 2773 2066 6965 6c64 2c20  lement's field, 
-000460a0: 6966 2061 6e64 206f 6e6c 7920 6966 2061  if and only if a
-000460b0: 6c6c 206f 6620 7468 6520 6669 656c 6473  ll of the fields
-000460c0: 206f 6e20 7468 6520 6368 696c 6472 656e   on the children
-000460d0: 206d 6174 6368 2e0d 0a0d 0a20 2020 2020   match.....     
-000460e0: 2020 203a 6669 656c 646e 616d 653a 2054     :fieldname: T
-000460f0: 6865 206e 616d 6520 6f66 2074 6865 2066  he name of the f
-00046100: 6965 6c64 2077 686f 7320 7661 6c75 6573  ield whos values
-00046110: 2077 6520 7761 6e74 2063 6f70 6965 6420   we want copied 
-00046120: 7570 2074 6865 2053 7472 7563 7475 7265  up the Structure
-00046130: 0d0a 2020 2020 2020 2020 2727 270d 0a20  ..        '''.. 
-00046140: 2020 2020 2020 2069 6620 6f70 7469 6d69         if optimi
-00046150: 7361 7469 6f6e 5f6c 6f6f 6b75 7020 6973  sation_lookup is
-00046160: 206e 6f74 204e 6f6e 653a 0d0a 0d0a 2020   not None:....  
-00046170: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-00046180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046190: 2369 6620 7365 6c66 2e73 686f 7274 636f  #if self.shortco
-000461a0: 6465 2069 6e20 5b27 4f4e 554b 4327 2c27  de in ['ONUKC','
-000461b0: 4f4e 4456 4127 2c27 4f4e 5348 4249 275d  ONDVA','ONSHBI']
-000461c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000461d0: 2020 2023 2020 2020 7072 696e 7428 2750     #    print('P
-000461e0: 4154 483a 2027 2c73 656c 662e 7061 7468  ATH: ',self.path
-000461f0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00046200: 2020 2023 6966 2073 656c 662e 7368 6f72     #if self.shor
-00046210: 7463 6f64 6520 696e 205b 274f 4e55 4b43  tcode in ['ONUKC
-00046220: 272c 274f 4e44 5641 272c 274f 4e53 4842  ','ONDVA','ONSHB
-00046230: 4927 5d3a 0d0a 2020 2020 2020 2020 2020  I']:..          
-00046240: 2020 2020 2020 2320 2020 2070 7269 6e74        #    print
-00046250: 2827 5452 593a 2020 272c 7365 6c66 2e61  ('TRY:  ',self.a
-00046260: 6e63 6573 746f 7273 5f73 7472 696e 6729  ncestors_string)
-00046270: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00046280: 2020 7265 7476 616c 203d 206f 7074 696d    retval = optim
-00046290: 6973 6174 696f 6e5f 6c6f 6f6b 7570 5b73  isation_lookup[s
-000462a0: 656c 662e 7061 7468 5d0d 0a20 2020 2020  elf.path]..     
-000462b0: 2020 2020 2020 2020 2020 2023 6966 2073             #if s
-000462c0: 656c 662e 7368 6f72 7463 6f64 6520 696e  elf.shortcode in
-000462d0: 205b 274f 4e55 4b43 272c 274f 4e44 5641   ['ONUKC','ONDVA
-000462e0: 272c 274f 4e53 4842 4927 5d3a 0d0a 2020  ','ONSHBI']:..  
-000462f0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00046300: 2020 2070 7269 6e74 2827 4c4b 503a 2020     print('LKP:  
-00046310: 272c 7365 6c66 2e61 6e63 6573 746f 7273  ',self.ancestors
-00046320: 5f73 7472 696e 672c 7265 7476 616c 290d  _string,retval).
-00046330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046340: 2072 6574 7572 6e20 7265 7476 616c 0d0a   return retval..
-00046350: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-00046360: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
-00046370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046380: 2370 7269 6e74 2827 7b7d 2069 736c 6561  #print('{} islea
-00046390: 6620 7b7d 272e 666f 726d 6174 2873 656c  f {}'.format(sel
-000463a0: 662e 7368 6f72 7463 6f64 652c 2020 7365  f.shortcode,  se
-000463b0: 6c66 2e69 735f 6c65 6166 2929 0d0a 2020  lf.is_leaf))..  
-000463c0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000463d0: 6c66 2e5f 646f 5f73 696e 676c 655f 736c  lf._do_single_sl
-000463e0: 7572 7028 6669 656c 646e 616d 652c 6f70  urp(fieldname,op
-000463f0: 7469 6d69 7361 7469 6f6e 5f6c 6f6f 6b75  timisation_looku
-00046400: 7029 0d0a 2020 2020 2020 2020 2020 2020  p)..            
-00046410: 2020 2020 2369 6620 7365 6c66 2e73 686f      #if self.sho
-00046420: 7274 636f 6465 2069 6e20 5b27 4f4e 554b  rtcode in ['ONUK
-00046430: 4327 2c27 4f4e 4456 4127 2c27 4f4e 5348  C','ONDVA','ONSH
-00046440: 4249 275d 3a0d 0a20 2020 2020 2020 2020  BI']:..         
-00046450: 2020 2020 2020 2023 2020 2020 7072 696e         #    prin
-00046460: 7428 2753 4c52 503a 2027 2c73 656c 662e  t('SLRP: ',self.
-00046470: 616e 6365 7374 6f72 735f 7374 7269 6e67  ancestors_string
-00046480: 2c73 656c 662e 6669 656c 6473 5b66 6965  ,self.fields[fie
-00046490: 6c64 6e61 6d65 5d29 0d0a 2020 2020 2020  ldname])..      
-000464a0: 2020 2020 2020 2020 2020 6f70 7469 6d69            optimi
-000464b0: 7361 7469 6f6e 5f6c 6f6f 6b75 705b 7365  sation_lookup[se
-000464c0: 6c66 2e70 6174 685d 203d 2073 656c 662e  lf.path] = self.
-000464d0: 6669 656c 6473 5b66 6965 6c64 6e61 6d65  fields[fieldname
-000464e0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
-000464f0: 2020 2072 6574 7572 6e20 7365 6c66 2e66     return self.f
-00046500: 6965 6c64 735b 6669 656c 646e 616d 655d  ields[fieldname]
-00046510: 0d0a 0d0a 2020 2020 2020 2020 656c 7365  ....        else
-00046520: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-00046530: 656c 662e 5f64 6f5f 7369 6e67 6c65 5f73  elf._do_single_s
-00046540: 6c75 7270 2866 6965 6c64 6e61 6d65 2c6f  lurp(fieldname,o
-00046550: 7074 696d 6973 6174 696f 6e5f 6c6f 6f6b  ptimisation_look
-00046560: 7570 290d 0a20 2020 2020 2020 2020 2020  up)..           
-00046570: 2023 6966 2073 656c 662e 7368 6f72 7463   #if self.shortc
-00046580: 6f64 6520 696e 205b 274f 4e55 4b43 272c  ode in ['ONUKC',
-00046590: 274f 4e44 5641 272c 274f 4e53 4842 4927  'ONDVA','ONSHBI'
-000465a0: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-000465b0: 2320 2020 2070 7269 6e74 2827 534c 5250  #    print('SLRP
-000465c0: 3a20 272c 7365 6c66 2e61 6e63 6573 746f  : ',self.ancesto
-000465d0: 7273 5f73 7472 696e 672c 7365 6c66 2e66  rs_string,self.f
-000465e0: 6965 6c64 735b 6669 656c 646e 616d 655d  ields[fieldname]
-000465f0: 290d 0a20 2020 2020 2020 2020 2020 2072  )..            r
-00046600: 6574 7572 6e20 7365 6c66 2e66 6965 6c64  eturn self.field
-00046610: 735b 6669 656c 646e 616d 655d 0d0a 0d0a  s[fieldname]....
-00046620: 2020 2020 2323 2323 2323 2323 2323 2323      ############
-00046630: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00046640: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00046650: 230d 0a20 2020 2023 0d0a 2020 2020 2320  #..    #..    # 
-00046660: 436f 6d70 6172 6973 6f6e 0d0a 2020 2020  Comparison..    
-00046670: 230d 0a20 2020 2023 2323 2323 2323 2323  #..    #########
-00046680: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00046690: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000466a0: 2323 2323 0d0a 0d0a 2020 2020 6465 6620  ####....    def 
-000466b0: 636f 6d70 6172 6528 7365 6c66 2c6f 7468  compare(self,oth
-000466c0: 6572 2c73 686f 7274 636f 6465 5f74 7261  er,shortcode_tra
-000466d0: 6e73 6c61 7469 6f6e 733d 4e6f 6e65 2c72  nslations=None,r
-000466e0: 6576 6572 7365 5f74 7261 6e73 6c61 7469  everse_translati
-000466f0: 6f6e 733d 4e6f 6e65 293a 0d0a 2020 2020  ons=None):..    
-00046700: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
-00046710: 2043 6f6d 7061 7265 2074 6869 7320 5374   Compare this St
-00046720: 7275 6374 7572 6545 6c65 6d65 6e74 2074  ructureElement t
-00046730: 6f20 616e 6f74 6865 722c 2065 7373 656e  o another, essen
-00046740: 7469 616c 6c79 2064 6f69 6e67 2061 2064  tially doing a d
-00046750: 6966 660d 0a20 2020 2020 2020 2041 6c73  iff..        Als
-00046760: 6f20 6765 7420 6120 6c69 7374 206f 6620  o get a list of 
-00046770: 6e65 772c 206d 6f76 6564 2061 6e64 2072  new, moved and r
-00046780: 656d 6f76 6564 2065 6c65 6d65 6e74 730d  emoved elements.
-00046790: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
-000467a0: 6e20 6120 5374 7275 6374 7572 6545 6c65  n a StructureEle
-000467b0: 6d65 6e74 436f 6d70 6172 6973 6f6e 206f  mentComparison o
-000467c0: 626a 6563 740d 0a0d 0a20 2020 2020 2020  bject....       
-000467d0: 203a 7061 7261 6d20 6f74 6865 723a 2053   :param other: S
-000467e0: 7472 7563 7475 7265 456c 656d 656e 7420  tructureElement 
-000467f0: 746f 2063 6f6d 7061 7265 2073 656c 6620  to compare self 
-00046800: 746f 0d0a 2020 2020 2020 2020 3a70 6172  to..        :par
-00046810: 616d 2073 686f 7274 636f 6465 5f74 7261  am shortcode_tra
-00046820: 6e73 6c61 7469 6f6e 733a 2064 6963 7469  nslations: dicti
-00046830: 6f6e 6172 7920 666f 7220 7472 616e 736c  onary for transl
-00046840: 6174 696e 6720 7368 6f72 7463 6f64 6573  ating shortcodes
-00046850: 206f 6620 226f 7468 6572 2220 7374 7275   of "other" stru
-00046860: 6374 7572 6520 656c 656d 656e 7473 2074  cture elements t
-00046870: 6f20 7368 6f72 7463 6f64 6573 206f 6620  o shortcodes of 
-00046880: 2273 656c 6622 2073 7472 7563 7475 7265  "self" structure
-00046890: 2065 6c65 6d65 6e74 732c 2073 6f20 7468   elements, so th
-000468a0: 6174 2073 696d 696c 6172 2068 6965 7261  at similar hiera
-000468b0: 7263 6869 6573 2063 616e 2062 6520 636f  rchies can be co
-000468c0: 6d70 6172 6564 2065 6666 6963 6965 6e74  mpared efficient
-000468d0: 6c79 0d0a 2020 2020 2020 2020 3a70 6172  ly..        :par
-000468e0: 616d 2072 6576 6572 7365 5f74 7261 6e73  am reverse_trans
-000468f0: 6c61 7469 6f6e 733a 2059 6f75 2073 686f  lations: You sho
-00046900: 756c 646e 2774 206e 6565 6420 746f 2073  uldn't need to s
-00046910: 7065 6369 6679 2074 6869 732e 2049 7420  pecify this. It 
-00046920: 6578 6973 7473 2073 6f20 7468 6174 2077  exists so that w
-00046930: 6520 646f 6e27 7420 6861 7665 2074 6f20  e don't have to 
-00046940: 6361 6c63 756c 6174 6520 7468 6520 7265  calculate the re
-00046950: 7665 7273 6520 7472 616e 736c 6174 696f  verse translatio
-00046960: 6e20 666f 7220 6576 6572 7920 5f72 6563  n for every _rec
-00046970: 7572 7369 7665 5f20 6361 6c6c 206f 6620  ursive_ call of 
-00046980: 7468 6973 2066 756e 6374 696f 6e0d 0a20  this function.. 
-00046990: 2020 2020 2020 2027 2727 0d0a 0d0a 2020         '''....  
-000469a0: 2020 2020 2020 6966 2073 686f 7274 636f        if shortco
-000469b0: 6465 5f74 7261 6e73 6c61 7469 6f6e 7320  de_translations 
-000469c0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-000469d0: 2020 2020 2020 7368 6f72 7463 6f64 655f        shortcode_
-000469e0: 7472 616e 736c 6174 696f 6e73 203d 207b  translations = {
-000469f0: 7d0d 0a0d 0a20 2020 2020 2020 2023 4173  }....        #As
-00046a00: 2061 6e20 6164 6465 6e64 756d 2074 6f20   an addendum to 
-00046a10: 7468 6520 6469 6666 206c 6f6f 6b20 666f  the diff look fo
-00046a20: 720d 0a20 2020 2020 2020 2023 202b 204e  r..        # + N
-00046a30: 6577 2045 6c65 6d65 6e74 7320 286c 6561  ew Elements (lea
-00046a40: 6620 616e 6420 6e6f 6e2d 6c65 6166 290d  f and non-leaf).
-00046a50: 0a20 2020 2020 2020 2023 202b 206d 6f76  .        # + mov
-00046a60: 6564 2065 6c65 6d65 6e74 7328 2920 2d20  ed elements() - 
-00046a70: 7765 206d 6179 206e 6565 6420 7468 6520  we may need the 
-00046a80: 6469 6666 2074 6f20 6765 7420 7468 6973  diff to get this
-00046a90: 2072 6967 6874 0d0a 2020 2020 2020 2020   right..        
-00046aa0: 2320 2b20 5265 6d6f 7665 6420 456c 656d  # + Removed Elem
-00046ab0: 656e 7473 2028 6c65 6166 2061 6e64 206e  ents (leaf and n
-00046ac0: 6f6e 2d6c 6561 6629 0d0a 0d0a 2020 2020  on-leaf)....    
-00046ad0: 2020 2020 7365 6c66 5f65 6c65 6d65 6e74      self_element
-00046ae0: 5f6c 6f6f 6b75 7020 203d 207b 7d0d 0a20  _lookup  = {}.. 
-00046af0: 2020 2020 2020 206f 7468 6572 5f65 6c65         other_ele
-00046b00: 6d65 6e74 5f6c 6f6f 6b75 7020 3d20 7b7d  ment_lookup = {}
-00046b10: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
-00046b20: 7365 2069 6e20 7365 6c66 2e77 616c 6b28  se in self.walk(
-00046b30: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00046b40: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-00046b50: 2020 2020 2020 7365 6c66 5f65 6c65 6d65        self_eleme
-00046b60: 6e74 5f6c 6f6f 6b75 705b 7365 2e73 686f  nt_lookup[se.sho
-00046b70: 7274 636f 6465 5d2e 6170 7065 6e64 2873  rtcode].append(s
-00046b80: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00046b90: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
-00046ba0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00046bb0: 2020 7365 6c66 5f65 6c65 6d65 6e74 5f6c    self_element_l
-00046bc0: 6f6f 6b75 705b 7365 2e73 686f 7274 636f  ookup[se.shortco
-00046bd0: 6465 5d20 3d20 5b73 655d 0d0a 0d0a 2020  de] = [se]....  
-00046be0: 2020 2020 2020 666f 7220 7365 2069 6e20        for se in 
-00046bf0: 6f74 6865 722e 7761 6c6b 2829 3a0d 0a20  other.walk():.. 
-00046c00: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
-00046c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00046c20: 206f 7468 6572 5f65 6c65 6d65 6e74 5f6c   other_element_l
-00046c30: 6f6f 6b75 705b 7365 2e73 686f 7274 636f  ookup[se.shortco
-00046c40: 6465 5d2e 6170 7065 6e64 2873 6529 0d0a  de].append(se)..
-00046c50: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00046c60: 7074 204b 6579 4572 726f 723a 0d0a 2020  pt KeyError:..  
-00046c70: 2020 2020 2020 2020 2020 2020 2020 6f74                ot
-00046c80: 6865 725f 656c 656d 656e 745f 6c6f 6f6b  her_element_look
-00046c90: 7570 5b73 652e 7368 6f72 7463 6f64 655d  up[se.shortcode]
-00046ca0: 203d 205b 7365 5d0d 0a0d 0a20 2020 2020   = [se]....     
-00046cb0: 2020 206e 6577 5f65 6c65 6d65 6e74 7320     new_elements 
-00046cc0: 3d20 5b5d 0d0a 2020 2020 2020 2020 6d6f  = []..        mo
-00046cd0: 7665 645f 6f72 5f72 656d 6f76 6564 5f65  ved_or_removed_e
-00046ce0: 6c65 6d65 6e74 7320 3d20 5b5d 0d0a 2020  lements = []..  
-00046cf0: 2020 2020 2020 7265 6d6f 7665 645f 656c        removed_el
-00046d00: 656d 656e 7473 203d 205b 5d0d 0a0d 0a20  ements = [].... 
-00046d10: 2020 2020 2020 2069 6620 7265 7665 7273         if revers
-00046d20: 655f 7472 616e 736c 6174 696f 6e73 2069  e_translations i
-00046d30: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-00046d40: 2020 2020 2023 4c6f 6f6b 2075 7020 746f       #Look up to
-00046d50: 2073 6565 2069 6620 656c 656d 656e 7473   see if elements
-00046d60: 2077 6974 6820 7468 6520 7368 6f72 7463   with the shortc
-00046d70: 6f64 6520 696e 2074 6869 7320 5374 7275  ode in this Stru
-00046d80: 6374 7572 6545 6c65 6d65 6e74 2065 7869  ctureElement exi
-00046d90: 7374 2069 6e20 7468 6520 6f74 6865 7220  st in the other 
-00046da0: 7374 7275 6374 7572 6520 656c 656d 656e  structure elemen
-00046db0: 740d 0a20 2020 2020 2020 2020 2020 2066  t..            f
-00046dc0: 6f72 2073 656c 665f 7368 6f72 7463 6f64  or self_shortcod
-00046dd0: 652c 2065 6c65 6d65 6e74 735f 7769 7468  e, elements_with
-00046de0: 5f73 686f 7274 636f 6465 2069 6e20 7365  _shortcode in se
-00046df0: 6c66 5f65 6c65 6d65 6e74 5f6c 6f6f 6b75  lf_element_looku
-00046e00: 702e 6974 656d 7328 293a 0d0a 2020 2020  p.items():..    
-00046e10: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00046e20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00046e30: 2020 2020 2020 6f74 6865 725f 656c 656d        other_elem
-00046e40: 656e 7473 203d 206f 7468 6572 5f65 6c65  ents = other_ele
-00046e50: 6d65 6e74 5f6c 6f6f 6b75 705b 7365 6c66  ment_lookup[self
-00046e60: 5f73 686f 7274 636f 6465 5d0d 0a20 2020  _shortcode]..   
-00046e70: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00046e80: 6570 7420 4b65 7945 7272 6f72 3a0d 0a20  ept KeyError:.. 
-00046e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046ea0: 2020 2072 656d 6f76 6564 5f65 6c65 6d65     removed_eleme
-00046eb0: 6e74 7320 2b3d 2065 6c65 6d65 6e74 735f  nts += elements_
-00046ec0: 7769 7468 5f73 686f 7274 636f 6465 0d0a  with_shortcode..
-00046ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00046ee0: 2020 2020 636f 6e74 696e 7565 0d0a 2020      continue..  
-00046ef0: 2020 2020 2020 2020 2020 2020 2020 2349                #I
-00046f00: 6620 7468 6579 2065 7869 7374 2c20 7365  f they exist, se
-00046f10: 6520 6966 2074 6865 7927 7665 206d 6f76  e if they've mov
-00046f20: 6564 2c20 6f72 2069 6620 7468 6572 6520  ed, or if there 
-00046f30: 6172 6520 6d6f 7265 2077 6974 6820 7468  are more with th
-00046f40: 6520 7361 6d65 2073 686f 7274 636f 6465  e same shortcode
-00046f50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00046f60: 2020 2346 6972 7374 2063 7265 6174 6520    #First create 
-00046f70: 6c6f 6f6b 7570 7320 666f 7220 7061 7265  lookups for pare
-00046f80: 6e74 2073 686f 7274 636f 6465 730d 0a20  nt shortcodes.. 
-00046f90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00046fa0: 656c 665f 656c 5f70 6172 656e 745f 7363  elf_el_parent_sc
-00046fb0: 5f73 655f 6c6f 6f6b 7570 203d 207b 7365  _se_lookup = {se
-00046fc0: 2e70 6172 656e 742e 7368 6f72 7463 6f64  .parent.shortcod
-00046fd0: 653a 7365 2066 6f72 2073 6520 696e 2065  e:se for se in e
-00046fe0: 6c65 6d65 6e74 735f 7769 7468 5f73 686f  lements_with_sho
-00046ff0: 7274 636f 6465 2069 6620 7365 2e70 6172  rtcode if se.par
-00047000: 656e 747d 0d0a 2020 2020 2020 2020 2020  ent}..          
-00047010: 2020 2020 2020 6f74 6865 725f 656c 5f70        other_el_p
-00047020: 6172 656e 745f 7363 5f73 655f 6c6f 6f6b  arent_sc_se_look
-00047030: 7570 203d 207b 7365 2e70 6172 656e 742e  up = {se.parent.
-00047040: 7368 6f72 7463 6f64 653a 7365 2066 6f72  shortcode:se for
-00047050: 2073 6520 696e 206f 7468 6572 5f65 6c65   se in other_ele
-00047060: 6d65 6e74 7320 6966 2073 652e 7061 7265  ments if se.pare
-00047070: 6e74 7d0d 0a0d 0a20 2020 2020 2020 2020  nt}....         
-00047080: 2020 2020 2020 2023 4120 6c6f 6361 6c5f         #A local_
-00047090: 636f 7079 5f6f 665f 6d6f 7665 645f 6f72  copy_of_moved_or
-000470a0: 5f72 656d 6f76 6564 5f65 6c65 6d65 6e74  _removed_element
-000470b0: 7320 2d20 7765 276c 6c20 6164 6420 7468  s - we'll add th
-000470c0: 6573 6520 6c69 7374 7320 746f 2074 6865  ese lists to the
-000470d0: 206d 6169 6e20 6c69 7374 2061 7320 6120   main list as a 
-000470e0: 7475 706c 650d 0a20 2020 2020 2020 2020  tuple..         
-000470f0: 2020 2020 2020 206c 6f63 616c 5f6d 6f76         local_mov
-00047100: 6564 5f6f 725f 7265 6d6f 7665 645f 656c  ed_or_removed_el
-00047110: 656d 656e 7473 5f73 656c 6620 3d20 5b5d  ements_self = []
-00047120: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00047130: 2020 6c6f 6361 6c5f 6d6f 7665 645f 6f72    local_moved_or
-00047140: 5f72 656d 6f76 6564 5f65 6c65 6d65 6e74  _removed_element
-00047150: 735f 6f74 6865 7220 3d20 5b5d 0d0a 0d0a  s_other = []....
-00047160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047170: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
-00047180: 5f65 6c5f 7061 7265 6e74 5f73 635f 7365  _el_parent_sc_se
-00047190: 5f6c 6f6f 6b75 702e 6974 656d 7328 293a  _lookup.items():
-000471a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000471b0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-000471c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000471d0: 2020 2020 6f74 6865 725f 656c 5f70 6172      other_el_par
-000471e0: 656e 745f 7363 5f73 655f 6c6f 6f6b 7570  ent_sc_se_lookup
-000471f0: 5b6b 5d0d 0a20 2020 2020 2020 2020 2020  [k]..           
-00047200: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00047210: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
-00047220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047230: 2020 206c 6f63 616c 5f6d 6f76 6564 5f6f     local_moved_o
-00047240: 725f 7265 6d6f 7665 645f 656c 656d 656e  r_removed_elemen
-00047250: 7473 5f73 656c 662e 6170 7065 6e64 2876  ts_self.append(v
-00047260: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00047270: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
-00047280: 206f 7468 6572 5f65 6c5f 7061 7265 6e74   other_el_parent
-00047290: 5f73 635f 7365 5f6c 6f6f 6b75 702e 6974  _sc_se_lookup.it
-000472a0: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
-000472b0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-000472c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000472d0: 2020 2020 2020 2020 2020 7365 6c66 5f65            self_e
-000472e0: 6c5f 7061 7265 6e74 5f73 635f 7365 5f6c  l_parent_sc_se_l
-000472f0: 6f6f 6b75 705b 6b5d 0d0a 2020 2020 2020  ookup[k]..      
-00047300: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00047310: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
-00047320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00047330: 2020 2020 2020 2020 6c6f 6361 6c5f 6d6f          local_mo
-00047340: 7665 645f 6f72 5f72 656d 6f76 6564 5f65  ved_or_removed_e
-00047350: 6c65 6d65 6e74 735f 6f74 6865 722e 6170  lements_other.ap
-00047360: 7065 6e64 2876 290d 0a0d 0a20 2020 2020  pend(v)....     
-00047370: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00047380: 6e28 6c6f 6361 6c5f 6d6f 7665 645f 6f72  n(local_moved_or
-00047390: 5f72 656d 6f76 6564 5f65 6c65 6d65 6e74  _removed_element
-000473a0: 735f 7365 6c66 293e 3020 6f72 206c 656e  s_self)>0 or len
-000473b0: 286c 6f63 616c 5f6d 6f76 6564 5f6f 725f  (local_moved_or_
-000473c0: 7265 6d6f 7665 645f 656c 656d 656e 7473  removed_elements
-000473d0: 5f6f 7468 6572 293e 303a 0d0a 2020 2020  _other)>0:..    
-000473e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000473f0: 6d6f 7665 645f 6f72 5f72 656d 6f76 6564  moved_or_removed
-00047400: 5f65 6c65 6d65 6e74 7320 2b3d 205b 286c  _elements += [(l
-00047410: 6f63 616c 5f6d 6f76 6564 5f6f 725f 7265  ocal_moved_or_re
-00047420: 6d6f 7665 645f 656c 656d 656e 7473 5f73  moved_elements_s
-00047430: 656c 662c 6c6f 6361 6c5f 6d6f 7665 645f  elf,local_moved_
-00047440: 6f72 5f72 656d 6f76 6564 5f65 6c65 6d65  or_removed_eleme
-00047450: 6e74 735f 6f74 6865 7229 5d0d 0a0d 0a20  nts_other)].... 
-00047460: 2020 2020 2020 2020 2020 2023 4e6f 7720             #Now 
-00047470: 6c6f 6f6b 2074 6865 206f 7468 6572 2077  look the other w
-00047480: 6179 202d 2061 7265 2074 6865 7265 2065  ay - are there e
-00047490: 6c65 6d65 6e74 7320 696e 206f 7468 6572  lements in other
-000474a0: 5f65 6c65 6d65 6e74 7320 7468 6174 2068  _elements that h
-000474b0: 6176 6520 6172 6520 6e65 7720 746f 2074  ave are new to t
-000474c0: 6869 7320 7374 7275 6374 7572 653f 0d0a  his structure?..
-000474d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-000474e0: 6f74 6865 725f 7368 6f72 7463 6f64 652c  other_shortcode,
-000474f0: 2065 6c65 6d65 6e74 735f 7769 7468 5f73   elements_with_s
-00047500: 686f 7274 636f 6465 2069 6e20 6f74 6865  hortcode in othe
-00047510: 725f 656c 656d 656e 745f 6c6f 6f6b 7570  r_element_lookup
-00047520: 2e69 7465 6d73 2829 3a0d 0a20 2020 2020  .items():..     
-00047530: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
-00047540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00047550: 2020 2020 2073 656c 665f 656c 656d 656e       self_elemen
-00047560: 7473 203d 2073 656c 665f 656c 656d 656e  ts = self_elemen
-00047570: 745f 6c6f 6f6b 7570 5b6f 7468 6572 5f73  t_lookup[other_s
-00047580: 686f 7274 636f 6465 5d0d 0a20 2020 2020  hortcode]..     
-00047590: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000475a0: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
-000475b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000475c0: 206e 6577 5f65 6c65 6d65 6e74 7320 2b3d   new_elements +=
-000475d0: 2065 6c65 6d65 6e74 735f 7769 7468 5f73   elements_with_s
-000475e0: 686f 7274 636f 6465 0d0a 0d0a 0d0a 2020  hortcode......  
-000475f0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00047600: 2020 2020 2020 2020 206e 6577 5f65 6c65           new_ele
-00047610: 6d65 6e74 7320 3d20 4e6f 6e65 0d0a 2020  ments = None..  
-00047620: 2020 2020 2020 2020 2020 6d6f 7665 645f            moved_
-00047630: 6f72 5f72 656d 6f76 6564 5f65 6c65 6d65  or_removed_eleme
-00047640: 6e74 7320 3d20 4e6f 6e65 0d0a 2020 2020  nts = None..    
-00047650: 2020 2020 2020 2020 7265 6d6f 7665 645f          removed_
-00047660: 656c 656d 656e 7473 203d 204e 6f6e 650d  elements = None.
-00047670: 0a0d 0a20 2020 2020 2020 2023 5468 6520  ...        #The 
-00047680: 666f 6c6c 6f77 696e 6720 7769 6c6c 2062  following will b
-00047690: 6520 646f 6e65 2069 6e20 7468 6520 6869  e done in the hi
-000476a0: 6572 6172 6368 7920 6d61 6e69 7075 6c61  erarchy manipula
-000476b0: 746f 7273 2c20 7369 6e63 6520 7468 6579  tors, since they
-000476c0: 2061 7265 2061 7420 656c 656d 656e 7420   are at element 
-000476d0: 6c65 7665 6c2c 2061 6e64 2072 6571 7569  level, and requi
-000476e0: 7265 2061 2063 616c 6375 6c61 7469 6f6e  re a calculation
-000476f0: 2072 6563 6f72 6469 6e67 2061 7420 7468   recording at th
-00047700: 6520 7374 6172 740d 0a20 2020 2020 2020  e start..       
-00047710: 2023 202b 204e 6577 2063 616c 6375 6c61   # + New calcula
-00047720: 7469 6f6e 2065 6c65 6d65 6e74 730d 0a20  tion elements.. 
-00047730: 2020 2020 2020 2023 202b 2043 616c 6375         # + Calcu
-00047740: 6c61 7469 6f6e 2063 6861 6e67 6573 0d0a  lation changes..
-00047750: 0d0a 2020 2020 2020 2020 234e 6f77 2064  ..        #Now d
-00047760: 6f20 7468 6520 6469 6666 0d0a 0d0a 2020  o the diff....  
-00047770: 2020 2020 2020 7365 6320 3d20 7365 6c66        sec = self
-00047780: 2e64 6966 6628 6f74 6865 722c 7368 6f72  .diff(other,shor
-00047790: 7463 6f64 655f 7472 616e 736c 6174 696f  tcode_translatio
-000477a0: 6e73 3d73 686f 7274 636f 6465 5f74 7261  ns=shortcode_tra
-000477b0: 6e73 6c61 7469 6f6e 732c 7265 7665 7273  nslations,revers
-000477c0: 655f 7472 616e 736c 6174 696f 6e73 3d72  e_translations=r
-000477d0: 6576 6572 7365 5f74 7261 6e73 6c61 7469  everse_translati
-000477e0: 6f6e 7329 0d0a 0d0a 2020 2020 2020 2020  ons)....        
-000477f0: 7365 632e 6e65 775f 656c 656d 656e 7473  sec.new_elements
-00047800: 203d 206e 6577 5f65 6c65 6d65 6e74 730d   = new_elements.
-00047810: 0a20 2020 2020 2020 2073 6563 2e6d 6f76  .        sec.mov
-00047820: 6564 5f6f 725f 7265 6d6f 7665 645f 656c  ed_or_removed_el
-00047830: 656d 656e 7473 203d 206d 6f76 6564 5f6f  ements = moved_o
-00047840: 725f 7265 6d6f 7665 645f 656c 656d 656e  r_removed_elemen
-00047850: 7473 0d0a 2020 2020 2020 2020 7365 632e  ts..        sec.
-00047860: 7265 6d6f 7665 645f 656c 656d 656e 7473  removed_elements
-00047870: 203d 2072 656d 6f76 6564 5f65 6c65 6d65   = removed_eleme
-00047880: 6e74 730d 0a0d 0a0d 0a20 2020 2020 2020  nts......       
-00047890: 2072 6574 7572 6e20 7365 630d 0a0d 0a20   return sec.... 
-000478a0: 2020 2064 6566 2064 6966 6628 7365 6c66     def diff(self
-000478b0: 2c6f 7468 6572 2c73 686f 7274 636f 6465  ,other,shortcode
-000478c0: 5f74 7261 6e73 6c61 7469 6f6e 733d 4e6f  _translations=No
-000478d0: 6e65 2c72 6576 6572 7365 5f74 7261 6e73  ne,reverse_trans
-000478e0: 6c61 7469 6f6e 733d 4e6f 6e65 293a 0d0a  lations=None):..
-000478f0: 2020 2020 2020 2020 2727 270d 0a20 2020          '''..   
-00047900: 2020 2020 2043 6f6d 7061 7265 2074 6869       Compare thi
-00047910: 7320 5374 7275 6374 7572 6545 6c65 6d65  s StructureEleme
-00047920: 6e74 2074 6f20 616e 6f74 6865 722c 2065  nt to another, e
-00047930: 7373 656e 7469 616c 6c79 2064 6f69 6e67  ssentially doing
-00047940: 2061 2064 6966 660d 0a20 2020 2020 2020   a diff..       
-00047950: 2049 6620 616e 2065 6c65 6d65 6e74 2069   If an element i
-00047960: 7320 6e65 7720 6f72 2068 6173 2062 6565  s new or has bee
-00047970: 6e20 7265 6d6f 7665 6420 7468 656e 2072  n removed then r
-00047980: 6563 6f72 6420 7468 6973 2069 6e66 6f72  ecord this infor
-00047990: 6d61 7469 6f6e 2e0d 0a20 2020 2020 2020  mation...       
-000479a0: 2049 6620 616e 2065 6c65 6d65 6e74 2069   If an element i
-000479b0: 7320 696e 2074 6865 2073 616d 6520 706f  s in the same po
-000479c0: 7369 7469 6f6e 206f 7220 6861 7320 6265  sition or has be
-000479d0: 656e 206d 6f76 6564 2c20 7265 636f 7264  en moved, record
-000479e0: 2074 6865 2069 6e66 6f72 6d61 7469 6f6e   the information
-000479f0: 2061 6e64 2074 6865 6e20 7072 6f63 6565   and then procee
-00047a00: 6420 746f 2063 6865 636b 696e 6720 7468  d to checking th
-00047a10: 6520 6368 696c 6472 656e 0d0a 2020 2020  e children..    
-00047a20: 2020 2020 5265 7475 726e 2061 2053 7472      Return a Str
-00047a30: 7563 7475 7265 456c 656d 656e 7443 6f6d  uctureElementCom
-00047a40: 7061 7269 736f 6e20 6f62 6a65 6374 0d0a  parison object..
-00047a50: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00047a60: 206f 7468 6572 3a20 5374 7275 6374 7572   other: Structur
-00047a70: 6545 6c65 6d65 6e74 2074 6f20 636f 6d70  eElement to comp
-00047a80: 6172 6520 7365 6c66 2074 6f0d 0a20 2020  are self to..   
-00047a90: 2020 2020 203a 7061 7261 6d20 7368 6f72       :param shor
-00047aa0: 7463 6f64 655f 7472 616e 736c 6174 696f  tcode_translatio
-00047ab0: 6e73 3a20 6469 6374 696f 6e61 7279 2066  ns: dictionary f
-00047ac0: 6f72 2074 7261 6e73 6c61 7469 6e67 2073  or translating s
-00047ad0: 686f 7274 636f 6465 7320 6f66 2022 6f74  hortcodes of "ot
-00047ae0: 6865 7222 2073 7472 7563 7475 7265 2065  her" structure e
-00047af0: 6c65 6d65 6e74 7320 746f 2073 686f 7274  lements to short
-00047b00: 636f 6465 7320 6f66 2022 7365 6c66 2220  codes of "self" 
-00047b10: 7374 7275 6374 7572 6520 656c 656d 656e  structure elemen
-00047b20: 7473 2c20 736f 2074 6861 7420 7369 6d69  ts, so that simi
-00047b30: 6c61 7220 6869 6572 6172 6368 6965 7320  lar hierarchies 
-00047b40: 6361 6e20 6265 2063 6f6d 7061 7265 6420  can be compared 
-00047b50: 6566 6669 6369 656e 746c 790d 0a20 2020  efficiently..   
-00047b60: 2020 2020 203a 7061 7261 6d20 7265 7665       :param reve
-00047b70: 7273 655f 7472 616e 736c 6174 696f 6e73  rse_translations
-00047b80: 3a20 596f 7520 7368 6f75 6c64 6e27 7420  : You shouldn't 
-00047b90: 6e65 6564 2074 6f20 7370 6563 6966 7920  need to specify 
-00047ba0: 7468 6973 2e20 4974 2065 7869 7374 7320  this. It exists 
-00047bb0: 736f 2074 6861 7420 7765 2064 6f6e 2774  so that we don't
-00047bc0: 2068 6176 6520 746f 2063 616c 6375 6c61   have to calcula
-00047bd0: 7465 2074 6865 2072 6576 6572 7365 2074  te the reverse t
-00047be0: 7261 6e73 6c61 7469 6f6e 2066 6f72 2065  ranslation for e
-00047bf0: 7665 7279 205f 7265 6375 7273 6976 655f  very _recursive_
-00047c00: 2063 616c 6c20 6f66 2074 6869 7320 6675   call of this fu
-00047c10: 6e63 7469 6f6e 0d0a 2020 2020 2020 2020  nction..        
-00047c20: 2727 270d 0a20 2020 2020 2020 2069 6620  '''..        if 
-00047c30: 7368 6f72 7463 6f64 655f 7472 616e 736c  shortcode_transl
-00047c40: 6174 696f 6e73 2069 7320 4e6f 6e65 3a0d  ations is None:.
-00047c50: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
-00047c60: 7274 636f 6465 5f74 7261 6e73 6c61 7469  rtcode_translati
-00047c70: 6f6e 7320 3d20 7b7d 0d0a 0d0a 2020 2020  ons = {}....    
-00047c80: 2020 2020 7365 6320 3d20 5374 7275 6374      sec = Struct
-00047c90: 7572 6545 6c65 6d65 6e74 436f 6d70 6172  ureElementCompar
-00047ca0: 6973 6f6e 2873 656c 662c 6f74 6865 7229  ison(self,other)
-00047cb0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-00047cc0: 5f63 6869 6c64 7265 6e5f 6b65 7973 2020  _children_keys  
-00047cd0: 3d20 7b73 652e 7368 6f72 746e 616d 653a  = {se.shortname:
-00047ce0: 6e20 666f 7220 6e2c 2073 6520 696e 2065  n for n, se in e
-00047cf0: 6e75 6d65 7261 7465 2873 656c 662e 5f63  numerate(self._c
-00047d00: 6869 6c64 5f73 7472 7563 7475 7265 5f65  hild_structure_e
-00047d10: 6c65 6d65 6e74 7329 7d0d 0a20 2020 2020  lements)}..     
-00047d20: 2020 206f 7468 6572 5f63 6869 6c64 7265     other_childre
-00047d30: 6e5f 6b65 7973 203d 207b 7d0d 0a0d 0a20  n_keys = {}.... 
-00047d40: 2020 2020 2020 2066 6f72 206e 2c20 7365         for n, se
-00047d50: 2069 6e20 656e 756d 6572 6174 6528 6f74   in enumerate(ot
-00047d60: 6865 722e 5f63 6869 6c64 5f73 7472 7563  her._child_struc
-00047d70: 7475 7265 5f65 6c65 6d65 6e74 7329 3a0d  ture_elements):.
-00047d80: 0a20 2020 2020 2020 2020 2020 2073 6520  .            se 
-00047d90: 3d20 7365 2e73 686f 7274 6e61 6d65 0d0a  = se.shortname..
-00047da0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00047db0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00047dc0: 2020 7365 203d 2073 686f 7274 636f 6465    se = shortcode
-00047dd0: 5f74 7261 6e73 6c61 7469 6f6e 735b 7365  _translations[se
-00047de0: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
-00047df0: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
-00047e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00047e10: 2070 6173 730d 0a20 2020 2020 2020 2020   pass..         
-00047e20: 2020 206f 7468 6572 5f63 6869 6c64 7265     other_childre
-00047e30: 6e5f 6b65 7973 5b73 655d 203d 206e 0d0a  n_keys[se] = n..
-00047e40: 0d0a 2020 2020 2020 2020 6966 2072 6576  ..        if rev
-00047e50: 6572 7365 5f74 7261 6e73 6c61 7469 6f6e  erse_translation
-00047e60: 7320 6973 204e 6f6e 653a 0d0a 2020 2020  s is None:..    
-00047e70: 2020 2020 2020 2020 7265 7665 7273 655f          reverse_
-00047e80: 7472 616e 736c 6174 696f 6e73 203d 207b  translations = {
-00047e90: 763a 6b20 666f 7220 6b2c 7620 696e 2073  v:k for k,v in s
-00047ea0: 686f 7274 636f 6465 5f74 7261 6e73 6c61  hortcode_transla
-00047eb0: 7469 6f6e 732e 6974 656d 7328 297d 0d0a  tions.items()}..
-00047ec0: 0d0a 2020 2020 2020 2020 2020 2020 2346  ..            #F
-00047ed0: 696c 6c20 7468 6520 7265 7665 7273 6520  ill the reverse 
-00047ee0: 7472 616e 736c 6174 696f 6e20 6469 6374  translation dict
-00047ef0: 2077 6974 6820 6b65 7973 2066 6f72 2061   with keys for a
-00047f00: 6e79 7468 696e 6720 7765 2064 6964 6e27  nything we didn'
-00047f10: 7420 6765 7420 696e 2074 6865 2074 7261  t get in the tra
-00047f20: 6e73 6c61 7469 6f6e 2064 6963 7469 6f6e  nslation diction
-00047f30: 6172 792c 2074 6f20 7361 7665 2075 7320  ary, to save us 
-00047f40: 7472 6170 7069 6e67 204b 6579 4572 726f  trapping KeyErro
-00047f50: 7273 2061 6c6c 206f 7665 7220 7468 6520  rs all over the 
-00047f60: 706c 6163 6520 696e 2074 6865 2066 6f6c  place in the fol
-00047f70: 6c6f 7769 6e67 2063 6f64 650d 0a20 2020  lowing code..   
-00047f80: 2020 2020 2020 2020 2023 4e6f 7465 2c20           #Note, 
-00047f90: 666f 7220 616e 2065 6d70 7479 2074 7261  for an empty tra
-00047fa0: 6e73 6c61 7469 6f6e 2064 6963 7469 6f6e  nslation diction
-00047fb0: 6172 792c 2077 6527 6c6c 2062 6520 636f  ary, we'll be co
-00047fc0: 6d70 6c65 7465 6c79 2066 696c 6c69 6e67  mpletely filling
-00047fd0: 2074 6869 7320 7265 7665 7273 6520 7472   this reverse tr
-00047fe0: 616e 736c 6174 696f 6e20 6469 6374 696f  anslation dictio
-00047ff0: 6e61 7279 2077 6974 6820 7361 6d65 2073  nary with same s
-00048000: 686f 7274 6e61 6d65 3a73 686f 7274 6e61  hortname:shortna
-00048010: 6d65 2070 6169 7273 0d0a 2020 2020 2020  me pairs..      
-00048020: 2020 2020 2020 666f 7220 6b20 696e 206f        for k in o
-00048030: 7468 6572 5f63 6869 6c64 7265 6e5f 6b65  ther_children_ke
-00048040: 7973 2e6b 6579 7328 293a 0d0a 2020 2020  ys.keys():..    
-00048050: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00048060: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00048070: 2020 2020 2020 7265 7665 7273 655f 7472        reverse_tr
-00048080: 616e 736c 6174 696f 6e73 5b6b 5d0d 0a20  anslations[k].. 
-00048090: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000480a0: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
-000480b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000480c0: 2020 2020 2072 6576 6572 7365 5f74 7261       reverse_tra
-000480d0: 6e73 6c61 7469 6f6e 735b 6b5d 203d 206b  nslations[k] = k
-000480e0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
-000480f0: 5f63 6869 6c64 7265 6e5f 706f 735f 6c6f  _children_pos_lo
-00048100: 6f6b 7570 2020 3d20 7b6e 3a73 6520 666f  okup  = {n:se fo
-00048110: 7220 6e2c 2073 6520 696e 2065 6e75 6d65  r n, se in enume
-00048120: 7261 7465 2820 7365 6c66 2e5f 6368 696c  rate( self._chil
-00048130: 645f 7374 7275 6374 7572 655f 656c 656d  d_structure_elem
-00048140: 656e 7473 297d 0d0a 2020 2020 2020 2020  ents)}..        
-00048150: 6f74 6865 725f 6368 696c 6472 656e 5f70  other_children_p
-00048160: 6f73 5f6c 6f6f 6b75 7020 3d20 7b6e 3a73  os_lookup = {n:s
-00048170: 6520 666f 7220 6e2c 2073 6520 696e 2065  e for n, se in e
-00048180: 6e75 6d65 7261 7465 286f 7468 6572 2e5f  numerate(other._
-00048190: 6368 696c 645f 7374 7275 6374 7572 655f  child_structure_
-000481a0: 656c 656d 656e 7473 297d 0d0a 0d0a 0d0a  elements)}......
-000481b0: 0d0a 2020 2020 2020 2020 234e 6f77 2064  ..        #Now d
-000481c0: 6f20 7468 6520 6469 6666 0d0a 0d0a 2020  o the diff....  
-000481d0: 2020 2020 2020 666f 7220 6f70 2c20 6b65        for op, ke
-000481e0: 795f 6c69 7374 2069 6e20 5f64 6966 6628  y_list in _diff(
-000481f0: 6c69 7374 2873 656c 665f 6368 696c 6472  list(self_childr
-00048200: 656e 5f6b 6579 732e 6b65 7973 2829 292c  en_keys.keys()),
-00048210: 6c69 7374 286f 7468 6572 5f63 6869 6c64  list(other_child
-00048220: 7265 6e5f 6b65 7973 2e6b 6579 7328 2929  ren_keys.keys())
-00048230: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00048240: 2370 7269 6e74 286f 702c 6b65 795f 6c69  #print(op,key_li
-00048250: 7374 290d 0a20 2020 2020 2020 2020 2020  st)..           
-00048260: 2066 6f72 206b 2069 6e20 6b65 795f 6c69   for k in key_li
-00048270: 7374 3a0d 0a20 2020 2020 2020 2020 2020  st:..           
-00048280: 2020 2020 2063 6f6d 7020 3d20 4e6f 6e65       comp = None
-00048290: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000482a0: 2020 7472 616e 736f 7020 3d20 6f70 0d0a    transop = op..
-000482b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000482c0: 6966 2020 2074 7261 6e73 6f70 203d 3d20  if   transop == 
-000482d0: 272d 273a 0d0a 2020 2020 2020 2020 2020  '-':..          
-000482e0: 2020 2020 2020 2020 2020 6973 5f69 6e5f            is_in_
-000482f0: 7365 6c66 203d 2054 7275 650d 0a20 2020  self = True..   
-00048300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048310: 2069 735f 696e 5f6f 7468 6572 203d 2046   is_in_other = F
-00048320: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
-00048330: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-00048340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048350: 2020 2020 2020 2020 7468 6973 5f70 6f73          this_pos
-00048360: 203d 2073 656c 665f 6368 696c 6472 656e   = self_children
-00048370: 5f6b 6579 735b 6b5d 0d0a 2020 2020 2020  _keys[k]..      
-00048380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048390: 2020 2370 7269 6e74 2874 6869 735f 706f    #print(this_po
-000483a0: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-000483b0: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-000483c0: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
+00043d90: 2020 2020 6966 2070 2069 7320 4e6f 6e65      if p is None
+00043da0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00043db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043dc0: 2020 2062 7265 616b 0d0a 0d0a 2020 2020     break....    
+00043dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043de0: 2020 2020 2020 2020 6966 2070 2e73 686f          if p.sho
+00043df0: 7274 6e61 6d65 203d 3d20 6375 7272 656e  rtname == curren
+00043e00: 745f 6f75 7470 7574 5f6e 6f64 652e 7368  t_output_node.sh
+00043e10: 6f72 746e 616d 653a 0d0a 0d0a 2020 2020  ortname:....    
+00043e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043e30: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+00043e40: 7363 696f 6e5f 6f75 7470 7574 5f6e 6f64  scion_output_nod
+00043e50: 6520 3d20 5374 7275 6374 7572 6545 6c65  e = StructureEle
+00043e60: 6d65 6e74 2865 6c65 6d65 6e74 203d 2073  ment(element = s
+00043e70: 6369 6f6e 5f73 7472 7563 7475 7265 5f65  cion_structure_e
+00043e80: 6c65 6d65 6e74 2e65 6c65 6d65 6e74 290d  lement.element).
+00043e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00043ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043eb0: 2074 7261 6365 5f6c 6f67 5f66 6e28 2753   trace_log_fn('S
+00043ec0: 6369 6f6e 2067 7261 6674 696e 6720 746f  cion grafting to
+00043ed0: 2061 6e63 6573 746f 7220 6f66 207b 7d2e   ancestor of {}.
+00043ee0: 207b 7d28 7b7d 2920 6164 6465 6420 746f   {}({}) added to
+00043ef0: 207b 7d27 2e66 6f72 6d61 7428 7363 696f   {}'.format(scio
+00043f00: 6e5f 7374 7275 6374 7572 655f 656c 656d  n_structure_elem
+00043f10: 656e 742e 7368 6f72 746e 616d 652c 6e65  ent.shortname,ne
+00043f20: 775f 7363 696f 6e5f 6f75 7470 7574 5f6e  w_scion_output_n
+00043f30: 6f64 652e 7368 6f72 746e 616d 652c 6e2c  ode.shortname,n,
+00043f40: 6375 7272 656e 745f 6f75 7470 7574 5f6e  current_output_n
+00043f50: 6f64 652e 7368 6f72 746e 616d 6529 290d  ode.shortname)).
+00043f60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00043f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043f80: 2063 7572 7265 6e74 5f6f 7574 7075 745f   current_output_
+00043f90: 6e6f 6465 2e5f 6164 645f 6368 696c 6428  node._add_child(
+00043fa0: 6e65 775f 7363 696f 6e5f 6f75 7470 7574  new_scion_output
+00043fb0: 5f6e 6f64 6529 0d0a 2020 2020 2020 2020  _node)..        
+00043fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00043fd0: 2020 2020 2020 2020 2372 6563 6f72 6420          #record 
+00043fe0: 7468 6520 636f 7069 6564 2073 6369 6f6e  the copied scion
+00043ff0: 2065 6c65 6d65 6e74 2069 6e20 6f75 7220   element in our 
+00044000: 6469 6374 696f 6e61 7279 2c20 736f 2074  dictionary, so t
+00044010: 6861 7420 7765 2063 616e 2073 686f 7274  hat we can short
+00044020: 6375 7420 6772 6166 7469 6e67 206f 6620  cut grafting of 
+00044030: 6475 706c 6963 6174 6520 656c 656d 656e  duplicate elemen
+00044040: 7473 0d0a 2020 2020 2020 2020 2020 2020  ts..            
+00044050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044060: 2020 2020 636f 7069 6564 5f73 6369 6f6e      copied_scion
+00044070: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00044080: 6e74 735b 6e65 775f 7363 696f 6e5f 6f75  nts[new_scion_ou
+00044090: 7470 7574 5f6e 6f64 652e 7368 6f72 746e  tput_node.shortn
+000440a0: 616d 655d 203d 206e 6577 5f73 6369 6f6e  ame] = new_scion
+000440b0: 5f6f 7574 7075 745f 6e6f 6465 0d0a 2020  _output_node..  
+000440c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000440d0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+000440e0: 6163 655f 6c6f 675f 666e 2827 2d2d 2d2d  ace_log_fn('----
+000440f0: 4375 7272 656e 7420 4f75 7470 7574 206e  Current Output n
+00044100: 6f64 6520 7365 7420 746f 2027 2b73 7472  ode set to '+str
+00044110: 2863 7572 7265 6e74 5f6f 7574 7075 745f  (current_output_
+00044120: 6e6f 6465 2e73 686f 7274 6e61 6d65 2929  node.shortname))
+00044130: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00044140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044150: 2020 2020 6375 7272 656e 745f 6f75 7470      current_outp
+00044160: 7574 5f6e 6f64 6520 3d20 6e65 775f 7363  ut_node = new_sc
+00044170: 696f 6e5f 6f75 7470 7574 5f6e 6f64 650d  ion_output_node.
+00044180: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00044190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000441a0: 2020 2023 5365 7420 6b65 6570 5f74 7279     #Set keep_try
+000441b0: 696e 675f 746f 5f67 7261 6674 2074 6f20  ing_to_graft to 
+000441c0: 4661 6c73 6520 696e 206f 7264 6572 2074  False in order t
+000441d0: 6f20 6272 6561 6b20 6f75 7420 6f66 2074  o break out of t
+000441e0: 6865 2077 6869 6c65 206c 6f6f 702c 2077  he while loop, w
+000441f0: 6869 6368 2077 696c 6c20 7472 7920 746f  hich will try to
+00044200: 2074 616b 6520 7573 2062 6163 6b20 7570   take us back up
+00044210: 2074 6865 2068 6965 7261 7263 6879 2075   the hierarchy u
+00044220: 6e74 696c 2077 6520 6361 6e20 6772 6166  ntil we can graf
+00044230: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+00044240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044250: 2020 2023 4279 2062 7265 616b 696e 6720     #By breaking 
+00044260: 6f75 7420 6f66 2074 6865 2077 6869 6c65  out of the while
+00044270: 206c 6f6f 7020 7765 2077 696c 6c20 7374   loop we will st
+00044280: 6172 7420 7472 7969 6e67 2074 6f20 6772  art trying to gr
+00044290: 6166 7420 7468 6520 6e65 7874 2073 6369  aft the next sci
+000442a0: 6f6e 206e 6f64 650d 0a20 2020 2020 2020  on node..       
+000442b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000442c0: 2020 2020 2020 2020 206b 6565 705f 7472           keep_tr
+000442d0: 7969 6e67 5f74 6f5f 6772 6166 7420 3d20  ying_to_graft = 
+000442e0: 4661 6c73 650d 0a20 2020 2020 2020 2020  False..         
+000442f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044300: 2020 2020 2020 2062 7265 616b 0d0a 0d0a         break....
+00044310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044320: 2020 2020 6966 206b 6565 705f 7472 7969      if keep_tryi
+00044330: 6e67 5f74 6f5f 6772 6166 743a 0d0a 2020  ng_to_graft:..  
+00044340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044350: 2020 2020 2020 2349 6620 7765 2067 6f74        #If we got
+00044360: 2074 6869 7320 6661 7220 7769 7468 6f75   this far withou
+00044370: 7420 6772 6166 7469 6e67 2c20 7468 656e  t grafting, then
+00044380: 2077 6520 636f 756c 646e 2774 2067 7261   we couldn't gra
+00044390: 6674 2074 6865 2073 6369 6f6e 206e 6f64  ft the scion nod
+000443a0: 6520 746f 2074 6869 7320 6375 7272 656e  e to this curren
+000443b0: 7420 6f75 7470 7574 206e 6f64 650d 0a20  t output node.. 
+000443c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000443d0: 2020 2020 2020 2023 536f 2067 6f20 7570         #So go up
+000443e0: 2061 206c 6576 656c 2c20 616e 6420 7472   a level, and tr
+000443f0: 7920 746f 2067 7261 6674 2074 6865 7265  y to graft there
+00044400: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00044410: 2020 2020 2020 2020 2020 2345 7665 6e74            #Event
+00044420: 7561 6c6c 7920 7765 276c 6c20 6d65 6574  ually we'll meet
+00044430: 2061 6e20 616e 6365 7374 6f72 206f 6620   an ancestor of 
+00044440: 7468 6520 6375 7272 656e 7420 7363 696f  the current scio
+00044450: 6e2c 206f 7220 7468 6520 6e65 775f 726f  n, or the new_ro
+00044460: 6f74 7374 6f63 6b5f 6f75 7470 7574 5f6e  otstock_output_n
+00044470: 6f64 652c 0d0a 2020 2020 2020 2020 2020  ode,..          
+00044480: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00044490: 616e 6420 7765 276c 6c20 6174 7461 6368  and we'll attach
+000444a0: 2074 6f20 7468 6174 0d0a 2020 2020 2020   to that..      
+000444b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000444c0: 2020 2374 7261 6365 5f6c 6f67 5f66 6e28    #trace_log_fn(
+000444d0: 2742 6f74 746f 6d20 6f66 2069 6e6e 6572  'Bottom of inner
+000444e0: 206c 6f6f 7020 6375 7272 656e 7420 4f75   loop current Ou
+000444f0: 7470 7574 204e 6f64 6520 7b7d 206d 6f76  tput Node {} mov
+00044500: 6564 2075 7020 746f 2070 6172 656e 742e  ed up to parent.
+00044510: 2049 7320 6e6f 7720 7365 7420 746f 207b   Is now set to {
+00044520: 7d27 2e66 6f72 6d61 7428 6375 7272 656e  }'.format(curren
+00044530: 745f 6f75 7470 7574 5f6e 6f64 652e 7061  t_output_node.pa
+00044540: 7265 6e74 2e73 686f 7274 6e61 6d65 2c20  rent.shortname, 
+00044550: 6375 7272 656e 745f 6f75 7470 7574 5f6e  current_output_n
+00044560: 6f64 652e 7368 6f72 746e 616d 6529 290d  ode.shortname)).
+00044570: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044580: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00044590: 5f6f 7574 7075 745f 6e6f 6465 203d 2063  _output_node = c
+000445a0: 7572 7265 6e74 5f6f 7574 7075 745f 6e6f  urrent_output_no
+000445b0: 6465 2e70 6172 656e 740d 0a0d 0a0d 0a20  de.parent...... 
+000445c0: 2020 2020 2020 2023 5265 7475 726e 2074         #Return t
+000445d0: 6865 2072 6f6f 7420 6e6f 6465 0d0a 2020  he root node..  
+000445e0: 2020 2020 2020 7265 7475 726e 2072 6f6f        return roo
+000445f0: 745f 6f75 7470 7574 5f6e 6f64 650d 0a0d  t_output_node...
+00044600: 0a0d 0a20 2020 2023 6465 6620 636f 6e63  ...    #def conc
+00044610: 6572 7469 6e61 2873 656c 662c 2029 3a0d  ertina(self, ):.
+00044620: 0a0d 0a20 2020 2064 6566 2066 696c 7465  ...    def filte
+00044630: 7228 7365 6c66 2c20 6669 6c74 6572 5f72  r(self, filter_r
+00044640: 756c 6520 3d20 4e6f 6e65 2c73 686f 7274  ule = None,short
+00044650: 636f 6465 5f6c 6973 743d 4e6f 6e65 2c66  code_list=None,f
+00044660: 696c 7465 725f 696e 203d 2054 7275 6529  ilter_in = True)
+00044670: 3a0d 0a20 2020 2020 2020 2027 2727 4669  :..        '''Fi
+00044680: 6c74 6572 206f 7574 2028 6f72 2066 696c  lter out (or fil
+00044690: 7465 7220 696e 2920 616c 6c20 656c 656d  ter in) all elem
+000446a0: 656e 7473 206f 6620 7468 6520 7375 6274  ents of the subt
+000446b0: 7265 6520 7468 6174 2064 6f20 6e6f 7420  ree that do not 
+000446c0: 286f 7220 646f 2920 636f 6e66 6f72 6d20  (or do) conform 
+000446d0: 746f 2074 6865 2066 696c 7465 7220 7275  to the filter ru
+000446e0: 6c65 206f 7220 6172 6520 6e6f 7420 286f  le or are not (o
+000446f0: 7220 6172 6529 2069 6e20 7468 6520 7368  r are) in the sh
+00044700: 6f72 7463 6f64 655f 6c69 7374 2e0d 0a20  ortcode_list... 
+00044710: 2020 2020 2020 2066 696c 7465 725f 696e         filter_in
+00044720: 2064 6574 6572 6d69 6e65 7320 7768 6574   determines whet
+00044730: 6865 7220 7468 6520 656c 656d 656e 7473  her the elements
+00044740: 2061 7070 6561 7269 6e67 2069 6e20 7468   appearing in th
+00044750: 6520 6c69 7374 206f 7220 636f 6e66 6f72  e list or confor
+00044760: 6d69 6e67 2074 6f20 7468 6520 7275 6c65  ming to the rule
+00044770: 2067 6574 2066 696c 7465 7265 6420 696e   get filtered in
+00044780: 206f 7220 6f75 740d 0a0d 0a20 2020 2020   or out....     
+00044790: 2020 2054 6865 2073 686f 7274 636f 6465     The shortcode
+000447a0: 206c 6973 7420 6973 2061 7070 6c69 6564   list is applied
+000447b0: 2066 6972 7374 2c20 666f 6c6c 6f77 6564   first, followed
+000447c0: 2062 7920 7468 6520 6669 6c74 6572 2072   by the filter r
+000447d0: 756c 650d 0a0d 0a20 2020 2020 2020 203a  ule....        :
+000447e0: 7061 7261 6d20 6669 6c74 6572 5f72 756c  param filter_rul
+000447f0: 653a 2061 2066 756e 6374 696f 6e20 7468  e: a function th
+00044800: 6174 2074 616b 6573 2061 2053 7472 7563  at takes a Struc
+00044810: 7475 7265 456c 656d 656e 7420 616e 6420  tureElement and 
+00044820: 7265 7475 726e 7320 5472 7565 2069 6620  returns True if 
+00044830: 6974 2069 7320 746f 2062 6520 6b65 7074  it is to be kept
+00044840: 2c20 4661 6c73 652c 206f 7468 6572 7769  , False, otherwi
+00044850: 7365 0d0a 2020 2020 2020 2020 3a70 6172  se..        :par
+00044860: 616d 2073 686f 7274 636f 6465 5f6c 6973  am shortcode_lis
+00044870: 743a 206c 6973 7420 6f66 2073 686f 7274  t: list of short
+00044880: 636f 6465 7320 746f 2062 6520 7573 6564  codes to be used
+00044890: 2074 6f20 6669 6c74 6572 2074 6865 2074   to filter the t
+000448a0: 7265 652c 2061 6c74 6572 6e61 7469 7665  ree, alternative
+000448b0: 2074 6f20 7573 696e 6720 6120 6669 6c74   to using a filt
+000448c0: 6572 2072 756c 650d 0a20 2020 2020 2020  er rule..       
+000448d0: 203a 7061 7261 6d20 6669 6c74 6572 5f69   :param filter_i
+000448e0: 6e3a 2020 2054 7275 6520 6966 2077 6520  n:   True if we 
+000448f0: 7769 7368 2074 6f20 696e 636c 7564 6520  wish to include 
+00044900: 7368 6f72 7463 6f64 6573 2069 6e20 7468  shortcodes in th
+00044910: 6520 7368 6f72 7463 6f64 655f 6c69 7374  e shortcode_list
+00044920: 2c20 4661 6c73 6520 6966 2077 6520 7769  , False if we wi
+00044930: 7368 2074 6f20 6578 636c 7564 6520 7468  sh to exclude th
+00044940: 656d 2066 726f 6d20 7468 6520 7472 6565  em from the tree
+00044950: 0d0a 2020 2020 2020 2020 2727 270d 0a0d  ..        '''...
+00044960: 0a0d 0a20 2020 2020 2020 2066 696c 7465  ...        filte
+00044970: 7265 645f 636f 756e 7420 3d20 2d31 0d0a  red_count = -1..
+00044980: 2020 2020 2020 2020 234b 6565 7020 6669          #Keep fi
+00044990: 6c74 6572 696e 6720 7468 6520 6368 696c  ltering the chil
+000449a0: 6472 656e 2075 6e74 696c 2074 6865 7265  dren until there
+000449b0: 2061 7265 206e 6f20 6669 6c74 6572 696e   are no filterin
+000449c0: 6720 6576 656e 7473 206c 6566 742c 2062  g events left, b
+000449d0: 6566 6f72 6520 6d6f 7669 6e67 206f 6e74  efore moving ont
+000449e0: 6f20 7468 6520 6368 696c 6472 656e 2074  o the children t
+000449f0: 6861 7420 7265 6d61 696e 0d0a 2020 2020  hat remain..    
+00044a00: 2020 2020 7768 696c 6520 6669 6c74 6572      while filter
+00044a10: 6564 5f63 6f75 6e74 2021 3d20 303a 0d0a  ed_count != 0:..
+00044a20: 2020 2020 2020 2020 2020 2020 2372 6573              #res
+00044a30: 7461 7274 2074 6865 2063 6f75 6e74 0d0a  tart the count..
+00044a40: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
+00044a50: 6572 6564 5f63 6f75 6e74 203d 2030 0d0a  ered_count = 0..
+00044a60: 2020 2020 2020 2020 2020 2020 2354 7572              #Tur
+00044a70: 6e20 2e63 6869 6c64 7265 6e20 696e 746f  n .children into
+00044a80: 2061 206c 6973 7420 6265 6361 7573 6520   a list because 
+00044a90: 7765 2061 7265 2063 6861 6e67 696e 6720  we are changing 
+00044aa0: 7468 6520 6368 696c 6472 656e 2061 7320  the children as 
+00044ab0: 7765 206c 6f6f 7020 6f76 6572 2074 6865  we loop over the
+00044ac0: 6d0d 0a20 2020 2020 2020 2020 2020 2066  m..            f
+00044ad0: 6f72 2063 6820 696e 206c 6973 7428 7365  or ch in list(se
+00044ae0: 6c66 2e63 6869 6c64 7265 6e29 3a0d 0a0d  lf.children):...
+00044af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044b00: 2069 6620 7368 6f72 7463 6f64 655f 6c69   if shortcode_li
+00044b10: 7374 2069 7320 6e6f 7420 4e6f 6e65 3a0d  st is not None:.
+00044b20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044b30: 2020 2020 206c 6973 745f 7265 7375 6c74       list_result
+00044b40: 203d 2063 682e 7368 6f72 746e 616d 6520   = ch.shortname 
+00044b50: 696e 2073 686f 7274 636f 6465 5f6c 6973  in shortcode_lis
+00044b60: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+00044b70: 2020 2020 2020 2069 6620 6669 6c74 6572         if filter
+00044b80: 5f69 6e3a 0d0a 2020 2020 2020 2020 2020  _in:..          
+00044b90: 2020 2020 2020 2020 2020 2020 2020 646f                do
+00044ba0: 5f66 696c 7465 725f 6f75 7420 3d20 206e  _filter_out =  n
+00044bb0: 6f74 206c 6973 745f 7265 7375 6c74 0d0a  ot list_result..
+00044bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044bd0: 2020 2020 2020 2020 236c 6f67 2e69 6e66          #log.inf
+00044be0: 6f28 6368 2e73 686f 7274 6e61 6d65 202b  o(ch.shortname +
+00044bf0: 2027 2027 2b73 7472 2864 6f5f 6669 6c74   ' '+str(do_filt
+00044c00: 6572 5f6f 7574 292b 7374 7228 3138 3834  er_out)+str(1884
+00044c10: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+00044c20: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00044c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044c40: 2020 2020 2020 2064 6f5f 6669 6c74 6572         do_filter
+00044c50: 5f6f 7574 203d 2020 6c69 7374 5f72 6573  _out =  list_res
+00044c60: 756c 740d 0a20 2020 2020 2020 2020 2020  ult..           
+00044c70: 2020 2020 2020 2020 2020 2020 2023 6c6f               #lo
+00044c80: 672e 696e 666f 2863 682e 7368 6f72 746e  g.info(ch.shortn
+00044c90: 616d 6520 2b20 2720 272b 7374 7228 646f  ame + ' '+str(do
+00044ca0: 5f66 696c 7465 725f 6f75 7429 2b73 7472  _filter_out)+str
+00044cb0: 2831 3838 3629 290d 0a0d 0a20 2020 2020  (1886))....     
+00044cc0: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
+00044cd0: 6c74 6572 5f72 756c 6520 6973 206e 6f74  lter_rule is not
+00044ce0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00044cf0: 2020 2020 2020 2020 2020 2020 7275 6c65              rule
+00044d00: 5f72 6573 756c 7420 3d20 6669 6c74 6572  _result = filter
+00044d10: 5f72 756c 6528 6368 290d 0a20 2020 2020  _rule(ch)..     
+00044d20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00044d30: 6620 6669 6c74 6572 5f69 6e3a 0d0a 2020  f filter_in:..  
+00044d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044d50: 2020 2020 2020 646f 5f66 696c 7465 725f        do_filter_
+00044d60: 6f75 7420 3d20 6e6f 7420 7275 6c65 5f72  out = not rule_r
+00044d70: 6573 756c 740d 0a20 2020 2020 2020 2020  esult..         
+00044d80: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00044d90: 6c6f 672e 696e 666f 2863 682e 7368 6f72  log.info(ch.shor
+00044da0: 746e 616d 6520 2b20 2720 272b 7374 7228  tname + ' '+str(
+00044db0: 646f 5f66 696c 7465 725f 6f75 7429 2b73  do_filter_out)+s
+00044dc0: 7472 2831 3839 3229 290d 0a20 2020 2020  tr(1892))..     
+00044dd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00044de0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00044df0: 2020 2020 2020 2020 2020 2020 2020 646f                do
+00044e00: 5f66 696c 7465 725f 6f75 7420 3d20 7275  _filter_out = ru
+00044e10: 6c65 5f72 6573 756c 740d 0a20 2020 2020  le_result..     
+00044e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044e30: 2020 2023 6c6f 672e 696e 666f 2863 682e     #log.info(ch.
+00044e40: 7368 6f72 746e 616d 6520 2b20 2720 272b  shortname + ' '+
+00044e50: 7374 7228 646f 5f66 696c 7465 725f 6f75  str(do_filter_ou
+00044e60: 7429 2b73 7472 2831 3839 3629 290d 0a0d  t)+str(1896))...
+00044e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00044e80: 2023 4669 6c74 6572 696e 6720 7468 6520   #Filtering the 
+00044e90: 6368 696c 6472 656e 2069 7320 646f 6e65  children is done
+00044ea0: 2062 7920 6162 6469 6361 7469 6e67 2074   by abdicating t
+00044eb0: 6865 6d2c 2077 6869 6368 206d 6561 6e73  hem, which means
+00044ec0: 2072 656d 6f76 696e 6720 7468 656d 2066   removing them f
+00044ed0: 726f 6d20 7365 6c66 2028 692e 652e 2074  rom self (i.e. t
+00044ee0: 6865 2063 6869 6c64 2773 2070 6172 656e  he child's paren
+00044ef0: 7429 2061 6e64 2070 7574 7469 6e67 2063  t) and putting c
+00044f00: 6869 6c64 7265 6e20 696e 2069 7473 2070  hildren in its p
+00044f10: 6c61 6365 0d0a 2020 2020 2020 2020 2020  lace..          
+00044f20: 2020 2020 2020 6966 2064 6f5f 6669 6c74        if do_filt
+00044f30: 6572 5f6f 7574 3a0d 0a20 2020 2020 2020  er_out:..       
+00044f40: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+00044f50: 7465 7265 645f 636f 756e 742b 3d31 0d0a  tered_count+=1..
+00044f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00044f70: 2020 2020 236c 6f67 2e69 6e66 6f28 2761      #log.info('a
+00044f80: 6264 6963 6174 696e 6720 272b 7365 6c66  bdicating '+self
+00044f90: 2e73 686f 7274 6e61 6d65 2b27 3a27 2b73  .shortname+':'+s
+00044fa0: 7472 2863 682e 7368 6f72 746e 616d 6529  tr(ch.shortname)
+00044fb0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00044fc0: 2020 2020 2020 2063 682e 6162 6469 6361         ch.abdica
+00044fd0: 7465 2829 0d0a 0d0a 2020 2020 2020 2020  te()....        
+00044fe0: 2353 656c 662e 6368 696c 6472 656e 2068  #Self.children h
+00044ff0: 6173 2062 6565 6e20 6669 6c74 6572 6564  as been filtered
+00045000: 206e 6f77 202d 2073 6f20 6669 6c74 6572   now - so filter
+00045010: 2074 6865 206e 6577 2063 6869 6c64 7265   the new childre
+00045020: 6e27 7320 6368 696c 6472 656e 0d0a 2020  n's children..  
+00045030: 2020 2020 2020 666f 7220 6368 2069 6e20        for ch in 
+00045040: 7365 6c66 2e63 6869 6c64 7265 6e3a 0d0a  self.children:..
+00045050: 2020 2020 2020 2020 2020 2020 6368 2e66              ch.f
+00045060: 696c 7465 7228 6669 6c74 6572 5f72 756c  ilter(filter_rul
+00045070: 6520 3d20 6669 6c74 6572 5f72 756c 652c  e = filter_rule,
+00045080: 7368 6f72 7463 6f64 655f 6c69 7374 3d73  shortcode_list=s
+00045090: 686f 7274 636f 6465 5f6c 6973 742c 6669  hortcode_list,fi
+000450a0: 6c74 6572 5f69 6e20 3d20 6669 6c74 6572  lter_in = filter
+000450b0: 5f69 6e29 0d0a 0d0a 2020 2020 2020 2020  _in)....        
+000450c0: 7265 7475 726e 2073 656c 660d 0a0d 0a20  return self.... 
+000450d0: 2020 2064 6566 2062 7573 6869 6679 2873     def bushify(s
+000450e0: 656c 662c 6275 7368 6966 795f 6164 6469  elf,bushify_addi
+000450f0: 7469 6f6e 616c 5f72 756c 653d 6c61 6d62  tional_rule=lamb
+00045100: 6461 2073 653a 5472 7565 293a 0d0a 2020  da se:True):..  
+00045110: 2020 2020 2020 2727 274d 616b 6520 7468        '''Make th
+00045120: 6520 7472 6565 2062 7573 6869 6572 2061  e tree bushier a
+00045130: 6e64 206c 6573 7320 7374 7261 6767 6c79  nd less straggly
+00045140: 2062 7920 7075 7474 696e 6720 7369 6e67   by putting sing
+00045150: 6c65 2063 6869 6c64 7265 6e20 696e 2070  le children in p
+00045160: 6c61 6365 206f 6620 7468 6569 7220 7061  lace of their pa
+00045170: 7265 6e74 730d 0a0d 0a20 2020 2020 2020  rents....       
+00045180: 203a 7061 7261 6d20 6275 7368 6966 795f   :param bushify_
+00045190: 6164 6469 7469 6f6e 616c 5f72 756c 653a  additional_rule:
+000451a0: 2045 7874 7261 2072 756c 6520 746f 2061   Extra rule to a
+000451b0: 7070 6c79 2074 6f20 6465 6369 6465 2069  pply to decide i
+000451c0: 6620 6120 5374 7275 6374 7572 6545 6c65  f a StructureEle
+000451d0: 6d65 6e74 2069 7320 656c 696d 696e 6174  ment is eliminat
+000451e0: 6564 206f 7220 6e6f 740d 0a20 2020 2020  ed or not..     
+000451f0: 2020 2065 2e67 2e0d 0a0d 0a20 2020 2020     e.g.....     
+00045200: 2020 2041 0d0a 2020 2020 2020 2020 2b2d     A..        +-
+00045210: 420d 0a20 2020 2020 2020 207c 202b 2d43  B..        | +-C
+00045220: 0d0a 2020 2020 2020 2020 7c20 2020 2b2d  ..        |   +-
+00045230: 440d 0a20 2020 2020 2020 202b 2d45 0d0a  D..        +-E..
+00045240: 2020 2020 2020 2020 2020 2b2d 460d 0a20            +-F.. 
+00045250: 2020 2020 2020 2020 202b 2d47 0d0a 0d0a           +-G....
+00045260: 2020 2020 2020 2020 6265 636f 6d65 732e          becomes.
+00045270: 2e2e 0d0a 0d0a 2020 2020 2020 2020 410d  ......        A.
+00045280: 0a20 2020 2020 2020 202b 2d44 0d0a 2020  .        +-D..  
+00045290: 2020 2020 2020 2b2d 450d 0a20 2020 2020        +-E..     
+000452a0: 2020 2020 202b 2d46 0d0a 2020 2020 2020       +-F..      
+000452b0: 2020 2020 2b2d 470d 0a0d 0a20 2020 2020      +-G....     
+000452c0: 2020 2065 6c69 6d69 6e61 7469 6e67 2074     eliminating t
+000452d0: 6865 2075 6e6e 6563 6573 7361 7279 2074  he unnecessary t
+000452e0: 6f74 616c 2065 6c65 6d65 6e74 7320 4220  otal elements B 
+000452f0: 616e 6420 430d 0a20 2020 2020 2020 2027  and C..        '
+00045300: 2727 0d0a 0d0a 2020 2020 2020 2020 6966  ''....        if
+00045310: 2073 656c 662e 6973 5f6c 6561 663a 0d0a   self.is_leaf:..
+00045320: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00045330: 726e 2073 656c 660d 0a0d 0a20 2020 2020  rn self....     
+00045340: 2020 2023 6d61 6b65 2063 6869 6c64 7265     #make childre
+00045350: 6e20 696e 746f 2061 206c 6973 7420 6265  n into a list be
+00045360: 6361 7573 6520 7765 2061 7265 2061 626f  cause we are abo
+00045370: 7574 2074 6f20 6368 616e 6765 2074 6865  ut to change the
+00045380: 6d0d 0a20 2020 2020 2020 2066 6f72 2063  m..        for c
+00045390: 6820 696e 206c 6973 7428 7365 6c66 2e63  h in list(self.c
+000453a0: 6869 6c64 7265 6e29 3a0d 0a20 2020 2020  hildren):..     
+000453b0: 2020 2020 2020 2063 682e 6275 7368 6966         ch.bushif
+000453c0: 7928 6275 7368 6966 795f 6164 6469 7469  y(bushify_additi
+000453d0: 6f6e 616c 5f72 756c 653d 6275 7368 6966  onal_rule=bushif
+000453e0: 795f 6164 6469 7469 6f6e 616c 5f72 756c  y_additional_rul
+000453f0: 6529 0d0a 0d0a 2020 2020 2020 2020 2361  e)....        #a
+00045400: 6264 6963 6174 6520 2872 656d 6f76 6520  bdicate (remove 
+00045410: 7365 6c66 2066 726f 6d20 7472 6565 2920  self from tree) 
+00045420: 6966 2079 6f75 2068 6176 6520 6a75 7374  if you have just
+00045430: 206f 6e65 2063 6869 6c64 2061 6e64 2068   one child and h
+00045440: 6176 6520 6120 7061 7265 6e74 0d0a 2020  ave a parent..  
+00045450: 2020 2020 2020 6966 2062 7573 6869 6679        if bushify
+00045460: 5f61 6464 6974 696f 6e61 6c5f 7275 6c65  _additional_rule
+00045470: 2873 656c 6629 2061 6e64 206c 656e 286c  (self) and len(l
+00045480: 6973 7428 7365 6c66 2e63 6869 6c64 7265  ist(self.childre
+00045490: 6e29 2920 3d3d 2031 2061 6e64 2073 656c  n)) == 1 and sel
+000454a0: 662e 7061 7265 6e74 2069 7320 6e6f 7420  f.parent is not 
+000454b0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+000454c0: 2020 2070 6172 656e 7420 3d20 7365 6c66     parent = self
+000454d0: 2e70 6172 656e 740d 0a20 2020 2020 2020  .parent..       
+000454e0: 2020 2020 2073 656c 662e 6162 6469 6361       self.abdica
+000454f0: 7465 2829 0d0a 2020 2020 2020 2020 2020  te()..          
+00045500: 2020 7265 7475 726e 2070 6172 656e 740d    return parent.
+00045510: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00045520: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00045530: 726e 2073 656c 660d 0a0d 0a20 2020 2023  rn self....    #
+00045540: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00045550: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00045560: 2323 2323 2323 2323 2323 2323 0d0a 2020  ############..  
+00045570: 2020 230d 0a20 2020 2023 2044 696d 656e    #..    # Dimen
+00045580: 7369 6f6e 456c 656d 656e 7420 6d61 6e69  sionElement mani
+00045590: 7075 6c61 7469 6f6e 2066 756e 6374 696f  pulation functio
+000455a0: 6e73 0d0a 2020 2020 230d 0a20 2020 2023  ns..    #..    #
+000455b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000455c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000455d0: 2323 2323 2323 2323 2323 2323 0d0a 0d0a  ############....
+000455e0: 2020 2020 6465 6620 636f 6e73 6f6c 6964      def consolid
+000455f0: 6174 6528 7365 6c66 293a 0d0a 2020 2020  ate(self):..    
+00045600: 2020 2020 2727 2743 7265 6174 6520 6120      '''Create a 
+00045610: 636f 6e73 6f6c 6964 6174 696f 6e20 6361  consolidation ca
+00045620: 6c63 756c 6174 696f 6e2c 2061 6e64 2073  lculation, and s
+00045630: 6574 2074 6865 2075 6e64 6572 6c79 696e  et the underlyin
+00045640: 6720 456c 656d 656e 7427 7320 6361 6c63  g Element's calc
+00045650: 756c 6174 696f 6e20 746f 2074 6865 2073  ulation to the s
+00045660: 7061 7273 6520 7375 6d20 6f66 2074 6865  parse sum of the
+00045670: 2063 6869 6c64 7265 6e0d 0a20 2020 2020   children..     
+00045680: 2020 2027 2727 0d0a 0d0a 2020 2020 2020     '''....      
+00045690: 2020 666f 7220 656c 2069 6e20 7365 6c66    for el in self
+000456a0: 2e63 6869 6c64 7265 6e3a 0d0a 2020 2020  .children:..    
+000456b0: 2020 2020 2020 2020 6966 2065 6c2e 7068          if el.ph
+000456c0: 7973 6964 2069 7320 4e6f 6e65 3a0d 0a20  ysid is None:.. 
+000456d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000456e0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+000456f0: 272e 636f 6e73 6f6c 6964 6174 6520 6361  '.consolidate ca
+00045700: 6e6e 6f74 2062 6520 7275 6e20 756e 7469  nnot be run unti
+00045710: 6c20 6368 696c 6420 7068 7973 6964 7320  l child physids 
+00045720: 6861 7665 2062 6565 6e20 7365 7427 290d  have been set').
+00045730: 0a0d 0a20 2020 2020 2020 2063 6f6e 736f  ...        conso
+00045740: 6c69 6461 7469 6f6e 5f63 616c 6375 6c61  lidation_calcula
+00045750: 7469 6f6e 5f73 7472 696e 6720 3d20 2720  tion_string = ' 
+00045760: 7c20 272e 6a6f 696e 285b 7374 7228 656c  | '.join([str(el
+00045770: 2e73 686f 7274 6e61 6d65 2920 666f 7220  .shortname) for 
+00045780: 656c 2069 6e20 7365 6c66 2e63 6869 6c64  el in self.child
+00045790: 7265 6e5d 290d 0a20 2020 2020 2020 2023  ren])..        #
+000457a0: 4372 6561 7465 2061 2070 6879 7369 6420  Create a physid 
+000457b0: 6361 6c63 756c 6174 696f 6e20 2d20 7765  calculation - we
+000457c0: 2063 616e 2774 2075 706c 6f61 6420 7468   can't upload th
+000457d0: 6973 2c20 6275 7420 7765 2063 616e 2063  is, but we can c
+000457e0: 6f6d 7061 7265 2074 6f20 7468 6520 456d  ompare to the Em
+000457f0: 706f 7765 7220 7665 7273 696f 6e2c 2074  power version, t
+00045800: 6f20 7374 6f70 2075 6e6e 6563 6573 7361  o stop unnecessa
+00045810: 7279 2063 616c 6375 6c61 7469 6f6e 2075  ry calculation u
+00045820: 7064 6174 6573 0d0a 2020 2020 2020 2020  pdates..        
+00045830: 7068 7973 6964 5f63 6f6e 736f 6c69 6461  physid_consolida
+00045840: 7469 6f6e 5f63 616c 6375 6c61 7469 6f6e  tion_calculation
+00045850: 5f73 7472 696e 6720 3d20 2720 7c20 272e  _string = ' | '.
+00045860: 6a6f 696e 285b 2740 272b 7374 7228 656c  join(['@'+str(el
+00045870: 2e70 6879 7369 6429 2066 6f72 2065 6c20  .physid) for el 
+00045880: 696e 2073 656c 662e 6368 696c 6472 656e  in self.children
+00045890: 5d29 0d0a 0d0a 2020 2020 2020 2020 2353  ])....        #S
+000458a0: 6574 2074 6865 2070 6879 7369 6420 6361  et the physid ca
+000458b0: 6c63 756c 6174 696f 6e20 7374 7269 6e67  lculation string
+000458c0: 2c20 7768 6963 6820 7769 6c6c 2062 6520  , which will be 
+000458d0: 7468 6520 6f6e 6520 7468 6174 2045 6d70  the one that Emp
+000458e0: 6f77 6572 2065 7870 6f72 7473 2d20 7468  ower exports- th
+000458f0: 6973 2077 6173 7920 7765 2064 6f6e 2774  is wasy we don't
+00045900: 2068 6176 6520 746f 2074 7269 6767 6572   have to trigger
+00045910: 2061 6e20 7570 6461 7465 0d0a 2020 2020   an update..    
+00045920: 2020 2020 2369 6620 7468 650d 0a20 2020      #if the..   
+00045930: 2020 2020 2073 656c 662e 656c 656d 656e       self.elemen
+00045940: 742e 5f70 6879 7369 645f 6361 6c63 756c  t._physid_calcul
+00045950: 6174 696f 6e20 3d20 7068 7973 6964 5f63  ation = physid_c
+00045960: 6f6e 736f 6c69 6461 7469 6f6e 5f63 616c  onsolidation_cal
+00045970: 6375 6c61 7469 6f6e 5f73 7472 696e 670d  culation_string.
+00045980: 0a20 2020 2020 2020 2073 656c 662e 656c  .        self.el
+00045990: 656d 656e 742e 6361 6c63 756c 6174 696f  ement.calculatio
+000459a0: 6e20 3d20 636f 6e73 6f6c 6964 6174 696f  n = consolidatio
+000459b0: 6e5f 6361 6c63 756c 6174 696f 6e5f 7374  n_calculation_st
+000459c0: 7269 6e67 0d0a 0d0a 0d0a 2020 2020 6465  ring......    de
+000459d0: 6620 7472 6963 6b6c 655f 646f 776e 5f66  f trickle_down_f
+000459e0: 6965 6c64 2873 656c 662c 6669 656c 646e  ield(self,fieldn
+000459f0: 616d 652c 7661 6c75 6529 3a0d 0a20 2020  ame,value):..   
+00045a00: 2020 2020 2027 2727 5365 7420 7468 6520       '''Set the 
+00045a10: 7661 6c75 6520 6f66 2061 2066 6965 6c64  value of a field
+00045a20: 206f 6e20 7468 6973 2053 7472 7563 7475   on this Structu
+00045a30: 7265 456c 656d 656e 7420 616e 6420 616c  reElement and al
+00045a40: 6c20 6974 7320 6465 7363 656e 6465 6e74  l its descendent
+00045a50: 730d 0a0d 0a20 2020 2020 2020 203a 7061  s....        :pa
+00045a60: 7261 6d20 6669 656c 646e 616d 653a 204e  ram fieldname: N
+00045a70: 616d 6520 6f66 2074 6865 2045 6c65 6d65  ame of the Eleme
+00045a80: 6e74 2066 6965 6c64 2074 6861 7420 7765  nt field that we
+00045a90: 2077 616e 7420 746f 2073 6574 0d0a 2020   want to set..  
+00045aa0: 2020 2020 2020 3a70 6172 616d 2076 616c        :param val
+00045ab0: 7565 3a20 5661 6c75 6520 7765 2077 616e  ue: Value we wan
+00045ac0: 7420 746f 2073 6574 2074 6865 2065 6c65  t to set the ele
+00045ad0: 6d65 6e74 2066 6965 6c64 2074 6f0d 0a20  ment field to.. 
+00045ae0: 2020 2020 2020 2027 2727 0d0a 2020 2020         '''..    
+00045af0: 2020 2020 666f 7220 6368 2069 6e20 7365      for ch in se
+00045b00: 6c66 2e63 6869 6c64 7265 6e3a 0d0a 2020  lf.children:..  
+00045b10: 2020 2020 2020 2020 2020 6368 2e65 6c65            ch.ele
+00045b20: 6d65 6e74 2e66 6965 6c64 735b 6669 656c  ment.fields[fiel
+00045b30: 646e 616d 655d 203d 2076 616c 7565 0d0a  dname] = value..
+00045b40: 2020 2020 2020 2020 2020 2020 6368 2e74              ch.t
+00045b50: 7269 636b 6c65 5f64 6f77 6e5f 6669 656c  rickle_down_fiel
+00045b60: 6428 6669 656c 646e 616d 653d 6669 656c  d(fieldname=fiel
+00045b70: 646e 616d 652c 7661 6c75 653d 7661 6c75  dname,value=valu
+00045b80: 6529 0d0a 0d0a 2020 2020 234f 6c64 2073  e)....    #Old s
+00045b90: 796e 6f6e 796d 0d0a 2020 2020 6465 6620  ynonym..    def 
+00045ba0: 7472 6963 6b6c 655f 646f 776e 5f66 6965  trickle_down_fie
+00045bb0: 6c64 7328 7365 6c66 2c66 6965 6c64 6e61  lds(self,fieldna
+00045bc0: 6d65 2c76 616c 7565 293a 0d0a 2020 2020  me,value):..    
+00045bd0: 2020 2020 2727 2744 6570 7265 6361 7465      '''Deprecate
+00045be0: 642e 2055 7365 2074 7269 636b 6c65 5f64  d. Use trickle_d
+00045bf0: 6f77 6e5f 6669 656c 6428 2920 696e 7374  own_field() inst
+00045c00: 6561 6427 2727 0d0a 2020 2020 2020 2020  ead'''..        
+00045c10: 7265 7475 726e 2073 656c 662e 7472 6963  return self.tric
+00045c20: 6b6c 655f 646f 776e 5f66 6965 6c64 2866  kle_down_field(f
+00045c30: 6965 6c64 6e61 6d65 2c76 616c 7565 290d  ieldname,value).
+00045c40: 0a0d 0a20 2020 2064 6566 205f 646f 5f73  ...    def _do_s
+00045c50: 696e 676c 655f 736c 7572 7028 7365 6c66  ingle_slurp(self
+00045c60: 2c66 6965 6c64 6e61 6d65 2c6f 7074 696d  ,fieldname,optim
+00045c70: 6973 6174 696f 6e5f 6c6f 6f6b 7570 293a  isation_lookup):
+00045c80: 0d0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+00045c90: 2073 656c 662e 6973 5f6c 6561 663a 0d0a   self.is_leaf:..
+00045ca0: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+00045cb0: 6e74 2827 536c 7572 7069 6e67 2043 6869  nt('Slurping Chi
+00045cc0: 6c64 7265 6e27 290d 0a20 2020 2020 2020  ldren')..       
+00045cd0: 2020 2020 2063 6869 6c64 6669 656c 6473       childfields
+00045ce0: 203d 205b 6368 2e73 6c75 7270 5f75 705f   = [ch.slurp_up_
+00045cf0: 6669 656c 6428 6669 656c 646e 616d 653d  field(fieldname=
+00045d00: 6669 656c 646e 616d 652c 6f70 7469 6d69  fieldname,optimi
+00045d10: 7361 7469 6f6e 5f6c 6f6f 6b75 703d 6f70  sation_lookup=op
+00045d20: 7469 6d69 7361 7469 6f6e 5f6c 6f6f 6b75  timisation_looku
+00045d30: 7029 2066 6f72 2063 6820 696e 2073 656c  p) for ch in sel
+00045d40: 662e 6368 696c 6472 656e 5d0d 0a20 2020  f.children]..   
+00045d50: 2020 2020 2020 2020 2023 2346 696c 7465           ##Filte
+00045d60: 7220 6669 656c 6473 2073 6574 2074 6f20  r fields set to 
+00045d70: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+00045d80: 2020 2363 6869 6c64 6669 656c 6473 203d    #childfields =
+00045d90: 205b 736c 7572 705f 6368 696c 6466 6965   [slurp_childfie
+00045da0: 6c64 2066 6f72 2073 6c75 7270 5f63 6869  ld for slurp_chi
+00045db0: 6c64 6669 656c 6420 696e 2063 6869 6c64  ldfield in child
+00045dc0: 6669 656c 6473 2069 6620 736c 7572 705f  fields if slurp_
+00045dd0: 6368 696c 6466 6965 6c64 2069 7320 6e6f  childfield is no
+00045de0: 7420 4e6f 6e65 5d0d 0a20 2020 2020 2020  t None]..       
+00045df0: 2020 2020 2023 5265 7475 726e 204e 6f6e       #Return Non
+00045e00: 6520 6966 2066 6965 6c64 2076 616c 7565  e if field value
+00045e10: 7320 696e 2063 6869 6c64 7265 6e20 646f  s in children do
+00045e20: 6e27 7420 6d61 7463 680d 0a20 2020 2020  n't match..     
+00045e30: 2020 2020 2020 2069 6620 6c65 6e28 7365         if len(se
+00045e40: 7428 6368 696c 6466 6965 6c64 7329 2920  t(childfields)) 
+00045e50: 3d3d 2031 3a0d 0a20 2020 2020 2020 2020  == 1:..         
+00045e60: 2020 2020 2020 2073 656c 662e 6669 656c         self.fiel
+00045e70: 6473 5b66 6965 6c64 6e61 6d65 5d20 3d20  ds[fieldname] = 
+00045e80: 6368 696c 6466 6965 6c64 735b 305d 0d0a  childfields[0]..
+00045e90: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00045ea0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00045eb0: 2020 2073 656c 662e 6669 656c 6473 5b66     self.fields[f
+00045ec0: 6965 6c64 6e61 6d65 5d20 3d20 4e6f 6e65  ieldname] = None
+00045ed0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00045ee0: 2369 6620 7365 6c66 2e73 686f 7274 636f  #if self.shortco
+00045ef0: 6465 2069 6e20 5b27 4f4e 554b 4327 2c27  de in ['ONUKC','
+00045f00: 4f4e 4456 4127 2c27 4f4e 5348 4249 275d  ONDVA','ONSHBI']
+00045f10: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00045f20: 2020 2020 7072 696e 7428 2753 4554 5449      print('SETTI
+00045f30: 4e47 3a20 2027 2c73 656c 662e 616e 6365  NG:  ',self.ance
+00045f40: 7374 6f72 735f 7374 7269 6e67 2c73 656c  stors_string,sel
+00045f50: 662e 6669 656c 6473 5b66 6965 6c64 6e61  f.fields[fieldna
+00045f60: 6d65 5d29 0d0a 0d0a 2020 2020 2020 2020  me])....        
+00045f70: 2369 6620 7365 6c66 2e73 686f 7274 636f  #if self.shortco
+00045f80: 6465 2069 6e20 5b27 4f4e 554b 4327 2c27  de in ['ONUKC','
+00045f90: 4f4e 4456 4127 2c27 4f4e 5348 4249 275d  ONDVA','ONSHBI']
+00045fa0: 3a0d 0a20 2020 2020 2020 2023 2020 2020  :..        #    
+00045fb0: 7072 696e 7428 2753 4554 3a20 2027 2c73  print('SET:  ',s
+00045fc0: 656c 662e 616e 6365 7374 6f72 735f 7374  elf.ancestors_st
+00045fd0: 7269 6e67 2c73 656c 662e 6669 656c 6473  ring,self.fields
+00045fe0: 5b66 6965 6c64 6e61 6d65 5d29 0d0a 0d0a  [fieldname])....
+00045ff0: 0d0a 2020 2020 6465 6620 736c 7572 705f  ..    def slurp_
+00046000: 7570 5f66 6965 6c64 2873 656c 662c 6669  up_field(self,fi
+00046010: 656c 646e 616d 652c 6f70 7469 6d69 7361  eldname,optimisa
+00046020: 7469 6f6e 5f6c 6f6f 6b75 703d 7b7d 293a  tion_lookup={}):
+00046030: 0d0a 2020 2020 2020 2020 2727 2746 726f  ..        '''Fro
+00046040: 6d20 7468 6520 6c65 6176 6573 206f 6620  m the leaves of 
+00046050: 6120 5374 7275 6374 7572 6545 6c65 6d65  a StructureEleme
+00046060: 6e74 2074 6f20 7468 6174 2053 7472 7563  nt to that Struc
+00046070: 7475 7265 456c 656d 656e 742c 2063 6f70  tureElement, cop
+00046080: 7920 7468 6520 7661 6c75 6520 696e 2074  y the value in t
+00046090: 6865 2063 6869 6c64 7265 6e27 7320 6669  he children's fi
+000460a0: 656c 6420 746f 2074 6865 2070 6172 656e  eld to the paren
+000460b0: 7420 5374 7275 6374 7572 6545 6c65 6d65  t StructureEleme
+000460c0: 6e74 2773 2066 6965 6c64 2c20 6966 2061  nt's field, if a
+000460d0: 6e64 206f 6e6c 7920 6966 2061 6c6c 206f  nd only if all o
+000460e0: 6620 7468 6520 6669 656c 6473 206f 6e20  f the fields on 
+000460f0: 7468 6520 6368 696c 6472 656e 206d 6174  the children mat
+00046100: 6368 2e0d 0a0d 0a20 2020 2020 2020 203a  ch.....        :
+00046110: 6669 656c 646e 616d 653a 2054 6865 206e  fieldname: The n
+00046120: 616d 6520 6f66 2074 6865 2066 6965 6c64  ame of the field
+00046130: 2077 686f 7320 7661 6c75 6573 2077 6520   whos values we 
+00046140: 7761 6e74 2063 6f70 6965 6420 7570 2074  want copied up t
+00046150: 6865 2053 7472 7563 7475 7265 0d0a 2020  he Structure..  
+00046160: 2020 2020 2020 2727 270d 0a20 2020 2020        '''..     
+00046170: 2020 2069 6620 6f70 7469 6d69 7361 7469     if optimisati
+00046180: 6f6e 5f6c 6f6f 6b75 7020 6973 206e 6f74  on_lookup is not
+00046190: 204e 6f6e 653a 0d0a 0d0a 2020 2020 2020   None:....      
+000461a0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+000461b0: 2020 2020 2020 2020 2020 2020 2369 6620              #if 
+000461c0: 7365 6c66 2e73 686f 7274 636f 6465 2069  self.shortcode i
+000461d0: 6e20 5b27 4f4e 554b 4327 2c27 4f4e 4456  n ['ONUKC','ONDV
+000461e0: 4127 2c27 4f4e 5348 4249 275d 3a0d 0a20  A','ONSHBI']:.. 
+000461f0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00046200: 2020 2020 7072 696e 7428 2750 4154 483a      print('PATH:
+00046210: 2027 2c73 656c 662e 7061 7468 290d 0a20   ',self.path).. 
+00046220: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00046230: 6966 2073 656c 662e 7368 6f72 7463 6f64  if self.shortcod
+00046240: 6520 696e 205b 274f 4e55 4b43 272c 274f  e in ['ONUKC','O
+00046250: 4e44 5641 272c 274f 4e53 4842 4927 5d3a  NDVA','ONSHBI']:
+00046260: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00046270: 2020 2320 2020 2070 7269 6e74 2827 5452    #    print('TR
+00046280: 593a 2020 272c 7365 6c66 2e61 6e63 6573  Y:  ',self.ances
+00046290: 746f 7273 5f73 7472 696e 6729 0d0a 2020  tors_string)..  
+000462a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000462b0: 7476 616c 203d 206f 7074 696d 6973 6174  tval = optimisat
+000462c0: 696f 6e5f 6c6f 6f6b 7570 5b73 656c 662e  ion_lookup[self.
+000462d0: 7061 7468 5d0d 0a20 2020 2020 2020 2020  path]..         
+000462e0: 2020 2020 2020 2023 6966 2073 656c 662e         #if self.
+000462f0: 7368 6f72 7463 6f64 6520 696e 205b 274f  shortcode in ['O
+00046300: 4e55 4b43 272c 274f 4e44 5641 272c 274f  NUKC','ONDVA','O
+00046310: 4e53 4842 4927 5d3a 0d0a 2020 2020 2020  NSHBI']:..      
+00046320: 2020 2020 2020 2020 2020 2320 2020 2070            #    p
+00046330: 7269 6e74 2827 4c4b 503a 2020 272c 7365  rint('LKP:  ',se
+00046340: 6c66 2e61 6e63 6573 746f 7273 5f73 7472  lf.ancestors_str
+00046350: 696e 672c 7265 7476 616c 290d 0a20 2020  ing,retval)..   
+00046360: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00046370: 7572 6e20 7265 7476 616c 0d0a 0d0a 2020  urn retval....  
+00046380: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00046390: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
+000463a0: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+000463b0: 6e74 2827 7b7d 2069 736c 6561 6620 7b7d  nt('{} isleaf {}
+000463c0: 272e 666f 726d 6174 2873 656c 662e 7368  '.format(self.sh
+000463d0: 6f72 7463 6f64 652c 2020 7365 6c66 2e69  ortcode,  self.i
+000463e0: 735f 6c65 6166 2929 0d0a 2020 2020 2020  s_leaf))..      
+000463f0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00046400: 646f 5f73 696e 676c 655f 736c 7572 7028  do_single_slurp(
+00046410: 6669 656c 646e 616d 652c 6f70 7469 6d69  fieldname,optimi
+00046420: 7361 7469 6f6e 5f6c 6f6f 6b75 7029 0d0a  sation_lookup)..
+00046430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046440: 2369 6620 7365 6c66 2e73 686f 7274 636f  #if self.shortco
+00046450: 6465 2069 6e20 5b27 4f4e 554b 4327 2c27  de in ['ONUKC','
+00046460: 4f4e 4456 4127 2c27 4f4e 5348 4249 275d  ONDVA','ONSHBI']
+00046470: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00046480: 2020 2023 2020 2020 7072 696e 7428 2753     #    print('S
+00046490: 4c52 503a 2027 2c73 656c 662e 616e 6365  LRP: ',self.ance
+000464a0: 7374 6f72 735f 7374 7269 6e67 2c73 656c  stors_string,sel
+000464b0: 662e 6669 656c 6473 5b66 6965 6c64 6e61  f.fields[fieldna
+000464c0: 6d65 5d29 0d0a 2020 2020 2020 2020 2020  me])..          
+000464d0: 2020 2020 2020 6f70 7469 6d69 7361 7469        optimisati
+000464e0: 6f6e 5f6c 6f6f 6b75 705b 7365 6c66 2e70  on_lookup[self.p
+000464f0: 6174 685d 203d 2073 656c 662e 6669 656c  ath] = self.fiel
+00046500: 6473 5b66 6965 6c64 6e61 6d65 5d0d 0a20  ds[fieldname].. 
+00046510: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00046520: 6574 7572 6e20 7365 6c66 2e66 6965 6c64  eturn self.field
+00046530: 735b 6669 656c 646e 616d 655d 0d0a 0d0a  s[fieldname]....
+00046540: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00046550: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00046560: 5f64 6f5f 7369 6e67 6c65 5f73 6c75 7270  _do_single_slurp
+00046570: 2866 6965 6c64 6e61 6d65 2c6f 7074 696d  (fieldname,optim
+00046580: 6973 6174 696f 6e5f 6c6f 6f6b 7570 290d  isation_lookup).
+00046590: 0a20 2020 2020 2020 2020 2020 2023 6966  .            #if
+000465a0: 2073 656c 662e 7368 6f72 7463 6f64 6520   self.shortcode 
+000465b0: 696e 205b 274f 4e55 4b43 272c 274f 4e44  in ['ONUKC','OND
+000465c0: 5641 272c 274f 4e53 4842 4927 5d3a 0d0a  VA','ONSHBI']:..
+000465d0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
+000465e0: 2070 7269 6e74 2827 534c 5250 3a20 272c   print('SLRP: ',
+000465f0: 7365 6c66 2e61 6e63 6573 746f 7273 5f73  self.ancestors_s
+00046600: 7472 696e 672c 7365 6c66 2e66 6965 6c64  tring,self.field
+00046610: 735b 6669 656c 646e 616d 655d 290d 0a20  s[fieldname]).. 
+00046620: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00046630: 6e20 7365 6c66 2e66 6965 6c64 735b 6669  n self.fields[fi
+00046640: 656c 646e 616d 655d 0d0a 0d0a 2020 2020  eldname]....    
+00046650: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00046660: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00046670: 2323 2323 2323 2323 2323 2323 230d 0a20  #############.. 
+00046680: 2020 2023 0d0a 2020 2020 2320 436f 6d70     #..    # Comp
+00046690: 6172 6973 6f6e 0d0a 2020 2020 230d 0a20  arison..    #.. 
+000466a0: 2020 2023 2323 2323 2323 2323 2323 2323     #############
+000466b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000466c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000466d0: 0d0a 0d0a 2020 2020 6465 6620 636f 6d70  ....    def comp
+000466e0: 6172 6528 7365 6c66 2c6f 7468 6572 2c73  are(self,other,s
+000466f0: 686f 7274 636f 6465 5f74 7261 6e73 6c61  hortcode_transla
+00046700: 7469 6f6e 733d 4e6f 6e65 2c72 6576 6572  tions=None,rever
+00046710: 7365 5f74 7261 6e73 6c61 7469 6f6e 733d  se_translations=
+00046720: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
+00046730: 2727 270d 0a20 2020 2020 2020 2043 6f6d  '''..        Com
+00046740: 7061 7265 2074 6869 7320 5374 7275 6374  pare this Struct
+00046750: 7572 6545 6c65 6d65 6e74 2074 6f20 616e  ureElement to an
+00046760: 6f74 6865 722c 2065 7373 656e 7469 616c  other, essential
+00046770: 6c79 2064 6f69 6e67 2061 2064 6966 660d  ly doing a diff.
+00046780: 0a20 2020 2020 2020 2041 6c73 6f20 6765  .        Also ge
+00046790: 7420 6120 6c69 7374 206f 6620 6e65 772c  t a list of new,
+000467a0: 206d 6f76 6564 2061 6e64 2072 656d 6f76   moved and remov
+000467b0: 6564 2065 6c65 6d65 6e74 730d 0a0d 0a20  ed elements.... 
+000467c0: 2020 2020 2020 2052 6574 7572 6e20 6120         Return a 
+000467d0: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+000467e0: 436f 6d70 6172 6973 6f6e 206f 626a 6563  Comparison objec
+000467f0: 740d 0a0d 0a20 2020 2020 2020 203a 7061  t....        :pa
+00046800: 7261 6d20 6f74 6865 723a 2053 7472 7563  ram other: Struc
+00046810: 7475 7265 456c 656d 656e 7420 746f 2063  tureElement to c
+00046820: 6f6d 7061 7265 2073 656c 6620 746f 0d0a  ompare self to..
+00046830: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+00046840: 686f 7274 636f 6465 5f74 7261 6e73 6c61  hortcode_transla
+00046850: 7469 6f6e 733a 2064 6963 7469 6f6e 6172  tions: dictionar
+00046860: 7920 666f 7220 7472 616e 736c 6174 696e  y for translatin
+00046870: 6720 7368 6f72 7463 6f64 6573 206f 6620  g shortcodes of 
+00046880: 226f 7468 6572 2220 7374 7275 6374 7572  "other" structur
+00046890: 6520 656c 656d 656e 7473 2074 6f20 7368  e elements to sh
+000468a0: 6f72 7463 6f64 6573 206f 6620 2273 656c  ortcodes of "sel
+000468b0: 6622 2073 7472 7563 7475 7265 2065 6c65  f" structure ele
+000468c0: 6d65 6e74 732c 2073 6f20 7468 6174 2073  ments, so that s
+000468d0: 696d 696c 6172 2068 6965 7261 7263 6869  imilar hierarchi
+000468e0: 6573 2063 616e 2062 6520 636f 6d70 6172  es can be compar
+000468f0: 6564 2065 6666 6963 6965 6e74 6c79 0d0a  ed efficiently..
+00046900: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
+00046910: 6576 6572 7365 5f74 7261 6e73 6c61 7469  everse_translati
+00046920: 6f6e 733a 2059 6f75 2073 686f 756c 646e  ons: You shouldn
+00046930: 2774 206e 6565 6420 746f 2073 7065 6369  't need to speci
+00046940: 6679 2074 6869 732e 2049 7420 6578 6973  fy this. It exis
+00046950: 7473 2073 6f20 7468 6174 2077 6520 646f  ts so that we do
+00046960: 6e27 7420 6861 7665 2074 6f20 6361 6c63  n't have to calc
+00046970: 756c 6174 6520 7468 6520 7265 7665 7273  ulate the revers
+00046980: 6520 7472 616e 736c 6174 696f 6e20 666f  e translation fo
+00046990: 7220 6576 6572 7920 5f72 6563 7572 7369  r every _recursi
+000469a0: 7665 5f20 6361 6c6c 206f 6620 7468 6973  ve_ call of this
+000469b0: 2066 756e 6374 696f 6e0d 0a20 2020 2020   function..     
+000469c0: 2020 2027 2727 0d0a 0d0a 2020 2020 2020     '''....      
+000469d0: 2020 6966 2073 686f 7274 636f 6465 5f74    if shortcode_t
+000469e0: 7261 6e73 6c61 7469 6f6e 7320 6973 204e  ranslations is N
+000469f0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00046a00: 2020 7368 6f72 7463 6f64 655f 7472 616e    shortcode_tran
+00046a10: 736c 6174 696f 6e73 203d 207b 7d0d 0a0d  slations = {}...
+00046a20: 0a20 2020 2020 2020 2023 4173 2061 6e20  .        #As an 
+00046a30: 6164 6465 6e64 756d 2074 6f20 7468 6520  addendum to the 
+00046a40: 6469 6666 206c 6f6f 6b20 666f 720d 0a20  diff look for.. 
+00046a50: 2020 2020 2020 2023 202b 204e 6577 2045         # + New E
+00046a60: 6c65 6d65 6e74 7320 286c 6561 6620 616e  lements (leaf an
+00046a70: 6420 6e6f 6e2d 6c65 6166 290d 0a20 2020  d non-leaf)..   
+00046a80: 2020 2020 2023 202b 206d 6f76 6564 2065       # + moved e
+00046a90: 6c65 6d65 6e74 7328 2920 2d20 7765 206d  lements() - we m
+00046aa0: 6179 206e 6565 6420 7468 6520 6469 6666  ay need the diff
+00046ab0: 2074 6f20 6765 7420 7468 6973 2072 6967   to get this rig
+00046ac0: 6874 0d0a 2020 2020 2020 2020 2320 2b20  ht..        # + 
+00046ad0: 5265 6d6f 7665 6420 456c 656d 656e 7473  Removed Elements
+00046ae0: 2028 6c65 6166 2061 6e64 206e 6f6e 2d6c   (leaf and non-l
+00046af0: 6561 6629 0d0a 0d0a 2020 2020 2020 2020  eaf)....        
+00046b00: 7365 6c66 5f65 6c65 6d65 6e74 5f6c 6f6f  self_element_loo
+00046b10: 6b75 7020 203d 207b 7d0d 0a20 2020 2020  kup  = {}..     
+00046b20: 2020 206f 7468 6572 5f65 6c65 6d65 6e74     other_element
+00046b30: 5f6c 6f6f 6b75 7020 3d20 7b7d 0d0a 0d0a  _lookup = {}....
+00046b40: 2020 2020 2020 2020 666f 7220 7365 2069          for se i
+00046b50: 6e20 7365 6c66 2e77 616c 6b28 293a 0d0a  n self.walk():..
+00046b60: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00046b70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00046b80: 2020 7365 6c66 5f65 6c65 6d65 6e74 5f6c    self_element_l
+00046b90: 6f6f 6b75 705b 7365 2e73 686f 7274 636f  ookup[se.shortco
+00046ba0: 6465 5d2e 6170 7065 6e64 2873 6529 0d0a  de].append(se)..
+00046bb0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00046bc0: 7074 204b 6579 4572 726f 723a 0d0a 2020  pt KeyError:..  
+00046bd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00046be0: 6c66 5f65 6c65 6d65 6e74 5f6c 6f6f 6b75  lf_element_looku
+00046bf0: 705b 7365 2e73 686f 7274 636f 6465 5d20  p[se.shortcode] 
+00046c00: 3d20 5b73 655d 0d0a 0d0a 2020 2020 2020  = [se]....      
+00046c10: 2020 666f 7220 7365 2069 6e20 6f74 6865    for se in othe
+00046c20: 722e 7761 6c6b 2829 3a0d 0a20 2020 2020  r.walk():..     
+00046c30: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+00046c40: 2020 2020 2020 2020 2020 2020 206f 7468               oth
+00046c50: 6572 5f65 6c65 6d65 6e74 5f6c 6f6f 6b75  er_element_looku
+00046c60: 705b 7365 2e73 686f 7274 636f 6465 5d2e  p[se.shortcode].
+00046c70: 6170 7065 6e64 2873 6529 0d0a 2020 2020  append(se)..    
+00046c80: 2020 2020 2020 2020 6578 6365 7074 204b          except K
+00046c90: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
+00046ca0: 2020 2020 2020 2020 2020 6f74 6865 725f            other_
+00046cb0: 656c 656d 656e 745f 6c6f 6f6b 7570 5b73  element_lookup[s
+00046cc0: 652e 7368 6f72 7463 6f64 655d 203d 205b  e.shortcode] = [
+00046cd0: 7365 5d0d 0a0d 0a20 2020 2020 2020 206e  se]....        n
+00046ce0: 6577 5f65 6c65 6d65 6e74 7320 3d20 5b5d  ew_elements = []
+00046cf0: 0d0a 2020 2020 2020 2020 6d6f 7665 645f  ..        moved_
+00046d00: 6f72 5f72 656d 6f76 6564 5f65 6c65 6d65  or_removed_eleme
+00046d10: 6e74 7320 3d20 5b5d 0d0a 2020 2020 2020  nts = []..      
+00046d20: 2020 7265 6d6f 7665 645f 656c 656d 656e    removed_elemen
+00046d30: 7473 203d 205b 5d0d 0a0d 0a20 2020 2020  ts = []....     
+00046d40: 2020 2069 6620 7265 7665 7273 655f 7472     if reverse_tr
+00046d50: 616e 736c 6174 696f 6e73 2069 7320 4e6f  anslations is No
+00046d60: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00046d70: 2023 4c6f 6f6b 2075 7020 746f 2073 6565   #Look up to see
+00046d80: 2069 6620 656c 656d 656e 7473 2077 6974   if elements wit
+00046d90: 6820 7468 6520 7368 6f72 7463 6f64 6520  h the shortcode 
+00046da0: 696e 2074 6869 7320 5374 7275 6374 7572  in this Structur
+00046db0: 6545 6c65 6d65 6e74 2065 7869 7374 2069  eElement exist i
+00046dc0: 6e20 7468 6520 6f74 6865 7220 7374 7275  n the other stru
+00046dd0: 6374 7572 6520 656c 656d 656e 740d 0a20  cture element.. 
+00046de0: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+00046df0: 656c 665f 7368 6f72 7463 6f64 652c 2065  elf_shortcode, e
+00046e00: 6c65 6d65 6e74 735f 7769 7468 5f73 686f  lements_with_sho
+00046e10: 7274 636f 6465 2069 6e20 7365 6c66 5f65  rtcode in self_e
+00046e20: 6c65 6d65 6e74 5f6c 6f6f 6b75 702e 6974  lement_lookup.it
+00046e30: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
+00046e40: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00046e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046e60: 2020 6f74 6865 725f 656c 656d 656e 7473    other_elements
+00046e70: 203d 206f 7468 6572 5f65 6c65 6d65 6e74   = other_element
+00046e80: 5f6c 6f6f 6b75 705b 7365 6c66 5f73 686f  _lookup[self_sho
+00046e90: 7274 636f 6465 5d0d 0a20 2020 2020 2020  rtcode]..       
+00046ea0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00046eb0: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
+00046ec0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00046ed0: 656d 6f76 6564 5f65 6c65 6d65 6e74 7320  emoved_elements 
+00046ee0: 2b3d 2065 6c65 6d65 6e74 735f 7769 7468  += elements_with
+00046ef0: 5f73 686f 7274 636f 6465 0d0a 2020 2020  _shortcode..    
+00046f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00046f10: 636f 6e74 696e 7565 0d0a 2020 2020 2020  continue..      
+00046f20: 2020 2020 2020 2020 2020 2349 6620 7468            #If th
+00046f30: 6579 2065 7869 7374 2c20 7365 6520 6966  ey exist, see if
+00046f40: 2074 6865 7927 7665 206d 6f76 6564 2c20   they've moved, 
+00046f50: 6f72 2069 6620 7468 6572 6520 6172 6520  or if there are 
+00046f60: 6d6f 7265 2077 6974 6820 7468 6520 7361  more with the sa
+00046f70: 6d65 2073 686f 7274 636f 6465 0d0a 2020  me shortcode..  
+00046f80: 2020 2020 2020 2020 2020 2020 2020 2346                #F
+00046f90: 6972 7374 2063 7265 6174 6520 6c6f 6f6b  irst create look
+00046fa0: 7570 7320 666f 7220 7061 7265 6e74 2073  ups for parent s
+00046fb0: 686f 7274 636f 6465 730d 0a20 2020 2020  hortcodes..     
+00046fc0: 2020 2020 2020 2020 2020 2073 656c 665f             self_
+00046fd0: 656c 5f70 6172 656e 745f 7363 5f73 655f  el_parent_sc_se_
+00046fe0: 6c6f 6f6b 7570 203d 207b 7365 2e70 6172  lookup = {se.par
+00046ff0: 656e 742e 7368 6f72 7463 6f64 653a 7365  ent.shortcode:se
+00047000: 2066 6f72 2073 6520 696e 2065 6c65 6d65   for se in eleme
+00047010: 6e74 735f 7769 7468 5f73 686f 7274 636f  nts_with_shortco
+00047020: 6465 2069 6620 7365 2e70 6172 656e 747d  de if se.parent}
+00047030: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00047040: 2020 6f74 6865 725f 656c 5f70 6172 656e    other_el_paren
+00047050: 745f 7363 5f73 655f 6c6f 6f6b 7570 203d  t_sc_se_lookup =
+00047060: 207b 7365 2e70 6172 656e 742e 7368 6f72   {se.parent.shor
+00047070: 7463 6f64 653a 7365 2066 6f72 2073 6520  tcode:se for se 
+00047080: 696e 206f 7468 6572 5f65 6c65 6d65 6e74  in other_element
+00047090: 7320 6966 2073 652e 7061 7265 6e74 7d0d  s if se.parent}.
+000470a0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+000470b0: 2020 2023 4120 6c6f 6361 6c5f 636f 7079     #A local_copy
+000470c0: 5f6f 665f 6d6f 7665 645f 6f72 5f72 656d  _of_moved_or_rem
+000470d0: 6f76 6564 5f65 6c65 6d65 6e74 7320 2d20  oved_elements - 
+000470e0: 7765 276c 6c20 6164 6420 7468 6573 6520  we'll add these 
+000470f0: 6c69 7374 7320 746f 2074 6865 206d 6169  lists to the mai
+00047100: 6e20 6c69 7374 2061 7320 6120 7475 706c  n list as a tupl
+00047110: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00047120: 2020 206c 6f63 616c 5f6d 6f76 6564 5f6f     local_moved_o
+00047130: 725f 7265 6d6f 7665 645f 656c 656d 656e  r_removed_elemen
+00047140: 7473 5f73 656c 6620 3d20 5b5d 0d0a 2020  ts_self = []..  
+00047150: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00047160: 6361 6c5f 6d6f 7665 645f 6f72 5f72 656d  cal_moved_or_rem
+00047170: 6f76 6564 5f65 6c65 6d65 6e74 735f 6f74  oved_elements_ot
+00047180: 6865 7220 3d20 5b5d 0d0a 0d0a 2020 2020  her = []....    
+00047190: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000471a0: 6b2c 2076 2069 6e20 7365 6c66 5f65 6c5f  k, v in self_el_
+000471b0: 7061 7265 6e74 5f73 635f 7365 5f6c 6f6f  parent_sc_se_loo
+000471c0: 6b75 702e 6974 656d 7328 293a 0d0a 2020  kup.items():..  
+000471d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000471e0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+000471f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047200: 6f74 6865 725f 656c 5f70 6172 656e 745f  other_el_parent_
+00047210: 7363 5f73 655f 6c6f 6f6b 7570 5b6b 5d0d  sc_se_lookup[k].
+00047220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00047230: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+00047240: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+00047250: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00047260: 6f63 616c 5f6d 6f76 6564 5f6f 725f 7265  ocal_moved_or_re
+00047270: 6d6f 7665 645f 656c 656d 656e 7473 5f73  moved_elements_s
+00047280: 656c 662e 6170 7065 6e64 2876 290d 0a0d  elf.append(v)...
+00047290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000472a0: 2066 6f72 206b 2c20 7620 696e 206f 7468   for k, v in oth
+000472b0: 6572 5f65 6c5f 7061 7265 6e74 5f73 635f  er_el_parent_sc_
+000472c0: 7365 5f6c 6f6f 6b75 702e 6974 656d 7328  se_lookup.items(
+000472d0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+000472e0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+000472f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047300: 2020 2020 2020 7365 6c66 5f65 6c5f 7061        self_el_pa
+00047310: 7265 6e74 5f73 635f 7365 5f6c 6f6f 6b75  rent_sc_se_looku
+00047320: 705b 6b5d 0d0a 2020 2020 2020 2020 2020  p[k]..          
+00047330: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00047340: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
+00047350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047360: 2020 2020 6c6f 6361 6c5f 6d6f 7665 645f      local_moved_
+00047370: 6f72 5f72 656d 6f76 6564 5f65 6c65 6d65  or_removed_eleme
+00047380: 6e74 735f 6f74 6865 722e 6170 7065 6e64  nts_other.append
+00047390: 2876 290d 0a0d 0a20 2020 2020 2020 2020  (v)....         
+000473a0: 2020 2020 2020 2069 6620 6c65 6e28 6c6f         if len(lo
+000473b0: 6361 6c5f 6d6f 7665 645f 6f72 5f72 656d  cal_moved_or_rem
+000473c0: 6f76 6564 5f65 6c65 6d65 6e74 735f 7365  oved_elements_se
+000473d0: 6c66 293e 3020 6f72 206c 656e 286c 6f63  lf)>0 or len(loc
+000473e0: 616c 5f6d 6f76 6564 5f6f 725f 7265 6d6f  al_moved_or_remo
+000473f0: 7665 645f 656c 656d 656e 7473 5f6f 7468  ved_elements_oth
+00047400: 6572 293e 303a 0d0a 2020 2020 2020 2020  er)>0:..        
+00047410: 2020 2020 2020 2020 2020 2020 6d6f 7665              move
+00047420: 645f 6f72 5f72 656d 6f76 6564 5f65 6c65  d_or_removed_ele
+00047430: 6d65 6e74 7320 2b3d 205b 286c 6f63 616c  ments += [(local
+00047440: 5f6d 6f76 6564 5f6f 725f 7265 6d6f 7665  _moved_or_remove
+00047450: 645f 656c 656d 656e 7473 5f73 656c 662c  d_elements_self,
+00047460: 6c6f 6361 6c5f 6d6f 7665 645f 6f72 5f72  local_moved_or_r
+00047470: 656d 6f76 6564 5f65 6c65 6d65 6e74 735f  emoved_elements_
+00047480: 6f74 6865 7229 5d0d 0a0d 0a20 2020 2020  other)]....     
+00047490: 2020 2020 2020 2023 4e6f 7720 6c6f 6f6b         #Now look
+000474a0: 2074 6865 206f 7468 6572 2077 6179 202d   the other way -
+000474b0: 2061 7265 2074 6865 7265 2065 6c65 6d65   are there eleme
+000474c0: 6e74 7320 696e 206f 7468 6572 5f65 6c65  nts in other_ele
+000474d0: 6d65 6e74 7320 7468 6174 2068 6176 6520  ments that have 
+000474e0: 6172 6520 6e65 7720 746f 2074 6869 7320  are new to this 
+000474f0: 7374 7275 6374 7572 653f 0d0a 2020 2020  structure?..    
+00047500: 2020 2020 2020 2020 666f 7220 6f74 6865          for othe
+00047510: 725f 7368 6f72 7463 6f64 652c 2065 6c65  r_shortcode, ele
+00047520: 6d65 6e74 735f 7769 7468 5f73 686f 7274  ments_with_short
+00047530: 636f 6465 2069 6e20 6f74 6865 725f 656c  code in other_el
+00047540: 656d 656e 745f 6c6f 6f6b 7570 2e69 7465  ement_lookup.ite
+00047550: 6d73 2829 3a0d 0a20 2020 2020 2020 2020  ms():..         
+00047560: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+00047570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00047580: 2073 656c 665f 656c 656d 656e 7473 203d   self_elements =
+00047590: 2073 656c 665f 656c 656d 656e 745f 6c6f   self_element_lo
+000475a0: 6f6b 7570 5b6f 7468 6572 5f73 686f 7274  okup[other_short
+000475b0: 636f 6465 5d0d 0a20 2020 2020 2020 2020  code]..         
+000475c0: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
+000475d0: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
+000475e0: 2020 2020 2020 2020 2020 2020 206e 6577               new
+000475f0: 5f65 6c65 6d65 6e74 7320 2b3d 2065 6c65  _elements += ele
+00047600: 6d65 6e74 735f 7769 7468 5f73 686f 7274  ments_with_short
+00047610: 636f 6465 0d0a 0d0a 0d0a 2020 2020 2020  code......      
+00047620: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00047630: 2020 2020 206e 6577 5f65 6c65 6d65 6e74       new_element
+00047640: 7320 3d20 4e6f 6e65 0d0a 2020 2020 2020  s = None..      
+00047650: 2020 2020 2020 6d6f 7665 645f 6f72 5f72        moved_or_r
+00047660: 656d 6f76 6564 5f65 6c65 6d65 6e74 7320  emoved_elements 
+00047670: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+00047680: 2020 2020 7265 6d6f 7665 645f 656c 656d      removed_elem
+00047690: 656e 7473 203d 204e 6f6e 650d 0a0d 0a20  ents = None.... 
+000476a0: 2020 2020 2020 2023 5468 6520 666f 6c6c         #The foll
+000476b0: 6f77 696e 6720 7769 6c6c 2062 6520 646f  owing will be do
+000476c0: 6e65 2069 6e20 7468 6520 6869 6572 6172  ne in the hierar
+000476d0: 6368 7920 6d61 6e69 7075 6c61 746f 7273  chy manipulators
+000476e0: 2c20 7369 6e63 6520 7468 6579 2061 7265  , since they are
+000476f0: 2061 7420 656c 656d 656e 7420 6c65 7665   at element leve
+00047700: 6c2c 2061 6e64 2072 6571 7569 7265 2061  l, and require a
+00047710: 2063 616c 6375 6c61 7469 6f6e 2072 6563   calculation rec
+00047720: 6f72 6469 6e67 2061 7420 7468 6520 7374  ording at the st
+00047730: 6172 740d 0a20 2020 2020 2020 2023 202b  art..        # +
+00047740: 204e 6577 2063 616c 6375 6c61 7469 6f6e   New calculation
+00047750: 2065 6c65 6d65 6e74 730d 0a20 2020 2020   elements..     
+00047760: 2020 2023 202b 2043 616c 6375 6c61 7469     # + Calculati
+00047770: 6f6e 2063 6861 6e67 6573 0d0a 0d0a 2020  on changes....  
+00047780: 2020 2020 2020 234e 6f77 2064 6f20 7468        #Now do th
+00047790: 6520 6469 6666 0d0a 0d0a 2020 2020 2020  e diff....      
+000477a0: 2020 7365 6320 3d20 7365 6c66 2e64 6966    sec = self.dif
+000477b0: 6628 6f74 6865 722c 7368 6f72 7463 6f64  f(other,shortcod
+000477c0: 655f 7472 616e 736c 6174 696f 6e73 3d73  e_translations=s
+000477d0: 686f 7274 636f 6465 5f74 7261 6e73 6c61  hortcode_transla
+000477e0: 7469 6f6e 732c 7265 7665 7273 655f 7472  tions,reverse_tr
+000477f0: 616e 736c 6174 696f 6e73 3d72 6576 6572  anslations=rever
+00047800: 7365 5f74 7261 6e73 6c61 7469 6f6e 7329  se_translations)
+00047810: 0d0a 0d0a 2020 2020 2020 2020 7365 632e  ....        sec.
+00047820: 6e65 775f 656c 656d 656e 7473 203d 206e  new_elements = n
+00047830: 6577 5f65 6c65 6d65 6e74 730d 0a20 2020  ew_elements..   
+00047840: 2020 2020 2073 6563 2e6d 6f76 6564 5f6f       sec.moved_o
+00047850: 725f 7265 6d6f 7665 645f 656c 656d 656e  r_removed_elemen
+00047860: 7473 203d 206d 6f76 6564 5f6f 725f 7265  ts = moved_or_re
+00047870: 6d6f 7665 645f 656c 656d 656e 7473 0d0a  moved_elements..
+00047880: 2020 2020 2020 2020 7365 632e 7265 6d6f          sec.remo
+00047890: 7665 645f 656c 656d 656e 7473 203d 2072  ved_elements = r
+000478a0: 656d 6f76 6564 5f65 6c65 6d65 6e74 730d  emoved_elements.
+000478b0: 0a0d 0a0d 0a20 2020 2020 2020 2072 6574  .....        ret
+000478c0: 7572 6e20 7365 630d 0a0d 0a20 2020 2064  urn sec....    d
+000478d0: 6566 2064 6966 6628 7365 6c66 2c6f 7468  ef diff(self,oth
+000478e0: 6572 2c73 686f 7274 636f 6465 5f74 7261  er,shortcode_tra
+000478f0: 6e73 6c61 7469 6f6e 733d 4e6f 6e65 2c72  nslations=None,r
+00047900: 6576 6572 7365 5f74 7261 6e73 6c61 7469  everse_translati
+00047910: 6f6e 733d 4e6f 6e65 293a 0d0a 2020 2020  ons=None):..    
+00047920: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
+00047930: 2043 6f6d 7061 7265 2074 6869 7320 5374   Compare this St
+00047940: 7275 6374 7572 6545 6c65 6d65 6e74 2074  ructureElement t
+00047950: 6f20 616e 6f74 6865 722c 2065 7373 656e  o another, essen
+00047960: 7469 616c 6c79 2064 6f69 6e67 2061 2064  tially doing a d
+00047970: 6966 660d 0a20 2020 2020 2020 2049 6620  iff..        If 
+00047980: 616e 2065 6c65 6d65 6e74 2069 7320 6e65  an element is ne
+00047990: 7720 6f72 2068 6173 2062 6565 6e20 7265  w or has been re
+000479a0: 6d6f 7665 6420 7468 656e 2072 6563 6f72  moved then recor
+000479b0: 6420 7468 6973 2069 6e66 6f72 6d61 7469  d this informati
+000479c0: 6f6e 2e0d 0a20 2020 2020 2020 2049 6620  on...        If 
+000479d0: 616e 2065 6c65 6d65 6e74 2069 7320 696e  an element is in
+000479e0: 2074 6865 2073 616d 6520 706f 7369 7469   the same positi
+000479f0: 6f6e 206f 7220 6861 7320 6265 656e 206d  on or has been m
+00047a00: 6f76 6564 2c20 7265 636f 7264 2074 6865  oved, record the
+00047a10: 2069 6e66 6f72 6d61 7469 6f6e 2061 6e64   information and
+00047a20: 2074 6865 6e20 7072 6f63 6565 6420 746f   then proceed to
+00047a30: 2063 6865 636b 696e 6720 7468 6520 6368   checking the ch
+00047a40: 696c 6472 656e 0d0a 2020 2020 2020 2020  ildren..        
+00047a50: 5265 7475 726e 2061 2053 7472 7563 7475  Return a Structu
+00047a60: 7265 456c 656d 656e 7443 6f6d 7061 7269  reElementCompari
+00047a70: 736f 6e20 6f62 6a65 6374 0d0a 0d0a 2020  son object....  
+00047a80: 2020 2020 2020 3a70 6172 616d 206f 7468        :param oth
+00047a90: 6572 3a20 5374 7275 6374 7572 6545 6c65  er: StructureEle
+00047aa0: 6d65 6e74 2074 6f20 636f 6d70 6172 6520  ment to compare 
+00047ab0: 7365 6c66 2074 6f0d 0a20 2020 2020 2020  self to..       
+00047ac0: 203a 7061 7261 6d20 7368 6f72 7463 6f64   :param shortcod
+00047ad0: 655f 7472 616e 736c 6174 696f 6e73 3a20  e_translations: 
+00047ae0: 6469 6374 696f 6e61 7279 2066 6f72 2074  dictionary for t
+00047af0: 7261 6e73 6c61 7469 6e67 2073 686f 7274  ranslating short
+00047b00: 636f 6465 7320 6f66 2022 6f74 6865 7222  codes of "other"
+00047b10: 2073 7472 7563 7475 7265 2065 6c65 6d65   structure eleme
+00047b20: 6e74 7320 746f 2073 686f 7274 636f 6465  nts to shortcode
+00047b30: 7320 6f66 2022 7365 6c66 2220 7374 7275  s of "self" stru
+00047b40: 6374 7572 6520 656c 656d 656e 7473 2c20  cture elements, 
+00047b50: 736f 2074 6861 7420 7369 6d69 6c61 7220  so that similar 
+00047b60: 6869 6572 6172 6368 6965 7320 6361 6e20  hierarchies can 
+00047b70: 6265 2063 6f6d 7061 7265 6420 6566 6669  be compared effi
+00047b80: 6369 656e 746c 790d 0a20 2020 2020 2020  ciently..       
+00047b90: 203a 7061 7261 6d20 7265 7665 7273 655f   :param reverse_
+00047ba0: 7472 616e 736c 6174 696f 6e73 3a20 596f  translations: Yo
+00047bb0: 7520 7368 6f75 6c64 6e27 7420 6e65 6564  u shouldn't need
+00047bc0: 2074 6f20 7370 6563 6966 7920 7468 6973   to specify this
+00047bd0: 2e20 4974 2065 7869 7374 7320 736f 2074  . It exists so t
+00047be0: 6861 7420 7765 2064 6f6e 2774 2068 6176  hat we don't hav
+00047bf0: 6520 746f 2063 616c 6375 6c61 7465 2074  e to calculate t
+00047c00: 6865 2072 6576 6572 7365 2074 7261 6e73  he reverse trans
+00047c10: 6c61 7469 6f6e 2066 6f72 2065 7665 7279  lation for every
+00047c20: 205f 7265 6375 7273 6976 655f 2063 616c   _recursive_ cal
+00047c30: 6c20 6f66 2074 6869 7320 6675 6e63 7469  l of this functi
+00047c40: 6f6e 0d0a 2020 2020 2020 2020 2727 270d  on..        '''.
+00047c50: 0a20 2020 2020 2020 2069 6620 7368 6f72  .        if shor
+00047c60: 7463 6f64 655f 7472 616e 736c 6174 696f  tcode_translatio
+00047c70: 6e73 2069 7320 4e6f 6e65 3a0d 0a20 2020  ns is None:..   
+00047c80: 2020 2020 2020 2020 2073 686f 7274 636f           shortco
+00047c90: 6465 5f74 7261 6e73 6c61 7469 6f6e 7320  de_translations 
+00047ca0: 3d20 7b7d 0d0a 0d0a 2020 2020 2020 2020  = {}....        
+00047cb0: 7365 6320 3d20 5374 7275 6374 7572 6545  sec = StructureE
+00047cc0: 6c65 6d65 6e74 436f 6d70 6172 6973 6f6e  lementComparison
+00047cd0: 2873 656c 662c 6f74 6865 7229 0d0a 0d0a  (self,other)....
+00047ce0: 2020 2020 2020 2020 7365 6c66 5f63 6869          self_chi
+00047cf0: 6c64 7265 6e5f 6b65 7973 2020 3d20 7b73  ldren_keys  = {s
+00047d00: 652e 7368 6f72 746e 616d 653a 6e20 666f  e.shortname:n fo
+00047d10: 7220 6e2c 2073 6520 696e 2065 6e75 6d65  r n, se in enume
+00047d20: 7261 7465 2873 656c 662e 5f63 6869 6c64  rate(self._child
+00047d30: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
+00047d40: 6e74 7329 7d0d 0a20 2020 2020 2020 206f  nts)}..        o
+00047d50: 7468 6572 5f63 6869 6c64 7265 6e5f 6b65  ther_children_ke
+00047d60: 7973 203d 207b 7d0d 0a0d 0a20 2020 2020  ys = {}....     
+00047d70: 2020 2066 6f72 206e 2c20 7365 2069 6e20     for n, se in 
+00047d80: 656e 756d 6572 6174 6528 6f74 6865 722e  enumerate(other.
+00047d90: 5f63 6869 6c64 5f73 7472 7563 7475 7265  _child_structure
+00047da0: 5f65 6c65 6d65 6e74 7329 3a0d 0a20 2020  _elements):..   
+00047db0: 2020 2020 2020 2020 2073 6520 3d20 7365           se = se
+00047dc0: 2e73 686f 7274 6e61 6d65 0d0a 2020 2020  .shortname..    
+00047dd0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00047de0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00047df0: 203d 2073 686f 7274 636f 6465 5f74 7261   = shortcode_tra
+00047e00: 6e73 6c61 7469 6f6e 735b 7365 5d0d 0a20  nslations[se].. 
+00047e10: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00047e20: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
+00047e30: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00047e40: 730d 0a20 2020 2020 2020 2020 2020 206f  s..            o
+00047e50: 7468 6572 5f63 6869 6c64 7265 6e5f 6b65  ther_children_ke
+00047e60: 7973 5b73 655d 203d 206e 0d0a 0d0a 2020  ys[se] = n....  
+00047e70: 2020 2020 2020 6966 2072 6576 6572 7365        if reverse
+00047e80: 5f74 7261 6e73 6c61 7469 6f6e 7320 6973  _translations is
+00047e90: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00047ea0: 2020 2020 7265 7665 7273 655f 7472 616e      reverse_tran
+00047eb0: 736c 6174 696f 6e73 203d 207b 763a 6b20  slations = {v:k 
+00047ec0: 666f 7220 6b2c 7620 696e 2073 686f 7274  for k,v in short
+00047ed0: 636f 6465 5f74 7261 6e73 6c61 7469 6f6e  code_translation
+00047ee0: 732e 6974 656d 7328 297d 0d0a 0d0a 2020  s.items()}....  
+00047ef0: 2020 2020 2020 2020 2020 2346 696c 6c20            #Fill 
+00047f00: 7468 6520 7265 7665 7273 6520 7472 616e  the reverse tran
+00047f10: 736c 6174 696f 6e20 6469 6374 2077 6974  slation dict wit
+00047f20: 6820 6b65 7973 2066 6f72 2061 6e79 7468  h keys for anyth
+00047f30: 696e 6720 7765 2064 6964 6e27 7420 6765  ing we didn't ge
+00047f40: 7420 696e 2074 6865 2074 7261 6e73 6c61  t in the transla
+00047f50: 7469 6f6e 2064 6963 7469 6f6e 6172 792c  tion dictionary,
+00047f60: 2074 6f20 7361 7665 2075 7320 7472 6170   to save us trap
+00047f70: 7069 6e67 204b 6579 4572 726f 7273 2061  ping KeyErrors a
+00047f80: 6c6c 206f 7665 7220 7468 6520 706c 6163  ll over the plac
+00047f90: 6520 696e 2074 6865 2066 6f6c 6c6f 7769  e in the followi
+00047fa0: 6e67 2063 6f64 650d 0a20 2020 2020 2020  ng code..       
+00047fb0: 2020 2020 2023 4e6f 7465 2c20 666f 7220       #Note, for 
+00047fc0: 616e 2065 6d70 7479 2074 7261 6e73 6c61  an empty transla
+00047fd0: 7469 6f6e 2064 6963 7469 6f6e 6172 792c  tion dictionary,
+00047fe0: 2077 6527 6c6c 2062 6520 636f 6d70 6c65   we'll be comple
+00047ff0: 7465 6c79 2066 696c 6c69 6e67 2074 6869  tely filling thi
+00048000: 7320 7265 7665 7273 6520 7472 616e 736c  s reverse transl
+00048010: 6174 696f 6e20 6469 6374 696f 6e61 7279  ation dictionary
+00048020: 2077 6974 6820 7361 6d65 2073 686f 7274   with same short
+00048030: 6e61 6d65 3a73 686f 7274 6e61 6d65 2070  name:shortname p
+00048040: 6169 7273 0d0a 2020 2020 2020 2020 2020  airs..          
+00048050: 2020 666f 7220 6b20 696e 206f 7468 6572    for k in other
+00048060: 5f63 6869 6c64 7265 6e5f 6b65 7973 2e6b  _children_keys.k
+00048070: 6579 7328 293a 0d0a 2020 2020 2020 2020  eys():..        
+00048080: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00048090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000480a0: 2020 7265 7665 7273 655f 7472 616e 736c    reverse_transl
+000480b0: 6174 696f 6e73 5b6b 5d0d 0a20 2020 2020  ations[k]..     
+000480c0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+000480d0: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
+000480e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000480f0: 2072 6576 6572 7365 5f74 7261 6e73 6c61   reverse_transla
+00048100: 7469 6f6e 735b 6b5d 203d 206b 0d0a 0d0a  tions[k] = k....
+00048110: 2020 2020 2020 2020 7365 6c66 5f63 6869          self_chi
+00048120: 6c64 7265 6e5f 706f 735f 6c6f 6f6b 7570  ldren_pos_lookup
+00048130: 2020 3d20 7b6e 3a73 6520 666f 7220 6e2c    = {n:se for n,
+00048140: 2073 6520 696e 2065 6e75 6d65 7261 7465   se in enumerate
+00048150: 2820 7365 6c66 2e5f 6368 696c 645f 7374  ( self._child_st
+00048160: 7275 6374 7572 655f 656c 656d 656e 7473  ructure_elements
+00048170: 297d 0d0a 2020 2020 2020 2020 6f74 6865  )}..        othe
+00048180: 725f 6368 696c 6472 656e 5f70 6f73 5f6c  r_children_pos_l
+00048190: 6f6f 6b75 7020 3d20 7b6e 3a73 6520 666f  ookup = {n:se fo
+000481a0: 7220 6e2c 2073 6520 696e 2065 6e75 6d65  r n, se in enume
+000481b0: 7261 7465 286f 7468 6572 2e5f 6368 696c  rate(other._chil
+000481c0: 645f 7374 7275 6374 7572 655f 656c 656d  d_structure_elem
+000481d0: 656e 7473 297d 0d0a 0d0a 0d0a 0d0a 2020  ents)}........  
+000481e0: 2020 2020 2020 234e 6f77 2064 6f20 7468        #Now do th
+000481f0: 6520 6469 6666 0d0a 0d0a 2020 2020 2020  e diff....      
+00048200: 2020 666f 7220 6f70 2c20 6b65 795f 6c69    for op, key_li
+00048210: 7374 2069 6e20 5f64 6966 6628 6c69 7374  st in _diff(list
+00048220: 2873 656c 665f 6368 696c 6472 656e 5f6b  (self_children_k
+00048230: 6579 732e 6b65 7973 2829 292c 6c69 7374  eys.keys()),list
+00048240: 286f 7468 6572 5f63 6869 6c64 7265 6e5f  (other_children_
+00048250: 6b65 7973 2e6b 6579 7328 2929 293a 0d0a  keys.keys())):..
+00048260: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+00048270: 6e74 286f 702c 6b65 795f 6c69 7374 290d  nt(op,key_list).
+00048280: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00048290: 206b 2069 6e20 6b65 795f 6c69 7374 3a0d   k in key_list:.
+000482a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000482b0: 2063 6f6d 7020 3d20 4e6f 6e65 0d0a 2020   comp = None..  
+000482c0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+000482d0: 616e 736f 7020 3d20 6f70 0d0a 2020 2020  ansop = op..    
+000482e0: 2020 2020 2020 2020 2020 2020 6966 2020              if  
+000482f0: 2074 7261 6e73 6f70 203d 3d20 272d 273a   transop == '-':
+00048300: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00048310: 2020 2020 2020 6973 5f69 6e5f 7365 6c66        is_in_self
+00048320: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+00048330: 2020 2020 2020 2020 2020 2020 2069 735f               is_
+00048340: 696e 5f6f 7468 6572 203d 2046 616c 7365  in_other = False
+00048350: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00048360: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00048370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048380: 2020 2020 7468 6973 5f70 6f73 203d 2073      this_pos = s
+00048390: 656c 665f 6368 696c 6472 656e 5f6b 6579  elf_children_key
+000483a0: 735b 6b5d 0d0a 2020 2020 2020 2020 2020  s[k]..          
+000483b0: 2020 2020 2020 2020 2020 2020 2020 2370                #p
+000483c0: 7269 6e74 2874 6869 735f 706f 7329 0d0a  rint(this_pos)..
 000483d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000483e0: 2020 7468 6973 5f70 6f73 203d 204e 6f6e    this_pos = Non
-000483f0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00048400: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00048410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048420: 2020 2020 206f 7468 6572 5f70 6f73 203d       other_pos =
-00048430: 206f 7468 6572 5f63 6869 6c64 7265 6e5f   other_children_
-00048440: 6b65 7973 5b6b 5d0d 0a20 2020 2020 2020  keys[k]..       
-00048450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048460: 2023 7072 696e 7428 6f74 6865 725f 706f   #print(other_po
-00048470: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
-00048480: 2020 2020 2020 2020 6578 6365 7074 204b          except K
-00048490: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
+000483e0: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+000483f0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+00048400: 2020 2020 2020 2020 2020 2020 2020 7468                th
+00048410: 6973 5f70 6f73 203d 204e 6f6e 650d 0a20  is_pos = None.. 
+00048420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048430: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00048440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048450: 206f 7468 6572 5f70 6f73 203d 206f 7468   other_pos = oth
+00048460: 6572 5f63 6869 6c64 7265 6e5f 6b65 7973  er_children_keys
+00048470: 5b6b 5d0d 0a20 2020 2020 2020 2020 2020  [k]..           
+00048480: 2020 2020 2020 2020 2020 2020 2023 7072               #pr
+00048490: 696e 7428 6f74 6865 725f 706f 7329 0d0a  int(other_pos)..
 000484a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000484b0: 2020 6f74 6865 725f 706f 7320 3d20 4e6f    other_pos = No
-000484c0: 6e65 0d0a 0d0a 2020 2020 2020 2020 2020  ne....          
-000484d0: 2020 2020 2020 2020 2020 6966 2074 6869            if thi
-000484e0: 735f 706f 7320 6973 206e 6f74 204e 6f6e  s_pos is not Non
-000484f0: 6520 616e 6420 6f74 6865 725f 706f 7320  e and other_pos 
-00048500: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
-00048510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048520: 2020 2020 2020 6966 2074 6869 735f 706f        if this_po
-00048530: 7320 3e20 6f74 6865 725f 706f 733a 0d0a  s > other_pos:..
+000484b0: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
+000484c0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+000484d0: 2020 2020 2020 2020 2020 2020 2020 6f74                ot
+000484e0: 6865 725f 706f 7320 3d20 4e6f 6e65 0d0a  her_pos = None..
+000484f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00048500: 2020 2020 2020 6966 2074 6869 735f 706f        if this_po
+00048510: 7320 6973 206e 6f74 204e 6f6e 6520 616e  s is not None an
+00048520: 6420 6f74 6865 725f 706f 7320 6973 206e  d other_pos is n
+00048530: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
 00048540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048550: 2020 2020 2020 2020 2020 2020 7472 616e              tran
-00048560: 736f 7020 3d20 275e 270d 0a20 2020 2020  sop = '^'..     
+00048550: 2020 6966 2074 6869 735f 706f 7320 3e20    if this_pos > 
+00048560: 6f74 6865 725f 706f 733a 0d0a 2020 2020  other_pos:..    
 00048570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048580: 2020 2069 6620 7468 6973 5f70 6f73 203c     if this_pos <
-00048590: 206f 7468 6572 5f70 6f73 3a0d 0a20 2020   other_pos:..   
-000485a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000485b0: 2020 2020 2020 2020 2074 7261 6e73 6f70           transop
-000485c0: 203d 2027 7627 0d0a 0d0a 2020 2020 2020   = 'v'....      
-000485d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000485e0: 2074 7261 6e73 6f70 2021 3d20 272d 273a   transop != '-':
-000485f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00048600: 2020 2020 2020 2020 2020 2369 6620 7468            #if th
-00048610: 6973 2069 7320 6e6f 7420 6120 7472 7565  is is not a true
-00048620: 2072 656d 6f76 6564 2069 7465 6d20 2869   removed item (i
-00048630: 2e65 2e20 6974 2069 7320 6d6f 7665 6429  .e. it is moved)
-00048640: 2077 6520 7769 6c6c 2077 616e 7420 746f   we will want to
-00048650: 2064 6966 6620 7468 6520 6368 696c 6472   diff the childr
-00048660: 656e 0d0a 2020 2020 2020 2020 2020 2020  en..            
-00048670: 2020 2020 2020 2020 2020 2020 7468 6973              this
-00048680: 5f73 6520 2020 2020 2020 2020 3d20 7365  _se         = se
-00048690: 6c66 5f63 6869 6c64 7265 6e5f 706f 735f  lf_children_pos_
-000486a0: 6c6f 6f6b 7570 5b74 6869 735f 706f 735d  lookup[this_pos]
-000486b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000486c0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-000486d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000486e0: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
-000486f0: 725f 7365 2020 2020 2020 2020 3d20 6f74  r_se        = ot
-00048700: 6865 725f 6368 696c 6472 656e 5f70 6f73  her_children_pos
-00048710: 5f6c 6f6f 6b75 705b 6f74 6865 725f 706f  _lookup[other_po
-00048720: 735d 0d0a 2020 2020 2020 2020 2020 2020  s]..            
-00048730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048740: 6973 5f69 6e5f 6f74 6865 7220 2020 2020  is_in_other     
-00048750: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-00048760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048770: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
-00048780: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00048790: 2020 2020 2020 2020 2020 2020 2020 6f74                ot
-000487a0: 6865 725f 7365 2020 2020 2020 2020 3d20  her_se        = 
-000487b0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-000487c0: 2020 2020 2020 2020 2020 2020 2020 2370                #p
-000487d0: 7269 6e74 2827 636f 6d70 6172 696e 6720  rint('comparing 
-000487e0: 7b7d 2074 6f20 7b7d 272e 666f 726d 6174  {} to {}'.format
-000487f0: 2874 6869 735f 7365 2e73 686f 7274 6e61  (this_se.shortna
-00048800: 6d65 2c6f 7468 6572 5f73 652e 7368 6f72  me,other_se.shor
-00048810: 746e 616d 6529 290d 0a20 2020 2020 2020  tname))..       
-00048820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048830: 2063 6f6d 7020 2020 2020 2020 2020 2020   comp           
-00048840: 203d 2074 6869 735f 7365 2e64 6966 6628   = this_se.diff(
-00048850: 6f74 6865 725f 7365 2c73 686f 7274 636f  other_se,shortco
-00048860: 6465 5f74 7261 6e73 6c61 7469 6f6e 732c  de_translations,
-00048870: 7265 7665 7273 655f 7472 616e 736c 6174  reverse_translat
-00048880: 696f 6e73 290d 0a0d 0a20 2020 2020 2020  ions)....       
-00048890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000488a0: 2063 6f6d 702e 6973 5f69 6e5f 7365 6c66   comp.is_in_self
-000488b0: 2020 2020 2020 2020 3d20 6973 5f69 6e5f          = is_in_
-000488c0: 7365 6c66 0d0a 2020 2020 2020 2020 2020  self..          
-000488d0: 2020 2020 2020 2020 2020 2020 2020 636f                co
-000488e0: 6d70 2e69 735f 696e 5f6f 7468 6572 2020  mp.is_in_other  
-000488f0: 2020 2020 203d 2069 735f 696e 5f6f 7468       = is_in_oth
-00048900: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
-00048910: 2020 2020 2020 2020 2020 2020 6272 616e              bran
-00048920: 6368 6573 5f6d 6174 6368 2020 3d20 636f  ches_match  = co
-00048930: 6d70 2e73 616d 650d 0a0d 0a20 2020 2020  mp.same....     
-00048940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048950: 2020 2069 6620 6e6f 7420 6272 616e 6368     if not branch
-00048960: 6573 5f6d 6174 6368 3a0d 0a20 2020 2020  es_match:..     
-00048970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048980: 2020 2020 2020 2074 7261 6e73 6f70 2b3d         transop+=
-00048990: 273e 270d 0a20 2020 2020 2020 2020 2020  '>'..           
-000489a0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-000489b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000489c0: 2020 2020 2020 2020 7468 6973 5f73 6520          this_se 
-000489d0: 3d20 7365 6c66 5f63 6869 6c64 7265 6e5f  = self_children_
-000489e0: 706f 735f 6c6f 6f6b 7570 5b74 6869 735f  pos_lookup[this_
-000489f0: 706f 735d 0d0a 2020 2020 2020 2020 2020  pos]..          
-00048a00: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00048a10: 6d70 203d 2053 7472 7563 7475 7265 456c  mp = StructureEl
-00048a20: 656d 656e 7443 6f6d 7061 7269 736f 6e28  ementComparison(
-00048a30: 7468 6973 5f73 652c 4e6f 6e65 290d 0a0d  this_se,None)...
-00048a40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048a50: 2020 2020 2023 7072 696e 7420 286b 2b20       #print (k+ 
-00048a60: 275c 7427 2b74 7261 6e73 6f70 290d 0a20  '\t'+transop).. 
-00048a70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00048a80: 6c69 6620 7472 616e 736f 7020 3d3d 2027  lif transop == '
-00048a90: 2b27 3a0d 0a20 2020 2020 2020 2020 2020  +':..           
-00048aa0: 2020 2020 2020 2020 2069 735f 696e 5f73           is_in_s
-00048ab0: 656c 6620 3d20 4661 6c73 650d 0a20 2020  elf = False..   
-00048ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048ad0: 2069 735f 696e 5f6f 7468 6572 203d 2054   is_in_other = T
-00048ae0: 7275 650d 0a20 2020 2020 2020 2020 2020  rue..           
-00048af0: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-00048b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048b10: 2020 2020 2020 2074 6869 735f 706f 7320         this_pos 
-00048b20: 3d20 7365 6c66 5f63 6869 6c64 7265 6e5f  = self_children_
-00048b30: 6b65 7973 5b6b 5d0d 0a20 2020 2020 2020  keys[k]..       
-00048b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048b50: 2023 7072 696e 7428 7468 6973 5f70 6f73   #print(this_pos
-00048b60: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00048b70: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-00048b80: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
+00048580: 2020 2020 2020 2020 7472 616e 736f 7020          transop 
+00048590: 3d20 275e 270d 0a20 2020 2020 2020 2020  = '^'..         
+000485a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000485b0: 6620 7468 6973 5f70 6f73 203c 206f 7468  f this_pos < oth
+000485c0: 6572 5f70 6f73 3a0d 0a20 2020 2020 2020  er_pos:..       
+000485d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000485e0: 2020 2020 2074 7261 6e73 6f70 203d 2027       transop = '
+000485f0: 7627 0d0a 0d0a 2020 2020 2020 2020 2020  v'....          
+00048600: 2020 2020 2020 2020 2020 6966 2074 7261            if tra
+00048610: 6e73 6f70 2021 3d20 272d 273a 0d0a 2020  nsop != '-':..  
+00048620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048630: 2020 2020 2020 2369 6620 7468 6973 2069        #if this i
+00048640: 7320 6e6f 7420 6120 7472 7565 2072 656d  s not a true rem
+00048650: 6f76 6564 2069 7465 6d20 2869 2e65 2e20  oved item (i.e. 
+00048660: 6974 2069 7320 6d6f 7665 6429 2077 6520  it is moved) we 
+00048670: 7769 6c6c 2077 616e 7420 746f 2064 6966  will want to dif
+00048680: 6620 7468 6520 6368 696c 6472 656e 0d0a  f the children..
+00048690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000486a0: 2020 2020 2020 2020 7468 6973 5f73 6520          this_se 
+000486b0: 2020 2020 2020 2020 3d20 7365 6c66 5f63          = self_c
+000486c0: 6869 6c64 7265 6e5f 706f 735f 6c6f 6f6b  hildren_pos_look
+000486d0: 7570 5b74 6869 735f 706f 735d 0d0a 2020  up[this_pos]..  
+000486e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000486f0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00048700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048710: 2020 2020 2020 2020 6f74 6865 725f 7365          other_se
+00048720: 2020 2020 2020 2020 3d20 6f74 6865 725f          = other_
+00048730: 6368 696c 6472 656e 5f70 6f73 5f6c 6f6f  children_pos_loo
+00048740: 6b75 705b 6f74 6865 725f 706f 735d 0d0a  kup[other_pos]..
+00048750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048760: 2020 2020 2020 2020 2020 2020 6973 5f69              is_i
+00048770: 6e5f 6f74 6865 7220 2020 2020 3d20 5472  n_other     = Tr
+00048780: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00048790: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+000487a0: 7074 204b 6579 4572 726f 723a 0d0a 2020  pt KeyError:..  
+000487b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000487c0: 2020 2020 2020 2020 2020 6f74 6865 725f            other_
+000487d0: 7365 2020 2020 2020 2020 3d20 4e6f 6e65  se        = None
+000487e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000487f0: 2020 2020 2020 2020 2020 2370 7269 6e74            #print
+00048800: 2827 636f 6d70 6172 696e 6720 7b7d 2074  ('comparing {} t
+00048810: 6f20 7b7d 272e 666f 726d 6174 2874 6869  o {}'.format(thi
+00048820: 735f 7365 2e73 686f 7274 6e61 6d65 2c6f  s_se.shortname,o
+00048830: 7468 6572 5f73 652e 7368 6f72 746e 616d  ther_se.shortnam
+00048840: 6529 290d 0a20 2020 2020 2020 2020 2020  e))..           
+00048850: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+00048860: 7020 2020 2020 2020 2020 2020 203d 2074  p            = t
+00048870: 6869 735f 7365 2e64 6966 6628 6f74 6865  his_se.diff(othe
+00048880: 725f 7365 2c73 686f 7274 636f 6465 5f74  r_se,shortcode_t
+00048890: 7261 6e73 6c61 7469 6f6e 732c 7265 7665  ranslations,reve
+000488a0: 7273 655f 7472 616e 736c 6174 696f 6e73  rse_translations
+000488b0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+000488c0: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+000488d0: 702e 6973 5f69 6e5f 7365 6c66 2020 2020  p.is_in_self    
+000488e0: 2020 2020 3d20 6973 5f69 6e5f 7365 6c66      = is_in_self
+000488f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00048900: 2020 2020 2020 2020 2020 636f 6d70 2e69            comp.i
+00048910: 735f 696e 5f6f 7468 6572 2020 2020 2020  s_in_other      
+00048920: 203d 2069 735f 696e 5f6f 7468 6572 0d0a   = is_in_other..
+00048930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048940: 2020 2020 2020 2020 6272 616e 6368 6573          branches
+00048950: 5f6d 6174 6368 2020 3d20 636f 6d70 2e73  _match  = comp.s
+00048960: 616d 650d 0a0d 0a20 2020 2020 2020 2020  ame....         
+00048970: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00048980: 6620 6e6f 7420 6272 616e 6368 6573 5f6d  f not branches_m
+00048990: 6174 6368 3a0d 0a20 2020 2020 2020 2020  atch:..         
+000489a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000489b0: 2020 2074 7261 6e73 6f70 2b3d 273e 270d     transop+='>'.
+000489c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000489d0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000489e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000489f0: 2020 2020 7468 6973 5f73 6520 3d20 7365      this_se = se
+00048a00: 6c66 5f63 6869 6c64 7265 6e5f 706f 735f  lf_children_pos_
+00048a10: 6c6f 6f6b 7570 5b74 6869 735f 706f 735d  lookup[this_pos]
+00048a20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00048a30: 2020 2020 2020 2020 2020 636f 6d70 203d            comp =
+00048a40: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
+00048a50: 7443 6f6d 7061 7269 736f 6e28 7468 6973  tComparison(this
+00048a60: 5f73 652c 4e6f 6e65 290d 0a0d 0a20 2020  _se,None)....   
+00048a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048a80: 2023 7072 696e 7420 286b 2b20 275c 7427   #print (k+ '\t'
+00048a90: 2b74 7261 6e73 6f70 290d 0a20 2020 2020  +transop)..     
+00048aa0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00048ab0: 7472 616e 736f 7020 3d3d 2027 2b27 3a0d  transop == '+':.
+00048ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00048ad0: 2020 2020 2069 735f 696e 5f73 656c 6620       is_in_self 
+00048ae0: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00048af0: 2020 2020 2020 2020 2020 2020 2069 735f               is_
+00048b00: 696e 5f6f 7468 6572 203d 2054 7275 650d  in_other = True.
+00048b10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00048b20: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00048b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048b40: 2020 2074 6869 735f 706f 7320 3d20 7365     this_pos = se
+00048b50: 6c66 5f63 6869 6c64 7265 6e5f 6b65 7973  lf_children_keys
+00048b60: 5b6b 5d0d 0a20 2020 2020 2020 2020 2020  [k]..           
+00048b70: 2020 2020 2020 2020 2020 2020 2023 7072               #pr
+00048b80: 696e 7428 7468 6973 5f70 6f73 290d 0a20  int(this_pos).. 
 00048b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048ba0: 2074 6869 735f 706f 7320 3d20 4e6f 6e65   this_pos = None
-00048bb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00048bc0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-00048bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048be0: 2020 2020 6f74 6865 725f 706f 7320 3d20      other_pos = 
-00048bf0: 6f74 6865 725f 6368 696c 6472 656e 5f6b  other_children_k
-00048c00: 6579 735b 6b5d 0d0a 2020 2020 2020 2020  eys[k]..        
-00048c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048c20: 2370 7269 6e74 286f 7468 6572 5f70 6f73  #print(other_pos
-00048c30: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00048c40: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-00048c50: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
+00048ba0: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
+00048bb0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00048bc0: 2020 2020 2020 2020 2020 2020 2074 6869               thi
+00048bd0: 735f 706f 7320 3d20 4e6f 6e65 0d0a 2020  s_pos = None..  
+00048be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048bf0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+00048c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048c10: 6f74 6865 725f 706f 7320 3d20 6f74 6865  other_pos = othe
+00048c20: 725f 6368 696c 6472 656e 5f6b 6579 735b  r_children_keys[
+00048c30: 6b5d 0d0a 2020 2020 2020 2020 2020 2020  k]..            
+00048c40: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+00048c50: 6e74 286f 7468 6572 5f70 6f73 290d 0a20  nt(other_pos).. 
 00048c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048c70: 206f 7468 6572 5f70 6f73 203d 204e 6f6e   other_pos = Non
-00048c80: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
-00048c90: 2020 2020 2020 2020 2069 6620 7468 6973           if this
-00048ca0: 5f70 6f73 2069 7320 6e6f 7420 4e6f 6e65  _pos is not None
-00048cb0: 2061 6e64 206f 7468 6572 5f70 6f73 2069   and other_pos i
-00048cc0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00048cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048ce0: 2020 2020 2069 6620 7468 6973 5f70 6f73       if this_pos
-00048cf0: 203e 206f 7468 6572 5f70 6f73 3a0d 0a20   > other_pos:.. 
+00048c70: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
+00048c80: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00048c90: 2020 2020 2020 2020 2020 2020 206f 7468               oth
+00048ca0: 6572 5f70 6f73 203d 204e 6f6e 650d 0a0d  er_pos = None...
+00048cb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00048cc0: 2020 2020 2069 6620 7468 6973 5f70 6f73       if this_pos
+00048cd0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+00048ce0: 206f 7468 6572 5f70 6f73 2069 7320 6e6f   other_pos is no
+00048cf0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
 00048d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048d10: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
-00048d20: 6f70 203d 2027 7627 0d0a 2020 2020 2020  op = 'v'..      
+00048d10: 2069 6620 7468 6973 5f70 6f73 203e 206f   if this_pos > o
+00048d20: 7468 6572 5f70 6f73 3a0d 0a20 2020 2020  ther_pos:..     
 00048d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048d40: 2020 6966 2074 6869 735f 706f 7320 3c20    if this_pos < 
-00048d50: 6f74 6865 725f 706f 733a 0d0a 2020 2020  other_pos:..    
-00048d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048d70: 2020 2020 2020 2020 7472 616e 736f 7020          transop 
-00048d80: 3d20 275e 270d 0a0d 0a20 2020 2020 2020  = '^'....       
-00048d90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00048da0: 7472 616e 736f 7020 213d 2027 2b27 3a0d  transop != '+':.
-00048db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00048dc0: 2020 2020 2020 2020 2023 6966 2074 6869           #if thi
-00048dd0: 7320 6973 206e 6f74 2061 2074 7275 6520  s is not a true 
-00048de0: 7265 6d6f 7665 6420 6974 656d 2028 692e  removed item (i.
-00048df0: 652e 2069 7420 6973 206d 6f76 6564 2920  e. it is moved) 
-00048e00: 7765 2077 696c 6c20 7761 6e74 2074 6f20  we will want to 
-00048e10: 6469 6666 2074 6865 2063 6869 6c64 7265  diff the childre
-00048e20: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
-00048e30: 2020 2020 2020 2020 2020 2069 735f 696e             is_in
-00048e40: 5f73 656c 6620 3d20 5472 7565 0d0a 2020  _self = True..  
+00048d40: 2020 2020 2020 2074 7261 6e73 6f70 203d         transop =
+00048d50: 2027 7627 0d0a 2020 2020 2020 2020 2020   'v'..          
+00048d60: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00048d70: 2074 6869 735f 706f 7320 3c20 6f74 6865   this_pos < othe
+00048d80: 725f 706f 733a 0d0a 2020 2020 2020 2020  r_pos:..        
+00048d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048da0: 2020 2020 7472 616e 736f 7020 3d20 275e      transop = '^
+00048db0: 270d 0a0d 0a20 2020 2020 2020 2020 2020  '....           
+00048dc0: 2020 2020 2020 2020 2069 6620 7472 616e           if tran
+00048dd0: 736f 7020 213d 2027 2b27 3a0d 0a20 2020  sop != '+':..   
+00048de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048df0: 2020 2020 2023 6966 2074 6869 7320 6973       #if this is
+00048e00: 206e 6f74 2061 2074 7275 6520 7265 6d6f   not a true remo
+00048e10: 7665 6420 6974 656d 2028 692e 652e 2069  ved item (i.e. i
+00048e20: 7420 6973 206d 6f76 6564 2920 7765 2077  t is moved) we w
+00048e30: 696c 6c20 7761 6e74 2074 6f20 6469 6666  ill want to diff
+00048e40: 2074 6865 2063 6869 6c64 7265 6e0d 0a20   the children.. 
 00048e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048e60: 2020 2020 2020 6973 5f69 6e5f 6f74 6865        is_in_othe
-00048e70: 7220 3d20 5472 7565 0d0a 0d0a 2020 2020  r = True....    
+00048e60: 2020 2020 2020 2069 735f 696e 5f73 656c         is_in_sel
+00048e70: 6620 3d20 5472 7565 0d0a 2020 2020 2020  f = True..      
 00048e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048e90: 2020 2020 7468 6973 5f73 6520 3d20 7365      this_se = se
-00048ea0: 6c66 5f63 6869 6c64 7265 6e5f 706f 735f  lf_children_pos_
-00048eb0: 6c6f 6f6b 7570 5b74 6869 735f 706f 735d  lookup[this_pos]
-00048ec0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00048ed0: 2020 2020 2020 2020 2020 6f74 6865 725f            other_
-00048ee0: 7365 203d 206f 7468 6572 5f63 6869 6c64  se = other_child
-00048ef0: 7265 6e5f 706f 735f 6c6f 6f6b 7570 5b6f  ren_pos_lookup[o
-00048f00: 7468 6572 5f70 6f73 5d0d 0a0d 0a20 2020  ther_pos]....   
-00048f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048f20: 2020 2020 2023 5265 7665 7273 6520 7468       #Reverse th
-00048f30: 6520 636f 6d70 6172 6973 6f6e 2066 6f72  e comparison for
-00048f40: 206d 6f76 6564 2069 7465 6d73 0d0a 2020   moved items..  
-00048f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00048f60: 2020 2020 2020 636f 6d70 203d 206f 7468        comp = oth
-00048f70: 6572 5f73 652e 6469 6666 2874 6869 735f  er_se.diff(this_
-00048f80: 7365 2c73 686f 7274 636f 6465 5f74 7261  se,shortcode_tra
-00048f90: 6e73 6c61 7469 6f6e 732c 7265 7665 7273  nslations,revers
-00048fa0: 655f 7472 616e 736c 6174 696f 6e73 290d  e_translations).
-00048fb0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00048fc0: 2020 2020 2020 2020 2020 2063 6f6d 702e             comp.
-00048fd0: 6973 5f69 6e5f 7365 6c66 2020 2020 2020  is_in_self      
-00048fe0: 2020 3d20 6973 5f69 6e5f 7365 6c66 0d0a    = is_in_self..
-00048ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049000: 2020 2020 2020 2020 636f 6d70 2e69 735f          comp.is_
-00049010: 696e 5f6f 7468 6572 2020 2020 2020 203d  in_other       =
-00049020: 2069 735f 696e 5f6f 7468 6572 0d0a 2020   is_in_other..  
-00049030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049040: 2020 2020 2020 6272 616e 6368 6573 5f6d        branches_m
-00049050: 6174 6368 203d 2063 6f6d 702e 7361 6d65  atch = comp.same
-00049060: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00049070: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00049080: 6f74 2062 7261 6e63 6865 735f 6d61 7463  ot branches_matc
-00049090: 683a 0d0a 2020 2020 2020 2020 2020 2020  h:..            
-000490a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000490b0: 7472 616e 736f 702b 3d27 3e27 0d0a 2020  transop+='>'..  
+00048e90: 2020 6973 5f69 6e5f 6f74 6865 7220 3d20    is_in_other = 
+00048ea0: 5472 7565 0d0a 0d0a 2020 2020 2020 2020  True....        
+00048eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ec0: 7468 6973 5f73 6520 3d20 7365 6c66 5f63  this_se = self_c
+00048ed0: 6869 6c64 7265 6e5f 706f 735f 6c6f 6f6b  hildren_pos_look
+00048ee0: 7570 5b74 6869 735f 706f 735d 0d0a 2020  up[this_pos]..  
+00048ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048f00: 2020 2020 2020 6f74 6865 725f 7365 203d        other_se =
+00048f10: 206f 7468 6572 5f63 6869 6c64 7265 6e5f   other_children_
+00048f20: 706f 735f 6c6f 6f6b 7570 5b6f 7468 6572  pos_lookup[other
+00048f30: 5f70 6f73 5d0d 0a0d 0a20 2020 2020 2020  _pos]....       
+00048f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048f50: 2023 5265 7665 7273 6520 7468 6520 636f   #Reverse the co
+00048f60: 6d70 6172 6973 6f6e 2066 6f72 206d 6f76  mparison for mov
+00048f70: 6564 2069 7465 6d73 0d0a 2020 2020 2020  ed items..      
+00048f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048f90: 2020 636f 6d70 203d 206f 7468 6572 5f73    comp = other_s
+00048fa0: 652e 6469 6666 2874 6869 735f 7365 2c73  e.diff(this_se,s
+00048fb0: 686f 7274 636f 6465 5f74 7261 6e73 6c61  hortcode_transla
+00048fc0: 7469 6f6e 732c 7265 7665 7273 655f 7472  tions,reverse_tr
+00048fd0: 616e 736c 6174 696f 6e73 290d 0a0d 0a20  anslations).... 
+00048fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00048ff0: 2020 2020 2020 2063 6f6d 702e 6973 5f69         comp.is_i
+00049000: 6e5f 7365 6c66 2020 2020 2020 2020 3d20  n_self        = 
+00049010: 6973 5f69 6e5f 7365 6c66 0d0a 2020 2020  is_in_self..    
+00049020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049030: 2020 2020 636f 6d70 2e69 735f 696e 5f6f      comp.is_in_o
+00049040: 7468 6572 2020 2020 2020 203d 2069 735f  ther       = is_
+00049050: 696e 5f6f 7468 6572 0d0a 2020 2020 2020  in_other..      
+00049060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049070: 2020 6272 616e 6368 6573 5f6d 6174 6368    branches_match
+00049080: 203d 2063 6f6d 702e 7361 6d65 0d0a 0d0a   = comp.same....
+00049090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000490a0: 2020 2020 2020 2020 6966 206e 6f74 2062          if not b
+000490b0: 7261 6e63 6865 735f 6d61 7463 683a 0d0a  ranches_match:..
 000490c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000490d0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-000490e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000490f0: 206f 7468 6572 5f73 6520 3d20 6f74 6865   other_se = othe
-00049100: 725f 6368 696c 6472 656e 5f70 6f73 5f6c  r_children_pos_l
-00049110: 6f6f 6b75 705b 6f74 6865 725f 706f 735d  ookup[other_pos]
-00049120: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00049130: 2020 2020 2020 2020 2020 636f 6d70 203d            comp =
-00049140: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
-00049150: 7443 6f6d 7061 7269 736f 6e28 6f74 6865  tComparison(othe
-00049160: 725f 7365 2c4e 6f6e 6529 0d0a 0d0a 0d0a  r_se,None)......
-00049170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049180: 2020 2020 2370 7269 6e74 2028 275c 7427      #print ('\t'
-00049190: 2b74 7261 6e73 6f70 2b27 2027 2b6b 290d  +transop+' '+k).
-000491a0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-000491b0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-000491c0: 2020 2020 2020 2020 2020 2020 2020 2354                #T
-000491d0: 6865 2062 7261 6e63 6865 7320 6172 6520  he branches are 
-000491e0: 6571 7561 6c20 6f6e 2074 6865 2066 6163  equal on the fac
-000491f0: 6520 6f66 2069 7420 2d20 6275 7420 6172  e of it - but ar
-00049200: 6520 7468 6520 6368 696c 6472 656e 2061  e the children a
-00049210: 6c6c 2074 6865 2077 6179 2064 6f77 6e20  ll the way down 
-00049220: 7468 6520 7361 6d65 3f0d 0a20 2020 2020  the same?..     
-00049230: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00049240: 4368 6563 6b20 7468 6520 6368 696c 6472  Check the childr
-00049250: 656e 0d0a 0d0a 2020 2020 2020 2020 2020  en....          
-00049260: 2020 2020 2020 2020 2020 6973 5f69 6e5f            is_in_
-00049270: 7365 6c66 203d 2054 7275 650d 0a20 2020  self = True..   
-00049280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049290: 2069 735f 696e 5f6f 7468 6572 203d 2054   is_in_other = T
-000492a0: 7275 650d 0a0d 0a20 2020 2020 2020 2020  rue....         
-000492b0: 2020 2020 2020 2020 2020 2074 6869 735f             this_
-000492c0: 706f 7320 203d 2073 656c 665f 6368 696c  pos  = self_chil
-000492d0: 6472 656e 5f6b 6579 735b 6b5d 0d0a 2020  dren_keys[k]..  
-000492e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000492f0: 2020 6f74 6865 725f 706f 7320 3d20 6f74    other_pos = ot
-00049300: 6865 725f 6368 696c 6472 656e 5f6b 6579  her_children_key
-00049310: 735b 6b5d 0d0a 0d0a 2020 2020 2020 2020  s[k]....        
-00049320: 2020 2020 2020 2020 2020 2020 7468 6973              this
-00049330: 5f73 6520 2020 3d20 7365 6c66 5f63 6869  _se   = self_chi
-00049340: 6c64 7265 6e5f 706f 735f 6c6f 6f6b 7570  ldren_pos_lookup
-00049350: 5b74 6869 735f 706f 735d 0d0a 2020 2020  [this_pos]..    
-00049360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049370: 6f74 6865 725f 7365 2020 3d20 6f74 6865  other_se  = othe
-00049380: 725f 6368 696c 6472 656e 5f70 6f73 5f6c  r_children_pos_l
-00049390: 6f6f 6b75 705b 6f74 6865 725f 706f 735d  ookup[other_pos]
-000493a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000493b0: 2020 2020 2020 2370 7269 6e74 2827 636f        #print('co
-000493c0: 6d70 6172 696e 6720 7b7d 2074 6f20 7b7d  mparing {} to {}
-000493d0: 272e 666f 726d 6174 2874 6869 735f 7365  '.format(this_se
-000493e0: 2e73 686f 7274 6e61 6d65 2c6f 7468 6572  .shortname,other
-000493f0: 5f73 652e 7368 6f72 746e 616d 6529 290d  _se.shortname)).
-00049400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00049410: 2020 2020 2063 6f6d 7020 3d20 7468 6973       comp = this
-00049420: 5f73 652e 6469 6666 286f 7468 6572 5f73  _se.diff(other_s
-00049430: 652c 7368 6f72 7463 6f64 655f 7472 616e  e,shortcode_tran
-00049440: 736c 6174 696f 6e73 2c72 6576 6572 7365  slations,reverse
-00049450: 5f74 7261 6e73 6c61 7469 6f6e 7329 0d0a  _translations)..
-00049460: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00049470: 2020 2020 2020 636f 6d70 2e69 735f 696e        comp.is_in
-00049480: 5f73 656c 6620 2020 2020 2020 203d 2069  _self        = i
-00049490: 735f 696e 5f73 656c 660d 0a20 2020 2020  s_in_self..     
-000494a0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000494b0: 6f6d 702e 6973 5f69 6e5f 6f74 6865 7220  omp.is_in_other 
-000494c0: 2020 2020 2020 3d20 6973 5f69 6e5f 6f74        = is_in_ot
-000494d0: 6865 720d 0a20 2020 2020 2020 2020 2020  her..           
-000494e0: 2020 2020 2020 2020 2062 7261 6e63 6865           branche
-000494f0: 735f 6d61 7463 6820 3d20 636f 6d70 2e73  s_match = comp.s
-00049500: 616d 650d 0a0d 0a20 2020 2020 2020 2020  ame....         
-00049510: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00049520: 7420 6272 616e 6368 6573 5f6d 6174 6368  t branches_match
-00049530: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00049540: 2020 2020 2020 2020 2020 2074 7261 6e73             trans
-00049550: 6f70 3d27 3e3e 270d 0a20 2020 2020 2020  op='>>'..       
-00049560: 2020 2020 2020 2020 2020 2020 2023 7072               #pr
-00049570: 696e 7428 6b2b 2027 5c74 272b 7472 616e  int(k+ '\t'+tran
-00049580: 736f 702b 2720 272b 6b29 0d0a 0d0a 2020  sop+' '+k)....  
-00049590: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000495a0: 2063 6f6d 7020 6973 206e 6f74 204e 6f6e   comp is not Non
-000495b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000495c0: 2020 2020 2020 2020 636f 6d70 2e6f 7020          comp.op 
-000495d0: 3d20 2020 2074 7261 6e73 6f70 0d0a 0d0a  =    transop....
+000490d0: 2020 2020 2020 2020 2020 2020 7472 616e              tran
+000490e0: 736f 702b 3d27 3e27 0d0a 2020 2020 2020  sop+='>'..      
+000490f0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00049100: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00049110: 2020 2020 2020 2020 2020 2020 206f 7468               oth
+00049120: 6572 5f73 6520 3d20 6f74 6865 725f 6368  er_se = other_ch
+00049130: 696c 6472 656e 5f70 6f73 5f6c 6f6f 6b75  ildren_pos_looku
+00049140: 705b 6f74 6865 725f 706f 735d 0d0a 2020  p[other_pos]..  
+00049150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049160: 2020 2020 2020 636f 6d70 203d 2053 7472        comp = Str
+00049170: 7563 7475 7265 456c 656d 656e 7443 6f6d  uctureElementCom
+00049180: 7061 7269 736f 6e28 6f74 6865 725f 7365  parison(other_se
+00049190: 2c4e 6f6e 6529 0d0a 0d0a 0d0a 2020 2020  ,None)......    
+000491a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000491b0: 2370 7269 6e74 2028 275c 7427 2b74 7261  #print ('\t'+tra
+000491c0: 6e73 6f70 2b27 2027 2b6b 290d 0a0d 0a20  nsop+' '+k).... 
+000491d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000491e0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+000491f0: 2020 2020 2020 2020 2020 2354 6865 2062            #The b
+00049200: 7261 6e63 6865 7320 6172 6520 6571 7561  ranches are equa
+00049210: 6c20 6f6e 2074 6865 2066 6163 6520 6f66  l on the face of
+00049220: 2069 7420 2d20 6275 7420 6172 6520 7468   it - but are th
+00049230: 6520 6368 696c 6472 656e 2061 6c6c 2074  e children all t
+00049240: 6865 2077 6179 2064 6f77 6e20 7468 6520  he way down the 
+00049250: 7361 6d65 3f0d 0a20 2020 2020 2020 2020  same?..         
+00049260: 2020 2020 2020 2020 2020 2023 4368 6563             #Chec
+00049270: 6b20 7468 6520 6368 696c 6472 656e 0d0a  k the children..
+00049280: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00049290: 2020 2020 2020 6973 5f69 6e5f 7365 6c66        is_in_self
+000492a0: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
+000492b0: 2020 2020 2020 2020 2020 2020 2069 735f               is_
+000492c0: 696e 5f6f 7468 6572 203d 2054 7275 650d  in_other = True.
+000492d0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+000492e0: 2020 2020 2020 2074 6869 735f 706f 7320         this_pos 
+000492f0: 203d 2073 656c 665f 6368 696c 6472 656e   = self_children
+00049300: 5f6b 6579 735b 6b5d 0d0a 2020 2020 2020  _keys[k]..      
+00049310: 2020 2020 2020 2020 2020 2020 2020 6f74                ot
+00049320: 6865 725f 706f 7320 3d20 6f74 6865 725f  her_pos = other_
+00049330: 6368 696c 6472 656e 5f6b 6579 735b 6b5d  children_keys[k]
+00049340: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00049350: 2020 2020 2020 2020 7468 6973 5f73 6520          this_se 
+00049360: 2020 3d20 7365 6c66 5f63 6869 6c64 7265    = self_childre
+00049370: 6e5f 706f 735f 6c6f 6f6b 7570 5b74 6869  n_pos_lookup[thi
+00049380: 735f 706f 735d 0d0a 2020 2020 2020 2020  s_pos]..        
+00049390: 2020 2020 2020 2020 2020 2020 6f74 6865              othe
+000493a0: 725f 7365 2020 3d20 6f74 6865 725f 6368  r_se  = other_ch
+000493b0: 696c 6472 656e 5f70 6f73 5f6c 6f6f 6b75  ildren_pos_looku
+000493c0: 705b 6f74 6865 725f 706f 735d 0d0a 2020  p[other_pos]..  
+000493d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000493e0: 2020 2370 7269 6e74 2827 636f 6d70 6172    #print('compar
+000493f0: 696e 6720 7b7d 2074 6f20 7b7d 272e 666f  ing {} to {}'.fo
+00049400: 726d 6174 2874 6869 735f 7365 2e73 686f  rmat(this_se.sho
+00049410: 7274 6e61 6d65 2c6f 7468 6572 5f73 652e  rtname,other_se.
+00049420: 7368 6f72 746e 616d 6529 290d 0a20 2020  shortname))..   
+00049430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049440: 2063 6f6d 7020 3d20 7468 6973 5f73 652e   comp = this_se.
+00049450: 6469 6666 286f 7468 6572 5f73 652c 7368  diff(other_se,sh
+00049460: 6f72 7463 6f64 655f 7472 616e 736c 6174  ortcode_translat
+00049470: 696f 6e73 2c72 6576 6572 7365 5f74 7261  ions,reverse_tra
+00049480: 6e73 6c61 7469 6f6e 7329 0d0a 0d0a 2020  nslations)....  
+00049490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000494a0: 2020 636f 6d70 2e69 735f 696e 5f73 656c    comp.is_in_sel
+000494b0: 6620 2020 2020 2020 203d 2069 735f 696e  f        = is_in
+000494c0: 5f73 656c 660d 0a20 2020 2020 2020 2020  _self..         
+000494d0: 2020 2020 2020 2020 2020 2063 6f6d 702e             comp.
+000494e0: 6973 5f69 6e5f 6f74 6865 7220 2020 2020  is_in_other     
+000494f0: 2020 3d20 6973 5f69 6e5f 6f74 6865 720d    = is_in_other.
+00049500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049510: 2020 2020 2062 7261 6e63 6865 735f 6d61       branches_ma
+00049520: 7463 6820 3d20 636f 6d70 2e73 616d 650d  tch = comp.same.
+00049530: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00049540: 2020 2020 2020 2069 6620 6e6f 7420 6272         if not br
+00049550: 616e 6368 6573 5f6d 6174 6368 3a0d 0a20  anches_match:.. 
+00049560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049570: 2020 2020 2020 2074 7261 6e73 6f70 3d27         transop='
+00049580: 3e3e 270d 0a20 2020 2020 2020 2020 2020  >>'..           
+00049590: 2020 2020 2020 2020 2023 7072 696e 7428           #print(
+000495a0: 6b2b 2027 5c74 272b 7472 616e 736f 702b  k+ '\t'+transop+
+000495b0: 2720 272b 6b29 0d0a 0d0a 2020 2020 2020  ' '+k)....      
+000495c0: 2020 2020 2020 2020 2020 6966 2063 6f6d            if com
+000495d0: 7020 6973 206e 6f74 204e 6f6e 653a 0d0a  p is not None:..
 000495e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000495f0: 2020 2020 636f 6d70 2e69 735f 696e 5f73      comp.is_in_s
-00049600: 656c 6620 2020 2020 2020 203d 2069 735f  elf        = is_
-00049610: 696e 5f73 656c 660d 0a20 2020 2020 2020  in_self..       
-00049620: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
-00049630: 702e 6973 5f69 6e5f 6f74 6865 7220 2020  p.is_in_other   
-00049640: 2020 2020 3d20 6973 5f69 6e5f 6f74 6865      = is_in_othe
-00049650: 720d 0a0d 0a20 2020 2020 2020 2020 2020  r....           
-00049660: 2020 2020 2020 2020 2073 6563 2e63 6f6d           sec.com
-00049670: 7061 7269 736f 6e5f 6c69 7374 2e61 7070  parison_list.app
-00049680: 656e 6428 636f 6d70 290d 0a0d 0a0d 0a0d  end(comp).......
-00049690: 0a0d 0a0d 0a20 2020 2020 2020 2072 6574  .....        ret
-000496a0: 7572 6e20 7365 630d 0a0d 0a63 6c61 7373  urn sec....class
-000496b0: 2045 6c65 6d65 6e74 5365 6375 7269 7479   ElementSecurity
-000496c0: 286f 626a 6563 7429 3a0d 0a20 2020 2027  (object):..    '
-000496d0: 2727 456e 6361 7073 756c 6174 6520 456c  ''Encapsulate El
-000496e0: 656d 656e 7420 7365 6375 7269 7479 2c20  ement security, 
-000496f0: 746f 206d 616b 6520 7669 6577 6572 732c  to make viewers,
-00049700: 2064 6174 615f 7669 6577 6572 7320 616e   data_viewers an
-00049710: 6420 6d6f 6469 6669 6572 7320 2727 270d  d modifiers '''.
-00049720: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00049730: 5f28 7365 6c66 0d0a 2020 2020 2020 2020  _(self..        
-00049740: 2020 2020 2020 2020 2c65 6c65 6d65 6e74          ,element
-00049750: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00049760: 2020 2c76 6965 7765 7273 203d 2073 6574    ,viewers = set
-00049770: 2829 0d0a 2020 2020 2020 2020 2020 2020  ()..            
-00049780: 2020 2020 2c64 6174 615f 7669 6577 6572      ,data_viewer
-00049790: 7320 3d20 7365 7428 290d 0a20 2020 2020  s = set()..     
-000497a0: 2020 2020 2020 2020 2020 202c 6d6f 6469             ,modi
-000497b0: 6669 6572 7320 3d20 7365 7428 290d 0a20  fiers = set().. 
-000497c0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-000497d0: 696e 6974 6961 6c69 7365 5f73 796e 6368  initialise_synch
-000497e0: 6564 203d 2046 616c 7365 0d0a 2020 2020  ed = False..    
-000497f0: 2020 2020 2020 2020 2020 2020 2c69 6e69              ,ini
-00049800: 7469 616c 6973 655f 6173 5f64 6566 6175  tialise_as_defau
-00049810: 6c74 203d 2054 7275 650d 0a20 2020 2020  lt = True..     
-00049820: 2020 2020 2020 2020 2020 2029 3a0d 0a0d             ):...
-00049830: 0a20 2020 2020 2020 2073 656c 662e 656c  .        self.el
-00049840: 656d 656e 7420 2020 2020 2020 203d 2065  ement        = e
-00049850: 6c65 6d65 6e74 0d0a 2020 2020 2020 2020  lement..        
-00049860: 7365 6c66 2e5f 7669 6577 6572 7320 2020  self._viewers   
-00049870: 2020 2020 3d20 5f53 6563 7572 6974 7955      = _SecurityU
-00049880: 7365 7273 4765 7474 6572 2865 6c65 6d65  sersGetter(eleme
-00049890: 6e74 203d 2065 6c65 6d65 6e74 2c20 7573  nt = element, us
-000498a0: 6572 7320 3d20 7669 6577 6572 732c 2069  ers = viewers, i
-000498b0: 6e69 7469 616c 6973 655f 7379 6e63 6865  nitialise_synche
-000498c0: 643d 696e 6974 6961 6c69 7365 5f73 796e  d=initialise_syn
-000498d0: 6368 6564 2c20 696e 6974 6961 6c69 7365  ched, initialise
-000498e0: 5f61 735f 6465 6661 756c 7420 3d20 696e  _as_default = in
-000498f0: 6974 6961 6c69 7365 5f61 735f 6465 6661  itialise_as_defa
-00049900: 756c 7429 0d0a 2020 2020 2020 2020 7365  ult)..        se
-00049910: 6c66 2e5f 6461 7461 5f76 6965 7765 7273  lf._data_viewers
-00049920: 2020 3d20 5f53 6563 7572 6974 7955 7365    = _SecurityUse
-00049930: 7273 4765 7474 6572 2865 6c65 6d65 6e74  rsGetter(element
-00049940: 203d 2065 6c65 6d65 6e74 2c20 7573 6572   = element, user
-00049950: 7320 3d20 6461 7461 5f76 6965 7765 7273  s = data_viewers
-00049960: 2c20 696e 6974 6961 6c69 7365 5f73 796e  , initialise_syn
-00049970: 6368 6564 3d69 6e69 7469 616c 6973 655f  ched=initialise_
-00049980: 7379 6e63 6865 642c 2069 6e69 7469 616c  synched, initial
-00049990: 6973 655f 6173 5f64 6566 6175 6c74 203d  ise_as_default =
-000499a0: 2069 6e69 7469 616c 6973 655f 6173 5f64   initialise_as_d
-000499b0: 6566 6175 6c74 290d 0a20 2020 2020 2020  efault)..       
-000499c0: 2073 656c 662e 5f6d 6f64 6966 6965 7273   self._modifiers
-000499d0: 2020 2020 203d 205f 5365 6375 7269 7479       = _Security
-000499e0: 5573 6572 7347 6574 7465 7228 656c 656d  UsersGetter(elem
-000499f0: 656e 7420 3d20 656c 656d 656e 742c 2075  ent = element, u
-00049a00: 7365 7273 203d 206d 6f64 6966 6965 7273  sers = modifiers
-00049a10: 2c20 696e 6974 6961 6c69 7365 5f73 796e  , initialise_syn
-00049a20: 6368 6564 3d69 6e69 7469 616c 6973 655f  ched=initialise_
-00049a30: 7379 6e63 6865 642c 2069 6e69 7469 616c  synched, initial
-00049a40: 6973 655f 6173 5f64 6566 6175 6c74 203d  ise_as_default =
-00049a50: 2069 6e69 7469 616c 6973 655f 6173 5f64   initialise_as_d
-00049a60: 6566 6175 6c74 290d 0a0d 0a20 2020 2040  efault)....    @
-00049a70: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-00049a80: 6620 7669 6577 6572 7328 7365 6c66 293a  f viewers(self):
-00049a90: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00049aa0: 2073 656c 662e 5f76 6965 7765 7273 0d0a   self._viewers..
-00049ab0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-00049ac0: 0a20 2020 2064 6566 2064 6174 615f 7669  .    def data_vi
-00049ad0: 6577 6572 7328 7365 6c66 293a 0d0a 2020  ewers(self):..  
-00049ae0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00049af0: 662e 5f64 6174 615f 7669 6577 6572 730d  f._data_viewers.
-00049b00: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-00049b10: 0d0a 2020 2020 6465 6620 6d6f 6469 6669  ..    def modifi
-00049b20: 6572 7328 7365 6c66 293a 0d0a 2020 2020  ers(self):..    
-00049b30: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00049b40: 5f6d 6f64 6966 6965 7273 0d0a 0d0a 2020  _modifiers....  
-00049b50: 2020 6465 6620 5f67 656e 6572 6963 5f73    def _generic_s
-00049b60: 6574 7465 7228 7365 6c66 2c20 6174 7472  etter(self, attr
-00049b70: 6962 7574 652c 2069 7465 6d2c 2061 7474  ibute, item, att
-00049b80: 7269 6275 7465 5f6e 616d 6529 3a0d 0a20  ribute_name):.. 
-00049b90: 2020 2020 2020 2027 2727 5573 6564 2066         '''Used f
-00049ba0: 6f72 2074 6865 2076 6965 7765 7273 2c20  or the viewers, 
-00049bb0: 6461 7461 5f76 6965 7765 7273 2061 6e64  data_viewers and
-00049bc0: 206d 6f64 6966 6965 7273 2073 6574 7465   modifiers sette
-00049bd0: 7273 2727 270d 0a20 2020 2020 2020 2069  rs'''..        i
-00049be0: 6620 6973 696e 7374 616e 6365 2869 7465  f isinstance(ite
-00049bf0: 6d2c 205f 5365 6375 7269 7479 5573 6572  m, _SecurityUser
-00049c00: 7347 6574 7465 7229 3a0d 0a20 2020 2020  sGetter):..     
-00049c10: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
-00049c20: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00049c30: 2020 2020 2020 2020 2020 2343 616e 2774            #Can't
-00049c40: 2073 6574 2074 6f20 6120 6e65 7720 7374   set to a new st
-00049c50: 7269 6e67 2069 6620 6e6f 7420 656d 7074  ring if not empt
-00049c60: 7920 2d20 7468 6973 2069 7320 746f 6f20  y - this is too 
-00049c70: 756e 7361 6665 2e20 496e 7369 7374 206f  unsafe. Insist o
-00049c80: 6e20 6361 6c6c 696e 6720 2e63 6c65 6172  n calling .clear
-00049c90: 2829 2066 6972 7374 0d0a 2020 2020 2020  () first..      
-00049ca0: 2020 2020 2020 6966 206c 656e 2861 7474        if len(att
-00049cb0: 7269 6275 7465 2920 3e20 303a 0d0a 2020  ribute) > 0:..  
-00049cc0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00049cd0: 6973 6520 4174 7472 6962 7574 6545 7272  ise AttributeErr
-00049ce0: 6f72 2827 4361 6e6e 6f74 2061 6464 207b  or('Cannot add {
-00049cf0: 7d20 6f66 2074 7970 6520 7b7d 2074 6f20  } of type {} to 
-00049d00: 7b7d 2062 6563 6175 7365 207b 7d20 6973  {} because {} is
-00049d10: 206e 6f74 2065 6d70 7479 2e20 5573 6520   not empty. Use 
-00049d20: 7b7d 2e63 6c65 6172 2829 2074 6f20 656d  {}.clear() to em
-00049d30: 7074 7920 6f72 202b 3d20 746f 2061 6464  pty or += to add
-00049d40: 2065 7874 7261 2069 7465 6d73 272e 666f   extra items'.fo
-00049d50: 726d 6174 2872 6570 7228 6974 656d 292c  rmat(repr(item),
-00049d60: 7479 7065 2869 7465 6d29 2c61 7474 7269  type(item),attri
-00049d70: 6275 7465 5f6e 616d 652c 6174 7472 6962  bute_name,attrib
-00049d80: 7574 655f 6e61 6d65 2c61 7474 7269 6275  ute_name,attribu
-00049d90: 7465 5f6e 616d 6529 290d 0a0d 0a20 2020  te_name))....   
-00049da0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-00049db0: 7374 616e 6365 2869 7465 6d2c 7374 7229  stance(item,str)
-00049dc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00049dd0: 2020 2061 7474 7269 6275 7465 2e61 6464     attribute.add
-00049de0: 2869 7465 6d29 0d0a 2020 2020 2020 2020  (item)..        
-00049df0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00049e00: 2020 2020 2020 2020 2020 2069 6e6e 6572             inner
-00049e10: 5f65 7272 6f72 203d 2046 616c 7365 0d0a  _error = False..
-00049e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049e30: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-00049e40: 2020 2020 2020 2020 2020 666f 7220 7375            for su
-00049e50: 6269 7465 6d20 696e 2069 7465 6d3a 0d0a  bitem in item:..
-00049e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049e70: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00049e80: 7461 6e63 6528 7375 6269 7465 6d2c 7374  tance(subitem,st
-00049e90: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
-00049ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049eb0: 2061 7474 7269 6275 7465 2e61 6464 2873   attribute.add(s
-00049ec0: 7562 6974 656d 290d 0a20 2020 2020 2020  ubitem)..       
-00049ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049ee0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00049ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049f00: 2020 2020 696e 6e65 725f 6572 726f 7220      inner_error 
-00049f10: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+000495f0: 2020 2020 636f 6d70 2e6f 7020 3d20 2020      comp.op =   
+00049600: 2074 7261 6e73 6f70 0d0a 0d0a 2020 2020   transop....    
+00049610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049620: 636f 6d70 2e69 735f 696e 5f73 656c 6620  comp.is_in_self 
+00049630: 2020 2020 2020 203d 2069 735f 696e 5f73         = is_in_s
+00049640: 656c 660d 0a20 2020 2020 2020 2020 2020  elf..           
+00049650: 2020 2020 2020 2020 2063 6f6d 702e 6973           comp.is
+00049660: 5f69 6e5f 6f74 6865 7220 2020 2020 2020  _in_other       
+00049670: 3d20 6973 5f69 6e5f 6f74 6865 720d 0a0d  = is_in_other...
+00049680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049690: 2020 2020 2073 6563 2e63 6f6d 7061 7269       sec.compari
+000496a0: 736f 6e5f 6c69 7374 2e61 7070 656e 6428  son_list.append(
+000496b0: 636f 6d70 290d 0a0d 0a0d 0a0d 0a0d 0a0d  comp)...........
+000496c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000496d0: 7365 630d 0a0d 0a63 6c61 7373 2045 6c65  sec....class Ele
+000496e0: 6d65 6e74 5365 6375 7269 7479 286f 626a  mentSecurity(obj
+000496f0: 6563 7429 3a0d 0a20 2020 2027 2727 456e  ect):..    '''En
+00049700: 6361 7073 756c 6174 6520 456c 656d 656e  capsulate Elemen
+00049710: 7420 7365 6375 7269 7479 2c20 746f 206d  t security, to m
+00049720: 616b 6520 7669 6577 6572 732c 2064 6174  ake viewers, dat
+00049730: 615f 7669 6577 6572 7320 616e 6420 6d6f  a_viewers and mo
+00049740: 6469 6669 6572 7320 2727 270d 0a20 2020  difiers '''..   
+00049750: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+00049760: 6c66 0d0a 2020 2020 2020 2020 2020 2020  lf..            
+00049770: 2020 2020 2c65 6c65 6d65 6e74 0d0a 2020      ,element..  
+00049780: 2020 2020 2020 2020 2020 2020 2020 2c76                ,v
+00049790: 6965 7765 7273 203d 2073 6574 2829 0d0a  iewers = set()..
+000497a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000497b0: 2c64 6174 615f 7669 6577 6572 7320 3d20  ,data_viewers = 
+000497c0: 7365 7428 290d 0a20 2020 2020 2020 2020  set()..         
+000497d0: 2020 2020 2020 202c 6d6f 6469 6669 6572         ,modifier
+000497e0: 7320 3d20 7365 7428 290d 0a20 2020 2020  s = set()..     
+000497f0: 2020 2020 2020 2020 2020 202c 696e 6974             ,init
+00049800: 6961 6c69 7365 5f73 796e 6368 6564 203d  ialise_synched =
+00049810: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
+00049820: 2020 2020 2020 2020 2c69 6e69 7469 616c          ,initial
+00049830: 6973 655f 6173 5f64 6566 6175 6c74 203d  ise_as_default =
+00049840: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
+00049850: 2020 2020 2020 2029 3a0d 0a0d 0a20 2020         ):....   
+00049860: 2020 2020 2073 656c 662e 656c 656d 656e       self.elemen
+00049870: 7420 2020 2020 2020 203d 2065 6c65 6d65  t        = eleme
+00049880: 6e74 0d0a 2020 2020 2020 2020 7365 6c66  nt..        self
+00049890: 2e5f 7669 6577 6572 7320 2020 2020 2020  ._viewers       
+000498a0: 3d20 5f53 6563 7572 6974 7955 7365 7273  = _SecurityUsers
+000498b0: 4765 7474 6572 2865 6c65 6d65 6e74 203d  Getter(element =
+000498c0: 2065 6c65 6d65 6e74 2c20 7573 6572 7320   element, users 
+000498d0: 3d20 7669 6577 6572 732c 2069 6e69 7469  = viewers, initi
+000498e0: 616c 6973 655f 7379 6e63 6865 643d 696e  alise_synched=in
+000498f0: 6974 6961 6c69 7365 5f73 796e 6368 6564  itialise_synched
+00049900: 2c20 696e 6974 6961 6c69 7365 5f61 735f  , initialise_as_
+00049910: 6465 6661 756c 7420 3d20 696e 6974 6961  default = initia
+00049920: 6c69 7365 5f61 735f 6465 6661 756c 7429  lise_as_default)
+00049930: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00049940: 6461 7461 5f76 6965 7765 7273 2020 3d20  data_viewers  = 
+00049950: 5f53 6563 7572 6974 7955 7365 7273 4765  _SecurityUsersGe
+00049960: 7474 6572 2865 6c65 6d65 6e74 203d 2065  tter(element = e
+00049970: 6c65 6d65 6e74 2c20 7573 6572 7320 3d20  lement, users = 
+00049980: 6461 7461 5f76 6965 7765 7273 2c20 696e  data_viewers, in
+00049990: 6974 6961 6c69 7365 5f73 796e 6368 6564  itialise_synched
+000499a0: 3d69 6e69 7469 616c 6973 655f 7379 6e63  =initialise_sync
+000499b0: 6865 642c 2069 6e69 7469 616c 6973 655f  hed, initialise_
+000499c0: 6173 5f64 6566 6175 6c74 203d 2069 6e69  as_default = ini
+000499d0: 7469 616c 6973 655f 6173 5f64 6566 6175  tialise_as_defau
+000499e0: 6c74 290d 0a20 2020 2020 2020 2073 656c  lt)..        sel
+000499f0: 662e 5f6d 6f64 6966 6965 7273 2020 2020  f._modifiers    
+00049a00: 203d 205f 5365 6375 7269 7479 5573 6572   = _SecurityUser
+00049a10: 7347 6574 7465 7228 656c 656d 656e 7420  sGetter(element 
+00049a20: 3d20 656c 656d 656e 742c 2075 7365 7273  = element, users
+00049a30: 203d 206d 6f64 6966 6965 7273 2c20 696e   = modifiers, in
+00049a40: 6974 6961 6c69 7365 5f73 796e 6368 6564  itialise_synched
+00049a50: 3d69 6e69 7469 616c 6973 655f 7379 6e63  =initialise_sync
+00049a60: 6865 642c 2069 6e69 7469 616c 6973 655f  hed, initialise_
+00049a70: 6173 5f64 6566 6175 6c74 203d 2069 6e69  as_default = ini
+00049a80: 7469 616c 6973 655f 6173 5f64 6566 6175  tialise_as_defau
+00049a90: 6c74 290d 0a0d 0a20 2020 2040 7072 6f70  lt)....    @prop
+00049aa0: 6572 7479 0d0a 2020 2020 6465 6620 7669  erty..    def vi
+00049ab0: 6577 6572 7328 7365 6c66 293a 0d0a 2020  ewers(self):..  
+00049ac0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00049ad0: 662e 5f76 6965 7765 7273 0d0a 0d0a 2020  f._viewers....  
+00049ae0: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+00049af0: 2064 6566 2064 6174 615f 7669 6577 6572   def data_viewer
+00049b00: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+00049b10: 2020 7265 7475 726e 2073 656c 662e 5f64    return self._d
+00049b20: 6174 615f 7669 6577 6572 730d 0a0d 0a20  ata_viewers.... 
+00049b30: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+00049b40: 2020 6465 6620 6d6f 6469 6669 6572 7328    def modifiers(
+00049b50: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00049b60: 7265 7475 726e 2073 656c 662e 5f6d 6f64  return self._mod
+00049b70: 6966 6965 7273 0d0a 0d0a 2020 2020 6465  ifiers....    de
+00049b80: 6620 5f67 656e 6572 6963 5f73 6574 7465  f _generic_sette
+00049b90: 7228 7365 6c66 2c20 6174 7472 6962 7574  r(self, attribut
+00049ba0: 652c 2069 7465 6d2c 2061 7474 7269 6275  e, item, attribu
+00049bb0: 7465 5f6e 616d 6529 3a0d 0a20 2020 2020  te_name):..     
+00049bc0: 2020 2027 2727 5573 6564 2066 6f72 2074     '''Used for t
+00049bd0: 6865 2076 6965 7765 7273 2c20 6461 7461  he viewers, data
+00049be0: 5f76 6965 7765 7273 2061 6e64 206d 6f64  _viewers and mod
+00049bf0: 6966 6965 7273 2073 6574 7465 7273 2727  ifiers setters''
+00049c00: 270d 0a20 2020 2020 2020 2069 6620 6973  '..        if is
+00049c10: 696e 7374 616e 6365 2869 7465 6d2c 205f  instance(item, _
+00049c20: 5365 6375 7269 7479 5573 6572 7347 6574  SecurityUsersGet
+00049c30: 7465 7229 3a0d 0a20 2020 2020 2020 2020  ter):..         
+00049c40: 2020 2070 6173 730d 0a0d 0a20 2020 2020     pass....     
+00049c50: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00049c60: 2020 2020 2020 2343 616e 2774 2073 6574        #Can't set
+00049c70: 2074 6f20 6120 6e65 7720 7374 7269 6e67   to a new string
+00049c80: 2069 6620 6e6f 7420 656d 7074 7920 2d20   if not empty - 
+00049c90: 7468 6973 2069 7320 746f 6f20 756e 7361  this is too unsa
+00049ca0: 6665 2e20 496e 7369 7374 206f 6e20 6361  fe. Insist on ca
+00049cb0: 6c6c 696e 6720 2e63 6c65 6172 2829 2066  lling .clear() f
+00049cc0: 6972 7374 0d0a 2020 2020 2020 2020 2020  irst..          
+00049cd0: 2020 6966 206c 656e 2861 7474 7269 6275    if len(attribu
+00049ce0: 7465 2920 3e20 303a 0d0a 2020 2020 2020  te) > 0:..      
+00049cf0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00049d00: 4174 7472 6962 7574 6545 7272 6f72 2827  AttributeError('
+00049d10: 4361 6e6e 6f74 2061 6464 207b 7d20 6f66  Cannot add {} of
+00049d20: 2074 7970 6520 7b7d 2074 6f20 7b7d 2062   type {} to {} b
+00049d30: 6563 6175 7365 207b 7d20 6973 206e 6f74  ecause {} is not
+00049d40: 2065 6d70 7479 2e20 5573 6520 7b7d 2e63   empty. Use {}.c
+00049d50: 6c65 6172 2829 2074 6f20 656d 7074 7920  lear() to empty 
+00049d60: 6f72 202b 3d20 746f 2061 6464 2065 7874  or += to add ext
+00049d70: 7261 2069 7465 6d73 272e 666f 726d 6174  ra items'.format
+00049d80: 2872 6570 7228 6974 656d 292c 7479 7065  (repr(item),type
+00049d90: 2869 7465 6d29 2c61 7474 7269 6275 7465  (item),attribute
+00049da0: 5f6e 616d 652c 6174 7472 6962 7574 655f  _name,attribute_
+00049db0: 6e61 6d65 2c61 7474 7269 6275 7465 5f6e  name,attribute_n
+00049dc0: 616d 6529 290d 0a0d 0a20 2020 2020 2020  ame))....       
+00049dd0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00049de0: 6365 2869 7465 6d2c 7374 7229 3a0d 0a20  ce(item,str):.. 
+00049df0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00049e00: 7474 7269 6275 7465 2e61 6464 2869 7465  ttribute.add(ite
+00049e10: 6d29 0d0a 2020 2020 2020 2020 2020 2020  m)..            
+00049e20: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00049e30: 2020 2020 2020 2069 6e6e 6572 5f65 7272         inner_err
+00049e40: 6f72 203d 2046 616c 7365 0d0a 2020 2020  or = False..    
+00049e50: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00049e60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00049e70: 2020 2020 2020 666f 7220 7375 6269 7465        for subite
+00049e80: 6d20 696e 2069 7465 6d3a 0d0a 2020 2020  m in item:..    
+00049e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049ea0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00049eb0: 6528 7375 6269 7465 6d2c 7374 7229 3a0d  e(subitem,str):.
+00049ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00049ed0: 2020 2020 2020 2020 2020 2020 2061 7474               att
+00049ee0: 7269 6275 7465 2e61 6464 2873 7562 6974  ribute.add(subit
+00049ef0: 656d 290d 0a20 2020 2020 2020 2020 2020  em)..           
+00049f00: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00049f10: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
 00049f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00049f30: 2020 2020 7261 6973 6520 4174 7472 6962      raise Attrib
-00049f40: 7574 6545 7272 6f72 2827 4361 6e6e 6f74  uteError('Cannot
-00049f50: 2061 6464 207b 7d20 6f66 2074 7970 6520   add {} of type 
-00049f60: 7b7d 2074 6f20 7b7d 2066 726f 6d20 6974  {} to {} from it
-00049f70: 6572 6162 6c65 207b 7d2e 2043 616e 206f  erable {}. Can o
-00049f80: 6e6c 7920 6164 6420 7368 6f72 7463 6f64  nly add shortcod
-00049f90: 6520 7374 7269 6e67 7320 746f 2061 6e20  e strings to an 
-00049fa0: 656d 7074 7920 7b7d 272e 666f 726d 6174  empty {}'.format
-00049fb0: 2872 6570 7228 7375 6269 7465 6d29 2c74  (repr(subitem),t
-00049fc0: 7970 6528 7375 6269 7465 6d29 2c61 7474  ype(subitem),att
-00049fd0: 7269 6275 7465 5f6e 616d 652c 7374 7228  ribute_name,str(
-00049fe0: 6974 656d 292c 6174 7472 6962 7574 655f  item),attribute_
-00049ff0: 6e61 6d65 2929 0d0a 2020 2020 2020 2020  name))..        
-0004a000: 2020 2020 2020 2020 2354 7970 6520 6572          #Type er
-0004a010: 726f 7220 7261 6973 6564 2069 6620 7472  ror raised if tr
-0004a020: 7969 6e67 2074 6f20 6974 6572 6174 6520  ying to iterate 
-0004a030: 6f76 6572 2061 206e 6f6e 2d69 7465 7261  over a non-itera
-0004a040: 626c 650d 0a20 2020 2020 2020 2020 2020  ble..           
-0004a050: 2020 2020 2065 7863 6570 7420 5479 7065       except Type
-0004a060: 4572 726f 7220 6173 2074 653a 0d0a 2020  Error as te:..  
-0004a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a080: 2020 6966 2069 6e6e 6572 5f65 7272 6f72    if inner_error
-0004a090: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004a0a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0004a0b0: 2074 650d 0a20 2020 2020 2020 2020 2020   te..           
-0004a0c0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-0004a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004a0e0: 2020 2020 2020 2020 7261 6973 6520 4174          raise At
-0004a0f0: 7472 6962 7574 6545 7272 6f72 2827 4361  tributeError('Ca
-0004a100: 6e6e 6f74 2061 6464 207b 7d20 6f66 2074  nnot add {} of t
-0004a110: 7970 6520 7b7d 2074 6f20 7b7d 2e20 4361  ype {} to {}. Ca
-0004a120: 6e20 6f6e 6c79 2061 6464 2073 686f 7274  n only add short
-0004a130: 636f 6465 2073 7472 696e 6773 2074 6f20  code strings to 
-0004a140: 616e 2065 6d70 7479 207b 7d27 2e66 6f72  an empty {}'.for
-0004a150: 6d61 7428 7265 7072 2869 7465 6d29 2c74  mat(repr(item),t
-0004a160: 7970 6528 6974 656d 292c 6174 7472 6962  ype(item),attrib
-0004a170: 7574 655f 6e61 6d65 2c61 7474 7269 6275  ute_name,attribu
-0004a180: 7465 5f6e 616d 6529 290d 0a0d 0a20 2020  te_name))....   
-0004a190: 2020 2020 2072 6574 7572 6e20 6174 7472       return attr
-0004a1a0: 6962 7574 650d 0a0d 0a20 2020 2040 7669  ibute....    @vi
-0004a1b0: 6577 6572 732e 7365 7474 6572 0d0a 2020  ewers.setter..  
-0004a1c0: 2020 6465 6620 7669 6577 6572 7328 7365    def viewers(se
-0004a1d0: 6c66 2c69 7465 6d29 3a0d 0a20 2020 2020  lf,item):..     
-0004a1e0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0004a1f0: 6765 6e65 7269 635f 7365 7474 6572 2873  generic_setter(s
-0004a200: 656c 662e 5f76 6965 7765 7273 2c20 6974  elf._viewers, it
-0004a210: 656d 2c20 6174 7472 6962 7574 655f 6e61  em, attribute_na
-0004a220: 6d65 3d27 7669 6577 6572 7327 290d 0a0d  me='viewers')...
-0004a230: 0a20 2020 2040 6461 7461 5f76 6965 7765  .    @data_viewe
-0004a240: 7273 2e73 6574 7465 720d 0a20 2020 2064  rs.setter..    d
-0004a250: 6566 2064 6174 615f 7669 6577 6572 7328  ef data_viewers(
-0004a260: 7365 6c66 2c69 7465 6d29 3a0d 0a20 2020  self,item):..   
-0004a270: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0004a280: 2e5f 6765 6e65 7269 635f 7365 7474 6572  ._generic_setter
-0004a290: 2873 656c 662e 5f64 6174 615f 7669 6577  (self._data_view
-0004a2a0: 6572 732c 2069 7465 6d2c 2061 7474 7269  ers, item, attri
-0004a2b0: 6275 7465 5f6e 616d 653d 2764 6174 615f  bute_name='data_
-0004a2c0: 7669 6577 6572 7327 290d 0a0d 0a20 2020  viewers')....   
-0004a2d0: 2040 6d6f 6469 6669 6572 732e 7365 7474   @modifiers.sett
-0004a2e0: 6572 0d0a 2020 2020 6465 6620 6d6f 6469  er..    def modi
-0004a2f0: 6669 6572 7328 7365 6c66 2c69 7465 6d29  fiers(self,item)
-0004a300: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-0004a310: 6e20 7365 6c66 2e5f 6765 6e65 7269 635f  n self._generic_
-0004a320: 7365 7474 6572 2873 656c 662e 5f6d 6f64  setter(self._mod
-0004a330: 6966 6965 7273 2c20 6974 656d 2c20 6174  ifiers, item, at
-0004a340: 7472 6962 7574 655f 6e61 6d65 3d27 6d6f  tribute_name='mo
-0004a350: 6469 6669 6572 7327 290d 0a0d 0a20 2020  difiers')....   
-0004a360: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-0004a370: 6465 6620 6564 6974 6564 2873 656c 6629  def edited(self)
-0004a380: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-0004a390: 6e20 7365 6c66 2e76 6965 7765 7273 2e65  n self.viewers.e
-0004a3a0: 6469 7465 6420 6f72 2073 656c 662e 6461  dited or self.da
-0004a3b0: 7461 5f76 6965 7765 7273 2e65 6469 7465  ta_viewers.edite
-0004a3c0: 6420 6f72 2073 656c 662e 6d6f 6469 6669  d or self.modifi
-0004a3d0: 6572 732e 6564 6974 6564 0d0a 0d0a 0d0a  ers.edited......
-0004a3e0: 636c 6173 7320 4669 656c 6444 6566 696e  class FieldDefin
-0004a3f0: 6974 696f 6e28 6f62 6a65 6374 293a 0d0a  ition(object):..
-0004a400: 2020 2020 2727 2744 6566 696e 6974 696f      '''Definitio
-0004a410: 6e20 6f66 2061 2044 696d 656e 7369 6f6e  n of a Dimension
-0004a420: 2046 6965 6c64 2e20 4265 6c6f 6e67 7320   Field. Belongs 
-0004a430: 746f 2061 2044 696d 656e 7369 6f6e 2c20  to a Dimension, 
-0004a440: 6e6f 7420 746f 2061 6e20 456c 656d 656e  not to an Elemen
-0004a450: 7427 2727 0d0a 2020 2020 6465 6620 5f5f  t'''..    def __
-0004a460: 696e 6974 5f5f 2873 656c 662c 206c 6f6e  init__(self, lon
-0004a470: 676e 616d 6520 2c20 7368 6f72 746e 616d  gname , shortnam
-0004a480: 653d 4e6f 6e65 2c64 6573 6372 6970 7469  e=None,descripti
-0004a490: 6f6e 3d4e 6f6e 6529 3a0d 0a0d 0a20 2020  on=None):....   
-0004a4a0: 2020 2020 2069 6620 7368 6f72 746e 616d       if shortnam
-0004a4b0: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
-0004a4c0: 2020 2020 2020 2020 2020 2020 7368 6f72              shor
-0004a4d0: 746e 616d 6520 3d20 7374 7228 7368 6f72  tname = str(shor
-0004a4e0: 746e 616d 6529 0d0a 0d0a 2020 2020 2020  tname)....      
-0004a4f0: 2020 2020 2020 6966 206c 656e 2873 686f        if len(sho
-0004a500: 7274 6e61 6d65 2920 3d3d 2030 3a0d 0a20  rtname) == 0:.. 
-0004a510: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0004a520: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0004a530: 2246 6965 6c64 4465 6669 6e69 7469 6f6e  "FieldDefinition
-0004a540: 2077 6173 2063 7265 6174 6564 2077 6974   was created wit
-0004a550: 6820 6120 7368 6f72 746e 616d 6520 7769  h a shortname wi
-0004a560: 7468 207a 6572 6f20 6368 6172 6163 7465  th zero characte
-0004a570: 7273 2e20 4578 706c 6963 6974 2073 686f  rs. Explicit sho
-0004a580: 7274 6e61 6d65 7320 696e 2061 2046 6965  rtnames in a Fie
-0004a590: 6c64 4465 6669 6e69 7469 6f6e 206d 7573  ldDefinition mus
-0004a5a0: 7420 6e6f 7420 6265 2061 6e20 656d 7074  t not be an empt
-0004a5b0: 7920 7374 7269 6e67 2229 0d0a 2020 2020  y string")..    
-0004a5c0: 2020 2020 2020 2020 6966 206c 656e 2873          if len(s
-0004a5d0: 686f 7274 6e61 6d65 2920 3e20 6c6c 752e  hortname) > llu.
-0004a5e0: 7368 6f72 746e 616d 655f 7369 7a65 3a0d  shortname_size:.
-0004a5f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004a600: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0004a610: 7228 2246 6965 6c64 4465 6669 6e69 7469  r("FieldDefiniti
-0004a620: 6f6e 2077 6173 2063 7265 6174 6564 2077  on was created w
-0004a630: 6974 6820 6120 7368 6f72 746e 616d 6520  ith a shortname 
-0004a640: 7769 7468 2067 7265 6174 6572 2074 6861  with greater tha
-0004a650: 6e20 7b30 7d20 6368 6172 6163 7465 7273  n {0} characters
-0004a660: 2028 7b31 7d29 2e20 4578 706c 6963 6974   ({1}). Explicit
-0004a670: 2073 686f 7274 6e61 6d65 7320 696e 2061   shortnames in a
-0004a680: 2046 6965 6c64 4465 6669 6e69 7469 6f6e   FieldDefinition
-0004a690: 206d 7573 7420 6265 206c 6573 7320 7468   must be less th
-0004a6a0: 616e 207b 307d 2063 6861 7261 6374 6572  an {0} character
-0004a6b0: 7320 6c6f 6e67 222e 666f 726d 6174 286c  s long".format(l
-0004a6c0: 6c75 2e73 686f 7274 6e61 6d65 5f73 697a  lu.shortname_siz
-0004a6d0: 652c 2073 686f 7274 6e61 6d65 2929 0d0a  e, shortname))..
-0004a6e0: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0004a6f0: 7220 6368 6172 6163 7465 7220 696e 2022  r character in "
-0004a700: 272b 2d2a 2f28 2940 2c7c 5e3d 5c72 5c6e  '+-*/()@,|^=\r\n
-0004a710: 5c74 222b 7227 2220 273a 0d0a 2020 2020  \t"+r'" ':..    
-0004a720: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0004a730: 6861 7261 6374 6572 2069 6e20 7368 6f72  haracter in shor
-0004a740: 746e 616d 653a 0d0a 2020 2020 2020 2020  tname:..        
-0004a750: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0004a760: 6520 5661 6c75 6545 7272 6f72 2822 4669  e ValueError("Fi
-0004a770: 656c 6444 6566 696e 6974 696f 6e20 7761  eldDefinition wa
-0004a780: 7320 6372 6561 7465 6420 7769 7468 2061  s created with a
-0004a790: 2073 686f 7274 6e61 6d65 2028 7b7d 2920   shortname ({}) 
-0004a7a0: 7768 6963 6820 636f 6e74 6169 6e65 6420  which contained 
-0004a7b0: 6120 6261 6420 6368 6172 6163 7465 7220  a bad character 
-0004a7c0: 287b 7d29 2e20 4669 656c 6444 6566 696e  ({}). FieldDefin
-0004a7d0: 6974 696f 6e20 7368 6f72 746e 616d 6573  ition shortnames
-0004a7e0: 2061 7265 2072 6573 7472 6963 7465 6420   are restricted 
-0004a7f0: 746f 2073 7461 6e64 6172 6420 6368 6172  to standard char
-0004a800: 6163 7465 7273 222e 666f 726d 6174 2873  acters".format(s
-0004a810: 686f 7274 6e61 6d65 2c63 6861 7261 6374  hortname,charact
-0004a820: 6572 2929 0d0a 0d0a 2020 2020 2020 2020  er))....        
-0004a830: 7365 6c66 2e73 686f 7274 6e61 6d65 2020  self.shortname  
-0004a840: 203d 2073 686f 7274 6e61 6d65 0d0a 0d0a   = shortname....
-0004a850: 2020 2020 2020 2020 7365 6c66 2e6c 6f6e          self.lon
-0004a860: 676e 616d 6520 2020 203d 206c 6f6e 676e  gname    = longn
-0004a870: 616d 650d 0a20 2020 2020 2020 2073 656c  ame..        sel
-0004a880: 662e 6465 7363 7269 7074 696f 6e20 3d20  f.description = 
-0004a890: 6465 7363 7269 7074 696f 6e0d 0a0d 0a0d  description.....
-0004a8a0: 0a63 6c61 7373 2056 6965 7770 6f69 6e74  .class Viewpoint
-0004a8b0: 286f 626a 6563 7429 3a0d 0a20 2020 2027  (object):..    '
-0004a8c0: 2727 416e 2045 6d70 6f77 6572 2056 6965  ''An Empower Vie
-0004a8d0: 7770 6f69 6e74 2e20 4120 7669 6577 706f  wpoint. A viewpo
-0004a8e0: 696e 7420 7370 6563 6966 6965 7320 6120  int specifies a 
-0004a8f0: 7375 6263 7562 6520 6f66 2074 6865 2065  subcube of the e
-0004a900: 6e74 6972 6520 456d 706f 7765 7220 6375  ntire Empower cu
-0004a910: 6265 2e20 5765 2072 6561 6420 616e 6420  be. We read and 
-0004a920: 6c6f 6164 2064 6174 6120 6672 6f6d 2056  load data from V
-0004a930: 6965 7770 6f69 6e74 732e 0d0a 2020 2020  iewpoints...    
-0004a940: 5669 6577 706f 696e 7473 2061 7265 2061  Viewpoints are a
-0004a950: 2063 6f6c 6c65 6374 696f 6e20 6f66 2073   collection of s
-0004a960: 7472 7563 7475 7265 732c 2077 6974 6820  tructures, with 
-0004a970: 6f6e 6520 7374 7275 6374 7572 6520 7065  one structure pe
-0004a980: 7220 6469 6d65 6e73 696f 6e2e 0d0a 2020  r dimension...  
-0004a990: 2020 2727 270d 0a20 2020 2064 6566 205f    '''..    def _
-0004a9a0: 5f69 6e69 745f 5f28 7365 6c66 2c20 7368  _init__(self, sh
-0004a9b0: 6f72 746e 616d 652c 2073 7472 7563 7475  ortname, structu
-0004a9c0: 7265 5f30 3d4e 6f6e 652c 2073 7472 7563  re_0=None, struc
-0004a9d0: 7475 7265 5f31 3d4e 6f6e 652c 2073 7472  ture_1=None, str
-0004a9e0: 7563 7475 7265 5f32 3d4e 6f6e 652c 2073  ucture_2=None, s
-0004a9f0: 7472 7563 7475 7265 5f33 3d4e 6f6e 652c  tructure_3=None,
-0004aa00: 2073 7472 7563 7475 7265 5f34 3d4e 6f6e   structure_4=Non
-0004aa10: 652c 2073 7472 7563 7475 7265 5f35 3d4e  e, structure_5=N
-0004aa20: 6f6e 652c 2073 7472 7563 7475 7265 5f36  one, structure_6
-0004aa30: 3d4e 6f6e 652c 2073 7472 7563 7475 7265  =None, structure
-0004aa40: 5f37 3d4e 6f6e 652c 2073 7472 7563 7475  _7=None, structu
-0004aa50: 7265 5f38 3d4e 6f6e 652c 2073 7472 7563  re_8=None, struc
-0004aa60: 7475 7265 5f39 3d4e 6f6e 652c 2073 7472  ture_9=None, str
-0004aa70: 7563 7475 7265 5f31 303d 4e6f 6e65 2c20  ucture_10=None, 
-0004aa80: 7374 7275 6374 7572 655f 3131 3d4e 6f6e  structure_11=Non
-0004aa90: 652c 2073 7472 7563 7475 7265 5f31 323d  e, structure_12=
-0004aaa0: 4e6f 6e65 2c20 7369 7465 3d4e 6f6e 652c  None, site=None,
-0004aab0: 6c6f 6e67 6e61 6d65 3d4e 6f6e 652c 6465  longname=None,de
-0004aac0: 7363 7269 7074 696f 6e3d 4e6f 6e65 2c70  scription=None,p
-0004aad0: 6879 7369 643d 4e6f 6e65 293a 0d0a 2020  hysid=None):..  
-0004aae0: 2020 2020 2020 7365 6c66 2e73 6974 6520        self.site 
-0004aaf0: 2020 2020 2020 2020 3d20 7369 7465 0d0a          = site..
-0004ab00: 2020 2020 2020 2020 7365 6c66 2e70 6879          self.phy
-0004ab10: 7369 6420 2020 2020 2020 3d20 7068 7973  sid       = phys
-0004ab20: 6964 0d0a 0d0a 2020 2020 2020 2020 7365  id....        se
-0004ab30: 6c66 2e73 686f 7274 6e61 6d65 2020 2020  lf.shortname    
-0004ab40: 3d20 7368 6f72 746e 616d 650d 0a20 2020  = shortname..   
-0004ab50: 2020 2020 2073 656c 662e 6c6f 6e67 6e61       self.longna
-0004ab60: 6d65 2020 2020 203d 206c 6f6e 676e 616d  me     = longnam
-0004ab70: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0004ab80: 6465 7363 7269 7074 696f 6e20 203d 2064  description  = d
-0004ab90: 6573 6372 6970 7469 6f6e 0d0a 0d0a 2020  escription....  
-0004aba0: 2020 2020 2020 7365 6c66 2e73 7472 7563        self.struc
-0004abb0: 7475 7265 7320 3d20 7b7d 0d0a 0d0a 2020  tures = {}....  
-0004abc0: 2020 2020 2020 2353 696e 6365 2077 6520        #Since we 
-0004abd0: 6172 6520 676f 696e 6720 746f 2068 6176  are going to hav
-0004abe0: 6520 746f 2064 6566 696e 6520 6120 6865  e to define a he
-0004abf0: 6c70 6572 2066 756e 6374 696f 6e20 616e  lper function an
-0004ac00: 7977 6179 2c20 6d61 7920 6173 2077 656c  yway, may as wel
-0004ac10: 6c20 6465 6669 6e65 2069 7420 7477 6f20  l define it two 
-0004ac20: 6469 6666 6572 656e 7420 7761 7973 202d  different ways -
-0004ac30: 206f 6e65 2066 6f72 2069 6620 7468 6572   one for if ther
-0004ac40: 6520 6973 2061 2073 6974 652c 2061 2064  e is a site, a d
-0004ac50: 6966 6665 7265 6e74 206f 6e65 206f 7468  ifferent one oth
-0004ac60: 6572 7769 7365 0d0a 0d0a 2020 2020 2020  erwise....      
-0004ac70: 2020 7365 6c66 2e5f 7075 745f 7374 7275    self._put_stru
-0004ac80: 6374 7572 655f 6f72 5f73 7472 696e 6728  cture_or_string(
-0004ac90: 7374 7275 6374 7572 655f 3020 2c20 3020  structure_0 , 0 
-0004aca0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-0004acb0: 5f70 7574 5f73 7472 7563 7475 7265 5f6f  _put_structure_o
-0004acc0: 725f 7374 7269 6e67 2873 7472 7563 7475  r_string(structu
-0004acd0: 7265 5f31 202c 2031 2029 0d0a 2020 2020  re_1 , 1 )..    
-0004ace0: 2020 2020 7365 6c66 2e5f 7075 745f 7374      self._put_st
-0004acf0: 7275 6374 7572 655f 6f72 5f73 7472 696e  ructure_or_strin
-0004ad00: 6728 7374 7275 6374 7572 655f 3220 2c20  g(structure_2 , 
-0004ad10: 3220 290d 0a20 2020 2020 2020 2073 656c  2 )..        sel
-0004ad20: 662e 5f70 7574 5f73 7472 7563 7475 7265  f._put_structure
-0004ad30: 5f6f 725f 7374 7269 6e67 2873 7472 7563  _or_string(struc
-0004ad40: 7475 7265 5f33 202c 2033 2029 0d0a 2020  ture_3 , 3 )..  
-0004ad50: 2020 2020 2020 7365 6c66 2e5f 7075 745f        self._put_
-0004ad60: 7374 7275 6374 7572 655f 6f72 5f73 7472  structure_or_str
-0004ad70: 696e 6728 7374 7275 6374 7572 655f 3420  ing(structure_4 
-0004ad80: 2c20 3420 290d 0a20 2020 2020 2020 2073  , 4 )..        s
-0004ad90: 656c 662e 5f70 7574 5f73 7472 7563 7475  elf._put_structu
-0004ada0: 7265 5f6f 725f 7374 7269 6e67 2873 7472  re_or_string(str
-0004adb0: 7563 7475 7265 5f35 202c 2035 2029 0d0a  ucture_5 , 5 )..
-0004adc0: 2020 2020 2020 2020 7365 6c66 2e5f 7075          self._pu
-0004add0: 745f 7374 7275 6374 7572 655f 6f72 5f73  t_structure_or_s
-0004ade0: 7472 696e 6728 7374 7275 6374 7572 655f  tring(structure_
-0004adf0: 3620 2c20 3620 290d 0a20 2020 2020 2020  6 , 6 )..       
-0004ae00: 2073 656c 662e 5f70 7574 5f73 7472 7563   self._put_struc
-0004ae10: 7475 7265 5f6f 725f 7374 7269 6e67 2873  ture_or_string(s
-0004ae20: 7472 7563 7475 7265 5f37 202c 2037 2029  tructure_7 , 7 )
-0004ae30: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0004ae40: 7075 745f 7374 7275 6374 7572 655f 6f72  put_structure_or
-0004ae50: 5f73 7472 696e 6728 7374 7275 6374 7572  _string(structur
-0004ae60: 655f 3820 2c20 3820 290d 0a20 2020 2020  e_8 , 8 )..     
-0004ae70: 2020 2073 656c 662e 5f70 7574 5f73 7472     self._put_str
-0004ae80: 7563 7475 7265 5f6f 725f 7374 7269 6e67  ucture_or_string
-0004ae90: 2873 7472 7563 7475 7265 5f39 202c 2039  (structure_9 , 9
-0004aea0: 2029 0d0a 2020 2020 2020 2020 7365 6c66   )..        self
-0004aeb0: 2e5f 7075 745f 7374 7275 6374 7572 655f  ._put_structure_
-0004aec0: 6f72 5f73 7472 696e 6728 7374 7275 6374  or_string(struct
-0004aed0: 7572 655f 3130 2c20 3130 290d 0a20 2020  ure_10, 10)..   
-0004aee0: 2020 2020 2073 656c 662e 5f70 7574 5f73       self._put_s
-0004aef0: 7472 7563 7475 7265 5f6f 725f 7374 7269  tructure_or_stri
-0004af00: 6e67 2873 7472 7563 7475 7265 5f31 312c  ng(structure_11,
-0004af10: 2031 3129 0d0a 2020 2020 2020 2020 7365   11)..        se
-0004af20: 6c66 2e5f 7075 745f 7374 7275 6374 7572  lf._put_structur
-0004af30: 655f 6f72 5f73 7472 696e 6728 7374 7275  e_or_string(stru
-0004af40: 6374 7572 655f 3132 2c20 3132 290d 0a0d  cture_12, 12)...
-0004af50: 0a0d 0a20 2020 2064 6566 205f 7075 745f  ...    def _put_
-0004af60: 7374 7275 6374 7572 655f 6f72 5f73 7472  structure_or_str
-0004af70: 696e 6728 7365 6c66 2c20 7372 632c 6469  ing(self, src,di
-0004af80: 6d65 6e73 696f 6e5f 6e75 6d62 6572 293a  mension_number):
-0004af90: 0d0a 2020 2020 2020 2020 2374 6865 2069  ..        #the i
-0004afa0: 6e70 7574 6564 2073 7472 7563 7475 7265  nputed structure
-0004afb0: 7320 636f 756c 6420 6265 2061 2073 686f  s could be a sho
-0004afc0: 7274 6e61 6d65 206f 7220 616e 2061 6374  rtname or an act
-0004afd0: 7561 6c20 5374 7275 6374 7572 6528 2920  ual Structure() 
-0004afe0: 6f62 6a65 6374 0d0a 2020 2020 2020 2020  object..        
-0004aff0: 2365 6974 6865 7220 6372 6561 7465 2061  #either create a
-0004b000: 2073 7472 7563 7475 7265 2077 6974 6820   structure with 
-0004b010: 7468 6520 7368 6f72 746e 616d 6520 6f72  the shortname or
-0004b020: 2075 7365 2074 6865 2053 7472 7563 7475   use the Structu
-0004b030: 7265 2829 0d0a 2020 2020 2020 2020 0d0a  re()..        ..
-0004b040: 2020 2020 2020 2020 6c6f 672e 6465 6275          log.debu
-0004b050: 6728 2750 7574 7469 6e67 207b 7d20 696e  g('Putting {} in
-0004b060: 746f 2053 7472 7563 7475 7265 2066 6f72  to Structure for
-0004b070: 2064 696d 656e 7369 6f6e 207b 7d20 7769   dimension {} wi
-0004b080: 7468 2073 6974 6520 7b7d 272e 666f 726d  th site {}'.form
-0004b090: 6174 2872 6570 7228 7372 6329 2c64 696d  at(repr(src),dim
-0004b0a0: 656e 7369 6f6e 5f6e 756d 6265 722c 7365  ension_number,se
-0004b0b0: 6c66 2e73 6974 6529 290d 0a0d 0a0d 0a20  lf.site))...... 
-0004b0c0: 2020 2020 2020 2023 7468 6520 696e 7075         #the inpu
-0004b0d0: 7465 6420 7374 7275 6374 7572 6573 2063  ted structures c
-0004b0e0: 6f75 6c64 2062 6520 6120 7368 6f72 746e  ould be a shortn
-0004b0f0: 616d 6520 6f72 2061 6e20 6163 7475 616c  ame or an actual
-0004b100: 2053 7472 7563 7475 7265 2829 206f 626a   Structure() obj
-0004b110: 6563 740d 0a20 2020 2020 2020 2023 6569  ect..        #ei
-0004b120: 7468 6572 2063 7265 6174 6520 6120 7374  ther create a st
-0004b130: 7275 6374 7572 6520 7769 7468 2074 6865  ructure with the
-0004b140: 2073 686f 7274 6e61 6d65 206f 7220 7573   shortname or us
-0004b150: 6520 7468 6520 5374 7275 6374 7572 6528  e the Structure(
-0004b160: 290d 0a20 2020 2020 2020 206c 6f67 2e64  )..        log.d
-0004b170: 6562 7567 2827 5075 7474 696e 6720 7b7d  ebug('Putting {}
-0004b180: 2069 6e74 6f20 5374 7275 6374 7572 6520   into Structure 
-0004b190: 666f 7220 6469 6d65 6e73 696f 6e20 7b7d  for dimension {}
-0004b1a0: 2077 6974 6820 7369 7465 207b 7d20 272e   with site {} '.
-0004b1b0: 666f 726d 6174 2872 6570 7228 7372 6329  format(repr(src)
-0004b1c0: 2c64 696d 656e 7369 6f6e 5f6e 756d 6265  ,dimension_numbe
-0004b1d0: 722c 2073 656c 662e 7369 7465 2929 0d0a  r, self.site))..
-0004b1e0: 0d0a 2020 2020 2020 2020 6966 2073 7263  ..        if src
-0004b1f0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-0004b200: 2020 2020 2020 2073 656c 662e 7374 7275         self.stru
-0004b210: 6374 7572 6573 5b64 696d 656e 7369 6f6e  ctures[dimension
-0004b220: 5f6e 756d 6265 725d 203d 204e 6f6e 650d  _number] = None.
-0004b230: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0004b240: 7572 6e0d 0a0d 0a20 2020 2020 2020 2069  urn....        i
-0004b250: 6620 6973 696e 7374 616e 6365 2873 7263  f isinstance(src
-0004b260: 2c73 7472 293a 0d0a 2020 2020 2020 2020  ,str):..        
-0004b270: 2020 2020 6966 2073 656c 662e 7369 7465      if self.site
-0004b280: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-0004b290: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0004b2a0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-0004b2b0: 2020 2020 2020 2020 2073 656c 662e 7369           self.si
-0004b2c0: 7465 2e64 696d 656e 7369 6f6e 735b 6469  te.dimensions[di
-0004b2d0: 6d65 6e73 696f 6e5f 6e75 6d62 6572 5d2e  mension_number].
-0004b2e0: 7374 7275 6374 7572 6573 2e5f 7374 7275  structures._stru
-0004b2f0: 6374 7572 6573 5b73 7263 5d0d 0a20 2020  ctures[src]..   
-0004b300: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0004b310: 6570 7420 4b65 7945 7272 6f72 3a0d 0a20  ept KeyError:.. 
-0004b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b330: 2020 2023 204a 4154 2032 3032 3130 3730     # JAT 2021070
-0004b340: 3920 2d20 4927 6d20 6e6f 7420 7375 7265  9 - I'm not sure
-0004b350: 2074 6869 7320 6973 2073 6f20 676f 6f64   this is so good
-0004b360: 2068 6176 696e 6720 6c6f 6f6b 6564 2061   having looked a
-0004b370: 7420 6974 2061 2073 6563 6f6e 6420 7469  t it a second ti
-0004b380: 6d65 202d 2077 6520 636f 756c 6420 656e  me - we could en
-0004b390: 6420 7570 2061 6363 6964 656e 7461 6c6c  d up accidentall
-0004b3a0: 7920 6372 6561 7469 6e67 2073 7472 7563  y creating struc
-0004b3b0: 7472 7565 730d 0a20 2020 2020 2020 2020  trues..         
-0004b3c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0004b3d0: 7369 7465 2e64 696d 656e 7369 6f6e 735b  site.dimensions[
-0004b3e0: 6469 6d65 6e73 696f 6e5f 6e75 6d62 6572  dimension_number
-0004b3f0: 5d2e 7374 7275 6374 7572 6573 2e5f 7374  ].structures._st
-0004b400: 7275 6374 7572 6573 5b73 7263 5d20 3d20  ructures[src] = 
-0004b410: 5374 7275 6374 7572 6528 7368 6f72 746e  Structure(shortn
-0004b420: 616d 6520 3d20 7372 632c 6469 6d65 6e73  ame = src,dimens
-0004b430: 696f 6e20 3d20 7365 6c66 2e73 6974 652e  ion = self.site.
-0004b440: 6469 6d65 6e73 696f 6e73 5b64 696d 656e  dimensions[dimen
-0004b450: 7369 6f6e 5f6e 756d 6265 725d 290d 0a0d  sion_number])...
-0004b460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004b470: 2073 656c 662e 7374 7275 6374 7572 6573   self.structures
-0004b480: 5b64 696d 656e 7369 6f6e 5f6e 756d 6265  [dimension_numbe
-0004b490: 725d 203d 2073 656c 662e 7369 7465 2e64  r] = self.site.d
-0004b4a0: 696d 656e 7369 6f6e 735b 6469 6d65 6e73  imensions[dimens
-0004b4b0: 696f 6e5f 6e75 6d62 6572 5d2e 7374 7275  ion_number].stru
-0004b4c0: 6374 7572 6573 2e5f 7374 7275 6374 7572  ctures._structur
-0004b4d0: 6573 5b73 7263 5d20 2020 2020 2020 2020  es[src]         
-0004b4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004b4f0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-0004b500: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-0004b510: 2020 2020 2073 656c 662e 7374 7275 6374       self.struct
-0004b520: 7572 6573 5b64 696d 656e 7369 6f6e 5f6e  ures[dimension_n
-0004b530: 756d 6265 725d 2020 3d20 5374 7275 6374  umber]  = Struct
-0004b540: 7572 6528 7368 6f72 746e 616d 6520 3d20  ure(shortname = 
-0004b550: 7372 632c 6469 6d65 6e73 696f 6e5f 696e  src,dimension_in
-0004b560: 6465 7820 3d20 6469 6d65 6e73 696f 6e5f  dex = dimension_
-0004b570: 6e75 6d62 6572 290d 0a20 2020 2020 2020  number)..       
-0004b580: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-0004b590: 2873 7263 2c53 7472 7563 7475 7265 293a  (src,Structure):
-0004b5a0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0004b5b0: 6c66 2e73 7472 7563 7475 7265 735b 6469  lf.structures[di
-0004b5c0: 6d65 6e73 696f 6e5f 6e75 6d62 6572 5d20  mension_number] 
-0004b5d0: 203d 2073 7263 0d0a 2020 2020 2020 2020   = src..        
-0004b5e0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-0004b5f0: 7372 632c 5374 7275 6374 7572 6545 6c65  src,StructureEle
-0004b600: 6d65 6e74 293a 0d0a 2020 2020 2020 2020  ment):..        
-0004b610: 2020 2020 7365 6c66 2e73 7472 7563 7475      self.structu
-0004b620: 7265 735b 6469 6d65 6e73 696f 6e5f 6e75  res[dimension_nu
-0004b630: 6d62 6572 5d20 203d 2073 7263 0d0a 2020  mber]  = src..  
-0004b640: 2020 2020 2020 656c 6966 2069 7369 6e73        elif isins
-0004b650: 7461 6e63 6528 7372 632c 456c 656d 656e  tance(src,Elemen
-0004b660: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
-0004b670: 2073 656c 662e 7374 7275 6374 7572 6573   self.structures
-0004b680: 5b64 696d 656e 7369 6f6e 5f6e 756d 6265  [dimension_numbe
-0004b690: 725d 2020 3d20 5374 7275 6374 7572 6545  r]  = StructureE
-0004b6a0: 6c65 6d65 6e74 2865 6c65 6d65 6e74 3d73  lement(element=s
-0004b6b0: 7263 290d 0a20 2020 2020 2020 2065 6c73  rc)..        els
-0004b6c0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0004b6d0: 2320 6475 636b 7479 7065 2069 7420 2d20  # ducktype it - 
-0004b6e0: 6966 2069 7420 7175 6163 6b73 206c 696b  if it quacks lik
-0004b6f0: 6520 6120 5374 7275 6374 7572 6520 7765  e a Structure we
-0004b700: 276c 6c20 6265 204f 4b0d 0a20 2020 2020  'll be OK..     
-0004b710: 2020 2020 2020 2073 656c 662e 7374 7275         self.stru
-0004b720: 6374 7572 6573 5b64 696d 656e 7369 6f6e  ctures[dimension
-0004b730: 5f6e 756d 6265 725d 2020 3d20 7372 630d  _number]  = src.
-0004b740: 0a0d 0a20 2020 2020 2020 2023 2054 7279  ...        # Try
-0004b750: 2074 6f20 7365 7420 6f75 7220 7369 7465   to set our site
-0004b760: 2075 7369 6e67 2074 6865 2069 6e74 6572   using the inter
-0004b770: 6e61 6c20 7369 7465 206f 6620 7468 6520  nal site of the 
-0004b780: 7374 7275 6374 7572 650d 0a20 2020 2020  structure..     
-0004b790: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-0004b7a0: 2020 2020 2073 656c 662e 7369 7465 203d       self.site =
-0004b7b0: 2073 7263 2e64 696d 656e 7369 6f6e 2e73   src.dimension.s
-0004b7c0: 6974 650d 0a20 2020 2020 2020 2065 7863  ite..        exc
-0004b7d0: 6570 7420 4174 7472 6962 7574 6545 7272  ept AttributeErr
-0004b7e0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-0004b7f0: 2070 6173 7320 2020 2020 2020 2020 2020   pass           
-0004b800: 2020 2020 0d0a 0d0a 2020 2020 2020 2020      ....        
-0004b810: 6c6f 672e 6465 6275 6728 2753 6574 2074  log.debug('Set t
-0004b820: 6172 6765 7420 7b7d 2066 6f72 207b 7d20  arget {} for {} 
-0004b830: 7769 7468 206e 6f20 7369 7465 272e 666f  with no site'.fo
-0004b840: 726d 6174 2872 6570 7228 7365 6c66 2e73  rmat(repr(self.s
-0004b850: 7472 7563 7475 7265 735b 6469 6d65 6e73  tructures[dimens
-0004b860: 696f 6e5f 6e75 6d62 6572 5d29 2c72 6570  ion_number]),rep
-0004b870: 7228 7365 6c66 2929 290d 0a20 2020 2020  r(self)))..     
-0004b880: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-0004b890: 2064 6566 206c 6f61 6428 7365 6c66 2c20   def load(self, 
-0004b8a0: 7372 632c 206d 6170 7069 6e67 7320 3d20  src, mappings = 
-0004b8b0: 7b7d 2c73 6166 655f 6c6f 6164 3d54 7275  {},safe_load=Tru
-0004b8c0: 652c 6964 656e 7469 6669 6572 5f63 6f6c  e,identifier_col
-0004b8d0: 756d 6e73 3d4e 6f6e 652c 6967 6e6f 7265  umns=None,ignore
-0004b8e0: 5f7a 6572 6f5f 7661 6c75 6573 3d54 7275  _zero_values=Tru
-0004b8f0: 652c 636c 6561 725f 666f 6375 735f 6265  e,clear_focus_be
-0004b900: 666f 7265 5f6c 6f61 6469 6e67 3d54 7275  fore_loading=Tru
-0004b910: 6529 3a0d 0a20 2020 2020 2020 2069 6620  e):..        if 
-0004b920: 6964 656e 7469 6669 6572 5f63 6f6c 756d  identifier_colum
-0004b930: 6e73 2069 7320 4e6f 6e65 3a0d 0a20 2020  ns is None:..   
-0004b940: 2020 2020 2020 2020 2069 6465 6e74 6966           identif
-0004b950: 6965 725f 636f 6c75 6d6e 733d 5b5d 0d0a  ier_columns=[]..
-0004b960: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-0004b970: 2020 2020 2020 666f 6375 7320 3d20 466f        focus = Fo
-0004b980: 6375 7328 7365 6c66 290d 0a20 2020 2020  cus(self)..     
-0004b990: 2020 2066 6f63 7573 2e6c 6f61 6428 7372     focus.load(sr
-0004b9a0: 633d 7372 630d 0a20 2020 2020 2020 2020  c=src..         
-0004b9b0: 2020 2020 2020 2020 202c 6d61 7070 696e           ,mappin
-0004b9c0: 6773 3d6d 6170 7069 6e67 730d 0a20 2020  gs=mappings..   
-0004b9d0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-0004b9e0: 7361 6665 5f6c 6f61 643d 7361 6665 5f6c  safe_load=safe_l
-0004b9f0: 6f61 640d 0a20 2020 2020 2020 2020 2020  oad..           
-0004ba00: 2020 2020 2020 202c 6964 656e 7469 6669         ,identifi
-0004ba10: 6572 5f63 6f6c 756d 6e73 3d69 6465 6e74  er_columns=ident
-0004ba20: 6966 6965 725f 636f 6c75 6d6e 730d 0a20  ifier_columns.. 
-0004ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ba40: 202c 6967 6e6f 7265 5f7a 6572 6f5f 7661   ,ignore_zero_va
-0004ba50: 6c75 6573 3d69 676e 6f72 655f 7a65 726f  lues=ignore_zero
-0004ba60: 5f76 616c 7565 730d 0a20 2020 2020 2020  _values..       
-0004ba70: 2020 2020 2020 2020 2020 202c 636c 6561             ,clea
-0004ba80: 725f 666f 6375 735f 6265 666f 7265 5f6c  r_focus_before_l
-0004ba90: 6f61 6469 6e67 3d63 6c65 6172 5f66 6f63  oading=clear_foc
-0004baa0: 7573 5f62 6566 6f72 655f 6c6f 6164 696e  us_before_loadin
-0004bab0: 670d 0a20 2020 2020 2020 2020 2020 2020  g..             
-0004bac0: 2020 2020 2029 0d0a 0d0a 2020 2020 6465       )....    de
-0004bad0: 6620 5f5f 6c65 6e5f 5f28 7365 6c66 293a  f __len__(self):
-0004bae0: 0d0a 0d0a 2020 2020 2020 2020 7265 7375  ....        resu
-0004baf0: 6c74 203d 2031 0d0a 2020 2020 2020 2020  lt = 1..        
-0004bb00: 666f 7220 7374 7275 6374 7572 6520 696e  for structure in
-0004bb10: 2073 656c 662e 7374 7275 6374 7572 6573   self.structures
-0004bb20: 2e76 616c 7565 7328 293a 0d0a 2020 2020  .values():..    
-0004bb30: 2020 2020 2020 2020 6966 2073 7472 7563          if struc
-0004bb40: 7475 7265 2069 7320 6e6f 7420 4e6f 6e65  ture is not None
-0004bb50: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004bb60: 2020 2072 6573 756c 7420 2a3d 206c 656e     result *= len
-0004bb70: 2873 7472 7563 7475 7265 290d 0a0d 0a20  (structure).... 
-0004bb80: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-0004bb90: 7375 6c74 0d0a 0d0a 636c 6173 7320 466f  sult....class Fo
-0004bba0: 6375 7328 6f62 6a65 6374 293a 0d0a 0d0a  cus(object):....
-0004bbb0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-0004bbc0: 2873 656c 662c 2073 7263 293a 0d0a 2020  (self, src):..  
-0004bbd0: 2020 2020 2020 7365 6c66 2e5f 7669 6577        self._view
-0004bbe0: 706f 696e 7420 3d20 4e6f 6e65 0d0a 2020  point = None..  
-0004bbf0: 2020 2020 2020 7365 6c66 2e5f 7374 7275        self._stru
-0004bc00: 6374 7572 6573 203d 205f 466f 6375 7353  ctures = _FocusS
-0004bc10: 7472 7563 7475 7265 7347 6574 7465 7228  tructuresGetter(
-0004bc20: 666f 6375 7320 3d20 7365 6c66 290d 0a20  focus = self).. 
-0004bc30: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-0004bc40: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0004bc50: 6365 2873 7263 2c56 6965 7770 6f69 6e74  ce(src,Viewpoint
-0004bc60: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0004bc70: 7365 6c66 2e5f 7669 6577 706f 696e 7420  self._viewpoint 
-0004bc80: 3d20 7372 630d 0a20 2020 2020 2020 2020  = src..         
-0004bc90: 2020 2023 436f 7079 2069 6e20 7468 6520     #Copy in the 
-0004bca0: 7669 6577 706f 696e 7420 7374 7275 6374  viewpoint struct
-0004bcb0: 7572 6573 2069 6e74 6f20 7468 6520 666f  ures into the fo
-0004bcc0: 6375 730d 0a20 2020 2020 2020 2020 2020  cus..           
-0004bcd0: 2066 6f72 206b 2c76 2069 6e20 7365 6c66   for k,v in self
-0004bce0: 2e5f 7669 6577 706f 696e 742e 7374 7275  ._viewpoint.stru
-0004bcf0: 6374 7572 6573 2e69 7465 6d73 2829 3a0d  ctures.items():.
-0004bd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004bd10: 2073 656c 662e 5f73 7472 7563 7475 7265   self._structure
-0004bd20: 735b 6b5d 203d 2076 0d0a 2020 2020 2020  s[k] = v..      
-0004bd30: 2020 2020 2020 2020 2020 0d0a 2020 2020            ..    
-0004bd40: 6465 6620 6c6f 6164 2873 656c 662c 2073  def load(self, s
-0004bd50: 7263 2c20 6d61 7070 696e 6773 203d 204e  rc, mappings = N
-0004bd60: 6f6e 652c 7361 6665 5f6c 6f61 643d 5472  one,safe_load=Tr
-0004bd70: 7565 2c69 6465 6e74 6966 6965 725f 636f  ue,identifier_co
-0004bd80: 6c75 6d6e 733d 4e6f 6e65 2c69 676e 6f72  lumns=None,ignor
-0004bd90: 655f 7a65 726f 5f76 616c 7565 733d 5472  e_zero_values=Tr
-0004bda0: 7565 2c63 6c65 6172 5f66 6f63 7573 5f62  ue,clear_focus_b
-0004bdb0: 6566 6f72 655f 6c6f 6164 696e 673d 5472  efore_loading=Tr
-0004bdc0: 7565 293a 0d0a 2020 2020 2020 2020 6966  ue):..        if
-0004bdd0: 206d 6170 7069 6e67 7320 6973 204e 6f6e   mappings is Non
-0004bde0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0004bdf0: 6d61 7070 696e 6773 203d 207b 7d0d 0a0d  mappings = {}...
-0004be00: 0a20 2020 2020 2020 2069 6620 6964 656e  .        if iden
-0004be10: 7469 6669 6572 5f63 6f6c 756d 6e73 2069  tifier_columns i
-0004be20: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
-0004be30: 2020 2020 2069 6465 6e74 6966 6965 725f       identifier_
-0004be40: 636f 6c75 6d6e 733d 5b5d 0d0a 2020 2020  columns=[]..    
-0004be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004be60: 2020 2020 0d0a 2020 2020 2020 2020 666c      ..        fl
-0004be70: 203d 2046 6f63 7573 4c6f 6164 6572 2873   = FocusLoader(s
-0004be80: 6f75 7263 653d 7372 630d 0a20 2020 2020  ource=src..     
-0004be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bea0: 2020 202c 7461 7267 6574 3d73 656c 660d     ,target=self.
-0004beb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004bec0: 2020 2020 2020 2020 202c 6d61 7070 696e           ,mappin
-0004bed0: 6773 3d6d 6170 7069 6e67 730d 0a20 2020  gs=mappings..   
+00049f30: 696e 6e65 725f 6572 726f 7220 3d20 5472  inner_error = Tr
+00049f40: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+00049f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00049f60: 7261 6973 6520 4174 7472 6962 7574 6545  raise AttributeE
+00049f70: 7272 6f72 2827 4361 6e6e 6f74 2061 6464  rror('Cannot add
+00049f80: 207b 7d20 6f66 2074 7970 6520 7b7d 2074   {} of type {} t
+00049f90: 6f20 7b7d 2066 726f 6d20 6974 6572 6162  o {} from iterab
+00049fa0: 6c65 207b 7d2e 2043 616e 206f 6e6c 7920  le {}. Can only 
+00049fb0: 6164 6420 7368 6f72 7463 6f64 6520 7374  add shortcode st
+00049fc0: 7269 6e67 7320 746f 2061 6e20 656d 7074  rings to an empt
+00049fd0: 7920 7b7d 272e 666f 726d 6174 2872 6570  y {}'.format(rep
+00049fe0: 7228 7375 6269 7465 6d29 2c74 7970 6528  r(subitem),type(
+00049ff0: 7375 6269 7465 6d29 2c61 7474 7269 6275  subitem),attribu
+0004a000: 7465 5f6e 616d 652c 7374 7228 6974 656d  te_name,str(item
+0004a010: 292c 6174 7472 6962 7574 655f 6e61 6d65  ),attribute_name
+0004a020: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
+0004a030: 2020 2020 2354 7970 6520 6572 726f 7220      #Type error 
+0004a040: 7261 6973 6564 2069 6620 7472 7969 6e67  raised if trying
+0004a050: 2074 6f20 6974 6572 6174 6520 6f76 6572   to iterate over
+0004a060: 2061 206e 6f6e 2d69 7465 7261 626c 650d   a non-iterable.
+0004a070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004a080: 2065 7863 6570 7420 5479 7065 4572 726f   except TypeErro
+0004a090: 7220 6173 2074 653a 0d0a 2020 2020 2020  r as te:..      
+0004a0a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0004a0b0: 2069 6e6e 6572 5f65 7272 6f72 3a0d 0a20   inner_error:.. 
+0004a0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a0d0: 2020 2020 2020 2072 6169 7365 2074 650d         raise te.
+0004a0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004a0f0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0004a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004a110: 2020 2020 7261 6973 6520 4174 7472 6962      raise Attrib
+0004a120: 7574 6545 7272 6f72 2827 4361 6e6e 6f74  uteError('Cannot
+0004a130: 2061 6464 207b 7d20 6f66 2074 7970 6520   add {} of type 
+0004a140: 7b7d 2074 6f20 7b7d 2e20 4361 6e20 6f6e  {} to {}. Can on
+0004a150: 6c79 2061 6464 2073 686f 7274 636f 6465  ly add shortcode
+0004a160: 2073 7472 696e 6773 2074 6f20 616e 2065   strings to an e
+0004a170: 6d70 7479 207b 7d27 2e66 6f72 6d61 7428  mpty {}'.format(
+0004a180: 7265 7072 2869 7465 6d29 2c74 7970 6528  repr(item),type(
+0004a190: 6974 656d 292c 6174 7472 6962 7574 655f  item),attribute_
+0004a1a0: 6e61 6d65 2c61 7474 7269 6275 7465 5f6e  name,attribute_n
+0004a1b0: 616d 6529 290d 0a0d 0a20 2020 2020 2020  ame))....       
+0004a1c0: 2072 6574 7572 6e20 6174 7472 6962 7574   return attribut
+0004a1d0: 650d 0a0d 0a20 2020 2040 7669 6577 6572  e....    @viewer
+0004a1e0: 732e 7365 7474 6572 0d0a 2020 2020 6465  s.setter..    de
+0004a1f0: 6620 7669 6577 6572 7328 7365 6c66 2c69  f viewers(self,i
+0004a200: 7465 6d29 3a0d 0a20 2020 2020 2020 2072  tem):..        r
+0004a210: 6574 7572 6e20 7365 6c66 2e5f 6765 6e65  eturn self._gene
+0004a220: 7269 635f 7365 7474 6572 2873 656c 662e  ric_setter(self.
+0004a230: 5f76 6965 7765 7273 2c20 6974 656d 2c20  _viewers, item, 
+0004a240: 6174 7472 6962 7574 655f 6e61 6d65 3d27  attribute_name='
+0004a250: 7669 6577 6572 7327 290d 0a0d 0a20 2020  viewers')....   
+0004a260: 2040 6461 7461 5f76 6965 7765 7273 2e73   @data_viewers.s
+0004a270: 6574 7465 720d 0a20 2020 2064 6566 2064  etter..    def d
+0004a280: 6174 615f 7669 6577 6572 7328 7365 6c66  ata_viewers(self
+0004a290: 2c69 7465 6d29 3a0d 0a20 2020 2020 2020  ,item):..       
+0004a2a0: 2072 6574 7572 6e20 7365 6c66 2e5f 6765   return self._ge
+0004a2b0: 6e65 7269 635f 7365 7474 6572 2873 656c  neric_setter(sel
+0004a2c0: 662e 5f64 6174 615f 7669 6577 6572 732c  f._data_viewers,
+0004a2d0: 2069 7465 6d2c 2061 7474 7269 6275 7465   item, attribute
+0004a2e0: 5f6e 616d 653d 2764 6174 615f 7669 6577  _name='data_view
+0004a2f0: 6572 7327 290d 0a0d 0a20 2020 2040 6d6f  ers')....    @mo
+0004a300: 6469 6669 6572 732e 7365 7474 6572 0d0a  difiers.setter..
+0004a310: 2020 2020 6465 6620 6d6f 6469 6669 6572      def modifier
+0004a320: 7328 7365 6c66 2c69 7465 6d29 3a0d 0a20  s(self,item):.. 
+0004a330: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0004a340: 6c66 2e5f 6765 6e65 7269 635f 7365 7474  lf._generic_sett
+0004a350: 6572 2873 656c 662e 5f6d 6f64 6966 6965  er(self._modifie
+0004a360: 7273 2c20 6974 656d 2c20 6174 7472 6962  rs, item, attrib
+0004a370: 7574 655f 6e61 6d65 3d27 6d6f 6469 6669  ute_name='modifi
+0004a380: 6572 7327 290d 0a0d 0a20 2020 2040 7072  ers')....    @pr
+0004a390: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+0004a3a0: 6564 6974 6564 2873 656c 6629 3a0d 0a20  edited(self):.. 
+0004a3b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0004a3c0: 6c66 2e76 6965 7765 7273 2e65 6469 7465  lf.viewers.edite
+0004a3d0: 6420 6f72 2073 656c 662e 6461 7461 5f76  d or self.data_v
+0004a3e0: 6965 7765 7273 2e65 6469 7465 6420 6f72  iewers.edited or
+0004a3f0: 2073 656c 662e 6d6f 6469 6669 6572 732e   self.modifiers.
+0004a400: 6564 6974 6564 0d0a 0d0a 0d0a 636c 6173  edited......clas
+0004a410: 7320 4669 656c 6444 6566 696e 6974 696f  s FieldDefinitio
+0004a420: 6e28 6f62 6a65 6374 293a 0d0a 2020 2020  n(object):..    
+0004a430: 2727 2744 6566 696e 6974 696f 6e20 6f66  '''Definition of
+0004a440: 2061 2044 696d 656e 7369 6f6e 2046 6965   a Dimension Fie
+0004a450: 6c64 2e20 4265 6c6f 6e67 7320 746f 2061  ld. Belongs to a
+0004a460: 2044 696d 656e 7369 6f6e 2c20 6e6f 7420   Dimension, not 
+0004a470: 746f 2061 6e20 456c 656d 656e 7427 2727  to an Element'''
+0004a480: 0d0a 2020 2020 6465 6620 5f5f 696e 6974  ..    def __init
+0004a490: 5f5f 2873 656c 662c 206c 6f6e 676e 616d  __(self, longnam
+0004a4a0: 6520 2c20 7368 6f72 746e 616d 653d 4e6f  e , shortname=No
+0004a4b0: 6e65 2c64 6573 6372 6970 7469 6f6e 3d4e  ne,description=N
+0004a4c0: 6f6e 6529 3a0d 0a0d 0a20 2020 2020 2020  one):....       
+0004a4d0: 2069 6620 7368 6f72 746e 616d 6520 6973   if shortname is
+0004a4e0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
+0004a4f0: 2020 2020 2020 2020 7368 6f72 746e 616d          shortnam
+0004a500: 6520 3d20 7374 7228 7368 6f72 746e 616d  e = str(shortnam
+0004a510: 6529 0d0a 0d0a 2020 2020 2020 2020 2020  e)....          
+0004a520: 2020 6966 206c 656e 2873 686f 7274 6e61    if len(shortna
+0004a530: 6d65 2920 3d3d 2030 3a0d 0a20 2020 2020  me) == 0:..     
+0004a540: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0004a550: 2056 616c 7565 4572 726f 7228 2246 6965   ValueError("Fie
+0004a560: 6c64 4465 6669 6e69 7469 6f6e 2077 6173  ldDefinition was
+0004a570: 2063 7265 6174 6564 2077 6974 6820 6120   created with a 
+0004a580: 7368 6f72 746e 616d 6520 7769 7468 207a  shortname with z
+0004a590: 6572 6f20 6368 6172 6163 7465 7273 2e20  ero characters. 
+0004a5a0: 4578 706c 6963 6974 2073 686f 7274 6e61  Explicit shortna
+0004a5b0: 6d65 7320 696e 2061 2046 6965 6c64 4465  mes in a FieldDe
+0004a5c0: 6669 6e69 7469 6f6e 206d 7573 7420 6e6f  finition must no
+0004a5d0: 7420 6265 2061 6e20 656d 7074 7920 7374  t be an empty st
+0004a5e0: 7269 6e67 2229 0d0a 2020 2020 2020 2020  ring")..        
+0004a5f0: 2020 2020 6966 206c 656e 2873 686f 7274      if len(short
+0004a600: 6e61 6d65 2920 3e20 6c6c 752e 7368 6f72  name) > llu.shor
+0004a610: 746e 616d 655f 7369 7a65 3a0d 0a20 2020  tname_size:..   
+0004a620: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0004a630: 7365 2056 616c 7565 4572 726f 7228 2246  se ValueError("F
+0004a640: 6965 6c64 4465 6669 6e69 7469 6f6e 2077  ieldDefinition w
+0004a650: 6173 2063 7265 6174 6564 2077 6974 6820  as created with 
+0004a660: 6120 7368 6f72 746e 616d 6520 7769 7468  a shortname with
+0004a670: 2067 7265 6174 6572 2074 6861 6e20 7b30   greater than {0
+0004a680: 7d20 6368 6172 6163 7465 7273 2028 7b31  } characters ({1
+0004a690: 7d29 2e20 4578 706c 6963 6974 2073 686f  }). Explicit sho
+0004a6a0: 7274 6e61 6d65 7320 696e 2061 2046 6965  rtnames in a Fie
+0004a6b0: 6c64 4465 6669 6e69 7469 6f6e 206d 7573  ldDefinition mus
+0004a6c0: 7420 6265 206c 6573 7320 7468 616e 207b  t be less than {
+0004a6d0: 307d 2063 6861 7261 6374 6572 7320 6c6f  0} characters lo
+0004a6e0: 6e67 222e 666f 726d 6174 286c 6c75 2e73  ng".format(llu.s
+0004a6f0: 686f 7274 6e61 6d65 5f73 697a 652c 2073  hortname_size, s
+0004a700: 686f 7274 6e61 6d65 2929 0d0a 0d0a 2020  hortname))....  
+0004a710: 2020 2020 2020 2020 2020 666f 7220 6368            for ch
+0004a720: 6172 6163 7465 7220 696e 2022 272b 2d2a  aracter in "'+-*
+0004a730: 2f28 2940 2c7c 5e3d 5c72 5c6e 5c74 222b  /()@,|^=\r\n\t"+
+0004a740: 7227 2220 273a 0d0a 2020 2020 2020 2020  r'" ':..        
+0004a750: 2020 2020 2020 2020 6966 2063 6861 7261          if chara
+0004a760: 6374 6572 2069 6e20 7368 6f72 746e 616d  cter in shortnam
+0004a770: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0004a780: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0004a790: 6c75 6545 7272 6f72 2822 4669 656c 6444  lueError("FieldD
+0004a7a0: 6566 696e 6974 696f 6e20 7761 7320 6372  efinition was cr
+0004a7b0: 6561 7465 6420 7769 7468 2061 2073 686f  eated with a sho
+0004a7c0: 7274 6e61 6d65 2028 7b7d 2920 7768 6963  rtname ({}) whic
+0004a7d0: 6820 636f 6e74 6169 6e65 6420 6120 6261  h contained a ba
+0004a7e0: 6420 6368 6172 6163 7465 7220 287b 7d29  d character ({})
+0004a7f0: 2e20 4669 656c 6444 6566 696e 6974 696f  . FieldDefinitio
+0004a800: 6e20 7368 6f72 746e 616d 6573 2061 7265  n shortnames are
+0004a810: 2072 6573 7472 6963 7465 6420 746f 2073   restricted to s
+0004a820: 7461 6e64 6172 6420 6368 6172 6163 7465  tandard characte
+0004a830: 7273 222e 666f 726d 6174 2873 686f 7274  rs".format(short
+0004a840: 6e61 6d65 2c63 6861 7261 6374 6572 2929  name,character))
+0004a850: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0004a860: 2e73 686f 7274 6e61 6d65 2020 203d 2073  .shortname   = s
+0004a870: 686f 7274 6e61 6d65 0d0a 0d0a 2020 2020  hortname....    
+0004a880: 2020 2020 7365 6c66 2e6c 6f6e 676e 616d      self.longnam
+0004a890: 6520 2020 203d 206c 6f6e 676e 616d 650d  e    = longname.
+0004a8a0: 0a20 2020 2020 2020 2073 656c 662e 6465  .        self.de
+0004a8b0: 7363 7269 7074 696f 6e20 3d20 6465 7363  scription = desc
+0004a8c0: 7269 7074 696f 6e0d 0a0d 0a0d 0a63 6c61  ription......cla
+0004a8d0: 7373 2056 6965 7770 6f69 6e74 286f 626a  ss Viewpoint(obj
+0004a8e0: 6563 7429 3a0d 0a20 2020 2027 2727 416e  ect):..    '''An
+0004a8f0: 2045 6d70 6f77 6572 2056 6965 7770 6f69   Empower Viewpoi
+0004a900: 6e74 2e20 4120 7669 6577 706f 696e 7420  nt. A viewpoint 
+0004a910: 7370 6563 6966 6965 7320 6120 7375 6263  specifies a subc
+0004a920: 7562 6520 6f66 2074 6865 2065 6e74 6972  ube of the entir
+0004a930: 6520 456d 706f 7765 7220 6375 6265 2e20  e Empower cube. 
+0004a940: 5765 2072 6561 6420 616e 6420 6c6f 6164  We read and load
+0004a950: 2064 6174 6120 6672 6f6d 2056 6965 7770   data from Viewp
+0004a960: 6f69 6e74 732e 0d0a 2020 2020 5669 6577  oints...    View
+0004a970: 706f 696e 7473 2061 7265 2061 2063 6f6c  points are a col
+0004a980: 6c65 6374 696f 6e20 6f66 2073 7472 7563  lection of struc
+0004a990: 7475 7265 732c 2077 6974 6820 6f6e 6520  tures, with one 
+0004a9a0: 7374 7275 6374 7572 6520 7065 7220 6469  structure per di
+0004a9b0: 6d65 6e73 696f 6e2e 0d0a 2020 2020 2727  mension...    ''
+0004a9c0: 270d 0a20 2020 2064 6566 205f 5f69 6e69  '..    def __ini
+0004a9d0: 745f 5f28 7365 6c66 2c20 7368 6f72 746e  t__(self, shortn
+0004a9e0: 616d 652c 2073 7472 7563 7475 7265 5f30  ame, structure_0
+0004a9f0: 3d4e 6f6e 652c 2073 7472 7563 7475 7265  =None, structure
+0004aa00: 5f31 3d4e 6f6e 652c 2073 7472 7563 7475  _1=None, structu
+0004aa10: 7265 5f32 3d4e 6f6e 652c 2073 7472 7563  re_2=None, struc
+0004aa20: 7475 7265 5f33 3d4e 6f6e 652c 2073 7472  ture_3=None, str
+0004aa30: 7563 7475 7265 5f34 3d4e 6f6e 652c 2073  ucture_4=None, s
+0004aa40: 7472 7563 7475 7265 5f35 3d4e 6f6e 652c  tructure_5=None,
+0004aa50: 2073 7472 7563 7475 7265 5f36 3d4e 6f6e   structure_6=Non
+0004aa60: 652c 2073 7472 7563 7475 7265 5f37 3d4e  e, structure_7=N
+0004aa70: 6f6e 652c 2073 7472 7563 7475 7265 5f38  one, structure_8
+0004aa80: 3d4e 6f6e 652c 2073 7472 7563 7475 7265  =None, structure
+0004aa90: 5f39 3d4e 6f6e 652c 2073 7472 7563 7475  _9=None, structu
+0004aaa0: 7265 5f31 303d 4e6f 6e65 2c20 7374 7275  re_10=None, stru
+0004aab0: 6374 7572 655f 3131 3d4e 6f6e 652c 2073  cture_11=None, s
+0004aac0: 7472 7563 7475 7265 5f31 323d 4e6f 6e65  tructure_12=None
+0004aad0: 2c20 7369 7465 3d4e 6f6e 652c 6c6f 6e67  , site=None,long
+0004aae0: 6e61 6d65 3d4e 6f6e 652c 6465 7363 7269  name=None,descri
+0004aaf0: 7074 696f 6e3d 4e6f 6e65 2c70 6879 7369  ption=None,physi
+0004ab00: 643d 4e6f 6e65 293a 0d0a 2020 2020 2020  d=None):..      
+0004ab10: 2020 7365 6c66 2e73 6974 6520 2020 2020    self.site     
+0004ab20: 2020 2020 3d20 7369 7465 0d0a 2020 2020      = site..    
+0004ab30: 2020 2020 7365 6c66 2e70 6879 7369 6420      self.physid 
+0004ab40: 2020 2020 2020 3d20 7068 7973 6964 0d0a        = physid..
+0004ab50: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+0004ab60: 686f 7274 6e61 6d65 2020 2020 3d20 7368  hortname    = sh
+0004ab70: 6f72 746e 616d 650d 0a20 2020 2020 2020  ortname..       
+0004ab80: 2073 656c 662e 6c6f 6e67 6e61 6d65 2020   self.longname  
+0004ab90: 2020 203d 206c 6f6e 676e 616d 650d 0a20     = longname.. 
+0004aba0: 2020 2020 2020 2073 656c 662e 6465 7363         self.desc
+0004abb0: 7269 7074 696f 6e20 203d 2064 6573 6372  ription  = descr
+0004abc0: 6970 7469 6f6e 0d0a 0d0a 2020 2020 2020  iption....      
+0004abd0: 2020 7365 6c66 2e73 7472 7563 7475 7265    self.structure
+0004abe0: 7320 3d20 7b7d 0d0a 0d0a 2020 2020 2020  s = {}....      
+0004abf0: 2020 2353 696e 6365 2077 6520 6172 6520    #Since we are 
+0004ac00: 676f 696e 6720 746f 2068 6176 6520 746f  going to have to
+0004ac10: 2064 6566 696e 6520 6120 6865 6c70 6572   define a helper
+0004ac20: 2066 756e 6374 696f 6e20 616e 7977 6179   function anyway
+0004ac30: 2c20 6d61 7920 6173 2077 656c 6c20 6465  , may as well de
+0004ac40: 6669 6e65 2069 7420 7477 6f20 6469 6666  fine it two diff
+0004ac50: 6572 656e 7420 7761 7973 202d 206f 6e65  erent ways - one
+0004ac60: 2066 6f72 2069 6620 7468 6572 6520 6973   for if there is
+0004ac70: 2061 2073 6974 652c 2061 2064 6966 6665   a site, a diffe
+0004ac80: 7265 6e74 206f 6e65 206f 7468 6572 7769  rent one otherwi
+0004ac90: 7365 0d0a 0d0a 2020 2020 2020 2020 7365  se....        se
+0004aca0: 6c66 2e5f 7075 745f 7374 7275 6374 7572  lf._put_structur
+0004acb0: 655f 6f72 5f73 7472 696e 6728 7374 7275  e_or_string(stru
+0004acc0: 6374 7572 655f 3020 2c20 3020 290d 0a20  cture_0 , 0 ).. 
+0004acd0: 2020 2020 2020 2073 656c 662e 5f70 7574         self._put
+0004ace0: 5f73 7472 7563 7475 7265 5f6f 725f 7374  _structure_or_st
+0004acf0: 7269 6e67 2873 7472 7563 7475 7265 5f31  ring(structure_1
+0004ad00: 202c 2031 2029 0d0a 2020 2020 2020 2020   , 1 )..        
+0004ad10: 7365 6c66 2e5f 7075 745f 7374 7275 6374  self._put_struct
+0004ad20: 7572 655f 6f72 5f73 7472 696e 6728 7374  ure_or_string(st
+0004ad30: 7275 6374 7572 655f 3220 2c20 3220 290d  ructure_2 , 2 ).
+0004ad40: 0a20 2020 2020 2020 2073 656c 662e 5f70  .        self._p
+0004ad50: 7574 5f73 7472 7563 7475 7265 5f6f 725f  ut_structure_or_
+0004ad60: 7374 7269 6e67 2873 7472 7563 7475 7265  string(structure
+0004ad70: 5f33 202c 2033 2029 0d0a 2020 2020 2020  _3 , 3 )..      
+0004ad80: 2020 7365 6c66 2e5f 7075 745f 7374 7275    self._put_stru
+0004ad90: 6374 7572 655f 6f72 5f73 7472 696e 6728  cture_or_string(
+0004ada0: 7374 7275 6374 7572 655f 3420 2c20 3420  structure_4 , 4 
+0004adb0: 290d 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0004adc0: 5f70 7574 5f73 7472 7563 7475 7265 5f6f  _put_structure_o
+0004add0: 725f 7374 7269 6e67 2873 7472 7563 7475  r_string(structu
+0004ade0: 7265 5f35 202c 2035 2029 0d0a 2020 2020  re_5 , 5 )..    
+0004adf0: 2020 2020 7365 6c66 2e5f 7075 745f 7374      self._put_st
+0004ae00: 7275 6374 7572 655f 6f72 5f73 7472 696e  ructure_or_strin
+0004ae10: 6728 7374 7275 6374 7572 655f 3620 2c20  g(structure_6 , 
+0004ae20: 3620 290d 0a20 2020 2020 2020 2073 656c  6 )..        sel
+0004ae30: 662e 5f70 7574 5f73 7472 7563 7475 7265  f._put_structure
+0004ae40: 5f6f 725f 7374 7269 6e67 2873 7472 7563  _or_string(struc
+0004ae50: 7475 7265 5f37 202c 2037 2029 0d0a 2020  ture_7 , 7 )..  
+0004ae60: 2020 2020 2020 7365 6c66 2e5f 7075 745f        self._put_
+0004ae70: 7374 7275 6374 7572 655f 6f72 5f73 7472  structure_or_str
+0004ae80: 696e 6728 7374 7275 6374 7572 655f 3820  ing(structure_8 
+0004ae90: 2c20 3820 290d 0a20 2020 2020 2020 2073  , 8 )..        s
+0004aea0: 656c 662e 5f70 7574 5f73 7472 7563 7475  elf._put_structu
+0004aeb0: 7265 5f6f 725f 7374 7269 6e67 2873 7472  re_or_string(str
+0004aec0: 7563 7475 7265 5f39 202c 2039 2029 0d0a  ucture_9 , 9 )..
+0004aed0: 2020 2020 2020 2020 7365 6c66 2e5f 7075          self._pu
+0004aee0: 745f 7374 7275 6374 7572 655f 6f72 5f73  t_structure_or_s
+0004aef0: 7472 696e 6728 7374 7275 6374 7572 655f  tring(structure_
+0004af00: 3130 2c20 3130 290d 0a20 2020 2020 2020  10, 10)..       
+0004af10: 2073 656c 662e 5f70 7574 5f73 7472 7563   self._put_struc
+0004af20: 7475 7265 5f6f 725f 7374 7269 6e67 2873  ture_or_string(s
+0004af30: 7472 7563 7475 7265 5f31 312c 2031 3129  tructure_11, 11)
+0004af40: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+0004af50: 7075 745f 7374 7275 6374 7572 655f 6f72  put_structure_or
+0004af60: 5f73 7472 696e 6728 7374 7275 6374 7572  _string(structur
+0004af70: 655f 3132 2c20 3132 290d 0a0d 0a0d 0a20  e_12, 12)...... 
+0004af80: 2020 2064 6566 205f 7075 745f 7374 7275     def _put_stru
+0004af90: 6374 7572 655f 6f72 5f73 7472 696e 6728  cture_or_string(
+0004afa0: 7365 6c66 2c20 7372 632c 6469 6d65 6e73  self, src,dimens
+0004afb0: 696f 6e5f 6e75 6d62 6572 293a 0d0a 2020  ion_number):..  
+0004afc0: 2020 2020 2020 2374 6865 2069 6e70 7574        #the input
+0004afd0: 6564 2073 7472 7563 7475 7265 7320 636f  ed structures co
+0004afe0: 756c 6420 6265 2061 2073 686f 7274 6e61  uld be a shortna
+0004aff0: 6d65 206f 7220 616e 2061 6374 7561 6c20  me or an actual 
+0004b000: 5374 7275 6374 7572 6528 2920 6f62 6a65  Structure() obje
+0004b010: 6374 0d0a 2020 2020 2020 2020 2365 6974  ct..        #eit
+0004b020: 6865 7220 6372 6561 7465 2061 2073 7472  her create a str
+0004b030: 7563 7475 7265 2077 6974 6820 7468 6520  ucture with the 
+0004b040: 7368 6f72 746e 616d 6520 6f72 2075 7365  shortname or use
+0004b050: 2074 6865 2053 7472 7563 7475 7265 2829   the Structure()
+0004b060: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
+0004b070: 2020 2020 6c6f 672e 6465 6275 6728 2750      log.debug('P
+0004b080: 7574 7469 6e67 207b 7d20 696e 746f 2053  utting {} into S
+0004b090: 7472 7563 7475 7265 2066 6f72 2064 696d  tructure for dim
+0004b0a0: 656e 7369 6f6e 207b 7d20 7769 7468 2073  ension {} with s
+0004b0b0: 6974 6520 7b7d 272e 666f 726d 6174 2872  ite {}'.format(r
+0004b0c0: 6570 7228 7372 6329 2c64 696d 656e 7369  epr(src),dimensi
+0004b0d0: 6f6e 5f6e 756d 6265 722c 7365 6c66 2e73  on_number,self.s
+0004b0e0: 6974 6529 290d 0a0d 0a0d 0a20 2020 2020  ite))......     
+0004b0f0: 2020 2023 7468 6520 696e 7075 7465 6420     #the inputed 
+0004b100: 7374 7275 6374 7572 6573 2063 6f75 6c64  structures could
+0004b110: 2062 6520 6120 7368 6f72 746e 616d 6520   be a shortname 
+0004b120: 6f72 2061 6e20 6163 7475 616c 2053 7472  or an actual Str
+0004b130: 7563 7475 7265 2829 206f 626a 6563 740d  ucture() object.
+0004b140: 0a20 2020 2020 2020 2023 6569 7468 6572  .        #either
+0004b150: 2063 7265 6174 6520 6120 7374 7275 6374   create a struct
+0004b160: 7572 6520 7769 7468 2074 6865 2073 686f  ure with the sho
+0004b170: 7274 6e61 6d65 206f 7220 7573 6520 7468  rtname or use th
+0004b180: 6520 5374 7275 6374 7572 6528 290d 0a20  e Structure().. 
+0004b190: 2020 2020 2020 206c 6f67 2e64 6562 7567         log.debug
+0004b1a0: 2827 5075 7474 696e 6720 7b7d 2069 6e74  ('Putting {} int
+0004b1b0: 6f20 5374 7275 6374 7572 6520 666f 7220  o Structure for 
+0004b1c0: 6469 6d65 6e73 696f 6e20 7b7d 2077 6974  dimension {} wit
+0004b1d0: 6820 7369 7465 207b 7d20 272e 666f 726d  h site {} '.form
+0004b1e0: 6174 2872 6570 7228 7372 6329 2c64 696d  at(repr(src),dim
+0004b1f0: 656e 7369 6f6e 5f6e 756d 6265 722c 2073  ension_number, s
+0004b200: 656c 662e 7369 7465 2929 0d0a 0d0a 2020  elf.site))....  
+0004b210: 2020 2020 2020 6966 2073 7263 2069 7320        if src is 
+0004b220: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0004b230: 2020 2073 656c 662e 7374 7275 6374 7572     self.structur
+0004b240: 6573 5b64 696d 656e 7369 6f6e 5f6e 756d  es[dimension_num
+0004b250: 6265 725d 203d 204e 6f6e 650d 0a20 2020  ber] = None..   
+0004b260: 2020 2020 2020 2020 2072 6574 7572 6e0d           return.
+0004b270: 0a0d 0a20 2020 2020 2020 2069 6620 6973  ...        if is
+0004b280: 696e 7374 616e 6365 2873 7263 2c73 7472  instance(src,str
+0004b290: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0004b2a0: 6966 2073 656c 662e 7369 7465 2069 7320  if self.site is 
+0004b2b0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0004b2c0: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+0004b2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b2e0: 2020 2020 2073 656c 662e 7369 7465 2e64       self.site.d
+0004b2f0: 696d 656e 7369 6f6e 735b 6469 6d65 6e73  imensions[dimens
+0004b300: 696f 6e5f 6e75 6d62 6572 5d2e 7374 7275  ion_number].stru
+0004b310: 6374 7572 6573 2e5f 7374 7275 6374 7572  ctures._structur
+0004b320: 6573 5b73 7263 5d0d 0a20 2020 2020 2020  es[src]..       
+0004b330: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0004b340: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
+0004b350: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0004b360: 204a 4154 2032 3032 3130 3730 3920 2d20   JAT 20210709 - 
+0004b370: 4927 6d20 6e6f 7420 7375 7265 2074 6869  I'm not sure thi
+0004b380: 7320 6973 2073 6f20 676f 6f64 2068 6176  s is so good hav
+0004b390: 696e 6720 6c6f 6f6b 6564 2061 7420 6974  ing looked at it
+0004b3a0: 2061 2073 6563 6f6e 6420 7469 6d65 202d   a second time -
+0004b3b0: 2077 6520 636f 756c 6420 656e 6420 7570   we could end up
+0004b3c0: 2061 6363 6964 656e 7461 6c6c 7920 6372   accidentally cr
+0004b3d0: 6561 7469 6e67 2073 7472 7563 7472 7565  eating structrue
+0004b3e0: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+0004b3f0: 2020 2020 2020 2073 656c 662e 7369 7465         self.site
+0004b400: 2e64 696d 656e 7369 6f6e 735b 6469 6d65  .dimensions[dime
+0004b410: 6e73 696f 6e5f 6e75 6d62 6572 5d2e 7374  nsion_number].st
+0004b420: 7275 6374 7572 6573 2e5f 7374 7275 6374  ructures._struct
+0004b430: 7572 6573 5b73 7263 5d20 3d20 5374 7275  ures[src] = Stru
+0004b440: 6374 7572 6528 7368 6f72 746e 616d 6520  cture(shortname 
+0004b450: 3d20 7372 632c 6469 6d65 6e73 696f 6e20  = src,dimension 
+0004b460: 3d20 7365 6c66 2e73 6974 652e 6469 6d65  = self.site.dime
+0004b470: 6e73 696f 6e73 5b64 696d 656e 7369 6f6e  nsions[dimension
+0004b480: 5f6e 756d 6265 725d 290d 0a0d 0a20 2020  _number])....   
+0004b490: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0004b4a0: 662e 7374 7275 6374 7572 6573 5b64 696d  f.structures[dim
+0004b4b0: 656e 7369 6f6e 5f6e 756d 6265 725d 203d  ension_number] =
+0004b4c0: 2073 656c 662e 7369 7465 2e64 696d 656e   self.site.dimen
+0004b4d0: 7369 6f6e 735b 6469 6d65 6e73 696f 6e5f  sions[dimension_
+0004b4e0: 6e75 6d62 6572 5d2e 7374 7275 6374 7572  number].structur
+0004b4f0: 6573 2e5f 7374 7275 6374 7572 6573 5b73  es._structures[s
+0004b500: 7263 5d20 2020 2020 2020 2020 2020 2020  rc]             
+0004b510: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
+0004b520: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+0004b530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004b540: 2073 656c 662e 7374 7275 6374 7572 6573   self.structures
+0004b550: 5b64 696d 656e 7369 6f6e 5f6e 756d 6265  [dimension_numbe
+0004b560: 725d 2020 3d20 5374 7275 6374 7572 6528  r]  = Structure(
+0004b570: 7368 6f72 746e 616d 6520 3d20 7372 632c  shortname = src,
+0004b580: 6469 6d65 6e73 696f 6e5f 696e 6465 7820  dimension_index 
+0004b590: 3d20 6469 6d65 6e73 696f 6e5f 6e75 6d62  = dimension_numb
+0004b5a0: 6572 290d 0a20 2020 2020 2020 2065 6c69  er)..        eli
+0004b5b0: 6620 6973 696e 7374 616e 6365 2873 7263  f isinstance(src
+0004b5c0: 2c53 7472 7563 7475 7265 293a 0d0a 2020  ,Structure):..  
+0004b5d0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+0004b5e0: 7472 7563 7475 7265 735b 6469 6d65 6e73  tructures[dimens
+0004b5f0: 696f 6e5f 6e75 6d62 6572 5d20 203d 2073  ion_number]  = s
+0004b600: 7263 0d0a 2020 2020 2020 2020 656c 6966  rc..        elif
+0004b610: 2069 7369 6e73 7461 6e63 6528 7372 632c   isinstance(src,
+0004b620: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+0004b630: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0004b640: 7365 6c66 2e73 7472 7563 7475 7265 735b  self.structures[
+0004b650: 6469 6d65 6e73 696f 6e5f 6e75 6d62 6572  dimension_number
+0004b660: 5d20 203d 2073 7263 0d0a 2020 2020 2020  ]  = src..      
+0004b670: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0004b680: 6528 7372 632c 456c 656d 656e 7429 3a0d  e(src,Element):.
+0004b690: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0004b6a0: 662e 7374 7275 6374 7572 6573 5b64 696d  f.structures[dim
+0004b6b0: 656e 7369 6f6e 5f6e 756d 6265 725d 2020  ension_number]  
+0004b6c0: 3d20 5374 7275 6374 7572 6545 6c65 6d65  = StructureEleme
+0004b6d0: 6e74 2865 6c65 6d65 6e74 3d73 7263 290d  nt(element=src).
+0004b6e0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0004b6f0: 2020 2020 2020 2020 2020 2020 2320 6475              # du
+0004b700: 636b 7479 7065 2069 7420 2d20 6966 2069  cktype it - if i
+0004b710: 7420 7175 6163 6b73 206c 696b 6520 6120  t quacks like a 
+0004b720: 5374 7275 6374 7572 6520 7765 276c 6c20  Structure we'll 
+0004b730: 6265 204f 4b0d 0a20 2020 2020 2020 2020  be OK..         
+0004b740: 2020 2073 656c 662e 7374 7275 6374 7572     self.structur
+0004b750: 6573 5b64 696d 656e 7369 6f6e 5f6e 756d  es[dimension_num
+0004b760: 6265 725d 2020 3d20 7372 630d 0a0d 0a20  ber]  = src.... 
+0004b770: 2020 2020 2020 2023 2054 7279 2074 6f20         # Try to 
+0004b780: 7365 7420 6f75 7220 7369 7465 2075 7369  set our site usi
+0004b790: 6e67 2074 6865 2069 6e74 6572 6e61 6c20  ng the internal 
+0004b7a0: 7369 7465 206f 6620 7468 6520 7374 7275  site of the stru
+0004b7b0: 6374 7572 650d 0a20 2020 2020 2020 2074  cture..        t
+0004b7c0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0004b7d0: 2073 656c 662e 7369 7465 203d 2073 7263   self.site = src
+0004b7e0: 2e64 696d 656e 7369 6f6e 2e73 6974 650d  .dimension.site.
+0004b7f0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0004b800: 4174 7472 6962 7574 6545 7272 6f72 3a0d  AttributeError:.
+0004b810: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+0004b820: 7320 2020 2020 2020 2020 2020 2020 2020  s               
+0004b830: 0d0a 0d0a 2020 2020 2020 2020 6c6f 672e  ....        log.
+0004b840: 6465 6275 6728 2753 6574 2074 6172 6765  debug('Set targe
+0004b850: 7420 7b7d 2066 6f72 207b 7d20 7769 7468  t {} for {} with
+0004b860: 206e 6f20 7369 7465 272e 666f 726d 6174   no site'.format
+0004b870: 2872 6570 7228 7365 6c66 2e73 7472 7563  (repr(self.struc
+0004b880: 7475 7265 735b 6469 6d65 6e73 696f 6e5f  tures[dimension_
+0004b890: 6e75 6d62 6572 5d29 2c72 6570 7228 7365  number]),repr(se
+0004b8a0: 6c66 2929 290d 0a20 2020 2020 2020 2020  lf)))..         
+0004b8b0: 2020 2020 2020 200d 0a20 2020 2064 6566         ..    def
+0004b8c0: 206c 6f61 6428 7365 6c66 2c20 7372 632c   load(self, src,
+0004b8d0: 206d 6170 7069 6e67 7320 3d20 7b7d 2c73   mappings = {},s
+0004b8e0: 6166 655f 6c6f 6164 3d54 7275 652c 6964  afe_load=True,id
+0004b8f0: 656e 7469 6669 6572 5f63 6f6c 756d 6e73  entifier_columns
+0004b900: 3d4e 6f6e 652c 6967 6e6f 7265 5f7a 6572  =None,ignore_zer
+0004b910: 6f5f 7661 6c75 6573 3d54 7275 652c 636c  o_values=True,cl
+0004b920: 6561 725f 666f 6375 735f 6265 666f 7265  ear_focus_before
+0004b930: 5f6c 6f61 6469 6e67 3d54 7275 6529 3a0d  _loading=True):.
+0004b940: 0a20 2020 2020 2020 2069 6620 6964 656e  .        if iden
+0004b950: 7469 6669 6572 5f63 6f6c 756d 6e73 2069  tifier_columns i
+0004b960: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0004b970: 2020 2020 2069 6465 6e74 6966 6965 725f       identifier_
+0004b980: 636f 6c75 6d6e 733d 5b5d 0d0a 2020 2020  columns=[]..    
+0004b990: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+0004b9a0: 2020 666f 6375 7320 3d20 466f 6375 7328    focus = Focus(
+0004b9b0: 7365 6c66 290d 0a20 2020 2020 2020 2066  self)..        f
+0004b9c0: 6f63 7573 2e6c 6f61 6428 7372 633d 7372  ocus.load(src=sr
+0004b9d0: 630d 0a20 2020 2020 2020 2020 2020 2020  c..             
+0004b9e0: 2020 2020 202c 6d61 7070 696e 6773 3d6d       ,mappings=m
+0004b9f0: 6170 7069 6e67 730d 0a20 2020 2020 2020  appings..       
+0004ba00: 2020 2020 2020 2020 2020 202c 7361 6665             ,safe
+0004ba10: 5f6c 6f61 643d 7361 6665 5f6c 6f61 640d  _load=safe_load.
+0004ba20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004ba30: 2020 202c 6964 656e 7469 6669 6572 5f63     ,identifier_c
+0004ba40: 6f6c 756d 6e73 3d69 6465 6e74 6966 6965  olumns=identifie
+0004ba50: 725f 636f 6c75 6d6e 730d 0a20 2020 2020  r_columns..     
+0004ba60: 2020 2020 2020 2020 2020 2020 202c 6967               ,ig
+0004ba70: 6e6f 7265 5f7a 6572 6f5f 7661 6c75 6573  nore_zero_values
+0004ba80: 3d69 676e 6f72 655f 7a65 726f 5f76 616c  =ignore_zero_val
+0004ba90: 7565 730d 0a20 2020 2020 2020 2020 2020  ues..           
+0004baa0: 2020 2020 2020 202c 636c 6561 725f 666f         ,clear_fo
+0004bab0: 6375 735f 6265 666f 7265 5f6c 6f61 6469  cus_before_loadi
+0004bac0: 6e67 3d63 6c65 6172 5f66 6f63 7573 5f62  ng=clear_focus_b
+0004bad0: 6566 6f72 655f 6c6f 6164 696e 670d 0a20  efore_loading.. 
+0004bae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004baf0: 2029 0d0a 0d0a 2020 2020 6465 6620 5f5f   )....    def __
+0004bb00: 6c65 6e5f 5f28 7365 6c66 293a 0d0a 0d0a  len__(self):....
+0004bb10: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0004bb20: 2031 0d0a 2020 2020 2020 2020 666f 7220   1..        for 
+0004bb30: 7374 7275 6374 7572 6520 696e 2073 656c  structure in sel
+0004bb40: 662e 7374 7275 6374 7572 6573 2e76 616c  f.structures.val
+0004bb50: 7565 7328 293a 0d0a 2020 2020 2020 2020  ues():..        
+0004bb60: 2020 2020 6966 2073 7472 7563 7475 7265      if structure
+0004bb70: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
+0004bb80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0004bb90: 6573 756c 7420 2a3d 206c 656e 2873 7472  esult *= len(str
+0004bba0: 7563 7475 7265 290d 0a0d 0a20 2020 2020  ucture)....     
+0004bbb0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+0004bbc0: 0d0a 0d0a 636c 6173 7320 466f 6375 7328  ....class Focus(
+0004bbd0: 6f62 6a65 6374 293a 0d0a 0d0a 2020 2020  object):....    
+0004bbe0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+0004bbf0: 662c 2073 7263 293a 0d0a 2020 2020 2020  f, src):..      
+0004bc00: 2020 7365 6c66 2e5f 7669 6577 706f 696e    self._viewpoin
+0004bc10: 7420 3d20 4e6f 6e65 0d0a 2020 2020 2020  t = None..      
+0004bc20: 2020 7365 6c66 2e5f 7374 7275 6374 7572    self._structur
+0004bc30: 6573 203d 205f 466f 6375 7353 7472 7563  es = _FocusStruc
+0004bc40: 7475 7265 7347 6574 7465 7228 666f 6375  turesGetter(focu
+0004bc50: 7320 3d20 7365 6c66 290d 0a20 2020 2020  s = self)..     
+0004bc60: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+0004bc70: 2069 6620 6973 696e 7374 616e 6365 2873   if isinstance(s
+0004bc80: 7263 2c56 6965 7770 6f69 6e74 293a 0d0a  rc,Viewpoint):..
+0004bc90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0004bca0: 2e5f 7669 6577 706f 696e 7420 3d20 7372  ._viewpoint = sr
+0004bcb0: 630d 0a20 2020 2020 2020 2020 2020 2023  c..            #
+0004bcc0: 436f 7079 2069 6e20 7468 6520 7669 6577  Copy in the view
+0004bcd0: 706f 696e 7420 7374 7275 6374 7572 6573  point structures
+0004bce0: 2069 6e74 6f20 7468 6520 666f 6375 730d   into the focus.
+0004bcf0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0004bd00: 206b 2c76 2069 6e20 7365 6c66 2e5f 7669   k,v in self._vi
+0004bd10: 6577 706f 696e 742e 7374 7275 6374 7572  ewpoint.structur
+0004bd20: 6573 2e69 7465 6d73 2829 3a0d 0a20 2020  es.items():..   
+0004bd30: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0004bd40: 662e 5f73 7472 7563 7475 7265 735b 6b5d  f._structures[k]
+0004bd50: 203d 2076 0d0a 2020 2020 2020 2020 2020   = v..          
+0004bd60: 2020 2020 2020 0d0a 2020 2020 6465 6620        ..    def 
+0004bd70: 6c6f 6164 2873 656c 662c 2073 7263 2c20  load(self, src, 
+0004bd80: 6d61 7070 696e 6773 203d 204e 6f6e 652c  mappings = None,
+0004bd90: 7361 6665 5f6c 6f61 643d 5472 7565 2c69  safe_load=True,i
+0004bda0: 6465 6e74 6966 6965 725f 636f 6c75 6d6e  dentifier_column
+0004bdb0: 733d 4e6f 6e65 2c69 676e 6f72 655f 7a65  s=None,ignore_ze
+0004bdc0: 726f 5f76 616c 7565 733d 5472 7565 2c63  ro_values=True,c
+0004bdd0: 6c65 6172 5f66 6f63 7573 5f62 6566 6f72  lear_focus_befor
+0004bde0: 655f 6c6f 6164 696e 673d 5472 7565 293a  e_loading=True):
+0004bdf0: 0d0a 2020 2020 2020 2020 6966 206d 6170  ..        if map
+0004be00: 7069 6e67 7320 6973 204e 6f6e 653a 0d0a  pings is None:..
+0004be10: 2020 2020 2020 2020 2020 2020 6d61 7070              mapp
+0004be20: 696e 6773 203d 207b 7d0d 0a0d 0a20 2020  ings = {}....   
+0004be30: 2020 2020 2069 6620 6964 656e 7469 6669       if identifi
+0004be40: 6572 5f63 6f6c 756d 6e73 2069 7320 4e6f  er_columns is No
+0004be50: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+0004be60: 2069 6465 6e74 6966 6965 725f 636f 6c75   identifier_colu
+0004be70: 6d6e 733d 5b5d 0d0a 2020 2020 2020 2020  mns=[]..        
+0004be80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004be90: 0d0a 2020 2020 2020 2020 666c 203d 2046  ..        fl = F
+0004bea0: 6f63 7573 4c6f 6164 6572 2873 6f75 7263  ocusLoader(sourc
+0004beb0: 653d 7372 630d 0a20 2020 2020 2020 2020  e=src..         
+0004bec0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0004bed0: 7461 7267 6574 3d73 656c 660d 0a20 2020  target=self..   
 0004bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bef0: 2020 2020 202c 7361 6665 5f6c 6f61 643d       ,safe_load=
-0004bf00: 7361 6665 5f6c 6f61 640d 0a20 2020 2020  safe_load..     
+0004bef0: 2020 2020 202c 6d61 7070 696e 6773 3d6d       ,mappings=m
+0004bf00: 6170 7069 6e67 730d 0a20 2020 2020 2020  appings..       
 0004bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bf20: 2020 202c 6964 656e 7469 6669 6572 5f63     ,identifier_c
-0004bf30: 6f6c 756d 6e73 3d69 6465 6e74 6966 6965  olumns=identifie
-0004bf40: 725f 636f 6c75 6d6e 730d 0a20 2020 2020  r_columns..     
-0004bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bf60: 2020 202c 6967 6e6f 7265 5f7a 6572 6f5f     ,ignore_zero_
-0004bf70: 7661 6c75 6573 3d69 676e 6f72 655f 7a65  values=ignore_ze
-0004bf80: 726f 5f76 616c 7565 730d 0a20 2020 2020  ro_values..     
-0004bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bfa0: 2020 202c 636c 6561 725f 666f 6375 735f     ,clear_focus_
-0004bfb0: 6265 666f 7265 5f6c 6f61 6469 6e67 3d63  before_loading=c
-0004bfc0: 6c65 6172 5f66 6f63 7573 5f62 6566 6f72  lear_focus_befor
-0004bfd0: 655f 6c6f 6164 696e 670d 0a20 2020 2020  e_loading..     
-0004bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004bff0: 2020 202c 5f64 6566 6572 5f6d 6170 7065     ,_defer_mappe
-0004c000: 725f 6372 6561 7469 6f6e 3d46 616c 7365  r_creation=False
-0004c010: 290d 0a0d 0a20 2020 2020 2020 2066 6c2e  )....        fl.
-0004c020: 6c6f 6164 2829 0d0a 0d0a 2020 2020 4070  load()....    @p
-0004c030: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-0004c040: 2076 6965 7770 6f69 6e74 2873 656c 6629   viewpoint(self)
-0004c050: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-0004c060: 6e20 7365 6c66 2e5f 7669 6577 706f 696e  n self._viewpoin
-0004c070: 740d 0a0d 0a20 2020 2040 7072 6f70 6572  t....    @proper
-0004c080: 7479 0d0a 2020 2020 6465 6620 7374 7275  ty..    def stru
-0004c090: 6374 7572 6573 2873 656c 6629 3a0d 0a20  ctures(self):.. 
-0004c0a0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0004c0b0: 6c66 2e5f 7374 7275 6374 7572 6573 0d0a  lf._structures..
-0004c0c0: 0d0a 2020 2020 4070 726f 7065 7274 790d  ..    @property.
-0004c0d0: 0a20 2020 2064 6566 2070 6879 7369 6428  .    def physid(
-0004c0e0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0004c0f0: 6966 2073 656c 662e 7669 6577 706f 696e  if self.viewpoin
-0004c100: 7420 6973 204e 6f6e 653a 0d0a 2020 2020  t is None:..    
-0004c110: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0004c120: 6f6e 650d 0a20 2020 2020 2020 2072 6574  one..        ret
-0004c130: 7572 6e20 7365 6c66 2e76 6965 7770 6f69  urn self.viewpoi
-0004c140: 6e74 2e70 6879 7369 640d 0a0d 0a20 2020  nt.physid....   
-0004c150: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-0004c160: 6465 6620 7369 7465 2873 656c 6629 3a0d  def site(self):.
-0004c170: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0004c180: 2e76 6965 7770 6f69 6e74 2069 7320 4e6f  .viewpoint is No
-0004c190: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-0004c1a0: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
-0004c1b0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0004c1c0: 662e 7669 6577 706f 696e 742e 7369 7465  f.viewpoint.site
-0004c1d0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 6c65  ....    def __le
-0004c1e0: 6e5f 5f28 7365 6c66 293a 0d0a 0d0a 2020  n__(self):....  
-0004c1f0: 2020 2020 2020 7265 7375 6c74 203d 2031        result = 1
-0004c200: 0d0a 2020 2020 2020 2020 666f 7220 7374  ..        for st
-0004c210: 7275 6374 7572 6520 696e 2073 656c 662e  ructure in self.
-0004c220: 7374 7275 6374 7572 6573 2e76 616c 7565  structures.value
-0004c230: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-0004c240: 2020 6966 2073 7472 7563 7475 7265 2069    if structure i
-0004c250: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-0004c260: 2020 2020 2020 2020 2020 2020 2072 6573               res
-0004c270: 756c 7420 2a3d 206c 656e 2873 7472 7563  ult *= len(struc
-0004c280: 7475 7265 290d 0a0d 0a20 2020 2020 2020  ture)....       
-0004c290: 2072 6574 7572 6e20 7265 7375 6c74 0d0a   return result..
-0004c2a0: 0d0a 636c 6173 7320 5f46 6f63 7573 5374  ..class _FocusSt
-0004c2b0: 7275 6374 7572 6573 4765 7474 6572 286f  ructuresGetter(o
-0004c2c0: 626a 6563 7429 3a0d 0a20 2020 2027 2727  bject):..    '''
-0004c2d0: 436c 6173 7320 666f 7220 656e 7375 7269  Class for ensuri
-0004c2e0: 6e67 2074 6861 7420 5f73 6574 6974 656d  ng that _setitem
-0004c2f0: 5f20 6f6e 2073 7472 7563 7475 7265 7320  _ on structures 
-0004c300: 6f62 6579 7320 466f 6375 7320 7275 6c65  obeys Focus rule
-0004c310: 730d 0a20 2020 2049 7420 6265 6861 7665  s..    It behave
-0004c320: 7320 6c69 6b65 2061 2064 6963 740d 0a20  s like a dict.. 
-0004c330: 2020 2054 6865 2072 6574 7572 6e65 6420     The returned 
-0004c340: 7374 7275 6374 7572 6573 2061 7265 206e  structures are n
-0004c350: 756d 6265 7265 6420 696e 2074 6865 2073  umbered in the s
-0004c360: 616d 6520 7761 7920 7468 6174 202e 7374  ame way that .st
-0004c370: 7275 6374 7572 6573 2069 6e20 6120 5669  ructures in a Vi
-0004c380: 6577 706f 696e 7420 6172 650d 0a20 2020  ewpoint are..   
-0004c390: 2027 2727 0d0a 0d0a 2020 2020 6465 6620   '''....    def 
-0004c3a0: 5f5f 696e 6974 5f5f 2873 656c 662c 666f  __init__(self,fo
-0004c3b0: 6375 7329 3a0d 0a20 2020 2020 2020 2073  cus):..        s
-0004c3c0: 656c 662e 5f73 7472 7563 7475 7265 733d  elf._structures=
-0004c3d0: 7b7d 0d0a 0d0a 2020 2020 2355 6e6c 696b  {}....    #Unlik
-0004c3e0: 6520 6120 7374 616e 6461 7264 2064 6963  e a standard dic
-0004c3f0: 7469 6f6e 6172 7920 7768 6963 6820 7265  tionary which re
-0004c400: 7475 726e 7320 6b65 7973 2069 6e20 6974  turns keys in it
-0004c410: 6572 2c20 7265 7475 726e 2076 616c 7565  er, return value
-0004c420: 7320 2873 696e 6365 2074 6861 7427 7320  s (since that's 
-0004c430: 7768 6174 2077 6520 7573 7561 6c6c 7920  what we usually 
-0004c440: 7761 6e74 290d 0a20 2020 2064 6566 205f  want)..    def _
-0004c450: 5f69 7465 725f 5f28 7365 6c66 293a 0d0a  _iter__(self):..
-0004c460: 2020 2020 2020 2020 7365 6c66 2e5f 6974          self._it
-0004c470: 6572 6174 6f72 203d 2069 7465 7228 7365  erator = iter(se
-0004c480: 6c66 2e76 616c 7565 7328 2929 0d0a 2020  lf.values())..  
-0004c490: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0004c4a0: 660d 0a0d 0a20 2020 2064 6566 205f 5f6e  f....    def __n
-0004c4b0: 6578 745f 5f28 7365 6c66 293a 0d0a 2020  ext__(self):..  
-0004c4c0: 2020 2020 2020 7265 7475 726e 206e 6578        return nex
-0004c4d0: 7428 7365 6c66 2e5f 6974 6572 6174 6f72  t(self._iterator
-0004c4e0: 290d 0a0d 0a20 2020 2064 6566 205f 5f67  )....    def __g
-0004c4f0: 6574 6974 656d 5f5f 2873 656c 662c 6974  etitem__(self,it
-0004c500: 656d 293a 0d0a 2020 2020 2020 2020 7472  em):..        tr
-0004c510: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-0004c520: 7265 7475 726e 2073 656c 662e 5f73 7472  return self._str
-0004c530: 7563 7475 7265 735b 6974 656d 5d0d 0a20  uctures[item].. 
-0004c540: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-0004c550: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
-0004c560: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0004c570: 6365 2869 7465 6d2c 696e 7429 3a0d 0a20  ce(item,int):.. 
-0004c580: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0004c590: 6574 7572 6e20 4e6f 6e65 0d0a 2020 2020  eturn None..    
-0004c5a0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-0004c5b0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0004c5c0: 6169 7365 0d0a 0d0a 2020 2020 6465 6620  aise....    def 
-0004c5d0: 5f5f 7365 7469 7465 6d5f 5f28 7365 6c66  __setitem__(self
-0004c5e0: 2c6b 6579 2c69 7465 6d29 3a0d 0a20 2020  ,key,item):..   
-0004c5f0: 2020 2020 2073 656c 662e 5f73 7472 7563       self._struc
-0004c600: 7475 7265 735b 6b65 795d 203d 2069 7465  tures[key] = ite
-0004c610: 6d0d 0a0d 0a20 2020 2023 2344 6566 696e  m....    ##Defin
-0004c620: 6520 7768 6174 2068 6170 7065 6e73 2077  e what happens w
-0004c630: 6865 6e20 7765 2063 616c 6c20 2b3d 0d0a  hen we call +=..
-0004c640: 2020 2020 2323 5765 2077 616e 7420 746f      ##We want to
-0004c650: 2061 7070 656e 640d 0a20 2020 2023 6465   append..    #de
-0004c660: 6620 5f5f 6961 6464 5f5f 2873 656c 662c  f __iadd__(self,
-0004c670: 6f74 6865 7229 3a0d 0a20 2020 2023 2020  other):..    #  
-0004c680: 2020 6173 7365 7274 2069 7369 6e73 7461    assert isinsta
-0004c690: 6e63 6528 6f74 6865 722c 5374 7275 6374  nce(other,Struct
-0004c6a0: 7572 6529 0d0a 2020 2020 2320 2020 2023  ure)..    #    #
-0004c6b0: 6164 6420 7468 6520 6e65 7720 7374 7275  add the new stru
-0004c6c0: 6374 7572 6520 696e 746f 2074 6865 2064  cture into the d
-0004c6d0: 6963 7469 6f6e 6172 7920 7573 696e 6720  ictionary using 
-0004c6e0: 5f5f 7365 7469 7465 6d5f 5f0d 0a20 2020  __setitem__..   
-0004c6f0: 2023 2020 2020 7365 6c66 5b6f 7468 6572   #    self[other
-0004c700: 2e73 686f 7274 6e61 6d65 5d20 3d20 6f74  .shortname] = ot
-0004c710: 6865 720d 0a20 2020 2023 2020 2020 7265  her..    #    re
-0004c720: 7475 726e 2073 656c 660d 0a0d 0a20 2020  turn self....   
-0004c730: 2064 6566 2076 616c 7565 7328 7365 6c66   def values(self
-0004c740: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-0004c750: 726e 2073 656c 662e 5f73 7472 7563 7475  rn self._structu
-0004c760: 7265 732e 7661 6c75 6573 2829 0d0a 0d0a  res.values()....
-0004c770: 2020 2020 6465 6620 6974 656d 7328 7365      def items(se
-0004c780: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
-0004c790: 7475 726e 2073 656c 662e 5f73 7472 7563  turn self._struc
-0004c7a0: 7475 7265 732e 6974 656d 7328 290d 0a0d  tures.items()...
-0004c7b0: 0a20 2020 2064 6566 206b 6579 7328 7365  .    def keys(se
-0004c7c0: 6c66 293a 0d0a 2020 2020 2020 2020 7265  lf):..        re
-0004c7d0: 7475 726e 2073 656c 662e 5f73 7472 7563  turn self._struc
-0004c7e0: 7475 7265 732e 6b65 7973 2829 0d0a 0d0a  tures.keys()....
-0004c7f0: 2020 2020 6465 6620 5f5f 6c65 6e5f 5f28      def __len__(
-0004c800: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0004c810: 7265 7475 726e 206c 656e 2873 656c 662e  return len(self.
-0004c820: 5f73 7472 7563 7475 7265 7329 0d0a 0d0a  _structures)....
-0004c830: 0d0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
-0004c840: 5f5f 2873 656c 6629 3a0d 0a20 2020 2020  __(self):..     
-0004c850: 2020 2072 6574 7572 6e20 277b 7d20 6672     return '{} fr
-0004c860: 6f6d 203c 7b7d 206f 626a 6563 7420 6174  om <{} object at
-0004c870: 207b 7d3e 272e 666f 726d 6174 2827 7b27   {}>'.format('{'
-0004c880: 202b 2027 5c6e 272e 6a6f 696e 285b 2022   + '\n'.join([ "
-0004c890: 277b 7d27 3a7b 7d22 2e66 6f72 6d61 7428  '{}':{}".format(
-0004c8a0: 6b2c 7265 7072 2876 2929 2066 6f72 206b  k,repr(v)) for k
-0004c8b0: 2c76 2069 6e20 7365 6c66 2e69 7465 6d73  ,v in self.items
-0004c8c0: 2829 5d29 202b 2027 7d27 2c73 656c 662e  ()]) + '}',self.
-0004c8d0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0004c8e0: 5f5f 2c68 6578 2869 6428 7365 6c66 2929  __,hex(id(self))
-0004c8f0: 290d 0a0d 0a0d 0a0d 0a23 2323 2323 2323  )........#######
-0004c900: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0004c910: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0004c920: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0004c930: 2323 2323 2323 2323 2323 2323 0d0a 230d  ############..#.
-0004c940: 0a23 204d 6170 7065 7273 0d0a 230d 0a23  .# Mappers..#..#
+0004bf20: 202c 7361 6665 5f6c 6f61 643d 7361 6665   ,safe_load=safe
+0004bf30: 5f6c 6f61 640d 0a20 2020 2020 2020 2020  _load..         
+0004bf40: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0004bf50: 6964 656e 7469 6669 6572 5f63 6f6c 756d  identifier_colum
+0004bf60: 6e73 3d69 6465 6e74 6966 6965 725f 636f  ns=identifier_co
+0004bf70: 6c75 6d6e 730d 0a20 2020 2020 2020 2020  lumns..         
+0004bf80: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0004bf90: 6967 6e6f 7265 5f7a 6572 6f5f 7661 6c75  ignore_zero_valu
+0004bfa0: 6573 3d69 676e 6f72 655f 7a65 726f 5f76  es=ignore_zero_v
+0004bfb0: 616c 7565 730d 0a20 2020 2020 2020 2020  alues..         
+0004bfc0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0004bfd0: 636c 6561 725f 666f 6375 735f 6265 666f  clear_focus_befo
+0004bfe0: 7265 5f6c 6f61 6469 6e67 3d63 6c65 6172  re_loading=clear
+0004bff0: 5f66 6f63 7573 5f62 6566 6f72 655f 6c6f  _focus_before_lo
+0004c000: 6164 696e 670d 0a20 2020 2020 2020 2020  ading..         
+0004c010: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0004c020: 5f64 6566 6572 5f6d 6170 7065 725f 6372  _defer_mapper_cr
+0004c030: 6561 7469 6f6e 3d46 616c 7365 290d 0a0d  eation=False)...
+0004c040: 0a20 2020 2020 2020 2066 6c2e 6c6f 6164  .        fl.load
+0004c050: 2829 0d0a 0d0a 2020 2020 4070 726f 7065  ()....    @prope
+0004c060: 7274 790d 0a20 2020 2064 6566 2076 6965  rty..    def vie
+0004c070: 7770 6f69 6e74 2873 656c 6629 3a0d 0a20  wpoint(self):.. 
+0004c080: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0004c090: 6c66 2e5f 7669 6577 706f 696e 740d 0a0d  lf._viewpoint...
+0004c0a0: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+0004c0b0: 2020 2020 6465 6620 7374 7275 6374 7572      def structur
+0004c0c0: 6573 2873 656c 6629 3a0d 0a20 2020 2020  es(self):..     
+0004c0d0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0004c0e0: 7374 7275 6374 7572 6573 0d0a 0d0a 2020  structures....  
+0004c0f0: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
+0004c100: 2064 6566 2070 6879 7369 6428 7365 6c66   def physid(self
+0004c110: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
+0004c120: 656c 662e 7669 6577 706f 696e 7420 6973  elf.viewpoint is
+0004c130: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0004c140: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
+0004c150: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0004c160: 7365 6c66 2e76 6965 7770 6f69 6e74 2e70  self.viewpoint.p
+0004c170: 6879 7369 640d 0a0d 0a20 2020 2040 7072  hysid....    @pr
+0004c180: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+0004c190: 7369 7465 2873 656c 6629 3a0d 0a20 2020  site(self):..   
+0004c1a0: 2020 2020 2069 6620 7365 6c66 2e76 6965       if self.vie
+0004c1b0: 7770 6f69 6e74 2069 7320 4e6f 6e65 3a0d  wpoint is None:.
+0004c1c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0004c1d0: 7572 6e20 4e6f 6e65 0d0a 2020 2020 2020  urn None..      
+0004c1e0: 2020 7265 7475 726e 2073 656c 662e 7669    return self.vi
+0004c1f0: 6577 706f 696e 742e 7369 7465 0d0a 0d0a  ewpoint.site....
+0004c200: 2020 2020 6465 6620 5f5f 6c65 6e5f 5f28      def __len__(
+0004c210: 7365 6c66 293a 0d0a 0d0a 2020 2020 2020  self):....      
+0004c220: 2020 7265 7375 6c74 203d 2031 0d0a 2020    result = 1..  
+0004c230: 2020 2020 2020 666f 7220 7374 7275 6374        for struct
+0004c240: 7572 6520 696e 2073 656c 662e 7374 7275  ure in self.stru
+0004c250: 6374 7572 6573 2e76 616c 7565 7328 293a  ctures.values():
+0004c260: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0004c270: 2073 7472 7563 7475 7265 2069 7320 6e6f   structure is no
+0004c280: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+0004c290: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+0004c2a0: 2a3d 206c 656e 2873 7472 7563 7475 7265  *= len(structure
+0004c2b0: 290d 0a0d 0a20 2020 2020 2020 2072 6574  )....        ret
+0004c2c0: 7572 6e20 7265 7375 6c74 0d0a 0d0a 636c  urn result....cl
+0004c2d0: 6173 7320 5f46 6f63 7573 5374 7275 6374  ass _FocusStruct
+0004c2e0: 7572 6573 4765 7474 6572 286f 626a 6563  uresGetter(objec
+0004c2f0: 7429 3a0d 0a20 2020 2027 2727 436c 6173  t):..    '''Clas
+0004c300: 7320 666f 7220 656e 7375 7269 6e67 2074  s for ensuring t
+0004c310: 6861 7420 5f73 6574 6974 656d 5f20 6f6e  hat _setitem_ on
+0004c320: 2073 7472 7563 7475 7265 7320 6f62 6579   structures obey
+0004c330: 7320 466f 6375 7320 7275 6c65 730d 0a20  s Focus rules.. 
+0004c340: 2020 2049 7420 6265 6861 7665 7320 6c69     It behaves li
+0004c350: 6b65 2061 2064 6963 740d 0a20 2020 2054  ke a dict..    T
+0004c360: 6865 2072 6574 7572 6e65 6420 7374 7275  he returned stru
+0004c370: 6374 7572 6573 2061 7265 206e 756d 6265  ctures are numbe
+0004c380: 7265 6420 696e 2074 6865 2073 616d 6520  red in the same 
+0004c390: 7761 7920 7468 6174 202e 7374 7275 6374  way that .struct
+0004c3a0: 7572 6573 2069 6e20 6120 5669 6577 706f  ures in a Viewpo
+0004c3b0: 696e 7420 6172 650d 0a20 2020 2027 2727  int are..    '''
+0004c3c0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 696e  ....    def __in
+0004c3d0: 6974 5f5f 2873 656c 662c 666f 6375 7329  it__(self,focus)
+0004c3e0: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+0004c3f0: 5f73 7472 7563 7475 7265 733d 7b7d 0d0a  _structures={}..
+0004c400: 0d0a 2020 2020 2355 6e6c 696b 6520 6120  ..    #Unlike a 
+0004c410: 7374 616e 6461 7264 2064 6963 7469 6f6e  standard diction
+0004c420: 6172 7920 7768 6963 6820 7265 7475 726e  ary which return
+0004c430: 7320 6b65 7973 2069 6e20 6974 6572 2c20  s keys in iter, 
+0004c440: 7265 7475 726e 2076 616c 7565 7320 2873  return values (s
+0004c450: 696e 6365 2074 6861 7427 7320 7768 6174  ince that's what
+0004c460: 2077 6520 7573 7561 6c6c 7920 7761 6e74   we usually want
+0004c470: 290d 0a20 2020 2064 6566 205f 5f69 7465  )..    def __ite
+0004c480: 725f 5f28 7365 6c66 293a 0d0a 2020 2020  r__(self):..    
+0004c490: 2020 2020 7365 6c66 2e5f 6974 6572 6174      self._iterat
+0004c4a0: 6f72 203d 2069 7465 7228 7365 6c66 2e76  or = iter(self.v
+0004c4b0: 616c 7565 7328 2929 0d0a 2020 2020 2020  alues())..      
+0004c4c0: 2020 7265 7475 726e 2073 656c 660d 0a0d    return self...
+0004c4d0: 0a20 2020 2064 6566 205f 5f6e 6578 745f  .    def __next_
+0004c4e0: 5f28 7365 6c66 293a 0d0a 2020 2020 2020  _(self):..      
+0004c4f0: 2020 7265 7475 726e 206e 6578 7428 7365    return next(se
+0004c500: 6c66 2e5f 6974 6572 6174 6f72 290d 0a0d  lf._iterator)...
+0004c510: 0a20 2020 2064 6566 205f 5f67 6574 6974  .    def __getit
+0004c520: 656d 5f5f 2873 656c 662c 6974 656d 293a  em__(self,item):
+0004c530: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
+0004c540: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0004c550: 726e 2073 656c 662e 5f73 7472 7563 7475  rn self._structu
+0004c560: 7265 735b 6974 656d 5d0d 0a20 2020 2020  res[item]..     
+0004c570: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
+0004c580: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+0004c590: 2069 6620 6973 696e 7374 616e 6365 2869   if isinstance(i
+0004c5a0: 7465 6d2c 696e 7429 3a0d 0a20 2020 2020  tem,int):..     
+0004c5b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0004c5c0: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
+0004c5d0: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+0004c5e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0004c5f0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 7365  ....    def __se
+0004c600: 7469 7465 6d5f 5f28 7365 6c66 2c6b 6579  titem__(self,key
+0004c610: 2c69 7465 6d29 3a0d 0a20 2020 2020 2020  ,item):..       
+0004c620: 2073 656c 662e 5f73 7472 7563 7475 7265   self._structure
+0004c630: 735b 6b65 795d 203d 2069 7465 6d0d 0a0d  s[key] = item...
+0004c640: 0a20 2020 2023 2344 6566 696e 6520 7768  .    ##Define wh
+0004c650: 6174 2068 6170 7065 6e73 2077 6865 6e20  at happens when 
+0004c660: 7765 2063 616c 6c20 2b3d 0d0a 2020 2020  we call +=..    
+0004c670: 2323 5765 2077 616e 7420 746f 2061 7070  ##We want to app
+0004c680: 656e 640d 0a20 2020 2023 6465 6620 5f5f  end..    #def __
+0004c690: 6961 6464 5f5f 2873 656c 662c 6f74 6865  iadd__(self,othe
+0004c6a0: 7229 3a0d 0a20 2020 2023 2020 2020 6173  r):..    #    as
+0004c6b0: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
+0004c6c0: 6f74 6865 722c 5374 7275 6374 7572 6529  other,Structure)
+0004c6d0: 0d0a 2020 2020 2320 2020 2023 6164 6420  ..    #    #add 
+0004c6e0: 7468 6520 6e65 7720 7374 7275 6374 7572  the new structur
+0004c6f0: 6520 696e 746f 2074 6865 2064 6963 7469  e into the dicti
+0004c700: 6f6e 6172 7920 7573 696e 6720 5f5f 7365  onary using __se
+0004c710: 7469 7465 6d5f 5f0d 0a20 2020 2023 2020  titem__..    #  
+0004c720: 2020 7365 6c66 5b6f 7468 6572 2e73 686f    self[other.sho
+0004c730: 7274 6e61 6d65 5d20 3d20 6f74 6865 720d  rtname] = other.
+0004c740: 0a20 2020 2023 2020 2020 7265 7475 726e  .    #    return
+0004c750: 2073 656c 660d 0a0d 0a20 2020 2064 6566   self....    def
+0004c760: 2076 616c 7565 7328 7365 6c66 293a 0d0a   values(self):..
+0004c770: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0004c780: 656c 662e 5f73 7472 7563 7475 7265 732e  elf._structures.
+0004c790: 7661 6c75 6573 2829 0d0a 0d0a 2020 2020  values()....    
+0004c7a0: 6465 6620 6974 656d 7328 7365 6c66 293a  def items(self):
+0004c7b0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0004c7c0: 2073 656c 662e 5f73 7472 7563 7475 7265   self._structure
+0004c7d0: 732e 6974 656d 7328 290d 0a0d 0a20 2020  s.items()....   
+0004c7e0: 2064 6566 206b 6579 7328 7365 6c66 293a   def keys(self):
+0004c7f0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0004c800: 2073 656c 662e 5f73 7472 7563 7475 7265   self._structure
+0004c810: 732e 6b65 7973 2829 0d0a 0d0a 2020 2020  s.keys()....    
+0004c820: 6465 6620 5f5f 6c65 6e5f 5f28 7365 6c66  def __len__(self
+0004c830: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
+0004c840: 726e 206c 656e 2873 656c 662e 5f73 7472  rn len(self._str
+0004c850: 7563 7475 7265 7329 0d0a 0d0a 0d0a 2020  uctures)......  
+0004c860: 2020 6465 6620 5f5f 7265 7072 5f5f 2873    def __repr__(s
+0004c870: 656c 6629 3a0d 0a20 2020 2020 2020 2072  elf):..        r
+0004c880: 6574 7572 6e20 277b 7d20 6672 6f6d 203c  eturn '{} from <
+0004c890: 7b7d 206f 626a 6563 7420 6174 207b 7d3e  {} object at {}>
+0004c8a0: 272e 666f 726d 6174 2827 7b27 202b 2027  '.format('{' + '
+0004c8b0: 5c6e 272e 6a6f 696e 285b 2022 277b 7d27  \n'.join([ "'{}'
+0004c8c0: 3a7b 7d22 2e66 6f72 6d61 7428 6b2c 7265  :{}".format(k,re
+0004c8d0: 7072 2876 2929 2066 6f72 206b 2c76 2069  pr(v)) for k,v i
+0004c8e0: 6e20 7365 6c66 2e69 7465 6d73 2829 5d29  n self.items()])
+0004c8f0: 202b 2027 7d27 2c73 656c 662e 5f5f 636c   + '}',self.__cl
+0004c900: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 2c68  ass__.__name__,h
+0004c910: 6578 2869 6428 7365 6c66 2929 290d 0a0d  ex(id(self)))...
+0004c920: 0a0d 0a0d 0a23 2323 2323 2323 2323 2323  .....###########
+0004c930: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0004c940: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0004c950: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0004c960: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0004c970: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0004c960: 2323 2323 2323 2323 0d0a 230d 0a23 204d  ########..#..# M
+0004c970: 6170 7065 7273 0d0a 230d 0a23 2323 2323  appers..#..#####
 0004c980: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0004c990: 2323 0d0a 0d0a 0d0a 0d0a 636c 6173 7320  ##........class 
-0004c9a0: 5461 626c 6545 6d70 6f77 6572 4d61 7070  TableEmpowerMapp
-0004c9b0: 6572 286f 626a 6563 7429 3a0d 0a20 2020  er(object):..   
-0004c9c0: 2027 2727 4261 7365 2063 6c61 7373 2066   '''Base class f
-0004c9d0: 6f72 2063 6c61 7373 6573 206d 6170 7069  or classes mappi
-0004c9e0: 6e67 2074 6162 6c65 7320 2873 6f20 6661  ng tables (so fa
-0004c9f0: 7220 6f6e 6c79 2070 616e 6461 7320 4461  r only pandas Da
-0004ca00: 7461 4672 616d 6573 2920 746f 2045 6d70  taFrames) to Emp
-0004ca10: 6f77 6572 2727 270d 0a20 2020 2070 6173  ower'''..    pas
-0004ca20: 730d 0a0d 0a63 6c61 7373 2043 6f6e 7374  s....class Const
-0004ca30: 616e 7428 5461 626c 6545 6d70 6f77 6572  ant(TableEmpower
-0004ca40: 4d61 7070 6572 293a 0d0a 2020 2020 2727  Mapper):..    ''
-0004ca50: 274f 626a 6563 7420 666f 7220 666f 7220  'Object for for 
-0004ca60: 7573 6520 7769 7468 2060 4c6f 6164 6572  use with `Loader
-0004ca70: 6073 2c20 6465 7369 676e 6564 2074 6f20  `s, designed to 
-0004ca80: 6164 6420 6120 636f 6c75 6d6e 2074 6f20  add a column to 
-0004ca90: 6120 7061 6e64 6173 2044 6174 6146 7261  a pandas DataFra
-0004caa0: 6d65 2063 6f6e 7461 696e 696e 6720 6120  me containing a 
-0004cab0: 7369 6e67 6c65 2070 6879 7369 6361 6c20  single physical 
-0004cac0: 6964 656e 7469 6669 6572 2066 6f72 2074  identifier for t
-0004cad0: 6865 2073 696e 676c 6520 456d 706f 7765  he single Empowe
-0004cae0: 7220 456c 656d 656e 7420 7765 2077 616e  r Element we wan
-0004caf0: 7420 746f 206c 6f61 6420 6167 6169 6e73  t to load agains
-0004cb00: 742e 2727 270d 0a0d 0a20 2020 2064 6566  t.'''....    def
-0004cb10: 205f 5f69 6e69 745f 5f28 7365 6c66 2c63   __init__(self,c
-0004cb20: 6f6e 7374 616e 743d 4e6f 6e65 293a 0d0a  onstant=None):..
-0004cb30: 2020 2020 2020 2020 2727 274f 626a 6563          '''Objec
-0004cb40: 7420 666f 7220 7573 6520 7769 7468 2060  t for use with `
-0004cb50: 4c6f 6164 6572 6073 2c66 6f72 2065 6173  Loader`s,for eas
-0004cb60: 696c 7920 6164 6469 6e67 2074 6865 2070  ily adding the p
-0004cb70: 6879 7369 6361 6c20 6964 656e 7469 6669  hysical identifi
-0004cb80: 6572 206f 6620 6120 636f 6e73 7461 6e74  er of a constant
-0004cb90: 2065 6c65 6d65 6e74 2074 6f20 7468 6520   element to the 
-0004cba0: 6461 7461 6672 616d 650d 0a0d 0a20 2020  dataframe....   
-0004cbb0: 2020 2020 203a 7061 7261 6d20 636f 6e73       :param cons
-0004cbc0: 7461 6e74 3a20 4120 7374 7269 6e67 2063  tant: A string c
-0004cbd0: 6f6e 7461 696e 696e 6720 7468 6520 7368  ontaining the sh
-0004cbe0: 6f72 7463 6f64 6520 6f66 2074 6865 2045  ortcode of the E
-0004cbf0: 6d70 6f77 6572 2045 6c65 6d65 6e74 2077  mpower Element w
-0004cc00: 6520 7761 6e74 2074 6f20 6c6f 6164 2061  e want to load a
-0004cc10: 6761 696e 7374 0d0a 2020 2020 2020 2020  gainst..        
-0004cc20: 2727 270d 0a20 2020 2020 2020 2073 656c  '''..        sel
-0004cc30: 662e 636f 6e73 7461 6e74 203d 2063 6f6e  f.constant = con
-0004cc40: 7374 616e 740d 0a0d 0a20 2020 2020 2020  stant....       
-0004cc50: 2023 6966 2074 6865 2063 6f6e 7374 616e   #if the constan
-0004cc60: 7420 6973 2061 2073 7472 696e 6720 2d20  t is a string - 
-0004cc70: 6974 2069 7320 6120 7368 6f72 746e 616d  it is a shortnam
-0004cc80: 650d 0a20 2020 2020 2020 2023 6966 2074  e..        #if t
-0004cc90: 6865 2063 6f6e 7374 616e 7420 6973 2061  he constant is a
-0004cca0: 6e20 696e 7420 2d20 6974 2069 7320 6120  n int - it is a 
-0004ccb0: 7068 7973 6964 0d0a 0d0a 2020 2020 6465  physid....    de
-0004ccc0: 6620 6d61 705f 6461 7461 6672 616d 6528  f map_dataframe(
-0004ccd0: 7365 6c66 2c64 6174 6166 7261 6d65 2c64  self,dataframe,d
-0004cce0: 696d 656e 7369 6f6e 2c6c 6f61 6465 7229  imension,loader)
-0004ccf0: 3a0d 0a20 2020 2020 2020 2027 2727 5472  :..        '''Tr
-0004cd00: 616e 7366 6f72 6d20 6120 7061 6e64 6173  ansform a pandas
-0004cd10: 2044 6174 6146 7261 6d65 2c20 6164 6469   DataFrame, addi
-0004cd20: 6e67 2069 6e20 6120 636f 6c75 6d6e 2063  ng in a column c
-0004cd30: 6f6e 7461 696e 696e 6720 616e 2045 6d70  ontaining an Emp
-0004cd40: 6f77 6572 2045 6c65 6d65 6e74 2070 6879  ower Element phy
-0004cd50: 7369 6420 2870 6879 7369 6361 6c20 6964  sid (physical id
-0004cd60: 656e 7469 6669 6572 2920 7468 6174 2063  entifier) that c
-0004cd70: 616e 2062 6520 7573 6564 2069 6e20 616e  an be used in an
-0004cd80: 2045 6d70 6f77 6572 2062 756c 6b20 6c6f   Empower bulk lo
-0004cd90: 6164 2070 726f 6365 7373 2e0d 0a0d 0a20  ad process..... 
-0004cda0: 2020 2020 2020 2052 6574 7572 6e73 2061         Returns a
-0004cdb0: 206c 6973 7420 6f66 2074 6865 206e 616d   list of the nam
-0004cdc0: 6573 206f 6620 7468 6520 636f 6c75 6d6e  es of the column
-0004cdd0: 7320 7468 6174 2068 6176 6520 6265 656e  s that have been
-0004cde0: 2063 7265 6174 6564 2062 7920 7468 6520   created by the 
-0004cdf0: 6d61 7070 696e 6720 7072 6f63 6573 732e  mapping process.
-0004ce00: 0d0a 0d0a 2020 2020 2020 2020 3a70 6172  ....        :par
-0004ce10: 616d 2064 6174 6166 7261 6d65 3a20 5468  am dataframe: Th
-0004ce20: 6520 7061 6e64 6173 2064 6174 6166 7261  e pandas datafra
-0004ce30: 6d65 2062 6569 6e67 2074 7261 6e73 666f  me being transfo
-0004ce40: 726d 6564 2e0d 0a20 2020 2020 2020 203a  rmed...        :
-0004ce50: 7061 7261 6d20 6469 6d65 6e73 696f 6e3a  param dimension:
-0004ce60: 2044 696d 656e 7369 6f6e 2062 6569 6e67   Dimension being
-0004ce70: 206d 6170 7065 642e 2053 696e 6365 2077   mapped. Since w
-0004ce80: 6520 6f6e 6c79 206b 6e6f 7720 7468 6520  e only know the 
-0004ce90: 7368 6f72 746e 616d 6520 6265 696e 6720  shortname being 
-0004cea0: 6d61 7070 6564 2077 6520 6e65 6564 2074  mapped we need t
-0004ceb0: 6865 2064 696d 656e 7369 6f6e 2074 6f20  he dimension to 
-0004cec0: 7472 616e 736c 6174 6520 7468 6520 7374  translate the st
-0004ced0: 7269 6e67 2076 616c 7565 0d0a 2020 2020  ring value..    
-0004cee0: 2020 2020 3a70 6172 616d 206c 6f61 6465      :param loade
-0004cef0: 723a 2044 6570 7265 6361 7465 640d 0a20  r: Deprecated.. 
-0004cf00: 2020 2020 2020 2027 2727 0d0a 0d0a 2020         '''....  
-0004cf10: 2020 2020 2020 636f 6c75 6d6e 5f6e 616d        column_nam
-0004cf20: 653d 2764 696d 656e 7369 6f6e 5f27 2b73  e='dimension_'+s
-0004cf30: 7472 2864 696d 656e 7369 6f6e 2e69 6e64  tr(dimension.ind
-0004cf40: 6578 292b 275f 7068 7973 6964 270d 0a0d  ex)+'_physid'...
-0004cf50: 0a20 2020 2020 2020 2063 6f6e 7374 616e  .        constan
-0004cf60: 745f 6973 5f73 7472 696e 673d 4661 6c73  t_is_string=Fals
-0004cf70: 650d 0a20 2020 2020 2020 2074 7279 3a0d  e..        try:.
-0004cf80: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0004cf90: 662e 636f 6e73 7461 6e74 203d 2073 656c  f.constant = sel
-0004cfa0: 662e 636f 6e73 7461 6e74 2b27 270d 0a20  f.constant+''.. 
-0004cfb0: 2020 2020 2020 2020 2020 2023 6c6f 6f6b             #look
-0004cfc0: 7320 6c69 6b65 2074 6865 2063 6f6e 7374  s like the const
-0004cfd0: 616e 7420 6973 2061 2073 7472 696e 6720  ant is a string 
-0004cfe0: 2d20 6173 7375 6d65 2069 7420 6973 2061  - assume it is a
-0004cff0: 2073 686f 7274 6e61 6d65 0d0a 2020 2020   shortname..    
-0004d000: 2020 2020 2020 2020 636f 6e73 7461 6e74          constant
-0004d010: 5f69 735f 7374 7269 6e67 3d54 7275 650d  _is_string=True.
-0004d020: 0a0d 0a20 2020 2020 2020 2065 7863 6570  ...        excep
-0004d030: 7420 5479 7065 4572 726f 723a 0d0a 2020  t TypeError:..  
-0004d040: 2020 2020 2020 2020 2020 2361 7373 756d            #assum
-0004d050: 6520 636f 6e73 7461 6e74 2069 7320 616e  e constant is an
-0004d060: 2069 6e74 6567 6572 0d0a 2020 2020 2020   integer..      
-0004d070: 2020 2020 2020 7061 7373 0d0a 0d0a 2020        pass....  
-0004d080: 2020 2020 2020 6966 2063 6f6e 7374 616e        if constan
-0004d090: 745f 6973 5f73 7472 696e 673a 0d0a 2020  t_is_string:..  
-0004d0a0: 2020 2020 2020 2020 2020 7068 7973 6964            physid
-0004d0b0: 3d64 696d 656e 7369 6f6e 2e65 6c65 6d65  =dimension.eleme
-0004d0c0: 6e74 735b 7365 6c66 2e63 6f6e 7374 616e  nts[self.constan
-0004d0d0: 745d 2e70 6879 7369 640d 0a20 2020 2020  t].physid..     
-0004d0e0: 2020 2020 2020 206c 6f67 2e76 6572 626f         log.verbo
-0004d0f0: 7365 2827 4d61 7070 696e 6720 636f 6e73  se('Mapping cons
-0004d100: 7461 6e74 2027 2b73 7472 2873 656c 662e  tant '+str(self.
-0004d110: 636f 6e73 7461 6e74 292b 2720 746f 2027  constant)+' to '
-0004d120: 2b73 7472 2870 6879 7369 6429 2b27 2066  +str(physid)+' f
-0004d130: 6f72 2063 6f6c 756d 6e20 5b27 2b73 7472  or column ['+str
-0004d140: 2863 6f6c 756d 6e5f 6e61 6d65 292b 275d  (column_name)+']
-0004d150: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
-0004d160: 6461 7461 6672 616d 655b 636f 6c75 6d6e  dataframe[column
-0004d170: 5f6e 616d 655d 203d 2070 6879 7369 640d  _name] = physid.
-0004d180: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0004d190: 2020 2020 2020 2020 2020 2020 2341 6464              #Add
-0004d1a0: 2061 7320 6120 7068 7973 6964 0d0a 2020   as a physid..  
-0004d1b0: 2020 2020 2020 2020 2020 6c6f 672e 7665            log.ve
-0004d1c0: 7262 6f73 6528 2753 6574 7469 6e67 2063  rbose('Setting c
-0004d1d0: 6f6e 7374 616e 7420 746f 2027 2b73 7472  onstant to '+str
-0004d1e0: 2873 656c 662e 636f 6e73 7461 6e74 292b  (self.constant)+
-0004d1f0: 2720 666f 7220 636f 6c75 6d6e 205b 272b  ' for column ['+
-0004d200: 7374 7228 636f 6c75 6d6e 5f6e 616d 6529  str(column_name)
-0004d210: 2b27 5d27 290d 0a20 2020 2020 2020 2020  +']')..         
-0004d220: 2020 2064 6174 6166 7261 6d65 5b63 6f6c     dataframe[col
-0004d230: 756d 6e5f 6e61 6d65 5d20 3d20 7365 6c66  umn_name] = self
-0004d240: 2e63 6f6e 7374 616e 740d 0a0d 0a20 2020  .constant....   
-0004d250: 2020 2020 2023 7265 7475 726e 2074 6865       #return the
-0004d260: 2063 6f6c 756d 6e73 2063 7265 6174 6564   columns created
-0004d270: 2069 6e20 7468 6520 6d61 7070 696e 6720   in the mapping 
-0004d280: 2d20 692e 652e 2074 6865 206f 6e65 7320  - i.e. the ones 
-0004d290: 7468 6174 2077 696c 6c20 6265 2075 7365  that will be use
-0004d2a0: 6420 696e 2074 6865 2065 7870 6c6f 7369  d in the explosi
-0004d2b0: 6f6e 0d0a 2020 2020 2020 2020 7265 7475  on..        retu
-0004d2c0: 726e 205b 636f 6c75 6d6e 5f6e 616d 655d  rn [column_name]
-0004d2d0: 0d0a 0d0a 636c 6173 7320 5374 7275 6374  ....class Struct
-0004d2e0: 7572 654d 6170 7065 7228 5461 626c 6545  ureMapper(TableE
-0004d2f0: 6d70 6f77 6572 4d61 7070 6572 293a 0d0a  mpowerMapper):..
-0004d300: 2020 2020 2727 274f 626a 6563 7420 666f      '''Object fo
-0004d310: 7220 7573 6520 7769 7468 2060 4c6f 6164  r use with `Load
-0004d320: 6572 6073 2c66 6f72 2065 6173 696c 7920  er`s,for easily 
-0004d330: 6d61 7070 696e 6720 616e 6420 6167 6772  mapping and aggr
-0004d340: 6567 6174 696e 6720 7570 2073 7472 7563  egating up struc
-0004d350: 7475 7265 7327 2727 0d0a 0d0a 2020 2020  tures'''....    
-0004d360: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-0004d370: 662c 7368 6f72 746e 616d 655f 636f 6c75  f,shortname_colu
-0004d380: 6d6e 3d4e 6f6e 652c 7375 6274 7265 653d  mn=None,subtree=
-0004d390: 4e6f 6e65 2c6c 6f6e 676e 616d 655f 636f  None,longname_co
-0004d3a0: 6c75 6d6e 3d4e 6f6e 652c 6669 656c 645f  lumn=None,field_
-0004d3b0: 7368 6f72 746e 616d 653d 4e6f 6e65 2c66  shortname=None,f
-0004d3c0: 6965 6c64 5f63 6f6c 756d 6e3d 4e6f 6e65  ield_column=None
-0004d3d0: 2c70 6174 683d 4e6f 6e65 293a 0d0a 2020  ,path=None):..  
-0004d3e0: 2020 2020 2020 2727 274f 626a 6563 7420        '''Object 
-0004d3f0: 666f 7220 7573 6520 7769 7468 2060 4c6f  for use with `Lo
-0004d400: 6164 6572 6073 2c66 6f72 2065 6173 696c  ader`s,for easil
-0004d410: 7920 6d61 7070 696e 6720 616e 6420 6167  y mapping and ag
-0004d420: 6772 6567 6174 696e 6720 7570 2073 7472  gregating up str
-0004d430: 7563 7475 7265 730d 0a20 2020 2020 2020  uctures..       
-0004d440: 2041 2063 6f6c 756d 6e20 7769 6c6c 2062   A column will b
-0004d450: 6520 6164 6465 6420 666f 7220 6561 6368  e added for each
-0004d460: 206c 6576 656c 206f 6620 6869 6572 6172   level of hierar
-0004d470: 6368 7920 6672 6f6d 2074 6865 206c 6561  chy from the lea
-0004d480: 6620 746f 2074 6865 2053 7472 7563 7475  f to the Structu
-0004d490: 7265 456c 656d 656e 7420 7370 6563 6966  reElement specif
-0004d4a0: 6965 6420 696e 2074 6865 2063 6f6e 7374  ied in the const
-0004d4b0: 7275 6374 6f72 2028 692e 652e 2074 6865  ructor (i.e. the
-0004d4c0: 205f 5f69 6e69 745f 5f20 6d65 7468 6f64   __init__ method
-0004d4d0: 290d 0a0d 0a20 2020 2020 2020 204d 6170  )....        Map
-0004d4e0: 7320 6120 4461 7461 4672 616d 6520 636f  s a DataFrame co
-0004d4f0: 6c75 6d6e 2068 6f6c 6469 6e67 2065 6974  lumn holding eit
-0004d500: 6865 722c 2073 686f 7274 6e61 6d65 2c20  her, shortname, 
-0004d510: 6c6f 6e67 6e61 6d65 206f 7220 6669 656c  longname or fiel
-0004d520: 6420 7661 6c75 6520 666f 7220 6c65 6166  d value for leaf
-0004d530: 206c 6576 656c 2074 7261 6e73 6c61 7469   level translati
-0004d540: 6f6e 0d0a 2020 2020 2020 2020 2a2a 4f6e  on..        **On
-0004d550: 6c79 206f 6e65 2a2a 206f 6620 7368 6f72  ly one** of shor
-0004d560: 746e 616d 655f 636f 6c75 6d6e 2c20 6c6f  tname_column, lo
-0004d570: 6e67 6e61 6d65 5f63 6f6c 756d 6e20 6f72  ngname_column or
-0004d580: 2061 2063 6f6d 6269 6e61 7469 6f6e 206f   a combination o
-0004d590: 6620 6669 656c 645f 636f 6c75 6d6e 2061  f field_column a
-0004d5a0: 6e64 2066 6965 6c64 5f73 686f 7274 6e61  nd field_shortna
-0004d5b0: 6d65 206e 6565 6473 2074 6f20 6265 2073  me needs to be s
-0004d5c0: 7570 706c 6965 640d 0a0d 0a20 2020 2020  upplied....     
-0004d5d0: 2020 203a 7061 7261 6d20 7368 6f72 746e     :param shortn
-0004d5e0: 616d 655f 636f 6c75 6d6e 3a20 5468 6520  ame_column: The 
-0004d5f0: 636f 6c75 6d6e 2028 7365 7269 6573 2920  column (series) 
-0004d600: 696e 2074 6865 2070 616e 6461 7320 4461  in the pandas Da
-0004d610: 7461 4672 616d 6520 7468 6174 2077 696c  taFrame that wil
-0004d620: 6c20 6265 206d 6170 7065 6420 7768 6963  l be mapped whic
-0004d630: 6820 686f 6c64 7320 7468 6520 6c65 6166  h holds the leaf
-0004d640: 2073 686f 7274 6e61 6d65 0d0a 2020 2020   shortname..    
-0004d650: 2020 2020 3a70 6172 616d 206c 6f6e 676e      :param longn
-0004d660: 616d 655f 636f 6c75 6d6e 3a20 2054 6865  ame_column:  The
-0004d670: 2063 6f6c 756d 6e20 2873 6572 6965 7329   column (series)
-0004d680: 2069 6e20 7468 6520 7061 6e64 6173 2044   in the pandas D
-0004d690: 6174 6146 7261 6d65 2074 6861 7420 7769  ataFrame that wi
-0004d6a0: 6c6c 2062 6520 6d61 7070 6564 2020 7768  ll be mapped  wh
-0004d6b0: 6963 6820 686f 6c64 7320 7468 6520 6c65  ich holds the le
-0004d6c0: 6166 206c 6f6e 676e 616d 650d 0a20 2020  af longname..   
-0004d6d0: 2020 2020 203a 7061 7261 6d20 6669 656c       :param fiel
-0004d6e0: 645f 636f 6c75 6d6e 3a20 2020 2020 5468  d_column:     Th
-0004d6f0: 6520 636f 6c75 6d6e 2028 7365 7269 6573  e column (series
-0004d700: 2920 696e 2074 6865 2070 616e 6461 7320  ) in the pandas 
-0004d710: 4461 7461 4672 616d 6520 7468 6174 2077  DataFrame that w
-0004d720: 696c 6c20 6265 206d 6170 7065 6420 2077  ill be mapped  w
-0004d730: 6869 6368 2068 6f6c 6473 2074 6865 206c  hich holds the l
-0004d740: 6561 6620 6669 656c 640d 0a20 2020 2020  eaf field..     
-0004d750: 2020 203a 7061 7261 6d20 6669 656c 645f     :param field_
-0004d760: 7368 6f72 746e 616d 653a 2020 5468 6520  shortname:  The 
-0004d770: 7368 6f72 746e 616d 6520 6f66 2074 6865  shortname of the
-0004d780: 2064 696d 656e 7369 6f6e 2066 6965 6c64   dimension field
-0004d790: 2068 6f6c 6469 6e67 2074 6865 2074 7261   holding the tra
-0004d7a0: 6e73 6c61 7469 6f6e 0d0a 2020 2020 2020  nslation..      
-0004d7b0: 2020 3a70 6172 616d 2073 7562 7472 6565    :param subtree
-0004d7c0: 3a20 2020 2020 2020 2020 2061 2074 7570  :          a tup
-0004d7d0: 6c65 206f 6620 2873 7472 7563 7475 7265  le of (structure
-0004d7e0: 2073 686f 7274 6e61 6d65 2c20 726f 6f74   shortname, root
-0004d7f0: 2065 6c65 6d65 6e74 2073 686f 7274 6e61   element shortna
-0004d800: 6d65 2c73 7562 7472 6565 2072 6f6f 7420  me,subtree root 
-0004d810: 7368 6f72 746e 616d 6529 2e20 5573 6564  shortname). Used
-0004d820: 2066 6f72 2065 7870 6c6f 6469 6e67 2064   for exploding d
-0004d830: 6174 6120 7570 2061 2073 7472 7563 7475  ata up a structu
-0004d840: 7265 2068 6965 7261 7263 6879 2e20 466f  re hierarchy. Fo
-0004d850: 7220 6261 636b 7761 7264 2063 6f6d 7061  r backward compa
-0004d860: 7469 6269 6c69 7479 206f 6e6c 792e 2055  tibility only. U
-0004d870: 7365 2070 6174 6820 696e 7374 6561 642e  se path instead.
-0004d880: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0004d890: 2070 6174 683a 2020 2020 2020 2020 2020   path:          
-0004d8a0: 2020 2070 6174 6820 746f 2061 2053 7472     path to a Str
-0004d8b0: 7563 7475 7265 456c 656d 656e 7420 652e  uctureElement e.
-0004d8c0: 672e 2027 4d79 5374 7275 6374 2e48 6965  g. 'MyStruct.Hie
-0004d8d0: 722f 456c 656d 6e31 2f45 6c65 6d65 6e32  r/Elemn1/Elemen2
-0004d8e0: 2720 2d20 416e 2061 6c74 6572 6e61 7469  ' - An alternati
-0004d8f0: 7665 2074 6f20 7468 6520 7375 6274 7265  ve to the subtre
-0004d900: 6520 7061 7261 6d65 7465 720d 0a20 2020  e parameter..   
-0004d910: 2020 2020 2027 2727 0d0a 2020 2020 2020       '''..      
-0004d920: 2020 7365 6c66 2e73 7562 7472 6565 2020    self.subtree  
-0004d930: 2020 2020 2020 2020 3d20 7375 6274 7265          = subtre
-0004d940: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0004d950: 7061 7468 2020 2020 2020 2020 2020 2020  path            
-0004d960: 203d 2070 6174 680d 0a20 2020 2020 2020   = path..       
-0004d970: 2023 0d0a 0d0a 2020 2020 2020 2020 7365   #....        se
-0004d980: 6c66 2e66 6965 6c64 5f73 686f 7274 6e61  lf.field_shortna
-0004d990: 6d65 2020 3d20 6669 656c 645f 7368 6f72  me  = field_shor
-0004d9a0: 746e 616d 650d 0a0d 0a20 2020 2020 2020  tname....       
-0004d9b0: 2069 6620 7368 6f72 746e 616d 655f 636f   if shortname_co
-0004d9c0: 6c75 6d6e 3a0d 0a20 2020 2020 2020 2020  lumn:..         
-0004d9d0: 2020 2073 656c 662e 636f 6c75 6d6e 5f74     self.column_t
-0004d9e0: 7970 6520 3d20 2773 686f 7274 6e61 6d65  ype = 'shortname
-0004d9f0: 270d 0a20 2020 2020 2020 2020 2020 2073  '..            s
-0004da00: 656c 662e 636f 6c75 6d6e 5f6e 616d 6520  elf.column_name 
-0004da10: 3d20 7368 6f72 746e 616d 655f 636f 6c75  = shortname_colu
-0004da20: 6d6e 0d0a 2020 2020 2020 2020 656c 6966  mn..        elif
-0004da30: 206c 6f6e 676e 616d 655f 636f 6c75 6d6e   longname_column
-0004da40: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
-0004da50: 656c 662e 636f 6c75 6d6e 5f74 7970 6520  elf.column_type 
-0004da60: 3d20 276c 6f6e 676e 616d 6527 0d0a 2020  = 'longname'..  
-0004da70: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
-0004da80: 6f6c 756d 6e5f 6e61 6d65 203d 206c 6f6e  olumn_name = lon
-0004da90: 676e 616d 655f 636f 6c75 6d6e 0d0a 2020  gname_column..  
-0004daa0: 2020 2020 2020 656c 6966 2066 6965 6c64        elif field
-0004dab0: 5f63 6f6c 756d 6e3a 0d0a 2020 2020 2020  _column:..      
-0004dac0: 2020 2020 2020 7365 6c66 2e63 6f6c 756d        self.colum
-0004dad0: 6e5f 7479 7065 203d 2027 6669 656c 6427  n_type = 'field'
-0004dae0: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0004daf0: 6c66 2e63 6f6c 756d 6e5f 6e61 6d65 203d  lf.column_name =
-0004db00: 2066 6965 6c64 5f63 6f6c 756d 6e0d 0a20   field_column.. 
-0004db10: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0004db20: 6c66 2e66 6965 6c64 5f73 686f 7274 6e61  lf.field_shortna
-0004db30: 6d65 2069 7320 4e6f 6e65 3a0d 0a20 2020  me is None:..   
-0004db40: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0004db50: 7365 2056 616c 7565 4572 726f 7228 2757  se ValueError('W
-0004db60: 6865 6e20 6120 5374 7275 6374 7572 654d  hen a StructureM
-0004db70: 6170 7065 7220 6973 2069 6e69 7469 616c  apper is initial
-0004db80: 6973 6564 2077 6974 6820 6120 6669 656c  ised with a fiel
-0004db90: 645f 636f 6c75 6d6e 2c20 6120 6669 656c  d_column, a fiel
-0004dba0: 645f 7368 6f72 746e 616d 6520 6d75 7374  d_shortname must
-0004dbb0: 2061 6c73 6f20 6265 2070 7265 7365 6e74   also be present
-0004dbc0: 2729 0d0a 0d0a 2020 2020 6465 6620 6d61  ')....    def ma
-0004dbd0: 705f 6461 7461 6672 616d 6528 7365 6c66  p_dataframe(self
-0004dbe0: 2c64 6174 6166 7261 6d65 2c64 696d 656e  ,dataframe,dimen
-0004dbf0: 7369 6f6e 2c6c 6f61 6465 7229 3a0d 0a20  sion,loader):.. 
-0004dc00: 2020 2020 2020 2027 2727 5472 616e 7366         '''Transf
-0004dc10: 6f72 6d20 6120 7061 6e64 6173 2044 6174  orm a pandas Dat
-0004dc20: 6146 7261 6d65 2c20 6164 6469 6e67 2069  aFrame, adding i
-0004dc30: 6e20 6120 636f 6c75 6d6e 2063 6f6e 7461  n a column conta
-0004dc40: 696e 696e 6720 456d 706f 7765 7220 456c  ining Empower El
-0004dc50: 656d 656e 7420 7068 7973 6964 7320 2870  ement physids (p
-0004dc60: 6879 7369 6361 6c20 6964 656e 7469 6669  hysical identifi
-0004dc70: 6572 7329 2074 6861 7420 6361 6e20 6265  ers) that can be
-0004dc80: 2075 7365 6420 696e 2061 6e20 456d 706f   used in an Empo
-0004dc90: 7765 7220 6275 6c6b 206c 6f61 6420 7072  wer bulk load pr
-0004dca0: 6f63 6573 732e 0d0a 2020 2020 2020 2020  ocess...        
-0004dcb0: 4120 636f 6c75 6d6e 2077 696c 6c20 6265  A column will be
-0004dcc0: 2061 6464 6564 2066 6f72 2065 6163 6820   added for each 
-0004dcd0: 6c65 7665 6c20 6f66 2068 6965 7261 7263  level of hierarc
-0004dce0: 6879 2066 726f 6d20 7468 6520 6c65 6166  hy from the leaf
-0004dcf0: 2074 6f20 7468 6520 5374 7275 6374 7572   to the Structur
-0004dd00: 6545 6c65 6d65 6e74 2073 7065 6369 6669  eElement specifi
-0004dd10: 6564 2069 6e20 7468 6520 636f 6e73 7472  ed in the constr
-0004dd20: 7563 746f 7220 2869 2e65 2e20 7468 6520  uctor (i.e. the 
-0004dd30: 5f5f 696e 6974 5f5f 206d 6574 686f 6429  __init__ method)
-0004dd40: 0d0a 0d0a 2020 2020 2020 2020 5265 7475  ....        Retu
-0004dd50: 726e 7320 6120 6c69 7374 206f 6620 7468  rns a list of th
-0004dd60: 6520 6e61 6d65 7320 6f66 2074 6865 2063  e names of the c
-0004dd70: 6f6c 756d 6e73 2074 6861 7420 6861 7665  olumns that have
-0004dd80: 2062 6565 6e20 6372 6561 7465 6420 6279   been created by
-0004dd90: 2074 6865 206d 6170 7069 6e67 2070 726f   the mapping pro
-0004dda0: 6365 7373 2e0d 0a0d 0a20 2020 2020 2020  cess.....       
-0004ddb0: 203a 7061 7261 6d20 6461 7461 6672 616d   :param datafram
-0004ddc0: 653a 2054 6865 2070 616e 6461 7320 6461  e: The pandas da
-0004ddd0: 7461 6672 616d 6520 6265 696e 6720 7472  taframe being tr
-0004dde0: 616e 7366 6f72 6d65 642e 0d0a 2020 2020  ansformed...    
-0004ddf0: 2020 2020 3a70 6172 616d 2064 696d 656e      :param dimen
-0004de00: 7369 6f6e 3a20 4469 6d65 6e73 696f 6e20  sion: Dimension 
-0004de10: 6265 696e 6720 6d61 7070 6564 2e20 5369  being mapped. Si
-0004de20: 6e63 6520 7765 206f 6e6c 7920 6b6e 6f77  nce we only know
-0004de30: 2074 6865 2073 686f 7274 6e61 6d65 2c20   the shortname, 
-0004de40: 6c6f 6e67 6e61 6d65 206f 7220 6669 656c  longname or fiel
-0004de50: 6420 6265 696e 6720 6d61 7070 6564 2077  d being mapped w
-0004de60: 6520 6e65 6564 2074 6865 2064 696d 656e  e need the dimen
-0004de70: 7369 6f6e 2074 6f20 7472 616e 736c 6174  sion to translat
-0004de80: 6520 7468 6520 7374 7269 6e67 2076 616c  e the string val
-0004de90: 7565 730d 0a20 2020 2020 2020 203a 7061  ues..        :pa
-0004dea0: 7261 6d20 6c6f 6164 6572 3a20 4465 7072  ram loader: Depr
-0004deb0: 6563 6174 6564 0d0a 2020 2020 2020 2020  ecated..        
-0004dec0: 2727 270d 0a0d 0a20 2020 2020 2020 2023  '''....        #
-0004ded0: 544f 446f 202d 2077 6f72 6b20 6f75 7420  TODo - work out 
-0004dee0: 7468 6520 6163 7475 616c 2063 6f6c 756d  the actual colum
-0004def0: 6e20 7479 7065 202d 2061 7373 756d 6520  n type - assume 
-0004df00: 696e 7420 3d20 7068 7973 6964 2c20 6173  int = physid, as
-0004df10: 7375 6d65 2073 7472 696e 6720 3d20 7368  sume string = sh
-0004df20: 6f72 746e 616d 650d 0a0d 0a20 2020 2020  ortname....     
-0004df30: 2020 206c 6f67 2e76 6572 626f 7365 2827     log.verbose('
-0004df40: 4d61 7070 696e 6720 636f 6c75 6d6e 2027  Mapping column '
-0004df50: 2b73 7472 2873 656c 662e 636f 6c75 6d6e  +str(self.column
-0004df60: 5f6e 616d 6529 2b27 2074 6f20 7374 7275  _name)+' to stru
-0004df70: 6374 7572 6520 5b27 2b73 7472 2873 656c  cture ['+str(sel
-0004df80: 662e 7375 6274 7265 6520 6966 2073 656c  f.subtree if sel
-0004df90: 662e 7375 6274 7265 6520 656c 7365 2073  f.subtree else s
-0004dfa0: 656c 662e 7061 7468 292b 275d 2729 0d0a  elf.path)+']')..
-0004dfb0: 0d0a 2020 2020 2020 2020 7472 616e 736c  ..        transl
-0004dfc0: 6174 696f 6e5f 6466 2020 203d 205f 6765  ation_df   = _ge
-0004dfd0: 745f 6c65 6166 5f74 7261 6e73 6c61 7469  t_leaf_translati
-0004dfe0: 6f6e 5f64 665f 6672 6f6d 5f74 7570 6c65  on_df_from_tuple
-0004dff0: 2864 696d 656e 7369 6f6e 2020 2020 2020  (dimension      
-0004e000: 2020 2020 3d20 6469 6d65 6e73 696f 6e0d      = dimension.
-0004e010: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e040: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-0004e050: 7374 7275 6374 7572 655f 7475 706c 6520  structure_tuple 
-0004e060: 2020 203d 2073 656c 662e 7375 6274 7265     = self.subtre
-0004e070: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0004e080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004c990: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0004c9a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0004c9b0: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
+0004c9c0: 0d0a 0d0a 0d0a 636c 6173 7320 5461 626c  ......class Tabl
+0004c9d0: 6545 6d70 6f77 6572 4d61 7070 6572 286f  eEmpowerMapper(o
+0004c9e0: 626a 6563 7429 3a0d 0a20 2020 2027 2727  bject):..    '''
+0004c9f0: 4261 7365 2063 6c61 7373 2066 6f72 2063  Base class for c
+0004ca00: 6c61 7373 6573 206d 6170 7069 6e67 2074  lasses mapping t
+0004ca10: 6162 6c65 7320 2873 6f20 6661 7220 6f6e  ables (so far on
+0004ca20: 6c79 2070 616e 6461 7320 4461 7461 4672  ly pandas DataFr
+0004ca30: 616d 6573 2920 746f 2045 6d70 6f77 6572  ames) to Empower
+0004ca40: 2727 270d 0a20 2020 2070 6173 730d 0a0d  '''..    pass...
+0004ca50: 0a63 6c61 7373 2043 6f6e 7374 616e 7428  .class Constant(
+0004ca60: 5461 626c 6545 6d70 6f77 6572 4d61 7070  TableEmpowerMapp
+0004ca70: 6572 293a 0d0a 2020 2020 2727 274f 626a  er):..    '''Obj
+0004ca80: 6563 7420 666f 7220 666f 7220 7573 6520  ect for for use 
+0004ca90: 7769 7468 2060 4c6f 6164 6572 6073 2c20  with `Loader`s, 
+0004caa0: 6465 7369 676e 6564 2074 6f20 6164 6420  designed to add 
+0004cab0: 6120 636f 6c75 6d6e 2074 6f20 6120 7061  a column to a pa
+0004cac0: 6e64 6173 2044 6174 6146 7261 6d65 2063  ndas DataFrame c
+0004cad0: 6f6e 7461 696e 696e 6720 6120 7369 6e67  ontaining a sing
+0004cae0: 6c65 2070 6879 7369 6361 6c20 6964 656e  le physical iden
+0004caf0: 7469 6669 6572 2066 6f72 2074 6865 2073  tifier for the s
+0004cb00: 696e 676c 6520 456d 706f 7765 7220 456c  ingle Empower El
+0004cb10: 656d 656e 7420 7765 2077 616e 7420 746f  ement we want to
+0004cb20: 206c 6f61 6420 6167 6169 6e73 742e 2727   load against.''
+0004cb30: 270d 0a0d 0a20 2020 2064 6566 205f 5f69  '....    def __i
+0004cb40: 6e69 745f 5f28 7365 6c66 2c63 6f6e 7374  nit__(self,const
+0004cb50: 616e 743d 4e6f 6e65 293a 0d0a 2020 2020  ant=None):..    
+0004cb60: 2020 2020 2727 274f 626a 6563 7420 666f      '''Object fo
+0004cb70: 7220 7573 6520 7769 7468 2060 4c6f 6164  r use with `Load
+0004cb80: 6572 6073 2c66 6f72 2065 6173 696c 7920  er`s,for easily 
+0004cb90: 6164 6469 6e67 2074 6865 2070 6879 7369  adding the physi
+0004cba0: 6361 6c20 6964 656e 7469 6669 6572 206f  cal identifier o
+0004cbb0: 6620 6120 636f 6e73 7461 6e74 2065 6c65  f a constant ele
+0004cbc0: 6d65 6e74 2074 6f20 7468 6520 6461 7461  ment to the data
+0004cbd0: 6672 616d 650d 0a0d 0a20 2020 2020 2020  frame....       
+0004cbe0: 203a 7061 7261 6d20 636f 6e73 7461 6e74   :param constant
+0004cbf0: 3a20 4120 7374 7269 6e67 2063 6f6e 7461  : A string conta
+0004cc00: 696e 696e 6720 7468 6520 7368 6f72 7463  ining the shortc
+0004cc10: 6f64 6520 6f66 2074 6865 2045 6d70 6f77  ode of the Empow
+0004cc20: 6572 2045 6c65 6d65 6e74 2077 6520 7761  er Element we wa
+0004cc30: 6e74 2074 6f20 6c6f 6164 2061 6761 696e  nt to load again
+0004cc40: 7374 0d0a 2020 2020 2020 2020 2727 270d  st..        '''.
+0004cc50: 0a20 2020 2020 2020 2073 656c 662e 636f  .        self.co
+0004cc60: 6e73 7461 6e74 203d 2063 6f6e 7374 616e  nstant = constan
+0004cc70: 740d 0a0d 0a20 2020 2020 2020 2023 6966  t....        #if
+0004cc80: 2074 6865 2063 6f6e 7374 616e 7420 6973   the constant is
+0004cc90: 2061 2073 7472 696e 6720 2d20 6974 2069   a string - it i
+0004cca0: 7320 6120 7368 6f72 746e 616d 650d 0a20  s a shortname.. 
+0004ccb0: 2020 2020 2020 2023 6966 2074 6865 2063         #if the c
+0004ccc0: 6f6e 7374 616e 7420 6973 2061 6e20 696e  onstant is an in
+0004ccd0: 7420 2d20 6974 2069 7320 6120 7068 7973  t - it is a phys
+0004cce0: 6964 0d0a 0d0a 2020 2020 6465 6620 6d61  id....    def ma
+0004ccf0: 705f 6461 7461 6672 616d 6528 7365 6c66  p_dataframe(self
+0004cd00: 2c64 6174 6166 7261 6d65 2c64 696d 656e  ,dataframe,dimen
+0004cd10: 7369 6f6e 2c6c 6f61 6465 7229 3a0d 0a20  sion,loader):.. 
+0004cd20: 2020 2020 2020 2027 2727 5472 616e 7366         '''Transf
+0004cd30: 6f72 6d20 6120 7061 6e64 6173 2044 6174  orm a pandas Dat
+0004cd40: 6146 7261 6d65 2c20 6164 6469 6e67 2069  aFrame, adding i
+0004cd50: 6e20 6120 636f 6c75 6d6e 2063 6f6e 7461  n a column conta
+0004cd60: 696e 696e 6720 616e 2045 6d70 6f77 6572  ining an Empower
+0004cd70: 2045 6c65 6d65 6e74 2070 6879 7369 6420   Element physid 
+0004cd80: 2870 6879 7369 6361 6c20 6964 656e 7469  (physical identi
+0004cd90: 6669 6572 2920 7468 6174 2063 616e 2062  fier) that can b
+0004cda0: 6520 7573 6564 2069 6e20 616e 2045 6d70  e used in an Emp
+0004cdb0: 6f77 6572 2062 756c 6b20 6c6f 6164 2070  ower bulk load p
+0004cdc0: 726f 6365 7373 2e0d 0a0d 0a20 2020 2020  rocess.....     
+0004cdd0: 2020 2052 6574 7572 6e73 2061 206c 6973     Returns a lis
+0004cde0: 7420 6f66 2074 6865 206e 616d 6573 206f  t of the names o
+0004cdf0: 6620 7468 6520 636f 6c75 6d6e 7320 7468  f the columns th
+0004ce00: 6174 2068 6176 6520 6265 656e 2063 7265  at have been cre
+0004ce10: 6174 6564 2062 7920 7468 6520 6d61 7070  ated by the mapp
+0004ce20: 696e 6720 7072 6f63 6573 732e 0d0a 0d0a  ing process.....
+0004ce30: 2020 2020 2020 2020 3a70 6172 616d 2064          :param d
+0004ce40: 6174 6166 7261 6d65 3a20 5468 6520 7061  ataframe: The pa
+0004ce50: 6e64 6173 2064 6174 6166 7261 6d65 2062  ndas dataframe b
+0004ce60: 6569 6e67 2074 7261 6e73 666f 726d 6564  eing transformed
+0004ce70: 2e0d 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0004ce80: 6d20 6469 6d65 6e73 696f 6e3a 2044 696d  m dimension: Dim
+0004ce90: 656e 7369 6f6e 2062 6569 6e67 206d 6170  ension being map
+0004cea0: 7065 642e 2053 696e 6365 2077 6520 6f6e  ped. Since we on
+0004ceb0: 6c79 206b 6e6f 7720 7468 6520 7368 6f72  ly know the shor
+0004cec0: 746e 616d 6520 6265 696e 6720 6d61 7070  tname being mapp
+0004ced0: 6564 2077 6520 6e65 6564 2074 6865 2064  ed we need the d
+0004cee0: 696d 656e 7369 6f6e 2074 6f20 7472 616e  imension to tran
+0004cef0: 736c 6174 6520 7468 6520 7374 7269 6e67  slate the string
+0004cf00: 2076 616c 7565 0d0a 2020 2020 2020 2020   value..        
+0004cf10: 3a70 6172 616d 206c 6f61 6465 723a 2044  :param loader: D
+0004cf20: 6570 7265 6361 7465 640d 0a20 2020 2020  eprecated..     
+0004cf30: 2020 2027 2727 0d0a 0d0a 2020 2020 2020     '''....      
+0004cf40: 2020 636f 6c75 6d6e 5f6e 616d 653d 2764    column_name='d
+0004cf50: 696d 656e 7369 6f6e 5f27 2b73 7472 2864  imension_'+str(d
+0004cf60: 696d 656e 7369 6f6e 2e69 6e64 6578 292b  imension.index)+
+0004cf70: 275f 7068 7973 6964 270d 0a0d 0a20 2020  '_physid'....   
+0004cf80: 2020 2020 2063 6f6e 7374 616e 745f 6973       constant_is
+0004cf90: 5f73 7472 696e 673d 4661 6c73 650d 0a20  _string=False.. 
+0004cfa0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+0004cfb0: 2020 2020 2020 2020 2073 656c 662e 636f           self.co
+0004cfc0: 6e73 7461 6e74 203d 2073 656c 662e 636f  nstant = self.co
+0004cfd0: 6e73 7461 6e74 2b27 270d 0a20 2020 2020  nstant+''..     
+0004cfe0: 2020 2020 2020 2023 6c6f 6f6b 7320 6c69         #looks li
+0004cff0: 6b65 2074 6865 2063 6f6e 7374 616e 7420  ke the constant 
+0004d000: 6973 2061 2073 7472 696e 6720 2d20 6173  is a string - as
+0004d010: 7375 6d65 2069 7420 6973 2061 2073 686f  sume it is a sho
+0004d020: 7274 6e61 6d65 0d0a 2020 2020 2020 2020  rtname..        
+0004d030: 2020 2020 636f 6e73 7461 6e74 5f69 735f      constant_is_
+0004d040: 7374 7269 6e67 3d54 7275 650d 0a0d 0a20  string=True.... 
+0004d050: 2020 2020 2020 2065 7863 6570 7420 5479         except Ty
+0004d060: 7065 4572 726f 723a 0d0a 2020 2020 2020  peError:..      
+0004d070: 2020 2020 2020 2361 7373 756d 6520 636f        #assume co
+0004d080: 6e73 7461 6e74 2069 7320 616e 2069 6e74  nstant is an int
+0004d090: 6567 6572 0d0a 2020 2020 2020 2020 2020  eger..          
+0004d0a0: 2020 7061 7373 0d0a 0d0a 2020 2020 2020    pass....      
+0004d0b0: 2020 6966 2063 6f6e 7374 616e 745f 6973    if constant_is
+0004d0c0: 5f73 7472 696e 673a 0d0a 2020 2020 2020  _string:..      
+0004d0d0: 2020 2020 2020 7068 7973 6964 3d64 696d        physid=dim
+0004d0e0: 656e 7369 6f6e 2e65 6c65 6d65 6e74 735b  ension.elements[
+0004d0f0: 7365 6c66 2e63 6f6e 7374 616e 745d 2e70  self.constant].p
+0004d100: 6879 7369 640d 0a20 2020 2020 2020 2020  hysid..         
+0004d110: 2020 206c 6f67 2e76 6572 626f 7365 2827     log.verbose('
+0004d120: 4d61 7070 696e 6720 636f 6e73 7461 6e74  Mapping constant
+0004d130: 2027 2b73 7472 2873 656c 662e 636f 6e73   '+str(self.cons
+0004d140: 7461 6e74 292b 2720 746f 2027 2b73 7472  tant)+' to '+str
+0004d150: 2870 6879 7369 6429 2b27 2066 6f72 2063  (physid)+' for c
+0004d160: 6f6c 756d 6e20 5b27 2b73 7472 2863 6f6c  olumn ['+str(col
+0004d170: 756d 6e5f 6e61 6d65 292b 275d 2729 0d0a  umn_name)+']')..
+0004d180: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0004d190: 6672 616d 655b 636f 6c75 6d6e 5f6e 616d  frame[column_nam
+0004d1a0: 655d 203d 2070 6879 7369 640d 0a20 2020  e] = physid..   
+0004d1b0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0004d1c0: 2020 2020 2020 2020 2341 6464 2061 7320          #Add as 
+0004d1d0: 6120 7068 7973 6964 0d0a 2020 2020 2020  a physid..      
+0004d1e0: 2020 2020 2020 6c6f 672e 7665 7262 6f73        log.verbos
+0004d1f0: 6528 2753 6574 7469 6e67 2063 6f6e 7374  e('Setting const
+0004d200: 616e 7420 746f 2027 2b73 7472 2873 656c  ant to '+str(sel
+0004d210: 662e 636f 6e73 7461 6e74 292b 2720 666f  f.constant)+' fo
+0004d220: 7220 636f 6c75 6d6e 205b 272b 7374 7228  r column ['+str(
+0004d230: 636f 6c75 6d6e 5f6e 616d 6529 2b27 5d27  column_name)+']'
+0004d240: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
+0004d250: 6174 6166 7261 6d65 5b63 6f6c 756d 6e5f  ataframe[column_
+0004d260: 6e61 6d65 5d20 3d20 7365 6c66 2e63 6f6e  name] = self.con
+0004d270: 7374 616e 740d 0a0d 0a20 2020 2020 2020  stant....       
+0004d280: 2023 7265 7475 726e 2074 6865 2063 6f6c   #return the col
+0004d290: 756d 6e73 2063 7265 6174 6564 2069 6e20  umns created in 
+0004d2a0: 7468 6520 6d61 7070 696e 6720 2d20 692e  the mapping - i.
+0004d2b0: 652e 2074 6865 206f 6e65 7320 7468 6174  e. the ones that
+0004d2c0: 2077 696c 6c20 6265 2075 7365 6420 696e   will be used in
+0004d2d0: 2074 6865 2065 7870 6c6f 7369 6f6e 0d0a   the explosion..
+0004d2e0: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+0004d2f0: 636f 6c75 6d6e 5f6e 616d 655d 0d0a 0d0a  column_name]....
+0004d300: 636c 6173 7320 5374 7275 6374 7572 654d  class StructureM
+0004d310: 6170 7065 7228 5461 626c 6545 6d70 6f77  apper(TableEmpow
+0004d320: 6572 4d61 7070 6572 293a 0d0a 2020 2020  erMapper):..    
+0004d330: 2727 274f 626a 6563 7420 666f 7220 7573  '''Object for us
+0004d340: 6520 7769 7468 2060 4c6f 6164 6572 6073  e with `Loader`s
+0004d350: 2c66 6f72 2065 6173 696c 7920 6d61 7070  ,for easily mapp
+0004d360: 696e 6720 616e 6420 6167 6772 6567 6174  ing and aggregat
+0004d370: 696e 6720 7570 2073 7472 7563 7475 7265  ing up structure
+0004d380: 7327 2727 0d0a 0d0a 2020 2020 6465 6620  s'''....    def 
+0004d390: 5f5f 696e 6974 5f5f 2873 656c 662c 7368  __init__(self,sh
+0004d3a0: 6f72 746e 616d 655f 636f 6c75 6d6e 3d4e  ortname_column=N
+0004d3b0: 6f6e 652c 7375 6274 7265 653d 4e6f 6e65  one,subtree=None
+0004d3c0: 2c6c 6f6e 676e 616d 655f 636f 6c75 6d6e  ,longname_column
+0004d3d0: 3d4e 6f6e 652c 6669 656c 645f 7368 6f72  =None,field_shor
+0004d3e0: 746e 616d 653d 4e6f 6e65 2c66 6965 6c64  tname=None,field
+0004d3f0: 5f63 6f6c 756d 6e3d 4e6f 6e65 2c70 6174  _column=None,pat
+0004d400: 683d 4e6f 6e65 293a 0d0a 2020 2020 2020  h=None):..      
+0004d410: 2020 2727 274f 626a 6563 7420 666f 7220    '''Object for 
+0004d420: 7573 6520 7769 7468 2060 4c6f 6164 6572  use with `Loader
+0004d430: 6073 2c66 6f72 2065 6173 696c 7920 6d61  `s,for easily ma
+0004d440: 7070 696e 6720 616e 6420 6167 6772 6567  pping and aggreg
+0004d450: 6174 696e 6720 7570 2073 7472 7563 7475  ating up structu
+0004d460: 7265 730d 0a20 2020 2020 2020 2041 2063  res..        A c
+0004d470: 6f6c 756d 6e20 7769 6c6c 2062 6520 6164  olumn will be ad
+0004d480: 6465 6420 666f 7220 6561 6368 206c 6576  ded for each lev
+0004d490: 656c 206f 6620 6869 6572 6172 6368 7920  el of hierarchy 
+0004d4a0: 6672 6f6d 2074 6865 206c 6561 6620 746f  from the leaf to
+0004d4b0: 2074 6865 2053 7472 7563 7475 7265 456c   the StructureEl
+0004d4c0: 656d 656e 7420 7370 6563 6966 6965 6420  ement specified 
+0004d4d0: 696e 2074 6865 2063 6f6e 7374 7275 6374  in the construct
+0004d4e0: 6f72 2028 692e 652e 2074 6865 205f 5f69  or (i.e. the __i
+0004d4f0: 6e69 745f 5f20 6d65 7468 6f64 290d 0a0d  nit__ method)...
+0004d500: 0a20 2020 2020 2020 204d 6170 7320 6120  .        Maps a 
+0004d510: 4461 7461 4672 616d 6520 636f 6c75 6d6e  DataFrame column
+0004d520: 2068 6f6c 6469 6e67 2065 6974 6865 722c   holding either,
+0004d530: 2073 686f 7274 6e61 6d65 2c20 6c6f 6e67   shortname, long
+0004d540: 6e61 6d65 206f 7220 6669 656c 6420 7661  name or field va
+0004d550: 6c75 6520 666f 7220 6c65 6166 206c 6576  lue for leaf lev
+0004d560: 656c 2074 7261 6e73 6c61 7469 6f6e 0d0a  el translation..
+0004d570: 2020 2020 2020 2020 2a2a 4f6e 6c79 206f          **Only o
+0004d580: 6e65 2a2a 206f 6620 7368 6f72 746e 616d  ne** of shortnam
+0004d590: 655f 636f 6c75 6d6e 2c20 6c6f 6e67 6e61  e_column, longna
+0004d5a0: 6d65 5f63 6f6c 756d 6e20 6f72 2061 2063  me_column or a c
+0004d5b0: 6f6d 6269 6e61 7469 6f6e 206f 6620 6669  ombination of fi
+0004d5c0: 656c 645f 636f 6c75 6d6e 2061 6e64 2066  eld_column and f
+0004d5d0: 6965 6c64 5f73 686f 7274 6e61 6d65 206e  ield_shortname n
+0004d5e0: 6565 6473 2074 6f20 6265 2073 7570 706c  eeds to be suppl
+0004d5f0: 6965 640d 0a0d 0a20 2020 2020 2020 203a  ied....        :
+0004d600: 7061 7261 6d20 7368 6f72 746e 616d 655f  param shortname_
+0004d610: 636f 6c75 6d6e 3a20 5468 6520 636f 6c75  column: The colu
+0004d620: 6d6e 2028 7365 7269 6573 2920 696e 2074  mn (series) in t
+0004d630: 6865 2070 616e 6461 7320 4461 7461 4672  he pandas DataFr
+0004d640: 616d 6520 7468 6174 2077 696c 6c20 6265  ame that will be
+0004d650: 206d 6170 7065 6420 7768 6963 6820 686f   mapped which ho
+0004d660: 6c64 7320 7468 6520 6c65 6166 2073 686f  lds the leaf sho
+0004d670: 7274 6e61 6d65 0d0a 2020 2020 2020 2020  rtname..        
+0004d680: 3a70 6172 616d 206c 6f6e 676e 616d 655f  :param longname_
+0004d690: 636f 6c75 6d6e 3a20 2054 6865 2063 6f6c  column:  The col
+0004d6a0: 756d 6e20 2873 6572 6965 7329 2069 6e20  umn (series) in 
+0004d6b0: 7468 6520 7061 6e64 6173 2044 6174 6146  the pandas DataF
+0004d6c0: 7261 6d65 2074 6861 7420 7769 6c6c 2062  rame that will b
+0004d6d0: 6520 6d61 7070 6564 2020 7768 6963 6820  e mapped  which 
+0004d6e0: 686f 6c64 7320 7468 6520 6c65 6166 206c  holds the leaf l
+0004d6f0: 6f6e 676e 616d 650d 0a20 2020 2020 2020  ongname..       
+0004d700: 203a 7061 7261 6d20 6669 656c 645f 636f   :param field_co
+0004d710: 6c75 6d6e 3a20 2020 2020 5468 6520 636f  lumn:     The co
+0004d720: 6c75 6d6e 2028 7365 7269 6573 2920 696e  lumn (series) in
+0004d730: 2074 6865 2070 616e 6461 7320 4461 7461   the pandas Data
+0004d740: 4672 616d 6520 7468 6174 2077 696c 6c20  Frame that will 
+0004d750: 6265 206d 6170 7065 6420 2077 6869 6368  be mapped  which
+0004d760: 2068 6f6c 6473 2074 6865 206c 6561 6620   holds the leaf 
+0004d770: 6669 656c 640d 0a20 2020 2020 2020 203a  field..        :
+0004d780: 7061 7261 6d20 6669 656c 645f 7368 6f72  param field_shor
+0004d790: 746e 616d 653a 2020 5468 6520 7368 6f72  tname:  The shor
+0004d7a0: 746e 616d 6520 6f66 2074 6865 2064 696d  tname of the dim
+0004d7b0: 656e 7369 6f6e 2066 6965 6c64 2068 6f6c  ension field hol
+0004d7c0: 6469 6e67 2074 6865 2074 7261 6e73 6c61  ding the transla
+0004d7d0: 7469 6f6e 0d0a 2020 2020 2020 2020 3a70  tion..        :p
+0004d7e0: 6172 616d 2073 7562 7472 6565 3a20 2020  aram subtree:   
+0004d7f0: 2020 2020 2020 2061 2074 7570 6c65 206f         a tuple o
+0004d800: 6620 2873 7472 7563 7475 7265 2073 686f  f (structure sho
+0004d810: 7274 6e61 6d65 2c20 726f 6f74 2065 6c65  rtname, root ele
+0004d820: 6d65 6e74 2073 686f 7274 6e61 6d65 2c73  ment shortname,s
+0004d830: 7562 7472 6565 2072 6f6f 7420 7368 6f72  ubtree root shor
+0004d840: 746e 616d 6529 2e20 5573 6564 2066 6f72  tname). Used for
+0004d850: 2065 7870 6c6f 6469 6e67 2064 6174 6120   exploding data 
+0004d860: 7570 2061 2073 7472 7563 7475 7265 2068  up a structure h
+0004d870: 6965 7261 7263 6879 2e20 466f 7220 6261  ierarchy. For ba
+0004d880: 636b 7761 7264 2063 6f6d 7061 7469 6269  ckward compatibi
+0004d890: 6c69 7479 206f 6e6c 792e 2055 7365 2070  lity only. Use p
+0004d8a0: 6174 6820 696e 7374 6561 642e 0d0a 2020  ath instead...  
+0004d8b0: 2020 2020 2020 3a70 6172 616d 2070 6174        :param pat
+0004d8c0: 683a 2020 2020 2020 2020 2020 2020 2070  h:             p
+0004d8d0: 6174 6820 746f 2061 2053 7472 7563 7475  ath to a Structu
+0004d8e0: 7265 456c 656d 656e 7420 652e 672e 2027  reElement e.g. '
+0004d8f0: 4d79 5374 7275 6374 2e48 6965 722f 456c  MyStruct.Hier/El
+0004d900: 656d 6e31 2f45 6c65 6d65 6e32 2720 2d20  emn1/Elemen2' - 
+0004d910: 416e 2061 6c74 6572 6e61 7469 7665 2074  An alternative t
+0004d920: 6f20 7468 6520 7375 6274 7265 6520 7061  o the subtree pa
+0004d930: 7261 6d65 7465 720d 0a20 2020 2020 2020  rameter..       
+0004d940: 2027 2727 0d0a 2020 2020 2020 2020 7365   '''..        se
+0004d950: 6c66 2e73 7562 7472 6565 2020 2020 2020  lf.subtree      
+0004d960: 2020 2020 3d20 7375 6274 7265 650d 0a20      = subtree.. 
+0004d970: 2020 2020 2020 2073 656c 662e 7061 7468         self.path
+0004d980: 2020 2020 2020 2020 2020 2020 203d 2070               = p
+0004d990: 6174 680d 0a20 2020 2020 2020 2023 0d0a  ath..        #..
+0004d9a0: 0d0a 2020 2020 2020 2020 7365 6c66 2e66  ..        self.f
+0004d9b0: 6965 6c64 5f73 686f 7274 6e61 6d65 2020  ield_shortname  
+0004d9c0: 3d20 6669 656c 645f 7368 6f72 746e 616d  = field_shortnam
+0004d9d0: 650d 0a0d 0a20 2020 2020 2020 2069 6620  e....        if 
+0004d9e0: 7368 6f72 746e 616d 655f 636f 6c75 6d6e  shortname_column
+0004d9f0: 3a0d 0a20 2020 2020 2020 2020 2020 2073  :..            s
+0004da00: 656c 662e 636f 6c75 6d6e 5f74 7970 6520  elf.column_type 
+0004da10: 3d20 2773 686f 7274 6e61 6d65 270d 0a20  = 'shortname'.. 
+0004da20: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004da30: 636f 6c75 6d6e 5f6e 616d 6520 3d20 7368  column_name = sh
+0004da40: 6f72 746e 616d 655f 636f 6c75 6d6e 0d0a  ortname_column..
+0004da50: 2020 2020 2020 2020 656c 6966 206c 6f6e          elif lon
+0004da60: 676e 616d 655f 636f 6c75 6d6e 3a0d 0a20  gname_column:.. 
+0004da70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0004da80: 636f 6c75 6d6e 5f74 7970 6520 3d20 276c  column_type = 'l
+0004da90: 6f6e 676e 616d 6527 0d0a 2020 2020 2020  ongname'..      
+0004daa0: 2020 2020 2020 7365 6c66 2e63 6f6c 756d        self.colum
+0004dab0: 6e5f 6e61 6d65 203d 206c 6f6e 676e 616d  n_name = longnam
+0004dac0: 655f 636f 6c75 6d6e 0d0a 2020 2020 2020  e_column..      
+0004dad0: 2020 656c 6966 2066 6965 6c64 5f63 6f6c    elif field_col
+0004dae0: 756d 6e3a 0d0a 2020 2020 2020 2020 2020  umn:..          
+0004daf0: 2020 7365 6c66 2e63 6f6c 756d 6e5f 7479    self.column_ty
+0004db00: 7065 203d 2027 6669 656c 6427 0d0a 2020  pe = 'field'..  
+0004db10: 2020 2020 2020 2020 2020 7365 6c66 2e63            self.c
+0004db20: 6f6c 756d 6e5f 6e61 6d65 203d 2066 6965  olumn_name = fie
+0004db30: 6c64 5f63 6f6c 756d 6e0d 0a20 2020 2020  ld_column..     
+0004db40: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
+0004db50: 6965 6c64 5f73 686f 7274 6e61 6d65 2069  ield_shortname i
+0004db60: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0004db70: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+0004db80: 616c 7565 4572 726f 7228 2757 6865 6e20  alueError('When 
+0004db90: 6120 5374 7275 6374 7572 654d 6170 7065  a StructureMappe
+0004dba0: 7220 6973 2069 6e69 7469 616c 6973 6564  r is initialised
+0004dbb0: 2077 6974 6820 6120 6669 656c 645f 636f   with a field_co
+0004dbc0: 6c75 6d6e 2c20 6120 6669 656c 645f 7368  lumn, a field_sh
+0004dbd0: 6f72 746e 616d 6520 6d75 7374 2061 6c73  ortname must als
+0004dbe0: 6f20 6265 2070 7265 7365 6e74 2729 0d0a  o be present')..
+0004dbf0: 0d0a 2020 2020 6465 6620 6d61 705f 6461  ..    def map_da
+0004dc00: 7461 6672 616d 6528 7365 6c66 2c64 6174  taframe(self,dat
+0004dc10: 6166 7261 6d65 2c64 696d 656e 7369 6f6e  aframe,dimension
+0004dc20: 2c6c 6f61 6465 7229 3a0d 0a20 2020 2020  ,loader):..     
+0004dc30: 2020 2027 2727 5472 616e 7366 6f72 6d20     '''Transform 
+0004dc40: 6120 7061 6e64 6173 2044 6174 6146 7261  a pandas DataFra
+0004dc50: 6d65 2c20 6164 6469 6e67 2069 6e20 6120  me, adding in a 
+0004dc60: 636f 6c75 6d6e 2063 6f6e 7461 696e 696e  column containin
+0004dc70: 6720 456d 706f 7765 7220 456c 656d 656e  g Empower Elemen
+0004dc80: 7420 7068 7973 6964 7320 2870 6879 7369  t physids (physi
+0004dc90: 6361 6c20 6964 656e 7469 6669 6572 7329  cal identifiers)
+0004dca0: 2074 6861 7420 6361 6e20 6265 2075 7365   that can be use
+0004dcb0: 6420 696e 2061 6e20 456d 706f 7765 7220  d in an Empower 
+0004dcc0: 6275 6c6b 206c 6f61 6420 7072 6f63 6573  bulk load proces
+0004dcd0: 732e 0d0a 2020 2020 2020 2020 4120 636f  s...        A co
+0004dce0: 6c75 6d6e 2077 696c 6c20 6265 2061 6464  lumn will be add
+0004dcf0: 6564 2066 6f72 2065 6163 6820 6c65 7665  ed for each leve
+0004dd00: 6c20 6f66 2068 6965 7261 7263 6879 2066  l of hierarchy f
+0004dd10: 726f 6d20 7468 6520 6c65 6166 2074 6f20  rom the leaf to 
+0004dd20: 7468 6520 5374 7275 6374 7572 6545 6c65  the StructureEle
+0004dd30: 6d65 6e74 2073 7065 6369 6669 6564 2069  ment specified i
+0004dd40: 6e20 7468 6520 636f 6e73 7472 7563 746f  n the constructo
+0004dd50: 7220 2869 2e65 2e20 7468 6520 5f5f 696e  r (i.e. the __in
+0004dd60: 6974 5f5f 206d 6574 686f 6429 0d0a 0d0a  it__ method)....
+0004dd70: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+0004dd80: 6120 6c69 7374 206f 6620 7468 6520 6e61  a list of the na
+0004dd90: 6d65 7320 6f66 2074 6865 2063 6f6c 756d  mes of the colum
+0004dda0: 6e73 2074 6861 7420 6861 7665 2062 6565  ns that have bee
+0004ddb0: 6e20 6372 6561 7465 6420 6279 2074 6865  n created by the
+0004ddc0: 206d 6170 7069 6e67 2070 726f 6365 7373   mapping process
+0004ddd0: 2e0d 0a0d 0a20 2020 2020 2020 203a 7061  .....        :pa
+0004dde0: 7261 6d20 6461 7461 6672 616d 653a 2054  ram dataframe: T
+0004ddf0: 6865 2070 616e 6461 7320 6461 7461 6672  he pandas datafr
+0004de00: 616d 6520 6265 696e 6720 7472 616e 7366  ame being transf
+0004de10: 6f72 6d65 642e 0d0a 2020 2020 2020 2020  ormed...        
+0004de20: 3a70 6172 616d 2064 696d 656e 7369 6f6e  :param dimension
+0004de30: 3a20 4469 6d65 6e73 696f 6e20 6265 696e  : Dimension bein
+0004de40: 6720 6d61 7070 6564 2e20 5369 6e63 6520  g mapped. Since 
+0004de50: 7765 206f 6e6c 7920 6b6e 6f77 2074 6865  we only know the
+0004de60: 2073 686f 7274 6e61 6d65 2c20 6c6f 6e67   shortname, long
+0004de70: 6e61 6d65 206f 7220 6669 656c 6420 6265  name or field be
+0004de80: 696e 6720 6d61 7070 6564 2077 6520 6e65  ing mapped we ne
+0004de90: 6564 2074 6865 2064 696d 656e 7369 6f6e  ed the dimension
+0004dea0: 2074 6f20 7472 616e 736c 6174 6520 7468   to translate th
+0004deb0: 6520 7374 7269 6e67 2076 616c 7565 730d  e string values.
+0004dec0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0004ded0: 6c6f 6164 6572 3a20 4465 7072 6563 6174  loader: Deprecat
+0004dee0: 6564 0d0a 2020 2020 2020 2020 2727 270d  ed..        '''.
+0004def0: 0a0d 0a20 2020 2020 2020 2023 544f 446f  ...        #TODo
+0004df00: 202d 2077 6f72 6b20 6f75 7420 7468 6520   - work out the 
+0004df10: 6163 7475 616c 2063 6f6c 756d 6e20 7479  actual column ty
+0004df20: 7065 202d 2061 7373 756d 6520 696e 7420  pe - assume int 
+0004df30: 3d20 7068 7973 6964 2c20 6173 7375 6d65  = physid, assume
+0004df40: 2073 7472 696e 6720 3d20 7368 6f72 746e   string = shortn
+0004df50: 616d 650d 0a0d 0a20 2020 2020 2020 206c  ame....        l
+0004df60: 6f67 2e76 6572 626f 7365 2827 4d61 7070  og.verbose('Mapp
+0004df70: 696e 6720 636f 6c75 6d6e 2027 2b73 7472  ing column '+str
+0004df80: 2873 656c 662e 636f 6c75 6d6e 5f6e 616d  (self.column_nam
+0004df90: 6529 2b27 2074 6f20 7374 7275 6374 7572  e)+' to structur
+0004dfa0: 6520 5b27 2b73 7472 2873 656c 662e 7375  e ['+str(self.su
+0004dfb0: 6274 7265 6520 6966 2073 656c 662e 7375  btree if self.su
+0004dfc0: 6274 7265 6520 656c 7365 2073 656c 662e  btree else self.
+0004dfd0: 7061 7468 292b 275d 2729 0d0a 0d0a 2020  path)+']')....  
+0004dfe0: 2020 2020 2020 7472 616e 736c 6174 696f        translatio
+0004dff0: 6e5f 6466 2020 203d 205f 6765 745f 6c65  n_df   = _get_le
+0004e000: 6166 5f74 7261 6e73 6c61 7469 6f6e 5f64  af_translation_d
+0004e010: 665f 6672 6f6d 5f74 7570 6c65 2864 696d  f_from_tuple(dim
+0004e020: 656e 7369 6f6e 2020 2020 2020 2020 2020  ension          
+0004e030: 3d20 6469 6d65 6e73 696f 6e0d 0a20 2020  = dimension..   
+0004e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e070: 2020 2020 2020 2020 2020 202c 7374 7275             ,stru
+0004e080: 6374 7572 655f 7475 706c 6520 2020 203d  cture_tuple    =
+0004e090: 2073 656c 662e 7375 6274 7265 650d 0a20   self.subtree.. 
 0004e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e0b0: 202c 7374 7275 6374 7572 655f 656c 656d   ,structure_elem
-0004e0c0: 656e 745f 7061 7468 203d 2073 656c 662e  ent_path = self.
-0004e0d0: 7061 7468 0d0a 2020 2020 2020 2020 2020  path..          
-0004e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e110: 2020 2020 2c66 6965 6c64 5f73 686f 7274      ,field_short
-0004e120: 6e61 6d65 2020 2020 3d20 7365 6c66 2e66  name    = self.f
-0004e130: 6965 6c64 5f73 686f 7274 6e61 6d65 0d0a  ield_shortname..
-0004e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e170: 2020 2020 2020 2020 2020 2020 2020 290d                ).
-0004e180: 0a0d 0a20 2020 2020 2020 2023 544f 444f  ...        #TODO
-0004e190: 202d 2065 6e73 7572 6520 7765 2068 6176   - ensure we hav
-0004e1a0: 6520 6e6f 2064 7570 6c69 6361 7465 7320  e no duplicates 
-0004e1b0: 696e 2074 6865 2074 7261 6e73 6c61 7469  in the translati
-0004e1c0: 6f6e 2064 660d 0a0d 0a20 2020 2020 2020  on df....       
-0004e1d0: 2023 5075 7420 6f75 7420 6120 7665 7279   #Put out a very
-0004e1e0: 2063 6c65 6172 206d 6573 7361 6765 202d   clear message -
-0004e1f0: 2077 6520 6361 6e27 7420 6c6f 6164 2069   we can't load i
-0004e200: 6620 7468 6520 7472 616e 736c 6174 696f  f the translatio
-0004e210: 6e20 6861 7320 6475 706c 6963 6174 6573  n has duplicates
-0004e220: 2c20 616e 6420 7468 6520 7265 6d65 6469  , and the remedi
-0004e230: 616c 2061 6374 696f 6e20 6164 7669 7365  al action advise
-0004e240: 640d 0a0d 0a0d 0a20 2020 2020 2020 2063  d......        c
-0004e250: 6f6c 756d 6e73 5f66 6f72 5f65 7870 6c6f  olumns_for_explo
-0004e260: 7369 6f6e 203d 205f 7472 616e 736c 6174  sion = _translat
-0004e270: 655f 6469 6d28 6466 2020 2020 2020 2020  e_dim(df        
-0004e280: 2020 2020 2020 3d20 6461 7461 6672 616d        = datafram
-0004e290: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0004e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e2c0: 202c 6469 6d5f 6964 656e 7469 6669 6572   ,dim_identifier
-0004e2d0: 2020 3d20 7365 6c66 2e63 6f6c 756d 6e5f    = self.column_
-0004e2e0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-0004e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e310: 2020 2020 2c64 696d 5f74 7970 6520 2020      ,dim_type   
-0004e320: 2020 2020 203d 2073 656c 662e 636f 6c75       = self.colu
-0004e330: 6d6e 5f74 7970 650d 0a20 2020 2020 2020  mn_type..       
-0004e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e360: 2020 2020 2020 202c 7472 616e 736c 6174         ,translat
-0004e370: 655f 6466 2020 2020 3d20 7472 616e 736c  e_df    = transl
-0004e380: 6174 696f 6e5f 6466 0d0a 2020 2020 2020  ation_df..      
-0004e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e3b0: 2020 2020 2020 2020 2c66 6965 6c64 5f73          ,field_s
-0004e3c0: 686f 7274 6e61 6d65 203d 2073 656c 662e  hortname = self.
-0004e3d0: 6669 656c 645f 7368 6f72 746e 616d 650d  field_shortname.
-0004e3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004e400: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0004e410: 0d0a 0d0a 2020 2020 2020 2020 2372 6574  ....        #ret
-0004e420: 7572 6e20 7468 6520 636f 6c75 6d6e 7320  urn the columns 
-0004e430: 6372 6561 7465 6420 696e 2074 6865 206d  created in the m
-0004e440: 6170 7069 6e67 202d 2069 2e65 2e20 7468  apping - i.e. th
-0004e450: 6520 6f6e 6573 2074 6861 7420 7769 6c6c  e ones that will
-0004e460: 2062 6520 7573 6564 2069 6e20 7468 6520   be used in the 
-0004e470: 6578 706c 6f73 696f 6e0d 0a20 2020 2020  explosion..     
-0004e480: 2020 2072 6574 7572 6e20 636f 6c75 6d6e     return column
-0004e490: 735f 666f 725f 6578 706c 6f73 696f 6e0d  s_for_explosion.
-0004e4a0: 0a0d 0a63 6c61 7373 2043 6f6c 756d 6e4d  ...class ColumnM
-0004e4b0: 6170 7065 7228 5461 626c 6545 6d70 6f77  apper(TableEmpow
-0004e4c0: 6572 4d61 7070 6572 293a 0d0a 2020 2020  erMapper):..    
-0004e4d0: 2727 2755 7469 6c69 7479 206f 626a 6563  '''Utility objec
-0004e4e0: 7420 666f 7220 666f 7220 7573 6520 7769  t for for use wi
-0004e4f0: 7468 2060 4c6f 6164 6572 6073 2c20 6465  th `Loader`s, de
-0004e500: 7369 676e 6564 2074 6f20 6d61 7020 636f  signed to map co
-0004e510: 6c75 6d6e 7320 696e 2061 2070 616e 6461  lumns in a panda
-0004e520: 7320 4461 7461 4672 616d 6520 746f 2074  s DataFrame to t
-0004e530: 6865 2070 6879 7369 6361 6c20 6964 656e  he physical iden
-0004e540: 7469 6669 6572 7320 6f66 2074 6865 2045  tifiers of the E
-0004e550: 6d70 6f77 6572 2045 6c65 6d65 6e74 7320  mpower Elements 
-0004e560: 7765 2077 616e 7420 746f 206c 6f61 6420  we want to load 
-0004e570: 6167 6169 6e73 742e 2727 270d 0a0d 0a20  against.'''.... 
-0004e580: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-0004e590: 7365 6c66 2c63 6f6c 756d 6e5f 6e61 6d65  self,column_name
-0004e5a0: 2c63 6f6c 756d 6e5f 7479 7065 2c66 6965  ,column_type,fie
-0004e5b0: 6c64 5f73 686f 7274 6e61 6d65 293a 0d0a  ld_shortname):..
-0004e5c0: 2020 2020 2020 2020 2727 2743 7265 6174          '''Creat
-0004e5d0: 6520 6120 6e65 7720 436f 6c75 6d6e 4d61  e a new ColumnMa
-0004e5e0: 7070 6572 2c20 6120 5574 696c 6974 7920  pper, a Utility 
-0004e5f0: 6f62 6a65 6374 2066 6f72 2066 6f72 2075  object for for u
-0004e600: 7365 2077 6974 6820 604c 6f61 6465 7260  se with `Loader`
-0004e610: 732c 2064 6573 6967 6e65 6420 746f 206d  s, designed to m
-0004e620: 6170 2063 6f6c 756d 6e73 2069 6e20 6120  ap columns in a 
-0004e630: 7061 6e64 6173 2044 6174 6146 7261 6d65  pandas DataFrame
-0004e640: 2074 6f20 7468 6520 7068 7973 6963 616c   to the physical
-0004e650: 2069 6465 6e74 6966 6965 7273 206f 6620   identifiers of 
-0004e660: 7468 6520 456d 706f 7765 7220 456c 656d  the Empower Elem
-0004e670: 656e 7473 2077 6520 7761 6e74 2074 6f20  ents we want to 
-0004e680: 6c6f 6164 2061 6761 696e 7374 2e0d 0a0d  load against....
-0004e690: 0a20 2020 2020 2020 204d 6170 7320 6120  .        Maps a 
-0004e6a0: 4461 7461 4672 616d 6520 636f 6c75 6d6e  DataFrame column
-0004e6b0: 2068 6f6c 6469 6e67 2065 6974 6865 722c   holding either,
-0004e6c0: 2073 686f 7274 6e61 6d65 2c20 6c6f 6e67   shortname, long
-0004e6d0: 6e61 6d65 206f 7220 6669 656c 6420 7661  name or field va
-0004e6e0: 6c75 6520 666f 7220 6c65 6166 206c 6576  lue for leaf lev
-0004e6f0: 656c 2074 7261 6e73 6c61 7469 6f6e 0d0a  el translation..
-0004e700: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0004e710: 2063 6f6c 756d 6e5f 6e61 6d65 3a20 5468   column_name: Th
-0004e720: 6520 6e61 6d65 206f 6620 7468 6520 636f  e name of the co
-0004e730: 6c75 6d6e 2069 6e20 7468 6520 7061 6e64  lumn in the pand
-0004e740: 6173 2044 6174 6146 7261 6d65 0d0a 2020  as DataFrame..  
-0004e750: 2020 2020 2020 3a70 6172 616d 2063 6f6c        :param col
-0004e760: 756d 6e5f 7479 7065 3a20 6f6e 6520 6f66  umn_type: one of
-0004e770: 2027 7068 7973 6964 272c 2027 7368 6f72   'physid', 'shor
-0004e780: 746e 616d 6527 2c20 276c 6f6e 676e 616d  tname', 'longnam
-0004e790: 6527 206f 7220 2766 6965 6c64 270d 0a20  e' or 'field'.. 
-0004e7a0: 2020 2020 2020 203a 7061 7261 6d20 6669         :param fi
-0004e7b0: 656c 645f 7368 6f72 746e 616d 653a 2057  eld_shortname: W
-0004e7c0: 6865 6e20 7468 6973 2069 7320 7365 742c  hen this is set,
-0004e7d0: 2074 6865 2076 616c 7565 7320 696e 2074   the values in t
-0004e7e0: 6865 2063 6f6c 756d 6e20 7769 6c6c 2062  he column will b
-0004e7f0: 6520 7472 616e 736c 6174 6564 2066 726f  e translated fro
-0004e800: 6d20 7468 6520 6669 656c 6420 696e 2074  m the field in t
-0004e810: 6865 2064 696d 656e 7369 6f6e 2077 6974  he dimension wit
-0004e820: 6820 7468 6174 2073 686f 7274 6e61 6d65  h that shortname
-0004e830: 2e20 5573 6520 7769 7468 2063 6f6c 756d  . Use with colum
-0004e840: 6e5f 7479 7065 203d 2027 6669 656c 6427  n_type = 'field'
-0004e850: 0d0a 2020 2020 2020 2020 2727 270d 0a0d  ..        '''...
-0004e860: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0004e870: 636f 6c75 6d6e 5f6e 616d 6520 3d20 636f  column_name = co
-0004e880: 6c75 6d6e 5f6e 616d 650d 0a20 2020 2020  lumn_name..     
-0004e890: 2020 2073 656c 662e 636f 6c75 6d6e 5f74     self.column_t
-0004e8a0: 7970 6520 3d20 636f 6c75 6d6e 5f74 7970  ype = column_typ
-0004e8b0: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
-0004e8c0: 6669 656c 645f 7368 6f72 746e 616d 6520  field_shortname 
-0004e8d0: 3d20 6669 656c 645f 7368 6f72 746e 616d  = field_shortnam
-0004e8e0: 650d 0a0d 0a20 2020 2064 6566 206d 6170  e....    def map
-0004e8f0: 5f64 6174 6166 7261 6d65 2873 656c 662c  _dataframe(self,
-0004e900: 2064 6174 6166 7261 6d65 2c64 696d 656e   dataframe,dimen
-0004e910: 7369 6f6e 2c6c 6f61 6465 7229 3a0d 0a20  sion,loader):.. 
-0004e920: 2020 2020 2020 2027 2727 5472 616e 7366         '''Transf
-0004e930: 6f72 6d20 6120 7061 6e64 6173 2044 6174  orm a pandas Dat
-0004e940: 6146 7261 6d65 2c20 6164 6469 6e67 2069  aFrame, adding i
-0004e950: 6e20 6120 636f 6c75 6d6e 2063 6f6e 7461  n a column conta
-0004e960: 696e 696e 6720 456d 706f 7765 7220 456c  ining Empower El
-0004e970: 656d 656e 7420 7068 7973 6964 7320 2870  ement physids (p
-0004e980: 6879 7369 6361 6c20 6964 656e 7469 6669  hysical identifi
-0004e990: 6572 7329 2074 6861 7420 6361 6e20 6265  ers) that can be
-0004e9a0: 2075 7365 6420 696e 2061 6e20 456d 706f   used in an Empo
-0004e9b0: 7765 7220 6275 6c6b 206c 6f61 6420 7072  wer bulk load pr
-0004e9c0: 6f63 6573 732e 0d0a 0d0a 2020 2020 2020  ocess.....      
-0004e9d0: 2020 5265 7475 726e 7320 6120 6c69 7374    Returns a list
-0004e9e0: 206f 6620 7468 6520 6e61 6d65 7320 6f66   of the names of
-0004e9f0: 2074 6865 2063 6f6c 756d 6e73 2074 6861   the columns tha
-0004ea00: 7420 6861 7665 2062 6565 6e20 6372 6561  t have been crea
-0004ea10: 7465 6420 6279 2074 6865 206d 6170 7069  ted by the mappi
-0004ea20: 6e67 2070 726f 6365 7373 2e0d 0a0d 0a20  ng process..... 
-0004ea30: 2020 2020 2020 203a 7061 7261 6d20 6461         :param da
-0004ea40: 7461 6672 616d 653a 2054 6865 2070 616e  taframe: The pan
-0004ea50: 6461 7320 6461 7461 6672 616d 6520 6265  das dataframe be
-0004ea60: 696e 6720 7472 616e 7366 6f72 6d65 642e  ing transformed.
-0004ea70: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0004ea80: 2064 696d 656e 7369 6f6e 3a20 4469 6d65   dimension: Dime
-0004ea90: 6e73 696f 6e20 6265 696e 6720 6d61 7070  nsion being mapp
-0004eaa0: 6564 2e20 5369 6e63 6520 7765 206f 6e6c  ed. Since we onl
-0004eab0: 7920 6b6e 6f77 2074 6865 2073 686f 7274  y know the short
-0004eac0: 6e61 6d65 2c20 6c6f 6e67 6e61 6d65 206f  name, longname o
-0004ead0: 7220 6669 656c 6420 6265 696e 6720 6d61  r field being ma
-0004eae0: 7070 6564 2077 6520 6e65 6564 2074 6865  pped we need the
-0004eaf0: 2064 696d 656e 7369 6f6e 2074 6f20 7472   dimension to tr
-0004eb00: 616e 736c 6174 6520 7468 6520 7374 7269  anslate the stri
-0004eb10: 6e67 2076 616c 7565 730d 0a20 2020 2020  ng values..     
-0004eb20: 2020 203a 7061 7261 6d20 6c6f 6164 6572     :param loader
-0004eb30: 3a20 4465 7072 6563 6174 6564 0d0a 2020  : Deprecated..  
-0004eb40: 2020 2020 2020 2727 270d 0a0d 0a20 2020        '''....   
-0004eb50: 2020 2020 2023 576f 726b 206f 7574 2074       #Work out t
-0004eb60: 6865 2063 6f6c 756d 6e20 7479 7065 0d0a  he column type..
-0004eb70: 2020 2020 2020 2020 2369 6620 6974 2069          #if it i
-0004eb80: 7320 6120 7374 7269 6e67 2063 6f6c 756d  s a string colum
-0004eb90: 6e2c 2074 6865 6e20 6173 7375 6d65 2069  n, then assume i
-0004eba0: 7420 6973 2061 2073 686f 7274 6e61 6d65  t is a shortname
-0004ebb0: 0d0a 2020 2020 2020 2020 2349 6620 6974  ..        #If it
-0004ebc0: 2069 7320 616e 2069 6e74 2063 6f6c 756d   is an int colum
-0004ebd0: 6e2c 2074 6865 6e20 6173 7375 6d65 2069  n, then assume i
-0004ebe0: 7420 6973 2061 2070 6879 7369 6420 2873  t is a physid (s
-0004ebf0: 6f20 646f 6e27 7420 646f 2061 6e79 7468  o don't do anyth
-0004ec00: 696e 6720 7769 7468 2069 7420 6174 2061  ing with it at a
-0004ec10: 6c6c 0d0a 0d0a 2020 2020 2020 2020 7472  ll....        tr
-0004ec20: 616e 736c 6174 696f 6e5f 6466 203d 2064  anslation_df = d
-0004ec30: 696d 656e 7369 6f6e 2e5f 6765 745f 7369  imension._get_si
-0004ec40: 6d70 6c65 5f74 7261 6e73 6c61 7469 6f6e  mple_translation
-0004ec50: 5f64 6628 6f75 7470 7574 5f63 6f6c 756d  _df(output_colum
-0004ec60: 6e5f 6e61 6d65 203d 2027 6469 6d5f 272b  n_name = 'dim_'+
-0004ec70: 7374 7228 6469 6d65 6e73 696f 6e2e 696e  str(dimension.in
-0004ec80: 6465 7829 2b27 5f70 6879 7369 645f 666f  dex)+'_physid_fo
-0004ec90: 725f 272b 7365 6c66 2e63 6f6c 756d 6e5f  r_'+self.column_
-0004eca0: 6e61 6d65 2c66 6965 6c64 5f73 686f 7274  name,field_short
-0004ecb0: 6e61 6d65 3d73 656c 662e 6669 656c 645f  name=self.field_
-0004ecc0: 7368 6f72 746e 616d 6529 0d0a 0d0a 2020  shortname)....  
-0004ecd0: 2020 2020 2020 636f 6c75 6d6e 735f 666f        columns_fo
-0004ece0: 725f 6578 706c 6f73 696f 6e20 3d20 5f74  r_explosion = _t
-0004ecf0: 7261 6e73 6c61 7465 5f64 696d 2864 6620  ranslate_dim(df 
-0004ed00: 2020 2020 2020 2020 2020 2020 203d 2064               = d
-0004ed10: 6174 6166 7261 6d65 0d0a 2020 2020 2020  ataframe..      
-0004ed20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed40: 2020 2020 2020 2020 2c64 696d 5f69 6465          ,dim_ide
-0004ed50: 6e74 6966 6965 7220 203d 2073 656c 662e  ntifier  = self.
-0004ed60: 636f 6c75 6d6e 5f6e 616d 650d 0a20 2020  column_name..   
-0004ed70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ed90: 2020 2020 2020 2020 2020 202c 6469 6d5f             ,dim_
-0004eda0: 7479 7065 2020 2020 2020 2020 3d20 7365  type        = se
-0004edb0: 6c66 2e63 6f6c 756d 6e5f 7479 7065 0d0a  lf.column_type..
-0004edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004edd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ede0: 2020 2020 2020 2020 2020 2020 2020 2c74                ,t
-0004edf0: 7261 6e73 6c61 7465 5f64 6620 2020 203d  ranslate_df    =
-0004ee00: 2074 7261 6e73 6c61 7469 6f6e 5f64 660d   translation_df.
-0004ee10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004ee20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ee30: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-0004ee40: 6669 656c 645f 7368 6f72 746e 616d 6520  field_shortname 
-0004ee50: 3d20 7365 6c66 2e66 6965 6c64 5f73 686f  = self.field_sho
-0004ee60: 7274 6e61 6d65 0d0a 2020 2020 2020 2020  rtname..        
-0004ee70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ee80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004ee90: 2020 2020 2020 290d 0a0d 0a20 2020 2020        )....     
-0004eea0: 2020 2023 7265 7475 726e 2074 6865 2063     #return the c
-0004eeb0: 6f6c 756d 6e73 2063 7265 6174 6564 2069  olumns created i
-0004eec0: 6e20 7468 6520 6d61 7070 696e 6720 2d20  n the mapping - 
-0004eed0: 692e 652e 2074 6865 206f 6e65 7320 7468  i.e. the ones th
-0004eee0: 6174 2077 696c 6c20 6265 2075 7365 6420  at will be used 
-0004eef0: 696e 2074 6865 2065 7870 6c6f 7369 6f6e  in the explosion
-0004ef00: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0004ef10: 2063 6f6c 756d 6e73 5f66 6f72 5f65 7870   columns_for_exp
-0004ef20: 6c6f 7369 6f6e 0d0a 0d0a 0d0a 636c 6173  losion......clas
-0004ef30: 7320 4375 6265 4d61 7070 6572 286f 626a  s CubeMapper(obj
-0004ef40: 6563 7429 3a0d 0a20 2020 2027 2727 436c  ect):..    '''Cl
-0004ef50: 6173 7320 7768 6963 6820 6d61 7073 2061  ass which maps a
-0004ef60: 2074 6162 6c65 2028 7061 6e64 6173 2044   table (pandas D
-0004ef70: 6174 6146 7261 6d65 2920 746f 2061 2046  ataFrame) to a F
-0004ef80: 6f63 7573 0d0a 2020 2020 436f 6e74 6169  ocus..    Contai
-0004ef90: 6e73 2074 6865 206c 6f67 6963 2066 6f72  ns the logic for
-0004efa0: 2074 7572 6e69 6e67 2064 6963 7469 6f6e   turning diction
-0004efb0: 6172 6965 7320 696e 746f 206d 6f72 6520  aries into more 
-0004efc0: 636f 6d70 6c65 7820 6d61 7070 696e 6720  complex mapping 
-0004efd0: 6f62 6a65 6374 7320 7768 6963 6820 6172  objects which ar
-0004efe0: 6520 456d 706f 7765 7220 7374 7275 6374  e Empower struct
-0004eff0: 7572 6520 6177 6172 652c 2061 6e64 2066  ure aware, and f
-0004f000: 6f72 2069 6e66 6572 7269 6e67 206d 6170  or inferring map
-0004f010: 7069 6e67 2069 6e66 6f72 6d61 7469 6f6e  ping information
-0004f020: 0d0a 2020 2020 2727 270d 0a0d 0a20 2020  ..    '''....   
-0004f030: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-0004f040: 6c66 2c6d 6170 7069 6e67 733d 4e6f 6e65  lf,mappings=None
-0004f050: 2c74 6172 6765 7420 3d20 4e6f 6e65 2c20  ,target = None, 
-0004f060: 736f 7572 6365 203d 204e 6f6e 6529 3a0d  source = None):.
-0004f070: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0004f080: 5f6d 6170 7065 7273 203d 207b 7d0d 0a0d  _mappers = {}...
-0004f090: 0a20 2020 2020 2020 2073 656c 662e 5f69  .        self._i
-0004f0a0: 6e69 7469 616c 5f74 6172 6765 7420 3d20  nitial_target = 
-0004f0b0: 7461 7267 6574 0d0a 2020 2020 2020 2020  target..        
-0004f0c0: 7365 6c66 2e5f 696e 6974 6961 6c5f 736f  self._initial_so
-0004f0d0: 7572 6365 203d 2073 6f75 7263 650d 0a0d  urce = source...
-0004f0e0: 0a20 2020 2020 2020 2023 496e 6974 6961  .        #Initia
-0004f0f0: 6c69 7365 2065 6d70 7479 206d 6170 7065  lise empty mappe
-0004f100: 7273 0d0a 2020 2020 2020 2020 666f 7220  rs..        for 
-0004f110: 6e20 696e 2072 616e 6765 2831 3329 3a0d  n in range(13):.
-0004f120: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0004f130: 662e 5f6d 6170 7065 7273 5b6e 5d20 3d20  f._mappers[n] = 
-0004f140: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
-0004f150: 6966 206d 6170 7069 6e67 7320 6973 206e  if mappings is n
-0004f160: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-0004f170: 2020 2020 2020 234e 6f77 2070 7574 2074        #Now put t
-0004f180: 6865 206d 6170 7069 6e67 7320 7765 2776  he mappings we'v
-0004f190: 6520 6265 656e 2067 6976 656e 2069 6e74  e been given int
-0004f1a0: 6f20 706c 6163 650d 0a20 2020 2020 2020  o place..       
-0004f1b0: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-0004f1c0: 2020 2020 2020 2020 2020 2023 4966 2074             #If t
-0004f1d0: 6865 206d 6170 7065 7273 206f 626a 6563  he mappers objec
-0004f1e0: 7420 6973 2061 2064 6963 7420 6c69 6b65  t is a dict like
-0004f1f0: 2c20 7468 656e 2067 6f20 6f76 6572 2074  , then go over t
-0004f200: 6865 206b 6579 7320 2877 6869 6368 2072  he keys (which r
-0004f210: 6566 6572 2074 6f20 6469 6d65 6e73 696f  efer to dimensio
-0004f220: 6e73 2077 6520 686f 7065 290d 0a20 2020  ns we hope)..   
-0004f230: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0004f240: 206b 2c76 2069 6e20 6d61 7070 696e 6773   k,v in mappings
-0004f250: 2e69 7465 6d73 2829 3a0d 0a20 2020 2020  .items():..     
-0004f260: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0004f270: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-0004f280: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0004f290: 665b 6b5d 0d0a 2020 2020 2020 2020 2020  f[k]..          
-0004f2a0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0004f2b0: 204b 6579 4572 726f 723a 0d0a 2020 2020   KeyError:..    
-0004f2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f2d0: 2020 2020 7261 6973 6520 4b65 7945 7272      raise KeyErr
-0004f2e0: 6f72 2822 6d61 7070 696e 6773 5b7b 7d5d  or("mappings[{}]
-0004f2f0: 2063 616e 6e6f 7420 6265 2073 6574 2062   cannot be set b
-0004f300: 6563 6175 7365 206f 6e6c 7920 696e 7465  ecause only inte
-0004f310: 6765 7220 696e 6465 7865 6420 6f72 206c  ger indexed or l
-0004f320: 6f6e 676e 616d 6520 6d61 7070 696e 6773  ongname mappings
-0004f330: 2061 7265 2068 616e 646c 6564 202d 2073   are handled - s
-0004f340: 6574 2065 6163 6820 6d61 7070 696e 6727  et each mapping'
-0004f350: 7320 6b65 7973 2074 6f20 616e 2069 6e74  s keys to an int
-0004f360: 6567 6572 2062 6574 7765 656e 2030 2061  eger between 0 a
-0004f370: 6e64 2031 3220 6f72 2074 6865 206c 6f6e  nd 12 or the lon
-0004f380: 676e 616d 6520 6f66 2074 6865 2064 696d  gname of the dim
-0004f390: 656e 7369 6f6e 222e 666f 726d 6174 286b  ension".format(k
-0004f3a0: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
-0004f3b0: 2020 2020 2020 2020 2020 7365 6c66 5b6b            self[k
-0004f3c0: 5d20 3d20 760d 0a0d 0a20 2020 2020 2020  ] = v....       
-0004f3d0: 2020 2020 2065 7863 6570 7420 4174 7472       except Attr
-0004f3e0: 6962 7574 6545 7272 6f72 3a0d 0a20 2020  ibuteError:..   
-0004f3f0: 2020 2020 2020 2020 2020 2020 2074 7279               try
-0004f400: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0004f410: 2020 2020 2020 2066 6f72 206d 6170 7069         for mappi
-0004f420: 6e67 2069 6e20 6d61 7070 696e 6773 3a0d  ng in mappings:.
-0004f430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004f440: 2020 2020 2020 2020 2070 6173 730d 0a20           pass.. 
-0004f450: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0004f460: 7863 6570 7420 5479 7065 4572 726f 723a  xcept TypeError:
-0004f470: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004f480: 2020 2020 2020 7261 6973 650d 0a0d 0a20        raise.... 
-0004f490: 2020 2064 6566 205f 5f67 6574 6974 656d     def __getitem
-0004f4a0: 5f5f 2873 656c 662c 6974 656d 293a 0d0a  __(self,item):..
-0004f4b0: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
-0004f4c0: 4e6f 6e65 0d0a 2020 2020 2020 2020 6966  None..        if
-0004f4d0: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
-0004f4e0: 2c69 6e74 293a 0d0a 2020 2020 2020 2020  ,int):..        
-0004f4f0: 2020 2020 696e 6465 7820 3d20 6974 656d      index = item
-0004f500: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0004f510: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0004f520: 2069 2069 6e20 7261 6e67 6528 3133 293a   i in range(13):
-0004f530: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0004f540: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-0004f550: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0004f560: 656c 662e 7461 7267 6574 2e73 6974 652e  elf.target.site.
-0004f570: 6469 6d65 6e73 696f 6e73 5b69 5d2e 6c6f  dimensions[i].lo
-0004f580: 6e67 6e61 6d65 203d 3d20 6974 656d 3a0d  ngname == item:.
-0004f590: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004f5a0: 2020 2020 2020 2020 2069 6e64 6578 203d           index =
-0004f5b0: 2069 0d0a 2020 2020 2020 2020 2020 2020   i..            
-0004f5c0: 2020 2020 6578 6365 7074 2028 4174 7472      except (Attr
-0004f5d0: 6962 7574 6545 7272 6f72 2c4b 6579 4572  ibuteError,KeyEr
-0004f5e0: 726f 7229 3a0d 0a20 2020 2020 2020 2020  ror):..         
-0004f5f0: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
-0004f600: 0a0d 0a20 2020 2020 2020 2069 6620 696e  ...        if in
-0004f610: 6465 7820 6973 204e 6f6e 653a 0d0a 2020  dex is None:..  
-0004f620: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0004f630: 4b65 7945 7272 6f72 2827 4469 6d65 6e73  KeyError('Dimens
-0004f640: 696f 6e5b 7b7d 5d20 7761 7320 6e6f 7420  ion[{}] was not 
-0004f650: 666f 756e 6420 696e 2073 6974 6527 2e66  found in site'.f
-0004f660: 6f72 6d61 7428 6974 656d 2920 290d 0a0d  ormat(item) )...
-0004f670: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0004f680: 7365 6c66 2e5f 6d61 7070 6572 735b 696e  self._mappers[in
-0004f690: 6465 785d 0d0a 0d0a 2020 2020 6465 6620  dex]....    def 
-0004f6a0: 5f5f 7365 7469 7465 6d5f 5f28 7365 6c66  __setitem__(self
-0004f6b0: 2c69 7465 6d2c 7661 6c75 6529 3a0d 0a20  ,item,value):.. 
-0004f6c0: 2020 2020 2020 2069 6e64 6578 203d 204e         index = N
-0004f6d0: 6f6e 650d 0a20 2020 2020 2020 2069 6620  one..        if 
-0004f6e0: 6973 696e 7374 616e 6365 2869 7465 6d2c  isinstance(item,
-0004f6f0: 696e 7429 3a0d 0a20 2020 2020 2020 2020  int):..         
-0004f700: 2020 2069 6e64 6578 203d 2069 7465 6d0d     index = item.
-0004f710: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-0004f720: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0004f730: 6920 696e 2072 616e 6765 2831 3329 3a0d  i in range(13):.
-0004f740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0004f750: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-0004f760: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0004f770: 6c66 2e74 6172 6765 742e 7369 7465 2e64  lf.target.site.d
-0004f780: 696d 656e 7369 6f6e 735b 695d 2e6c 6f6e  imensions[i].lon
-0004f790: 676e 616d 6520 3d3d 2069 7465 6d3a 0d0a  gname == item:..
-0004f7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0004f7b0: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
-0004f7c0: 690d 0a20 2020 2020 2020 2020 2020 2020  i..             
-0004f7d0: 2020 2065 7863 6570 7420 2841 7474 7269     except (Attri
-0004f7e0: 6275 7465 4572 726f 722c 4b65 7945 7272  buteError,KeyErr
-0004f7f0: 6f72 293a 0d0a 2020 2020 2020 2020 2020  or):..          
-0004f800: 2020 2020 2020 2020 2020 7061 7373 0d0a            pass..
-0004f810: 0d0a 2020 2020 2020 2020 6966 2069 6e64  ..        if ind
-0004f820: 6578 2069 7320 4e6f 6e65 3a0d 0a20 2020  ex is None:..   
-0004f830: 2020 2020 2020 2020 2072 6169 7365 204b           raise K
-0004f840: 6579 4572 726f 7228 2744 696d 656e 7369  eyError('Dimensi
-0004f850: 6f6e 5b7b 7d5d 2077 6173 206e 6f74 2066  on[{}] was not f
-0004f860: 6f75 6e64 2069 6e20 7369 7465 272e 666f  ound in site'.fo
-0004f870: 726d 6174 2869 7465 6d29 2029 0d0a 0d0a  rmat(item) )....
-0004f880: 2020 2020 2020 2020 7365 6c66 2e5f 6d61          self._ma
-0004f890: 7070 6572 735b 696e 6465 785d 203d 2076  ppers[index] = v
-0004f8a0: 616c 7565 0d0a 0d0a 2020 2020 4070 726f  alue....    @pro
-0004f8b0: 7065 7274 790d 0a20 2020 2064 6566 2074  perty..    def t
-0004f8c0: 6172 6765 7428 7365 6c66 293a 0d0a 2020  arget(self):..  
-0004f8d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0004f8e0: 662e 5f69 6e69 7469 616c 5f74 6172 6765  f._initial_targe
-0004f8f0: 740d 0a20 2020 2040 7072 6f70 6572 7479  t..    @property
-0004f900: 0d0a 2020 2020 6465 6620 736f 7572 6365  ..    def source
-0004f910: 2873 656c 6629 3a0d 0a20 2020 2020 2020  (self):..       
-0004f920: 2072 6574 7572 6e20 7365 6c66 2e5f 696e   return self._in
-0004f930: 6974 6961 6c5f 736f 7572 6365 0d0a 2020  itial_source..  
-0004f940: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-0004f950: 2064 6566 2073 6974 6528 7365 6c66 293a   def site(self):
-0004f960: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0004f970: 2073 656c 662e 7461 7267 6574 2e73 6974   self.target.sit
-0004f980: 650d 0a0d 0a20 2020 2040 7072 6f70 6572  e....    @proper
-0004f990: 7479 0d0a 2020 2020 6465 6620 636f 6c75  ty..    def colu
-0004f9a0: 6d6e 7328 7365 6c66 293a 0d0a 2020 2020  mns(self):..    
-0004f9b0: 2020 2020 7265 7475 726e 205b 6320 666f      return [c fo
-0004f9c0: 7220 6320 696e 2073 656c 662e 736f 7572  r c in self.sour
-0004f9d0: 6365 2e63 6f6c 756d 6e73 5d0d 0a0d 0a0d  ce.columns].....
-0004f9e0: 0a0d 0a20 2020 2064 6566 205f 6765 745f  ...    def _get_
-0004f9f0: 696d 706c 6965 645f 7368 6f72 7463 6f64  implied_shortcod
-0004fa00: 655f 6c69 7374 5f61 6e64 5f6d 6170 7069  e_list_and_mappi
-0004fa10: 6e67 5f74 7970 6528 7365 6c66 2c20 6469  ng_type(self, di
-0004fa20: 6d65 6e73 696f 6e5f 696e 6465 782c 206f  mension_index, o
-0004fa30: 626a 6563 745f 746f 5f63 6865 636b 5f61  bject_to_check_a
-0004fa40: 6761 696e 7374 2c20 636f 6c75 6d6e 5f6c  gainst, column_l
-0004fa50: 6973 745f 746f 5f63 6865 636b 5f61 6761  ist_to_check_aga
-0004fa60: 696e 7374 203d 204e 6f6e 6529 3a0d 0a20  inst = None):.. 
-0004fa70: 2020 2020 2020 2027 2727 0d0a 2020 2020         '''..    
-0004fa80: 2020 2020 4765 7420 6120 6c69 7374 206f      Get a list o
-0004fa90: 6620 7368 6f72 7463 6f64 6573 2069 6d70  f shortcodes imp
-0004faa0: 6c69 6564 2062 7920 7468 6520 7468 6973  lied by the this
-0004fab0: 206f 626a 6563 7427 7320 6d61 7070 696e   object's mappin
-0004fac0: 6720 666f 7220 6120 6769 7665 6e20 6469  g for a given di
-0004fad0: 6d65 6e73 696f 6e5f 696e 6465 782c 2067  mension_index, g
-0004fae0: 6976 656e 2061 6e20 6f62 6a65 6374 2074  iven an object t
-0004faf0: 6861 7420 6d69 6768 7420 636f 6e74 6169  hat might contai
-0004fb00: 6e20 7468 6f73 6520 7368 6f72 7463 6f64  n those shortcod
-0004fb10: 6573 0d0a 0d0a 2020 2020 2020 2020 652e  es....        e.
-0004fb20: 672e 2027 765f 4c4f 4e47 2720 636f 756c  g. 'v_LONG' coul
-0004fb30: 6420 6265 2061 2063 6f6e 7374 616e 7420  d be a constant 
-0004fb40: 7368 6f72 746e 616d 652c 206f 7220 6120  shortname, or a 
-0004fb50: 636f 6c75 6d6e 2068 6f6c 6469 6e67 2073  column holding s
-0004fb60: 686f 7274 6e61 6d65 730d 0a20 2020 2020  hortnames..     
-0004fb70: 2020 2020 2020 2020 7b27 466f 6f27 3a27          {'Foo':'
-0004fb80: 4261 7227 7d20 636f 756c 6420 6265 2061  Bar'} could be a
-0004fb90: 6e20 696e 6469 6361 746f 7220 7374 796c  n indicator styl
-0004fba0: 6520 6d65 7472 6963 2064 6963 7469 6f6e  e metric diction
-0004fbb0: 6172 7920 2d20 636f 6c75 6d6e 2046 6f6f  ary - column Foo
-0004fbc0: 2068 6f6c 6473 2076 616c 7565 7320 746f   holds values to
-0004fbd0: 2067 6f20 746f 206d 6574 7269 6320 7368   go to metric sh
-0004fbe0: 6f72 746e 616d 6520 4261 722c 206f 7220  ortname Bar, or 
-0004fbf0: 6120 636f 6c75 6d6e 2d66 6965 6c64 2064  a column-field d
-0004fc00: 6963 7469 6f6e 6172 7920 636f 6c75 6d6e  ictionary column
-0004fc10: 2046 6f6f 2067 6f65 7320 746f 2066 6965   Foo goes to fie
-0004fc20: 6c64 2042 6172 206f 6e20 6469 6d65 6e73  ld Bar on dimens
-0004fc30: 696f 6e20 780d 0a20 2020 2020 2020 2020  ion x..         
-0004fc40: 2020 2020 7b27 466f 6f27 3a7b 2742 6172      {'Foo':{'Bar
-0004fc50: 273a 312c 2747 7566 273a 317d 7d20 6973  ':1,'Guf':1}} is
-0004fc60: 2061 2073 686f 7274 6e61 6d65 2076 616c   a shortname val
-0004fc70: 7565 206d 6170 7069 6e67 202d 2069 6620  ue mapping - if 
-0004fc80: 7765 2066 696e 6420 4261 7220 696e 2063  we find Bar in c
-0004fc90: 6f6c 756d 6e20 466f 6f2c 2077 6520 7075  olumn Foo, we pu
-0004fca0: 7420 3120 6167 6169 6e73 7420 7468 6520  t 1 against the 
-0004fcb0: 6d65 7472 6963 2042 6172 2c20 6966 2077  metric Bar, if w
-0004fcc0: 6520 6669 6e64 2047 7566 2c20 7765 2070  e find Guf, we p
-0004fcd0: 7574 2031 2061 6761 696e 7374 2074 6861  ut 1 against tha
-0004fce0: 7420 6d65 7472 6963 2073 686f 7274 636f  t metric shortco
-0004fcf0: 6465 0d0a 0d0a 2020 2020 2020 2020 4966  de....        If
-0004fd00: 2074 6865 206d 6170 7069 6e67 2074 7970   the mapping typ
-0004fd10: 6520 6973 2063 6f6c 756d 6e73 2074 6f20  e is columns to 
-0004fd20: 6669 656c 6473 2c20 7468 6520 7265 7475  fields, the retu
-0004fd30: 726e 6564 206c 6973 7420 7769 6c6c 2069  rned list will i
-0004fd40: 6e73 7465 6164 2062 6520 6120 6469 6374  nstead be a dict
-0004fd50: 696f 6e61 7279 206f 6620 7468 6520 666f  ionary of the fo
-0004fd60: 726d 207b 2866 6965 6c64 5f76 616c 7565  rm {(field_value
-0004fd70: 2c20 6669 656c 645f 7661 6c75 652c 202e  , field_value, .
-0004fd80: 2e2e 293a 2073 686f 7274 6e61 6d65 2c20  ..): shortname, 
-0004fd90: 2e2e 2e7d 0d0a 0d0a 2020 2020 2020 2020  ...}....        
-0004fda0: 3a70 6172 616d 2064 696d 656e 7369 6f6e  :param dimension
-0004fdb0: 5f69 6e64 6578 3a20 696e 6465 7820 6f66  _index: index of
-0004fdc0: 2074 6865 2064 696d 656e 7369 6f6e 0d0a   the dimension..
-0004fdd0: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-0004fde0: 626a 6563 745f 746f 5f63 6865 636b 5f61  bject_to_check_a
-0004fdf0: 6761 696e 7374 3a20 456d 706f 7765 7220  gainst: Empower 
-0004fe00: 6f62 6a65 6374 2074 6f20 6368 6563 6b20  object to check 
-0004fe10: 6167 6169 6e73 7420 2d20 6120 5369 7465  against - a Site
-0004fe20: 2c20 4469 6d65 6e73 696f 6e2c 2061 2053  , Dimension, a S
-0004fe30: 7472 7563 7475 7265 206f 7220 6120 5374  tructure or a St
-0004fe40: 7275 6374 7572 6545 6c65 6d65 6e74 0d0a  ructureElement..
-0004fe50: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
-0004fe60: 6f6c 756d 6e5f 6c69 7374 5f74 6f5f 6368  olumn_list_to_ch
-0004fe70: 6563 6b5f 6167 6169 6e73 743a 204f 7074  eck_against: Opt
-0004fe80: 696f 6e61 6c20 6c69 7374 206f 6620 636f  ional list of co
-0004fe90: 6c75 6d6e 7320 7468 6174 2077 6520 6361  lumns that we ca
-0004fea0: 6e20 6368 6563 6b20 6167 6169 6e73 7420  n check against 
-0004feb0: 2d20 7573 6566 756c 2069 6620 7765 2068  - useful if we h
-0004fec0: 6176 6520 6120 6c61 7267 6520 6373 7620  ave a large csv 
-0004fed0: 6669 6c65 2077 6974 6820 6865 6164 6572  file with header
-0004fee0: 7320 6173 2074 6865 2073 6f75 7263 652e  s as the source.
-0004fef0: 2054 6869 7320 7061 7261 6d65 7465 7220   This parameter 
-0004ff00: 6973 2069 676e 6f72 6564 2069 6620 7468  is ignored if th
-0004ff10: 6973 2043 7562 656d 6170 7065 7220 6861  is Cubemapper ha
-0004ff20: 7320 6120 736f 7572 6365 0d0a 0d0a 2020  s a source....  
-0004ff30: 2020 2020 2020 3a72 6574 7572 6e3a 206c        :return: l
-0004ff40: 6973 745f 6f72 5f64 6963 745f 6f66 5f73  ist_or_dict_of_s
-0004ff50: 686f 7274 636f 6465 732c 206d 6170 7069  hortcodes, mappi
-0004ff60: 6e67 5f74 7970 6520 2d20 6f6e 6520 6f66  ng_type - one of
-0004ff70: 2027 636f 6e73 7461 6e74 2073 686f 7274   'constant short
-0004ff80: 6e61 6d65 272c 2763 6f6c 756d 6e20 6e61  name','column na
-0004ff90: 6d65 272c 2763 6f6c 756d 6e73 2074 6f20  me','columns to 
-0004ffa0: 6669 656c 6473 272c 2763 6f6c 756d 6e73  fields','columns
-0004ffb0: 2074 6f20 7368 6f72 746e 616d 6573 272c   to shortnames',
-0004ffc0: 2763 6f6c 756d 6e20 746f 2073 686f 7274  'column to short
-0004ffd0: 6e61 6d65 2074 6f20 7661 6c75 6527 2c20  name to value', 
-0004ffe0: 616e 6420 7468 656e 2063 6f6c 756d 6e20  and then column 
-0004fff0: 6e61 6d65 730d 0a20 2020 2020 2020 2027  names..        '
-00050000: 2727 0d0a 0d0a 2020 2020 2020 2020 2363  ''....        #c
-00050010: 6f6e 7665 7274 206f 626a 6563 745f 746f  onvert object_to
-00050020: 5f63 6865 636b 5f61 6761 696e 7374 2074  _check_against t
-00050030: 6f20 7468 6520 6469 6d65 6e73 696f 6e20  o the dimension 
-00050040: 7765 2077 6973 6820 746f 2063 6865 636b  we wish to check
-00050050: 2069 6620 7765 2068 6176 6520 676f 7420   if we have got 
-00050060: 6120 5369 7465 206f 626a 6563 742c 2074  a Site object, t
-00050070: 6869 7320 6361 7365 2077 696c 6c20 6265  his case will be
-00050080: 2068 616e 646c 6564 2062 656c 6f77 0d0a   handled below..
-00050090: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000500a0: 7461 6e63 6528 6f62 6a65 6374 5f74 6f5f  tance(object_to_
-000500b0: 6368 6563 6b5f 6167 6169 6e73 742c 5369  check_against,Si
-000500c0: 7465 293a 0d0a 2020 2020 2020 2020 2020  te):..          
-000500d0: 2020 6f62 6a65 6374 5f74 6f5f 6368 6563    object_to_chec
-000500e0: 6b5f 6167 6169 6e73 7420 3d20 6f62 6a65  k_against = obje
-000500f0: 6374 5f74 6f5f 6368 6563 6b5f 6167 6169  ct_to_check_agai
-00050100: 6e73 742e 6469 6d65 6e73 696f 6e73 5b64  nst.dimensions[d
-00050110: 696d 656e 7369 6f6e 5f69 6e64 6578 5d0d  imension_index].
-00050120: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
-00050130: 6c66 2e73 6f75 7263 6520 6973 206e 6f74  lf.source is not
-00050140: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00050150: 2020 2020 636f 6c75 6d6e 5f6c 6973 745f      column_list_
-00050160: 746f 5f63 6865 636b 5f61 6761 696e 7374  to_check_against
-00050170: 203d 205b 6320 666f 7220 6320 696e 2073   = [c for c in s
-00050180: 656c 662e 736f 7572 6365 2e63 6f6c 756d  elf.source.colum
-00050190: 6e73 5d0d 0a20 2020 2020 2020 2065 6c73  ns]..        els
-000501a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000501b0: 636f 6c75 6d6e 5f6c 6973 745f 746f 5f63  column_list_to_c
-000501c0: 6865 636b 5f61 6761 696e 7374 203d 204e  heck_against = N
-000501d0: 6f6e 650d 0a0d 0a20 2020 2020 2020 2023  one....        #
-000501e0: 6372 6561 7465 2061 2063 6f6c 756d 6e73  create a columns
-000501f0: 5f64 6963 7420 666f 7220 6661 7374 206c  _dict for fast l
-00050200: 6f6f 6b75 700d 0a20 2020 2020 2020 2069  ookup..        i
-00050210: 6620 636f 6c75 6d6e 5f6c 6973 745f 746f  f column_list_to
-00050220: 5f63 6865 636b 5f61 6761 696e 7374 2069  _check_against i
-00050230: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00050240: 2020 2020 2020 2020 2063 6f6c 756d 6e73           columns
-00050250: 5f64 6963 7420 3d20 7b63 3a63 2066 6f72  _dict = {c:c for
-00050260: 2063 2069 6e20 636f 6c75 6d6e 5f6c 6973   c in column_lis
-00050270: 745f 746f 5f63 6865 636b 5f61 6761 696e  t_to_check_again
-00050280: 7374 7d0d 0a20 2020 2020 2020 2065 6c73  st}..        els
-00050290: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000502a0: 636f 6c75 6d6e 735f 6469 6374 203d 204e  columns_dict = N
-000502b0: 6f6e 650d 0a0d 0a20 2020 2020 2020 2063  one....        c
-000502c0: 6f6c 756d 6e5f 6e61 6d65 7320 3d20 4e6f  olumn_names = No
-000502d0: 6e65 0d0a 0d0a 2020 2020 2020 2020 2357  ne....        #W
-000502e0: 6865 6e20 7468 6572 6520 6973 206e 6f20  hen there is no 
-000502f0: 6d61 7070 696e 672c 2074 6865 2069 6d70  mapping, the imp
-00050300: 6c69 6564 2073 686f 7274 636f 6465 206c  lied shortcode l
-00050310: 6973 7420 6973 204e 6f6e 6520 2d20 6e6f  ist is None - no
-00050320: 7420 5b5d 2c20 6a75 7374 204e 6f6e 650d  t [], just None.
-00050330: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
-00050340: 2020 2020 2020 2020 2020 206d 6170 7069             mappi
-00050350: 6e67 203d 2073 656c 665b 6469 6d65 6e73  ng = self[dimens
-00050360: 696f 6e5f 696e 6465 785d 0d0a 0d0a 2020  ion_index]....  
-00050370: 2020 2020 2020 2020 2020 6966 206d 6170            if map
-00050380: 7069 6e67 2069 7320 4e6f 6e65 3a0d 0a20  ping is None:.. 
-00050390: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000503a0: 6574 7572 6e20 4e6f 6e65 2c20 4e6f 6e65  eturn None, None
-000503b0: 2c20 4e6f 6e65 0d0a 2020 2020 2020 2020  , None..        
-000503c0: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
-000503d0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-000503e0: 7475 726e 204e 6f6e 652c 204e 6f6e 652c  turn None, None,
-000503f0: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
-00050400: 2023 5765 206d 6179 206e 6565 6420 746f   #We may need to
-00050410: 2077 6f72 6b20 6f75 7420 7768 6574 6865   work out whethe
-00050420: 7220 7765 2061 7265 2073 6565 696e 6720  r we are seeing 
-00050430: 610d 0a20 2020 2020 2020 2069 6620 2020  a..        if   
-00050440: 6973 696e 7374 616e 6365 286f 626a 6563  isinstance(objec
-00050450: 745f 746f 5f63 6865 636b 5f61 6761 696e  t_to_check_again
-00050460: 7374 2c44 696d 656e 7369 6f6e 293a 0d0a  st,Dimension):..
-00050470: 2020 2020 2020 2020 2020 2020 656c 656d              elem
-00050480: 656e 7473 5f64 6963 7420 3d20 6f62 6a65  ents_dict = obje
-00050490: 6374 5f74 6f5f 6368 6563 6b5f 6167 6169  ct_to_check_agai
-000504a0: 6e73 742e 656c 656d 656e 7473 0d0a 2020  nst.elements..  
-000504b0: 2020 2020 2020 2020 2020 6669 656c 6473            fields
-000504c0: 5f64 6963 7420 2020 3d20 6f62 6a65 6374  _dict   = object
-000504d0: 5f74 6f5f 6368 6563 6b5f 6167 6169 6e73  _to_check_agains
-000504e0: 742e 6669 656c 6473 0d0a 0d0a 2020 2020  t.fields....    
-000504f0: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00050500: 6e63 6528 6f62 6a65 6374 5f74 6f5f 6368  nce(object_to_ch
-00050510: 6563 6b5f 6167 6169 6e73 742c 5374 7275  eck_against,Stru
-00050520: 6374 7572 6529 3a0d 0a20 2020 2020 2020  cture):..       
-00050530: 2020 2020 2065 6c65 6d65 6e74 735f 6469       elements_di
-00050540: 6374 203d 206f 626a 6563 745f 746f 5f63  ct = object_to_c
-00050550: 6865 636b 5f61 6761 696e 7374 2e64 696d  heck_against.dim
-00050560: 656e 7369 6f6e 2e65 6c65 6d65 6e74 730d  ension.elements.
-00050570: 0a20 2020 2020 2020 2020 2020 2066 6965  .            fie
-00050580: 6c64 735f 6469 6374 2020 203d 206f 626a  lds_dict   = obj
-00050590: 6563 745f 746f 5f63 6865 636b 5f61 6761  ect_to_check_aga
-000505a0: 696e 7374 2e64 696d 656e 7369 6f6e 2e66  inst.dimension.f
-000505b0: 6965 6c64 730d 0a0d 0a20 2020 2020 2020  ields....       
-000505c0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-000505d0: 286f 626a 6563 745f 746f 5f63 6865 636b  (object_to_check
-000505e0: 5f61 6761 696e 7374 2c53 7472 7563 7475  _against,Structu
-000505f0: 7265 456c 656d 656e 7429 3a0d 0a20 2020  reElement):..   
-00050600: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
-00050610: 735f 6469 6374 203d 206f 626a 6563 745f  s_dict = object_
-00050620: 746f 5f63 6865 636b 5f61 6761 696e 7374  to_check_against
-00050630: 2e64 696d 656e 7369 6f6e 2e65 6c65 6d65  .dimension.eleme
-00050640: 6e74 730d 0a20 2020 2020 2020 2020 2020  nts..           
-00050650: 2066 6965 6c64 735f 6469 6374 2020 203d   fields_dict   =
-00050660: 206f 626a 6563 745f 746f 5f63 6865 636b   object_to_check
-00050670: 5f61 6761 696e 7374 2e64 696d 656e 7369  _against.dimensi
-00050680: 6f6e 2e66 6965 6c64 730d 0a20 2020 2020  on.fields..     
-00050690: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-000506a0: 2020 2020 2020 7261 6973 6520 5479 7065        raise Type
-000506b0: 4572 726f 7228 2243 616e 6e6f 7420 6d61  Error("Cannot ma
-000506c0: 7020 746f 206f 626a 6563 7420 7b7d 206f  p to object {} o
-000506d0: 6620 7479 7065 207b 7d22 2e66 6f72 6d61  f type {}".forma
-000506e0: 7428 6f62 6a65 6374 5f74 6f5f 6368 6563  t(object_to_chec
-000506f0: 6b5f 6167 6169 6e73 742c 7479 7065 286f  k_against,type(o
-00050700: 626a 6563 745f 746f 5f63 6865 636b 5f61  bject_to_check_a
-00050710: 6761 696e 7374 2929 290d 0a0d 0a20 2020  gainst)))....   
-00050720: 2020 2020 2069 735f 636f 6e73 7461 6e74       is_constant
-00050730: 5f73 686f 7274 636f 6465 5f6f 725f 636f  _shortcode_or_co
-00050740: 6c75 6d6e 5f69 6d70 6c69 6564 5f73 686f  lumn_implied_sho
-00050750: 7274 636f 6465 5f6d 6170 7069 6e67 203d  rtcode_mapping =
-00050760: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-00050770: 6973 5f66 6965 6c64 5f6f 725f 7368 6f72  is_field_or_shor
-00050780: 7463 6f64 655f 6d61 7070 696e 6720 3d20  tcode_mapping = 
-00050790: 4661 6c73 650d 0a20 2020 2020 2020 2069  False..        i
-000507a0: 735f 7368 6f72 7463 6f64 655f 7661 6c75  s_shortcode_valu
+0004e0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e0d0: 2020 2020 2020 2020 2020 2020 202c 7374               ,st
+0004e0e0: 7275 6374 7572 655f 656c 656d 656e 745f  ructure_element_
+0004e0f0: 7061 7468 203d 2073 656c 662e 7061 7468  path = self.path
+0004e100: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e140: 2c66 6965 6c64 5f73 686f 7274 6e61 6d65  ,field_shortname
+0004e150: 2020 2020 3d20 7365 6c66 2e66 6965 6c64      = self.field
+0004e160: 5f73 686f 7274 6e61 6d65 0d0a 2020 2020  _shortname..    
+0004e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e1a0: 2020 2020 2020 2020 2020 290d 0a0d 0a20            ).... 
+0004e1b0: 2020 2020 2020 2023 544f 444f 202d 2065         #TODO - e
+0004e1c0: 6e73 7572 6520 7765 2068 6176 6520 6e6f  nsure we have no
+0004e1d0: 2064 7570 6c69 6361 7465 7320 696e 2074   duplicates in t
+0004e1e0: 6865 2074 7261 6e73 6c61 7469 6f6e 2064  he translation d
+0004e1f0: 660d 0a0d 0a20 2020 2020 2020 2023 5075  f....        #Pu
+0004e200: 7420 6f75 7420 6120 7665 7279 2063 6c65  t out a very cle
+0004e210: 6172 206d 6573 7361 6765 202d 2077 6520  ar message - we 
+0004e220: 6361 6e27 7420 6c6f 6164 2069 6620 7468  can't load if th
+0004e230: 6520 7472 616e 736c 6174 696f 6e20 6861  e translation ha
+0004e240: 7320 6475 706c 6963 6174 6573 2c20 616e  s duplicates, an
+0004e250: 6420 7468 6520 7265 6d65 6469 616c 2061  d the remedial a
+0004e260: 6374 696f 6e20 6164 7669 7365 640d 0a0d  ction advised...
+0004e270: 0a0d 0a20 2020 2020 2020 2063 6f6c 756d  ...        colum
+0004e280: 6e73 5f66 6f72 5f65 7870 6c6f 7369 6f6e  ns_for_explosion
+0004e290: 203d 205f 7472 616e 736c 6174 655f 6469   = _translate_di
+0004e2a0: 6d28 6466 2020 2020 2020 2020 2020 2020  m(df            
+0004e2b0: 2020 3d20 6461 7461 6672 616d 650d 0a20    = dataframe.. 
+0004e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e2e0: 2020 2020 2020 2020 2020 2020 202c 6469               ,di
+0004e2f0: 6d5f 6964 656e 7469 6669 6572 2020 3d20  m_identifier  = 
+0004e300: 7365 6c66 2e63 6f6c 756d 6e5f 6e61 6d65  self.column_name
+0004e310: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e340: 2c64 696d 5f74 7970 6520 2020 2020 2020  ,dim_type       
+0004e350: 203d 2073 656c 662e 636f 6c75 6d6e 5f74   = self.column_t
+0004e360: 7970 650d 0a20 2020 2020 2020 2020 2020  ype..           
+0004e370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e390: 2020 202c 7472 616e 736c 6174 655f 6466     ,translate_df
+0004e3a0: 2020 2020 3d20 7472 616e 736c 6174 696f      = translatio
+0004e3b0: 6e5f 6466 0d0a 2020 2020 2020 2020 2020  n_df..          
+0004e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e3e0: 2020 2020 2c66 6965 6c64 5f73 686f 7274      ,field_short
+0004e3f0: 6e61 6d65 203d 2073 656c 662e 6669 656c  name = self.fiel
+0004e400: 645f 7368 6f72 746e 616d 650d 0a20 2020  d_shortname..   
+0004e410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004e430: 2020 2020 2020 2020 2020 2029 0d0a 0d0a             )....
+0004e440: 2020 2020 2020 2020 2372 6574 7572 6e20          #return 
+0004e450: 7468 6520 636f 6c75 6d6e 7320 6372 6561  the columns crea
+0004e460: 7465 6420 696e 2074 6865 206d 6170 7069  ted in the mappi
+0004e470: 6e67 202d 2069 2e65 2e20 7468 6520 6f6e  ng - i.e. the on
+0004e480: 6573 2074 6861 7420 7769 6c6c 2062 6520  es that will be 
+0004e490: 7573 6564 2069 6e20 7468 6520 6578 706c  used in the expl
+0004e4a0: 6f73 696f 6e0d 0a20 2020 2020 2020 2072  osion..        r
+0004e4b0: 6574 7572 6e20 636f 6c75 6d6e 735f 666f  eturn columns_fo
+0004e4c0: 725f 6578 706c 6f73 696f 6e0d 0a0d 0a63  r_explosion....c
+0004e4d0: 6c61 7373 2043 6f6c 756d 6e4d 6170 7065  lass ColumnMappe
+0004e4e0: 7228 5461 626c 6545 6d70 6f77 6572 4d61  r(TableEmpowerMa
+0004e4f0: 7070 6572 293a 0d0a 2020 2020 2727 2755  pper):..    '''U
+0004e500: 7469 6c69 7479 206f 626a 6563 7420 666f  tility object fo
+0004e510: 7220 666f 7220 7573 6520 7769 7468 2060  r for use with `
+0004e520: 4c6f 6164 6572 6073 2c20 6465 7369 676e  Loader`s, design
+0004e530: 6564 2074 6f20 6d61 7020 636f 6c75 6d6e  ed to map column
+0004e540: 7320 696e 2061 2070 616e 6461 7320 4461  s in a pandas Da
+0004e550: 7461 4672 616d 6520 746f 2074 6865 2070  taFrame to the p
+0004e560: 6879 7369 6361 6c20 6964 656e 7469 6669  hysical identifi
+0004e570: 6572 7320 6f66 2074 6865 2045 6d70 6f77  ers of the Empow
+0004e580: 6572 2045 6c65 6d65 6e74 7320 7765 2077  er Elements we w
+0004e590: 616e 7420 746f 206c 6f61 6420 6167 6169  ant to load agai
+0004e5a0: 6e73 742e 2727 270d 0a0d 0a20 2020 2064  nst.'''....    d
+0004e5b0: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+0004e5c0: 2c63 6f6c 756d 6e5f 6e61 6d65 2c63 6f6c  ,column_name,col
+0004e5d0: 756d 6e5f 7479 7065 2c66 6965 6c64 5f73  umn_type,field_s
+0004e5e0: 686f 7274 6e61 6d65 293a 0d0a 2020 2020  hortname):..    
+0004e5f0: 2020 2020 2727 2743 7265 6174 6520 6120      '''Create a 
+0004e600: 6e65 7720 436f 6c75 6d6e 4d61 7070 6572  new ColumnMapper
+0004e610: 2c20 6120 5574 696c 6974 7920 6f62 6a65  , a Utility obje
+0004e620: 6374 2066 6f72 2066 6f72 2075 7365 2077  ct for for use w
+0004e630: 6974 6820 604c 6f61 6465 7260 732c 2064  ith `Loader`s, d
+0004e640: 6573 6967 6e65 6420 746f 206d 6170 2063  esigned to map c
+0004e650: 6f6c 756d 6e73 2069 6e20 6120 7061 6e64  olumns in a pand
+0004e660: 6173 2044 6174 6146 7261 6d65 2074 6f20  as DataFrame to 
+0004e670: 7468 6520 7068 7973 6963 616c 2069 6465  the physical ide
+0004e680: 6e74 6966 6965 7273 206f 6620 7468 6520  ntifiers of the 
+0004e690: 456d 706f 7765 7220 456c 656d 656e 7473  Empower Elements
+0004e6a0: 2077 6520 7761 6e74 2074 6f20 6c6f 6164   we want to load
+0004e6b0: 2061 6761 696e 7374 2e0d 0a0d 0a20 2020   against.....   
+0004e6c0: 2020 2020 204d 6170 7320 6120 4461 7461       Maps a Data
+0004e6d0: 4672 616d 6520 636f 6c75 6d6e 2068 6f6c  Frame column hol
+0004e6e0: 6469 6e67 2065 6974 6865 722c 2073 686f  ding either, sho
+0004e6f0: 7274 6e61 6d65 2c20 6c6f 6e67 6e61 6d65  rtname, longname
+0004e700: 206f 7220 6669 656c 6420 7661 6c75 6520   or field value 
+0004e710: 666f 7220 6c65 6166 206c 6576 656c 2074  for leaf level t
+0004e720: 7261 6e73 6c61 7469 6f6e 0d0a 0d0a 2020  ranslation....  
+0004e730: 2020 2020 2020 3a70 6172 616d 2063 6f6c        :param col
+0004e740: 756d 6e5f 6e61 6d65 3a20 5468 6520 6e61  umn_name: The na
+0004e750: 6d65 206f 6620 7468 6520 636f 6c75 6d6e  me of the column
+0004e760: 2069 6e20 7468 6520 7061 6e64 6173 2044   in the pandas D
+0004e770: 6174 6146 7261 6d65 0d0a 2020 2020 2020  ataFrame..      
+0004e780: 2020 3a70 6172 616d 2063 6f6c 756d 6e5f    :param column_
+0004e790: 7479 7065 3a20 6f6e 6520 6f66 2027 7068  type: one of 'ph
+0004e7a0: 7973 6964 272c 2027 7368 6f72 746e 616d  ysid', 'shortnam
+0004e7b0: 6527 2c20 276c 6f6e 676e 616d 6527 206f  e', 'longname' o
+0004e7c0: 7220 2766 6965 6c64 270d 0a20 2020 2020  r 'field'..     
+0004e7d0: 2020 203a 7061 7261 6d20 6669 656c 645f     :param field_
+0004e7e0: 7368 6f72 746e 616d 653a 2057 6865 6e20  shortname: When 
+0004e7f0: 7468 6973 2069 7320 7365 742c 2074 6865  this is set, the
+0004e800: 2076 616c 7565 7320 696e 2074 6865 2063   values in the c
+0004e810: 6f6c 756d 6e20 7769 6c6c 2062 6520 7472  olumn will be tr
+0004e820: 616e 736c 6174 6564 2066 726f 6d20 7468  anslated from th
+0004e830: 6520 6669 656c 6420 696e 2074 6865 2064  e field in the d
+0004e840: 696d 656e 7369 6f6e 2077 6974 6820 7468  imension with th
+0004e850: 6174 2073 686f 7274 6e61 6d65 2e20 5573  at shortname. Us
+0004e860: 6520 7769 7468 2063 6f6c 756d 6e5f 7479  e with column_ty
+0004e870: 7065 203d 2027 6669 656c 6427 0d0a 2020  pe = 'field'..  
+0004e880: 2020 2020 2020 2727 270d 0a0d 0a0d 0a20        '''...... 
+0004e890: 2020 2020 2020 2073 656c 662e 636f 6c75         self.colu
+0004e8a0: 6d6e 5f6e 616d 6520 3d20 636f 6c75 6d6e  mn_name = column
+0004e8b0: 5f6e 616d 650d 0a20 2020 2020 2020 2073  _name..        s
+0004e8c0: 656c 662e 636f 6c75 6d6e 5f74 7970 6520  elf.column_type 
+0004e8d0: 3d20 636f 6c75 6d6e 5f74 7970 650d 0a20  = column_type.. 
+0004e8e0: 2020 2020 2020 2073 656c 662e 6669 656c         self.fiel
+0004e8f0: 645f 7368 6f72 746e 616d 6520 3d20 6669  d_shortname = fi
+0004e900: 656c 645f 7368 6f72 746e 616d 650d 0a0d  eld_shortname...
+0004e910: 0a20 2020 2064 6566 206d 6170 5f64 6174  .    def map_dat
+0004e920: 6166 7261 6d65 2873 656c 662c 2064 6174  aframe(self, dat
+0004e930: 6166 7261 6d65 2c64 696d 656e 7369 6f6e  aframe,dimension
+0004e940: 2c6c 6f61 6465 7229 3a0d 0a20 2020 2020  ,loader):..     
+0004e950: 2020 2027 2727 5472 616e 7366 6f72 6d20     '''Transform 
+0004e960: 6120 7061 6e64 6173 2044 6174 6146 7261  a pandas DataFra
+0004e970: 6d65 2c20 6164 6469 6e67 2069 6e20 6120  me, adding in a 
+0004e980: 636f 6c75 6d6e 2063 6f6e 7461 696e 696e  column containin
+0004e990: 6720 456d 706f 7765 7220 456c 656d 656e  g Empower Elemen
+0004e9a0: 7420 7068 7973 6964 7320 2870 6879 7369  t physids (physi
+0004e9b0: 6361 6c20 6964 656e 7469 6669 6572 7329  cal identifiers)
+0004e9c0: 2074 6861 7420 6361 6e20 6265 2075 7365   that can be use
+0004e9d0: 6420 696e 2061 6e20 456d 706f 7765 7220  d in an Empower 
+0004e9e0: 6275 6c6b 206c 6f61 6420 7072 6f63 6573  bulk load proces
+0004e9f0: 732e 0d0a 0d0a 2020 2020 2020 2020 5265  s.....        Re
+0004ea00: 7475 726e 7320 6120 6c69 7374 206f 6620  turns a list of 
+0004ea10: 7468 6520 6e61 6d65 7320 6f66 2074 6865  the names of the
+0004ea20: 2063 6f6c 756d 6e73 2074 6861 7420 6861   columns that ha
+0004ea30: 7665 2062 6565 6e20 6372 6561 7465 6420  ve been created 
+0004ea40: 6279 2074 6865 206d 6170 7069 6e67 2070  by the mapping p
+0004ea50: 726f 6365 7373 2e0d 0a0d 0a20 2020 2020  rocess.....     
+0004ea60: 2020 203a 7061 7261 6d20 6461 7461 6672     :param datafr
+0004ea70: 616d 653a 2054 6865 2070 616e 6461 7320  ame: The pandas 
+0004ea80: 6461 7461 6672 616d 6520 6265 696e 6720  dataframe being 
+0004ea90: 7472 616e 7366 6f72 6d65 642e 0d0a 2020  transformed...  
+0004eaa0: 2020 2020 2020 3a70 6172 616d 2064 696d        :param dim
+0004eab0: 656e 7369 6f6e 3a20 4469 6d65 6e73 696f  ension: Dimensio
+0004eac0: 6e20 6265 696e 6720 6d61 7070 6564 2e20  n being mapped. 
+0004ead0: 5369 6e63 6520 7765 206f 6e6c 7920 6b6e  Since we only kn
+0004eae0: 6f77 2074 6865 2073 686f 7274 6e61 6d65  ow the shortname
+0004eaf0: 2c20 6c6f 6e67 6e61 6d65 206f 7220 6669  , longname or fi
+0004eb00: 656c 6420 6265 696e 6720 6d61 7070 6564  eld being mapped
+0004eb10: 2077 6520 6e65 6564 2074 6865 2064 696d   we need the dim
+0004eb20: 656e 7369 6f6e 2074 6f20 7472 616e 736c  ension to transl
+0004eb30: 6174 6520 7468 6520 7374 7269 6e67 2076  ate the string v
+0004eb40: 616c 7565 730d 0a20 2020 2020 2020 203a  alues..        :
+0004eb50: 7061 7261 6d20 6c6f 6164 6572 3a20 4465  param loader: De
+0004eb60: 7072 6563 6174 6564 0d0a 2020 2020 2020  precated..      
+0004eb70: 2020 2727 270d 0a0d 0a20 2020 2020 2020    '''....       
+0004eb80: 2023 576f 726b 206f 7574 2074 6865 2063   #Work out the c
+0004eb90: 6f6c 756d 6e20 7479 7065 0d0a 2020 2020  olumn type..    
+0004eba0: 2020 2020 2369 6620 6974 2069 7320 6120      #if it is a 
+0004ebb0: 7374 7269 6e67 2063 6f6c 756d 6e2c 2074  string column, t
+0004ebc0: 6865 6e20 6173 7375 6d65 2069 7420 6973  hen assume it is
+0004ebd0: 2061 2073 686f 7274 6e61 6d65 0d0a 2020   a shortname..  
+0004ebe0: 2020 2020 2020 2349 6620 6974 2069 7320        #If it is 
+0004ebf0: 616e 2069 6e74 2063 6f6c 756d 6e2c 2074  an int column, t
+0004ec00: 6865 6e20 6173 7375 6d65 2069 7420 6973  hen assume it is
+0004ec10: 2061 2070 6879 7369 6420 2873 6f20 646f   a physid (so do
+0004ec20: 6e27 7420 646f 2061 6e79 7468 696e 6720  n't do anything 
+0004ec30: 7769 7468 2069 7420 6174 2061 6c6c 0d0a  with it at all..
+0004ec40: 0d0a 2020 2020 2020 2020 7472 616e 736c  ..        transl
+0004ec50: 6174 696f 6e5f 6466 203d 2064 696d 656e  ation_df = dimen
+0004ec60: 7369 6f6e 2e5f 6765 745f 7369 6d70 6c65  sion._get_simple
+0004ec70: 5f74 7261 6e73 6c61 7469 6f6e 5f64 6628  _translation_df(
+0004ec80: 6f75 7470 7574 5f63 6f6c 756d 6e5f 6e61  output_column_na
+0004ec90: 6d65 203d 2027 6469 6d5f 272b 7374 7228  me = 'dim_'+str(
+0004eca0: 6469 6d65 6e73 696f 6e2e 696e 6465 7829  dimension.index)
+0004ecb0: 2b27 5f70 6879 7369 645f 666f 725f 272b  +'_physid_for_'+
+0004ecc0: 7365 6c66 2e63 6f6c 756d 6e5f 6e61 6d65  self.column_name
+0004ecd0: 2c66 6965 6c64 5f73 686f 7274 6e61 6d65  ,field_shortname
+0004ece0: 3d73 656c 662e 6669 656c 645f 7368 6f72  =self.field_shor
+0004ecf0: 746e 616d 6529 0d0a 0d0a 2020 2020 2020  tname)....      
+0004ed00: 2020 636f 6c75 6d6e 735f 666f 725f 6578    columns_for_ex
+0004ed10: 706c 6f73 696f 6e20 3d20 5f74 7261 6e73  plosion = _trans
+0004ed20: 6c61 7465 5f64 696d 2864 6620 2020 2020  late_dim(df     
+0004ed30: 2020 2020 2020 2020 203d 2064 6174 6166           = dataf
+0004ed40: 7261 6d65 0d0a 2020 2020 2020 2020 2020  rame..          
+0004ed50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ed60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ed70: 2020 2020 2c64 696d 5f69 6465 6e74 6966      ,dim_identif
+0004ed80: 6965 7220 203d 2073 656c 662e 636f 6c75  ier  = self.colu
+0004ed90: 6d6e 5f6e 616d 650d 0a20 2020 2020 2020  mn_name..       
+0004eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004edb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004edc0: 2020 2020 2020 202c 6469 6d5f 7479 7065         ,dim_type
+0004edd0: 2020 2020 2020 2020 3d20 7365 6c66 2e63          = self.c
+0004ede0: 6f6c 756d 6e5f 7479 7065 0d0a 2020 2020  olumn_type..    
+0004edf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ee10: 2020 2020 2020 2020 2020 2c74 7261 6e73            ,trans
+0004ee20: 6c61 7465 5f64 6620 2020 203d 2074 7261  late_df    = tra
+0004ee30: 6e73 6c61 7469 6f6e 5f64 660d 0a20 2020  nslation_df..   
+0004ee40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ee50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004ee60: 2020 2020 2020 2020 2020 202c 6669 656c             ,fiel
+0004ee70: 645f 7368 6f72 746e 616d 6520 3d20 7365  d_shortname = se
+0004ee80: 6c66 2e66 6965 6c64 5f73 686f 7274 6e61  lf.field_shortna
+0004ee90: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
+0004eea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004eec0: 2020 290d 0a0d 0a20 2020 2020 2020 2023    )....        #
+0004eed0: 7265 7475 726e 2074 6865 2063 6f6c 756d  return the colum
+0004eee0: 6e73 2063 7265 6174 6564 2069 6e20 7468  ns created in th
+0004eef0: 6520 6d61 7070 696e 6720 2d20 692e 652e  e mapping - i.e.
+0004ef00: 2074 6865 206f 6e65 7320 7468 6174 2077   the ones that w
+0004ef10: 696c 6c20 6265 2075 7365 6420 696e 2074  ill be used in t
+0004ef20: 6865 2065 7870 6c6f 7369 6f6e 0d0a 2020  he explosion..  
+0004ef30: 2020 2020 2020 7265 7475 726e 2063 6f6c        return col
+0004ef40: 756d 6e73 5f66 6f72 5f65 7870 6c6f 7369  umns_for_explosi
+0004ef50: 6f6e 0d0a 0d0a 0d0a 636c 6173 7320 4375  on......class Cu
+0004ef60: 6265 4d61 7070 6572 286f 626a 6563 7429  beMapper(object)
+0004ef70: 3a0d 0a20 2020 2027 2727 436c 6173 7320  :..    '''Class 
+0004ef80: 7768 6963 6820 6d61 7073 2061 2074 6162  which maps a tab
+0004ef90: 6c65 2028 7061 6e64 6173 2044 6174 6146  le (pandas DataF
+0004efa0: 7261 6d65 2920 746f 2061 2046 6f63 7573  rame) to a Focus
+0004efb0: 0d0a 2020 2020 436f 6e74 6169 6e73 2074  ..    Contains t
+0004efc0: 6865 206c 6f67 6963 2066 6f72 2074 7572  he logic for tur
+0004efd0: 6e69 6e67 2064 6963 7469 6f6e 6172 6965  ning dictionarie
+0004efe0: 7320 696e 746f 206d 6f72 6520 636f 6d70  s into more comp
+0004eff0: 6c65 7820 6d61 7070 696e 6720 6f62 6a65  lex mapping obje
+0004f000: 6374 7320 7768 6963 6820 6172 6520 456d  cts which are Em
+0004f010: 706f 7765 7220 7374 7275 6374 7572 6520  power structure 
+0004f020: 6177 6172 652c 2061 6e64 2066 6f72 2069  aware, and for i
+0004f030: 6e66 6572 7269 6e67 206d 6170 7069 6e67  nferring mapping
+0004f040: 2069 6e66 6f72 6d61 7469 6f6e 0d0a 2020   information..  
+0004f050: 2020 2727 270d 0a0d 0a20 2020 2064 6566    '''....    def
+0004f060: 205f 5f69 6e69 745f 5f28 7365 6c66 2c6d   __init__(self,m
+0004f070: 6170 7069 6e67 733d 4e6f 6e65 2c74 6172  appings=None,tar
+0004f080: 6765 7420 3d20 4e6f 6e65 2c20 736f 7572  get = None, sour
+0004f090: 6365 203d 204e 6f6e 6529 3a0d 0a0d 0a20  ce = None):.... 
+0004f0a0: 2020 2020 2020 2073 656c 662e 5f6d 6170         self._map
+0004f0b0: 7065 7273 203d 207b 7d0d 0a0d 0a20 2020  pers = {}....   
+0004f0c0: 2020 2020 2073 656c 662e 5f69 6e69 7469       self._initi
+0004f0d0: 616c 5f74 6172 6765 7420 3d20 7461 7267  al_target = targ
+0004f0e0: 6574 0d0a 2020 2020 2020 2020 7365 6c66  et..        self
+0004f0f0: 2e5f 696e 6974 6961 6c5f 736f 7572 6365  ._initial_source
+0004f100: 203d 2073 6f75 7263 650d 0a0d 0a20 2020   = source....   
+0004f110: 2020 2020 2023 496e 6974 6961 6c69 7365       #Initialise
+0004f120: 2065 6d70 7479 206d 6170 7065 7273 0d0a   empty mappers..
+0004f130: 2020 2020 2020 2020 666f 7220 6e20 696e          for n in
+0004f140: 2072 616e 6765 2831 3329 3a0d 0a20 2020   range(13):..   
+0004f150: 2020 2020 2020 2020 2073 656c 662e 5f6d           self._m
+0004f160: 6170 7065 7273 5b6e 5d20 3d20 4e6f 6e65  appers[n] = None
+0004f170: 0d0a 0d0a 2020 2020 2020 2020 6966 206d  ....        if m
+0004f180: 6170 7069 6e67 7320 6973 206e 6f74 204e  appings is not N
+0004f190: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0004f1a0: 2020 234e 6f77 2070 7574 2074 6865 206d    #Now put the m
+0004f1b0: 6170 7069 6e67 7320 7765 2776 6520 6265  appings we've be
+0004f1c0: 656e 2067 6976 656e 2069 6e74 6f20 706c  en given into pl
+0004f1d0: 6163 650d 0a20 2020 2020 2020 2020 2020  ace..           
+0004f1e0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+0004f1f0: 2020 2020 2020 2023 4966 2074 6865 206d         #If the m
+0004f200: 6170 7065 7273 206f 626a 6563 7420 6973  appers object is
+0004f210: 2061 2064 6963 7420 6c69 6b65 2c20 7468   a dict like, th
+0004f220: 656e 2067 6f20 6f76 6572 2074 6865 206b  en go over the k
+0004f230: 6579 7320 2877 6869 6368 2072 6566 6572  eys (which refer
+0004f240: 2074 6f20 6469 6d65 6e73 696f 6e73 2077   to dimensions w
+0004f250: 6520 686f 7065 290d 0a20 2020 2020 2020  e hope)..       
+0004f260: 2020 2020 2020 2020 2066 6f72 206b 2c76           for k,v
+0004f270: 2069 6e20 6d61 7070 696e 6773 2e69 7465   in mappings.ite
+0004f280: 6d73 2829 3a0d 0a20 2020 2020 2020 2020  ms():..         
+0004f290: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+0004f2a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0004f2b0: 2020 2020 2020 2020 2073 656c 665b 6b5d           self[k]
+0004f2c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004f2d0: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
+0004f2e0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+0004f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f300: 7261 6973 6520 4b65 7945 7272 6f72 2822  raise KeyError("
+0004f310: 6d61 7070 696e 6773 5b7b 7d5d 2063 616e  mappings[{}] can
+0004f320: 6e6f 7420 6265 2073 6574 2062 6563 6175  not be set becau
+0004f330: 7365 206f 6e6c 7920 696e 7465 6765 7220  se only integer 
+0004f340: 696e 6465 7865 6420 6f72 206c 6f6e 676e  indexed or longn
+0004f350: 616d 6520 6d61 7070 696e 6773 2061 7265  ame mappings are
+0004f360: 2068 616e 646c 6564 202d 2073 6574 2065   handled - set e
+0004f370: 6163 6820 6d61 7070 696e 6727 7320 6b65  ach mapping's ke
+0004f380: 7973 2074 6f20 616e 2069 6e74 6567 6572  ys to an integer
+0004f390: 2062 6574 7765 656e 2030 2061 6e64 2031   between 0 and 1
+0004f3a0: 3220 6f72 2074 6865 206c 6f6e 676e 616d  2 or the longnam
+0004f3b0: 6520 6f66 2074 6865 2064 696d 656e 7369  e of the dimensi
+0004f3c0: 6f6e 222e 666f 726d 6174 286b 2929 0d0a  on".format(k))..
+0004f3d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004f3e0: 2020 2020 2020 7365 6c66 5b6b 5d20 3d20        self[k] = 
+0004f3f0: 760d 0a0d 0a20 2020 2020 2020 2020 2020  v....           
+0004f400: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
+0004f410: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
+0004f420: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+0004f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f440: 2020 2066 6f72 206d 6170 7069 6e67 2069     for mapping i
+0004f450: 6e20 6d61 7070 696e 6773 3a0d 0a20 2020  n mappings:..   
+0004f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f470: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
+0004f480: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0004f490: 7420 5479 7065 4572 726f 723a 0d0a 2020  t TypeError:..  
+0004f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f4b0: 2020 7261 6973 650d 0a0d 0a20 2020 2064    raise....    d
+0004f4c0: 6566 205f 5f67 6574 6974 656d 5f5f 2873  ef __getitem__(s
+0004f4d0: 656c 662c 6974 656d 293a 0d0a 2020 2020  elf,item):..    
+0004f4e0: 2020 2020 696e 6465 7820 3d20 4e6f 6e65      index = None
+0004f4f0: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
+0004f500: 6e73 7461 6e63 6528 6974 656d 2c69 6e74  nstance(item,int
+0004f510: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+0004f520: 696e 6465 7820 3d20 6974 656d 0d0a 2020  index = item..  
+0004f530: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0004f540: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+0004f550: 6e20 7261 6e67 6528 3133 293a 0d0a 2020  n range(13):..  
+0004f560: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+0004f570: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+0004f580: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0004f590: 7461 7267 6574 2e73 6974 652e 6469 6d65  target.site.dime
+0004f5a0: 6e73 696f 6e73 5b69 5d2e 6c6f 6e67 6e61  nsions[i].longna
+0004f5b0: 6d65 203d 3d20 6974 656d 3a0d 0a20 2020  me == item:..   
+0004f5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f5d0: 2020 2020 2069 6e64 6578 203d 2069 0d0a       index = i..
+0004f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f5f0: 6578 6365 7074 2028 4174 7472 6962 7574  except (Attribut
+0004f600: 6545 7272 6f72 2c4b 6579 4572 726f 7229  eError,KeyError)
+0004f610: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004f620: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
+0004f630: 2020 2020 2020 2069 6620 696e 6465 7820         if index 
+0004f640: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+0004f650: 2020 2020 2020 7261 6973 6520 4b65 7945        raise KeyE
+0004f660: 7272 6f72 2827 4469 6d65 6e73 696f 6e5b  rror('Dimension[
+0004f670: 7b7d 5d20 7761 7320 6e6f 7420 666f 756e  {}] was not foun
+0004f680: 6420 696e 2073 6974 6527 2e66 6f72 6d61  d in site'.forma
+0004f690: 7428 6974 656d 2920 290d 0a0d 0a20 2020  t(item) )....   
+0004f6a0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0004f6b0: 2e5f 6d61 7070 6572 735b 696e 6465 785d  ._mappers[index]
+0004f6c0: 0d0a 0d0a 2020 2020 6465 6620 5f5f 7365  ....    def __se
+0004f6d0: 7469 7465 6d5f 5f28 7365 6c66 2c69 7465  titem__(self,ite
+0004f6e0: 6d2c 7661 6c75 6529 3a0d 0a20 2020 2020  m,value):..     
+0004f6f0: 2020 2069 6e64 6578 203d 204e 6f6e 650d     index = None.
+0004f700: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
+0004f710: 7374 616e 6365 2869 7465 6d2c 696e 7429  stance(item,int)
+0004f720: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
+0004f730: 6e64 6578 203d 2069 7465 6d0d 0a20 2020  ndex = item..   
+0004f740: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+0004f750: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+0004f760: 2072 616e 6765 2831 3329 3a0d 0a20 2020   range(13):..   
+0004f770: 2020 2020 2020 2020 2020 2020 2074 7279               try
+0004f780: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0004f790: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
+0004f7a0: 6172 6765 742e 7369 7465 2e64 696d 656e  arget.site.dimen
+0004f7b0: 7369 6f6e 735b 695d 2e6c 6f6e 676e 616d  sions[i].longnam
+0004f7c0: 6520 3d3d 2069 7465 6d3a 0d0a 2020 2020  e == item:..    
+0004f7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0004f7e0: 2020 2020 696e 6465 7820 3d20 690d 0a20      index = i.. 
+0004f7f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0004f800: 7863 6570 7420 2841 7474 7269 6275 7465  xcept (Attribute
+0004f810: 4572 726f 722c 4b65 7945 7272 6f72 293a  Error,KeyError):
+0004f820: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0004f830: 2020 2020 2020 7061 7373 0d0a 0d0a 2020        pass....  
+0004f840: 2020 2020 2020 6966 2069 6e64 6578 2069        if index i
+0004f850: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+0004f860: 2020 2020 2072 6169 7365 204b 6579 4572       raise KeyEr
+0004f870: 726f 7228 2744 696d 656e 7369 6f6e 5b7b  ror('Dimension[{
+0004f880: 7d5d 2077 6173 206e 6f74 2066 6f75 6e64  }] was not found
+0004f890: 2069 6e20 7369 7465 272e 666f 726d 6174   in site'.format
+0004f8a0: 2869 7465 6d29 2029 0d0a 0d0a 2020 2020  (item) )....    
+0004f8b0: 2020 2020 7365 6c66 2e5f 6d61 7070 6572      self._mapper
+0004f8c0: 735b 696e 6465 785d 203d 2076 616c 7565  s[index] = value
+0004f8d0: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+0004f8e0: 790d 0a20 2020 2064 6566 2074 6172 6765  y..    def targe
+0004f8f0: 7428 7365 6c66 293a 0d0a 2020 2020 2020  t(self):..      
+0004f900: 2020 7265 7475 726e 2073 656c 662e 5f69    return self._i
+0004f910: 6e69 7469 616c 5f74 6172 6765 740d 0a20  nitial_target.. 
+0004f920: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+0004f930: 2020 6465 6620 736f 7572 6365 2873 656c    def source(sel
+0004f940: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
+0004f950: 7572 6e20 7365 6c66 2e5f 696e 6974 6961  urn self._initia
+0004f960: 6c5f 736f 7572 6365 0d0a 2020 2020 4070  l_source..    @p
+0004f970: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+0004f980: 2073 6974 6528 7365 6c66 293a 0d0a 2020   site(self):..  
+0004f990: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0004f9a0: 662e 7461 7267 6574 2e73 6974 650d 0a0d  f.target.site...
+0004f9b0: 0a20 2020 2040 7072 6f70 6572 7479 0d0a  .    @property..
+0004f9c0: 2020 2020 6465 6620 636f 6c75 6d6e 7328      def columns(
+0004f9d0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+0004f9e0: 7265 7475 726e 205b 6320 666f 7220 6320  return [c for c 
+0004f9f0: 696e 2073 656c 662e 736f 7572 6365 2e63  in self.source.c
+0004fa00: 6f6c 756d 6e73 5d0d 0a0d 0a0d 0a0d 0a20  olumns]........ 
+0004fa10: 2020 2064 6566 205f 6765 745f 696d 706c     def _get_impl
+0004fa20: 6965 645f 7368 6f72 7463 6f64 655f 6c69  ied_shortcode_li
+0004fa30: 7374 5f61 6e64 5f6d 6170 7069 6e67 5f74  st_and_mapping_t
+0004fa40: 7970 6528 7365 6c66 2c20 6469 6d65 6e73  ype(self, dimens
+0004fa50: 696f 6e5f 696e 6465 782c 206f 626a 6563  ion_index, objec
+0004fa60: 745f 746f 5f63 6865 636b 5f61 6761 696e  t_to_check_again
+0004fa70: 7374 2c20 636f 6c75 6d6e 5f6c 6973 745f  st, column_list_
+0004fa80: 746f 5f63 6865 636b 5f61 6761 696e 7374  to_check_against
+0004fa90: 203d 204e 6f6e 6529 3a0d 0a20 2020 2020   = None):..     
+0004faa0: 2020 2027 2727 0d0a 2020 2020 2020 2020     '''..        
+0004fab0: 4765 7420 6120 6c69 7374 206f 6620 7368  Get a list of sh
+0004fac0: 6f72 7463 6f64 6573 2069 6d70 6c69 6564  ortcodes implied
+0004fad0: 2062 7920 7468 6520 7468 6973 206f 626a   by the this obj
+0004fae0: 6563 7427 7320 6d61 7070 696e 6720 666f  ect's mapping fo
+0004faf0: 7220 6120 6769 7665 6e20 6469 6d65 6e73  r a given dimens
+0004fb00: 696f 6e5f 696e 6465 782c 2067 6976 656e  ion_index, given
+0004fb10: 2061 6e20 6f62 6a65 6374 2074 6861 7420   an object that 
+0004fb20: 6d69 6768 7420 636f 6e74 6169 6e20 7468  might contain th
+0004fb30: 6f73 6520 7368 6f72 7463 6f64 6573 0d0a  ose shortcodes..
+0004fb40: 0d0a 2020 2020 2020 2020 652e 672e 2027  ..        e.g. '
+0004fb50: 765f 4c4f 4e47 2720 636f 756c 6420 6265  v_LONG' could be
+0004fb60: 2061 2063 6f6e 7374 616e 7420 7368 6f72   a constant shor
+0004fb70: 746e 616d 652c 206f 7220 6120 636f 6c75  tname, or a colu
+0004fb80: 6d6e 2068 6f6c 6469 6e67 2073 686f 7274  mn holding short
+0004fb90: 6e61 6d65 730d 0a20 2020 2020 2020 2020  names..         
+0004fba0: 2020 2020 7b27 466f 6f27 3a27 4261 7227      {'Foo':'Bar'
+0004fbb0: 7d20 636f 756c 6420 6265 2061 6e20 696e  } could be an in
+0004fbc0: 6469 6361 746f 7220 7374 796c 6520 6d65  dicator style me
+0004fbd0: 7472 6963 2064 6963 7469 6f6e 6172 7920  tric dictionary 
+0004fbe0: 2d20 636f 6c75 6d6e 2046 6f6f 2068 6f6c  - column Foo hol
+0004fbf0: 6473 2076 616c 7565 7320 746f 2067 6f20  ds values to go 
+0004fc00: 746f 206d 6574 7269 6320 7368 6f72 746e  to metric shortn
+0004fc10: 616d 6520 4261 722c 206f 7220 6120 636f  ame Bar, or a co
+0004fc20: 6c75 6d6e 2d66 6965 6c64 2064 6963 7469  lumn-field dicti
+0004fc30: 6f6e 6172 7920 636f 6c75 6d6e 2046 6f6f  onary column Foo
+0004fc40: 2067 6f65 7320 746f 2066 6965 6c64 2042   goes to field B
+0004fc50: 6172 206f 6e20 6469 6d65 6e73 696f 6e20  ar on dimension 
+0004fc60: 780d 0a20 2020 2020 2020 2020 2020 2020  x..             
+0004fc70: 7b27 466f 6f27 3a7b 2742 6172 273a 312c  {'Foo':{'Bar':1,
+0004fc80: 2747 7566 273a 317d 7d20 6973 2061 2073  'Guf':1}} is a s
+0004fc90: 686f 7274 6e61 6d65 2076 616c 7565 206d  hortname value m
+0004fca0: 6170 7069 6e67 202d 2069 6620 7765 2066  apping - if we f
+0004fcb0: 696e 6420 4261 7220 696e 2063 6f6c 756d  ind Bar in colum
+0004fcc0: 6e20 466f 6f2c 2077 6520 7075 7420 3120  n Foo, we put 1 
+0004fcd0: 6167 6169 6e73 7420 7468 6520 6d65 7472  against the metr
+0004fce0: 6963 2042 6172 2c20 6966 2077 6520 6669  ic Bar, if we fi
+0004fcf0: 6e64 2047 7566 2c20 7765 2070 7574 2031  nd Guf, we put 1
+0004fd00: 2061 6761 696e 7374 2074 6861 7420 6d65   against that me
+0004fd10: 7472 6963 2073 686f 7274 636f 6465 0d0a  tric shortcode..
+0004fd20: 0d0a 2020 2020 2020 2020 4966 2074 6865  ..        If the
+0004fd30: 206d 6170 7069 6e67 2074 7970 6520 6973   mapping type is
+0004fd40: 2063 6f6c 756d 6e73 2074 6f20 6669 656c   columns to fiel
+0004fd50: 6473 2c20 7468 6520 7265 7475 726e 6564  ds, the returned
+0004fd60: 206c 6973 7420 7769 6c6c 2069 6e73 7465   list will inste
+0004fd70: 6164 2062 6520 6120 6469 6374 696f 6e61  ad be a dictiona
+0004fd80: 7279 206f 6620 7468 6520 666f 726d 207b  ry of the form {
+0004fd90: 2866 6965 6c64 5f76 616c 7565 2c20 6669  (field_value, fi
+0004fda0: 656c 645f 7661 6c75 652c 202e 2e2e 293a  eld_value, ...):
+0004fdb0: 2073 686f 7274 6e61 6d65 2c20 2e2e 2e7d   shortname, ...}
+0004fdc0: 0d0a 0d0a 2020 2020 2020 2020 3a70 6172  ....        :par
+0004fdd0: 616d 2064 696d 656e 7369 6f6e 5f69 6e64  am dimension_ind
+0004fde0: 6578 3a20 696e 6465 7820 6f66 2074 6865  ex: index of the
+0004fdf0: 2064 696d 656e 7369 6f6e 0d0a 2020 2020   dimension..    
+0004fe00: 2020 2020 3a70 6172 616d 206f 626a 6563      :param objec
+0004fe10: 745f 746f 5f63 6865 636b 5f61 6761 696e  t_to_check_again
+0004fe20: 7374 3a20 456d 706f 7765 7220 6f62 6a65  st: Empower obje
+0004fe30: 6374 2074 6f20 6368 6563 6b20 6167 6169  ct to check agai
+0004fe40: 6e73 7420 2d20 6120 5369 7465 2c20 4469  nst - a Site, Di
+0004fe50: 6d65 6e73 696f 6e2c 2061 2053 7472 7563  mension, a Struc
+0004fe60: 7475 7265 206f 7220 6120 5374 7275 6374  ture or a Struct
+0004fe70: 7572 6545 6c65 6d65 6e74 0d0a 2020 2020  ureElement..    
+0004fe80: 2020 2020 3a70 6172 616d 2063 6f6c 756d      :param colum
+0004fe90: 6e5f 6c69 7374 5f74 6f5f 6368 6563 6b5f  n_list_to_check_
+0004fea0: 6167 6169 6e73 743a 204f 7074 696f 6e61  against: Optiona
+0004feb0: 6c20 6c69 7374 206f 6620 636f 6c75 6d6e  l list of column
+0004fec0: 7320 7468 6174 2077 6520 6361 6e20 6368  s that we can ch
+0004fed0: 6563 6b20 6167 6169 6e73 7420 2d20 7573  eck against - us
+0004fee0: 6566 756c 2069 6620 7765 2068 6176 6520  eful if we have 
+0004fef0: 6120 6c61 7267 6520 6373 7620 6669 6c65  a large csv file
+0004ff00: 2077 6974 6820 6865 6164 6572 7320 6173   with headers as
+0004ff10: 2074 6865 2073 6f75 7263 652e 2054 6869   the source. Thi
+0004ff20: 7320 7061 7261 6d65 7465 7220 6973 2069  s parameter is i
+0004ff30: 676e 6f72 6564 2069 6620 7468 6973 2043  gnored if this C
+0004ff40: 7562 656d 6170 7065 7220 6861 7320 6120  ubemapper has a 
+0004ff50: 736f 7572 6365 0d0a 0d0a 2020 2020 2020  source....      
+0004ff60: 2020 3a72 6574 7572 6e3a 206c 6973 745f    :return: list_
+0004ff70: 6f72 5f64 6963 745f 6f66 5f73 686f 7274  or_dict_of_short
+0004ff80: 636f 6465 732c 206d 6170 7069 6e67 5f74  codes, mapping_t
+0004ff90: 7970 6520 2d20 6f6e 6520 6f66 2027 636f  ype - one of 'co
+0004ffa0: 6e73 7461 6e74 2073 686f 7274 6e61 6d65  nstant shortname
+0004ffb0: 272c 2763 6f6c 756d 6e20 6e61 6d65 272c  ','column name',
+0004ffc0: 2763 6f6c 756d 6e73 2074 6f20 6669 656c  'columns to fiel
+0004ffd0: 6473 272c 2763 6f6c 756d 6e73 2074 6f20  ds','columns to 
+0004ffe0: 7368 6f72 746e 616d 6573 272c 2763 6f6c  shortnames','col
+0004fff0: 756d 6e20 746f 2073 686f 7274 6e61 6d65  umn to shortname
+00050000: 2074 6f20 7661 6c75 6527 2c20 616e 6420   to value', and 
+00050010: 7468 656e 2063 6f6c 756d 6e20 6e61 6d65  then column name
+00050020: 730d 0a20 2020 2020 2020 2027 2727 0d0a  s..        '''..
+00050030: 0d0a 2020 2020 2020 2020 2363 6f6e 7665  ..        #conve
+00050040: 7274 206f 626a 6563 745f 746f 5f63 6865  rt object_to_che
+00050050: 636b 5f61 6761 696e 7374 2074 6f20 7468  ck_against to th
+00050060: 6520 6469 6d65 6e73 696f 6e20 7765 2077  e dimension we w
+00050070: 6973 6820 746f 2063 6865 636b 2069 6620  ish to check if 
+00050080: 7765 2068 6176 6520 676f 7420 6120 5369  we have got a Si
+00050090: 7465 206f 626a 6563 742c 2074 6869 7320  te object, this 
+000500a0: 6361 7365 2077 696c 6c20 6265 2068 616e  case will be han
+000500b0: 646c 6564 2062 656c 6f77 0d0a 2020 2020  dled below..    
+000500c0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+000500d0: 6528 6f62 6a65 6374 5f74 6f5f 6368 6563  e(object_to_chec
+000500e0: 6b5f 6167 6169 6e73 742c 5369 7465 293a  k_against,Site):
+000500f0: 0d0a 2020 2020 2020 2020 2020 2020 6f62  ..            ob
+00050100: 6a65 6374 5f74 6f5f 6368 6563 6b5f 6167  ject_to_check_ag
+00050110: 6169 6e73 7420 3d20 6f62 6a65 6374 5f74  ainst = object_t
+00050120: 6f5f 6368 6563 6b5f 6167 6169 6e73 742e  o_check_against.
+00050130: 6469 6d65 6e73 696f 6e73 5b64 696d 656e  dimensions[dimen
+00050140: 7369 6f6e 5f69 6e64 6578 5d0d 0a0d 0a20  sion_index].... 
+00050150: 2020 2020 2020 2069 6620 7365 6c66 2e73         if self.s
+00050160: 6f75 7263 6520 6973 206e 6f74 204e 6f6e  ource is not Non
+00050170: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00050180: 636f 6c75 6d6e 5f6c 6973 745f 746f 5f63  column_list_to_c
+00050190: 6865 636b 5f61 6761 696e 7374 203d 205b  heck_against = [
+000501a0: 6320 666f 7220 6320 696e 2073 656c 662e  c for c in self.
+000501b0: 736f 7572 6365 2e63 6f6c 756d 6e73 5d0d  source.columns].
+000501c0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+000501d0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+000501e0: 6d6e 5f6c 6973 745f 746f 5f63 6865 636b  mn_list_to_check
+000501f0: 5f61 6761 696e 7374 203d 204e 6f6e 650d  _against = None.
+00050200: 0a0d 0a20 2020 2020 2020 2023 6372 6561  ...        #crea
+00050210: 7465 2061 2063 6f6c 756d 6e73 5f64 6963  te a columns_dic
+00050220: 7420 666f 7220 6661 7374 206c 6f6f 6b75  t for fast looku
+00050230: 700d 0a20 2020 2020 2020 2069 6620 636f  p..        if co
+00050240: 6c75 6d6e 5f6c 6973 745f 746f 5f63 6865  lumn_list_to_che
+00050250: 636b 5f61 6761 696e 7374 2069 7320 6e6f  ck_against is no
+00050260: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00050270: 2020 2020 2063 6f6c 756d 6e73 5f64 6963       columns_dic
+00050280: 7420 3d20 7b63 3a63 2066 6f72 2063 2069  t = {c:c for c i
+00050290: 6e20 636f 6c75 6d6e 5f6c 6973 745f 746f  n column_list_to
+000502a0: 5f63 6865 636b 5f61 6761 696e 7374 7d0d  _check_against}.
+000502b0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+000502c0: 2020 2020 2020 2020 2020 2020 636f 6c75              colu
+000502d0: 6d6e 735f 6469 6374 203d 204e 6f6e 650d  mns_dict = None.
+000502e0: 0a0d 0a20 2020 2020 2020 2063 6f6c 756d  ...        colum
+000502f0: 6e5f 6e61 6d65 7320 3d20 4e6f 6e65 0d0a  n_names = None..
+00050300: 0d0a 2020 2020 2020 2020 2357 6865 6e20  ..        #When 
+00050310: 7468 6572 6520 6973 206e 6f20 6d61 7070  there is no mapp
+00050320: 696e 672c 2074 6865 2069 6d70 6c69 6564  ing, the implied
+00050330: 2073 686f 7274 636f 6465 206c 6973 7420   shortcode list 
+00050340: 6973 204e 6f6e 6520 2d20 6e6f 7420 5b5d  is None - not []
+00050350: 2c20 6a75 7374 204e 6f6e 650d 0a20 2020  , just None..   
+00050360: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00050370: 2020 2020 2020 206d 6170 7069 6e67 203d         mapping =
+00050380: 2073 656c 665b 6469 6d65 6e73 696f 6e5f   self[dimension_
+00050390: 696e 6465 785d 0d0a 0d0a 2020 2020 2020  index]....      
+000503a0: 2020 2020 2020 6966 206d 6170 7069 6e67        if mapping
+000503b0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+000503c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000503d0: 6e20 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f  n None, None, No
+000503e0: 6e65 0d0a 2020 2020 2020 2020 6578 6365  ne..        exce
+000503f0: 7074 204b 6579 4572 726f 723a 0d0a 2020  pt KeyError:..  
+00050400: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00050410: 204e 6f6e 652c 204e 6f6e 652c 204e 6f6e   None, None, Non
+00050420: 650d 0a0d 0a20 2020 2020 2020 2023 5765  e....        #We
+00050430: 206d 6179 206e 6565 6420 746f 2077 6f72   may need to wor
+00050440: 6b20 6f75 7420 7768 6574 6865 7220 7765  k out whether we
+00050450: 2061 7265 2073 6565 696e 6720 610d 0a20   are seeing a.. 
+00050460: 2020 2020 2020 2069 6620 2020 6973 696e         if   isin
+00050470: 7374 616e 6365 286f 626a 6563 745f 746f  stance(object_to
+00050480: 5f63 6865 636b 5f61 6761 696e 7374 2c44  _check_against,D
+00050490: 696d 656e 7369 6f6e 293a 0d0a 2020 2020  imension):..    
+000504a0: 2020 2020 2020 2020 656c 656d 656e 7473          elements
+000504b0: 5f64 6963 7420 3d20 6f62 6a65 6374 5f74  _dict = object_t
+000504c0: 6f5f 6368 6563 6b5f 6167 6169 6e73 742e  o_check_against.
+000504d0: 656c 656d 656e 7473 0d0a 2020 2020 2020  elements..      
+000504e0: 2020 2020 2020 6669 656c 6473 5f64 6963        fields_dic
+000504f0: 7420 2020 3d20 6f62 6a65 6374 5f74 6f5f  t   = object_to_
+00050500: 6368 6563 6b5f 6167 6169 6e73 742e 6669  check_against.fi
+00050510: 656c 6473 0d0a 0d0a 2020 2020 2020 2020  elds....        
+00050520: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00050530: 6f62 6a65 6374 5f74 6f5f 6368 6563 6b5f  object_to_check_
+00050540: 6167 6169 6e73 742c 5374 7275 6374 7572  against,Structur
+00050550: 6529 3a0d 0a20 2020 2020 2020 2020 2020  e):..           
+00050560: 2065 6c65 6d65 6e74 735f 6469 6374 203d   elements_dict =
+00050570: 206f 626a 6563 745f 746f 5f63 6865 636b   object_to_check
+00050580: 5f61 6761 696e 7374 2e64 696d 656e 7369  _against.dimensi
+00050590: 6f6e 2e65 6c65 6d65 6e74 730d 0a20 2020  on.elements..   
+000505a0: 2020 2020 2020 2020 2066 6965 6c64 735f           fields_
+000505b0: 6469 6374 2020 203d 206f 626a 6563 745f  dict   = object_
+000505c0: 746f 5f63 6865 636b 5f61 6761 696e 7374  to_check_against
+000505d0: 2e64 696d 656e 7369 6f6e 2e66 6965 6c64  .dimension.field
+000505e0: 730d 0a0d 0a20 2020 2020 2020 2065 6c69  s....        eli
+000505f0: 6620 6973 696e 7374 616e 6365 286f 626a  f isinstance(obj
+00050600: 6563 745f 746f 5f63 6865 636b 5f61 6761  ect_to_check_aga
+00050610: 696e 7374 2c53 7472 7563 7475 7265 456c  inst,StructureEl
+00050620: 656d 656e 7429 3a0d 0a20 2020 2020 2020  ement):..       
+00050630: 2020 2020 2065 6c65 6d65 6e74 735f 6469       elements_di
+00050640: 6374 203d 206f 626a 6563 745f 746f 5f63  ct = object_to_c
+00050650: 6865 636b 5f61 6761 696e 7374 2e64 696d  heck_against.dim
+00050660: 656e 7369 6f6e 2e65 6c65 6d65 6e74 730d  ension.elements.
+00050670: 0a20 2020 2020 2020 2020 2020 2066 6965  .            fie
+00050680: 6c64 735f 6469 6374 2020 203d 206f 626a  lds_dict   = obj
+00050690: 6563 745f 746f 5f63 6865 636b 5f61 6761  ect_to_check_aga
+000506a0: 696e 7374 2e64 696d 656e 7369 6f6e 2e66  inst.dimension.f
+000506b0: 6965 6c64 730d 0a20 2020 2020 2020 2065  ields..        e
+000506c0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+000506d0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+000506e0: 7228 2243 616e 6e6f 7420 6d61 7020 746f  r("Cannot map to
+000506f0: 206f 626a 6563 7420 7b7d 206f 6620 7479   object {} of ty
+00050700: 7065 207b 7d22 2e66 6f72 6d61 7428 6f62  pe {}".format(ob
+00050710: 6a65 6374 5f74 6f5f 6368 6563 6b5f 6167  ject_to_check_ag
+00050720: 6169 6e73 742c 7479 7065 286f 626a 6563  ainst,type(objec
+00050730: 745f 746f 5f63 6865 636b 5f61 6761 696e  t_to_check_again
+00050740: 7374 2929 290d 0a0d 0a20 2020 2020 2020  st)))....       
+00050750: 2069 735f 636f 6e73 7461 6e74 5f73 686f   is_constant_sho
+00050760: 7274 636f 6465 5f6f 725f 636f 6c75 6d6e  rtcode_or_column
+00050770: 5f69 6d70 6c69 6564 5f73 686f 7274 636f  _implied_shortco
+00050780: 6465 5f6d 6170 7069 6e67 203d 2046 616c  de_mapping = Fal
+00050790: 7365 0d0a 2020 2020 2020 2020 6973 5f66  se..        is_f
+000507a0: 6965 6c64 5f6f 725f 7368 6f72 7463 6f64  ield_or_shortcod
 000507b0: 655f 6d61 7070 696e 6720 3d20 4661 6c73  e_mapping = Fals
-000507c0: 650d 0a20 2020 2020 2020 2069 735f 636f  e..        is_co
-000507d0: 6e73 7461 6e74 5f64 6174 6574 696d 6520  nstant_datetime 
-000507e0: 3d20 4661 6c73 650d 0a0d 0a20 2020 2020  = False....     
-000507f0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00050800: 286d 6170 7069 6e67 2c73 7472 293a 0d0a  (mapping,str):..
-00050810: 2020 2020 2020 2020 2020 2020 2320 4966              # If
-00050820: 2077 6520 6765 7420 6120 7369 6e67 6c65   we get a single
-00050830: 2073 7472 696e 6720 7765 2061 7373 756d   string we assum
-00050840: 6520 7468 6174 2077 6520 6172 6520 6c6f  e that we are lo
-00050850: 6f6b 696e 6720 6174 2061 2073 696e 676c  oking at a singl
-00050860: 6520 7368 6f72 7463 6f64 6520 4f52 2061  e shortcode OR a
-00050870: 2073 696e 676c 6520 636f 6c75 6d6e 2028   single column (
-00050880: 7769 7468 2074 6865 2069 6d70 6c69 6361  with the implica
-00050890: 7469 6f6e 2074 6861 7420 7468 6520 636f  tion that the co
-000508a0: 6c75 6d6e 2063 6f6e 7461 696e 7320 7368  lumn contains sh
-000508b0: 6f72 7463 6f64 6573 290d 0a20 2020 2020  ortcodes)..     
-000508c0: 2020 2020 2020 2069 735f 636f 6e73 7461         is_consta
-000508d0: 6e74 5f73 686f 7274 636f 6465 5f6f 725f  nt_shortcode_or_
-000508e0: 636f 6c75 6d6e 5f69 6d70 6c69 6564 5f73  column_implied_s
-000508f0: 686f 7274 636f 6465 5f6d 6170 7069 6e67  hortcode_mapping
-00050900: 203d 2054 7275 650d 0a20 2020 2020 2020   = True..       
-00050910: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00050920: 286d 6170 7069 6e67 2c64 6174 6574 696d  (mapping,datetim
-00050930: 652e 6461 7465 7469 6d65 293a 0d0a 2020  e.datetime):..  
-00050940: 2020 2020 2020 2020 2020 2320 4120 7369            # A si
-00050950: 6e67 6c65 2064 6174 6574 696d 6520 696d  ngle datetime im
-00050960: 706c 6965 7320 7468 6174 2077 6520 6172  plies that we ar
-00050970: 6520 646f 696e 6720 6120 6461 7465 206d  e doing a date m
-00050980: 6170 7069 6e67 2061 7420 7768 6174 6576  apping at whatev
-00050990: 6572 2067 7261 6e75 6c61 7269 7479 2074  er granularity t
-000509a0: 6865 2073 7570 706c 6965 6420 6869 6572  he supplied hier
-000509b0: 6172 6368 7920 6861 730d 0a20 2020 2020  archy has..     
-000509c0: 2020 2020 2020 2069 735f 636f 6e73 7461         is_consta
-000509d0: 6e74 5f64 6174 6574 696d 6520 3d20 5472  nt_datetime = Tr
-000509e0: 7565 0d0a 0d0a 2020 2020 2020 2020 656c  ue....        el
-000509f0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00050a00: 2069 6620 6c65 6e28 6d61 7070 696e 6729   if len(mapping)
-00050a10: 203d 3d20 313a 0d0a 2020 2020 2020 2020   == 1:..        
-00050a20: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-00050a30: 2069 6e20 6d61 7070 696e 672e 6974 656d   in mapping.item
-00050a40: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-00050a50: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-00050a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050a70: 2020 2020 2020 2020 2349 6620 7765 2068          #If we h
-00050a80: 6176 6520 6120 7369 6e67 6c65 206b 6579  ave a single key
-00050a90: 2077 6974 6820 6120 6469 6374 696f 6e61   with a dictiona
-00050aa0: 7279 206d 6170 7069 6e67 2c20 7468 656e  ry mapping, then
-00050ab0: 2074 6869 7320 6973 2061 2073 686f 7274   this is a short
-00050ac0: 636f 6465 202d 2076 616c 7565 206d 6170  code - value map
-00050ad0: 7069 6e67 0d0a 2020 2020 2020 2020 2020  ping..          
-00050ae0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00050af0: 7220 6b32 2c20 7632 2069 6e20 762e 6974  r k2, v2 in v.it
-00050b00: 656d 7328 293a 0d0a 2020 2020 2020 2020  ems():..        
-00050b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050b20: 2020 2020 6973 5f73 686f 7274 636f 6465      is_shortcode
-00050b30: 5f76 616c 7565 5f6d 6170 7069 6e67 203d  _value_mapping =
-00050b40: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
-00050b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050b60: 2020 2062 7265 616b 0d0a 2020 2020 2020     break..      
-00050b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050b80: 2020 7368 6f72 7463 6f64 655f 7661 6c75    shortcode_valu
-00050b90: 655f 6d61 7070 696e 6720 3d20 760d 0a20  e_mapping = v.. 
-00050ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050bb0: 2020 2020 2020 2063 6f6c 756d 6e5f 6e61         column_na
-00050bc0: 6d65 7320 3d20 5b6b 5d0d 0a20 2020 2020  mes = [k]..     
+000507c0: 650d 0a20 2020 2020 2020 2069 735f 7368  e..        is_sh
+000507d0: 6f72 7463 6f64 655f 7661 6c75 655f 6d61  ortcode_value_ma
+000507e0: 7070 696e 6720 3d20 4661 6c73 650d 0a20  pping = False.. 
+000507f0: 2020 2020 2020 2069 735f 636f 6e73 7461         is_consta
+00050800: 6e74 5f64 6174 6574 696d 6520 3d20 4661  nt_datetime = Fa
+00050810: 6c73 650d 0a0d 0a20 2020 2020 2020 2069  lse....        i
+00050820: 6620 6973 696e 7374 616e 6365 286d 6170  f isinstance(map
+00050830: 7069 6e67 2c73 7472 293a 0d0a 2020 2020  ping,str):..    
+00050840: 2020 2020 2020 2020 2320 4966 2077 6520          # If we 
+00050850: 6765 7420 6120 7369 6e67 6c65 2073 7472  get a single str
+00050860: 696e 6720 7765 2061 7373 756d 6520 7468  ing we assume th
+00050870: 6174 2077 6520 6172 6520 6c6f 6f6b 696e  at we are lookin
+00050880: 6720 6174 2061 2073 696e 676c 6520 7368  g at a single sh
+00050890: 6f72 7463 6f64 6520 4f52 2061 2073 696e  ortcode OR a sin
+000508a0: 676c 6520 636f 6c75 6d6e 2028 7769 7468  gle column (with
+000508b0: 2074 6865 2069 6d70 6c69 6361 7469 6f6e   the implication
+000508c0: 2074 6861 7420 7468 6520 636f 6c75 6d6e   that the column
+000508d0: 2063 6f6e 7461 696e 7320 7368 6f72 7463   contains shortc
+000508e0: 6f64 6573 290d 0a20 2020 2020 2020 2020  odes)..         
+000508f0: 2020 2069 735f 636f 6e73 7461 6e74 5f73     is_constant_s
+00050900: 686f 7274 636f 6465 5f6f 725f 636f 6c75  hortcode_or_colu
+00050910: 6d6e 5f69 6d70 6c69 6564 5f73 686f 7274  mn_implied_short
+00050920: 636f 6465 5f6d 6170 7069 6e67 203d 2054  code_mapping = T
+00050930: 7275 650d 0a20 2020 2020 2020 2065 6c69  rue..        eli
+00050940: 6620 6973 696e 7374 616e 6365 286d 6170  f isinstance(map
+00050950: 7069 6e67 2c64 6174 6574 696d 652e 6461  ping,datetime.da
+00050960: 7465 7469 6d65 293a 0d0a 2020 2020 2020  tetime):..      
+00050970: 2020 2020 2020 2320 4120 7369 6e67 6c65        # A single
+00050980: 2064 6174 6574 696d 6520 696d 706c 6965   datetime implie
+00050990: 7320 7468 6174 2077 6520 6172 6520 646f  s that we are do
+000509a0: 696e 6720 6120 6461 7465 206d 6170 7069  ing a date mappi
+000509b0: 6e67 2061 7420 7768 6174 6576 6572 2067  ng at whatever g
+000509c0: 7261 6e75 6c61 7269 7479 2074 6865 2073  ranularity the s
+000509d0: 7570 706c 6965 6420 6869 6572 6172 6368  upplied hierarch
+000509e0: 7920 6861 730d 0a20 2020 2020 2020 2020  y has..         
+000509f0: 2020 2069 735f 636f 6e73 7461 6e74 5f64     is_constant_d
+00050a00: 6174 6574 696d 6520 3d20 5472 7565 0d0a  atetime = True..
+00050a10: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00050a20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00050a30: 6c65 6e28 6d61 7070 696e 6729 203d 3d20  len(mapping) == 
+00050a40: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+00050a50: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
+00050a60: 6d61 7070 696e 672e 6974 656d 7328 293a  mapping.items():
+00050a70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00050a80: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00050a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050aa0: 2020 2020 2349 6620 7765 2068 6176 6520      #If we have 
+00050ab0: 6120 7369 6e67 6c65 206b 6579 2077 6974  a single key wit
+00050ac0: 6820 6120 6469 6374 696f 6e61 7279 206d  h a dictionary m
+00050ad0: 6170 7069 6e67 2c20 7468 656e 2074 6869  apping, then thi
+00050ae0: 7320 6973 2061 2073 686f 7274 636f 6465  s is a shortcode
+00050af0: 202d 2076 616c 7565 206d 6170 7069 6e67   - value mapping
+00050b00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00050b10: 2020 2020 2020 2020 2020 666f 7220 6b32            for k2
+00050b20: 2c20 7632 2069 6e20 762e 6974 656d 7328  , v2 in v.items(
+00050b30: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00050b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050b50: 6973 5f73 686f 7274 636f 6465 5f76 616c  is_shortcode_val
+00050b60: 7565 5f6d 6170 7069 6e67 203d 2054 7275  ue_mapping = Tru
+00050b70: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00050b80: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00050b90: 7265 616b 0d0a 2020 2020 2020 2020 2020  reak..          
+00050ba0: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00050bb0: 6f72 7463 6f64 655f 7661 6c75 655f 6d61  ortcode_value_ma
+00050bc0: 7070 696e 6720 3d20 760d 0a20 2020 2020  pping = v..     
 00050bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050be0: 2020 2062 7265 616b 0d0a 2020 2020 2020     break..      
-00050bf0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00050c00: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
-00050c10: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-00050c20: 2020 2020 2020 2020 2020 2020 2020 6973                is
-00050c30: 5f66 6965 6c64 5f6f 725f 7368 6f72 7463  _field_or_shortc
-00050c40: 6f64 655f 6d61 7070 696e 6720 3d20 5472  ode_mapping = Tr
-00050c50: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-00050c60: 2020 2020 2020 2020 6272 6561 6b0d 0a20          break.. 
-00050c70: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00050c80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00050c90: 2020 6973 5f66 6965 6c64 5f6f 725f 7368    is_field_or_sh
-00050ca0: 6f72 7463 6f64 655f 6d61 7070 696e 6720  ortcode_mapping 
-00050cb0: 3d20 5472 7565 0d0a 0d0a 2020 2020 2020  = True....      
-00050cc0: 2020 6966 206e 6f74 2069 735f 636f 6e73    if not is_cons
-00050cd0: 7461 6e74 5f73 686f 7274 636f 6465 5f6f  tant_shortcode_o
-00050ce0: 725f 636f 6c75 6d6e 5f69 6d70 6c69 6564  r_column_implied
-00050cf0: 5f73 686f 7274 636f 6465 5f6d 6170 7069  _shortcode_mappi
-00050d00: 6e67 2061 6e64 206e 6f74 2069 735f 6669  ng and not is_fi
-00050d10: 656c 645f 6f72 5f73 686f 7274 636f 6465  eld_or_shortcode
-00050d20: 5f6d 6170 7069 6e67 2061 6e64 206e 6f74  _mapping and not
-00050d30: 2069 735f 7368 6f72 7463 6f64 655f 7661   is_shortcode_va
-00050d40: 6c75 655f 6d61 7070 696e 6720 616e 6420  lue_mapping and 
-00050d50: 6e6f 7420 6973 5f63 6f6e 7374 616e 745f  not is_constant_
-00050d60: 6461 7465 7469 6d65 3a0d 0a20 2020 2020  datetime:..     
-00050d70: 2020 2020 2020 2072 6169 7365 2041 7474         raise Att
-00050d80: 7269 6275 7465 4572 726f 7228 2743 616e  ributeError('Can
-00050d90: 6e6f 7420 6465 7465 726d 696e 6520 7768  not determine wh
-00050da0: 6174 2073 6f72 7420 6f66 206d 6170 7069  at sort of mappi
-00050db0: 6e67 2068 6173 2062 6565 6e20 6372 6561  ng has been crea
-00050dc0: 7465 6420 666f 7220 6469 6d65 6e73 696f  ted for dimensio
-00050dd0: 6e5b 7b7d 5d27 2e66 6f72 6d61 7428 6469  n[{}]'.format(di
-00050de0: 6d65 6e73 696f 6e5f 696e 6465 7829 290d  mension_index)).
-00050df0: 0a0d 0a20 2020 2020 2020 2069 735f 636f  ...        is_co
-00050e00: 6e73 7461 6e74 5f73 686f 7274 636f 6465  nstant_shortcode
-00050e10: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00050e20: 2020 6973 5f63 6f6c 756d 6e5f 696d 706c    is_column_impl
-00050e30: 6965 645f 7368 6f72 7463 6f64 655f 6d61  ied_shortcode_ma
-00050e40: 7070 696e 6720 3d20 4661 6c73 650d 0a0d  pping = False...
-00050e50: 0a20 2020 2020 2020 2069 6620 6973 5f63  .        if is_c
-00050e60: 6f6e 7374 616e 745f 7368 6f72 7463 6f64  onstant_shortcod
-00050e70: 655f 6f72 5f63 6f6c 756d 6e5f 696d 706c  e_or_column_impl
-00050e80: 6965 645f 7368 6f72 7463 6f64 655f 6d61  ied_shortcode_ma
-00050e90: 7070 696e 673a 0d0a 2020 2020 2020 2020  pping:..        
-00050ea0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-00050eb0: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-00050ec0: 7473 5f64 6963 745b 6d61 7070 696e 675d  ts_dict[mapping]
-00050ed0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00050ee0: 2020 6973 5f63 6f6e 7374 616e 745f 7368    is_constant_sh
-00050ef0: 6f72 7463 6f64 6520 3d20 5472 7565 0d0a  ortcode = True..
-00050f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00050f10: 6973 5f63 6f6c 756d 6e5f 696d 706c 6965  is_column_implie
-00050f20: 645f 7368 6f72 7463 6f64 655f 6d61 7070  d_shortcode_mapp
-00050f30: 696e 6720 3d20 4661 6c73 650d 0a20 2020  ing = False..   
-00050f40: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00050f50: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
-00050f60: 2020 2020 2020 2020 2020 2069 735f 636f             is_co
-00050f70: 6e73 7461 6e74 5f73 686f 7274 636f 6465  nstant_shortcode
-00050f80: 203d 2046 616c 7365 0d0a 2020 2020 2020   = False..      
-00050f90: 2020 2020 2020 2020 2020 6973 5f63 6f6c            is_col
-00050fa0: 756d 6e5f 696d 706c 6965 645f 7368 6f72  umn_implied_shor
-00050fb0: 7463 6f64 655f 6d61 7070 696e 6720 3d20  tcode_mapping = 
-00050fc0: 5472 7565 0d0a 2020 2020 2020 2020 2020  True..          
-00050fd0: 2020 2020 2020 636f 6c75 6d6e 5f6e 616d        column_nam
-00050fe0: 6573 203d 205b 6d61 7070 696e 675d 0d0a  es = [mapping]..
-00050ff0: 0d0a 2020 2020 2020 2020 6973 5f66 6965  ..        is_fie
-00051000: 6c64 5f6d 6170 7069 6e67 203d 2046 616c  ld_mapping = Fal
-00051010: 7365 0d0a 2020 2020 2020 2020 6973 5f73  se..        is_s
-00051020: 686f 7274 636f 6465 5f6d 6170 7069 6e67  hortcode_mapping
-00051030: 203d 2046 616c 7365 0d0a 0d0a 2020 2020   = False....    
-00051040: 2020 2020 6966 2069 735f 6669 656c 645f      if is_field_
-00051050: 6f72 5f73 686f 7274 636f 6465 5f6d 6170  or_shortcode_map
-00051060: 7069 6e67 3a0d 0a0d 0a20 2020 2020 2020  ping:....       
-00051070: 2020 2020 2066 6f75 6e64 5f66 6965 6c64       found_field
-00051080: 7320 3d20 5b5d 0d0a 2020 2020 2020 2020  s = []..        
-00051090: 2020 2020 6d69 7373 696e 675f 6669 656c      missing_fiel
-000510a0: 6473 203d 205b 5d0d 0a20 2020 2020 2020  ds = []..       
-000510b0: 2020 2020 206d 6973 7369 6e67 5f65 6c65       missing_ele
-000510c0: 6d65 6e74 5f73 686f 7274 636f 6465 7320  ment_shortcodes 
-000510d0: 3d20 5b5d 0d0a 2020 2020 2020 2020 2020  = []..          
-000510e0: 2020 636f 6c75 6d6e 5f6e 616d 6573 203d    column_names =
-000510f0: 205b 5d0d 0a20 2020 2020 2020 2020 2020   []..           
-00051100: 2023 4368 6563 6b20 7768 6574 6865 7220   #Check whether 
-00051110: 7468 6520 6d61 7070 6564 2074 6869 6e67  the mapped thing
-00051120: 7320 6172 6520 6669 656c 6473 206f 7220  s are fields or 
-00051130: 7368 6f72 7463 6f64 6573 0d0a 2020 2020  shortcodes..    
-00051140: 2020 2020 2020 2020 666f 7220 6b2c 2076          for k, v
-00051150: 2069 6e20 6d61 7070 696e 672e 6974 656d   in mapping.item
-00051160: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-00051170: 2020 2020 2020 636f 6c75 6d6e 5f6e 616d        column_nam
-00051180: 6573 2e61 7070 656e 6428 6b29 0d0a 0d0a  es.append(k)....
-00051190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000511a0: 237b 2746 6f6f 273a 4e6f 6e65 7d20 6d61  #{'Foo':None} ma
-000511b0: 7073 2061 2063 6f6c 756d 6e20 746f 2061  ps a column to a
-000511c0: 2073 686f 7274 6e61 6d65 0d0a 2020 2020   shortname..    
-000511d0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-000511e0: 203d 3d20 4e6f 6e65 3a0d 0a20 2020 2020   == None:..     
-000511f0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00051200: 203d 2027 5368 6f72 7420 4e61 6d65 270d   = 'Short Name'.
-00051210: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00051220: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00051230: 2020 2020 2020 2020 2020 2020 2066 6965               fie
-00051240: 6c64 735f 6469 6374 5b76 5d0d 0a20 2020  lds_dict[v]..   
-00051250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051260: 2066 6f75 6e64 5f66 6965 6c64 732e 6170   found_fields.ap
-00051270: 7065 6e64 2876 290d 0a20 2020 2020 2020  pend(v)..       
-00051280: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00051290: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
-000512a0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000512b0: 6973 7369 6e67 5f66 6965 6c64 732e 6170  issing_fields.ap
-000512c0: 7065 6e64 2876 290d 0a20 2020 2020 2020  pend(v)..       
-000512d0: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-000512e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000512f0: 2020 2065 6c65 6d65 6e74 735f 6469 6374     elements_dict
-00051300: 5b76 5d0d 0a20 2020 2020 2020 2020 2020  [v]..           
-00051310: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-00051320: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00051330: 2020 2020 2020 2020 2020 206d 6973 7369             missi
-00051340: 6e67 5f65 6c65 6d65 6e74 5f73 686f 7274  ng_element_short
-00051350: 636f 6465 732e 6170 7065 6e64 2876 290d  codes.append(v).
-00051360: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
-00051370: 6620 6c65 6e28 6d69 7373 696e 675f 6669  f len(missing_fi
-00051380: 656c 6473 2920 3d3d 2030 2061 6e64 206c  elds) == 0 and l
-00051390: 656e 286d 6973 7369 6e67 5f65 6c65 6d65  en(missing_eleme
-000513a0: 6e74 5f73 686f 7274 636f 6465 7329 203d  nt_shortcodes) =
-000513b0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
-000513c0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-000513d0: 6545 7272 6f72 2827 4361 6e6e 6f74 2064  eError('Cannot d
-000513e0: 6574 6572 6d69 6e65 2077 6861 7420 736f  etermine what so
-000513f0: 7274 206f 6620 6d61 7070 696e 6720 6861  rt of mapping ha
-00051400: 7320 6265 656e 2063 7265 6174 6564 2066  s been created f
-00051410: 6f72 2064 696d 656e 7369 6f6e 5b7b 7d5d  or dimension[{}]
-00051420: 2061 6c6c 206d 6170 7065 6420 6974 656d   all mapped item
-00051430: 7320 7b7d 2063 6f75 6c64 2062 6520 6569  s {} could be ei
-00051440: 7468 6572 2046 6965 6c64 7320 6f72 2045  ther Fields or E
-00051450: 6c65 6d65 6e74 2073 686f 7274 6e61 6d65  lement shortname
-00051460: 7327 2e66 6f72 6d61 7428 6469 6d65 6e73  s'.format(dimens
-00051470: 696f 6e5f 696e 6465 782c 6c69 7374 286d  ion_index,list(m
-00051480: 6170 7069 6e67 2e76 616c 7565 7329 2929  apping.values)))
-00051490: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000514a0: 6966 206c 656e 286d 6973 7369 6e67 5f66  if len(missing_f
-000514b0: 6965 6c64 7329 203d 3d20 303a 0d0a 2020  ields) == 0:..  
-000514c0: 2020 2020 2020 2020 2020 2020 2020 6973                is
-000514d0: 5f66 6965 6c64 5f6d 6170 7069 6e67 203d  _field_mapping =
-000514e0: 2054 7275 650d 0a0d 0a20 2020 2020 2020   True....       
-000514f0: 2020 2020 2069 6620 6c65 6e28 6d69 7373       if len(miss
-00051500: 696e 675f 656c 656d 656e 745f 7368 6f72  ing_element_shor
-00051510: 7463 6f64 6573 2920 3d3d 2020 303a 0d0a  tcodes) ==  0:..
-00051520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051530: 6973 5f73 686f 7274 636f 6465 5f6d 6170  is_shortcode_map
-00051540: 7069 6e67 203d 2054 7275 650d 0a0d 0a20  ping = True.... 
-00051550: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00051560: 7420 6973 5f66 6965 6c64 5f6d 6170 7069  t is_field_mappi
-00051570: 6e67 2061 6e64 206e 6f74 2069 735f 7368  ng and not is_sh
-00051580: 6f72 7463 6f64 655f 6d61 7070 696e 673a  ortcode_mapping:
-00051590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000515a0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000515b0: 6f72 2827 4361 6e6e 6f74 2064 6574 6572  or('Cannot deter
-000515c0: 6d69 6e65 2077 6861 7420 736f 7274 206f  mine what sort o
-000515d0: 6620 6d61 7070 696e 6720 6861 7320 6265  f mapping has be
-000515e0: 656e 2063 7265 6174 6564 2066 6f72 2064  en created for d
-000515f0: 696d 656e 7369 6f6e 5b7b 7d5d 2e20 7b7d  imension[{}]. {}
-00051600: 2061 7265 206e 6f74 2046 6965 6c64 7320   are not Fields 
-00051610: 616e 6420 7b7d 2061 7265 206e 6f74 2045  and {} are not E
-00051620: 6c65 6d65 6e74 2073 686f 7274 6e61 6d65  lement shortname
-00051630: 7320 272e 666f 726d 6174 2864 696d 656e  s '.format(dimen
-00051640: 7369 6f6e 5f69 6e64 6578 2c6d 6973 7369  sion_index,missi
-00051650: 6e67 5f66 6965 6c64 732c 6d69 7373 696e  ng_fields,missin
-00051660: 675f 656c 656d 656e 745f 7368 6f72 7463  g_element_shortc
-00051670: 6f64 6573 2929 0d0a 0d0a 2020 2020 2020  odes))....      
-00051680: 2020 2343 6865 636b 2063 6f6c 756d 6e20    #Check column 
-00051690: 6e61 6d65 7320 6d61 6b65 2073 656e 7365  names make sense
-000516a0: 2063 6f6d 7061 7265 6420 746f 2074 6865   compared to the
-000516b0: 2073 6f75 7263 650d 0a20 2020 2020 2020   source..       
-000516c0: 2069 6620 636f 6c75 6d6e 5f6e 616d 6573   if column_names
-000516d0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
-000516e0: 2063 6f6c 756d 6e73 5f64 6963 7420 6973   columns_dict is
-000516f0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-00051700: 2020 2020 2020 2020 666f 7220 636f 6c75          for colu
-00051710: 6d6e 5f6e 616d 6520 696e 2063 6f6c 756d  mn_name in colum
-00051720: 6e5f 6e61 6d65 733a 0d0a 2020 2020 2020  n_names:..      
-00051730: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-00051740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051750: 2020 2020 636f 6c75 6d6e 735f 6469 6374      columns_dict
-00051760: 5b63 6f6c 756d 6e5f 6e61 6d65 5d0d 0a20  [column_name].. 
-00051770: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00051780: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
-00051790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000517a0: 2020 2020 2072 6169 7365 204b 6579 4572       raise KeyEr
-000517b0: 726f 7228 2743 6f6c 756d 6e20 227b 7d22  ror('Column "{}"
-000517c0: 2077 6173 2069 6d70 6c69 6564 2062 7920   was implied by 
-000517d0: 6d61 7070 696e 6720 7b7d 2062 7574 2077  mapping {} but w
-000517e0: 6173 206e 6f74 2066 6f75 6e64 2069 6e20  as not found in 
-000517f0: 636f 6c75 6d6e 206e 616d 6573 207b 7d20  column names {} 
-00051800: 6f72 2069 6e20 7368 6f72 7463 6f64 6573  or in shortcodes
-00051810: 206f 6620 6469 6d65 6e73 696f 6e27 2e66   of dimension'.f
-00051820: 6f72 6d61 7428 636f 6c75 6d6e 5f6e 616d  ormat(column_nam
-00051830: 652c 6d61 7070 696e 672c 636f 6c75 6d6e  e,mapping,column
-00051840: 5f6c 6973 745f 746f 5f63 6865 636b 5f61  _list_to_check_a
-00051850: 6761 696e 7374 2920 290d 0a0d 0a20 2020  gainst) )....   
-00051860: 2020 2020 2069 6620 636f 6c75 6d6e 5f6e       if column_n
-00051870: 616d 6573 2069 7320 6e6f 7420 4e6f 6e65  ames is not None
-00051880: 2061 6e64 206c 656e 2863 6f6c 756d 6e5f   and len(column_
-00051890: 6e61 6d65 7329 203e 2030 3a0d 0a20 2020  names) > 0:..   
-000518a0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000518b0: 2e73 6f75 7263 6520 6973 204e 6f6e 653a  .source is None:
-000518c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000518d0: 2020 7261 6973 6520 6d70 6578 2e4c 6f61    raise mpex.Loa
-000518e0: 6465 7253 6574 7570 4572 726f 7228 274d  derSetupError('M
-000518f0: 6170 7065 6420 636f 6c75 6d6e 206e 616d  apped column nam
-00051900: 6573 207b 7d20 696e 2064 696d 656e 7369  es {} in dimensi
-00051910: 6f6e 207b 7d20 636f 756c 6420 6e6f 7420  on {} could not 
-00051920: 6265 2072 6573 6f6c 7665 6420 6265 6361  be resolved beca
-00051930: 7573 6520 7468 6572 6520 6973 206e 6f20  use there is no 
-00051940: 736f 7572 6365 2044 6174 6146 7261 6d65  source DataFrame
-00051950: 206f 7220 7468 6572 6520 6172 6520 6e6f   or there are no
-00051960: 2063 6f6c 756d 6e73 2069 6e20 7468 6520   columns in the 
-00051970: 736f 7572 6365 2044 6174 6146 7261 6d65  source DataFrame
-00051980: 272e 666f 726d 6174 2863 6f6c 756d 6e5f  '.format(column_
-00051990: 6e61 6d65 732c 2064 696d 656e 7369 6f6e  names, dimension
-000519a0: 5f69 6e64 6578 2929 0d0a 2020 2020 2020  _index))..      
-000519b0: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-000519c0: 636f 6c75 6d6e 7320 6973 204e 6f6e 653a  columns is None:
-000519d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000519e0: 2020 7261 6973 6520 4b65 7945 7272 6f72    raise KeyError
-000519f0: 2827 4d61 7070 6564 2063 6f6c 756d 6e20  ('Mapped column 
-00051a00: 6e61 6d65 7320 7b7d 2069 6e20 6469 6d65  names {} in dime
-00051a10: 6e73 696f 6e20 7b7d 2063 6f75 6c64 206e  nsion {} could n
-00051a20: 6f74 2062 6520 7265 736f 6c76 6564 2062  ot be resolved b
-00051a30: 6563 6175 7365 2074 6865 7265 2069 7320  ecause there is 
-00051a40: 6e6f 2073 6f75 7263 6520 4461 7461 4672  no source DataFr
-00051a50: 616d 6520 6f72 2074 6865 7265 2061 7265  ame or there are
-00051a60: 206e 6f20 636f 6c75 6d6e 7320 696e 2074   no columns in t
-00051a70: 6865 2073 6f75 7263 6520 4461 7461 4672  he source DataFr
-00051a80: 616d 6527 2e66 6f72 6d61 7428 636f 6c75  ame'.format(colu
-00051a90: 6d6e 5f6e 616d 6573 2c20 6469 6d65 6e73  mn_names, dimens
-00051aa0: 696f 6e5f 696e 6465 7829 290d 0a0d 0a20  ion_index)).... 
-00051ab0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00051ac0: 616e 6365 286f 626a 6563 745f 746f 5f63  ance(object_to_c
-00051ad0: 6865 636b 5f61 6761 696e 7374 2c44 696d  heck_against,Dim
-00051ae0: 656e 7369 6f6e 293a 0d0a 2020 2020 2020  ension):..      
-00051af0: 2020 2020 2020 2349 6620 7765 2061 7265        #If we are
-00051b00: 2063 6865 636b 696e 6720 6167 6169 6e73   checking agains
-00051b10: 7420 6120 6469 6d65 6e73 696f 6e2c 2065  t a dimension, e
-00051b20: 6e73 7572 6520 7468 6174 2061 2073 696e  nsure that a sin
-00051b30: 676c 6520 7368 6f72 7463 6f64 6520 6973  gle shortcode is
-00051b40: 206f 6e65 206f 6620 7468 6520 656c 656d   one of the elem
-00051b50: 656e 7473 0d0a 2020 2020 2020 2020 2020  ents..          
-00051b60: 2020 6966 2069 735f 636f 6e73 7461 6e74    if is_constant
-00051b70: 5f73 686f 7274 636f 6465 3a0d 0a20 2020  _shortcode:..   
-00051b80: 2020 2020 2020 2020 2020 2020 2065 6c65               ele
-00051b90: 6d65 6e74 203d 206f 626a 6563 745f 746f  ment = object_to
-00051ba0: 5f63 6865 636b 5f61 6761 696e 7374 2e65  _check_against.e
-00051bb0: 6c65 6d65 6e74 735b 6d61 7070 696e 675d  lements[mapping]
-00051bc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00051bd0: 2020 7265 7475 726e 205b 656c 656d 656e    return [elemen
-00051be0: 742e 7368 6f72 746e 616d 655d 2c20 2763  t.shortname], 'c
-00051bf0: 6f6e 7374 616e 7420 7368 6f72 746e 616d  onstant shortnam
-00051c00: 6527 2c63 6f6c 756d 6e5f 6e61 6d65 730d  e',column_names.
-00051c10: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00051c20: 6620 6973 5f63 6f6c 756d 6e5f 696d 706c  f is_column_impl
-00051c30: 6965 645f 7368 6f72 7463 6f64 655f 6d61  ied_shortcode_ma
-00051c40: 7070 696e 673a 0d0a 2020 2020 2020 2020  pping:..        
-00051c50: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00051c60: 6f6e 652c 2027 636f 6c75 6d6e 206e 616d  one, 'column nam
-00051c70: 6527 2c63 6f6c 756d 6e5f 6e61 6d65 730d  e',column_names.
-00051c80: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00051c90: 6620 6973 5f73 686f 7274 636f 6465 5f6d  f is_shortcode_m
-00051ca0: 6170 7069 6e67 3a0d 0a20 2020 2020 2020  apping:..       
-00051cb0: 2020 2020 2020 2020 2023 6d65 7472 6963           #metric
-00051cc0: 5f64 6963 7420 7374 796c 6520 6d61 7070  _dict style mapp
-00051cd0: 696e 670d 0a20 2020 2020 2020 2020 2020  ing..           
-00051ce0: 2020 2020 2072 6574 7572 6e20 5b6f 626a       return [obj
-00051cf0: 6563 745f 746f 5f63 6865 636b 5f61 6761  ect_to_check_aga
-00051d00: 696e 7374 2e65 6c65 6d65 6e74 735b 7363  inst.elements[sc
-00051d10: 5d2e 7368 6f72 746e 616d 6520 666f 7220  ].shortname for 
-00051d20: 7363 2069 6e20 6d61 7070 696e 672e 7661  sc in mapping.va
-00051d30: 6c75 6573 2829 5d2c 2027 636f 6c75 6d6e  lues()], 'column
-00051d40: 7320 746f 2073 686f 7274 6e61 6d65 7327  s to shortnames'
-00051d50: 2c63 6f6c 756d 6e5f 6e61 6d65 730d 0a0d  ,column_names...
-00051d60: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00051d70: 6620 6973 5f66 6965 6c64 5f6d 6170 7069  f is_field_mappi
-00051d80: 6e67 3a0d 0a20 2020 2020 2020 2020 2020  ng:..           
-00051d90: 2020 2020 2066 6965 6c64 735f 656c 656d       fields_elem
-00051da0: 656e 745f 6c6f 6f6b 7570 203d 207b 7d0d  ent_lookup = {}.
+00050be0: 2020 2063 6f6c 756d 6e5f 6e61 6d65 7320     column_names 
+00050bf0: 3d20 5b6b 5d0d 0a20 2020 2020 2020 2020  = [k]..         
+00050c00: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00050c10: 7265 616b 0d0a 2020 2020 2020 2020 2020  reak..          
+00050c20: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00050c30: 2041 7474 7269 6275 7465 4572 726f 723a   AttributeError:
+00050c40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00050c50: 2020 2020 2020 2020 2020 6973 5f66 6965            is_fie
+00050c60: 6c64 5f6f 725f 7368 6f72 7463 6f64 655f  ld_or_shortcode_
+00050c70: 6d61 7070 696e 6720 3d20 5472 7565 0d0a  mapping = True..
+00050c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00050c90: 2020 2020 6272 6561 6b0d 0a20 2020 2020      break..     
+00050ca0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+00050cb0: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00050cc0: 5f66 6965 6c64 5f6f 725f 7368 6f72 7463  _field_or_shortc
+00050cd0: 6f64 655f 6d61 7070 696e 6720 3d20 5472  ode_mapping = Tr
+00050ce0: 7565 0d0a 0d0a 2020 2020 2020 2020 6966  ue....        if
+00050cf0: 206e 6f74 2069 735f 636f 6e73 7461 6e74   not is_constant
+00050d00: 5f73 686f 7274 636f 6465 5f6f 725f 636f  _shortcode_or_co
+00050d10: 6c75 6d6e 5f69 6d70 6c69 6564 5f73 686f  lumn_implied_sho
+00050d20: 7274 636f 6465 5f6d 6170 7069 6e67 2061  rtcode_mapping a
+00050d30: 6e64 206e 6f74 2069 735f 6669 656c 645f  nd not is_field_
+00050d40: 6f72 5f73 686f 7274 636f 6465 5f6d 6170  or_shortcode_map
+00050d50: 7069 6e67 2061 6e64 206e 6f74 2069 735f  ping and not is_
+00050d60: 7368 6f72 7463 6f64 655f 7661 6c75 655f  shortcode_value_
+00050d70: 6d61 7070 696e 6720 616e 6420 6e6f 7420  mapping and not 
+00050d80: 6973 5f63 6f6e 7374 616e 745f 6461 7465  is_constant_date
+00050d90: 7469 6d65 3a0d 0a20 2020 2020 2020 2020  time:..         
+00050da0: 2020 2072 6169 7365 2041 7474 7269 6275     raise Attribu
+00050db0: 7465 4572 726f 7228 2743 616e 6e6f 7420  teError('Cannot 
+00050dc0: 6465 7465 726d 696e 6520 7768 6174 2073  determine what s
+00050dd0: 6f72 7420 6f66 206d 6170 7069 6e67 2068  ort of mapping h
+00050de0: 6173 2062 6565 6e20 6372 6561 7465 6420  as been created 
+00050df0: 666f 7220 6469 6d65 6e73 696f 6e5b 7b7d  for dimension[{}
+00050e00: 5d27 2e66 6f72 6d61 7428 6469 6d65 6e73  ]'.format(dimens
+00050e10: 696f 6e5f 696e 6465 7829 290d 0a0d 0a20  ion_index)).... 
+00050e20: 2020 2020 2020 2069 735f 636f 6e73 7461         is_consta
+00050e30: 6e74 5f73 686f 7274 636f 6465 203d 2046  nt_shortcode = F
+00050e40: 616c 7365 0d0a 2020 2020 2020 2020 6973  alse..        is
+00050e50: 5f63 6f6c 756d 6e5f 696d 706c 6965 645f  _column_implied_
+00050e60: 7368 6f72 7463 6f64 655f 6d61 7070 696e  shortcode_mappin
+00050e70: 6720 3d20 4661 6c73 650d 0a0d 0a20 2020  g = False....   
+00050e80: 2020 2020 2069 6620 6973 5f63 6f6e 7374       if is_const
+00050e90: 616e 745f 7368 6f72 7463 6f64 655f 6f72  ant_shortcode_or
+00050ea0: 5f63 6f6c 756d 6e5f 696d 706c 6965 645f  _column_implied_
+00050eb0: 7368 6f72 7463 6f64 655f 6d61 7070 696e  shortcode_mappin
+00050ec0: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
+00050ed0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00050ee0: 2020 2020 2020 656c 656d 656e 7473 5f64        elements_d
+00050ef0: 6963 745b 6d61 7070 696e 675d 0d0a 2020  ict[mapping]..  
+00050f00: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00050f10: 5f63 6f6e 7374 616e 745f 7368 6f72 7463  _constant_shortc
+00050f20: 6f64 6520 3d20 5472 7565 0d0a 2020 2020  ode = True..    
+00050f30: 2020 2020 2020 2020 2020 2020 6973 5f63              is_c
+00050f40: 6f6c 756d 6e5f 696d 706c 6965 645f 7368  olumn_implied_sh
+00050f50: 6f72 7463 6f64 655f 6d61 7070 696e 6720  ortcode_mapping 
+00050f60: 3d20 4661 6c73 650d 0a20 2020 2020 2020  = False..       
+00050f70: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+00050f80: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+00050f90: 2020 2020 2020 2069 735f 636f 6e73 7461         is_consta
+00050fa0: 6e74 5f73 686f 7274 636f 6465 203d 2046  nt_shortcode = F
+00050fb0: 616c 7365 0d0a 2020 2020 2020 2020 2020  alse..          
+00050fc0: 2020 2020 2020 6973 5f63 6f6c 756d 6e5f        is_column_
+00050fd0: 696d 706c 6965 645f 7368 6f72 7463 6f64  implied_shortcod
+00050fe0: 655f 6d61 7070 696e 6720 3d20 5472 7565  e_mapping = True
+00050ff0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00051000: 2020 636f 6c75 6d6e 5f6e 616d 6573 203d    column_names =
+00051010: 205b 6d61 7070 696e 675d 0d0a 0d0a 2020   [mapping]....  
+00051020: 2020 2020 2020 6973 5f66 6965 6c64 5f6d        is_field_m
+00051030: 6170 7069 6e67 203d 2046 616c 7365 0d0a  apping = False..
+00051040: 2020 2020 2020 2020 6973 5f73 686f 7274          is_short
+00051050: 636f 6465 5f6d 6170 7069 6e67 203d 2046  code_mapping = F
+00051060: 616c 7365 0d0a 0d0a 2020 2020 2020 2020  alse....        
+00051070: 6966 2069 735f 6669 656c 645f 6f72 5f73  if is_field_or_s
+00051080: 686f 7274 636f 6465 5f6d 6170 7069 6e67  hortcode_mapping
+00051090: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+000510a0: 2066 6f75 6e64 5f66 6965 6c64 7320 3d20   found_fields = 
+000510b0: 5b5d 0d0a 2020 2020 2020 2020 2020 2020  []..            
+000510c0: 6d69 7373 696e 675f 6669 656c 6473 203d  missing_fields =
+000510d0: 205b 5d0d 0a20 2020 2020 2020 2020 2020   []..           
+000510e0: 206d 6973 7369 6e67 5f65 6c65 6d65 6e74   missing_element
+000510f0: 5f73 686f 7274 636f 6465 7320 3d20 5b5d  _shortcodes = []
+00051100: 0d0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+00051110: 6c75 6d6e 5f6e 616d 6573 203d 205b 5d0d  lumn_names = [].
+00051120: 0a20 2020 2020 2020 2020 2020 2023 4368  .            #Ch
+00051130: 6563 6b20 7768 6574 6865 7220 7468 6520  eck whether the 
+00051140: 6d61 7070 6564 2074 6869 6e67 7320 6172  mapped things ar
+00051150: 6520 6669 656c 6473 206f 7220 7368 6f72  e fields or shor
+00051160: 7463 6f64 6573 0d0a 2020 2020 2020 2020  tcodes..        
+00051170: 2020 2020 666f 7220 6b2c 2076 2069 6e20      for k, v in 
+00051180: 6d61 7070 696e 672e 6974 656d 7328 293a  mapping.items():
+00051190: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000511a0: 2020 636f 6c75 6d6e 5f6e 616d 6573 2e61    column_names.a
+000511b0: 7070 656e 6428 6b29 0d0a 0d0a 2020 2020  ppend(k)....    
+000511c0: 2020 2020 2020 2020 2020 2020 237b 2746              #{'F
+000511d0: 6f6f 273a 4e6f 6e65 7d20 6d61 7073 2061  oo':None} maps a
+000511e0: 2063 6f6c 756d 6e20 746f 2061 2073 686f   column to a sho
+000511f0: 7274 6e61 6d65 0d0a 2020 2020 2020 2020  rtname..        
+00051200: 2020 2020 2020 2020 6966 2076 203d 3d20          if v == 
+00051210: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00051220: 2020 2020 2020 2020 2020 2076 203d 2027             v = '
+00051230: 5368 6f72 7420 4e61 6d65 270d 0a0d 0a20  Short Name'.... 
+00051240: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00051250: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+00051260: 2020 2020 2020 2020 2066 6965 6c64 735f           fields_
+00051270: 6469 6374 5b76 5d0d 0a20 2020 2020 2020  dict[v]..       
+00051280: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
+00051290: 6e64 5f66 6965 6c64 732e 6170 7065 6e64  nd_fields.append
+000512a0: 2876 290d 0a20 2020 2020 2020 2020 2020  (v)..           
+000512b0: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
+000512c0: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+000512d0: 2020 2020 2020 2020 2020 206d 6973 7369             missi
+000512e0: 6e67 5f66 6965 6c64 732e 6170 7065 6e64  ng_fields.append
+000512f0: 2876 290d 0a20 2020 2020 2020 2020 2020  (v)..           
+00051300: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00051310: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00051320: 6c65 6d65 6e74 735f 6469 6374 5b76 5d0d  lements_dict[v].
+00051330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051340: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+00051350: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00051360: 2020 2020 2020 206d 6973 7369 6e67 5f65         missing_e
+00051370: 6c65 6d65 6e74 5f73 686f 7274 636f 6465  lement_shortcode
+00051380: 732e 6170 7065 6e64 2876 290d 0a0d 0a20  s.append(v).... 
+00051390: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+000513a0: 6e28 6d69 7373 696e 675f 6669 656c 6473  n(missing_fields
+000513b0: 2920 3d3d 2030 2061 6e64 206c 656e 286d  ) == 0 and len(m
+000513c0: 6973 7369 6e67 5f65 6c65 6d65 6e74 5f73  issing_element_s
+000513d0: 686f 7274 636f 6465 7329 203d 3d20 303a  hortcodes) == 0:
+000513e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000513f0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+00051400: 6f72 2827 4361 6e6e 6f74 2064 6574 6572  or('Cannot deter
+00051410: 6d69 6e65 2077 6861 7420 736f 7274 206f  mine what sort o
+00051420: 6620 6d61 7070 696e 6720 6861 7320 6265  f mapping has be
+00051430: 656e 2063 7265 6174 6564 2066 6f72 2064  en created for d
+00051440: 696d 656e 7369 6f6e 5b7b 7d5d 2061 6c6c  imension[{}] all
+00051450: 206d 6170 7065 6420 6974 656d 7320 7b7d   mapped items {}
+00051460: 2063 6f75 6c64 2062 6520 6569 7468 6572   could be either
+00051470: 2046 6965 6c64 7320 6f72 2045 6c65 6d65   Fields or Eleme
+00051480: 6e74 2073 686f 7274 6e61 6d65 7327 2e66  nt shortnames'.f
+00051490: 6f72 6d61 7428 6469 6d65 6e73 696f 6e5f  ormat(dimension_
+000514a0: 696e 6465 782c 6c69 7374 286d 6170 7069  index,list(mappi
+000514b0: 6e67 2e76 616c 7565 7329 2929 0d0a 0d0a  ng.values)))....
+000514c0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+000514d0: 656e 286d 6973 7369 6e67 5f66 6965 6c64  en(missing_field
+000514e0: 7329 203d 3d20 303a 0d0a 2020 2020 2020  s) == 0:..      
+000514f0: 2020 2020 2020 2020 2020 6973 5f66 6965            is_fie
+00051500: 6c64 5f6d 6170 7069 6e67 203d 2054 7275  ld_mapping = Tru
+00051510: 650d 0a0d 0a20 2020 2020 2020 2020 2020  e....           
+00051520: 2069 6620 6c65 6e28 6d69 7373 696e 675f   if len(missing_
+00051530: 656c 656d 656e 745f 7368 6f72 7463 6f64  element_shortcod
+00051540: 6573 2920 3d3d 2020 303a 0d0a 2020 2020  es) ==  0:..    
+00051550: 2020 2020 2020 2020 2020 2020 6973 5f73              is_s
+00051560: 686f 7274 636f 6465 5f6d 6170 7069 6e67  hortcode_mapping
+00051570: 203d 2054 7275 650d 0a0d 0a20 2020 2020   = True....     
+00051580: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+00051590: 5f66 6965 6c64 5f6d 6170 7069 6e67 2061  _field_mapping a
+000515a0: 6e64 206e 6f74 2069 735f 7368 6f72 7463  nd not is_shortc
+000515b0: 6f64 655f 6d61 7070 696e 673a 0d0a 2020  ode_mapping:..  
+000515c0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000515d0: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+000515e0: 4361 6e6e 6f74 2064 6574 6572 6d69 6e65  Cannot determine
+000515f0: 2077 6861 7420 736f 7274 206f 6620 6d61   what sort of ma
+00051600: 7070 696e 6720 6861 7320 6265 656e 2063  pping has been c
+00051610: 7265 6174 6564 2066 6f72 2064 696d 656e  reated for dimen
+00051620: 7369 6f6e 5b7b 7d5d 2e20 7b7d 2061 7265  sion[{}]. {} are
+00051630: 206e 6f74 2046 6965 6c64 7320 616e 6420   not Fields and 
+00051640: 7b7d 2061 7265 206e 6f74 2045 6c65 6d65  {} are not Eleme
+00051650: 6e74 2073 686f 7274 6e61 6d65 7320 272e  nt shortnames '.
+00051660: 666f 726d 6174 2864 696d 656e 7369 6f6e  format(dimension
+00051670: 5f69 6e64 6578 2c6d 6973 7369 6e67 5f66  _index,missing_f
+00051680: 6965 6c64 732c 6d69 7373 696e 675f 656c  ields,missing_el
+00051690: 656d 656e 745f 7368 6f72 7463 6f64 6573  ement_shortcodes
+000516a0: 2929 0d0a 0d0a 2020 2020 2020 2020 2343  ))....        #C
+000516b0: 6865 636b 2063 6f6c 756d 6e20 6e61 6d65  heck column name
+000516c0: 7320 6d61 6b65 2073 656e 7365 2063 6f6d  s make sense com
+000516d0: 7061 7265 6420 746f 2074 6865 2073 6f75  pared to the sou
+000516e0: 7263 650d 0a20 2020 2020 2020 2069 6620  rce..        if 
+000516f0: 636f 6c75 6d6e 5f6e 616d 6573 2069 7320  column_names is 
+00051700: 6e6f 7420 4e6f 6e65 2061 6e64 2063 6f6c  not None and col
+00051710: 756d 6e73 5f64 6963 7420 6973 206e 6f74  umns_dict is not
+00051720: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00051730: 2020 2020 666f 7220 636f 6c75 6d6e 5f6e      for column_n
+00051740: 616d 6520 696e 2063 6f6c 756d 6e5f 6e61  ame in column_na
+00051750: 6d65 733a 0d0a 2020 2020 2020 2020 2020  mes:..          
+00051760: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00051770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00051780: 636f 6c75 6d6e 735f 6469 6374 5b63 6f6c  columns_dict[col
+00051790: 756d 6e5f 6e61 6d65 5d0d 0a20 2020 2020  umn_name]..     
+000517a0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+000517b0: 7420 4b65 7945 7272 6f72 3a0d 0a20 2020  t KeyError:..   
+000517c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000517d0: 2072 6169 7365 204b 6579 4572 726f 7228   raise KeyError(
+000517e0: 2743 6f6c 756d 6e20 227b 7d22 2077 6173  'Column "{}" was
+000517f0: 2069 6d70 6c69 6564 2062 7920 6d61 7070   implied by mapp
+00051800: 696e 6720 7b7d 2062 7574 2077 6173 206e  ing {} but was n
+00051810: 6f74 2066 6f75 6e64 2069 6e20 636f 6c75  ot found in colu
+00051820: 6d6e 206e 616d 6573 207b 7d20 6f72 2069  mn names {} or i
+00051830: 6e20 7368 6f72 7463 6f64 6573 206f 6620  n shortcodes of 
+00051840: 6469 6d65 6e73 696f 6e27 2e66 6f72 6d61  dimension'.forma
+00051850: 7428 636f 6c75 6d6e 5f6e 616d 652c 6d61  t(column_name,ma
+00051860: 7070 696e 672c 636f 6c75 6d6e 5f6c 6973  pping,column_lis
+00051870: 745f 746f 5f63 6865 636b 5f61 6761 696e  t_to_check_again
+00051880: 7374 2920 290d 0a0d 0a20 2020 2020 2020  st) )....       
+00051890: 2069 6620 636f 6c75 6d6e 5f6e 616d 6573   if column_names
+000518a0: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+000518b0: 206c 656e 2863 6f6c 756d 6e5f 6e61 6d65   len(column_name
+000518c0: 7329 203e 2030 3a0d 0a20 2020 2020 2020  s) > 0:..       
+000518d0: 2020 2020 2069 6620 7365 6c66 2e73 6f75       if self.sou
+000518e0: 7263 6520 6973 204e 6f6e 653a 0d0a 2020  rce is None:..  
+000518f0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00051900: 6973 6520 6d70 6578 2e4c 6f61 6465 7253  ise mpex.LoaderS
+00051910: 6574 7570 4572 726f 7228 274d 6170 7065  etupError('Mappe
+00051920: 6420 636f 6c75 6d6e 206e 616d 6573 207b  d column names {
+00051930: 7d20 696e 2064 696d 656e 7369 6f6e 207b  } in dimension {
+00051940: 7d20 636f 756c 6420 6e6f 7420 6265 2072  } could not be r
+00051950: 6573 6f6c 7665 6420 6265 6361 7573 6520  esolved because 
+00051960: 7468 6572 6520 6973 206e 6f20 736f 7572  there is no sour
+00051970: 6365 2044 6174 6146 7261 6d65 206f 7220  ce DataFrame or 
+00051980: 7468 6572 6520 6172 6520 6e6f 2063 6f6c  there are no col
+00051990: 756d 6e73 2069 6e20 7468 6520 736f 7572  umns in the sour
+000519a0: 6365 2044 6174 6146 7261 6d65 272e 666f  ce DataFrame'.fo
+000519b0: 726d 6174 2863 6f6c 756d 6e5f 6e61 6d65  rmat(column_name
+000519c0: 732c 2064 696d 656e 7369 6f6e 5f69 6e64  s, dimension_ind
+000519d0: 6578 2929 0d0a 2020 2020 2020 2020 2020  ex))..          
+000519e0: 2020 656c 6966 2073 656c 662e 636f 6c75    elif self.colu
+000519f0: 6d6e 7320 6973 204e 6f6e 653a 0d0a 2020  mns is None:..  
+00051a00: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00051a10: 6973 6520 4b65 7945 7272 6f72 2827 4d61  ise KeyError('Ma
+00051a20: 7070 6564 2063 6f6c 756d 6e20 6e61 6d65  pped column name
+00051a30: 7320 7b7d 2069 6e20 6469 6d65 6e73 696f  s {} in dimensio
+00051a40: 6e20 7b7d 2063 6f75 6c64 206e 6f74 2062  n {} could not b
+00051a50: 6520 7265 736f 6c76 6564 2062 6563 6175  e resolved becau
+00051a60: 7365 2074 6865 7265 2069 7320 6e6f 2073  se there is no s
+00051a70: 6f75 7263 6520 4461 7461 4672 616d 6520  ource DataFrame 
+00051a80: 6f72 2074 6865 7265 2061 7265 206e 6f20  or there are no 
+00051a90: 636f 6c75 6d6e 7320 696e 2074 6865 2073  columns in the s
+00051aa0: 6f75 7263 6520 4461 7461 4672 616d 6527  ource DataFrame'
+00051ab0: 2e66 6f72 6d61 7428 636f 6c75 6d6e 5f6e  .format(column_n
+00051ac0: 616d 6573 2c20 6469 6d65 6e73 696f 6e5f  ames, dimension_
+00051ad0: 696e 6465 7829 290d 0a0d 0a20 2020 2020  index))....     
+00051ae0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00051af0: 286f 626a 6563 745f 746f 5f63 6865 636b  (object_to_check
+00051b00: 5f61 6761 696e 7374 2c44 696d 656e 7369  _against,Dimensi
+00051b10: 6f6e 293a 0d0a 2020 2020 2020 2020 2020  on):..          
+00051b20: 2020 2349 6620 7765 2061 7265 2063 6865    #If we are che
+00051b30: 636b 696e 6720 6167 6169 6e73 7420 6120  cking against a 
+00051b40: 6469 6d65 6e73 696f 6e2c 2065 6e73 7572  dimension, ensur
+00051b50: 6520 7468 6174 2061 2073 696e 676c 6520  e that a single 
+00051b60: 7368 6f72 7463 6f64 6520 6973 206f 6e65  shortcode is one
+00051b70: 206f 6620 7468 6520 656c 656d 656e 7473   of the elements
+00051b80: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00051b90: 2069 735f 636f 6e73 7461 6e74 5f73 686f   is_constant_sho
+00051ba0: 7274 636f 6465 3a0d 0a20 2020 2020 2020  rtcode:..       
+00051bb0: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
+00051bc0: 203d 206f 626a 6563 745f 746f 5f63 6865   = object_to_che
+00051bd0: 636b 5f61 6761 696e 7374 2e65 6c65 6d65  ck_against.eleme
+00051be0: 6e74 735b 6d61 7070 696e 675d 0d0a 2020  nts[mapping]..  
+00051bf0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00051c00: 7475 726e 205b 656c 656d 656e 742e 7368  turn [element.sh
+00051c10: 6f72 746e 616d 655d 2c20 2763 6f6e 7374  ortname], 'const
+00051c20: 616e 7420 7368 6f72 746e 616d 6527 2c63  ant shortname',c
+00051c30: 6f6c 756d 6e5f 6e61 6d65 730d 0a20 2020  olumn_names..   
+00051c40: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+00051c50: 5f63 6f6c 756d 6e5f 696d 706c 6965 645f  _column_implied_
+00051c60: 7368 6f72 7463 6f64 655f 6d61 7070 696e  shortcode_mappin
+00051c70: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
+00051c80: 2020 2020 7265 7475 726e 204e 6f6e 652c      return None,
+00051c90: 2027 636f 6c75 6d6e 206e 616d 6527 2c63   'column name',c
+00051ca0: 6f6c 756d 6e5f 6e61 6d65 730d 0a20 2020  olumn_names..   
+00051cb0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+00051cc0: 5f73 686f 7274 636f 6465 5f6d 6170 7069  _shortcode_mappi
+00051cd0: 6e67 3a0d 0a20 2020 2020 2020 2020 2020  ng:..           
+00051ce0: 2020 2020 2023 6d65 7472 6963 5f64 6963       #metric_dic
+00051cf0: 7420 7374 796c 6520 6d61 7070 696e 670d  t style mapping.
+00051d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00051d10: 2072 6574 7572 6e20 5b6f 626a 6563 745f   return [object_
+00051d20: 746f 5f63 6865 636b 5f61 6761 696e 7374  to_check_against
+00051d30: 2e65 6c65 6d65 6e74 735b 7363 5d2e 7368  .elements[sc].sh
+00051d40: 6f72 746e 616d 6520 666f 7220 7363 2069  ortname for sc i
+00051d50: 6e20 6d61 7070 696e 672e 7661 6c75 6573  n mapping.values
+00051d60: 2829 5d2c 2027 636f 6c75 6d6e 7320 746f  ()], 'columns to
+00051d70: 2073 686f 7274 6e61 6d65 7327 2c63 6f6c   shortnames',col
+00051d80: 756d 6e5f 6e61 6d65 730d 0a0d 0a20 2020  umn_names....   
+00051d90: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
+00051da0: 5f66 6965 6c64 5f6d 6170 7069 6e67 3a0d  _field_mapping:.
 00051db0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00051dc0: 2066 6f72 2065 6c20 696e 206f 626a 6563   for el in objec
-00051dd0: 745f 746f 5f63 6865 636b 5f61 6761 696e  t_to_check_again
-00051de0: 7374 2e65 6c65 6d65 6e74 733a 0d0a 2020  st.elements:..  
-00051df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00051e00: 2020 6669 656c 6473 5f65 6c65 6d65 6e74    fields_element
-00051e10: 5f6c 6f6f 6b75 705b 7475 706c 6528 656c  _lookup[tuple(el
-00051e20: 2e66 6965 6c64 735b 6669 656c 645d 2066  .fields[field] f
-00051e30: 6f72 2066 6965 6c64 2069 6e20 666f 756e  or field in foun
-00051e40: 645f 6669 656c 6473 295d 203d 2065 6c2e  d_fields)] = el.
-00051e50: 7368 6f72 746e 616d 650d 0a0d 0a20 2020  shortname....   
-00051e60: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00051e70: 7572 6e20 6669 656c 6473 5f65 6c65 6d65  urn fields_eleme
-00051e80: 6e74 5f6c 6f6f 6b75 702c 2020 2763 6f6c  nt_lookup,  'col
-00051e90: 756d 6e73 2074 6f20 6669 656c 6473 272c  umns to fields',
-00051ea0: 636f 6c75 6d6e 5f6e 616d 6573 0d0a 2020  column_names..  
-00051eb0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-00051ec0: 735f 7368 6f72 7463 6f64 655f 7661 6c75  s_shortcode_valu
-00051ed0: 655f 6d61 7070 696e 673a 0d0a 2020 2020  e_mapping:..    
-00051ee0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00051ef0: 726e 205b 6f62 6a65 6374 5f74 6f5f 6368  rn [object_to_ch
-00051f00: 6563 6b5f 6167 6169 6e73 742e 656c 656d  eck_against.elem
-00051f10: 656e 7473 5b73 635d 2e73 686f 7274 6e61  ents[sc].shortna
-00051f20: 6d65 2066 6f72 2073 6320 696e 2073 686f  me for sc in sho
-00051f30: 7274 636f 6465 5f76 616c 7565 5f6d 6170  rtcode_value_map
-00051f40: 7069 6e67 2e6b 6579 7328 295d 2c20 2763  ping.keys()], 'c
-00051f50: 6f6c 756d 6e20 746f 2073 686f 7274 6e61  olumn to shortna
-00051f60: 6d65 2074 6f20 7661 6c75 6527 2c63 6f6c  me to value',col
-00051f70: 756d 6e5f 6e61 6d65 730d 0a20 2020 2020  umn_names..     
-00051f80: 2020 2020 2020 2065 6c69 6620 6973 5f63         elif is_c
-00051f90: 6f6e 7374 616e 745f 6461 7465 7469 6d65  onstant_datetime
-00051fa0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00051fb0: 2020 2072 6169 7365 206d 7065 782e 4c6f     raise mpex.Lo
-00051fc0: 6164 6572 5365 7475 7045 7272 6f72 2827  aderSetupError('
-00051fd0: 4361 6e6e 6f74 206d 6170 2063 6f6e 7374  Cannot map const
-00051fe0: 616e 7420 6461 7465 7469 6d65 7320 7965  ant datetimes ye
-00051ff0: 7427 290d 0a0d 0a0d 0a20 2020 2020 2020  t')......       
-00052000: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00052010: 286f 626a 6563 745f 746f 5f63 6865 636b  (object_to_check
-00052020: 5f61 6761 696e 7374 2c53 7472 7563 7475  _against,Structu
-00052030: 7265 2920 6f72 2020 6973 696e 7374 616e  re) or  isinstan
-00052040: 6365 286f 626a 6563 745f 746f 5f63 6865  ce(object_to_che
-00052050: 636b 5f61 6761 696e 7374 2c53 7472 7563  ck_against,Struc
-00052060: 7475 7265 456c 656d 656e 7429 3a0d 0a0d  tureElement):...
-00052070: 0a20 2020 2020 2020 2020 2020 2023 4c6f  .            #Lo
-00052080: 6f6b 2074 6872 6f75 6768 2061 6c6c 206f  ok through all o
-00052090: 6620 7468 6520 6869 6572 6172 6368 6965  f the hierarchie
-000520a0: 7320 666f 7220 6120 5374 7275 6374 7572  s for a Structur
-000520b0: 652c 2066 6f72 2061 2053 7472 7563 7475  e, for a Structu
-000520c0: 7265 456c 656d 656e 7420 6c6f 6f6b 2074  reElement look t
-000520d0: 6872 6f75 6768 2074 6861 740d 0a20 2020  hrough that..   
-000520e0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
-000520f0: 7374 616e 6365 286f 626a 6563 745f 746f  stance(object_to
-00052100: 5f63 6865 636b 5f61 6761 696e 7374 2c53  _check_against,S
-00052110: 7472 7563 7475 7265 293a 0d0a 2020 2020  tructure):..    
-00052120: 2020 2020 2020 2020 2020 2020 6869 6572              hier
-00052130: 6172 6368 6965 7320 3d20 6f62 6a65 6374  archies = object
-00052140: 5f74 6f5f 6368 6563 6b5f 6167 6169 6e73  _to_check_agains
-00052150: 742e 6869 6572 6172 6368 6965 730d 0a20  t.hierarchies.. 
-00052160: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00052170: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00052180: 2020 6869 6572 6172 6368 6965 7320 3d20    hierarchies = 
-00052190: 5b6f 626a 6563 745f 746f 5f63 6865 636b  [object_to_check
-000521a0: 5f61 6761 696e 7374 5d0d 0a0d 0a20 2020  _against]....   
-000521b0: 2020 2020 2020 2020 2069 6620 6973 5f63           if is_c
-000521c0: 6f6e 7374 616e 745f 7368 6f72 7463 6f64  onstant_shortcod
-000521d0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000521e0: 2020 2020 666f 7220 6869 6572 6172 6368      for hierarch
-000521f0: 7920 696e 2068 6965 7261 7263 6869 6573  y in hierarchies
-00052200: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00052210: 2020 2020 2020 2069 6620 6d61 7070 696e         if mappin
-00052220: 6720 696e 205b 6c2e 7368 6f72 746e 616d  g in [l.shortnam
-00052230: 6520 666f 7220 6c20 696e 2068 6965 7261  e for l in hiera
-00052240: 7263 6879 2e67 6574 5f65 6c65 6d65 6e74  rchy.get_element
-00052250: 7328 6d61 7070 696e 6729 5d3a 0d0a 2020  s(mapping)]:..  
-00052260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052270: 2020 2020 2020 7265 7475 726e 205b 6d61        return [ma
-00052280: 7070 696e 675d 2c20 2027 636f 6e73 7461  pping],  'consta
-00052290: 6e74 2073 686f 7274 6e61 6d65 272c 636f  nt shortname',co
-000522a0: 6c75 6d6e 5f6e 616d 6573 0d0a 2020 2020  lumn_names..    
-000522b0: 2020 2020 2020 2020 2020 2020 2349 6620              #If 
-000522c0: 7765 2064 6964 6e27 7420 7265 7475 726e  we didn't return
-000522d0: 2074 6865 2073 686f 7274 636f 6465 2c20   the shortcode, 
-000522e0: 7261 6973 6520 616e 204b 6579 4572 726f  raise an KeyErro
-000522f0: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
-00052300: 2020 2072 6169 7365 204b 6579 4572 726f     raise KeyErro
-00052310: 7228 2753 686f 7274 636f 6465 207b 7d20  r('Shortcode {} 
-00052320: 6973 206e 6f74 2069 6e20 7468 6520 5374  is not in the St
-00052330: 7275 6374 7572 6520 7b7d 2069 6e20 6469  ructure {} in di
-00052340: 6d65 6e73 696f 6e20 7b7d 272e 666f 726d  mension {}'.form
-00052350: 6174 286d 6170 7069 6e67 2c6f 626a 6563  at(mapping,objec
-00052360: 745f 746f 5f63 6865 636b 5f61 6761 696e  t_to_check_again
-00052370: 7374 2e73 686f 7274 6e61 6d65 2c20 6469  st.shortname, di
-00052380: 6d65 6e73 696f 6e5f 696e 6465 7829 290d  mension_index)).
-00052390: 0a0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
-000523a0: 6c69 6620 6973 5f63 6f6e 7374 616e 745f  lif is_constant_
-000523b0: 6461 7465 7469 6d65 3a0d 0a20 2020 2020  datetime:..     
-000523c0: 2020 2020 2020 2020 2020 2066 6f72 2068             for h
-000523d0: 6965 7261 7263 6879 2069 6e20 6869 6572  ierarchy in hier
-000523e0: 6172 6368 6965 733a 0d0a 2020 2020 2020  archies:..      
-000523f0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00052400: 7220 7365 2069 6e20 6869 6572 6172 6368  r se in hierarch
-00052410: 792e 7761 6c6b 2829 3a0d 0a20 2020 2020  y.walk():..     
-00052420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052430: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00052440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052450: 2020 2020 2069 6620 7365 2e65 6c65 6d65       if se.eleme
-00052460: 6e74 2e64 6174 6520 3d3d 206d 6170 7069  nt.date == mappi
-00052470: 6e67 3a0d 0a20 2020 2020 2020 2020 2020  ng:..           
-00052480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052490: 2020 2020 2072 6574 7572 6e20 5b73 652e       return [se.
-000524a0: 7368 6f72 746e 616d 655d 2c20 2027 636f  shortname],  'co
-000524b0: 6e73 7461 6e74 2064 6174 6527 2c20 636f  nstant date', co
-000524c0: 6c75 6d6e 5f6e 616d 6573 0d0a 2020 2020  lumn_names..    
-000524d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000524e0: 2020 2020 6578 6365 7074 2041 7474 7269      except Attri
-000524f0: 6275 7465 4572 726f 723a 0d0a 2020 2020  buteError:..    
+00051dc0: 2066 6965 6c64 735f 656c 656d 656e 745f   fields_element_
+00051dd0: 6c6f 6f6b 7570 203d 207b 7d0d 0a20 2020  lookup = {}..   
+00051de0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00051df0: 2065 6c20 696e 206f 626a 6563 745f 746f   el in object_to
+00051e00: 5f63 6865 636b 5f61 6761 696e 7374 2e65  _check_against.e
+00051e10: 6c65 6d65 6e74 733a 0d0a 2020 2020 2020  lements:..      
+00051e20: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+00051e30: 656c 6473 5f65 6c65 6d65 6e74 5f6c 6f6f  elds_element_loo
+00051e40: 6b75 705b 7475 706c 6528 656c 2e66 6965  kup[tuple(el.fie
+00051e50: 6c64 735b 6669 656c 645d 2066 6f72 2066  lds[field] for f
+00051e60: 6965 6c64 2069 6e20 666f 756e 645f 6669  ield in found_fi
+00051e70: 656c 6473 295d 203d 2065 6c2e 7368 6f72  elds)] = el.shor
+00051e80: 746e 616d 650d 0a0d 0a20 2020 2020 2020  tname....       
+00051e90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00051ea0: 6669 656c 6473 5f65 6c65 6d65 6e74 5f6c  fields_element_l
+00051eb0: 6f6f 6b75 702c 2020 2763 6f6c 756d 6e73  ookup,  'columns
+00051ec0: 2074 6f20 6669 656c 6473 272c 636f 6c75   to fields',colu
+00051ed0: 6d6e 5f6e 616d 6573 0d0a 2020 2020 2020  mn_names..      
+00051ee0: 2020 2020 2020 656c 6966 2069 735f 7368        elif is_sh
+00051ef0: 6f72 7463 6f64 655f 7661 6c75 655f 6d61  ortcode_value_ma
+00051f00: 7070 696e 673a 0d0a 2020 2020 2020 2020  pping:..        
+00051f10: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+00051f20: 6f62 6a65 6374 5f74 6f5f 6368 6563 6b5f  object_to_check_
+00051f30: 6167 6169 6e73 742e 656c 656d 656e 7473  against.elements
+00051f40: 5b73 635d 2e73 686f 7274 6e61 6d65 2066  [sc].shortname f
+00051f50: 6f72 2073 6320 696e 2073 686f 7274 636f  or sc in shortco
+00051f60: 6465 5f76 616c 7565 5f6d 6170 7069 6e67  de_value_mapping
+00051f70: 2e6b 6579 7328 295d 2c20 2763 6f6c 756d  .keys()], 'colum
+00051f80: 6e20 746f 2073 686f 7274 6e61 6d65 2074  n to shortname t
+00051f90: 6f20 7661 6c75 6527 2c63 6f6c 756d 6e5f  o value',column_
+00051fa0: 6e61 6d65 730d 0a20 2020 2020 2020 2020  names..         
+00051fb0: 2020 2065 6c69 6620 6973 5f63 6f6e 7374     elif is_const
+00051fc0: 616e 745f 6461 7465 7469 6d65 3a0d 0a20  ant_datetime:.. 
+00051fd0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00051fe0: 6169 7365 206d 7065 782e 4c6f 6164 6572  aise mpex.Loader
+00051ff0: 5365 7475 7045 7272 6f72 2827 4361 6e6e  SetupError('Cann
+00052000: 6f74 206d 6170 2063 6f6e 7374 616e 7420  ot map constant 
+00052010: 6461 7465 7469 6d65 7320 7965 7427 290d  datetimes yet').
+00052020: 0a0d 0a0d 0a20 2020 2020 2020 2065 6c69  .....        eli
+00052030: 6620 6973 696e 7374 616e 6365 286f 626a  f isinstance(obj
+00052040: 6563 745f 746f 5f63 6865 636b 5f61 6761  ect_to_check_aga
+00052050: 696e 7374 2c53 7472 7563 7475 7265 2920  inst,Structure) 
+00052060: 6f72 2020 6973 696e 7374 616e 6365 286f  or  isinstance(o
+00052070: 626a 6563 745f 746f 5f63 6865 636b 5f61  bject_to_check_a
+00052080: 6761 696e 7374 2c53 7472 7563 7475 7265  gainst,Structure
+00052090: 456c 656d 656e 7429 3a0d 0a0d 0a20 2020  Element):....   
+000520a0: 2020 2020 2020 2020 2023 4c6f 6f6b 2074           #Look t
+000520b0: 6872 6f75 6768 2061 6c6c 206f 6620 7468  hrough all of th
+000520c0: 6520 6869 6572 6172 6368 6965 7320 666f  e hierarchies fo
+000520d0: 7220 6120 5374 7275 6374 7572 652c 2066  r a Structure, f
+000520e0: 6f72 2061 2053 7472 7563 7475 7265 456c  or a StructureEl
+000520f0: 656d 656e 7420 6c6f 6f6b 2074 6872 6f75  ement look throu
+00052100: 6768 2074 6861 740d 0a20 2020 2020 2020  gh that..       
+00052110: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+00052120: 6365 286f 626a 6563 745f 746f 5f63 6865  ce(object_to_che
+00052130: 636b 5f61 6761 696e 7374 2c53 7472 7563  ck_against,Struc
+00052140: 7475 7265 293a 0d0a 2020 2020 2020 2020  ture):..        
+00052150: 2020 2020 2020 2020 6869 6572 6172 6368          hierarch
+00052160: 6965 7320 3d20 6f62 6a65 6374 5f74 6f5f  ies = object_to_
+00052170: 6368 6563 6b5f 6167 6169 6e73 742e 6869  check_against.hi
+00052180: 6572 6172 6368 6965 730d 0a20 2020 2020  erarchies..     
+00052190: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+000521a0: 2020 2020 2020 2020 2020 2020 2020 6869                hi
+000521b0: 6572 6172 6368 6965 7320 3d20 5b6f 626a  erarchies = [obj
+000521c0: 6563 745f 746f 5f63 6865 636b 5f61 6761  ect_to_check_aga
+000521d0: 696e 7374 5d0d 0a0d 0a20 2020 2020 2020  inst]....       
+000521e0: 2020 2020 2069 6620 6973 5f63 6f6e 7374       if is_const
+000521f0: 616e 745f 7368 6f72 7463 6f64 653a 0d0a  ant_shortcode:..
+00052200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052210: 666f 7220 6869 6572 6172 6368 7920 696e  for hierarchy in
+00052220: 2068 6965 7261 7263 6869 6573 3a0d 0a20   hierarchies:.. 
+00052230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052240: 2020 2069 6620 6d61 7070 696e 6720 696e     if mapping in
+00052250: 205b 6c2e 7368 6f72 746e 616d 6520 666f   [l.shortname fo
+00052260: 7220 6c20 696e 2068 6965 7261 7263 6879  r l in hierarchy
+00052270: 2e67 6574 5f65 6c65 6d65 6e74 7328 6d61  .get_elements(ma
+00052280: 7070 696e 6729 5d3a 0d0a 2020 2020 2020  pping)]:..      
+00052290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000522a0: 2020 7265 7475 726e 205b 6d61 7070 696e    return [mappin
+000522b0: 675d 2c20 2027 636f 6e73 7461 6e74 2073  g],  'constant s
+000522c0: 686f 7274 6e61 6d65 272c 636f 6c75 6d6e  hortname',column
+000522d0: 5f6e 616d 6573 0d0a 2020 2020 2020 2020  _names..        
+000522e0: 2020 2020 2020 2020 2349 6620 7765 2064          #If we d
+000522f0: 6964 6e27 7420 7265 7475 726e 2074 6865  idn't return the
+00052300: 2073 686f 7274 636f 6465 2c20 7261 6973   shortcode, rais
+00052310: 6520 616e 204b 6579 4572 726f 720d 0a20  e an KeyError.. 
+00052320: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00052330: 6169 7365 204b 6579 4572 726f 7228 2753  aise KeyError('S
+00052340: 686f 7274 636f 6465 207b 7d20 6973 206e  hortcode {} is n
+00052350: 6f74 2069 6e20 7468 6520 5374 7275 6374  ot in the Struct
+00052360: 7572 6520 7b7d 2069 6e20 6469 6d65 6e73  ure {} in dimens
+00052370: 696f 6e20 7b7d 272e 666f 726d 6174 286d  ion {}'.format(m
+00052380: 6170 7069 6e67 2c6f 626a 6563 745f 746f  apping,object_to
+00052390: 5f63 6865 636b 5f61 6761 696e 7374 2e73  _check_against.s
+000523a0: 686f 7274 6e61 6d65 2c20 6469 6d65 6e73  hortname, dimens
+000523b0: 696f 6e5f 696e 6465 7829 290d 0a0d 0a20  ion_index)).... 
+000523c0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+000523d0: 6973 5f63 6f6e 7374 616e 745f 6461 7465  is_constant_date
+000523e0: 7469 6d65 3a0d 0a20 2020 2020 2020 2020  time:..         
+000523f0: 2020 2020 2020 2066 6f72 2068 6965 7261         for hiera
+00052400: 7263 6879 2069 6e20 6869 6572 6172 6368  rchy in hierarch
+00052410: 6965 733a 0d0a 2020 2020 2020 2020 2020  ies:..          
+00052420: 2020 2020 2020 2020 2020 666f 7220 7365            for se
+00052430: 2069 6e20 6869 6572 6172 6368 792e 7761   in hierarchy.wa
+00052440: 6c6b 2829 3a0d 0a20 2020 2020 2020 2020  lk():..         
+00052450: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00052460: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+00052470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052480: 2069 6620 7365 2e65 6c65 6d65 6e74 2e64   if se.element.d
+00052490: 6174 6520 3d3d 206d 6170 7069 6e67 3a0d  ate == mapping:.
+000524a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000524b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000524c0: 2072 6574 7572 6e20 5b73 652e 7368 6f72   return [se.shor
+000524d0: 746e 616d 655d 2c20 2027 636f 6e73 7461  tname],  'consta
+000524e0: 6e74 2064 6174 6527 2c20 636f 6c75 6d6e  nt date', column
+000524f0: 5f6e 616d 6573 0d0a 2020 2020 2020 2020  _names..        
 00052500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052510: 2020 2020 2020 2020 234e 6f74 2061 6c6c          #Not all
-00052520: 2065 6c65 6d65 6e74 7320 7769 6c6c 2068   elements will h
-00052530: 6176 6520 6120 2e64 6174 6520 6174 7472  ave a .date attr
-00052540: 6962 7574 6520 2d20 7468 6174 2773 204f  ibute - that's O
-00052550: 4b0d 0a20 2020 2020 2020 2020 2020 2020  K..             
-00052560: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00052570: 6173 730d 0a0d 0a20 2020 2020 2020 2020  ass....         
-00052580: 2020 2020 2020 2023 4966 2077 6520 6469         #If we di
-00052590: 646e 2774 2072 6574 7572 6e20 616e 2065  dn't return an e
-000525a0: 6c65 6d65 6e74 2077 6974 6820 7468 6520  lement with the 
-000525b0: 7368 6f72 7463 6f64 652c 2072 6169 7365  shortcode, raise
-000525c0: 2061 6e20 4b65 7945 7272 6f72 0d0a 2020   an KeyError..  
-000525d0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000525e0: 6973 6520 4b65 7945 7272 6f72 2827 4e6f  ise KeyError('No
-000525f0: 2065 6c65 6d65 6e74 2066 6f75 6e64 2077   element found w
-00052600: 6974 6820 6461 7465 7469 6d65 207b 7d20  ith datetime {} 
-00052610: 696e 2074 6865 2053 7472 7563 7475 7265  in the Structure
-00052620: 207b 7d20 696e 2064 696d 656e 7369 6f6e   {} in dimension
-00052630: 207b 7d27 2e66 6f72 6d61 7428 6d61 7070   {}'.format(mapp
-00052640: 696e 672c 6f62 6a65 6374 5f74 6f5f 6368  ing,object_to_ch
-00052650: 6563 6b5f 6167 6169 6e73 742e 7368 6f72  eck_against.shor
-00052660: 746e 616d 652c 2064 696d 656e 7369 6f6e  tname, dimension
-00052670: 5f69 6e64 6578 2929 0d0a 0d0a 2020 2020  _index))....    
-00052680: 2020 2020 2020 2020 656c 6966 2069 735f          elif is_
-00052690: 636f 6c75 6d6e 5f69 6d70 6c69 6564 5f73  column_implied_s
-000526a0: 686f 7274 636f 6465 5f6d 6170 7069 6e67  hortcode_mapping
-000526b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000526c0: 2020 2072 6574 7572 6e20 4e6f 6e65 2c20     return None, 
-000526d0: 2763 6f6c 756d 6e20 6e61 6d65 272c 636f  'column name',co
-000526e0: 6c75 6d6e 5f6e 616d 6573 0d0a 0d0a 2020  lumn_names....  
-000526f0: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
-00052700: 735f 7368 6f72 7463 6f64 655f 6d61 7070  s_shortcode_mapp
-00052710: 696e 673a 0d0a 2020 2020 2020 2020 2020  ing:..          
-00052720: 2020 2020 2020 236d 6574 7269 635f 6469        #metric_di
-00052730: 6374 2073 7479 6c65 206d 6170 7069 6e67  ct style mapping
+00052510: 6578 6365 7074 2041 7474 7269 6275 7465  except Attribute
+00052520: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
+00052530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052540: 2020 2020 234e 6f74 2061 6c6c 2065 6c65      #Not all ele
+00052550: 6d65 6e74 7320 7769 6c6c 2068 6176 6520  ments will have 
+00052560: 6120 2e64 6174 6520 6174 7472 6962 7574  a .date attribut
+00052570: 6520 2d20 7468 6174 2773 204f 4b0d 0a20  e - that's OK.. 
+00052580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052590: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+000525a0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+000525b0: 2020 2023 4966 2077 6520 6469 646e 2774     #If we didn't
+000525c0: 2072 6574 7572 6e20 616e 2065 6c65 6d65   return an eleme
+000525d0: 6e74 2077 6974 6820 7468 6520 7368 6f72  nt with the shor
+000525e0: 7463 6f64 652c 2072 6169 7365 2061 6e20  tcode, raise an 
+000525f0: 4b65 7945 7272 6f72 0d0a 2020 2020 2020  KeyError..      
+00052600: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00052610: 4b65 7945 7272 6f72 2827 4e6f 2065 6c65  KeyError('No ele
+00052620: 6d65 6e74 2066 6f75 6e64 2077 6974 6820  ment found with 
+00052630: 6461 7465 7469 6d65 207b 7d20 696e 2074  datetime {} in t
+00052640: 6865 2053 7472 7563 7475 7265 207b 7d20  he Structure {} 
+00052650: 696e 2064 696d 656e 7369 6f6e 207b 7d27  in dimension {}'
+00052660: 2e66 6f72 6d61 7428 6d61 7070 696e 672c  .format(mapping,
+00052670: 6f62 6a65 6374 5f74 6f5f 6368 6563 6b5f  object_to_check_
+00052680: 6167 6169 6e73 742e 7368 6f72 746e 616d  against.shortnam
+00052690: 652c 2064 696d 656e 7369 6f6e 5f69 6e64  e, dimension_ind
+000526a0: 6578 2929 0d0a 0d0a 2020 2020 2020 2020  ex))....        
+000526b0: 2020 2020 656c 6966 2069 735f 636f 6c75      elif is_colu
+000526c0: 6d6e 5f69 6d70 6c69 6564 5f73 686f 7274  mn_implied_short
+000526d0: 636f 6465 5f6d 6170 7069 6e67 3a0d 0a20  code_mapping:.. 
+000526e0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000526f0: 6574 7572 6e20 4e6f 6e65 2c20 2763 6f6c  eturn None, 'col
+00052700: 756d 6e20 6e61 6d65 272c 636f 6c75 6d6e  umn name',column
+00052710: 5f6e 616d 6573 0d0a 0d0a 2020 2020 2020  _names....      
+00052720: 2020 2020 2020 656c 6966 2069 735f 7368        elif is_sh
+00052730: 6f72 7463 6f64 655f 6d61 7070 696e 673a  ortcode_mapping:
 00052740: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00052750: 2020 656c 656d 656e 7473 203d 205b 5d0d    elements = [].
-00052760: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00052770: 2066 6f72 2068 6965 7261 7263 6879 2069   for hierarchy i
-00052780: 6e20 6869 6572 6172 6368 6965 733a 0d0a  n hierarchies:..
-00052790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000527a0: 2020 2020 666f 7220 7363 2069 6e20 6d61      for sc in ma
-000527b0: 7070 696e 672e 7661 6c75 6573 2829 3a0d  pping.values():.
-000527c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000527d0: 2020 2020 2020 2020 2069 6620 7363 2069           if sc i
-000527e0: 6e20 5b6c 2e73 686f 7274 6e61 6d65 2066  n [l.shortname f
-000527f0: 6f72 206c 2069 6e20 6869 6572 6172 6368  or l in hierarch
-00052800: 792e 6765 745f 656c 656d 656e 7473 2873  y.get_elements(s
-00052810: 6329 5d3a 0d0a 2020 2020 2020 2020 2020  c)]:..          
-00052820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052830: 2020 656c 656d 656e 7473 2e61 7070 656e    elements.appen
-00052840: 6428 7363 290d 0a20 2020 2020 2020 2020  d(sc)..         
-00052850: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-00052860: 656d 656e 7473 2c20 2763 6f6c 756d 6e73  ements, 'columns
-00052870: 2074 6f20 7368 6f72 746e 616d 6573 272c   to shortnames',
-00052880: 636f 6c75 6d6e 5f6e 616d 6573 0d0a 0d0a  column_names....
-00052890: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000528a0: 2069 735f 6669 656c 645f 6d61 7070 696e   is_field_mappin
-000528b0: 673a 0d0a 2020 2020 2020 2020 2020 2020  g:..            
-000528c0: 2020 2020 6669 656c 6473 5f65 6c65 6d65      fields_eleme
-000528d0: 6e74 5f6c 6f6f 6b75 7020 3d20 7b7d 0d0a  nt_lookup = {}..
+00052750: 2020 236d 6574 7269 635f 6469 6374 2073    #metric_dict s
+00052760: 7479 6c65 206d 6170 7069 6e67 0d0a 2020  tyle mapping..  
+00052770: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00052780: 656d 656e 7473 203d 205b 5d0d 0a20 2020  ements = []..   
+00052790: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+000527a0: 2068 6965 7261 7263 6879 2069 6e20 6869   hierarchy in hi
+000527b0: 6572 6172 6368 6965 733a 0d0a 2020 2020  erarchies:..    
+000527c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000527d0: 666f 7220 7363 2069 6e20 6d61 7070 696e  for sc in mappin
+000527e0: 672e 7661 6c75 6573 2829 3a0d 0a20 2020  g.values():..   
+000527f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052800: 2020 2020 2069 6620 7363 2069 6e20 5b6c       if sc in [l
+00052810: 2e73 686f 7274 6e61 6d65 2066 6f72 206c  .shortname for l
+00052820: 2069 6e20 6869 6572 6172 6368 792e 6765   in hierarchy.ge
+00052830: 745f 656c 656d 656e 7473 2873 6329 5d3a  t_elements(sc)]:
+00052840: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00052850: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00052860: 656d 656e 7473 2e61 7070 656e 6428 7363  ements.append(sc
+00052870: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00052880: 2020 2072 6574 7572 6e20 656c 656d 656e     return elemen
+00052890: 7473 2c20 2763 6f6c 756d 6e73 2074 6f20  ts, 'columns to 
+000528a0: 7368 6f72 746e 616d 6573 272c 636f 6c75  shortnames',colu
+000528b0: 6d6e 5f6e 616d 6573 0d0a 0d0a 2020 2020  mn_names....    
+000528c0: 2020 2020 2020 2020 656c 6966 2069 735f          elif is_
+000528d0: 6669 656c 645f 6d61 7070 696e 673a 0d0a  field_mapping:..
 000528e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000528f0: 666f 7220 6869 6572 6172 6368 7920 696e  for hierarchy in
-00052900: 2068 6965 7261 7263 6869 6573 3a0d 0a20   hierarchies:.. 
-00052910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052920: 2020 2066 6f72 2065 6c20 696e 2068 6965     for el in hie
-00052930: 7261 7263 6879 2e6c 6561 7665 733a 0d0a  rarchy.leaves:..
-00052940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052950: 2020 2020 2020 2020 6669 656c 6473 5f65          fields_e
-00052960: 6c65 6d65 6e74 5f6c 6f6f 6b75 705b 7475  lement_lookup[tu
-00052970: 706c 6528 656c 2e66 6965 6c64 735b 6669  ple(el.fields[fi
-00052980: 656c 645d 2066 6f72 2066 6965 6c64 2069  eld] for field i
-00052990: 6e20 666f 756e 645f 6669 656c 6473 295d  n found_fields)]
-000529a0: 203d 2065 6c2e 7368 6f72 746e 616d 650d   = el.shortname.
-000529b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000529c0: 2072 6574 7572 6e20 6669 656c 6473 5f65   return fields_e
-000529d0: 6c65 6d65 6e74 5f6c 6f6f 6b75 702c 2027  lement_lookup, '
-000529e0: 636f 6c75 6d6e 7320 746f 2066 6965 6c64  columns to field
-000529f0: 7327 202c 636f 6c75 6d6e 5f6e 616d 6573  s' ,column_names
-00052a00: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00052a10: 6966 2069 735f 7368 6f72 7463 6f64 655f  if is_shortcode_
-00052a20: 7661 6c75 655f 6d61 7070 696e 673a 0d0a  value_mapping:..
-00052a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052a40: 656c 656d 656e 7473 203d 205b 5d0d 0a20  elements = [].. 
-00052a50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00052a60: 6f72 2073 6320 696e 2073 686f 7274 636f  or sc in shortco
-00052a70: 6465 5f76 616c 7565 5f6d 6170 7069 6e67  de_value_mapping
-00052a80: 2e6b 6579 7328 293a 0d0a 2020 2020 2020  .keys():..      
-00052a90: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00052aa0: 7220 6869 6572 6172 6368 7920 696e 2068  r hierarchy in h
-00052ab0: 6965 7261 7263 6869 6573 3a0d 0a20 2020  ierarchies:..   
-00052ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00052ad0: 2020 2020 2069 6620 7363 2069 6e20 5b6c       if sc in [l
-00052ae0: 2e73 686f 7274 6e61 6d65 2066 6f72 206c  .shortname for l
-00052af0: 2069 6e20 6869 6572 6172 6368 792e 6765   in hierarchy.ge
-00052b00: 745f 656c 656d 656e 7473 2873 6329 5d3a  t_elements(sc)]:
-00052b10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00052b20: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00052b30: 656d 656e 7473 2e61 7070 656e 6428 7363  ements.append(sc
-00052b40: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00052b50: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
-00052b60: 656e 7473 2c20 2763 6f6c 756d 6e20 746f  ents, 'column to
-00052b70: 2073 686f 7274 6e61 6d65 2074 6f20 7661   shortname to va
-00052b80: 6c75 6527 2c20 636f 6c75 6d6e 5f6e 616d  lue', column_nam
-00052b90: 6573 0d0a 0d0a 2020 2020 2020 2020 2020  es....          
-00052ba0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00052bb0: 2020 2020 2020 2020 2023 5765 2776 6520           #We've 
-00052bc0: 6661 6c6c 656e 206f 6666 2074 6865 2065  fallen off the e
-00052bd0: 6e64 206f 6620 7468 6520 776f 726c 6420  nd of the world 
-00052be0: 6865 7265 202d 2073 6f6d 6574 6869 6e67  here - something
-00052bf0: 2069 6e20 7468 6520 6c6f 6769 6320 6f66   in the logic of
-00052c00: 2074 6865 2063 6f64 6520 6973 2062 726f   the code is bro
-00052c10: 6b65 6e0d 0a20 2020 2020 2020 2020 2020  ken..           
-00052c20: 2020 2020 2072 6169 7365 206d 7065 782e       raise mpex.
-00052c30: 4c6f 6164 6572 5365 7475 7045 7272 6f72  LoaderSetupError
-00052c40: 2827 436f 756c 6420 6e6f 7420 6669 6e64  ('Could not find
-00052c50: 206d 6170 7069 6e67 2074 7970 6527 290d   mapping type').
-00052c60: 0a0d 0a20 2020 2064 6566 205f 6372 6561  ...    def _crea
-00052c70: 7465 5f54 6162 6c65 4d61 7070 6572 7328  te_TableMappers(
-00052c80: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00052c90: 6966 2073 656c 662e 5f69 6e69 7469 616c  if self._initial
-00052ca0: 5f74 6172 6765 7420 6973 204e 6f6e 653a  _target is None:
-00052cb0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-00052cc0: 6973 6520 6d70 6578 2e4c 6f61 6465 7253  ise mpex.LoaderS
-00052cd0: 6574 7570 4572 726f 7228 2743 616e 6e6f  etupError('Canno
-00052ce0: 7420 7365 7420 7570 2061 2046 6f63 7573  t set up a Focus
-00052cf0: 4c6f 6164 6572 2077 6974 686f 7574 2061  Loader without a
-00052d00: 2074 6172 6765 7427 290d 0a0d 0a20 2020   target')....   
-00052d10: 2020 2020 2073 656c 662e 5f64 696d 656e       self._dimen
-00052d20: 7369 6f6e 5f30 5f6d 6170 7065 7220 2020  sion_0_mapper   
-00052d30: 3d20 7365 6c66 2e5f 6765 745f 5461 626c  = self._get_Tabl
-00052d40: 654d 6170 7065 725f 666f 725f 6469 6d65  eMapper_for_dime
-00052d50: 6e73 696f 6e69 6e64 6578 2864 696d 656e  nsionindex(dimen
-00052d60: 7369 6f6e 5f69 6e64 6578 203d 2030 290d  sion_index = 0).
-00052d70: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
-00052d80: 696d 656e 7369 6f6e 5f31 5f6d 6170 7065  imension_1_mappe
-00052d90: 7220 2020 3d20 7365 6c66 2e5f 6765 745f  r   = self._get_
-00052da0: 5461 626c 654d 6170 7065 725f 666f 725f  TableMapper_for_
-00052db0: 6469 6d65 6e73 696f 6e69 6e64 6578 2864  dimensionindex(d
-00052dc0: 696d 656e 7369 6f6e 5f69 6e64 6578 203d  imension_index =
-00052dd0: 2031 290d 0a20 2020 2020 2020 2073 656c   1)..        sel
-00052de0: 662e 5f64 696d 656e 7369 6f6e 5f32 5f6d  f._dimension_2_m
-00052df0: 6170 7065 7220 2020 3d20 7365 6c66 2e5f  apper   = self._
-00052e00: 6765 745f 5461 626c 654d 6170 7065 725f  get_TableMapper_
-00052e10: 666f 725f 6469 6d65 6e73 696f 6e69 6e64  for_dimensionind
-00052e20: 6578 2864 696d 656e 7369 6f6e 5f69 6e64  ex(dimension_ind
-00052e30: 6578 203d 2032 290d 0a20 2020 2020 2020  ex = 2)..       
-00052e40: 2073 656c 662e 5f64 696d 656e 7369 6f6e   self._dimension
-00052e50: 5f33 5f6d 6170 7065 7220 2020 3d20 7365  _3_mapper   = se
-00052e60: 6c66 2e5f 6765 745f 5461 626c 654d 6170  lf._get_TableMap
-00052e70: 7065 725f 666f 725f 6469 6d65 6e73 696f  per_for_dimensio
-00052e80: 6e69 6e64 6578 2864 696d 656e 7369 6f6e  nindex(dimension
-00052e90: 5f69 6e64 6578 203d 2033 290d 0a20 2020  _index = 3)..   
-00052ea0: 2020 2020 2073 656c 662e 5f64 696d 656e       self._dimen
-00052eb0: 7369 6f6e 5f34 5f6d 6170 7065 7220 2020  sion_4_mapper   
-00052ec0: 3d20 7365 6c66 2e5f 6765 745f 5461 626c  = self._get_Tabl
-00052ed0: 654d 6170 7065 725f 666f 725f 6469 6d65  eMapper_for_dime
-00052ee0: 6e73 696f 6e69 6e64 6578 2864 696d 656e  nsionindex(dimen
-00052ef0: 7369 6f6e 5f69 6e64 6578 203d 2034 290d  sion_index = 4).
-00052f00: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
-00052f10: 696d 656e 7369 6f6e 5f35 5f6d 6170 7065  imension_5_mappe
-00052f20: 7220 2020 3d20 7365 6c66 2e5f 6765 745f  r   = self._get_
-00052f30: 5461 626c 654d 6170 7065 725f 666f 725f  TableMapper_for_
-00052f40: 6469 6d65 6e73 696f 6e69 6e64 6578 2864  dimensionindex(d
-00052f50: 696d 656e 7369 6f6e 5f69 6e64 6578 203d  imension_index =
-00052f60: 2035 290d 0a20 2020 2020 2020 2073 656c   5)..        sel
-00052f70: 662e 5f64 696d 656e 7369 6f6e 5f36 5f6d  f._dimension_6_m
-00052f80: 6170 7065 7220 2020 3d20 7365 6c66 2e5f  apper   = self._
-00052f90: 6765 745f 5461 626c 654d 6170 7065 725f  get_TableMapper_
-00052fa0: 666f 725f 6469 6d65 6e73 696f 6e69 6e64  for_dimensionind
-00052fb0: 6578 2864 696d 656e 7369 6f6e 5f69 6e64  ex(dimension_ind
-00052fc0: 6578 203d 2036 290d 0a20 2020 2020 2020  ex = 6)..       
-00052fd0: 2073 656c 662e 5f64 696d 656e 7369 6f6e   self._dimension
-00052fe0: 5f37 5f6d 6170 7065 7220 2020 3d20 7365  _7_mapper   = se
-00052ff0: 6c66 2e5f 6765 745f 5461 626c 654d 6170  lf._get_TableMap
-00053000: 7065 725f 666f 725f 6469 6d65 6e73 696f  per_for_dimensio
-00053010: 6e69 6e64 6578 2864 696d 656e 7369 6f6e  nindex(dimension
-00053020: 5f69 6e64 6578 203d 2037 290d 0a20 2020  _index = 7)..   
-00053030: 2020 2020 2073 656c 662e 5f6d 6574 7269       self._metri
-00053040: 635f 6d61 7070 6572 2020 2020 2020 2020  c_mapper        
-00053050: 3d20 7365 6c66 2e5f 6765 745f 5461 626c  = self._get_Tabl
-00053060: 654d 6170 7065 725f 666f 725f 6469 6d65  eMapper_for_dime
-00053070: 6e73 696f 6e69 6e64 6578 2864 696d 656e  nsionindex(dimen
-00053080: 7369 6f6e 5f69 6e64 6578 203d 2038 290d  sion_index = 8).
-00053090: 0a20 2020 2020 2020 2073 656c 662e 5f6d  .        self._m
-000530a0: 6f64 655f 6d61 7070 6572 2020 2020 2020  ode_mapper      
-000530b0: 2020 2020 3d20 7365 6c66 2e5f 6765 745f      = self._get_
-000530c0: 5461 626c 654d 6170 7065 725f 666f 725f  TableMapper_for_
-000530d0: 6469 6d65 6e73 696f 6e69 6e64 6578 2864  dimensionindex(d
-000530e0: 696d 656e 7369 6f6e 5f69 6e64 6578 203d  imension_index =
-000530f0: 2039 290d 0a20 2020 2020 2020 2073 656c   9)..        sel
-00053100: 662e 5f62 6173 655f 6d61 7070 6572 2020  f._base_mapper  
-00053110: 2020 2020 2020 2020 3d20 7365 6c66 2e5f          = self._
-00053120: 6765 745f 5461 626c 654d 6170 7065 725f  get_TableMapper_
-00053130: 666f 725f 6469 6d65 6e73 696f 6e69 6e64  for_dimensionind
-00053140: 6578 2864 696d 656e 7369 6f6e 5f69 6e64  ex(dimension_ind
-00053150: 6578 203d 2031 3029 0d0a 0d0a 2020 2020  ex = 10)....    
-00053160: 2020 2020 7469 6d65 5f6d 6170 7065 725f      time_mapper_
-00053170: 7475 706c 6520 2020 2020 2020 2020 203d  tuple          =
-00053180: 2073 656c 662e 5f67 6574 5f54 6162 6c65   self._get_Table
-00053190: 4d61 7070 6572 5f66 6f72 5f64 696d 656e  Mapper_for_dimen
-000531a0: 7369 6f6e 696e 6465 7828 6469 6d65 6e73  sionindex(dimens
-000531b0: 696f 6e5f 696e 6465 7820 3d20 3131 290d  ion_index = 11).
-000531c0: 0a0d 0a20 2020 2020 2020 2069 6620 7469  ...        if ti
-000531d0: 6d65 5f6d 6170 7065 725f 7475 706c 6520  me_mapper_tuple 
-000531e0: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
-000531f0: 2020 2020 2020 7365 6c66 2e5f 7469 6d65        self._time
-00053200: 5f6d 6170 7065 7220 2020 2020 2020 2020  _mapper         
-00053210: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-00053220: 2020 2020 7365 6c66 2e5f 656d 706f 7765      self._empowe
-00053230: 725f 7065 7269 6f64 5f74 7970 6520 3d20  r_period_type = 
-00053240: 4e6f 6e65 0d0a 2020 2020 2020 2020 656c  None..        el
-00053250: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00053260: 2073 656c 662e 5f74 696d 655f 6d61 7070   self._time_mapp
-00053270: 6572 2c73 656c 662e 5f65 6d70 6f77 6572  er,self._empower
-00053280: 5f70 6572 696f 645f 7479 7065 203d 2074  _period_type = t
-00053290: 696d 655f 6d61 7070 6572 5f74 7570 6c65  ime_mapper_tuple
-000532a0: 0d0a 0d0a 2020 2020 6465 6620 5f67 6574  ....    def _get
-000532b0: 5f65 6666 6563 7469 7665 5f65 6c65 6d65  _effective_eleme
-000532c0: 6e74 5f66 6f72 5f73 7472 7563 7475 7265  nt_for_structure
-000532d0: 2873 656c 662c 6469 6d65 6e73 696f 6e5f  (self,dimension_
-000532e0: 696e 6465 782c 6566 6665 6374 6976 655f  index,effective_
-000532f0: 656c 656d 656e 7473 293a 0d0a 2020 2020  elements):..    
-00053300: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
-00053310: 203a 7061 7261 6d20 6566 6665 6374 6976   :param effectiv
-00053320: 655f 656c 656d 656e 7473 3a20 4375 7272  e_elements: Curr
-00053330: 656e 746c 7920 6967 6e6f 7265 7320 2d20  ently ignores - 
-00053340: 7365 6520 636f 6d6d 656e 7473 2062 656c  see comments bel
-00053350: 6f77 0d0a 2020 2020 2020 2020 2727 270d  ow..        '''.
-00053360: 0a20 2020 2020 2020 2023 6566 6665 6374  .        #effect
-00053370: 6976 655f 656c 656d 656e 7473 206d 6179  ive_elements may
-00053380: 2062 6520 4e6f 6e65 2e0d 0a20 2020 2020   be None...     
-00053390: 2020 2023 5468 6973 2069 7320 7768 6174     #This is what
-000533a0: 2067 6574 7320 7265 7475 726e 6564 2077   gets returned w
-000533b0: 6865 6e20 7765 2068 6176 6520 6669 6775  hen we have figu
-000533c0: 7265 6420 6f75 7420 7765 2061 7265 206c  red out we are l
-000533d0: 6f6f 6b69 6e67 2061 7420 6120 636f 6c75  ooking at a colu
-000533e0: 6d6e 0d0a 2020 2020 2020 2020 2349 7420  mn..        #It 
-000533f0: 696d 706c 6965 7320 7468 6174 2077 6520  implies that we 
-00053400: 7061 7373 2074 6865 2065 6666 6563 7469  pass the effecti
-00053410: 7665 2065 6c65 6d65 6e74 2061 7320 636f  ve element as co
-00053420: 6d70 7574 6564 2062 7920 7365 6c66 2e65  mputed by self.e
-00053430: 6666 6563 7469 7665 5f64 696d 656e 7369  ffective_dimensi
-00053440: 6f6e 5f65 6c65 6d65 6e74 7328 290d 0a0d  on_elements()...
-00053450: 0a20 2020 2020 2020 2023 2321 2121 2121  .        ##!!!!!
-00053460: 2121 210d 0a20 2020 2020 2020 2023 2066  !!!..        # f
-00053470: 6f72 206e 6f77 2077 6520 6172 6520 6967  or now we are ig
-00053480: 6e6f 7269 6e67 2065 6666 6563 7469 7665  noring effective
-00053490: 5f65 6c65 6d65 6e74 7320 696e 7075 7420  _elements input 
-000534a0: 2d20 6974 206d 6967 6874 2068 6176 6520  - it might have 
-000534b0: 736f 6d65 2075 7365 2c20 6275 7420 756e  some use, but un
-000534c0: 666f 7274 756e 6174 656c 7920 6974 2067  fortunately it g
-000534d0: 6574 7320 7468 6520 6f6e 6573 2061 7420  ets the ones at 
-000534e0: 6c65 6166 206c 6576 656c 0d0a 2020 2020  leaf level..    
-000534f0: 2020 2020 2320 666f 7220 636f 6d70 6172      # for compar
-00053500: 6973 6f6e 2077 6974 6820 7468 6520 6461  ison with the da
-00053510: 7461 2063 6f6d 696e 6720 696e 0d0a 2020  ta coming in..  
-00053520: 2020 2020 2020 2320 7765 206e 6565 6420        # we need 
-00053530: 7468 6520 726f 6f74 7769 7365 206f 6e65  the rootwise one
-00053540: 732c 2061 7320 7061 7373 6564 2074 6f20  s, as passed to 
-00053550: 7468 6520 466f 6375 7320 5374 7269 6e67  the Focus String
-00053560: 206d 616b 6572 2e0d 0a20 2020 2020 2020   maker...       
-00053570: 2023 2053 696e 6365 2077 6527 7665 2061   # Since we've a
-00053580: 6c72 6561 6479 2063 616c 6375 6c61 7465  lready calculate
-00053590: 6420 7468 6573 652c 2077 6520 6861 7665  d these, we have
-000535a0: 2061 6e20 6f70 706f 7274 756e 6974 7920   an opportunity 
-000535b0: 666f 7220 7265 7573 696e 6720 7468 6520  for reusing the 
-000535c0: 6361 6c63 756c 6174 696f 6e20 7265 7375  calculation resu
-000535d0: 6c74 2028 706f 7373 6962 6c79 2062 7920  lt (possibly by 
-000535e0: 6d65 6d6f 697a 696e 6720 7468 6520 6675  memoizing the fu
-000535f0: 6e63 7469 6f6e 290d 0a20 2020 2020 2020  nction)..       
-00053600: 2023 2046 6f72 206e 6f77 2075 7365 2074   # For now use t
-00053610: 6865 2066 756e 6374 696f 6e20 6167 6169  he function agai
-00053620: 6e0d 0a0d 0a20 2020 2020 2020 2065 6666  n....        eff
-00053630: 6563 7469 7665 5f65 6c65 6d65 6e74 7320  ective_elements 
-00053640: 3d20 7365 6c66 2e65 6666 6563 7469 7665  = self.effective
-00053650: 5f64 696d 656e 7369 6f6e 5f65 6c65 6d65  _dimension_eleme
-00053660: 6e74 7328 6469 6d65 6e73 696f 6e5f 696e  nts(dimension_in
-00053670: 6465 7829 0d0a 0d0a 2020 2020 2020 2020  dex)....        
-00053680: 2349 6620 7374 696c 6c20 4e6f 6e65 2c20  #If still None, 
-00053690: 7261 6973 6520 616e 2065 7272 6f72 0d0a  raise an error..
-000536a0: 2020 2020 2020 2020 6966 2065 6666 6563          if effec
-000536b0: 7469 7665 5f65 6c65 6d65 6e74 7320 6973  tive_elements is
-000536c0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-000536d0: 2020 2020 7261 6973 6520 6d70 6578 2e4c      raise mpex.L
-000536e0: 6f61 6465 7253 6574 7570 4572 726f 7228  oaderSetupError(
-000536f0: 2743 6f75 6c64 206e 6f74 2063 6f6d 7075  'Could not compu
-00053700: 7465 2065 6666 6563 7469 7665 2065 6c65  te effective ele
-00053710: 6d65 6e74 7320 746f 2063 7265 6174 6520  ments to create 
-00053720: 6120 5461 626c 654d 6170 7065 7220 6672  a TableMapper fr
-00053730: 6f6d 2066 6f72 2064 696d 656e 7369 6f6e  om for dimension
-00053740: 2069 6e64 6578 207b 7d2c 2066 6f72 207b   index {}, for {
-00053750: 7d27 2e66 6f72 6d61 7428 6469 6d65 6e73  }'.format(dimens
-00053760: 696f 6e5f 696e 6465 782c 7265 7072 2873  ion_index,repr(s
-00053770: 656c 662e 7461 7267 6574 2e73 7472 7563  elf.target.struc
-00053780: 7475 7265 735b 6469 6d65 6e73 696f 6e5f  tures[dimension_
-00053790: 696e 6465 785d 2929 290d 0a0d 0a20 2020  index])))....   
-000537a0: 2020 2020 2069 6620 6c65 6e28 6566 6665       if len(effe
-000537b0: 6374 6976 655f 656c 656d 656e 7473 2920  ctive_elements) 
-000537c0: 3e20 313a 0d0a 2020 2020 2020 2020 2020  > 1:..          
-000537d0: 2020 2354 4f44 4f20 2d20 6368 616e 6765    #TODO - change
-000537e0: 2074 6869 7320 7768 656e 2077 6520 6861   this when we ha
-000537f0: 7665 2065 2e67 2e20 6d75 6c74 6970 6c65  ve e.g. multiple
-00053800: 2043 6f6d 7061 7269 736f 6e73 0d0a 2020   Comparisons..  
-00053810: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00053820: 6d70 6578 2e4c 6f61 6465 7253 6574 7570  mpex.LoaderSetup
-00053830: 4572 726f 7228 274d 756c 7469 706c 6520  Error('Multiple 
-00053840: 4566 6665 6374 6976 6520 656c 656d 656e  Effective elemen
-00053850: 7473 207b 7d20 696e 2064 696d 656e 7369  ts {} in dimensi
-00053860: 6f6e 207b 7d20 6e6f 7420 636f 6465 6420  on {} not coded 
-00053870: 666f 7220 5374 7275 6374 7572 654d 6170  for StructureMap
-00053880: 7065 7273 2079 6574 272e 666f 726d 6174  pers yet'.format
-00053890: 285b 7265 7072 2865 6c29 2066 6f72 2065  ([repr(el) for e
-000538a0: 6c20 696e 2065 6666 6563 7469 7665 5f65  l in effective_e
-000538b0: 6c65 6d65 6e74 735d 2c20 6469 6d65 6e73  lements], dimens
-000538c0: 696f 6e5f 696e 6465 7829 290d 0a0d 0a20  ion_index)).... 
-000538d0: 2020 2020 2020 2069 6620 6c65 6e28 6566         if len(ef
-000538e0: 6665 6374 6976 655f 656c 656d 656e 7473  fective_elements
-000538f0: 2920 3e20 313a 0d0a 2020 2020 2020 2020  ) > 1:..        
-00053900: 2020 2020 7261 6973 6520 6d70 6578 2e4c      raise mpex.L
-00053910: 6f61 6465 7253 6574 7570 4572 726f 7228  oaderSetupError(
-00053920: 274d 756c 7469 706c 6520 4566 6665 6374  'Multiple Effect
-00053930: 6976 6520 656c 656d 656e 7473 207b 7d20  ive elements {} 
-00053940: 696e 2064 696d 656e 7369 6f6e 207b 7d20  in dimension {} 
-00053950: 6e6f 7420 636f 6465 6420 666f 7220 5374  not coded for St
-00053960: 7275 6374 7572 654d 6170 7065 7273 2079  ructureMappers y
-00053970: 6574 272e 666f 726d 6174 285b 7265 7072  et'.format([repr
-00053980: 2865 6c29 2066 6f72 2065 6c20 696e 2065  (el) for el in e
-00053990: 6666 6563 7469 7665 5f65 6c65 6d65 6e74  ffective_element
-000539a0: 735d 2c20 6469 6d65 6e73 696f 6e5f 696e  s], dimension_in
-000539b0: 6465 7829 290d 0a0d 0a20 2020 2020 2020  dex))....       
-000539c0: 2065 6666 6563 7469 7665 5f65 6c65 6d65   effective_eleme
-000539d0: 6e74 203d 2065 6666 6563 7469 7665 5f65  nt = effective_e
-000539e0: 6c65 6d65 6e74 735b 305d 0d0a 0d0a 2020  lements[0]....  
-000539f0: 2020 2020 2020 7265 7475 726e 2065 6666        return eff
-00053a00: 6563 7469 7665 5f65 6c65 6d65 6e74 0d0a  ective_element..
-00053a10: 0d0a 2020 2020 6465 6620 5f67 6574 5f54  ..    def _get_T
-00053a20: 6162 6c65 4d61 7070 6572 5f66 6f72 5f64  ableMapper_for_d
-00053a30: 696d 656e 7369 6f6e 696e 6465 7828 7365  imensionindex(se
-00053a40: 6c66 2c64 696d 656e 7369 6f6e 5f69 6e64  lf,dimension_ind
-00053a50: 6578 293a 0d0a 0d0a 2020 2020 2020 2020  ex):....        
-00053a60: 2348 616e 646c 6520 7468 6520 6361 7365  #Handle the case
-00053a70: 2066 6f72 2065 6d70 7479 2055 6e69 7420   for empty Unit 
-00053a80: 6469 6d65 6e73 696f 6e73 0d0a 2020 2020  dimensions..    
-00053a90: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-00053aa0: 2020 2020 2020 6966 2073 656c 662e 7369        if self.si
-00053ab0: 7465 2069 7320 4e6f 6e65 3a0d 0a20 2020  te is None:..   
-00053ac0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00053ad0: 7572 6e20 4e6f 6e65 0d0a 0d0a 2020 2020  urn None....    
-00053ae0: 2020 2020 2020 2020 6469 6d20 3d20 7365          dim = se
-00053af0: 6c66 2e73 6974 652e 6469 6d65 6e73 696f  lf.site.dimensio
-00053b00: 6e73 5b64 696d 656e 7369 6f6e 5f69 6e64  ns[dimension_ind
-00053b10: 6578 5d0d 0a20 2020 2020 2020 2020 2020  ex]..           
-00053b20: 2069 6620 6469 6d20 6973 204e 6f6e 653a   if dim is None:
-00053b30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00053b40: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
-00053b50: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-00053b60: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
-00053b70: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-00053b80: 0d0a 2020 2020 2020 2020 0d0a 2020 2020  ..        ..    
-00053b90: 2020 2020 0d0a 2020 2020 2020 2020 6566      ..        ef
-00053ba0: 6665 6374 6976 655f 656c 656d 656e 7473  fective_elements
-00053bb0: 2c20 6d61 7070 696e 675f 7479 7065 2c63  , mapping_type,c
-00053bc0: 6f6c 756d 6e5f 6e61 6d65 7320 3d20 7365  olumn_names = se
-00053bd0: 6c66 2e5f 6765 745f 696d 706c 6965 645f  lf._get_implied_
-00053be0: 7368 6f72 7463 6f64 655f 6c69 7374 5f61  shortcode_list_a
-00053bf0: 6e64 5f6d 6170 7069 6e67 5f74 7970 6528  nd_mapping_type(
-00053c00: 6469 6d65 6e73 696f 6e5f 696e 6465 7820  dimension_index 
-00053c10: 3d20 6469 6d65 6e73 696f 6e5f 696e 6465  = dimension_inde
-00053c20: 782c 206f 626a 6563 745f 746f 5f63 6865  x, object_to_che
-00053c30: 636b 5f61 6761 696e 7374 203d 7365 6c66  ck_against =self
-00053c40: 2e74 6172 6765 742e 7374 7275 6374 7572  .target.structur
-00053c50: 6573 5b64 696d 656e 7369 6f6e 5f69 6e64  es[dimension_ind
-00053c60: 6578 5d29 0d0a 0d0a 0d0a 2020 2020 2020  ex])......      
-00053c70: 2020 2343 6865 636b 2074 6861 7420 6120    #Check that a 
-00053c80: 636f 6c75 6d6e 206e 616d 6520 7265 616c  column name real
-00053c90: 6c79 2069 7320 6120 636f 6c75 6d6e 206e  ly is a column n
-00053ca0: 616d 652c 2061 6e64 206e 6f74 2061 206d  ame, and not a m
-00053cb0: 6973 7479 7065 6420 7368 6f72 746e 616d  istyped shortnam
-00053cc0: 652c 206f 7220 6120 6c6f 7420 6f66 2069  e, or a lot of i
-00053cd0: 6e6e 6f63 656e 7420 6461 7461 2069 7320  nnocent data is 
-00053ce0: 676f 696e 6720 746f 2062 6520 6465 7374  going to be dest
-00053cf0: 726f 7965 640d 0a20 2020 2020 2020 2069  royed..        i
-00053d00: 6620 636f 6c75 6d6e 5f6e 616d 6573 2069  f column_names i
-00053d10: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00053d20: 2020 2020 2020 2020 2066 6f72 2063 6f6c           for col
-00053d30: 756d 6e5f 6e61 6d65 2069 6e20 636f 6c75  umn_name in colu
-00053d40: 6d6e 5f6e 616d 6573 3a0d 0a20 2020 2020  mn_names:..     
-00053d50: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-00053d60: 6c66 2e73 6f75 7263 6520 6973 204e 6f6e  lf.source is Non
-00053d70: 6520 6f72 2063 6f6c 756d 6e5f 6e61 6d65  e or column_name
-00053d80: 206e 6f74 2069 6e20 7365 6c66 2e63 6f6c   not in self.col
-00053d90: 756d 6e73 3a0d 0a20 2020 2020 2020 2020  umns:..         
-00053da0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00053db0: 206d 7065 782e 4c6f 6164 6572 5365 7475   mpex.LoaderSetu
-00053dc0: 7045 7272 6f72 2827 4d61 7070 6564 2063  pError('Mapped c
-00053dd0: 6f6c 756d 6e20 6e61 6d65 207b 7d20 696e  olumn name {} in
-00053de0: 2064 696d 656e 7369 6f6e 207b 7d20 6e6f   dimension {} no
-00053df0: 7420 696e 2063 6f6c 756d 6e20 6e61 6d65  t in column name
-00053e00: 7320 6f66 2073 6f75 7263 6520 7b7d 272e  s of source {}'.
-00053e10: 666f 726d 6174 2863 6f6c 756d 6e5f 6e61  format(column_na
-00053e20: 6d65 2c20 6469 6d65 6e73 696f 6e5f 696e  me, dimension_in
-00053e30: 6465 782c 2073 656c 662e 636f 6c75 6d6e  dex, self.column
-00053e40: 7329 290d 0a0d 0a20 2020 2020 2020 2023  s))....        #
-00053e50: 5765 2068 616e 646c 6520 5374 7275 6374  We handle Struct
-00053e60: 7572 6573 2064 6966 6665 7265 6e74 6c79  ures differently
-00053e70: 2074 6f20 5374 7275 6374 7572 6545 6c65   to StructureEle
-00053e80: 6d65 6e74 730d 0a20 2020 2020 2020 2069  ments..        i
-00053e90: 735f 7374 7275 6374 7572 6520 3d20 6973  s_structure = is
-00053ea0: 696e 7374 616e 6365 2873 656c 662e 7461  instance(self.ta
-00053eb0: 7267 6574 2e73 7472 7563 7475 7265 735b  rget.structures[
-00053ec0: 6469 6d65 6e73 696f 6e5f 696e 6465 785d  dimension_index]
-00053ed0: 2c53 7472 7563 7475 7265 290d 0a20 2020  ,Structure)..   
-00053ee0: 2020 2020 2069 735f 7374 7275 6374 7572       is_structur
-00053ef0: 655f 656c 656d 656e 7420 3d20 6973 696e  e_element = isin
-00053f00: 7374 616e 6365 2873 656c 662e 7461 7267  stance(self.targ
-00053f10: 6574 2e73 7472 7563 7475 7265 735b 6469  et.structures[di
-00053f20: 6d65 6e73 696f 6e5f 696e 6465 785d 2c53  mension_index],S
-00053f30: 7472 7563 7475 7265 456c 656d 656e 7429  tructureElement)
-00053f40: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-00053f50: 726e 5f76 616c 7565 203d 204e 6f6e 650d  rn_value = None.
-00053f60: 0a0d 0a20 2020 2020 2020 2069 6620 6d61  ...        if ma
-00053f70: 7070 696e 675f 7479 7065 203d 3d27 636f  pping_type =='co
-00053f80: 6e73 7461 6e74 2073 686f 7274 6e61 6d65  nstant shortname
-00053f90: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-00053fa0: 7265 7475 726e 5f76 616c 7565 203d 2043  return_value = C
-00053fb0: 6f6e 7374 616e 7428 636f 6e73 7461 6e74  onstant(constant
-00053fc0: 203d 2065 6666 6563 7469 7665 5f65 6c65   = effective_ele
-00053fd0: 6d65 6e74 735b 305d 290d 0a20 2020 2020  ments[0])..     
-00053fe0: 2020 2065 6c69 6620 6d61 7070 696e 675f     elif mapping_
-00053ff0: 7479 7065 203d 3d27 636f 6c75 6d6e 206e  type =='column n
-00054000: 616d 6527 3a0d 0a0d 0a0d 0a20 2020 2020  ame':......     
-00054010: 2020 2020 2020 2069 6620 6973 5f73 7472         if is_str
-00054020: 7563 7475 7265 3a0d 0a20 2020 2020 2020  ucture:..       
-00054030: 2020 2020 2020 2020 2065 6666 6563 7469           effecti
-00054040: 7665 5f65 6c65 6d65 6e74 203d 2073 656c  ve_element = sel
-00054050: 662e 5f67 6574 5f65 6666 6563 7469 7665  f._get_effective
-00054060: 5f65 6c65 6d65 6e74 5f66 6f72 5f73 7472  _element_for_str
-00054070: 7563 7475 7265 2864 696d 656e 7369 6f6e  ucture(dimension
-00054080: 5f69 6e64 6578 3d64 696d 656e 7369 6f6e  _index=dimension
-00054090: 5f69 6e64 6578 2c65 6666 6563 7469 7665  _index,effective
-000540a0: 5f65 6c65 6d65 6e74 7320 3d20 6566 6665  _elements = effe
-000540b0: 6374 6976 655f 656c 656d 656e 7473 290d  ctive_elements).
-000540c0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-000540d0: 2020 2072 6574 7572 6e5f 7661 6c75 6520     return_value 
-000540e0: 3d20 2053 7472 7563 7475 7265 4d61 7070  =  StructureMapp
-000540f0: 6572 2873 686f 7274 6e61 6d65 5f63 6f6c  er(shortname_col
-00054100: 756d 6e3d 636f 6c75 6d6e 5f6e 616d 652c  umn=column_name,
-00054110: 7061 7468 203d 2065 6666 6563 7469 7665  path = effective
-00054120: 5f65 6c65 6d65 6e74 2e70 6174 6829 0d0a  _element.path)..
-00054130: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00054140: 2069 735f 7374 7275 6374 7572 655f 656c   is_structure_el
-00054150: 656d 656e 743a 0d0a 2020 2020 2020 2020  ement:..        
-00054160: 2020 2020 2020 2020 7374 7275 6374 7572          structur
-00054170: 655f 656c 656d 656e 7420 3d20 7365 6c66  e_element = self
-00054180: 2e74 6172 6765 742e 7374 7275 6374 7572  .target.structur
-00054190: 6573 5b64 696d 656e 7369 6f6e 5f69 6e64  es[dimension_ind
-000541a0: 6578 5d0d 0a0d 0a20 2020 2020 2020 2020  ex]....         
-000541b0: 2020 2020 2020 2069 6620 7374 7275 6374         if struct
-000541c0: 7572 655f 656c 656d 656e 742e 6973 5f6c  ure_element.is_l
-000541d0: 6561 663a 0d0a 2020 2020 2020 2020 2020  eaf:..          
-000541e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000541f0: 5f76 616c 7565 203d 2020 436f 6c75 6d6e  _value =  Column
-00054200: 4d61 7070 6572 2863 6f6c 756d 6e5f 6e61  Mapper(column_na
-00054210: 6d65 3d63 6f6c 756d 6e5f 6e61 6d65 2c63  me=column_name,c
-00054220: 6f6c 756d 6e5f 7479 7065 3d27 7368 6f72  olumn_type='shor
-00054230: 746e 616d 6527 2c66 6965 6c64 5f73 686f  tname',field_sho
-00054240: 7274 6e61 6d65 3d4e 6f6e 6529 0d0a 2020  rtname=None)..  
-00054250: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00054260: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00054270: 2020 2020 2020 2020 2072 6574 7572 6e5f           return_
-00054280: 7661 6c75 6520 3d20 2053 7472 7563 7475  value =  Structu
-00054290: 7265 4d61 7070 6572 2873 686f 7274 6e61  reMapper(shortna
-000542a0: 6d65 5f63 6f6c 756d 6e3d 636f 6c75 6d6e  me_column=column
-000542b0: 5f6e 616d 652c 7061 7468 203d 2073 7472  _name,path = str
-000542c0: 7563 7475 7265 5f65 6c65 6d65 6e74 2e70  ucture_element.p
-000542d0: 6174 6829 0d0a 2020 2020 2020 2020 2020  ath)..          
-000542e0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-000542f0: 2020 2020 2020 2020 2072 6574 7572 6e5f           return_
-00054300: 7661 6c75 6520 3d20 2043 6f6c 756d 6e4d  value =  ColumnM
-00054310: 6170 7065 7228 636f 6c75 6d6e 5f6e 616d  apper(column_nam
-00054320: 653d 636f 6c75 6d6e 5f6e 616d 652c 636f  e=column_name,co
-00054330: 6c75 6d6e 5f74 7970 653d 2773 686f 7274  lumn_type='short
-00054340: 6e61 6d65 272c 6669 656c 645f 7368 6f72  name',field_shor
-00054350: 746e 616d 653d 4e6f 6e65 290d 0a0d 0a0d  tname=None).....
-00054360: 0a20 2020 2020 2020 2065 6c69 6620 6d61  .        elif ma
-00054370: 7070 696e 675f 7479 7065 203d 3d27 636f  pping_type =='co
-00054380: 6c75 6d6e 7320 746f 2066 6965 6c64 7327  lumns to fields'
-00054390: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-000543a0: 6620 6469 6d65 6e73 696f 6e5f 696e 6465  f dimension_inde
-000543b0: 7820 3d3d 2031 313a 0d0a 2020 2020 2020  x == 11:..      
-000543c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000543d0: 6d70 6578 2e4c 6f61 6465 7253 6574 7570  mpex.LoaderSetup
-000543e0: 4572 726f 7228 2743 616e 6e6f 7420 6d61  Error('Cannot ma
-000543f0: 7020 6669 656c 6473 2066 6f72 2074 6865  p fields for the
-00054400: 2074 696d 6520 6469 6d65 6e73 696f 6e27   time dimension'
-00054410: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00054420: 2069 6620 6973 5f73 7472 7563 7475 7265   if is_structure
-00054430: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00054440: 2020 2023 5765 2068 6176 6520 746f 2075     #We have to u
-00054450: 7365 206c 6f67 6963 2074 6f20 6669 6775  se logic to figu
-00054460: 7265 206f 7574 2c20 6672 6f6d 2074 6865  re out, from the
-00054470: 2073 7472 7563 7475 7265 2077 6861 7420   structure what 
-00054480: 7468 6520 636f 7272 6563 7420 6566 6665  the correct effe
-00054490: 6374 6976 6520 656c 656d 656e 7420 6973  ctive element is
-000544a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000544b0: 2020 6566 6665 6374 6976 655f 656c 656d    effective_elem
-000544c0: 656e 7420 3d20 7365 6c66 2e5f 6765 745f  ent = self._get_
-000544d0: 6566 6665 6374 6976 655f 656c 656d 656e  effective_elemen
-000544e0: 745f 666f 725f 7374 7275 6374 7572 6528  t_for_structure(
-000544f0: 6469 6d65 6e73 696f 6e5f 696e 6465 783d  dimension_index=
-00054500: 6469 6d65 6e73 696f 6e5f 696e 6465 782c  dimension_index,
-00054510: 6566 6665 6374 6976 655f 656c 656d 656e  effective_elemen
-00054520: 7473 203d 2065 6666 6563 7469 7665 5f65  ts = effective_e
-00054530: 6c65 6d65 6e74 7329 0d0a 0d0a 2020 2020  lements)....    
-00054540: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00054550: 726e 5f76 616c 7565 203d 2020 5374 7275  rn_value =  Stru
-00054560: 6374 7572 654d 6170 7065 7228 6669 656c  ctureMapper(fiel
-00054570: 645f 636f 6c75 6d6e 3d63 6f6c 756d 6e5f  d_column=column_
-00054580: 6e61 6d65 2c66 6965 6c64 5f73 686f 7274  name,field_short
-00054590: 6e61 6d65 3d6c 6973 7428 7365 6c66 2e5f  name=list(self._
-000545a0: 6d61 7070 6572 735b 6469 6d65 6e73 696f  mappers[dimensio
-000545b0: 6e5f 696e 6465 785d 2e76 616c 7565 7328  n_index].values(
-000545c0: 2929 5b30 5d2c 7061 7468 203d 2065 6666  ))[0],path = eff
-000545d0: 6563 7469 7665 5f65 6c65 6d65 6e74 2e70  ective_element.p
-000545e0: 6174 6829 0d0a 0d0a 2020 2020 2020 2020  ath)....        
-000545f0: 2020 2020 656c 6966 2069 735f 7374 7275      elif is_stru
-00054600: 6374 7572 655f 656c 656d 656e 743a 0d0a  cture_element:..
-00054610: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00054620: 2020 7374 7275 6374 7572 655f 656c 656d    structure_elem
-00054630: 656e 7420 3d20 7365 6c66 2e74 6172 6765  ent = self.targe
-00054640: 742e 7374 7275 6374 7572 6573 5b64 696d  t.structures[dim
-00054650: 656e 7369 6f6e 5f69 6e64 6578 5d0d 0a0d  ension_index]...
-00054660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00054670: 2066 6965 6c64 5f73 686f 7274 6e61 6d65   field_shortname
-00054680: 3d6c 6973 7428 7365 6c66 2e5f 6d61 7070  =list(self._mapp
-00054690: 6572 735b 6469 6d65 6e73 696f 6e5f 696e  ers[dimension_in
-000546a0: 6465 785d 2e76 616c 7565 7328 2929 5b30  dex].values())[0
-000546b0: 5d0d 0a0d 0a20 2020 2020 2020 2020 2020  ]....           
-000546c0: 2020 2020 2069 6620 7374 7275 6374 7572       if structur
-000546d0: 655f 656c 656d 656e 742e 6973 5f6c 6561  e_element.is_lea
-000546e0: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
-000546f0: 2020 2020 2020 2020 7265 7475 726e 5f76          return_v
-00054700: 616c 7565 203d 2043 6f6c 756d 6e4d 6170  alue = ColumnMap
-00054710: 7065 7228 636f 6c75 6d6e 5f6e 616d 653d  per(column_name=
-00054720: 636f 6c75 6d6e 5f6e 616d 652c 636f 6c75  column_name,colu
-00054730: 6d6e 5f74 7970 653d 2766 6965 6c64 272c  mn_type='field',
-00054740: 6669 656c 645f 7368 6f72 746e 616d 653d  field_shortname=
-00054750: 6669 656c 645f 7368 6f72 746e 616d 6529  field_shortname)
-00054760: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00054770: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00054780: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00054790: 7572 6e5f 7661 6c75 6520 3d20 5374 7275  urn_value = Stru
-000547a0: 6374 7572 654d 6170 7065 7228 6669 656c  ctureMapper(fiel
-000547b0: 645f 636f 6c75 6d6e 3d63 6f6c 756d 6e5f  d_column=column_
-000547c0: 6e61 6d65 2c66 6965 6c64 5f73 686f 7274  name,field_short
-000547d0: 6e61 6d65 3d66 6965 6c64 5f73 686f 7274  name=field_short
-000547e0: 6e61 6d65 2c70 6174 6820 3d20 7374 7275  name,path = stru
-000547f0: 6374 7572 655f 656c 656d 656e 742e 7061  cture_element.pa
-00054800: 7468 290d 0a0d 0a20 2020 2020 2020 2020  th)....         
-00054810: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00054820: 2020 2020 2020 2020 2020 2354 4f44 4f20            #TODO 
-00054830: 2d65 7874 656e 6420 7468 6973 2074 6f20  -extend this to 
-00054840: 6d75 6c74 6920 6669 656c 6420 6d75 6c74  multi field mult
-00054850: 6920 636f 6c75 6d6e 2076 6172 6961 6e74  i column variant
-00054860: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00054870: 2020 2363 6f6c 756d 6e5f 7479 7065 3a20    #column_type: 
-00054880: 6f6e 6520 6f66 2027 7068 7973 6964 272c  one of 'physid',
-00054890: 2027 7368 6f72 746e 616d 6527 2c20 276c   'shortname', 'l
-000548a0: 6f6e 676e 616d 6527 206f 7220 2766 6965  ongname' or 'fie
-000548b0: 6c64 270d 0a20 2020 2020 2020 2020 2020  ld'..           
-000548c0: 2020 2020 2066 6965 6c64 5f73 686f 7274       field_short
-000548d0: 6e61 6d65 3d6c 6973 7428 7365 6c66 2e5f  name=list(self._
-000548e0: 6d61 7070 6572 735b 6469 6d65 6e73 696f  mappers[dimensio
-000548f0: 6e5f 696e 6465 785d 2e76 616c 7565 7328  n_index].values(
-00054900: 2929 5b30 5d0d 0a0d 0a20 2020 2020 2020  ))[0]....       
-00054910: 2020 2020 2020 2020 2072 6574 7572 6e5f           return_
-00054920: 7661 6c75 6520 3d20 436f 6c75 6d6e 4d61  value = ColumnMa
-00054930: 7070 6572 2863 6f6c 756d 6e5f 6e61 6d65  pper(column_name
-00054940: 3d63 6f6c 756d 6e5f 6e61 6d65 2c63 6f6c  =column_name,col
-00054950: 756d 6e5f 7479 7065 3d27 6669 656c 6427  umn_type='field'
-00054960: 2c66 6965 6c64 5f73 686f 7274 6e61 6d65  ,field_shortname
-00054970: 3d66 6965 6c64 5f73 686f 7274 6e61 6d65  =field_shortname
-00054980: 290d 0a0d 0a20 2020 2020 2020 2065 6c69  )....        eli
-00054990: 6620 6d61 7070 696e 675f 7479 7065 203d  f mapping_type =
-000549a0: 3d27 636f 6c75 6d6e 7320 746f 2073 686f  ='columns to sho
-000549b0: 7274 6e61 6d65 7327 3a0d 0a20 2020 2020  rtnames':..     
-000549c0: 2020 2020 2020 2072 6574 7572 6e5f 7661         return_va
-000549d0: 6c75 6520 3d20 7365 6c66 2e5f 6d61 7070  lue = self._mapp
-000549e0: 6572 735b 6469 6d65 6e73 696f 6e5f 696e  ers[dimension_in
-000549f0: 6465 785d 0d0a 2020 2020 2020 2020 656c  dex]..        el
-00054a00: 6966 206d 6170 7069 6e67 5f74 7970 6520  if mapping_type 
-00054a10: 3d3d 2763 6f6c 756d 6e20 746f 2073 686f  =='column to sho
-00054a20: 7274 6e61 6d65 2074 6f20 7661 6c75 6527  rtname to value'
-00054a30: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-00054a40: 6169 7365 206d 7065 782e 4c6f 6164 6572  aise mpex.Loader
-00054a50: 5365 7475 7045 7272 6f72 2827 636f 6c75  SetupError('colu
-00054a60: 6d6e 3a7b 7368 6f72 746e 616d 653a 7661  mn:{shortname:va
-00054a70: 6c75 657d 2073 7479 6c65 206d 6170 7069  lue} style mappi
-00054a80: 6e67 2028 692e 652e 2066 6c61 672d 7374  ng (i.e. flag-st
-00054a90: 796c 6520 6d61 7070 696e 6729 206e 6f74  yle mapping) not
-00054aa0: 2069 6d70 6c65 6d65 6e74 6564 2079 6574   implemented yet
-00054ab0: 2729 0d0a 0d0a 2020 2020 2020 2020 656c  ')....        el
-00054ac0: 6966 206d 6170 7069 6e67 5f74 7970 6520  if mapping_type 
-00054ad0: 3d3d 2763 6f6e 7374 616e 7420 6461 7465  =='constant date
-00054ae0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-00054af0: 6966 2064 696d 656e 7369 6f6e 5f69 6e64  if dimension_ind
-00054b00: 6578 2021 3d20 3131 3a0d 0a20 2020 2020  ex != 11:..     
-00054b10: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00054b20: 206d 7065 782e 4c6f 6164 6572 5365 7475   mpex.LoaderSetu
-00054b30: 7045 7272 6f72 2827 436f 756c 6420 6e6f  pError('Could no
-00054b40: 7420 6372 6561 7465 2061 2066 6f63 7573  t create a focus
-00054b50: 206c 6f61 6465 7220 666f 7220 6469 6d65   loader for dime
-00054b60: 6e73 696f 6e20 696e 6465 7820 7b7d 2077  nsion index {} w
-00054b70: 6974 6820 6120 636f 6e73 7461 6e74 2064  ith a constant d
-00054b80: 6174 652e 2059 6f75 2063 616e 206f 6e6c  ate. You can onl
-00054b90: 7920 7365 7420 6120 636f 6e73 7461 6e74  y set a constant
-00054ba0: 2064 6174 6120 666f 7420 7468 6520 5469   data fot the Ti
-00054bb0: 6d65 2064 696d 656e 7369 6f6e 2028 3131  me dimension (11
-00054bc0: 2927 2e66 6f72 6d61 7428 6469 6d65 6e73  )'.format(dimens
-00054bd0: 696f 6e5f 696e 6465 7829 290d 0a20 2020  ion_index))..   
-00054be0: 2020 2020 2020 2020 2065 6c73 653a 2020           else:  
-00054bf0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-00054c00: 2020 2020 7265 7475 726e 5f76 616c 7565      return_value
-00054c10: 203d 2043 6f6e 7374 616e 7428 636f 6e73   = Constant(cons
-00054c20: 7461 6e74 203d 2073 656c 662e 5f6d 6170  tant = self._map
-00054c30: 7065 7273 5b64 696d 656e 7369 6f6e 5f69  pers[dimension_i
-00054c40: 6e64 6578 5d29 2023 204a 4154 2032 3032  ndex]) # JAT 202
-00054c50: 3130 3330 3920 2d20 7075 7420 7468 6973  10309 - put this
-00054c60: 206c 696e 6520 696e 2073 7065 6375 6c61   line in specula
-00054c70: 7469 7665 6c79 202d 2069 7420 7368 6f75  tively - it shou
-00054c80: 6c64 2070 7574 2074 6865 2064 6174 6574  ld put the datet
-00054c90: 696d 6520 6f72 2074 7570 6c65 2069 6e74  ime or tuple int
-00054ca0: 6f20 7468 6520 436f 6e73 7461 6e74 2e2e  o the Constant..
-00054cb0: 2e0d 0a20 2020 2020 2020 2065 6c69 6620  ...        elif 
-00054cc0: 6d61 7070 696e 675f 7479 7065 2069 7320  mapping_type is 
-00054cd0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-00054ce0: 2020 2023 4e6f 206d 6170 7069 6e67 2077     #No mapping w
-00054cf0: 6173 2073 7570 706c 6965 640d 0a20 2020  as supplied..   
-00054d00: 2020 2020 2020 2020 2023 5468 6973 2c20           #This, 
-00054d10: 7468 6973 2068 6164 2062 6574 7465 7220  this had better 
-00054d20: 6265 2061 2053 7472 7563 7475 7265 2077  be a Structure w
-00054d30: 6974 6820 6120 7369 6e67 6c65 2065 6666  ith a single eff
-00054d40: 6563 7469 7665 2065 6c65 6d65 6e74 206f  ective element o
-00054d50: 7220 7369 6e67 6c65 206c 6561 6620 5374  r single leaf St
-00054d60: 7275 6374 7572 6545 6c65 6d65 6e74 0d0a  ructureElement..
-00054d70: 2020 2020 2020 2020 2020 2020 2354 6865              #The
-00054d80: 6e20 7765 2063 616e 2063 7265 6174 6520  n we can create 
-00054d90: 6120 7369 6e67 6c65 2045 6c65 6d65 6e74  a single Element
-00054da0: 2074 6f20 696e 7365 7274 2069 6e74 6f0d   to insert into.
-00054db0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00054dc0: 6973 5f73 7472 7563 7475 7265 3a0d 0a20  is_structure:.. 
-00054dd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00054de0: 6666 6563 7469 7665 5f65 6c65 6d65 6e74  ffective_element
-00054df0: 203d 2073 656c 662e 5f67 6574 5f65 6666   = self._get_eff
-00054e00: 6563 7469 7665 5f65 6c65 6d65 6e74 5f66  ective_element_f
-00054e10: 6f72 5f73 7472 7563 7475 7265 2864 696d  or_structure(dim
-00054e20: 656e 7369 6f6e 5f69 6e64 6578 3d64 696d  ension_index=dim
-00054e30: 656e 7369 6f6e 5f69 6e64 6578 2c65 6666  ension_index,eff
-00054e40: 6563 7469 7665 5f65 6c65 6d65 6e74 7320  ective_elements 
-00054e50: 3d20 6566 6665 6374 6976 655f 656c 656d  = effective_elem
-00054e60: 656e 7473 290d 0a20 2020 2020 2020 2020  ents)..         
-00054e70: 2020 2020 2020 2069 6620 6e6f 7420 6566         if not ef
-00054e80: 6665 6374 6976 655f 656c 656d 656e 742e  fective_element.
-00054e90: 6973 5f6c 6561 663a 0d0a 2020 2020 2020  is_leaf:..      
-00054ea0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00054eb0: 6973 6520 6d70 6578 2e4c 6f61 6465 7253  ise mpex.LoaderS
-00054ec0: 6574 7570 4572 726f 7228 2743 6f75 6c64  etupError('Could
-00054ed0: 206e 6f74 2063 7265 6174 6520 6120 666f   not create a fo
-00054ee0: 6375 7320 6c6f 6164 6572 2066 6f72 2064  cus loader for d
-00054ef0: 696d 656e 7369 6f6e 2069 6e64 6578 207b  imension index {
-00054f00: 7d20 7769 7468 6f75 7420 6120 7375 7070  } without a supp
-00054f10: 6c69 6564 206d 6170 7069 6e67 2c20 6265  lied mapping, be
-00054f20: 6361 7573 6520 7468 6520 5374 7275 6374  cause the Struct
-00054f30: 7572 6545 6c65 6d65 6e74 207b 7d20 696e  ureElement {} in
-00054f40: 2074 6865 2072 656c 6576 616e 7420 466f   the relevant Fo
-00054f50: 6375 7320 7761 7320 6e6f 7420 6120 6c65  cus was not a le
-00054f60: 6166 2065 6c65 6d65 6e74 272e 666f 726d  af element'.form
-00054f70: 6174 2864 696d 656e 7369 6f6e 5f69 6e64  at(dimension_ind
-00054f80: 6578 2c65 6666 6563 7469 7665 5f65 6c65  ex,effective_ele
-00054f90: 6d65 6e74 2e70 6174 6829 290d 0a0d 0a20  ment.path)).... 
-00054fa0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00054fb0: 6574 7572 6e5f 7661 6c75 6520 3d20 436f  eturn_value = Co
-00054fc0: 6e73 7461 6e74 2863 6f6e 7374 616e 7420  nstant(constant 
-00054fd0: 3d20 6566 6665 6374 6976 655f 656c 656d  = effective_elem
-00054fe0: 656e 742e 7068 7973 6964 290d 0a20 2020  ent.physid)..   
-00054ff0: 2020 2020 2020 2020 2065 6c69 6620 6973           elif is
-00055000: 5f73 7472 7563 7475 7265 5f65 6c65 6d65  _structure_eleme
-00055010: 6e74 3a0d 0a20 2020 2020 2020 2020 2020  nt:..           
-00055020: 2020 2020 2073 7472 7563 7475 7265 5f65       structure_e
-00055030: 6c65 6d65 6e74 203d 2073 656c 662e 7461  lement = self.ta
-00055040: 7267 6574 2e73 7472 7563 7475 7265 735b  rget.structures[
-00055050: 6469 6d65 6e73 696f 6e5f 696e 6465 785d  dimension_index]
-00055060: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00055070: 2020 2020 6966 206e 6f74 2073 7472 7563      if not struc
-00055080: 7475 7265 5f65 6c65 6d65 6e74 2e69 735f  ture_element.is_
-00055090: 6c65 6166 3a0d 0a20 2020 2020 2020 2020  leaf:..         
-000550a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000550b0: 206d 7065 782e 4c6f 6164 6572 5365 7475   mpex.LoaderSetu
-000550c0: 7045 7272 6f72 2827 436f 756c 6420 6e6f  pError('Could no
-000550d0: 7420 6372 6561 7465 2061 2066 6f63 7573  t create a focus
-000550e0: 206c 6f61 6465 7220 666f 7220 6469 6d65   loader for dime
-000550f0: 6e73 696f 6e20 696e 6465 7820 7b7d 2077  nsion index {} w
-00055100: 6974 686f 7574 2061 2073 7570 706c 6965  ithout a supplie
-00055110: 6420 6d61 7070 696e 672c 2062 6563 6175  d mapping, becau
-00055120: 7365 2074 6865 2053 7472 7563 7475 7265  se the Structure
-00055130: 456c 656d 656e 7420 7b7d 2069 6e20 7468  Element {} in th
-00055140: 6520 7265 6c65 7661 6e74 2077 6173 206e  e relevant was n
-00055150: 6f74 2061 206c 6561 6620 656c 656d 656e  ot a leaf elemen
-00055160: 7427 2e66 6f72 6d61 7428 6469 6d65 6e73  t'.format(dimens
-00055170: 696f 6e5f 696e 6465 782c 6566 6665 6374  ion_index,effect
-00055180: 6976 655f 656c 656d 656e 742e 7061 7468  ive_element.path
-00055190: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
-000551a0: 2020 2020 2020 7265 7475 726e 5f76 616c        return_val
-000551b0: 7565 203d 2043 6f6e 7374 616e 7428 636f  ue = Constant(co
-000551c0: 6e73 7461 6e74 203d 2073 7472 7563 7475  nstant = structu
-000551d0: 7265 5f65 6c65 6d65 6e74 2e70 6879 7369  re_element.physi
-000551e0: 6429 0d0a 2020 2020 2020 2020 2020 2020  d)..            
-000551f0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00055200: 2020 2020 2020 2072 6169 7365 206d 7065         raise mpe
-00055210: 782e 4c6f 6164 6572 5365 7475 7045 7272  x.LoaderSetupErr
-00055220: 6f72 2827 436f 756c 6420 6e6f 7420 6372  or('Could not cr
-00055230: 6561 7465 2061 2066 6f63 7573 206c 6f61  eate a focus loa
-00055240: 6465 7220 666f 7220 6469 6d65 6e73 696f  der for dimensio
-00055250: 6e20 696e 6465 7820 7b7d 2077 6974 686f  n index {} witho
-00055260: 7574 2061 2073 7570 706c 6965 6420 6d61  ut a supplied ma
-00055270: 7070 696e 672c 2062 6563 6175 7365 2066  pping, because f
-00055280: 6f75 6e64 2053 7472 7563 7475 7265 456c  ound StructureEl
-00055290: 656d 656e 7420 696e 2074 6865 2072 656c  ement in the rel
-000552a0: 6576 616e 7420 7761 7320 6f66 2074 7970  evant was of typ
-000552b0: 6520 7b7d 2027 2e66 6f72 6d61 7428 6469  e {} '.format(di
-000552c0: 6d65 6e73 696f 6e5f 696e 6465 782c 7265  mension_index,re
-000552d0: 7072 2865 6666 6563 7469 7665 5f65 6c65  pr(effective_ele
-000552e0: 6d65 6e74 2929 290d 0a0d 0a20 2020 2020  ment)))....     
-000552f0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00055300: 2020 2020 2020 7261 6973 6520 6d70 6578        raise mpex
-00055310: 2e4c 6f61 6465 7253 6574 7570 4572 726f  .LoaderSetupErro
-00055320: 7228 2747 6f74 206c 6f73 7420 6465 6369  r('Got lost deci
-00055330: 6469 6e67 2054 6162 6c65 4d61 7070 6572  ding TableMapper
-00055340: 2074 7970 6520 666f 7220 6469 6d65 6e73   type for dimens
-00055350: 696f 6e20 696e 6465 7820 7b7d 2066 6f72  ion index {} for
-00055360: 2073 7472 7563 7475 7265 2064 6566 696e   structure defin
-00055370: 6974 696f 6e20 7b7d 2e20 496e 7465 726e  ition {}. Intern
-00055380: 616c 6c79 2c20 6566 6665 6374 6976 655f  ally, effective_
-00055390: 656c 656d 656e 7473 203d 207b 7d2c 206d  elements = {}, m
-000553a0: 6170 7069 6e67 5f74 7970 6520 3d20 7b7d  apping_type = {}
-000553b0: 2c20 636f 6c75 6d6e 5f6e 616d 6573 203d  , column_names =
-000553c0: 207b 7d27 2e66 6f72 6d61 7428 6469 6d65   {}'.format(dime
-000553d0: 6e73 696f 6e5f 696e 6465 782c 2072 6570  nsion_index, rep
-000553e0: 7228 7365 6c66 2e74 6172 6765 742e 7374  r(self.target.st
-000553f0: 7275 6374 7572 6573 5b64 696d 656e 7369  ructures[dimensi
-00055400: 6f6e 5f69 6e64 6578 5d29 2c20 7265 7072  on_index]), repr
-00055410: 2865 6666 6563 7469 7665 5f65 6c65 6d65  (effective_eleme
-00055420: 6e74 7329 2c20 6d61 7070 696e 675f 7479  nts), mapping_ty
-00055430: 7065 2c72 6570 7228 636f 6c75 6d6e 5f6e  pe,repr(column_n
-00055440: 616d 6573 2929 290d 0a0d 0a0d 0a20 2020  ames)))......   
-00055450: 2020 2020 2069 6620 6469 6d65 6e73 696f       if dimensio
-00055460: 6e5f 696e 6465 7820 3d3d 2031 313a 0d0a  n_index == 11:..
-00055470: 2020 2020 2020 2020 2020 2020 2354 696d              #Tim
-00055480: 6520 6973 2068 616e 646c 6564 2064 6966  e is handled dif
-00055490: 6665 7265 6e74 6c79 2c20 6173 2069 7420  ferently, as it 
-000554a0: 6e65 6564 7320 746f 2072 6574 7572 6e20  needs to return 
-000554b0: 6569 7468 6572 2061 2043 6f6c 756d 6e4d  either a ColumnM
-000554c0: 6170 7065 7220 616e 6420 616e 2045 6d70  apper and an Emp
-000554d0: 6f77 6572 2074 696d 6520 7065 7269 6f64  ower time period
-000554e0: 0d0a 2020 2020 2020 2020 2020 2020 236f  ..            #o
-000554f0: 7220 6120 636f 6e73 7461 6e74 2061 6e64  r a constant and
-00055500: 2020 616e 2045 6d70 6f77 6572 2074 696d    an Empower tim
-00055510: 6520 7065 7269 6f64 0d0a 0d0a 2020 2020  e period....    
-00055520: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00055530: 7461 6e63 6528 7265 7475 726e 5f76 616c  tance(return_val
-00055540: 7565 2c43 6f6e 7374 616e 7429 3a0d 0a20  ue,Constant):.. 
-00055550: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00055560: 6f75 6e64 5f65 6c65 6d65 6e74 203d 204e  ound_element = N
-00055570: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-00055580: 2020 2020 2066 6f75 6e64 5f64 6174 6520       found_date 
-00055590: 2020 203d 204e 6f6e 650d 0a20 2020 2020     = None..     
-000555a0: 2020 2020 2020 2020 2020 2066 6f75 6e64             found
-000555b0: 5f65 6d70 6f77 6572 5f64 6174 655f 636f  _empower_date_co
-000555c0: 6e73 7461 6e74 203d 204e 6f6e 650d 0a0d  nstant = None...
-000555d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000555e0: 2069 6620 6973 696e 7374 616e 6365 2872   if isinstance(r
-000555f0: 6574 7572 6e5f 7661 6c75 652e 636f 6e73  eturn_value.cons
-00055600: 7461 6e74 2c73 7472 293a 0d0a 2020 2020  tant,str):..    
-00055610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055620: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-00055630: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00055640: 756e 645f 656c 656d 656e 7420 3d20 7365  und_element = se
-00055650: 6c66 2e73 6974 652e 6469 6d65 6e73 696f  lf.site.dimensio
-00055660: 6e73 5b31 315d 2e65 6c65 6d65 6e74 735b  ns[11].elements[
-00055670: 7265 7475 726e 5f76 616c 7565 2e63 6f6e  return_value.con
-00055680: 7374 616e 745d 0d0a 2020 2020 2020 2020  stant]..        
-00055690: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-000556a0: 7074 204b 6579 4572 726f 723a 0d0a 2020  pt KeyError:..  
-000556b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000556c0: 2020 2020 2020 2363 6f75 6c64 6e27 7420        #couldn't 
-000556d0: 6669 6e64 2061 6e20 656c 656d 656e 7420  find an element 
-000556e0: 2d20 7065 7268 6170 7320 7468 6973 2069  - perhaps this i
-000556f0: 7320 6120 6461 7465 2073 7472 696e 670d  s a date string.
-00055700: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00055710: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00055720: 206d 7065 782e 4c6f 6164 6572 5365 7475   mpex.LoaderSetu
-00055730: 7045 7272 6f72 2827 4e6f 7420 496d 706c  pError('Not Impl
-00055740: 656d 656e 7465 642e 2054 696d 6520 6d61  emented. Time ma
-00055750: 7070 696e 6720 6672 6f6d 2061 2073 7472  pping from a str
-00055760: 696e 6720 7b7d 2069 7320 6e6f 7420 7965  ing {} is not ye
-00055770: 7420 696d 706c 656d 656e 7465 6420 756e  t implemented un
-00055780: 6c65 7373 2074 6861 7420 7374 7269 6e67  less that string
-00055790: 2069 7320 6120 7661 6c69 6420 7368 6f72   is a valid shor
-000557a0: 746e 616d 6520 6f66 2061 2074 696d 6520  tname of a time 
-000557b0: 656c 656d 656e 7427 2e66 6f72 6d61 7428  element'.format(
-000557c0: 7265 7475 726e 5f76 616c 7565 2e63 6f6e  return_value.con
-000557d0: 7374 616e 7429 290d 0a0d 0a20 2020 2020  stant))....     
-000557e0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-000557f0: 696e 7374 616e 6365 2872 6574 7572 6e5f  instance(return_
-00055800: 7661 6c75 652e 636f 6e73 7461 6e74 2c64  value.constant,d
-00055810: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-00055820: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00055830: 2020 2020 2020 2020 666f 756e 645f 6461          found_da
-00055840: 7465 203d 2072 6574 7572 6e5f 7661 6c75  te = return_valu
-00055850: 652e 636f 6e73 7461 6e74 0d0a 0d0a 2020  e.constant....  
-00055860: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00055870: 6966 2069 7369 6e73 7461 6e63 6528 7265  if isinstance(re
-00055880: 7475 726e 5f76 616c 7565 2e63 6f6e 7374  turn_value.const
-00055890: 616e 742c 696e 7429 3a0d 0a20 2020 2020  ant,int):..     
-000558a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000558b0: 436f 6e73 7461 6e74 2063 6f75 6c64 2062  Constant could b
-000558c0: 6520 616e 2045 6d70 6f77 6572 2070 6879  e an Empower phy
-000558d0: 7369 6361 6c20 6964 0d0a 2020 2020 2020  sical id..      
-000558e0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-000558f0: 7220 656c 656d 656e 7420 696e 2073 656c  r element in sel
-00055900: 662e 7369 7465 2e64 696d 656e 7369 6f6e  f.site.dimension
-00055910: 735b 3131 5d2e 656c 656d 656e 7473 2e76  s[11].elements.v
-00055920: 616c 7565 7328 293a 0d0a 2020 2020 2020  alues():..      
-00055930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055940: 2020 6966 2065 6c65 6d65 6e74 2e70 6879    if element.phy
-00055950: 7369 6420 3d3d 2072 6574 7572 6e5f 7661  sid == return_va
-00055960: 6c75 652e 636f 6e73 7461 6e74 3a0d 0a20  lue.constant:.. 
-00055970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055980: 2020 2020 2020 2020 2020 2066 6f75 6e64             found
-00055990: 5f65 6c65 6d65 6e74 203d 2065 6c65 6d65  _element = eleme
-000559a0: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-000559b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000559c0: 2354 4f44 4f20 6861 6e64 6c65 0d0a 0d0a  #TODO handle....
+000528f0: 6669 656c 6473 5f65 6c65 6d65 6e74 5f6c  fields_element_l
+00052900: 6f6f 6b75 7020 3d20 7b7d 0d0a 2020 2020  ookup = {}..    
+00052910: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00052920: 6869 6572 6172 6368 7920 696e 2068 6965  hierarchy in hie
+00052930: 7261 7263 6869 6573 3a0d 0a20 2020 2020  rarchies:..     
+00052940: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00052950: 6f72 2065 6c20 696e 2068 6965 7261 7263  or el in hierarc
+00052960: 6879 2e6c 6561 7665 733a 0d0a 2020 2020  hy.leaves:..    
+00052970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052980: 2020 2020 6669 656c 6473 5f65 6c65 6d65      fields_eleme
+00052990: 6e74 5f6c 6f6f 6b75 705b 7475 706c 6528  nt_lookup[tuple(
+000529a0: 656c 2e66 6965 6c64 735b 6669 656c 645d  el.fields[field]
+000529b0: 2066 6f72 2066 6965 6c64 2069 6e20 666f   for field in fo
+000529c0: 756e 645f 6669 656c 6473 295d 203d 2065  und_fields)] = e
+000529d0: 6c2e 7368 6f72 746e 616d 650d 0a20 2020  l.shortname..   
+000529e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+000529f0: 7572 6e20 6669 656c 6473 5f65 6c65 6d65  urn fields_eleme
+00052a00: 6e74 5f6c 6f6f 6b75 702c 2027 636f 6c75  nt_lookup, 'colu
+00052a10: 6d6e 7320 746f 2066 6965 6c64 7327 202c  mns to fields' ,
+00052a20: 636f 6c75 6d6e 5f6e 616d 6573 0d0a 2020  column_names..  
+00052a30: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+00052a40: 735f 7368 6f72 7463 6f64 655f 7661 6c75  s_shortcode_valu
+00052a50: 655f 6d61 7070 696e 673a 0d0a 2020 2020  e_mapping:..    
+00052a60: 2020 2020 2020 2020 2020 2020 656c 656d              elem
+00052a70: 656e 7473 203d 205b 5d0d 0a20 2020 2020  ents = []..     
+00052a80: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+00052a90: 6320 696e 2073 686f 7274 636f 6465 5f76  c in shortcode_v
+00052aa0: 616c 7565 5f6d 6170 7069 6e67 2e6b 6579  alue_mapping.key
+00052ab0: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
+00052ac0: 2020 2020 2020 2020 2020 666f 7220 6869            for hi
+00052ad0: 6572 6172 6368 7920 696e 2068 6965 7261  erarchy in hiera
+00052ae0: 7263 6869 6573 3a0d 0a20 2020 2020 2020  rchies:..       
+00052af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052b00: 2069 6620 7363 2069 6e20 5b6c 2e73 686f   if sc in [l.sho
+00052b10: 7274 6e61 6d65 2066 6f72 206c 2069 6e20  rtname for l in 
+00052b20: 6869 6572 6172 6368 792e 6765 745f 656c  hierarchy.get_el
+00052b30: 656d 656e 7473 2873 6329 5d3a 0d0a 2020  ements(sc)]:..  
+00052b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00052b50: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
+00052b60: 7473 2e61 7070 656e 6428 7363 290d 0a0d  ts.append(sc)...
+00052b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00052b80: 2072 6574 7572 6e20 656c 656d 656e 7473   return elements
+00052b90: 2c20 2763 6f6c 756d 6e20 746f 2073 686f  , 'column to sho
+00052ba0: 7274 6e61 6d65 2074 6f20 7661 6c75 6527  rtname to value'
+00052bb0: 2c20 636f 6c75 6d6e 5f6e 616d 6573 0d0a  , column_names..
+00052bc0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00052bd0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00052be0: 2020 2020 2023 5765 2776 6520 6661 6c6c       #We've fall
+00052bf0: 656e 206f 6666 2074 6865 2065 6e64 206f  en off the end o
+00052c00: 6620 7468 6520 776f 726c 6420 6865 7265  f the world here
+00052c10: 202d 2073 6f6d 6574 6869 6e67 2069 6e20   - something in 
+00052c20: 7468 6520 6c6f 6769 6320 6f66 2074 6865  the logic of the
+00052c30: 2063 6f64 6520 6973 2062 726f 6b65 6e0d   code is broken.
+00052c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00052c50: 2072 6169 7365 206d 7065 782e 4c6f 6164   raise mpex.Load
+00052c60: 6572 5365 7475 7045 7272 6f72 2827 436f  erSetupError('Co
+00052c70: 756c 6420 6e6f 7420 6669 6e64 206d 6170  uld not find map
+00052c80: 7069 6e67 2074 7970 6527 290d 0a0d 0a20  ping type').... 
+00052c90: 2020 2064 6566 205f 6372 6561 7465 5f54     def _create_T
+00052ca0: 6162 6c65 4d61 7070 6572 7328 7365 6c66  ableMappers(self
+00052cb0: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
+00052cc0: 656c 662e 5f69 6e69 7469 616c 5f74 6172  elf._initial_tar
+00052cd0: 6765 7420 6973 204e 6f6e 653a 0d0a 2020  get is None:..  
+00052ce0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00052cf0: 6d70 6578 2e4c 6f61 6465 7253 6574 7570  mpex.LoaderSetup
+00052d00: 4572 726f 7228 2743 616e 6e6f 7420 7365  Error('Cannot se
+00052d10: 7420 7570 2061 2046 6f63 7573 4c6f 6164  t up a FocusLoad
+00052d20: 6572 2077 6974 686f 7574 2061 2074 6172  er without a tar
+00052d30: 6765 7427 290d 0a0d 0a20 2020 2020 2020  get')....       
+00052d40: 2073 656c 662e 5f64 696d 656e 7369 6f6e   self._dimension
+00052d50: 5f30 5f6d 6170 7065 7220 2020 3d20 7365  _0_mapper   = se
+00052d60: 6c66 2e5f 6765 745f 5461 626c 654d 6170  lf._get_TableMap
+00052d70: 7065 725f 666f 725f 6469 6d65 6e73 696f  per_for_dimensio
+00052d80: 6e69 6e64 6578 2864 696d 656e 7369 6f6e  nindex(dimension
+00052d90: 5f69 6e64 6578 203d 2030 290d 0a20 2020  _index = 0)..   
+00052da0: 2020 2020 2073 656c 662e 5f64 696d 656e       self._dimen
+00052db0: 7369 6f6e 5f31 5f6d 6170 7065 7220 2020  sion_1_mapper   
+00052dc0: 3d20 7365 6c66 2e5f 6765 745f 5461 626c  = self._get_Tabl
+00052dd0: 654d 6170 7065 725f 666f 725f 6469 6d65  eMapper_for_dime
+00052de0: 6e73 696f 6e69 6e64 6578 2864 696d 656e  nsionindex(dimen
+00052df0: 7369 6f6e 5f69 6e64 6578 203d 2031 290d  sion_index = 1).
+00052e00: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
+00052e10: 696d 656e 7369 6f6e 5f32 5f6d 6170 7065  imension_2_mappe
+00052e20: 7220 2020 3d20 7365 6c66 2e5f 6765 745f  r   = self._get_
+00052e30: 5461 626c 654d 6170 7065 725f 666f 725f  TableMapper_for_
+00052e40: 6469 6d65 6e73 696f 6e69 6e64 6578 2864  dimensionindex(d
+00052e50: 696d 656e 7369 6f6e 5f69 6e64 6578 203d  imension_index =
+00052e60: 2032 290d 0a20 2020 2020 2020 2073 656c   2)..        sel
+00052e70: 662e 5f64 696d 656e 7369 6f6e 5f33 5f6d  f._dimension_3_m
+00052e80: 6170 7065 7220 2020 3d20 7365 6c66 2e5f  apper   = self._
+00052e90: 6765 745f 5461 626c 654d 6170 7065 725f  get_TableMapper_
+00052ea0: 666f 725f 6469 6d65 6e73 696f 6e69 6e64  for_dimensionind
+00052eb0: 6578 2864 696d 656e 7369 6f6e 5f69 6e64  ex(dimension_ind
+00052ec0: 6578 203d 2033 290d 0a20 2020 2020 2020  ex = 3)..       
+00052ed0: 2073 656c 662e 5f64 696d 656e 7369 6f6e   self._dimension
+00052ee0: 5f34 5f6d 6170 7065 7220 2020 3d20 7365  _4_mapper   = se
+00052ef0: 6c66 2e5f 6765 745f 5461 626c 654d 6170  lf._get_TableMap
+00052f00: 7065 725f 666f 725f 6469 6d65 6e73 696f  per_for_dimensio
+00052f10: 6e69 6e64 6578 2864 696d 656e 7369 6f6e  nindex(dimension
+00052f20: 5f69 6e64 6578 203d 2034 290d 0a20 2020  _index = 4)..   
+00052f30: 2020 2020 2073 656c 662e 5f64 696d 656e       self._dimen
+00052f40: 7369 6f6e 5f35 5f6d 6170 7065 7220 2020  sion_5_mapper   
+00052f50: 3d20 7365 6c66 2e5f 6765 745f 5461 626c  = self._get_Tabl
+00052f60: 654d 6170 7065 725f 666f 725f 6469 6d65  eMapper_for_dime
+00052f70: 6e73 696f 6e69 6e64 6578 2864 696d 656e  nsionindex(dimen
+00052f80: 7369 6f6e 5f69 6e64 6578 203d 2035 290d  sion_index = 5).
+00052f90: 0a20 2020 2020 2020 2073 656c 662e 5f64  .        self._d
+00052fa0: 696d 656e 7369 6f6e 5f36 5f6d 6170 7065  imension_6_mappe
+00052fb0: 7220 2020 3d20 7365 6c66 2e5f 6765 745f  r   = self._get_
+00052fc0: 5461 626c 654d 6170 7065 725f 666f 725f  TableMapper_for_
+00052fd0: 6469 6d65 6e73 696f 6e69 6e64 6578 2864  dimensionindex(d
+00052fe0: 696d 656e 7369 6f6e 5f69 6e64 6578 203d  imension_index =
+00052ff0: 2036 290d 0a20 2020 2020 2020 2073 656c   6)..        sel
+00053000: 662e 5f64 696d 656e 7369 6f6e 5f37 5f6d  f._dimension_7_m
+00053010: 6170 7065 7220 2020 3d20 7365 6c66 2e5f  apper   = self._
+00053020: 6765 745f 5461 626c 654d 6170 7065 725f  get_TableMapper_
+00053030: 666f 725f 6469 6d65 6e73 696f 6e69 6e64  for_dimensionind
+00053040: 6578 2864 696d 656e 7369 6f6e 5f69 6e64  ex(dimension_ind
+00053050: 6578 203d 2037 290d 0a20 2020 2020 2020  ex = 7)..       
+00053060: 2073 656c 662e 5f6d 6574 7269 635f 6d61   self._metric_ma
+00053070: 7070 6572 2020 2020 2020 2020 3d20 7365  pper        = se
+00053080: 6c66 2e5f 6765 745f 5461 626c 654d 6170  lf._get_TableMap
+00053090: 7065 725f 666f 725f 6469 6d65 6e73 696f  per_for_dimensio
+000530a0: 6e69 6e64 6578 2864 696d 656e 7369 6f6e  nindex(dimension
+000530b0: 5f69 6e64 6578 203d 2038 290d 0a20 2020  _index = 8)..   
+000530c0: 2020 2020 2073 656c 662e 5f6d 6f64 655f       self._mode_
+000530d0: 6d61 7070 6572 2020 2020 2020 2020 2020  mapper          
+000530e0: 3d20 7365 6c66 2e5f 6765 745f 5461 626c  = self._get_Tabl
+000530f0: 654d 6170 7065 725f 666f 725f 6469 6d65  eMapper_for_dime
+00053100: 6e73 696f 6e69 6e64 6578 2864 696d 656e  nsionindex(dimen
+00053110: 7369 6f6e 5f69 6e64 6578 203d 2039 290d  sion_index = 9).
+00053120: 0a20 2020 2020 2020 2073 656c 662e 5f62  .        self._b
+00053130: 6173 655f 6d61 7070 6572 2020 2020 2020  ase_mapper      
+00053140: 2020 2020 3d20 7365 6c66 2e5f 6765 745f      = self._get_
+00053150: 5461 626c 654d 6170 7065 725f 666f 725f  TableMapper_for_
+00053160: 6469 6d65 6e73 696f 6e69 6e64 6578 2864  dimensionindex(d
+00053170: 696d 656e 7369 6f6e 5f69 6e64 6578 203d  imension_index =
+00053180: 2031 3029 0d0a 0d0a 2020 2020 2020 2020   10)....        
+00053190: 7469 6d65 5f6d 6170 7065 725f 7475 706c  time_mapper_tupl
+000531a0: 6520 2020 2020 2020 2020 203d 2073 656c  e          = sel
+000531b0: 662e 5f67 6574 5f54 6162 6c65 4d61 7070  f._get_TableMapp
+000531c0: 6572 5f66 6f72 5f64 696d 656e 7369 6f6e  er_for_dimension
+000531d0: 696e 6465 7828 6469 6d65 6e73 696f 6e5f  index(dimension_
+000531e0: 696e 6465 7820 3d20 3131 290d 0a0d 0a20  index = 11).... 
+000531f0: 2020 2020 2020 2069 6620 7469 6d65 5f6d         if time_m
+00053200: 6170 7065 725f 7475 706c 6520 6973 204e  apper_tuple is N
+00053210: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00053220: 2020 7365 6c66 2e5f 7469 6d65 5f6d 6170    self._time_map
+00053230: 7065 7220 2020 2020 2020 2020 3d20 4e6f  per         = No
+00053240: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+00053250: 7365 6c66 2e5f 656d 706f 7765 725f 7065  self._empower_pe
+00053260: 7269 6f64 5f74 7970 6520 3d20 4e6f 6e65  riod_type = None
+00053270: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00053280: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00053290: 662e 5f74 696d 655f 6d61 7070 6572 2c73  f._time_mapper,s
+000532a0: 656c 662e 5f65 6d70 6f77 6572 5f70 6572  elf._empower_per
+000532b0: 696f 645f 7479 7065 203d 2074 696d 655f  iod_type = time_
+000532c0: 6d61 7070 6572 5f74 7570 6c65 0d0a 0d0a  mapper_tuple....
+000532d0: 2020 2020 6465 6620 5f67 6574 5f65 6666      def _get_eff
+000532e0: 6563 7469 7665 5f65 6c65 6d65 6e74 5f66  ective_element_f
+000532f0: 6f72 5f73 7472 7563 7475 7265 2873 656c  or_structure(sel
+00053300: 662c 6469 6d65 6e73 696f 6e5f 696e 6465  f,dimension_inde
+00053310: 782c 6566 6665 6374 6976 655f 656c 656d  x,effective_elem
+00053320: 656e 7473 293a 0d0a 2020 2020 2020 2020  ents):..        
+00053330: 2727 270d 0a20 2020 2020 2020 203a 7061  '''..        :pa
+00053340: 7261 6d20 6566 6665 6374 6976 655f 656c  ram effective_el
+00053350: 656d 656e 7473 3a20 4375 7272 656e 746c  ements: Currentl
+00053360: 7920 6967 6e6f 7265 7320 2d20 7365 6520  y ignores - see 
+00053370: 636f 6d6d 656e 7473 2062 656c 6f77 0d0a  comments below..
+00053380: 2020 2020 2020 2020 2727 270d 0a20 2020          '''..   
+00053390: 2020 2020 2023 6566 6665 6374 6976 655f       #effective_
+000533a0: 656c 656d 656e 7473 206d 6179 2062 6520  elements may be 
+000533b0: 4e6f 6e65 2e0d 0a20 2020 2020 2020 2023  None...        #
+000533c0: 5468 6973 2069 7320 7768 6174 2067 6574  This is what get
+000533d0: 7320 7265 7475 726e 6564 2077 6865 6e20  s returned when 
+000533e0: 7765 2068 6176 6520 6669 6775 7265 6420  we have figured 
+000533f0: 6f75 7420 7765 2061 7265 206c 6f6f 6b69  out we are looki
+00053400: 6e67 2061 7420 6120 636f 6c75 6d6e 0d0a  ng at a column..
+00053410: 2020 2020 2020 2020 2349 7420 696d 706c          #It impl
+00053420: 6965 7320 7468 6174 2077 6520 7061 7373  ies that we pass
+00053430: 2074 6865 2065 6666 6563 7469 7665 2065   the effective e
+00053440: 6c65 6d65 6e74 2061 7320 636f 6d70 7574  lement as comput
+00053450: 6564 2062 7920 7365 6c66 2e65 6666 6563  ed by self.effec
+00053460: 7469 7665 5f64 696d 656e 7369 6f6e 5f65  tive_dimension_e
+00053470: 6c65 6d65 6e74 7328 290d 0a0d 0a20 2020  lements()....   
+00053480: 2020 2020 2023 2321 2121 2121 2121 210d       ##!!!!!!!!.
+00053490: 0a20 2020 2020 2020 2023 2066 6f72 206e  .        # for n
+000534a0: 6f77 2077 6520 6172 6520 6967 6e6f 7269  ow we are ignori
+000534b0: 6e67 2065 6666 6563 7469 7665 5f65 6c65  ng effective_ele
+000534c0: 6d65 6e74 7320 696e 7075 7420 2d20 6974  ments input - it
+000534d0: 206d 6967 6874 2068 6176 6520 736f 6d65   might have some
+000534e0: 2075 7365 2c20 6275 7420 756e 666f 7274   use, but unfort
+000534f0: 756e 6174 656c 7920 6974 2067 6574 7320  unately it gets 
+00053500: 7468 6520 6f6e 6573 2061 7420 6c65 6166  the ones at leaf
+00053510: 206c 6576 656c 0d0a 2020 2020 2020 2020   level..        
+00053520: 2320 666f 7220 636f 6d70 6172 6973 6f6e  # for comparison
+00053530: 2077 6974 6820 7468 6520 6461 7461 2063   with the data c
+00053540: 6f6d 696e 6720 696e 0d0a 2020 2020 2020  oming in..      
+00053550: 2020 2320 7765 206e 6565 6420 7468 6520    # we need the 
+00053560: 726f 6f74 7769 7365 206f 6e65 732c 2061  rootwise ones, a
+00053570: 7320 7061 7373 6564 2074 6f20 7468 6520  s passed to the 
+00053580: 466f 6375 7320 5374 7269 6e67 206d 616b  Focus String mak
+00053590: 6572 2e0d 0a20 2020 2020 2020 2023 2053  er...        # S
+000535a0: 696e 6365 2077 6527 7665 2061 6c72 6561  ince we've alrea
+000535b0: 6479 2063 616c 6375 6c61 7465 6420 7468  dy calculated th
+000535c0: 6573 652c 2077 6520 6861 7665 2061 6e20  ese, we have an 
+000535d0: 6f70 706f 7274 756e 6974 7920 666f 7220  opportunity for 
+000535e0: 7265 7573 696e 6720 7468 6520 6361 6c63  reusing the calc
+000535f0: 756c 6174 696f 6e20 7265 7375 6c74 2028  ulation result (
+00053600: 706f 7373 6962 6c79 2062 7920 6d65 6d6f  possibly by memo
+00053610: 697a 696e 6720 7468 6520 6675 6e63 7469  izing the functi
+00053620: 6f6e 290d 0a20 2020 2020 2020 2023 2046  on)..        # F
+00053630: 6f72 206e 6f77 2075 7365 2074 6865 2066  or now use the f
+00053640: 756e 6374 696f 6e20 6167 6169 6e0d 0a0d  unction again...
+00053650: 0a20 2020 2020 2020 2065 6666 6563 7469  .        effecti
+00053660: 7665 5f65 6c65 6d65 6e74 7320 3d20 7365  ve_elements = se
+00053670: 6c66 2e65 6666 6563 7469 7665 5f64 696d  lf.effective_dim
+00053680: 656e 7369 6f6e 5f65 6c65 6d65 6e74 7328  ension_elements(
+00053690: 6469 6d65 6e73 696f 6e5f 696e 6465 7829  dimension_index)
+000536a0: 0d0a 0d0a 2020 2020 2020 2020 2349 6620  ....        #If 
+000536b0: 7374 696c 6c20 4e6f 6e65 2c20 7261 6973  still None, rais
+000536c0: 6520 616e 2065 7272 6f72 0d0a 2020 2020  e an error..    
+000536d0: 2020 2020 6966 2065 6666 6563 7469 7665      if effective
+000536e0: 5f65 6c65 6d65 6e74 7320 6973 204e 6f6e  _elements is Non
+000536f0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00053700: 7261 6973 6520 6d70 6578 2e4c 6f61 6465  raise mpex.Loade
+00053710: 7253 6574 7570 4572 726f 7228 2743 6f75  rSetupError('Cou
+00053720: 6c64 206e 6f74 2063 6f6d 7075 7465 2065  ld not compute e
+00053730: 6666 6563 7469 7665 2065 6c65 6d65 6e74  ffective element
+00053740: 7320 746f 2063 7265 6174 6520 6120 5461  s to create a Ta
+00053750: 626c 654d 6170 7065 7220 6672 6f6d 2066  bleMapper from f
+00053760: 6f72 2064 696d 656e 7369 6f6e 2069 6e64  or dimension ind
+00053770: 6578 207b 7d2c 2066 6f72 207b 7d27 2e66  ex {}, for {}'.f
+00053780: 6f72 6d61 7428 6469 6d65 6e73 696f 6e5f  ormat(dimension_
+00053790: 696e 6465 782c 7265 7072 2873 656c 662e  index,repr(self.
+000537a0: 7461 7267 6574 2e73 7472 7563 7475 7265  target.structure
+000537b0: 735b 6469 6d65 6e73 696f 6e5f 696e 6465  s[dimension_inde
+000537c0: 785d 2929 290d 0a0d 0a20 2020 2020 2020  x])))....       
+000537d0: 2069 6620 6c65 6e28 6566 6665 6374 6976   if len(effectiv
+000537e0: 655f 656c 656d 656e 7473 2920 3e20 313a  e_elements) > 1:
+000537f0: 0d0a 2020 2020 2020 2020 2020 2020 2354  ..            #T
+00053800: 4f44 4f20 2d20 6368 616e 6765 2074 6869  ODO - change thi
+00053810: 7320 7768 656e 2077 6520 6861 7665 2065  s when we have e
+00053820: 2e67 2e20 6d75 6c74 6970 6c65 2043 6f6d  .g. multiple Com
+00053830: 7061 7269 736f 6e73 0d0a 2020 2020 2020  parisons..      
+00053840: 2020 2020 2020 7261 6973 6520 6d70 6578        raise mpex
+00053850: 2e4c 6f61 6465 7253 6574 7570 4572 726f  .LoaderSetupErro
+00053860: 7228 274d 756c 7469 706c 6520 4566 6665  r('Multiple Effe
+00053870: 6374 6976 6520 656c 656d 656e 7473 207b  ctive elements {
+00053880: 7d20 696e 2064 696d 656e 7369 6f6e 207b  } in dimension {
+00053890: 7d20 6e6f 7420 636f 6465 6420 666f 7220  } not coded for 
+000538a0: 5374 7275 6374 7572 654d 6170 7065 7273  StructureMappers
+000538b0: 2079 6574 272e 666f 726d 6174 285b 7265   yet'.format([re
+000538c0: 7072 2865 6c29 2066 6f72 2065 6c20 696e  pr(el) for el in
+000538d0: 2065 6666 6563 7469 7665 5f65 6c65 6d65   effective_eleme
+000538e0: 6e74 735d 2c20 6469 6d65 6e73 696f 6e5f  nts], dimension_
+000538f0: 696e 6465 7829 290d 0a0d 0a20 2020 2020  index))....     
+00053900: 2020 2069 6620 6c65 6e28 6566 6665 6374     if len(effect
+00053910: 6976 655f 656c 656d 656e 7473 2920 3e20  ive_elements) > 
+00053920: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+00053930: 7261 6973 6520 6d70 6578 2e4c 6f61 6465  raise mpex.Loade
+00053940: 7253 6574 7570 4572 726f 7228 274d 756c  rSetupError('Mul
+00053950: 7469 706c 6520 4566 6665 6374 6976 6520  tiple Effective 
+00053960: 656c 656d 656e 7473 207b 7d20 696e 2064  elements {} in d
+00053970: 696d 656e 7369 6f6e 207b 7d20 6e6f 7420  imension {} not 
+00053980: 636f 6465 6420 666f 7220 5374 7275 6374  coded for Struct
+00053990: 7572 654d 6170 7065 7273 2079 6574 272e  ureMappers yet'.
+000539a0: 666f 726d 6174 285b 7265 7072 2865 6c29  format([repr(el)
+000539b0: 2066 6f72 2065 6c20 696e 2065 6666 6563   for el in effec
+000539c0: 7469 7665 5f65 6c65 6d65 6e74 735d 2c20  tive_elements], 
+000539d0: 6469 6d65 6e73 696f 6e5f 696e 6465 7829  dimension_index)
+000539e0: 290d 0a0d 0a20 2020 2020 2020 2065 6666  )....        eff
+000539f0: 6563 7469 7665 5f65 6c65 6d65 6e74 203d  ective_element =
+00053a00: 2065 6666 6563 7469 7665 5f65 6c65 6d65   effective_eleme
+00053a10: 6e74 735b 305d 0d0a 0d0a 2020 2020 2020  nts[0]....      
+00053a20: 2020 7265 7475 726e 2065 6666 6563 7469    return effecti
+00053a30: 7665 5f65 6c65 6d65 6e74 0d0a 0d0a 2020  ve_element....  
+00053a40: 2020 6465 6620 5f67 6574 5f54 6162 6c65    def _get_Table
+00053a50: 4d61 7070 6572 5f66 6f72 5f64 696d 656e  Mapper_for_dimen
+00053a60: 7369 6f6e 696e 6465 7828 7365 6c66 2c64  sionindex(self,d
+00053a70: 696d 656e 7369 6f6e 5f69 6e64 6578 293a  imension_index):
+00053a80: 0d0a 0d0a 2020 2020 2020 2020 2348 616e  ....        #Han
+00053a90: 646c 6520 7468 6520 6361 7365 2066 6f72  dle the case for
+00053aa0: 2065 6d70 7479 2055 6e69 7420 6469 6d65   empty Unit dime
+00053ab0: 6e73 696f 6e73 0d0a 2020 2020 2020 2020  nsions..        
+00053ac0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+00053ad0: 2020 6966 2073 656c 662e 7369 7465 2069    if self.site i
+00053ae0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00053af0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00053b00: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
+00053b10: 2020 2020 6469 6d20 3d20 7365 6c66 2e73      dim = self.s
+00053b20: 6974 652e 6469 6d65 6e73 696f 6e73 5b64  ite.dimensions[d
+00053b30: 696d 656e 7369 6f6e 5f69 6e64 6578 5d0d  imension_index].
+00053b40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00053b50: 6469 6d20 6973 204e 6f6e 653a 0d0a 2020  dim is None:..  
+00053b60: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00053b70: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
+00053b80: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
+00053b90: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00053ba0: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
+00053bb0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
+00053bc0: 0d0a 2020 2020 2020 2020 6566 6665 6374  ..        effect
+00053bd0: 6976 655f 656c 656d 656e 7473 2c20 6d61  ive_elements, ma
+00053be0: 7070 696e 675f 7479 7065 2c63 6f6c 756d  pping_type,colum
+00053bf0: 6e5f 6e61 6d65 7320 3d20 7365 6c66 2e5f  n_names = self._
+00053c00: 6765 745f 696d 706c 6965 645f 7368 6f72  get_implied_shor
+00053c10: 7463 6f64 655f 6c69 7374 5f61 6e64 5f6d  tcode_list_and_m
+00053c20: 6170 7069 6e67 5f74 7970 6528 6469 6d65  apping_type(dime
+00053c30: 6e73 696f 6e5f 696e 6465 7820 3d20 6469  nsion_index = di
+00053c40: 6d65 6e73 696f 6e5f 696e 6465 782c 206f  mension_index, o
+00053c50: 626a 6563 745f 746f 5f63 6865 636b 5f61  bject_to_check_a
+00053c60: 6761 696e 7374 203d 7365 6c66 2e74 6172  gainst =self.tar
+00053c70: 6765 742e 7374 7275 6374 7572 6573 5b64  get.structures[d
+00053c80: 696d 656e 7369 6f6e 5f69 6e64 6578 5d29  imension_index])
+00053c90: 0d0a 0d0a 0d0a 2020 2020 2020 2020 2343  ......        #C
+00053ca0: 6865 636b 2074 6861 7420 6120 636f 6c75  heck that a colu
+00053cb0: 6d6e 206e 616d 6520 7265 616c 6c79 2069  mn name really i
+00053cc0: 7320 6120 636f 6c75 6d6e 206e 616d 652c  s a column name,
+00053cd0: 2061 6e64 206e 6f74 2061 206d 6973 7479   and not a misty
+00053ce0: 7065 6420 7368 6f72 746e 616d 652c 206f  ped shortname, o
+00053cf0: 7220 6120 6c6f 7420 6f66 2069 6e6e 6f63  r a lot of innoc
+00053d00: 656e 7420 6461 7461 2069 7320 676f 696e  ent data is goin
+00053d10: 6720 746f 2062 6520 6465 7374 726f 7965  g to be destroye
+00053d20: 640d 0a20 2020 2020 2020 2069 6620 636f  d..        if co
+00053d30: 6c75 6d6e 5f6e 616d 6573 2069 7320 6e6f  lumn_names is no
+00053d40: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00053d50: 2020 2020 2066 6f72 2063 6f6c 756d 6e5f       for column_
+00053d60: 6e61 6d65 2069 6e20 636f 6c75 6d6e 5f6e  name in column_n
+00053d70: 616d 6573 3a0d 0a20 2020 2020 2020 2020  ames:..         
+00053d80: 2020 2020 2020 2069 6620 7365 6c66 2e73         if self.s
+00053d90: 6f75 7263 6520 6973 204e 6f6e 6520 6f72  ource is None or
+00053da0: 2063 6f6c 756d 6e5f 6e61 6d65 206e 6f74   column_name not
+00053db0: 2069 6e20 7365 6c66 2e63 6f6c 756d 6e73   in self.columns
+00053dc0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00053dd0: 2020 2020 2020 2072 6169 7365 206d 7065         raise mpe
+00053de0: 782e 4c6f 6164 6572 5365 7475 7045 7272  x.LoaderSetupErr
+00053df0: 6f72 2827 4d61 7070 6564 2063 6f6c 756d  or('Mapped colum
+00053e00: 6e20 6e61 6d65 207b 7d20 696e 2064 696d  n name {} in dim
+00053e10: 656e 7369 6f6e 207b 7d20 6e6f 7420 696e  ension {} not in
+00053e20: 2063 6f6c 756d 6e20 6e61 6d65 7320 6f66   column names of
+00053e30: 2073 6f75 7263 6520 7b7d 272e 666f 726d   source {}'.form
+00053e40: 6174 2863 6f6c 756d 6e5f 6e61 6d65 2c20  at(column_name, 
+00053e50: 6469 6d65 6e73 696f 6e5f 696e 6465 782c  dimension_index,
+00053e60: 2073 656c 662e 636f 6c75 6d6e 7329 290d   self.columns)).
+00053e70: 0a0d 0a20 2020 2020 2020 2023 5765 2068  ...        #We h
+00053e80: 616e 646c 6520 5374 7275 6374 7572 6573  andle Structures
+00053e90: 2064 6966 6665 7265 6e74 6c79 2074 6f20   differently to 
+00053ea0: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
+00053eb0: 730d 0a20 2020 2020 2020 2069 735f 7374  s..        is_st
+00053ec0: 7275 6374 7572 6520 3d20 6973 696e 7374  ructure = isinst
+00053ed0: 616e 6365 2873 656c 662e 7461 7267 6574  ance(self.target
+00053ee0: 2e73 7472 7563 7475 7265 735b 6469 6d65  .structures[dime
+00053ef0: 6e73 696f 6e5f 696e 6465 785d 2c53 7472  nsion_index],Str
+00053f00: 7563 7475 7265 290d 0a20 2020 2020 2020  ucture)..       
+00053f10: 2069 735f 7374 7275 6374 7572 655f 656c   is_structure_el
+00053f20: 656d 656e 7420 3d20 6973 696e 7374 616e  ement = isinstan
+00053f30: 6365 2873 656c 662e 7461 7267 6574 2e73  ce(self.target.s
+00053f40: 7472 7563 7475 7265 735b 6469 6d65 6e73  tructures[dimens
+00053f50: 696f 6e5f 696e 6465 785d 2c53 7472 7563  ion_index],Struc
+00053f60: 7475 7265 456c 656d 656e 7429 0d0a 0d0a  tureElement)....
+00053f70: 2020 2020 2020 2020 7265 7475 726e 5f76          return_v
+00053f80: 616c 7565 203d 204e 6f6e 650d 0a0d 0a20  alue = None.... 
+00053f90: 2020 2020 2020 2069 6620 6d61 7070 696e         if mappin
+00053fa0: 675f 7479 7065 203d 3d27 636f 6e73 7461  g_type =='consta
+00053fb0: 6e74 2073 686f 7274 6e61 6d65 273a 0d0a  nt shortname':..
+00053fc0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00053fd0: 726e 5f76 616c 7565 203d 2043 6f6e 7374  rn_value = Const
+00053fe0: 616e 7428 636f 6e73 7461 6e74 203d 2065  ant(constant = e
+00053ff0: 6666 6563 7469 7665 5f65 6c65 6d65 6e74  ffective_element
+00054000: 735b 305d 290d 0a20 2020 2020 2020 2065  s[0])..        e
+00054010: 6c69 6620 6d61 7070 696e 675f 7479 7065  lif mapping_type
+00054020: 203d 3d27 636f 6c75 6d6e 206e 616d 6527   =='column name'
+00054030: 3a0d 0a0d 0a0d 0a20 2020 2020 2020 2020  :......         
+00054040: 2020 2069 6620 6973 5f73 7472 7563 7475     if is_structu
+00054050: 7265 3a0d 0a20 2020 2020 2020 2020 2020  re:..           
+00054060: 2020 2020 2065 6666 6563 7469 7665 5f65       effective_e
+00054070: 6c65 6d65 6e74 203d 2073 656c 662e 5f67  lement = self._g
+00054080: 6574 5f65 6666 6563 7469 7665 5f65 6c65  et_effective_ele
+00054090: 6d65 6e74 5f66 6f72 5f73 7472 7563 7475  ment_for_structu
+000540a0: 7265 2864 696d 656e 7369 6f6e 5f69 6e64  re(dimension_ind
+000540b0: 6578 3d64 696d 656e 7369 6f6e 5f69 6e64  ex=dimension_ind
+000540c0: 6578 2c65 6666 6563 7469 7665 5f65 6c65  ex,effective_ele
+000540d0: 6d65 6e74 7320 3d20 6566 6665 6374 6976  ments = effectiv
+000540e0: 655f 656c 656d 656e 7473 290d 0a0d 0a20  e_elements).... 
+000540f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00054100: 6574 7572 6e5f 7661 6c75 6520 3d20 2053  eturn_value =  S
+00054110: 7472 7563 7475 7265 4d61 7070 6572 2873  tructureMapper(s
+00054120: 686f 7274 6e61 6d65 5f63 6f6c 756d 6e3d  hortname_column=
+00054130: 636f 6c75 6d6e 5f6e 616d 652c 7061 7468  column_name,path
+00054140: 203d 2065 6666 6563 7469 7665 5f65 6c65   = effective_ele
+00054150: 6d65 6e74 2e70 6174 6829 0d0a 2020 2020  ment.path)..    
+00054160: 2020 2020 2020 2020 656c 6966 2069 735f          elif is_
+00054170: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+00054180: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00054190: 2020 2020 7374 7275 6374 7572 655f 656c      structure_el
+000541a0: 656d 656e 7420 3d20 7365 6c66 2e74 6172  ement = self.tar
+000541b0: 6765 742e 7374 7275 6374 7572 6573 5b64  get.structures[d
+000541c0: 696d 656e 7369 6f6e 5f69 6e64 6578 5d0d  imension_index].
+000541d0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+000541e0: 2020 2069 6620 7374 7275 6374 7572 655f     if structure_
+000541f0: 656c 656d 656e 742e 6973 5f6c 6561 663a  element.is_leaf:
+00054200: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00054210: 2020 2020 2020 7265 7475 726e 5f76 616c        return_val
+00054220: 7565 203d 2020 436f 6c75 6d6e 4d61 7070  ue =  ColumnMapp
+00054230: 6572 2863 6f6c 756d 6e5f 6e61 6d65 3d63  er(column_name=c
+00054240: 6f6c 756d 6e5f 6e61 6d65 2c63 6f6c 756d  olumn_name,colum
+00054250: 6e5f 7479 7065 3d27 7368 6f72 746e 616d  n_type='shortnam
+00054260: 6527 2c66 6965 6c64 5f73 686f 7274 6e61  e',field_shortna
+00054270: 6d65 3d4e 6f6e 6529 0d0a 2020 2020 2020  me=None)..      
+00054280: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00054290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000542a0: 2020 2020 2072 6574 7572 6e5f 7661 6c75       return_valu
+000542b0: 6520 3d20 2053 7472 7563 7475 7265 4d61  e =  StructureMa
+000542c0: 7070 6572 2873 686f 7274 6e61 6d65 5f63  pper(shortname_c
+000542d0: 6f6c 756d 6e3d 636f 6c75 6d6e 5f6e 616d  olumn=column_nam
+000542e0: 652c 7061 7468 203d 2073 7472 7563 7475  e,path = structu
+000542f0: 7265 5f65 6c65 6d65 6e74 2e70 6174 6829  re_element.path)
+00054300: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00054310: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00054320: 2020 2020 2072 6574 7572 6e5f 7661 6c75       return_valu
+00054330: 6520 3d20 2043 6f6c 756d 6e4d 6170 7065  e =  ColumnMappe
+00054340: 7228 636f 6c75 6d6e 5f6e 616d 653d 636f  r(column_name=co
+00054350: 6c75 6d6e 5f6e 616d 652c 636f 6c75 6d6e  lumn_name,column
+00054360: 5f74 7970 653d 2773 686f 7274 6e61 6d65  _type='shortname
+00054370: 272c 6669 656c 645f 7368 6f72 746e 616d  ',field_shortnam
+00054380: 653d 4e6f 6e65 290d 0a0d 0a0d 0a20 2020  e=None)......   
+00054390: 2020 2020 2065 6c69 6620 6d61 7070 696e       elif mappin
+000543a0: 675f 7479 7065 203d 3d27 636f 6c75 6d6e  g_type =='column
+000543b0: 7320 746f 2066 6965 6c64 7327 3a0d 0a20  s to fields':.. 
+000543c0: 2020 2020 2020 2020 2020 2069 6620 6469             if di
+000543d0: 6d65 6e73 696f 6e5f 696e 6465 7820 3d3d  mension_index ==
+000543e0: 2031 313a 0d0a 2020 2020 2020 2020 2020   11:..          
+000543f0: 2020 2020 2020 7261 6973 6520 6d70 6578        raise mpex
+00054400: 2e4c 6f61 6465 7253 6574 7570 4572 726f  .LoaderSetupErro
+00054410: 7228 2743 616e 6e6f 7420 6d61 7020 6669  r('Cannot map fi
+00054420: 656c 6473 2066 6f72 2074 6865 2074 696d  elds for the tim
+00054430: 6520 6469 6d65 6e73 696f 6e27 290d 0a0d  e dimension')...
+00054440: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00054450: 6973 5f73 7472 7563 7475 7265 3a0d 0a20  is_structure:.. 
+00054460: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00054470: 5765 2068 6176 6520 746f 2075 7365 206c  We have to use l
+00054480: 6f67 6963 2074 6f20 6669 6775 7265 206f  ogic to figure o
+00054490: 7574 2c20 6672 6f6d 2074 6865 2073 7472  ut, from the str
+000544a0: 7563 7475 7265 2077 6861 7420 7468 6520  ucture what the 
+000544b0: 636f 7272 6563 7420 6566 6665 6374 6976  correct effectiv
+000544c0: 6520 656c 656d 656e 7420 6973 0d0a 2020  e element is..  
+000544d0: 2020 2020 2020 2020 2020 2020 2020 6566                ef
+000544e0: 6665 6374 6976 655f 656c 656d 656e 7420  fective_element 
+000544f0: 3d20 7365 6c66 2e5f 6765 745f 6566 6665  = self._get_effe
+00054500: 6374 6976 655f 656c 656d 656e 745f 666f  ctive_element_fo
+00054510: 725f 7374 7275 6374 7572 6528 6469 6d65  r_structure(dime
+00054520: 6e73 696f 6e5f 696e 6465 783d 6469 6d65  nsion_index=dime
+00054530: 6e73 696f 6e5f 696e 6465 782c 6566 6665  nsion_index,effe
+00054540: 6374 6976 655f 656c 656d 656e 7473 203d  ctive_elements =
+00054550: 2065 6666 6563 7469 7665 5f65 6c65 6d65   effective_eleme
+00054560: 6e74 7329 0d0a 0d0a 2020 2020 2020 2020  nts)....        
+00054570: 2020 2020 2020 2020 7265 7475 726e 5f76          return_v
+00054580: 616c 7565 203d 2020 5374 7275 6374 7572  alue =  Structur
+00054590: 654d 6170 7065 7228 6669 656c 645f 636f  eMapper(field_co
+000545a0: 6c75 6d6e 3d63 6f6c 756d 6e5f 6e61 6d65  lumn=column_name
+000545b0: 2c66 6965 6c64 5f73 686f 7274 6e61 6d65  ,field_shortname
+000545c0: 3d6c 6973 7428 7365 6c66 2e5f 6d61 7070  =list(self._mapp
+000545d0: 6572 735b 6469 6d65 6e73 696f 6e5f 696e  ers[dimension_in
+000545e0: 6465 785d 2e76 616c 7565 7328 2929 5b30  dex].values())[0
+000545f0: 5d2c 7061 7468 203d 2065 6666 6563 7469  ],path = effecti
+00054600: 7665 5f65 6c65 6d65 6e74 2e70 6174 6829  ve_element.path)
+00054610: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00054620: 656c 6966 2069 735f 7374 7275 6374 7572  elif is_structur
+00054630: 655f 656c 656d 656e 743a 0d0a 0d0a 2020  e_element:....  
+00054640: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00054650: 7275 6374 7572 655f 656c 656d 656e 7420  ructure_element 
+00054660: 3d20 7365 6c66 2e74 6172 6765 742e 7374  = self.target.st
+00054670: 7275 6374 7572 6573 5b64 696d 656e 7369  ructures[dimensi
+00054680: 6f6e 5f69 6e64 6578 5d0d 0a0d 0a20 2020  on_index]....   
+00054690: 2020 2020 2020 2020 2020 2020 2066 6965               fie
+000546a0: 6c64 5f73 686f 7274 6e61 6d65 3d6c 6973  ld_shortname=lis
+000546b0: 7428 7365 6c66 2e5f 6d61 7070 6572 735b  t(self._mappers[
+000546c0: 6469 6d65 6e73 696f 6e5f 696e 6465 785d  dimension_index]
+000546d0: 2e76 616c 7565 7328 2929 5b30 5d0d 0a0d  .values())[0]...
+000546e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000546f0: 2069 6620 7374 7275 6374 7572 655f 656c   if structure_el
+00054700: 656d 656e 742e 6973 5f6c 6561 663a 0d0a  ement.is_leaf:..
+00054710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054720: 2020 2020 7265 7475 726e 5f76 616c 7565      return_value
+00054730: 203d 2043 6f6c 756d 6e4d 6170 7065 7228   = ColumnMapper(
+00054740: 636f 6c75 6d6e 5f6e 616d 653d 636f 6c75  column_name=colu
+00054750: 6d6e 5f6e 616d 652c 636f 6c75 6d6e 5f74  mn_name,column_t
+00054760: 7970 653d 2766 6965 6c64 272c 6669 656c  ype='field',fiel
+00054770: 645f 7368 6f72 746e 616d 653d 6669 656c  d_shortname=fiel
+00054780: 645f 7368 6f72 746e 616d 6529 0d0a 2020  d_shortname)..  
+00054790: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000547a0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000547b0: 2020 2020 2020 2020 2072 6574 7572 6e5f           return_
+000547c0: 7661 6c75 6520 3d20 5374 7275 6374 7572  value = Structur
+000547d0: 654d 6170 7065 7228 6669 656c 645f 636f  eMapper(field_co
+000547e0: 6c75 6d6e 3d63 6f6c 756d 6e5f 6e61 6d65  lumn=column_name
+000547f0: 2c66 6965 6c64 5f73 686f 7274 6e61 6d65  ,field_shortname
+00054800: 3d66 6965 6c64 5f73 686f 7274 6e61 6d65  =field_shortname
+00054810: 2c70 6174 6820 3d20 7374 7275 6374 7572  ,path = structur
+00054820: 655f 656c 656d 656e 742e 7061 7468 290d  e_element.path).
+00054830: 0a0d 0a20 2020 2020 2020 2020 2020 2065  ...            e
+00054840: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00054850: 2020 2020 2020 2354 4f44 4f20 2d65 7874        #TODO -ext
+00054860: 656e 6420 7468 6973 2074 6f20 6d75 6c74  end this to mult
+00054870: 6920 6669 656c 6420 6d75 6c74 6920 636f  i field multi co
+00054880: 6c75 6d6e 2076 6172 6961 6e74 0d0a 2020  lumn variant..  
+00054890: 2020 2020 2020 2020 2020 2020 2020 2363                #c
+000548a0: 6f6c 756d 6e5f 7479 7065 3a20 6f6e 6520  olumn_type: one 
+000548b0: 6f66 2027 7068 7973 6964 272c 2027 7368  of 'physid', 'sh
+000548c0: 6f72 746e 616d 6527 2c20 276c 6f6e 676e  ortname', 'longn
+000548d0: 616d 6527 206f 7220 2766 6965 6c64 270d  ame' or 'field'.
+000548e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000548f0: 2066 6965 6c64 5f73 686f 7274 6e61 6d65   field_shortname
+00054900: 3d6c 6973 7428 7365 6c66 2e5f 6d61 7070  =list(self._mapp
+00054910: 6572 735b 6469 6d65 6e73 696f 6e5f 696e  ers[dimension_in
+00054920: 6465 785d 2e76 616c 7565 7328 2929 5b30  dex].values())[0
+00054930: 5d0d 0a0d 0a20 2020 2020 2020 2020 2020  ]....           
+00054940: 2020 2020 2072 6574 7572 6e5f 7661 6c75       return_valu
+00054950: 6520 3d20 436f 6c75 6d6e 4d61 7070 6572  e = ColumnMapper
+00054960: 2863 6f6c 756d 6e5f 6e61 6d65 3d63 6f6c  (column_name=col
+00054970: 756d 6e5f 6e61 6d65 2c63 6f6c 756d 6e5f  umn_name,column_
+00054980: 7479 7065 3d27 6669 656c 6427 2c66 6965  type='field',fie
+00054990: 6c64 5f73 686f 7274 6e61 6d65 3d66 6965  ld_shortname=fie
+000549a0: 6c64 5f73 686f 7274 6e61 6d65 290d 0a0d  ld_shortname)...
+000549b0: 0a20 2020 2020 2020 2065 6c69 6620 6d61  .        elif ma
+000549c0: 7070 696e 675f 7479 7065 203d 3d27 636f  pping_type =='co
+000549d0: 6c75 6d6e 7320 746f 2073 686f 7274 6e61  lumns to shortna
+000549e0: 6d65 7327 3a0d 0a20 2020 2020 2020 2020  mes':..         
+000549f0: 2020 2072 6574 7572 6e5f 7661 6c75 6520     return_value 
+00054a00: 3d20 7365 6c66 2e5f 6d61 7070 6572 735b  = self._mappers[
+00054a10: 6469 6d65 6e73 696f 6e5f 696e 6465 785d  dimension_index]
+00054a20: 0d0a 2020 2020 2020 2020 656c 6966 206d  ..        elif m
+00054a30: 6170 7069 6e67 5f74 7970 6520 3d3d 2763  apping_type =='c
+00054a40: 6f6c 756d 6e20 746f 2073 686f 7274 6e61  olumn to shortna
+00054a50: 6d65 2074 6f20 7661 6c75 6527 3a0d 0a20  me to value':.. 
+00054a60: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00054a70: 206d 7065 782e 4c6f 6164 6572 5365 7475   mpex.LoaderSetu
+00054a80: 7045 7272 6f72 2827 636f 6c75 6d6e 3a7b  pError('column:{
+00054a90: 7368 6f72 746e 616d 653a 7661 6c75 657d  shortname:value}
+00054aa0: 2073 7479 6c65 206d 6170 7069 6e67 2028   style mapping (
+00054ab0: 692e 652e 2066 6c61 672d 7374 796c 6520  i.e. flag-style 
+00054ac0: 6d61 7070 696e 6729 206e 6f74 2069 6d70  mapping) not imp
+00054ad0: 6c65 6d65 6e74 6564 2079 6574 2729 0d0a  lemented yet')..
+00054ae0: 0d0a 2020 2020 2020 2020 656c 6966 206d  ..        elif m
+00054af0: 6170 7069 6e67 5f74 7970 6520 3d3d 2763  apping_type =='c
+00054b00: 6f6e 7374 616e 7420 6461 7465 273a 0d0a  onstant date':..
+00054b10: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00054b20: 696d 656e 7369 6f6e 5f69 6e64 6578 2021  imension_index !
+00054b30: 3d20 3131 3a0d 0a20 2020 2020 2020 2020  = 11:..         
+00054b40: 2020 2020 2020 2072 6169 7365 206d 7065         raise mpe
+00054b50: 782e 4c6f 6164 6572 5365 7475 7045 7272  x.LoaderSetupErr
+00054b60: 6f72 2827 436f 756c 6420 6e6f 7420 6372  or('Could not cr
+00054b70: 6561 7465 2061 2066 6f63 7573 206c 6f61  eate a focus loa
+00054b80: 6465 7220 666f 7220 6469 6d65 6e73 696f  der for dimensio
+00054b90: 6e20 696e 6465 7820 7b7d 2077 6974 6820  n index {} with 
+00054ba0: 6120 636f 6e73 7461 6e74 2064 6174 652e  a constant date.
+00054bb0: 2059 6f75 2063 616e 206f 6e6c 7920 7365   You can only se
+00054bc0: 7420 6120 636f 6e73 7461 6e74 2064 6174  t a constant dat
+00054bd0: 6120 666f 7420 7468 6520 5469 6d65 2064  a fot the Time d
+00054be0: 696d 656e 7369 6f6e 2028 3131 2927 2e66  imension (11)'.f
+00054bf0: 6f72 6d61 7428 6469 6d65 6e73 696f 6e5f  ormat(dimension_
+00054c00: 696e 6465 7829 290d 0a20 2020 2020 2020  index))..       
+00054c10: 2020 2020 2065 6c73 653a 2020 2020 0d0a       else:    ..
+00054c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00054c30: 7265 7475 726e 5f76 616c 7565 203d 2043  return_value = C
+00054c40: 6f6e 7374 616e 7428 636f 6e73 7461 6e74  onstant(constant
+00054c50: 203d 2073 656c 662e 5f6d 6170 7065 7273   = self._mappers
+00054c60: 5b64 696d 656e 7369 6f6e 5f69 6e64 6578  [dimension_index
+00054c70: 5d29 2023 204a 4154 2032 3032 3130 3330  ]) # JAT 2021030
+00054c80: 3920 2d20 7075 7420 7468 6973 206c 696e  9 - put this lin
+00054c90: 6520 696e 2073 7065 6375 6c61 7469 7665  e in speculative
+00054ca0: 6c79 202d 2069 7420 7368 6f75 6c64 2070  ly - it should p
+00054cb0: 7574 2074 6865 2064 6174 6574 696d 6520  ut the datetime 
+00054cc0: 6f72 2074 7570 6c65 2069 6e74 6f20 7468  or tuple into th
+00054cd0: 6520 436f 6e73 7461 6e74 2e2e 2e0d 0a20  e Constant..... 
+00054ce0: 2020 2020 2020 2065 6c69 6620 6d61 7070         elif mapp
+00054cf0: 696e 675f 7479 7065 2069 7320 4e6f 6e65  ing_type is None
+00054d00: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
+00054d10: 4e6f 206d 6170 7069 6e67 2077 6173 2073  No mapping was s
+00054d20: 7570 706c 6965 640d 0a20 2020 2020 2020  upplied..       
+00054d30: 2020 2020 2023 5468 6973 2c20 7468 6973       #This, this
+00054d40: 2068 6164 2062 6574 7465 7220 6265 2061   had better be a
+00054d50: 2053 7472 7563 7475 7265 2077 6974 6820   Structure with 
+00054d60: 6120 7369 6e67 6c65 2065 6666 6563 7469  a single effecti
+00054d70: 7665 2065 6c65 6d65 6e74 206f 7220 7369  ve element or si
+00054d80: 6e67 6c65 206c 6561 6620 5374 7275 6374  ngle leaf Struct
+00054d90: 7572 6545 6c65 6d65 6e74 0d0a 2020 2020  ureElement..    
+00054da0: 2020 2020 2020 2020 2354 6865 6e20 7765          #Then we
+00054db0: 2063 616e 2063 7265 6174 6520 6120 7369   can create a si
+00054dc0: 6e67 6c65 2045 6c65 6d65 6e74 2074 6f20  ngle Element to 
+00054dd0: 696e 7365 7274 2069 6e74 6f0d 0a20 2020  insert into..   
+00054de0: 2020 2020 2020 2020 2069 6620 6973 5f73           if is_s
+00054df0: 7472 7563 7475 7265 3a0d 0a20 2020 2020  tructure:..     
+00054e00: 2020 2020 2020 2020 2020 2065 6666 6563             effec
+00054e10: 7469 7665 5f65 6c65 6d65 6e74 203d 2073  tive_element = s
+00054e20: 656c 662e 5f67 6574 5f65 6666 6563 7469  elf._get_effecti
+00054e30: 7665 5f65 6c65 6d65 6e74 5f66 6f72 5f73  ve_element_for_s
+00054e40: 7472 7563 7475 7265 2864 696d 656e 7369  tructure(dimensi
+00054e50: 6f6e 5f69 6e64 6578 3d64 696d 656e 7369  on_index=dimensi
+00054e60: 6f6e 5f69 6e64 6578 2c65 6666 6563 7469  on_index,effecti
+00054e70: 7665 5f65 6c65 6d65 6e74 7320 3d20 6566  ve_elements = ef
+00054e80: 6665 6374 6976 655f 656c 656d 656e 7473  fective_elements
+00054e90: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00054ea0: 2020 2069 6620 6e6f 7420 6566 6665 6374     if not effect
+00054eb0: 6976 655f 656c 656d 656e 742e 6973 5f6c  ive_element.is_l
+00054ec0: 6561 663a 0d0a 2020 2020 2020 2020 2020  eaf:..          
+00054ed0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00054ee0: 6d70 6578 2e4c 6f61 6465 7253 6574 7570  mpex.LoaderSetup
+00054ef0: 4572 726f 7228 2743 6f75 6c64 206e 6f74  Error('Could not
+00054f00: 2063 7265 6174 6520 6120 666f 6375 7320   create a focus 
+00054f10: 6c6f 6164 6572 2066 6f72 2064 696d 656e  loader for dimen
+00054f20: 7369 6f6e 2069 6e64 6578 207b 7d20 7769  sion index {} wi
+00054f30: 7468 6f75 7420 6120 7375 7070 6c69 6564  thout a supplied
+00054f40: 206d 6170 7069 6e67 2c20 6265 6361 7573   mapping, becaus
+00054f50: 6520 7468 6520 5374 7275 6374 7572 6545  e the StructureE
+00054f60: 6c65 6d65 6e74 207b 7d20 696e 2074 6865  lement {} in the
+00054f70: 2072 656c 6576 616e 7420 466f 6375 7320   relevant Focus 
+00054f80: 7761 7320 6e6f 7420 6120 6c65 6166 2065  was not a leaf e
+00054f90: 6c65 6d65 6e74 272e 666f 726d 6174 2864  lement'.format(d
+00054fa0: 696d 656e 7369 6f6e 5f69 6e64 6578 2c65  imension_index,e
+00054fb0: 6666 6563 7469 7665 5f65 6c65 6d65 6e74  ffective_element
+00054fc0: 2e70 6174 6829 290d 0a0d 0a20 2020 2020  .path))....     
+00054fd0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00054fe0: 6e5f 7661 6c75 6520 3d20 436f 6e73 7461  n_value = Consta
+00054ff0: 6e74 2863 6f6e 7374 616e 7420 3d20 6566  nt(constant = ef
+00055000: 6665 6374 6976 655f 656c 656d 656e 742e  fective_element.
+00055010: 7068 7973 6964 290d 0a20 2020 2020 2020  physid)..       
+00055020: 2020 2020 2065 6c69 6620 6973 5f73 7472       elif is_str
+00055030: 7563 7475 7265 5f65 6c65 6d65 6e74 3a0d  ucture_element:.
+00055040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00055050: 2073 7472 7563 7475 7265 5f65 6c65 6d65   structure_eleme
+00055060: 6e74 203d 2073 656c 662e 7461 7267 6574  nt = self.target
+00055070: 2e73 7472 7563 7475 7265 735b 6469 6d65  .structures[dime
+00055080: 6e73 696f 6e5f 696e 6465 785d 0d0a 0d0a  nsion_index]....
+00055090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000550a0: 6966 206e 6f74 2073 7472 7563 7475 7265  if not structure
+000550b0: 5f65 6c65 6d65 6e74 2e69 735f 6c65 6166  _element.is_leaf
+000550c0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000550d0: 2020 2020 2020 2072 6169 7365 206d 7065         raise mpe
+000550e0: 782e 4c6f 6164 6572 5365 7475 7045 7272  x.LoaderSetupErr
+000550f0: 6f72 2827 436f 756c 6420 6e6f 7420 6372  or('Could not cr
+00055100: 6561 7465 2061 2066 6f63 7573 206c 6f61  eate a focus loa
+00055110: 6465 7220 666f 7220 6469 6d65 6e73 696f  der for dimensio
+00055120: 6e20 696e 6465 7820 7b7d 2077 6974 686f  n index {} witho
+00055130: 7574 2061 2073 7570 706c 6965 6420 6d61  ut a supplied ma
+00055140: 7070 696e 672c 2062 6563 6175 7365 2074  pping, because t
+00055150: 6865 2053 7472 7563 7475 7265 456c 656d  he StructureElem
+00055160: 656e 7420 7b7d 2069 6e20 7468 6520 7265  ent {} in the re
+00055170: 6c65 7661 6e74 2077 6173 206e 6f74 2061  levant was not a
+00055180: 206c 6561 6620 656c 656d 656e 7427 2e66   leaf element'.f
+00055190: 6f72 6d61 7428 6469 6d65 6e73 696f 6e5f  ormat(dimension_
+000551a0: 696e 6465 782c 6566 6665 6374 6976 655f  index,effective_
+000551b0: 656c 656d 656e 742e 7061 7468 2929 0d0a  element.path))..
+000551c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000551d0: 2020 7265 7475 726e 5f76 616c 7565 203d    return_value =
+000551e0: 2043 6f6e 7374 616e 7428 636f 6e73 7461   Constant(consta
+000551f0: 6e74 203d 2073 7472 7563 7475 7265 5f65  nt = structure_e
+00055200: 6c65 6d65 6e74 2e70 6879 7369 6429 0d0a  lement.physid)..
+00055210: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00055220: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00055230: 2020 2072 6169 7365 206d 7065 782e 4c6f     raise mpex.Lo
+00055240: 6164 6572 5365 7475 7045 7272 6f72 2827  aderSetupError('
+00055250: 436f 756c 6420 6e6f 7420 6372 6561 7465  Could not create
+00055260: 2061 2066 6f63 7573 206c 6f61 6465 7220   a focus loader 
+00055270: 666f 7220 6469 6d65 6e73 696f 6e20 696e  for dimension in
+00055280: 6465 7820 7b7d 2077 6974 686f 7574 2061  dex {} without a
+00055290: 2073 7570 706c 6965 6420 6d61 7070 696e   supplied mappin
+000552a0: 672c 2062 6563 6175 7365 2066 6f75 6e64  g, because found
+000552b0: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
+000552c0: 7420 696e 2074 6865 2072 656c 6576 616e  t in the relevan
+000552d0: 7420 7761 7320 6f66 2074 7970 6520 7b7d  t was of type {}
+000552e0: 2027 2e66 6f72 6d61 7428 6469 6d65 6e73   '.format(dimens
+000552f0: 696f 6e5f 696e 6465 782c 7265 7072 2865  ion_index,repr(e
+00055300: 6666 6563 7469 7665 5f65 6c65 6d65 6e74  ffective_element
+00055310: 2929 290d 0a0d 0a20 2020 2020 2020 2065  )))....        e
+00055320: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00055330: 2020 7261 6973 6520 6d70 6578 2e4c 6f61    raise mpex.Loa
+00055340: 6465 7253 6574 7570 4572 726f 7228 2747  derSetupError('G
+00055350: 6f74 206c 6f73 7420 6465 6369 6469 6e67  ot lost deciding
+00055360: 2054 6162 6c65 4d61 7070 6572 2074 7970   TableMapper typ
+00055370: 6520 666f 7220 6469 6d65 6e73 696f 6e20  e for dimension 
+00055380: 696e 6465 7820 7b7d 2066 6f72 2073 7472  index {} for str
+00055390: 7563 7475 7265 2064 6566 696e 6974 696f  ucture definitio
+000553a0: 6e20 7b7d 2e20 496e 7465 726e 616c 6c79  n {}. Internally
+000553b0: 2c20 6566 6665 6374 6976 655f 656c 656d  , effective_elem
+000553c0: 656e 7473 203d 207b 7d2c 206d 6170 7069  ents = {}, mappi
+000553d0: 6e67 5f74 7970 6520 3d20 7b7d 2c20 636f  ng_type = {}, co
+000553e0: 6c75 6d6e 5f6e 616d 6573 203d 207b 7d27  lumn_names = {}'
+000553f0: 2e66 6f72 6d61 7428 6469 6d65 6e73 696f  .format(dimensio
+00055400: 6e5f 696e 6465 782c 2072 6570 7228 7365  n_index, repr(se
+00055410: 6c66 2e74 6172 6765 742e 7374 7275 6374  lf.target.struct
+00055420: 7572 6573 5b64 696d 656e 7369 6f6e 5f69  ures[dimension_i
+00055430: 6e64 6578 5d29 2c20 7265 7072 2865 6666  ndex]), repr(eff
+00055440: 6563 7469 7665 5f65 6c65 6d65 6e74 7329  ective_elements)
+00055450: 2c20 6d61 7070 696e 675f 7479 7065 2c72  , mapping_type,r
+00055460: 6570 7228 636f 6c75 6d6e 5f6e 616d 6573  epr(column_names
+00055470: 2929 290d 0a0d 0a0d 0a20 2020 2020 2020  )))......       
+00055480: 2069 6620 6469 6d65 6e73 696f 6e5f 696e   if dimension_in
+00055490: 6465 7820 3d3d 2031 313a 0d0a 2020 2020  dex == 11:..    
+000554a0: 2020 2020 2020 2020 2354 696d 6520 6973          #Time is
+000554b0: 2068 616e 646c 6564 2064 6966 6665 7265   handled differe
+000554c0: 6e74 6c79 2c20 6173 2069 7420 6e65 6564  ntly, as it need
+000554d0: 7320 746f 2072 6574 7572 6e20 6569 7468  s to return eith
+000554e0: 6572 2061 2043 6f6c 756d 6e4d 6170 7065  er a ColumnMappe
+000554f0: 7220 616e 6420 616e 2045 6d70 6f77 6572  r and an Empower
+00055500: 2074 696d 6520 7065 7269 6f64 0d0a 2020   time period..  
+00055510: 2020 2020 2020 2020 2020 236f 7220 6120            #or a 
+00055520: 636f 6e73 7461 6e74 2061 6e64 2020 616e  constant and  an
+00055530: 2045 6d70 6f77 6572 2074 696d 6520 7065   Empower time pe
+00055540: 7269 6f64 0d0a 0d0a 2020 2020 2020 2020  riod....        
+00055550: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00055560: 6528 7265 7475 726e 5f76 616c 7565 2c43  e(return_value,C
+00055570: 6f6e 7374 616e 7429 3a0d 0a20 2020 2020  onstant):..     
+00055580: 2020 2020 2020 2020 2020 2066 6f75 6e64             found
+00055590: 5f65 6c65 6d65 6e74 203d 204e 6f6e 650d  _element = None.
+000555a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000555b0: 2066 6f75 6e64 5f64 6174 6520 2020 203d   found_date    =
+000555c0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+000555d0: 2020 2020 2020 2066 6f75 6e64 5f65 6d70         found_emp
+000555e0: 6f77 6572 5f64 6174 655f 636f 6e73 7461  ower_date_consta
+000555f0: 6e74 203d 204e 6f6e 650d 0a0d 0a20 2020  nt = None....   
+00055600: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00055610: 6973 696e 7374 616e 6365 2872 6574 7572  isinstance(retur
+00055620: 6e5f 7661 6c75 652e 636f 6e73 7461 6e74  n_value.constant
+00055630: 2c73 7472 293a 0d0a 2020 2020 2020 2020  ,str):..        
+00055640: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00055650: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00055660: 2020 2020 2020 2020 2020 666f 756e 645f            found_
+00055670: 656c 656d 656e 7420 3d20 7365 6c66 2e73  element = self.s
+00055680: 6974 652e 6469 6d65 6e73 696f 6e73 5b31  ite.dimensions[1
+00055690: 315d 2e65 6c65 6d65 6e74 735b 7265 7475  1].elements[retu
+000556a0: 726e 5f76 616c 7565 2e63 6f6e 7374 616e  rn_value.constan
+000556b0: 745d 0d0a 2020 2020 2020 2020 2020 2020  t]..            
+000556c0: 2020 2020 2020 2020 6578 6365 7074 204b          except K
+000556d0: 6579 4572 726f 723a 0d0a 2020 2020 2020  eyError:..      
+000556e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000556f0: 2020 2363 6f75 6c64 6e27 7420 6669 6e64    #couldn't find
+00055700: 2061 6e20 656c 656d 656e 7420 2d20 7065   an element - pe
+00055710: 7268 6170 7320 7468 6973 2069 7320 6120  rhaps this is a 
+00055720: 6461 7465 2073 7472 696e 670d 0a0d 0a20  date string.... 
+00055730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055740: 2020 2020 2020 2072 6169 7365 206d 7065         raise mpe
+00055750: 782e 4c6f 6164 6572 5365 7475 7045 7272  x.LoaderSetupErr
+00055760: 6f72 2827 4e6f 7420 496d 706c 656d 656e  or('Not Implemen
+00055770: 7465 642e 2054 696d 6520 6d61 7070 696e  ted. Time mappin
+00055780: 6720 6672 6f6d 2061 2073 7472 696e 6720  g from a string 
+00055790: 7b7d 2069 7320 6e6f 7420 7965 7420 696d  {} is not yet im
+000557a0: 706c 656d 656e 7465 6420 756e 6c65 7373  plemented unless
+000557b0: 2074 6861 7420 7374 7269 6e67 2069 7320   that string is 
+000557c0: 6120 7661 6c69 6420 7368 6f72 746e 616d  a valid shortnam
+000557d0: 6520 6f66 2061 2074 696d 6520 656c 656d  e of a time elem
+000557e0: 656e 7427 2e66 6f72 6d61 7428 7265 7475  ent'.format(retu
+000557f0: 726e 5f76 616c 7565 2e63 6f6e 7374 616e  rn_value.constan
+00055800: 7429 290d 0a0d 0a20 2020 2020 2020 2020  t))....         
+00055810: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00055820: 616e 6365 2872 6574 7572 6e5f 7661 6c75  ance(return_valu
+00055830: 652e 636f 6e73 7461 6e74 2c64 6174 6574  e.constant,datet
+00055840: 696d 652e 6461 7465 7469 6d65 293a 0d0a  ime.datetime):..
+00055850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055860: 2020 2020 666f 756e 645f 6461 7465 203d      found_date =
+00055870: 2072 6574 7572 6e5f 7661 6c75 652e 636f   return_value.co
+00055880: 6e73 7461 6e74 0d0a 0d0a 2020 2020 2020  nstant....      
+00055890: 2020 2020 2020 2020 2020 656c 6966 2069            elif i
+000558a0: 7369 6e73 7461 6e63 6528 7265 7475 726e  sinstance(return
+000558b0: 5f76 616c 7565 2e63 6f6e 7374 616e 742c  _value.constant,
+000558c0: 696e 7429 3a0d 0a20 2020 2020 2020 2020  int):..         
+000558d0: 2020 2020 2020 2020 2020 2023 436f 6e73             #Cons
+000558e0: 7461 6e74 2063 6f75 6c64 2062 6520 616e  tant could be an
+000558f0: 2045 6d70 6f77 6572 2070 6879 7369 6361   Empower physica
+00055900: 6c20 6964 0d0a 2020 2020 2020 2020 2020  l id..          
+00055910: 2020 2020 2020 2020 2020 666f 7220 656c            for el
+00055920: 656d 656e 7420 696e 2073 656c 662e 7369  ement in self.si
+00055930: 7465 2e64 696d 656e 7369 6f6e 735b 3131  te.dimensions[11
+00055940: 5d2e 656c 656d 656e 7473 2e76 616c 7565  ].elements.value
+00055950: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
+00055960: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00055970: 2065 6c65 6d65 6e74 2e70 6879 7369 6420   element.physid 
+00055980: 3d3d 2072 6574 7572 6e5f 7661 6c75 652e  == return_value.
+00055990: 636f 6e73 7461 6e74 3a0d 0a20 2020 2020  constant:..     
+000559a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000559b0: 2020 2020 2020 2066 6f75 6e64 5f65 6c65         found_ele
+000559c0: 6d65 6e74 203d 2065 6c65 6d65 6e74 0d0a  ment = element..
 000559d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000559e0: 2020 2020 6966 2066 6f75 6e64 5f65 6c65      if found_ele
-000559f0: 6d65 6e74 2069 7320 4e6f 6e65 3a0d 0a20  ment is None:.. 
+000559e0: 2020 2020 2020 2020 2020 2020 2354 4f44              #TOD
+000559f0: 4f20 6861 6e64 6c65 0d0a 0d0a 2020 2020  O handle....    
 00055a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055a10: 2020 2020 2020 2023 436f 6e73 7461 6e74         #Constant
-00055a20: 2063 6f75 6c64 2062 6520 6120 7965 6172   could be a year
-00055a30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00055a40: 2020 2020 2020 2020 2020 666f 7220 656c            for el
-00055a50: 656d 656e 7420 696e 2073 656c 662e 7369  ement in self.si
-00055a60: 7465 2e64 696d 656e 7369 6f6e 735b 3131  te.dimensions[11
-00055a70: 5d2e 656c 656d 656e 7473 2e76 616c 7565  ].elements.value
-00055a80: 7328 293a 0d0a 2020 2020 2020 2020 2020  s():..          
-00055a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055aa0: 2020 6966 2065 6c65 6d65 6e74 2e5f 7374    if element._st
-00055ab0: 6172 745f 6461 7465 2020 3d3d 2073 7472  art_date  == str
-00055ac0: 2872 6574 7572 6e5f 7661 6c75 652e 636f  (return_value.co
-00055ad0: 6e73 7461 6e74 2920 616e 6420 656c 656d  nstant) and elem
-00055ae0: 656e 742e 696e 7465 7276 616c 203d 3d20  ent.interval == 
-00055af0: 2759 6561 7227 2061 6e64 2065 6c65 6d65  'Year' and eleme
-00055b00: 6e74 2e69 6e74 6572 7661 6c5f 616d 6f75  nt.interval_amou
-00055b10: 6e74 203d 3d20 3120 616e 6420 656c 656d  nt == 1 and elem
-00055b20: 656e 742e 6f66 6673 6574 2069 7320 4e6f  ent.offset is No
-00055b30: 6e65 2061 6e64 2065 6c65 6d65 6e74 2e67  ne and element.g
-00055b40: 726f 7570 5f6f 6e6c 7920 6973 204e 6f6e  roup_only is Non
-00055b50: 6520 3a0d 0a20 2020 2020 2020 2020 2020  e :..           
-00055b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055b70: 2020 2020 2066 6f75 6e64 5f65 6c65 6d65       found_eleme
-00055b80: 6e74 203d 2065 6c65 6d65 6e74 0d0a 0d0a  nt = element....
+00055a10: 6966 2066 6f75 6e64 5f65 6c65 6d65 6e74  if found_element
+00055a20: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00055a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055a40: 2020 2023 436f 6e73 7461 6e74 2063 6f75     #Constant cou
+00055a50: 6c64 2062 6520 6120 7965 6172 0d0a 2020  ld be a year..  
+00055a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055a70: 2020 2020 2020 666f 7220 656c 656d 656e        for elemen
+00055a80: 7420 696e 2073 656c 662e 7369 7465 2e64  t in self.site.d
+00055a90: 696d 656e 7369 6f6e 735b 3131 5d2e 656c  imensions[11].el
+00055aa0: 656d 656e 7473 2e76 616c 7565 7328 293a  ements.values():
+00055ab0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00055ac0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00055ad0: 2065 6c65 6d65 6e74 2e5f 7374 6172 745f   element._start_
+00055ae0: 6461 7465 2020 3d3d 2073 7472 2872 6574  date  == str(ret
+00055af0: 7572 6e5f 7661 6c75 652e 636f 6e73 7461  urn_value.consta
+00055b00: 6e74 2920 616e 6420 656c 656d 656e 742e  nt) and element.
+00055b10: 696e 7465 7276 616c 203d 3d20 2759 6561  interval == 'Yea
+00055b20: 7227 2061 6e64 2065 6c65 6d65 6e74 2e69  r' and element.i
+00055b30: 6e74 6572 7661 6c5f 616d 6f75 6e74 203d  nterval_amount =
+00055b40: 3d20 3120 616e 6420 656c 656d 656e 742e  = 1 and element.
+00055b50: 6f66 6673 6574 2069 7320 4e6f 6e65 2061  offset is None a
+00055b60: 6e64 2065 6c65 6d65 6e74 2e67 726f 7570  nd element.group
+00055b70: 5f6f 6e6c 7920 6973 204e 6f6e 6520 3a0d  _only is None :.
+00055b80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00055b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055ba0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
-00055bb0: 7265 7475 726e 5f76 616c 7565 2e63 6f6e  return_value.con
-00055bc0: 7374 616e 742c 456c 656d 656e 7429 3a0d  stant,Element):.
-00055bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00055be0: 2020 2020 2066 6f75 6e64 5f65 6c65 6d65       found_eleme
-00055bf0: 6e74 203d 2072 6574 7572 6e5f 7661 6c75  nt = return_valu
-00055c00: 652e 636f 6e73 7461 6e74 0d0a 0d0a 2020  e.constant....  
-00055c10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00055c20: 2066 6f75 6e64 5f64 6174 6520 6973 206e   found_date is n
-00055c30: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-00055c40: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00055c50: 7475 726e 2043 6f6e 7374 616e 7428 666f  turn Constant(fo
-00055c60: 756e 645f 6461 7465 292c 2066 6f75 6e64  und_date), found
-00055c70: 5f65 6d70 6f77 6572 5f64 6174 655f 636f  _empower_date_co
-00055c80: 6e73 7461 6e74 0d0a 0d0a 2020 2020 2020  nstant....      
-00055c90: 2020 2020 2020 2020 2020 6966 2066 6f75            if fou
-00055ca0: 6e64 5f65 6c65 6d65 6e74 2069 7320 6e6f  nd_element is no
-00055cb0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00055cc0: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00055cd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00055ce0: 2020 2020 2020 2020 2020 2061 7373 6572             asser
-00055cf0: 7420 666f 756e 645f 656c 656d 656e 742e  t found_element.
-00055d00: 6772 6f75 705f 6f6e 6c79 2069 7320 4e6f  group_only is No
-00055d10: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-00055d20: 2020 2020 2020 2020 2020 2020 6173 7365              asse
-00055d30: 7274 2066 6f75 6e64 5f65 6c65 6d65 6e74  rt found_element
-00055d40: 2e69 6e74 6572 7661 6c5f 616d 6f75 6e74  .interval_amount
-00055d50: 203d 3d20 310d 0a20 2020 2020 2020 2020   == 1..         
-00055d60: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00055d70: 7373 6572 7420 666f 756e 645f 656c 656d  ssert found_elem
-00055d80: 656e 742e 696e 7465 7276 616c 203d 3d20  ent.interval == 
-00055d90: 666f 756e 645f 656c 656d 656e 742e 7265  found_element.re
-00055da0: 736f 6c75 7469 6f6e 0d0a 2020 2020 2020  solution..      
-00055db0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00055dc0: 6365 7074 2041 7373 6572 7469 6f6e 4572  cept AssertionEr
-00055dd0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-00055de0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00055df0: 672e 6572 726f 7228 2754 696d 6545 6c65  g.error('TimeEle
-00055e00: 6d65 6e74 2066 6f75 6e64 2077 6974 6820  ment found with 
-00055e10: 696e 636f 7272 6563 7420 6669 656c 6473  incorrect fields
-00055e20: 2066 6f72 2054 696d 6520 4d61 7070 696e   for Time Mappin
-00055e30: 6720 7368 6f72 746e 616d 653a 7b7d 2c20  g shortname:{}, 
-00055e40: 6669 656c 6473 7b7d 272e 666f 726d 6174  fields{}'.format
-00055e50: 2866 6f75 6e64 5f65 6c65 6d65 6e74 2e73  (found_element.s
-00055e60: 686f 7274 6e61 6d65 2c66 6f75 6e64 5f65  hortname,found_e
-00055e70: 6c65 6d65 6e74 2e66 6965 6c64 7329 290d  lement.fields)).
-00055e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00055e90: 2020 2020 2020 2020 2072 6169 7365 0d0a           raise..
-00055ea0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00055eb0: 2020 2020 2020 6966 2066 6f75 6e64 5f65        if found_e
-00055ec0: 6c65 6d65 6e74 2e5f 7374 6172 745f 6461  lement._start_da
-00055ed0: 7465 2069 7320 4e6f 6e65 2061 6e64 2066  te is None and f
-00055ee0: 6f75 6e64 5f65 6c65 6d65 6e74 2e6f 6666  ound_element.off
-00055ef0: 7365 7420 6973 206e 6f74 204e 6f6e 653a  set is not None:
-00055f00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00055f10: 2020 2020 2020 2020 2020 2357 6520 6861            #We ha
-00055f20: 7665 2061 2066 6f75 6e64 2061 2043 7572  ve a found a Cur
-00055f30: 7265 6e74 204d 6f6e 7468 206f 7220 4375  rent Month or Cu
-00055f40: 7272 656e 7420 5965 6172 2065 6c65 6d65  rrent Year eleme
-00055f50: 6e74 2061 6e64 2073 6f20 6f6e 2e0d 0a20  nt and so on... 
-00055f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055f70: 2020 2020 2020 2069 6e74 6572 7661 6c20         interval 
-00055f80: 3d20 666f 756e 645f 656c 656d 656e 742e  = found_element.
-00055f90: 696e 7465 7276 616c 0d0a 2020 2020 2020  interval..      
-00055fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00055fb0: 2020 6f66 6673 6574 2020 203d 2066 6f75    offset   = fou
-00055fc0: 6e64 5f65 6c65 6d65 6e74 2e6f 6666 7365  nd_element.offse
-00055fd0: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-00055fe0: 2020 2020 2020 2020 2020 2023 4765 7420             #Get 
-00055ff0: 7468 6520 6461 7461 2066 6f72 2074 6865  the data for the
-00056000: 2043 7572 7265 6e74 204d 6f6e 7468 2066   Current Month f
-00056010: 6f72 2074 6865 2069 6e74 6572 7661 6c2c  or the interval,
-00056020: 2061 6e64 206d 6f65 7620 6279 2074 6865   and moev by the
-00056030: 206f 6666 7365 740d 0a20 2020 2020 2020   offset..       
-00056040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056050: 2023 544f 444f 0d0a 2020 2020 2020 2020   #TODO..        
-00056060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056070: 7261 6973 6520 6d70 6578 2e4c 6f61 6465  raise mpex.Loade
-00056080: 7253 6574 7570 4572 726f 7228 274e 6f74  rSetupError('Not
-00056090: 2049 6d70 6c65 6d65 6e74 6564 2e20 5469   Implemented. Ti
-000560a0: 6d65 206d 6170 7069 6e67 2066 726f 6d20  me mapping from 
-000560b0: 6120 6375 7272 656e 7420 6d6f 6e74 6820  a current month 
-000560c0: 6973 206e 6f74 2079 6574 2069 6d70 6c65  is not yet imple
-000560d0: 6d65 6e74 6564 2729 0d0a 2020 2020 2020  mented')..      
-000560e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000560f0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00056100: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00056110: 7572 6e20 436f 6e73 7461 6e74 2866 6f75  urn Constant(fou
-00056120: 6e64 5f65 6c65 6d65 6e74 2e64 6174 6529  nd_element.date)
-00056130: 2c66 6f75 6e64 5f65 6c65 6d65 6e74 2e65  ,found_element.e
-00056140: 6d70 6f77 6572 5f70 6572 696f 645f 6e75  mpower_period_nu
-00056150: 6d62 6572 0d0a 0d0a 2020 2020 2020 2020  mber....        
-00056160: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-00056170: 6e63 6528 7265 7475 726e 5f76 616c 7565  nce(return_value
-00056180: 2c43 6f6c 756d 6e4d 6170 7065 7229 3a0d  ,ColumnMapper):.
-00056190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000561a0: 200d 0a20 2020 2020 2020 2020 2020 2020   ..             
-000561b0: 2020 2023 2044 6566 6175 6c74 2069 7320     # Default is 
-000561c0: 6d6f 6e74 680d 0a20 2020 2020 2020 2020  month..         
-000561d0: 2020 2020 2020 2065 6d70 6f77 6572 5f74         empower_t
-000561e0: 696d 655f 636f 6e73 7461 6e74 203d 206c  ime_constant = l
-000561f0: 6c75 2e45 4d50 4f57 4552 5f4d 4f4e 5448  lu.EMPOWER_MONTH
-00056200: 5f43 4f4e 5354 414e 540d 0a20 2020 2020  _CONSTANT..     
-00056210: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
-00056220: 2020 2020 2020 2020 2020 2020 2023 2054               # T
-00056230: 7279 2074 6f20 6765 7420 7468 6520 7469  ry to get the ti
-00056240: 6d65 2070 6572 696f 6420 6672 6f6d 2074  me period from t
-00056250: 6865 2054 696d 6520 656c 656d 656e 7420  he Time element 
-00056260: 696e 2074 6865 2066 6f63 7573 0d0a 2020  in the focus..  
-00056270: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00056280: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00056290: 2020 2020 2020 2020 2347 6574 2061 6e20          #Get an 
-000562a0: 656c 656d 656e 7420 6672 6f6d 2074 6865  element from the
-000562b0: 2073 7472 7563 7475 7265 202d 2069 7420   structure - it 
-000562c0: 7368 6f75 6c64 2068 6176 6520 616e 2045  should have an E
-000562d0: 6d70 6f77 6572 2064 6174 6520 7479 7065  mpower date type
-000562e0: 2028 7765 656b 2c20 6d6f 6e74 682c 2079   (week, month, y
-000562f0: 6561 7220 6574 632e 2920 616e 6420 7765  ear etc.) and we
-00056300: 2063 616e 2075 7365 2074 6861 7420 0d0a   can use that ..
-00056310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00056320: 2020 2020 656d 706f 7765 725f 7469 6d65      empower_time
-00056330: 5f63 6f6e 7374 616e 7420 3d20 7365 6c66  _constant = self
-00056340: 2e65 6666 6563 7469 7665 5f74 696d 655f  .effective_time_
-00056350: 656c 656d 656e 7473 5b30 5d2e 696e 7465  elements[0].inte
-00056360: 7276 616c 5f69 6e64 6578 0d0a 2020 2020  rval_index..    
-00056370: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-00056380: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
-00056390: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-000563a0: 2020 2020 2020 2020 2320 4a75 7374 2067          # Just g
-000563b0: 6f20 7769 7468 2074 6865 2064 6566 6175  o with the defau
-000563c0: 6c74 2069 6e20 7468 6520 6361 7365 2074  lt in the case t
-000563d0: 6861 7420 7468 6973 2069 7320 6e6f 7420  hat this is not 
-000563e0: 6120 7374 616e 6461 7264 2074 696d 6520  a standard time 
-000563f0: 656c 656d 656e 742c 206f 7220 6966 2074  element, or if t
-00056400: 6865 7265 2077 6572 6520 6e6f 2065 6666  here were no eff
-00056410: 6563 7469 7665 2065 6c65 6d65 6e74 7320  ective elements 
-00056420: 2861 6c74 686f 7567 6820 7765 206d 6179  (although we may
-00056430: 206e 6576 6572 2067 6574 2073 7563 6820   never get such 
-00056440: 6120 7468 696e 6720 696e 2070 7261 6374  a thing in pract
-00056450: 6963 6520 6265 6361 7573 6520 616e 2065  ice because an e
-00056460: 7272 6f72 2077 6f75 6c64 2068 6176 6520  rror would have 
-00056470: 6265 656e 2072 6169 7365 6420 656c 7365  been raised else
-00056480: 7768 6572 6529 0d0a 2020 2020 2020 2020  where)..        
-00056490: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-000564a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000564b0: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-000564c0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-000564d0: 6574 7572 6e5f 7661 6c75 652c 2065 6d70  eturn_value, emp
-000564e0: 6f77 6572 5f74 696d 655f 636f 6e73 7461  ower_time_consta
-000564f0: 6e74 0d0a 2020 2020 2020 2020 2020 2020  nt..            
-00056500: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00056510: 2020 2020 2020 2072 6169 7365 206d 7065         raise mpe
-00056520: 782e 4c6f 6164 6572 5365 7475 7045 7272  x.LoaderSetupErr
-00056530: 6f72 2827 5469 6d65 206d 6170 7069 6e67  or('Time mapping
-00056540: 206d 7573 7420 6265 2073 6574 2075 7020   must be set up 
-00056550: 7769 7468 2061 2076 616c 6964 2065 6c65  with a valid ele
-00056560: 6d65 6e74 2729 0d0a 0d0a 2020 2020 2020  ment')....      
-00056570: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00056580: 2020 2020 2072 6574 7572 6e20 7265 7475       return retu
-00056590: 726e 5f76 616c 7565 0d0a 0d0a 0d0a 2020  rn_value......  
-000565a0: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-000565b0: 2064 6566 2065 6666 6563 7469 7665 5f74   def effective_t
-000565c0: 696d 655f 656c 656d 656e 7473 2873 656c  ime_elements(sel
-000565d0: 6629 3a0d 0a0d 0a20 2020 2020 2020 206e  f):....        n
-000565e0: 6f5f 6d61 7070 696e 6773 5f66 6f72 5f74  o_mappings_for_t
-000565f0: 696d 6520 3d20 7365 6c66 2e5f 6d61 7070  ime = self._mapp
-00056600: 6572 7320 6973 204e 6f6e 6520 6f72 2073  ers is None or s
-00056610: 656c 662e 5f6d 6170 7065 7273 5b31 315d  elf._mappers[11]
-00056620: 2069 7320 4e6f 6e65 0d0a 0d0a 2020 2020   is None....    
-00056630: 2020 2020 6966 2073 656c 662e 7461 7267      if self.targ
-00056640: 6574 2069 7320 4e6f 6e65 3a0d 0a20 2020  et is None:..   
-00056650: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-00056660: 7065 782e 4c6f 6164 6572 5365 7475 7045  pex.LoaderSetupE
-00056670: 7272 6f72 2827 4361 6e6e 6f74 2063 6f6d  rror('Cannot com
-00056680: 7075 7465 2065 6666 6563 7469 7665 2074  pute effective t
-00056690: 696d 6520 656c 656d 656e 7473 2066 6f72  ime elements for
-000566a0: 2061 2046 6f63 7573 4c6f 6164 6572 2077   a FocusLoader w
-000566b0: 6869 6368 2068 6173 206e 6f20 7461 7267  hich has no targ
-000566c0: 6574 2056 6965 7770 6f69 6e74 206f 7220  et Viewpoint or 
-000566d0: 466f 6375 7320 7365 7427 290d 0a0d 0a20  Focus set').... 
-000566e0: 2020 2020 2020 2023 7374 7275 6374 7572         #structur
-000566f0: 6573 5b31 315d 2069 7320 7469 6d65 202d  es[11] is time -
-00056700: 2077 6520 6361 6e74 2720 6765 7420 6566   we cant' get ef
-00056710: 6665 6374 6976 6520 7469 6d65 2065 6c65  fective time ele
-00056720: 6d65 6e74 7320 7769 7468 206e 6f20 7469  ments with no ti
-00056730: 6d65 2073 7472 7563 7475 7265 2073 6574  me structure set
-00056740: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-00056750: 662e 7461 7267 6574 2e73 7472 7563 7475  f.target.structu
-00056760: 7265 735b 3131 5d20 6973 204e 6f6e 653a  res[11] is None:
-00056770: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
-00056780: 6973 6520 6d70 6578 2e4c 6f61 6465 7253  ise mpex.LoaderS
-00056790: 6574 7570 4572 726f 7228 2743 616e 6e6f  etupError('Canno
-000567a0: 7420 636f 6d70 7574 6520 6566 6665 6374  t compute effect
-000567b0: 6976 6520 7469 6d65 2065 6c65 6d65 6e74  ive time element
-000567c0: 7320 666f 7220 6120 466f 6375 734c 6f61  s for a FocusLoa
-000567d0: 6465 7220 7768 6963 6820 6861 7320 6e6f  der which has no
-000567e0: 2054 696d 6520 7374 7275 6374 7572 6520   Time structure 
-000567f0: 282e 7374 7275 6374 7572 6573 5b31 315d  (.structures[11]
-00056800: 2927 290d 0a0d 0a20 2020 2020 2020 2064  )')....        d
-00056810: 696d 656e 7369 6f6e 5f69 6e64 6578 203d  imension_index =
-00056820: 2031 310d 0a20 2020 2020 2020 2065 6666   11..        eff
-00056830: 6563 7469 7665 5f65 6c65 6d65 6e74 732c  ective_elements,
-00056840: 206d 6170 7069 6e67 5f74 7970 652c 636f   mapping_type,co
-00056850: 6c75 6d6e 5f6e 616d 6573 203d 2073 656c  lumn_names = sel
-00056860: 662e 5f67 6574 5f69 6d70 6c69 6564 5f73  f._get_implied_s
-00056870: 686f 7274 636f 6465 5f6c 6973 745f 616e  hortcode_list_an
-00056880: 645f 6d61 7070 696e 675f 7479 7065 2864  d_mapping_type(d
-00056890: 696d 656e 7369 6f6e 5f69 6e64 6578 203d  imension_index =
-000568a0: 2064 696d 656e 7369 6f6e 5f69 6e64 6578   dimension_index
-000568b0: 2c20 6f62 6a65 6374 5f74 6f5f 6368 6563  , object_to_chec
-000568c0: 6b5f 6167 6169 6e73 7420 3d73 656c 662e  k_against =self.
-000568d0: 7461 7267 6574 2e73 7472 7563 7475 7265  target.structure
-000568e0: 735b 6469 6d65 6e73 696f 6e5f 696e 6465  s[dimension_inde
-000568f0: 785d 290d 0a0d 0a20 2020 2020 2020 2069  x])....        i
-00056900: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
-00056910: 662e 7461 7267 6574 2e73 7472 7563 7475  f.target.structu
-00056920: 7265 735b 3131 5d2c 5374 7275 6374 7572  res[11],Structur
-00056930: 6529 2061 6e64 206e 6f5f 6d61 7070 696e  e) and no_mappin
-00056940: 6773 5f66 6f72 5f74 696d 653a 0d0a 2020  gs_for_time:..  
-00056950: 2020 2020 2020 2020 2020 2343 6865 636b            #Check
-00056960: 2074 6861 7420 7468 6572 6520 6973 206f   that there is o
-00056970: 6e6c 7920 6f6e 6520 6869 6572 6172 6368  nly one hierarch
-00056980: 7920 6966 2077 6520 6861 7665 2061 2053  y if we have a S
-00056990: 7472 7563 7475 7265 2061 6e64 206e 6f20  tructure and no 
-000569a0: 6d61 7070 696e 6773 0d0a 2020 2020 2020  mappings..      
-000569b0: 2020 2020 2020 6966 206c 656e 2873 656c        if len(sel
-000569c0: 662e 7461 7267 6574 2e73 7472 7563 7475  f.target.structu
-000569d0: 7265 735b 3131 5d2e 6869 6572 6172 6368  res[11].hierarch
-000569e0: 6965 7329 2021 3d20 313a 0d0a 2020 2020  ies) != 1:..    
-000569f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00056a00: 6520 6d70 6578 2e4c 6f61 6465 7253 6574  e mpex.LoaderSet
-00056a10: 7570 4572 726f 7228 2746 6f63 7573 4c6f  upError('FocusLo
-00056a20: 6164 6572 2077 6974 686f 7574 2061 6e79  ader without any
-00056a30: 206d 6170 7069 6e67 7320 6361 6e6e 6f74   mappings cannot
-00056a40: 2068 616e 646c 6520 5469 6d65 2053 7472   handle Time Str
-00056a50: 7563 7475 7265 7320 7769 7468 2061 6e79  uctures with any
-00056a60: 7468 696e 6720 6f74 6865 7220 7468 616e  thing other than
-00056a70: 2031 2068 6965 7261 7263 6879 2729 0d0a   1 hierarchy')..
-00056a80: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-00056a90: 6e73 7461 6e63 6528 7365 6c66 2e74 6172  nstance(self.tar
-00056aa0: 6765 742e 7374 7275 6374 7572 6573 5b31  get.structures[1
-00056ab0: 315d 2c53 7472 7563 7475 7265 293a 0d0a  1],Structure):..
-00056ac0: 0d0a 2020 2020 2020 2020 2020 2020 7469  ..            ti
-00056ad0: 6d65 5f68 6965 7261 7263 6879 203d 205b  me_hierarchy = [
-00056ae0: 6820 666f 7220 6820 696e 2073 656c 662e  h for h in self.
-00056af0: 7461 7267 6574 2e73 7472 7563 7475 7265  target.structure
-00056b00: 735b 3131 5d2e 6869 6572 6172 6368 6965  s[11].hierarchie
-00056b10: 735d 5b30 5d0d 0a20 2020 2020 2020 2065  s][0]..        e
-00056b20: 6c69 6620 6973 696e 7374 616e 6365 2873  lif isinstance(s
-00056b30: 656c 662e 7461 7267 6574 2e73 7472 7563  elf.target.struc
-00056b40: 7475 7265 735b 3131 5d2c 5374 7275 6374  tures[11],Struct
-00056b50: 7572 6545 6c65 6d65 6e74 293a 0d0a 2020  ureElement):..  
-00056b60: 2020 2020 2020 2020 2020 7469 6d65 5f68            time_h
-00056b70: 6965 7261 7263 6879 203d 2073 656c 662e  ierarchy = self.
-00056b80: 7461 7267 6574 2e73 7472 7563 7475 7265  target.structure
-00056b90: 735b 3131 5d0d 0a0d 0a20 2020 2020 2020  s[11]....       
-00056ba0: 2023 5768 6572 6520 7468 6572 6520 6172   #Where there ar
-00056bb0: 6520 6e6f 206d 6170 7069 6e67 7320 7765  e no mappings we
-00056bc0: 2061 7265 2068 6170 7079 2074 6f20 7573   are happy to us
-00056bd0: 6520 6120 7369 6e67 6c65 2065 6c65 6d65  e a single eleme
-00056be0: 6e74 2069 6620 6f6e 6520 6973 2070 7265  nt if one is pre
-00056bf0: 7365 6e74 2069 6e20 7468 6520 5469 6d65  sent in the Time
-00056c00: 2048 6965 7261 7263 6879 2f53 7472 7563   Hierarchy/Struc
-00056c10: 7475 7265 0d0a 2020 2020 2020 2020 6966  ture..        if
-00056c20: 206e 6f5f 6d61 7070 696e 6773 5f66 6f72   no_mappings_for
-00056c30: 5f74 696d 653a 0d0a 0d0a 2020 2020 2020  _time:....      
-00056c40: 2020 2020 2020 6966 206c 656e 2874 696d        if len(tim
-00056c50: 655f 6869 6572 6172 6368 792e 6368 696c  e_hierarchy.chil
-00056c60: 6472 656e 2920 3d3d 2030 3a0d 0a20 2020  dren) == 0:..   
-00056c70: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00056c80: 7572 6e20 5b74 696d 655f 6869 6572 6172  urn [time_hierar
-00056c90: 6368 795d 0d0a 2020 2020 2020 2020 2020  chy]..          
-00056ca0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-00056cb0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-00056cc0: 7065 782e 4c6f 6164 6572 5365 7475 7045  pex.LoaderSetupE
-00056cd0: 7272 6f72 2827 466f 6375 734c 6f61 6465  rror('FocusLoade
-00056ce0: 7220 7769 7468 6f75 7420 616e 7920 6d61  r without any ma
-00056cf0: 7070 696e 6773 2063 616e 6e6f 7420 6861  ppings cannot ha
-00056d00: 6e64 6c65 2054 696d 6520 5374 7275 6375  ndle Time Strucu
-00056d10: 7265 456c 656d 656e 7473 2077 6974 6820  reElements with 
-00056d20: 616e 7974 6869 6e67 206f 7468 6572 2074  anything other t
-00056d30: 6861 6e20 6120 7369 6e67 6c65 2065 6c65  han a single ele
-00056d40: 6d65 6e74 2729 0d0a 0d0a 2020 2020 2020  ment')....      
-00056d50: 2020 6966 206d 6170 7069 6e67 5f74 7970    if mapping_typ
-00056d60: 6520 3d3d 2027 636f 6e73 7461 6e74 2073  e == 'constant s
-00056d70: 686f 7274 6e61 6d65 273a 0d0a 2020 2020  hortname':..    
-00056d80: 2020 2020 2020 2020 2343 616e 2067 6574          #Can get
-00056d90: 2074 6865 2065 6c65 6d65 6e74 2077 6974   the element wit
-00056da0: 6820 7468 6520 7368 6f72 7463 6f64 6520  h the shortcode 
-00056db0: 616e 6420 7475 726e 2069 7420 696e 746f  and turn it into
-00056dc0: 2061 2053 7472 7563 7475 7265 2065 6c65   a Structure ele
-00056dd0: 6d65 6e74 0d0a 2020 2020 2020 2020 2020  ment..          
-00056de0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00056df0: 2020 2020 2020 2020 6c65 6166 5f65 6c65          leaf_ele
-00056e00: 6d65 6e74 7320 3d20 5b53 7472 7563 7475  ments = [Structu
-00056e10: 7265 456c 656d 656e 7428 656c 656d 656e  reElement(elemen
-00056e20: 743d 7365 6c66 2e73 6974 652e 6469 6d65  t=self.site.dime
-00056e30: 6e73 696f 6e73 5b31 315d 2e65 6c65 6d65  nsions[11].eleme
-00056e40: 6e74 735b 6566 6665 6374 6976 655f 656c  nts[effective_el
-00056e50: 656d 656e 7473 5b30 5d5d 295d 0d0a 2020  ements[0]])]..  
-00056e60: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00056e70: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
-00056e80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00056e90: 2020 7072 696e 7428 2274 696d 655f 6869    print("time_hi
-00056ea0: 6572 6172 6368 7922 290d 0a20 2020 2020  erarchy")..     
-00056eb0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00056ec0: 2874 696d 655f 6869 6572 6172 6368 7929  (time_hierarchy)
-00056ed0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00056ee0: 2020 7072 696e 7428 2265 6666 6563 7469    print("effecti
-00056ef0: 7665 5f65 6c65 6d65 6e74 7322 290d 0a20  ve_elements").. 
-00056f00: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00056f10: 7269 6e74 2865 6666 6563 7469 7665 5f65  rint(effective_e
-00056f20: 6c65 6d65 6e74 7329 2020 2020 2020 2020  lements)        
-00056f30: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
-00056f40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00056f50: 650d 0a20 2020 2020 2020 2020 2020 200d  e..            .
-00056f60: 0a0d 0a20 2020 2020 2020 2065 6c73 653a  ...        else:
-00056f70: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00056f80: 2374 696d 655f 6869 6572 6172 6368 7920  #time_hierarchy 
-00056f90: 3d20 5b68 2066 6f72 2068 2069 6e20 7365  = [h for h in se
-00056fa0: 6c66 2e74 6172 6765 742e 7374 7275 6374  lf.target.struct
-00056fb0: 7572 6573 5b31 315d 2e68 6965 7261 7263  ures[11].hierarc
-00056fc0: 6869 6573 5d5b 305d 0d0a 2020 2020 2020  hies][0]..      
-00056fd0: 2020 2020 2020 6c65 6166 5f65 6c65 6d65        leaf_eleme
-00056fe0: 6e74 7320 3d20 5b6c 2066 6f72 206c 2069  nts = [l for l i
-00056ff0: 6e20 7469 6d65 5f68 6965 7261 7263 6879  n time_hierarchy
-00057000: 2e6c 6561 7665 735d 0d0a 0d0a 2020 2020  .leaves]....    
-00057010: 2020 2020 2323 2343 6865 636b 2074 6865      ###Check the
-00057020: 206c 6561 6620 656c 656d 656e 7473 2062   leaf elements b
-00057030: 656c 6f77 2066 6f72 2063 6f6e 7369 7374  elow for consist
-00057040: 656e 6379 2c20 616e 6420 666f 7220 7661  ency, and for va
-00057050: 6c69 6469 7479 2061 6761 696e 7374 2074  lidity against t
-00057060: 6865 206d 6170 7069 6e67 2c20 6265 666f  he mapping, befo
-00057070: 7265 2072 6574 7572 6e69 6e67 2074 6865  re returning the
-00057080: 6d0d 0a0d 0a20 2020 2020 2020 2023 5261  m....        #Ra
-00057090: 6973 6520 616e 2065 7272 6f72 2069 6620  ise an error if 
-000570a0: 6974 2069 7320 6120 7369 6e67 6c65 2063  it is a single c
-000570b0: 7572 7265 6e74 206d 6f6e 7468 2c20 6265  urrent month, be
-000570c0: 6361 7573 6520 7765 2063 616e 2774 2068  cause we can't h
-000570d0: 616e 646c 6520 7468 6174 2079 6574 0d0a  andle that yet..
-000570e0: 2020 2020 2020 2020 6966 206c 656e 286c          if len(l
-000570f0: 6561 665f 656c 656d 656e 7473 2920 3d3d  eaf_elements) ==
-00057100: 2031 2061 6e64 206c 6561 665f 656c 656d   1 and leaf_elem
-00057110: 656e 7473 5b30 5d2e 5f73 7461 7274 5f64  ents[0]._start_d
-00057120: 6174 6520 6973 204e 6f6e 6520 616e 6420  ate is None and 
-00057130: 6c65 6166 5f65 6c65 6d65 6e74 735b 305d  leaf_elements[0]
-00057140: 2e6f 6666 7365 7420 6973 206e 6f74 204e  .offset is not N
-00057150: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00057160: 2020 2357 6520 6861 7665 2061 2066 6f75    #We have a fou
-00057170: 6e64 2061 2043 7572 7265 6e74 204d 6f6e  nd a Current Mon
-00057180: 7468 206f 7220 4375 7272 656e 7420 5965  th or Current Ye
-00057190: 6172 2065 6c65 6d65 6e74 2061 6e64 2073  ar element and s
-000571a0: 6f20 6f6e 2e0d 0a20 2020 2020 2020 2020  o on...         
-000571b0: 2020 2069 6e74 6572 7661 6c20 3d20 6c65     interval = le
-000571c0: 6166 5f65 6c65 6d65 6e74 735b 305d 2e69  af_elements[0].i
-000571d0: 6e74 6572 7661 6c0d 0a20 2020 2020 2020  nterval..       
-000571e0: 2020 2020 206f 6666 7365 7420 2020 3d20       offset   = 
-000571f0: 6c65 6166 5f65 6c65 6d65 6e74 735b 305d  leaf_elements[0]
-00057200: 2e6f 6666 7365 740d 0a20 2020 2020 2020  .offset..       
-00057210: 2020 2020 2023 4765 7420 7468 6520 6461       #Get the da
-00057220: 7461 2066 6f72 2074 6865 2043 7572 7265  ta for the Curre
-00057230: 6e74 204d 6f6e 7468 2066 6f72 2074 6865  nt Month for the
-00057240: 2069 6e74 6572 7661 6c2c 2061 6e64 206d   interval, and m
-00057250: 6f76 6520 6279 2074 6865 206f 6666 7365  ove by the offse
-00057260: 740d 0a20 2020 2020 2020 2020 2020 2023  t..            #
-00057270: 544f 444f 0d0a 2020 2020 2020 2020 2020  TODO..          
-00057280: 2020 7261 6973 6520 6d70 6578 2e4c 6f61    raise mpex.Loa
-00057290: 6465 7253 6574 7570 4572 726f 7228 274e  derSetupError('N
-000572a0: 6f74 2049 6d70 6c65 6d65 6e74 6564 2e20  ot Implemented. 
-000572b0: 5469 6d65 206d 6170 7069 6e67 2066 726f  Time mapping fro
-000572c0: 6d20 6120 6375 7272 656e 7420 6d6f 6e74  m a current mont
-000572d0: 6820 6973 206e 6f74 2079 6574 2069 6d70  h is not yet imp
-000572e0: 6c65 6d65 6e74 6564 2729 0d0a 0d0a 2020  lemented')....  
-000572f0: 2020 2020 2020 656c 7365 203a 0d0a 2020        else :..  
-00057300: 2020 2020 2020 2020 2020 234f 722c 2063            #Or, c
-00057310: 6865 636b 2074 6861 7420 7468 6520 6c65  heck that the le
-00057320: 6166 2065 6c65 6d65 6e74 7320 6172 6520  af elements are 
-00057330: 6f66 2061 2073 696e 676c 6520 456d 706f  of a single Empo
-00057340: 7765 7220 7469 6d65 2074 7970 6520 2865  wer time type (e
-00057350: 2e67 2e20 616c 6c20 4d4f 4e54 4829 0d0a  .g. all MONTH)..
-00057360: 2020 2020 2020 2020 2020 2020 2341 6e64              #And
-00057370: 2074 6861 7420 7468 6520 656c 656d 656e   that the elemen
-00057380: 7473 2061 7265 2063 6f6e 7469 6775 6f75  ts are contiguou
-00057390: 730d 0a20 2020 2020 2020 2020 2020 2065  s..            e
-000573a0: 6d70 6f77 6572 5f74 696d 655f 7479 7065  mpower_time_type
-000573b0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-000573c0: 2020 2020 2070 7265 7669 6f75 735f 6461       previous_da
-000573d0: 7465 203d 204e 6f6e 650d 0a20 2020 2020  te = None..     
-000573e0: 2020 2020 2020 2070 7265 7669 6f75 735f         previous_
-000573f0: 7365 203d 204e 6f6e 650d 0a0d 0a20 2020  se = None....   
-00057400: 2020 2020 2020 2020 2064 6174 6573 5f74           dates_t
-00057410: 6f5f 6c65 6166 5f65 6c65 6d65 6e74 735f  o_leaf_elements_
-00057420: 6c6b 7020 3d20 7b7d 0d0a 0d0a 2020 2020  lkp = {}....    
-00057430: 2020 2020 2020 2020 666f 7220 7365 2069          for se i
-00057440: 6e20 6c65 6166 5f65 6c65 6d65 6e74 733a  n leaf_elements:
-00057450: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00057460: 2020 2020 2343 6865 636b 2061 6c6c 2066      #Check all f
-00057470: 6965 6c64 7320 6172 6520 706f 7075 6c61  ields are popula
-00057480: 7465 6420 6173 2077 6520 776f 756c 6420  ted as we would 
-00057490: 6578 7065 6374 0d0a 2020 2020 2020 2020  expect..        
-000574a0: 2020 2020 2020 2020 6966 2065 6d70 6f77          if empow
-000574b0: 6572 5f74 696d 655f 7479 7065 2069 7320  er_time_type is 
-000574c0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-000574d0: 2020 2020 2020 2020 2020 2065 6d70 6f77             empow
-000574e0: 6572 5f74 696d 655f 7479 7065 203d 2073  er_time_type = s
-000574f0: 652e 696e 7465 7276 616c 0d0a 0d0a 2020  e.interval....  
-00057500: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00057510: 2065 6d70 6f77 6572 5f74 696d 655f 7479   empower_time_ty
-00057520: 7065 2021 3d20 7365 2e69 6e74 6572 7661  pe != se.interva
-00057530: 6c3a 0d0a 2020 2020 2020 2020 2020 2020  l:..            
-00057540: 2020 2020 2020 2020 7261 6973 6520 6d70          raise mp
-00057550: 6578 2e4c 6f61 6465 7253 6574 7570 4572  ex.LoaderSetupEr
-00057560: 726f 7228 2743 616e 6e6f 7420 6c6f 6164  ror('Cannot load
-00057570: 2069 6e74 6f20 6120 6869 6572 6172 6368   into a hierarch
-00057580: 7920 6f66 2074 696d 6520 656c 656d 656e  y of time elemen
-00057590: 7473 2077 6974 6820 6d6f 7265 2074 6861  ts with more tha
-000575a0: 6e20 6f6e 6520 496e 7465 7276 616c 2074  n one Interval t
-000575b0: 7970 652e 2054 696d 6520 656c 656d 656e  ype. Time elemen
-000575c0: 7420 7b7d 2069 6e20 6869 6572 6172 6368  t {} in hierarch
-000575d0: 7920 7b7d 2077 6974 6820 496e 7465 7276  y {} with Interv
-000575e0: 616c 207b 7d20 6e6f 7420 7361 6d65 2061  al {} not same a
-000575f0: 7320 7072 6576 696f 7573 2049 6e74 6572  s previous Inter
-00057600: 7661 6c20 7b7d 272e 666f 726d 6174 2873  val {}'.format(s
-00057610: 652e 7368 6f72 746e 616d 652c 7469 6d65  e.shortname,time
-00057620: 5f68 6965 7261 7263 6879 2e70 6174 682c  _hierarchy.path,
-00057630: 7365 2e69 6e74 6572 7661 6c2c 656d 706f  se.interval,empo
-00057640: 7765 725f 7469 6d65 5f74 7970 6529 290d  wer_time_type)).
-00057650: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00057660: 2020 2023 4368 6563 6b20 6966 2074 7970     #Check if typ
-00057670: 6520 6f72 2069 6e74 6572 7661 6c20 6973  e or interval is
-00057680: 204e 6f6e 6520 2d20 6966 2073 6f20 7765   None - if so we
-00057690: 2061 7265 2072 756e 6e69 6e67 2074 6865   are running the
-000576a0: 206c 6f6f 7020 666f 7220 7468 6520 6669   loop for the fi
-000576b0: 7273 7420 7469 6d65 0d0a 0d0a 2020 2020  rst time....    
-000576c0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-000576d0: 652e 6772 6f75 705f 6f6e 6c79 2069 7320  e.group_only is 
-000576e0: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-000576f0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00057700: 6169 7365 206d 7065 782e 4c6f 6164 6572  aise mpex.Loader
-00057710: 5365 7475 7045 7272 6f72 2827 4361 6e6e  SetupError('Cann
-00057720: 6f74 206c 6f61 6420 696e 746f 2047 726f  ot load into Gro
-00057730: 7570 2d4f 6e6c 7920 7469 6d65 2065 6c65  up-Only time ele
-00057740: 6d65 6e74 207b 7d20 696e 2068 6965 7261  ment {} in hiera
-00057750: 7263 6879 207b 7d27 2e66 6f72 6d61 7428  rchy {}'.format(
-00057760: 7365 2e73 686f 7274 6e61 6d65 2c74 696d  se.shortname,tim
-00057770: 655f 6869 6572 6172 6368 792e 7061 7468  e_hierarchy.path
-00057780: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
-00057790: 2020 2020 2020 6966 2073 652e 696e 7465        if se.inte
-000577a0: 7276 616c 5f61 6d6f 756e 7420 213d 2031  rval_amount != 1
-000577b0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000577c0: 2020 2020 2020 2072 6169 7365 206d 7065         raise mpe
-000577d0: 782e 4c6f 6164 6572 5365 7475 7045 7272  x.LoaderSetupErr
-000577e0: 6f72 2827 4361 6e6e 6f74 206c 6f61 6420  or('Cannot load 
-000577f0: 696e 746f 2074 696d 6520 656c 656d 656e  into time elemen
-00057800: 7473 2077 6974 6820 496e 7465 7276 616c  ts with Interval
-00057810: 2041 6d6f 756e 7473 206f 7468 6572 2074   Amounts other t
-00057820: 6861 6e20 312e 2054 696d 6520 656c 656d  han 1. Time elem
-00057830: 656e 7420 7b7d 2069 6e20 6869 6572 6172  ent {} in hierar
-00057840: 6368 7920 7b7d 2077 6974 6820 496e 7465  chy {} with Inte
-00057850: 7276 616c 2041 6d6f 756e 7420 7b7d 272e  rval Amount {}'.
-00057860: 666f 726d 6174 2873 652e 7368 6f72 746e  format(se.shortn
-00057870: 616d 652c 7469 6d65 5f68 6965 7261 7263  ame,time_hierarc
-00057880: 6879 2e70 6174 682c 7365 2e69 6e74 6572  hy.path,se.inter
-00057890: 7661 6c5f 616d 6f75 6e74 2929 0d0a 0d0a  val_amount))....
-000578a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000578b0: 6966 2073 652e 696e 7465 7276 616c 2021  if se.interval !
-000578c0: 3d20 7365 2e72 6573 6f6c 7574 696f 6e3a  = se.resolution:
-000578d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000578e0: 2020 2020 2020 7261 6973 6520 6d70 6578        raise mpex
-000578f0: 2e4c 6f61 6465 7253 6574 7570 4572 726f  .LoaderSetupErro
-00057900: 7228 2743 616e 6e6f 7420 6c6f 6164 2069  r('Cannot load i
-00057910: 6e74 6f20 7469 6d65 2065 6c65 6d65 6e74  nto time element
-00057920: 7320 7769 7468 2049 6e74 6572 7661 6c20  s with Interval 
-00057930: 416d 6f75 6e74 206e 6f74 2065 7175 616c  Amount not equal
-00057940: 2074 6f20 6974 7320 5265 736f 6c75 7469   to its Resoluti
-00057950: 6f6e 2e20 5469 6d65 2065 6c65 6d65 6e74  on. Time element
-00057960: 207b 7d20 696e 2068 6965 7261 7263 6879   {} in hierarchy
-00057970: 207b 7d20 7769 7468 2049 6e74 6572 7661   {} with Interva
-00057980: 6c20 416d 6f75 6e74 207b 7d20 616e 6420  l Amount {} and 
-00057990: 5265 736f 6c75 7469 6f6e 207b 7d27 2e66  Resolution {}'.f
-000579a0: 6f72 6d61 7428 7365 2e73 686f 7274 6e61  ormat(se.shortna
-000579b0: 6d65 2c74 696d 655f 6869 6572 6172 6368  me,time_hierarch
-000579c0: 792e 7061 7468 2c73 652e 696e 7465 7276  y.path,se.interv
-000579d0: 616c 5f61 6d6f 756e 742c 7365 2e72 6573  al_amount,se.res
-000579e0: 6f6c 7574 696f 6e29 290d 0a0d 0a0d 0a20  olution))...... 
-000579f0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00057a00: 6174 6520 3d20 7365 2e65 6c65 6d65 6e74  ate = se.element
-00057a10: 2e64 6174 650d 0a20 2020 2020 2020 2020  .date..         
-00057a20: 2020 2020 2020 2069 6620 6461 7465 2069         if date i
-00057a30: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
-00057a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057a50: 2064 6174 6573 5f74 6f5f 6c65 6166 5f65   dates_to_leaf_e
-00057a60: 6c65 6d65 6e74 735f 6c6b 705b 6461 7465  lements_lkp[date
-00057a70: 5d20 3d20 7365 0d0a 0d0a 2020 2020 2020  ] = se....      
-00057a80: 2020 2020 2020 2020 2020 6966 2070 7265            if pre
-00057a90: 7669 6f75 735f 6461 7465 2069 7320 6e6f  vious_date is no
-00057aa0: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00057ab0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00057ac0: 656d 706f 7765 725f 7469 6d65 5f74 7970  empower_time_typ
-00057ad0: 6520 3d3d 2027 4d6f 6e74 6827 3a0d 0a20  e == 'Month':.. 
-00057ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057af0: 2020 2020 2020 2069 6620 7072 6576 696f         if previo
-00057b00: 7573 5f64 6174 6520 2b20 4d4f 4e54 4820  us_date + MONTH 
-00057b10: 213d 2064 6174 653a 0d0a 2020 2020 2020  != date:..      
-00057b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057b30: 2020 2020 2020 7261 6973 6520 6d70 6578        raise mpex
-00057b40: 2e4c 6f61 6465 7253 6574 7570 4572 726f  .LoaderSetupErro
-00057b50: 7228 2743 616e 206f 6e6c 7920 6c6f 6164  r('Can only load
-00057b60: 2069 6e74 6f20 6120 5669 6577 706f 696e   into a Viewpoin
-00057b70: 7420 7769 7468 2063 6f6e 7469 6775 6f75  t with contiguou
-00057b80: 7320 7469 6d65 2065 6c65 6d65 6e74 732e  s time elements.
-00057b90: 2044 6174 6520 7b7d 2069 6e20 656c 656d   Date {} in elem
-00057ba0: 656e 7420 7b7d 2066 6f6c 6c6f 7765 6420  ent {} followed 
-00057bb0: 6461 7465 207b 7d20 696e 2065 6c65 6d65  date {} in eleme
-00057bc0: 6e74 2069 6e20 6869 6572 6172 6368 7920  nt in hierarchy 
-00057bd0: 7b7d 272e 666f 726d 6174 2864 6174 652c  {}'.format(date,
-00057be0: 7365 2e73 686f 7274 6e61 6d65 2c70 7265  se.shortname,pre
-00057bf0: 7669 6f75 735f 6461 7465 2c70 7265 7669  vious_date,previ
-00057c00: 6f75 735f 7365 2e73 686f 7274 6e61 6d65  ous_se.shortname
-00057c10: 2c74 696d 655f 6869 6572 6172 6368 792e  ,time_hierarchy.
-00057c20: 7061 7468 2929 0d0a 0d0a 2020 2020 2020  path))....      
-00057c30: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00057c40: 6966 2065 6d70 6f77 6572 5f74 696d 655f  if empower_time_
-00057c50: 7479 7065 203d 3d20 2759 6561 7227 3a0d  type == 'Year':.
-00057c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00057c70: 2020 2020 2020 2020 2069 6620 7072 6576           if prev
-00057c80: 696f 7573 5f64 6174 6520 2b20 5945 4152  ious_date + YEAR
-00057c90: 2021 3d20 6461 7465 3a0d 0a20 2020 2020   != date:..     
-00057ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057cb0: 2020 2020 2020 2072 6169 7365 206d 7065         raise mpe
-00057cc0: 782e 4c6f 6164 6572 5365 7475 7045 7272  x.LoaderSetupErr
-00057cd0: 6f72 2827 4361 6e20 6f6e 6c79 206c 6f61  or('Can only loa
-00057ce0: 6420 696e 746f 2061 2056 6965 7770 6f69  d into a Viewpoi
-00057cf0: 6e74 2077 6974 6820 636f 6e74 6967 756f  nt with contiguo
-00057d00: 7573 2074 696d 6520 656c 656d 656e 7473  us time elements
-00057d10: 2e20 4461 7465 207b 7d20 696e 2065 6c65  . Date {} in ele
-00057d20: 6d65 6e74 207b 7d20 666f 6c6c 6f77 6564  ment {} followed
-00057d30: 2064 6174 6520 7b7d 2069 6e20 656c 656d   date {} in elem
-00057d40: 656e 7420 696e 2068 6965 7261 7263 6879  ent in hierarchy
-00057d50: 207b 7d27 2e66 6f72 6d61 7428 6461 7465   {}'.format(date
-00057d60: 2c73 652e 7368 6f72 746e 616d 652c 7072  ,se.shortname,pr
-00057d70: 6576 696f 7573 5f64 6174 652c 7072 6576  evious_date,prev
-00057d80: 696f 7573 5f73 652e 7368 6f72 746e 616d  ious_se.shortnam
-00057d90: 652c 7469 6d65 5f68 6965 7261 7263 6879  e,time_hierarchy
-00057da0: 2e70 6174 6829 290d 0a0d 0a0d 0a20 2020  .path))......   
-00057db0: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-00057dc0: 7669 6f75 735f 7469 6d65 5f74 7970 6520  vious_time_type 
-00057dd0: 3d20 656d 706f 7765 725f 7469 6d65 5f74  = empower_time_t
-00057de0: 7970 650d 0a20 2020 2020 2020 2020 2020  ype..           
-00057df0: 2020 2020 2070 7265 7669 6f75 735f 6461       previous_da
-00057e00: 7465 203d 2064 6174 650d 0a20 2020 2020  te = date..     
-00057e10: 2020 2020 2020 2020 2020 2070 7265 7669             previ
-00057e20: 6f75 735f 7365 203d 2073 650d 0a0d 0a20  ous_se = se.... 
-00057e30: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
-00057e40: 7070 696e 675f 7479 7065 203d 3d20 2763  pping_type == 'c
-00057e50: 6f6e 7374 616e 7420 6461 7465 273a 0d0a  onstant date':..
-00057e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00057e70: 2353 696e 6365 2061 6c6c 206f 6620 7468  #Since all of th
-00057e80: 6520 6461 7465 7320 696e 2074 6865 206c  e dates in the l
-00057e90: 6561 7665 7320 6f66 2074 6865 2068 6965  eaves of the hie
-00057ea0: 7261 7263 6879 2061 7265 206f 6620 7468  rarchy are of th
-00057eb0: 6520 7361 6d65 2045 6d70 6f77 6572 2044  e same Empower D
-00057ec0: 6174 6520 5479 7065 0d0a 2020 2020 2020  ate Type..      
-00057ed0: 2020 2020 2020 2020 2020 2354 6865 6e20            #Then 
-00057ee0: 456d 706f 7765 7220 4461 7465 2054 7970  Empower Date Typ
-00057ef0: 6520 6973 2075 6e61 6d62 6967 756f 7573  e is unambiguous
-00057f00: 2061 6e64 2074 6865 2063 6f6e 7374 616e   and the constan
-00057f10: 7420 6461 7465 2069 6e20 7468 6520 6d61  t date in the ma
-00057f20: 7070 696e 6720 6d75 7374 2062 6520 7365  pping must be se
-00057f30: 656e 2069 6e20 7468 6520 636f 6e74 6578  en in the contex
-00057f40: 7420 6f66 2074 6869 7320 6461 7465 2074  t of this date t
-00057f50: 7970 650d 0a20 2020 2020 2020 2020 2020  ype..           
-00057f60: 2020 2020 206f 7269 6769 6e61 6c5f 6461       original_da
-00057f70: 7465 203d 2073 656c 662e 5f6d 6170 7065  te = self._mappe
-00057f80: 7273 5b31 315d 0d0a 2020 2020 2020 2020  rs[11]..        
-00057f90: 2020 2020 2020 2020 6173 7365 7274 2069          assert i
-00057fa0: 7369 6e73 7461 6e63 6528 6f72 6967 696e  sinstance(origin
-00057fb0: 616c 5f64 6174 652c 6461 7465 7469 6d65  al_date,datetime
-00057fc0: 2e64 6174 6574 696d 6529 0d0a 0d0a 2020  .datetime)....  
-00057fd0: 2020 2020 2020 2020 2020 2020 2020 2354                #T
-00057fe0: 7261 6e73 666f 726d 2074 6865 206d 6170  ransform the map
-00057ff0: 706e 6967 2074 6f20 6461 7465 2074 6f20  pnig to date to 
-00058000: 6f6e 6520 7468 6174 2077 696c 6c20 6c6f  one that will lo
-00058010: 6f6b 2075 7020 7468 6520 636f 7272 6563  ok up the correc
-00058020: 7420 656c 656d 656e 740d 0a20 2020 2020  t element..     
-00058030: 2020 2020 2020 2020 2020 2069 6620 656d             if em
-00058040: 706f 7765 725f 7469 6d65 5f74 7970 6520  power_time_type 
-00058050: 3d3d 2027 4d6f 6e74 6827 3a0d 0a20 2020  == 'Month':..   
-00058060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00058070: 206c 6f6f 6b75 705f 6461 7465 203d 2064   lookup_date = d
-00058080: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-00058090: 286f 7269 6769 6e61 6c5f 6461 7465 2e79  (original_date.y
-000580a0: 6561 722c 206f 7269 6769 6e61 6c5f 6461  ear, original_da
-000580b0: 7465 2e6d 6f6e 7468 2c31 290d 0a20 2020  te.month,1)..   
-000580c0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-000580d0: 6620 656d 706f 7765 725f 7469 6d65 5f74  f empower_time_t
-000580e0: 7970 6520 3d3d 2027 5965 6172 273a 0d0a  ype == 'Year':..
-000580f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00058100: 2020 2020 6c6f 6f6b 7570 5f64 6174 6520      lookup_date 
-00058110: 3d20 6461 7465 7469 6d65 2e64 6174 6574  = datetime.datet
-00058120: 696d 6528 6f72 6967 696e 616c 5f64 6174  ime(original_dat
-00058130: 652e 7965 6172 2c20 312c 3129 0d0a 2020  e.year, 1,1)..  
-00058140: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00058150: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00058160: 2020 2020 2020 2020 2023 4f74 6865 7220           #Other 
-00058170: 636f 6465 2073 686f 756c 6420 6861 7665  code should have
-00058180: 2072 6169 7365 6420 7468 6520 6578 6365   raised the exce
-00058190: 7074 696f 6e20 6966 2075 6e68 616e 646c  ption if unhandl
-000581a0: 6564 2064 6174 6520 7479 7065 2065 6e74  ed date type ent
-000581b0: 6572 6564 0d0a 2020 2020 2020 2020 2020  ered..          
-000581c0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-000581d0: 2046 616c 7365 0d0a 2020 2020 2020 2020   False..        
-000581e0: 2020 2020 2020 2020 6c65 6166 5f65 6c65          leaf_ele
-000581f0: 6d65 6e74 203d 2064 6174 6573 5f74 6f5f  ment = dates_to_
-00058200: 6c65 6166 5f65 6c65 6d65 6e74 735f 6c6b  leaf_elements_lk
-00058210: 705b 6c6f 6f6b 7570 5f64 6174 655d 0d0a  p[lookup_date]..
-00058220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00058230: 7265 7475 726e 205b 6c65 6166 5f65 6c65  return [leaf_ele
-00058240: 6d65 6e74 5d0d 0a20 2020 2020 2020 2020  ment]..         
-00058250: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00058260: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00058270: 206c 6561 665f 656c 656d 656e 7473 0d0a   leaf_elements..
-00058280: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00058290: 2065 6666 6563 7469 7665 5f65 6c65 6d65   effective_eleme
-000582a0: 6e74 730d 0a0d 0a20 2020 2040 7072 6f70  nts....    @prop
-000582b0: 6572 7479 0d0a 2020 2020 6465 6620 6566  erty..    def ef
-000582c0: 6665 6374 6976 655f 6469 6d30 5f65 6c65  fective_dim0_ele
-000582d0: 6d65 6e74 7328 7365 6c66 293a 0d0a 2020  ments(self):..  
-000582e0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000582f0: 662e 6566 6665 6374 6976 655f 756e 6974  f.effective_unit
-00058300: 5f64 696d 656e 7369 6f6e 5f65 6c65 6d65  _dimension_eleme
-00058310: 6e74 7328 6469 6d65 6e73 696f 6e5f 696e  nts(dimension_in
-00058320: 6465 783d 3029 0d0a 2020 2020 4070 726f  dex=0)..    @pro
-00058330: 7065 7274 790d 0a20 2020 2064 6566 2065  perty..    def e
-00058340: 6666 6563 7469 7665 5f64 696d 315f 656c  ffective_dim1_el
-00058350: 656d 656e 7473 2873 656c 6629 3a0d 0a20  ements(self):.. 
-00058360: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00058370: 6c66 2e65 6666 6563 7469 7665 5f75 6e69  lf.effective_uni
-00058380: 745f 6469 6d65 6e73 696f 6e5f 656c 656d  t_dimension_elem
-00058390: 656e 7473 2864 696d 656e 7369 6f6e 5f69  ents(dimension_i
-000583a0: 6e64 6578 3d31 290d 0a20 2020 2040 7072  ndex=1)..    @pr
-000583b0: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
-000583c0: 6566 6665 6374 6976 655f 6469 6d32 5f65  effective_dim2_e
-000583d0: 6c65 6d65 6e74 7328 7365 6c66 293a 0d0a  lements(self):..
-000583e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000583f0: 656c 662e 6566 6665 6374 6976 655f 756e  elf.effective_un
-00058400: 6974 5f64 696d 656e 7369 6f6e 5f65 6c65  it_dimension_ele
-00058410: 6d65 6e74 7328 6469 6d65 6e73 696f 6e5f  ments(dimension_
-00058420: 696e 6465 783d 3229 0d0a 2020 2020 4070  index=2)..    @p
-00058430: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-00058440: 2065 6666 6563 7469 7665 5f64 696d 335f   effective_dim3_
-00058450: 656c 656d 656e 7473 2873 656c 6629 3a0d  elements(self):.
-00058460: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00058470: 7365 6c66 2e65 6666 6563 7469 7665 5f75  self.effective_u
-00058480: 6e69 745f 6469 6d65 6e73 696f 6e5f 656c  nit_dimension_el
-00058490: 656d 656e 7473 2864 696d 656e 7369 6f6e  ements(dimension
-000584a0: 5f69 6e64 6578 3d33 290d 0a20 2020 2040  _index=3)..    @
-000584b0: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
-000584c0: 6620 6566 6665 6374 6976 655f 6469 6d34  f effective_dim4
-000584d0: 5f65 6c65 6d65 6e74 7328 7365 6c66 293a  _elements(self):
-000584e0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000584f0: 2073 656c 662e 6566 6665 6374 6976 655f   self.effective_
-00058500: 756e 6974 5f64 696d 656e 7369 6f6e 5f65  unit_dimension_e
-00058510: 6c65 6d65 6e74 7328 6469 6d65 6e73 696f  lements(dimensio
-00058520: 6e5f 696e 6465 783d 3429 0d0a 2020 2020  n_index=4)..    
-00058530: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
-00058540: 6566 2065 6666 6563 7469 7665 5f64 696d  ef effective_dim
-00058550: 355f 656c 656d 656e 7473 2873 656c 6629  5_elements(self)
-00058560: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-00058570: 6e20 7365 6c66 2e65 6666 6563 7469 7665  n self.effective
-00058580: 5f75 6e69 745f 6469 6d65 6e73 696f 6e5f  _unit_dimension_
-00058590: 656c 656d 656e 7473 2864 696d 656e 7369  elements(dimensi
-000585a0: 6f6e 5f69 6e64 6578 3d35 290d 0a20 2020  on_index=5)..   
-000585b0: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-000585c0: 6465 6620 6566 6665 6374 6976 655f 6469  def effective_di
-000585d0: 6d36 5f65 6c65 6d65 6e74 7328 7365 6c66  m6_elements(self
-000585e0: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-000585f0: 726e 2073 656c 662e 6566 6665 6374 6976  rn self.effectiv
-00058600: 655f 756e 6974 5f64 696d 656e 7369 6f6e  e_unit_dimension
-00058610: 5f65 6c65 6d65 6e74 7328 6469 6d65 6e73  _elements(dimens
-00058620: 696f 6e5f 696e 6465 783d 3629 0d0a 2020  ion_index=6)..  
-00058630: 2020 4070 726f 7065 7274 790d 0a20 2020    @property..   
-00058640: 2064 6566 2065 6666 6563 7469 7665 5f64   def effective_d
-00058650: 696d 375f 656c 656d 656e 7473 2873 656c  im7_elements(sel
-00058660: 6629 3a0d 0a20 2020 2020 2020 2072 6574  f):..        ret
-00058670: 7572 6e20 7365 6c66 2e65 6666 6563 7469  urn self.effecti
-00058680: 7665 5f75 6e69 745f 6469 6d65 6e73 696f  ve_unit_dimensio
-00058690: 6e5f 656c 656d 656e 7473 2864 696d 656e  n_elements(dimen
-000586a0: 7369 6f6e 5f69 6e64 6578 3d37 290d 0a0d  sion_index=7)...
-000586b0: 0a20 2020 2064 6566 205f 6669 7273 745f  .    def _first_
-000586c0: 756e 6772 6f75 7065 645f 6368 696c 6472  ungrouped_childr
-000586d0: 656e 2873 656c 662c 7374 7275 6374 7572  en(self,structur
-000586e0: 655f 656c 656d 656e 7429 3a0d 0a20 2020  e_element):..   
-000586f0: 2020 2020 2069 6620 7374 7275 6374 7572       if structur
-00058700: 655f 656c 656d 656e 742e 6772 6f75 705f  e_element.group_
-00058710: 6f6e 6c79 203d 3d20 2747 726f 7570 273a  only == 'Group':
-00058720: 0d0a 2020 2020 2020 2020 2020 2020 616c  ..            al
-00058730: 6c5f 6368 696c 6472 656e 203d 205b 5d0d  l_children = [].
-00058740: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00058750: 2063 6820 696e 2073 7472 7563 7475 7265   ch in structure
-00058760: 5f65 6c65 6d65 6e74 2e63 6869 6c64 7265  _element.childre
-00058770: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-00058780: 2020 2020 616c 6c5f 6368 696c 6472 656e      all_children
-00058790: 202b 3d20 7365 6c66 2e5f 6669 7273 745f   += self._first_
-000587a0: 756e 6772 6f75 7065 645f 6368 696c 6472  ungrouped_childr
-000587b0: 656e 2863 6829 0d0a 2020 2020 2020 2020  en(ch)..        
-000587c0: 2020 2020 7265 7475 726e 2061 6c6c 5f63      return all_c
-000587d0: 6869 6c64 7265 6e0d 0a20 2020 2020 2020  hildren..       
-000587e0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000587f0: 2020 2020 7265 7475 726e 205b 7374 7275      return [stru
-00058800: 6374 7572 655f 656c 656d 656e 745d 0d0a  cture_element]..
-00058810: 0d0a 2020 2020 6465 6620 6566 6665 6374  ..    def effect
-00058820: 6976 655f 6469 6d65 6e73 696f 6e5f 656c  ive_dimension_el
-00058830: 656d 656e 7473 2873 656c 662c 6469 6d65  ements(self,dime
-00058840: 6e73 696f 6e5f 696e 6465 7829 3a0d 0a20  nsion_index):.. 
-00058850: 2020 2020 2020 2069 6620 6469 6d65 6e73         if dimens
-00058860: 696f 6e5f 696e 6465 7820 3c3d 2037 3a0d  ion_index <= 7:.
-00058870: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00058880: 6469 6d65 6e73 696f 6e5f 696e 6465 7820  dimension_index 
-00058890: 3c20 7365 6c66 2e73 6974 652e 6e75 6d62  < self.site.numb
-000588a0: 6572 5f6f 665f 756e 6974 5f64 696d 656e  er_of_unit_dimen
-000588b0: 7369 6f6e 733a 0d0a 2020 2020 2020 2020  sions:..        
-000588c0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000588d0: 656c 662e 6566 6665 6374 6976 655f 756e  elf.effective_un
-000588e0: 6974 5f64 696d 656e 7369 6f6e 5f65 6c65  it_dimension_ele
-000588f0: 6d65 6e74 7328 6469 6d65 6e73 696f 6e5f  ments(dimension_
-00058900: 696e 6465 7829 0d0a 2020 2020 2020 2020  index)..        
-00058910: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00058920: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00058930: 6e20 4e6f 6e65 0d0a 2020 2020 2020 2020  n None..        
-00058940: 656c 6966 2064 696d 656e 7369 6f6e 5f69  elif dimension_i
-00058950: 6e64 6578 203d 3d20 383a 0d0a 2020 2020  ndex == 8:..    
-00058960: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00058970: 656c 662e 6566 6665 6374 6976 655f 696e  elf.effective_in
-00058980: 6469 6361 746f 725f 656c 656d 656e 7473  dicator_elements
-00058990: 0d0a 2020 2020 2020 2020 656c 6966 2064  ..        elif d
-000589a0: 696d 656e 7369 6f6e 5f69 6e64 6578 203d  imension_index =
-000589b0: 3d20 393a 0d0a 2020 2020 2020 2020 2020  = 9:..          
-000589c0: 2020 7265 7475 726e 2073 656c 662e 6566    return self.ef
-000589d0: 6665 6374 6976 655f 636f 6d70 6172 6973  fective_comparis
-000589e0: 6f6e 5f65 6c65 6d65 6e74 730d 0a20 2020  on_elements..   
-000589f0: 2020 2020 2065 6c69 6620 6469 6d65 6e73       elif dimens
-00058a00: 696f 6e5f 696e 6465 7820 3d3d 2031 303a  ion_index == 10:
-00058a10: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00058a20: 7475 726e 2073 656c 662e 6566 6665 6374  turn self.effect
-00058a30: 6976 655f 6375 7272 656e 6379 5f65 6c65  ive_currency_ele
-00058a40: 6d65 6e74 730d 0a20 2020 2020 2020 2065  ments..        e
-00058a50: 6c69 6620 6469 6d65 6e73 696f 6e5f 696e  lif dimension_in
-00058a60: 6465 7820 3d3d 2031 313a 0d0a 2020 2020  dex == 11:..    
-00058a70: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00058a80: 656c 662e 6566 6665 6374 6976 655f 7469  elf.effective_ti
-00058a90: 6d65 5f65 6c65 6d65 6e74 730d 0a20 2020  me_elements..   
-00058aa0: 2020 2020 2065 6c69 6620 6469 6d65 6e73       elif dimens
-00058ab0: 696f 6e5f 696e 6465 7820 3d3d 2031 323a  ion_index == 12:
-00058ac0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-00058ad0: 7475 726e 2073 656c 662e 6566 6665 6374  turn self.effect
-00058ae0: 6976 655f 7472 616e 7366 6f72 6d5f 656c  ive_transform_el
-00058af0: 656d 656e 7473 0d0a 0d0a 0d0a 2020 2020  ements......    
-00058b00: 6465 6620 6566 6665 6374 6976 655f 756e  def effective_un
-00058b10: 6974 5f64 696d 656e 7369 6f6e 5f65 6c65  it_dimension_ele
-00058b20: 6d65 6e74 7328 7365 6c66 2c64 696d 656e  ments(self,dimen
-00058b30: 7369 6f6e 5f69 6e64 6578 293a 0d0a 0d0a  sion_index):....
-00058b40: 2020 2020 2020 2020 7365 6c66 2e5f 6861          self._ha
-00058b50: 6e64 6c65 5f65 6d70 7479 5f74 6172 6765  ndle_empty_targe
-00058b60: 7428 290d 0a0d 0a20 2020 2020 2020 2023  t()....        #
-00058b70: 4469 6d65 6e73 696f 6e20 6e61 6d65 2075  Dimension name u
-00058b80: 7365 6420 666f 7220 4572 726f 7220 6d65  sed for Error me
-00058b90: 7373 6167 6573 0d0a 2020 2020 2020 2020  ssages..        
-00058ba0: 6966 2064 696d 656e 7369 6f6e 5f69 6e64  if dimension_ind
-00058bb0: 6578 203c 2038 3a0d 0a20 2020 2020 2020  ex < 8:..       
-00058bc0: 2020 2020 2064 696d 656e 7369 6f6e 5f6e       dimension_n
-00058bd0: 616d 6520 3d20 2755 6e69 7420 272b 7374  ame = 'Unit '+st
-00058be0: 7228 6469 6d65 6e73 696f 6e5f 696e 6465  r(dimension_inde
-00058bf0: 7829 0d0a 2020 2020 2020 2020 6966 2064  x)..        if d
-00058c00: 696d 656e 7369 6f6e 5f69 6e64 6578 3d3d  imension_index==
-00058c10: 393a 0d0a 2020 2020 2020 2020 2020 2020  9:..            
-00058c20: 6469 6d65 6e73 696f 6e5f 6e61 6d65 203d  dimension_name =
-00058c30: 2027 436f 6d70 6172 6973 6f6e 270d 0a20   'Comparison'.. 
-00058c40: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00058c50: 2020 2020 2020 2020 2020 6469 6d65 6e73            dimens
-00058c60: 696f 6e5f 6e61 6d65 203d 2027 4469 6d65  ion_name = 'Dime
-00058c70: 6e73 696f 6e20 272b 7374 7228 6469 6d65  nsion '+str(dime
-00058c80: 6e73 696f 6e5f 696e 6465 7829 0d0a 0d0a  nsion_index)....
-00058c90: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00058ca0: 7461 7267 6574 2e73 7472 7563 7475 7265  target.structure
-00058cb0: 735b 6469 6d65 6e73 696f 6e5f 696e 6465  s[dimension_inde
-00058cc0: 785d 2069 7320 4e6f 6e65 3a0d 0a20 2020  x] is None:..   
-00058cd0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-00058ce0: 7065 782e 4c6f 6164 6572 5365 7475 7045  pex.LoaderSetupE
-00058cf0: 7272 6f72 2827 4361 6e6e 6f74 2063 6f6d  rror('Cannot com
-00058d00: 7075 7465 2065 6666 6563 7469 7665 2075  pute effective u
-00058d10: 6e69 7420 6469 6d65 6e73 696f 6e20 656c  nit dimension el
-00058d20: 656d 656e 7473 2066 6f72 2061 2046 6f63  ements for a Foc
-00058d30: 7573 4c6f 6164 6572 2077 6869 6368 2068  usLoader which h
-00058d40: 6173 206e 6f20 7374 7275 6374 7572 6520  as no structure 
-00058d50: 282e 7374 7275 6374 7572 6573 5b7b 7d5d  (.structures[{}]
-00058d60: 2927 2e66 6f72 6d61 7428 6469 6d65 6e73  )'.format(dimens
-00058d70: 696f 6e5f 696e 6465 7829 290d 0a0d 0a20  ion_index)).... 
-00058d80: 2020 2020 2020 206e 6f5f 6d61 7070 696e         no_mappin
-00058d90: 6773 5f66 6f72 5f74 6869 735f 6469 6d65  gs_for_this_dime
-00058da0: 6e73 696f 6e20 3d20 4661 6c73 650d 0a20  nsion = False.. 
-00058db0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00058dc0: 6d61 7070 6572 7320 6973 204e 6f6e 6520  mappers is None 
-00058dd0: 6f72 206c 656e 2873 656c 662e 5f6d 6170  or len(self._map
-00058de0: 7065 7273 293d 3d30 3a0d 0a20 2020 2020  pers)==0:..     
-00058df0: 2020 2020 2020 206e 6f5f 6d61 7070 696e         no_mappin
-00058e00: 6773 5f66 6f72 5f74 6869 735f 6469 6d65  gs_for_this_dime
-00058e10: 6e73 696f 6e20 3d20 5472 7565 0d0a 2020  nsion = True..  
-00058e20: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-00058e30: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-00058e40: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00058e50: 6f5f 6d61 7070 696e 6773 5f66 6f72 5f74  o_mappings_for_t
-00058e60: 6869 735f 6469 6d65 6e73 696f 6e20 3d20  his_dimension = 
-00058e70: 7365 6c66 2e5f 6d61 7070 6572 735b 6469  self._mappers[di
-00058e80: 6d65 6e73 696f 6e5f 696e 6465 785d 2069  mension_index] i
-00058e90: 7320 4e6f 6e65 0d0a 2020 2020 2020 2020  s None..        
-00058ea0: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-00058eb0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-00058ec0: 2020 2020 2020 6e6f 5f6d 6170 7069 6e67        no_mapping
-00058ed0: 735f 666f 725f 7468 6973 5f64 696d 656e  s_for_this_dimen
-00058ee0: 7369 6f6e 203d 2054 7275 650d 0a0d 0a20  sion = True.... 
-00058ef0: 2020 2020 2020 2023 5768 6572 6520 7468         #Where th
-00058f00: 6572 6520 6172 6520 6e6f 206d 6170 7069  ere are no mappi
-00058f10: 6e67 7320 7765 2061 7265 2068 6170 7079  ngs we are happy
-00058f20: 2074 6f20 7573 6520 6120 7369 6e67 6c65   to use a single
-00058f30: 2065 6c65 6d65 6e74 2069 6620 6f6e 6520   element if one 
-00058f40: 6973 2061 7661 696c 6162 6c65 0d0a 2020  is available..  
-00058f50: 2020 2020 2020 6966 206e 6f5f 6d61 7070        if no_mapp
-00058f60: 696e 6773 5f66 6f72 5f74 6869 735f 6469  ings_for_this_di
-00058f70: 6d65 6e73 696f 6e3a 0d0a 0d0a 2020 2020  mension:....    
-00058f80: 2020 2020 2020 2020 6869 6572 6172 6368          hierarch
-00058f90: 7920 3d20 7365 6c66 2e5f 6765 745f 6869  y = self._get_hi
-00058fa0: 6572 6172 6368 795f 6469 7265 6374 5f6f  erarchy_direct_o
-00058fb0: 725f 7369 6e67 6c65 5f68 6965 7261 7263  r_single_hierarc
-00058fc0: 6879 5f66 726f 6d5f 7374 7275 6374 7572  hy_from_structur
-00058fd0: 6528 6469 6d65 6e73 696f 6e5f 696e 6465  e(dimension_inde
-00058fe0: 783d 6469 6d65 6e73 696f 6e5f 696e 6465  x=dimension_inde
-00058ff0: 782c 6469 6d65 6e73 696f 6e5f 6e61 6d65  x,dimension_name
-00059000: 3d64 696d 656e 7369 6f6e 5f6e 616d 652c  =dimension_name,
-00059010: 656e 666f 7263 655f 7369 6e67 6c65 5f65  enforce_single_e
-00059020: 6c65 6d65 6e74 3d54 7275 6529 0d0a 0d0a  lement=True)....
-00059030: 2020 2020 2020 2020 2020 2020 6669 7273              firs
-00059040: 745f 756e 6772 6f75 7065 645f 6368 696c  t_ungrouped_chil
-00059050: 6472 656e 203d 2073 656c 662e 5f66 6972  dren = self._fir
-00059060: 7374 5f75 6e67 726f 7570 6564 5f63 6869  st_ungrouped_chi
-00059070: 6c64 7265 6e28 6869 6572 6172 6368 7929  ldren(hierarchy)
-00059080: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00059090: 2366 6972 7374 5f75 6e67 726f 7570 6564  #first_ungrouped
-000590a0: 5f63 6869 6c64 7265 6e20 7368 6f75 6c64  _children should
-000590b0: 2062 6520 6120 7369 6e67 6c65 2069 7465   be a single ite
-000590c0: 6d20 6c69 7374 2e20 5468 6174 2069 7465  m list. That ite
-000590d0: 6d20 2869 2e65 2e20 7468 6174 2053 7472  m (i.e. that Str
-000590e0: 7563 7475 7265 456c 656d 656e 7429 2073  uctureElement) s
-000590f0: 686f 756c 6420 6861 7665 206e 6f20 6368  hould have no ch
-00059100: 696c 6472 656e 202d 2069 2e65 2e20 7765  ildren - i.e. we
-00059110: 2061 7265 206c 6f6f 6f6b 696e 6720 6174   are loooking at
-00059120: 2061 2073 696e 676c 6520 656c 656d 656e   a single elemen
-00059130: 740d 0a20 2020 2020 2020 2020 2020 2069  t..            i
-00059140: 6620 6c65 6e28 6669 7273 745f 756e 6772  f len(first_ungr
-00059150: 6f75 7065 645f 6368 696c 6472 656e 2920  ouped_children) 
-00059160: 3d3d 2031 2061 6e64 206c 656e 2866 6972  == 1 and len(fir
-00059170: 7374 5f75 6e67 726f 7570 6564 5f63 6869  st_ungrouped_chi
-00059180: 6c64 7265 6e5b 305d 2e63 6869 6c64 7265  ldren[0].childre
-00059190: 6e29 203d 3d20 303a 0d0a 2020 2020 2020  n) == 0:..      
-000591a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000591b0: 2066 6972 7374 5f75 6e67 726f 7570 6564   first_ungrouped
-000591c0: 5f63 6869 6c64 7265 6e0d 0a20 2020 2020  _children..     
-000591d0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000591e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000591f0: 6973 6520 6d70 6578 2e4c 6f61 6465 7253  ise mpex.LoaderS
-00059200: 6574 7570 4572 726f 7228 2746 6f63 7573  etupError('Focus
-00059210: 4c6f 6164 6572 2077 6974 686f 7574 2061  Loader without a
-00059220: 6e79 206d 6170 7069 6e67 7320 6361 6e6e  ny mappings cann
-00059230: 6f74 2068 616e 646c 6520 7b7d 2053 7472  ot handle {} Str
-00059240: 7563 7475 7265 456c 656d 656e 7473 2077  uctureElements w
-00059250: 6974 6820 616e 7974 6869 6e67 206f 7468  ith anything oth
-00059260: 6572 2074 6861 6e20 6120 7369 6e67 6c65  er than a single
-00059270: 2065 6c65 6d65 6e74 2e20 5374 7275 6374   element. Struct
-00059280: 7572 6520 7b7d 2068 6173 206d 6f72 6520  ure {} has more 
-00059290: 7468 616e 206f 6e65 2065 6c65 6d65 6e74  than one element
-000592a0: 2e20 4368 6f6f 7365 2061 6e6f 7468 6572  . Choose another
-000592b0: 2053 7472 7563 7475 7265 206f 7220 6372   Structure or cr
-000592c0: 6561 7465 206d 6170 7069 6e67 7320 666f  eate mappings fo
-000592d0: 7220 7468 6520 6869 6572 6172 6368 7927  r the hierarchy'
-000592e0: 2e66 6f72 6d61 7428 6469 6d65 6e73 696f  .format(dimensio
-000592f0: 6e5f 6e61 6d65 2c73 656c 662e 7461 7267  n_name,self.targ
-00059300: 6574 2e73 7472 7563 7475 7265 735b 6469  et.structures[di
-00059310: 6d65 6e73 696f 6e5f 696e 6465 785d 2e6c  mension_index].l
-00059320: 6f6e 676e 616d 6529 290d 0a20 2020 2020  ongname))..     
-00059330: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00059340: 2020 2020 2020 2355 7365 205f 6765 745f        #Use _get_
-00059350: 696d 706c 6965 645f 7368 6f72 7463 6f64  implied_shortcod
-00059360: 655f 6c69 7374 5f61 6e64 5f6d 6170 7069  e_list_and_mappi
-00059370: 6e67 5f74 7970 652c 2062 6563 6175 7365  ng_type, because
-00059380: 2069 7420 6368 6563 6b73 2066 6f72 2063   it checks for c
-00059390: 6f6c 756d 6e20 6578 6973 7465 6e63 6520  olumn existence 
-000593a0: 7261 7468 6572 2074 6861 6e20 626c 6974  rather than blit
-000593b0: 6865 6c79 2061 7373 756d 696e 6720 7468  hely assuming th
-000593c0: 6174 2063 6f6c 756d 6e20 6e61 6d65 732f  at column names/
-000593d0: 7368 6f72 746e 616d 6573 2068 6176 6520  shortnames have 
-000593e0: 6265 656e 2074 7970 6564 2063 6f72 7265  been typed corre
-000593f0: 6374 6c79 0d0a 2020 2020 2020 2020 2020  ctly..          
-00059400: 2020 6566 6665 6374 6976 655f 656c 656d    effective_elem
-00059410: 656e 7473 2c20 6d61 7070 696e 675f 7479  ents, mapping_ty
-00059420: 7065 2c63 6f6c 756d 6e5f 6e61 6d65 7320  pe,column_names 
-00059430: 3d20 7365 6c66 2e5f 6765 745f 696d 706c  = self._get_impl
-00059440: 6965 645f 7368 6f72 7463 6f64 655f 6c69  ied_shortcode_li
-00059450: 7374 5f61 6e64 5f6d 6170 7069 6e67 5f74  st_and_mapping_t
-00059460: 7970 6528 6469 6d65 6e73 696f 6e5f 696e  ype(dimension_in
-00059470: 6465 7820 3d20 6469 6d65 6e73 696f 6e5f  dex = dimension_
-00059480: 696e 6465 782c 206f 626a 6563 745f 746f  index, object_to
-00059490: 5f63 6865 636b 5f61 6761 696e 7374 203d  _check_against =
-000594a0: 7365 6c66 2e74 6172 6765 742e 7374 7275  self.target.stru
-000594b0: 6374 7572 6573 5b64 696d 656e 7369 6f6e  ctures[dimension
-000594c0: 5f69 6e64 6578 5d29 0d0a 0d0a 2020 2020  _index])....    
-000594d0: 2020 2020 2020 2020 6869 6572 6172 6368          hierarch
-000594e0: 7920 3d20 7365 6c66 2e5f 6765 745f 6869  y = self._get_hi
-000594f0: 6572 6172 6368 795f 6469 7265 6374 5f6f  erarchy_direct_o
-00059500: 725f 7369 6e67 6c65 5f68 6965 7261 7263  r_single_hierarc
-00059510: 6879 5f66 726f 6d5f 7374 7275 6374 7572  hy_from_structur
-00059520: 6528 6469 6d65 6e73 696f 6e5f 696e 6465  e(dimension_inde
-00059530: 783d 6469 6d65 6e73 696f 6e5f 696e 6465  x=dimension_inde
-00059540: 782c 6469 6d65 6e73 696f 6e5f 6e61 6d65  x,dimension_name
-00059550: 3d64 696d 656e 7369 6f6e 5f6e 616d 6529  =dimension_name)
-00059560: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00059570: 2366 6972 7374 5f75 6e67 726f 7570 6564  #first_ungrouped
-00059580: 5f63 6869 6c64 7265 6e20 3d20 7365 6c66  _children = self
-00059590: 2e5f 6669 7273 745f 756e 6772 6f75 7065  ._first_ungroupe
-000595a0: 645f 6368 696c 6472 656e 2868 6965 7261  d_children(hiera
-000595b0: 7263 6879 290d 0a20 2020 2020 2020 2020  rchy)..         
-000595c0: 2020 2023 2357 6520 6172 6520 6861 7070     ##We are happ
-000595d0: 7920 746f 2072 6574 7572 6e20 6120 4772  y to return a Gr
-000595e0: 6f75 7020 656c 656d 656e 7420 6865 7265  oup element here
-000595f0: 2c20 616e 6420 7468 656e 2075 7365 2064  , and then use d
-00059600: 6f74 7469 6e65 7373 206f 6620 360d 0a20  ottiness of 6.. 
-00059610: 2020 2020 2020 2020 2020 2066 6972 7374             first
-00059620: 5f75 6e67 726f 7570 6564 5f63 6869 6c64  _ungrouped_child
-00059630: 7265 6e20 3d20 5b68 6965 7261 7263 6879  ren = [hierarchy
-00059640: 5d0d 0a20 2020 2020 2020 2020 2020 2023  ]..            #
-00059650: 2354 4f44 4f20 6d61 7463 6820 7468 6520  #TODO match the 
-00059660: 6566 6665 6374 6976 6520 656c 656d 656e  effective elemen
-00059670: 7473 2075 7020 7769 7468 2074 6865 2068  ts up with the h
-00059680: 6965 7261 7263 6879 2065 6c65 6d65 6e74  ierarchy element
-00059690: 730d 0a20 2020 2020 2020 2020 2020 2023  s..            #
-000596a0: 2343 6f6d 6d65 6e74 6564 2063 6f64 6520  #Commented code 
-000596b0: 6265 6c6f 7720 6973 2069 676e 6f72 616e  below is ignoran
-000596c0: 7420 6f66 2074 6865 2073 7472 7563 7475  t of the structu
-000596d0: 7265 206f 6620 7468 6520 6f75 7470 7574  re of the output
-000596e0: 7320 616e 6420 6973 6e27 7420 776f 726b  s and isn't work
-000596f0: 696e 670d 0a20 2020 2020 2020 2020 2020  ing..           
-00059700: 2023 6966 2065 6666 6563 7469 7665 5f65   #if effective_e
-00059710: 6c65 6d65 6e74 7320 6973 206e 6f74 204e  lements is not N
-00059720: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00059730: 2020 2320 2020 2066 6f72 2063 6820 696e    #    for ch in
-00059740: 2066 6972 7374 5f75 6e67 726f 7570 6564   first_ungrouped
-00059750: 5f63 6869 6c64 7265 6e3a 0d0a 2020 2020  _children:..    
-00059760: 2020 2020 2020 2020 2320 2020 2020 2020          #       
-00059770: 2061 7373 6572 7420 6368 2e73 686f 7274   assert ch.short
-00059780: 6e61 6d65 2069 6e20 6566 6665 6374 6976  name in effectiv
-00059790: 655f 656c 656d 656e 7473 2c20 227b 7d20  e_elements, "{} 
-000597a0: 6e6f 7420 696e 207b 7d22 2e66 6f72 6d61  not in {}".forma
-000597b0: 7428 6368 2e73 686f 7274 6e61 6d65 2c20  t(ch.shortname, 
-000597c0: 6566 6665 6374 6976 655f 656c 656d 656e  effective_elemen
-000597d0: 7473 290d 0a20 2020 2020 2020 2020 2020  ts)..           
-000597e0: 2023 656c 7365 3a0d 0a20 2020 2020 2020   #else:..       
-000597f0: 2020 2020 2023 2020 2020 236d 6179 6265       #    #maybe
-00059800: 2073 686f 756c 6420 6173 7365 7274 2074   should assert t
-00059810: 6861 7420 6669 7273 7420 756e 6772 6f75  hat first ungrou
-00059820: 7065 6420 656c 656d 656e 7473 2069 7320  ped elements is 
-00059830: 7369 6e67 6c65 2065 6c65 6d65 6e74 206c  single element l
-00059840: 6973 743f 0d0a 2020 2020 2020 2020 2020  ist?..          
-00059850: 2020 2320 2020 2070 6173 730d 0a0d 0a20    #    pass.... 
-00059860: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
-00059870: 7070 696e 675f 7479 7065 203d 3d20 2763  pping_type == 'c
-00059880: 6f6e 7374 616e 7420 7368 6f72 746e 616d  onstant shortnam
-00059890: 6527 3a0d 0a20 2020 2020 2020 2020 2020  e':..           
-000598a0: 2020 2020 2066 6f72 2063 6820 696e 2066       for ch in f
-000598b0: 6972 7374 5f75 6e67 726f 7570 6564 5f63  irst_ungrouped_c
-000598c0: 6869 6c64 7265 6e3a 0d0a 2020 2020 2020  hildren:..      
-000598d0: 2020 2020 2020 2020 2020 2020 2020 2374                #t
-000598e0: 6869 7320 636f 6465 2061 7373 756d 6573  his code assumes
-000598f0: 2074 6861 7420 6120 6d61 7070 696e 6720   that a mapping 
-00059900: 636f 6e74 6169 6e73 2061 2073 686f 7274  contains a short
-00059910: 636f 6465 2066 6f72 2061 2043 6f6d 7061  code for a Compa
-00059920: 7269 736f 6e0d 0a20 2020 2020 2020 2020  rison..         
-00059930: 2020 2020 2020 2020 2020 2023 4974 2069             #It i
-00059940: 7320 6c69 6b65 6c79 2074 6861 7420 6974  s likely that it
-00059950: 276c 6c20 686f 6c64 2073 6f6d 6574 6869  'll hold somethi
-00059960: 6e67 206d 6f72 6520 736f 7068 6973 7469  ng more sophisti
-00059970: 6361 7465 642e 0d0a 2020 2020 2020 2020  cated...        
-00059980: 2020 2020 2020 2020 2020 2020 2357 6865              #Whe
-00059990: 6e20 6974 2064 6f65 7320 7468 6520 7465  n it does the te
-000599a0: 7374 7320 7769 6c6c 2062 7265 616b 202d  sts will break -
-000599b0: 2073 6f20 4927 7665 2073 7461 7465 6420   so I've stated 
-000599c0: 7468 6973 2061 7373 756d 7074 696f 6e20  this assumption 
-000599d0: 6578 706c 6963 6974 6c79 0d0a 2020 2020  explicitly..    
-000599e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000599f0: 6966 2063 682e 7368 6f72 746e 616d 6520  if ch.shortname 
-00059a00: 3d3d 2073 656c 662e 5f6d 6170 7065 7273  == self._mappers
-00059a10: 5b64 696d 656e 7369 6f6e 5f69 6e64 6578  [dimension_index
-00059a20: 5d3a 0d0a 2020 2020 2020 2020 2020 2020  ]:..            
-00059a30: 2020 2020 2020 2020 2020 2020 2352 6574              #Ret
-00059a40: 7572 6e20 7468 6520 6669 7273 7420 6368  urn the first ch
-00059a50: 696c 6420 7765 2066 696e 6420 696e 2074  ild we find in t
-00059a60: 6865 2068 6965 7261 7263 6879 2077 6974  he hierarchy wit
-00059a70: 6820 7468 6520 6d61 7070 6564 2073 686f  h the mapped sho
-00059a80: 7274 636f 6465 0d0a 2020 2020 2020 2020  rtcode..        
-00059a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059aa0: 7265 7475 726e 205b 6368 5d0d 0a20 2020  return [ch]..   
-00059ab0: 2020 2020 2020 2020 2020 2020 2023 4966               #If
-00059ac0: 2064 6964 6e27 7420 7265 7475 726e 2061   didn't return a
-00059ad0: 2063 6869 6c64 2c20 7468 656e 2069 7420   child, then it 
-00059ae0: 6973 2070 6f73 7369 626c 6520 7468 6520  is possible the 
-00059af0: 6669 7273 745f 756e 6772 6f75 7065 645f  first_ungrouped_
-00059b00: 6368 696c 6472 656e 2069 7320 6120 7369  children is a si
-00059b10: 6e67 6c65 2067 726f 7570 6564 2065 6c65  ngle grouped ele
-00059b20: 6d65 6e74 0d0a 2020 2020 2020 2020 2020  ment..          
-00059b30: 2020 2020 2020 2349 6620 736f 2c20 7761        #If so, wa
-00059b40: 6c6b 2069 7420 616e 6420 7265 7475 726e  lk it and return
-00059b50: 2074 6865 2066 6972 7374 206f 6e65 2066   the first one f
-00059b60: 6f75 6e64 0d0a 2020 2020 2020 2020 2020  ound..          
-00059b70: 2020 2020 2020 6966 2066 6972 7374 5f75        if first_u
-00059b80: 6e67 726f 7570 6564 5f63 6869 6c64 7265  ngrouped_childre
-00059b90: 6e5b 305d 2e67 726f 7570 5f6f 6e6c 7920  n[0].group_only 
-00059ba0: 3d3d 2027 4772 6f75 7027 3a0d 0a20 2020  == 'Group':..   
-00059bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059bc0: 2066 6f72 2063 6820 696e 2066 6972 7374   for ch in first
-00059bd0: 5f75 6e67 726f 7570 6564 5f63 6869 6c64  _ungrouped_child
-00059be0: 7265 6e5b 305d 2e77 616c 6b28 293a 0d0a  ren[0].walk():..
-00059bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059c00: 2020 2020 2020 2020 2374 6869 7320 636f          #this co
-00059c10: 6465 2061 7373 756d 6573 2074 6861 7420  de assumes that 
-00059c20: 6120 6d61 7070 696e 6720 636f 6e74 6169  a mapping contai
-00059c30: 6e73 2061 2073 686f 7274 636f 6465 2066  ns a shortcode f
-00059c40: 6f72 2061 2043 6f6d 7061 7269 736f 6e0d  or a Comparison.
-00059c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00059c60: 2020 2020 2020 2020 2023 4974 2069 7320           #It is 
-00059c70: 6c69 6b65 6c79 2074 6861 7420 6974 276c  likely that it'l
-00059c80: 6c20 686f 6c64 2073 6f6d 6574 6869 6e67  l hold something
-00059c90: 206d 6f72 6520 736f 7068 6973 7469 6361   more sophistica
-00059ca0: 7465 642e 0d0a 2020 2020 2020 2020 2020  ted...          
-00059cb0: 2020 2020 2020 2020 2020 2020 2020 2357                #W
-00059cc0: 6865 6e20 6974 2064 6f65 7320 7468 6520  hen it does the 
-00059cd0: 7465 7374 7320 7769 6c6c 2062 7265 616b  tests will break
-00059ce0: 202d 2073 6f20 4927 7665 2073 7461 7465   - so I've state
-00059cf0: 6420 7468 6973 2061 7373 756d 7074 696f  d this assumptio
-00059d00: 6e20 6578 706c 6963 6974 6c79 0d0a 2020  n explicitly..  
-00059d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059d20: 2020 2020 2020 6966 2063 682e 7368 6f72        if ch.shor
-00059d30: 746e 616d 6520 3d3d 2073 656c 662e 5f6d  tname == self._m
-00059d40: 6170 7065 7273 5b64 696d 656e 7369 6f6e  appers[dimension
-00059d50: 5f69 6e64 6578 5d3a 0d0a 2020 2020 2020  _index]:..      
-00059d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059d70: 2020 2020 2020 2352 6574 7572 6e20 7468        #Return th
-00059d80: 6520 6669 7273 7420 6368 696c 6420 7765  e first child we
-00059d90: 2066 696e 6420 696e 2074 6865 2068 6965   find in the hie
-00059da0: 7261 7263 6879 2077 6974 6820 7468 6520  rarchy with the 
-00059db0: 6d61 7070 6564 2073 686f 7274 636f 6465  mapped shortcode
-00059dc0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00059dd0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00059de0: 7475 726e 205b 6368 5d0d 0a0d 0a20 2020  turn [ch]....   
-00059df0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00059e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00059e10: 7265 7475 726e 2066 6972 7374 5f75 6e67  return first_ung
-00059e20: 726f 7570 6564 5f63 6869 6c64 7265 6e0d  rouped_children.
-00059e30: 0a0d 0a20 2020 2064 6566 205f 6861 6e64  ...    def _hand
-00059e40: 6c65 5f6e 6f5f 6d61 7070 696e 675f 7369  le_no_mapping_si
-00059e50: 6e67 6c65 5f65 6c65 6d65 6e74 2873 656c  ngle_element(sel
-00059e60: 662c 6469 6d65 6e73 696f 6e5f 696e 6465  f,dimension_inde
-00059e70: 782c 6469 6d65 6e73 696f 6e5f 6e61 6d65  x,dimension_name
-00059e80: 293a 0d0a 2020 2020 2020 2020 6966 2069  ):..        if i
-00059e90: 7369 6e73 7461 6e63 6528 7365 6c66 2e74  sinstance(self.t
-00059ea0: 6172 6765 742e 7374 7275 6374 7572 6573  arget.structures
-00059eb0: 5b64 696d 656e 7369 6f6e 5f69 6e64 6578  [dimension_index
-00059ec0: 5d2c 5374 7275 6374 7572 6529 3a0d 0a20  ],Structure):.. 
-00059ed0: 2020 2020 2020 2020 2020 2023 4368 6563             #Chec
-00059ee0: 6b20 7468 6174 2074 6865 7265 2069 7320  k that there is 
-00059ef0: 6f6e 6c79 206f 6e65 2068 6965 7261 7263  only one hierarc
-00059f00: 6879 2c20 616e 6420 7468 6174 2074 6861  hy, and that tha
-00059f10: 7420 6869 6572 6172 6368 7920 6f6e 6c79  t hierarchy only
-00059f20: 2068 6173 2061 2073 696e 676c 6520 656c   has a single el
-00059f30: 656d 656e 740d 0a20 2020 2020 2020 2020  ement..         
-00059f40: 2020 2069 6620 6c65 6e28 7365 6c66 2e74     if len(self.t
-00059f50: 6172 6765 742e 7374 7275 6374 7572 6573  arget.structures
-00059f60: 5b64 696d 656e 7369 6f6e 5f69 6e64 6578  [dimension_index
-00059f70: 5d2e 6869 6572 6172 6368 6965 7329 203d  ].hierarchies) =
-00059f80: 3d20 3120 616e 6420 6c65 6e28 5b68 2066  = 1 and len([h f
-00059f90: 6f72 2068 2069 6e20 7365 6c66 2e74 6172  or h in self.tar
-00059fa0: 6765 742e 7374 7275 6374 7572 6573 5b64  get.structures[d
-00059fb0: 696d 656e 7369 6f6e 5f69 6e64 6578 5d2e  imension_index].
-00059fc0: 6869 6572 6172 6368 6965 735d 5b30 5d2e  hierarchies][0].
-00059fd0: 6368 696c 6472 656e 2920 3d3d 2030 3a0d  children) == 0:.
-00059fe0: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00059ff0: 2020 2068 203d 206c 6973 7428 7365 6c66     h = list(self
-0005a000: 2e74 6172 6765 742e 7374 7275 6374 7572  .target.structur
-0005a010: 6573 5b64 696d 656e 7369 6f6e 5f69 6e64  es[dimension_ind
-0005a020: 6578 5d2e 6869 6572 6172 6368 6965 7329  ex].hierarchies)
-0005a030: 5b30 5d0d 0a20 2020 2020 2020 2020 2020  [0]..           
-0005a040: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0005a050: 2e5f 6669 7273 745f 756e 6772 6f75 7065  ._first_ungroupe
-0005a060: 645f 6368 696c 6472 656e 2868 290d 0a0d  d_children(h)...
-0005a070: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0005a080: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0005a090: 2020 2020 7261 6973 6520 6d70 6578 2e4c      raise mpex.L
-0005a0a0: 6f61 6465 7253 6574 7570 4572 726f 7228  oaderSetupError(
-0005a0b0: 2746 6f63 7573 4c6f 6164 6572 2077 6974  'FocusLoader wit
-0005a0c0: 686f 7574 2061 6e79 206d 6170 7069 6e67  hout any mapping
-0005a0d0: 7320 6361 6e6e 6f74 2068 616e 646c 6520  s cannot handle 
-0005a0e0: 7b7d 2053 7472 7563 7475 7265 7320 7769  {} Structures wi
-0005a0f0: 7468 2061 6e79 7468 696e 6720 6f74 6865  th anything othe
-0005a100: 7220 7468 616e 2031 2068 6965 7261 7263  r than 1 hierarc
-0005a110: 6879 2077 6974 6820 6120 7369 6e67 6c65  hy with a single
-0005a120: 2065 6c65 6d65 6e74 2e20 5374 7275 6374   element. Struct
-0005a130: 7572 6520 7b7d 2068 6173 206d 6f72 6520  ure {} has more 
-0005a140: 7468 616e 206f 6e65 2065 6c65 6d65 6e74  than one element
-0005a150: 2e20 4368 6f6f 7365 2061 6e6f 7468 6572  . Choose another
-0005a160: 2053 7472 7563 7475 7265 206f 7220 6372   Structure or cr
-0005a170: 6561 7465 206d 6170 7069 6e67 7320 666f  eate mappings fo
-0005a180: 7220 7468 6520 6869 6572 6172 6368 7927  r the hierarchy'
-0005a190: 2e66 6f72 6d61 7428 6469 6d65 6e73 696f  .format(dimensio
-0005a1a0: 6e5f 6e61 6d65 2c73 656c 662e 7461 7267  n_name,self.targ
-0005a1b0: 6574 2e73 7472 7563 7475 7265 735b 6469  et.structures[di
-0005a1c0: 6d65 6e73 696f 6e5f 696e 6465 785d 2e6c  mension_index].l
-0005a1d0: 6f6e 676e 616d 6529 290d 0a20 2020 2020  ongname))..     
-0005a1e0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0005a1f0: 6365 2873 656c 662e 7461 7267 6574 2e73  ce(self.target.s
-0005a200: 7472 7563 7475 7265 735b 6469 6d65 6e73  tructures[dimens
-0005a210: 696f 6e5f 696e 6465 785d 2c53 7472 7563  ion_index],Struc
-0005a220: 7475 7265 456c 656d 656e 7429 3a0d 0a20  tureElement):.. 
-0005a230: 2020 2020 2020 2020 2020 2066 6972 7374             first
-0005a240: 5f75 6e67 726f 7570 6564 5f63 6869 6c64  _ungrouped_child
-0005a250: 7265 6e20 3d20 7365 6c66 2e5f 6669 7273  ren = self._firs
-0005a260: 745f 756e 6772 6f75 7065 645f 6368 696c  t_ungrouped_chil
-0005a270: 6472 656e 2873 656c 662e 7461 7267 6574  dren(self.target
-0005a280: 2e73 7472 7563 7475 7265 735b 6469 6d65  .structures[dime
-0005a290: 6e73 696f 6e5f 696e 6465 785d 290d 0a0d  nsion_index])...
-0005a2a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0005a2b0: 6c65 6e28 6669 7273 745f 756e 6772 6f75  len(first_ungrou
-0005a2c0: 7065 645f 6368 696c 6472 656e 2e63 6869  ped_children.chi
-0005a2d0: 6c64 7265 6e29 203d 3d20 303a 0d0a 2020  ldren) == 0:..  
-0005a2e0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0005a2f0: 7475 726e 2066 6972 7374 5f75 6e67 726f  turn first_ungro
-0005a300: 7570 6564 5f63 6869 6c64 7265 6e0d 0a20  uped_children.. 
-0005a310: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0005a320: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005a330: 2020 7261 6973 6520 6d70 6578 2e4c 6f61    raise mpex.Loa
-0005a340: 6465 7253 6574 7570 4572 726f 7228 2746  derSetupError('F
-0005a350: 6f63 7573 4c6f 6164 6572 2077 6974 686f  ocusLoader witho
-0005a360: 7574 2061 6e79 206d 6170 7069 6e67 7320  ut any mappings 
-0005a370: 6361 6e6e 6f74 2068 616e 646c 6520 7b7d  cannot handle {}
-0005a380: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
-0005a390: 7473 2077 6974 6820 616e 7974 6869 6e67  ts with anything
-0005a3a0: 206f 7468 6572 2074 6861 6e20 6120 7369   other than a si
-0005a3b0: 6e67 6c65 2065 6c65 6d65 6e74 2e20 5374  ngle element. St
-0005a3c0: 7275 6374 7572 6520 7b7d 2068 6173 206d  ructure {} has m
-0005a3d0: 6f72 6520 7468 616e 206f 6e65 2065 6c65  ore than one ele
-0005a3e0: 6d65 6e74 2e20 4368 6f6f 7365 2061 6e6f  ment. Choose ano
-0005a3f0: 7468 6572 2053 7472 7563 7475 7265 206f  ther Structure o
-0005a400: 7220 6372 6561 7465 206d 6170 7069 6e67  r create mapping
-0005a410: 7320 666f 7220 7468 6520 6869 6572 6172  s for the hierar
-0005a420: 6368 7927 2e66 6f72 6d61 7428 6469 6d65  chy'.format(dime
-0005a430: 6e73 696f 6e5f 6e61 6d65 2c73 656c 662e  nsion_name,self.
-0005a440: 7461 7267 6574 2e73 7472 7563 7475 7265  target.structure
-0005a450: 735b 6469 6d65 6e73 696f 6e5f 696e 6465  s[dimension_inde
-0005a460: 785d 2e6c 6f6e 676e 616d 6529 290d 0a0d  x].longname))...
-0005a470: 0a20 2020 2064 6566 205f 6861 6e64 6c65  .    def _handle
-0005a480: 5f65 6d70 7479 5f74 6172 6765 7428 7365  _empty_target(se
-0005a490: 6c66 293a 0d0a 2020 2020 2020 2020 6966  lf):..        if
-0005a4a0: 2073 656c 662e 7461 7267 6574 2069 7320   self.target is 
-0005a4b0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0005a4c0: 2020 2072 6169 7365 206d 7065 782e 4c6f     raise mpex.Lo
-0005a4d0: 6164 6572 5365 7475 7045 7272 6f72 2827  aderSetupError('
-0005a4e0: 4361 6e6e 6f74 2063 6f6d 7075 7465 2065  Cannot compute e
-0005a4f0: 6666 6563 7469 7665 2074 696d 6520 656c  ffective time el
-0005a500: 656d 656e 7473 2066 6f72 2061 2046 6f63  ements for a Foc
-0005a510: 7573 4c6f 6164 6572 2077 6869 6368 2068  usLoader which h
-0005a520: 6173 206e 6f20 7461 7267 6574 2056 6965  as no target Vie
-0005a530: 7770 6f69 6e74 206f 7220 466f 6375 7320  wpoint or Focus 
-0005a540: 7365 7427 290d 0a0d 0a20 2020 2064 6566  set')....    def
-0005a550: 205f 6765 745f 6869 6572 6172 6368 795f   _get_hierarchy_
-0005a560: 6469 7265 6374 5f6f 725f 7369 6e67 6c65  direct_or_single
-0005a570: 5f68 6965 7261 7263 6879 5f66 726f 6d5f  _hierarchy_from_
-0005a580: 7374 7275 6374 7572 6528 7365 6c66 2c64  structure(self,d
-0005a590: 696d 656e 7369 6f6e 5f69 6e64 6578 2c64  imension_index,d
-0005a5a0: 696d 656e 7369 6f6e 5f6e 616d 652c 656e  imension_name,en
-0005a5b0: 666f 7263 655f 7369 6e67 6c65 5f65 6c65  force_single_ele
-0005a5c0: 6d65 6e74 3d46 616c 7365 293a 0d0a 2020  ment=False):..  
-0005a5d0: 2020 2020 2020 2727 270d 0a0d 0a20 2020        '''....   
-0005a5e0: 2020 2020 203a 7061 7261 6d20 656e 666f       :param enfo
-0005a5f0: 7263 655f 7369 6e67 6c65 5f65 6c65 6d65  rce_single_eleme
-0005a600: 6e74 3a20 4966 2073 6574 2074 6f20 5472  nt: If set to Tr
-0005a610: 7565 2c20 7769 6c6c 2074 6872 6f77 6e20  ue, will thrown 
-0005a620: 616e 2065 7272 6f72 2069 6620 7468 6520  an error if the 
-0005a630: 7265 7475 726e 6564 2068 6965 7261 7263  returned hierarc
-0005a640: 6879 2064 6f65 7320 6e6f 7420 6861 7665  hy does not have
-0005a650: 2061 2073 696e 676c 6520 656c 656d 656e   a single elemen
-0005a660: 740d 0a20 2020 2020 2020 2027 2727 0d0a  t..        '''..
-0005a670: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0005a680: 6e73 7461 6e63 6528 7365 6c66 2e74 6172  nstance(self.tar
-0005a690: 6765 742e 7374 7275 6374 7572 6573 5b64  get.structures[d
-0005a6a0: 696d 656e 7369 6f6e 5f69 6e64 6578 5d2c  imension_index],
-0005a6b0: 5374 7275 6374 7572 6529 3a0d 0a20 2020  Structure):..   
-0005a6c0: 2020 2020 2020 2020 2023 4368 6563 6b20           #Check 
-0005a6d0: 7468 6174 2074 6865 7265 2069 7320 6f6e  that there is on
-0005a6e0: 6c79 206f 6e65 2068 6965 7261 7263 6879  ly one hierarchy
-0005a6f0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0005a700: 206c 656e 2873 656c 662e 7461 7267 6574   len(self.target
-0005a710: 2e73 7472 7563 7475 7265 735b 6469 6d65  .structures[dime
-0005a720: 6e73 696f 6e5f 696e 6465 785d 2e68 6965  nsion_index].hie
-0005a730: 7261 7263 6869 6573 2920 3d3d 2031 3a0d  rarchies) == 1:.
-0005a740: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005a750: 2069 6620 656e 666f 7263 655f 7369 6e67   if enforce_sing
-0005a760: 6c65 5f65 6c65 6d65 6e74 2061 6e64 206e  le_element and n
-0005a770: 6f74 206c 656e 285b 6820 666f 7220 6820  ot len([h for h 
-0005a780: 696e 2073 656c 662e 7461 7267 6574 2e73  in self.target.s
-0005a790: 7472 7563 7475 7265 735b 6469 6d65 6e73  tructures[dimens
-0005a7a0: 696f 6e5f 696e 6465 785d 2e68 6965 7261  ion_index].hiera
-0005a7b0: 7263 6869 6573 5d5b 305d 2e63 6869 6c64  rchies][0].child
-0005a7c0: 7265 6e29 203d 3d20 303a 0d0a 2020 2020  ren) == 0:..    
-0005a7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005a7e0: 2353 6f6d 6520 7573 6520 6361 7365 7320  #Some use cases 
-0005a7f0: 7265 7175 6972 6520 6f6e 6c79 2073 696e  require only sin
-0005a800: 676c 6520 656c 656d 656e 7420 6869 6572  gle element hier
-0005a810: 6172 6368 6965 7320 746f 2062 6520 7072  archies to be pr
-0005a820: 6573 656e 740d 0a20 2020 2020 2020 2020  esent..         
-0005a830: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0005a840: 206d 7065 782e 4c6f 6164 6572 5365 7475   mpex.LoaderSetu
-0005a850: 7045 7272 6f72 2827 466f 6375 734c 6f61  pError('FocusLoa
-0005a860: 6465 7220 7769 7468 6f75 7420 616e 7920  der without any 
-0005a870: 6d61 7070 696e 6773 2063 616e 6e6f 7420  mappings cannot 
-0005a880: 6861 6e64 6c65 207b 7d20 5374 7275 6374  handle {} Struct
-0005a890: 7572 6573 2077 6974 6820 616e 7974 6869  ures with anythi
-0005a8a0: 6e67 206f 7468 6572 2074 6861 6e20 3120  ng other than 1 
-0005a8b0: 6869 6572 6172 6368 7920 7769 7468 2061  hierarchy with a
-0005a8c0: 2073 696e 676c 6520 656c 656d 656e 742e   single element.
-0005a8d0: 2053 7472 7563 7475 7265 207b 7d20 6861   Structure {} ha
-0005a8e0: 7320 6d6f 7265 2074 6861 6e20 6f6e 6520  s more than one 
-0005a8f0: 656c 656d 656e 742e 2043 686f 6f73 6520  element. Choose 
-0005a900: 616e 6f74 6865 7220 5374 7275 6374 7572  another Structur
-0005a910: 6520 6f72 2063 7265 6174 6520 6d61 7070  e or create mapp
-0005a920: 696e 6773 2066 6f72 2074 6865 2068 6965  ings for the hie
-0005a930: 7261 7263 6879 272e 666f 726d 6174 2864  rarchy'.format(d
-0005a940: 696d 656e 7369 6f6e 5f6e 616d 652c 7365  imension_name,se
-0005a950: 6c66 2e74 6172 6765 742e 7374 7275 6374  lf.target.struct
-0005a960: 7572 6573 5b64 696d 656e 7369 6f6e 5f69  ures[dimension_i
-0005a970: 6e64 6578 5d2e 7368 6f72 746e 616d 6529  ndex].shortname)
-0005a980: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0005a990: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0005a9a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0005a9b0: 7475 726e 206c 6973 7428 7365 6c66 2e74  turn list(self.t
-0005a9c0: 6172 6765 742e 7374 7275 6374 7572 6573  arget.structures
-0005a9d0: 5b64 696d 656e 7369 6f6e 5f69 6e64 6578  [dimension_index
-0005a9e0: 5d2e 6869 6572 6172 6368 6965 7329 5b30  ].hierarchies)[0
-0005a9f0: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
-0005aa00: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0005aa10: 2020 2020 2020 7261 6973 6520 6d70 6578        raise mpex
-0005aa20: 2e4c 6f61 6465 7253 6574 7570 4572 726f  .LoaderSetupErro
-0005aa30: 7228 2746 6f63 7573 4c6f 6164 6572 2063  r('FocusLoader c
-0005aa40: 616e 6e6f 7420 6861 6e64 6c65 207b 7d20  annot handle {} 
-0005aa50: 5374 7275 6374 7572 6573 2077 6974 6820  Structures with 
-0005aa60: 616e 7974 6869 6e67 206f 7468 6572 2074  anything other t
-0005aa70: 6861 6e20 3120 6869 6572 6172 6368 792e  han 1 hierarchy.
-0005aa80: 2053 7472 7563 7475 7265 207b 7d20 6861   Structure {} ha
-0005aa90: 7320 6d75 6c74 6970 6c65 2068 6965 7261  s multiple hiera
-0005aaa0: 7263 6869 6573 203a 207b 7d2e 2043 686f  rchies : {}. Cho
-0005aab0: 6f73 6520 616e 6f74 6865 7220 5374 7275  ose another Stru
-0005aac0: 6374 7572 6520 6f72 2063 7265 6174 6520  cture or create 
-0005aad0: 6d61 7070 696e 6773 2066 6f72 2074 6865  mappings for the
-0005aae0: 207b 7d20 6869 6572 6172 6368 7927 2e66   {} hierarchy'.f
-0005aaf0: 6f72 6d61 7428 6469 6d65 6e73 696f 6e5f  ormat(dimension_
-0005ab00: 6e61 6d65 2c73 656c 662e 7461 7267 6574  name,self.target
-0005ab10: 2e73 7472 7563 7475 7265 735b 6469 6d65  .structures[dime
-0005ab20: 6e73 696f 6e5f 696e 6465 785d 2e6c 6f6e  nsion_index].lon
-0005ab30: 676e 616d 652c 272c 272e 6a6f 696e 285b  gname,','.join([
-0005ab40: 682e 7368 6f72 746e 616d 6520 666f 7220  h.shortname for 
-0005ab50: 6820 696e 2073 656c 662e 7461 7267 6574  h in self.target
-0005ab60: 2e73 7472 7563 7475 7265 735b 6469 6d65  .structures[dime
-0005ab70: 6e73 696f 6e5f 696e 6465 785d 2e68 6965  nsion_index].hie
-0005ab80: 7261 7263 6869 6573 5d29 2c64 696d 656e  rarchies]),dimen
-0005ab90: 7369 6f6e 5f6e 616d 6529 290d 0a20 2020  sion_name))..   
-0005aba0: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-0005abb0: 616e 6365 2873 656c 662e 7461 7267 6574  ance(self.target
-0005abc0: 2e73 7472 7563 7475 7265 735b 6469 6d65  .structures[dime
-0005abd0: 6e73 696f 6e5f 696e 6465 785d 2c53 7472  nsion_index],Str
-0005abe0: 7563 7475 7265 456c 656d 656e 7429 3a0d  uctureElement):.
-0005abf0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0005ac00: 7572 6e20 7365 6c66 2e74 6172 6765 742e  urn self.target.
-0005ac10: 7374 7275 6374 7572 6573 5b64 696d 656e  structures[dimen
-0005ac20: 7369 6f6e 5f69 6e64 6578 5d0d 0a0d 0a20  sion_index].... 
-0005ac30: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-0005ac40: 2020 6465 6620 6566 6665 6374 6976 655f    def effective_
-0005ac50: 696e 6469 6361 746f 725f 656c 656d 656e  indicator_elemen
-0005ac60: 7473 2873 656c 6629 3a0d 0a20 2020 2020  ts(self):..     
-0005ac70: 2020 2023 5f67 6574 5f69 6d70 6c69 6564     #_get_implied
-0005ac80: 5f73 686f 7274 636f 6465 5f6c 6973 745f  _shortcode_list_
-0005ac90: 616e 645f 6d61 7070 696e 675f 7479 7065  and_mapping_type
-0005aca0: 0d0a 2020 2020 2020 2020 6469 6d65 6e73  ..        dimens
-0005acb0: 696f 6e5f 696e 6465 7820 3d20 380d 0a20  ion_index = 8.. 
-0005acc0: 2020 2020 2020 2073 656c 662e 5f68 616e         self._han
-0005acd0: 646c 655f 656d 7074 795f 7461 7267 6574  dle_empty_target
-0005ace0: 2829 0d0a 0d0a 2020 2020 2020 2020 2357  ()....        #W
-0005acf0: 6865 7265 2074 6865 7265 2061 7265 206e  here there are n
-0005ad00: 6f20 6d61 7070 696e 6773 2077 6520 6172  o mappings we ar
-0005ad10: 6520 6861 7070 7920 746f 2075 7365 2061  e happy to use a
-0005ad20: 2073 696e 676c 6520 656c 656d 656e 7420   single element 
-0005ad30: 6966 206f 6e65 2069 7320 6176 6169 6c61  if one is availa
-0005ad40: 626c 650d 0a20 2020 2020 2020 2069 6620  ble..        if 
-0005ad50: 7365 6c66 2e5f 6d61 7070 6572 7320 6973  self._mappers is
-0005ad60: 204e 6f6e 6520 6f72 2073 656c 662e 5f6d   None or self._m
-0005ad70: 6170 7065 7273 5b64 696d 656e 7369 6f6e  appers[dimension
-0005ad80: 5f69 6e64 6578 5d20 6973 204e 6f6e 653a  _index] is None:
-0005ad90: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-0005ada0: 6c66 2e5f 6861 6e64 6c65 5f6e 6f5f 6d61  lf._handle_no_ma
-0005adb0: 7070 696e 675f 7369 6e67 6c65 5f65 6c65  pping_single_ele
-0005adc0: 6d65 6e74 2864 696d 656e 7369 6f6e 5f69  ment(dimension_i
-0005add0: 6e64 6578 3d64 696d 656e 7369 6f6e 5f69  ndex=dimension_i
-0005ade0: 6e64 6578 2c64 696d 656e 7369 6f6e 5f6e  ndex,dimension_n
-0005adf0: 616d 653d 2749 6e64 6963 6174 6f72 2729  ame='Indicator')
-0005ae00: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0005ae10: 0a20 2020 2020 2020 2020 2020 2065 6666  .            eff
-0005ae20: 6563 7469 7665 5f65 6c65 6d65 6e74 732c  ective_elements,
-0005ae30: 206d 6170 7069 6e67 5f74 7970 652c 636f   mapping_type,co
-0005ae40: 6c75 6d6e 5f6e 616d 6573 203d 2073 656c  lumn_names = sel
-0005ae50: 662e 5f67 6574 5f69 6d70 6c69 6564 5f73  f._get_implied_s
-0005ae60: 686f 7274 636f 6465 5f6c 6973 745f 616e  hortcode_list_an
-0005ae70: 645f 6d61 7070 696e 675f 7479 7065 2864  d_mapping_type(d
-0005ae80: 696d 656e 7369 6f6e 5f69 6e64 6578 203d  imension_index =
-0005ae90: 2064 696d 656e 7369 6f6e 5f69 6e64 6578   dimension_index
-0005aea0: 2c20 6f62 6a65 6374 5f74 6f5f 6368 6563  , object_to_chec
-0005aeb0: 6b5f 6167 6169 6e73 7420 3d73 656c 662e  k_against =self.
-0005aec0: 7461 7267 6574 2e73 7472 7563 7475 7265  target.structure
-0005aed0: 735b 6469 6d65 6e73 696f 6e5f 696e 6465  s[dimension_inde
-0005aee0: 785d 290d 0a0d 0a20 2020 2020 2020 2020  x])....         
-0005aef0: 2020 2069 6620 6d61 7070 696e 675f 7479     if mapping_ty
-0005af00: 7065 203d 3d27 636f 6e73 7461 6e74 2073  pe =='constant s
-0005af10: 686f 7274 6e61 6d65 273a 0d0a 2020 2020  hortname':..    
-0005af20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0005af30: 726e 0d0a 2020 2020 2020 2020 2020 2020  rn..            
-0005af40: 656c 6966 206d 6170 7069 6e67 5f74 7970  elif mapping_typ
-0005af50: 6520 3d3d 2763 6f6c 756d 6e20 6e61 6d65  e =='column name
-0005af60: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-0005af70: 2020 2020 7265 7475 726e 0d0a 2020 2020      return..    
-0005af80: 2020 2020 2020 2020 656c 6966 206d 6170          elif map
-0005af90: 7069 6e67 5f74 7970 6520 3d3d 2763 6f6c  ping_type =='col
-0005afa0: 756d 6e73 2074 6f20 6669 656c 6473 273a  umns to fields':
-0005afb0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005afc0: 2020 7265 7475 726e 0d0a 2020 2020 2020    return..      
-0005afd0: 2020 2020 2020 656c 6966 206d 6170 7069        elif mappi
-0005afe0: 6e67 5f74 7970 6520 3d3d 2763 6f6c 756d  ng_type =='colum
-0005aff0: 6e73 2074 6f20 7368 6f72 746e 616d 6573  ns to shortnames
-0005b000: 273a 0d0a 0d0a 2020 2020 2020 2020 2020  ':....          
-0005b010: 2020 2020 2020 2372 6574 7572 6e20 7468        #return th
-0005b020: 6520 6669 7273 7420 5374 7275 6374 7572  e first Structur
-0005b030: 6565 6c65 6d65 6e74 7320 7765 2066 696e  eelements we fin
-0005b040: 6420 7769 7468 2074 6865 0d0a 2020 2020  d with the..    
-0005b050: 2020 2020 2020 2020 2020 2020 6669 6c74              filt
-0005b060: 6572 6564 5f65 6c65 6d65 6e74 7320 3d20  ered_elements = 
-0005b070: 5b5d 0d0a 0d0a 2020 2020 2020 2020 2020  []....          
-0005b080: 2020 2020 2020 2345 6974 6865 7220 6765        #Either ge
-0005b090: 7420 7468 6520 6669 7273 7420 6869 6572  t the first hier
-0005b0a0: 6172 6368 7920 696e 2061 2073 696e 676c  archy in a singl
-0005b0b0: 6520 6869 6572 6172 6368 7920 5374 7275  e hierarchy Stru
-0005b0c0: 6374 7572 6520 6f72 2067 6574 2074 6865  cture or get the
-0005b0d0: 2068 6965 7261 7263 6879 2070 6173 7365   hierarchy passe
-0005b0e0: 6420 696e 202d 2077 6869 6368 6576 6572  d in - whichever
-0005b0f0: 2069 7420 7761 730d 0a20 2020 2020 2020   it was..       
-0005b100: 2020 2020 2020 2020 2068 6965 7261 7263           hierarc
-0005b110: 6879 203d 2073 656c 662e 5f67 6574 5f68  hy = self._get_h
-0005b120: 6965 7261 7263 6879 5f64 6972 6563 745f  ierarchy_direct_
-0005b130: 6f72 5f73 696e 676c 655f 6869 6572 6172  or_single_hierar
-0005b140: 6368 795f 6672 6f6d 5f73 7472 7563 7475  chy_from_structu
-0005b150: 7265 2864 696d 656e 7369 6f6e 5f69 6e64  re(dimension_ind
-0005b160: 6578 3d64 696d 656e 7369 6f6e 5f69 6e64  ex=dimension_ind
-0005b170: 6578 2c64 696d 656e 7369 6f6e 5f6e 616d  ex,dimension_nam
-0005b180: 653d 2749 6e64 6963 6174 6f72 2729 0d0a  e='Indicator')..
-0005b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b1a0: 2357 6527 7665 2061 7373 756d 6564 2074  #We've assumed t
-0005b1b0: 6861 7420 6566 6665 6374 6976 655f 656c  hat effective_el
-0005b1c0: 656d 656e 7473 2069 7320 6120 6c69 7374  ements is a list
-0005b1d0: 206f 6620 7368 6f72 746e 616d 6573 0d0a   of shortnames..
-0005b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b1f0: 666f 7220 7368 6f72 746e 616d 6520 696e  for shortname in
-0005b200: 2065 6666 6563 7469 7665 5f65 6c65 6d65   effective_eleme
-0005b210: 6e74 733a 0d0a 2020 2020 2020 2020 2020  nts:..          
-0005b220: 2020 2020 2020 2020 2020 666f 756e 645f            found_
-0005b230: 656c 656d 656e 7473 203d 2068 6965 7261  elements = hiera
-0005b240: 7263 6879 2e67 6574 5f65 6c65 6d65 6e74  rchy.get_element
-0005b250: 7328 7368 6f72 746e 616d 6529 0d0a 2020  s(shortname)..  
-0005b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b270: 2020 2341 7070 656e 6420 7468 6520 6669    #Append the fi
-0005b280: 7273 7420 696e 7374 616e 6365 206f 6620  rst instance of 
-0005b290: 616e 7920 656c 656d 656e 7473 2077 6520  any elements we 
-0005b2a0: 6669 6e64 0d0a 2020 2020 2020 2020 2020  find..          
-0005b2b0: 2020 2020 2020 2020 2020 2369 6620 7765            #if we
-0005b2c0: 2064 6f6e 2774 2066 696e 6420 6f6e 652c   don't find one,
-0005b2d0: 2064 6f65 736e 2774 206d 6174 7465 7220   doesn't matter 
-0005b2e0: 2849 2074 6869 6e6b 290d 0a20 2020 2020  (I think)..     
-0005b2f0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0005b300: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-0005b310: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0005b320: 7465 7265 645f 656c 656d 656e 7473 2e61  tered_elements.a
-0005b330: 7070 656e 6428 666f 756e 645f 656c 656d  ppend(found_elem
-0005b340: 656e 7473 5b30 5d20 290d 0a20 2020 2020  ents[0] )..     
-0005b350: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0005b360: 7863 6570 7420 496e 6465 7845 7272 6f72  xcept IndexError
-0005b370: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0005b380: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
-0005b390: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-0005b3a0: 2020 2072 6574 7572 6e20 6669 6c74 6572     return filter
-0005b3b0: 6564 5f65 6c65 6d65 6e74 730d 0a0d 0a20  ed_elements.... 
-0005b3c0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-0005b3d0: 6d61 7070 696e 675f 7479 7065 203d 3d27  mapping_type =='
-0005b3e0: 636f 6c75 6d6e 2074 6f20 7368 6f72 746e  column to shortn
-0005b3f0: 616d 6520 746f 2076 616c 7565 273a 0d0a  ame to value':..
-0005b400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005b410: 7265 7475 726e 0d0a 0d0a 2020 2020 4070  return....    @p
-0005b420: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-0005b430: 2065 6666 6563 7469 7665 5f63 6f6d 7061   effective_compa
-0005b440: 7269 736f 6e5f 656c 656d 656e 7473 2873  rison_elements(s
-0005b450: 656c 6629 3a0d 0a20 2020 2020 2020 2023  elf):..        #
-0005b460: 436f 6d70 6172 6973 6f6e 2062 6568 6176  Comparison behav
-0005b470: 6573 206a 7573 7420 6c69 6b65 2061 2075  es just like a u
-0005b480: 6e69 7420 6469 6d65 6e73 696f 6e2c 2073  nit dimension, s
-0005b490: 6f20 7765 2073 686f 756c 6420 6265 2061  o we should be a
-0005b4a0: 626c 6520 746f 2072 6575 7365 2074 6865  ble to reuse the
-0005b4b0: 2063 6f64 650d 0a20 2020 2020 2020 2064   code..        d
-0005b4c0: 696d 656e 7369 6f6e 5f69 6e64 6578 203d  imension_index =
-0005b4d0: 2039 0d0a 0d0a 2020 2020 2020 2020 6966   9....        if
-0005b4e0: 2073 656c 662e 5f6d 6170 7065 7273 5b64   self._mappers[d
-0005b4f0: 696d 656e 7369 6f6e 5f69 6e64 6578 5d20  imension_index] 
-0005b500: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-0005b510: 6e6f 7420 6973 696e 7374 616e 6365 2873  not isinstance(s
-0005b520: 656c 662e 5f6d 6170 7065 7273 5b64 696d  elf._mappers[dim
-0005b530: 656e 7369 6f6e 5f69 6e64 6578 5d2c 7374  ension_index],st
-0005b540: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
-0005b550: 2072 6169 7365 206d 7065 782e 4c6f 6164   raise mpex.Load
-0005b560: 6572 5365 7475 7045 7272 6f72 2827 4d61  erSetupError('Ma
-0005b570: 7070 696e 6720 666f 7220 7468 6520 436f  pping for the Co
-0005b580: 6d70 6172 6973 6f6e 2073 7472 7563 7475  mparison structu
-0005b590: 7265 206f 6620 6120 466f 6375 734c 6f61  re of a FocusLoa
-0005b5a0: 6465 7220 6d75 7374 2062 6520 6120 7369  der must be a si
-0005b5b0: 6e67 6c65 2073 686f 7274 6e61 6d65 2073  ngle shortname s
-0005b5c0: 7472 696e 6720 6f72 2073 696e 676c 6520  tring or single 
-0005b5d0: 636f 6c75 6d6e 206e 616d 6520 616e 6420  column name and 
-0005b5e0: 6e6f 7420 7b7d 272e 666f 726d 6174 2873  not {}'.format(s
-0005b5f0: 656c 662e 5f6d 6170 7065 7273 5b64 696d  elf._mappers[dim
-0005b600: 656e 7369 6f6e 5f69 6e64 6578 5d29 290d  ension_index])).
-0005b610: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
-0005b620: 6e20 7365 6c66 2e65 6666 6563 7469 7665  n self.effective
-0005b630: 5f75 6e69 745f 6469 6d65 6e73 696f 6e5f  _unit_dimension_
-0005b640: 656c 656d 656e 7473 2864 696d 656e 7369  elements(dimensi
-0005b650: 6f6e 5f69 6e64 6578 290d 0a0d 0a20 2020  on_index)....   
-0005b660: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-0005b670: 6465 6620 6566 6665 6374 6976 655f 6375  def effective_cu
-0005b680: 7272 656e 6379 5f65 6c65 6d65 6e74 7328  rrency_elements(
-0005b690: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-0005b6a0: 6469 6d65 6e73 696f 6e5f 696e 6465 7820  dimension_index 
-0005b6b0: 3d20 3130 0d0a 2020 2020 2020 2020 2373  = 10..        #s
-0005b6c0: 656c 662e 5f68 616e 646c 655f 656d 7074  elf._handle_empt
-0005b6d0: 795f 7461 7267 6574 2829 0d0a 0d0a 2020  y_target()....  
-0005b6e0: 2020 2020 2020 2323 5768 6572 6520 7468        ##Where th
-0005b6f0: 6572 6520 6172 6520 6e6f 206d 6170 7069  ere are no mappi
-0005b700: 6e67 7320 7765 2061 7265 2068 6170 7079  ngs we are happy
-0005b710: 2074 6f20 7573 6520 6120 7369 6e67 6c65   to use a single
-0005b720: 2065 6c65 6d65 6e74 2069 6620 6f6e 6520   element if one 
-0005b730: 6973 2061 7661 696c 6162 6c65 0d0a 2020  is available..  
-0005b740: 2020 2020 2020 2369 6620 7365 6c66 2e5f        #if self._
-0005b750: 6d61 7070 6572 7320 6973 204e 6f6e 6520  mappers is None 
-0005b760: 6f72 2073 656c 662e 5f6d 6170 7065 7273  or self._mappers
-0005b770: 5b64 696d 656e 7369 6f6e 5f69 6e64 6578  [dimension_index
-0005b780: 5d20 6973 204e 6f6e 653a 0d0a 2020 2020  ] is None:..    
-0005b790: 2020 2020 2320 2020 2068 6965 7261 7263      #    hierarc
-0005b7a0: 6879 203d 2073 656c 662e 5f67 6574 5f68  hy = self._get_h
-0005b7b0: 6965 7261 7263 6879 5f64 6972 6563 745f  ierarchy_direct_
-0005b7c0: 6f72 5f73 696e 676c 655f 6869 6572 6172  or_single_hierar
-0005b7d0: 6368 795f 6672 6f6d 5f73 7472 7563 7475  chy_from_structu
-0005b7e0: 7265 2864 696d 656e 7369 6f6e 5f69 6e64  re(dimension_ind
-0005b7f0: 6578 3d64 696d 656e 7369 6f6e 5f69 6e64  ex=dimension_ind
-0005b800: 6578 2c64 696d 656e 7369 6f6e 5f6e 616d  ex,dimension_nam
-0005b810: 653d 2743 7572 7265 6e63 7927 2c65 6e66  e='Currency',enf
-0005b820: 6f72 6365 5f73 696e 676c 655f 656c 656d  orce_single_elem
-0005b830: 656e 743d 5472 7565 290d 0a20 2020 2020  ent=True)..     
-0005b840: 2020 2023 2020 2020 6669 7273 745f 756e     #    first_un
-0005b850: 6772 6f75 7065 645f 6368 696c 6472 656e  grouped_children
-0005b860: 203d 2073 656c 662e 5f66 6972 7374 5f75   = self._first_u
-0005b870: 6e67 726f 7570 6564 5f63 6869 6c64 7265  ngrouped_childre
-0005b880: 6e28 6869 6572 6172 6368 7929 0d0a 2020  n(hierarchy)..  
-0005b890: 2020 2020 2020 2320 2020 2072 6574 7572        #    retur
-0005b8a0: 6e20 6669 7273 745f 756e 6772 6f75 7065  n first_ungroupe
-0005b8b0: 645f 6368 696c 6472 656e 0d0a 2020 2020  d_children..    
-0005b8c0: 2020 2020 2365 6c73 653a 0d0a 2020 2020      #else:..    
-0005b8d0: 2020 2020 2320 2020 2023 4569 7468 6572      #    #Either
-0005b8e0: 2067 6574 2074 6865 2066 6972 7374 2068   get the first h
-0005b8f0: 6965 7261 7263 6879 2069 6e20 6120 7369  ierarchy in a si
-0005b900: 6e67 6c65 2068 6965 7261 7263 6879 2053  ngle hierarchy S
-0005b910: 7472 7563 7475 7265 206f 7220 6765 7420  tructure or get 
-0005b920: 7468 6520 6869 6572 6172 6368 7920 7061  the hierarchy pa
-0005b930: 7373 6564 2069 6e20 2d20 7768 6963 6865  ssed in - whiche
-0005b940: 7665 7220 6974 2077 6173 0d0a 2020 2020  ver it was..    
-0005b950: 2020 2020 2320 2020 2068 6965 7261 7263      #    hierarc
-0005b960: 6879 203d 2073 656c 662e 5f67 6574 5f68  hy = self._get_h
-0005b970: 6965 7261 7263 6879 5f64 6972 6563 745f  ierarchy_direct_
-0005b980: 6f72 5f73 696e 676c 655f 6869 6572 6172  or_single_hierar
-0005b990: 6368 795f 6672 6f6d 5f73 7472 7563 7475  chy_from_structu
-0005b9a0: 7265 2864 696d 656e 7369 6f6e 5f69 6e64  re(dimension_ind
-0005b9b0: 6578 3d64 696d 656e 7369 6f6e 5f69 6e64  ex=dimension_ind
-0005b9c0: 6578 2c64 696d 656e 7369 6f6e 5f6e 616d  ex,dimension_nam
-0005b9d0: 653d 2743 7572 7265 6e63 7927 290d 0a20  e='Currency').. 
-0005b9e0: 2020 2020 2020 2023 2020 2020 6669 7273         #    firs
-0005b9f0: 745f 756e 6772 6f75 7065 645f 6368 696c  t_ungrouped_chil
-0005ba00: 6472 656e 203d 2020 7365 6c66 2e5f 6669  dren =  self._fi
-0005ba10: 7273 745f 756e 6772 6f75 7065 645f 6368  rst_ungrouped_ch
-0005ba20: 696c 6472 656e 2868 6965 7261 7263 6879  ildren(hierarchy
-0005ba30: 290d 0a20 2020 2020 2020 2023 0d0a 2020  )..        #..  
-0005ba40: 2020 2020 2020 2320 2020 2023 4368 6563        #    #Chec
-0005ba50: 6b20 7468 6174 2065 6163 6820 656c 656d  k that each elem
-0005ba60: 656e 7420 696e 2066 6972 7374 5f75 6e67  ent in first_ung
-0005ba70: 726f 7570 6564 5f63 6869 6c64 7265 6e20  rouped_children 
-0005ba80: 6973 2061 2073 696e 676c 6520 656c 656d  is a single elem
-0005ba90: 656e 7420 2d20 692e 652e 2068 6173 206e  ent - i.e. has n
-0005baa0: 6f20 6869 6572 6172 6368 790d 0a20 2020  o hierarchy..   
-0005bab0: 2020 2020 2023 2020 2020 666f 7220 6820       #    for h 
-0005bac0: 696e 2066 6972 7374 5f75 6e67 726f 7570  in first_ungroup
-0005bad0: 6564 5f63 6869 6c64 7265 6e3a 0d0a 2020  ed_children:..  
-0005bae0: 2020 2020 2020 2320 2020 2020 2020 2069        #        i
-0005baf0: 6620 6c65 6e28 682e 6368 696c 6472 656e  f len(h.children
-0005bb00: 2920 3e20 303a 0d0a 2020 2020 2020 2020  ) > 0:..        
-0005bb10: 2320 2020 2020 2020 2020 2020 2072 6169  #            rai
-0005bb20: 7365 206d 7065 782e 4c6f 6164 6572 5365  se mpex.LoaderSe
-0005bb30: 7475 7045 7272 6f72 2827 466f 6375 734c  tupError('FocusL
-0005bb40: 6f61 6465 7220 6361 6e6e 6f74 2068 616e  oader cannot han
-0005bb50: 646c 6520 4375 7272 656e 6379 2053 7472  dle Currency Str
-0005bb60: 7563 7475 7265 456c 656d 656e 7473 2077  uctureElements w
-0005bb70: 6974 6820 616e 7974 6869 6e67 206d 6f72  ith anything mor
-0005bb80: 6520 7468 616e 2061 2073 696e 676c 6520  e than a single 
-0005bb90: 666c 6174 2073 7472 7563 7475 7265 2c20  flat structure, 
-0005bba0: 6f72 2061 2073 696e 676c 6520 6772 6f75  or a single grou
-0005bbb0: 7065 6420 666c 6174 2073 7472 7563 7475  ped flat structu
-0005bbc0: 7265 2e20 7b7d 272e 666f 726d 6174 2873  re. {}'.format(s
-0005bbd0: 656c 662e 7461 7267 6574 2e73 7472 7563  elf.target.struc
-0005bbe0: 7475 7265 735b 6469 6d65 6e73 696f 6e5f  tures[dimension_
-0005bbf0: 696e 6465 785d 2e6c 6f6e 676e 616d 6529  index].longname)
-0005bc00: 290d 0a20 2020 2020 2020 2023 0d0a 2020  )..        #..  
-0005bc10: 2020 2020 2020 2320 2020 2072 6574 7572        #    retur
-0005bc20: 6e20 6669 7273 745f 756e 6772 6f75 7065  n first_ungroupe
-0005bc30: 645f 6368 696c 6472 656e 0d0a 0d0a 2020  d_children....  
-0005bc40: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0005bc50: 662e 6566 6665 6374 6976 655f 756e 6974  f.effective_unit
-0005bc60: 5f64 696d 656e 7369 6f6e 5f65 6c65 6d65  _dimension_eleme
-0005bc70: 6e74 7328 6469 6d65 6e73 696f 6e5f 696e  nts(dimension_in
-0005bc80: 6465 7829 0d0a 0d0a 0d0a 2020 2020 4070  dex)......    @p
-0005bc90: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
-0005bca0: 2065 6666 6563 7469 7665 5f74 7261 6e73   effective_trans
-0005bcb0: 666f 726d 5f65 6c65 6d65 6e74 7328 7365  form_elements(se
-0005bcc0: 6c66 293a 0d0a 2020 2020 2020 2020 2727  lf):..        ''
-0005bcd0: 2747 6574 2074 6865 2065 6666 6563 7469  'Get the effecti
-0005bce0: 7665 2053 7472 7563 7475 7265 2045 6c65  ve Structure Ele
-0005bcf0: 6d65 6e74 7320 6672 6f6d 2074 6865 2054  ments from the T
-0005bd00: 7261 6e73 666f 726d 2064 696d 656e 7369  ransform dimensi
-0005bd10: 6f6e 0d0a 2020 2020 2020 2020 5765 206a  on..        We j
-0005bd20: 7573 7420 7761 6e74 2074 6865 2066 6972  ust want the fir
-0005bd30: 7374 2027 5261 7727 2065 6c65 6d65 6e74  st 'Raw' element
-0005bd40: 2069 6e20 7468 6520 5669 6577 706f 696e   in the Viewpoin
-0005bd50: 7420 2d20 7765 2064 6f6e 2774 2063 6172  t - we don't car
-0005bd60: 6520 686f 7720 6d61 6e79 2068 6965 7261  e how many hiera
-0005bd70: 7263 6869 6573 2074 6865 2076 6965 7770  rchies the viewp
-0005bd80: 6f69 6e74 2068 6173 202d 2073 696e 6365  oint has - since
-0005bd90: 2061 6c6c 2052 6177 2065 6c65 6d65 6e74   all Raw element
-0005bda0: 7320 6172 6520 7574 7465 726c 7920 6571  s are utterly eq
-0005bdb0: 7569 7661 6c65 6e74 0d0a 2020 2020 2020  uivalent..      
-0005bdc0: 2020 2727 270d 0a0d 0a20 2020 2020 2020    '''....       
-0005bdd0: 2064 696d 656e 7369 6f6e 5f69 6e64 6578   dimension_index
-0005bde0: 203d 2031 320d 0a20 2020 2020 2020 2073   = 12..        s
-0005bdf0: 656c 662e 5f68 616e 646c 655f 656d 7074  elf._handle_empt
-0005be00: 795f 7461 7267 6574 2829 0d0a 0d0a 2020  y_target()....  
-0005be10: 2020 2020 2020 2357 6520 6172 6520 6e6f        #We are no
-0005be20: 7420 696e 7465 7265 7374 6564 2069 6e20  t interested in 
-0005be30: 7468 6520 6d61 7070 696e 6773 0d0a 0d0a  the mappings....
-0005be40: 2020 2020 2020 2020 666f 7220 7365 2069          for se i
-0005be50: 6e20 7365 6c66 2e74 6172 6765 742e 7374  n self.target.st
-0005be60: 7275 6374 7572 6573 5b64 696d 656e 7369  ructures[dimensi
-0005be70: 6f6e 5f69 6e64 6578 5d2e 7761 6c6b 2829  on_index].walk()
-0005be80: 3a0d 0a20 2020 2020 2020 2020 2020 2069  :..            i
-0005be90: 6620 7365 2e66 6965 6c64 735b 2743 616c  f se.fields['Cal
-0005bea0: 6375 6c61 7469 6f6e 2053 7461 7475 7327  culation Status'
-0005beb0: 5d20 3d3d 2027 5265 616c 2720 616e 6420  ] == 'Real' and 
-0005bec0: 7365 2e66 6965 6c64 735b 2747 726f 7570  se.fields['Group
-0005bed0: 204f 6e6c 7927 5d20 6973 204e 6f6e 653a   Only'] is None:
-0005bee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005bef0: 2020 7265 7475 726e 205b 7365 5d0d 0a0d    return [se]...
-0005bf00: 0a20 2020 2020 2020 2072 6169 7365 206d  .        raise m
-0005bf10: 7065 782e 4c6f 6164 6572 5365 7475 7045  pex.LoaderSetupE
-0005bf20: 7272 6f72 2827 466f 6375 734c 6f61 6465  rror('FocusLoade
-0005bf30: 7220 6361 6e6e 6f74 2068 616e 646c 6520  r cannot handle 
-0005bf40: 6120 5472 616e 7366 6f72 6d61 7469 6f6e  a Transformation
-0005bf50: 2053 7472 7563 7475 7265 2022 7b7d 2220   Structure "{}" 
-0005bf60: 7768 6963 6820 646f 6573 206e 6f74 2063  which does not c
-0005bf70: 6f6e 7461 696e 2061 6e79 2052 6561 6c20  ontain any Real 
-0005bf80: 656c 656d 656e 7473 2e27 2e66 6f72 6d61  elements.'.forma
-0005bf90: 7428 7365 6c66 2e74 6172 6765 742e 7374  t(self.target.st
-0005bfa0: 7275 6374 7572 6573 5b64 696d 656e 7369  ructures[dimensi
-0005bfb0: 6f6e 5f69 6e64 6578 5d2e 6c6f 6e67 6e61  on_index].longna
-0005bfc0: 6d65 2929 0d0a 0d0a 0d0a 2323 2323 2323  me))......######
-0005bfd0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0005bfe0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0005bff0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0005c000: 2323 2323 2323 2323 2323 2323 2323 0d0a  ##############..
-0005c010: 0d0a 636c 6173 7320 4c6f 6164 6572 286f  ..class Loader(o
-0005c020: 626a 6563 7429 3a0d 0a20 2020 2027 2727  bject):..    '''
-0005c030: 5472 616e 7361 6374 696f 6e61 6c20 6461  Transactional da
-0005c040: 7461 2069 7320 6c6f 6164 6564 2069 6e74  ta is loaded int
-0005c050: 6f20 456d 706f 7765 7220 5369 7465 7320  o Empower Sites 
-0005c060: 2d20 7468 6973 206f 626a 6563 7420 6c6f  - this object lo
-0005c070: 6164 7320 6974 2727 270d 0a0d 0a20 2020  ads it'''....   
-0005c080: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-0005c090: 6c66 2c73 6f75 7263 653d 4e6f 6e65 2c73  lf,source=None,s
-0005c0a0: 6974 653d 4e6f 6e65 2c6c 6f67 6769 6e67  ite=None,logging
-0005c0b0: 5f71 7565 7565 3d4e 6f6e 652c 6465 6c74  _queue=None,delt
-0005c0c0: 613d 5472 7565 2c69 6465 6e74 6966 6965  a=True,identifie
-0005c0d0: 725f 636f 6c75 6d6e 733d 4e6f 6e65 2c6e  r_columns=None,n
-0005c0e0: 616d 653d 276c 6f61 6465 725f 3027 2c73  ame='loader_0',s
-0005c0f0: 6166 655f 6c6f 6164 3d54 7275 652c 656d  afe_load=True,em
-0005c100: 706f 7765 725f 7065 7269 6f64 5f74 7970  power_period_typ
-0005c110: 653d 6c6c 752e 454d 504f 5745 525f 4d4f  e=llu.EMPOWER_MO
-0005c120: 4e54 485f 434f 4e53 5441 4e54 2c65 6d70  NTH_CONSTANT,emp
-0005c130: 6f77 6572 5f69 6d70 6f72 7465 725f 6578  ower_importer_ex
-0005c140: 6563 7574 6162 6c65 3d6c 6c75 2e45 4d50  ecutable=llu.EMP
-0005c150: 4f57 4552 5f49 4d50 4f52 5445 525f 4558  OWER_IMPORTER_EX
-0005c160: 4543 5554 4142 4c45 293a 0d0a 2020 2020  ECUTABLE):..    
-0005c170: 2020 2020 2727 270d 0a20 2020 2020 2020      '''..       
-0005c180: 2049 6620 6465 6c74 6120 6973 2073 6574   If delta is set
-0005c190: 2074 6f20 5472 7565 2c20 2877 6869 6368   to True, (which
-0005c1a0: 2069 7320 7468 6520 6465 6661 756c 7429   is the default)
-0005c1b0: 2074 6865 6e20 7468 6973 206c 6f61 6465   then this loade
-0005c1c0: 7220 7769 6c6c 2070 6572 666f 726d 2064  r will perform d
-0005c1d0: 656c 7461 206c 6f61 6473 0d0a 0d0a 2020  elta loads....  
-0005c1e0: 2020 2020 2020 3a70 6172 616d 2073 6f75        :param sou
-0005c1f0: 7263 653a 2041 2070 616e 6461 7320 4461  rce: A pandas Da
-0005c200: 7461 6672 616d 6520 746f 2062 6520 7573  taframe to be us
-0005c210: 6564 2061 7320 7468 6520 736f 7572 6365  ed as the source
-0005c220: 2064 6174 610d 0a20 2020 2020 2020 203a   data..        :
-0005c230: 7061 7261 6d20 6964 656e 7469 6669 6572  param identifier
-0005c240: 5f63 6f6c 756d 6e73 3a20 436f 6c75 6d6e  _columns: Column
-0005c250: 7320 696e 2074 6865 2073 6f75 7263 6520  s in the source 
-0005c260: 7768 6963 6820 6172 6520 7573 6566 756c  which are useful
-0005c270: 2069 6e20 6465 6275 6767 696e 670d 0a20   in debugging.. 
-0005c280: 2020 2020 2020 203a 7061 7261 6d20 7361         :param sa
-0005c290: 6665 5f6c 6f61 643a 206f 6e6c 7920 6d6f  fe_load: only mo
-0005c2a0: 7665 2044 6174 6120 4669 6c65 7320 6166  ve Data Files af
-0005c2b0: 7465 7220 6c6f 6164 696e 6720 6174 2074  ter loading at t
-0005c2c0: 6865 206c 6173 7420 6d6f 6d65 6e74 202d  he last moment -
-0005c2d0: 2074 6869 7320 6d61 6b65 7320 7468 6520   this makes the 
-0005c2e0: 7072 6f63 6573 7320 7065 7266 6563 746c  process perfectl
-0005c2f0: 7920 7265 7374 6172 7461 626c 650d 0a20  y restartable.. 
-0005c300: 2020 2020 2020 2027 2727 0d0a 2020 2020         '''..    
-0005c310: 2020 2020 6966 2069 6465 6e74 6966 6965      if identifie
-0005c320: 725f 636f 6c75 6d6e 7320 6973 204e 6f6e  r_columns is Non
-0005c330: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0005c340: 6964 656e 7469 6669 6572 5f63 6f6c 756d  identifier_colum
-0005c350: 6e73 3d5b 5d0d 0a0d 0a20 2020 2020 2020  ns=[]....       
-0005c360: 2073 656c 662e 5f73 6974 6520 2020 2020   self._site     
-0005c370: 2020 2020 2020 2020 2020 3d20 7369 7465            = site
-0005c380: 0d0a 2020 2020 2020 2020 7365 6c66 2e6c  ..        self.l
-0005c390: 6f67 6769 6e67 5f71 7565 7565 2020 2020  ogging_queue    
-0005c3a0: 2020 3d20 6c6f 6767 696e 675f 7175 6575    = logging_queu
-0005c3b0: 650d 0a20 2020 2020 2020 2023 544f 444f  e..        #TODO
-0005c3c0: 202d 2073 656c 662e 7661 6c69 6461 746f   - self.validato
-0005c3d0: 720d 0a20 2020 2020 2020 2023 544f 444f  r..        #TODO
-0005c3e0: 202d 206d 6169 6e74 6169 6e20 6469 6374   - maintain dict
-0005c3f0: 696f 6e61 7279 206f 6620 6e61 6d65 6420  ionary of named 
-0005c400: 6461 7461 6672 616d 6573 2066 6f72 2075  dataframes for u
-0005c410: 7365 2069 6e20 7468 6520 7661 6c69 6461  se in the valida
-0005c420: 746f 720d 0a0d 0a20 2020 2020 2020 2073  tor....        s
-0005c430: 656c 662e 6465 6c74 613d 6465 6c74 610d  elf.delta=delta.
-0005c440: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0005c450: 736f 7572 6365 3d73 6f75 7263 650d 0a20  source=source.. 
-0005c460: 2020 2020 2020 2023 5765 206d 6179 2077         #We may w
-0005c470: 6973 6820 746f 2061 6464 206f 7468 6572  ish to add other
-0005c480: 2073 6f75 7263 6573 2028 652e 672e 2063   sources (e.g. c
-0005c490: 7376 2c20 6578 6365 6c29 2061 6c73 6f20  sv, excel) also 
-0005c4a0: 7468 6520 6466 2077 696c 6c20 6368 616e  the df will chan
-0005c4b0: 6765 206f 7665 7220 7469 6d65 0d0a 2020  ge over time..  
-0005c4c0: 2020 2020 2020 7365 6c66 2e64 663d 7365        self.df=se
-0005c4d0: 6c66 2e73 6f75 7263 650d 0a0d 0a20 2020  lf.source....   
-0005c4e0: 2020 2020 2073 656c 662e 6964 656e 7469       self.identi
-0005c4f0: 6669 6572 5f63 6f6c 756d 6e73 203d 2069  fier_columns = i
-0005c500: 6465 6e74 6966 6965 725f 636f 6c75 6d6e  dentifier_column
-0005c510: 730d 0a0d 0a20 2020 2020 2020 2073 656c  s....        sel
-0005c520: 662e 6e61 6d65 203d 206e 616d 650d 0a20  f.name = name.. 
-0005c530: 2020 2020 2020 2023 5468 6520 6c6f 6164         #The load
-0005c540: 206d 6179 2062 6520 6272 6f6b 656e 2064   may be broken d
-0005c550: 6f77 6e20 696e 746f 2073 7562 6c6f 6164  own into subload
-0005c560: 732c 2069 6620 7765 2077 616e 7420 746f  s, if we want to
-0005c570: 2072 6575 7365 2061 206c 6f61 6465 720d   reuse a loader.
-0005c580: 0a20 2020 2020 2020 2073 656c 662e 7375  .        self.su
-0005c590: 626c 6f61 6473 3d5b 5d0d 0a0d 0a20 2020  bloads=[]....   
-0005c5a0: 2020 2020 2073 656c 662e 656d 706f 7765       self.empowe
-0005c5b0: 725f 7065 7269 6f64 5f74 7970 6520 3d20  r_period_type = 
-0005c5c0: 656d 706f 7765 725f 7065 7269 6f64 5f74  empower_period_t
-0005c5d0: 7970 650d 0a20 2020 2020 2020 2073 656c  ype..        sel
-0005c5e0: 662e 656d 706f 7765 725f 696d 706f 7274  f.empower_import
-0005c5f0: 6572 5f65 7865 6375 7461 626c 6520 3d20  er_executable = 
-0005c600: 656d 706f 7765 725f 696d 706f 7274 6572  empower_importer
-0005c610: 5f65 7865 6375 7461 626c 650d 0a0d 0a20  _executable.... 
-0005c620: 2020 2020 2020 2073 656c 662e 7361 6665         self.safe
-0005c630: 5f6c 6f61 643d 7361 6665 5f6c 6f61 640d  _load=safe_load.
-0005c640: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0005c650: 7368 6172 6469 6e67 5f71 7565 7565 203d  sharding_queue =
-0005c660: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
-0005c670: 2023 5573 6564 2066 6f72 206d 6f6e 6b65   #Used for monke
-0005c680: 792d 7061 7463 6869 6e67 2069 6e20 616c  y-patching in al
-0005c690: 7068 6120 6465 7665 6c6f 706d 656e 7420  pha development 
-0005c6a0: 7374 6174 7573 2062 756c 6b20 6c6f 6164  status bulk load
-0005c6b0: 696e 6720 6675 6e63 7469 6f6e 730d 0a20  ing functions.. 
-0005c6c0: 2020 2020 2020 2073 656c 662e 5f73 696e         self._sin
-0005c6d0: 676c 655f 6275 6c6b 5f6c 6f61 645f 6675  gle_bulk_load_fu
-0005c6e0: 6e63 7469 6f6e 203d 2020 6c6c 752e 6d73  nction =  llu.ms
-0005c6f0: 6773 696e 6b5f 5f72 756e 5f73 696e 676c  gsink__run_singl
-0005c700: 655f 7371 6c5f 656d 706f 7765 725f 6275  e_sql_empower_bu
-0005c710: 6c6b 5f6c 6f61 640d 0a0d 0a20 2020 2064  lk_load....    d
-0005c720: 6566 206c 6f61 6428 7365 6c66 0d0a 2020  ef load(self..  
-0005c730: 2020 2020 2020 2020 2020 2c64 696d 656e            ,dimen
-0005c740: 7369 6f6e 5f30 2020 203d 204e 6f6e 650d  sion_0   = None.
-0005c750: 0a20 2020 2020 2020 2020 2020 202c 6469  .            ,di
-0005c760: 6d65 6e73 696f 6e5f 3120 2020 3d20 4e6f  mension_1   = No
-0005c770: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0005c780: 2c64 696d 656e 7369 6f6e 5f32 2020 203d  ,dimension_2   =
-0005c790: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-0005c7a0: 2020 202c 6469 6d65 6e73 696f 6e5f 3320     ,dimension_3 
-0005c7b0: 2020 3d20 4e6f 6e65 0d0a 2020 2020 2020    = None..      
-0005c7c0: 2020 2020 2020 2c64 696d 656e 7369 6f6e        ,dimension
-0005c7d0: 5f34 2020 203d 204e 6f6e 650d 0a20 2020  _4   = None..   
-0005c7e0: 2020 2020 2020 2020 202c 6469 6d65 6e73           ,dimens
-0005c7f0: 696f 6e5f 3520 2020 3d20 4e6f 6e65 0d0a  ion_5   = None..
-0005c800: 2020 2020 2020 2020 2020 2020 2c64 696d              ,dim
-0005c810: 656e 7369 6f6e 5f36 2020 203d 204e 6f6e  ension_6   = Non
-0005c820: 650d 0a20 2020 2020 2020 2020 2020 202c  e..            ,
-0005c830: 6469 6d65 6e73 696f 6e5f 3720 2020 3d20  dimension_7   = 
-0005c840: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-0005c850: 2020 2c6d 6f64 6520 2020 2020 2020 2020    ,mode         
-0005c860: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
-0005c870: 2020 2020 202c 6261 7365 2020 2020 2020       ,base      
-0005c880: 2020 2020 3d20 4e6f 6e65 0d0a 2020 2020      = None..    
-0005c890: 2020 2020 2020 2020 2c74 696d 6520 2020          ,time   
-0005c8a0: 2020 2020 2020 203d 204e 6f6e 650d 0a20         = None.. 
-0005c8b0: 2020 2020 2020 2020 2020 202c 6d65 7472             ,metr
-0005c8c0: 6963 2020 2020 2020 2020 3d20 4e6f 6e65  ic        = None
-0005c8d0: 0d0a 2020 2020 2020 2020 2020 2020 2c65  ..            ,e
-0005c8e0: 6d70 6f77 6572 5f70 6572 696f 645f 7479  mpower_period_ty
-0005c8f0: 7065 203d 204e 6f6e 650d 0a20 2020 2020  pe = None..     
-0005c900: 2020 2020 2020 202c 7661 6c75 6520 2020         ,value   
-0005c910: 2020 2020 2020 3d20 4e6f 6e65 0d0a 2020        = None..  
-0005c920: 2020 2020 2020 2020 2020 2c69 676e 6f72            ,ignor
-0005c930: 655f 7a65 726f 5f76 616c 7565 7320 2020  e_zero_values   
-0005c940: 2020 2020 2020 3d20 5472 7565 0d0a 2020        = True..  
-0005c950: 2020 2020 2020 2020 2020 293a 0d0a 2020            ):..  
-0005c960: 2020 2020 2020 2727 270d 0a0d 0a20 2020        '''....   
-0005c970: 2020 2020 202e 6c6f 6164 2829 2064 6f65       .load() doe
-0005c980: 7320 2e65 7870 6c6f 6465 2829 2c20 2e73  s .explode(), .s
-0005c990: 6861 7264 2829 2061 6e64 202e 6c6f 6164  hard() and .load
-0005c9a0: 5f73 6861 7264 7328 290d 0a0d 0a20 2020  _shards()....   
-0005c9b0: 2020 2020 203a 7061 7261 6d20 6469 6d65       :param dime
-0005c9c0: 6e73 696f 6e5f 303a 2073 7472 696e 672c  nsion_0: string,
-0005c9d0: 206c 6973 742c 2070 796d 7078 2e45 6c65   list, pympx.Ele
-0005c9e0: 6d65 6e74 2c20 7079 6d70 782e 436f 6e73  ment, pympx.Cons
-0005c9f0: 7461 6e74 206f 7220 7079 6d70 782e 5374  tant or pympx.St
-0005ca00: 7275 6374 7572 654d 6170 7065 722e 2053  ructureMapper. S
-0005ca10: 7472 696e 6720 7265 7072 6573 656e 7473  tring represents
-0005ca20: 2061 2063 6f6c 756d 6e20 6e61 6d65 2c20   a column name, 
-0005ca30: 6120 436f 6e73 7461 6e74 2063 616e 2062  a Constant can b
-0005ca40: 6520 6569 7468 6572 2061 2070 6879 7369  e either a physi
-0005ca50: 6420 6f72 2073 686f 7274 6e61 6d65 2c20  d or shortname, 
-0005ca60: 6120 5374 7275 6374 7572 6520 6d61 7070  a Structure mapp
-0005ca70: 6572 2072 6570 7265 7365 6e74 7320 6120  er represents a 
-0005ca80: 6869 6572 6172 6368 7920 7472 6565 2e20  hierarchy tree. 
-0005ca90: 4c69 7374 2063 616e 2062 6520 6569 7468  List can be eith
-0005caa0: 6572 2061 206c 6973 7420 6f66 2073 7472  er a list of str
-0005cab0: 696e 6773 206f 7220 436f 6e73 7461 6e74  ings or Constant
-0005cac0: 730d 0a20 2020 2020 2020 203a 7061 7261  s..        :para
-0005cad0: 6d20 6469 6d65 6e73 696f 6e5f 313a 2073  m dimension_1: s
-0005cae0: 7472 696e 672c 206c 6973 742c 2070 796d  tring, list, pym
-0005caf0: 7078 2e45 6c65 6d65 6e74 2c20 7079 6d70  px.Element, pymp
-0005cb00: 782e 436f 6e73 7461 6e74 206f 7220 7079  x.Constant or py
-0005cb10: 6d70 782e 5374 7275 6374 7572 654d 6170  mpx.StructureMap
-0005cb20: 7065 722e 2053 7472 696e 6720 7265 7072  per. String repr
-0005cb30: 6573 656e 7473 2061 2063 6f6c 756d 6e20  esents a column 
-0005cb40: 6e61 6d65 2c20 6120 436f 6e73 7461 6e74  name, a Constant
-0005cb50: 2063 616e 2062 6520 6569 7468 6572 2061   can be either a
-0005cb60: 2070 6879 7369 6420 6f72 2073 686f 7274   physid or short
-0005cb70: 6e61 6d65 2c20 6120 5374 7275 6374 7572  name, a Structur
-0005cb80: 6520 6d61 7070 6572 2072 6570 7265 7365  e mapper represe
-0005cb90: 6e74 7320 6120 6869 6572 6172 6368 7920  nts a hierarchy 
-0005cba0: 7472 6565 2e20 4c69 7374 2063 616e 2062  tree. List can b
-0005cbb0: 6520 6569 7468 6572 2061 206c 6973 7420  e either a list 
-0005cbc0: 6f66 2073 7472 696e 6773 206f 7220 436f  of strings or Co
-0005cbd0: 6e73 7461 6e74 730d 0a20 2020 2020 2020  nstants..       
-0005cbe0: 203a 7061 7261 6d20 6469 6d65 6e73 696f   :param dimensio
-0005cbf0: 6e5f 323a 2073 7472 696e 672c 206c 6973  n_2: string, lis
-0005cc00: 742c 2070 796d 7078 2e45 6c65 6d65 6e74  t, pympx.Element
-0005cc10: 2c20 7079 6d70 782e 436f 6e73 7461 6e74  , pympx.Constant
-0005cc20: 206f 7220 7079 6d70 782e 5374 7275 6374   or pympx.Struct
-0005cc30: 7572 654d 6170 7065 722e 2053 7472 696e  ureMapper. Strin
-0005cc40: 6720 7265 7072 6573 656e 7473 2061 2063  g represents a c
-0005cc50: 6f6c 756d 6e20 6e61 6d65 2c20 6120 436f  olumn name, a Co
-0005cc60: 6e73 7461 6e74 2063 616e 2062 6520 6569  nstant can be ei
-0005cc70: 7468 6572 2061 2070 6879 7369 6420 6f72  ther a physid or
-0005cc80: 2073 686f 7274 6e61 6d65 2c20 6120 5374   shortname, a St
-0005cc90: 7275 6374 7572 6520 6d61 7070 6572 2072  ructure mapper r
-0005cca0: 6570 7265 7365 6e74 7320 6120 6869 6572  epresents a hier
-0005ccb0: 6172 6368 7920 7472 6565 2e20 4c69 7374  archy tree. List
-0005ccc0: 2063 616e 2062 6520 6569 7468 6572 2061   can be either a
-0005ccd0: 206c 6973 7420 6f66 2073 7472 696e 6773   list of strings
-0005cce0: 206f 7220 436f 6e73 7461 6e74 730d 0a20   or Constants.. 
-0005ccf0: 2020 2020 2020 203a 7061 7261 6d20 6469         :param di
-0005cd00: 6d65 6e73 696f 6e5f 333a 2073 7472 696e  mension_3: strin
-0005cd10: 672c 206c 6973 742c 2070 796d 7078 2e45  g, list, pympx.E
-0005cd20: 6c65 6d65 6e74 2c20 7079 6d70 782e 436f  lement, pympx.Co
-0005cd30: 6e73 7461 6e74 206f 7220 7079 6d70 782e  nstant or pympx.
-0005cd40: 5374 7275 6374 7572 654d 6170 7065 722e  StructureMapper.
-0005cd50: 2053 7472 696e 6720 7265 7072 6573 656e   String represen
-0005cd60: 7473 2061 2063 6f6c 756d 6e20 6e61 6d65  ts a column name
-0005cd70: 2c20 6120 436f 6e73 7461 6e74 2063 616e  , a Constant can
-0005cd80: 2062 6520 6569 7468 6572 2061 2070 6879   be either a phy
-0005cd90: 7369 6420 6f72 2073 686f 7274 6e61 6d65  sid or shortname
-0005cda0: 2c20 6120 5374 7275 6374 7572 6520 6d61  , a Structure ma
-0005cdb0: 7070 6572 2072 6570 7265 7365 6e74 7320  pper represents 
-0005cdc0: 6120 6869 6572 6172 6368 7920 7472 6565  a hierarchy tree
-0005cdd0: 2e20 4c69 7374 2063 616e 2062 6520 6569  . List can be ei
-0005cde0: 7468 6572 2061 206c 6973 7420 6f66 2073  ther a list of s
-0005cdf0: 7472 696e 6773 206f 7220 436f 6e73 7461  trings or Consta
-0005ce00: 6e74 730d 0a20 2020 2020 2020 203a 7061  nts..        :pa
-0005ce10: 7261 6d20 6469 6d65 6e73 696f 6e5f 343a  ram dimension_4:
-0005ce20: 2073 7472 696e 672c 206c 6973 742c 2070   string, list, p
-0005ce30: 796d 7078 2e45 6c65 6d65 6e74 2c20 7079  ympx.Element, py
-0005ce40: 6d70 782e 436f 6e73 7461 6e74 206f 7220  mpx.Constant or 
-0005ce50: 7079 6d70 782e 5374 7275 6374 7572 654d  pympx.StructureM
-0005ce60: 6170 7065 722e 2053 7472 696e 6720 7265  apper. String re
-0005ce70: 7072 6573 656e 7473 2061 2063 6f6c 756d  presents a colum
-0005ce80: 6e20 6e61 6d65 2c20 6120 436f 6e73 7461  n name, a Consta
-0005ce90: 6e74 2063 616e 2062 6520 6569 7468 6572  nt can be either
-0005cea0: 2061 2070 6879 7369 6420 6f72 2073 686f   a physid or sho
-0005ceb0: 7274 6e61 6d65 2c20 6120 5374 7275 6374  rtname, a Struct
-0005cec0: 7572 6520 6d61 7070 6572 2072 6570 7265  ure mapper repre
-0005ced0: 7365 6e74 7320 6120 6869 6572 6172 6368  sents a hierarch
-0005cee0: 7920 7472 6565 2e20 4c69 7374 2063 616e  y tree. List can
-0005cef0: 2062 6520 6569 7468 6572 2061 206c 6973   be either a lis
-0005cf00: 7420 6f66 2073 7472 696e 6773 206f 7220  t of strings or 
-0005cf10: 436f 6e73 7461 6e74 730d 0a20 2020 2020  Constants..     
-0005cf20: 2020 203a 7061 7261 6d20 6469 6d65 6e73     :param dimens
-0005cf30: 696f 6e5f 353a 2073 7472 696e 672c 206c  ion_5: string, l
-0005cf40: 6973 742c 2070 796d 7078 2e45 6c65 6d65  ist, pympx.Eleme
-0005cf50: 6e74 2c20 7079 6d70 782e 436f 6e73 7461  nt, pympx.Consta
-0005cf60: 6e74 206f 7220 7079 6d70 782e 5374 7275  nt or pympx.Stru
-0005cf70: 6374 7572 654d 6170 7065 722e 2053 7472  ctureMapper. Str
-0005cf80: 696e 6720 7265 7072 6573 656e 7473 2061  ing represents a
-0005cf90: 2063 6f6c 756d 6e20 6e61 6d65 2c20 6120   column name, a 
-0005cfa0: 436f 6e73 7461 6e74 2063 616e 2062 6520  Constant can be 
-0005cfb0: 6569 7468 6572 2061 2070 6879 7369 6420  either a physid 
-0005cfc0: 6f72 2073 686f 7274 6e61 6d65 2c20 6120  or shortname, a 
-0005cfd0: 5374 7275 6374 7572 6520 6d61 7070 6572  Structure mapper
-0005cfe0: 2072 6570 7265 7365 6e74 7320 6120 6869   represents a hi
-0005cff0: 6572 6172 6368 7920 7472 6565 2e20 4c69  erarchy tree. Li
-0005d000: 7374 2063 616e 2062 6520 6569 7468 6572  st can be either
-0005d010: 2061 206c 6973 7420 6f66 2073 7472 696e   a list of strin
-0005d020: 6773 206f 7220 436f 6e73 7461 6e74 730d  gs or Constants.
-0005d030: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0005d040: 6469 6d65 6e73 696f 6e5f 363a 2073 7472  dimension_6: str
-0005d050: 696e 672c 206c 6973 742c 2070 796d 7078  ing, list, pympx
-0005d060: 2e45 6c65 6d65 6e74 2c20 7079 6d70 782e  .Element, pympx.
-0005d070: 436f 6e73 7461 6e74 206f 7220 7079 6d70  Constant or pymp
-0005d080: 782e 5374 7275 6374 7572 654d 6170 7065  x.StructureMappe
-0005d090: 722e 2053 7472 696e 6720 7265 7072 6573  r. String repres
-0005d0a0: 656e 7473 2061 2063 6f6c 756d 6e20 6e61  ents a column na
-0005d0b0: 6d65 2c20 6120 436f 6e73 7461 6e74 2063  me, a Constant c
-0005d0c0: 616e 2062 6520 6569 7468 6572 2061 2070  an be either a p
-0005d0d0: 6879 7369 6420 6f72 2073 686f 7274 6e61  hysid or shortna
-0005d0e0: 6d65 2c20 6120 5374 7275 6374 7572 6520  me, a Structure 
-0005d0f0: 6d61 7070 6572 2072 6570 7265 7365 6e74  mapper represent
-0005d100: 7320 6120 6869 6572 6172 6368 7920 7472  s a hierarchy tr
-0005d110: 6565 2e20 4c69 7374 2063 616e 2062 6520  ee. List can be 
-0005d120: 6569 7468 6572 2061 206c 6973 7420 6f66  either a list of
-0005d130: 2073 7472 696e 6773 206f 7220 436f 6e73   strings or Cons
-0005d140: 7461 6e74 730d 0a20 2020 2020 2020 203a  tants..        :
-0005d150: 7061 7261 6d20 6469 6d65 6e73 696f 6e5f  param dimension_
-0005d160: 373a 2073 7472 696e 672c 206c 6973 742c  7: string, list,
-0005d170: 2070 796d 7078 2e45 6c65 6d65 6e74 2c20   pympx.Element, 
-0005d180: 7079 6d70 782e 436f 6e73 7461 6e74 206f  pympx.Constant o
-0005d190: 7220 7079 6d70 782e 5374 7275 6374 7572  r pympx.Structur
-0005d1a0: 654d 6170 7065 722e 2053 7472 696e 6720  eMapper. String 
-0005d1b0: 7265 7072 6573 656e 7473 2061 2063 6f6c  represents a col
-0005d1c0: 756d 6e20 6e61 6d65 2c20 6120 436f 6e73  umn name, a Cons
-0005d1d0: 7461 6e74 2063 616e 2062 6520 6569 7468  tant can be eith
-0005d1e0: 6572 2061 2070 6879 7369 6420 6f72 2073  er a physid or s
-0005d1f0: 686f 7274 6e61 6d65 2c20 6120 5374 7275  hortname, a Stru
-0005d200: 6374 7572 6520 6d61 7070 6572 2072 6570  cture mapper rep
-0005d210: 7265 7365 6e74 7320 6120 6869 6572 6172  resents a hierar
-0005d220: 6368 7920 7472 6565 2e20 4c69 7374 2063  chy tree. List c
-0005d230: 616e 2062 6520 6569 7468 6572 2061 206c  an be either a l
-0005d240: 6973 7420 6f66 2073 7472 696e 6773 206f  ist of strings o
-0005d250: 7220 436f 6e73 7461 6e74 730d 0a20 2020  r Constants..   
-0005d260: 2020 2020 203a 7061 7261 6d20 6d6f 6465       :param mode
-0005d270: 3a20 7374 7269 6e67 2c20 6c69 7374 2c20  : string, list, 
-0005d280: 7079 6d70 782e 456c 656d 656e 742c 206f  pympx.Element, o
-0005d290: 7220 7079 6d70 782e 436f 6e73 7461 6e74  r pympx.Constant
-0005d2a0: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0005d2b0: 2062 6173 653a 2073 7472 696e 672c 206c   base: string, l
-0005d2c0: 6973 742c 2070 796d 7078 2e45 6c65 6d65  ist, pympx.Eleme
-0005d2d0: 6e74 2c20 6f72 2070 796d 7078 2e43 6f6e  nt, or pympx.Con
-0005d2e0: 7374 616e 740d 0a20 2020 2020 2020 203a  stant..        :
-0005d2f0: 7061 7261 6d20 7469 6d65 3a20 7374 7269  param time: stri
-0005d300: 6e67 2c20 6c69 7374 2c20 7079 6d70 782e  ng, list, pympx.
-0005d310: 456c 656d 656e 742c 206f 7220 7079 6d70  Element, or pymp
-0005d320: 782e 436f 6e73 7461 6e74 0d0a 2020 2020  x.Constant..    
-0005d330: 2020 2020 3a70 6172 616d 206d 6574 7269      :param metri
-0005d340: 633a 2045 6974 6865 7220 6120 7374 7269  c: Either a stri
-0005d350: 6e67 206e 616d 696e 6720 7468 6520 6d65  ng naming the me
-0005d360: 7472 6963 2063 6f6c 756d 6e20 7768 6963  tric column whic
-0005d370: 6820 7368 6f75 6c64 2063 6f6e 7461 696e  h should contain
-0005d380: 206d 6574 7269 6320 7368 6f72 746e 616d   metric shortnam
-0005d390: 6573 206f 7220 7068 7973 6964 732c 206f  es or physids, o
-0005d3a0: 7220 6120 6469 6374 696f 6e61 7279 206f  r a dictionary o
-0005d3b0: 6620 636f 6c75 6d6e 206e 616d 6573 2074  f column names t
-0005d3c0: 6f20 6d65 7472 6963 2073 686f 7274 6e61  o metric shortna
-0005d3d0: 6d65 730d 0a20 2020 2020 2020 203a 7061  mes..        :pa
-0005d3e0: 7261 6d20 7661 6c75 653a 2057 6865 6e20  ram value: When 
-0005d3f0: 7573 696e 6720 6120 6d65 7472 6963 2063  using a metric c
-0005d400: 6f6c 756d 6e20 636f 6e74 6169 6e69 6e67  olumn containing
-0005d410: 206d 6574 7269 6320 2869 6e64 6963 6174   metric (indicat
-0005d420: 6f72 2920 7368 6f72 7463 6f64 6520 6f72  or) shortcode or
-0005d430: 2070 6879 7369 6473 2c20 7468 656e 2070   physids, then p
-0005d440: 7574 2074 6865 2076 616c 7565 7320 696e  ut the values in
-0005d450: 2068 6572 652e 2049 6620 6d65 7472 6963   here. If metric
-0005d460: 7320 6172 6520 696e 2064 6966 6665 7265  s are in differe
-0005d470: 6e74 2063 6f6c 756d 6e73 206c 6561 7665  nt columns leave
-0005d480: 2074 6869 7320 7061 7261 6d65 7465 7220   this parameter 
-0005d490: 6173 204e 6f6e 650d 0a20 2020 2020 2020  as None..       
-0005d4a0: 203a 7061 7261 6d20 6967 6e6f 7265 5f7a   :param ignore_z
-0005d4b0: 6572 6f5f 7661 6c75 6573 3a20 5573 7561  ero_values: Usua
-0005d4c0: 6c6c 7920 7765 2064 6f20 6e6f 7420 7769  lly we do not wi
-0005d4d0: 7368 2074 6f20 6c6f 6164 207a 6572 6f20  sh to load zero 
-0005d4e0: 7661 6c75 6573 2069 6e74 6f20 456d 706f  values into Empo
-0005d4f0: 7765 7220 696e 206f 7264 6572 2074 6f20  wer in order to 
-0005d500: 7361 7665 2074 696d 6520 616e 6420 7370  save time and sp
-0005d510: 6163 652c 2073 696e 6365 206d 6f73 7420  ace, since most 
-0005d520: 456d 706f 7765 7220 6375 6265 2069 6d70  Empower cube imp
-0005d530: 6c65 6d65 6e74 6174 696f 6e73 2064 6973  lementations dis
-0005d540: 706c 6179 204e 2f41 7320 6173 207a 6572  play N/As as zer
-0005d550: 6f20 616e 7977 6179 0d0a 2020 2020 2020  o anyway..      
-0005d560: 2020 2727 270d 0a0d 0a20 2020 2020 2020    '''....       
-0005d570: 2073 656c 662e 6578 706c 6f64 6528 6469   self.explode(di
-0005d580: 6d65 6e73 696f 6e5f 3020 3d20 6469 6d65  mension_0 = dime
-0005d590: 6e73 696f 6e5f 300d 0a20 2020 2020 2020  nsion_0..       
-0005d5a0: 2020 2020 2020 2020 2020 2020 2c64 696d              ,dim
-0005d5b0: 656e 7369 6f6e 5f31 203d 2064 696d 656e  ension_1 = dimen
-0005d5c0: 7369 6f6e 5f31 0d0a 2020 2020 2020 2020  sion_1..        
-0005d5d0: 2020 2020 2020 2020 2020 202c 6469 6d65             ,dime
-0005d5e0: 6e73 696f 6e5f 3220 3d20 6469 6d65 6e73  nsion_2 = dimens
-0005d5f0: 696f 6e5f 320d 0a20 2020 2020 2020 2020  ion_2..         
-0005d600: 2020 2020 2020 2020 2020 2c64 696d 656e            ,dimen
-0005d610: 7369 6f6e 5f33 203d 2064 696d 656e 7369  sion_3 = dimensi
-0005d620: 6f6e 5f33 0d0a 2020 2020 2020 2020 2020  on_3..          
-0005d630: 2020 2020 2020 2020 202c 6469 6d65 6e73           ,dimens
-0005d640: 696f 6e5f 3420 3d20 6469 6d65 6e73 696f  ion_4 = dimensio
-0005d650: 6e5f 340d 0a20 2020 2020 2020 2020 2020  n_4..           
-0005d660: 2020 2020 2020 2020 2c64 696d 656e 7369          ,dimensi
-0005d670: 6f6e 5f35 203d 2064 696d 656e 7369 6f6e  on_5 = dimension
-0005d680: 5f35 0d0a 2020 2020 2020 2020 2020 2020  _5..            
-0005d690: 2020 2020 2020 202c 6469 6d65 6e73 696f         ,dimensio
-0005d6a0: 6e5f 3620 3d20 6469 6d65 6e73 696f 6e5f  n_6 = dimension_
-0005d6b0: 360d 0a20 2020 2020 2020 2020 2020 2020  6..             
-0005d6c0: 2020 2020 2020 2c64 696d 656e 7369 6f6e        ,dimension
-0005d6d0: 5f37 203d 2064 696d 656e 7369 6f6e 5f37  _7 = dimension_7
-0005d6e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005d6f0: 2020 2020 202c 6d6f 6465 2020 2020 2020       ,mode      
-0005d700: 2020 3d20 6d6f 6465 0d0a 2020 2020 2020    = mode..      
-0005d710: 2020 2020 2020 2020 2020 2020 202c 6261               ,ba
-0005d720: 7365 2020 2020 2020 2020 3d20 6261 7365  se        = base
-0005d730: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005d740: 2020 2020 202c 7469 6d65 2020 2020 2020       ,time      
-0005d750: 2020 3d20 7469 6d65 0d0a 2020 2020 2020    = time..      
-0005d760: 2020 2020 2020 2020 2020 2020 202c 6d65               ,me
-0005d770: 7472 6963 2020 2020 2020 3d20 6d65 7472  tric      = metr
-0005d780: 6963 0d0a 2020 2020 2020 2020 2020 2020  ic..            
-0005d790: 2020 2020 2020 2023 2c76 616c 7565 2020         #,value  
-0005d7a0: 2020 2020 2020 203d 204e 6f6e 650d 0a20         = None.. 
+00055ba0: 2066 6f75 6e64 5f65 6c65 6d65 6e74 203d   found_element =
+00055bb0: 2065 6c65 6d65 6e74 0d0a 0d0a 2020 2020   element....    
+00055bc0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+00055bd0: 2069 7369 6e73 7461 6e63 6528 7265 7475   isinstance(retu
+00055be0: 726e 5f76 616c 7565 2e63 6f6e 7374 616e  rn_value.constan
+00055bf0: 742c 456c 656d 656e 7429 3a0d 0a20 2020  t,Element):..   
+00055c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055c10: 2066 6f75 6e64 5f65 6c65 6d65 6e74 203d   found_element =
+00055c20: 2072 6574 7572 6e5f 7661 6c75 652e 636f   return_value.co
+00055c30: 6e73 7461 6e74 0d0a 0d0a 2020 2020 2020  nstant....      
+00055c40: 2020 2020 2020 2020 2020 6966 2066 6f75            if fou
+00055c50: 6e64 5f64 6174 6520 6973 206e 6f74 204e  nd_date is not N
+00055c60: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+00055c70: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00055c80: 2043 6f6e 7374 616e 7428 666f 756e 645f   Constant(found_
+00055c90: 6461 7465 292c 2066 6f75 6e64 5f65 6d70  date), found_emp
+00055ca0: 6f77 6572 5f64 6174 655f 636f 6e73 7461  ower_date_consta
+00055cb0: 6e74 0d0a 0d0a 2020 2020 2020 2020 2020  nt....          
+00055cc0: 2020 2020 2020 6966 2066 6f75 6e64 5f65        if found_e
+00055cd0: 6c65 6d65 6e74 2069 7320 6e6f 7420 4e6f  lement is not No
+00055ce0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00055cf0: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+00055d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055d10: 2020 2020 2020 2061 7373 6572 7420 666f         assert fo
+00055d20: 756e 645f 656c 656d 656e 742e 6772 6f75  und_element.grou
+00055d30: 705f 6f6e 6c79 2069 7320 4e6f 6e65 0d0a  p_only is None..
+00055d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055d50: 2020 2020 2020 2020 6173 7365 7274 2066          assert f
+00055d60: 6f75 6e64 5f65 6c65 6d65 6e74 2e69 6e74  ound_element.int
+00055d70: 6572 7661 6c5f 616d 6f75 6e74 203d 3d20  erval_amount == 
+00055d80: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
+00055d90: 2020 2020 2020 2020 2020 2061 7373 6572             asser
+00055da0: 7420 666f 756e 645f 656c 656d 656e 742e  t found_element.
+00055db0: 696e 7465 7276 616c 203d 3d20 666f 756e  interval == foun
+00055dc0: 645f 656c 656d 656e 742e 7265 736f 6c75  d_element.resolu
+00055dd0: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
+00055de0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00055df0: 2041 7373 6572 7469 6f6e 4572 726f 723a   AssertionError:
+00055e00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00055e10: 2020 2020 2020 2020 2020 6c6f 672e 6572            log.er
+00055e20: 726f 7228 2754 696d 6545 6c65 6d65 6e74  ror('TimeElement
+00055e30: 2066 6f75 6e64 2077 6974 6820 696e 636f   found with inco
+00055e40: 7272 6563 7420 6669 656c 6473 2066 6f72  rrect fields for
+00055e50: 2054 696d 6520 4d61 7070 696e 6720 7368   Time Mapping sh
+00055e60: 6f72 746e 616d 653a 7b7d 2c20 6669 656c  ortname:{}, fiel
+00055e70: 6473 7b7d 272e 666f 726d 6174 2866 6f75  ds{}'.format(fou
+00055e80: 6e64 5f65 6c65 6d65 6e74 2e73 686f 7274  nd_element.short
+00055e90: 6e61 6d65 2c66 6f75 6e64 5f65 6c65 6d65  name,found_eleme
+00055ea0: 6e74 2e66 6965 6c64 7329 290d 0a20 2020  nt.fields))..   
+00055eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055ec0: 2020 2020 2072 6169 7365 0d0a 0d0a 2020       raise....  
+00055ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055ee0: 2020 6966 2066 6f75 6e64 5f65 6c65 6d65    if found_eleme
+00055ef0: 6e74 2e5f 7374 6172 745f 6461 7465 2069  nt._start_date i
+00055f00: 7320 4e6f 6e65 2061 6e64 2066 6f75 6e64  s None and found
+00055f10: 5f65 6c65 6d65 6e74 2e6f 6666 7365 7420  _element.offset 
+00055f20: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+00055f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055f40: 2020 2020 2020 2357 6520 6861 7665 2061        #We have a
+00055f50: 2066 6f75 6e64 2061 2043 7572 7265 6e74   found a Current
+00055f60: 204d 6f6e 7468 206f 7220 4375 7272 656e   Month or Curren
+00055f70: 7420 5965 6172 2065 6c65 6d65 6e74 2061  t Year element a
+00055f80: 6e64 2073 6f20 6f6e 2e0d 0a20 2020 2020  nd so on...     
+00055f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00055fa0: 2020 2069 6e74 6572 7661 6c20 3d20 666f     interval = fo
+00055fb0: 756e 645f 656c 656d 656e 742e 696e 7465  und_element.inte
+00055fc0: 7276 616c 0d0a 2020 2020 2020 2020 2020  rval..          
+00055fd0: 2020 2020 2020 2020 2020 2020 2020 6f66                of
+00055fe0: 6673 6574 2020 203d 2066 6f75 6e64 5f65  fset   = found_e
+00055ff0: 6c65 6d65 6e74 2e6f 6666 7365 740d 0a20  lement.offset.. 
+00056000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056010: 2020 2020 2020 2023 4765 7420 7468 6520         #Get the 
+00056020: 6461 7461 2066 6f72 2074 6865 2043 7572  data for the Cur
+00056030: 7265 6e74 204d 6f6e 7468 2066 6f72 2074  rent Month for t
+00056040: 6865 2069 6e74 6572 7661 6c2c 2061 6e64  he interval, and
+00056050: 206d 6f65 7620 6279 2074 6865 206f 6666   moev by the off
+00056060: 7365 740d 0a20 2020 2020 2020 2020 2020  set..           
+00056070: 2020 2020 2020 2020 2020 2020 2023 544f               #TO
+00056080: 444f 0d0a 2020 2020 2020 2020 2020 2020  DO..            
+00056090: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000560a0: 6520 6d70 6578 2e4c 6f61 6465 7253 6574  e mpex.LoaderSet
+000560b0: 7570 4572 726f 7228 274e 6f74 2049 6d70  upError('Not Imp
+000560c0: 6c65 6d65 6e74 6564 2e20 5469 6d65 206d  lemented. Time m
+000560d0: 6170 7069 6e67 2066 726f 6d20 6120 6375  apping from a cu
+000560e0: 7272 656e 7420 6d6f 6e74 6820 6973 206e  rrent month is n
+000560f0: 6f74 2079 6574 2069 6d70 6c65 6d65 6e74  ot yet implement
+00056100: 6564 2729 0d0a 2020 2020 2020 2020 2020  ed')..          
+00056110: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00056120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00056130: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00056140: 436f 6e73 7461 6e74 2866 6f75 6e64 5f65  Constant(found_e
+00056150: 6c65 6d65 6e74 2e64 6174 6529 2c66 6f75  lement.date),fou
+00056160: 6e64 5f65 6c65 6d65 6e74 2e65 6d70 6f77  nd_element.empow
+00056170: 6572 5f70 6572 696f 645f 6e75 6d62 6572  er_period_number
+00056180: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00056190: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+000561a0: 7265 7475 726e 5f76 616c 7565 2c43 6f6c  return_value,Col
+000561b0: 756d 6e4d 6170 7065 7229 3a0d 0a20 2020  umnMapper):..   
+000561c0: 2020 2020 2020 2020 2020 2020 200d 0a20               .. 
+000561d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000561e0: 2044 6566 6175 6c74 2069 7320 6d6f 6e74   Default is mont
+000561f0: 680d 0a20 2020 2020 2020 2020 2020 2020  h..             
+00056200: 2020 2065 6d70 6f77 6572 5f74 696d 655f     empower_time_
+00056210: 636f 6e73 7461 6e74 203d 206c 6c75 2e45  constant = llu.E
+00056220: 4d50 4f57 4552 5f4d 4f4e 5448 5f43 4f4e  MPOWER_MONTH_CON
+00056230: 5354 414e 540d 0a20 2020 2020 2020 2020  STANT..         
+00056240: 2020 2020 2020 200d 0a20 2020 2020 2020         ..       
+00056250: 2020 2020 2020 2020 2023 2054 7279 2074           # Try t
+00056260: 6f20 6765 7420 7468 6520 7469 6d65 2070  o get the time p
+00056270: 6572 696f 6420 6672 6f6d 2074 6865 2054  eriod from the T
+00056280: 696d 6520 656c 656d 656e 7420 696e 2074  ime element in t
+00056290: 6865 2066 6f63 7573 0d0a 2020 2020 2020  he focus..      
+000562a0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
+000562b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000562c0: 2020 2020 2347 6574 2061 6e20 656c 656d      #Get an elem
+000562d0: 656e 7420 6672 6f6d 2074 6865 2073 7472  ent from the str
+000562e0: 7563 7475 7265 202d 2069 7420 7368 6f75  ucture - it shou
+000562f0: 6c64 2068 6176 6520 616e 2045 6d70 6f77  ld have an Empow
+00056300: 6572 2064 6174 6520 7479 7065 2028 7765  er date type (we
+00056310: 656b 2c20 6d6f 6e74 682c 2079 6561 7220  ek, month, year 
+00056320: 6574 632e 2920 616e 6420 7765 2063 616e  etc.) and we can
+00056330: 2075 7365 2074 6861 7420 0d0a 2020 2020   use that ..    
+00056340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00056350: 656d 706f 7765 725f 7469 6d65 5f63 6f6e  empower_time_con
+00056360: 7374 616e 7420 3d20 7365 6c66 2e65 6666  stant = self.eff
+00056370: 6563 7469 7665 5f74 696d 655f 656c 656d  ective_time_elem
+00056380: 656e 7473 5b30 5d2e 696e 7465 7276 616c  ents[0].interval
+00056390: 5f69 6e64 6578 0d0a 2020 2020 2020 2020  _index..        
+000563a0: 2020 2020 2020 2020 6578 6365 7074 2041          except A
+000563b0: 7474 7269 6275 7465 4572 726f 723a 0d0a  ttributeError:..
+000563c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000563d0: 2020 2020 2320 4a75 7374 2067 6f20 7769      # Just go wi
+000563e0: 7468 2074 6865 2064 6566 6175 6c74 2069  th the default i
+000563f0: 6e20 7468 6520 6361 7365 2074 6861 7420  n the case that 
+00056400: 7468 6973 2069 7320 6e6f 7420 6120 7374  this is not a st
+00056410: 616e 6461 7264 2074 696d 6520 656c 656d  andard time elem
+00056420: 656e 742c 206f 7220 6966 2074 6865 7265  ent, or if there
+00056430: 2077 6572 6520 6e6f 2065 6666 6563 7469   were no effecti
+00056440: 7665 2065 6c65 6d65 6e74 7320 2861 6c74  ve elements (alt
+00056450: 686f 7567 6820 7765 206d 6179 206e 6576  hough we may nev
+00056460: 6572 2067 6574 2073 7563 6820 6120 7468  er get such a th
+00056470: 696e 6720 696e 2070 7261 6374 6963 6520  ing in practice 
+00056480: 6265 6361 7573 6520 616e 2065 7272 6f72  because an error
+00056490: 2077 6f75 6c64 2068 6176 6520 6265 656e   would have been
+000564a0: 2072 6169 7365 6420 656c 7365 7768 6572   raised elsewher
+000564b0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000564c0: 2020 2020 2020 2020 7061 7373 0d0a 2020          pass..  
+000564d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000564e0: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
+000564f0: 2020 2020 7265 7475 726e 2072 6574 7572      return retur
+00056500: 6e5f 7661 6c75 652c 2065 6d70 6f77 6572  n_value, empower
+00056510: 5f74 696d 655f 636f 6e73 7461 6e74 0d0a  _time_constant..
+00056520: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00056530: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00056540: 2020 2072 6169 7365 206d 7065 782e 4c6f     raise mpex.Lo
+00056550: 6164 6572 5365 7475 7045 7272 6f72 2827  aderSetupError('
+00056560: 5469 6d65 206d 6170 7069 6e67 206d 7573  Time mapping mus
+00056570: 7420 6265 2073 6574 2075 7020 7769 7468  t be set up with
+00056580: 2061 2076 616c 6964 2065 6c65 6d65 6e74   a valid element
+00056590: 2729 0d0a 0d0a 2020 2020 2020 2020 656c  ')....        el
+000565a0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000565b0: 2072 6574 7572 6e20 7265 7475 726e 5f76   return return_v
+000565c0: 616c 7565 0d0a 0d0a 0d0a 2020 2020 4070  alue......    @p
+000565d0: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+000565e0: 2065 6666 6563 7469 7665 5f74 696d 655f   effective_time_
+000565f0: 656c 656d 656e 7473 2873 656c 6629 3a0d  elements(self):.
+00056600: 0a0d 0a20 2020 2020 2020 206e 6f5f 6d61  ...        no_ma
+00056610: 7070 696e 6773 5f66 6f72 5f74 696d 6520  ppings_for_time 
+00056620: 3d20 7365 6c66 2e5f 6d61 7070 6572 7320  = self._mappers 
+00056630: 6973 204e 6f6e 6520 6f72 2073 656c 662e  is None or self.
+00056640: 5f6d 6170 7065 7273 5b31 315d 2069 7320  _mappers[11] is 
+00056650: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
+00056660: 6966 2073 656c 662e 7461 7267 6574 2069  if self.target i
+00056670: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00056680: 2020 2020 2072 6169 7365 206d 7065 782e       raise mpex.
+00056690: 4c6f 6164 6572 5365 7475 7045 7272 6f72  LoaderSetupError
+000566a0: 2827 4361 6e6e 6f74 2063 6f6d 7075 7465  ('Cannot compute
+000566b0: 2065 6666 6563 7469 7665 2074 696d 6520   effective time 
+000566c0: 656c 656d 656e 7473 2066 6f72 2061 2046  elements for a F
+000566d0: 6f63 7573 4c6f 6164 6572 2077 6869 6368  ocusLoader which
+000566e0: 2068 6173 206e 6f20 7461 7267 6574 2056   has no target V
+000566f0: 6965 7770 6f69 6e74 206f 7220 466f 6375  iewpoint or Focu
+00056700: 7320 7365 7427 290d 0a0d 0a20 2020 2020  s set')....     
+00056710: 2020 2023 7374 7275 6374 7572 6573 5b31     #structures[1
+00056720: 315d 2069 7320 7469 6d65 202d 2077 6520  1] is time - we 
+00056730: 6361 6e74 2720 6765 7420 6566 6665 6374  cant' get effect
+00056740: 6976 6520 7469 6d65 2065 6c65 6d65 6e74  ive time element
+00056750: 7320 7769 7468 206e 6f20 7469 6d65 2073  s with no time s
+00056760: 7472 7563 7475 7265 2073 6574 0d0a 2020  tructure set..  
+00056770: 2020 2020 2020 6966 2073 656c 662e 7461        if self.ta
+00056780: 7267 6574 2e73 7472 7563 7475 7265 735b  rget.structures[
+00056790: 3131 5d20 6973 204e 6f6e 653a 0d0a 2020  11] is None:..  
+000567a0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000567b0: 6d70 6578 2e4c 6f61 6465 7253 6574 7570  mpex.LoaderSetup
+000567c0: 4572 726f 7228 2743 616e 6e6f 7420 636f  Error('Cannot co
+000567d0: 6d70 7574 6520 6566 6665 6374 6976 6520  mpute effective 
+000567e0: 7469 6d65 2065 6c65 6d65 6e74 7320 666f  time elements fo
+000567f0: 7220 6120 466f 6375 734c 6f61 6465 7220  r a FocusLoader 
+00056800: 7768 6963 6820 6861 7320 6e6f 2054 696d  which has no Tim
+00056810: 6520 7374 7275 6374 7572 6520 282e 7374  e structure (.st
+00056820: 7275 6374 7572 6573 5b31 315d 2927 290d  ructures[11])').
+00056830: 0a0d 0a20 2020 2020 2020 2064 696d 656e  ...        dimen
+00056840: 7369 6f6e 5f69 6e64 6578 203d 2031 310d  sion_index = 11.
+00056850: 0a20 2020 2020 2020 2065 6666 6563 7469  .        effecti
+00056860: 7665 5f65 6c65 6d65 6e74 732c 206d 6170  ve_elements, map
+00056870: 7069 6e67 5f74 7970 652c 636f 6c75 6d6e  ping_type,column
+00056880: 5f6e 616d 6573 203d 2073 656c 662e 5f67  _names = self._g
+00056890: 6574 5f69 6d70 6c69 6564 5f73 686f 7274  et_implied_short
+000568a0: 636f 6465 5f6c 6973 745f 616e 645f 6d61  code_list_and_ma
+000568b0: 7070 696e 675f 7479 7065 2864 696d 656e  pping_type(dimen
+000568c0: 7369 6f6e 5f69 6e64 6578 203d 2064 696d  sion_index = dim
+000568d0: 656e 7369 6f6e 5f69 6e64 6578 2c20 6f62  ension_index, ob
+000568e0: 6a65 6374 5f74 6f5f 6368 6563 6b5f 6167  ject_to_check_ag
+000568f0: 6169 6e73 7420 3d73 656c 662e 7461 7267  ainst =self.targ
+00056900: 6574 2e73 7472 7563 7475 7265 735b 6469  et.structures[di
+00056910: 6d65 6e73 696f 6e5f 696e 6465 785d 290d  mension_index]).
+00056920: 0a0d 0a20 2020 2020 2020 2069 6620 6973  ...        if is
+00056930: 696e 7374 616e 6365 2873 656c 662e 7461  instance(self.ta
+00056940: 7267 6574 2e73 7472 7563 7475 7265 735b  rget.structures[
+00056950: 3131 5d2c 5374 7275 6374 7572 6529 2061  11],Structure) a
+00056960: 6e64 206e 6f5f 6d61 7070 696e 6773 5f66  nd no_mappings_f
+00056970: 6f72 5f74 696d 653a 0d0a 2020 2020 2020  or_time:..      
+00056980: 2020 2020 2020 2343 6865 636b 2074 6861        #Check tha
+00056990: 7420 7468 6572 6520 6973 206f 6e6c 7920  t there is only 
+000569a0: 6f6e 6520 6869 6572 6172 6368 7920 6966  one hierarchy if
+000569b0: 2077 6520 6861 7665 2061 2053 7472 7563   we have a Struc
+000569c0: 7475 7265 2061 6e64 206e 6f20 6d61 7070  ture and no mapp
+000569d0: 696e 6773 0d0a 2020 2020 2020 2020 2020  ings..          
+000569e0: 2020 6966 206c 656e 2873 656c 662e 7461    if len(self.ta
+000569f0: 7267 6574 2e73 7472 7563 7475 7265 735b  rget.structures[
+00056a00: 3131 5d2e 6869 6572 6172 6368 6965 7329  11].hierarchies)
+00056a10: 2021 3d20 313a 0d0a 2020 2020 2020 2020   != 1:..        
+00056a20: 2020 2020 2020 2020 7261 6973 6520 6d70          raise mp
+00056a30: 6578 2e4c 6f61 6465 7253 6574 7570 4572  ex.LoaderSetupEr
+00056a40: 726f 7228 2746 6f63 7573 4c6f 6164 6572  ror('FocusLoader
+00056a50: 2077 6974 686f 7574 2061 6e79 206d 6170   without any map
+00056a60: 7069 6e67 7320 6361 6e6e 6f74 2068 616e  pings cannot han
+00056a70: 646c 6520 5469 6d65 2053 7472 7563 7475  dle Time Structu
+00056a80: 7265 7320 7769 7468 2061 6e79 7468 696e  res with anythin
+00056a90: 6720 6f74 6865 7220 7468 616e 2031 2068  g other than 1 h
+00056aa0: 6965 7261 7263 6879 2729 0d0a 0d0a 2020  ierarchy')....  
+00056ab0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00056ac0: 6e63 6528 7365 6c66 2e74 6172 6765 742e  nce(self.target.
+00056ad0: 7374 7275 6374 7572 6573 5b31 315d 2c53  structures[11],S
+00056ae0: 7472 7563 7475 7265 293a 0d0a 0d0a 2020  tructure):....  
+00056af0: 2020 2020 2020 2020 2020 7469 6d65 5f68            time_h
+00056b00: 6965 7261 7263 6879 203d 205b 6820 666f  ierarchy = [h fo
+00056b10: 7220 6820 696e 2073 656c 662e 7461 7267  r h in self.targ
+00056b20: 6574 2e73 7472 7563 7475 7265 735b 3131  et.structures[11
+00056b30: 5d2e 6869 6572 6172 6368 6965 735d 5b30  ].hierarchies][0
+00056b40: 5d0d 0a20 2020 2020 2020 2065 6c69 6620  ]..        elif 
+00056b50: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+00056b60: 7461 7267 6574 2e73 7472 7563 7475 7265  target.structure
+00056b70: 735b 3131 5d2c 5374 7275 6374 7572 6545  s[11],StructureE
+00056b80: 6c65 6d65 6e74 293a 0d0a 2020 2020 2020  lement):..      
+00056b90: 2020 2020 2020 7469 6d65 5f68 6965 7261        time_hiera
+00056ba0: 7263 6879 203d 2073 656c 662e 7461 7267  rchy = self.targ
+00056bb0: 6574 2e73 7472 7563 7475 7265 735b 3131  et.structures[11
+00056bc0: 5d0d 0a0d 0a20 2020 2020 2020 2023 5768  ]....        #Wh
+00056bd0: 6572 6520 7468 6572 6520 6172 6520 6e6f  ere there are no
+00056be0: 206d 6170 7069 6e67 7320 7765 2061 7265   mappings we are
+00056bf0: 2068 6170 7079 2074 6f20 7573 6520 6120   happy to use a 
+00056c00: 7369 6e67 6c65 2065 6c65 6d65 6e74 2069  single element i
+00056c10: 6620 6f6e 6520 6973 2070 7265 7365 6e74  f one is present
+00056c20: 2069 6e20 7468 6520 5469 6d65 2048 6965   in the Time Hie
+00056c30: 7261 7263 6879 2f53 7472 7563 7475 7265  rarchy/Structure
+00056c40: 0d0a 2020 2020 2020 2020 6966 206e 6f5f  ..        if no_
+00056c50: 6d61 7070 696e 6773 5f66 6f72 5f74 696d  mappings_for_tim
+00056c60: 653a 0d0a 0d0a 2020 2020 2020 2020 2020  e:....          
+00056c70: 2020 6966 206c 656e 2874 696d 655f 6869    if len(time_hi
+00056c80: 6572 6172 6368 792e 6368 696c 6472 656e  erarchy.children
+00056c90: 2920 3d3d 2030 3a0d 0a20 2020 2020 2020  ) == 0:..       
+00056ca0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00056cb0: 5b74 696d 655f 6869 6572 6172 6368 795d  [time_hierarchy]
+00056cc0: 0d0a 2020 2020 2020 2020 2020 2020 656c  ..            el
+00056cd0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00056ce0: 2020 2020 2072 6169 7365 206d 7065 782e       raise mpex.
+00056cf0: 4c6f 6164 6572 5365 7475 7045 7272 6f72  LoaderSetupError
+00056d00: 2827 466f 6375 734c 6f61 6465 7220 7769  ('FocusLoader wi
+00056d10: 7468 6f75 7420 616e 7920 6d61 7070 696e  thout any mappin
+00056d20: 6773 2063 616e 6e6f 7420 6861 6e64 6c65  gs cannot handle
+00056d30: 2054 696d 6520 5374 7275 6375 7265 456c   Time StrucureEl
+00056d40: 656d 656e 7473 2077 6974 6820 616e 7974  ements with anyt
+00056d50: 6869 6e67 206f 7468 6572 2074 6861 6e20  hing other than 
+00056d60: 6120 7369 6e67 6c65 2065 6c65 6d65 6e74  a single element
+00056d70: 2729 0d0a 0d0a 2020 2020 2020 2020 6966  ')....        if
+00056d80: 206d 6170 7069 6e67 5f74 7970 6520 3d3d   mapping_type ==
+00056d90: 2027 636f 6e73 7461 6e74 2073 686f 7274   'constant short
+00056da0: 6e61 6d65 273a 0d0a 2020 2020 2020 2020  name':..        
+00056db0: 2020 2020 2343 616e 2067 6574 2074 6865      #Can get the
+00056dc0: 2065 6c65 6d65 6e74 2077 6974 6820 7468   element with th
+00056dd0: 6520 7368 6f72 7463 6f64 6520 616e 6420  e shortcode and 
+00056de0: 7475 726e 2069 7420 696e 746f 2061 2053  turn it into a S
+00056df0: 7472 7563 7475 7265 2065 6c65 6d65 6e74  tructure element
+00056e00: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+00056e10: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00056e20: 2020 2020 6c65 6166 5f65 6c65 6d65 6e74      leaf_element
+00056e30: 7320 3d20 5b53 7472 7563 7475 7265 456c  s = [StructureEl
+00056e40: 656d 656e 7428 656c 656d 656e 743d 7365  ement(element=se
+00056e50: 6c66 2e73 6974 652e 6469 6d65 6e73 696f  lf.site.dimensio
+00056e60: 6e73 5b31 315d 2e65 6c65 6d65 6e74 735b  ns[11].elements[
+00056e70: 6566 6665 6374 6976 655f 656c 656d 656e  effective_elemen
+00056e80: 7473 5b30 5d5d 295d 0d0a 2020 2020 2020  ts[0]])]..      
+00056e90: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00056ea0: 6570 7469 6f6e 2061 7320 653a 0d0a 2020  eption as e:..  
+00056eb0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00056ec0: 696e 7428 2274 696d 655f 6869 6572 6172  int("time_hierar
+00056ed0: 6368 7922 290d 0a20 2020 2020 2020 2020  chy")..         
+00056ee0: 2020 2020 2020 2070 7269 6e74 2874 696d         print(tim
+00056ef0: 655f 6869 6572 6172 6368 7929 0d0a 2020  e_hierarchy)..  
+00056f00: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00056f10: 696e 7428 2265 6666 6563 7469 7665 5f65  int("effective_e
+00056f20: 6c65 6d65 6e74 7322 290d 0a20 2020 2020  lements")..     
+00056f30: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00056f40: 2865 6666 6563 7469 7665 5f65 6c65 6d65  (effective_eleme
+00056f50: 6e74 7329 2020 2020 2020 2020 2020 2020  nts)            
+00056f60: 2020 2020 0d0a 2020 2020 2020 2020 2020      ..          
+00056f70: 2020 2020 2020 7261 6973 6520 650d 0a20        raise e.. 
+00056f80: 2020 2020 2020 2020 2020 200d 0a0d 0a20             .... 
+00056f90: 2020 2020 2020 2065 6c73 653a 0d0a 0d0a         else:....
+00056fa0: 2020 2020 2020 2020 2020 2020 2374 696d              #tim
+00056fb0: 655f 6869 6572 6172 6368 7920 3d20 5b68  e_hierarchy = [h
+00056fc0: 2066 6f72 2068 2069 6e20 7365 6c66 2e74   for h in self.t
+00056fd0: 6172 6765 742e 7374 7275 6374 7572 6573  arget.structures
+00056fe0: 5b31 315d 2e68 6965 7261 7263 6869 6573  [11].hierarchies
+00056ff0: 5d5b 305d 0d0a 2020 2020 2020 2020 2020  ][0]..          
+00057000: 2020 6c65 6166 5f65 6c65 6d65 6e74 7320    leaf_elements 
+00057010: 3d20 5b6c 2066 6f72 206c 2069 6e20 7469  = [l for l in ti
+00057020: 6d65 5f68 6965 7261 7263 6879 2e6c 6561  me_hierarchy.lea
+00057030: 7665 735d 0d0a 0d0a 2020 2020 2020 2020  ves]....        
+00057040: 2323 2343 6865 636b 2074 6865 206c 6561  ###Check the lea
+00057050: 6620 656c 656d 656e 7473 2062 656c 6f77  f elements below
+00057060: 2066 6f72 2063 6f6e 7369 7374 656e 6379   for consistency
+00057070: 2c20 616e 6420 666f 7220 7661 6c69 6469  , and for validi
+00057080: 7479 2061 6761 696e 7374 2074 6865 206d  ty against the m
+00057090: 6170 7069 6e67 2c20 6265 666f 7265 2072  apping, before r
+000570a0: 6574 7572 6e69 6e67 2074 6865 6d0d 0a0d  eturning them...
+000570b0: 0a20 2020 2020 2020 2023 5261 6973 6520  .        #Raise 
+000570c0: 616e 2065 7272 6f72 2069 6620 6974 2069  an error if it i
+000570d0: 7320 6120 7369 6e67 6c65 2063 7572 7265  s a single curre
+000570e0: 6e74 206d 6f6e 7468 2c20 6265 6361 7573  nt month, becaus
+000570f0: 6520 7765 2063 616e 2774 2068 616e 646c  e we can't handl
+00057100: 6520 7468 6174 2079 6574 0d0a 2020 2020  e that yet..    
+00057110: 2020 2020 6966 206c 656e 286c 6561 665f      if len(leaf_
+00057120: 656c 656d 656e 7473 2920 3d3d 2031 2061  elements) == 1 a
+00057130: 6e64 206c 6561 665f 656c 656d 656e 7473  nd leaf_elements
+00057140: 5b30 5d2e 5f73 7461 7274 5f64 6174 6520  [0]._start_date 
+00057150: 6973 204e 6f6e 6520 616e 6420 6c65 6166  is None and leaf
+00057160: 5f65 6c65 6d65 6e74 735b 305d 2e6f 6666  _elements[0].off
+00057170: 7365 7420 6973 206e 6f74 204e 6f6e 653a  set is not None:
+00057180: 0d0a 2020 2020 2020 2020 2020 2020 2357  ..            #W
+00057190: 6520 6861 7665 2061 2066 6f75 6e64 2061  e have a found a
+000571a0: 2043 7572 7265 6e74 204d 6f6e 7468 206f   Current Month o
+000571b0: 7220 4375 7272 656e 7420 5965 6172 2065  r Current Year e
+000571c0: 6c65 6d65 6e74 2061 6e64 2073 6f20 6f6e  lement and so on
+000571d0: 2e0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+000571e0: 6e74 6572 7661 6c20 3d20 6c65 6166 5f65  nterval = leaf_e
+000571f0: 6c65 6d65 6e74 735b 305d 2e69 6e74 6572  lements[0].inter
+00057200: 7661 6c0d 0a20 2020 2020 2020 2020 2020  val..           
+00057210: 206f 6666 7365 7420 2020 3d20 6c65 6166   offset   = leaf
+00057220: 5f65 6c65 6d65 6e74 735b 305d 2e6f 6666  _elements[0].off
+00057230: 7365 740d 0a20 2020 2020 2020 2020 2020  set..           
+00057240: 2023 4765 7420 7468 6520 6461 7461 2066   #Get the data f
+00057250: 6f72 2074 6865 2043 7572 7265 6e74 204d  or the Current M
+00057260: 6f6e 7468 2066 6f72 2074 6865 2069 6e74  onth for the int
+00057270: 6572 7661 6c2c 2061 6e64 206d 6f76 6520  erval, and move 
+00057280: 6279 2074 6865 206f 6666 7365 740d 0a20  by the offset.. 
+00057290: 2020 2020 2020 2020 2020 2023 544f 444f             #TODO
+000572a0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+000572b0: 6973 6520 6d70 6578 2e4c 6f61 6465 7253  ise mpex.LoaderS
+000572c0: 6574 7570 4572 726f 7228 274e 6f74 2049  etupError('Not I
+000572d0: 6d70 6c65 6d65 6e74 6564 2e20 5469 6d65  mplemented. Time
+000572e0: 206d 6170 7069 6e67 2066 726f 6d20 6120   mapping from a 
+000572f0: 6375 7272 656e 7420 6d6f 6e74 6820 6973  current month is
+00057300: 206e 6f74 2079 6574 2069 6d70 6c65 6d65   not yet impleme
+00057310: 6e74 6564 2729 0d0a 0d0a 2020 2020 2020  nted')....      
+00057320: 2020 656c 7365 203a 0d0a 2020 2020 2020    else :..      
+00057330: 2020 2020 2020 234f 722c 2063 6865 636b        #Or, check
+00057340: 2074 6861 7420 7468 6520 6c65 6166 2065   that the leaf e
+00057350: 6c65 6d65 6e74 7320 6172 6520 6f66 2061  lements are of a
+00057360: 2073 696e 676c 6520 456d 706f 7765 7220   single Empower 
+00057370: 7469 6d65 2074 7970 6520 2865 2e67 2e20  time type (e.g. 
+00057380: 616c 6c20 4d4f 4e54 4829 0d0a 2020 2020  all MONTH)..    
+00057390: 2020 2020 2020 2020 2341 6e64 2074 6861          #And tha
+000573a0: 7420 7468 6520 656c 656d 656e 7473 2061  t the elements a
+000573b0: 7265 2063 6f6e 7469 6775 6f75 730d 0a20  re contiguous.. 
+000573c0: 2020 2020 2020 2020 2020 2065 6d70 6f77             empow
+000573d0: 6572 5f74 696d 655f 7479 7065 203d 204e  er_time_type = N
+000573e0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+000573f0: 2070 7265 7669 6f75 735f 6461 7465 203d   previous_date =
+00057400: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+00057410: 2020 2070 7265 7669 6f75 735f 7365 203d     previous_se =
+00057420: 204e 6f6e 650d 0a0d 0a20 2020 2020 2020   None....       
+00057430: 2020 2020 2064 6174 6573 5f74 6f5f 6c65       dates_to_le
+00057440: 6166 5f65 6c65 6d65 6e74 735f 6c6b 7020  af_elements_lkp 
+00057450: 3d20 7b7d 0d0a 0d0a 2020 2020 2020 2020  = {}....        
+00057460: 2020 2020 666f 7220 7365 2069 6e20 6c65      for se in le
+00057470: 6166 5f65 6c65 6d65 6e74 733a 0d0a 0d0a  af_elements:....
+00057480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057490: 2343 6865 636b 2061 6c6c 2066 6965 6c64  #Check all field
+000574a0: 7320 6172 6520 706f 7075 6c61 7465 6420  s are populated 
+000574b0: 6173 2077 6520 776f 756c 6420 6578 7065  as we would expe
+000574c0: 6374 0d0a 2020 2020 2020 2020 2020 2020  ct..            
+000574d0: 2020 2020 6966 2065 6d70 6f77 6572 5f74      if empower_t
+000574e0: 696d 655f 7479 7065 2069 7320 4e6f 6e65  ime_type is None
+000574f0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00057500: 2020 2020 2020 2065 6d70 6f77 6572 5f74         empower_t
+00057510: 696d 655f 7479 7065 203d 2073 652e 696e  ime_type = se.in
+00057520: 7465 7276 616c 0d0a 0d0a 2020 2020 2020  terval....      
+00057530: 2020 2020 2020 2020 2020 6966 2065 6d70            if emp
+00057540: 6f77 6572 5f74 696d 655f 7479 7065 2021  ower_time_type !
+00057550: 3d20 7365 2e69 6e74 6572 7661 6c3a 0d0a  = se.interval:..
+00057560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057570: 2020 2020 7261 6973 6520 6d70 6578 2e4c      raise mpex.L
+00057580: 6f61 6465 7253 6574 7570 4572 726f 7228  oaderSetupError(
+00057590: 2743 616e 6e6f 7420 6c6f 6164 2069 6e74  'Cannot load int
+000575a0: 6f20 6120 6869 6572 6172 6368 7920 6f66  o a hierarchy of
+000575b0: 2074 696d 6520 656c 656d 656e 7473 2077   time elements w
+000575c0: 6974 6820 6d6f 7265 2074 6861 6e20 6f6e  ith more than on
+000575d0: 6520 496e 7465 7276 616c 2074 7970 652e  e Interval type.
+000575e0: 2054 696d 6520 656c 656d 656e 7420 7b7d   Time element {}
+000575f0: 2069 6e20 6869 6572 6172 6368 7920 7b7d   in hierarchy {}
+00057600: 2077 6974 6820 496e 7465 7276 616c 207b   with Interval {
+00057610: 7d20 6e6f 7420 7361 6d65 2061 7320 7072  } not same as pr
+00057620: 6576 696f 7573 2049 6e74 6572 7661 6c20  evious Interval 
+00057630: 7b7d 272e 666f 726d 6174 2873 652e 7368  {}'.format(se.sh
+00057640: 6f72 746e 616d 652c 7469 6d65 5f68 6965  ortname,time_hie
+00057650: 7261 7263 6879 2e70 6174 682c 7365 2e69  rarchy.path,se.i
+00057660: 6e74 6572 7661 6c2c 656d 706f 7765 725f  nterval,empower_
+00057670: 7469 6d65 5f74 7970 6529 290d 0a0d 0a20  time_type)).... 
+00057680: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00057690: 4368 6563 6b20 6966 2074 7970 6520 6f72  Check if type or
+000576a0: 2069 6e74 6572 7661 6c20 6973 204e 6f6e   interval is Non
+000576b0: 6520 2d20 6966 2073 6f20 7765 2061 7265  e - if so we are
+000576c0: 2072 756e 6e69 6e67 2074 6865 206c 6f6f   running the loo
+000576d0: 7020 666f 7220 7468 6520 6669 7273 7420  p for the first 
+000576e0: 7469 6d65 0d0a 0d0a 2020 2020 2020 2020  time....        
+000576f0: 2020 2020 2020 2020 6966 2073 652e 6772          if se.gr
+00057700: 6f75 705f 6f6e 6c79 2069 7320 6e6f 7420  oup_only is not 
+00057710: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00057720: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00057730: 206d 7065 782e 4c6f 6164 6572 5365 7475   mpex.LoaderSetu
+00057740: 7045 7272 6f72 2827 4361 6e6e 6f74 206c  pError('Cannot l
+00057750: 6f61 6420 696e 746f 2047 726f 7570 2d4f  oad into Group-O
+00057760: 6e6c 7920 7469 6d65 2065 6c65 6d65 6e74  nly time element
+00057770: 207b 7d20 696e 2068 6965 7261 7263 6879   {} in hierarchy
+00057780: 207b 7d27 2e66 6f72 6d61 7428 7365 2e73   {}'.format(se.s
+00057790: 686f 7274 6e61 6d65 2c74 696d 655f 6869  hortname,time_hi
+000577a0: 6572 6172 6368 792e 7061 7468 2929 0d0a  erarchy.path))..
+000577b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000577c0: 2020 6966 2073 652e 696e 7465 7276 616c    if se.interval
+000577d0: 5f61 6d6f 756e 7420 213d 2031 3a0d 0a20  _amount != 1:.. 
+000577e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000577f0: 2020 2072 6169 7365 206d 7065 782e 4c6f     raise mpex.Lo
+00057800: 6164 6572 5365 7475 7045 7272 6f72 2827  aderSetupError('
+00057810: 4361 6e6e 6f74 206c 6f61 6420 696e 746f  Cannot load into
+00057820: 2074 696d 6520 656c 656d 656e 7473 2077   time elements w
+00057830: 6974 6820 496e 7465 7276 616c 2041 6d6f  ith Interval Amo
+00057840: 756e 7473 206f 7468 6572 2074 6861 6e20  unts other than 
+00057850: 312e 2054 696d 6520 656c 656d 656e 7420  1. Time element 
+00057860: 7b7d 2069 6e20 6869 6572 6172 6368 7920  {} in hierarchy 
+00057870: 7b7d 2077 6974 6820 496e 7465 7276 616c  {} with Interval
+00057880: 2041 6d6f 756e 7420 7b7d 272e 666f 726d   Amount {}'.form
+00057890: 6174 2873 652e 7368 6f72 746e 616d 652c  at(se.shortname,
+000578a0: 7469 6d65 5f68 6965 7261 7263 6879 2e70  time_hierarchy.p
+000578b0: 6174 682c 7365 2e69 6e74 6572 7661 6c5f  ath,se.interval_
+000578c0: 616d 6f75 6e74 2929 0d0a 0d0a 2020 2020  amount))....    
+000578d0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000578e0: 652e 696e 7465 7276 616c 2021 3d20 7365  e.interval != se
+000578f0: 2e72 6573 6f6c 7574 696f 6e3a 0d0a 2020  .resolution:..  
+00057900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057910: 2020 7261 6973 6520 6d70 6578 2e4c 6f61    raise mpex.Loa
+00057920: 6465 7253 6574 7570 4572 726f 7228 2743  derSetupError('C
+00057930: 616e 6e6f 7420 6c6f 6164 2069 6e74 6f20  annot load into 
+00057940: 7469 6d65 2065 6c65 6d65 6e74 7320 7769  time elements wi
+00057950: 7468 2049 6e74 6572 7661 6c20 416d 6f75  th Interval Amou
+00057960: 6e74 206e 6f74 2065 7175 616c 2074 6f20  nt not equal to 
+00057970: 6974 7320 5265 736f 6c75 7469 6f6e 2e20  its Resolution. 
+00057980: 5469 6d65 2065 6c65 6d65 6e74 207b 7d20  Time element {} 
+00057990: 696e 2068 6965 7261 7263 6879 207b 7d20  in hierarchy {} 
+000579a0: 7769 7468 2049 6e74 6572 7661 6c20 416d  with Interval Am
+000579b0: 6f75 6e74 207b 7d20 616e 6420 5265 736f  ount {} and Reso
+000579c0: 6c75 7469 6f6e 207b 7d27 2e66 6f72 6d61  lution {}'.forma
+000579d0: 7428 7365 2e73 686f 7274 6e61 6d65 2c74  t(se.shortname,t
+000579e0: 696d 655f 6869 6572 6172 6368 792e 7061  ime_hierarchy.pa
+000579f0: 7468 2c73 652e 696e 7465 7276 616c 5f61  th,se.interval_a
+00057a00: 6d6f 756e 742c 7365 2e72 6573 6f6c 7574  mount,se.resolut
+00057a10: 696f 6e29 290d 0a0d 0a0d 0a20 2020 2020  ion))......     
+00057a20: 2020 2020 2020 2020 2020 2064 6174 6520             date 
+00057a30: 3d20 7365 2e65 6c65 6d65 6e74 2e64 6174  = se.element.dat
+00057a40: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00057a50: 2020 2069 6620 6461 7465 2069 7320 6e6f     if date is no
+00057a60: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
+00057a70: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00057a80: 6573 5f74 6f5f 6c65 6166 5f65 6c65 6d65  es_to_leaf_eleme
+00057a90: 6e74 735f 6c6b 705b 6461 7465 5d20 3d20  nts_lkp[date] = 
+00057aa0: 7365 0d0a 0d0a 2020 2020 2020 2020 2020  se....          
+00057ab0: 2020 2020 2020 6966 2070 7265 7669 6f75        if previou
+00057ac0: 735f 6461 7465 2069 7320 6e6f 7420 4e6f  s_date is not No
+00057ad0: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00057ae0: 2020 2020 2020 2020 2069 6620 656d 706f           if empo
+00057af0: 7765 725f 7469 6d65 5f74 7970 6520 3d3d  wer_time_type ==
+00057b00: 2027 4d6f 6e74 6827 3a0d 0a20 2020 2020   'Month':..     
+00057b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057b20: 2020 2069 6620 7072 6576 696f 7573 5f64     if previous_d
+00057b30: 6174 6520 2b20 4d4f 4e54 4820 213d 2064  ate + MONTH != d
+00057b40: 6174 653a 0d0a 2020 2020 2020 2020 2020  ate:..          
+00057b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057b60: 2020 7261 6973 6520 6d70 6578 2e4c 6f61    raise mpex.Loa
+00057b70: 6465 7253 6574 7570 4572 726f 7228 2743  derSetupError('C
+00057b80: 616e 206f 6e6c 7920 6c6f 6164 2069 6e74  an only load int
+00057b90: 6f20 6120 5669 6577 706f 696e 7420 7769  o a Viewpoint wi
+00057ba0: 7468 2063 6f6e 7469 6775 6f75 7320 7469  th contiguous ti
+00057bb0: 6d65 2065 6c65 6d65 6e74 732e 2044 6174  me elements. Dat
+00057bc0: 6520 7b7d 2069 6e20 656c 656d 656e 7420  e {} in element 
+00057bd0: 7b7d 2066 6f6c 6c6f 7765 6420 6461 7465  {} followed date
+00057be0: 207b 7d20 696e 2065 6c65 6d65 6e74 2069   {} in element i
+00057bf0: 6e20 6869 6572 6172 6368 7920 7b7d 272e  n hierarchy {}'.
+00057c00: 666f 726d 6174 2864 6174 652c 7365 2e73  format(date,se.s
+00057c10: 686f 7274 6e61 6d65 2c70 7265 7669 6f75  hortname,previou
+00057c20: 735f 6461 7465 2c70 7265 7669 6f75 735f  s_date,previous_
+00057c30: 7365 2e73 686f 7274 6e61 6d65 2c74 696d  se.shortname,tim
+00057c40: 655f 6869 6572 6172 6368 792e 7061 7468  e_hierarchy.path
+00057c50: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
+00057c60: 2020 2020 2020 2020 2020 656c 6966 2065            elif e
+00057c70: 6d70 6f77 6572 5f74 696d 655f 7479 7065  mpower_time_type
+00057c80: 203d 3d20 2759 6561 7227 3a0d 0a20 2020   == 'Year':..   
+00057c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057ca0: 2020 2020 2069 6620 7072 6576 696f 7573       if previous
+00057cb0: 5f64 6174 6520 2b20 5945 4152 2021 3d20  _date + YEAR != 
+00057cc0: 6461 7465 3a0d 0a20 2020 2020 2020 2020  date:..         
+00057cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00057ce0: 2020 2072 6169 7365 206d 7065 782e 4c6f     raise mpex.Lo
+00057cf0: 6164 6572 5365 7475 7045 7272 6f72 2827  aderSetupError('
+00057d00: 4361 6e20 6f6e 6c79 206c 6f61 6420 696e  Can only load in
+00057d10: 746f 2061 2056 6965 7770 6f69 6e74 2077  to a Viewpoint w
+00057d20: 6974 6820 636f 6e74 6967 756f 7573 2074  ith contiguous t
+00057d30: 696d 6520 656c 656d 656e 7473 2e20 4461  ime elements. Da
+00057d40: 7465 207b 7d20 696e 2065 6c65 6d65 6e74  te {} in element
+00057d50: 207b 7d20 666f 6c6c 6f77 6564 2064 6174   {} followed dat
+00057d60: 6520 7b7d 2069 6e20 656c 656d 656e 7420  e {} in element 
+00057d70: 696e 2068 6965 7261 7263 6879 207b 7d27  in hierarchy {}'
+00057d80: 2e66 6f72 6d61 7428 6461 7465 2c73 652e  .format(date,se.
+00057d90: 7368 6f72 746e 616d 652c 7072 6576 696f  shortname,previo
+00057da0: 7573 5f64 6174 652c 7072 6576 696f 7573  us_date,previous
+00057db0: 5f73 652e 7368 6f72 746e 616d 652c 7469  _se.shortname,ti
+00057dc0: 6d65 5f68 6965 7261 7263 6879 2e70 6174  me_hierarchy.pat
+00057dd0: 6829 290d 0a0d 0a0d 0a20 2020 2020 2020  h))......       
+00057de0: 2020 2020 2020 2020 2070 7265 7669 6f75           previou
+00057df0: 735f 7469 6d65 5f74 7970 6520 3d20 656d  s_time_type = em
+00057e00: 706f 7765 725f 7469 6d65 5f74 7970 650d  power_time_type.
+00057e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00057e20: 2070 7265 7669 6f75 735f 6461 7465 203d   previous_date =
+00057e30: 2064 6174 650d 0a20 2020 2020 2020 2020   date..         
+00057e40: 2020 2020 2020 2070 7265 7669 6f75 735f         previous_
+00057e50: 7365 203d 2073 650d 0a0d 0a20 2020 2020  se = se....     
+00057e60: 2020 2020 2020 2069 6620 6d61 7070 696e         if mappin
+00057e70: 675f 7479 7065 203d 3d20 2763 6f6e 7374  g_type == 'const
+00057e80: 616e 7420 6461 7465 273a 0d0a 2020 2020  ant date':..    
+00057e90: 2020 2020 2020 2020 2020 2020 2353 696e              #Sin
+00057ea0: 6365 2061 6c6c 206f 6620 7468 6520 6461  ce all of the da
+00057eb0: 7465 7320 696e 2074 6865 206c 6561 7665  tes in the leave
+00057ec0: 7320 6f66 2074 6865 2068 6965 7261 7263  s of the hierarc
+00057ed0: 6879 2061 7265 206f 6620 7468 6520 7361  hy are of the sa
+00057ee0: 6d65 2045 6d70 6f77 6572 2044 6174 6520  me Empower Date 
+00057ef0: 5479 7065 0d0a 2020 2020 2020 2020 2020  Type..          
+00057f00: 2020 2020 2020 2354 6865 6e20 456d 706f        #Then Empo
+00057f10: 7765 7220 4461 7465 2054 7970 6520 6973  wer Date Type is
+00057f20: 2075 6e61 6d62 6967 756f 7573 2061 6e64   unambiguous and
+00057f30: 2074 6865 2063 6f6e 7374 616e 7420 6461   the constant da
+00057f40: 7465 2069 6e20 7468 6520 6d61 7070 696e  te in the mappin
+00057f50: 6720 6d75 7374 2062 6520 7365 656e 2069  g must be seen i
+00057f60: 6e20 7468 6520 636f 6e74 6578 7420 6f66  n the context of
+00057f70: 2074 6869 7320 6461 7465 2074 7970 650d   this date type.
+00057f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00057f90: 206f 7269 6769 6e61 6c5f 6461 7465 203d   original_date =
+00057fa0: 2073 656c 662e 5f6d 6170 7065 7273 5b31   self._mappers[1
+00057fb0: 315d 0d0a 2020 2020 2020 2020 2020 2020  1]..            
+00057fc0: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+00057fd0: 7461 6e63 6528 6f72 6967 696e 616c 5f64  tance(original_d
+00057fe0: 6174 652c 6461 7465 7469 6d65 2e64 6174  ate,datetime.dat
+00057ff0: 6574 696d 6529 0d0a 0d0a 2020 2020 2020  etime)....      
+00058000: 2020 2020 2020 2020 2020 2354 7261 6e73            #Trans
+00058010: 666f 726d 2074 6865 206d 6170 706e 6967  form the mappnig
+00058020: 2074 6f20 6461 7465 2074 6f20 6f6e 6520   to date to one 
+00058030: 7468 6174 2077 696c 6c20 6c6f 6f6b 2075  that will look u
+00058040: 7020 7468 6520 636f 7272 6563 7420 656c  p the correct el
+00058050: 656d 656e 740d 0a20 2020 2020 2020 2020  ement..         
+00058060: 2020 2020 2020 2069 6620 656d 706f 7765         if empowe
+00058070: 725f 7469 6d65 5f74 7970 6520 3d3d 2027  r_time_type == '
+00058080: 4d6f 6e74 6827 3a0d 0a20 2020 2020 2020  Month':..       
+00058090: 2020 2020 2020 2020 2020 2020 206c 6f6f               loo
+000580a0: 6b75 705f 6461 7465 203d 2064 6174 6574  kup_date = datet
+000580b0: 696d 652e 6461 7465 7469 6d65 286f 7269  ime.datetime(ori
+000580c0: 6769 6e61 6c5f 6461 7465 2e79 6561 722c  ginal_date.year,
+000580d0: 206f 7269 6769 6e61 6c5f 6461 7465 2e6d   original_date.m
+000580e0: 6f6e 7468 2c31 290d 0a20 2020 2020 2020  onth,1)..       
+000580f0: 2020 2020 2020 2020 2065 6c69 6620 656d           elif em
+00058100: 706f 7765 725f 7469 6d65 5f74 7970 6520  power_time_type 
+00058110: 3d3d 2027 5965 6172 273a 0d0a 2020 2020  == 'Year':..    
+00058120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00058130: 6c6f 6f6b 7570 5f64 6174 6520 3d20 6461  lookup_date = da
+00058140: 7465 7469 6d65 2e64 6174 6574 696d 6528  tetime.datetime(
+00058150: 6f72 6967 696e 616c 5f64 6174 652e 7965  original_date.ye
+00058160: 6172 2c20 312c 3129 0d0a 2020 2020 2020  ar, 1,1)..      
+00058170: 2020 2020 2020 2020 2020 656c 7365 3a0d            else:.
+00058180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00058190: 2020 2020 2023 4f74 6865 7220 636f 6465       #Other code
+000581a0: 2073 686f 756c 6420 6861 7665 2072 6169   should have rai
+000581b0: 7365 6420 7468 6520 6578 6365 7074 696f  sed the exceptio
+000581c0: 6e20 6966 2075 6e68 616e 646c 6564 2064  n if unhandled d
+000581d0: 6174 6520 7479 7065 2065 6e74 6572 6564  ate type entered
+000581e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000581f0: 2020 2020 2020 6173 7365 7274 2046 616c        assert Fal
+00058200: 7365 0d0a 2020 2020 2020 2020 2020 2020  se..            
+00058210: 2020 2020 6c65 6166 5f65 6c65 6d65 6e74      leaf_element
+00058220: 203d 2064 6174 6573 5f74 6f5f 6c65 6166   = dates_to_leaf
+00058230: 5f65 6c65 6d65 6e74 735f 6c6b 705b 6c6f  _elements_lkp[lo
+00058240: 6f6b 7570 5f64 6174 655d 0d0a 2020 2020  okup_date]..    
+00058250: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00058260: 726e 205b 6c65 6166 5f65 6c65 6d65 6e74  rn [leaf_element
+00058270: 5d0d 0a20 2020 2020 2020 2020 2020 2065  ]..            e
+00058280: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00058290: 2020 2020 2020 7265 7475 726e 206c 6561        return lea
+000582a0: 665f 656c 656d 656e 7473 0d0a 0d0a 2020  f_elements....  
+000582b0: 2020 2020 2020 7265 7475 726e 2065 6666        return eff
+000582c0: 6563 7469 7665 5f65 6c65 6d65 6e74 730d  ective_elements.
+000582d0: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+000582e0: 0d0a 2020 2020 6465 6620 6566 6665 6374  ..    def effect
+000582f0: 6976 655f 6469 6d30 5f65 6c65 6d65 6e74  ive_dim0_element
+00058300: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+00058310: 2020 7265 7475 726e 2073 656c 662e 6566    return self.ef
+00058320: 6665 6374 6976 655f 756e 6974 5f64 696d  fective_unit_dim
+00058330: 656e 7369 6f6e 5f65 6c65 6d65 6e74 7328  ension_elements(
+00058340: 6469 6d65 6e73 696f 6e5f 696e 6465 783d  dimension_index=
+00058350: 3029 0d0a 2020 2020 4070 726f 7065 7274  0)..    @propert
+00058360: 790d 0a20 2020 2064 6566 2065 6666 6563  y..    def effec
+00058370: 7469 7665 5f64 696d 315f 656c 656d 656e  tive_dim1_elemen
+00058380: 7473 2873 656c 6629 3a0d 0a20 2020 2020  ts(self):..     
+00058390: 2020 2072 6574 7572 6e20 7365 6c66 2e65     return self.e
+000583a0: 6666 6563 7469 7665 5f75 6e69 745f 6469  ffective_unit_di
+000583b0: 6d65 6e73 696f 6e5f 656c 656d 656e 7473  mension_elements
+000583c0: 2864 696d 656e 7369 6f6e 5f69 6e64 6578  (dimension_index
+000583d0: 3d31 290d 0a20 2020 2040 7072 6f70 6572  =1)..    @proper
+000583e0: 7479 0d0a 2020 2020 6465 6620 6566 6665  ty..    def effe
+000583f0: 6374 6976 655f 6469 6d32 5f65 6c65 6d65  ctive_dim2_eleme
+00058400: 6e74 7328 7365 6c66 293a 0d0a 2020 2020  nts(self):..    
+00058410: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00058420: 6566 6665 6374 6976 655f 756e 6974 5f64  effective_unit_d
+00058430: 696d 656e 7369 6f6e 5f65 6c65 6d65 6e74  imension_element
+00058440: 7328 6469 6d65 6e73 696f 6e5f 696e 6465  s(dimension_inde
+00058450: 783d 3229 0d0a 2020 2020 4070 726f 7065  x=2)..    @prope
+00058460: 7274 790d 0a20 2020 2064 6566 2065 6666  rty..    def eff
+00058470: 6563 7469 7665 5f64 696d 335f 656c 656d  ective_dim3_elem
+00058480: 656e 7473 2873 656c 6629 3a0d 0a20 2020  ents(self):..   
+00058490: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000584a0: 2e65 6666 6563 7469 7665 5f75 6e69 745f  .effective_unit_
+000584b0: 6469 6d65 6e73 696f 6e5f 656c 656d 656e  dimension_elemen
+000584c0: 7473 2864 696d 656e 7369 6f6e 5f69 6e64  ts(dimension_ind
+000584d0: 6578 3d33 290d 0a20 2020 2040 7072 6f70  ex=3)..    @prop
+000584e0: 6572 7479 0d0a 2020 2020 6465 6620 6566  erty..    def ef
+000584f0: 6665 6374 6976 655f 6469 6d34 5f65 6c65  fective_dim4_ele
+00058500: 6d65 6e74 7328 7365 6c66 293a 0d0a 2020  ments(self):..  
+00058510: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00058520: 662e 6566 6665 6374 6976 655f 756e 6974  f.effective_unit
+00058530: 5f64 696d 656e 7369 6f6e 5f65 6c65 6d65  _dimension_eleme
+00058540: 6e74 7328 6469 6d65 6e73 696f 6e5f 696e  nts(dimension_in
+00058550: 6465 783d 3429 0d0a 2020 2020 4070 726f  dex=4)..    @pro
+00058560: 7065 7274 790d 0a20 2020 2064 6566 2065  perty..    def e
+00058570: 6666 6563 7469 7665 5f64 696d 355f 656c  ffective_dim5_el
+00058580: 656d 656e 7473 2873 656c 6629 3a0d 0a20  ements(self):.. 
+00058590: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000585a0: 6c66 2e65 6666 6563 7469 7665 5f75 6e69  lf.effective_uni
+000585b0: 745f 6469 6d65 6e73 696f 6e5f 656c 656d  t_dimension_elem
+000585c0: 656e 7473 2864 696d 656e 7369 6f6e 5f69  ents(dimension_i
+000585d0: 6e64 6578 3d35 290d 0a20 2020 2040 7072  ndex=5)..    @pr
+000585e0: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+000585f0: 6566 6665 6374 6976 655f 6469 6d36 5f65  effective_dim6_e
+00058600: 6c65 6d65 6e74 7328 7365 6c66 293a 0d0a  lements(self):..
+00058610: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00058620: 656c 662e 6566 6665 6374 6976 655f 756e  elf.effective_un
+00058630: 6974 5f64 696d 656e 7369 6f6e 5f65 6c65  it_dimension_ele
+00058640: 6d65 6e74 7328 6469 6d65 6e73 696f 6e5f  ments(dimension_
+00058650: 696e 6465 783d 3629 0d0a 2020 2020 4070  index=6)..    @p
+00058660: 726f 7065 7274 790d 0a20 2020 2064 6566  roperty..    def
+00058670: 2065 6666 6563 7469 7665 5f64 696d 375f   effective_dim7_
+00058680: 656c 656d 656e 7473 2873 656c 6629 3a0d  elements(self):.
+00058690: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000586a0: 7365 6c66 2e65 6666 6563 7469 7665 5f75  self.effective_u
+000586b0: 6e69 745f 6469 6d65 6e73 696f 6e5f 656c  nit_dimension_el
+000586c0: 656d 656e 7473 2864 696d 656e 7369 6f6e  ements(dimension
+000586d0: 5f69 6e64 6578 3d37 290d 0a0d 0a20 2020  _index=7)....   
+000586e0: 2064 6566 205f 6669 7273 745f 756e 6772   def _first_ungr
+000586f0: 6f75 7065 645f 6368 696c 6472 656e 2873  ouped_children(s
+00058700: 656c 662c 7374 7275 6374 7572 655f 656c  elf,structure_el
+00058710: 656d 656e 7429 3a0d 0a20 2020 2020 2020  ement):..       
+00058720: 2069 6620 7374 7275 6374 7572 655f 656c   if structure_el
+00058730: 656d 656e 742e 6772 6f75 705f 6f6e 6c79  ement.group_only
+00058740: 203d 3d20 2747 726f 7570 273a 0d0a 2020   == 'Group':..  
+00058750: 2020 2020 2020 2020 2020 616c 6c5f 6368            all_ch
+00058760: 696c 6472 656e 203d 205b 5d0d 0a20 2020  ildren = []..   
+00058770: 2020 2020 2020 2020 2066 6f72 2063 6820           for ch 
+00058780: 696e 2073 7472 7563 7475 7265 5f65 6c65  in structure_ele
+00058790: 6d65 6e74 2e63 6869 6c64 7265 6e3a 0d0a  ment.children:..
+000587a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000587b0: 616c 6c5f 6368 696c 6472 656e 202b 3d20  all_children += 
+000587c0: 7365 6c66 2e5f 6669 7273 745f 756e 6772  self._first_ungr
+000587d0: 6f75 7065 645f 6368 696c 6472 656e 2863  ouped_children(c
+000587e0: 6829 0d0a 2020 2020 2020 2020 2020 2020  h)..            
+000587f0: 7265 7475 726e 2061 6c6c 5f63 6869 6c64  return all_child
+00058800: 7265 6e0d 0a20 2020 2020 2020 2065 6c73  ren..        els
+00058810: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00058820: 7265 7475 726e 205b 7374 7275 6374 7572  return [structur
+00058830: 655f 656c 656d 656e 745d 0d0a 0d0a 2020  e_element]....  
+00058840: 2020 6465 6620 6566 6665 6374 6976 655f    def effective_
+00058850: 6469 6d65 6e73 696f 6e5f 656c 656d 656e  dimension_elemen
+00058860: 7473 2873 656c 662c 6469 6d65 6e73 696f  ts(self,dimensio
+00058870: 6e5f 696e 6465 7829 3a0d 0a20 2020 2020  n_index):..     
+00058880: 2020 2069 6620 6469 6d65 6e73 696f 6e5f     if dimension_
+00058890: 696e 6465 7820 3c3d 2037 3a0d 0a20 2020  index <= 7:..   
+000588a0: 2020 2020 2020 2020 2069 6620 6469 6d65           if dime
+000588b0: 6e73 696f 6e5f 696e 6465 7820 3c20 7365  nsion_index < se
+000588c0: 6c66 2e73 6974 652e 6e75 6d62 6572 5f6f  lf.site.number_o
+000588d0: 665f 756e 6974 5f64 696d 656e 7369 6f6e  f_unit_dimension
+000588e0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+000588f0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00058900: 6566 6665 6374 6976 655f 756e 6974 5f64  effective_unit_d
+00058910: 696d 656e 7369 6f6e 5f65 6c65 6d65 6e74  imension_element
+00058920: 7328 6469 6d65 6e73 696f 6e5f 696e 6465  s(dimension_inde
+00058930: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
+00058940: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00058950: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00058960: 6e65 0d0a 2020 2020 2020 2020 656c 6966  ne..        elif
+00058970: 2064 696d 656e 7369 6f6e 5f69 6e64 6578   dimension_index
+00058980: 203d 3d20 383a 0d0a 2020 2020 2020 2020   == 8:..        
+00058990: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+000589a0: 6566 6665 6374 6976 655f 696e 6469 6361  effective_indica
+000589b0: 746f 725f 656c 656d 656e 7473 0d0a 2020  tor_elements..  
+000589c0: 2020 2020 2020 656c 6966 2064 696d 656e        elif dimen
+000589d0: 7369 6f6e 5f69 6e64 6578 203d 3d20 393a  sion_index == 9:
+000589e0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+000589f0: 7475 726e 2073 656c 662e 6566 6665 6374  turn self.effect
+00058a00: 6976 655f 636f 6d70 6172 6973 6f6e 5f65  ive_comparison_e
+00058a10: 6c65 6d65 6e74 730d 0a20 2020 2020 2020  lements..       
+00058a20: 2065 6c69 6620 6469 6d65 6e73 696f 6e5f   elif dimension_
+00058a30: 696e 6465 7820 3d3d 2031 303a 0d0a 2020  index == 10:..  
+00058a40: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00058a50: 2073 656c 662e 6566 6665 6374 6976 655f   self.effective_
+00058a60: 6375 7272 656e 6379 5f65 6c65 6d65 6e74  currency_element
+00058a70: 730d 0a20 2020 2020 2020 2065 6c69 6620  s..        elif 
+00058a80: 6469 6d65 6e73 696f 6e5f 696e 6465 7820  dimension_index 
+00058a90: 3d3d 2031 313a 0d0a 2020 2020 2020 2020  == 11:..        
+00058aa0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00058ab0: 6566 6665 6374 6976 655f 7469 6d65 5f65  effective_time_e
+00058ac0: 6c65 6d65 6e74 730d 0a20 2020 2020 2020  lements..       
+00058ad0: 2065 6c69 6620 6469 6d65 6e73 696f 6e5f   elif dimension_
+00058ae0: 696e 6465 7820 3d3d 2031 323a 0d0a 2020  index == 12:..  
+00058af0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00058b00: 2073 656c 662e 6566 6665 6374 6976 655f   self.effective_
+00058b10: 7472 616e 7366 6f72 6d5f 656c 656d 656e  transform_elemen
+00058b20: 7473 0d0a 0d0a 0d0a 2020 2020 6465 6620  ts......    def 
+00058b30: 6566 6665 6374 6976 655f 756e 6974 5f64  effective_unit_d
+00058b40: 696d 656e 7369 6f6e 5f65 6c65 6d65 6e74  imension_element
+00058b50: 7328 7365 6c66 2c64 696d 656e 7369 6f6e  s(self,dimension
+00058b60: 5f69 6e64 6578 293a 0d0a 0d0a 2020 2020  _index):....    
+00058b70: 2020 2020 7365 6c66 2e5f 6861 6e64 6c65      self._handle
+00058b80: 5f65 6d70 7479 5f74 6172 6765 7428 290d  _empty_target().
+00058b90: 0a0d 0a20 2020 2020 2020 2023 4469 6d65  ...        #Dime
+00058ba0: 6e73 696f 6e20 6e61 6d65 2075 7365 6420  nsion name used 
+00058bb0: 666f 7220 4572 726f 7220 6d65 7373 6167  for Error messag
+00058bc0: 6573 0d0a 2020 2020 2020 2020 6966 2064  es..        if d
+00058bd0: 696d 656e 7369 6f6e 5f69 6e64 6578 203c  imension_index <
+00058be0: 2038 3a0d 0a20 2020 2020 2020 2020 2020   8:..           
+00058bf0: 2064 696d 656e 7369 6f6e 5f6e 616d 6520   dimension_name 
+00058c00: 3d20 2755 6e69 7420 272b 7374 7228 6469  = 'Unit '+str(di
+00058c10: 6d65 6e73 696f 6e5f 696e 6465 7829 0d0a  mension_index)..
+00058c20: 2020 2020 2020 2020 6966 2064 696d 656e          if dimen
+00058c30: 7369 6f6e 5f69 6e64 6578 3d3d 393a 0d0a  sion_index==9:..
+00058c40: 2020 2020 2020 2020 2020 2020 6469 6d65              dime
+00058c50: 6e73 696f 6e5f 6e61 6d65 203d 2027 436f  nsion_name = 'Co
+00058c60: 6d70 6172 6973 6f6e 270d 0a20 2020 2020  mparison'..     
+00058c70: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00058c80: 2020 2020 2020 6469 6d65 6e73 696f 6e5f        dimension_
+00058c90: 6e61 6d65 203d 2027 4469 6d65 6e73 696f  name = 'Dimensio
+00058ca0: 6e20 272b 7374 7228 6469 6d65 6e73 696f  n '+str(dimensio
+00058cb0: 6e5f 696e 6465 7829 0d0a 0d0a 2020 2020  n_index)....    
+00058cc0: 2020 2020 6966 2073 656c 662e 7461 7267      if self.targ
+00058cd0: 6574 2e73 7472 7563 7475 7265 735b 6469  et.structures[di
+00058ce0: 6d65 6e73 696f 6e5f 696e 6465 785d 2069  mension_index] i
+00058cf0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+00058d00: 2020 2020 2072 6169 7365 206d 7065 782e       raise mpex.
+00058d10: 4c6f 6164 6572 5365 7475 7045 7272 6f72  LoaderSetupError
+00058d20: 2827 4361 6e6e 6f74 2063 6f6d 7075 7465  ('Cannot compute
+00058d30: 2065 6666 6563 7469 7665 2075 6e69 7420   effective unit 
+00058d40: 6469 6d65 6e73 696f 6e20 656c 656d 656e  dimension elemen
+00058d50: 7473 2066 6f72 2061 2046 6f63 7573 4c6f  ts for a FocusLo
+00058d60: 6164 6572 2077 6869 6368 2068 6173 206e  ader which has n
+00058d70: 6f20 7374 7275 6374 7572 6520 282e 7374  o structure (.st
+00058d80: 7275 6374 7572 6573 5b7b 7d5d 2927 2e66  ructures[{}])'.f
+00058d90: 6f72 6d61 7428 6469 6d65 6e73 696f 6e5f  ormat(dimension_
+00058da0: 696e 6465 7829 290d 0a0d 0a20 2020 2020  index))....     
+00058db0: 2020 206e 6f5f 6d61 7070 696e 6773 5f66     no_mappings_f
+00058dc0: 6f72 5f74 6869 735f 6469 6d65 6e73 696f  or_this_dimensio
+00058dd0: 6e20 3d20 4661 6c73 650d 0a20 2020 2020  n = False..     
+00058de0: 2020 2069 6620 7365 6c66 2e5f 6d61 7070     if self._mapp
+00058df0: 6572 7320 6973 204e 6f6e 6520 6f72 206c  ers is None or l
+00058e00: 656e 2873 656c 662e 5f6d 6170 7065 7273  en(self._mappers
+00058e10: 293d 3d30 3a0d 0a20 2020 2020 2020 2020  )==0:..         
+00058e20: 2020 206e 6f5f 6d61 7070 696e 6773 5f66     no_mappings_f
+00058e30: 6f72 5f74 6869 735f 6469 6d65 6e73 696f  or_this_dimensio
+00058e40: 6e20 3d20 5472 7565 0d0a 2020 2020 2020  n = True..      
+00058e50: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00058e60: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00058e70: 2020 2020 2020 2020 2020 206e 6f5f 6d61             no_ma
+00058e80: 7070 696e 6773 5f66 6f72 5f74 6869 735f  ppings_for_this_
+00058e90: 6469 6d65 6e73 696f 6e20 3d20 7365 6c66  dimension = self
+00058ea0: 2e5f 6d61 7070 6572 735b 6469 6d65 6e73  ._mappers[dimens
+00058eb0: 696f 6e5f 696e 6465 785d 2069 7320 4e6f  ion_index] is No
+00058ec0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+00058ed0: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
+00058ee0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00058ef0: 2020 6e6f 5f6d 6170 7069 6e67 735f 666f    no_mappings_fo
+00058f00: 725f 7468 6973 5f64 696d 656e 7369 6f6e  r_this_dimension
+00058f10: 203d 2054 7275 650d 0a0d 0a20 2020 2020   = True....     
+00058f20: 2020 2023 5768 6572 6520 7468 6572 6520     #Where there 
+00058f30: 6172 6520 6e6f 206d 6170 7069 6e67 7320  are no mappings 
+00058f40: 7765 2061 7265 2068 6170 7079 2074 6f20  we are happy to 
+00058f50: 7573 6520 6120 7369 6e67 6c65 2065 6c65  use a single ele
+00058f60: 6d65 6e74 2069 6620 6f6e 6520 6973 2061  ment if one is a
+00058f70: 7661 696c 6162 6c65 0d0a 2020 2020 2020  vailable..      
+00058f80: 2020 6966 206e 6f5f 6d61 7070 696e 6773    if no_mappings
+00058f90: 5f66 6f72 5f74 6869 735f 6469 6d65 6e73  _for_this_dimens
+00058fa0: 696f 6e3a 0d0a 0d0a 2020 2020 2020 2020  ion:....        
+00058fb0: 2020 2020 6869 6572 6172 6368 7920 3d20      hierarchy = 
+00058fc0: 7365 6c66 2e5f 6765 745f 6869 6572 6172  self._get_hierar
+00058fd0: 6368 795f 6469 7265 6374 5f6f 725f 7369  chy_direct_or_si
+00058fe0: 6e67 6c65 5f68 6965 7261 7263 6879 5f66  ngle_hierarchy_f
+00058ff0: 726f 6d5f 7374 7275 6374 7572 6528 6469  rom_structure(di
+00059000: 6d65 6e73 696f 6e5f 696e 6465 783d 6469  mension_index=di
+00059010: 6d65 6e73 696f 6e5f 696e 6465 782c 6469  mension_index,di
+00059020: 6d65 6e73 696f 6e5f 6e61 6d65 3d64 696d  mension_name=dim
+00059030: 656e 7369 6f6e 5f6e 616d 652c 656e 666f  ension_name,enfo
+00059040: 7263 655f 7369 6e67 6c65 5f65 6c65 6d65  rce_single_eleme
+00059050: 6e74 3d54 7275 6529 0d0a 0d0a 2020 2020  nt=True)....    
+00059060: 2020 2020 2020 2020 6669 7273 745f 756e          first_un
+00059070: 6772 6f75 7065 645f 6368 696c 6472 656e  grouped_children
+00059080: 203d 2073 656c 662e 5f66 6972 7374 5f75   = self._first_u
+00059090: 6e67 726f 7570 6564 5f63 6869 6c64 7265  ngrouped_childre
+000590a0: 6e28 6869 6572 6172 6368 7929 0d0a 0d0a  n(hierarchy)....
+000590b0: 2020 2020 2020 2020 2020 2020 2366 6972              #fir
+000590c0: 7374 5f75 6e67 726f 7570 6564 5f63 6869  st_ungrouped_chi
+000590d0: 6c64 7265 6e20 7368 6f75 6c64 2062 6520  ldren should be 
+000590e0: 6120 7369 6e67 6c65 2069 7465 6d20 6c69  a single item li
+000590f0: 7374 2e20 5468 6174 2069 7465 6d20 2869  st. That item (i
+00059100: 2e65 2e20 7468 6174 2053 7472 7563 7475  .e. that Structu
+00059110: 7265 456c 656d 656e 7429 2073 686f 756c  reElement) shoul
+00059120: 6420 6861 7665 206e 6f20 6368 696c 6472  d have no childr
+00059130: 656e 202d 2069 2e65 2e20 7765 2061 7265  en - i.e. we are
+00059140: 206c 6f6f 6f6b 696e 6720 6174 2061 2073   loooking at a s
+00059150: 696e 676c 6520 656c 656d 656e 740d 0a20  ingle element.. 
+00059160: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00059170: 6e28 6669 7273 745f 756e 6772 6f75 7065  n(first_ungroupe
+00059180: 645f 6368 696c 6472 656e 2920 3d3d 2031  d_children) == 1
+00059190: 2061 6e64 206c 656e 2866 6972 7374 5f75   and len(first_u
+000591a0: 6e67 726f 7570 6564 5f63 6869 6c64 7265  ngrouped_childre
+000591b0: 6e5b 305d 2e63 6869 6c64 7265 6e29 203d  n[0].children) =
+000591c0: 3d20 303a 0d0a 2020 2020 2020 2020 2020  = 0:..          
+000591d0: 2020 2020 2020 7265 7475 726e 2066 6972        return fir
+000591e0: 7374 5f75 6e67 726f 7570 6564 5f63 6869  st_ungrouped_chi
+000591f0: 6c64 7265 6e0d 0a20 2020 2020 2020 2020  ldren..         
+00059200: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00059210: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00059220: 6d70 6578 2e4c 6f61 6465 7253 6574 7570  mpex.LoaderSetup
+00059230: 4572 726f 7228 2746 6f63 7573 4c6f 6164  Error('FocusLoad
+00059240: 6572 2077 6974 686f 7574 2061 6e79 206d  er without any m
+00059250: 6170 7069 6e67 7320 6361 6e6e 6f74 2068  appings cannot h
+00059260: 616e 646c 6520 7b7d 2053 7472 7563 7475  andle {} Structu
+00059270: 7265 456c 656d 656e 7473 2077 6974 6820  reElements with 
+00059280: 616e 7974 6869 6e67 206f 7468 6572 2074  anything other t
+00059290: 6861 6e20 6120 7369 6e67 6c65 2065 6c65  han a single ele
+000592a0: 6d65 6e74 2e20 5374 7275 6374 7572 6520  ment. Structure 
+000592b0: 7b7d 2068 6173 206d 6f72 6520 7468 616e  {} has more than
+000592c0: 206f 6e65 2065 6c65 6d65 6e74 2e20 4368   one element. Ch
+000592d0: 6f6f 7365 2061 6e6f 7468 6572 2053 7472  oose another Str
+000592e0: 7563 7475 7265 206f 7220 6372 6561 7465  ucture or create
+000592f0: 206d 6170 7069 6e67 7320 666f 7220 7468   mappings for th
+00059300: 6520 6869 6572 6172 6368 7927 2e66 6f72  e hierarchy'.for
+00059310: 6d61 7428 6469 6d65 6e73 696f 6e5f 6e61  mat(dimension_na
+00059320: 6d65 2c73 656c 662e 7461 7267 6574 2e73  me,self.target.s
+00059330: 7472 7563 7475 7265 735b 6469 6d65 6e73  tructures[dimens
+00059340: 696f 6e5f 696e 6465 785d 2e6c 6f6e 676e  ion_index].longn
+00059350: 616d 6529 290d 0a20 2020 2020 2020 2065  ame))..        e
+00059360: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00059370: 2020 2355 7365 205f 6765 745f 696d 706c    #Use _get_impl
+00059380: 6965 645f 7368 6f72 7463 6f64 655f 6c69  ied_shortcode_li
+00059390: 7374 5f61 6e64 5f6d 6170 7069 6e67 5f74  st_and_mapping_t
+000593a0: 7970 652c 2062 6563 6175 7365 2069 7420  ype, because it 
+000593b0: 6368 6563 6b73 2066 6f72 2063 6f6c 756d  checks for colum
+000593c0: 6e20 6578 6973 7465 6e63 6520 7261 7468  n existence rath
+000593d0: 6572 2074 6861 6e20 626c 6974 6865 6c79  er than blithely
+000593e0: 2061 7373 756d 696e 6720 7468 6174 2063   assuming that c
+000593f0: 6f6c 756d 6e20 6e61 6d65 732f 7368 6f72  olumn names/shor
+00059400: 746e 616d 6573 2068 6176 6520 6265 656e  tnames have been
+00059410: 2074 7970 6564 2063 6f72 7265 6374 6c79   typed correctly
+00059420: 0d0a 2020 2020 2020 2020 2020 2020 6566  ..            ef
+00059430: 6665 6374 6976 655f 656c 656d 656e 7473  fective_elements
+00059440: 2c20 6d61 7070 696e 675f 7479 7065 2c63  , mapping_type,c
+00059450: 6f6c 756d 6e5f 6e61 6d65 7320 3d20 7365  olumn_names = se
+00059460: 6c66 2e5f 6765 745f 696d 706c 6965 645f  lf._get_implied_
+00059470: 7368 6f72 7463 6f64 655f 6c69 7374 5f61  shortcode_list_a
+00059480: 6e64 5f6d 6170 7069 6e67 5f74 7970 6528  nd_mapping_type(
+00059490: 6469 6d65 6e73 696f 6e5f 696e 6465 7820  dimension_index 
+000594a0: 3d20 6469 6d65 6e73 696f 6e5f 696e 6465  = dimension_inde
+000594b0: 782c 206f 626a 6563 745f 746f 5f63 6865  x, object_to_che
+000594c0: 636b 5f61 6761 696e 7374 203d 7365 6c66  ck_against =self
+000594d0: 2e74 6172 6765 742e 7374 7275 6374 7572  .target.structur
+000594e0: 6573 5b64 696d 656e 7369 6f6e 5f69 6e64  es[dimension_ind
+000594f0: 6578 5d29 0d0a 0d0a 2020 2020 2020 2020  ex])....        
+00059500: 2020 2020 6869 6572 6172 6368 7920 3d20      hierarchy = 
+00059510: 7365 6c66 2e5f 6765 745f 6869 6572 6172  self._get_hierar
+00059520: 6368 795f 6469 7265 6374 5f6f 725f 7369  chy_direct_or_si
+00059530: 6e67 6c65 5f68 6965 7261 7263 6879 5f66  ngle_hierarchy_f
+00059540: 726f 6d5f 7374 7275 6374 7572 6528 6469  rom_structure(di
+00059550: 6d65 6e73 696f 6e5f 696e 6465 783d 6469  mension_index=di
+00059560: 6d65 6e73 696f 6e5f 696e 6465 782c 6469  mension_index,di
+00059570: 6d65 6e73 696f 6e5f 6e61 6d65 3d64 696d  mension_name=dim
+00059580: 656e 7369 6f6e 5f6e 616d 6529 0d0a 0d0a  ension_name)....
+00059590: 2020 2020 2020 2020 2020 2020 2366 6972              #fir
+000595a0: 7374 5f75 6e67 726f 7570 6564 5f63 6869  st_ungrouped_chi
+000595b0: 6c64 7265 6e20 3d20 7365 6c66 2e5f 6669  ldren = self._fi
+000595c0: 7273 745f 756e 6772 6f75 7065 645f 6368  rst_ungrouped_ch
+000595d0: 696c 6472 656e 2868 6965 7261 7263 6879  ildren(hierarchy
+000595e0: 290d 0a20 2020 2020 2020 2020 2020 2023  )..            #
+000595f0: 2357 6520 6172 6520 6861 7070 7920 746f  #We are happy to
+00059600: 2072 6574 7572 6e20 6120 4772 6f75 7020   return a Group 
+00059610: 656c 656d 656e 7420 6865 7265 2c20 616e  element here, an
+00059620: 6420 7468 656e 2075 7365 2064 6f74 7469  d then use dotti
+00059630: 6e65 7373 206f 6620 360d 0a20 2020 2020  ness of 6..     
+00059640: 2020 2020 2020 2066 6972 7374 5f75 6e67         first_ung
+00059650: 726f 7570 6564 5f63 6869 6c64 7265 6e20  rouped_children 
+00059660: 3d20 5b68 6965 7261 7263 6879 5d0d 0a20  = [hierarchy].. 
+00059670: 2020 2020 2020 2020 2020 2023 2354 4f44             ##TOD
+00059680: 4f20 6d61 7463 6820 7468 6520 6566 6665  O match the effe
+00059690: 6374 6976 6520 656c 656d 656e 7473 2075  ctive elements u
+000596a0: 7020 7769 7468 2074 6865 2068 6965 7261  p with the hiera
+000596b0: 7263 6879 2065 6c65 6d65 6e74 730d 0a20  rchy elements.. 
+000596c0: 2020 2020 2020 2020 2020 2023 2343 6f6d             ##Com
+000596d0: 6d65 6e74 6564 2063 6f64 6520 6265 6c6f  mented code belo
+000596e0: 7720 6973 2069 676e 6f72 616e 7420 6f66  w is ignorant of
+000596f0: 2074 6865 2073 7472 7563 7475 7265 206f   the structure o
+00059700: 6620 7468 6520 6f75 7470 7574 7320 616e  f the outputs an
+00059710: 6420 6973 6e27 7420 776f 726b 696e 670d  d isn't working.
+00059720: 0a20 2020 2020 2020 2020 2020 2023 6966  .            #if
+00059730: 2065 6666 6563 7469 7665 5f65 6c65 6d65   effective_eleme
+00059740: 6e74 7320 6973 206e 6f74 204e 6f6e 653a  nts is not None:
+00059750: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00059760: 2020 2066 6f72 2063 6820 696e 2066 6972     for ch in fir
+00059770: 7374 5f75 6e67 726f 7570 6564 5f63 6869  st_ungrouped_chi
+00059780: 6c64 7265 6e3a 0d0a 2020 2020 2020 2020  ldren:..        
+00059790: 2020 2020 2320 2020 2020 2020 2061 7373      #        ass
+000597a0: 6572 7420 6368 2e73 686f 7274 6e61 6d65  ert ch.shortname
+000597b0: 2069 6e20 6566 6665 6374 6976 655f 656c   in effective_el
+000597c0: 656d 656e 7473 2c20 227b 7d20 6e6f 7420  ements, "{} not 
+000597d0: 696e 207b 7d22 2e66 6f72 6d61 7428 6368  in {}".format(ch
+000597e0: 2e73 686f 7274 6e61 6d65 2c20 6566 6665  .shortname, effe
+000597f0: 6374 6976 655f 656c 656d 656e 7473 290d  ctive_elements).
+00059800: 0a20 2020 2020 2020 2020 2020 2023 656c  .            #el
+00059810: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+00059820: 2023 2020 2020 236d 6179 6265 2073 686f   #    #maybe sho
+00059830: 756c 6420 6173 7365 7274 2074 6861 7420  uld assert that 
+00059840: 6669 7273 7420 756e 6772 6f75 7065 6420  first ungrouped 
+00059850: 656c 656d 656e 7473 2069 7320 7369 6e67  elements is sing
+00059860: 6c65 2065 6c65 6d65 6e74 206c 6973 743f  le element list?
+00059870: 0d0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+00059880: 2020 2070 6173 730d 0a0d 0a20 2020 2020     pass....     
+00059890: 2020 2020 2020 2069 6620 6d61 7070 696e         if mappin
+000598a0: 675f 7479 7065 203d 3d20 2763 6f6e 7374  g_type == 'const
+000598b0: 616e 7420 7368 6f72 746e 616d 6527 3a0d  ant shortname':.
+000598c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000598d0: 2066 6f72 2063 6820 696e 2066 6972 7374   for ch in first
+000598e0: 5f75 6e67 726f 7570 6564 5f63 6869 6c64  _ungrouped_child
+000598f0: 7265 6e3a 0d0a 2020 2020 2020 2020 2020  ren:..          
+00059900: 2020 2020 2020 2020 2020 2374 6869 7320            #this 
+00059910: 636f 6465 2061 7373 756d 6573 2074 6861  code assumes tha
+00059920: 7420 6120 6d61 7070 696e 6720 636f 6e74  t a mapping cont
+00059930: 6169 6e73 2061 2073 686f 7274 636f 6465  ains a shortcode
+00059940: 2066 6f72 2061 2043 6f6d 7061 7269 736f   for a Compariso
+00059950: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
+00059960: 2020 2020 2020 2023 4974 2069 7320 6c69         #It is li
+00059970: 6b65 6c79 2074 6861 7420 6974 276c 6c20  kely that it'll 
+00059980: 686f 6c64 2073 6f6d 6574 6869 6e67 206d  hold something m
+00059990: 6f72 6520 736f 7068 6973 7469 6361 7465  ore sophisticate
+000599a0: 642e 0d0a 2020 2020 2020 2020 2020 2020  d...            
+000599b0: 2020 2020 2020 2020 2357 6865 6e20 6974          #When it
+000599c0: 2064 6f65 7320 7468 6520 7465 7374 7320   does the tests 
+000599d0: 7769 6c6c 2062 7265 616b 202d 2073 6f20  will break - so 
+000599e0: 4927 7665 2073 7461 7465 6420 7468 6973  I've stated this
+000599f0: 2061 7373 756d 7074 696f 6e20 6578 706c   assumption expl
+00059a00: 6963 6974 6c79 0d0a 2020 2020 2020 2020  icitly..        
+00059a10: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00059a20: 682e 7368 6f72 746e 616d 6520 3d3d 2073  h.shortname == s
+00059a30: 656c 662e 5f6d 6170 7065 7273 5b64 696d  elf._mappers[dim
+00059a40: 656e 7369 6f6e 5f69 6e64 6578 5d3a 0d0a  ension_index]:..
+00059a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059a60: 2020 2020 2020 2020 2352 6574 7572 6e20          #Return 
+00059a70: 7468 6520 6669 7273 7420 6368 696c 6420  the first child 
+00059a80: 7765 2066 696e 6420 696e 2074 6865 2068  we find in the h
+00059a90: 6965 7261 7263 6879 2077 6974 6820 7468  ierarchy with th
+00059aa0: 6520 6d61 7070 6564 2073 686f 7274 636f  e mapped shortco
+00059ab0: 6465 0d0a 2020 2020 2020 2020 2020 2020  de..            
+00059ac0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00059ad0: 726e 205b 6368 5d0d 0a20 2020 2020 2020  rn [ch]..       
+00059ae0: 2020 2020 2020 2020 2023 4966 2064 6964           #If did
+00059af0: 6e27 7420 7265 7475 726e 2061 2063 6869  n't return a chi
+00059b00: 6c64 2c20 7468 656e 2069 7420 6973 2070  ld, then it is p
+00059b10: 6f73 7369 626c 6520 7468 6520 6669 7273  ossible the firs
+00059b20: 745f 756e 6772 6f75 7065 645f 6368 696c  t_ungrouped_chil
+00059b30: 6472 656e 2069 7320 6120 7369 6e67 6c65  dren is a single
+00059b40: 2067 726f 7570 6564 2065 6c65 6d65 6e74   grouped element
+00059b50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00059b60: 2020 2349 6620 736f 2c20 7761 6c6b 2069    #If so, walk i
+00059b70: 7420 616e 6420 7265 7475 726e 2074 6865  t and return the
+00059b80: 2066 6972 7374 206f 6e65 2066 6f75 6e64   first one found
+00059b90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00059ba0: 2020 6966 2066 6972 7374 5f75 6e67 726f    if first_ungro
+00059bb0: 7570 6564 5f63 6869 6c64 7265 6e5b 305d  uped_children[0]
+00059bc0: 2e67 726f 7570 5f6f 6e6c 7920 3d3d 2027  .group_only == '
+00059bd0: 4772 6f75 7027 3a0d 0a20 2020 2020 2020  Group':..       
+00059be0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00059bf0: 2063 6820 696e 2066 6972 7374 5f75 6e67   ch in first_ung
+00059c00: 726f 7570 6564 5f63 6869 6c64 7265 6e5b  rouped_children[
+00059c10: 305d 2e77 616c 6b28 293a 0d0a 2020 2020  0].walk():..    
+00059c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059c30: 2020 2020 2374 6869 7320 636f 6465 2061      #this code a
+00059c40: 7373 756d 6573 2074 6861 7420 6120 6d61  ssumes that a ma
+00059c50: 7070 696e 6720 636f 6e74 6169 6e73 2061  pping contains a
+00059c60: 2073 686f 7274 636f 6465 2066 6f72 2061   shortcode for a
+00059c70: 2043 6f6d 7061 7269 736f 6e0d 0a20 2020   Comparison..   
+00059c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059c90: 2020 2020 2023 4974 2069 7320 6c69 6b65       #It is like
+00059ca0: 6c79 2074 6861 7420 6974 276c 6c20 686f  ly that it'll ho
+00059cb0: 6c64 2073 6f6d 6574 6869 6e67 206d 6f72  ld something mor
+00059cc0: 6520 736f 7068 6973 7469 6361 7465 642e  e sophisticated.
+00059cd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00059ce0: 2020 2020 2020 2020 2020 2357 6865 6e20            #When 
+00059cf0: 6974 2064 6f65 7320 7468 6520 7465 7374  it does the test
+00059d00: 7320 7769 6c6c 2062 7265 616b 202d 2073  s will break - s
+00059d10: 6f20 4927 7665 2073 7461 7465 6420 7468  o I've stated th
+00059d20: 6973 2061 7373 756d 7074 696f 6e20 6578  is assumption ex
+00059d30: 706c 6963 6974 6c79 0d0a 2020 2020 2020  plicitly..      
+00059d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059d50: 2020 6966 2063 682e 7368 6f72 746e 616d    if ch.shortnam
+00059d60: 6520 3d3d 2073 656c 662e 5f6d 6170 7065  e == self._mappe
+00059d70: 7273 5b64 696d 656e 7369 6f6e 5f69 6e64  rs[dimension_ind
+00059d80: 6578 5d3a 0d0a 2020 2020 2020 2020 2020  ex]:..          
+00059d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059da0: 2020 2352 6574 7572 6e20 7468 6520 6669    #Return the fi
+00059db0: 7273 7420 6368 696c 6420 7765 2066 696e  rst child we fin
+00059dc0: 6420 696e 2074 6865 2068 6965 7261 7263  d in the hierarc
+00059dd0: 6879 2077 6974 6820 7468 6520 6d61 7070  hy with the mapp
+00059de0: 6564 2073 686f 7274 636f 6465 0d0a 2020  ed shortcode..  
+00059df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00059e00: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00059e10: 205b 6368 5d0d 0a0d 0a20 2020 2020 2020   [ch]....       
+00059e20: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00059e30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00059e40: 726e 2066 6972 7374 5f75 6e67 726f 7570  rn first_ungroup
+00059e50: 6564 5f63 6869 6c64 7265 6e0d 0a0d 0a20  ed_children.... 
+00059e60: 2020 2064 6566 205f 6861 6e64 6c65 5f6e     def _handle_n
+00059e70: 6f5f 6d61 7070 696e 675f 7369 6e67 6c65  o_mapping_single
+00059e80: 5f65 6c65 6d65 6e74 2873 656c 662c 6469  _element(self,di
+00059e90: 6d65 6e73 696f 6e5f 696e 6465 782c 6469  mension_index,di
+00059ea0: 6d65 6e73 696f 6e5f 6e61 6d65 293a 0d0a  mension_name):..
+00059eb0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00059ec0: 7461 6e63 6528 7365 6c66 2e74 6172 6765  tance(self.targe
+00059ed0: 742e 7374 7275 6374 7572 6573 5b64 696d  t.structures[dim
+00059ee0: 656e 7369 6f6e 5f69 6e64 6578 5d2c 5374  ension_index],St
+00059ef0: 7275 6374 7572 6529 3a0d 0a20 2020 2020  ructure):..     
+00059f00: 2020 2020 2020 2023 4368 6563 6b20 7468         #Check th
+00059f10: 6174 2074 6865 7265 2069 7320 6f6e 6c79  at there is only
+00059f20: 206f 6e65 2068 6965 7261 7263 6879 2c20   one hierarchy, 
+00059f30: 616e 6420 7468 6174 2074 6861 7420 6869  and that that hi
+00059f40: 6572 6172 6368 7920 6f6e 6c79 2068 6173  erarchy only has
+00059f50: 2061 2073 696e 676c 6520 656c 656d 656e   a single elemen
+00059f60: 740d 0a20 2020 2020 2020 2020 2020 2069  t..            i
+00059f70: 6620 6c65 6e28 7365 6c66 2e74 6172 6765  f len(self.targe
+00059f80: 742e 7374 7275 6374 7572 6573 5b64 696d  t.structures[dim
+00059f90: 656e 7369 6f6e 5f69 6e64 6578 5d2e 6869  ension_index].hi
+00059fa0: 6572 6172 6368 6965 7329 203d 3d20 3120  erarchies) == 1 
+00059fb0: 616e 6420 6c65 6e28 5b68 2066 6f72 2068  and len([h for h
+00059fc0: 2069 6e20 7365 6c66 2e74 6172 6765 742e   in self.target.
+00059fd0: 7374 7275 6374 7572 6573 5b64 696d 656e  structures[dimen
+00059fe0: 7369 6f6e 5f69 6e64 6578 5d2e 6869 6572  sion_index].hier
+00059ff0: 6172 6368 6965 735d 5b30 5d2e 6368 696c  archies][0].chil
+0005a000: 6472 656e 2920 3d3d 2030 3a0d 0a0d 0a20  dren) == 0:.... 
+0005a010: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+0005a020: 203d 206c 6973 7428 7365 6c66 2e74 6172   = list(self.tar
+0005a030: 6765 742e 7374 7275 6374 7572 6573 5b64  get.structures[d
+0005a040: 696d 656e 7369 6f6e 5f69 6e64 6578 5d2e  imension_index].
+0005a050: 6869 6572 6172 6368 6965 7329 5b30 5d0d  hierarchies)[0].
+0005a060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005a070: 2072 6574 7572 6e20 7365 6c66 2e5f 6669   return self._fi
+0005a080: 7273 745f 756e 6772 6f75 7065 645f 6368  rst_ungrouped_ch
+0005a090: 696c 6472 656e 2868 290d 0a0d 0a20 2020  ildren(h)....   
+0005a0a0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0005a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005a0c0: 7261 6973 6520 6d70 6578 2e4c 6f61 6465  raise mpex.Loade
+0005a0d0: 7253 6574 7570 4572 726f 7228 2746 6f63  rSetupError('Foc
+0005a0e0: 7573 4c6f 6164 6572 2077 6974 686f 7574  usLoader without
+0005a0f0: 2061 6e79 206d 6170 7069 6e67 7320 6361   any mappings ca
+0005a100: 6e6e 6f74 2068 616e 646c 6520 7b7d 2053  nnot handle {} S
+0005a110: 7472 7563 7475 7265 7320 7769 7468 2061  tructures with a
+0005a120: 6e79 7468 696e 6720 6f74 6865 7220 7468  nything other th
+0005a130: 616e 2031 2068 6965 7261 7263 6879 2077  an 1 hierarchy w
+0005a140: 6974 6820 6120 7369 6e67 6c65 2065 6c65  ith a single ele
+0005a150: 6d65 6e74 2e20 5374 7275 6374 7572 6520  ment. Structure 
+0005a160: 7b7d 2068 6173 206d 6f72 6520 7468 616e  {} has more than
+0005a170: 206f 6e65 2065 6c65 6d65 6e74 2e20 4368   one element. Ch
+0005a180: 6f6f 7365 2061 6e6f 7468 6572 2053 7472  oose another Str
+0005a190: 7563 7475 7265 206f 7220 6372 6561 7465  ucture or create
+0005a1a0: 206d 6170 7069 6e67 7320 666f 7220 7468   mappings for th
+0005a1b0: 6520 6869 6572 6172 6368 7927 2e66 6f72  e hierarchy'.for
+0005a1c0: 6d61 7428 6469 6d65 6e73 696f 6e5f 6e61  mat(dimension_na
+0005a1d0: 6d65 2c73 656c 662e 7461 7267 6574 2e73  me,self.target.s
+0005a1e0: 7472 7563 7475 7265 735b 6469 6d65 6e73  tructures[dimens
+0005a1f0: 696f 6e5f 696e 6465 785d 2e6c 6f6e 676e  ion_index].longn
+0005a200: 616d 6529 290d 0a20 2020 2020 2020 2065  ame))..        e
+0005a210: 6c69 6620 6973 696e 7374 616e 6365 2873  lif isinstance(s
+0005a220: 656c 662e 7461 7267 6574 2e73 7472 7563  elf.target.struc
+0005a230: 7475 7265 735b 6469 6d65 6e73 696f 6e5f  tures[dimension_
+0005a240: 696e 6465 785d 2c53 7472 7563 7475 7265  index],Structure
+0005a250: 456c 656d 656e 7429 3a0d 0a20 2020 2020  Element):..     
+0005a260: 2020 2020 2020 2066 6972 7374 5f75 6e67         first_ung
+0005a270: 726f 7570 6564 5f63 6869 6c64 7265 6e20  rouped_children 
+0005a280: 3d20 7365 6c66 2e5f 6669 7273 745f 756e  = self._first_un
+0005a290: 6772 6f75 7065 645f 6368 696c 6472 656e  grouped_children
+0005a2a0: 2873 656c 662e 7461 7267 6574 2e73 7472  (self.target.str
+0005a2b0: 7563 7475 7265 735b 6469 6d65 6e73 696f  uctures[dimensio
+0005a2c0: 6e5f 696e 6465 785d 290d 0a0d 0a20 2020  n_index])....   
+0005a2d0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0005a2e0: 6669 7273 745f 756e 6772 6f75 7065 645f  first_ungrouped_
+0005a2f0: 6368 696c 6472 656e 2e63 6869 6c64 7265  children.childre
+0005a300: 6e29 203d 3d20 303a 0d0a 2020 2020 2020  n) == 0:..      
+0005a310: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0005a320: 2066 6972 7374 5f75 6e67 726f 7570 6564   first_ungrouped
+0005a330: 5f63 6869 6c64 7265 6e0d 0a20 2020 2020  _children..     
+0005a340: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0005a350: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0005a360: 6973 6520 6d70 6578 2e4c 6f61 6465 7253  ise mpex.LoaderS
+0005a370: 6574 7570 4572 726f 7228 2746 6f63 7573  etupError('Focus
+0005a380: 4c6f 6164 6572 2077 6974 686f 7574 2061  Loader without a
+0005a390: 6e79 206d 6170 7069 6e67 7320 6361 6e6e  ny mappings cann
+0005a3a0: 6f74 2068 616e 646c 6520 7b7d 2053 7472  ot handle {} Str
+0005a3b0: 7563 7475 7265 456c 656d 656e 7473 2077  uctureElements w
+0005a3c0: 6974 6820 616e 7974 6869 6e67 206f 7468  ith anything oth
+0005a3d0: 6572 2074 6861 6e20 6120 7369 6e67 6c65  er than a single
+0005a3e0: 2065 6c65 6d65 6e74 2e20 5374 7275 6374   element. Struct
+0005a3f0: 7572 6520 7b7d 2068 6173 206d 6f72 6520  ure {} has more 
+0005a400: 7468 616e 206f 6e65 2065 6c65 6d65 6e74  than one element
+0005a410: 2e20 4368 6f6f 7365 2061 6e6f 7468 6572  . Choose another
+0005a420: 2053 7472 7563 7475 7265 206f 7220 6372   Structure or cr
+0005a430: 6561 7465 206d 6170 7069 6e67 7320 666f  eate mappings fo
+0005a440: 7220 7468 6520 6869 6572 6172 6368 7927  r the hierarchy'
+0005a450: 2e66 6f72 6d61 7428 6469 6d65 6e73 696f  .format(dimensio
+0005a460: 6e5f 6e61 6d65 2c73 656c 662e 7461 7267  n_name,self.targ
+0005a470: 6574 2e73 7472 7563 7475 7265 735b 6469  et.structures[di
+0005a480: 6d65 6e73 696f 6e5f 696e 6465 785d 2e6c  mension_index].l
+0005a490: 6f6e 676e 616d 6529 290d 0a0d 0a20 2020  ongname))....   
+0005a4a0: 2064 6566 205f 6861 6e64 6c65 5f65 6d70   def _handle_emp
+0005a4b0: 7479 5f74 6172 6765 7428 7365 6c66 293a  ty_target(self):
+0005a4c0: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0005a4d0: 662e 7461 7267 6574 2069 7320 4e6f 6e65  f.target is None
+0005a4e0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
+0005a4f0: 6169 7365 206d 7065 782e 4c6f 6164 6572  aise mpex.Loader
+0005a500: 5365 7475 7045 7272 6f72 2827 4361 6e6e  SetupError('Cann
+0005a510: 6f74 2063 6f6d 7075 7465 2065 6666 6563  ot compute effec
+0005a520: 7469 7665 2074 696d 6520 656c 656d 656e  tive time elemen
+0005a530: 7473 2066 6f72 2061 2046 6f63 7573 4c6f  ts for a FocusLo
+0005a540: 6164 6572 2077 6869 6368 2068 6173 206e  ader which has n
+0005a550: 6f20 7461 7267 6574 2056 6965 7770 6f69  o target Viewpoi
+0005a560: 6e74 206f 7220 466f 6375 7320 7365 7427  nt or Focus set'
+0005a570: 290d 0a0d 0a20 2020 2064 6566 205f 6765  )....    def _ge
+0005a580: 745f 6869 6572 6172 6368 795f 6469 7265  t_hierarchy_dire
+0005a590: 6374 5f6f 725f 7369 6e67 6c65 5f68 6965  ct_or_single_hie
+0005a5a0: 7261 7263 6879 5f66 726f 6d5f 7374 7275  rarchy_from_stru
+0005a5b0: 6374 7572 6528 7365 6c66 2c64 696d 656e  cture(self,dimen
+0005a5c0: 7369 6f6e 5f69 6e64 6578 2c64 696d 656e  sion_index,dimen
+0005a5d0: 7369 6f6e 5f6e 616d 652c 656e 666f 7263  sion_name,enforc
+0005a5e0: 655f 7369 6e67 6c65 5f65 6c65 6d65 6e74  e_single_element
+0005a5f0: 3d46 616c 7365 293a 0d0a 2020 2020 2020  =False):..      
+0005a600: 2020 2727 270d 0a0d 0a20 2020 2020 2020    '''....       
+0005a610: 203a 7061 7261 6d20 656e 666f 7263 655f   :param enforce_
+0005a620: 7369 6e67 6c65 5f65 6c65 6d65 6e74 3a20  single_element: 
+0005a630: 4966 2073 6574 2074 6f20 5472 7565 2c20  If set to True, 
+0005a640: 7769 6c6c 2074 6872 6f77 6e20 616e 2065  will thrown an e
+0005a650: 7272 6f72 2069 6620 7468 6520 7265 7475  rror if the retu
+0005a660: 726e 6564 2068 6965 7261 7263 6879 2064  rned hierarchy d
+0005a670: 6f65 7320 6e6f 7420 6861 7665 2061 2073  oes not have a s
+0005a680: 696e 676c 6520 656c 656d 656e 740d 0a20  ingle element.. 
+0005a690: 2020 2020 2020 2027 2727 0d0a 0d0a 2020         '''....  
+0005a6a0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0005a6b0: 6e63 6528 7365 6c66 2e74 6172 6765 742e  nce(self.target.
+0005a6c0: 7374 7275 6374 7572 6573 5b64 696d 656e  structures[dimen
+0005a6d0: 7369 6f6e 5f69 6e64 6578 5d2c 5374 7275  sion_index],Stru
+0005a6e0: 6374 7572 6529 3a0d 0a20 2020 2020 2020  cture):..       
+0005a6f0: 2020 2020 2023 4368 6563 6b20 7468 6174       #Check that
+0005a700: 2074 6865 7265 2069 7320 6f6e 6c79 206f   there is only o
+0005a710: 6e65 2068 6965 7261 7263 6879 0d0a 2020  ne hierarchy..  
+0005a720: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0005a730: 2873 656c 662e 7461 7267 6574 2e73 7472  (self.target.str
+0005a740: 7563 7475 7265 735b 6469 6d65 6e73 696f  uctures[dimensio
+0005a750: 6e5f 696e 6465 785d 2e68 6965 7261 7263  n_index].hierarc
+0005a760: 6869 6573 2920 3d3d 2031 3a0d 0a20 2020  hies) == 1:..   
+0005a770: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0005a780: 656e 666f 7263 655f 7369 6e67 6c65 5f65  enforce_single_e
+0005a790: 6c65 6d65 6e74 2061 6e64 206e 6f74 206c  lement and not l
+0005a7a0: 656e 285b 6820 666f 7220 6820 696e 2073  en([h for h in s
+0005a7b0: 656c 662e 7461 7267 6574 2e73 7472 7563  elf.target.struc
+0005a7c0: 7475 7265 735b 6469 6d65 6e73 696f 6e5f  tures[dimension_
+0005a7d0: 696e 6465 785d 2e68 6965 7261 7263 6869  index].hierarchi
+0005a7e0: 6573 5d5b 305d 2e63 6869 6c64 7265 6e29  es][0].children)
+0005a7f0: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
+0005a800: 2020 2020 2020 2020 2020 2020 2353 6f6d              #Som
+0005a810: 6520 7573 6520 6361 7365 7320 7265 7175  e use cases requ
+0005a820: 6972 6520 6f6e 6c79 2073 696e 676c 6520  ire only single 
+0005a830: 656c 656d 656e 7420 6869 6572 6172 6368  element hierarch
+0005a840: 6965 7320 746f 2062 6520 7072 6573 656e  ies to be presen
+0005a850: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+0005a860: 2020 2020 2020 2072 6169 7365 206d 7065         raise mpe
+0005a870: 782e 4c6f 6164 6572 5365 7475 7045 7272  x.LoaderSetupErr
+0005a880: 6f72 2827 466f 6375 734c 6f61 6465 7220  or('FocusLoader 
+0005a890: 7769 7468 6f75 7420 616e 7920 6d61 7070  without any mapp
+0005a8a0: 696e 6773 2063 616e 6e6f 7420 6861 6e64  ings cannot hand
+0005a8b0: 6c65 207b 7d20 5374 7275 6374 7572 6573  le {} Structures
+0005a8c0: 2077 6974 6820 616e 7974 6869 6e67 206f   with anything o
+0005a8d0: 7468 6572 2074 6861 6e20 3120 6869 6572  ther than 1 hier
+0005a8e0: 6172 6368 7920 7769 7468 2061 2073 696e  archy with a sin
+0005a8f0: 676c 6520 656c 656d 656e 742e 2053 7472  gle element. Str
+0005a900: 7563 7475 7265 207b 7d20 6861 7320 6d6f  ucture {} has mo
+0005a910: 7265 2074 6861 6e20 6f6e 6520 656c 656d  re than one elem
+0005a920: 656e 742e 2043 686f 6f73 6520 616e 6f74  ent. Choose anot
+0005a930: 6865 7220 5374 7275 6374 7572 6520 6f72  her Structure or
+0005a940: 2063 7265 6174 6520 6d61 7070 696e 6773   create mappings
+0005a950: 2066 6f72 2074 6865 2068 6965 7261 7263   for the hierarc
+0005a960: 6879 272e 666f 726d 6174 2864 696d 656e  hy'.format(dimen
+0005a970: 7369 6f6e 5f6e 616d 652c 7365 6c66 2e74  sion_name,self.t
+0005a980: 6172 6765 742e 7374 7275 6374 7572 6573  arget.structures
+0005a990: 5b64 696d 656e 7369 6f6e 5f69 6e64 6578  [dimension_index
+0005a9a0: 5d2e 7368 6f72 746e 616d 6529 290d 0a20  ].shortname)).. 
+0005a9b0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0005a9c0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+0005a9d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0005a9e0: 206c 6973 7428 7365 6c66 2e74 6172 6765   list(self.targe
+0005a9f0: 742e 7374 7275 6374 7572 6573 5b64 696d  t.structures[dim
+0005aa00: 656e 7369 6f6e 5f69 6e64 6578 5d2e 6869  ension_index].hi
+0005aa10: 6572 6172 6368 6965 7329 5b30 5d0d 0a20  erarchies)[0].. 
+0005aa20: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0005aa30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005aa40: 2020 7261 6973 6520 6d70 6578 2e4c 6f61    raise mpex.Loa
+0005aa50: 6465 7253 6574 7570 4572 726f 7228 2746  derSetupError('F
+0005aa60: 6f63 7573 4c6f 6164 6572 2063 616e 6e6f  ocusLoader canno
+0005aa70: 7420 6861 6e64 6c65 207b 7d20 5374 7275  t handle {} Stru
+0005aa80: 6374 7572 6573 2077 6974 6820 616e 7974  ctures with anyt
+0005aa90: 6869 6e67 206f 7468 6572 2074 6861 6e20  hing other than 
+0005aaa0: 3120 6869 6572 6172 6368 792e 2053 7472  1 hierarchy. Str
+0005aab0: 7563 7475 7265 207b 7d20 6861 7320 6d75  ucture {} has mu
+0005aac0: 6c74 6970 6c65 2068 6965 7261 7263 6869  ltiple hierarchi
+0005aad0: 6573 203a 207b 7d2e 2043 686f 6f73 6520  es : {}. Choose 
+0005aae0: 616e 6f74 6865 7220 5374 7275 6374 7572  another Structur
+0005aaf0: 6520 6f72 2063 7265 6174 6520 6d61 7070  e or create mapp
+0005ab00: 696e 6773 2066 6f72 2074 6865 207b 7d20  ings for the {} 
+0005ab10: 6869 6572 6172 6368 7927 2e66 6f72 6d61  hierarchy'.forma
+0005ab20: 7428 6469 6d65 6e73 696f 6e5f 6e61 6d65  t(dimension_name
+0005ab30: 2c73 656c 662e 7461 7267 6574 2e73 7472  ,self.target.str
+0005ab40: 7563 7475 7265 735b 6469 6d65 6e73 696f  uctures[dimensio
+0005ab50: 6e5f 696e 6465 785d 2e6c 6f6e 676e 616d  n_index].longnam
+0005ab60: 652c 272c 272e 6a6f 696e 285b 682e 7368  e,','.join([h.sh
+0005ab70: 6f72 746e 616d 6520 666f 7220 6820 696e  ortname for h in
+0005ab80: 2073 656c 662e 7461 7267 6574 2e73 7472   self.target.str
+0005ab90: 7563 7475 7265 735b 6469 6d65 6e73 696f  uctures[dimensio
+0005aba0: 6e5f 696e 6465 785d 2e68 6965 7261 7263  n_index].hierarc
+0005abb0: 6869 6573 5d29 2c64 696d 656e 7369 6f6e  hies]),dimension
+0005abc0: 5f6e 616d 6529 290d 0a20 2020 2020 2020  _name))..       
+0005abd0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+0005abe0: 2873 656c 662e 7461 7267 6574 2e73 7472  (self.target.str
+0005abf0: 7563 7475 7265 735b 6469 6d65 6e73 696f  uctures[dimensio
+0005ac00: 6e5f 696e 6465 785d 2c53 7472 7563 7475  n_index],Structu
+0005ac10: 7265 456c 656d 656e 7429 3a0d 0a20 2020  reElement):..   
+0005ac20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0005ac30: 7365 6c66 2e74 6172 6765 742e 7374 7275  self.target.stru
+0005ac40: 6374 7572 6573 5b64 696d 656e 7369 6f6e  ctures[dimension
+0005ac50: 5f69 6e64 6578 5d0d 0a0d 0a20 2020 2040  _index]....    @
+0005ac60: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+0005ac70: 6620 6566 6665 6374 6976 655f 696e 6469  f effective_indi
+0005ac80: 6361 746f 725f 656c 656d 656e 7473 2873  cator_elements(s
+0005ac90: 656c 6629 3a0d 0a20 2020 2020 2020 2023  elf):..        #
+0005aca0: 5f67 6574 5f69 6d70 6c69 6564 5f73 686f  _get_implied_sho
+0005acb0: 7274 636f 6465 5f6c 6973 745f 616e 645f  rtcode_list_and_
+0005acc0: 6d61 7070 696e 675f 7479 7065 0d0a 2020  mapping_type..  
+0005acd0: 2020 2020 2020 6469 6d65 6e73 696f 6e5f        dimension_
+0005ace0: 696e 6465 7820 3d20 380d 0a20 2020 2020  index = 8..     
+0005acf0: 2020 2073 656c 662e 5f68 616e 646c 655f     self._handle_
+0005ad00: 656d 7074 795f 7461 7267 6574 2829 0d0a  empty_target()..
+0005ad10: 0d0a 2020 2020 2020 2020 2357 6865 7265  ..        #Where
+0005ad20: 2074 6865 7265 2061 7265 206e 6f20 6d61   there are no ma
+0005ad30: 7070 696e 6773 2077 6520 6172 6520 6861  ppings we are ha
+0005ad40: 7070 7920 746f 2075 7365 2061 2073 696e  ppy to use a sin
+0005ad50: 676c 6520 656c 656d 656e 7420 6966 206f  gle element if o
+0005ad60: 6e65 2069 7320 6176 6169 6c61 626c 650d  ne is available.
+0005ad70: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0005ad80: 2e5f 6d61 7070 6572 7320 6973 204e 6f6e  ._mappers is Non
+0005ad90: 6520 6f72 2073 656c 662e 5f6d 6170 7065  e or self._mappe
+0005ada0: 7273 5b64 696d 656e 7369 6f6e 5f69 6e64  rs[dimension_ind
+0005adb0: 6578 5d20 6973 204e 6f6e 653a 0d0a 2020  ex] is None:..  
+0005adc0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0005add0: 6861 6e64 6c65 5f6e 6f5f 6d61 7070 696e  handle_no_mappin
+0005ade0: 675f 7369 6e67 6c65 5f65 6c65 6d65 6e74  g_single_element
+0005adf0: 2864 696d 656e 7369 6f6e 5f69 6e64 6578  (dimension_index
+0005ae00: 3d64 696d 656e 7369 6f6e 5f69 6e64 6578  =dimension_index
+0005ae10: 2c64 696d 656e 7369 6f6e 5f6e 616d 653d  ,dimension_name=
+0005ae20: 2749 6e64 6963 6174 6f72 2729 0d0a 2020  'Indicator')..  
+0005ae30: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0005ae40: 2020 2020 2020 2020 2065 6666 6563 7469           effecti
+0005ae50: 7665 5f65 6c65 6d65 6e74 732c 206d 6170  ve_elements, map
+0005ae60: 7069 6e67 5f74 7970 652c 636f 6c75 6d6e  ping_type,column
+0005ae70: 5f6e 616d 6573 203d 2073 656c 662e 5f67  _names = self._g
+0005ae80: 6574 5f69 6d70 6c69 6564 5f73 686f 7274  et_implied_short
+0005ae90: 636f 6465 5f6c 6973 745f 616e 645f 6d61  code_list_and_ma
+0005aea0: 7070 696e 675f 7479 7065 2864 696d 656e  pping_type(dimen
+0005aeb0: 7369 6f6e 5f69 6e64 6578 203d 2064 696d  sion_index = dim
+0005aec0: 656e 7369 6f6e 5f69 6e64 6578 2c20 6f62  ension_index, ob
+0005aed0: 6a65 6374 5f74 6f5f 6368 6563 6b5f 6167  ject_to_check_ag
+0005aee0: 6169 6e73 7420 3d73 656c 662e 7461 7267  ainst =self.targ
+0005aef0: 6574 2e73 7472 7563 7475 7265 735b 6469  et.structures[di
+0005af00: 6d65 6e73 696f 6e5f 696e 6465 785d 290d  mension_index]).
+0005af10: 0a0d 0a20 2020 2020 2020 2020 2020 2069  ...            i
+0005af20: 6620 6d61 7070 696e 675f 7479 7065 203d  f mapping_type =
+0005af30: 3d27 636f 6e73 7461 6e74 2073 686f 7274  ='constant short
+0005af40: 6e61 6d65 273a 0d0a 2020 2020 2020 2020  name':..        
+0005af50: 2020 2020 2020 2020 7265 7475 726e 0d0a          return..
+0005af60: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+0005af70: 206d 6170 7069 6e67 5f74 7970 6520 3d3d   mapping_type ==
+0005af80: 2763 6f6c 756d 6e20 6e61 6d65 273a 0d0a  'column name':..
+0005af90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005afa0: 7265 7475 726e 0d0a 2020 2020 2020 2020  return..        
+0005afb0: 2020 2020 656c 6966 206d 6170 7069 6e67      elif mapping
+0005afc0: 5f74 7970 6520 3d3d 2763 6f6c 756d 6e73  _type =='columns
+0005afd0: 2074 6f20 6669 656c 6473 273a 0d0a 2020   to fields':..  
+0005afe0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0005aff0: 7475 726e 0d0a 2020 2020 2020 2020 2020  turn..          
+0005b000: 2020 656c 6966 206d 6170 7069 6e67 5f74    elif mapping_t
+0005b010: 7970 6520 3d3d 2763 6f6c 756d 6e73 2074  ype =='columns t
+0005b020: 6f20 7368 6f72 746e 616d 6573 273a 0d0a  o shortnames':..
+0005b030: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005b040: 2020 2372 6574 7572 6e20 7468 6520 6669    #return the fi
+0005b050: 7273 7420 5374 7275 6374 7572 6565 6c65  rst Structureele
+0005b060: 6d65 6e74 7320 7765 2066 696e 6420 7769  ments we find wi
+0005b070: 7468 2074 6865 0d0a 2020 2020 2020 2020  th the..        
+0005b080: 2020 2020 2020 2020 6669 6c74 6572 6564          filtered
+0005b090: 5f65 6c65 6d65 6e74 7320 3d20 5b5d 0d0a  _elements = []..
+0005b0a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005b0b0: 2020 2345 6974 6865 7220 6765 7420 7468    #Either get th
+0005b0c0: 6520 6669 7273 7420 6869 6572 6172 6368  e first hierarch
+0005b0d0: 7920 696e 2061 2073 696e 676c 6520 6869  y in a single hi
+0005b0e0: 6572 6172 6368 7920 5374 7275 6374 7572  erarchy Structur
+0005b0f0: 6520 6f72 2067 6574 2074 6865 2068 6965  e or get the hie
+0005b100: 7261 7263 6879 2070 6173 7365 6420 696e  rarchy passed in
+0005b110: 202d 2077 6869 6368 6576 6572 2069 7420   - whichever it 
+0005b120: 7761 730d 0a20 2020 2020 2020 2020 2020  was..           
+0005b130: 2020 2020 2068 6965 7261 7263 6879 203d       hierarchy =
+0005b140: 2073 656c 662e 5f67 6574 5f68 6965 7261   self._get_hiera
+0005b150: 7263 6879 5f64 6972 6563 745f 6f72 5f73  rchy_direct_or_s
+0005b160: 696e 676c 655f 6869 6572 6172 6368 795f  ingle_hierarchy_
+0005b170: 6672 6f6d 5f73 7472 7563 7475 7265 2864  from_structure(d
+0005b180: 696d 656e 7369 6f6e 5f69 6e64 6578 3d64  imension_index=d
+0005b190: 696d 656e 7369 6f6e 5f69 6e64 6578 2c64  imension_index,d
+0005b1a0: 696d 656e 7369 6f6e 5f6e 616d 653d 2749  imension_name='I
+0005b1b0: 6e64 6963 6174 6f72 2729 0d0a 2020 2020  ndicator')..    
+0005b1c0: 2020 2020 2020 2020 2020 2020 2357 6527              #We'
+0005b1d0: 7665 2061 7373 756d 6564 2074 6861 7420  ve assumed that 
+0005b1e0: 6566 6665 6374 6976 655f 656c 656d 656e  effective_elemen
+0005b1f0: 7473 2069 7320 6120 6c69 7374 206f 6620  ts is a list of 
+0005b200: 7368 6f72 746e 616d 6573 0d0a 2020 2020  shortnames..    
+0005b210: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0005b220: 7368 6f72 746e 616d 6520 696e 2065 6666  shortname in eff
+0005b230: 6563 7469 7665 5f65 6c65 6d65 6e74 733a  ective_elements:
+0005b240: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005b250: 2020 2020 2020 666f 756e 645f 656c 656d        found_elem
+0005b260: 656e 7473 203d 2068 6965 7261 7263 6879  ents = hierarchy
+0005b270: 2e67 6574 5f65 6c65 6d65 6e74 7328 7368  .get_elements(sh
+0005b280: 6f72 746e 616d 6529 0d0a 2020 2020 2020  ortname)..      
+0005b290: 2020 2020 2020 2020 2020 2020 2020 2341                #A
+0005b2a0: 7070 656e 6420 7468 6520 6669 7273 7420  ppend the first 
+0005b2b0: 696e 7374 616e 6365 206f 6620 616e 7920  instance of any 
+0005b2c0: 656c 656d 656e 7473 2077 6520 6669 6e64  elements we find
+0005b2d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005b2e0: 2020 2020 2020 2369 6620 7765 2064 6f6e        #if we don
+0005b2f0: 2774 2066 696e 6420 6f6e 652c 2064 6f65  't find one, doe
+0005b300: 736e 2774 206d 6174 7465 7220 2849 2074  sn't matter (I t
+0005b310: 6869 6e6b 290d 0a20 2020 2020 2020 2020  hink)..         
+0005b320: 2020 2020 2020 2020 2020 2074 7279 3a0d             try:.
+0005b330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005b340: 2020 2020 2020 2020 2066 696c 7465 7265           filtere
+0005b350: 645f 656c 656d 656e 7473 2e61 7070 656e  d_elements.appen
+0005b360: 6428 666f 756e 645f 656c 656d 656e 7473  d(found_elements
+0005b370: 5b30 5d20 290d 0a20 2020 2020 2020 2020  [0] )..         
+0005b380: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0005b390: 7420 496e 6465 7845 7272 6f72 3a0d 0a20  t IndexError:.. 
+0005b3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005b3b0: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
+0005b3c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0005b3d0: 6574 7572 6e20 6669 6c74 6572 6564 5f65  eturn filtered_e
+0005b3e0: 6c65 6d65 6e74 730d 0a0d 0a20 2020 2020  lements....     
+0005b3f0: 2020 2020 2020 2065 6c69 6620 6d61 7070         elif mapp
+0005b400: 696e 675f 7479 7065 203d 3d27 636f 6c75  ing_type =='colu
+0005b410: 6d6e 2074 6f20 7368 6f72 746e 616d 6520  mn to shortname 
+0005b420: 746f 2076 616c 7565 273a 0d0a 2020 2020  to value':..    
+0005b430: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0005b440: 726e 0d0a 0d0a 2020 2020 4070 726f 7065  rn....    @prope
+0005b450: 7274 790d 0a20 2020 2064 6566 2065 6666  rty..    def eff
+0005b460: 6563 7469 7665 5f63 6f6d 7061 7269 736f  ective_compariso
+0005b470: 6e5f 656c 656d 656e 7473 2873 656c 6629  n_elements(self)
+0005b480: 3a0d 0a20 2020 2020 2020 2023 436f 6d70  :..        #Comp
+0005b490: 6172 6973 6f6e 2062 6568 6176 6573 206a  arison behaves j
+0005b4a0: 7573 7420 6c69 6b65 2061 2075 6e69 7420  ust like a unit 
+0005b4b0: 6469 6d65 6e73 696f 6e2c 2073 6f20 7765  dimension, so we
+0005b4c0: 2073 686f 756c 6420 6265 2061 626c 6520   should be able 
+0005b4d0: 746f 2072 6575 7365 2074 6865 2063 6f64  to reuse the cod
+0005b4e0: 650d 0a20 2020 2020 2020 2064 696d 656e  e..        dimen
+0005b4f0: 7369 6f6e 5f69 6e64 6578 203d 2039 0d0a  sion_index = 9..
+0005b500: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+0005b510: 662e 5f6d 6170 7065 7273 5b64 696d 656e  f._mappers[dimen
+0005b520: 7369 6f6e 5f69 6e64 6578 5d20 6973 206e  sion_index] is n
+0005b530: 6f74 204e 6f6e 6520 616e 6420 6e6f 7420  ot None and not 
+0005b540: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+0005b550: 5f6d 6170 7065 7273 5b64 696d 656e 7369  _mappers[dimensi
+0005b560: 6f6e 5f69 6e64 6578 5d2c 7374 7229 3a0d  on_index],str):.
+0005b570: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0005b580: 7365 206d 7065 782e 4c6f 6164 6572 5365  se mpex.LoaderSe
+0005b590: 7475 7045 7272 6f72 2827 4d61 7070 696e  tupError('Mappin
+0005b5a0: 6720 666f 7220 7468 6520 436f 6d70 6172  g for the Compar
+0005b5b0: 6973 6f6e 2073 7472 7563 7475 7265 206f  ison structure o
+0005b5c0: 6620 6120 466f 6375 734c 6f61 6465 7220  f a FocusLoader 
+0005b5d0: 6d75 7374 2062 6520 6120 7369 6e67 6c65  must be a single
+0005b5e0: 2073 686f 7274 6e61 6d65 2073 7472 696e   shortname strin
+0005b5f0: 6720 6f72 2073 696e 676c 6520 636f 6c75  g or single colu
+0005b600: 6d6e 206e 616d 6520 616e 6420 6e6f 7420  mn name and not 
+0005b610: 7b7d 272e 666f 726d 6174 2873 656c 662e  {}'.format(self.
+0005b620: 5f6d 6170 7065 7273 5b64 696d 656e 7369  _mappers[dimensi
+0005b630: 6f6e 5f69 6e64 6578 5d29 290d 0a0d 0a20  on_index])).... 
+0005b640: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0005b650: 6c66 2e65 6666 6563 7469 7665 5f75 6e69  lf.effective_uni
+0005b660: 745f 6469 6d65 6e73 696f 6e5f 656c 656d  t_dimension_elem
+0005b670: 656e 7473 2864 696d 656e 7369 6f6e 5f69  ents(dimension_i
+0005b680: 6e64 6578 290d 0a0d 0a20 2020 2040 7072  ndex)....    @pr
+0005b690: 6f70 6572 7479 0d0a 2020 2020 6465 6620  operty..    def 
+0005b6a0: 6566 6665 6374 6976 655f 6375 7272 656e  effective_curren
+0005b6b0: 6379 5f65 6c65 6d65 6e74 7328 7365 6c66  cy_elements(self
+0005b6c0: 293a 0d0a 2020 2020 2020 2020 6469 6d65  ):..        dime
+0005b6d0: 6e73 696f 6e5f 696e 6465 7820 3d20 3130  nsion_index = 10
+0005b6e0: 0d0a 2020 2020 2020 2020 2373 656c 662e  ..        #self.
+0005b6f0: 5f68 616e 646c 655f 656d 7074 795f 7461  _handle_empty_ta
+0005b700: 7267 6574 2829 0d0a 0d0a 2020 2020 2020  rget()....      
+0005b710: 2020 2323 5768 6572 6520 7468 6572 6520    ##Where there 
+0005b720: 6172 6520 6e6f 206d 6170 7069 6e67 7320  are no mappings 
+0005b730: 7765 2061 7265 2068 6170 7079 2074 6f20  we are happy to 
+0005b740: 7573 6520 6120 7369 6e67 6c65 2065 6c65  use a single ele
+0005b750: 6d65 6e74 2069 6620 6f6e 6520 6973 2061  ment if one is a
+0005b760: 7661 696c 6162 6c65 0d0a 2020 2020 2020  vailable..      
+0005b770: 2020 2369 6620 7365 6c66 2e5f 6d61 7070    #if self._mapp
+0005b780: 6572 7320 6973 204e 6f6e 6520 6f72 2073  ers is None or s
+0005b790: 656c 662e 5f6d 6170 7065 7273 5b64 696d  elf._mappers[dim
+0005b7a0: 656e 7369 6f6e 5f69 6e64 6578 5d20 6973  ension_index] is
+0005b7b0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+0005b7c0: 2320 2020 2068 6965 7261 7263 6879 203d  #    hierarchy =
+0005b7d0: 2073 656c 662e 5f67 6574 5f68 6965 7261   self._get_hiera
+0005b7e0: 7263 6879 5f64 6972 6563 745f 6f72 5f73  rchy_direct_or_s
+0005b7f0: 696e 676c 655f 6869 6572 6172 6368 795f  ingle_hierarchy_
+0005b800: 6672 6f6d 5f73 7472 7563 7475 7265 2864  from_structure(d
+0005b810: 696d 656e 7369 6f6e 5f69 6e64 6578 3d64  imension_index=d
+0005b820: 696d 656e 7369 6f6e 5f69 6e64 6578 2c64  imension_index,d
+0005b830: 696d 656e 7369 6f6e 5f6e 616d 653d 2743  imension_name='C
+0005b840: 7572 7265 6e63 7927 2c65 6e66 6f72 6365  urrency',enforce
+0005b850: 5f73 696e 676c 655f 656c 656d 656e 743d  _single_element=
+0005b860: 5472 7565 290d 0a20 2020 2020 2020 2023  True)..        #
+0005b870: 2020 2020 6669 7273 745f 756e 6772 6f75      first_ungrou
+0005b880: 7065 645f 6368 696c 6472 656e 203d 2073  ped_children = s
+0005b890: 656c 662e 5f66 6972 7374 5f75 6e67 726f  elf._first_ungro
+0005b8a0: 7570 6564 5f63 6869 6c64 7265 6e28 6869  uped_children(hi
+0005b8b0: 6572 6172 6368 7929 0d0a 2020 2020 2020  erarchy)..      
+0005b8c0: 2020 2320 2020 2072 6574 7572 6e20 6669    #    return fi
+0005b8d0: 7273 745f 756e 6772 6f75 7065 645f 6368  rst_ungrouped_ch
+0005b8e0: 696c 6472 656e 0d0a 2020 2020 2020 2020  ildren..        
+0005b8f0: 2365 6c73 653a 0d0a 2020 2020 2020 2020  #else:..        
+0005b900: 2320 2020 2023 4569 7468 6572 2067 6574  #    #Either get
+0005b910: 2074 6865 2066 6972 7374 2068 6965 7261   the first hiera
+0005b920: 7263 6879 2069 6e20 6120 7369 6e67 6c65  rchy in a single
+0005b930: 2068 6965 7261 7263 6879 2053 7472 7563   hierarchy Struc
+0005b940: 7475 7265 206f 7220 6765 7420 7468 6520  ture or get the 
+0005b950: 6869 6572 6172 6368 7920 7061 7373 6564  hierarchy passed
+0005b960: 2069 6e20 2d20 7768 6963 6865 7665 7220   in - whichever 
+0005b970: 6974 2077 6173 0d0a 2020 2020 2020 2020  it was..        
+0005b980: 2320 2020 2068 6965 7261 7263 6879 203d  #    hierarchy =
+0005b990: 2073 656c 662e 5f67 6574 5f68 6965 7261   self._get_hiera
+0005b9a0: 7263 6879 5f64 6972 6563 745f 6f72 5f73  rchy_direct_or_s
+0005b9b0: 696e 676c 655f 6869 6572 6172 6368 795f  ingle_hierarchy_
+0005b9c0: 6672 6f6d 5f73 7472 7563 7475 7265 2864  from_structure(d
+0005b9d0: 696d 656e 7369 6f6e 5f69 6e64 6578 3d64  imension_index=d
+0005b9e0: 696d 656e 7369 6f6e 5f69 6e64 6578 2c64  imension_index,d
+0005b9f0: 696d 656e 7369 6f6e 5f6e 616d 653d 2743  imension_name='C
+0005ba00: 7572 7265 6e63 7927 290d 0a20 2020 2020  urrency')..     
+0005ba10: 2020 2023 2020 2020 6669 7273 745f 756e     #    first_un
+0005ba20: 6772 6f75 7065 645f 6368 696c 6472 656e  grouped_children
+0005ba30: 203d 2020 7365 6c66 2e5f 6669 7273 745f   =  self._first_
+0005ba40: 756e 6772 6f75 7065 645f 6368 696c 6472  ungrouped_childr
+0005ba50: 656e 2868 6965 7261 7263 6879 290d 0a20  en(hierarchy).. 
+0005ba60: 2020 2020 2020 2023 0d0a 2020 2020 2020         #..      
+0005ba70: 2020 2320 2020 2023 4368 6563 6b20 7468    #    #Check th
+0005ba80: 6174 2065 6163 6820 656c 656d 656e 7420  at each element 
+0005ba90: 696e 2066 6972 7374 5f75 6e67 726f 7570  in first_ungroup
+0005baa0: 6564 5f63 6869 6c64 7265 6e20 6973 2061  ed_children is a
+0005bab0: 2073 696e 676c 6520 656c 656d 656e 7420   single element 
+0005bac0: 2d20 692e 652e 2068 6173 206e 6f20 6869  - i.e. has no hi
+0005bad0: 6572 6172 6368 790d 0a20 2020 2020 2020  erarchy..       
+0005bae0: 2023 2020 2020 666f 7220 6820 696e 2066   #    for h in f
+0005baf0: 6972 7374 5f75 6e67 726f 7570 6564 5f63  irst_ungrouped_c
+0005bb00: 6869 6c64 7265 6e3a 0d0a 2020 2020 2020  hildren:..      
+0005bb10: 2020 2320 2020 2020 2020 2069 6620 6c65    #        if le
+0005bb20: 6e28 682e 6368 696c 6472 656e 2920 3e20  n(h.children) > 
+0005bb30: 303a 0d0a 2020 2020 2020 2020 2320 2020  0:..        #   
+0005bb40: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
+0005bb50: 7065 782e 4c6f 6164 6572 5365 7475 7045  pex.LoaderSetupE
+0005bb60: 7272 6f72 2827 466f 6375 734c 6f61 6465  rror('FocusLoade
+0005bb70: 7220 6361 6e6e 6f74 2068 616e 646c 6520  r cannot handle 
+0005bb80: 4375 7272 656e 6379 2053 7472 7563 7475  Currency Structu
+0005bb90: 7265 456c 656d 656e 7473 2077 6974 6820  reElements with 
+0005bba0: 616e 7974 6869 6e67 206d 6f72 6520 7468  anything more th
+0005bbb0: 616e 2061 2073 696e 676c 6520 666c 6174  an a single flat
+0005bbc0: 2073 7472 7563 7475 7265 2c20 6f72 2061   structure, or a
+0005bbd0: 2073 696e 676c 6520 6772 6f75 7065 6420   single grouped 
+0005bbe0: 666c 6174 2073 7472 7563 7475 7265 2e20  flat structure. 
+0005bbf0: 7b7d 272e 666f 726d 6174 2873 656c 662e  {}'.format(self.
+0005bc00: 7461 7267 6574 2e73 7472 7563 7475 7265  target.structure
+0005bc10: 735b 6469 6d65 6e73 696f 6e5f 696e 6465  s[dimension_inde
+0005bc20: 785d 2e6c 6f6e 676e 616d 6529 290d 0a20  x].longname)).. 
+0005bc30: 2020 2020 2020 2023 0d0a 2020 2020 2020         #..      
+0005bc40: 2020 2320 2020 2072 6574 7572 6e20 6669    #    return fi
+0005bc50: 7273 745f 756e 6772 6f75 7065 645f 6368  rst_ungrouped_ch
+0005bc60: 696c 6472 656e 0d0a 0d0a 2020 2020 2020  ildren....      
+0005bc70: 2020 7265 7475 726e 2073 656c 662e 6566    return self.ef
+0005bc80: 6665 6374 6976 655f 756e 6974 5f64 696d  fective_unit_dim
+0005bc90: 656e 7369 6f6e 5f65 6c65 6d65 6e74 7328  ension_elements(
+0005bca0: 6469 6d65 6e73 696f 6e5f 696e 6465 7829  dimension_index)
+0005bcb0: 0d0a 0d0a 0d0a 2020 2020 4070 726f 7065  ......    @prope
+0005bcc0: 7274 790d 0a20 2020 2064 6566 2065 6666  rty..    def eff
+0005bcd0: 6563 7469 7665 5f74 7261 6e73 666f 726d  ective_transform
+0005bce0: 5f65 6c65 6d65 6e74 7328 7365 6c66 293a  _elements(self):
+0005bcf0: 0d0a 2020 2020 2020 2020 2727 2747 6574  ..        '''Get
+0005bd00: 2074 6865 2065 6666 6563 7469 7665 2053   the effective S
+0005bd10: 7472 7563 7475 7265 2045 6c65 6d65 6e74  tructure Element
+0005bd20: 7320 6672 6f6d 2074 6865 2054 7261 6e73  s from the Trans
+0005bd30: 666f 726d 2064 696d 656e 7369 6f6e 0d0a  form dimension..
+0005bd40: 2020 2020 2020 2020 5765 206a 7573 7420          We just 
+0005bd50: 7761 6e74 2074 6865 2066 6972 7374 2027  want the first '
+0005bd60: 5261 7727 2065 6c65 6d65 6e74 2069 6e20  Raw' element in 
+0005bd70: 7468 6520 5669 6577 706f 696e 7420 2d20  the Viewpoint - 
+0005bd80: 7765 2064 6f6e 2774 2063 6172 6520 686f  we don't care ho
+0005bd90: 7720 6d61 6e79 2068 6965 7261 7263 6869  w many hierarchi
+0005bda0: 6573 2074 6865 2076 6965 7770 6f69 6e74  es the viewpoint
+0005bdb0: 2068 6173 202d 2073 696e 6365 2061 6c6c   has - since all
+0005bdc0: 2052 6177 2065 6c65 6d65 6e74 7320 6172   Raw elements ar
+0005bdd0: 6520 7574 7465 726c 7920 6571 7569 7661  e utterly equiva
+0005bde0: 6c65 6e74 0d0a 2020 2020 2020 2020 2727  lent..        ''
+0005bdf0: 270d 0a0d 0a20 2020 2020 2020 2064 696d  '....        dim
+0005be00: 656e 7369 6f6e 5f69 6e64 6578 203d 2031  ension_index = 1
+0005be10: 320d 0a20 2020 2020 2020 2073 656c 662e  2..        self.
+0005be20: 5f68 616e 646c 655f 656d 7074 795f 7461  _handle_empty_ta
+0005be30: 7267 6574 2829 0d0a 0d0a 2020 2020 2020  rget()....      
+0005be40: 2020 2357 6520 6172 6520 6e6f 7420 696e    #We are not in
+0005be50: 7465 7265 7374 6564 2069 6e20 7468 6520  terested in the 
+0005be60: 6d61 7070 696e 6773 0d0a 0d0a 2020 2020  mappings....    
+0005be70: 2020 2020 666f 7220 7365 2069 6e20 7365      for se in se
+0005be80: 6c66 2e74 6172 6765 742e 7374 7275 6374  lf.target.struct
+0005be90: 7572 6573 5b64 696d 656e 7369 6f6e 5f69  ures[dimension_i
+0005bea0: 6e64 6578 5d2e 7761 6c6b 2829 3a0d 0a20  ndex].walk():.. 
+0005beb0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0005bec0: 2e66 6965 6c64 735b 2743 616c 6375 6c61  .fields['Calcula
+0005bed0: 7469 6f6e 2053 7461 7475 7327 5d20 3d3d  tion Status'] ==
+0005bee0: 2027 5265 616c 2720 616e 6420 7365 2e66   'Real' and se.f
+0005bef0: 6965 6c64 735b 2747 726f 7570 204f 6e6c  ields['Group Onl
+0005bf00: 7927 5d20 6973 204e 6f6e 653a 0d0a 2020  y'] is None:..  
+0005bf10: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0005bf20: 7475 726e 205b 7365 5d0d 0a0d 0a20 2020  turn [se]....   
+0005bf30: 2020 2020 2072 6169 7365 206d 7065 782e       raise mpex.
+0005bf40: 4c6f 6164 6572 5365 7475 7045 7272 6f72  LoaderSetupError
+0005bf50: 2827 466f 6375 734c 6f61 6465 7220 6361  ('FocusLoader ca
+0005bf60: 6e6e 6f74 2068 616e 646c 6520 6120 5472  nnot handle a Tr
+0005bf70: 616e 7366 6f72 6d61 7469 6f6e 2053 7472  ansformation Str
+0005bf80: 7563 7475 7265 2022 7b7d 2220 7768 6963  ucture "{}" whic
+0005bf90: 6820 646f 6573 206e 6f74 2063 6f6e 7461  h does not conta
+0005bfa0: 696e 2061 6e79 2052 6561 6c20 656c 656d  in any Real elem
+0005bfb0: 656e 7473 2e27 2e66 6f72 6d61 7428 7365  ents.'.format(se
+0005bfc0: 6c66 2e74 6172 6765 742e 7374 7275 6374  lf.target.struct
+0005bfd0: 7572 6573 5b64 696d 656e 7369 6f6e 5f69  ures[dimension_i
+0005bfe0: 6e64 6578 5d2e 6c6f 6e67 6e61 6d65 2929  ndex].longname))
+0005bff0: 0d0a 0d0a 0d0a 2323 2323 2323 2323 2323  ......##########
+0005c000: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0005c010: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0005c020: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0005c030: 2323 2323 2323 2323 2323 0d0a 0d0a 636c  ##########....cl
+0005c040: 6173 7320 4c6f 6164 6572 286f 626a 6563  ass Loader(objec
+0005c050: 7429 3a0d 0a20 2020 2027 2727 5472 616e  t):..    '''Tran
+0005c060: 7361 6374 696f 6e61 6c20 6461 7461 2069  sactional data i
+0005c070: 7320 6c6f 6164 6564 2069 6e74 6f20 456d  s loaded into Em
+0005c080: 706f 7765 7220 5369 7465 7320 2d20 7468  power Sites - th
+0005c090: 6973 206f 626a 6563 7420 6c6f 6164 7320  is object loads 
+0005c0a0: 6974 2727 270d 0a0d 0a20 2020 2064 6566  it'''....    def
+0005c0b0: 205f 5f69 6e69 745f 5f28 7365 6c66 2c73   __init__(self,s
+0005c0c0: 6f75 7263 653d 4e6f 6e65 2c73 6974 653d  ource=None,site=
+0005c0d0: 4e6f 6e65 2c6c 6f67 6769 6e67 5f71 7565  None,logging_que
+0005c0e0: 7565 3d4e 6f6e 652c 6465 6c74 613d 5472  ue=None,delta=Tr
+0005c0f0: 7565 2c69 6465 6e74 6966 6965 725f 636f  ue,identifier_co
+0005c100: 6c75 6d6e 733d 4e6f 6e65 2c6e 616d 653d  lumns=None,name=
+0005c110: 276c 6f61 6465 725f 3027 2c73 6166 655f  'loader_0',safe_
+0005c120: 6c6f 6164 3d54 7275 652c 656d 706f 7765  load=True,empowe
+0005c130: 725f 7065 7269 6f64 5f74 7970 653d 6c6c  r_period_type=ll
+0005c140: 752e 454d 504f 5745 525f 4d4f 4e54 485f  u.EMPOWER_MONTH_
+0005c150: 434f 4e53 5441 4e54 2c65 6d70 6f77 6572  CONSTANT,empower
+0005c160: 5f69 6d70 6f72 7465 725f 6578 6563 7574  _importer_execut
+0005c170: 6162 6c65 3d6c 6c75 2e45 4d50 4f57 4552  able=llu.EMPOWER
+0005c180: 5f49 4d50 4f52 5445 525f 4558 4543 5554  _IMPORTER_EXECUT
+0005c190: 4142 4c45 293a 0d0a 2020 2020 2020 2020  ABLE):..        
+0005c1a0: 2727 270d 0a20 2020 2020 2020 2049 6620  '''..        If 
+0005c1b0: 6465 6c74 6120 6973 2073 6574 2074 6f20  delta is set to 
+0005c1c0: 5472 7565 2c20 2877 6869 6368 2069 7320  True, (which is 
+0005c1d0: 7468 6520 6465 6661 756c 7429 2074 6865  the default) the
+0005c1e0: 6e20 7468 6973 206c 6f61 6465 7220 7769  n this loader wi
+0005c1f0: 6c6c 2070 6572 666f 726d 2064 656c 7461  ll perform delta
+0005c200: 206c 6f61 6473 0d0a 0d0a 2020 2020 2020   loads....      
+0005c210: 2020 3a70 6172 616d 2073 6f75 7263 653a    :param source:
+0005c220: 2041 2070 616e 6461 7320 4461 7461 6672   A pandas Datafr
+0005c230: 616d 6520 746f 2062 6520 7573 6564 2061  ame to be used a
+0005c240: 7320 7468 6520 736f 7572 6365 2064 6174  s the source dat
+0005c250: 610d 0a20 2020 2020 2020 203a 7061 7261  a..        :para
+0005c260: 6d20 6964 656e 7469 6669 6572 5f63 6f6c  m identifier_col
+0005c270: 756d 6e73 3a20 436f 6c75 6d6e 7320 696e  umns: Columns in
+0005c280: 2074 6865 2073 6f75 7263 6520 7768 6963   the source whic
+0005c290: 6820 6172 6520 7573 6566 756c 2069 6e20  h are useful in 
+0005c2a0: 6465 6275 6767 696e 670d 0a20 2020 2020  debugging..     
+0005c2b0: 2020 203a 7061 7261 6d20 7361 6665 5f6c     :param safe_l
+0005c2c0: 6f61 643a 206f 6e6c 7920 6d6f 7665 2044  oad: only move D
+0005c2d0: 6174 6120 4669 6c65 7320 6166 7465 7220  ata Files after 
+0005c2e0: 6c6f 6164 696e 6720 6174 2074 6865 206c  loading at the l
+0005c2f0: 6173 7420 6d6f 6d65 6e74 202d 2074 6869  ast moment - thi
+0005c300: 7320 6d61 6b65 7320 7468 6520 7072 6f63  s makes the proc
+0005c310: 6573 7320 7065 7266 6563 746c 7920 7265  ess perfectly re
+0005c320: 7374 6172 7461 626c 650d 0a20 2020 2020  startable..     
+0005c330: 2020 2027 2727 0d0a 2020 2020 2020 2020     '''..        
+0005c340: 6966 2069 6465 6e74 6966 6965 725f 636f  if identifier_co
+0005c350: 6c75 6d6e 7320 6973 204e 6f6e 653a 0d0a  lumns is None:..
+0005c360: 2020 2020 2020 2020 2020 2020 6964 656e              iden
+0005c370: 7469 6669 6572 5f63 6f6c 756d 6e73 3d5b  tifier_columns=[
+0005c380: 5d0d 0a0d 0a20 2020 2020 2020 2073 656c  ]....        sel
+0005c390: 662e 5f73 6974 6520 2020 2020 2020 2020  f._site         
+0005c3a0: 2020 2020 2020 3d20 7369 7465 0d0a 2020        = site..  
+0005c3b0: 2020 2020 2020 7365 6c66 2e6c 6f67 6769        self.loggi
+0005c3c0: 6e67 5f71 7565 7565 2020 2020 2020 3d20  ng_queue      = 
+0005c3d0: 6c6f 6767 696e 675f 7175 6575 650d 0a20  logging_queue.. 
+0005c3e0: 2020 2020 2020 2023 544f 444f 202d 2073         #TODO - s
+0005c3f0: 656c 662e 7661 6c69 6461 746f 720d 0a20  elf.validator.. 
+0005c400: 2020 2020 2020 2023 544f 444f 202d 206d         #TODO - m
+0005c410: 6169 6e74 6169 6e20 6469 6374 696f 6e61  aintain dictiona
+0005c420: 7279 206f 6620 6e61 6d65 6420 6461 7461  ry of named data
+0005c430: 6672 616d 6573 2066 6f72 2075 7365 2069  frames for use i
+0005c440: 6e20 7468 6520 7661 6c69 6461 746f 720d  n the validator.
+0005c450: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
+0005c460: 6465 6c74 613d 6465 6c74 610d 0a0d 0a20  delta=delta.... 
+0005c470: 2020 2020 2020 2073 656c 662e 736f 7572         self.sour
+0005c480: 6365 3d73 6f75 7263 650d 0a20 2020 2020  ce=source..     
+0005c490: 2020 2023 5765 206d 6179 2077 6973 6820     #We may wish 
+0005c4a0: 746f 2061 6464 206f 7468 6572 2073 6f75  to add other sou
+0005c4b0: 7263 6573 2028 652e 672e 2063 7376 2c20  rces (e.g. csv, 
+0005c4c0: 6578 6365 6c29 2061 6c73 6f20 7468 6520  excel) also the 
+0005c4d0: 6466 2077 696c 6c20 6368 616e 6765 206f  df will change o
+0005c4e0: 7665 7220 7469 6d65 0d0a 2020 2020 2020  ver time..      
+0005c4f0: 2020 7365 6c66 2e64 663d 7365 6c66 2e73    self.df=self.s
+0005c500: 6f75 7263 650d 0a0d 0a20 2020 2020 2020  ource....       
+0005c510: 2073 656c 662e 6964 656e 7469 6669 6572   self.identifier
+0005c520: 5f63 6f6c 756d 6e73 203d 2069 6465 6e74  _columns = ident
+0005c530: 6966 6965 725f 636f 6c75 6d6e 730d 0a0d  ifier_columns...
+0005c540: 0a20 2020 2020 2020 2073 656c 662e 6e61  .        self.na
+0005c550: 6d65 203d 206e 616d 650d 0a20 2020 2020  me = name..     
+0005c560: 2020 2023 5468 6520 6c6f 6164 206d 6179     #The load may
+0005c570: 2062 6520 6272 6f6b 656e 2064 6f77 6e20   be broken down 
+0005c580: 696e 746f 2073 7562 6c6f 6164 732c 2069  into subloads, i
+0005c590: 6620 7765 2077 616e 7420 746f 2072 6575  f we want to reu
+0005c5a0: 7365 2061 206c 6f61 6465 720d 0a20 2020  se a loader..   
+0005c5b0: 2020 2020 2073 656c 662e 7375 626c 6f61       self.subloa
+0005c5c0: 6473 3d5b 5d0d 0a0d 0a20 2020 2020 2020  ds=[]....       
+0005c5d0: 2073 656c 662e 656d 706f 7765 725f 7065   self.empower_pe
+0005c5e0: 7269 6f64 5f74 7970 6520 3d20 656d 706f  riod_type = empo
+0005c5f0: 7765 725f 7065 7269 6f64 5f74 7970 650d  wer_period_type.
+0005c600: 0a20 2020 2020 2020 2073 656c 662e 656d  .        self.em
+0005c610: 706f 7765 725f 696d 706f 7274 6572 5f65  power_importer_e
+0005c620: 7865 6375 7461 626c 6520 3d20 656d 706f  xecutable = empo
+0005c630: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
+0005c640: 6375 7461 626c 650d 0a0d 0a20 2020 2020  cutable....     
+0005c650: 2020 2073 656c 662e 7361 6665 5f6c 6f61     self.safe_loa
+0005c660: 643d 7361 6665 5f6c 6f61 640d 0a0d 0a20  d=safe_load.... 
+0005c670: 2020 2020 2020 2073 656c 662e 7368 6172         self.shar
+0005c680: 6469 6e67 5f71 7565 7565 203d 204e 6f6e  ding_queue = Non
+0005c690: 650d 0a0d 0a20 2020 2020 2020 2023 5573  e....        #Us
+0005c6a0: 6564 2066 6f72 206d 6f6e 6b65 792d 7061  ed for monkey-pa
+0005c6b0: 7463 6869 6e67 2069 6e20 616c 7068 6120  tching in alpha 
+0005c6c0: 6465 7665 6c6f 706d 656e 7420 7374 6174  development stat
+0005c6d0: 7573 2062 756c 6b20 6c6f 6164 696e 6720  us bulk loading 
+0005c6e0: 6675 6e63 7469 6f6e 730d 0a20 2020 2020  functions..     
+0005c6f0: 2020 2073 656c 662e 5f73 696e 676c 655f     self._single_
+0005c700: 6275 6c6b 5f6c 6f61 645f 6675 6e63 7469  bulk_load_functi
+0005c710: 6f6e 203d 2020 6c6c 752e 6d73 6773 696e  on =  llu.msgsin
+0005c720: 6b5f 5f72 756e 5f73 696e 676c 655f 7371  k__run_single_sq
+0005c730: 6c5f 656d 706f 7765 725f 6275 6c6b 5f6c  l_empower_bulk_l
+0005c740: 6f61 640d 0a0d 0a20 2020 2064 6566 206c  oad....    def l
+0005c750: 6f61 6428 7365 6c66 0d0a 2020 2020 2020  oad(self..      
+0005c760: 2020 2020 2020 2c64 696d 656e 7369 6f6e        ,dimension
+0005c770: 5f30 2020 203d 204e 6f6e 650d 0a20 2020  _0   = None..   
+0005c780: 2020 2020 2020 2020 202c 6469 6d65 6e73           ,dimens
+0005c790: 696f 6e5f 3120 2020 3d20 4e6f 6e65 0d0a  ion_1   = None..
+0005c7a0: 2020 2020 2020 2020 2020 2020 2c64 696d              ,dim
+0005c7b0: 656e 7369 6f6e 5f32 2020 203d 204e 6f6e  ension_2   = Non
+0005c7c0: 650d 0a20 2020 2020 2020 2020 2020 202c  e..            ,
+0005c7d0: 6469 6d65 6e73 696f 6e5f 3320 2020 3d20  dimension_3   = 
+0005c7e0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+0005c7f0: 2020 2c64 696d 656e 7369 6f6e 5f34 2020    ,dimension_4  
+0005c800: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+0005c810: 2020 2020 202c 6469 6d65 6e73 696f 6e5f       ,dimension_
+0005c820: 3520 2020 3d20 4e6f 6e65 0d0a 2020 2020  5   = None..    
+0005c830: 2020 2020 2020 2020 2c64 696d 656e 7369          ,dimensi
+0005c840: 6f6e 5f36 2020 203d 204e 6f6e 650d 0a20  on_6   = None.. 
+0005c850: 2020 2020 2020 2020 2020 202c 6469 6d65             ,dime
+0005c860: 6e73 696f 6e5f 3720 2020 3d20 4e6f 6e65  nsion_7   = None
+0005c870: 0d0a 2020 2020 2020 2020 2020 2020 2c6d  ..            ,m
+0005c880: 6f64 6520 2020 2020 2020 2020 203d 204e  ode          = N
+0005c890: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+0005c8a0: 202c 6261 7365 2020 2020 2020 2020 2020   ,base          
+0005c8b0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
+0005c8c0: 2020 2020 2c74 696d 6520 2020 2020 2020      ,time       
+0005c8d0: 2020 203d 204e 6f6e 650d 0a20 2020 2020     = None..     
+0005c8e0: 2020 2020 2020 202c 6d65 7472 6963 2020         ,metric  
+0005c8f0: 2020 2020 2020 3d20 4e6f 6e65 0d0a 2020        = None..  
+0005c900: 2020 2020 2020 2020 2020 2c65 6d70 6f77            ,empow
+0005c910: 6572 5f70 6572 696f 645f 7479 7065 203d  er_period_type =
+0005c920: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
+0005c930: 2020 202c 7661 6c75 6520 2020 2020 2020     ,value       
+0005c940: 2020 3d20 4e6f 6e65 0d0a 2020 2020 2020    = None..      
+0005c950: 2020 2020 2020 2c69 676e 6f72 655f 7a65        ,ignore_ze
+0005c960: 726f 5f76 616c 7565 7320 2020 2020 2020  ro_values       
+0005c970: 2020 3d20 5472 7565 0d0a 2020 2020 2020    = True..      
+0005c980: 2020 2020 2020 293a 0d0a 2020 2020 2020        ):..      
+0005c990: 2020 2727 270d 0a0d 0a20 2020 2020 2020    '''....       
+0005c9a0: 202e 6c6f 6164 2829 2064 6f65 7320 2e65   .load() does .e
+0005c9b0: 7870 6c6f 6465 2829 2c20 2e73 6861 7264  xplode(), .shard
+0005c9c0: 2829 2061 6e64 202e 6c6f 6164 5f73 6861  () and .load_sha
+0005c9d0: 7264 7328 290d 0a0d 0a20 2020 2020 2020  rds()....       
+0005c9e0: 203a 7061 7261 6d20 6469 6d65 6e73 696f   :param dimensio
+0005c9f0: 6e5f 303a 2073 7472 696e 672c 206c 6973  n_0: string, lis
+0005ca00: 742c 2070 796d 7078 2e45 6c65 6d65 6e74  t, pympx.Element
+0005ca10: 2c20 7079 6d70 782e 436f 6e73 7461 6e74  , pympx.Constant
+0005ca20: 206f 7220 7079 6d70 782e 5374 7275 6374   or pympx.Struct
+0005ca30: 7572 654d 6170 7065 722e 2053 7472 696e  ureMapper. Strin
+0005ca40: 6720 7265 7072 6573 656e 7473 2061 2063  g represents a c
+0005ca50: 6f6c 756d 6e20 6e61 6d65 2c20 6120 436f  olumn name, a Co
+0005ca60: 6e73 7461 6e74 2063 616e 2062 6520 6569  nstant can be ei
+0005ca70: 7468 6572 2061 2070 6879 7369 6420 6f72  ther a physid or
+0005ca80: 2073 686f 7274 6e61 6d65 2c20 6120 5374   shortname, a St
+0005ca90: 7275 6374 7572 6520 6d61 7070 6572 2072  ructure mapper r
+0005caa0: 6570 7265 7365 6e74 7320 6120 6869 6572  epresents a hier
+0005cab0: 6172 6368 7920 7472 6565 2e20 4c69 7374  archy tree. List
+0005cac0: 2063 616e 2062 6520 6569 7468 6572 2061   can be either a
+0005cad0: 206c 6973 7420 6f66 2073 7472 696e 6773   list of strings
+0005cae0: 206f 7220 436f 6e73 7461 6e74 730d 0a20   or Constants.. 
+0005caf0: 2020 2020 2020 203a 7061 7261 6d20 6469         :param di
+0005cb00: 6d65 6e73 696f 6e5f 313a 2073 7472 696e  mension_1: strin
+0005cb10: 672c 206c 6973 742c 2070 796d 7078 2e45  g, list, pympx.E
+0005cb20: 6c65 6d65 6e74 2c20 7079 6d70 782e 436f  lement, pympx.Co
+0005cb30: 6e73 7461 6e74 206f 7220 7079 6d70 782e  nstant or pympx.
+0005cb40: 5374 7275 6374 7572 654d 6170 7065 722e  StructureMapper.
+0005cb50: 2053 7472 696e 6720 7265 7072 6573 656e   String represen
+0005cb60: 7473 2061 2063 6f6c 756d 6e20 6e61 6d65  ts a column name
+0005cb70: 2c20 6120 436f 6e73 7461 6e74 2063 616e  , a Constant can
+0005cb80: 2062 6520 6569 7468 6572 2061 2070 6879   be either a phy
+0005cb90: 7369 6420 6f72 2073 686f 7274 6e61 6d65  sid or shortname
+0005cba0: 2c20 6120 5374 7275 6374 7572 6520 6d61  , a Structure ma
+0005cbb0: 7070 6572 2072 6570 7265 7365 6e74 7320  pper represents 
+0005cbc0: 6120 6869 6572 6172 6368 7920 7472 6565  a hierarchy tree
+0005cbd0: 2e20 4c69 7374 2063 616e 2062 6520 6569  . List can be ei
+0005cbe0: 7468 6572 2061 206c 6973 7420 6f66 2073  ther a list of s
+0005cbf0: 7472 696e 6773 206f 7220 436f 6e73 7461  trings or Consta
+0005cc00: 6e74 730d 0a20 2020 2020 2020 203a 7061  nts..        :pa
+0005cc10: 7261 6d20 6469 6d65 6e73 696f 6e5f 323a  ram dimension_2:
+0005cc20: 2073 7472 696e 672c 206c 6973 742c 2070   string, list, p
+0005cc30: 796d 7078 2e45 6c65 6d65 6e74 2c20 7079  ympx.Element, py
+0005cc40: 6d70 782e 436f 6e73 7461 6e74 206f 7220  mpx.Constant or 
+0005cc50: 7079 6d70 782e 5374 7275 6374 7572 654d  pympx.StructureM
+0005cc60: 6170 7065 722e 2053 7472 696e 6720 7265  apper. String re
+0005cc70: 7072 6573 656e 7473 2061 2063 6f6c 756d  presents a colum
+0005cc80: 6e20 6e61 6d65 2c20 6120 436f 6e73 7461  n name, a Consta
+0005cc90: 6e74 2063 616e 2062 6520 6569 7468 6572  nt can be either
+0005cca0: 2061 2070 6879 7369 6420 6f72 2073 686f   a physid or sho
+0005ccb0: 7274 6e61 6d65 2c20 6120 5374 7275 6374  rtname, a Struct
+0005ccc0: 7572 6520 6d61 7070 6572 2072 6570 7265  ure mapper repre
+0005ccd0: 7365 6e74 7320 6120 6869 6572 6172 6368  sents a hierarch
+0005cce0: 7920 7472 6565 2e20 4c69 7374 2063 616e  y tree. List can
+0005ccf0: 2062 6520 6569 7468 6572 2061 206c 6973   be either a lis
+0005cd00: 7420 6f66 2073 7472 696e 6773 206f 7220  t of strings or 
+0005cd10: 436f 6e73 7461 6e74 730d 0a20 2020 2020  Constants..     
+0005cd20: 2020 203a 7061 7261 6d20 6469 6d65 6e73     :param dimens
+0005cd30: 696f 6e5f 333a 2073 7472 696e 672c 206c  ion_3: string, l
+0005cd40: 6973 742c 2070 796d 7078 2e45 6c65 6d65  ist, pympx.Eleme
+0005cd50: 6e74 2c20 7079 6d70 782e 436f 6e73 7461  nt, pympx.Consta
+0005cd60: 6e74 206f 7220 7079 6d70 782e 5374 7275  nt or pympx.Stru
+0005cd70: 6374 7572 654d 6170 7065 722e 2053 7472  ctureMapper. Str
+0005cd80: 696e 6720 7265 7072 6573 656e 7473 2061  ing represents a
+0005cd90: 2063 6f6c 756d 6e20 6e61 6d65 2c20 6120   column name, a 
+0005cda0: 436f 6e73 7461 6e74 2063 616e 2062 6520  Constant can be 
+0005cdb0: 6569 7468 6572 2061 2070 6879 7369 6420  either a physid 
+0005cdc0: 6f72 2073 686f 7274 6e61 6d65 2c20 6120  or shortname, a 
+0005cdd0: 5374 7275 6374 7572 6520 6d61 7070 6572  Structure mapper
+0005cde0: 2072 6570 7265 7365 6e74 7320 6120 6869   represents a hi
+0005cdf0: 6572 6172 6368 7920 7472 6565 2e20 4c69  erarchy tree. Li
+0005ce00: 7374 2063 616e 2062 6520 6569 7468 6572  st can be either
+0005ce10: 2061 206c 6973 7420 6f66 2073 7472 696e   a list of strin
+0005ce20: 6773 206f 7220 436f 6e73 7461 6e74 730d  gs or Constants.
+0005ce30: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0005ce40: 6469 6d65 6e73 696f 6e5f 343a 2073 7472  dimension_4: str
+0005ce50: 696e 672c 206c 6973 742c 2070 796d 7078  ing, list, pympx
+0005ce60: 2e45 6c65 6d65 6e74 2c20 7079 6d70 782e  .Element, pympx.
+0005ce70: 436f 6e73 7461 6e74 206f 7220 7079 6d70  Constant or pymp
+0005ce80: 782e 5374 7275 6374 7572 654d 6170 7065  x.StructureMappe
+0005ce90: 722e 2053 7472 696e 6720 7265 7072 6573  r. String repres
+0005cea0: 656e 7473 2061 2063 6f6c 756d 6e20 6e61  ents a column na
+0005ceb0: 6d65 2c20 6120 436f 6e73 7461 6e74 2063  me, a Constant c
+0005cec0: 616e 2062 6520 6569 7468 6572 2061 2070  an be either a p
+0005ced0: 6879 7369 6420 6f72 2073 686f 7274 6e61  hysid or shortna
+0005cee0: 6d65 2c20 6120 5374 7275 6374 7572 6520  me, a Structure 
+0005cef0: 6d61 7070 6572 2072 6570 7265 7365 6e74  mapper represent
+0005cf00: 7320 6120 6869 6572 6172 6368 7920 7472  s a hierarchy tr
+0005cf10: 6565 2e20 4c69 7374 2063 616e 2062 6520  ee. List can be 
+0005cf20: 6569 7468 6572 2061 206c 6973 7420 6f66  either a list of
+0005cf30: 2073 7472 696e 6773 206f 7220 436f 6e73   strings or Cons
+0005cf40: 7461 6e74 730d 0a20 2020 2020 2020 203a  tants..        :
+0005cf50: 7061 7261 6d20 6469 6d65 6e73 696f 6e5f  param dimension_
+0005cf60: 353a 2073 7472 696e 672c 206c 6973 742c  5: string, list,
+0005cf70: 2070 796d 7078 2e45 6c65 6d65 6e74 2c20   pympx.Element, 
+0005cf80: 7079 6d70 782e 436f 6e73 7461 6e74 206f  pympx.Constant o
+0005cf90: 7220 7079 6d70 782e 5374 7275 6374 7572  r pympx.Structur
+0005cfa0: 654d 6170 7065 722e 2053 7472 696e 6720  eMapper. String 
+0005cfb0: 7265 7072 6573 656e 7473 2061 2063 6f6c  represents a col
+0005cfc0: 756d 6e20 6e61 6d65 2c20 6120 436f 6e73  umn name, a Cons
+0005cfd0: 7461 6e74 2063 616e 2062 6520 6569 7468  tant can be eith
+0005cfe0: 6572 2061 2070 6879 7369 6420 6f72 2073  er a physid or s
+0005cff0: 686f 7274 6e61 6d65 2c20 6120 5374 7275  hortname, a Stru
+0005d000: 6374 7572 6520 6d61 7070 6572 2072 6570  cture mapper rep
+0005d010: 7265 7365 6e74 7320 6120 6869 6572 6172  resents a hierar
+0005d020: 6368 7920 7472 6565 2e20 4c69 7374 2063  chy tree. List c
+0005d030: 616e 2062 6520 6569 7468 6572 2061 206c  an be either a l
+0005d040: 6973 7420 6f66 2073 7472 696e 6773 206f  ist of strings o
+0005d050: 7220 436f 6e73 7461 6e74 730d 0a20 2020  r Constants..   
+0005d060: 2020 2020 203a 7061 7261 6d20 6469 6d65       :param dime
+0005d070: 6e73 696f 6e5f 363a 2073 7472 696e 672c  nsion_6: string,
+0005d080: 206c 6973 742c 2070 796d 7078 2e45 6c65   list, pympx.Ele
+0005d090: 6d65 6e74 2c20 7079 6d70 782e 436f 6e73  ment, pympx.Cons
+0005d0a0: 7461 6e74 206f 7220 7079 6d70 782e 5374  tant or pympx.St
+0005d0b0: 7275 6374 7572 654d 6170 7065 722e 2053  ructureMapper. S
+0005d0c0: 7472 696e 6720 7265 7072 6573 656e 7473  tring represents
+0005d0d0: 2061 2063 6f6c 756d 6e20 6e61 6d65 2c20   a column name, 
+0005d0e0: 6120 436f 6e73 7461 6e74 2063 616e 2062  a Constant can b
+0005d0f0: 6520 6569 7468 6572 2061 2070 6879 7369  e either a physi
+0005d100: 6420 6f72 2073 686f 7274 6e61 6d65 2c20  d or shortname, 
+0005d110: 6120 5374 7275 6374 7572 6520 6d61 7070  a Structure mapp
+0005d120: 6572 2072 6570 7265 7365 6e74 7320 6120  er represents a 
+0005d130: 6869 6572 6172 6368 7920 7472 6565 2e20  hierarchy tree. 
+0005d140: 4c69 7374 2063 616e 2062 6520 6569 7468  List can be eith
+0005d150: 6572 2061 206c 6973 7420 6f66 2073 7472  er a list of str
+0005d160: 696e 6773 206f 7220 436f 6e73 7461 6e74  ings or Constant
+0005d170: 730d 0a20 2020 2020 2020 203a 7061 7261  s..        :para
+0005d180: 6d20 6469 6d65 6e73 696f 6e5f 373a 2073  m dimension_7: s
+0005d190: 7472 696e 672c 206c 6973 742c 2070 796d  tring, list, pym
+0005d1a0: 7078 2e45 6c65 6d65 6e74 2c20 7079 6d70  px.Element, pymp
+0005d1b0: 782e 436f 6e73 7461 6e74 206f 7220 7079  x.Constant or py
+0005d1c0: 6d70 782e 5374 7275 6374 7572 654d 6170  mpx.StructureMap
+0005d1d0: 7065 722e 2053 7472 696e 6720 7265 7072  per. String repr
+0005d1e0: 6573 656e 7473 2061 2063 6f6c 756d 6e20  esents a column 
+0005d1f0: 6e61 6d65 2c20 6120 436f 6e73 7461 6e74  name, a Constant
+0005d200: 2063 616e 2062 6520 6569 7468 6572 2061   can be either a
+0005d210: 2070 6879 7369 6420 6f72 2073 686f 7274   physid or short
+0005d220: 6e61 6d65 2c20 6120 5374 7275 6374 7572  name, a Structur
+0005d230: 6520 6d61 7070 6572 2072 6570 7265 7365  e mapper represe
+0005d240: 6e74 7320 6120 6869 6572 6172 6368 7920  nts a hierarchy 
+0005d250: 7472 6565 2e20 4c69 7374 2063 616e 2062  tree. List can b
+0005d260: 6520 6569 7468 6572 2061 206c 6973 7420  e either a list 
+0005d270: 6f66 2073 7472 696e 6773 206f 7220 436f  of strings or Co
+0005d280: 6e73 7461 6e74 730d 0a20 2020 2020 2020  nstants..       
+0005d290: 203a 7061 7261 6d20 6d6f 6465 3a20 7374   :param mode: st
+0005d2a0: 7269 6e67 2c20 6c69 7374 2c20 7079 6d70  ring, list, pymp
+0005d2b0: 782e 456c 656d 656e 742c 206f 7220 7079  x.Element, or py
+0005d2c0: 6d70 782e 436f 6e73 7461 6e74 0d0a 2020  mpx.Constant..  
+0005d2d0: 2020 2020 2020 3a70 6172 616d 2062 6173        :param bas
+0005d2e0: 653a 2073 7472 696e 672c 206c 6973 742c  e: string, list,
+0005d2f0: 2070 796d 7078 2e45 6c65 6d65 6e74 2c20   pympx.Element, 
+0005d300: 6f72 2070 796d 7078 2e43 6f6e 7374 616e  or pympx.Constan
+0005d310: 740d 0a20 2020 2020 2020 203a 7061 7261  t..        :para
+0005d320: 6d20 7469 6d65 3a20 7374 7269 6e67 2c20  m time: string, 
+0005d330: 6c69 7374 2c20 7079 6d70 782e 456c 656d  list, pympx.Elem
+0005d340: 656e 742c 206f 7220 7079 6d70 782e 436f  ent, or pympx.Co
+0005d350: 6e73 7461 6e74 0d0a 2020 2020 2020 2020  nstant..        
+0005d360: 3a70 6172 616d 206d 6574 7269 633a 2045  :param metric: E
+0005d370: 6974 6865 7220 6120 7374 7269 6e67 206e  ither a string n
+0005d380: 616d 696e 6720 7468 6520 6d65 7472 6963  aming the metric
+0005d390: 2063 6f6c 756d 6e20 7768 6963 6820 7368   column which sh
+0005d3a0: 6f75 6c64 2063 6f6e 7461 696e 206d 6574  ould contain met
+0005d3b0: 7269 6320 7368 6f72 746e 616d 6573 206f  ric shortnames o
+0005d3c0: 7220 7068 7973 6964 732c 206f 7220 6120  r physids, or a 
+0005d3d0: 6469 6374 696f 6e61 7279 206f 6620 636f  dictionary of co
+0005d3e0: 6c75 6d6e 206e 616d 6573 2074 6f20 6d65  lumn names to me
+0005d3f0: 7472 6963 2073 686f 7274 6e61 6d65 730d  tric shortnames.
+0005d400: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0005d410: 7661 6c75 653a 2057 6865 6e20 7573 696e  value: When usin
+0005d420: 6720 6120 6d65 7472 6963 2063 6f6c 756d  g a metric colum
+0005d430: 6e20 636f 6e74 6169 6e69 6e67 206d 6574  n containing met
+0005d440: 7269 6320 2869 6e64 6963 6174 6f72 2920  ric (indicator) 
+0005d450: 7368 6f72 7463 6f64 6520 6f72 2070 6879  shortcode or phy
+0005d460: 7369 6473 2c20 7468 656e 2070 7574 2074  sids, then put t
+0005d470: 6865 2076 616c 7565 7320 696e 2068 6572  he values in her
+0005d480: 652e 2049 6620 6d65 7472 6963 7320 6172  e. If metrics ar
+0005d490: 6520 696e 2064 6966 6665 7265 6e74 2063  e in different c
+0005d4a0: 6f6c 756d 6e73 206c 6561 7665 2074 6869  olumns leave thi
+0005d4b0: 7320 7061 7261 6d65 7465 7220 6173 204e  s parameter as N
+0005d4c0: 6f6e 650d 0a20 2020 2020 2020 203a 7061  one..        :pa
+0005d4d0: 7261 6d20 6967 6e6f 7265 5f7a 6572 6f5f  ram ignore_zero_
+0005d4e0: 7661 6c75 6573 3a20 5573 7561 6c6c 7920  values: Usually 
+0005d4f0: 7765 2064 6f20 6e6f 7420 7769 7368 2074  we do not wish t
+0005d500: 6f20 6c6f 6164 207a 6572 6f20 7661 6c75  o load zero valu
+0005d510: 6573 2069 6e74 6f20 456d 706f 7765 7220  es into Empower 
+0005d520: 696e 206f 7264 6572 2074 6f20 7361 7665  in order to save
+0005d530: 2074 696d 6520 616e 6420 7370 6163 652c   time and space,
+0005d540: 2073 696e 6365 206d 6f73 7420 456d 706f   since most Empo
+0005d550: 7765 7220 6375 6265 2069 6d70 6c65 6d65  wer cube impleme
+0005d560: 6e74 6174 696f 6e73 2064 6973 706c 6179  ntations display
+0005d570: 204e 2f41 7320 6173 207a 6572 6f20 616e   N/As as zero an
+0005d580: 7977 6179 0d0a 2020 2020 2020 2020 2727  yway..        ''
+0005d590: 270d 0a0d 0a20 2020 2020 2020 2073 656c  '....        sel
+0005d5a0: 662e 6578 706c 6f64 6528 6469 6d65 6e73  f.explode(dimens
+0005d5b0: 696f 6e5f 3020 3d20 6469 6d65 6e73 696f  ion_0 = dimensio
+0005d5c0: 6e5f 300d 0a20 2020 2020 2020 2020 2020  n_0..           
+0005d5d0: 2020 2020 2020 2020 2c64 696d 656e 7369          ,dimensi
+0005d5e0: 6f6e 5f31 203d 2064 696d 656e 7369 6f6e  on_1 = dimension
+0005d5f0: 5f31 0d0a 2020 2020 2020 2020 2020 2020  _1..            
+0005d600: 2020 2020 2020 202c 6469 6d65 6e73 696f         ,dimensio
+0005d610: 6e5f 3220 3d20 6469 6d65 6e73 696f 6e5f  n_2 = dimension_
+0005d620: 320d 0a20 2020 2020 2020 2020 2020 2020  2..             
+0005d630: 2020 2020 2020 2c64 696d 656e 7369 6f6e        ,dimension
+0005d640: 5f33 203d 2064 696d 656e 7369 6f6e 5f33  _3 = dimension_3
+0005d650: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005d660: 2020 2020 202c 6469 6d65 6e73 696f 6e5f       ,dimension_
+0005d670: 3420 3d20 6469 6d65 6e73 696f 6e5f 340d  4 = dimension_4.
+0005d680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005d690: 2020 2020 2c64 696d 656e 7369 6f6e 5f35      ,dimension_5
+0005d6a0: 203d 2064 696d 656e 7369 6f6e 5f35 0d0a   = dimension_5..
+0005d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d6c0: 2020 202c 6469 6d65 6e73 696f 6e5f 3620     ,dimension_6 
+0005d6d0: 3d20 6469 6d65 6e73 696f 6e5f 360d 0a20  = dimension_6.. 
+0005d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d6f0: 2020 2c64 696d 656e 7369 6f6e 5f37 203d    ,dimension_7 =
+0005d700: 2064 696d 656e 7369 6f6e 5f37 0d0a 2020   dimension_7..  
+0005d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d720: 202c 6d6f 6465 2020 2020 2020 2020 3d20   ,mode        = 
+0005d730: 6d6f 6465 0d0a 2020 2020 2020 2020 2020  mode..          
+0005d740: 2020 2020 2020 2020 202c 6261 7365 2020           ,base  
+0005d750: 2020 2020 2020 3d20 6261 7365 0d0a 2020        = base..  
+0005d760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005d770: 202c 7469 6d65 2020 2020 2020 2020 3d20   ,time        = 
+0005d780: 7469 6d65 0d0a 2020 2020 2020 2020 2020  time..          
+0005d790: 2020 2020 2020 2020 202c 6d65 7472 6963           ,metric
+0005d7a0: 2020 2020 2020 3d20 6d65 7472 6963 0d0a        = metric..
 0005d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005d7c0: 2020 2c73 7562 6c6f 6164 5f6e 616d 653d    ,subload_name=
-0005d7d0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-0005d7e0: 2020 2020 2020 2020 2020 2c65 6d70 6f77            ,empow
-0005d7f0: 6572 5f70 6572 696f 645f 7479 7065 2020  er_period_type  
-0005d800: 203d 2065 6d70 6f77 6572 5f70 6572 696f   = empower_perio
-0005d810: 645f 7479 7065 0d0a 2020 2020 2020 2020  d_type..        
-0005d820: 2020 2020 2020 2020 2020 202c 6967 6e6f             ,igno
-0005d830: 7265 5f7a 6572 6f5f 7661 6c75 6573 2020  re_zero_values  
-0005d840: 2020 3d20 6967 6e6f 7265 5f7a 6572 6f5f    = ignore_zero_
-0005d850: 7661 6c75 6573 0d0a 2020 2020 2020 2020  values..        
-0005d860: 2020 2020 2020 2020 2020 2029 0d0a 0d0a             )....
-0005d870: 2020 2020 2020 2020 7365 6c66 2e73 6861          self.sha
-0005d880: 7264 2829 0d0a 0d0a 2020 2020 2020 2020  rd()....        
-0005d890: 7365 6c66 2e6c 6f61 645f 7368 6172 6473  self.load_shards
-0005d8a0: 2829 0d0a 0d0a 2020 2020 6465 6620 7374  ()....    def st
-0005d8b0: 6172 745f 7368 6172 6465 7228 7365 6c66  art_sharder(self
-0005d8c0: 293a 0d0a 0d0a 2020 2020 2020 2020 2343  ):....        #C
-0005d8d0: 7265 6174 6520 7468 6520 7175 6575 650d  reate the queue.
-0005d8e0: 0a20 2020 2020 2020 206c 6f67 2e76 6572  .        log.ver
-0005d8f0: 626f 7365 2827 5368 6172 6469 6e67 2066  bose('Sharding f
-0005d900: 696c 6573 206f 6e20 7175 6575 6527 290d  iles on queue').
-0005d910: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-0005d920: 7368 6172 6469 6e67 5f71 7565 7565 203d  sharding_queue =
-0005d930: 206d 7071 2e50 6572 7369 7374 656e 7451   mpq.PersistentQ
-0005d940: 7565 7565 2870 6963 6b75 705f 6669 6c65  ueue(pickup_file
-0005d950: 5f70 7265 6669 783d 2753 6861 7264 696e  _prefix='Shardin
-0005d960: 6720 5175 6575 6527 290d 0a0d 0a20 2020  g Queue')....   
-0005d970: 2020 2020 2023 5374 6172 7420 7468 6520       #Start the 
-0005d980: 6d65 7373 6167 6520 7369 6e6b 0d0a 2020  message sink..  
-0005d990: 2020 2020 2020 7365 6c66 2e73 6861 7264        self.shard
-0005d9a0: 6572 3d6d 756c 7469 7072 6f63 6573 7369  er=multiprocessi
-0005d9b0: 6e67 2e50 726f 6365 7373 2874 6172 6765  ng.Process(targe
-0005d9c0: 743d 6c6c 752e 6d73 6773 696e 6b5f 5f73  t=llu.msgsink__s
-0005d9d0: 6861 7264 5f66 696c 6573 5f62 795f 7374  hard_files_by_st
-0005d9e0: 6f72 6167 655f 6469 6d0d 0a20 2020 2020  orage_dim..     
-0005d9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005da00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005da10: 2020 2c6b 7761 7267 733d 7b27 7374 6f72    ,kwargs={'stor
-0005da20: 6167 655f 6469 6d65 6e73 696f 6e5f 696e  age_dimension_in
-0005da30: 6465 7827 3a73 656c 662e 7369 7465 2e73  dex':self.site.s
-0005da40: 746f 7261 6765 5f64 696d 656e 7369 6f6e  torage_dimension
-0005da50: 5f69 6e64 6578 0d0a 2020 2020 2020 2020  _index..        
-0005da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005da80: 2020 2020 2020 202c 276c 6f61 645f 7072         ,'load_pr
-0005da90: 6f63 6573 7369 6e67 5f64 6972 273a 7365  ocessing_dir':se
-0005daa0: 6c66 2e73 6974 652e 5f6c 6f61 645f 7072  lf.site._load_pr
-0005dab0: 6f63 6573 7369 6e67 5f64 6972 0d0a 2020  ocessing_dir..  
-0005dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dae0: 2020 2020 2020 2020 2020 2020 202c 2766               ,'f
-0005daf0: 696c 655f 6d61 736b 273a 272a 2e74 7376  ile_mask':'*.tsv
-0005db00: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
-0005db10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005db20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005db30: 2020 2c27 7368 6172 645f 7072 6566 6978    ,'shard_prefix
-0005db40: 273a 2753 6861 7264 5f27 0d0a 2020 2020  ':'Shard_'..    
-0005db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005db70: 2020 2020 2020 2020 2020 202c 276e 756d             ,'num
-0005db80: 6265 725f 6f66 5f73 746f 7261 6765 5f65  ber_of_storage_e
-0005db90: 6c65 6d65 6e74 735f 7065 725f 656d 706f  lements_per_empo
-0005dba0: 7765 725f 6461 7461 5f66 696c 6527 3a73  wer_data_file':s
-0005dbb0: 656c 662e 7369 7465 2e65 6c65 6d65 6e74  elf.site.element
-0005dbc0: 735f 7065 725f 7374 6f72 6167 655f 6469  s_per_storage_di
-0005dbd0: 6d65 6e73 696f 6e0d 0a20 2020 2020 2020  mension..       
-0005dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dc00: 2020 2020 2020 2020 2c27 7365 7061 7261          ,'separa
-0005dc10: 746f 7227 3a27 5c74 270d 0a20 2020 2020  tor':'\t'..     
+0005d7c0: 2020 2023 2c76 616c 7565 2020 2020 2020     #,value      
+0005d7d0: 2020 203d 204e 6f6e 650d 0a20 2020 2020     = None..     
+0005d7e0: 2020 2020 2020 2020 2020 2020 2020 2c73                ,s
+0005d7f0: 7562 6c6f 6164 5f6e 616d 653d 204e 6f6e  ubload_name= Non
+0005d800: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0005d810: 2020 2020 2020 2c65 6d70 6f77 6572 5f70        ,empower_p
+0005d820: 6572 696f 645f 7479 7065 2020 203d 2065  eriod_type   = e
+0005d830: 6d70 6f77 6572 5f70 6572 696f 645f 7479  mpower_period_ty
+0005d840: 7065 0d0a 2020 2020 2020 2020 2020 2020  pe..            
+0005d850: 2020 2020 2020 202c 6967 6e6f 7265 5f7a         ,ignore_z
+0005d860: 6572 6f5f 7661 6c75 6573 2020 2020 3d20  ero_values    = 
+0005d870: 6967 6e6f 7265 5f7a 6572 6f5f 7661 6c75  ignore_zero_valu
+0005d880: 6573 0d0a 2020 2020 2020 2020 2020 2020  es..            
+0005d890: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
+0005d8a0: 2020 2020 7365 6c66 2e73 6861 7264 2829      self.shard()
+0005d8b0: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+0005d8c0: 2e6c 6f61 645f 7368 6172 6473 2829 0d0a  .load_shards()..
+0005d8d0: 0d0a 2020 2020 6465 6620 7374 6172 745f  ..    def start_
+0005d8e0: 7368 6172 6465 7228 7365 6c66 293a 0d0a  sharder(self):..
+0005d8f0: 0d0a 2020 2020 2020 2020 2343 7265 6174  ..        #Creat
+0005d900: 6520 7468 6520 7175 6575 650d 0a20 2020  e the queue..   
+0005d910: 2020 2020 206c 6f67 2e76 6572 626f 7365       log.verbose
+0005d920: 2827 5368 6172 6469 6e67 2066 696c 6573  ('Sharding files
+0005d930: 206f 6e20 7175 6575 6527 290d 0a0d 0a20   on queue').... 
+0005d940: 2020 2020 2020 2073 656c 662e 7368 6172         self.shar
+0005d950: 6469 6e67 5f71 7565 7565 203d 206d 7071  ding_queue = mpq
+0005d960: 2e50 6572 7369 7374 656e 7451 7565 7565  .PersistentQueue
+0005d970: 2870 6963 6b75 705f 6669 6c65 5f70 7265  (pickup_file_pre
+0005d980: 6669 783d 2753 6861 7264 696e 6720 5175  fix='Sharding Qu
+0005d990: 6575 6527 290d 0a0d 0a20 2020 2020 2020  eue')....       
+0005d9a0: 2023 5374 6172 7420 7468 6520 6d65 7373   #Start the mess
+0005d9b0: 6167 6520 7369 6e6b 0d0a 2020 2020 2020  age sink..      
+0005d9c0: 2020 7365 6c66 2e73 6861 7264 6572 3d6d    self.sharder=m
+0005d9d0: 756c 7469 7072 6f63 6573 7369 6e67 2e50  ultiprocessing.P
+0005d9e0: 726f 6365 7373 2874 6172 6765 743d 6c6c  rocess(target=ll
+0005d9f0: 752e 6d73 6773 696e 6b5f 5f73 6861 7264  u.msgsink__shard
+0005da00: 5f66 696c 6573 5f62 795f 7374 6f72 6167  _files_by_storag
+0005da10: 655f 6469 6d0d 0a20 2020 2020 2020 2020  e_dim..         
+0005da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005da30: 2020 2020 2020 2020 2020 2020 2020 2c6b                ,k
+0005da40: 7761 7267 733d 7b27 7374 6f72 6167 655f  wargs={'storage_
+0005da50: 6469 6d65 6e73 696f 6e5f 696e 6465 7827  dimension_index'
+0005da60: 3a73 656c 662e 7369 7465 2e73 746f 7261  :self.site.stora
+0005da70: 6765 5f64 696d 656e 7369 6f6e 5f69 6e64  ge_dimension_ind
+0005da80: 6578 0d0a 2020 2020 2020 2020 2020 2020  ex..            
+0005da90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dab0: 2020 202c 276c 6f61 645f 7072 6f63 6573     ,'load_proces
+0005dac0: 7369 6e67 5f64 6972 273a 7365 6c66 2e73  sing_dir':self.s
+0005dad0: 6974 652e 5f6c 6f61 645f 7072 6f63 6573  ite._load_proces
+0005dae0: 7369 6e67 5f64 6972 0d0a 2020 2020 2020  sing_dir..      
+0005daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005db10: 2020 2020 2020 2020 202c 2766 696c 655f           ,'file_
+0005db20: 6d61 736b 273a 272a 2e74 7376 270d 0a20  mask':'*.tsv'.. 
+0005db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005db40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005db50: 2020 2020 2020 2020 2020 2020 2020 2c27                ,'
+0005db60: 7368 6172 645f 7072 6566 6978 273a 2753  shard_prefix':'S
+0005db70: 6861 7264 5f27 0d0a 2020 2020 2020 2020  hard_'..        
+0005db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005db90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dba0: 2020 2020 2020 202c 276e 756d 6265 725f         ,'number_
+0005dbb0: 6f66 5f73 746f 7261 6765 5f65 6c65 6d65  of_storage_eleme
+0005dbc0: 6e74 735f 7065 725f 656d 706f 7765 725f  nts_per_empower_
+0005dbd0: 6461 7461 5f66 696c 6527 3a73 656c 662e  data_file':self.
+0005dbe0: 7369 7465 2e65 6c65 6d65 6e74 735f 7065  site.elements_pe
+0005dbf0: 725f 7374 6f72 6167 655f 6469 6d65 6e73  r_storage_dimens
+0005dc00: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
+0005dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dc40: 2020 2020 2020 2020 2020 2c27 7369 7465            ,'site
-0005dc50: 5f65 7870 6c6f 6465 645f 7175 6575 6527  _exploded_queue'
-0005dc60: 3a73 656c 662e 7368 6172 6469 6e67 5f71  :self.sharding_q
-0005dc70: 7565 7565 0d0a 2020 2020 2020 2020 2020  ueue..          
-0005dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dca0: 2020 2020 202c 2773 6974 655f 7368 6172       ,'site_shar
-0005dcb0: 6465 645f 7175 6575 6527 3a4e 6f6e 650d  ded_queue':None.
-0005dcc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dcf0: 2c27 656d 706f 7765 725f 696d 706f 7274  ,'empower_import
-0005dd00: 6572 5f65 7865 6375 7461 626c 6527 3a73  er_executable':s
-0005dd10: 656c 662e 656d 706f 7765 725f 696d 706f  elf.empower_impo
-0005dd20: 7274 6572 5f65 7865 6375 7461 626c 650d  rter_executable.
-0005dd30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005dd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dd60: 2c27 6c6f 6767 696e 675f 7175 6575 6527  ,'logging_queue'
-0005dd70: 3a73 656c 662e 7369 7465 2e6c 6f67 6769  :self.site.loggi
-0005dd80: 6e67 5f71 7565 7565 0d0a 2020 2020 2020  ng_queue..      
-0005dd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005ddb0: 2020 2020 2020 2020 207d 0d0a 2020 2020           }..    
+0005dc30: 2020 2020 2c27 7365 7061 7261 746f 7227      ,'separator'
+0005dc40: 3a27 5c74 270d 0a20 2020 2020 2020 2020  :'\t'..         
+0005dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dc70: 2020 2020 2020 2c27 7369 7465 5f65 7870        ,'site_exp
+0005dc80: 6c6f 6465 645f 7175 6575 6527 3a73 656c  loded_queue':sel
+0005dc90: 662e 7368 6172 6469 6e67 5f71 7565 7565  f.sharding_queue
+0005dca0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dcd0: 202c 2773 6974 655f 7368 6172 6465 645f   ,'site_sharded_
+0005dce0: 7175 6575 6527 3a4e 6f6e 650d 0a20 2020  queue':None..   
+0005dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dd10: 2020 2020 2020 2020 2020 2020 2c27 656d              ,'em
+0005dd20: 706f 7765 725f 696d 706f 7274 6572 5f65  power_importer_e
+0005dd30: 7865 6375 7461 626c 6527 3a73 656c 662e  xecutable':self.
+0005dd40: 656d 706f 7765 725f 696d 706f 7274 6572  empower_importer
+0005dd50: 5f65 7865 6375 7461 626c 650d 0a20 2020  _executable..   
+0005dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005dd80: 2020 2020 2020 2020 2020 2020 2c27 6c6f              ,'lo
+0005dd90: 6767 696e 675f 7175 6575 6527 3a73 656c  gging_queue':sel
+0005dda0: 662e 7369 7465 2e6c 6f67 6769 6e67 5f71  f.site.logging_q
+0005ddb0: 7565 7565 0d0a 2020 2020 2020 2020 2020  ueue..          
 0005ddc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005ddd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005dde0: 2020 202c 6e61 6d65 3d27 5368 6172 6420     ,name='Shard 
-0005ddf0: 4669 6c65 7327 290d 0a0d 0a0d 0a20 2020  Files')......   
-0005de00: 2020 2020 2023 5374 6172 7420 7468 6520       #Start the 
-0005de10: 2873 696e 676c 6520 7468 7265 6164 6564  (single threaded
-0005de20: 2920 7368 6172 6465 7220 696e 2069 7427  ) sharder in it'
-0005de30: 7320 6f77 6e20 7468 7265 6164 0d0a 2020  s own thread..  
-0005de40: 2020 2020 2020 2369 7420 7769 6c6c 2077        #it will w
-0005de50: 6169 7420 666f 7220 6578 706c 6f64 6564  ait for exploded
-0005de60: 2066 696c 6573 2061 6e64 2073 7461 7274   files and start
-0005de70: 2073 6861 7264 696e 6720 7468 656d 0d0a   sharding them..
-0005de80: 2020 2020 2020 2020 7365 6c66 2e73 6861          self.sha
-0005de90: 7264 6572 2e73 7461 7274 2829 0d0a 0d0a  rder.start()....
-0005dea0: 0d0a 2020 2020 6465 6620 6578 706c 6f64  ..    def explod
-0005deb0: 6528 7365 6c66 0d0a 2020 2020 2020 2020  e(self..        
-0005dec0: 2020 2020 2020 202c 6469 6d65 6e73 696f         ,dimensio
-0005ded0: 6e5f 3020 2020 2020 2020 2020 3d20 4e6f  n_0         = No
-0005dee0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0005def0: 2020 202c 6469 6d65 6e73 696f 6e5f 3120     ,dimension_1 
+0005dde0: 2020 2020 207d 0d0a 2020 2020 2020 2020       }..        
+0005ddf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005de00: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0005de10: 6e61 6d65 3d27 5368 6172 6420 4669 6c65  name='Shard File
+0005de20: 7327 290d 0a0d 0a0d 0a20 2020 2020 2020  s')......       
+0005de30: 2023 5374 6172 7420 7468 6520 2873 696e   #Start the (sin
+0005de40: 676c 6520 7468 7265 6164 6564 2920 7368  gle threaded) sh
+0005de50: 6172 6465 7220 696e 2069 7427 7320 6f77  arder in it's ow
+0005de60: 6e20 7468 7265 6164 0d0a 2020 2020 2020  n thread..      
+0005de70: 2020 2369 7420 7769 6c6c 2077 6169 7420    #it will wait 
+0005de80: 666f 7220 6578 706c 6f64 6564 2066 696c  for exploded fil
+0005de90: 6573 2061 6e64 2073 7461 7274 2073 6861  es and start sha
+0005dea0: 7264 696e 6720 7468 656d 0d0a 2020 2020  rding them..    
+0005deb0: 2020 2020 7365 6c66 2e73 6861 7264 6572      self.sharder
+0005dec0: 2e73 7461 7274 2829 0d0a 0d0a 0d0a 2020  .start()......  
+0005ded0: 2020 6465 6620 6578 706c 6f64 6528 7365    def explode(se
+0005dee0: 6c66 0d0a 2020 2020 2020 2020 2020 2020  lf..            
+0005def0: 2020 202c 6469 6d65 6e73 696f 6e5f 3020     ,dimension_0 
 0005df00: 2020 2020 2020 2020 3d20 4e6f 6e65 0d0a          = None..
 0005df10: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-0005df20: 6469 6d65 6e73 696f 6e5f 3220 2020 2020  dimension_2     
+0005df20: 6469 6d65 6e73 696f 6e5f 3120 2020 2020  dimension_1     
 0005df30: 2020 2020 3d20 4e6f 6e65 0d0a 2020 2020      = None..    
 0005df40: 2020 2020 2020 2020 2020 202c 6469 6d65             ,dime
-0005df50: 6e73 696f 6e5f 3320 2020 2020 2020 2020  nsion_3         
+0005df50: 6e73 696f 6e5f 3220 2020 2020 2020 2020  nsion_2         
 0005df60: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
 0005df70: 2020 2020 2020 202c 6469 6d65 6e73 696f         ,dimensio
-0005df80: 6e5f 3420 2020 2020 2020 2020 3d20 4e6f  n_4         = No
+0005df80: 6e5f 3320 2020 2020 2020 2020 3d20 4e6f  n_3         = No
 0005df90: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0005dfa0: 2020 202c 6469 6d65 6e73 696f 6e5f 3520     ,dimension_5 
+0005dfa0: 2020 202c 6469 6d65 6e73 696f 6e5f 3420     ,dimension_4 
 0005dfb0: 2020 2020 2020 2020 3d20 4e6f 6e65 0d0a          = None..
 0005dfc0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-0005dfd0: 6469 6d65 6e73 696f 6e5f 3620 2020 2020  dimension_6     
+0005dfd0: 6469 6d65 6e73 696f 6e5f 3520 2020 2020  dimension_5     
 0005dfe0: 2020 2020 3d20 4e6f 6e65 0d0a 2020 2020      = None..    
 0005dff0: 2020 2020 2020 2020 2020 202c 6469 6d65             ,dime
-0005e000: 6e73 696f 6e5f 3720 2020 2020 2020 2020  nsion_7         
+0005e000: 6e73 696f 6e5f 3620 2020 2020 2020 2020  nsion_6         
 0005e010: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-0005e020: 2020 2020 2020 202c 6d6f 6465 2020 2020         ,mode    
-0005e030: 2020 2020 2020 2020 2020 2020 3d20 4e6f              = No
+0005e020: 2020 2020 2020 202c 6469 6d65 6e73 696f         ,dimensio
+0005e030: 6e5f 3720 2020 2020 2020 2020 3d20 4e6f  n_7         = No
 0005e040: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0005e050: 2020 202c 6261 7365 2020 2020 2020 2020     ,base        
+0005e050: 2020 202c 6d6f 6465 2020 2020 2020 2020     ,mode        
 0005e060: 2020 2020 2020 2020 3d20 4e6f 6e65 0d0a          = None..
 0005e070: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-0005e080: 7469 6d65 2020 2020 2020 2020 2020 2020  time            
+0005e080: 6261 7365 2020 2020 2020 2020 2020 2020  base            
 0005e090: 2020 2020 3d20 4e6f 6e65 0d0a 2020 2020      = None..    
-0005e0a0: 2020 2020 2020 2020 2020 202c 6d65 7472             ,metr
-0005e0b0: 6963 2020 2020 2020 2020 2020 2020 2020  ic              
+0005e0a0: 2020 2020 2020 2020 2020 202c 7469 6d65             ,time
+0005e0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0005e0c0: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-0005e0d0: 2020 2020 2020 202c 7661 6c75 655f 636f         ,value_co
-0005e0e0: 6c75 6d6e 2020 2020 2020 2020 3d20 4e6f  lumn        = No
+0005e0d0: 2020 2020 2020 202c 6d65 7472 6963 2020         ,metric  
+0005e0e0: 2020 2020 2020 2020 2020 2020 3d20 4e6f              = No
 0005e0f0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-0005e100: 2020 202c 7375 626c 6f61 645f 6e61 6d65     ,subload_name
+0005e100: 2020 202c 7661 6c75 655f 636f 6c75 6d6e     ,value_column
 0005e110: 2020 2020 2020 2020 3d20 4e6f 6e65 0d0a          = None..
 0005e120: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-0005e130: 656d 706f 7765 725f 7065 7269 6f64 5f74  empower_period_t
-0005e140: 7970 6520 3d20 4e6f 6e65 0d0a 2020 2020  ype = None..    
-0005e150: 2020 2020 2020 2020 2020 202c 736f 7572             ,sour
-0005e160: 6365 5f64 6174 6166 7261 6d65 2020 2020  ce_dataframe    
+0005e130: 7375 626c 6f61 645f 6e61 6d65 2020 2020  subload_name    
+0005e140: 2020 2020 3d20 4e6f 6e65 0d0a 2020 2020      = None..    
+0005e150: 2020 2020 2020 2020 2020 202c 656d 706f             ,empo
+0005e160: 7765 725f 7065 7269 6f64 5f74 7970 6520  wer_period_type 
 0005e170: 3d20 4e6f 6e65 0d0a 2020 2020 2020 2020  = None..        
-0005e180: 2020 2020 2020 202c 6967 6e6f 7265 5f7a         ,ignore_z
-0005e190: 6572 6f5f 7661 6c75 6573 2020 3d20 5472  ero_values  = Tr
-0005e1a0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
-0005e1b0: 2020 2029 3a0d 0a20 2020 2020 2020 2027     ):..        '
-0005e1c0: 2727 4578 706c 6f64 6520 6461 7461 2062  ''Explode data b
-0005e1d0: 7920 7468 6520 6469 6d65 6e73 696f 6e20  y the dimension 
-0005e1e0: 6578 7061 6e73 696f 6e73 2067 6976 656e  expansions given
-0005e1f0: 2c20 616e 6420 7072 6570 6172 6520 666f  , and prepare fo
-0005e200: 7220 6465 6c74 6120 6275 6c6b 206c 6f61  r delta bulk loa
-0005e210: 6469 6e67 0d0a 0d0a 2020 2020 2020 2020  ding....        
-0005e220: 3a70 6172 616d 2064 696d 656e 7369 6f6e  :param dimension
-0005e230: 5f30 3a20 7374 7269 6e67 2c20 6c69 7374  _0: string, list
-0005e240: 2c20 7079 6d70 782e 456c 656d 656e 742c  , pympx.Element,
-0005e250: 2070 796d 7078 2e43 6f6e 7374 616e 7420   pympx.Constant 
-0005e260: 6f72 2070 796d 7078 2e53 7472 7563 7475  or pympx.Structu
-0005e270: 7265 4d61 7070 6572 2e20 5374 7269 6e67  reMapper. String
-0005e280: 2072 6570 7265 7365 6e74 7320 6120 636f   represents a co
-0005e290: 6c75 6d6e 206e 616d 652c 2061 2043 6f6e  lumn name, a Con
-0005e2a0: 7374 616e 7420 6361 6e20 6265 2065 6974  stant can be eit
-0005e2b0: 6865 7220 6120 7068 7973 6964 206f 7220  her a physid or 
-0005e2c0: 7368 6f72 746e 616d 652c 2061 2053 7472  shortname, a Str
-0005e2d0: 7563 7475 7265 206d 6170 7065 7220 7265  ucture mapper re
-0005e2e0: 7072 6573 656e 7473 2061 2068 6965 7261  presents a hiera
-0005e2f0: 7263 6879 2074 7265 652e 204c 6973 7420  rchy tree. List 
-0005e300: 6361 6e20 6265 2065 6974 6865 7220 6120  can be either a 
-0005e310: 6c69 7374 206f 6620 7374 7269 6e67 7320  list of strings 
-0005e320: 6f72 2043 6f6e 7374 616e 7473 0d0a 2020  or Constants..  
-0005e330: 2020 2020 2020 3a70 6172 616d 2064 696d        :param dim
-0005e340: 656e 7369 6f6e 5f31 3a20 7374 7269 6e67  ension_1: string
-0005e350: 2c20 6c69 7374 2c20 7079 6d70 782e 456c  , list, pympx.El
-0005e360: 656d 656e 742c 2070 796d 7078 2e43 6f6e  ement, pympx.Con
-0005e370: 7374 616e 7420 6f72 2070 796d 7078 2e53  stant or pympx.S
-0005e380: 7472 7563 7475 7265 4d61 7070 6572 2e20  tructureMapper. 
-0005e390: 5374 7269 6e67 2072 6570 7265 7365 6e74  String represent
-0005e3a0: 7320 6120 636f 6c75 6d6e 206e 616d 652c  s a column name,
-0005e3b0: 2061 2043 6f6e 7374 616e 7420 6361 6e20   a Constant can 
-0005e3c0: 6265 2065 6974 6865 7220 6120 7068 7973  be either a phys
-0005e3d0: 6964 206f 7220 7368 6f72 746e 616d 652c  id or shortname,
-0005e3e0: 2061 2053 7472 7563 7475 7265 206d 6170   a Structure map
-0005e3f0: 7065 7220 7265 7072 6573 656e 7473 2061  per represents a
-0005e400: 2068 6965 7261 7263 6879 2074 7265 652e   hierarchy tree.
-0005e410: 204c 6973 7420 6361 6e20 6265 2065 6974   List can be eit
-0005e420: 6865 7220 6120 6c69 7374 206f 6620 7374  her a list of st
-0005e430: 7269 6e67 7320 6f72 2043 6f6e 7374 616e  rings or Constan
-0005e440: 7473 0d0a 2020 2020 2020 2020 3a70 6172  ts..        :par
-0005e450: 616d 2064 696d 656e 7369 6f6e 5f32 3a20  am dimension_2: 
-0005e460: 7374 7269 6e67 2c20 6c69 7374 2c20 7079  string, list, py
-0005e470: 6d70 782e 456c 656d 656e 742c 2070 796d  mpx.Element, pym
-0005e480: 7078 2e43 6f6e 7374 616e 7420 6f72 2070  px.Constant or p
-0005e490: 796d 7078 2e53 7472 7563 7475 7265 4d61  ympx.StructureMa
-0005e4a0: 7070 6572 2e20 5374 7269 6e67 2072 6570  pper. String rep
-0005e4b0: 7265 7365 6e74 7320 6120 636f 6c75 6d6e  resents a column
-0005e4c0: 206e 616d 652c 2061 2043 6f6e 7374 616e   name, a Constan
-0005e4d0: 7420 6361 6e20 6265 2065 6974 6865 7220  t can be either 
-0005e4e0: 6120 7068 7973 6964 206f 7220 7368 6f72  a physid or shor
-0005e4f0: 746e 616d 652c 2061 2053 7472 7563 7475  tname, a Structu
-0005e500: 7265 206d 6170 7065 7220 7265 7072 6573  re mapper repres
-0005e510: 656e 7473 2061 2068 6965 7261 7263 6879  ents a hierarchy
-0005e520: 2074 7265 652e 204c 6973 7420 6361 6e20   tree. List can 
-0005e530: 6265 2065 6974 6865 7220 6120 6c69 7374  be either a list
-0005e540: 206f 6620 7374 7269 6e67 7320 6f72 2043   of strings or C
-0005e550: 6f6e 7374 616e 7473 0d0a 2020 2020 2020  onstants..      
-0005e560: 2020 3a70 6172 616d 2064 696d 656e 7369    :param dimensi
-0005e570: 6f6e 5f33 3a20 7374 7269 6e67 2c20 6c69  on_3: string, li
-0005e580: 7374 2c20 7079 6d70 782e 456c 656d 656e  st, pympx.Elemen
-0005e590: 742c 2070 796d 7078 2e43 6f6e 7374 616e  t, pympx.Constan
-0005e5a0: 7420 6f72 2070 796d 7078 2e53 7472 7563  t or pympx.Struc
-0005e5b0: 7475 7265 4d61 7070 6572 2e20 5374 7269  tureMapper. Stri
-0005e5c0: 6e67 2072 6570 7265 7365 6e74 7320 6120  ng represents a 
-0005e5d0: 636f 6c75 6d6e 206e 616d 652c 2061 2043  column name, a C
-0005e5e0: 6f6e 7374 616e 7420 6361 6e20 6265 2065  onstant can be e
-0005e5f0: 6974 6865 7220 6120 7068 7973 6964 206f  ither a physid o
-0005e600: 7220 7368 6f72 746e 616d 652c 2061 2053  r shortname, a S
-0005e610: 7472 7563 7475 7265 206d 6170 7065 7220  tructure mapper 
-0005e620: 7265 7072 6573 656e 7473 2061 2068 6965  represents a hie
-0005e630: 7261 7263 6879 2074 7265 652e 204c 6973  rarchy tree. Lis
-0005e640: 7420 6361 6e20 6265 2065 6974 6865 7220  t can be either 
-0005e650: 6120 6c69 7374 206f 6620 7374 7269 6e67  a list of string
-0005e660: 7320 6f72 2043 6f6e 7374 616e 7473 0d0a  s or Constants..
-0005e670: 2020 2020 2020 2020 3a70 6172 616d 2064          :param d
-0005e680: 696d 656e 7369 6f6e 5f34 3a20 7374 7269  imension_4: stri
-0005e690: 6e67 2c20 6c69 7374 2c20 7079 6d70 782e  ng, list, pympx.
-0005e6a0: 456c 656d 656e 742c 2070 796d 7078 2e43  Element, pympx.C
-0005e6b0: 6f6e 7374 616e 7420 6f72 2070 796d 7078  onstant or pympx
-0005e6c0: 2e53 7472 7563 7475 7265 4d61 7070 6572  .StructureMapper
-0005e6d0: 2e20 5374 7269 6e67 2072 6570 7265 7365  . String represe
-0005e6e0: 6e74 7320 6120 636f 6c75 6d6e 206e 616d  nts a column nam
-0005e6f0: 652c 2061 2043 6f6e 7374 616e 7420 6361  e, a Constant ca
-0005e700: 6e20 6265 2065 6974 6865 7220 6120 7068  n be either a ph
-0005e710: 7973 6964 206f 7220 7368 6f72 746e 616d  ysid or shortnam
-0005e720: 652c 2061 2053 7472 7563 7475 7265 206d  e, a Structure m
-0005e730: 6170 7065 7220 7265 7072 6573 656e 7473  apper represents
-0005e740: 2061 2068 6965 7261 7263 6879 2074 7265   a hierarchy tre
-0005e750: 652e 204c 6973 7420 6361 6e20 6265 2065  e. List can be e
-0005e760: 6974 6865 7220 6120 6c69 7374 206f 6620  ither a list of 
-0005e770: 7374 7269 6e67 7320 6f72 2043 6f6e 7374  strings or Const
-0005e780: 616e 7473 0d0a 2020 2020 2020 2020 3a70  ants..        :p
-0005e790: 6172 616d 2064 696d 656e 7369 6f6e 5f35  aram dimension_5
-0005e7a0: 3a20 7374 7269 6e67 2c20 6c69 7374 2c20  : string, list, 
-0005e7b0: 7079 6d70 782e 456c 656d 656e 742c 2070  pympx.Element, p
-0005e7c0: 796d 7078 2e43 6f6e 7374 616e 7420 6f72  ympx.Constant or
-0005e7d0: 2070 796d 7078 2e53 7472 7563 7475 7265   pympx.Structure
-0005e7e0: 4d61 7070 6572 2e20 5374 7269 6e67 2072  Mapper. String r
-0005e7f0: 6570 7265 7365 6e74 7320 6120 636f 6c75  epresents a colu
-0005e800: 6d6e 206e 616d 652c 2061 2043 6f6e 7374  mn name, a Const
-0005e810: 616e 7420 6361 6e20 6265 2065 6974 6865  ant can be eithe
-0005e820: 7220 6120 7068 7973 6964 206f 7220 7368  r a physid or sh
-0005e830: 6f72 746e 616d 652c 2061 2053 7472 7563  ortname, a Struc
-0005e840: 7475 7265 206d 6170 7065 7220 7265 7072  ture mapper repr
-0005e850: 6573 656e 7473 2061 2068 6965 7261 7263  esents a hierarc
-0005e860: 6879 2074 7265 652e 204c 6973 7420 6361  hy tree. List ca
-0005e870: 6e20 6265 2065 6974 6865 7220 6120 6c69  n be either a li
-0005e880: 7374 206f 6620 7374 7269 6e67 7320 6f72  st of strings or
-0005e890: 2043 6f6e 7374 616e 7473 0d0a 2020 2020   Constants..    
-0005e8a0: 2020 2020 3a70 6172 616d 2064 696d 656e      :param dimen
-0005e8b0: 7369 6f6e 5f36 3a20 7374 7269 6e67 2c20  sion_6: string, 
-0005e8c0: 6c69 7374 2c20 7079 6d70 782e 456c 656d  list, pympx.Elem
-0005e8d0: 656e 742c 2070 796d 7078 2e43 6f6e 7374  ent, pympx.Const
-0005e8e0: 616e 7420 6f72 2070 796d 7078 2e53 7472  ant or pympx.Str
-0005e8f0: 7563 7475 7265 4d61 7070 6572 2e20 5374  uctureMapper. St
-0005e900: 7269 6e67 2072 6570 7265 7365 6e74 7320  ring represents 
-0005e910: 6120 636f 6c75 6d6e 206e 616d 652c 2061  a column name, a
-0005e920: 2043 6f6e 7374 616e 7420 6361 6e20 6265   Constant can be
-0005e930: 2065 6974 6865 7220 6120 7068 7973 6964   either a physid
-0005e940: 206f 7220 7368 6f72 746e 616d 652c 2061   or shortname, a
-0005e950: 2053 7472 7563 7475 7265 206d 6170 7065   Structure mappe
-0005e960: 7220 7265 7072 6573 656e 7473 2061 2068  r represents a h
-0005e970: 6965 7261 7263 6879 2074 7265 652e 204c  ierarchy tree. L
-0005e980: 6973 7420 6361 6e20 6265 2065 6974 6865  ist can be eithe
-0005e990: 7220 6120 6c69 7374 206f 6620 7374 7269  r a list of stri
-0005e9a0: 6e67 7320 6f72 2043 6f6e 7374 616e 7473  ngs or Constants
-0005e9b0: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0005e9c0: 2064 696d 656e 7369 6f6e 5f37 3a20 7374   dimension_7: st
-0005e9d0: 7269 6e67 2c20 6c69 7374 2c20 7079 6d70  ring, list, pymp
-0005e9e0: 782e 456c 656d 656e 742c 2070 796d 7078  x.Element, pympx
-0005e9f0: 2e43 6f6e 7374 616e 7420 6f72 2070 796d  .Constant or pym
-0005ea00: 7078 2e53 7472 7563 7475 7265 4d61 7070  px.StructureMapp
-0005ea10: 6572 2e20 5374 7269 6e67 2072 6570 7265  er. String repre
-0005ea20: 7365 6e74 7320 6120 636f 6c75 6d6e 206e  sents a column n
-0005ea30: 616d 652c 2061 2043 6f6e 7374 616e 7420  ame, a Constant 
-0005ea40: 6361 6e20 6265 2065 6974 6865 7220 6120  can be either a 
-0005ea50: 7068 7973 6964 206f 7220 7368 6f72 746e  physid or shortn
-0005ea60: 616d 652c 2061 2053 7472 7563 7475 7265  ame, a Structure
-0005ea70: 206d 6170 7065 7220 7265 7072 6573 656e   mapper represen
-0005ea80: 7473 2061 2068 6965 7261 7263 6879 2074  ts a hierarchy t
-0005ea90: 7265 652e 204c 6973 7420 6361 6e20 6265  ree. List can be
-0005eaa0: 2065 6974 6865 7220 6120 6c69 7374 206f   either a list o
-0005eab0: 6620 7374 7269 6e67 7320 6f72 2043 6f6e  f strings or Con
-0005eac0: 7374 616e 7473 0d0a 2020 2020 2020 2020  stants..        
-0005ead0: 3a70 6172 616d 206d 6f64 653a 2073 7472  :param mode: str
-0005eae0: 696e 672c 206c 6973 742c 2070 796d 7078  ing, list, pympx
-0005eaf0: 2e45 6c65 6d65 6e74 2c20 6f72 2070 796d  .Element, or pym
-0005eb00: 7078 2e43 6f6e 7374 616e 740d 0a20 2020  px.Constant..   
-0005eb10: 2020 2020 203a 7061 7261 6d20 6261 7365       :param base
-0005eb20: 3a20 7374 7269 6e67 2c20 7079 6d70 782e  : string, pympx.
-0005eb30: 456c 656d 656e 742c 206f 7220 7079 6d70  Element, or pymp
-0005eb40: 782e 436f 6e73 7461 6e74 0d0a 2020 2020  x.Constant..    
-0005eb50: 2020 2020 3a70 6172 616d 2074 696d 653a      :param time:
-0005eb60: 2073 7472 696e 672c 2070 796d 7078 2e45   string, pympx.E
-0005eb70: 6c65 6d65 6e74 2c20 6f72 2070 796d 7078  lement, or pympx
-0005eb80: 2e43 6f6e 7374 616e 7420 6f72 2064 6174  .Constant or dat
-0005eb90: 6574 696d 650d 0a20 2020 2020 2020 203a  etime..        :
-0005eba0: 7061 7261 6d20 6d65 7472 6963 3a20 4569  param metric: Ei
-0005ebb0: 7468 6572 2061 2073 7472 696e 6720 6e61  ther a string na
-0005ebc0: 6d69 6e67 2074 6865 206d 6574 7269 6320  ming the metric 
-0005ebd0: 636f 6c75 6d6e 2c20 6f72 2061 2064 6963  column, or a dic
-0005ebe0: 7469 6f6e 6172 7920 6f66 2063 6f6c 756d  tionary of colum
-0005ebf0: 6e20 6e61 6d65 7320 746f 206d 6574 7269  n names to metri
-0005ec00: 6320 7368 6f72 746e 616d 6573 0d0a 2020  c shortnames..  
-0005ec10: 2020 2020 2020 3a70 6172 616d 2076 616c        :param val
-0005ec20: 7565 5f63 6f6c 756d 6e3a 2057 6865 6e20  ue_column: When 
-0005ec30: 7573 696e 6720 6120 6d65 7472 6963 2063  using a metric c
-0005ec40: 6f6c 756d 6e20 636f 6e74 6169 6e69 6e67  olumn containing
-0005ec50: 206d 6574 7269 6320 2869 6e64 6963 6174   metric (indicat
-0005ec60: 6f72 2920 7368 6f72 7463 6f64 6520 6f72  or) shortcode or
-0005ec70: 2070 6879 7369 6473 2c20 7468 656e 2070   physids, then p
-0005ec80: 7574 2074 6865 206e 616d 6520 6f66 2074  ut the name of t
-0005ec90: 6865 2076 616c 7565 2063 6f6c 756d 6e20  he value column 
-0005eca0: 696e 2068 6572 652e 2049 6620 6d65 7472  in here. If metr
-0005ecb0: 6963 7320 6172 6520 696e 2064 6966 6665  ics are in diffe
-0005ecc0: 7265 6e74 2063 6f6c 756d 6e73 206c 6561  rent columns lea
-0005ecd0: 7665 2074 6869 7320 7061 7261 6d65 7465  ve this paramete
-0005ece0: 7220 6173 204e 6f6e 650d 0a20 2020 2020  r as None..     
-0005ecf0: 2020 203a 7061 7261 6d20 7375 626c 6f61     :param subloa
-0005ed00: 645f 6e61 6d65 3a0d 0a20 2020 2020 2020  d_name:..       
-0005ed10: 203a 7061 7261 6d20 736f 7572 6365 5f64   :param source_d
-0005ed20: 6174 6166 7261 6d65 3a0d 0a20 2020 2020  ataframe:..     
-0005ed30: 2020 203a 7061 7261 6d20 6967 6e6f 7265     :param ignore
-0005ed40: 5f7a 6572 6f5f 7661 6c75 6573 3a20 5573  _zero_values: Us
-0005ed50: 7561 6c6c 7920 7765 2064 6f20 6e6f 7420  ually we do not 
-0005ed60: 7769 7368 2074 6f20 6c6f 6164 207a 6572  wish to load zer
-0005ed70: 6f20 7661 6c75 6573 2069 6e74 6f20 456d  o values into Em
-0005ed80: 706f 7765 722e 2054 6869 7320 666c 6167  power. This flag
-0005ed90: 2070 7265 7665 6e74 7320 7468 6520 7a65   prevents the ze
-0005eda0: 726f 2076 616c 7565 7320 6265 696e 6720  ro values being 
-0005edb0: 6c6f 6164 6564 2069 6e74 6f20 456d 706f  loaded into Empo
-0005edc0: 7765 720d 0a20 2020 2020 2020 2027 2727  wer..        '''
-0005edd0: 0d0a 0d0a 2020 2020 2020 2020 2354 4f44  ....        #TOD
-0005ede0: 4f20 2d20 7468 726f 7720 6572 726f 7220  O - throw error 
-0005edf0: 6966 2062 6173 6520 6973 2061 206c 6973  if base is a lis
-0005ee00: 7420 2d20 7765 2063 616e 2774 2068 6176  t - we can't hav
-0005ee10: 6520 6d6f 7265 2074 6861 6e20 6f6e 6520  e more than one 
-0005ee20: 6e6f 6e2d 6164 6469 7469 7665 2063 6f6c  non-additive col
-0005ee30: 756d 6e20 2873 696e 6365 2069 7427 7320  umn (since it's 
-0005ee40: 6e6f 6e20 6164 6469 7469 7665 2077 6520  non additive we 
-0005ee50: 776f 6e27 7420 6167 6772 6567 6174 6529  won't aggregate)
-0005ee60: 0d0a 0d0a 0d0a 0d0a 2020 2020 2020 2020  ........        
-0005ee70: 2346 6972 7374 2c20 6765 7420 7468 6520  #First, get the 
-0005ee80: 7479 7065 206f 6620 7472 616e 736c 6174  type of translat
-0005ee90: 696f 6e20 6461 7461 6672 616d 652c 2061  ion dataframe, a
-0005eea0: 6e64 2074 6865 2063 6f6c 756d 6e20 6e61  nd the column na
-0005eeb0: 6d65 7320 666f 7220 6561 6368 2064 696d  mes for each dim
-0005eec0: 656e 7369 6f6e 0d0a 0d0a 2020 2020 2020  ension....      
-0005eed0: 2020 6c6f 6f6b 7570 5f6d 6574 7269 635f    lookup_metric_
-0005eee0: 7368 6f72 746e 616d 655f 6672 6f6d 5f63  shortname_from_c
-0005eef0: 6f6c 756d 6e20 3d20 4e6f 6e65 0d0a 2020  olumn = None..  
-0005ef00: 2020 2020 2020 6479 6e61 6d69 635f 6d65        dynamic_me
-0005ef10: 7472 6963 5f63 6f6c 756d 6e73 2020 2020  tric_columns    
-0005ef20: 2020 2020 2020 2020 2020 3d20 4e6f 6e65            = None
-0005ef30: 0d0a 0d0a 2020 2020 2020 2020 6966 2073  ....        if s
-0005ef40: 7562 6c6f 6164 5f6e 616d 6520 6973 204e  ubload_name is N
-0005ef50: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0005ef60: 2020 7375 626c 6f61 645f 6e61 6d65 203d    subload_name =
-0005ef70: 2027 7375 626c 6f61 645f 3027 0d0a 0d0a   'subload_0'....
-0005ef80: 0d0a 2020 2020 2020 2020 6966 2065 6d70  ..        if emp
-0005ef90: 6f77 6572 5f70 6572 696f 645f 7479 7065  ower_period_type
-0005efa0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-0005efb0: 2020 2020 2020 2065 6d70 6f77 6572 5f70         empower_p
-0005efc0: 6572 696f 645f 7479 7065 3d20 7365 6c66  eriod_type= self
-0005efd0: 2e65 6d70 6f77 6572 5f70 6572 696f 645f  .empower_period_
-0005efe0: 7479 7065 0d0a 0d0a 2020 2020 2020 2020  type....        
-0005eff0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
-0005f000: 2020 2343 6865 636b 2069 6620 6d65 7472    #Check if metr
-0005f010: 6963 2069 7320 6120 7374 7269 6e67 0d0a  ic is a string..
-0005f020: 2020 2020 2020 2020 2020 2020 6d65 7472              metr
-0005f030: 6963 3d6d 6574 7269 632b 2727 0d0a 0d0a  ic=metric+''....
-0005f040: 2020 2020 2020 2020 2020 2020 6479 6e61              dyna
-0005f050: 6d69 635f 6d65 7472 6963 5f63 6f6c 756d  mic_metric_colum
-0005f060: 6e73 203d 205b 6d65 7472 6963 5d0d 0a20  ns = [metric].. 
-0005f070: 2020 2020 2020 2065 7863 6570 7420 5479         except Ty
-0005f080: 7065 4572 726f 723a 0d0a 2020 2020 2020  peError:..      
-0005f090: 2020 2020 2020 236d 6574 7269 6320 6973        #metric is
-0005f0a0: 206e 6f74 2061 2073 7472 696e 6720 2d20   not a string - 
-0005f0b0: 6974 2069 7320 6120 6469 6374 0d0a 2020  it is a dict..  
-0005f0c0: 2020 2020 2020 2020 2020 6c6f 6f6b 7570            lookup
-0005f0d0: 5f6d 6574 7269 635f 7368 6f72 746e 616d  _metric_shortnam
-0005f0e0: 655f 6672 6f6d 5f63 6f6c 756d 6e20 3d20  e_from_column = 
-0005f0f0: 6d65 7472 6963 0d0a 0d0a 2020 2020 2020  metric....      
-0005f100: 2020 6966 2073 6f75 7263 655f 6461 7461    if source_data
-0005f110: 6672 616d 6520 6973 206e 6f74 204e 6f6e  frame is not Non
-0005f120: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0005f130: 6461 7461 6672 616d 6520 3d20 736f 7572  dataframe = sour
-0005f140: 6365 5f64 6174 6166 7261 6d65 2e63 6f70  ce_dataframe.cop
-0005f150: 7928 290d 0a20 2020 2020 2020 2065 6c73  y()..        els
-0005f160: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0005f170: 6461 7461 6672 616d 6520 3d20 7365 6c66  dataframe = self
-0005f180: 2e64 662e 636f 7079 2829 0d0a 0d0a 2020  .df.copy()....  
-0005f190: 2020 2020 2020 6465 6620 5f64 6563 6964        def _decid
-0005f1a0: 655f 6d61 7070 6572 5f74 7970 6528 6d61  e_mapper_type(ma
-0005f1b0: 7070 6572 5f69 6e70 7574 293a 0d0a 2020  pper_input):..  
-0005f1c0: 2020 2020 2020 2020 2020 2363 6f6e 7665            #conve
-0005f1d0: 7274 2074 6865 2069 6e70 7574 2074 6f20  rt the input to 
-0005f1e0: 6120 7374 616e 6461 7264 206d 6170 7065  a standard mappe
-0005f1f0: 7220 7479 7065 0d0a 2020 2020 2020 2020  r type..        
-0005f200: 2020 2020 236d 6170 7065 7220 696e 7075      #mapper inpu
-0005f210: 7420 6d61 7920 6265 206e 6f6e 6520 6966  t may be none if
-0005f220: 2074 6865 2064 696d 656e 7369 6f6e 7320   the dimensions 
-0005f230: 6973 206e 6f74 2070 7265 7365 6e74 0d0a  is not present..
-0005f240: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0005f250: 6170 7065 725f 696e 7075 7420 6973 204e  apper_input is N
-0005f260: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0005f270: 2020 2020 2020 7265 7475 726e 2043 6f6e        return Con
-0005f280: 7374 616e 7428 2d31 290d 0a20 2020 2020  stant(-1)..     
-0005f290: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0005f2a0: 616e 6365 286d 6170 7065 725f 696e 7075  ance(mapper_inpu
-0005f2b0: 742c 2053 7472 7563 7475 7265 4d61 7070  t, StructureMapp
-0005f2c0: 6572 293a 0d0a 2020 2020 2020 2020 2020  er):..          
-0005f2d0: 2020 2020 2020 7265 7475 726e 206d 6170        return map
-0005f2e0: 7065 725f 696e 7075 740d 0a20 2020 2020  per_input..     
-0005f2f0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0005f300: 616e 6365 286d 6170 7065 725f 696e 7075  ance(mapper_inpu
-0005f310: 742c 2043 6f6e 7374 616e 7429 3a0d 0a20  t, Constant):.. 
-0005f320: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0005f330: 6574 7572 6e20 6d61 7070 6572 5f69 6e70  eturn mapper_inp
-0005f340: 7574 0d0a 2020 2020 2020 2020 2020 2020  ut..            
-0005f350: 6966 2069 7369 6e73 7461 6e63 6528 6d61  if isinstance(ma
-0005f360: 7070 6572 5f69 6e70 7574 2c20 436f 6c75  pper_input, Colu
-0005f370: 6d6e 4d61 7070 6572 293a 0d0a 2020 2020  mnMapper):..    
-0005f380: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0005f390: 726e 206d 6170 7065 725f 696e 7075 740d  rn mapper_input.
-0005f3a0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0005f3b0: 6973 696e 7374 616e 6365 286d 6170 7065  isinstance(mappe
-0005f3c0: 725f 696e 7075 742c 2073 7472 293a 0d0a  r_input, str):..
-0005f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f3e0: 2354 4f44 4f20 2d20 6469 6666 6572 656e  #TODO - differen
-0005f3f0: 7469 6174 6520 6265 7477 6565 6e20 7374  tiate between st
-0005f400: 7220 616e 6420 696e 742f 666c 6f61 7420  r and int/float 
-0005f410: 7064 2e53 6572 6965 732c 2061 6e64 2072  pd.Series, and r
-0005f420: 6574 7572 6e20 7368 6f72 746e 616d 6520  eturn shortname 
-0005f430: 6f72 2070 6879 7369 6420 6d61 7070 6572  or physid mapper
-0005f440: 2061 6363 6f72 6469 6e67 6c79 0d0a 2020   accordingly..  
-0005f450: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0005f460: 7475 726e 2043 6f6c 756d 6e4d 6170 7065  turn ColumnMappe
-0005f470: 7228 636f 6c75 6d6e 5f6e 616d 6520 2020  r(column_name   
-0005f480: 2020 3d20 6d61 7070 6572 5f69 6e70 7574    = mapper_input
-0005f490: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0005f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f4b0: 2020 2020 202c 636f 6c75 6d6e 5f74 7970       ,column_typ
-0005f4c0: 6520 2020 2020 3d20 2773 686f 7274 6e61  e     = 'shortna
-0005f4d0: 6d65 270d 0a20 2020 2020 2020 2020 2020  me'..           
-0005f4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f4f0: 2020 2020 2020 2020 2c66 6965 6c64 5f73          ,field_s
-0005f500: 686f 7274 6e61 6d65 203d 204e 6f6e 650d  hortname = None.
-0005f510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0005f520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0005f530: 2020 2020 290d 0a0d 0a20 2020 2020 2020      )....       
-0005f540: 2020 2020 2023 544f 446f 202d 2068 616e       #TODo - han
-0005f550: 646c 6520 6c69 7374 7320 6f66 2063 6f6c  dle lists of col
-0005f560: 756d 6e73 0d0a 2020 2020 2020 2020 2020  umns..          
-0005f570: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0005f580: 6f72 2827 4361 6e6e 6f74 206d 6170 2066  or('Cannot map f
-0005f590: 726f 6d20 696e 7075 7420 272b 7374 7228  rom input '+str(
-0005f5a0: 6d61 7070 6572 5f69 6e70 7574 2929 0d0a  mapper_input))..
-0005f5b0: 0d0a 2020 2020 2020 2020 6469 6d65 6e73  ..        dimens
-0005f5c0: 696f 6e5f 305f 6d61 7070 6572 203d 205f  ion_0_mapper = _
-0005f5d0: 6465 6369 6465 5f6d 6170 7065 725f 7479  decide_mapper_ty
-0005f5e0: 7065 2864 696d 656e 7369 6f6e 5f30 290d  pe(dimension_0).
-0005f5f0: 0a20 2020 2020 2020 2064 696d 656e 7369  .        dimensi
-0005f600: 6f6e 5f31 5f6d 6170 7065 7220 3d20 5f64  on_1_mapper = _d
-0005f610: 6563 6964 655f 6d61 7070 6572 5f74 7970  ecide_mapper_typ
-0005f620: 6528 6469 6d65 6e73 696f 6e5f 3129 0d0a  e(dimension_1)..
-0005f630: 2020 2020 2020 2020 6469 6d65 6e73 696f          dimensio
-0005f640: 6e5f 325f 6d61 7070 6572 203d 205f 6465  n_2_mapper = _de
-0005f650: 6369 6465 5f6d 6170 7065 725f 7479 7065  cide_mapper_type
-0005f660: 2864 696d 656e 7369 6f6e 5f32 290d 0a20  (dimension_2).. 
-0005f670: 2020 2020 2020 2064 696d 656e 7369 6f6e         dimension
-0005f680: 5f33 5f6d 6170 7065 7220 3d20 5f64 6563  _3_mapper = _dec
-0005f690: 6964 655f 6d61 7070 6572 5f74 7970 6528  ide_mapper_type(
-0005f6a0: 6469 6d65 6e73 696f 6e5f 3329 0d0a 2020  dimension_3)..  
-0005f6b0: 2020 2020 2020 6469 6d65 6e73 696f 6e5f        dimension_
-0005f6c0: 345f 6d61 7070 6572 203d 205f 6465 6369  4_mapper = _deci
-0005f6d0: 6465 5f6d 6170 7065 725f 7479 7065 2864  de_mapper_type(d
-0005f6e0: 696d 656e 7369 6f6e 5f34 290d 0a20 2020  imension_4)..   
-0005f6f0: 2020 2020 2064 696d 656e 7369 6f6e 5f35       dimension_5
-0005f700: 5f6d 6170 7065 7220 3d20 5f64 6563 6964  _mapper = _decid
-0005f710: 655f 6d61 7070 6572 5f74 7970 6528 6469  e_mapper_type(di
-0005f720: 6d65 6e73 696f 6e5f 3529 0d0a 2020 2020  mension_5)..    
-0005f730: 2020 2020 6469 6d65 6e73 696f 6e5f 365f      dimension_6_
-0005f740: 6d61 7070 6572 203d 205f 6465 6369 6465  mapper = _decide
-0005f750: 5f6d 6170 7065 725f 7479 7065 2864 696d  _mapper_type(dim
-0005f760: 656e 7369 6f6e 5f36 290d 0a20 2020 2020  ension_6)..     
-0005f770: 2020 2064 696d 656e 7369 6f6e 5f37 5f6d     dimension_7_m
-0005f780: 6170 7065 7220 3d20 5f64 6563 6964 655f  apper = _decide_
-0005f790: 6d61 7070 6572 5f74 7970 6528 6469 6d65  mapper_type(dime
-0005f7a0: 6e73 696f 6e5f 3729 0d0a 2020 2020 2020  nsion_7)..      
-0005f7b0: 2020 6d6f 6465 5f6d 6170 7065 7220 2020    mode_mapper   
-0005f7c0: 2020 2020 203d 205f 6465 6369 6465 5f6d       = _decide_m
-0005f7d0: 6170 7065 725f 7479 7065 286d 6f64 6529  apper_type(mode)
-0005f7e0: 0d0a 2020 2020 2020 2020 6261 7365 5f6d  ..        base_m
-0005f7f0: 6170 7065 7220 2020 2020 2020 203d 205f  apper        = _
-0005f800: 6465 6369 6465 5f6d 6170 7065 725f 7479  decide_mapper_ty
-0005f810: 7065 2862 6173 6529 0d0a 2020 2020 2020  pe(base)..      
-0005f820: 2020 6966 2064 796e 616d 6963 5f6d 6574    if dynamic_met
-0005f830: 7269 635f 636f 6c75 6d6e 7320 6973 206e  ric_columns is n
-0005f840: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-0005f850: 2020 2020 2020 6d65 7472 6963 5f6d 6170        metric_map
-0005f860: 7065 7220 3d20 5f64 6563 6964 655f 6d61  per = _decide_ma
-0005f870: 7070 6572 5f74 7970 6528 6d65 7472 6963  pper_type(metric
-0005f880: 290d 0a0d 0a20 2020 2020 2020 2064 696d  )....        dim
-0005f890: 656e 7369 6f6e 5f30 5f63 6f6c 756d 6e73  ension_0_columns
-0005f8a0: 203d 205b 5d0d 0a20 2020 2020 2020 2064   = []..        d
-0005f8b0: 696d 656e 7369 6f6e 5f31 5f63 6f6c 756d  imension_1_colum
-0005f8c0: 6e73 203d 205b 5d0d 0a20 2020 2020 2020  ns = []..       
-0005f8d0: 2064 696d 656e 7369 6f6e 5f32 5f63 6f6c   dimension_2_col
-0005f8e0: 756d 6e73 203d 205b 5d0d 0a20 2020 2020  umns = []..     
-0005f8f0: 2020 2064 696d 656e 7369 6f6e 5f33 5f63     dimension_3_c
-0005f900: 6f6c 756d 6e73 203d 205b 5d0d 0a20 2020  olumns = []..   
-0005f910: 2020 2020 2064 696d 656e 7369 6f6e 5f34       dimension_4
-0005f920: 5f63 6f6c 756d 6e73 203d 205b 5d0d 0a20  _columns = [].. 
-0005f930: 2020 2020 2020 2064 696d 656e 7369 6f6e         dimension
-0005f940: 5f35 5f63 6f6c 756d 6e73 203d 205b 5d0d  _5_columns = [].
-0005f950: 0a20 2020 2020 2020 2064 696d 656e 7369  .        dimensi
-0005f960: 6f6e 5f36 5f63 6f6c 756d 6e73 203d 205b  on_6_columns = [
-0005f970: 5d0d 0a20 2020 2020 2020 2064 696d 656e  ]..        dimen
-0005f980: 7369 6f6e 5f37 5f63 6f6c 756d 6e73 203d  sion_7_columns =
-0005f990: 205b 5d0d 0a0d 0a0d 0a20 2020 2020 2020   []......       
-0005f9a0: 2069 6620 7365 6c66 2e73 6974 652e 6e75   if self.site.nu
-0005f9b0: 6d62 6572 5f6f 665f 756e 6974 5f64 696d  mber_of_unit_dim
-0005f9c0: 656e 7369 6f6e 7320 3e3d 313a 0d0a 2020  ensions >=1:..  
-0005f9d0: 2020 2020 2020 2020 2020 6469 6d65 6e73            dimens
-0005f9e0: 696f 6e5f 305f 636f 6c75 6d6e 7320 3d20  ion_0_columns = 
-0005f9f0: 6469 6d65 6e73 696f 6e5f 305f 6d61 7070  dimension_0_mapp
-0005fa00: 6572 2e6d 6170 5f64 6174 6166 7261 6d65  er.map_dataframe
-0005fa10: 2864 6174 6166 7261 6d65 3d64 6174 6166  (dataframe=dataf
-0005fa20: 7261 6d65 2c64 696d 656e 7369 6f6e 3d73  rame,dimension=s
-0005fa30: 656c 662e 7369 7465 2e64 696d 656e 7369  elf.site.dimensi
-0005fa40: 6f6e 735b 305d 2c6c 6f61 6465 723d 7365  ons[0],loader=se
-0005fa50: 6c66 290d 0a20 2020 2020 2020 2069 6620  lf)..        if 
-0005fa60: 7365 6c66 2e73 6974 652e 6e75 6d62 6572  self.site.number
-0005fa70: 5f6f 665f 756e 6974 5f64 696d 656e 7369  _of_unit_dimensi
-0005fa80: 6f6e 7320 3e3d 323a 0d0a 2020 2020 2020  ons >=2:..      
-0005fa90: 2020 2020 2020 6469 6d65 6e73 696f 6e5f        dimension_
-0005faa0: 315f 636f 6c75 6d6e 7320 3d20 6469 6d65  1_columns = dime
-0005fab0: 6e73 696f 6e5f 315f 6d61 7070 6572 2e6d  nsion_1_mapper.m
-0005fac0: 6170 5f64 6174 6166 7261 6d65 2864 6174  ap_dataframe(dat
-0005fad0: 6166 7261 6d65 3d64 6174 6166 7261 6d65  aframe=dataframe
-0005fae0: 2c64 696d 656e 7369 6f6e 3d73 656c 662e  ,dimension=self.
-0005faf0: 7369 7465 2e64 696d 656e 7369 6f6e 735b  site.dimensions[
-0005fb00: 315d 2c6c 6f61 6465 723d 7365 6c66 290d  1],loader=self).
-0005fb10: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0005fb20: 2e73 6974 652e 6e75 6d62 6572 5f6f 665f  .site.number_of_
-0005fb30: 756e 6974 5f64 696d 656e 7369 6f6e 7320  unit_dimensions 
-0005fb40: 3e3d 333a 0d0a 2020 2020 2020 2020 2020  >=3:..          
-0005fb50: 2020 6469 6d65 6e73 696f 6e5f 325f 636f    dimension_2_co
-0005fb60: 6c75 6d6e 7320 3d20 6469 6d65 6e73 696f  lumns = dimensio
-0005fb70: 6e5f 325f 6d61 7070 6572 2e6d 6170 5f64  n_2_mapper.map_d
-0005fb80: 6174 6166 7261 6d65 2864 6174 6166 7261  ataframe(datafra
-0005fb90: 6d65 3d64 6174 6166 7261 6d65 2c64 696d  me=dataframe,dim
-0005fba0: 656e 7369 6f6e 3d73 656c 662e 7369 7465  ension=self.site
-0005fbb0: 2e64 696d 656e 7369 6f6e 735b 325d 2c6c  .dimensions[2],l
-0005fbc0: 6f61 6465 723d 7365 6c66 290d 0a20 2020  oader=self)..   
-0005fbd0: 2020 2020 2069 6620 7365 6c66 2e73 6974       if self.sit
-0005fbe0: 652e 6e75 6d62 6572 5f6f 665f 756e 6974  e.number_of_unit
-0005fbf0: 5f64 696d 656e 7369 6f6e 7320 3e3d 343a  _dimensions >=4:
-0005fc00: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
-0005fc10: 6d65 6e73 696f 6e5f 335f 636f 6c75 6d6e  mension_3_column
-0005fc20: 7320 3d20 6469 6d65 6e73 696f 6e5f 335f  s = dimension_3_
-0005fc30: 6d61 7070 6572 2e6d 6170 5f64 6174 6166  mapper.map_dataf
-0005fc40: 7261 6d65 2864 6174 6166 7261 6d65 3d64  rame(dataframe=d
-0005fc50: 6174 6166 7261 6d65 2c64 696d 656e 7369  ataframe,dimensi
-0005fc60: 6f6e 3d73 656c 662e 7369 7465 2e64 696d  on=self.site.dim
-0005fc70: 656e 7369 6f6e 735b 335d 2c6c 6f61 6465  ensions[3],loade
-0005fc80: 723d 7365 6c66 290d 0a20 2020 2020 2020  r=self)..       
-0005fc90: 2069 6620 7365 6c66 2e73 6974 652e 6e75   if self.site.nu
-0005fca0: 6d62 6572 5f6f 665f 756e 6974 5f64 696d  mber_of_unit_dim
-0005fcb0: 656e 7369 6f6e 7320 3e3d 353a 0d0a 2020  ensions >=5:..  
-0005fcc0: 2020 2020 2020 2020 2020 6469 6d65 6e73            dimens
-0005fcd0: 696f 6e5f 345f 636f 6c75 6d6e 7320 3d20  ion_4_columns = 
-0005fce0: 6469 6d65 6e73 696f 6e5f 345f 6d61 7070  dimension_4_mapp
-0005fcf0: 6572 2e6d 6170 5f64 6174 6166 7261 6d65  er.map_dataframe
-0005fd00: 2864 6174 6166 7261 6d65 3d64 6174 6166  (dataframe=dataf
-0005fd10: 7261 6d65 2c64 696d 656e 7369 6f6e 3d73  rame,dimension=s
-0005fd20: 656c 662e 7369 7465 2e64 696d 656e 7369  elf.site.dimensi
-0005fd30: 6f6e 735b 345d 2c6c 6f61 6465 723d 7365  ons[4],loader=se
-0005fd40: 6c66 290d 0a20 2020 2020 2020 2069 6620  lf)..        if 
-0005fd50: 7365 6c66 2e73 6974 652e 6e75 6d62 6572  self.site.number
-0005fd60: 5f6f 665f 756e 6974 5f64 696d 656e 7369  _of_unit_dimensi
-0005fd70: 6f6e 7320 3e3d 363a 0d0a 2020 2020 2020  ons >=6:..      
-0005fd80: 2020 2020 2020 6469 6d65 6e73 696f 6e5f        dimension_
-0005fd90: 355f 636f 6c75 6d6e 7320 3d20 6469 6d65  5_columns = dime
-0005fda0: 6e73 696f 6e5f 355f 6d61 7070 6572 2e6d  nsion_5_mapper.m
-0005fdb0: 6170 5f64 6174 6166 7261 6d65 2864 6174  ap_dataframe(dat
-0005fdc0: 6166 7261 6d65 3d64 6174 6166 7261 6d65  aframe=dataframe
-0005fdd0: 2c64 696d 656e 7369 6f6e 3d73 656c 662e  ,dimension=self.
-0005fde0: 7369 7465 2e64 696d 656e 7369 6f6e 735b  site.dimensions[
-0005fdf0: 355d 2c6c 6f61 6465 723d 7365 6c66 290d  5],loader=self).
-0005fe00: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0005fe10: 2e73 6974 652e 6e75 6d62 6572 5f6f 665f  .site.number_of_
-0005fe20: 756e 6974 5f64 696d 656e 7369 6f6e 7320  unit_dimensions 
-0005fe30: 3e3d 373a 0d0a 2020 2020 2020 2020 2020  >=7:..          
-0005fe40: 2020 6469 6d65 6e73 696f 6e5f 365f 636f    dimension_6_co
-0005fe50: 6c75 6d6e 7320 3d20 6469 6d65 6e73 696f  lumns = dimensio
-0005fe60: 6e5f 365f 6d61 7070 6572 2e6d 6170 5f64  n_6_mapper.map_d
-0005fe70: 6174 6166 7261 6d65 2864 6174 6166 7261  ataframe(datafra
-0005fe80: 6d65 3d64 6174 6166 7261 6d65 2c64 696d  me=dataframe,dim
-0005fe90: 656e 7369 6f6e 3d73 656c 662e 7369 7465  ension=self.site
-0005fea0: 2e64 696d 656e 7369 6f6e 735b 365d 2c6c  .dimensions[6],l
-0005feb0: 6f61 6465 723d 7365 6c66 290d 0a20 2020  oader=self)..   
-0005fec0: 2020 2020 2069 6620 7365 6c66 2e73 6974       if self.sit
-0005fed0: 652e 6e75 6d62 6572 5f6f 665f 756e 6974  e.number_of_unit
-0005fee0: 5f64 696d 656e 7369 6f6e 7320 3e3d 383a  _dimensions >=8:
-0005fef0: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
-0005ff00: 6d65 6e73 696f 6e5f 375f 636f 6c75 6d6e  mension_7_column
-0005ff10: 7320 3d20 6469 6d65 6e73 696f 6e5f 375f  s = dimension_7_
-0005ff20: 6d61 7070 6572 2e6d 6170 5f64 6174 6166  mapper.map_dataf
-0005ff30: 7261 6d65 2864 6174 6166 7261 6d65 3d64  rame(dataframe=d
-0005ff40: 6174 6166 7261 6d65 2c64 696d 656e 7369  ataframe,dimensi
-0005ff50: 6f6e 3d73 656c 662e 7369 7465 2e64 696d  on=self.site.dim
-0005ff60: 656e 7369 6f6e 735b 375d 2c6c 6f61 6465  ensions[7],loade
-0005ff70: 723d 7365 6c66 290d 0a0d 0a20 2020 2020  r=self)....     
-0005ff80: 2020 206d 6f64 655f 636f 6c75 6d6e 7320     mode_columns 
-0005ff90: 2020 2020 2020 203d 206d 6f64 655f 6d61         = mode_ma
-0005ffa0: 7070 6572 2e6d 6170 5f64 6174 6166 7261  pper.map_datafra
-0005ffb0: 6d65 2864 6174 6166 7261 6d65 3d64 6174  me(dataframe=dat
-0005ffc0: 6166 7261 6d65 2c64 696d 656e 7369 6f6e  aframe,dimension
-0005ffd0: 3d73 656c 662e 7369 7465 2e64 696d 656e  =self.site.dimen
-0005ffe0: 7369 6f6e 735b 395d 2c6c 6f61 6465 723d  sions[9],loader=
-0005fff0: 7365 6c66 290d 0a20 2020 2020 2020 2062  self)..        b
-00060000: 6173 655f 636f 6c75 6d6e 7320 2020 2020  ase_columns     
-00060010: 2020 203d 2062 6173 655f 6d61 7070 6572     = base_mapper
-00060020: 2e6d 6170 5f64 6174 6166 7261 6d65 2864  .map_dataframe(d
-00060030: 6174 6166 7261 6d65 3d64 6174 6166 7261  ataframe=datafra
-00060040: 6d65 2c64 696d 656e 7369 6f6e 3d73 656c  me,dimension=sel
-00060050: 662e 7369 7465 2e64 696d 656e 7369 6f6e  f.site.dimension
-00060060: 735b 3130 5d2c 6c6f 6164 6572 3d73 656c  s[10],loader=sel
-00060070: 6629 0d0a 2020 2020 2020 2020 6966 2064  f)..        if d
-00060080: 796e 616d 6963 5f6d 6574 7269 635f 636f  ynamic_metric_co
-00060090: 6c75 6d6e 7320 6973 206e 6f74 204e 6f6e  lumns is not Non
-000600a0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000600b0: 6479 6e61 6d69 635f 6d65 7472 6963 5f63  dynamic_metric_c
-000600c0: 6f6c 756d 6e73 203d 206d 6574 7269 635f  olumns = metric_
-000600d0: 6d61 7070 6572 2e6d 6170 5f64 6174 6166  mapper.map_dataf
-000600e0: 7261 6d65 2864 6174 6166 7261 6d65 3d64  rame(dataframe=d
-000600f0: 6174 6166 7261 6d65 2c64 696d 656e 7369  ataframe,dimensi
-00060100: 6f6e 3d73 656c 662e 7369 7465 2e64 696d  on=self.site.dim
-00060110: 656e 7369 6f6e 735b 385d 2c6c 6f61 6465  ensions[8],loade
-00060120: 723d 7365 6c66 290d 0a0d 0a20 2020 2020  r=self)....     
-00060130: 2020 2023 4d61 7020 7469 6d65 2074 6f20     #Map time to 
-00060140: 656d 706f 7765 7220 6461 7465 2074 7570  empower date tup
-00060150: 6c65 730d 0a20 2020 2020 2020 2023 6e65  les..        #ne
-00060160: 6564 7320 656d 706f 7765 725f 7965 6172  eds empower_year
-00060170: 2065 7463 2e20 636f 6c75 6d6e 730d 0a20   etc. columns.. 
-00060180: 2020 2020 2020 2064 6174 6166 7261 6d65         dataframe
-00060190: 5b27 656d 706f 7765 7220 7065 7269 6f64  ['empower period
-000601a0: 2074 7970 6527 5d20 3d20 656d 706f 7765   type'] = empowe
-000601b0: 725f 7065 7269 6f64 5f74 7970 650d 0a20  r_period_type.. 
-000601c0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-000601d0: 616e 6365 2874 696d 652c 2064 6174 6574  ance(time, datet
-000601e0: 696d 652e 6461 7465 7469 6d65 293a 0d0a  ime.datetime):..
-000601f0: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00060200: 6672 616d 655b 2765 6d70 6f77 6572 2079  frame['empower y
-00060210: 6561 7227 5d20 2020 2020 2020 203d 2074  ear']        = t
-00060220: 696d 652e 7965 6172 0d0a 2020 2020 2020  ime.year..      
-00060230: 2020 2020 2020 6461 7461 6672 616d 655b        dataframe[
-00060240: 2765 6d70 6f77 6572 2070 6572 696f 6427  'empower period'
-00060250: 5d20 2020 2020 203d 2074 696d 652e 6d6f  ]      = time.mo
-00060260: 6e74 680d 0a20 2020 2020 2020 2065 6c73  nth..        els
-00060270: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00060280: 2361 7373 756d 6520 7468 6520 7469 6d65  #assume the time
-00060290: 2069 7320 6120 636f 6c75 6d6e 206e 616d   is a column nam
-000602a0: 650d 0a20 2020 2020 2020 2020 2020 2023  e..            #
-000602b0: 5265 6164 2074 6865 2074 696d 6520 6672  Read the time fr
-000602c0: 6f6d 2074 6865 2063 6f6c 756d 6e20 6e61  om the column na
-000602d0: 6d65 2067 6976 656e 0d0a 2020 2020 2020  me given..      
-000602e0: 2020 2020 2020 2374 7572 6e20 6974 2069        #turn it i
-000602f0: 6e74 6f20 616e 2065 6d70 6f77 6572 2074  nto an empower t
-00060300: 7570 6c65 0d0a 2020 2020 2020 2020 2020  uple..          
-00060310: 2020 6461 7461 6672 616d 655b 2765 6d70    dataframe['emp
-00060320: 6f77 6572 2079 6561 7227 5d20 2020 2020  ower year']     
-00060330: 2020 203d 2064 6174 6166 7261 6d65 5b74     = dataframe[t
-00060340: 696d 655d 2e64 742e 7965 6172 0d0a 2020  ime].dt.year..  
-00060350: 2020 2020 2020 2020 2020 6461 7461 6672            datafr
-00060360: 616d 655b 2765 6d70 6f77 6572 2070 6572  ame['empower per
-00060370: 696f 6427 5d20 2020 2020 203d 2064 6174  iod']      = dat
-00060380: 6166 7261 6d65 5b74 696d 655d 2e64 742e  aframe[time].dt.
-00060390: 6d6f 6e74 680d 0a0d 0a0d 0a20 2020 2020  month......     
-000603a0: 2020 2066 6f72 2064 6972 2069 6e20 5b73     for dir in [s
-000603b0: 656c 662e 7369 7465 2e5f 6275 6c6b 5f6c  elf.site._bulk_l
-000603c0: 6f61 645f 696e 7465 726d 6564 6961 7465  oad_intermediate
-000603d0: 5f64 6972 0d0a 2020 2020 2020 2020 2020  _dir..          
-000603e0: 2020 2020 2020 2020 202c 7365 6c66 2e73           ,self.s
-000603f0: 6974 652e 5f6c 6f61 645f 7072 6f63 6573  ite._load_proces
-00060400: 7369 6e67 5f64 6972 0d0a 2020 2020 2020  sing_dir..      
-00060410: 2020 2020 2020 2020 2020 2020 202c 7365               ,se
-00060420: 6c66 2e73 6974 652e 5f6f 7574 7075 745f  lf.site._output_
-00060430: 6461 7461 5f66 696c 6573 5f64 6972 0d0a  data_files_dir..
-00060440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060450: 2020 205d 3a0d 0a0d 0a20 2020 2020 2020     ]:....       
-00060460: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00060470: 2020 2020 2020 2020 2020 206f 732e 6d61             os.ma
-00060480: 6b65 6469 7273 2864 6972 290d 0a20 2020  kedirs(dir)..   
-00060490: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-000604a0: 4669 6c65 4578 6973 7473 4572 726f 723a  FileExistsError:
-000604b0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000604c0: 2020 7061 7373 0d0a 2020 2020 2020 2020    pass..        
-000604d0: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
-000604e0: 6f72 2061 7320 653a 0d0a 2020 2020 2020  or as e:..      
-000604f0: 2020 2020 2020 2020 2020 6966 2065 2e77            if e.w
-00060500: 696e 6572 726f 7220 3d3d 2031 3233 3a0d  inerror == 123:.
-00060510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00060520: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00060530: 4572 726f 7228 2744 6972 6563 746f 7279  Error('Directory
-00060540: 2022 7b7d 2220 6861 7320 616e 2069 6e76   "{}" has an inv
-00060550: 616c 6964 206e 616d 652e 2044 6964 2079  alid name. Did y
-00060560: 6f75 2070 6173 7320 6120 7369 7465 5f6c  ou pass a site_l
-00060570: 6f63 6174 6f72 2070 6174 6820 227b 7d22  ocator path "{}"
-00060580: 2077 6974 686f 7574 2064 6f75 626c 652d   without double-
-00060590: 6573 6361 7069 6e67 2062 6163 6b73 6c61  escaping backsla
-000605a0: 7368 6573 206f 7220 7072 6566 6978 696e  shes or prefixin
-000605b0: 6720 7468 6520 7374 7269 6e67 2077 6974  g the string wit
-000605c0: 6820 616e 2022 7222 2066 6f72 2072 6177  h an "r" for raw
-000605d0: 3f27 2e66 6f72 6d61 7428 6469 722c 7265  ?'.format(dir,re
-000605e0: 7072 2873 6974 655f 6c6f 6361 746f 7229  pr(site_locator)
-000605f0: 2929 0d0a 2020 2020 2020 2020 2020 2020  ))..            
-00060600: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00060610: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00060620: 6169 7365 2065 0d0a 0d0a 2020 2020 2020  aise e....      
-00060630: 2020 2343 7265 6174 6520 7468 6520 6669    #Create the fi
-00060640: 6c65 206e 616d 6573 2061 7574 6f6d 6174  le names automat
-00060650: 6963 616c 6c79 0d0a 2020 2020 2020 2020  ically..        
-00060660: 696e 7465 726d 6564 6961 7465 5f66 696c  intermediate_fil
-00060670: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
-00060680: 2e6a 6f69 6e28 7365 6c66 2e73 6974 652e  .join(self.site.
-00060690: 5f62 756c 6b5f 6c6f 6164 5f69 6e74 6572  _bulk_load_inter
-000606a0: 6d65 6469 6174 655f 6469 722c 0d0a 2020  mediate_dir,..  
-000606b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000606c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000606d0: 2020 2020 2020 2020 2020 4c6f 6164 6572            Loader
-000606e0: 2e5f 6765 745f 696e 7465 726d 6564 6961  ._get_intermedia
-000606f0: 7465 5f66 696c 655f 6e61 6d65 286c 6f61  te_file_name(loa
-00060700: 6465 725f 6e61 6d65 2020 3d20 7365 6c66  der_name  = self
-00060710: 2e6e 616d 650d 0a20 2020 2020 2020 2020  .name..         
-00060720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060740: 2020 2020 2020 2c73 7562 6c6f 6164 5f6e        ,subload_n
-00060750: 616d 6520 3d20 7375 626c 6f61 645f 6e61  ame = subload_na
-00060760: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
-00060770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060790: 2020 202c 7369 7465 5f70 7265 6669 7820     ,site_prefix 
-000607a0: 203d 2073 656c 662e 7369 7465 2e70 7265   = self.site.pre
-000607b0: 6669 780d 0a20 2020 2020 2020 2020 2020  fix..           
-000607c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000607d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000607e0: 2020 2020 2c74 696d 6520 2020 2020 2020      ,time       
-000607f0: 2020 3d20 7469 6d65 0d0a 2020 2020 2020    = time..      
+0005e180: 2020 2020 2020 202c 736f 7572 6365 5f64         ,source_d
+0005e190: 6174 6166 7261 6d65 2020 2020 3d20 4e6f  ataframe    = No
+0005e1a0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
+0005e1b0: 2020 202c 6967 6e6f 7265 5f7a 6572 6f5f     ,ignore_zero_
+0005e1c0: 7661 6c75 6573 2020 3d20 5472 7565 0d0a  values  = True..
+0005e1d0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0005e1e0: 3a0d 0a20 2020 2020 2020 2027 2727 4578  :..        '''Ex
+0005e1f0: 706c 6f64 6520 6461 7461 2062 7920 7468  plode data by th
+0005e200: 6520 6469 6d65 6e73 696f 6e20 6578 7061  e dimension expa
+0005e210: 6e73 696f 6e73 2067 6976 656e 2c20 616e  nsions given, an
+0005e220: 6420 7072 6570 6172 6520 666f 7220 6465  d prepare for de
+0005e230: 6c74 6120 6275 6c6b 206c 6f61 6469 6e67  lta bulk loading
+0005e240: 0d0a 0d0a 2020 2020 2020 2020 3a70 6172  ....        :par
+0005e250: 616d 2064 696d 656e 7369 6f6e 5f30 3a20  am dimension_0: 
+0005e260: 7374 7269 6e67 2c20 6c69 7374 2c20 7079  string, list, py
+0005e270: 6d70 782e 456c 656d 656e 742c 2070 796d  mpx.Element, pym
+0005e280: 7078 2e43 6f6e 7374 616e 7420 6f72 2070  px.Constant or p
+0005e290: 796d 7078 2e53 7472 7563 7475 7265 4d61  ympx.StructureMa
+0005e2a0: 7070 6572 2e20 5374 7269 6e67 2072 6570  pper. String rep
+0005e2b0: 7265 7365 6e74 7320 6120 636f 6c75 6d6e  resents a column
+0005e2c0: 206e 616d 652c 2061 2043 6f6e 7374 616e   name, a Constan
+0005e2d0: 7420 6361 6e20 6265 2065 6974 6865 7220  t can be either 
+0005e2e0: 6120 7068 7973 6964 206f 7220 7368 6f72  a physid or shor
+0005e2f0: 746e 616d 652c 2061 2053 7472 7563 7475  tname, a Structu
+0005e300: 7265 206d 6170 7065 7220 7265 7072 6573  re mapper repres
+0005e310: 656e 7473 2061 2068 6965 7261 7263 6879  ents a hierarchy
+0005e320: 2074 7265 652e 204c 6973 7420 6361 6e20   tree. List can 
+0005e330: 6265 2065 6974 6865 7220 6120 6c69 7374  be either a list
+0005e340: 206f 6620 7374 7269 6e67 7320 6f72 2043   of strings or C
+0005e350: 6f6e 7374 616e 7473 0d0a 2020 2020 2020  onstants..      
+0005e360: 2020 3a70 6172 616d 2064 696d 656e 7369    :param dimensi
+0005e370: 6f6e 5f31 3a20 7374 7269 6e67 2c20 6c69  on_1: string, li
+0005e380: 7374 2c20 7079 6d70 782e 456c 656d 656e  st, pympx.Elemen
+0005e390: 742c 2070 796d 7078 2e43 6f6e 7374 616e  t, pympx.Constan
+0005e3a0: 7420 6f72 2070 796d 7078 2e53 7472 7563  t or pympx.Struc
+0005e3b0: 7475 7265 4d61 7070 6572 2e20 5374 7269  tureMapper. Stri
+0005e3c0: 6e67 2072 6570 7265 7365 6e74 7320 6120  ng represents a 
+0005e3d0: 636f 6c75 6d6e 206e 616d 652c 2061 2043  column name, a C
+0005e3e0: 6f6e 7374 616e 7420 6361 6e20 6265 2065  onstant can be e
+0005e3f0: 6974 6865 7220 6120 7068 7973 6964 206f  ither a physid o
+0005e400: 7220 7368 6f72 746e 616d 652c 2061 2053  r shortname, a S
+0005e410: 7472 7563 7475 7265 206d 6170 7065 7220  tructure mapper 
+0005e420: 7265 7072 6573 656e 7473 2061 2068 6965  represents a hie
+0005e430: 7261 7263 6879 2074 7265 652e 204c 6973  rarchy tree. Lis
+0005e440: 7420 6361 6e20 6265 2065 6974 6865 7220  t can be either 
+0005e450: 6120 6c69 7374 206f 6620 7374 7269 6e67  a list of string
+0005e460: 7320 6f72 2043 6f6e 7374 616e 7473 0d0a  s or Constants..
+0005e470: 2020 2020 2020 2020 3a70 6172 616d 2064          :param d
+0005e480: 696d 656e 7369 6f6e 5f32 3a20 7374 7269  imension_2: stri
+0005e490: 6e67 2c20 6c69 7374 2c20 7079 6d70 782e  ng, list, pympx.
+0005e4a0: 456c 656d 656e 742c 2070 796d 7078 2e43  Element, pympx.C
+0005e4b0: 6f6e 7374 616e 7420 6f72 2070 796d 7078  onstant or pympx
+0005e4c0: 2e53 7472 7563 7475 7265 4d61 7070 6572  .StructureMapper
+0005e4d0: 2e20 5374 7269 6e67 2072 6570 7265 7365  . String represe
+0005e4e0: 6e74 7320 6120 636f 6c75 6d6e 206e 616d  nts a column nam
+0005e4f0: 652c 2061 2043 6f6e 7374 616e 7420 6361  e, a Constant ca
+0005e500: 6e20 6265 2065 6974 6865 7220 6120 7068  n be either a ph
+0005e510: 7973 6964 206f 7220 7368 6f72 746e 616d  ysid or shortnam
+0005e520: 652c 2061 2053 7472 7563 7475 7265 206d  e, a Structure m
+0005e530: 6170 7065 7220 7265 7072 6573 656e 7473  apper represents
+0005e540: 2061 2068 6965 7261 7263 6879 2074 7265   a hierarchy tre
+0005e550: 652e 204c 6973 7420 6361 6e20 6265 2065  e. List can be e
+0005e560: 6974 6865 7220 6120 6c69 7374 206f 6620  ither a list of 
+0005e570: 7374 7269 6e67 7320 6f72 2043 6f6e 7374  strings or Const
+0005e580: 616e 7473 0d0a 2020 2020 2020 2020 3a70  ants..        :p
+0005e590: 6172 616d 2064 696d 656e 7369 6f6e 5f33  aram dimension_3
+0005e5a0: 3a20 7374 7269 6e67 2c20 6c69 7374 2c20  : string, list, 
+0005e5b0: 7079 6d70 782e 456c 656d 656e 742c 2070  pympx.Element, p
+0005e5c0: 796d 7078 2e43 6f6e 7374 616e 7420 6f72  ympx.Constant or
+0005e5d0: 2070 796d 7078 2e53 7472 7563 7475 7265   pympx.Structure
+0005e5e0: 4d61 7070 6572 2e20 5374 7269 6e67 2072  Mapper. String r
+0005e5f0: 6570 7265 7365 6e74 7320 6120 636f 6c75  epresents a colu
+0005e600: 6d6e 206e 616d 652c 2061 2043 6f6e 7374  mn name, a Const
+0005e610: 616e 7420 6361 6e20 6265 2065 6974 6865  ant can be eithe
+0005e620: 7220 6120 7068 7973 6964 206f 7220 7368  r a physid or sh
+0005e630: 6f72 746e 616d 652c 2061 2053 7472 7563  ortname, a Struc
+0005e640: 7475 7265 206d 6170 7065 7220 7265 7072  ture mapper repr
+0005e650: 6573 656e 7473 2061 2068 6965 7261 7263  esents a hierarc
+0005e660: 6879 2074 7265 652e 204c 6973 7420 6361  hy tree. List ca
+0005e670: 6e20 6265 2065 6974 6865 7220 6120 6c69  n be either a li
+0005e680: 7374 206f 6620 7374 7269 6e67 7320 6f72  st of strings or
+0005e690: 2043 6f6e 7374 616e 7473 0d0a 2020 2020   Constants..    
+0005e6a0: 2020 2020 3a70 6172 616d 2064 696d 656e      :param dimen
+0005e6b0: 7369 6f6e 5f34 3a20 7374 7269 6e67 2c20  sion_4: string, 
+0005e6c0: 6c69 7374 2c20 7079 6d70 782e 456c 656d  list, pympx.Elem
+0005e6d0: 656e 742c 2070 796d 7078 2e43 6f6e 7374  ent, pympx.Const
+0005e6e0: 616e 7420 6f72 2070 796d 7078 2e53 7472  ant or pympx.Str
+0005e6f0: 7563 7475 7265 4d61 7070 6572 2e20 5374  uctureMapper. St
+0005e700: 7269 6e67 2072 6570 7265 7365 6e74 7320  ring represents 
+0005e710: 6120 636f 6c75 6d6e 206e 616d 652c 2061  a column name, a
+0005e720: 2043 6f6e 7374 616e 7420 6361 6e20 6265   Constant can be
+0005e730: 2065 6974 6865 7220 6120 7068 7973 6964   either a physid
+0005e740: 206f 7220 7368 6f72 746e 616d 652c 2061   or shortname, a
+0005e750: 2053 7472 7563 7475 7265 206d 6170 7065   Structure mappe
+0005e760: 7220 7265 7072 6573 656e 7473 2061 2068  r represents a h
+0005e770: 6965 7261 7263 6879 2074 7265 652e 204c  ierarchy tree. L
+0005e780: 6973 7420 6361 6e20 6265 2065 6974 6865  ist can be eithe
+0005e790: 7220 6120 6c69 7374 206f 6620 7374 7269  r a list of stri
+0005e7a0: 6e67 7320 6f72 2043 6f6e 7374 616e 7473  ngs or Constants
+0005e7b0: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0005e7c0: 2064 696d 656e 7369 6f6e 5f35 3a20 7374   dimension_5: st
+0005e7d0: 7269 6e67 2c20 6c69 7374 2c20 7079 6d70  ring, list, pymp
+0005e7e0: 782e 456c 656d 656e 742c 2070 796d 7078  x.Element, pympx
+0005e7f0: 2e43 6f6e 7374 616e 7420 6f72 2070 796d  .Constant or pym
+0005e800: 7078 2e53 7472 7563 7475 7265 4d61 7070  px.StructureMapp
+0005e810: 6572 2e20 5374 7269 6e67 2072 6570 7265  er. String repre
+0005e820: 7365 6e74 7320 6120 636f 6c75 6d6e 206e  sents a column n
+0005e830: 616d 652c 2061 2043 6f6e 7374 616e 7420  ame, a Constant 
+0005e840: 6361 6e20 6265 2065 6974 6865 7220 6120  can be either a 
+0005e850: 7068 7973 6964 206f 7220 7368 6f72 746e  physid or shortn
+0005e860: 616d 652c 2061 2053 7472 7563 7475 7265  ame, a Structure
+0005e870: 206d 6170 7065 7220 7265 7072 6573 656e   mapper represen
+0005e880: 7473 2061 2068 6965 7261 7263 6879 2074  ts a hierarchy t
+0005e890: 7265 652e 204c 6973 7420 6361 6e20 6265  ree. List can be
+0005e8a0: 2065 6974 6865 7220 6120 6c69 7374 206f   either a list o
+0005e8b0: 6620 7374 7269 6e67 7320 6f72 2043 6f6e  f strings or Con
+0005e8c0: 7374 616e 7473 0d0a 2020 2020 2020 2020  stants..        
+0005e8d0: 3a70 6172 616d 2064 696d 656e 7369 6f6e  :param dimension
+0005e8e0: 5f36 3a20 7374 7269 6e67 2c20 6c69 7374  _6: string, list
+0005e8f0: 2c20 7079 6d70 782e 456c 656d 656e 742c  , pympx.Element,
+0005e900: 2070 796d 7078 2e43 6f6e 7374 616e 7420   pympx.Constant 
+0005e910: 6f72 2070 796d 7078 2e53 7472 7563 7475  or pympx.Structu
+0005e920: 7265 4d61 7070 6572 2e20 5374 7269 6e67  reMapper. String
+0005e930: 2072 6570 7265 7365 6e74 7320 6120 636f   represents a co
+0005e940: 6c75 6d6e 206e 616d 652c 2061 2043 6f6e  lumn name, a Con
+0005e950: 7374 616e 7420 6361 6e20 6265 2065 6974  stant can be eit
+0005e960: 6865 7220 6120 7068 7973 6964 206f 7220  her a physid or 
+0005e970: 7368 6f72 746e 616d 652c 2061 2053 7472  shortname, a Str
+0005e980: 7563 7475 7265 206d 6170 7065 7220 7265  ucture mapper re
+0005e990: 7072 6573 656e 7473 2061 2068 6965 7261  presents a hiera
+0005e9a0: 7263 6879 2074 7265 652e 204c 6973 7420  rchy tree. List 
+0005e9b0: 6361 6e20 6265 2065 6974 6865 7220 6120  can be either a 
+0005e9c0: 6c69 7374 206f 6620 7374 7269 6e67 7320  list of strings 
+0005e9d0: 6f72 2043 6f6e 7374 616e 7473 0d0a 2020  or Constants..  
+0005e9e0: 2020 2020 2020 3a70 6172 616d 2064 696d        :param dim
+0005e9f0: 656e 7369 6f6e 5f37 3a20 7374 7269 6e67  ension_7: string
+0005ea00: 2c20 6c69 7374 2c20 7079 6d70 782e 456c  , list, pympx.El
+0005ea10: 656d 656e 742c 2070 796d 7078 2e43 6f6e  ement, pympx.Con
+0005ea20: 7374 616e 7420 6f72 2070 796d 7078 2e53  stant or pympx.S
+0005ea30: 7472 7563 7475 7265 4d61 7070 6572 2e20  tructureMapper. 
+0005ea40: 5374 7269 6e67 2072 6570 7265 7365 6e74  String represent
+0005ea50: 7320 6120 636f 6c75 6d6e 206e 616d 652c  s a column name,
+0005ea60: 2061 2043 6f6e 7374 616e 7420 6361 6e20   a Constant can 
+0005ea70: 6265 2065 6974 6865 7220 6120 7068 7973  be either a phys
+0005ea80: 6964 206f 7220 7368 6f72 746e 616d 652c  id or shortname,
+0005ea90: 2061 2053 7472 7563 7475 7265 206d 6170   a Structure map
+0005eaa0: 7065 7220 7265 7072 6573 656e 7473 2061  per represents a
+0005eab0: 2068 6965 7261 7263 6879 2074 7265 652e   hierarchy tree.
+0005eac0: 204c 6973 7420 6361 6e20 6265 2065 6974   List can be eit
+0005ead0: 6865 7220 6120 6c69 7374 206f 6620 7374  her a list of st
+0005eae0: 7269 6e67 7320 6f72 2043 6f6e 7374 616e  rings or Constan
+0005eaf0: 7473 0d0a 2020 2020 2020 2020 3a70 6172  ts..        :par
+0005eb00: 616d 206d 6f64 653a 2073 7472 696e 672c  am mode: string,
+0005eb10: 206c 6973 742c 2070 796d 7078 2e45 6c65   list, pympx.Ele
+0005eb20: 6d65 6e74 2c20 6f72 2070 796d 7078 2e43  ment, or pympx.C
+0005eb30: 6f6e 7374 616e 740d 0a20 2020 2020 2020  onstant..       
+0005eb40: 203a 7061 7261 6d20 6261 7365 3a20 7374   :param base: st
+0005eb50: 7269 6e67 2c20 7079 6d70 782e 456c 656d  ring, pympx.Elem
+0005eb60: 656e 742c 206f 7220 7079 6d70 782e 436f  ent, or pympx.Co
+0005eb70: 6e73 7461 6e74 0d0a 2020 2020 2020 2020  nstant..        
+0005eb80: 3a70 6172 616d 2074 696d 653a 2073 7472  :param time: str
+0005eb90: 696e 672c 2070 796d 7078 2e45 6c65 6d65  ing, pympx.Eleme
+0005eba0: 6e74 2c20 6f72 2070 796d 7078 2e43 6f6e  nt, or pympx.Con
+0005ebb0: 7374 616e 7420 6f72 2064 6174 6574 696d  stant or datetim
+0005ebc0: 650d 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+0005ebd0: 6d20 6d65 7472 6963 3a20 4569 7468 6572  m metric: Either
+0005ebe0: 2061 2073 7472 696e 6720 6e61 6d69 6e67   a string naming
+0005ebf0: 2074 6865 206d 6574 7269 6320 636f 6c75   the metric colu
+0005ec00: 6d6e 2c20 6f72 2061 2064 6963 7469 6f6e  mn, or a diction
+0005ec10: 6172 7920 6f66 2063 6f6c 756d 6e20 6e61  ary of column na
+0005ec20: 6d65 7320 746f 206d 6574 7269 6320 7368  mes to metric sh
+0005ec30: 6f72 746e 616d 6573 0d0a 2020 2020 2020  ortnames..      
+0005ec40: 2020 3a70 6172 616d 2076 616c 7565 5f63    :param value_c
+0005ec50: 6f6c 756d 6e3a 2057 6865 6e20 7573 696e  olumn: When usin
+0005ec60: 6720 6120 6d65 7472 6963 2063 6f6c 756d  g a metric colum
+0005ec70: 6e20 636f 6e74 6169 6e69 6e67 206d 6574  n containing met
+0005ec80: 7269 6320 2869 6e64 6963 6174 6f72 2920  ric (indicator) 
+0005ec90: 7368 6f72 7463 6f64 6520 6f72 2070 6879  shortcode or phy
+0005eca0: 7369 6473 2c20 7468 656e 2070 7574 2074  sids, then put t
+0005ecb0: 6865 206e 616d 6520 6f66 2074 6865 2076  he name of the v
+0005ecc0: 616c 7565 2063 6f6c 756d 6e20 696e 2068  alue column in h
+0005ecd0: 6572 652e 2049 6620 6d65 7472 6963 7320  ere. If metrics 
+0005ece0: 6172 6520 696e 2064 6966 6665 7265 6e74  are in different
+0005ecf0: 2063 6f6c 756d 6e73 206c 6561 7665 2074   columns leave t
+0005ed00: 6869 7320 7061 7261 6d65 7465 7220 6173  his parameter as
+0005ed10: 204e 6f6e 650d 0a20 2020 2020 2020 203a   None..        :
+0005ed20: 7061 7261 6d20 7375 626c 6f61 645f 6e61  param subload_na
+0005ed30: 6d65 3a0d 0a20 2020 2020 2020 203a 7061  me:..        :pa
+0005ed40: 7261 6d20 736f 7572 6365 5f64 6174 6166  ram source_dataf
+0005ed50: 7261 6d65 3a0d 0a20 2020 2020 2020 203a  rame:..        :
+0005ed60: 7061 7261 6d20 6967 6e6f 7265 5f7a 6572  param ignore_zer
+0005ed70: 6f5f 7661 6c75 6573 3a20 5573 7561 6c6c  o_values: Usuall
+0005ed80: 7920 7765 2064 6f20 6e6f 7420 7769 7368  y we do not wish
+0005ed90: 2074 6f20 6c6f 6164 207a 6572 6f20 7661   to load zero va
+0005eda0: 6c75 6573 2069 6e74 6f20 456d 706f 7765  lues into Empowe
+0005edb0: 722e 2054 6869 7320 666c 6167 2070 7265  r. This flag pre
+0005edc0: 7665 6e74 7320 7468 6520 7a65 726f 2076  vents the zero v
+0005edd0: 616c 7565 7320 6265 696e 6720 6c6f 6164  alues being load
+0005ede0: 6564 2069 6e74 6f20 456d 706f 7765 720d  ed into Empower.
+0005edf0: 0a20 2020 2020 2020 2027 2727 0d0a 0d0a  .        '''....
+0005ee00: 2020 2020 2020 2020 2354 4f44 4f20 2d20          #TODO - 
+0005ee10: 7468 726f 7720 6572 726f 7220 6966 2062  throw error if b
+0005ee20: 6173 6520 6973 2061 206c 6973 7420 2d20  ase is a list - 
+0005ee30: 7765 2063 616e 2774 2068 6176 6520 6d6f  we can't have mo
+0005ee40: 7265 2074 6861 6e20 6f6e 6520 6e6f 6e2d  re than one non-
+0005ee50: 6164 6469 7469 7665 2063 6f6c 756d 6e20  additive column 
+0005ee60: 2873 696e 6365 2069 7427 7320 6e6f 6e20  (since it's non 
+0005ee70: 6164 6469 7469 7665 2077 6520 776f 6e27  additive we won'
+0005ee80: 7420 6167 6772 6567 6174 6529 0d0a 0d0a  t aggregate)....
+0005ee90: 0d0a 0d0a 2020 2020 2020 2020 2346 6972  ....        #Fir
+0005eea0: 7374 2c20 6765 7420 7468 6520 7479 7065  st, get the type
+0005eeb0: 206f 6620 7472 616e 736c 6174 696f 6e20   of translation 
+0005eec0: 6461 7461 6672 616d 652c 2061 6e64 2074  dataframe, and t
+0005eed0: 6865 2063 6f6c 756d 6e20 6e61 6d65 7320  he column names 
+0005eee0: 666f 7220 6561 6368 2064 696d 656e 7369  for each dimensi
+0005eef0: 6f6e 0d0a 0d0a 2020 2020 2020 2020 6c6f  on....        lo
+0005ef00: 6f6b 7570 5f6d 6574 7269 635f 7368 6f72  okup_metric_shor
+0005ef10: 746e 616d 655f 6672 6f6d 5f63 6f6c 756d  tname_from_colum
+0005ef20: 6e20 3d20 4e6f 6e65 0d0a 2020 2020 2020  n = None..      
+0005ef30: 2020 6479 6e61 6d69 635f 6d65 7472 6963    dynamic_metric
+0005ef40: 5f63 6f6c 756d 6e73 2020 2020 2020 2020  _columns        
+0005ef50: 2020 2020 2020 3d20 4e6f 6e65 0d0a 0d0a        = None....
+0005ef60: 2020 2020 2020 2020 6966 2073 7562 6c6f          if sublo
+0005ef70: 6164 5f6e 616d 6520 6973 204e 6f6e 653a  ad_name is None:
+0005ef80: 0d0a 2020 2020 2020 2020 2020 2020 7375  ..            su
+0005ef90: 626c 6f61 645f 6e61 6d65 203d 2027 7375  bload_name = 'su
+0005efa0: 626c 6f61 645f 3027 0d0a 0d0a 0d0a 2020  bload_0'......  
+0005efb0: 2020 2020 2020 6966 2065 6d70 6f77 6572        if empower
+0005efc0: 5f70 6572 696f 645f 7479 7065 2069 7320  _period_type is 
+0005efd0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0005efe0: 2020 2065 6d70 6f77 6572 5f70 6572 696f     empower_perio
+0005eff0: 645f 7479 7065 3d20 7365 6c66 2e65 6d70  d_type= self.emp
+0005f000: 6f77 6572 5f70 6572 696f 645f 7479 7065  ower_period_type
+0005f010: 0d0a 0d0a 2020 2020 2020 2020 7472 793a  ....        try:
+0005f020: 0d0a 2020 2020 2020 2020 2020 2020 2343  ..            #C
+0005f030: 6865 636b 2069 6620 6d65 7472 6963 2069  heck if metric i
+0005f040: 7320 6120 7374 7269 6e67 0d0a 2020 2020  s a string..    
+0005f050: 2020 2020 2020 2020 6d65 7472 6963 3d6d          metric=m
+0005f060: 6574 7269 632b 2727 0d0a 0d0a 2020 2020  etric+''....    
+0005f070: 2020 2020 2020 2020 6479 6e61 6d69 635f          dynamic_
+0005f080: 6d65 7472 6963 5f63 6f6c 756d 6e73 203d  metric_columns =
+0005f090: 205b 6d65 7472 6963 5d0d 0a20 2020 2020   [metric]..     
+0005f0a0: 2020 2065 7863 6570 7420 5479 7065 4572     except TypeEr
+0005f0b0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+0005f0c0: 2020 236d 6574 7269 6320 6973 206e 6f74    #metric is not
+0005f0d0: 2061 2073 7472 696e 6720 2d20 6974 2069   a string - it i
+0005f0e0: 7320 6120 6469 6374 0d0a 2020 2020 2020  s a dict..      
+0005f0f0: 2020 2020 2020 6c6f 6f6b 7570 5f6d 6574        lookup_met
+0005f100: 7269 635f 7368 6f72 746e 616d 655f 6672  ric_shortname_fr
+0005f110: 6f6d 5f63 6f6c 756d 6e20 3d20 6d65 7472  om_column = metr
+0005f120: 6963 0d0a 0d0a 2020 2020 2020 2020 6966  ic....        if
+0005f130: 2073 6f75 7263 655f 6461 7461 6672 616d   source_datafram
+0005f140: 6520 6973 206e 6f74 204e 6f6e 653a 0d0a  e is not None:..
+0005f150: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0005f160: 6672 616d 6520 3d20 736f 7572 6365 5f64  frame = source_d
+0005f170: 6174 6166 7261 6d65 2e63 6f70 7928 290d  ataframe.copy().
+0005f180: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+0005f190: 2020 2020 2020 2020 2020 2020 6461 7461              data
+0005f1a0: 6672 616d 6520 3d20 7365 6c66 2e64 662e  frame = self.df.
+0005f1b0: 636f 7079 2829 0d0a 0d0a 2020 2020 2020  copy()....      
+0005f1c0: 2020 6465 6620 5f64 6563 6964 655f 6d61    def _decide_ma
+0005f1d0: 7070 6572 5f74 7970 6528 6d61 7070 6572  pper_type(mapper
+0005f1e0: 5f69 6e70 7574 293a 0d0a 2020 2020 2020  _input):..      
+0005f1f0: 2020 2020 2020 2363 6f6e 7665 7274 2074        #convert t
+0005f200: 6865 2069 6e70 7574 2074 6f20 6120 7374  he input to a st
+0005f210: 616e 6461 7264 206d 6170 7065 7220 7479  andard mapper ty
+0005f220: 7065 0d0a 2020 2020 2020 2020 2020 2020  pe..            
+0005f230: 236d 6170 7065 7220 696e 7075 7420 6d61  #mapper input ma
+0005f240: 7920 6265 206e 6f6e 6520 6966 2074 6865  y be none if the
+0005f250: 2064 696d 656e 7369 6f6e 7320 6973 206e   dimensions is n
+0005f260: 6f74 2070 7265 7365 6e74 0d0a 2020 2020  ot present..    
+0005f270: 2020 2020 2020 2020 6966 206d 6170 7065          if mappe
+0005f280: 725f 696e 7075 7420 6973 204e 6f6e 653a  r_input is None:
+0005f290: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005f2a0: 2020 7265 7475 726e 2043 6f6e 7374 616e    return Constan
+0005f2b0: 7428 2d31 290d 0a20 2020 2020 2020 2020  t(-1)..         
+0005f2c0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0005f2d0: 286d 6170 7065 725f 696e 7075 742c 2053  (mapper_input, S
+0005f2e0: 7472 7563 7475 7265 4d61 7070 6572 293a  tructureMapper):
+0005f2f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0005f300: 2020 7265 7475 726e 206d 6170 7065 725f    return mapper_
+0005f310: 696e 7075 740d 0a20 2020 2020 2020 2020  input..         
+0005f320: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0005f330: 286d 6170 7065 725f 696e 7075 742c 2043  (mapper_input, C
+0005f340: 6f6e 7374 616e 7429 3a0d 0a20 2020 2020  onstant):..     
+0005f350: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0005f360: 6e20 6d61 7070 6572 5f69 6e70 7574 0d0a  n mapper_input..
+0005f370: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+0005f380: 7369 6e73 7461 6e63 6528 6d61 7070 6572  sinstance(mapper
+0005f390: 5f69 6e70 7574 2c20 436f 6c75 6d6e 4d61  _input, ColumnMa
+0005f3a0: 7070 6572 293a 0d0a 2020 2020 2020 2020  pper):..        
+0005f3b0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+0005f3c0: 6170 7065 725f 696e 7075 740d 0a20 2020  apper_input..   
+0005f3d0: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+0005f3e0: 7374 616e 6365 286d 6170 7065 725f 696e  stance(mapper_in
+0005f3f0: 7075 742c 2073 7472 293a 0d0a 2020 2020  put, str):..    
+0005f400: 2020 2020 2020 2020 2020 2020 2354 4f44              #TOD
+0005f410: 4f20 2d20 6469 6666 6572 656e 7469 6174  O - differentiat
+0005f420: 6520 6265 7477 6565 6e20 7374 7220 616e  e between str an
+0005f430: 6420 696e 742f 666c 6f61 7420 7064 2e53  d int/float pd.S
+0005f440: 6572 6965 732c 2061 6e64 2072 6574 7572  eries, and retur
+0005f450: 6e20 7368 6f72 746e 616d 6520 6f72 2070  n shortname or p
+0005f460: 6879 7369 6420 6d61 7070 6572 2061 6363  hysid mapper acc
+0005f470: 6f72 6469 6e67 6c79 0d0a 2020 2020 2020  ordingly..      
+0005f480: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0005f490: 2043 6f6c 756d 6e4d 6170 7065 7228 636f   ColumnMapper(co
+0005f4a0: 6c75 6d6e 5f6e 616d 6520 2020 2020 3d20  lumn_name     = 
+0005f4b0: 6d61 7070 6572 5f69 6e70 7574 0d0a 2020  mapper_input..  
+0005f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f4e0: 202c 636f 6c75 6d6e 5f74 7970 6520 2020   ,column_type   
+0005f4f0: 2020 3d20 2773 686f 7274 6e61 6d65 270d    = 'shortname'.
+0005f500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0005f510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f520: 2020 2020 2c66 6965 6c64 5f73 686f 7274      ,field_short
+0005f530: 6e61 6d65 203d 204e 6f6e 650d 0a20 2020  name = None..   
+0005f540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0005f560: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
+0005f570: 2023 544f 446f 202d 2068 616e 646c 6520   #TODo - handle 
+0005f580: 6c69 7374 7320 6f66 2063 6f6c 756d 6e73  lists of columns
+0005f590: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0005f5a0: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+0005f5b0: 4361 6e6e 6f74 206d 6170 2066 726f 6d20  Cannot map from 
+0005f5c0: 696e 7075 7420 272b 7374 7228 6d61 7070  input '+str(mapp
+0005f5d0: 6572 5f69 6e70 7574 2929 0d0a 0d0a 2020  er_input))....  
+0005f5e0: 2020 2020 2020 6469 6d65 6e73 696f 6e5f        dimension_
+0005f5f0: 305f 6d61 7070 6572 203d 205f 6465 6369  0_mapper = _deci
+0005f600: 6465 5f6d 6170 7065 725f 7479 7065 2864  de_mapper_type(d
+0005f610: 696d 656e 7369 6f6e 5f30 290d 0a20 2020  imension_0)..   
+0005f620: 2020 2020 2064 696d 656e 7369 6f6e 5f31       dimension_1
+0005f630: 5f6d 6170 7065 7220 3d20 5f64 6563 6964  _mapper = _decid
+0005f640: 655f 6d61 7070 6572 5f74 7970 6528 6469  e_mapper_type(di
+0005f650: 6d65 6e73 696f 6e5f 3129 0d0a 2020 2020  mension_1)..    
+0005f660: 2020 2020 6469 6d65 6e73 696f 6e5f 325f      dimension_2_
+0005f670: 6d61 7070 6572 203d 205f 6465 6369 6465  mapper = _decide
+0005f680: 5f6d 6170 7065 725f 7479 7065 2864 696d  _mapper_type(dim
+0005f690: 656e 7369 6f6e 5f32 290d 0a20 2020 2020  ension_2)..     
+0005f6a0: 2020 2064 696d 656e 7369 6f6e 5f33 5f6d     dimension_3_m
+0005f6b0: 6170 7065 7220 3d20 5f64 6563 6964 655f  apper = _decide_
+0005f6c0: 6d61 7070 6572 5f74 7970 6528 6469 6d65  mapper_type(dime
+0005f6d0: 6e73 696f 6e5f 3329 0d0a 2020 2020 2020  nsion_3)..      
+0005f6e0: 2020 6469 6d65 6e73 696f 6e5f 345f 6d61    dimension_4_ma
+0005f6f0: 7070 6572 203d 205f 6465 6369 6465 5f6d  pper = _decide_m
+0005f700: 6170 7065 725f 7479 7065 2864 696d 656e  apper_type(dimen
+0005f710: 7369 6f6e 5f34 290d 0a20 2020 2020 2020  sion_4)..       
+0005f720: 2064 696d 656e 7369 6f6e 5f35 5f6d 6170   dimension_5_map
+0005f730: 7065 7220 3d20 5f64 6563 6964 655f 6d61  per = _decide_ma
+0005f740: 7070 6572 5f74 7970 6528 6469 6d65 6e73  pper_type(dimens
+0005f750: 696f 6e5f 3529 0d0a 2020 2020 2020 2020  ion_5)..        
+0005f760: 6469 6d65 6e73 696f 6e5f 365f 6d61 7070  dimension_6_mapp
+0005f770: 6572 203d 205f 6465 6369 6465 5f6d 6170  er = _decide_map
+0005f780: 7065 725f 7479 7065 2864 696d 656e 7369  per_type(dimensi
+0005f790: 6f6e 5f36 290d 0a20 2020 2020 2020 2064  on_6)..        d
+0005f7a0: 696d 656e 7369 6f6e 5f37 5f6d 6170 7065  imension_7_mappe
+0005f7b0: 7220 3d20 5f64 6563 6964 655f 6d61 7070  r = _decide_mapp
+0005f7c0: 6572 5f74 7970 6528 6469 6d65 6e73 696f  er_type(dimensio
+0005f7d0: 6e5f 3729 0d0a 2020 2020 2020 2020 6d6f  n_7)..        mo
+0005f7e0: 6465 5f6d 6170 7065 7220 2020 2020 2020  de_mapper       
+0005f7f0: 203d 205f 6465 6369 6465 5f6d 6170 7065   = _decide_mappe
+0005f800: 725f 7479 7065 286d 6f64 6529 0d0a 2020  r_type(mode)..  
+0005f810: 2020 2020 2020 6261 7365 5f6d 6170 7065        base_mappe
+0005f820: 7220 2020 2020 2020 203d 205f 6465 6369  r        = _deci
+0005f830: 6465 5f6d 6170 7065 725f 7479 7065 2862  de_mapper_type(b
+0005f840: 6173 6529 0d0a 2020 2020 2020 2020 6966  ase)..        if
+0005f850: 2064 796e 616d 6963 5f6d 6574 7269 635f   dynamic_metric_
+0005f860: 636f 6c75 6d6e 7320 6973 206e 6f74 204e  columns is not N
+0005f870: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0005f880: 2020 6d65 7472 6963 5f6d 6170 7065 7220    metric_mapper 
+0005f890: 3d20 5f64 6563 6964 655f 6d61 7070 6572  = _decide_mapper
+0005f8a0: 5f74 7970 6528 6d65 7472 6963 290d 0a0d  _type(metric)...
+0005f8b0: 0a20 2020 2020 2020 2064 696d 656e 7369  .        dimensi
+0005f8c0: 6f6e 5f30 5f63 6f6c 756d 6e73 203d 205b  on_0_columns = [
+0005f8d0: 5d0d 0a20 2020 2020 2020 2064 696d 656e  ]..        dimen
+0005f8e0: 7369 6f6e 5f31 5f63 6f6c 756d 6e73 203d  sion_1_columns =
+0005f8f0: 205b 5d0d 0a20 2020 2020 2020 2064 696d   []..        dim
+0005f900: 656e 7369 6f6e 5f32 5f63 6f6c 756d 6e73  ension_2_columns
+0005f910: 203d 205b 5d0d 0a20 2020 2020 2020 2064   = []..        d
+0005f920: 696d 656e 7369 6f6e 5f33 5f63 6f6c 756d  imension_3_colum
+0005f930: 6e73 203d 205b 5d0d 0a20 2020 2020 2020  ns = []..       
+0005f940: 2064 696d 656e 7369 6f6e 5f34 5f63 6f6c   dimension_4_col
+0005f950: 756d 6e73 203d 205b 5d0d 0a20 2020 2020  umns = []..     
+0005f960: 2020 2064 696d 656e 7369 6f6e 5f35 5f63     dimension_5_c
+0005f970: 6f6c 756d 6e73 203d 205b 5d0d 0a20 2020  olumns = []..   
+0005f980: 2020 2020 2064 696d 656e 7369 6f6e 5f36       dimension_6
+0005f990: 5f63 6f6c 756d 6e73 203d 205b 5d0d 0a20  _columns = [].. 
+0005f9a0: 2020 2020 2020 2064 696d 656e 7369 6f6e         dimension
+0005f9b0: 5f37 5f63 6f6c 756d 6e73 203d 205b 5d0d  _7_columns = [].
+0005f9c0: 0a0d 0a0d 0a20 2020 2020 2020 2069 6620  .....        if 
+0005f9d0: 7365 6c66 2e73 6974 652e 6e75 6d62 6572  self.site.number
+0005f9e0: 5f6f 665f 756e 6974 5f64 696d 656e 7369  _of_unit_dimensi
+0005f9f0: 6f6e 7320 3e3d 313a 0d0a 2020 2020 2020  ons >=1:..      
+0005fa00: 2020 2020 2020 6469 6d65 6e73 696f 6e5f        dimension_
+0005fa10: 305f 636f 6c75 6d6e 7320 3d20 6469 6d65  0_columns = dime
+0005fa20: 6e73 696f 6e5f 305f 6d61 7070 6572 2e6d  nsion_0_mapper.m
+0005fa30: 6170 5f64 6174 6166 7261 6d65 2864 6174  ap_dataframe(dat
+0005fa40: 6166 7261 6d65 3d64 6174 6166 7261 6d65  aframe=dataframe
+0005fa50: 2c64 696d 656e 7369 6f6e 3d73 656c 662e  ,dimension=self.
+0005fa60: 7369 7465 2e64 696d 656e 7369 6f6e 735b  site.dimensions[
+0005fa70: 305d 2c6c 6f61 6465 723d 7365 6c66 290d  0],loader=self).
+0005fa80: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0005fa90: 2e73 6974 652e 6e75 6d62 6572 5f6f 665f  .site.number_of_
+0005faa0: 756e 6974 5f64 696d 656e 7369 6f6e 7320  unit_dimensions 
+0005fab0: 3e3d 323a 0d0a 2020 2020 2020 2020 2020  >=2:..          
+0005fac0: 2020 6469 6d65 6e73 696f 6e5f 315f 636f    dimension_1_co
+0005fad0: 6c75 6d6e 7320 3d20 6469 6d65 6e73 696f  lumns = dimensio
+0005fae0: 6e5f 315f 6d61 7070 6572 2e6d 6170 5f64  n_1_mapper.map_d
+0005faf0: 6174 6166 7261 6d65 2864 6174 6166 7261  ataframe(datafra
+0005fb00: 6d65 3d64 6174 6166 7261 6d65 2c64 696d  me=dataframe,dim
+0005fb10: 656e 7369 6f6e 3d73 656c 662e 7369 7465  ension=self.site
+0005fb20: 2e64 696d 656e 7369 6f6e 735b 315d 2c6c  .dimensions[1],l
+0005fb30: 6f61 6465 723d 7365 6c66 290d 0a20 2020  oader=self)..   
+0005fb40: 2020 2020 2069 6620 7365 6c66 2e73 6974       if self.sit
+0005fb50: 652e 6e75 6d62 6572 5f6f 665f 756e 6974  e.number_of_unit
+0005fb60: 5f64 696d 656e 7369 6f6e 7320 3e3d 333a  _dimensions >=3:
+0005fb70: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+0005fb80: 6d65 6e73 696f 6e5f 325f 636f 6c75 6d6e  mension_2_column
+0005fb90: 7320 3d20 6469 6d65 6e73 696f 6e5f 325f  s = dimension_2_
+0005fba0: 6d61 7070 6572 2e6d 6170 5f64 6174 6166  mapper.map_dataf
+0005fbb0: 7261 6d65 2864 6174 6166 7261 6d65 3d64  rame(dataframe=d
+0005fbc0: 6174 6166 7261 6d65 2c64 696d 656e 7369  ataframe,dimensi
+0005fbd0: 6f6e 3d73 656c 662e 7369 7465 2e64 696d  on=self.site.dim
+0005fbe0: 656e 7369 6f6e 735b 325d 2c6c 6f61 6465  ensions[2],loade
+0005fbf0: 723d 7365 6c66 290d 0a20 2020 2020 2020  r=self)..       
+0005fc00: 2069 6620 7365 6c66 2e73 6974 652e 6e75   if self.site.nu
+0005fc10: 6d62 6572 5f6f 665f 756e 6974 5f64 696d  mber_of_unit_dim
+0005fc20: 656e 7369 6f6e 7320 3e3d 343a 0d0a 2020  ensions >=4:..  
+0005fc30: 2020 2020 2020 2020 2020 6469 6d65 6e73            dimens
+0005fc40: 696f 6e5f 335f 636f 6c75 6d6e 7320 3d20  ion_3_columns = 
+0005fc50: 6469 6d65 6e73 696f 6e5f 335f 6d61 7070  dimension_3_mapp
+0005fc60: 6572 2e6d 6170 5f64 6174 6166 7261 6d65  er.map_dataframe
+0005fc70: 2864 6174 6166 7261 6d65 3d64 6174 6166  (dataframe=dataf
+0005fc80: 7261 6d65 2c64 696d 656e 7369 6f6e 3d73  rame,dimension=s
+0005fc90: 656c 662e 7369 7465 2e64 696d 656e 7369  elf.site.dimensi
+0005fca0: 6f6e 735b 335d 2c6c 6f61 6465 723d 7365  ons[3],loader=se
+0005fcb0: 6c66 290d 0a20 2020 2020 2020 2069 6620  lf)..        if 
+0005fcc0: 7365 6c66 2e73 6974 652e 6e75 6d62 6572  self.site.number
+0005fcd0: 5f6f 665f 756e 6974 5f64 696d 656e 7369  _of_unit_dimensi
+0005fce0: 6f6e 7320 3e3d 353a 0d0a 2020 2020 2020  ons >=5:..      
+0005fcf0: 2020 2020 2020 6469 6d65 6e73 696f 6e5f        dimension_
+0005fd00: 345f 636f 6c75 6d6e 7320 3d20 6469 6d65  4_columns = dime
+0005fd10: 6e73 696f 6e5f 345f 6d61 7070 6572 2e6d  nsion_4_mapper.m
+0005fd20: 6170 5f64 6174 6166 7261 6d65 2864 6174  ap_dataframe(dat
+0005fd30: 6166 7261 6d65 3d64 6174 6166 7261 6d65  aframe=dataframe
+0005fd40: 2c64 696d 656e 7369 6f6e 3d73 656c 662e  ,dimension=self.
+0005fd50: 7369 7465 2e64 696d 656e 7369 6f6e 735b  site.dimensions[
+0005fd60: 345d 2c6c 6f61 6465 723d 7365 6c66 290d  4],loader=self).
+0005fd70: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0005fd80: 2e73 6974 652e 6e75 6d62 6572 5f6f 665f  .site.number_of_
+0005fd90: 756e 6974 5f64 696d 656e 7369 6f6e 7320  unit_dimensions 
+0005fda0: 3e3d 363a 0d0a 2020 2020 2020 2020 2020  >=6:..          
+0005fdb0: 2020 6469 6d65 6e73 696f 6e5f 355f 636f    dimension_5_co
+0005fdc0: 6c75 6d6e 7320 3d20 6469 6d65 6e73 696f  lumns = dimensio
+0005fdd0: 6e5f 355f 6d61 7070 6572 2e6d 6170 5f64  n_5_mapper.map_d
+0005fde0: 6174 6166 7261 6d65 2864 6174 6166 7261  ataframe(datafra
+0005fdf0: 6d65 3d64 6174 6166 7261 6d65 2c64 696d  me=dataframe,dim
+0005fe00: 656e 7369 6f6e 3d73 656c 662e 7369 7465  ension=self.site
+0005fe10: 2e64 696d 656e 7369 6f6e 735b 355d 2c6c  .dimensions[5],l
+0005fe20: 6f61 6465 723d 7365 6c66 290d 0a20 2020  oader=self)..   
+0005fe30: 2020 2020 2069 6620 7365 6c66 2e73 6974       if self.sit
+0005fe40: 652e 6e75 6d62 6572 5f6f 665f 756e 6974  e.number_of_unit
+0005fe50: 5f64 696d 656e 7369 6f6e 7320 3e3d 373a  _dimensions >=7:
+0005fe60: 0d0a 2020 2020 2020 2020 2020 2020 6469  ..            di
+0005fe70: 6d65 6e73 696f 6e5f 365f 636f 6c75 6d6e  mension_6_column
+0005fe80: 7320 3d20 6469 6d65 6e73 696f 6e5f 365f  s = dimension_6_
+0005fe90: 6d61 7070 6572 2e6d 6170 5f64 6174 6166  mapper.map_dataf
+0005fea0: 7261 6d65 2864 6174 6166 7261 6d65 3d64  rame(dataframe=d
+0005feb0: 6174 6166 7261 6d65 2c64 696d 656e 7369  ataframe,dimensi
+0005fec0: 6f6e 3d73 656c 662e 7369 7465 2e64 696d  on=self.site.dim
+0005fed0: 656e 7369 6f6e 735b 365d 2c6c 6f61 6465  ensions[6],loade
+0005fee0: 723d 7365 6c66 290d 0a20 2020 2020 2020  r=self)..       
+0005fef0: 2069 6620 7365 6c66 2e73 6974 652e 6e75   if self.site.nu
+0005ff00: 6d62 6572 5f6f 665f 756e 6974 5f64 696d  mber_of_unit_dim
+0005ff10: 656e 7369 6f6e 7320 3e3d 383a 0d0a 2020  ensions >=8:..  
+0005ff20: 2020 2020 2020 2020 2020 6469 6d65 6e73            dimens
+0005ff30: 696f 6e5f 375f 636f 6c75 6d6e 7320 3d20  ion_7_columns = 
+0005ff40: 6469 6d65 6e73 696f 6e5f 375f 6d61 7070  dimension_7_mapp
+0005ff50: 6572 2e6d 6170 5f64 6174 6166 7261 6d65  er.map_dataframe
+0005ff60: 2864 6174 6166 7261 6d65 3d64 6174 6166  (dataframe=dataf
+0005ff70: 7261 6d65 2c64 696d 656e 7369 6f6e 3d73  rame,dimension=s
+0005ff80: 656c 662e 7369 7465 2e64 696d 656e 7369  elf.site.dimensi
+0005ff90: 6f6e 735b 375d 2c6c 6f61 6465 723d 7365  ons[7],loader=se
+0005ffa0: 6c66 290d 0a0d 0a20 2020 2020 2020 206d  lf)....        m
+0005ffb0: 6f64 655f 636f 6c75 6d6e 7320 2020 2020  ode_columns     
+0005ffc0: 2020 203d 206d 6f64 655f 6d61 7070 6572     = mode_mapper
+0005ffd0: 2e6d 6170 5f64 6174 6166 7261 6d65 2864  .map_dataframe(d
+0005ffe0: 6174 6166 7261 6d65 3d64 6174 6166 7261  ataframe=datafra
+0005fff0: 6d65 2c64 696d 656e 7369 6f6e 3d73 656c  me,dimension=sel
+00060000: 662e 7369 7465 2e64 696d 656e 7369 6f6e  f.site.dimension
+00060010: 735b 395d 2c6c 6f61 6465 723d 7365 6c66  s[9],loader=self
+00060020: 290d 0a20 2020 2020 2020 2062 6173 655f  )..        base_
+00060030: 636f 6c75 6d6e 7320 2020 2020 2020 203d  columns        =
+00060040: 2062 6173 655f 6d61 7070 6572 2e6d 6170   base_mapper.map
+00060050: 5f64 6174 6166 7261 6d65 2864 6174 6166  _dataframe(dataf
+00060060: 7261 6d65 3d64 6174 6166 7261 6d65 2c64  rame=dataframe,d
+00060070: 696d 656e 7369 6f6e 3d73 656c 662e 7369  imension=self.si
+00060080: 7465 2e64 696d 656e 7369 6f6e 735b 3130  te.dimensions[10
+00060090: 5d2c 6c6f 6164 6572 3d73 656c 6629 0d0a  ],loader=self)..
+000600a0: 2020 2020 2020 2020 6966 2064 796e 616d          if dynam
+000600b0: 6963 5f6d 6574 7269 635f 636f 6c75 6d6e  ic_metric_column
+000600c0: 7320 6973 206e 6f74 204e 6f6e 653a 0d0a  s is not None:..
+000600d0: 2020 2020 2020 2020 2020 2020 6479 6e61              dyna
+000600e0: 6d69 635f 6d65 7472 6963 5f63 6f6c 756d  mic_metric_colum
+000600f0: 6e73 203d 206d 6574 7269 635f 6d61 7070  ns = metric_mapp
+00060100: 6572 2e6d 6170 5f64 6174 6166 7261 6d65  er.map_dataframe
+00060110: 2864 6174 6166 7261 6d65 3d64 6174 6166  (dataframe=dataf
+00060120: 7261 6d65 2c64 696d 656e 7369 6f6e 3d73  rame,dimension=s
+00060130: 656c 662e 7369 7465 2e64 696d 656e 7369  elf.site.dimensi
+00060140: 6f6e 735b 385d 2c6c 6f61 6465 723d 7365  ons[8],loader=se
+00060150: 6c66 290d 0a0d 0a20 2020 2020 2020 2023  lf)....        #
+00060160: 4d61 7020 7469 6d65 2074 6f20 656d 706f  Map time to empo
+00060170: 7765 7220 6461 7465 2074 7570 6c65 730d  wer date tuples.
+00060180: 0a20 2020 2020 2020 2023 6e65 6564 7320  .        #needs 
+00060190: 656d 706f 7765 725f 7965 6172 2065 7463  empower_year etc
+000601a0: 2e20 636f 6c75 6d6e 730d 0a20 2020 2020  . columns..     
+000601b0: 2020 2064 6174 6166 7261 6d65 5b27 656d     dataframe['em
+000601c0: 706f 7765 7220 7065 7269 6f64 2074 7970  power period typ
+000601d0: 6527 5d20 3d20 656d 706f 7765 725f 7065  e'] = empower_pe
+000601e0: 7269 6f64 5f74 7970 650d 0a20 2020 2020  riod_type..     
+000601f0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00060200: 2874 696d 652c 2064 6174 6574 696d 652e  (time, datetime.
+00060210: 6461 7465 7469 6d65 293a 0d0a 2020 2020  datetime):..    
+00060220: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
+00060230: 655b 2765 6d70 6f77 6572 2079 6561 7227  e['empower year'
+00060240: 5d20 2020 2020 2020 203d 2074 696d 652e  ]        = time.
+00060250: 7965 6172 0d0a 2020 2020 2020 2020 2020  year..          
+00060260: 2020 6461 7461 6672 616d 655b 2765 6d70    dataframe['emp
+00060270: 6f77 6572 2070 6572 696f 6427 5d20 2020  ower period']   
+00060280: 2020 203d 2074 696d 652e 6d6f 6e74 680d     = time.month.
+00060290: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+000602a0: 2020 2020 2020 2020 2020 2020 2361 7373              #ass
+000602b0: 756d 6520 7468 6520 7469 6d65 2069 7320  ume the time is 
+000602c0: 6120 636f 6c75 6d6e 206e 616d 650d 0a20  a column name.. 
+000602d0: 2020 2020 2020 2020 2020 2023 5265 6164             #Read
+000602e0: 2074 6865 2074 696d 6520 6672 6f6d 2074   the time from t
+000602f0: 6865 2063 6f6c 756d 6e20 6e61 6d65 2067  he column name g
+00060300: 6976 656e 0d0a 2020 2020 2020 2020 2020  iven..          
+00060310: 2020 2374 7572 6e20 6974 2069 6e74 6f20    #turn it into 
+00060320: 616e 2065 6d70 6f77 6572 2074 7570 6c65  an empower tuple
+00060330: 0d0a 2020 2020 2020 2020 2020 2020 6461  ..            da
+00060340: 7461 6672 616d 655b 2765 6d70 6f77 6572  taframe['empower
+00060350: 2079 6561 7227 5d20 2020 2020 2020 203d   year']        =
+00060360: 2064 6174 6166 7261 6d65 5b74 696d 655d   dataframe[time]
+00060370: 2e64 742e 7965 6172 0d0a 2020 2020 2020  .dt.year..      
+00060380: 2020 2020 2020 6461 7461 6672 616d 655b        dataframe[
+00060390: 2765 6d70 6f77 6572 2070 6572 696f 6427  'empower period'
+000603a0: 5d20 2020 2020 203d 2064 6174 6166 7261  ]      = datafra
+000603b0: 6d65 5b74 696d 655d 2e64 742e 6d6f 6e74  me[time].dt.mont
+000603c0: 680d 0a0d 0a0d 0a20 2020 2020 2020 2066  h......        f
+000603d0: 6f72 2064 6972 2069 6e20 5b73 656c 662e  or dir in [self.
+000603e0: 7369 7465 2e5f 6275 6c6b 5f6c 6f61 645f  site._bulk_load_
+000603f0: 696e 7465 726d 6564 6961 7465 5f64 6972  intermediate_dir
+00060400: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00060410: 2020 2020 202c 7365 6c66 2e73 6974 652e       ,self.site.
+00060420: 5f6c 6f61 645f 7072 6f63 6573 7369 6e67  _load_processing
+00060430: 5f64 6972 0d0a 2020 2020 2020 2020 2020  _dir..          
+00060440: 2020 2020 2020 2020 202c 7365 6c66 2e73           ,self.s
+00060450: 6974 652e 5f6f 7574 7075 745f 6461 7461  ite._output_data
+00060460: 5f66 696c 6573 5f64 6972 0d0a 2020 2020  _files_dir..    
+00060470: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00060480: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+00060490: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+000604a0: 2020 2020 2020 206f 732e 6d61 6b65 6469         os.makedi
+000604b0: 7273 2864 6972 290d 0a20 2020 2020 2020  rs(dir)..       
+000604c0: 2020 2020 2065 7863 6570 7420 4669 6c65       except File
+000604d0: 4578 6973 7473 4572 726f 723a 0d0a 2020  ExistsError:..  
+000604e0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000604f0: 7373 0d0a 2020 2020 2020 2020 2020 2020  ss..            
+00060500: 6578 6365 7074 204f 5345 7272 6f72 2061  except OSError a
+00060510: 7320 653a 0d0a 2020 2020 2020 2020 2020  s e:..          
+00060520: 2020 2020 2020 6966 2065 2e77 696e 6572        if e.winer
+00060530: 726f 7220 3d3d 2031 3233 3a0d 0a20 2020  ror == 123:..   
+00060540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060550: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00060560: 7228 2744 6972 6563 746f 7279 2022 7b7d  r('Directory "{}
+00060570: 2220 6861 7320 616e 2069 6e76 616c 6964  " has an invalid
+00060580: 206e 616d 652e 2044 6964 2079 6f75 2070   name. Did you p
+00060590: 6173 7320 6120 7369 7465 5f6c 6f63 6174  ass a site_locat
+000605a0: 6f72 2070 6174 6820 227b 7d22 2077 6974  or path "{}" wit
+000605b0: 686f 7574 2064 6f75 626c 652d 6573 6361  hout double-esca
+000605c0: 7069 6e67 2062 6163 6b73 6c61 7368 6573  ping backslashes
+000605d0: 206f 7220 7072 6566 6978 696e 6720 7468   or prefixing th
+000605e0: 6520 7374 7269 6e67 2077 6974 6820 616e  e string with an
+000605f0: 2022 7222 2066 6f72 2072 6177 3f27 2e66   "r" for raw?'.f
+00060600: 6f72 6d61 7428 6469 722c 7265 7072 2873  ormat(dir,repr(s
+00060610: 6974 655f 6c6f 6361 746f 7229 2929 0d0a  ite_locator)))..
+00060620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060630: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+00060640: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00060650: 2065 0d0a 0d0a 2020 2020 2020 2020 2343   e....        #C
+00060660: 7265 6174 6520 7468 6520 6669 6c65 206e  reate the file n
+00060670: 616d 6573 2061 7574 6f6d 6174 6963 616c  ames automatical
+00060680: 6c79 0d0a 2020 2020 2020 2020 696e 7465  ly..        inte
+00060690: 726d 6564 6961 7465 5f66 696c 655f 6e61  rmediate_file_na
+000606a0: 6d65 203d 206f 732e 7061 7468 2e6a 6f69  me = os.path.joi
+000606b0: 6e28 7365 6c66 2e73 6974 652e 5f62 756c  n(self.site._bul
+000606c0: 6b5f 6c6f 6164 5f69 6e74 6572 6d65 6469  k_load_intermedi
+000606d0: 6174 655f 6469 722c 0d0a 2020 2020 2020  ate_dir,..      
+000606e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000606f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060700: 2020 2020 2020 4c6f 6164 6572 2e5f 6765        Loader._ge
+00060710: 745f 696e 7465 726d 6564 6961 7465 5f66  t_intermediate_f
+00060720: 696c 655f 6e61 6d65 286c 6f61 6465 725f  ile_name(loader_
+00060730: 6e61 6d65 2020 3d20 7365 6c66 2e6e 616d  name  = self.nam
+00060740: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00060750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060770: 2020 2c73 7562 6c6f 6164 5f6e 616d 6520    ,subload_name 
+00060780: 3d20 7375 626c 6f61 645f 6e61 6d65 0d0a  = subload_name..
+00060790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000607a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000607b0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+000607c0: 7369 7465 5f70 7265 6669 7820 203d 2073  site_prefix  = s
+000607d0: 656c 662e 7369 7465 2e70 7265 6669 780d  elf.site.prefix.
+000607e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000607f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00060800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060820: 2020 2020 2020 2020 202c 656d 706f 7765           ,empowe
-00060830: 725f 7065 7269 6f64 5f74 7970 653d 656d  r_period_type=em
-00060840: 706f 7765 725f 7065 7269 6f64 5f74 7970  power_period_typ
-00060850: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00060860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060880: 2020 290d 0a20 2020 2020 2020 2020 2020    )..           
+00060810: 2c74 696d 6520 2020 2020 2020 2020 3d20  ,time         = 
+00060820: 7469 6d65 0d0a 2020 2020 2020 2020 2020  time..          
+00060830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060850: 2020 2020 202c 656d 706f 7765 725f 7065       ,empower_pe
+00060860: 7269 6f64 5f74 7970 653d 656d 706f 7765  riod_type=empowe
+00060870: 725f 7065 7269 6f64 5f74 7970 650d 0a20  r_period_type.. 
+00060880: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00060890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000608a0: 2020 2020 2020 2029 0d0a 2020 2020 2020         )..      
-000608b0: 2020 7461 7267 6574 5f66 696c 655f 6e61    target_file_na
-000608c0: 6d65 203d 206f 732e 7061 7468 2e6a 6f69  me = os.path.joi
-000608d0: 6e28 7365 6c66 2e73 6974 652e 5f62 756c  n(self.site._bul
-000608e0: 6b5f 6c6f 6164 5f69 6e74 6572 6d65 6469  k_load_intermedi
-000608f0: 6174 655f 6469 722c 0d0a 2020 2020 2020  ate_dir,..      
-00060900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060920: 2020 2020 2020 4c6f 6164 6572 2e5f 6765        Loader._ge
-00060930: 745f 7461 7267 6574 5f66 696c 655f 6e61  t_target_file_na
-00060940: 6d65 286c 6f61 6465 725f 6e61 6d65 2020  me(loader_name  
-00060950: 3d20 7365 6c66 2e6e 616d 650d 0a20 2020  = self.name..   
-00060960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060980: 2020 2020 2020 2020 2020 2020 2c73 7562              ,sub
-00060990: 6c6f 6164 5f6e 616d 6520 3d20 7375 626c  load_name = subl
-000609a0: 6f61 645f 6e61 6d65 0d0a 2020 2020 2020  oad_name..      
-000609b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000609c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000609d0: 2020 2020 2020 2020 202c 7369 7465 5f70           ,site_p
-000609e0: 7265 6669 7820 203d 2073 656c 662e 7369  refix  = self.si
-000609f0: 7465 2e70 7265 6669 780d 0a20 2020 2020  te.prefix..     
-00060a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060a20: 2020 2020 2020 2020 2020 2c74 696d 6520            ,time 
-00060a30: 2020 2020 2020 2020 3d20 7469 6d65 0d0a          = time..
+000608a0: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+000608b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000608c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000608d0: 2020 2029 0d0a 2020 2020 2020 2020 7461     )..        ta
+000608e0: 7267 6574 5f66 696c 655f 6e61 6d65 203d  rget_file_name =
+000608f0: 206f 732e 7061 7468 2e6a 6f69 6e28 7365   os.path.join(se
+00060900: 6c66 2e73 6974 652e 5f62 756c 6b5f 6c6f  lf.site._bulk_lo
+00060910: 6164 5f69 6e74 6572 6d65 6469 6174 655f  ad_intermediate_
+00060920: 6469 722c 0d0a 2020 2020 2020 2020 2020  dir,..          
+00060930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060950: 2020 4c6f 6164 6572 2e5f 6765 745f 7461    Loader._get_ta
+00060960: 7267 6574 5f66 696c 655f 6e61 6d65 286c  rget_file_name(l
+00060970: 6f61 6465 725f 6e61 6d65 2020 3d20 7365  oader_name  = se
+00060980: 6c66 2e6e 616d 650d 0a20 2020 2020 2020  lf.name..       
+00060990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000609a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000609b0: 2020 2020 2020 2020 2c73 7562 6c6f 6164          ,subload
+000609c0: 5f6e 616d 6520 3d20 7375 626c 6f61 645f  _name = subload_
+000609d0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+000609e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000609f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060a00: 2020 2020 202c 7369 7465 5f70 7265 6669       ,site_prefi
+00060a10: 7820 203d 2073 656c 662e 7369 7465 2e70  x  = self.site.p
+00060a20: 7265 6669 780d 0a20 2020 2020 2020 2020  refix..         
+00060a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00060a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060a60: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-00060a70: 656d 706f 7765 725f 7065 7269 6f64 5f74  empower_period_t
-00060a80: 7970 653d 656d 706f 7765 725f 7065 7269  ype=empower_peri
-00060a90: 6f64 5f74 7970 650d 0a20 2020 2020 2020  od_type..       
-00060aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060ac0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00060a50: 2020 2020 2020 2c74 696d 6520 2020 2020        ,time     
+00060a60: 2020 2020 3d20 7469 6d65 0d0a 2020 2020      = time..    
+00060a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060a90: 2020 2020 2020 2020 2020 202c 656d 706f             ,empo
+00060aa0: 7765 725f 7065 7269 6f64 5f74 7970 653d  wer_period_type=
+00060ab0: 656d 706f 7765 725f 7065 7269 6f64 5f74  empower_period_t
+00060ac0: 7970 650d 0a20 2020 2020 2020 2020 2020  ype..           
 00060ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060ae0: 2020 2020 2020 2020 2020 2020 2029 0d0a               )..
-00060af0: 0d0a 2020 2020 2020 2020 6966 2076 616c  ..        if val
-00060b00: 7565 5f63 6f6c 756d 6e20 6973 204e 6f6e  ue_column is Non
-00060b10: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00060b20: 6d65 7472 6963 5f63 6f6c 756d 6e73 203d  metric_columns =
-00060b30: 204e 6f6e 650d 0a20 2020 2020 2020 2065   None..        e
-00060b40: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00060b50: 2020 6d65 7472 6963 5f63 6f6c 756d 6e73    metric_columns
-00060b60: 203d 205b 7661 6c75 655f 636f 6c75 6d6e   = [value_column
-00060b70: 5d0d 0a0d 0a20 2020 2020 2020 2023 6173  ]....        #as
-00060b80: 7365 7274 206e 6f74 2073 656c 662e 7368  sert not self.sh
-00060b90: 6172 6469 6e67 5f71 7565 7565 2069 7320  arding_queue is 
-00060ba0: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
-00060bb0: 2365 7870 6c6f 6465 2064 6174 6120 666f  #explode data fo
-00060bc0: 7220 7468 6520 7469 6d65 2070 6572 696f  r the time perio
-00060bd0: 6420 696e 2071 7565 7374 696f 6e0d 0a20  d in question.. 
-00060be0: 2020 2020 2020 206c 6c75 2e63 7265 6174         llu.creat
-00060bf0: 655f 6578 706c 6f64 6564 5f62 756c 6b6c  e_exploded_bulkl
-00060c00: 6f61 645f 6669 6c65 7328 6461 7461 6672  oad_files(datafr
-00060c10: 616d 6520 2020 2020 2020 2020 2020 2020  ame             
-00060c20: 2020 2020 2020 2020 2020 2020 2020 203d                 =
-00060c30: 2064 6174 6166 7261 6d65 0d0a 2020 2020   dataframe..    
+00060ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060af0: 2020 2020 290d 0a20 2020 2020 2020 2020      )..         
+00060b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060b10: 2020 2020 2020 2020 2029 0d0a 0d0a 2020           )....  
+00060b20: 2020 2020 2020 6966 2076 616c 7565 5f63        if value_c
+00060b30: 6f6c 756d 6e20 6973 204e 6f6e 653a 0d0a  olumn is None:..
+00060b40: 2020 2020 2020 2020 2020 2020 6d65 7472              metr
+00060b50: 6963 5f63 6f6c 756d 6e73 203d 204e 6f6e  ic_columns = Non
+00060b60: 650d 0a20 2020 2020 2020 2065 6c73 653a  e..        else:
+00060b70: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+00060b80: 7472 6963 5f63 6f6c 756d 6e73 203d 205b  tric_columns = [
+00060b90: 7661 6c75 655f 636f 6c75 6d6e 5d0d 0a0d  value_column]...
+00060ba0: 0a20 2020 2020 2020 2023 6173 7365 7274  .        #assert
+00060bb0: 206e 6f74 2073 656c 662e 7368 6172 6469   not self.shardi
+00060bc0: 6e67 5f71 7565 7565 2069 7320 4e6f 6e65  ng_queue is None
+00060bd0: 0d0a 0d0a 2020 2020 2020 2020 2365 7870  ....        #exp
+00060be0: 6c6f 6465 2064 6174 6120 666f 7220 7468  lode data for th
+00060bf0: 6520 7469 6d65 2070 6572 696f 6420 696e  e time period in
+00060c00: 2071 7565 7374 696f 6e0d 0a20 2020 2020   question..     
+00060c10: 2020 206c 6c75 2e63 7265 6174 655f 6578     llu.create_ex
+00060c20: 706c 6f64 6564 5f62 756c 6b6c 6f61 645f  ploded_bulkload_
+00060c30: 6669 6c65 7328 6461 7461 6672 616d 6520  files(dataframe 
 00060c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060c60: 2020 2020 2020 2c69 6e74 6572 6d65 6469        ,intermedi
-00060c70: 6174 655f 6669 6c65 5f6e 616d 6520 2020  ate_file_name   
-00060c80: 2020 2020 2020 2020 2020 2020 3d20 696e              = in
-00060c90: 7465 726d 6564 6961 7465 5f66 696c 655f  termediate_file_
-00060ca0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-00060cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060cd0: 2c74 6172 6765 745f 6669 6c65 5f6e 616d  ,target_file_nam
-00060ce0: 6520 2020 2020 2020 2020 2020 2020 2020  e               
-00060cf0: 2020 2020 2020 3d20 7461 7267 6574 5f66        = target_f
-00060d00: 696c 655f 6e61 6d65 0d0a 2020 2020 2020  ile_name..      
+00060c50: 2020 2020 2020 2020 2020 203d 2064 6174             = dat
+00060c60: 6166 7261 6d65 0d0a 2020 2020 2020 2020  aframe..        
+00060c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060c90: 2020 2c69 6e74 6572 6d65 6469 6174 655f    ,intermediate_
+00060ca0: 6669 6c65 5f6e 616d 6520 2020 2020 2020  file_name       
+00060cb0: 2020 2020 2020 2020 3d20 696e 7465 726d          = interm
+00060cc0: 6564 6961 7465 5f66 696c 655f 6e61 6d65  ediate_file_name
+00060cd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00060ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060cf0: 2020 2020 2020 2020 2020 2020 2c74 6172              ,tar
+00060d00: 6765 745f 6669 6c65 5f6e 616d 6520 2020  get_file_name   
 00060d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060d30: 2020 2020 2c6c 6f6f 6b75 705f 6d65 7472      ,lookup_metr
-00060d40: 6963 5f73 686f 7274 6e61 6d65 5f66 726f  ic_shortname_fro
-00060d50: 6d5f 636f 6c75 6d6e 2020 3d20 6c6f 6f6b  m_column  = look
-00060d60: 7570 5f6d 6574 7269 635f 7368 6f72 746e  up_metric_shortn
-00060d70: 616d 655f 6672 6f6d 5f63 6f6c 756d 6e0d  ame_from_column.
-00060d80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00060d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060da0: 2020 2020 2020 2020 2020 202c 6c6f 6f6b             ,look
-00060db0: 7570 5f6d 6574 7269 635f 7068 7973 6964  up_metric_physid
-00060dc0: 5f66 726f 6d5f 636f 6c75 6d6e 2020 2020  _from_column    
-00060dd0: 203d 207b 7d0d 0a20 2020 2020 2020 2020   = {}..         
-00060de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060e00: 202c 6431 5f6c 6576 656c 7320 2020 2020   ,d1_levels     
+00060d20: 2020 3d20 7461 7267 6574 5f66 696c 655f    = target_file_
+00060d30: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+00060d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060d60: 2c6c 6f6f 6b75 705f 6d65 7472 6963 5f73  ,lookup_metric_s
+00060d70: 686f 7274 6e61 6d65 5f66 726f 6d5f 636f  hortname_from_co
+00060d80: 6c75 6d6e 2020 3d20 6c6f 6f6b 7570 5f6d  lumn  = lookup_m
+00060d90: 6574 7269 635f 7368 6f72 746e 616d 655f  etric_shortname_
+00060da0: 6672 6f6d 5f63 6f6c 756d 6e0d 0a20 2020  from_column..   
+00060db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060dd0: 2020 2020 2020 202c 6c6f 6f6b 7570 5f6d         ,lookup_m
+00060de0: 6574 7269 635f 7068 7973 6964 5f66 726f  etric_physid_fro
+00060df0: 6d5f 636f 6c75 6d6e 2020 2020 203d 207b  m_column     = {
+00060e00: 7d0d 0a20 2020 2020 2020 2020 2020 2020  }..             
 00060e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060e20: 2020 2020 2020 203d 2064 696d 656e 7369         = dimensi
-00060e30: 6f6e 5f30 5f63 6f6c 756d 6e73 0d0a 2020  on_0_columns..  
+00060e20: 2020 2020 2020 2020 2020 2020 202c 6431               ,d1
+00060e30: 5f6c 6576 656c 7320 2020 2020 2020 2020  _levels         
 00060e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060e60: 2020 2020 2020 2020 2c64 325f 6c65 7665          ,d2_leve
-00060e70: 6c73 2020 2020 2020 2020 2020 2020 2020  ls              
-00060e80: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
-00060e90: 6469 6d65 6e73 696f 6e5f 315f 636f 6c75  dimension_1_colu
-00060ea0: 6d6e 730d 0a20 2020 2020 2020 2020 2020  mns..           
-00060eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060ec0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-00060ed0: 6433 5f6c 6576 656c 7320 2020 2020 2020  d3_levels       
+00060e50: 2020 203d 2064 696d 656e 7369 6f6e 5f30     = dimension_0
+00060e60: 5f63 6f6c 756d 6e73 0d0a 2020 2020 2020  _columns..      
+00060e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060e90: 2020 2020 2c64 325f 6c65 7665 6c73 2020      ,d2_levels  
+00060ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060eb0: 2020 2020 2020 2020 2020 3d20 6469 6d65            = dime
+00060ec0: 6e73 696f 6e5f 315f 636f 6c75 6d6e 730d  nsion_1_columns.
+00060ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00060ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060ef0: 2020 2020 203d 2064 696d 656e 7369 6f6e       = dimension
-00060f00: 5f32 5f63 6f6c 756d 6e73 0d0a 2020 2020  _2_columns..    
+00060ef0: 2020 2020 2020 2020 2020 202c 6433 5f6c             ,d3_l
+00060f00: 6576 656c 7320 2020 2020 2020 2020 2020  evels           
 00060f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060f30: 2020 2020 2020 2c64 345f 6c65 7665 6c73        ,d4_levels
+00060f20: 203d 2064 696d 656e 7369 6f6e 5f32 5f63   = dimension_2_c
+00060f30: 6f6c 756d 6e73 0d0a 2020 2020 2020 2020  olumns..        
 00060f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060f50: 2020 2020 2020 2020 2020 2020 3d20 6469              = di
-00060f60: 6d65 6e73 696f 6e5f 335f 636f 6c75 6d6e  mension_3_column
-00060f70: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
-00060f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060f90: 2020 2020 2020 2020 2020 2020 202c 6435               ,d5
-00060fa0: 5f6c 6576 656c 7320 2020 2020 2020 2020  _levels         
+00060f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060f60: 2020 2c64 345f 6c65 7665 6c73 2020 2020    ,d4_levels    
+00060f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00060f80: 2020 2020 2020 2020 3d20 6469 6d65 6e73          = dimens
+00060f90: 696f 6e5f 335f 636f 6c75 6d6e 730d 0a20  ion_3_columns.. 
+00060fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00060fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060fc0: 2020 203d 2064 696d 656e 7369 6f6e 5f34     = dimension_4
-00060fd0: 5f63 6f6c 756d 6e73 0d0a 2020 2020 2020  _columns..      
-00060fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00060ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061000: 2020 2020 2c64 365f 6c65 7665 6c73 2020      ,d6_levels  
+00060fc0: 2020 2020 2020 2020 202c 6435 5f6c 6576           ,d5_lev
+00060fd0: 656c 7320 2020 2020 2020 2020 2020 2020  els             
+00060fe0: 2020 2020 2020 2020 2020 2020 2020 203d                 =
+00060ff0: 2064 696d 656e 7369 6f6e 5f34 5f63 6f6c   dimension_4_col
+00061000: 756d 6e73 0d0a 2020 2020 2020 2020 2020  umns..          
 00061010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061020: 2020 2020 2020 2020 2020 3d20 6469 6d65            = dime
-00061030: 6e73 696f 6e5f 355f 636f 6c75 6d6e 730d  nsion_5_columns.
-00061040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00061050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061060: 2020 2020 2020 2020 2020 202c 6437 5f6c             ,d7_l
-00061070: 6576 656c 7320 2020 2020 2020 2020 2020  evels           
+00061020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061030: 2c64 365f 6c65 7665 6c73 2020 2020 2020  ,d6_levels      
+00061040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061050: 2020 2020 2020 3d20 6469 6d65 6e73 696f        = dimensio
+00061060: 6e5f 355f 636f 6c75 6d6e 730d 0a20 2020  n_5_columns..   
+00061070: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00061080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061090: 203d 2064 696d 656e 7369 6f6e 5f36 5f63   = dimension_6_c
-000610a0: 6f6c 756d 6e73 0d0a 2020 2020 2020 2020  olumns..        
-000610b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000610c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000610d0: 2020 2c64 385f 6c65 7665 6c73 2020 2020    ,d8_levels    
+00061090: 2020 2020 2020 202c 6437 5f6c 6576 656c         ,d7_level
+000610a0: 7320 2020 2020 2020 2020 2020 2020 2020  s               
+000610b0: 2020 2020 2020 2020 2020 2020 203d 2064               = d
+000610c0: 696d 656e 7369 6f6e 5f36 5f63 6f6c 756d  imension_6_colum
+000610d0: 6e73 0d0a 2020 2020 2020 2020 2020 2020  ns..            
 000610e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000610f0: 2020 2020 2020 2020 3d20 6469 6d65 6e73          = dimens
-00061100: 696f 6e5f 375f 636f 6c75 6d6e 730d 0a20  ion_7_columns.. 
+000610f0: 2020 2020 2020 2020 2020 2020 2020 2c64                ,d
+00061100: 385f 6c65 7665 6c73 2020 2020 2020 2020  8_levels        
 00061110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061130: 2020 2020 2020 2020 202c 6d6f 6465 5f6c           ,mode_l
-00061140: 6576 656c 7320 2020 2020 2020 2020 2020  evels           
-00061150: 2020 2020 2020 2020 2020 2020 2020 203d                 =
-00061160: 206d 6f64 655f 636f 6c75 6d6e 730d 0a20   mode_columns.. 
-00061170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061190: 2020 2020 2020 2020 202c 6375 7272 656e           ,curren
-000611a0: 6379 5f63 6f6c 756d 6e5f 6e61 6d65 2020  cy_column_name  
-000611b0: 2020 2020 2020 2020 2020 2020 2020 203d                 =
-000611c0: 2062 6173 655f 636f 6c75 6d6e 735b 305d   base_columns[0]
-000611d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000611e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000611f0: 2020 2020 2020 2020 2020 2020 2c65 6d70              ,emp
-00061200: 6f77 6572 5f64 6174 655f 7475 706c 6520  ower_date_tuple 
+00061120: 2020 2020 3d20 6469 6d65 6e73 696f 6e5f      = dimension_
+00061130: 375f 636f 6c75 6d6e 730d 0a20 2020 2020  7_columns..     
+00061140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061160: 2020 2020 202c 6d6f 6465 5f6c 6576 656c       ,mode_level
+00061170: 7320 2020 2020 2020 2020 2020 2020 2020  s               
+00061180: 2020 2020 2020 2020 2020 203d 206d 6f64             = mod
+00061190: 655f 636f 6c75 6d6e 730d 0a20 2020 2020  e_columns..     
+000611a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000611b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000611c0: 2020 2020 202c 6375 7272 656e 6379 5f63       ,currency_c
+000611d0: 6f6c 756d 6e5f 6e61 6d65 2020 2020 2020  olumn_name      
+000611e0: 2020 2020 2020 2020 2020 203d 2062 6173             = bas
+000611f0: 655f 636f 6c75 6d6e 735b 305d 0d0a 2020  e_columns[0]..  
+00061200: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00061210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061220: 2020 3d20 4e6f 6e65 0d0a 2020 2020 2020    = None..      
-00061230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061250: 2020 2020 2c65 7870 6f72 7465 645f 6d65      ,exported_me
-00061260: 7472 6963 5f70 6879 7369 645f 6466 2020  tric_physid_df  
-00061270: 2020 2020 2020 2020 2020 3d20 7365 6c66            = self
-00061280: 2e73 6974 652e 6d65 7472 6963 2e65 6c65  .site.metric.ele
-00061290: 6d65 6e74 732e 6461 7461 6672 616d 655b  ments.dataframe[
-000612a0: 5b27 5368 6f72 7420 4e61 6d65 272c 2749  ['Short Name','I
-000612b0: 4427 5d5d 0d0a 2020 2020 2020 2020 2020  D']]..          
-000612c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000612d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000612e0: 2c6d 6574 7269 635f 636f 6c75 6d6e 7320  ,metric_columns 
+00061220: 2020 2020 2020 2020 2c65 6d70 6f77 6572          ,empower
+00061230: 5f64 6174 655f 7475 706c 6520 2020 2020  _date_tuple     
+00061240: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
+00061250: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+00061260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061280: 2c65 7870 6f72 7465 645f 6d65 7472 6963  ,exported_metric
+00061290: 5f70 6879 7369 645f 6466 2020 2020 2020  _physid_df      
+000612a0: 2020 2020 2020 3d20 7365 6c66 2e73 6974        = self.sit
+000612b0: 652e 6d65 7472 6963 2e65 6c65 6d65 6e74  e.metric.element
+000612c0: 732e 6461 7461 6672 616d 655b 5b27 5368  s.dataframe[['Sh
+000612d0: 6f72 7420 4e61 6d65 272c 2749 4427 5d5d  ort Name','ID']]
+000612e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 000612f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061300: 2020 2020 2020 3d20 6d65 7472 6963 5f63        = metric_c
-00061310: 6f6c 756d 6e73 0d0a 2020 2020 2020 2020  olumns..        
+00061300: 2020 2020 2020 2020 2020 2020 2c6d 6574              ,met
+00061310: 7269 635f 636f 6c75 6d6e 7320 2020 2020  ric_columns     
 00061320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061340: 2020 2c64 796e 616d 6963 5f6d 6574 7269    ,dynamic_metri
-00061350: 635f 636f 6c75 6d6e 7320 2020 2020 2020  c_columns       
-00061360: 2020 2020 2020 2020 3d20 6479 6e61 6d69          = dynami
-00061370: 635f 6d65 7472 6963 5f63 6f6c 756d 6e73  c_metric_columns
-00061380: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00061390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000613a0: 2020 2020 2020 2020 2020 2020 2c69 6465              ,ide
-000613b0: 6e74 6966 6965 725f 636f 6c75 6d6e 7320  ntifier_columns 
+00061330: 2020 3d20 6d65 7472 6963 5f63 6f6c 756d    = metric_colum
+00061340: 6e73 0d0a 2020 2020 2020 2020 2020 2020  ns..            
+00061350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061360: 2020 2020 2020 2020 2020 2020 2020 2c64                ,d
+00061370: 796e 616d 6963 5f6d 6574 7269 635f 636f  ynamic_metric_co
+00061380: 6c75 6d6e 7320 2020 2020 2020 2020 2020  lumns           
+00061390: 2020 2020 3d20 6479 6e61 6d69 635f 6d65      = dynamic_me
+000613a0: 7472 6963 5f63 6f6c 756d 6e73 0d0a 2020  tric_columns..  
+000613b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000613c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000613d0: 2020 3d20 7365 6c66 2e69 6465 6e74 6966    = self.identif
-000613e0: 6965 725f 636f 6c75 6d6e 730d 0a20 2020  ier_columns..   
-000613f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061410: 2020 2020 2020 202c 6669 6c65 5f73 6570         ,file_sep
-00061420: 6172 6174 6f72 2020 2020 2020 2020 2020  arator          
-00061430: 2020 2020 2020 2020 2020 2020 203d 2027               = '
-00061440: 5c74 270d 0a20 2020 2020 2020 2020 2020  \t'..           
-00061450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061460: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-00061470: 6c6f 6767 696e 675f 7175 6575 6520 2020  logging_queue   
+000613d0: 2020 2020 2020 2020 2c69 6465 6e74 6966          ,identif
+000613e0: 6965 725f 636f 6c75 6d6e 7320 2020 2020  ier_columns     
+000613f0: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
+00061400: 7365 6c66 2e69 6465 6e74 6966 6965 725f  self.identifier_
+00061410: 636f 6c75 6d6e 730d 0a20 2020 2020 2020  columns..       
+00061420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061440: 2020 202c 6669 6c65 5f73 6570 6172 6174     ,file_separat
+00061450: 6f72 2020 2020 2020 2020 2020 2020 2020  or              
+00061460: 2020 2020 2020 2020 203d 2027 5c74 270d           = '\t'.
+00061470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00061480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061490: 2020 2020 203d 2073 656c 662e 7369 7465       = self.site
-000614a0: 2e6c 6f67 6769 6e67 5f71 7565 7565 0d0a  .logging_queue..
+00061490: 2020 2020 2020 2020 2020 202c 6c6f 6767             ,logg
+000614a0: 696e 675f 7175 6575 6520 2020 2020 2020  ing_queue       
 000614b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000614c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000614d0: 2020 2020 2020 2020 2020 2c63 6f6d 706c            ,compl
-000614e0: 6574 6564 5f6d 6574 7269 635f 7175 6575  eted_metric_queu
-000614f0: 6520 2020 2020 2020 2020 2020 2020 2020  e               
-00061500: 3d20 7365 6c66 2e73 6861 7264 696e 675f  = self.sharding_
-00061510: 7175 6575 650d 0a20 2020 2020 2020 2020  queue..         
-00061520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061540: 202c 6967 6e6f 7265 5f7a 6572 6f5f 7661   ,ignore_zero_va
-00061550: 6c75 6573 2020 2020 2020 2020 2020 2020  lues            
-00061560: 2020 2020 2020 203d 2069 676e 6f72 655f         = ignore_
-00061570: 7a65 726f 5f76 616c 7565 730d 0a20 2020  zero_values..   
+000614c0: 203d 2073 656c 662e 7369 7465 2e6c 6f67   = self.site.log
+000614d0: 6769 6e67 5f71 7565 7565 0d0a 2020 2020  ging_queue..    
+000614e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000614f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061500: 2020 2020 2020 2c63 6f6d 706c 6574 6564        ,completed
+00061510: 5f6d 6574 7269 635f 7175 6575 6520 2020  _metric_queue   
+00061520: 2020 2020 2020 2020 2020 2020 3d20 7365              = se
+00061530: 6c66 2e73 6861 7264 696e 675f 7175 6575  lf.sharding_queu
+00061540: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00061550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061560: 2020 2020 2020 2020 2020 2020 202c 6967               ,ig
+00061570: 6e6f 7265 5f7a 6572 6f5f 7661 6c75 6573  nore_zero_values
 00061580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000615a0: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
-000615b0: 2020 2020 2344 726f 7020 7468 6520 636f      #Drop the co
-000615c0: 7069 6564 2064 6174 6166 7261 6d65 202d  pied dataframe -
-000615d0: 2074 6869 7320 7769 6c6c 2068 656c 7020   this will help 
-000615e0: 7468 6520 4761 7262 6167 6520 436f 6c6c  the Garbage Coll
-000615f0: 6563 746f 7220 636c 6561 6e20 7570 0d0a  ector clean up..
-00061600: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
-00061610: 6520 3d20 4e6f 6e65 0d0a 0d0a 2020 2020  e = None....    
-00061620: 2020 2020 2373 746f 7265 2069 6e66 6f72      #store infor
-00061630: 6d61 7469 6f6e 2061 626f 7574 2077 6865  mation about whe
-00061640: 7265 2074 6865 2065 7870 6c6f 6465 6420  re the exploded 
-00061650: 6669 6c65 7320 6172 650d 0a20 2020 2020  files are..     
-00061660: 2020 2073 656c 662e 696e 7465 726d 6564     self.intermed
-00061670: 6961 7465 5f66 696c 655f 6e61 6d65 2020  iate_file_name  
-00061680: 3d20 696e 7465 726d 6564 6961 7465 5f66  = intermediate_f
-00061690: 696c 655f 6e61 6d65 0d0a 2020 2020 2020  ile_name..      
-000616a0: 2020 7365 6c66 2e74 6172 6765 745f 6669    self.target_fi
-000616b0: 6c65 5f6e 616d 6520 2020 2020 2020 203d  le_name        =
-000616c0: 2074 6172 6765 745f 6669 6c65 5f6e 616d   target_file_nam
-000616d0: 650d 0a0d 0a0d 0a20 2020 2020 2020 2069  e......        i
-000616e0: 6620 7365 6c66 2e73 6974 652e 7374 6f72  f self.site.stor
-000616f0: 6167 655f 7479 7065 3d3d 2273 716c 223a  age_type=="sql":
-00061700: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00061710: 2073 656c 662e 6465 6c74 613a 0d0a 2020   self.delta:..  
-00061720: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00061730: 6973 6520 4174 7472 6962 7574 6545 7272  ise AttributeErr
-00061740: 6f72 2822 4375 7272 656e 746c 7920 6120  or("Currently a 
-00061750: 4c6f 6164 6572 2063 616e 6e6f 7420 646f  Loader cannot do
-00061760: 2064 656c 7461 2070 726f 6365 7373 696e   delta processin
-00061770: 6720 6f6e 2061 2053 514c 2066 696c 6522  g on a SQL file"
-00061780: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00061790: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-000617a0: 2020 2020 2020 666f 7220 6469 7220 696e        for dir in
-000617b0: 205b 7365 6c66 2e73 6974 652e 5f62 756c   [self.site._bul
-000617c0: 6b5f 6c6f 6164 5f64 656c 7461 5f64 6972  k_load_delta_dir
-000617d0: 5d3a 0d0a 0d0a 2020 2020 2020 2020 2020  ]:....          
-000617e0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-000617f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061800: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
-00061810: 6972 7328 6469 7229 0d0a 2020 2020 2020  irs(dir)..      
-00061820: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00061830: 6365 7074 2046 696c 6545 7869 7374 7345  cept FileExistsE
-00061840: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00061850: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00061860: 6173 730d 0a20 2020 2020 2020 2020 2020  ass..           
-00061870: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00061880: 4f53 4572 726f 7220 6173 2065 3a0d 0a20  OSError as e:.. 
-00061890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000618a0: 2020 2020 2020 2069 6620 652e 7769 6e65         if e.wine
-000618b0: 7272 6f72 203d 3d20 3132 333a 0d0a 2020  rror == 123:..  
+00061590: 2020 203d 2069 676e 6f72 655f 7a65 726f     = ignore_zero
+000615a0: 5f76 616c 7565 730d 0a20 2020 2020 2020  _values..       
+000615b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000615c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000615d0: 2020 2029 0d0a 0d0a 2020 2020 2020 2020     )....        
+000615e0: 2344 726f 7020 7468 6520 636f 7069 6564  #Drop the copied
+000615f0: 2064 6174 6166 7261 6d65 202d 2074 6869   dataframe - thi
+00061600: 7320 7769 6c6c 2068 656c 7020 7468 6520  s will help the 
+00061610: 4761 7262 6167 6520 436f 6c6c 6563 746f  Garbage Collecto
+00061620: 7220 636c 6561 6e20 7570 0d0a 2020 2020  r clean up..    
+00061630: 2020 2020 6461 7461 6672 616d 6520 3d20      dataframe = 
+00061640: 4e6f 6e65 0d0a 0d0a 2020 2020 2020 2020  None....        
+00061650: 2373 746f 7265 2069 6e66 6f72 6d61 7469  #store informati
+00061660: 6f6e 2061 626f 7574 2077 6865 7265 2074  on about where t
+00061670: 6865 2065 7870 6c6f 6465 6420 6669 6c65  he exploded file
+00061680: 7320 6172 650d 0a20 2020 2020 2020 2073  s are..        s
+00061690: 656c 662e 696e 7465 726d 6564 6961 7465  elf.intermediate
+000616a0: 5f66 696c 655f 6e61 6d65 2020 3d20 696e  _file_name  = in
+000616b0: 7465 726d 6564 6961 7465 5f66 696c 655f  termediate_file_
+000616c0: 6e61 6d65 0d0a 2020 2020 2020 2020 7365  name..        se
+000616d0: 6c66 2e74 6172 6765 745f 6669 6c65 5f6e  lf.target_file_n
+000616e0: 616d 6520 2020 2020 2020 203d 2074 6172  ame        = tar
+000616f0: 6765 745f 6669 6c65 5f6e 616d 650d 0a0d  get_file_name...
+00061700: 0a0d 0a20 2020 2020 2020 2069 6620 7365  ...        if se
+00061710: 6c66 2e73 6974 652e 7374 6f72 6167 655f  lf.site.storage_
+00061720: 7479 7065 3d3d 2273 716c 223a 0d0a 2020  type=="sql":..  
+00061730: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+00061740: 662e 6465 6c74 613a 0d0a 2020 2020 2020  f.delta:..      
+00061750: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00061760: 4174 7472 6962 7574 6545 7272 6f72 2822  AttributeError("
+00061770: 4375 7272 656e 746c 7920 6120 4c6f 6164  Currently a Load
+00061780: 6572 2063 616e 6e6f 7420 646f 2064 656c  er cannot do del
+00061790: 7461 2070 726f 6365 7373 696e 6720 6f6e  ta processing on
+000617a0: 2061 2053 514c 2066 696c 6522 290d 0a20   a SQL file").. 
+000617b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000617c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000617d0: 2020 666f 7220 6469 7220 696e 205b 7365    for dir in [se
+000617e0: 6c66 2e73 6974 652e 5f62 756c 6b5f 6c6f  lf.site._bulk_lo
+000617f0: 6164 5f64 656c 7461 5f64 6972 5d3a 0d0a  ad_delta_dir]:..
+00061800: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00061810: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00061820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061830: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
+00061840: 6469 7229 0d0a 2020 2020 2020 2020 2020  dir)..          
+00061850: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00061860: 2046 696c 6545 7869 7374 7345 7272 6f72   FileExistsError
+00061870: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00061880: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+00061890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000618a0: 2020 2020 2065 7863 6570 7420 4f53 4572       except OSEr
+000618b0: 726f 7220 6173 2065 3a0d 0a20 2020 2020  ror as e:..     
 000618c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000618d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000618e0: 5661 6c75 6545 7272 6f72 2827 4469 7265  ValueError('Dire
-000618f0: 6374 6f72 7920 227b 7d22 2068 6173 2061  ctory "{}" has a
-00061900: 6e20 696e 7661 6c69 6420 6e61 6d65 2e20  n invalid name. 
-00061910: 4469 6420 796f 7520 7061 7373 2061 2073  Did you pass a s
-00061920: 6974 655f 6c6f 6361 746f 7220 7061 7468  ite_locator path
-00061930: 2022 7b7d 2220 7769 7468 6f75 7420 646f   "{}" without do
-00061940: 7562 6c65 2d65 7363 6170 696e 6720 6261  uble-escaping ba
-00061950: 636b 736c 6173 6865 7320 6f72 2070 7265  ckslashes or pre
-00061960: 6669 7869 6e67 2074 6865 2073 7472 696e  fixing the strin
-00061970: 6720 7769 7468 2061 6e20 2272 2220 666f  g with an "r" fo
-00061980: 7220 7261 773f 272e 666f 726d 6174 2864  r raw?'.format(d
-00061990: 6972 2c72 6570 7228 7369 7465 5f6c 6f63  ir,repr(site_loc
-000619a0: 6174 6f72 2929 290d 0a20 2020 2020 2020  ator)))..       
-000619b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000619c0: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-000619d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000619e0: 2020 2020 7261 6973 6520 650d 0a20 2020      raise e..   
-000619f0: 2020 2020 2020 2020 2020 2020 2023 4966               #If
-00061a00: 2077 6520 6172 6520 6e6f 7420 646f 696e   we are not doin
-00061a10: 6720 6120 6465 6c74 6120 7765 2064 6f6e  g a delta we don
-00061a20: 2774 206e 6565 6420 746f 2073 6f72 7420  't need to sort 
-00061a30: 7468 6520 6669 6c65 206f 7220 6372 6561  the file or crea
-00061a40: 7465 2061 6e20 6f76 6572 7269 6465 2066  te an override f
-00061a50: 696c 6520 2d20 7765 206a 7573 7420 6e65  ile - we just ne
-00061a60: 6564 2074 6f20 6d6f 7665 2069 7420 696e  ed to move it in
-00061a70: 746f 2070 6c61 6365 2d20 2074 6869 7320  to place-  this 
-00061a80: 7368 6f75 6c64 2062 6520 7175 6963 6b20  should be quick 
-00061a90: 6966 2069 7420 6973 2061 2073 696d 706c  if it is a simpl
-00061aa0: 6520 7265 6e61 6d65 0d0a 2020 2020 2020  e rename..      
-00061ab0: 2020 2020 2020 2020 2020 7368 7574 696c            shutil
-00061ac0: 2e6d 6f76 6528 7461 7267 6574 5f66 696c  .move(target_fil
-00061ad0: 655f 6e61 6d65 2c20 6f73 2e70 6174 682e  e_name, os.path.
-00061ae0: 6a6f 696e 2873 656c 662e 7369 7465 2e5f  join(self.site._
-00061af0: 6275 6c6b 5f6c 6f61 645f 6465 6c74 615f  bulk_load_delta_
-00061b00: 6469 722c 206f 732e 7061 7468 2e62 6173  dir, os.path.bas
-00061b10: 656e 616d 6528 7461 7267 6574 5f66 696c  ename(target_fil
-00061b20: 655f 6e61 6d65 2929 290d 0a0d 0a20 2020  e_name)))....   
-00061b30: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00061b40: 662e 7375 626c 6f61 6473 2e61 7070 656e  f.subloads.appen
-00061b50: 6428 2873 7562 6c6f 6164 5f6e 616d 652c  d((subload_name,
-00061b60: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-00061b70: 2874 6172 6765 745f 6669 6c65 5f6e 616d  (target_file_nam
-00061b80: 6529 2c29 290d 0a0d 0a20 2020 2020 2020  e),))....       
-00061b90: 2065 6c73 653a 0d0a 0d0a 2020 2020 2020   else:....      
-00061ba0: 2020 2020 2020 6966 2073 656c 662e 6465        if self.de
-00061bb0: 6c74 613a 0d0a 2020 2020 2020 2020 2020  lta:..          
-00061bc0: 2020 2020 2020 7461 7267 6574 5f66 696c        target_fil
-00061bd0: 655f 6e61 6d65 5f6e 6f5f 6578 742c 2065  e_name_no_ext, e
-00061be0: 7874 203d 206f 732e 7061 7468 2e73 706c  xt = os.path.spl
-00061bf0: 6974 6578 7428 6f73 2e70 6174 682e 6261  itext(os.path.ba
-00061c00: 7365 6e61 6d65 2874 6172 6765 745f 6669  sename(target_fi
-00061c10: 6c65 5f6e 616d 6529 290d 0a0d 0a20 2020  le_name))....   
-00061c20: 2020 2020 2020 2020 2020 2020 2023 4372               #Cr
-00061c30: 6561 7465 2074 6865 2064 656c 7461 0d0a  eate the delta..
-00061c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061c50: 2368 6973 746f 7279 2066 696c 6520 7769  #history file wi
-00061c60: 6c6c 2062 6520 696e 2027 4461 7461 2046  ll be in 'Data F
-00061c70: 696c 6573 5c6c 6173 745f 7375 6363 6573  iles\last_succes
-00061c80: 7366 756c 5f62 756c 6b5f 6c6f 6164 270d  sful_bulk_load'.
-00061c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00061ca0: 2023 6375 7272 656e 746c 7920 6c6f 6164   #currently load
-00061cb0: 696e 6720 6669 6c65 7320 2877 6869 6368  ing files (which
-00061cc0: 2077 696c 6c20 6265 2077 7269 7474 656e   will be written
-00061cd0: 2069 6e74 6f20 2744 6174 6120 4669 6c65   into 'Data File
-00061ce0: 735c 6c61 7374 5f73 7563 6365 7373 6675  s\last_successfu
-00061cf0: 6c5f 6275 6c6b 5f6c 6f61 6427 2061 6674  l_bulk_load' aft
-00061d00: 6572 2061 2073 7563 6365 7373 6675 6c20  er a successful 
-00061d10: 6c6f 6164 2061 7265 2069 6e20 2744 6174  load are in 'Dat
-00061d20: 6120 4669 6c65 735c 6375 7272 656e 746c  a Files\currentl
-00061d30: 795f 7072 6f63 6573 7369 6e67 5f62 756c  y_processing_bul
-00061d40: 6b5f 6c6f 6164 270d 0a20 2020 2020 2020  k_load'..       
-00061d50: 2020 2020 2020 2020 2023 4d61 6b65 2074           #Make t
-00061d60: 6865 2064 6972 6563 746f 7279 2069 6620  he directory if 
-00061d70: 6974 2064 6f65 736e 2774 2065 7869 7374  it doesn't exist
-00061d80: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00061d90: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00061da0: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
-00061db0: 6b64 6972 286f 732e 7061 7468 2e6a 6f69  kdir(os.path.joi
-00061dc0: 6e28 7365 6c66 2e73 6974 652e 5f64 6174  n(self.site._dat
-00061dd0: 615f 6669 6c65 735f 6469 722c 2763 7572  a_files_dir,'cur
-00061de0: 7265 6e74 6c79 5f70 726f 6365 7373 696e  rently_processin
-00061df0: 675f 6275 6c6b 5f6c 6f61 6427 2929 0d0a  g_bulk_load'))..
-00061e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061e10: 6578 6365 7074 2046 696c 6545 7869 7374  except FileExist
-00061e20: 7345 7272 6f72 3a0d 0a20 2020 2020 2020  sError:..       
-00061e30: 2020 2020 2020 2020 2020 2020 2023 4966               #If
-00061e40: 2074 6865 2064 6972 6563 746f 7279 2064   the directory d
-00061e50: 6f65 7320 6578 6973 742c 2074 6865 6e20  oes exist, then 
-00061e60: 6974 2068 6f6c 6473 2064 6174 6120 6672  it holds data fr
-00061e70: 6f6d 2061 2066 6169 6c65 6420 6c6f 6164  om a failed load
-00061e80: 202d 2072 656d 6f76 6520 7468 6520 6661   - remove the fa
-00061e90: 696c 6564 2064 6174 610d 0a20 2020 2020  iled data..     
-00061ea0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00061eb0: 6f67 2e77 6172 6e28 2746 6f75 6e64 206c  og.warn('Found l
-00061ec0: 6566 746f 7665 7220 6461 7461 2066 726f  eftover data fro
-00061ed0: 6d20 6120 7072 6576 696f 7573 6c79 2066  m a previously f
-00061ee0: 6169 6c65 6420 6c6f 6164 2069 6e20 272b  ailed load in '+
-00061ef0: 7374 7228 6f73 2e70 6174 682e 6a6f 696e  str(os.path.join
-00061f00: 2873 656c 662e 7369 7465 2e5f 6461 7461  (self.site._data
-00061f10: 5f66 696c 6573 5f64 6972 2c27 6375 7272  _files_dir,'curr
-00061f20: 656e 746c 795f 7072 6f63 6573 7369 6e67  ently_processing
-00061f30: 5f62 756c 6b5f 6c6f 6164 2729 2929 0d0a  _bulk_load')))..
-00061f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00061f50: 2020 2020 666f 7220 6620 696e 206f 732e      for f in os.
-00061f60: 6c69 7374 6469 7228 6f73 2e70 6174 682e  listdir(os.path.
-00061f70: 6a6f 696e 2873 656c 662e 7369 7465 2e5f  join(self.site._
-00061f80: 6461 7461 5f66 696c 6573 5f64 6972 2c27  data_files_dir,'
-00061f90: 6375 7272 656e 746c 795f 7072 6f63 6573  currently_proces
-00061fa0: 7369 6e67 5f62 756c 6b5f 6c6f 6164 2729  sing_bulk_load')
-00061fb0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00061fc0: 2020 2020 2020 2020 2020 2020 6f73 2e72              os.r
-00061fd0: 656d 6f76 6528 6f73 2e70 6174 682e 6a6f  emove(os.path.jo
-00061fe0: 696e 2873 656c 662e 7369 7465 2e5f 6461  in(self.site._da
-00061ff0: 7461 5f66 696c 6573 5f64 6972 2c27 6375  ta_files_dir,'cu
-00062000: 7272 656e 746c 795f 7072 6f63 6573 7369  rrently_processi
-00062010: 6e67 5f62 756c 6b5f 6c6f 6164 272c 6629  ng_bulk_load',f)
-00062020: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00062030: 2020 2020 2074 6172 6765 745f 6669 6c65       target_file
-00062040: 5f6e 616d 655f 736f 7274 6564 3d6f 732e  _name_sorted=os.
-00062050: 7061 7468 2e6a 6f69 6e28 7365 6c66 2e73  path.join(self.s
-00062060: 6974 652e 5f64 6174 615f 6669 6c65 735f  ite._data_files_
-00062070: 6469 722c 2763 7572 7265 6e74 6c79 5f70  dir,'currently_p
-00062080: 726f 6365 7373 696e 675f 6275 6c6b 5f6c  rocessing_bulk_l
-00062090: 6f61 6427 2c20 7461 7267 6574 5f66 696c  oad', target_fil
-000620a0: 655f 6e61 6d65 5f6e 6f5f 6578 742b 275f  e_name_no_ext+'_
-000620b0: 736f 7274 6564 272b 6578 7429 0d0a 0d0a  sorted'+ext)....
-000620c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000620d0: 2020 2353 6f72 7420 7468 6520 6578 706c    #Sort the expl
-000620e0: 6f64 6564 2062 756c 6b20 6c6f 6164 2066  oded bulk load f
-000620f0: 696c 6520 2d20 736f 2074 6861 7420 7765  ile - so that we
-00062100: 2063 616e 2064 656c 7461 2069 740d 0a20   can delta it.. 
-00062110: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00062120: 6c75 2e73 6f72 745f 6669 6c65 2873 6f75  lu.sort_file(sou
-00062130: 7263 655f 6669 6c65 5f6e 616d 653d 7461  rce_file_name=ta
-00062140: 7267 6574 5f66 696c 655f 6e61 6d65 2c74  rget_file_name,t
-00062150: 6172 6765 745f 6669 6c65 5f6e 616d 653d  arget_file_name=
-00062160: 7461 7267 6574 5f66 696c 655f 6e61 6d65  target_file_name
-00062170: 5f73 6f72 7465 6429 0d0a 0d0a 2020 2020  _sorted)....    
-00062180: 2020 2020 2020 2020 2020 2020 234d 616b              #Mak
-00062190: 6520 7468 6520 6469 7265 6374 6f72 7920  e the directory 
-000621a0: 6966 2069 7420 646f 6573 6e27 7420 6578  if it doesn't ex
-000621b0: 6973 740d 0a20 2020 2020 2020 2020 2020  ist..           
-000621c0: 2020 2020 2023 4d6f 7665 2061 6e79 2073       #Move any s
-000621d0: 6f72 7465 642e 7473 7620 6669 6c65 7320  orted.tsv files 
-000621e0: 696e 2c20 6173 2074 6865 7920 776f 756c  in, as they woul
-000621f0: 6420 6861 7665 2062 6565 6e20 6372 6561  d have been crea
-00062200: 7465 6420 6279 2061 2070 7265 7669 6f75  ted by a previou
-00062210: 7320 696e 6361 726e 6174 696f 6e20 6f66  s incarnation of
-00062220: 2074 6869 7320 636f 6465 0d0a 2020 2020   this code..    
-00062230: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00062240: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00062250: 2020 2020 2020 6f73 2e6d 6b64 6972 286f        os.mkdir(o
-00062260: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
-00062270: 2e73 6974 652e 5f64 6174 615f 6669 6c65  .site._data_file
-00062280: 735f 6469 722c 276c 6173 745f 7375 6363  s_dir,'last_succ
-00062290: 6573 7366 756c 5f62 756c 6b5f 6c6f 6164  essful_bulk_load
-000622a0: 2729 290d 0a20 2020 2020 2020 2020 2020  '))..           
-000622b0: 2020 2020 2020 2020 2066 6f72 2066 2069           for f i
-000622c0: 6e20 6f73 2e6c 6973 7464 6972 286f 732e  n os.listdir(os.
-000622d0: 7061 7468 2e6a 6f69 6e28 7365 6c66 2e73  path.join(self.s
-000622e0: 6974 652e 5f64 6174 615f 6669 6c65 735f  ite._data_files_
-000622f0: 6469 7229 293a 0d0a 2020 2020 2020 2020  dir)):..        
-00062300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062310: 6966 2066 6e6d 6174 6368 2e66 6e6d 6174  if fnmatch.fnmat
-00062320: 6368 2866 2c27 2a5f 736f 7274 6564 2e74  ch(f,'*_sorted.t
-00062330: 7376 2729 3a0d 0a20 2020 2020 2020 2020  sv'):..         
-00062340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062350: 2020 2073 6875 7469 6c2e 6d6f 7665 286f     shutil.move(o
-00062360: 732e 7061 7468 2e6a 6f69 6e28 7365 6c66  s.path.join(self
-00062370: 2e73 6974 652e 5f64 6174 615f 6669 6c65  .site._data_file
-00062380: 735f 6469 722c 6629 2c20 6f73 2e70 6174  s_dir,f), os.pat
-00062390: 682e 6a6f 696e 2873 656c 662e 7369 7465  h.join(self.site
-000623a0: 2e5f 6461 7461 5f66 696c 6573 5f64 6972  ._data_files_dir
-000623b0: 2c27 6c61 7374 5f73 7563 6365 7373 6675  ,'last_successfu
-000623c0: 6c5f 6275 6c6b 5f6c 6f61 6427 2929 0d0a  l_bulk_load'))..
-000623d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000623e0: 2020 6578 6365 7074 2046 696c 6545 7869    except FileExi
-000623f0: 7374 7345 7272 6f72 3a0d 0a20 2020 2020  stsError:..     
-00062400: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00062410: 6173 730d 0a0d 0a20 2020 2020 2020 2020  ass....         
-00062420: 2020 2020 2020 2074 6172 6765 745f 6669         target_fi
-00062430: 6c65 5f6e 616d 655f 736f 7274 6564 5f70  le_name_sorted_p
-00062440: 7265 7669 6f75 733d 6f73 2e70 6174 682e  revious=os.path.
-00062450: 6a6f 696e 2873 656c 662e 7369 7465 2e5f  join(self.site._
-00062460: 6461 7461 5f66 696c 6573 5f64 6972 2c27  data_files_dir,'
-00062470: 6c61 7374 5f73 7563 6365 7373 6675 6c5f  last_successful_
-00062480: 6275 6c6b 5f6c 6f61 6427 2c20 7461 7267  bulk_load', targ
-00062490: 6574 5f66 696c 655f 6e61 6d65 5f6e 6f5f  et_file_name_no_
-000624a0: 6578 742b 275f 736f 7274 6564 272b 6578  ext+'_sorted'+ex
-000624b0: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
-000624c0: 2020 2020 6465 6c74 615f 6669 6c65 5f6e      delta_file_n
-000624d0: 616d 653d 6f73 2e70 6174 682e 6a6f 696e  ame=os.path.join
-000624e0: 2873 656c 662e 7369 7465 2e5f 6275 6c6b  (self.site._bulk
-000624f0: 5f6c 6f61 645f 6465 6c74 615f 6469 722c  _load_delta_dir,
-00062500: 2074 6172 6765 745f 6669 6c65 5f6e 616d   target_file_nam
-00062510: 655f 6e6f 5f65 7874 2b27 5f73 6f72 7465  e_no_ext+'_sorte
-00062520: 6427 2b65 7874 290d 0a0d 0a20 2020 2020  d'+ext)....     
-00062530: 2020 2020 2020 2020 2020 2066 6f72 2064             for d
-00062540: 6972 2069 6e20 5b73 656c 662e 5f62 756c  ir in [self._bul
-00062550: 6b5f 6c6f 6164 5f64 656c 7461 5f64 6972  k_load_delta_dir
-00062560: 5d3a 0d0a 0d0a 2020 2020 2020 2020 2020  ]:....          
-00062570: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-00062580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062590: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
-000625a0: 6972 7328 6469 7229 0d0a 2020 2020 2020  irs(dir)..      
-000625b0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-000625c0: 6365 7074 2046 696c 6545 7869 7374 7345  cept FileExistsE
-000625d0: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-000625e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000625f0: 6173 730d 0a20 2020 2020 2020 2020 2020  ass..           
-00062600: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00062610: 4f53 4572 726f 7220 6173 2065 3a0d 0a20  OSError as e:.. 
-00062620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062630: 2020 2020 2020 2069 6620 652e 7769 6e65         if e.wine
-00062640: 7272 6f72 203d 3d20 3132 333a 0d0a 2020  rror == 123:..  
+000618d0: 2020 2069 6620 652e 7769 6e65 7272 6f72     if e.winerror
+000618e0: 203d 3d20 3132 333a 0d0a 2020 2020 2020   == 123:..      
+000618f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061900: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00061910: 6545 7272 6f72 2827 4469 7265 6374 6f72  eError('Director
+00061920: 7920 227b 7d22 2068 6173 2061 6e20 696e  y "{}" has an in
+00061930: 7661 6c69 6420 6e61 6d65 2e20 4469 6420  valid name. Did 
+00061940: 796f 7520 7061 7373 2061 2073 6974 655f  you pass a site_
+00061950: 6c6f 6361 746f 7220 7061 7468 2022 7b7d  locator path "{}
+00061960: 2220 7769 7468 6f75 7420 646f 7562 6c65  " without double
+00061970: 2d65 7363 6170 696e 6720 6261 636b 736c  -escaping backsl
+00061980: 6173 6865 7320 6f72 2070 7265 6669 7869  ashes or prefixi
+00061990: 6e67 2074 6865 2073 7472 696e 6720 7769  ng the string wi
+000619a0: 7468 2061 6e20 2272 2220 666f 7220 7261  th an "r" for ra
+000619b0: 773f 272e 666f 726d 6174 2864 6972 2c72  w?'.format(dir,r
+000619c0: 6570 7228 7369 7465 5f6c 6f63 6174 6f72  epr(site_locator
+000619d0: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
+000619e0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+000619f0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00061a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061a10: 7261 6973 6520 650d 0a20 2020 2020 2020  raise e..       
+00061a20: 2020 2020 2020 2020 2023 4966 2077 6520           #If we 
+00061a30: 6172 6520 6e6f 7420 646f 696e 6720 6120  are not doing a 
+00061a40: 6465 6c74 6120 7765 2064 6f6e 2774 206e  delta we don't n
+00061a50: 6565 6420 746f 2073 6f72 7420 7468 6520  eed to sort the 
+00061a60: 6669 6c65 206f 7220 6372 6561 7465 2061  file or create a
+00061a70: 6e20 6f76 6572 7269 6465 2066 696c 6520  n override file 
+00061a80: 2d20 7765 206a 7573 7420 6e65 6564 2074  - we just need t
+00061a90: 6f20 6d6f 7665 2069 7420 696e 746f 2070  o move it into p
+00061aa0: 6c61 6365 2d20 2074 6869 7320 7368 6f75  lace-  this shou
+00061ab0: 6c64 2062 6520 7175 6963 6b20 6966 2069  ld be quick if i
+00061ac0: 7420 6973 2061 2073 696d 706c 6520 7265  t is a simple re
+00061ad0: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
+00061ae0: 2020 2020 2020 7368 7574 696c 2e6d 6f76        shutil.mov
+00061af0: 6528 7461 7267 6574 5f66 696c 655f 6e61  e(target_file_na
+00061b00: 6d65 2c20 6f73 2e70 6174 682e 6a6f 696e  me, os.path.join
+00061b10: 2873 656c 662e 7369 7465 2e5f 6275 6c6b  (self.site._bulk
+00061b20: 5f6c 6f61 645f 6465 6c74 615f 6469 722c  _load_delta_dir,
+00061b30: 206f 732e 7061 7468 2e62 6173 656e 616d   os.path.basenam
+00061b40: 6528 7461 7267 6574 5f66 696c 655f 6e61  e(target_file_na
+00061b50: 6d65 2929 290d 0a0d 0a20 2020 2020 2020  me)))....       
+00061b60: 2020 2020 2020 2020 2073 656c 662e 7375           self.su
+00061b70: 626c 6f61 6473 2e61 7070 656e 6428 2873  bloads.append((s
+00061b80: 7562 6c6f 6164 5f6e 616d 652c 6f73 2e70  ubload_name,os.p
+00061b90: 6174 682e 6261 7365 6e61 6d65 2874 6172  ath.basename(tar
+00061ba0: 6765 745f 6669 6c65 5f6e 616d 6529 2c29  get_file_name),)
+00061bb0: 290d 0a0d 0a20 2020 2020 2020 2065 6c73  )....        els
+00061bc0: 653a 0d0a 0d0a 2020 2020 2020 2020 2020  e:....          
+00061bd0: 2020 6966 2073 656c 662e 6465 6c74 613a    if self.delta:
+00061be0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00061bf0: 2020 7461 7267 6574 5f66 696c 655f 6e61    target_file_na
+00061c00: 6d65 5f6e 6f5f 6578 742c 2065 7874 203d  me_no_ext, ext =
+00061c10: 206f 732e 7061 7468 2e73 706c 6974 6578   os.path.splitex
+00061c20: 7428 6f73 2e70 6174 682e 6261 7365 6e61  t(os.path.basena
+00061c30: 6d65 2874 6172 6765 745f 6669 6c65 5f6e  me(target_file_n
+00061c40: 616d 6529 290d 0a0d 0a20 2020 2020 2020  ame))....       
+00061c50: 2020 2020 2020 2020 2023 4372 6561 7465           #Create
+00061c60: 2074 6865 2064 656c 7461 0d0a 2020 2020   the delta..    
+00061c70: 2020 2020 2020 2020 2020 2020 2368 6973              #his
+00061c80: 746f 7279 2066 696c 6520 7769 6c6c 2062  tory file will b
+00061c90: 6520 696e 2027 4461 7461 2046 696c 6573  e in 'Data Files
+00061ca0: 5c6c 6173 745f 7375 6363 6573 7366 756c  \last_successful
+00061cb0: 5f62 756c 6b5f 6c6f 6164 270d 0a20 2020  _bulk_load'..   
+00061cc0: 2020 2020 2020 2020 2020 2020 2023 6375               #cu
+00061cd0: 7272 656e 746c 7920 6c6f 6164 696e 6720  rrently loading 
+00061ce0: 6669 6c65 7320 2877 6869 6368 2077 696c  files (which wil
+00061cf0: 6c20 6265 2077 7269 7474 656e 2069 6e74  l be written int
+00061d00: 6f20 2744 6174 6120 4669 6c65 735c 6c61  o 'Data Files\la
+00061d10: 7374 5f73 7563 6365 7373 6675 6c5f 6275  st_successful_bu
+00061d20: 6c6b 5f6c 6f61 6427 2061 6674 6572 2061  lk_load' after a
+00061d30: 2073 7563 6365 7373 6675 6c20 6c6f 6164   successful load
+00061d40: 2061 7265 2069 6e20 2744 6174 6120 4669   are in 'Data Fi
+00061d50: 6c65 735c 6375 7272 656e 746c 795f 7072  les\currently_pr
+00061d60: 6f63 6573 7369 6e67 5f62 756c 6b5f 6c6f  ocessing_bulk_lo
+00061d70: 6164 270d 0a20 2020 2020 2020 2020 2020  ad'..           
+00061d80: 2020 2020 2023 4d61 6b65 2074 6865 2064       #Make the d
+00061d90: 6972 6563 746f 7279 2069 6620 6974 2064  irectory if it d
+00061da0: 6f65 736e 2774 2065 7869 7374 0d0a 2020  oesn't exist..  
+00061db0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00061dc0: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00061dd0: 2020 2020 2020 2020 6f73 2e6d 6b64 6972          os.mkdir
+00061de0: 286f 732e 7061 7468 2e6a 6f69 6e28 7365  (os.path.join(se
+00061df0: 6c66 2e73 6974 652e 5f64 6174 615f 6669  lf.site._data_fi
+00061e00: 6c65 735f 6469 722c 2763 7572 7265 6e74  les_dir,'current
+00061e10: 6c79 5f70 726f 6365 7373 696e 675f 6275  ly_processing_bu
+00061e20: 6c6b 5f6c 6f61 6427 2929 0d0a 2020 2020  lk_load'))..    
+00061e30: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00061e40: 7074 2046 696c 6545 7869 7374 7345 7272  pt FileExistsErr
+00061e50: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00061e60: 2020 2020 2020 2020 2023 4966 2074 6865           #If the
+00061e70: 2064 6972 6563 746f 7279 2064 6f65 7320   directory does 
+00061e80: 6578 6973 742c 2074 6865 6e20 6974 2068  exist, then it h
+00061e90: 6f6c 6473 2064 6174 6120 6672 6f6d 2061  olds data from a
+00061ea0: 2066 6169 6c65 6420 6c6f 6164 202d 2072   failed load - r
+00061eb0: 656d 6f76 6520 7468 6520 6661 696c 6564  emove the failed
+00061ec0: 2064 6174 610d 0a20 2020 2020 2020 2020   data..         
+00061ed0: 2020 2020 2020 2020 2020 206c 6f67 2e77             log.w
+00061ee0: 6172 6e28 2746 6f75 6e64 206c 6566 746f  arn('Found lefto
+00061ef0: 7665 7220 6461 7461 2066 726f 6d20 6120  ver data from a 
+00061f00: 7072 6576 696f 7573 6c79 2066 6169 6c65  previously faile
+00061f10: 6420 6c6f 6164 2069 6e20 272b 7374 7228  d load in '+str(
+00061f20: 6f73 2e70 6174 682e 6a6f 696e 2873 656c  os.path.join(sel
+00061f30: 662e 7369 7465 2e5f 6461 7461 5f66 696c  f.site._data_fil
+00061f40: 6573 5f64 6972 2c27 6375 7272 656e 746c  es_dir,'currentl
+00061f50: 795f 7072 6f63 6573 7369 6e67 5f62 756c  y_processing_bul
+00061f60: 6b5f 6c6f 6164 2729 2929 0d0a 2020 2020  k_load')))..    
+00061f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061f80: 666f 7220 6620 696e 206f 732e 6c69 7374  for f in os.list
+00061f90: 6469 7228 6f73 2e70 6174 682e 6a6f 696e  dir(os.path.join
+00061fa0: 2873 656c 662e 7369 7465 2e5f 6461 7461  (self.site._data
+00061fb0: 5f66 696c 6573 5f64 6972 2c27 6375 7272  _files_dir,'curr
+00061fc0: 656e 746c 795f 7072 6f63 6573 7369 6e67  ently_processing
+00061fd0: 5f62 756c 6b5f 6c6f 6164 2729 293a 0d0a  _bulk_load')):..
+00061fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00061ff0: 2020 2020 2020 2020 6f73 2e72 656d 6f76          os.remov
+00062000: 6528 6f73 2e70 6174 682e 6a6f 696e 2873  e(os.path.join(s
+00062010: 656c 662e 7369 7465 2e5f 6461 7461 5f66  elf.site._data_f
+00062020: 696c 6573 5f64 6972 2c27 6375 7272 656e  iles_dir,'curren
+00062030: 746c 795f 7072 6f63 6573 7369 6e67 5f62  tly_processing_b
+00062040: 756c 6b5f 6c6f 6164 272c 6629 290d 0a0d  ulk_load',f))...
+00062050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00062060: 2074 6172 6765 745f 6669 6c65 5f6e 616d   target_file_nam
+00062070: 655f 736f 7274 6564 3d6f 732e 7061 7468  e_sorted=os.path
+00062080: 2e6a 6f69 6e28 7365 6c66 2e73 6974 652e  .join(self.site.
+00062090: 5f64 6174 615f 6669 6c65 735f 6469 722c  _data_files_dir,
+000620a0: 2763 7572 7265 6e74 6c79 5f70 726f 6365  'currently_proce
+000620b0: 7373 696e 675f 6275 6c6b 5f6c 6f61 6427  ssing_bulk_load'
+000620c0: 2c20 7461 7267 6574 5f66 696c 655f 6e61  , target_file_na
+000620d0: 6d65 5f6e 6f5f 6578 742b 275f 736f 7274  me_no_ext+'_sort
+000620e0: 6564 272b 6578 7429 0d0a 0d0a 0d0a 2020  ed'+ext)......  
+000620f0: 2020 2020 2020 2020 2020 2020 2020 2353                #S
+00062100: 6f72 7420 7468 6520 6578 706c 6f64 6564  ort the exploded
+00062110: 2062 756c 6b20 6c6f 6164 2066 696c 6520   bulk load file 
+00062120: 2d20 736f 2074 6861 7420 7765 2063 616e  - so that we can
+00062130: 2064 656c 7461 2069 740d 0a20 2020 2020   delta it..     
+00062140: 2020 2020 2020 2020 2020 206c 6c75 2e73             llu.s
+00062150: 6f72 745f 6669 6c65 2873 6f75 7263 655f  ort_file(source_
+00062160: 6669 6c65 5f6e 616d 653d 7461 7267 6574  file_name=target
+00062170: 5f66 696c 655f 6e61 6d65 2c74 6172 6765  _file_name,targe
+00062180: 745f 6669 6c65 5f6e 616d 653d 7461 7267  t_file_name=targ
+00062190: 6574 5f66 696c 655f 6e61 6d65 5f73 6f72  et_file_name_sor
+000621a0: 7465 6429 0d0a 0d0a 2020 2020 2020 2020  ted)....        
+000621b0: 2020 2020 2020 2020 234d 616b 6520 7468          #Make th
+000621c0: 6520 6469 7265 6374 6f72 7920 6966 2069  e directory if i
+000621d0: 7420 646f 6573 6e27 7420 6578 6973 740d  t doesn't exist.
+000621e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000621f0: 2023 4d6f 7665 2061 6e79 2073 6f72 7465   #Move any sorte
+00062200: 642e 7473 7620 6669 6c65 7320 696e 2c20  d.tsv files in, 
+00062210: 6173 2074 6865 7920 776f 756c 6420 6861  as they would ha
+00062220: 7665 2062 6565 6e20 6372 6561 7465 6420  ve been created 
+00062230: 6279 2061 2070 7265 7669 6f75 7320 696e  by a previous in
+00062240: 6361 726e 6174 696f 6e20 6f66 2074 6869  carnation of thi
+00062250: 7320 636f 6465 0d0a 2020 2020 2020 2020  s code..        
+00062260: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00062270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062280: 2020 6f73 2e6d 6b64 6972 286f 732e 7061    os.mkdir(os.pa
+00062290: 7468 2e6a 6f69 6e28 7365 6c66 2e73 6974  th.join(self.sit
+000622a0: 652e 5f64 6174 615f 6669 6c65 735f 6469  e._data_files_di
+000622b0: 722c 276c 6173 745f 7375 6363 6573 7366  r,'last_successf
+000622c0: 756c 5f62 756c 6b5f 6c6f 6164 2729 290d  ul_bulk_load')).
+000622d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000622e0: 2020 2020 2066 6f72 2066 2069 6e20 6f73       for f in os
+000622f0: 2e6c 6973 7464 6972 286f 732e 7061 7468  .listdir(os.path
+00062300: 2e6a 6f69 6e28 7365 6c66 2e73 6974 652e  .join(self.site.
+00062310: 5f64 6174 615f 6669 6c65 735f 6469 7229  _data_files_dir)
+00062320: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00062330: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+00062340: 6e6d 6174 6368 2e66 6e6d 6174 6368 2866  nmatch.fnmatch(f
+00062350: 2c27 2a5f 736f 7274 6564 2e74 7376 2729  ,'*_sorted.tsv')
+00062360: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00062370: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00062380: 6875 7469 6c2e 6d6f 7665 286f 732e 7061  hutil.move(os.pa
+00062390: 7468 2e6a 6f69 6e28 7365 6c66 2e73 6974  th.join(self.sit
+000623a0: 652e 5f64 6174 615f 6669 6c65 735f 6469  e._data_files_di
+000623b0: 722c 6629 2c20 6f73 2e70 6174 682e 6a6f  r,f), os.path.jo
+000623c0: 696e 2873 656c 662e 7369 7465 2e5f 6461  in(self.site._da
+000623d0: 7461 5f66 696c 6573 5f64 6972 2c27 6c61  ta_files_dir,'la
+000623e0: 7374 5f73 7563 6365 7373 6675 6c5f 6275  st_successful_bu
+000623f0: 6c6b 5f6c 6f61 6427 2929 0d0a 0d0a 2020  lk_load'))....  
+00062400: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00062410: 6365 7074 2046 696c 6545 7869 7374 7345  cept FileExistsE
+00062420: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+00062430: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+00062440: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
+00062450: 2020 2074 6172 6765 745f 6669 6c65 5f6e     target_file_n
+00062460: 616d 655f 736f 7274 6564 5f70 7265 7669  ame_sorted_previ
+00062470: 6f75 733d 6f73 2e70 6174 682e 6a6f 696e  ous=os.path.join
+00062480: 2873 656c 662e 7369 7465 2e5f 6461 7461  (self.site._data
+00062490: 5f66 696c 6573 5f64 6972 2c27 6c61 7374  _files_dir,'last
+000624a0: 5f73 7563 6365 7373 6675 6c5f 6275 6c6b  _successful_bulk
+000624b0: 5f6c 6f61 6427 2c20 7461 7267 6574 5f66  _load', target_f
+000624c0: 696c 655f 6e61 6d65 5f6e 6f5f 6578 742b  ile_name_no_ext+
+000624d0: 275f 736f 7274 6564 272b 6578 7429 0d0a  '_sorted'+ext)..
+000624e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000624f0: 6465 6c74 615f 6669 6c65 5f6e 616d 653d  delta_file_name=
+00062500: 6f73 2e70 6174 682e 6a6f 696e 2873 656c  os.path.join(sel
+00062510: 662e 7369 7465 2e5f 6275 6c6b 5f6c 6f61  f.site._bulk_loa
+00062520: 645f 6465 6c74 615f 6469 722c 2074 6172  d_delta_dir, tar
+00062530: 6765 745f 6669 6c65 5f6e 616d 655f 6e6f  get_file_name_no
+00062540: 5f65 7874 2b27 5f73 6f72 7465 6427 2b65  _ext+'_sorted'+e
+00062550: 7874 290d 0a0d 0a20 2020 2020 2020 2020  xt)....         
+00062560: 2020 2020 2020 2066 6f72 2064 6972 2069         for dir i
+00062570: 6e20 5b73 656c 662e 5f62 756c 6b5f 6c6f  n [self._bulk_lo
+00062580: 6164 5f64 656c 7461 5f64 6972 5d3a 0d0a  ad_delta_dir]:..
+00062590: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000625a0: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+000625b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000625c0: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
+000625d0: 6469 7229 0d0a 2020 2020 2020 2020 2020  dir)..          
+000625e0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+000625f0: 2046 696c 6545 7869 7374 7345 7272 6f72   FileExistsError
+00062600: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00062610: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+00062620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00062630: 2020 2020 2065 7863 6570 7420 4f53 4572       except OSEr
+00062640: 726f 7220 6173 2065 3a0d 0a20 2020 2020  ror as e:..     
 00062650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062660: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00062670: 5661 6c75 6545 7272 6f72 2827 4469 7265  ValueError('Dire
-00062680: 6374 6f72 7920 227b 7d22 2068 6173 2061  ctory "{}" has a
-00062690: 6e20 696e 7661 6c69 6420 6e61 6d65 2e20  n invalid name. 
-000626a0: 4469 6420 796f 7520 7061 7373 2061 2073  Did you pass a s
-000626b0: 6974 655f 6c6f 6361 746f 7220 7061 7468  ite_locator path
-000626c0: 2022 7b7d 2220 7769 7468 6f75 7420 646f   "{}" without do
-000626d0: 7562 6c65 2d65 7363 6170 696e 6720 6261  uble-escaping ba
-000626e0: 636b 736c 6173 6865 7320 6f72 2070 7265  ckslashes or pre
-000626f0: 6669 7869 6e67 2074 6865 2073 7472 696e  fixing the strin
-00062700: 6720 7769 7468 2061 6e20 2272 2220 666f  g with an "r" fo
-00062710: 7220 7261 773f 272e 666f 726d 6174 2864  r raw?'.format(d
-00062720: 6972 2c72 6570 7228 7369 7465 5f6c 6f63  ir,repr(site_loc
-00062730: 6174 6f72 2929 290d 0a20 2020 2020 2020  ator)))..       
-00062740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062750: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-00062760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062770: 2020 2020 7261 6973 6520 650d 0a20 2020      raise e..   
-00062780: 2020 2020 2020 2020 2020 2020 2023 4174               #At
-00062790: 7465 6d70 7420 746f 2063 7265 6174 6520  tempt to create 
-000627a0: 6120 6465 6c74 6120 6275 6c6b 206c 6f61  a delta bulk loa
-000627b0: 6420 6669 6c65 0d0a 2020 2020 2020 2020  d file..        
-000627c0: 2020 2020 2020 2020 6c6c 752e 6372 6561          llu.crea
-000627d0: 7465 5f6f 7665 7277 7269 7465 5f62 756c  te_overwrite_bul
-000627e0: 6b5f 6c6f 6164 5f66 696c 6528 6f6c 645f  k_load_file(old_
-000627f0: 736f 7572 6365 5f62 756c 6b5f 6c6f 6164  source_bulk_load
-00062800: 5f72 6561 6479 5f66 696c 655f 736f 7274  _ready_file_sort
-00062810: 6564 203d 2074 6172 6765 745f 6669 6c65  ed = target_file
-00062820: 5f6e 616d 655f 736f 7274 6564 5f70 7265  _name_sorted_pre
-00062830: 7669 6f75 730d 0a20 2020 2020 2020 2020  vious..         
-00062840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062860: 2020 2020 2020 2020 2020 2c6e 6577 5f73            ,new_s
-00062870: 6f75 7263 655f 6275 6c6b 5f6c 6f61 645f  ource_bulk_load_
-00062880: 7265 6164 795f 6669 6c65 5f73 6f72 7465  ready_file_sorte
-00062890: 6420 3d20 7461 7267 6574 5f66 696c 655f  d = target_file_
-000628a0: 6e61 6d65 5f73 6f72 7465 640d 0a20 2020  name_sorted..   
-000628b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000628c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000628d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000628e0: 2c74 6172 6765 745f 6275 6c6b 5f6c 6f61  ,target_bulk_loa
-000628f0: 645f 7265 6164 795f 6669 6c65 2020 2020  d_ready_file    
-00062900: 2020 2020 2020 2020 3d20 6465 6c74 615f          = delta_
-00062910: 6669 6c65 5f6e 616d 650d 0a20 2020 2020  file_name..     
-00062920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062940: 2020 2020 2020 2020 2020 2020 2020 2c74                ,t
-00062950: 6172 6765 745f 6275 6c6b 5f6c 6f61 645f  arget_bulk_load_
-00062960: 7265 7665 7273 696f 6e5f 6669 6c65 2020  reversion_file  
-00062970: 2020 2020 2020 3d20 6f73 2e64 6576 6e75        = os.devnu
-00062980: 6c6c 0d0a 2020 2020 2020 2020 2020 2020  ll..            
-00062990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000629a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000629b0: 2020 2020 2020 202c 6372 6561 7465 5f74         ,create_t
-000629c0: 7275 655f 6465 6c74 6120 2020 2020 2020  rue_delta       
-000629d0: 2020 2020 2020 2020 2020 2020 2020 203d                 =
-000629e0: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
-000629f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062a10: 2020 2020 2020 2020 2020 2c6e 756d 6265            ,numbe
-00062a20: 725f 6f66 5f75 6e69 745f 6469 6d65 6e73  r_of_unit_dimens
-00062a30: 696f 6e73 2020 2020 2020 2020 2020 2020  ions            
-00062a40: 2020 3d20 7365 6c66 2e73 6974 652e 6e75    = self.site.nu
-00062a50: 6d62 6572 5f6f 665f 756e 6974 5f64 696d  mber_of_unit_dim
-00062a60: 656e 7369 6f6e 730d 0a20 2020 2020 2020  ensions..       
-00062a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062a90: 2020 2020 2020 2020 2020 2020 2c69 676e              ,ign
-00062aa0: 6f72 655f 6d69 7373 696e 675f 6f6c 6420  ore_missing_old 
+00062660: 2020 2069 6620 652e 7769 6e65 7272 6f72     if e.winerror
+00062670: 203d 3d20 3132 333a 0d0a 2020 2020 2020   == 123:..      
+00062680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062690: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+000626a0: 6545 7272 6f72 2827 4469 7265 6374 6f72  eError('Director
+000626b0: 7920 227b 7d22 2068 6173 2061 6e20 696e  y "{}" has an in
+000626c0: 7661 6c69 6420 6e61 6d65 2e20 4469 6420  valid name. Did 
+000626d0: 796f 7520 7061 7373 2061 2073 6974 655f  you pass a site_
+000626e0: 6c6f 6361 746f 7220 7061 7468 2022 7b7d  locator path "{}
+000626f0: 2220 7769 7468 6f75 7420 646f 7562 6c65  " without double
+00062700: 2d65 7363 6170 696e 6720 6261 636b 736c  -escaping backsl
+00062710: 6173 6865 7320 6f72 2070 7265 6669 7869  ashes or prefixi
+00062720: 6e67 2074 6865 2073 7472 696e 6720 7769  ng the string wi
+00062730: 7468 2061 6e20 2272 2220 666f 7220 7261  th an "r" for ra
+00062740: 773f 272e 666f 726d 6174 2864 6972 2c72  w?'.format(dir,r
+00062750: 6570 7228 7369 7465 5f6c 6f63 6174 6f72  epr(site_locator
+00062760: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
+00062770: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00062780: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00062790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000627a0: 7261 6973 6520 650d 0a20 2020 2020 2020  raise e..       
+000627b0: 2020 2020 2020 2020 2023 4174 7465 6d70           #Attemp
+000627c0: 7420 746f 2063 7265 6174 6520 6120 6465  t to create a de
+000627d0: 6c74 6120 6275 6c6b 206c 6f61 6420 6669  lta bulk load fi
+000627e0: 6c65 0d0a 2020 2020 2020 2020 2020 2020  le..            
+000627f0: 2020 2020 6c6c 752e 6372 6561 7465 5f6f      llu.create_o
+00062800: 7665 7277 7269 7465 5f62 756c 6b5f 6c6f  verwrite_bulk_lo
+00062810: 6164 5f66 696c 6528 6f6c 645f 736f 7572  ad_file(old_sour
+00062820: 6365 5f62 756c 6b5f 6c6f 6164 5f72 6561  ce_bulk_load_rea
+00062830: 6479 5f66 696c 655f 736f 7274 6564 203d  dy_file_sorted =
+00062840: 2074 6172 6765 745f 6669 6c65 5f6e 616d   target_file_nam
+00062850: 655f 736f 7274 6564 5f70 7265 7669 6f75  e_sorted_previou
+00062860: 730d 0a20 2020 2020 2020 2020 2020 2020  s..             
+00062870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062890: 2020 2020 2020 2c6e 6577 5f73 6f75 7263        ,new_sourc
+000628a0: 655f 6275 6c6b 5f6c 6f61 645f 7265 6164  e_bulk_load_read
+000628b0: 795f 6669 6c65 5f73 6f72 7465 6420 3d20  y_file_sorted = 
+000628c0: 7461 7267 6574 5f66 696c 655f 6e61 6d65  target_file_name
+000628d0: 5f73 6f72 7465 640d 0a20 2020 2020 2020  _sorted..       
+000628e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000628f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062900: 2020 2020 2020 2020 2020 2020 2c74 6172              ,tar
+00062910: 6765 745f 6275 6c6b 5f6c 6f61 645f 7265  get_bulk_load_re
+00062920: 6164 795f 6669 6c65 2020 2020 2020 2020  ady_file        
+00062930: 2020 2020 3d20 6465 6c74 615f 6669 6c65      = delta_file
+00062940: 5f6e 616d 650d 0a20 2020 2020 2020 2020  _name..         
+00062950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062970: 2020 2020 2020 2020 2020 2c74 6172 6765            ,targe
+00062980: 745f 6275 6c6b 5f6c 6f61 645f 7265 7665  t_bulk_load_reve
+00062990: 7273 696f 6e5f 6669 6c65 2020 2020 2020  rsion_file      
+000629a0: 2020 3d20 6f73 2e64 6576 6e75 6c6c 0d0a    = os.devnull..
+000629b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000629c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000629d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000629e0: 2020 202c 6372 6561 7465 5f74 7275 655f     ,create_true_
+000629f0: 6465 6c74 6120 2020 2020 2020 2020 2020  delta           
+00062a00: 2020 2020 2020 2020 2020 203d 2054 7275             = Tru
+00062a10: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00062a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062a40: 2020 2020 2020 2c6e 756d 6265 725f 6f66        ,number_of
+00062a50: 5f75 6e69 745f 6469 6d65 6e73 696f 6e73  _unit_dimensions
+00062a60: 2020 2020 2020 2020 2020 2020 2020 3d20                = 
+00062a70: 7365 6c66 2e73 6974 652e 6e75 6d62 6572  self.site.number
+00062a80: 5f6f 665f 756e 6974 5f64 696d 656e 7369  _of_unit_dimensi
+00062a90: 6f6e 730d 0a20 2020 2020 2020 2020 2020  ons..           
+00062aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00062ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062ac0: 2020 2020 3d20 5472 7565 0d0a 2020 2020      = True..    
-00062ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062ac0: 2020 2020 2020 2020 2c69 676e 6f72 655f          ,ignore_
+00062ad0: 6d69 7373 696e 675f 6f6c 6420 2020 2020  missing_old     
 00062ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062af0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00062b00: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00062b10: 2020 2020 7365 6c66 2e73 7562 6c6f 6164      self.subload
-00062b20: 732e 6170 7065 6e64 2828 7375 626c 6f61  s.append((subloa
-00062b30: 645f 6e61 6d65 2c74 6172 6765 745f 6669  d_name,target_fi
-00062b40: 6c65 5f6e 616d 655f 736f 7274 6564 2929  le_name_sorted))
-00062b50: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00062b60: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00062b70: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
-00062b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062b90: 206f 732e 6d6b 6469 7228 6f73 2e70 6174   os.mkdir(os.pat
-00062ba0: 682e 6a6f 696e 2873 656c 662e 7369 7465  h.join(self.site
-00062bb0: 2e5f 6461 7461 5f66 696c 6573 5f64 6972  ._data_files_dir
-00062bc0: 2c27 6375 7272 656e 746c 795f 7072 6f63  ,'currently_proc
-00062bd0: 6573 7369 6e67 5f62 756c 6b5f 6c6f 6164  essing_bulk_load
-00062be0: 2729 290d 0a20 2020 2020 2020 2020 2020  '))..           
-00062bf0: 2020 2020 2065 7863 6570 7420 4669 6c65       except File
-00062c00: 4578 6973 7473 4572 726f 723a 0d0a 2020  ExistsError:..  
-00062c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062c20: 2020 7061 7373 0d0a 0d0a 2020 2020 2020    pass....      
-00062c30: 2020 2020 2020 2020 2020 666f 7220 6469            for di
-00062c40: 7220 696e 205b 7365 6c66 2e73 6974 652e  r in [self.site.
-00062c50: 5f62 756c 6b5f 6c6f 6164 5f64 656c 7461  _bulk_load_delta
-00062c60: 5f64 6972 5d3a 0d0a 0d0a 2020 2020 2020  _dir]:....      
-00062c70: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00062c80: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00062c90: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
-00062ca0: 616b 6564 6972 7328 6469 7229 0d0a 2020  akedirs(dir)..  
+00062af0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
+00062b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062b20: 2020 2020 2020 2020 2020 2029 0d0a 0d0a             )....
+00062b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062b40: 7365 6c66 2e73 7562 6c6f 6164 732e 6170  self.subloads.ap
+00062b50: 7065 6e64 2828 7375 626c 6f61 645f 6e61  pend((subload_na
+00062b60: 6d65 2c74 6172 6765 745f 6669 6c65 5f6e  me,target_file_n
+00062b70: 616d 655f 736f 7274 6564 2929 0d0a 0d0a  ame_sorted))....
+00062b80: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00062b90: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00062ba0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
+00062bb0: 2020 2020 2020 2020 2020 2020 206f 732e               os.
+00062bc0: 6d6b 6469 7228 6f73 2e70 6174 682e 6a6f  mkdir(os.path.jo
+00062bd0: 696e 2873 656c 662e 7369 7465 2e5f 6461  in(self.site._da
+00062be0: 7461 5f66 696c 6573 5f64 6972 2c27 6375  ta_files_dir,'cu
+00062bf0: 7272 656e 746c 795f 7072 6f63 6573 7369  rrently_processi
+00062c00: 6e67 5f62 756c 6b5f 6c6f 6164 2729 290d  ng_bulk_load')).
+00062c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00062c20: 2065 7863 6570 7420 4669 6c65 4578 6973   except FileExis
+00062c30: 7473 4572 726f 723a 0d0a 2020 2020 2020  tsError:..      
+00062c40: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00062c50: 7373 0d0a 0d0a 2020 2020 2020 2020 2020  ss....          
+00062c60: 2020 2020 2020 666f 7220 6469 7220 696e        for dir in
+00062c70: 205b 7365 6c66 2e73 6974 652e 5f62 756c   [self.site._bul
+00062c80: 6b5f 6c6f 6164 5f64 656c 7461 5f64 6972  k_load_delta_dir
+00062c90: 5d3a 0d0a 0d0a 2020 2020 2020 2020 2020  ]:....          
+00062ca0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
 00062cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062cc0: 2020 6578 6365 7074 2046 696c 6545 7869    except FileExi
-00062cd0: 7374 7345 7272 6f72 3a0d 0a20 2020 2020  stsError:..     
-00062ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062cf0: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
-00062d00: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-00062d10: 6570 7420 4f53 4572 726f 7220 6173 2065  ept OSError as e
-00062d20: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00062d30: 2020 2020 2020 2020 2020 2069 6620 652e             if e.
-00062d40: 7769 6e65 7272 6f72 203d 3d20 3132 333a  winerror == 123:
-00062d50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00062d60: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00062d70: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
-00062d80: 4469 7265 6374 6f72 7920 227b 7d22 2068  Directory "{}" h
-00062d90: 6173 2061 6e20 696e 7661 6c69 6420 6e61  as an invalid na
-00062da0: 6d65 2e20 4469 6420 796f 7520 7061 7373  me. Did you pass
-00062db0: 2061 2073 6974 655f 6c6f 6361 746f 7220   a site_locator 
-00062dc0: 7061 7468 2022 7b7d 2220 7769 7468 6f75  path "{}" withou
-00062dd0: 7420 646f 7562 6c65 2d65 7363 6170 696e  t double-escapin
-00062de0: 6720 6261 636b 736c 6173 6865 7320 6f72  g backslashes or
-00062df0: 2070 7265 6669 7869 6e67 2074 6865 2073   prefixing the s
-00062e00: 7472 696e 6720 7769 7468 2061 6e20 2272  tring with an "r
-00062e10: 2220 666f 7220 7261 773f 272e 666f 726d  " for raw?'.form
-00062e20: 6174 2864 6972 2c72 6570 7228 7369 7465  at(dir,repr(site
-00062e30: 5f6c 6f63 6174 6f72 2929 290d 0a20 2020  _locator)))..   
-00062e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062e50: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
-00062e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00062e70: 2020 2020 2020 2020 7261 6973 6520 650d          raise e.
-00062e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00062e90: 2023 4966 2077 6520 6172 6520 6e6f 7420   #If we are not 
-00062ea0: 646f 696e 6720 6120 6465 6c74 6120 7765  doing a delta we
-00062eb0: 2064 6f6e 2774 206e 6565 6420 746f 2073   don't need to s
-00062ec0: 6f72 7420 7468 6520 6669 6c65 206f 7220  ort the file or 
-00062ed0: 6372 6561 7465 2061 6e20 6f76 6572 7269  create an overri
-00062ee0: 6465 2066 696c 6520 2d20 7765 206a 7573  de file - we jus
-00062ef0: 7420 6e65 6564 2074 6f20 6d6f 7665 2069  t need to move i
-00062f00: 7420 696e 746f 2070 6c61 6365 2d20 2074  t into place-  t
-00062f10: 6869 7320 7368 6f75 6c64 2062 6520 7175  his should be qu
-00062f20: 6963 6b20 6966 2069 7420 6973 2061 2073  ick if it is a s
-00062f30: 696d 706c 6520 7265 6e61 6d65 0d0a 2020  imple rename..  
-00062f40: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-00062f50: 7574 696c 2e6d 6f76 6528 7461 7267 6574  util.move(target
-00062f60: 5f66 696c 655f 6e61 6d65 2c20 6f73 2e70  _file_name, os.p
-00062f70: 6174 682e 6a6f 696e 2873 656c 662e 7369  ath.join(self.si
-00062f80: 7465 2e5f 6275 6c6b 5f6c 6f61 645f 6465  te._bulk_load_de
-00062f90: 6c74 615f 6469 722c 206f 732e 7061 7468  lta_dir, os.path
-00062fa0: 2e62 6173 656e 616d 6528 7461 7267 6574  .basename(target
-00062fb0: 5f66 696c 655f 6e61 6d65 2929 290d 0a0d  _file_name)))...
-00062fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00062fd0: 2073 656c 662e 7375 626c 6f61 6473 2e61   self.subloads.a
-00062fe0: 7070 656e 6428 2873 7562 6c6f 6164 5f6e  ppend((subload_n
-00062ff0: 616d 652c 6f73 2e70 6174 682e 6261 7365  ame,os.path.base
-00063000: 6e61 6d65 2874 6172 6765 745f 6669 6c65  name(target_file
-00063010: 5f6e 616d 6529 2929 0d0a 0d0a 0d0a 2020  _name)))......  
-00063020: 2020 2020 2020 234d 616b 6520 7468 6520        #Make the 
-00063030: 6c69 7374 2075 6e69 7175 6520 2d20 696e  list unique - in
-00063040: 2063 6173 6520 7765 2061 7265 2072 756e   case we are run
-00063050: 6e69 6e67 2074 6869 7320 696e 204a 7570  ning this in Jup
-00063060: 7974 6572 206e 6f74 6562 6f6f 6b2c 2061  yter notebook, a
-00063070: 6e64 2074 6865 2073 616d 6520 6c6f 6164  nd the same load
-00063080: 6572 2069 7320 6265 696e 6720 7275 6e20  er is being run 
-00063090: 6d75 6c74 6970 6c65 2074 696d 6573 2028  multiple times (
-000630a0: 652e 672e 2064 7572 696e 6720 6465 7665  e.g. during deve
-000630b0: 6c6f 706d 656e 7429 0d0a 2020 2020 2020  lopment)..      
-000630c0: 2020 7365 6c66 2e73 7562 6c6f 6164 733d    self.subloads=
-000630d0: 6c69 7374 2873 6574 2820 7365 6c66 2e73  list(set( self.s
-000630e0: 7562 6c6f 6164 7329 290d 0a0d 0a20 2020  ubloads))....   
-000630f0: 2020 2020 2023 6966 206e 6f74 2073 656c       #if not sel
-00063100: 662e 7368 6172 6469 6e67 5f71 7565 7565  f.sharding_queue
-00063110: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00063120: 2020 2023 2020 2020 6465 6c74 615f 6669     #    delta_fi
-00063130: 6c65 5f6e 616d 6520 3d20 6f73 2e70 6174  le_name = os.pat
-00063140: 682e 6a6f 696e 2873 656c 662e 7369 7465  h.join(self.site
-00063150: 2e5f 6275 6c6b 5f6c 6f61 645f 6465 6c74  ._bulk_load_delt
-00063160: 615f 6469 722c 6f73 2e70 6174 682e 6261  a_dir,os.path.ba
-00063170: 7365 6e61 6d65 2874 6172 6765 745f 6669  sename(target_fi
-00063180: 6c65 5f6e 616d 6529 290d 0a20 2020 2020  le_name))..     
-00063190: 2020 2023 0d0a 2020 2020 2020 2020 2320     #..        # 
-000631a0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-000631b0: 2023 2020 2020 2020 2020 2370 7574 2074   #        #put t
-000631c0: 6865 206d 6573 7361 6765 206f 6e20 7468  he message on th
-000631d0: 6520 7175 6575 650d 0a20 2020 2020 2020  e queue..       
-000631e0: 2023 2020 2020 2020 2020 7365 6c66 2e73   #        self.s
-000631f0: 6861 7264 696e 675f 7175 6575 652e 7075  harding_queue.pu
-00063200: 7428 6465 6c74 615f 6669 6c65 5f6e 616d  t(delta_file_nam
-00063210: 6529 0d0a 2020 2020 2020 2020 2320 2020  e)..        #   
-00063220: 2020 2020 206c 6f67 2e76 6572 626f 7365       log.verbose
-00063230: 2827 5175 6575 696e 6720 6669 6c65 2066  ('Queuing file f
-00063240: 6f72 2073 6861 7264 696e 673a 272b 6465  or sharding:'+de
-00063250: 6c74 615f 6669 6c65 5f6e 616d 6529 0d0a  lta_file_name)..
-00063260: 2020 2020 2020 2020 230d 0a20 2020 2020          #..     
-00063270: 2020 2023 0d0a 2020 2020 2020 2020 2320     #..        # 
-00063280: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00063290: 696f 6e3a 0d0a 2020 2020 2020 2020 2320  ion:..        # 
-000632a0: 2020 2020 2020 206c 6f67 2e65 7272 6f72         log.error
-000632b0: 2827 4661 696c 696e 6720 7368 6172 6469  ('Failing shardi
-000632c0: 6e67 2071 7565 7565 2e2e 2e27 290d 0a20  ng queue...').. 
-000632d0: 2020 2020 2020 2023 2020 2020 2020 2020         #        
-000632e0: 7365 6c66 2e73 6861 7264 696e 675f 7175  self.sharding_qu
-000632f0: 6575 652e 6661 696c 2829 0d0a 2020 2020  eue.fail()..    
-00063300: 2020 2020 2320 2020 2020 2020 206c 6f67      #        log
-00063310: 2e65 7272 6f72 2827 4661 696c 6564 2020  .error('Failed  
-00063320: 7368 6172 6469 6e67 2071 7565 7565 2729  sharding queue')
-00063330: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
-00063340: 2020 2072 6169 7365 0d0a 0d0a 0d0a 2020     raise......  
-00063350: 2020 6465 6620 7368 6172 6428 7365 6c66    def shard(self
-00063360: 2c66 696c 6573 5f74 6f5f 7368 6172 643d  ,files_to_shard=
-00063370: 4e6f 6e65 293a 0d0a 2020 2020 2020 2020  None):..        
-00063380: 2727 2753 6861 7264 2061 6c6c 206f 6620  '''Shard all of 
-00063390: 7468 6520 6465 6c74 6120 6669 6c65 7320  the delta files 
-000633a0: 666f 7220 616c 6c20 6f66 2074 6865 2073  for all of the s
-000633b0: 7562 6c6f 6164 7320 746f 2063 7265 6174  ubloads to creat
-000633c0: 6520 6669 6c65 7320 7265 6164 7920 746f  e files ready to
-000633d0: 2062 6520 6c6f 6164 6564 2727 270d 0a0d   be loaded'''...
-000633e0: 0a20 2020 2020 2020 2069 6620 6669 6c65  .        if file
-000633f0: 735f 746f 5f73 6861 7264 2069 7320 4e6f  s_to_shard is No
-00063400: 6e65 2061 6e64 2073 656c 662e 7368 6172  ne and self.shar
-00063410: 6469 6e67 5f71 7565 7565 2069 7320 4e6f  ding_queue is No
-00063420: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
-00063430: 2066 696c 6573 5f74 6f5f 7368 6172 643d   files_to_shard=
-00063440: 5b5d 0d0a 2020 2020 2020 2020 2020 2020  []..            
-00063450: 2347 6f20 7468 726f 7567 6820 616c 6c20  #Go through all 
-00063460: 6f66 2074 6865 2066 696c 6573 2074 6f20  of the files to 
-00063470: 7368 6172 6420 6672 6f6d 2073 7562 6c6f  shard from sublo
-00063480: 6164 7320 616e 6420 7368 6172 6420 7468  ads and shard th
-00063490: 656d 2074 6f67 6574 6865 720d 0a20 2020  em together..   
-000634a0: 2020 2020 2020 2020 2066 6f72 2073 7562           for sub
-000634b0: 6c6f 6164 5f6e 616d 652c 7461 7267 6574  load_name,target
-000634c0: 5f66 696c 655f 6e61 6d65 5f73 6f72 7465  _file_name_sorte
-000634d0: 6420 696e 2073 656c 662e 7375 626c 6f61  d in self.subloa
-000634e0: 6473 3a0d 0a20 2020 2020 2020 2020 2020  ds:..           
-000634f0: 2020 2020 2064 656c 7461 5f66 696c 655f       delta_file_
-00063500: 6e61 6d65 203d 206f 732e 7061 7468 2e6a  name = os.path.j
-00063510: 6f69 6e28 7365 6c66 2e73 6974 652e 5f62  oin(self.site._b
-00063520: 756c 6b5f 6c6f 6164 5f64 656c 7461 5f64  ulk_load_delta_d
-00063530: 6972 2c6f 732e 7061 7468 2e62 6173 656e  ir,os.path.basen
-00063540: 616d 6528 7461 7267 6574 5f66 696c 655f  ame(target_file_
-00063550: 6e61 6d65 5f73 6f72 7465 6429 290d 0a0d  name_sorted))...
-00063560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00063570: 2066 696c 6573 5f74 6f5f 7368 6172 642e   files_to_shard.
-00063580: 6170 7065 6e64 2864 656c 7461 5f66 696c  append(delta_fil
-00063590: 655f 6e61 6d65 290d 0a0d 0a0d 0a0d 0a20  e_name)........ 
-000635a0: 2020 2020 2020 2023 5368 6172 6420 7468         #Shard th
-000635b0: 6520 696e 7465 726d 6564 6961 7465 2066  e intermediate f
-000635c0: 696c 6573 2073 6f20 7765 2063 616e 206c  iles so we can l
-000635d0: 6f61 6420 7468 656d 2069 6e20 7061 7261  oad them in para
-000635e0: 6c6c 656c 0d0a 2020 2020 2020 2020 6c6c  llel..        ll
-000635f0: 752e 7368 6172 645f 6669 6c65 735f 696e  u.shard_files_in
-00063600: 5f6c 6973 745f 6279 5f73 746f 7261 6765  _list_by_storage
-00063610: 5f64 696d 2866 696c 6573 5f74 6f5f 7368  _dim(files_to_sh
-00063620: 6172 643d 6669 6c65 735f 746f 5f73 6861  ard=files_to_sha
-00063630: 7264 0d0a 2020 2020 2020 2020 2020 2020  rd..            
-00063640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063660: 2020 2c73 746f 7261 6765 5f64 696d 656e    ,storage_dimen
-00063670: 7369 6f6e 5f69 6e64 6578 3d73 656c 662e  sion_index=self.
-00063680: 7369 7465 2e73 746f 7261 6765 5f64 696d  site.storage_dim
-00063690: 656e 7369 6f6e 5f69 6e64 6578 0d0a 2020  ension_index..  
-000636a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000636b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000636c0: 2020 2020 2020 2020 2020 2020 2c6e 756d              ,num
-000636d0: 6265 725f 6f66 5f73 746f 7261 6765 5f65  ber_of_storage_e
-000636e0: 6c65 6d65 6e74 735f 7065 725f 656d 706f  lements_per_empo
-000636f0: 7765 725f 6461 7461 5f66 696c 653d 7365  wer_data_file=se
-00063700: 6c66 2e73 6974 652e 656c 656d 656e 7473  lf.site.elements
-00063710: 5f70 6572 5f73 746f 7261 6765 5f64 696d  _per_storage_dim
-00063720: 656e 7369 6f6e 0d0a 2020 2020 2020 2020  ension..        
-00063730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063750: 2020 2020 2020 2c6c 6f61 645f 7072 6f63        ,load_proc
-00063760: 6573 7369 6e67 5f64 6972 3d73 656c 662e  essing_dir=self.
-00063770: 7369 7465 2e5f 6c6f 6164 5f70 726f 6365  site._load_proce
-00063780: 7373 696e 675f 6469 720d 0a20 2020 2020  ssing_dir..     
-00063790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000637a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000637b0: 2020 2020 2020 2020 202c 7368 6172 645f           ,shard_
-000637c0: 7072 6566 6978 3d27 5368 6172 645f 270d  prefix='Shard_'.
-000637d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000637e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000637f0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-00063800: 7365 7061 7261 746f 723d 275c 7427 0d0a  separator='\t'..
+00062cc0: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
+00062cd0: 6972 7328 6469 7229 0d0a 2020 2020 2020  irs(dir)..      
+00062ce0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00062cf0: 6365 7074 2046 696c 6545 7869 7374 7345  cept FileExistsE
+00062d00: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
+00062d10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00062d20: 6173 730d 0a20 2020 2020 2020 2020 2020  ass..           
+00062d30: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00062d40: 4f53 4572 726f 7220 6173 2065 3a0d 0a20  OSError as e:.. 
+00062d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062d60: 2020 2020 2020 2069 6620 652e 7769 6e65         if e.wine
+00062d70: 7272 6f72 203d 3d20 3132 333a 0d0a 2020  rror == 123:..  
+00062d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062d90: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00062da0: 5661 6c75 6545 7272 6f72 2827 4469 7265  ValueError('Dire
+00062db0: 6374 6f72 7920 227b 7d22 2068 6173 2061  ctory "{}" has a
+00062dc0: 6e20 696e 7661 6c69 6420 6e61 6d65 2e20  n invalid name. 
+00062dd0: 4469 6420 796f 7520 7061 7373 2061 2073  Did you pass a s
+00062de0: 6974 655f 6c6f 6361 746f 7220 7061 7468  ite_locator path
+00062df0: 2022 7b7d 2220 7769 7468 6f75 7420 646f   "{}" without do
+00062e00: 7562 6c65 2d65 7363 6170 696e 6720 6261  uble-escaping ba
+00062e10: 636b 736c 6173 6865 7320 6f72 2070 7265  ckslashes or pre
+00062e20: 6669 7869 6e67 2074 6865 2073 7472 696e  fixing the strin
+00062e30: 6720 7769 7468 2061 6e20 2272 2220 666f  g with an "r" fo
+00062e40: 7220 7261 773f 272e 666f 726d 6174 2864  r raw?'.format(d
+00062e50: 6972 2c72 6570 7228 7369 7465 5f6c 6f63  ir,repr(site_loc
+00062e60: 6174 6f72 2929 290d 0a20 2020 2020 2020  ator)))..       
+00062e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062e80: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+00062e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00062ea0: 2020 2020 7261 6973 6520 650d 0a20 2020      raise e..   
+00062eb0: 2020 2020 2020 2020 2020 2020 2023 4966               #If
+00062ec0: 2077 6520 6172 6520 6e6f 7420 646f 696e   we are not doin
+00062ed0: 6720 6120 6465 6c74 6120 7765 2064 6f6e  g a delta we don
+00062ee0: 2774 206e 6565 6420 746f 2073 6f72 7420  't need to sort 
+00062ef0: 7468 6520 6669 6c65 206f 7220 6372 6561  the file or crea
+00062f00: 7465 2061 6e20 6f76 6572 7269 6465 2066  te an override f
+00062f10: 696c 6520 2d20 7765 206a 7573 7420 6e65  ile - we just ne
+00062f20: 6564 2074 6f20 6d6f 7665 2069 7420 696e  ed to move it in
+00062f30: 746f 2070 6c61 6365 2d20 2074 6869 7320  to place-  this 
+00062f40: 7368 6f75 6c64 2062 6520 7175 6963 6b20  should be quick 
+00062f50: 6966 2069 7420 6973 2061 2073 696d 706c  if it is a simpl
+00062f60: 6520 7265 6e61 6d65 0d0a 2020 2020 2020  e rename..      
+00062f70: 2020 2020 2020 2020 2020 7368 7574 696c            shutil
+00062f80: 2e6d 6f76 6528 7461 7267 6574 5f66 696c  .move(target_fil
+00062f90: 655f 6e61 6d65 2c20 6f73 2e70 6174 682e  e_name, os.path.
+00062fa0: 6a6f 696e 2873 656c 662e 7369 7465 2e5f  join(self.site._
+00062fb0: 6275 6c6b 5f6c 6f61 645f 6465 6c74 615f  bulk_load_delta_
+00062fc0: 6469 722c 206f 732e 7061 7468 2e62 6173  dir, os.path.bas
+00062fd0: 656e 616d 6528 7461 7267 6574 5f66 696c  ename(target_fil
+00062fe0: 655f 6e61 6d65 2929 290d 0a0d 0a20 2020  e_name)))....   
+00062ff0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00063000: 662e 7375 626c 6f61 6473 2e61 7070 656e  f.subloads.appen
+00063010: 6428 2873 7562 6c6f 6164 5f6e 616d 652c  d((subload_name,
+00063020: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
+00063030: 2874 6172 6765 745f 6669 6c65 5f6e 616d  (target_file_nam
+00063040: 6529 2929 0d0a 0d0a 0d0a 2020 2020 2020  e)))......      
+00063050: 2020 234d 616b 6520 7468 6520 6c69 7374    #Make the list
+00063060: 2075 6e69 7175 6520 2d20 696e 2063 6173   unique - in cas
+00063070: 6520 7765 2061 7265 2072 756e 6e69 6e67  e we are running
+00063080: 2074 6869 7320 696e 204a 7570 7974 6572   this in Jupyter
+00063090: 206e 6f74 6562 6f6f 6b2c 2061 6e64 2074   notebook, and t
+000630a0: 6865 2073 616d 6520 6c6f 6164 6572 2069  he same loader i
+000630b0: 7320 6265 696e 6720 7275 6e20 6d75 6c74  s being run mult
+000630c0: 6970 6c65 2074 696d 6573 2028 652e 672e  iple times (e.g.
+000630d0: 2064 7572 696e 6720 6465 7665 6c6f 706d   during developm
+000630e0: 656e 7429 0d0a 2020 2020 2020 2020 7365  ent)..        se
+000630f0: 6c66 2e73 7562 6c6f 6164 733d 6c69 7374  lf.subloads=list
+00063100: 2873 6574 2820 7365 6c66 2e73 7562 6c6f  (set( self.sublo
+00063110: 6164 7329 290d 0a0d 0a20 2020 2020 2020  ads))....       
+00063120: 2023 6966 206e 6f74 2073 656c 662e 7368   #if not self.sh
+00063130: 6172 6469 6e67 5f71 7565 7565 2069 7320  arding_queue is 
+00063140: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2023  None:..        #
+00063150: 2020 2020 6465 6c74 615f 6669 6c65 5f6e      delta_file_n
+00063160: 616d 6520 3d20 6f73 2e70 6174 682e 6a6f  ame = os.path.jo
+00063170: 696e 2873 656c 662e 7369 7465 2e5f 6275  in(self.site._bu
+00063180: 6c6b 5f6c 6f61 645f 6465 6c74 615f 6469  lk_load_delta_di
+00063190: 722c 6f73 2e70 6174 682e 6261 7365 6e61  r,os.path.basena
+000631a0: 6d65 2874 6172 6765 745f 6669 6c65 5f6e  me(target_file_n
+000631b0: 616d 6529 290d 0a20 2020 2020 2020 2023  ame))..        #
+000631c0: 0d0a 2020 2020 2020 2020 2320 2020 2074  ..        #    t
+000631d0: 7279 3a0d 0a20 2020 2020 2020 2023 2020  ry:..        #  
+000631e0: 2020 2020 2020 2370 7574 2074 6865 206d        #put the m
+000631f0: 6573 7361 6765 206f 6e20 7468 6520 7175  essage on the qu
+00063200: 6575 650d 0a20 2020 2020 2020 2023 2020  eue..        #  
+00063210: 2020 2020 2020 7365 6c66 2e73 6861 7264        self.shard
+00063220: 696e 675f 7175 6575 652e 7075 7428 6465  ing_queue.put(de
+00063230: 6c74 615f 6669 6c65 5f6e 616d 6529 0d0a  lta_file_name)..
+00063240: 2020 2020 2020 2020 2320 2020 2020 2020          #       
+00063250: 206c 6f67 2e76 6572 626f 7365 2827 5175   log.verbose('Qu
+00063260: 6575 696e 6720 6669 6c65 2066 6f72 2073  euing file for s
+00063270: 6861 7264 696e 673a 272b 6465 6c74 615f  harding:'+delta_
+00063280: 6669 6c65 5f6e 616d 6529 0d0a 2020 2020  file_name)..    
+00063290: 2020 2020 230d 0a20 2020 2020 2020 2023      #..        #
+000632a0: 0d0a 2020 2020 2020 2020 2320 2020 2065  ..        #    e
+000632b0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
+000632c0: 0d0a 2020 2020 2020 2020 2320 2020 2020  ..        #     
+000632d0: 2020 206c 6f67 2e65 7272 6f72 2827 4661     log.error('Fa
+000632e0: 696c 696e 6720 7368 6172 6469 6e67 2071  iling sharding q
+000632f0: 7565 7565 2e2e 2e27 290d 0a20 2020 2020  ueue...')..     
+00063300: 2020 2023 2020 2020 2020 2020 7365 6c66     #        self
+00063310: 2e73 6861 7264 696e 675f 7175 6575 652e  .sharding_queue.
+00063320: 6661 696c 2829 0d0a 2020 2020 2020 2020  fail()..        
+00063330: 2320 2020 2020 2020 206c 6f67 2e65 7272  #        log.err
+00063340: 6f72 2827 4661 696c 6564 2020 7368 6172  or('Failed  shar
+00063350: 6469 6e67 2071 7565 7565 2729 0d0a 2020  ding queue')..  
+00063360: 2020 2020 2020 2320 2020 2020 2020 2072        #        r
+00063370: 6169 7365 0d0a 0d0a 0d0a 2020 2020 6465  aise......    de
+00063380: 6620 7368 6172 6428 7365 6c66 2c66 696c  f shard(self,fil
+00063390: 6573 5f74 6f5f 7368 6172 643d 4e6f 6e65  es_to_shard=None
+000633a0: 293a 0d0a 2020 2020 2020 2020 2727 2753  ):..        '''S
+000633b0: 6861 7264 2061 6c6c 206f 6620 7468 6520  hard all of the 
+000633c0: 6465 6c74 6120 6669 6c65 7320 666f 7220  delta files for 
+000633d0: 616c 6c20 6f66 2074 6865 2073 7562 6c6f  all of the sublo
+000633e0: 6164 7320 746f 2063 7265 6174 6520 6669  ads to create fi
+000633f0: 6c65 7320 7265 6164 7920 746f 2062 6520  les ready to be 
+00063400: 6c6f 6164 6564 2727 270d 0a0d 0a20 2020  loaded'''....   
+00063410: 2020 2020 2069 6620 6669 6c65 735f 746f       if files_to
+00063420: 5f73 6861 7264 2069 7320 4e6f 6e65 2061  _shard is None a
+00063430: 6e64 2073 656c 662e 7368 6172 6469 6e67  nd self.sharding
+00063440: 5f71 7565 7565 2069 7320 4e6f 6e65 3a0d  _queue is None:.
+00063450: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00063460: 6573 5f74 6f5f 7368 6172 643d 5b5d 0d0a  es_to_shard=[]..
+00063470: 2020 2020 2020 2020 2020 2020 2347 6f20              #Go 
+00063480: 7468 726f 7567 6820 616c 6c20 6f66 2074  through all of t
+00063490: 6865 2066 696c 6573 2074 6f20 7368 6172  he files to shar
+000634a0: 6420 6672 6f6d 2073 7562 6c6f 6164 7320  d from subloads 
+000634b0: 616e 6420 7368 6172 6420 7468 656d 2074  and shard them t
+000634c0: 6f67 6574 6865 720d 0a20 2020 2020 2020  ogether..       
+000634d0: 2020 2020 2066 6f72 2073 7562 6c6f 6164       for subload
+000634e0: 5f6e 616d 652c 7461 7267 6574 5f66 696c  _name,target_fil
+000634f0: 655f 6e61 6d65 5f73 6f72 7465 6420 696e  e_name_sorted in
+00063500: 2073 656c 662e 7375 626c 6f61 6473 3a0d   self.subloads:.
+00063510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00063520: 2064 656c 7461 5f66 696c 655f 6e61 6d65   delta_file_name
+00063530: 203d 206f 732e 7061 7468 2e6a 6f69 6e28   = os.path.join(
+00063540: 7365 6c66 2e73 6974 652e 5f62 756c 6b5f  self.site._bulk_
+00063550: 6c6f 6164 5f64 656c 7461 5f64 6972 2c6f  load_delta_dir,o
+00063560: 732e 7061 7468 2e62 6173 656e 616d 6528  s.path.basename(
+00063570: 7461 7267 6574 5f66 696c 655f 6e61 6d65  target_file_name
+00063580: 5f73 6f72 7465 6429 290d 0a0d 0a20 2020  _sorted))....   
+00063590: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+000635a0: 6573 5f74 6f5f 7368 6172 642e 6170 7065  es_to_shard.appe
+000635b0: 6e64 2864 656c 7461 5f66 696c 655f 6e61  nd(delta_file_na
+000635c0: 6d65 290d 0a0d 0a0d 0a0d 0a20 2020 2020  me)........     
+000635d0: 2020 2023 5368 6172 6420 7468 6520 696e     #Shard the in
+000635e0: 7465 726d 6564 6961 7465 2066 696c 6573  termediate files
+000635f0: 2073 6f20 7765 2063 616e 206c 6f61 6420   so we can load 
+00063600: 7468 656d 2069 6e20 7061 7261 6c6c 656c  them in parallel
+00063610: 0d0a 2020 2020 2020 2020 6c6c 752e 7368  ..        llu.sh
+00063620: 6172 645f 6669 6c65 735f 696e 5f6c 6973  ard_files_in_lis
+00063630: 745f 6279 5f73 746f 7261 6765 5f64 696d  t_by_storage_dim
+00063640: 2866 696c 6573 5f74 6f5f 7368 6172 643d  (files_to_shard=
+00063650: 6669 6c65 735f 746f 5f73 6861 7264 0d0a  files_to_shard..
+00063660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063680: 2020 2020 2020 2020 2020 2020 2020 2c73                ,s
+00063690: 746f 7261 6765 5f64 696d 656e 7369 6f6e  torage_dimension
+000636a0: 5f69 6e64 6578 3d73 656c 662e 7369 7465  _index=self.site
+000636b0: 2e73 746f 7261 6765 5f64 696d 656e 7369  .storage_dimensi
+000636c0: 6f6e 5f69 6e64 6578 0d0a 2020 2020 2020  on_index..      
+000636d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000636e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000636f0: 2020 2020 2020 2020 2c6e 756d 6265 725f          ,number_
+00063700: 6f66 5f73 746f 7261 6765 5f65 6c65 6d65  of_storage_eleme
+00063710: 6e74 735f 7065 725f 656d 706f 7765 725f  nts_per_empower_
+00063720: 6461 7461 5f66 696c 653d 7365 6c66 2e73  data_file=self.s
+00063730: 6974 652e 656c 656d 656e 7473 5f70 6572  ite.elements_per
+00063740: 5f73 746f 7261 6765 5f64 696d 656e 7369  _storage_dimensi
+00063750: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+00063760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063780: 2020 2c6c 6f61 645f 7072 6f63 6573 7369    ,load_processi
+00063790: 6e67 5f64 6972 3d73 656c 662e 7369 7465  ng_dir=self.site
+000637a0: 2e5f 6c6f 6164 5f70 726f 6365 7373 696e  ._load_processin
+000637b0: 675f 6469 720d 0a20 2020 2020 2020 2020  g_dir..         
+000637c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000637d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000637e0: 2020 2020 202c 7368 6172 645f 7072 6566       ,shard_pref
+000637f0: 6978 3d27 5368 6172 645f 270d 0a20 2020  ix='Shard_'..   
+00063800: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00063810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063830: 2020 2020 2020 2020 2020 2020 2020 2c6c                ,l
-00063840: 6f67 6769 6e67 5f71 7565 7565 203d 2073  ogging_queue = s
-00063850: 656c 662e 7369 7465 2e6c 6f67 6769 6e67  elf.site.logging
-00063860: 5f71 7565 7565 0d0a 2020 2020 2020 2020  _queue..        
-00063870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063890: 2020 2020 2020 290d 0a0d 0a20 2020 2064        )....    d
-000638a0: 6566 206c 6f61 645f 7368 6172 6473 2873  ef load_shards(s
-000638b0: 656c 662c 7375 626c 6f61 6473 3d4e 6f6e  elf,subloads=Non
-000638c0: 6529 3a0d 0a20 2020 2020 2020 2027 2727  e):..        '''
-000638d0: 0d0a 2020 2020 2020 2020 2727 270d 0a0d  ..        '''...
-000638e0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-000638f0: 7365 6c66 2e73 6861 7264 696e 675f 7175  self.sharding_qu
-00063900: 6575 6520 6973 204e 6f6e 653a 0d0a 2020  eue is None:..  
-00063910: 2020 2020 2020 2020 2020 6c6f 672e 7665            log.ve
-00063920: 7262 6f73 6528 2744 6973 706f 7369 6e67  rbose('Disposing
-00063930: 2073 6861 7264 696e 6720 7175 6575 652e   sharding queue.
-00063940: 2e2e 2729 0d0a 2020 2020 2020 2020 2020  ..')..          
-00063950: 2020 7365 6c66 2e73 6861 7264 696e 675f    self.sharding_
-00063960: 7175 6575 652e 6469 7370 6f73 6528 290d  queue.dispose().
-00063970: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00063980: 2e76 6572 626f 7365 2827 5368 6172 6469  .verbose('Shardi
-00063990: 6e67 2071 7565 7565 2064 6973 706f 7365  ng queue dispose
-000639a0: 6427 290d 0a0d 0a20 2020 2020 2020 2020  d')....         
-000639b0: 2020 206c 6f67 2e76 6572 626f 7365 2827     log.verbose('
-000639c0: 4a6f 696e 696e 6720 7368 6172 6465 7227  Joining sharder'
-000639d0: 290d 0a20 2020 2020 2020 2020 2020 2073  )..            s
-000639e0: 656c 662e 7368 6172 6465 722e 6a6f 696e  elf.sharder.join
-000639f0: 2829 0d0a 0d0a 2020 2020 2020 2020 2020  ()....          
-00063a00: 2020 6966 2073 656c 662e 7368 6172 6465    if self.sharde
-00063a10: 722e 6578 6974 636f 6465 2021 3d20 303a  r.exitcode != 0:
-00063a20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00063a30: 2020 6c6f 672e 6572 726f 7228 277b 7d2e    log.error('{}.
-00063a40: 6578 6974 636f 6465 203d 207b 7d27 2e66  exitcode = {}'.f
-00063a50: 6f72 6d61 7428 7365 6c66 2e73 6861 7264  ormat(self.shard
-00063a60: 6572 2e73 656c 662e 7368 6172 6465 722c  er.self.sharder,
-00063a70: 2073 656c 662e 7368 6172 6465 722e 6578   self.sharder.ex
-00063a80: 6974 636f 6465 2929 0d0a 2020 2020 2020  itcode))..      
-00063a90: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00063aa0: 6d70 6578 2e43 6f6d 706c 6574 656c 794c  mpex.CompletelyL
-00063ab0: 6f67 6765 6445 7272 6f72 2827 5368 6172  oggedError('Shar
-00063ac0: 6465 7220 4a6f 623a 272b 7365 6c66 2e73  der Job:'+self.s
-00063ad0: 6861 7264 6572 2e6e 616d 652b 2720 6661  harder.name+' fa
-00063ae0: 696c 6564 2077 6974 6820 6578 6974 2063  iled with exit c
-00063af0: 6f64 6520 272b 7374 7228 7365 6c66 2e73  ode '+str(self.s
-00063b00: 6861 7264 6572 2e65 7869 7463 6f64 6529  harder.exitcode)
-00063b10: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00063b20: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00063b30: 2020 2020 2020 6c6f 672e 7665 7262 6f73        log.verbos
-00063b40: 6528 277b 7d2e 6578 6974 636f 6465 203d  e('{}.exitcode =
-00063b50: 207b 7d27 2e66 6f72 6d61 7428 7365 6c66   {}'.format(self
-00063b60: 2e73 6861 7264 6572 2e6e 616d 652c 2073  .sharder.name, s
-00063b70: 656c 662e 7368 6172 6465 722e 6578 6974  elf.sharder.exit
-00063b80: 636f 6465 2929 0d0a 0d0a 2020 2020 2020  code))....      
-00063b90: 2020 6966 2073 656c 662e 7369 7465 2e73    if self.site.s
-00063ba0: 746f 7261 6765 5f74 7970 653d 3d22 7371  torage_type=="sq
-00063bb0: 6c22 3a0d 0a0d 0a20 2020 2020 2020 2020  l":....         
-00063bc0: 2020 206c 6c75 2e6c 6f61 645f 7371 6c5f     llu.load_sql_
-00063bd0: 656d 706f 7765 725f 6672 6f6d 5f73 6861  empower_from_sha
-00063be0: 7264 7328 2065 6d70 6f77 6572 5f73 6974  rds( empower_sit
-00063bf0: 653d 7365 6c66 2e73 6974 652e 5f73 6974  e=self.site._sit
-00063c00: 655f 6c6f 6361 746f 720d 0a20 2020 2020  e_locator..     
-00063c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063c30: 2020 2020 2020 2020 2c65 6e63 7279 7074          ,encrypt
-00063c40: 6564 5f65 6d70 6f77 6572 5f75 7365 723d  ed_empower_user=
-00063c50: 7365 6c66 2e73 6974 652e 5f65 6e63 7279  self.site._encry
-00063c60: 7074 6564 5f75 7365 720d 0a20 2020 2020  pted_user..     
-00063c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063c90: 2020 2020 2020 2020 2c65 6e63 7279 7074          ,encrypt
-00063ca0: 6564 5f65 6d70 6f77 6572 5f70 7764 3d73  ed_empower_pwd=s
-00063cb0: 656c 662e 7369 7465 2e5f 656e 6372 7970  elf.site._encryp
-00063cc0: 7465 645f 7077 640d 0a20 2020 2020 2020  ted_pwd..       
-00063cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063cf0: 2020 2020 2020 2c73 6861 7264 5f66 696c        ,shard_fil
-00063d00: 655f 7072 6566 6978 3d27 5368 6172 645f  e_prefix='Shard_
-00063d10: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
-00063d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063d40: 2c6e 756d 6265 725f 6f66 5f77 6f72 6b65  ,number_of_worke
-00063d50: 7273 3d6d 756c 7469 7072 6f63 6573 7369  rs=multiprocessi
-00063d60: 6e67 2e63 7075 5f63 6f75 6e74 2829 2d31  ng.cpu_count()-1
-00063d70: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00063d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063d90: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-00063da0: 6c6f 6164 5f70 726f 6365 7373 696e 675f  load_processing_
-00063db0: 6469 723d 7365 6c66 2e73 6974 652e 5f6c  dir=self.site._l
-00063dc0: 6f61 645f 7072 6f63 6573 7369 6e67 5f64  oad_processing_d
-00063dd0: 6972 0d0a 2020 2020 2020 2020 2020 2020  ir..            
-00063de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063e00: 202c 6c6f 6767 696e 675f 7175 6575 653d   ,logging_queue=
-00063e10: 7365 6c66 2e73 6974 652e 6c6f 6767 696e  self.site.loggin
-00063e20: 675f 7175 6575 650d 0a20 2020 2020 2020  g_queue..       
-00063e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063e50: 2020 2020 2020 2c5f 7369 6e67 6c65 5f62        ,_single_b
-00063e60: 756c 6b5f 6c6f 6164 5f66 756e 6374 696f  ulk_load_functio
-00063e70: 6e20 3d20 7365 6c66 2e5f 7369 6e67 6c65  n = self._single
-00063e80: 5f62 756c 6b5f 6c6f 6164 5f66 756e 6374  _bulk_load_funct
-00063e90: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
-00063ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00063ec0: 2020 290d 0a20 2020 2020 2020 2065 6c73    )..        els
-00063ed0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00063ee0: 6c6f 672e 7665 7262 6f73 6528 2743 616c  log.verbose('Cal
-00063ef0: 6c69 6e67 206c 6f77 206c 6576 656c 2075  ling low level u
-00063f00: 7469 6c69 7479 206c 6f61 645f 656d 706f  tility load_empo
-00063f10: 7765 725f 6672 6f6d 5f73 6861 7264 732e  wer_from_shards.
-00063f20: 2e2e 2729 0d0a 0d0a 2020 2020 2020 2020  ..')....        
-00063f30: 2020 2020 6966 2073 656c 662e 7369 7465      if self.site
-00063f40: 2e70 7265 6669 7820 6973 204e 6f6e 653a  .prefix is None:
-00063f50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00063f60: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00063f70: 6f72 2827 4361 6e6e 6f74 2062 6567 696e  or('Cannot begin
-00063f80: 2062 756c 6b20 6c6f 6164 696e 6720 756e   bulk loading un
-00063f90: 7469 6c20 7468 6520 7369 7465 2e70 7265  til the site.pre
-00063fa0: 6669 7820 6861 7320 6265 656e 2073 6574  fix has been set
-00063fb0: 2e20 5365 7420 7369 7465 2e70 7265 6669  . Set site.prefi
-00063fc0: 7820 746f 2074 6865 2066 696c 656e 616d  x to the filenam
-00063fd0: 6520 7072 6566 6978 206f 6620 7468 6520  e prefix of the 
-00063fe0: 6461 7461 2066 696c 6573 2028 7468 6520  data files (the 
-00063ff0: 6269 7420 6265 666f 7265 2074 6865 206c  bit before the l
-00064000: 6173 7420 3320 6c65 7474 6572 7320 6265  ast 3 letters be
-00064010: 666f 7265 2e30 3030 292e 2054 6865 6e20  fore.000). Then 
-00064020: 6361 6c6c 206c 6f61 6465 722e 6c6f 6164  call loader.load
-00064030: 2829 2061 6761 696e 2729 0d0a 0d0a 2020  () again')....  
-00064040: 2020 2020 2020 2020 2020 2353 686f 756c            #Shoul
-00064050: 6420 7765 2063 7265 6174 6520 6120 5375  d we create a Su
-00064060: 624c 6f61 6420 6f62 6a65 6374 2c20 746f  bLoad object, to
-00064070: 2068 6f6c 6420 7468 6520 7375 626c 6f61   hold the subloa
-00064080: 6420 616e 6420 7065 7269 6f64 2074 6f67  d and period tog
-00064090: 6574 6865 722c 206a 7573 7420 696e 2063  ether, just in c
-000640a0: 6173 653f 0d0a 2020 2020 2020 2020 2020  ase?..          
-000640b0: 2020 6c6c 752e 6c6f 6164 5f65 6d70 6f77    llu.load_empow
-000640c0: 6572 5f66 726f 6d5f 7368 6172 6473 2865  er_from_shards(e
-000640d0: 6d70 6f77 6572 5f73 6974 6520 3d20 7365  mpower_site = se
-000640e0: 6c66 2e73 6974 652e 5f73 6974 655f 6c6f  lf.site._site_lo
-000640f0: 6361 746f 720d 0a20 2020 2020 2020 2020  cator..         
-00064100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064110: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-00064120: 656d 706f 7765 725f 7573 6572 203d 2073  empower_user = s
-00064130: 656c 662e 7369 7465 2e5f 7573 6572 0d0a  elf.site._user..
-00064140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064160: 2020 2020 2020 2020 2c65 6d70 6f77 6572          ,empower
-00064170: 5f70 7764 2020 3d20 7365 6c66 2e73 6974  _pwd  = self.sit
-00064180: 652e 5f70 7764 0d0a 2020 2020 2020 2020  e._pwd..        
-00064190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000641a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000641b0: 2c6c 6f61 645f 6d65 7468 6f64 3d27 6275  ,load_method='bu
-000641c0: 6c6b 270d 0a20 2020 2020 2020 2020 2020  lk'..           
-000641d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000641e0: 2020 2020 2020 2020 2020 2020 202c 7368               ,sh
-000641f0: 6172 645f 6669 6c65 5f70 7265 6669 783d  ard_file_prefix=
-00064200: 2753 6861 7264 5f27 0d0a 2020 2020 2020  'Shard_'..      
-00064210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064230: 2020 2c65 6d70 6f77 6572 5f64 6174 615f    ,empower_data_
-00064240: 6669 6c65 5f70 7265 6669 783d 7365 6c66  file_prefix=self
-00064250: 2e73 6974 652e 7072 6566 6978 0d0a 2020  .site.prefix..  
-00064260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064280: 2020 2020 2020 2c6d 6169 6e5f 7369 7465        ,main_site
-00064290: 5f6f 7574 7075 745f 6461 7461 5f66 696c  _output_data_fil
-000642a0: 6573 5f64 6972 3d73 656c 662e 7369 7465  es_dir=self.site
-000642b0: 2e5f 6f75 7470 7574 5f64 6174 615f 6669  ._output_data_fi
-000642c0: 6c65 735f 6469 720d 0a20 2020 2020 2020  les_dir..       
-000642d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000642e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000642f0: 202c 6c6f 6164 5f70 726f 6365 7373 696e   ,load_processin
-00064300: 675f 6469 723d 7365 6c66 2e73 6974 652e  g_dir=self.site.
-00064310: 5f6c 6f61 645f 7072 6f63 6573 7369 6e67  _load_processing
-00064320: 5f64 6972 0d0a 2020 2020 2020 2020 2020  _dir..          
-00064330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064340: 2020 2020 2020 2020 2020 2020 2020 2c6c                ,l
-00064350: 6f67 6769 6e67 5f71 7565 7565 203d 2073  ogging_queue = s
-00064360: 656c 662e 7369 7465 2e6c 6f67 6769 6e67  elf.site.logging
-00064370: 5f71 7565 7565 0d0a 2020 2020 2020 2020  _queue..        
-00064380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000643a0: 2c73 6166 655f 6c6f 6164 3d73 656c 662e  ,safe_load=self.
-000643b0: 7361 6665 5f6c 6f61 640d 0a20 2020 2020  safe_load..     
-000643c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000643d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000643e0: 2020 202c 656e 6372 7970 7465 645f 656d     ,encrypted_em
-000643f0: 706f 7765 725f 7573 6572 3d73 656c 662e  power_user=self.
-00064400: 7369 7465 2e5f 656e 6372 7970 7465 645f  site._encrypted_
-00064410: 7573 6572 0d0a 2020 2020 2020 2020 2020  user..          
-00064420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064430: 2020 2020 2020 2020 2020 2020 2020 2c65                ,e
-00064440: 6e63 7279 7074 6564 5f65 6d70 6f77 6572  ncrypted_empower
-00064450: 5f70 7764 3d73 656c 662e 7369 7465 2e5f  _pwd=self.site._
-00064460: 656e 6372 7970 7465 645f 7077 640d 0a20  encrypted_pwd.. 
-00064470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00064490: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
-000644a0: 6465 6620 5f72 6570 6c61 6365 5f62 6164  def _replace_bad
-000644b0: 5f63 6861 7273 2873 7472 696e 6729 3a0d  _chars(string):.
-000644c0: 0a20 2020 2020 2020 2066 6f72 2063 6861  .        for cha
-000644d0: 7220 696e 2072 273c 3e3a 222f 5c7c 3f2a  r in r'<>:"/\|?*
-000644e0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-000644f0: 7374 7269 6e67 3d73 7472 696e 672e 7265  string=string.re
-00064500: 706c 6163 6528 6368 6172 2c27 2327 290d  place(char,'#').
-00064510: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00064520: 7374 7269 6e67 0d0a 0d0a 2020 2020 6465  string....    de
-00064530: 6620 5f67 6574 5f62 756c 6b6c 6f61 645f  f _get_bulkload_
-00064540: 6669 6c65 5f74 696d 655f 7072 6566 6978  file_time_prefix
-00064550: 2874 696d 652c 656d 706f 7765 725f 7065  (time,empower_pe
-00064560: 7269 6f64 5f74 7970 6529 3a0d 0a20 2020  riod_type):..   
-00064570: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00064580: 2020 2020 2020 2074 696d 655f 7072 6566         time_pref
-00064590: 6978 3d64 6174 6574 696d 652e 6461 7465  ix=datetime.date
-000645a0: 7469 6d65 2e73 7472 6674 696d 6528 7469  time.strftime(ti
-000645b0: 6d65 2c27 2559 5f25 6d5f 2564 5f27 292b  me,'%Y_%m_%d_')+
-000645c0: 7374 7228 656d 706f 7765 725f 7065 7269  str(empower_peri
-000645d0: 6f64 5f74 7970 6529 0d0a 2020 2020 2020  od_type)..      
-000645e0: 2020 6578 6365 7074 2054 7970 6545 7272    except TypeErr
-000645f0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-00064600: 2023 5765 2067 6f74 2070 6173 7365 6420   #We got passed 
-00064610: 696e 2061 2043 6f6c 756d 6e20 4e61 6d65  in a Column Name
-00064620: 2028 7769 7468 204d 756c 7469 706c 6520   (with Multiple 
-00064630: 7469 6d65 7329 0d0a 2020 2020 2020 2020  times)..        
-00064640: 2020 2020 7469 6d65 5f70 7265 6669 7820      time_prefix 
-00064650: 3d20 7469 6d65 2e72 6570 6c61 6365 2827  = time.replace('
-00064660: 2027 2c27 5f27 292b 275f 272b 7374 7228   ','_')+'_'+str(
-00064670: 656d 706f 7765 725f 7065 7269 6f64 5f74  empower_period_t
-00064680: 7970 6529 0d0a 0d0a 2020 2020 2020 2020  ype)....        
-00064690: 7265 7475 726e 2074 696d 655f 7072 6566  return time_pref
-000646a0: 6978 0d0a 0d0a 2020 2020 6465 6620 5f67  ix....    def _g
-000646b0: 6574 5f62 756c 6b6c 6f61 645f 6669 6c65  et_bulkload_file
-000646c0: 5f70 7265 6669 7828 6c6f 6164 6572 5f6e  _prefix(loader_n
-000646d0: 616d 652c 2073 7562 6c6f 6164 5f6e 616d  ame, subload_nam
-000646e0: 652c 2073 6974 655f 7072 6566 6978 2c20  e, site_prefix, 
-000646f0: 7469 6d65 2c65 6d70 6f77 6572 5f70 6572  time,empower_per
-00064700: 696f 645f 7479 7065 293a 0d0a 2020 2020  iod_type):..    
-00064710: 2020 2020 7469 6d65 5f70 7265 6669 7820      time_prefix 
-00064720: 2020 2020 2020 2020 2020 2020 3d20 4c6f              = Lo
-00064730: 6164 6572 2e5f 6765 745f 6275 6c6b 6c6f  ader._get_bulklo
-00064740: 6164 5f66 696c 655f 7469 6d65 5f70 7265  ad_file_time_pre
-00064750: 6669 7828 7469 6d65 2c65 6d70 6f77 6572  fix(time,empower
-00064760: 5f70 6572 696f 645f 7479 7065 290d 0a20  _period_type).. 
-00064770: 2020 2020 2020 2066 696c 655f 7072 6566         file_pref
-00064780: 6978 2020 2020 2020 2020 2020 2020 203d  ix             =
-00064790: 204c 6f61 6465 722e 5f72 6570 6c61 6365   Loader._replace
-000647a0: 5f62 6164 5f63 6861 7273 2873 6974 655f  _bad_chars(site_
-000647b0: 7072 6566 6978 2920 2b20 275f 2720 2b20  prefix) + '_' + 
-000647c0: 4c6f 6164 6572 2e5f 7265 706c 6163 655f  Loader._replace_
-000647d0: 6261 645f 6368 6172 7328 6c6f 6164 6572  bad_chars(loader
-000647e0: 5f6e 616d 6529 202b 2027 5f27 202b 204c  _name) + '_' + L
-000647f0: 6f61 6465 722e 5f72 6570 6c61 6365 5f62  oader._replace_b
-00064800: 6164 5f63 6861 7273 2873 7562 6c6f 6164  ad_chars(subload
-00064810: 5f6e 616d 6529 2b27 5f27 2b74 696d 655f  _name)+'_'+time_
-00064820: 7072 6566 6978 0d0a 2020 2020 2020 2020  prefix..        
-00064830: 7265 7475 726e 2066 696c 655f 7072 6566  return file_pref
-00064840: 6978 0d0a 0d0a 2020 2020 6465 6620 5f67  ix....    def _g
-00064850: 6574 5f69 6e74 6572 6d65 6469 6174 655f  et_intermediate_
-00064860: 6669 6c65 5f6e 616d 6528 6c6f 6164 6572  file_name(loader
-00064870: 5f6e 616d 652c 2073 7562 6c6f 6164 5f6e  _name, subload_n
-00064880: 616d 652c 2073 6974 655f 7072 6566 6978  ame, site_prefix
-00064890: 2c20 7469 6d65 2c65 6d70 6f77 6572 5f70  , time,empower_p
-000648a0: 6572 696f 645f 7479 7065 293a 0d0a 2020  eriod_type):..  
-000648b0: 2020 2020 2020 7265 7475 726e 204c 6f61        return Loa
-000648c0: 6465 722e 5f67 6574 5f62 756c 6b6c 6f61  der._get_bulkloa
-000648d0: 645f 6669 6c65 5f70 7265 6669 7828 6c6f  d_file_prefix(lo
-000648e0: 6164 6572 5f6e 616d 652c 2073 7562 6c6f  ader_name, sublo
-000648f0: 6164 5f6e 616d 652c 2073 6974 655f 7072  ad_name, site_pr
-00064900: 6566 6978 2c20 7469 6d65 2c65 6d70 6f77  efix, time,empow
-00064910: 6572 5f70 6572 696f 645f 7479 7065 2920  er_period_type) 
-00064920: 2b20 275f 696e 7465 726d 6564 6961 7465  + '_intermediate
-00064930: 2e74 7376 270d 0a0d 0a20 2020 2064 6566  .tsv'....    def
-00064940: 205f 6765 745f 7461 7267 6574 5f66 696c   _get_target_fil
-00064950: 655f 6e61 6d65 286c 6f61 6465 725f 6e61  e_name(loader_na
-00064960: 6d65 2c20 7375 626c 6f61 645f 6e61 6d65  me, subload_name
-00064970: 2c20 7369 7465 5f70 7265 6669 782c 2074  , site_prefix, t
-00064980: 696d 652c 656d 706f 7765 725f 7065 7269  ime,empower_peri
-00064990: 6f64 5f74 7970 6529 3a0d 0a20 2020 2020  od_type):..     
-000649a0: 2020 2072 6574 7572 6e20 4c6f 6164 6572     return Loader
-000649b0: 2e5f 6765 745f 6275 6c6b 6c6f 6164 5f66  ._get_bulkload_f
-000649c0: 696c 655f 7072 6566 6978 286c 6f61 6465  ile_prefix(loade
-000649d0: 725f 6e61 6d65 2c20 7375 626c 6f61 645f  r_name, subload_
-000649e0: 6e61 6d65 2c20 7369 7465 5f70 7265 6669  name, site_prefi
-000649f0: 782c 2074 696d 652c 656d 706f 7765 725f  x, time,empower_
-00064a00: 7065 7269 6f64 5f74 7970 6529 202b 2027  period_type) + '
-00064a10: 5f65 7870 6c6f 6465 642e 7473 7627 0d0a  _exploded.tsv'..
-00064a20: 0d0a 2020 2020 6465 6620 5f67 6574 5f64  ..    def _get_d
-00064a30: 656c 7461 5f66 696c 655f 6e61 6d65 286c  elta_file_name(l
-00064a40: 6f61 6465 725f 6e61 6d65 2c20 7375 626c  oader_name, subl
-00064a50: 6f61 645f 6e61 6d65 2c20 7369 7465 5f70  oad_name, site_p
-00064a60: 7265 6669 782c 2074 696d 652c 656d 706f  refix, time,empo
-00064a70: 7765 725f 7065 7269 6f64 5f74 7970 6529  wer_period_type)
-00064a80: 3a0d 0a20 2020 2020 2020 2072 6574 7572  :..        retur
-00064a90: 6e20 4c6f 6164 6572 2e5f 6765 745f 6275  n Loader._get_bu
-00064aa0: 6c6b 6c6f 6164 5f66 696c 655f 7072 6566  lkload_file_pref
-00064ab0: 6978 286c 6f61 6465 725f 6e61 6d65 2c20  ix(loader_name, 
-00064ac0: 7375 626c 6f61 645f 6e61 6d65 2c20 7369  subload_name, si
-00064ad0: 7465 5f70 7265 6669 782c 2074 696d 652c  te_prefix, time,
-00064ae0: 656d 706f 7765 725f 7065 7269 6f64 5f74  empower_period_t
-00064af0: 7970 6529 202b 2027 5f64 656c 7461 2e74  ype) + '_delta.t
-00064b00: 7376 270d 0a0d 0a20 2020 2064 6566 205f  sv'....    def _
-00064b10: 6765 745f 6465 6c74 615f 7265 7665 7273  get_delta_revers
-00064b20: 696f 6e5f 6669 6c65 5f6e 616d 6528 6c6f  ion_file_name(lo
-00064b30: 6164 6572 5f6e 616d 652c 2073 7562 6c6f  ader_name, sublo
-00064b40: 6164 5f6e 616d 652c 2073 6974 655f 7072  ad_name, site_pr
-00064b50: 6566 6978 2c20 7469 6d65 2c65 6d70 6f77  efix, time,empow
-00064b60: 6572 5f70 6572 696f 645f 7479 7065 293a  er_period_type):
-00064b70: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00064b80: 204c 6f61 6465 722e 5f67 6574 5f62 756c   Loader._get_bul
-00064b90: 6b6c 6f61 645f 6669 6c65 5f70 7265 6669  kload_file_prefi
-00064ba0: 7828 6c6f 6164 6572 5f6e 616d 652c 2073  x(loader_name, s
-00064bb0: 7562 6c6f 6164 5f6e 616d 652c 2073 6974  ubload_name, sit
-00064bc0: 655f 7072 6566 6978 2c20 7469 6d65 2c65  e_prefix, time,e
-00064bd0: 6d70 6f77 6572 5f70 6572 696f 645f 7479  mpower_period_ty
-00064be0: 7065 2920 2b20 275f 6465 6c74 615f 7265  pe) + '_delta_re
-00064bf0: 7665 7273 696f 6e2e 7473 7627 0d0a 0d0a  version.tsv'....
-00064c00: 2020 2020 6465 6620 5f67 6574 5f73 6f72      def _get_sor
-00064c10: 7465 645f 6669 6c65 5f6e 616d 6528 6c6f  ted_file_name(lo
-00064c20: 6164 6572 5f6e 616d 652c 2073 7562 6c6f  ader_name, sublo
-00064c30: 6164 5f6e 616d 652c 2073 6974 655f 7072  ad_name, site_pr
-00064c40: 6566 6978 2c20 7469 6d65 2c65 6d70 6f77  efix, time,empow
-00064c50: 6572 5f70 6572 696f 645f 7479 7065 293a  er_period_type):
-00064c60: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00064c70: 204c 6f61 6465 722e 5f67 6574 5f62 756c   Loader._get_bul
-00064c80: 6b6c 6f61 645f 6669 6c65 5f70 7265 6669  kload_file_prefi
-00064c90: 7828 6c6f 6164 6572 5f6e 616d 652c 2073  x(loader_name, s
-00064ca0: 7562 6c6f 6164 5f6e 616d 652c 2073 6974  ubload_name, sit
-00064cb0: 655f 7072 6566 6978 2c20 7469 6d65 2c65  e_prefix, time,e
-00064cc0: 6d70 6f77 6572 5f70 6572 696f 645f 7479  mpower_period_ty
-00064cd0: 7065 2920 2b20 275f 6578 706c 6f64 6564  pe) + '_exploded
-00064ce0: 5f73 6f72 7465 642e 7473 7627 0d0a 0d0a  _sorted.tsv'....
-00064cf0: 2020 2020 4070 726f 7065 7274 790d 0a20      @property.. 
-00064d00: 2020 2064 6566 2073 6974 6528 7365 6c66     def site(self
-00064d10: 293a 0d0a 2020 2020 2020 2020 7265 7475  ):..        retu
-00064d20: 726e 2073 656c 662e 5f73 6974 650d 0a0d  rn self._site...
-00064d30: 0a63 6c61 7373 2046 6f63 7573 4c6f 6164  .class FocusLoad
-00064d40: 6572 284c 6f61 6465 7229 3a0d 0a20 2020  er(Loader):..   
-00064d50: 2027 2727 4c6f 6164 7320 7472 616e 7361   '''Loads transa
-00064d60: 6374 696f 6e73 2069 6e74 6f20 616e 2045  ctions into an E
-00064d70: 6d70 6f77 6572 2066 6f63 7573 2727 270d  mpower focus'''.
-00064d80: 0a0d 0a20 2020 2023 4120 466f 6375 734c  ...    #A FocusL
-00064d90: 6f61 6465 7220 6973 2061 204c 6f61 6465  oader is a Loade
-00064da0: 7220 7768 6963 6820 6361 6e20 7461 6b65  r which can take
-00064db0: 2061 2046 6f63 7573 2061 7320 7461 7267   a Focus as targ
-00064dc0: 6574 2c20 616e 6420 6669 6c6c 2069 6e20  et, and fill in 
-00064dd0: 7468 6520 7375 7065 7220 636c 6173 7320  the super class 
-00064de0: 4c6f 6164 6572 206f 626a 6563 7420 6163  Loader object ac
-00064df0: 636f 7264 696e 676c 790d 0a20 2020 2023  cordingly..    #
-00064e00: 5468 6973 206d 6561 6e73 2074 6861 7420  This means that 
-00064e10: 6361 6c6c 7320 746f 206c 6f61 6420 6e65  calls to load ne
-00064e20: 6564 206c 6974 746c 6520 6170 706c 6963  ed little applic
-00064e30: 6174 696f 6e20 7072 6f67 7261 6d6d 6572  ation programmer
-00064e40: 2069 6e70 7574 2c20 616e 6420 7468 7573   input, and thus
-00064e50: 2061 2063 616c 6c20 7375 6368 2061 7320   a call such as 
-00064e60: 6466 2e74 6f5f 656d 706f 7765 7228 466f  df.to_empower(Fo
-00064e70: 6375 7329 206f 7220 6576 656e 2064 662e  cus) or even df.
-00064e80: 746f 5f65 6d70 6f77 6572 2856 6965 7770  to_empower(Viewp
-00064e90: 6f69 6e74 2920 6265 636f 6d65 7320 706f  oint) becomes po
-00064ea0: 7373 6962 6c65 0d0a 0d0a 2020 2020 6465  ssible....    de
-00064eb0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-00064ec0: 736f 7572 6365 3d4e 6f6e 652c 7461 7267  source=None,targ
-00064ed0: 6574 3d4e 6f6e 652c 6d61 7070 696e 6773  et=None,mappings
-00064ee0: 3d4e 6f6e 652c 7361 6665 5f6c 6f61 643d  =None,safe_load=
-00064ef0: 5472 7565 2c69 6465 6e74 6966 6965 725f  True,identifier_
-00064f00: 636f 6c75 6d6e 733d 4e6f 6e65 2c69 676e  columns=None,ign
-00064f10: 6f72 655f 7a65 726f 5f76 616c 7565 733d  ore_zero_values=
-00064f20: 5472 7565 2c63 6c65 6172 5f66 6f63 7573  True,clear_focus
-00064f30: 5f62 6566 6f72 655f 6c6f 6164 696e 673d  _before_loading=
-00064f40: 5472 7565 2c5f 6465 6665 725f 6d61 7070  True,_defer_mapp
-00064f50: 6572 5f63 7265 6174 696f 6e3d 4661 6c73  er_creation=Fals
-00064f60: 6529 3a0d 0a20 2020 2020 2020 2027 2727  e):..        '''
-00064f70: 2043 7265 6174 6520 6120 6e65 7720 466f   Create a new Fo
-00064f80: 6375 734c 6f61 6465 720d 0a0d 0a20 2020  cusLoader....   
-00064f90: 2020 2020 203a 7061 7261 6d20 736f 7572       :param sour
-00064fa0: 6365 3a0d 0a20 2020 2020 2020 203a 7061  ce:..        :pa
-00064fb0: 7261 6d20 7461 7267 6574 3a0d 0a20 2020  ram target:..   
-00064fc0: 2020 2020 203a 7061 7261 6d20 6d61 7070       :param mapp
-00064fd0: 696e 6773 3a0d 0a20 2020 2020 2020 203a  ings:..        :
-00064fe0: 7061 7261 6d20 7361 6665 5f6c 6f61 643a  param safe_load:
-00064ff0: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00065000: 2069 6465 6e74 6966 6965 725f 636f 6c75   identifier_colu
-00065010: 6d6e 733a 0d0a 2020 2020 2020 2020 3a70  mns:..        :p
-00065020: 6172 616d 2069 676e 6f72 655f 7a65 726f  aram ignore_zero
-00065030: 5f76 616c 7565 733a 2044 6f6e 2774 206c  _values: Don't l
-00065040: 6f61 6420 5a65 726f 2076 616c 7565 7320  oad Zero values 
-00065050: 696e 746f 2074 6865 2063 7562 6520 2d20  into the cube - 
-00065060: 6c65 6176 6520 4e2f 4173 2069 6e20 706c  leave N/As in pl
-00065070: 6163 650d 0a20 2020 2020 2020 203a 7061  ace..        :pa
-00065080: 7261 6d20 636c 6561 725f 666f 6375 735f  ram clear_focus_
-00065090: 6265 666f 7265 5f6c 6f61 6469 6e67 3a0d  before_loading:.
-000650a0: 0a0d 0a20 2020 2020 2020 2027 2727 0d0a  ...        '''..
-000650b0: 2020 2020 2020 2020 6966 2069 6465 6e74          if ident
-000650c0: 6966 6965 725f 636f 6c75 6d6e 7320 6973  ifier_columns is
-000650d0: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-000650e0: 2020 2020 6964 656e 7469 6669 6572 5f63      identifier_c
-000650f0: 6f6c 756d 6e73 3d5b 5d0d 0a0d 0a20 2020  olumns=[]....   
-00065100: 2020 2020 2073 656c 662e 5f69 6e69 7469       self._initi
-00065110: 616c 5f74 6172 6765 7420 3d20 7461 7267  al_target = targ
-00065120: 6574 0d0a 0d0a 2020 2020 2020 2020 7365  et....        se
-00065130: 6c66 2e5f 696e 6974 6961 6c5f 736f 7572  lf._initial_sour
-00065140: 6365 203d 2073 6f75 7263 650d 0a0d 0a20  ce = source.... 
-00065150: 2020 2020 2020 2023 544f 444f 202d 2063         #TODO - c
-00065160: 6172 6566 756c 6c79 2073 6574 2075 7020  arefully set up 
-00065170: 6d61 7070 696e 6773 2074 6f20 7472 616e  mappings to tran
-00065180: 7366 6f72 6d20 6469 6374 696f 6e61 7269  sform dictionari
-00065190: 6573 206f 7220 7573 6520 4375 6265 4d61  es or use CubeMa
-000651a0: 7070 6572 2061 7320 6973 0d0a 2020 2020  pper as is..    
-000651b0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-000651c0: 6528 6d61 7070 696e 6773 2c43 7562 654d  e(mappings,CubeM
-000651d0: 6170 7065 7229 3a0d 0a20 2020 2020 2020  apper):..       
-000651e0: 2020 2020 2073 656c 662e 5f6d 6170 7069       self._mappi
-000651f0: 6e67 7320 3d20 6d61 7070 696e 6773 0d0a  ngs = mappings..
-00065200: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00065210: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00065220: 5f6d 6170 7069 6e67 7320 3d20 4375 6265  _mappings = Cube
-00065230: 4d61 7070 6572 286d 6170 7069 6e67 7320  Mapper(mappings 
-00065240: 3d20 6d61 7070 696e 6773 2c20 7461 7267  = mappings, targ
-00065250: 6574 203d 2073 656c 662e 5f69 6e69 7469  et = self._initi
-00065260: 616c 5f74 6172 6765 742c 2073 6f75 7263  al_target, sourc
-00065270: 6520 3d20 7365 6c66 2e5f 696e 6974 6961  e = self._initia
-00065280: 6c5f 736f 7572 6365 290d 0a0d 0a20 2020  l_source)....   
-00065290: 2020 2020 2073 656c 662e 5f69 676e 6f72       self._ignor
-000652a0: 655f 7a65 726f 5f76 616c 7565 7320 3d20  e_zero_values = 
-000652b0: 6967 6e6f 7265 5f7a 6572 6f5f 7661 6c75  ignore_zero_valu
-000652c0: 6573 0d0a 0d0a 2020 2020 2020 2020 234f  es....        #O
-000652d0: 7665 7272 6964 6520 7468 6520 6f6c 6420  verride the old 
-000652e0: 4c6f 6164 6572 206e 616d 6520 7769 7468  Loader name with
-000652f0: 2074 6869 7320 7261 7468 6572 2067 656e   this rather gen
-00065300: 6572 6963 2027 466f 6375 734c 6f61 6465  eric 'FocusLoade
-00065310: 7227 0d0a 0d0a 2020 2020 2020 2020 6966  r'....        if
-00065320: 2073 656c 662e 7369 7465 2069 7320 6e6f   self.site is no
-00065330: 7420 4e6f 6e65 3a0d 0a20 2020 2020 2020  t None:..       
-00065340: 2020 2020 206c 6f67 6769 6e67 5f71 7565       logging_que
-00065350: 7565 203d 2073 656c 662e 7369 7465 2e6c  ue = self.site.l
-00065360: 6f67 6769 6e67 5f71 7565 7565 0d0a 2020  ogging_queue..  
-00065370: 2020 2020 2020 2020 2020 656d 706f 7765            empowe
-00065380: 725f 696d 706f 7274 6572 5f65 7865 6375  r_importer_execu
-00065390: 7461 626c 6520 3d20 7365 6c66 2e73 6974  table = self.sit
-000653a0: 652e 656d 706f 7765 725f 696d 706f 7274  e.empower_import
-000653b0: 6572 5f65 7865 6375 7461 626c 650d 0a20  er_executable.. 
-000653c0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-000653d0: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
-000653e0: 675f 7175 6575 6520 3d20 4e6f 6e65 0d0a  g_queue = None..
-000653f0: 2020 2020 2020 2020 2020 2020 656d 706f              empo
-00065400: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
-00065410: 6375 7461 626c 6520 3d20 6c6c 752e 454d  cutable = llu.EM
-00065420: 504f 5745 525f 494d 504f 5254 4552 5f45  POWER_IMPORTER_E
-00065430: 5845 4355 5441 424c 450d 0a0d 0a20 2020  XECUTABLE....   
-00065440: 2020 2020 2073 7570 6572 2846 6f63 7573       super(Focus
-00065450: 4c6f 6164 6572 2c20 7365 6c66 292e 5f5f  Loader, self).__
-00065460: 696e 6974 5f5f 2873 6f75 7263 653d 7365  init__(source=se
-00065470: 6c66 2e5f 696e 6974 6961 6c5f 736f 7572  lf._initial_sour
-00065480: 6365 0d0a 2020 2020 2020 2020 2020 2020  ce..            
-00065490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000654a0: 2020 2020 2020 2020 2020 2020 202c 7369               ,si
-000654b0: 7465 3d73 656c 662e 7369 7465 0d0a 2020  te=self.site..  
+00063820: 2020 2020 2020 2020 2020 202c 7365 7061             ,sepa
+00063830: 7261 746f 723d 275c 7427 0d0a 2020 2020  rator='\t'..    
+00063840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063860: 2020 2020 2020 2020 2020 2c6c 6f67 6769            ,loggi
+00063870: 6e67 5f71 7565 7565 203d 2073 656c 662e  ng_queue = self.
+00063880: 7369 7465 2e6c 6f67 6769 6e67 5f71 7565  site.logging_que
+00063890: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+000638a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000638b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000638c0: 2020 290d 0a0d 0a20 2020 2064 6566 206c    )....    def l
+000638d0: 6f61 645f 7368 6172 6473 2873 656c 662c  oad_shards(self,
+000638e0: 7375 626c 6f61 6473 3d4e 6f6e 6529 3a0d  subloads=None):.
+000638f0: 0a20 2020 2020 2020 2027 2727 0d0a 2020  .        '''..  
+00063900: 2020 2020 2020 2727 270d 0a0d 0a20 2020        '''....   
+00063910: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+00063920: 2e73 6861 7264 696e 675f 7175 6575 6520  .sharding_queue 
+00063930: 6973 204e 6f6e 653a 0d0a 2020 2020 2020  is None:..      
+00063940: 2020 2020 2020 6c6f 672e 7665 7262 6f73        log.verbos
+00063950: 6528 2744 6973 706f 7369 6e67 2073 6861  e('Disposing sha
+00063960: 7264 696e 6720 7175 6575 652e 2e2e 2729  rding queue...')
+00063970: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00063980: 6c66 2e73 6861 7264 696e 675f 7175 6575  lf.sharding_queu
+00063990: 652e 6469 7370 6f73 6528 290d 0a20 2020  e.dispose()..   
+000639a0: 2020 2020 2020 2020 206c 6f67 2e76 6572           log.ver
+000639b0: 626f 7365 2827 5368 6172 6469 6e67 2071  bose('Sharding q
+000639c0: 7565 7565 2064 6973 706f 7365 6427 290d  ueue disposed').
+000639d0: 0a0d 0a20 2020 2020 2020 2020 2020 206c  ...            l
+000639e0: 6f67 2e76 6572 626f 7365 2827 4a6f 696e  og.verbose('Join
+000639f0: 696e 6720 7368 6172 6465 7227 290d 0a20  ing sharder').. 
+00063a00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00063a10: 7368 6172 6465 722e 6a6f 696e 2829 0d0a  sharder.join()..
+00063a20: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00063a30: 2073 656c 662e 7368 6172 6465 722e 6578   self.sharder.ex
+00063a40: 6974 636f 6465 2021 3d20 303a 0d0a 2020  itcode != 0:..  
+00063a50: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00063a60: 672e 6572 726f 7228 277b 7d2e 6578 6974  g.error('{}.exit
+00063a70: 636f 6465 203d 207b 7d27 2e66 6f72 6d61  code = {}'.forma
+00063a80: 7428 7365 6c66 2e73 6861 7264 6572 2e73  t(self.sharder.s
+00063a90: 656c 662e 7368 6172 6465 722c 2073 656c  elf.sharder, sel
+00063aa0: 662e 7368 6172 6465 722e 6578 6974 636f  f.sharder.exitco
+00063ab0: 6465 2929 0d0a 2020 2020 2020 2020 2020  de))..          
+00063ac0: 2020 2020 2020 7261 6973 6520 6d70 6578        raise mpex
+00063ad0: 2e43 6f6d 706c 6574 656c 794c 6f67 6765  .CompletelyLogge
+00063ae0: 6445 7272 6f72 2827 5368 6172 6465 7220  dError('Sharder 
+00063af0: 4a6f 623a 272b 7365 6c66 2e73 6861 7264  Job:'+self.shard
+00063b00: 6572 2e6e 616d 652b 2720 6661 696c 6564  er.name+' failed
+00063b10: 2077 6974 6820 6578 6974 2063 6f64 6520   with exit code 
+00063b20: 272b 7374 7228 7365 6c66 2e73 6861 7264  '+str(self.shard
+00063b30: 6572 2e65 7869 7463 6f64 6529 290d 0a20  er.exitcode)).. 
+00063b40: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00063b50: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00063b60: 2020 6c6f 672e 7665 7262 6f73 6528 277b    log.verbose('{
+00063b70: 7d2e 6578 6974 636f 6465 203d 207b 7d27  }.exitcode = {}'
+00063b80: 2e66 6f72 6d61 7428 7365 6c66 2e73 6861  .format(self.sha
+00063b90: 7264 6572 2e6e 616d 652c 2073 656c 662e  rder.name, self.
+00063ba0: 7368 6172 6465 722e 6578 6974 636f 6465  sharder.exitcode
+00063bb0: 2929 0d0a 0d0a 2020 2020 2020 2020 6966  ))....        if
+00063bc0: 2073 656c 662e 7369 7465 2e73 746f 7261   self.site.stora
+00063bd0: 6765 5f74 7970 653d 3d22 7371 6c22 3a0d  ge_type=="sql":.
+00063be0: 0a0d 0a20 2020 2020 2020 2020 2020 206c  ...            l
+00063bf0: 6c75 2e6c 6f61 645f 7371 6c5f 656d 706f  lu.load_sql_empo
+00063c00: 7765 725f 6672 6f6d 5f73 6861 7264 7328  wer_from_shards(
+00063c10: 2065 6d70 6f77 6572 5f73 6974 653d 7365   empower_site=se
+00063c20: 6c66 2e73 6974 652e 5f73 6974 655f 6c6f  lf.site._site_lo
+00063c30: 6361 746f 720d 0a20 2020 2020 2020 2020  cator..         
+00063c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063c60: 2020 2020 2c65 6e63 7279 7074 6564 5f65      ,encrypted_e
+00063c70: 6d70 6f77 6572 5f75 7365 723d 7365 6c66  mpower_user=self
+00063c80: 2e73 6974 652e 5f65 6e63 7279 7074 6564  .site._encrypted
+00063c90: 5f75 7365 720d 0a20 2020 2020 2020 2020  _user..         
+00063ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063cc0: 2020 2020 2c65 6e63 7279 7074 6564 5f65      ,encrypted_e
+00063cd0: 6d70 6f77 6572 5f70 7764 3d73 656c 662e  mpower_pwd=self.
+00063ce0: 7369 7465 2e5f 656e 6372 7970 7465 645f  site._encrypted_
+00063cf0: 7077 640d 0a20 2020 2020 2020 2020 2020  pwd..           
+00063d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063d20: 2020 2c73 6861 7264 5f66 696c 655f 7072    ,shard_file_pr
+00063d30: 6566 6978 3d27 5368 6172 645f 270d 0a20  efix='Shard_'.. 
+00063d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063d60: 2020 2020 2020 2020 2020 2020 2c6e 756d              ,num
+00063d70: 6265 725f 6f66 5f77 6f72 6b65 7273 3d6d  ber_of_workers=m
+00063d80: 756c 7469 7072 6f63 6573 7369 6e67 2e63  ultiprocessing.c
+00063d90: 7075 5f63 6f75 6e74 2829 2d31 0d0a 2020  pu_count()-1..  
+00063da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063dc0: 2020 2020 2020 2020 2020 202c 6c6f 6164             ,load
+00063dd0: 5f70 726f 6365 7373 696e 675f 6469 723d  _processing_dir=
+00063de0: 7365 6c66 2e73 6974 652e 5f6c 6f61 645f  self.site._load_
+00063df0: 7072 6f63 6573 7369 6e67 5f64 6972 0d0a  processing_dir..
+00063e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063e20: 2020 2020 2020 2020 2020 2020 202c 6c6f               ,lo
+00063e30: 6767 696e 675f 7175 6575 653d 7365 6c66  gging_queue=self
+00063e40: 2e73 6974 652e 6c6f 6767 696e 675f 7175  .site.logging_qu
+00063e50: 6575 650d 0a20 2020 2020 2020 2020 2020  eue..           
+00063e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063e80: 2020 2c5f 7369 6e67 6c65 5f62 756c 6b5f    ,_single_bulk_
+00063e90: 6c6f 6164 5f66 756e 6374 696f 6e20 3d20  load_function = 
+00063ea0: 7365 6c66 2e5f 7369 6e67 6c65 5f62 756c  self._single_bul
+00063eb0: 6b5f 6c6f 6164 5f66 756e 6374 696f 6e0d  k_load_function.
+00063ec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00063ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00063ee0: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00063ef0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+00063f00: 2020 2020 2020 2020 2020 2020 6c6f 672e              log.
+00063f10: 7665 7262 6f73 6528 2743 616c 6c69 6e67  verbose('Calling
+00063f20: 206c 6f77 206c 6576 656c 2075 7469 6c69   low level utili
+00063f30: 7479 206c 6f61 645f 656d 706f 7765 725f  ty load_empower_
+00063f40: 6672 6f6d 5f73 6861 7264 732e 2e2e 2729  from_shards...')
+00063f50: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00063f60: 6966 2073 656c 662e 7369 7465 2e70 7265  if self.site.pre
+00063f70: 6669 7820 6973 204e 6f6e 653a 0d0a 2020  fix is None:..  
+00063f80: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00063f90: 6973 6520 5661 6c75 6545 7272 6f72 2827  ise ValueError('
+00063fa0: 4361 6e6e 6f74 2062 6567 696e 2062 756c  Cannot begin bul
+00063fb0: 6b20 6c6f 6164 696e 6720 756e 7469 6c20  k loading until 
+00063fc0: 7468 6520 7369 7465 2e70 7265 6669 7820  the site.prefix 
+00063fd0: 6861 7320 6265 656e 2073 6574 2e20 5365  has been set. Se
+00063fe0: 7420 7369 7465 2e70 7265 6669 7820 746f  t site.prefix to
+00063ff0: 2074 6865 2066 696c 656e 616d 6520 7072   the filename pr
+00064000: 6566 6978 206f 6620 7468 6520 6461 7461  efix of the data
+00064010: 2066 696c 6573 2028 7468 6520 6269 7420   files (the bit 
+00064020: 6265 666f 7265 2074 6865 206c 6173 7420  before the last 
+00064030: 3320 6c65 7474 6572 7320 6265 666f 7265  3 letters before
+00064040: 2e30 3030 292e 2054 6865 6e20 6361 6c6c  .000). Then call
+00064050: 206c 6f61 6465 722e 6c6f 6164 2829 2061   loader.load() a
+00064060: 6761 696e 2729 0d0a 0d0a 2020 2020 2020  gain')....      
+00064070: 2020 2020 2020 2353 686f 756c 6420 7765        #Should we
+00064080: 2063 7265 6174 6520 6120 5375 624c 6f61   create a SubLoa
+00064090: 6420 6f62 6a65 6374 2c20 746f 2068 6f6c  d object, to hol
+000640a0: 6420 7468 6520 7375 626c 6f61 6420 616e  d the subload an
+000640b0: 6420 7065 7269 6f64 2074 6f67 6574 6865  d period togethe
+000640c0: 722c 206a 7573 7420 696e 2063 6173 653f  r, just in case?
+000640d0: 0d0a 2020 2020 2020 2020 2020 2020 6c6c  ..            ll
+000640e0: 752e 6c6f 6164 5f65 6d70 6f77 6572 5f66  u.load_empower_f
+000640f0: 726f 6d5f 7368 6172 6473 2865 6d70 6f77  rom_shards(empow
+00064100: 6572 5f73 6974 6520 3d20 7365 6c66 2e73  er_site = self.s
+00064110: 6974 652e 5f73 6974 655f 6c6f 6361 746f  ite._site_locato
+00064120: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
+00064130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064140: 2020 2020 2020 2020 2020 202c 656d 706f             ,empo
+00064150: 7765 725f 7573 6572 203d 2073 656c 662e  wer_user = self.
+00064160: 7369 7465 2e5f 7573 6572 0d0a 2020 2020  site._user..    
+00064170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064190: 2020 2020 2c65 6d70 6f77 6572 5f70 7764      ,empower_pwd
+000641a0: 2020 3d20 7365 6c66 2e73 6974 652e 5f70    = self.site._p
+000641b0: 7764 0d0a 2020 2020 2020 2020 2020 2020  wd..            
+000641c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000641d0: 2020 2020 2020 2020 2020 2020 2c6c 6f61              ,loa
+000641e0: 645f 6d65 7468 6f64 3d27 6275 6c6b 270d  d_method='bulk'.
+000641f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00064200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064210: 2020 2020 2020 2020 202c 7368 6172 645f           ,shard_
+00064220: 6669 6c65 5f70 7265 6669 783d 2753 6861  file_prefix='Sha
+00064230: 7264 5f27 0d0a 2020 2020 2020 2020 2020  rd_'..          
+00064240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064250: 2020 2020 2020 2020 2020 2020 2020 2c65                ,e
+00064260: 6d70 6f77 6572 5f64 6174 615f 6669 6c65  mpower_data_file
+00064270: 5f70 7265 6669 783d 7365 6c66 2e73 6974  _prefix=self.sit
+00064280: 652e 7072 6566 6978 0d0a 2020 2020 2020  e.prefix..      
+00064290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000642a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000642b0: 2020 2c6d 6169 6e5f 7369 7465 5f6f 7574    ,main_site_out
+000642c0: 7075 745f 6461 7461 5f66 696c 6573 5f64  put_data_files_d
+000642d0: 6972 3d73 656c 662e 7369 7465 2e5f 6f75  ir=self.site._ou
+000642e0: 7470 7574 5f64 6174 615f 6669 6c65 735f  tput_data_files_
+000642f0: 6469 720d 0a20 2020 2020 2020 2020 2020  dir..           
+00064300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064310: 2020 2020 2020 2020 2020 2020 202c 6c6f               ,lo
+00064320: 6164 5f70 726f 6365 7373 696e 675f 6469  ad_processing_di
+00064330: 723d 7365 6c66 2e73 6974 652e 5f6c 6f61  r=self.site._loa
+00064340: 645f 7072 6f63 6573 7369 6e67 5f64 6972  d_processing_dir
+00064350: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00064360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064370: 2020 2020 2020 2020 2020 2c6c 6f67 6769            ,loggi
+00064380: 6e67 5f71 7565 7565 203d 2073 656c 662e  ng_queue = self.
+00064390: 7369 7465 2e6c 6f67 6769 6e67 5f71 7565  site.logging_que
+000643a0: 7565 0d0a 2020 2020 2020 2020 2020 2020  ue..            
+000643b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000643c0: 2020 2020 2020 2020 2020 2020 2c73 6166              ,saf
+000643d0: 655f 6c6f 6164 3d73 656c 662e 7361 6665  e_load=self.safe
+000643e0: 5f6c 6f61 640d 0a20 2020 2020 2020 2020  _load..         
+000643f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064400: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+00064410: 656e 6372 7970 7465 645f 656d 706f 7765  encrypted_empowe
+00064420: 725f 7573 6572 3d73 656c 662e 7369 7465  r_user=self.site
+00064430: 2e5f 656e 6372 7970 7465 645f 7573 6572  ._encrypted_user
+00064440: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00064450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00064460: 2020 2020 2020 2020 2020 2c65 6e63 7279            ,encry
+00064470: 7074 6564 5f65 6d70 6f77 6572 5f70 7764  pted_empower_pwd
+00064480: 3d73 656c 662e 7369 7465 2e5f 656e 6372  =self.site._encr
+00064490: 7970 7465 645f 7077 640d 0a20 2020 2020  ypted_pwd..     
+000644a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000644b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000644c0: 2020 2029 0d0a 0d0a 2020 2020 6465 6620     )....    def 
+000644d0: 5f72 6570 6c61 6365 5f62 6164 5f63 6861  _replace_bad_cha
+000644e0: 7273 2873 7472 696e 6729 3a0d 0a20 2020  rs(string):..   
+000644f0: 2020 2020 2066 6f72 2063 6861 7220 696e       for char in
+00064500: 2072 273c 3e3a 222f 5c7c 3f2a 273a 0d0a   r'<>:"/\|?*':..
+00064510: 2020 2020 2020 2020 2020 2020 7374 7269              stri
+00064520: 6e67 3d73 7472 696e 672e 7265 706c 6163  ng=string.replac
+00064530: 6528 6368 6172 2c27 2327 290d 0a20 2020  e(char,'#')..   
+00064540: 2020 2020 2072 6574 7572 6e20 7374 7269       return stri
+00064550: 6e67 0d0a 0d0a 2020 2020 6465 6620 5f67  ng....    def _g
+00064560: 6574 5f62 756c 6b6c 6f61 645f 6669 6c65  et_bulkload_file
+00064570: 5f74 696d 655f 7072 6566 6978 2874 696d  _time_prefix(tim
+00064580: 652c 656d 706f 7765 725f 7065 7269 6f64  e,empower_period
+00064590: 5f74 7970 6529 3a0d 0a20 2020 2020 2020  _type):..       
+000645a0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+000645b0: 2020 2074 696d 655f 7072 6566 6978 3d64     time_prefix=d
+000645c0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
+000645d0: 2e73 7472 6674 696d 6528 7469 6d65 2c27  .strftime(time,'
+000645e0: 2559 5f25 6d5f 2564 5f27 292b 7374 7228  %Y_%m_%d_')+str(
+000645f0: 656d 706f 7765 725f 7065 7269 6f64 5f74  empower_period_t
+00064600: 7970 6529 0d0a 2020 2020 2020 2020 6578  ype)..        ex
+00064610: 6365 7074 2054 7970 6545 7272 6f72 3a0d  cept TypeError:.
+00064620: 0a20 2020 2020 2020 2020 2020 2023 5765  .            #We
+00064630: 2067 6f74 2070 6173 7365 6420 696e 2061   got passed in a
+00064640: 2043 6f6c 756d 6e20 4e61 6d65 2028 7769   Column Name (wi
+00064650: 7468 204d 756c 7469 706c 6520 7469 6d65  th Multiple time
+00064660: 7329 0d0a 2020 2020 2020 2020 2020 2020  s)..            
+00064670: 7469 6d65 5f70 7265 6669 7820 3d20 7469  time_prefix = ti
+00064680: 6d65 2e72 6570 6c61 6365 2827 2027 2c27  me.replace(' ','
+00064690: 5f27 292b 275f 272b 7374 7228 656d 706f  _')+'_'+str(empo
+000646a0: 7765 725f 7065 7269 6f64 5f74 7970 6529  wer_period_type)
+000646b0: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
+000646c0: 726e 2074 696d 655f 7072 6566 6978 0d0a  rn time_prefix..
+000646d0: 0d0a 2020 2020 6465 6620 5f67 6574 5f62  ..    def _get_b
+000646e0: 756c 6b6c 6f61 645f 6669 6c65 5f70 7265  ulkload_file_pre
+000646f0: 6669 7828 6c6f 6164 6572 5f6e 616d 652c  fix(loader_name,
+00064700: 2073 7562 6c6f 6164 5f6e 616d 652c 2073   subload_name, s
+00064710: 6974 655f 7072 6566 6978 2c20 7469 6d65  ite_prefix, time
+00064720: 2c65 6d70 6f77 6572 5f70 6572 696f 645f  ,empower_period_
+00064730: 7479 7065 293a 0d0a 2020 2020 2020 2020  type):..        
+00064740: 7469 6d65 5f70 7265 6669 7820 2020 2020  time_prefix     
+00064750: 2020 2020 2020 2020 3d20 4c6f 6164 6572          = Loader
+00064760: 2e5f 6765 745f 6275 6c6b 6c6f 6164 5f66  ._get_bulkload_f
+00064770: 696c 655f 7469 6d65 5f70 7265 6669 7828  ile_time_prefix(
+00064780: 7469 6d65 2c65 6d70 6f77 6572 5f70 6572  time,empower_per
+00064790: 696f 645f 7479 7065 290d 0a20 2020 2020  iod_type)..     
+000647a0: 2020 2066 696c 655f 7072 6566 6978 2020     file_prefix  
+000647b0: 2020 2020 2020 2020 2020 203d 204c 6f61             = Loa
+000647c0: 6465 722e 5f72 6570 6c61 6365 5f62 6164  der._replace_bad
+000647d0: 5f63 6861 7273 2873 6974 655f 7072 6566  _chars(site_pref
+000647e0: 6978 2920 2b20 275f 2720 2b20 4c6f 6164  ix) + '_' + Load
+000647f0: 6572 2e5f 7265 706c 6163 655f 6261 645f  er._replace_bad_
+00064800: 6368 6172 7328 6c6f 6164 6572 5f6e 616d  chars(loader_nam
+00064810: 6529 202b 2027 5f27 202b 204c 6f61 6465  e) + '_' + Loade
+00064820: 722e 5f72 6570 6c61 6365 5f62 6164 5f63  r._replace_bad_c
+00064830: 6861 7273 2873 7562 6c6f 6164 5f6e 616d  hars(subload_nam
+00064840: 6529 2b27 5f27 2b74 696d 655f 7072 6566  e)+'_'+time_pref
+00064850: 6978 0d0a 2020 2020 2020 2020 7265 7475  ix..        retu
+00064860: 726e 2066 696c 655f 7072 6566 6978 0d0a  rn file_prefix..
+00064870: 0d0a 2020 2020 6465 6620 5f67 6574 5f69  ..    def _get_i
+00064880: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
+00064890: 5f6e 616d 6528 6c6f 6164 6572 5f6e 616d  _name(loader_nam
+000648a0: 652c 2073 7562 6c6f 6164 5f6e 616d 652c  e, subload_name,
+000648b0: 2073 6974 655f 7072 6566 6978 2c20 7469   site_prefix, ti
+000648c0: 6d65 2c65 6d70 6f77 6572 5f70 6572 696f  me,empower_perio
+000648d0: 645f 7479 7065 293a 0d0a 2020 2020 2020  d_type):..      
+000648e0: 2020 7265 7475 726e 204c 6f61 6465 722e    return Loader.
+000648f0: 5f67 6574 5f62 756c 6b6c 6f61 645f 6669  _get_bulkload_fi
+00064900: 6c65 5f70 7265 6669 7828 6c6f 6164 6572  le_prefix(loader
+00064910: 5f6e 616d 652c 2073 7562 6c6f 6164 5f6e  _name, subload_n
+00064920: 616d 652c 2073 6974 655f 7072 6566 6978  ame, site_prefix
+00064930: 2c20 7469 6d65 2c65 6d70 6f77 6572 5f70  , time,empower_p
+00064940: 6572 696f 645f 7479 7065 2920 2b20 275f  eriod_type) + '_
+00064950: 696e 7465 726d 6564 6961 7465 2e74 7376  intermediate.tsv
+00064960: 270d 0a0d 0a20 2020 2064 6566 205f 6765  '....    def _ge
+00064970: 745f 7461 7267 6574 5f66 696c 655f 6e61  t_target_file_na
+00064980: 6d65 286c 6f61 6465 725f 6e61 6d65 2c20  me(loader_name, 
+00064990: 7375 626c 6f61 645f 6e61 6d65 2c20 7369  subload_name, si
+000649a0: 7465 5f70 7265 6669 782c 2074 696d 652c  te_prefix, time,
+000649b0: 656d 706f 7765 725f 7065 7269 6f64 5f74  empower_period_t
+000649c0: 7970 6529 3a0d 0a20 2020 2020 2020 2072  ype):..        r
+000649d0: 6574 7572 6e20 4c6f 6164 6572 2e5f 6765  eturn Loader._ge
+000649e0: 745f 6275 6c6b 6c6f 6164 5f66 696c 655f  t_bulkload_file_
+000649f0: 7072 6566 6978 286c 6f61 6465 725f 6e61  prefix(loader_na
+00064a00: 6d65 2c20 7375 626c 6f61 645f 6e61 6d65  me, subload_name
+00064a10: 2c20 7369 7465 5f70 7265 6669 782c 2074  , site_prefix, t
+00064a20: 696d 652c 656d 706f 7765 725f 7065 7269  ime,empower_peri
+00064a30: 6f64 5f74 7970 6529 202b 2027 5f65 7870  od_type) + '_exp
+00064a40: 6c6f 6465 642e 7473 7627 0d0a 0d0a 2020  loded.tsv'....  
+00064a50: 2020 6465 6620 5f67 6574 5f64 656c 7461    def _get_delta
+00064a60: 5f66 696c 655f 6e61 6d65 286c 6f61 6465  _file_name(loade
+00064a70: 725f 6e61 6d65 2c20 7375 626c 6f61 645f  r_name, subload_
+00064a80: 6e61 6d65 2c20 7369 7465 5f70 7265 6669  name, site_prefi
+00064a90: 782c 2074 696d 652c 656d 706f 7765 725f  x, time,empower_
+00064aa0: 7065 7269 6f64 5f74 7970 6529 3a0d 0a20  period_type):.. 
+00064ab0: 2020 2020 2020 2072 6574 7572 6e20 4c6f         return Lo
+00064ac0: 6164 6572 2e5f 6765 745f 6275 6c6b 6c6f  ader._get_bulklo
+00064ad0: 6164 5f66 696c 655f 7072 6566 6978 286c  ad_file_prefix(l
+00064ae0: 6f61 6465 725f 6e61 6d65 2c20 7375 626c  oader_name, subl
+00064af0: 6f61 645f 6e61 6d65 2c20 7369 7465 5f70  oad_name, site_p
+00064b00: 7265 6669 782c 2074 696d 652c 656d 706f  refix, time,empo
+00064b10: 7765 725f 7065 7269 6f64 5f74 7970 6529  wer_period_type)
+00064b20: 202b 2027 5f64 656c 7461 2e74 7376 270d   + '_delta.tsv'.
+00064b30: 0a0d 0a20 2020 2064 6566 205f 6765 745f  ...    def _get_
+00064b40: 6465 6c74 615f 7265 7665 7273 696f 6e5f  delta_reversion_
+00064b50: 6669 6c65 5f6e 616d 6528 6c6f 6164 6572  file_name(loader
+00064b60: 5f6e 616d 652c 2073 7562 6c6f 6164 5f6e  _name, subload_n
+00064b70: 616d 652c 2073 6974 655f 7072 6566 6978  ame, site_prefix
+00064b80: 2c20 7469 6d65 2c65 6d70 6f77 6572 5f70  , time,empower_p
+00064b90: 6572 696f 645f 7479 7065 293a 0d0a 2020  eriod_type):..  
+00064ba0: 2020 2020 2020 7265 7475 726e 204c 6f61        return Loa
+00064bb0: 6465 722e 5f67 6574 5f62 756c 6b6c 6f61  der._get_bulkloa
+00064bc0: 645f 6669 6c65 5f70 7265 6669 7828 6c6f  d_file_prefix(lo
+00064bd0: 6164 6572 5f6e 616d 652c 2073 7562 6c6f  ader_name, sublo
+00064be0: 6164 5f6e 616d 652c 2073 6974 655f 7072  ad_name, site_pr
+00064bf0: 6566 6978 2c20 7469 6d65 2c65 6d70 6f77  efix, time,empow
+00064c00: 6572 5f70 6572 696f 645f 7479 7065 2920  er_period_type) 
+00064c10: 2b20 275f 6465 6c74 615f 7265 7665 7273  + '_delta_revers
+00064c20: 696f 6e2e 7473 7627 0d0a 0d0a 2020 2020  ion.tsv'....    
+00064c30: 6465 6620 5f67 6574 5f73 6f72 7465 645f  def _get_sorted_
+00064c40: 6669 6c65 5f6e 616d 6528 6c6f 6164 6572  file_name(loader
+00064c50: 5f6e 616d 652c 2073 7562 6c6f 6164 5f6e  _name, subload_n
+00064c60: 616d 652c 2073 6974 655f 7072 6566 6978  ame, site_prefix
+00064c70: 2c20 7469 6d65 2c65 6d70 6f77 6572 5f70  , time,empower_p
+00064c80: 6572 696f 645f 7479 7065 293a 0d0a 2020  eriod_type):..  
+00064c90: 2020 2020 2020 7265 7475 726e 204c 6f61        return Loa
+00064ca0: 6465 722e 5f67 6574 5f62 756c 6b6c 6f61  der._get_bulkloa
+00064cb0: 645f 6669 6c65 5f70 7265 6669 7828 6c6f  d_file_prefix(lo
+00064cc0: 6164 6572 5f6e 616d 652c 2073 7562 6c6f  ader_name, sublo
+00064cd0: 6164 5f6e 616d 652c 2073 6974 655f 7072  ad_name, site_pr
+00064ce0: 6566 6978 2c20 7469 6d65 2c65 6d70 6f77  efix, time,empow
+00064cf0: 6572 5f70 6572 696f 645f 7479 7065 2920  er_period_type) 
+00064d00: 2b20 275f 6578 706c 6f64 6564 5f73 6f72  + '_exploded_sor
+00064d10: 7465 642e 7473 7627 0d0a 0d0a 2020 2020  ted.tsv'....    
+00064d20: 4070 726f 7065 7274 790d 0a20 2020 2064  @property..    d
+00064d30: 6566 2073 6974 6528 7365 6c66 293a 0d0a  ef site(self):..
+00064d40: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00064d50: 656c 662e 5f73 6974 650d 0a0d 0a63 6c61  elf._site....cla
+00064d60: 7373 2046 6f63 7573 4c6f 6164 6572 284c  ss FocusLoader(L
+00064d70: 6f61 6465 7229 3a0d 0a20 2020 2027 2727  oader):..    '''
+00064d80: 4c6f 6164 7320 7472 616e 7361 6374 696f  Loads transactio
+00064d90: 6e73 2069 6e74 6f20 616e 2045 6d70 6f77  ns into an Empow
+00064da0: 6572 2066 6f63 7573 2727 270d 0a0d 0a20  er focus'''.... 
+00064db0: 2020 2023 4120 466f 6375 734c 6f61 6465     #A FocusLoade
+00064dc0: 7220 6973 2061 204c 6f61 6465 7220 7768  r is a Loader wh
+00064dd0: 6963 6820 6361 6e20 7461 6b65 2061 2046  ich can take a F
+00064de0: 6f63 7573 2061 7320 7461 7267 6574 2c20  ocus as target, 
+00064df0: 616e 6420 6669 6c6c 2069 6e20 7468 6520  and fill in the 
+00064e00: 7375 7065 7220 636c 6173 7320 4c6f 6164  super class Load
+00064e10: 6572 206f 626a 6563 7420 6163 636f 7264  er object accord
+00064e20: 696e 676c 790d 0a20 2020 2023 5468 6973  ingly..    #This
+00064e30: 206d 6561 6e73 2074 6861 7420 6361 6c6c   means that call
+00064e40: 7320 746f 206c 6f61 6420 6e65 6564 206c  s to load need l
+00064e50: 6974 746c 6520 6170 706c 6963 6174 696f  ittle applicatio
+00064e60: 6e20 7072 6f67 7261 6d6d 6572 2069 6e70  n programmer inp
+00064e70: 7574 2c20 616e 6420 7468 7573 2061 2063  ut, and thus a c
+00064e80: 616c 6c20 7375 6368 2061 7320 6466 2e74  all such as df.t
+00064e90: 6f5f 656d 706f 7765 7228 466f 6375 7329  o_empower(Focus)
+00064ea0: 206f 7220 6576 656e 2064 662e 746f 5f65   or even df.to_e
+00064eb0: 6d70 6f77 6572 2856 6965 7770 6f69 6e74  mpower(Viewpoint
+00064ec0: 2920 6265 636f 6d65 7320 706f 7373 6962  ) becomes possib
+00064ed0: 6c65 0d0a 0d0a 2020 2020 6465 6620 5f5f  le....    def __
+00064ee0: 696e 6974 5f5f 2873 656c 662c 736f 7572  init__(self,sour
+00064ef0: 6365 3d4e 6f6e 652c 7461 7267 6574 3d4e  ce=None,target=N
+00064f00: 6f6e 652c 6d61 7070 696e 6773 3d4e 6f6e  one,mappings=Non
+00064f10: 652c 7361 6665 5f6c 6f61 643d 5472 7565  e,safe_load=True
+00064f20: 2c69 6465 6e74 6966 6965 725f 636f 6c75  ,identifier_colu
+00064f30: 6d6e 733d 4e6f 6e65 2c69 676e 6f72 655f  mns=None,ignore_
+00064f40: 7a65 726f 5f76 616c 7565 733d 5472 7565  zero_values=True
+00064f50: 2c63 6c65 6172 5f66 6f63 7573 5f62 6566  ,clear_focus_bef
+00064f60: 6f72 655f 6c6f 6164 696e 673d 5472 7565  ore_loading=True
+00064f70: 2c5f 6465 6665 725f 6d61 7070 6572 5f63  ,_defer_mapper_c
+00064f80: 7265 6174 696f 6e3d 4661 6c73 6529 3a0d  reation=False):.
+00064f90: 0a20 2020 2020 2020 2027 2727 2043 7265  .        ''' Cre
+00064fa0: 6174 6520 6120 6e65 7720 466f 6375 734c  ate a new FocusL
+00064fb0: 6f61 6465 720d 0a0d 0a20 2020 2020 2020  oader....       
+00064fc0: 203a 7061 7261 6d20 736f 7572 6365 3a0d   :param source:.
+00064fd0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00064fe0: 7461 7267 6574 3a0d 0a20 2020 2020 2020  target:..       
+00064ff0: 203a 7061 7261 6d20 6d61 7070 696e 6773   :param mappings
+00065000: 3a0d 0a20 2020 2020 2020 203a 7061 7261  :..        :para
+00065010: 6d20 7361 6665 5f6c 6f61 643a 0d0a 2020  m safe_load:..  
+00065020: 2020 2020 2020 3a70 6172 616d 2069 6465        :param ide
+00065030: 6e74 6966 6965 725f 636f 6c75 6d6e 733a  ntifier_columns:
+00065040: 0d0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00065050: 2069 676e 6f72 655f 7a65 726f 5f76 616c   ignore_zero_val
+00065060: 7565 733a 2044 6f6e 2774 206c 6f61 6420  ues: Don't load 
+00065070: 5a65 726f 2076 616c 7565 7320 696e 746f  Zero values into
+00065080: 2074 6865 2063 7562 6520 2d20 6c65 6176   the cube - leav
+00065090: 6520 4e2f 4173 2069 6e20 706c 6163 650d  e N/As in place.
+000650a0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000650b0: 636c 6561 725f 666f 6375 735f 6265 666f  clear_focus_befo
+000650c0: 7265 5f6c 6f61 6469 6e67 3a0d 0a0d 0a20  re_loading:.... 
+000650d0: 2020 2020 2020 2027 2727 0d0a 2020 2020         '''..    
+000650e0: 2020 2020 6966 2069 6465 6e74 6966 6965      if identifie
+000650f0: 725f 636f 6c75 6d6e 7320 6973 204e 6f6e  r_columns is Non
+00065100: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00065110: 6964 656e 7469 6669 6572 5f63 6f6c 756d  identifier_colum
+00065120: 6e73 3d5b 5d0d 0a0d 0a20 2020 2020 2020  ns=[]....       
+00065130: 2073 656c 662e 5f69 6e69 7469 616c 5f74   self._initial_t
+00065140: 6172 6765 7420 3d20 7461 7267 6574 0d0a  arget = target..
+00065150: 0d0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
+00065160: 696e 6974 6961 6c5f 736f 7572 6365 203d  initial_source =
+00065170: 2073 6f75 7263 650d 0a0d 0a20 2020 2020   source....     
+00065180: 2020 2023 544f 444f 202d 2063 6172 6566     #TODO - caref
+00065190: 756c 6c79 2073 6574 2075 7020 6d61 7070  ully set up mapp
+000651a0: 696e 6773 2074 6f20 7472 616e 7366 6f72  ings to transfor
+000651b0: 6d20 6469 6374 696f 6e61 7269 6573 206f  m dictionaries o
+000651c0: 7220 7573 6520 4375 6265 4d61 7070 6572  r use CubeMapper
+000651d0: 2061 7320 6973 0d0a 2020 2020 2020 2020   as is..        
+000651e0: 6966 2069 7369 6e73 7461 6e63 6528 6d61  if isinstance(ma
+000651f0: 7070 696e 6773 2c43 7562 654d 6170 7065  ppings,CubeMappe
+00065200: 7229 3a0d 0a20 2020 2020 2020 2020 2020  r):..           
+00065210: 2073 656c 662e 5f6d 6170 7069 6e67 7320   self._mappings 
+00065220: 3d20 6d61 7070 696e 6773 0d0a 2020 2020  = mappings..    
+00065230: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00065240: 2020 2020 2020 2073 656c 662e 5f6d 6170         self._map
+00065250: 7069 6e67 7320 3d20 4375 6265 4d61 7070  pings = CubeMapp
+00065260: 6572 286d 6170 7069 6e67 7320 3d20 6d61  er(mappings = ma
+00065270: 7070 696e 6773 2c20 7461 7267 6574 203d  ppings, target =
+00065280: 2073 656c 662e 5f69 6e69 7469 616c 5f74   self._initial_t
+00065290: 6172 6765 742c 2073 6f75 7263 6520 3d20  arget, source = 
+000652a0: 7365 6c66 2e5f 696e 6974 6961 6c5f 736f  self._initial_so
+000652b0: 7572 6365 290d 0a0d 0a20 2020 2020 2020  urce)....       
+000652c0: 2073 656c 662e 5f69 676e 6f72 655f 7a65   self._ignore_ze
+000652d0: 726f 5f76 616c 7565 7320 3d20 6967 6e6f  ro_values = igno
+000652e0: 7265 5f7a 6572 6f5f 7661 6c75 6573 0d0a  re_zero_values..
+000652f0: 0d0a 2020 2020 2020 2020 234f 7665 7272  ..        #Overr
+00065300: 6964 6520 7468 6520 6f6c 6420 4c6f 6164  ide the old Load
+00065310: 6572 206e 616d 6520 7769 7468 2074 6869  er name with thi
+00065320: 7320 7261 7468 6572 2067 656e 6572 6963  s rather generic
+00065330: 2027 466f 6375 734c 6f61 6465 7227 0d0a   'FocusLoader'..
+00065340: 0d0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
+00065350: 662e 7369 7465 2069 7320 6e6f 7420 4e6f  f.site is not No
+00065360: 6e65 3a0d 0a20 2020 2020 2020 2020 2020  ne:..           
+00065370: 206c 6f67 6769 6e67 5f71 7565 7565 203d   logging_queue =
+00065380: 2073 656c 662e 7369 7465 2e6c 6f67 6769   self.site.loggi
+00065390: 6e67 5f71 7565 7565 0d0a 2020 2020 2020  ng_queue..      
+000653a0: 2020 2020 2020 656d 706f 7765 725f 696d        empower_im
+000653b0: 706f 7274 6572 5f65 7865 6375 7461 626c  porter_executabl
+000653c0: 6520 3d20 7365 6c66 2e73 6974 652e 656d  e = self.site.em
+000653d0: 706f 7765 725f 696d 706f 7274 6572 5f65  power_importer_e
+000653e0: 7865 6375 7461 626c 650d 0a20 2020 2020  xecutable..     
+000653f0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00065400: 2020 2020 2020 6c6f 6767 696e 675f 7175        logging_qu
+00065410: 6575 6520 3d20 4e6f 6e65 0d0a 2020 2020  eue = None..    
+00065420: 2020 2020 2020 2020 656d 706f 7765 725f          empower_
+00065430: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
+00065440: 626c 6520 3d20 6c6c 752e 454d 504f 5745  ble = llu.EMPOWE
+00065450: 525f 494d 504f 5254 4552 5f45 5845 4355  R_IMPORTER_EXECU
+00065460: 5441 424c 450d 0a0d 0a20 2020 2020 2020  TABLE....       
+00065470: 2073 7570 6572 2846 6f63 7573 4c6f 6164   super(FocusLoad
+00065480: 6572 2c20 7365 6c66 292e 5f5f 696e 6974  er, self).__init
+00065490: 5f5f 2873 6f75 7263 653d 7365 6c66 2e5f  __(source=self._
+000654a0: 696e 6974 6961 6c5f 736f 7572 6365 0d0a  initial_source..
+000654b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000654c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000654d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000654e0: 2020 2020 2020 202c 6c6f 6767 696e 675f         ,logging_
-000654f0: 7175 6575 653d 6c6f 6767 696e 675f 7175  queue=logging_qu
-00065500: 6575 650d 0a20 2020 2020 2020 2020 2020  eue..           
-00065510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065520: 2020 2020 2020 2020 2020 2020 2020 2c64                ,d
-00065530: 656c 7461 3d46 616c 7365 0d0a 2020 2020  elta=False..    
+000654d0: 2020 2020 2020 2020 202c 7369 7465 3d73           ,site=s
+000654e0: 656c 662e 7369 7465 0d0a 2020 2020 2020  elf.site..      
+000654f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065510: 2020 202c 6c6f 6767 696e 675f 7175 6575     ,logging_queu
+00065520: 653d 6c6f 6767 696e 675f 7175 6575 650d  e=logging_queue.
+00065530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00065540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065560: 2020 2020 202c 6964 656e 7469 6669 6572       ,identifier
-00065570: 5f63 6f6c 756d 6e73 3d69 6465 6e74 6966  _columns=identif
-00065580: 6965 725f 636f 6c75 6d6e 730d 0a20 2020  ier_columns..   
-00065590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000655a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000655b0: 2020 2020 2020 2c6e 616d 653d 2746 6f63        ,name='Foc
-000655c0: 7573 4c6f 6164 6572 270d 0a20 2020 2020  usLoader'..     
+00065550: 2020 2020 2020 2020 2020 2c64 656c 7461            ,delta
+00065560: 3d46 616c 7365 0d0a 2020 2020 2020 2020  =False..        
+00065570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065590: 202c 6964 656e 7469 6669 6572 5f63 6f6c   ,identifier_col
+000655a0: 756d 6e73 3d69 6465 6e74 6966 6965 725f  umns=identifier_
+000655b0: 636f 6c75 6d6e 730d 0a20 2020 2020 2020  columns..       
+000655c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000655d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000655e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000655f0: 2020 2020 2c73 6166 655f 6c6f 6164 3d73      ,safe_load=s
-00065600: 6166 655f 6c6f 6164 0d0a 2020 2020 2020  afe_load..      
+000655e0: 2020 2c6e 616d 653d 2746 6f63 7573 4c6f    ,name='FocusLo
+000655f0: 6164 6572 270d 0a20 2020 2020 2020 2020  ader'..         
+00065600: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00065610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065630: 2020 202c 656d 706f 7765 725f 7065 7269     ,empower_peri
-00065640: 6f64 5f74 7970 653d 6c6c 752e 454d 504f  od_type=llu.EMPO
-00065650: 5745 525f 4d4f 4e54 485f 434f 4e53 5441  WER_MONTH_CONSTA
-00065660: 4e54 2023 2054 6869 7320 7769 6c6c 2062  NT # This will b
-00065670: 6520 6f76 6572 7269 6464 656e 2062 7920  e overridden by 
-00065680: 7468 6520 696e 6665 7272 6564 2065 6d70  the inferred emp
-00065690: 6f77 6572 5f70 6572 696f 645f 7479 7065  ower_period_type
-000656a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000656b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000656c0: 2020 2020 2020 2020 2020 202c 656d 706f             ,empo
-000656d0: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
-000656e0: 6375 7461 626c 653d 656d 706f 7765 725f  cutable=empower_
-000656f0: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
-00065700: 626c 6529 0d0a 0d0a 2020 2020 2020 2020  ble)....        
-00065710: 2363 6865 636b 2074 6861 7420 6576 6572  #check that ever
-00065720: 7974 6869 6e67 2077 6974 6820 6120 6d61  ything with a ma
-00065730: 7070 696e 6720 6861 7320 7468 6520 6e65  pping has the ne
-00065740: 6365 7373 6172 7920 7072 6572 6571 7569  cessary prerequi
-00065750: 7369 7465 732c 206f 7220 7261 6973 6520  sites, or raise 
-00065760: 6120 4c6f 6164 6572 5365 7475 7045 7272  a LoaderSetupErr
-00065770: 6f72 0d0a 2020 2020 2020 2020 2354 6869  or..        #Thi
-00065780: 7320 7769 6c6c 2063 6174 6368 2075 6e69  s will catch uni
-00065790: 6d70 6c65 6d65 6e74 6564 2075 7365 2063  mplemented use c
-000657a0: 6173 6573 206e 6963 6520 616e 6420 6561  ases nice and ea
-000657b0: 726c 790d 0a0d 0a0d 0a20 2020 2020 2020  rly......       
-000657c0: 2020 2020 200d 0a20 2020 2020 2020 2073       ..        s
-000657d0: 656c 662e 5f64 6566 6572 5f6d 6170 7065  elf._defer_mappe
-000657e0: 725f 6372 6561 7469 6f6e 203d 205f 6465  r_creation = _de
-000657f0: 6665 725f 6d61 7070 6572 5f63 7265 6174  fer_mapper_creat
-00065800: 696f 6e0d 0a20 2020 2020 2020 2069 6620  ion..        if 
-00065810: 6e6f 7420 7365 6c66 2e5f 6465 6665 725f  not self._defer_
-00065820: 6d61 7070 6572 5f63 7265 6174 696f 6e3a  mapper_creation:
-00065830: 0d0a 2020 2020 2020 2020 2020 2020 7365  ..            se
-00065840: 6c66 2e5f 6d61 7070 696e 6773 2e5f 6372  lf._mappings._cr
-00065850: 6561 7465 5f54 6162 6c65 4d61 7070 6572  eate_TableMapper
-00065860: 7328 290d 0a0d 0a0d 0a20 2020 2064 6566  s()......    def
-00065870: 206c 6f61 6428 7365 6c66 293a 0d0a 2020   load(self):..  
-00065880: 2020 2020 2020 2727 270d 0a20 2020 2020        '''..     
-00065890: 2020 202e 6c6f 6164 2829 2064 6f65 7320     .load() does 
-000658a0: 2e64 656c 6574 655f 7461 7267 6574 5f64  .delete_target_d
-000658b0: 6174 6128 292c 202e 6578 706c 6f64 6528  ata(), .explode(
-000658c0: 292c 202e 7368 6172 6428 2920 616e 6420  ), .shard() and 
-000658d0: 2e6c 6f61 645f 7368 6172 6473 2829 0d0a  .load_shards()..
-000658e0: 2020 2020 2020 2020 2727 270d 0a0d 0a20          '''.... 
-000658f0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00065900: 6465 6665 725f 6d61 7070 6572 5f63 7265  defer_mapper_cre
-00065910: 6174 696f 6e3a 0d0a 2020 2020 2020 2020  ation:..        
-00065920: 2020 2020 7365 6c66 2e5f 6d61 7070 696e      self._mappin
-00065930: 6773 2e5f 6372 6561 7465 5f54 6162 6c65  gs._create_Table
-00065940: 4d61 7070 6572 7328 290d 0a0d 0a20 2020  Mappers()....   
-00065950: 2020 2020 2073 656c 662e 6465 6c65 7465       self.delete
-00065960: 5f74 6172 6765 745f 6461 7461 2829 0d0a  _target_data()..
-00065970: 0d0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-00065980: 6e73 7461 6e63 6528 7365 6c66 2e5f 6d61  nstance(self._ma
-00065990: 7070 696e 6773 2e5f 7469 6d65 5f6d 6170  ppings._time_map
-000659a0: 7065 722c 2043 6f6e 7374 616e 7429 3a0d  per, Constant):.
-000659b0: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
-000659c0: 655f 6d61 7070 696e 6720 3d20 7365 6c66  e_mapping = self
-000659d0: 2e5f 6d61 7070 696e 6773 2e5f 7469 6d65  ._mappings._time
-000659e0: 5f6d 6170 7065 722e 636f 6e73 7461 6e74  _mapper.constant
-000659f0: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-00065a00: 0a20 2020 2020 2020 2020 2020 2074 696d  .            tim
-00065a10: 655f 6d61 7070 696e 6720 3d20 7365 6c66  e_mapping = self
-00065a20: 2e5f 6d61 7070 696e 6773 2e5f 7469 6d65  ._mappings._time
-00065a30: 5f6d 6170 7065 720d 0a0d 0a20 2020 2020  _mapper....     
-00065a40: 2020 2023 544f 444f 202d 2064 6566 6572     #TODO - defer
-00065a50: 2074 6869 7320 746f 2062 6173 6520 616e   this to base an
-00065a60: 6420 6861 7665 2074 6869 7320 636c 6173  d have this clas
-00065a70: 7320 646f 2074 6865 2077 6f72 6b20 6f66  s do the work of
-00065a80: 2073 6574 7469 6e67 2074 6865 2070 6172   setting the par
-00065a90: 616d 6574 6572 7320 696e 2061 2073 696d  ameters in a sim
-00065aa0: 706c 6520 2e65 7870 6c6f 6465 2829 2063  ple .explode() c
-00065ab0: 616c 6c20 756e 6465 7220 7468 6520 636f  all under the co
-00065ac0: 7665 7273 0d0a 2020 2020 2020 2020 7365  vers..        se
-00065ad0: 6c66 2e65 7870 6c6f 6465 2864 696d 656e  lf.explode(dimen
-00065ae0: 7369 6f6e 5f30 2020 2020 2020 2020 203d  sion_0         =
-00065af0: 2073 656c 662e 5f6d 6170 7069 6e67 732e   self._mappings.
-00065b00: 5f64 696d 656e 7369 6f6e 5f30 5f6d 6170  _dimension_0_map
-00065b10: 7065 720d 0a20 2020 2020 2020 2020 2020  per..           
-00065b20: 2020 2020 2020 2020 202c 6469 6d65 6e73           ,dimens
-00065b30: 696f 6e5f 3120 2020 2020 2020 2020 3d20  ion_1         = 
-00065b40: 7365 6c66 2e5f 6d61 7070 696e 6773 2e5f  self._mappings._
-00065b50: 6469 6d65 6e73 696f 6e5f 315f 6d61 7070  dimension_1_mapp
-00065b60: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
-00065b70: 2020 2020 2020 2020 2c64 696d 656e 7369          ,dimensi
-00065b80: 6f6e 5f32 2020 2020 2020 2020 203d 2073  on_2         = s
-00065b90: 656c 662e 5f6d 6170 7069 6e67 732e 5f64  elf._mappings._d
-00065ba0: 696d 656e 7369 6f6e 5f32 5f6d 6170 7065  imension_2_mappe
-00065bb0: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
-00065bc0: 2020 2020 2020 202c 6469 6d65 6e73 696f         ,dimensio
-00065bd0: 6e5f 3320 2020 2020 2020 2020 3d20 7365  n_3         = se
-00065be0: 6c66 2e5f 6d61 7070 696e 6773 2e5f 6469  lf._mappings._di
-00065bf0: 6d65 6e73 696f 6e5f 335f 6d61 7070 6572  mension_3_mapper
-00065c00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00065c10: 2020 2020 2020 2c64 696d 656e 7369 6f6e        ,dimension
-00065c20: 5f34 2020 2020 2020 2020 203d 2073 656c  _4         = sel
-00065c30: 662e 5f6d 6170 7069 6e67 732e 5f64 696d  f._mappings._dim
-00065c40: 656e 7369 6f6e 5f34 5f6d 6170 7065 720d  ension_4_mapper.
-00065c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00065c60: 2020 2020 202c 6469 6d65 6e73 696f 6e5f       ,dimension_
-00065c70: 3520 2020 2020 2020 2020 3d20 7365 6c66  5         = self
-00065c80: 2e5f 6d61 7070 696e 6773 2e5f 6469 6d65  ._mappings._dime
-00065c90: 6e73 696f 6e5f 355f 6d61 7070 6572 0d0a  nsion_5_mapper..
-00065ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065cb0: 2020 2020 2c64 696d 656e 7369 6f6e 5f36      ,dimension_6
-00065cc0: 2020 2020 2020 2020 203d 2073 656c 662e           = self.
-00065cd0: 5f6d 6170 7069 6e67 732e 5f64 696d 656e  _mappings._dimen
-00065ce0: 7369 6f6e 5f36 5f6d 6170 7065 720d 0a20  sion_6_mapper.. 
-00065cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065d00: 2020 202c 6469 6d65 6e73 696f 6e5f 3720     ,dimension_7 
-00065d10: 2020 2020 2020 2020 3d20 7365 6c66 2e5f          = self._
-00065d20: 6d61 7070 696e 6773 2e5f 6469 6d65 6e73  mappings._dimens
-00065d30: 696f 6e5f 375f 6d61 7070 6572 0d0a 2020  ion_7_mapper..  
-00065d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065d50: 2020 2c6d 6f64 6520 2020 2020 2020 2020    ,mode         
-00065d60: 2020 2020 2020 203d 2073 656c 662e 5f6d         = self._m
-00065d70: 6170 7069 6e67 732e 5f6d 6f64 655f 6d61  appings._mode_ma
-00065d80: 7070 6572 0d0a 2020 2020 2020 2020 2020  pper..          
-00065d90: 2020 2020 2020 2020 2020 2c62 6173 6520            ,base 
-00065da0: 2020 2020 2020 2020 2020 2020 2020 203d                 =
-00065db0: 2073 656c 662e 5f6d 6170 7069 6e67 732e   self._mappings.
-00065dc0: 5f62 6173 655f 6d61 7070 6572 0d0a 2020  _base_mapper..  
-00065dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00065de0: 2020 2c74 696d 6520 2020 2020 2020 2020    ,time         
-00065df0: 2020 2020 2020 203d 2074 696d 655f 6d61         = time_ma
-00065e00: 7070 696e 670d 0a20 2020 2020 2020 2020  pping..         
-00065e10: 2020 2020 2020 2020 2020 202c 6d65 7472             ,metr
-00065e20: 6963 2020 2020 2020 2020 2020 2020 2020  ic              
-00065e30: 3d20 7365 6c66 2e5f 6d61 7070 696e 6773  = self._mappings
-00065e40: 2e5f 6d65 7472 6963 5f6d 6170 7065 720d  ._metric_mapper.
-00065e50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00065e60: 2020 2020 2023 2c76 616c 7565 2020 2020       #,value    
-00065e70: 2020 2020 2020 2020 2020 2020 203d 204e               = N
-00065e80: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
-00065e90: 2020 2020 2020 2020 202c 7375 626c 6f61           ,subloa
-00065ea0: 645f 6e61 6d65 2020 2020 2020 2020 3d20  d_name        = 
-00065eb0: 7365 6c66 2e74 6172 6765 742e 7669 6577  self.target.view
-00065ec0: 706f 696e 742e 7368 6f72 746e 616d 650d  point.shortname.
-00065ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00065ee0: 2020 2020 202c 656d 706f 7765 725f 7065       ,empower_pe
-00065ef0: 7269 6f64 5f74 7970 6520 3d20 7365 6c66  riod_type = self
-00065f00: 2e5f 6d61 7070 696e 6773 2e5f 656d 706f  ._mappings._empo
-00065f10: 7765 725f 7065 7269 6f64 5f74 7970 650d  wer_period_type.
-00065f20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00065f30: 2020 2020 202c 6967 6e6f 7265 5f7a 6572       ,ignore_zer
-00065f40: 6f5f 7661 6c75 6573 2020 3d20 7365 6c66  o_values  = self
-00065f50: 2e5f 6967 6e6f 7265 5f7a 6572 6f5f 7661  ._ignore_zero_va
-00065f60: 6c75 6573 0d0a 2020 2020 2020 2020 2020  lues..          
-00065f70: 2020 2020 2020 2020 2020 2c73 6f75 7263            ,sourc
-00065f80: 655f 6461 7461 6672 616d 6520 2020 203d  e_dataframe    =
-00065f90: 2073 656c 662e 5f69 6e69 7469 616c 5f73   self._initial_s
-00065fa0: 6f75 7263 650d 0a20 2020 2020 2020 2020  ource..         
-00065fb0: 2020 2020 2020 2020 2020 2029 0d0a 0d0a             )....
-00065fc0: 2020 2020 2020 2020 7365 6c66 2e73 6861          self.sha
-00065fd0: 7264 2829 0d0a 0d0a 2020 2020 2020 2020  rd()....        
-00065fe0: 7365 6c66 2e6c 6f61 645f 7368 6172 6473  self.load_shards
-00065ff0: 2829 0d0a 0d0a 0d0a 2020 2020 4070 726f  ()......    @pro
-00066000: 7065 7274 790d 0a20 2020 2064 6566 206d  perty..    def m
-00066010: 6170 7069 6e67 7328 7365 6c66 293a 0d0a  appings(self):..
-00066020: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00066030: 656c 662e 5f6d 6170 7069 6e67 730d 0a0d  elf._mappings...
-00066040: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
-00066050: 0d0a 2020 2020 6465 6620 7369 7465 2873  ..    def site(s
-00066060: 656c 6629 3a0d 0a20 2020 2020 2020 2069  elf):..        i
-00066070: 6620 7365 6c66 2e74 6172 6765 7420 6973  f self.target is
-00066080: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00066090: 2020 2020 7265 7475 726e 204e 6f6e 650d      return None.
-000660a0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-000660b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000660c0: 726e 2073 656c 662e 7461 7267 6574 2e76  rn self.target.v
-000660d0: 6965 7770 6f69 6e74 2e73 6974 650d 0a0d  iewpoint.site...
-000660e0: 0a20 2020 2023 4070 726f 7065 7274 790d  .    #@property.
-000660f0: 0a20 2020 2023 6465 6620 7369 7465 2873  .    #def site(s
-00066100: 656c 6629 3a0d 0a20 2020 2023 2020 2020  elf):..    #    
-00066110: 7365 6c66 2e5f 696e 6974 6961 6c5f 7461  self._initial_ta
-00066120: 7267 6574 2e73 6974 650d 0a0d 0a20 2020  rget.site....   
-00066130: 2040 7072 6f70 6572 7479 0d0a 2020 2020   @property..    
-00066140: 2354 4f44 4f20 2d20 6d61 6e69 7075 6c61  #TODO - manipula
-00066150: 7465 2046 6f63 7573 2074 6f20 696e 636c  te Focus to incl
-00066160: 7564 6520 6669 6c74 6572 7320 6265 666f  ude filters befo
-00066170: 7265 2072 6574 7572 6e69 6e67 2069 740d  re returning it.
-00066180: 0a20 2020 2064 6566 2074 6172 6765 7428  .    def target(
-00066190: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-000661a0: 6966 2073 656c 662e 5f69 6e69 7469 616c  if self._initial
-000661b0: 5f74 6172 6765 7420 6973 204e 6f6e 653a  _target is None:
-000661c0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-000661d0: 7475 726e 204e 6f6e 650d 0a20 2020 2020  turn None..     
-000661e0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-000661f0: 6365 2873 656c 662e 5f69 6e69 7469 616c  ce(self._initial
-00066200: 5f74 6172 6765 742c 5669 6577 706f 696e  _target,Viewpoin
-00066210: 7429 3a0d 0a20 2020 2020 2020 2020 2020  t):..           
-00066220: 2072 6574 7572 6e20 466f 6375 7328 7365   return Focus(se
-00066230: 6c66 2e5f 696e 6974 6961 6c5f 7461 7267  lf._initial_targ
-00066240: 6574 290d 0a20 2020 2020 2020 2065 6c69  et)..        eli
-00066250: 6620 6973 696e 7374 616e 6365 2873 656c  f isinstance(sel
-00066260: 662e 5f69 6e69 7469 616c 5f74 6172 6765  f._initial_targe
-00066270: 742c 466f 6375 7329 3a0d 0a20 2020 2020  t,Focus):..     
-00066280: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00066290: 6c66 2e5f 696e 6974 6961 6c5f 7461 7267  lf._initial_targ
-000662a0: 6574 0d0a 2020 2020 2020 2020 656c 7365  et..        else
-000662b0: 3a0d 0a20 2020 2020 2020 2020 2020 2072  :..            r
-000662c0: 6169 7365 2054 7970 6545 7272 6f72 2827  aise TypeError('
-000662d0: 466f 6375 734c 6f61 6465 722e 7461 7267  FocusLoader.targ
-000662e0: 6574 2073 686f 756c 6420 6265 2061 2056  et should be a V
-000662f0: 6965 7770 6f69 6e74 206f 7220 466f 6375  iewpoint or Focu
-00066300: 732c 2062 7574 2077 6173 2069 6e20 6661  s, but was in fa
-00066310: 6374 3a20 7b7d 272e 666f 726d 6174 2872  ct: {}'.format(r
-00066320: 6570 7228 7365 6c66 2e5f 696e 6974 6961  epr(self._initia
-00066330: 6c5f 7461 7267 6574 2929 290d 0a0d 0a20  l_target))).... 
-00066340: 2020 2064 6566 205f 7369 6e67 6c65 5f64     def _single_d
-00066350: 696d 656e 7369 6f6e 5f66 6f63 7573 5f73  imension_focus_s
-00066360: 7472 696e 676c 6574 2873 656c 662c 6469  tringlet(self,di
-00066370: 6d65 6e73 696f 6e5f 696e 6465 7829 3a0d  mension_index):.
-00066380: 0a0d 0a20 2020 2020 2020 2072 2731 3d23  ...        r'1=#
-00066390: 3723 2331 2332 3b27 0d0a 0d0a 0d0a 2020  7##1#2;'......  
-000663a0: 2020 2020 2020 2334 2064 6f74 7469 6e65        #4 dottine
-000663b0: 7373 2069 7320 6375 7374 6f6d 2c20 656c  ss is custom, el
-000663c0: 656d 656e 7473 2061 7265 2073 6570 6172  ements are separ
-000663d0: 6174 6564 2062 7920 7370 6163 6573 0d0a  ated by spaces..
-000663e0: 2020 2020 2020 2020 2365 2e67 2e0d 0a20          #e.g... 
-000663f0: 2020 2020 2020 2023 3132 3d23 3423 2331         #12=#4##1
-00066400: 2331 3738 2031 3739 2031 3830 3b0d 0a20  #178 179 180;.. 
-00066410: 2020 2020 2020 2023 4a41 4e31 3120 3137         #JAN11 17
-00066420: 380d 0a20 2020 2020 2020 2023 4645 4231  8..        #FEB1
-00066430: 3120 3137 390d 0a20 2020 2020 2020 2023  1 179..        #
-00066440: 4d41 5231 3120 3138 300d 0a20 2020 2020  MAR11 180..     
-00066450: 2020 2069 6620 6469 6d65 6e73 696f 6e5f     if dimension_
-00066460: 696e 6465 7820 3c3d 2037 3a0d 0a0d 0a20  index <= 7:.... 
-00066470: 2020 2020 2020 2020 2020 2065 6666 6563             effec
-00066480: 7469 7665 5f65 6c65 6d65 6e74 7320 3d20  tive_elements = 
-00066490: 7365 6c66 2e5f 6d61 7070 696e 6773 2e65  self._mappings.e
-000664a0: 6666 6563 7469 7665 5f75 6e69 745f 6469  ffective_unit_di
-000664b0: 6d65 6e73 696f 6e5f 656c 656d 656e 7473  mension_elements
-000664c0: 2864 696d 656e 7369 6f6e 5f69 6e64 6578  (dimension_index
-000664d0: 3d64 696d 656e 7369 6f6e 5f69 6e64 6578  =dimension_index
-000664e0: 290d 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-000664f0: 6469 6d65 6e73 696f 6e5f 696e 6465 7820  dimension_index 
-00066500: 3d3d 2038 3a0d 0a20 2020 2020 2020 2020  == 8:..         
-00066510: 2020 2065 6666 6563 7469 7665 5f65 6c65     effective_ele
-00066520: 6d65 6e74 7320 3d20 7365 6c66 2e5f 6d61  ments = self._ma
-00066530: 7070 696e 6773 2e65 6666 6563 7469 7665  ppings.effective
-00066540: 5f69 6e64 6963 6174 6f72 5f65 6c65 6d65  _indicator_eleme
-00066550: 6e74 730d 0a20 2020 2020 2020 2065 6c69  nts..        eli
-00066560: 6620 6469 6d65 6e73 696f 6e5f 696e 6465  f dimension_inde
-00066570: 7820 3d3d 2039 3a0d 0a20 2020 2020 2020  x == 9:..       
-00066580: 2020 2020 2065 6666 6563 7469 7665 5f65       effective_e
-00066590: 6c65 6d65 6e74 7320 3d20 7365 6c66 2e5f  lements = self._
-000665a0: 6d61 7070 696e 6773 2e65 6666 6563 7469  mappings.effecti
-000665b0: 7665 5f63 6f6d 7061 7269 736f 6e5f 656c  ve_comparison_el
-000665c0: 656d 656e 7473 0d0a 2020 2020 2020 2020  ements..        
-000665d0: 656c 6966 2064 696d 656e 7369 6f6e 5f69  elif dimension_i
-000665e0: 6e64 6578 203d 3d20 3130 3a0d 0a20 2020  ndex == 10:..   
-000665f0: 2020 2020 2020 2020 2065 6666 6563 7469           effecti
-00066600: 7665 5f65 6c65 6d65 6e74 7320 3d20 7365  ve_elements = se
-00066610: 6c66 2e5f 6d61 7070 696e 6773 2e65 6666  lf._mappings.eff
-00066620: 6563 7469 7665 5f63 7572 7265 6e63 795f  ective_currency_
-00066630: 656c 656d 656e 7473 0d0a 2020 2020 2020  elements..      
-00066640: 2020 656c 6966 2064 696d 656e 7369 6f6e    elif dimension
-00066650: 5f69 6e64 6578 203d 3d20 3131 3a0d 0a20  _index == 11:.. 
-00066660: 2020 2020 2020 2020 2020 2065 6666 6563             effec
-00066670: 7469 7665 5f65 6c65 6d65 6e74 7320 3d20  tive_elements = 
-00066680: 7365 6c66 2e5f 6d61 7070 696e 6773 2e65  self._mappings.e
-00066690: 6666 6563 7469 7665 5f74 696d 655f 656c  ffective_time_el
-000666a0: 656d 656e 7473 0d0a 2020 2020 2020 2020  ements..        
-000666b0: 656c 6966 2064 696d 656e 7369 6f6e 5f69  elif dimension_i
-000666c0: 6e64 6578 203d 3d20 3132 3a0d 0a20 2020  ndex == 12:..   
-000666d0: 2020 2020 2020 2020 2065 6666 6563 7469           effecti
-000666e0: 7665 5f65 6c65 6d65 6e74 7320 3d20 7365  ve_elements = se
-000666f0: 6c66 2e5f 6d61 7070 696e 6773 2e65 6666  lf._mappings.eff
-00066700: 6563 7469 7665 5f74 7261 6e73 666f 726d  ective_transform
-00066710: 5f65 6c65 6d65 6e74 730d 0a0d 0a20 2020  _elements....   
-00066720: 2020 2020 2023 5765 206e 6565 6420 7468       #We need th
-00066730: 6520 706f 7369 7469 6f6e 2072 656c 6174  e position relat
-00066740: 6976 6520 746f 2074 6865 2069 6e69 7469  ive to the initi
-00066750: 616c 2074 6172 6765 7420 696e 2074 6865  al target in the
-00066760: 2053 7472 7563 7475 7265 0d0a 2020 2020   Structure..    
-00066770: 2020 2020 7374 7275 6374 7572 6520 3d20      structure = 
-00066780: 7365 6c66 2e5f 696e 6974 6961 6c5f 7461  self._initial_ta
-00066790: 7267 6574 2e73 7472 7563 7475 7265 735b  rget.structures[
-000667a0: 6469 6d65 6e73 696f 6e5f 696e 6465 785d  dimension_index]
-000667b0: 0d0a 0d0a 2020 2020 2020 2020 6669 7273  ....        firs
-000667c0: 745f 6566 6665 6374 6976 655f 656c 656d  t_effective_elem
-000667d0: 656e 7420 3d20 6566 6665 6374 6976 655f  ent = effective_
-000667e0: 656c 656d 656e 7473 5b30 5d0d 0a0d 0a20  elements[0].... 
-000667f0: 2020 2020 2020 2069 6620 6c65 6e28 6566         if len(ef
-00066800: 6665 6374 6976 655f 656c 656d 656e 7473  fective_elements
-00066810: 2920 3e20 313a 0d0a 2020 2020 2020 2020  ) > 1:..        
-00066820: 2020 2020 2350 7265 7474 7920 626c 756e      #Pretty blun
-00066830: 7420 2d20 6275 7420 4920 7468 696e 6b20  t - but I think 
-00066840: 6974 2077 6f72 6b73 202d 2069 6620 7468  it works - if th
-00066850: 6572 6520 6973 206d 6f72 6520 7468 616e  ere is more than
-00066860: 2031 2065 6666 6563 7469 7665 2065 6c65   1 effective ele
-00066870: 6d65 6e74 2c20 7468 656e 206d 7573 7420  ment, then must 
-00066880: 6265 2034 2027 6375 7374 6f6d 2720 283f  be 4 'custom' (?
-00066890: 290d 0a20 2020 2020 2020 2020 2020 2064  )..            d
-000668a0: 6f74 7469 6e65 7373 5f6e 756d 6265 7220  ottiness_number 
-000668b0: 3d20 340d 0a20 2020 2020 2020 2065 6c73  = 4..        els
-000668c0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-000668d0: 6966 206c 656e 2866 6972 7374 5f65 6666  if len(first_eff
-000668e0: 6563 7469 7665 5f65 6c65 6d65 6e74 2e63  ective_element.c
-000668f0: 6869 6c64 7265 6e29 203e 2030 3a0d 0a0d  hildren) > 0:...
-00066900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00066910: 2069 6620 6669 7273 745f 6566 6665 6374   if first_effect
-00066920: 6976 655f 656c 656d 656e 742e 6772 6f75  ive_element.grou
-00066930: 705f 6f6e 6c79 203d 3d20 2747 726f 7570  p_only == 'Group
-00066940: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-00066950: 2020 2020 2020 2020 2344 6f74 7469 6e65          #Dottine
-00066960: 7373 2036 2069 7320 616c 6c20 6368 696c  ss 6 is all chil
-00066970: 6472 656e 0d0a 2020 2020 2020 2020 2020  dren..          
-00066980: 2020 2020 2020 2020 2020 646f 7474 696e            dottin
-00066990: 6573 735f 6e75 6d62 6572 203d 2036 0d0a  ess_number = 6..
+00065620: 2c73 6166 655f 6c6f 6164 3d73 6166 655f  ,safe_load=safe_
+00065630: 6c6f 6164 0d0a 2020 2020 2020 2020 2020  load..          
+00065640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065650: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+00065660: 656d 706f 7765 725f 7065 7269 6f64 5f74  empower_period_t
+00065670: 7970 653d 6c6c 752e 454d 504f 5745 525f  ype=llu.EMPOWER_
+00065680: 4d4f 4e54 485f 434f 4e53 5441 4e54 2023  MONTH_CONSTANT #
+00065690: 2054 6869 7320 7769 6c6c 2062 6520 6f76   This will be ov
+000656a0: 6572 7269 6464 656e 2062 7920 7468 6520  erridden by the 
+000656b0: 696e 6665 7272 6564 2065 6d70 6f77 6572  inferred empower
+000656c0: 5f70 6572 696f 645f 7479 7065 0d0a 2020  _period_type..  
+000656d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000656e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000656f0: 2020 2020 2020 202c 656d 706f 7765 725f         ,empower_
+00065700: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
+00065710: 626c 653d 656d 706f 7765 725f 696d 706f  ble=empower_impo
+00065720: 7274 6572 5f65 7865 6375 7461 626c 6529  rter_executable)
+00065730: 0d0a 0d0a 2020 2020 2020 2020 2363 6865  ....        #che
+00065740: 636b 2074 6861 7420 6576 6572 7974 6869  ck that everythi
+00065750: 6e67 2077 6974 6820 6120 6d61 7070 696e  ng with a mappin
+00065760: 6720 6861 7320 7468 6520 6e65 6365 7373  g has the necess
+00065770: 6172 7920 7072 6572 6571 7569 7369 7465  ary prerequisite
+00065780: 732c 206f 7220 7261 6973 6520 6120 4c6f  s, or raise a Lo
+00065790: 6164 6572 5365 7475 7045 7272 6f72 0d0a  aderSetupError..
+000657a0: 2020 2020 2020 2020 2354 6869 7320 7769          #This wi
+000657b0: 6c6c 2063 6174 6368 2075 6e69 6d70 6c65  ll catch unimple
+000657c0: 6d65 6e74 6564 2075 7365 2063 6173 6573  mented use cases
+000657d0: 206e 6963 6520 616e 6420 6561 726c 790d   nice and early.
+000657e0: 0a0d 0a0d 0a20 2020 2020 2020 2020 2020  .....           
+000657f0: 200d 0a20 2020 2020 2020 2073 656c 662e   ..        self.
+00065800: 5f64 6566 6572 5f6d 6170 7065 725f 6372  _defer_mapper_cr
+00065810: 6561 7469 6f6e 203d 205f 6465 6665 725f  eation = _defer_
+00065820: 6d61 7070 6572 5f63 7265 6174 696f 6e0d  mapper_creation.
+00065830: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00065840: 7365 6c66 2e5f 6465 6665 725f 6d61 7070  self._defer_mapp
+00065850: 6572 5f63 7265 6174 696f 6e3a 0d0a 2020  er_creation:..  
+00065860: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00065870: 6d61 7070 696e 6773 2e5f 6372 6561 7465  mappings._create
+00065880: 5f54 6162 6c65 4d61 7070 6572 7328 290d  _TableMappers().
+00065890: 0a0d 0a0d 0a20 2020 2064 6566 206c 6f61  .....    def loa
+000658a0: 6428 7365 6c66 293a 0d0a 2020 2020 2020  d(self):..      
+000658b0: 2020 2727 270d 0a20 2020 2020 2020 202e    '''..        .
+000658c0: 6c6f 6164 2829 2064 6f65 7320 2e64 656c  load() does .del
+000658d0: 6574 655f 7461 7267 6574 5f64 6174 6128  ete_target_data(
+000658e0: 292c 202e 6578 706c 6f64 6528 292c 202e  ), .explode(), .
+000658f0: 7368 6172 6428 2920 616e 6420 2e6c 6f61  shard() and .loa
+00065900: 645f 7368 6172 6473 2829 0d0a 2020 2020  d_shards()..    
+00065910: 2020 2020 2727 270d 0a0d 0a20 2020 2020      '''....     
+00065920: 2020 2069 6620 7365 6c66 2e5f 6465 6665     if self._defe
+00065930: 725f 6d61 7070 6572 5f63 7265 6174 696f  r_mapper_creatio
+00065940: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
+00065950: 7365 6c66 2e5f 6d61 7070 696e 6773 2e5f  self._mappings._
+00065960: 6372 6561 7465 5f54 6162 6c65 4d61 7070  create_TableMapp
+00065970: 6572 7328 290d 0a0d 0a20 2020 2020 2020  ers()....       
+00065980: 2073 656c 662e 6465 6c65 7465 5f74 6172   self.delete_tar
+00065990: 6765 745f 6461 7461 2829 0d0a 0d0a 2020  get_data()....  
+000659a0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+000659b0: 6e63 6528 7365 6c66 2e5f 6d61 7070 696e  nce(self._mappin
+000659c0: 6773 2e5f 7469 6d65 5f6d 6170 7065 722c  gs._time_mapper,
+000659d0: 2043 6f6e 7374 616e 7429 3a0d 0a20 2020   Constant):..   
+000659e0: 2020 2020 2020 2020 2074 696d 655f 6d61           time_ma
+000659f0: 7070 696e 6720 3d20 7365 6c66 2e5f 6d61  pping = self._ma
+00065a00: 7070 696e 6773 2e5f 7469 6d65 5f6d 6170  ppings._time_map
+00065a10: 7065 722e 636f 6e73 7461 6e74 0d0a 2020  per.constant..  
+00065a20: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+00065a30: 2020 2020 2020 2020 2074 696d 655f 6d61           time_ma
+00065a40: 7070 696e 6720 3d20 7365 6c66 2e5f 6d61  pping = self._ma
+00065a50: 7070 696e 6773 2e5f 7469 6d65 5f6d 6170  ppings._time_map
+00065a60: 7065 720d 0a0d 0a20 2020 2020 2020 2023  per....        #
+00065a70: 544f 444f 202d 2064 6566 6572 2074 6869  TODO - defer thi
+00065a80: 7320 746f 2062 6173 6520 616e 6420 6861  s to base and ha
+00065a90: 7665 2074 6869 7320 636c 6173 7320 646f  ve this class do
+00065aa0: 2074 6865 2077 6f72 6b20 6f66 2073 6574   the work of set
+00065ab0: 7469 6e67 2074 6865 2070 6172 616d 6574  ting the paramet
+00065ac0: 6572 7320 696e 2061 2073 696d 706c 6520  ers in a simple 
+00065ad0: 2e65 7870 6c6f 6465 2829 2063 616c 6c20  .explode() call 
+00065ae0: 756e 6465 7220 7468 6520 636f 7665 7273  under the covers
+00065af0: 0d0a 2020 2020 2020 2020 7365 6c66 2e65  ..        self.e
+00065b00: 7870 6c6f 6465 2864 696d 656e 7369 6f6e  xplode(dimension
+00065b10: 5f30 2020 2020 2020 2020 203d 2073 656c  _0         = sel
+00065b20: 662e 5f6d 6170 7069 6e67 732e 5f64 696d  f._mappings._dim
+00065b30: 656e 7369 6f6e 5f30 5f6d 6170 7065 720d  ension_0_mapper.
+00065b40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00065b50: 2020 2020 202c 6469 6d65 6e73 696f 6e5f       ,dimension_
+00065b60: 3120 2020 2020 2020 2020 3d20 7365 6c66  1         = self
+00065b70: 2e5f 6d61 7070 696e 6773 2e5f 6469 6d65  ._mappings._dime
+00065b80: 6e73 696f 6e5f 315f 6d61 7070 6572 0d0a  nsion_1_mapper..
+00065b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065ba0: 2020 2020 2c64 696d 656e 7369 6f6e 5f32      ,dimension_2
+00065bb0: 2020 2020 2020 2020 203d 2073 656c 662e           = self.
+00065bc0: 5f6d 6170 7069 6e67 732e 5f64 696d 656e  _mappings._dimen
+00065bd0: 7369 6f6e 5f32 5f6d 6170 7065 720d 0a20  sion_2_mapper.. 
+00065be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065bf0: 2020 202c 6469 6d65 6e73 696f 6e5f 3320     ,dimension_3 
+00065c00: 2020 2020 2020 2020 3d20 7365 6c66 2e5f          = self._
+00065c10: 6d61 7070 696e 6773 2e5f 6469 6d65 6e73  mappings._dimens
+00065c20: 696f 6e5f 335f 6d61 7070 6572 0d0a 2020  ion_3_mapper..  
+00065c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065c40: 2020 2c64 696d 656e 7369 6f6e 5f34 2020    ,dimension_4  
+00065c50: 2020 2020 2020 203d 2073 656c 662e 5f6d         = self._m
+00065c60: 6170 7069 6e67 732e 5f64 696d 656e 7369  appings._dimensi
+00065c70: 6f6e 5f34 5f6d 6170 7065 720d 0a20 2020  on_4_mapper..   
+00065c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065c90: 202c 6469 6d65 6e73 696f 6e5f 3520 2020   ,dimension_5   
+00065ca0: 2020 2020 2020 3d20 7365 6c66 2e5f 6d61        = self._ma
+00065cb0: 7070 696e 6773 2e5f 6469 6d65 6e73 696f  ppings._dimensio
+00065cc0: 6e5f 355f 6d61 7070 6572 0d0a 2020 2020  n_5_mapper..    
+00065cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065ce0: 2c64 696d 656e 7369 6f6e 5f36 2020 2020  ,dimension_6    
+00065cf0: 2020 2020 203d 2073 656c 662e 5f6d 6170       = self._map
+00065d00: 7069 6e67 732e 5f64 696d 656e 7369 6f6e  pings._dimension
+00065d10: 5f36 5f6d 6170 7065 720d 0a20 2020 2020  _6_mapper..     
+00065d20: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+00065d30: 6469 6d65 6e73 696f 6e5f 3720 2020 2020  dimension_7     
+00065d40: 2020 2020 3d20 7365 6c66 2e5f 6d61 7070      = self._mapp
+00065d50: 696e 6773 2e5f 6469 6d65 6e73 696f 6e5f  ings._dimension_
+00065d60: 375f 6d61 7070 6572 0d0a 2020 2020 2020  7_mapper..      
+00065d70: 2020 2020 2020 2020 2020 2020 2020 2c6d                ,m
+00065d80: 6f64 6520 2020 2020 2020 2020 2020 2020  ode             
+00065d90: 2020 203d 2073 656c 662e 5f6d 6170 7069     = self._mappi
+00065da0: 6e67 732e 5f6d 6f64 655f 6d61 7070 6572  ngs._mode_mapper
+00065db0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00065dc0: 2020 2020 2020 2c62 6173 6520 2020 2020        ,base     
+00065dd0: 2020 2020 2020 2020 2020 203d 2073 656c             = sel
+00065de0: 662e 5f6d 6170 7069 6e67 732e 5f62 6173  f._mappings._bas
+00065df0: 655f 6d61 7070 6572 0d0a 2020 2020 2020  e_mapper..      
+00065e00: 2020 2020 2020 2020 2020 2020 2020 2c74                ,t
+00065e10: 696d 6520 2020 2020 2020 2020 2020 2020  ime             
+00065e20: 2020 203d 2074 696d 655f 6d61 7070 696e     = time_mappin
+00065e30: 670d 0a20 2020 2020 2020 2020 2020 2020  g..             
+00065e40: 2020 2020 2020 202c 6d65 7472 6963 2020         ,metric  
+00065e50: 2020 2020 2020 2020 2020 2020 3d20 7365              = se
+00065e60: 6c66 2e5f 6d61 7070 696e 6773 2e5f 6d65  lf._mappings._me
+00065e70: 7472 6963 5f6d 6170 7065 720d 0a20 2020  tric_mapper..   
+00065e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065e90: 2023 2c76 616c 7565 2020 2020 2020 2020   #,value        
+00065ea0: 2020 2020 2020 2020 203d 204e 6f6e 650d           = None.
+00065eb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00065ec0: 2020 2020 202c 7375 626c 6f61 645f 6e61       ,subload_na
+00065ed0: 6d65 2020 2020 2020 2020 3d20 7365 6c66  me        = self
+00065ee0: 2e74 6172 6765 742e 7669 6577 706f 696e  .target.viewpoin
+00065ef0: 742e 7368 6f72 746e 616d 650d 0a20 2020  t.shortname..   
+00065f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065f10: 202c 656d 706f 7765 725f 7065 7269 6f64   ,empower_period
+00065f20: 5f74 7970 6520 3d20 7365 6c66 2e5f 6d61  _type = self._ma
+00065f30: 7070 696e 6773 2e5f 656d 706f 7765 725f  ppings._empower_
+00065f40: 7065 7269 6f64 5f74 7970 650d 0a20 2020  period_type..   
+00065f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00065f60: 202c 6967 6e6f 7265 5f7a 6572 6f5f 7661   ,ignore_zero_va
+00065f70: 6c75 6573 2020 3d20 7365 6c66 2e5f 6967  lues  = self._ig
+00065f80: 6e6f 7265 5f7a 6572 6f5f 7661 6c75 6573  nore_zero_values
+00065f90: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00065fa0: 2020 2020 2020 2c73 6f75 7263 655f 6461        ,source_da
+00065fb0: 7461 6672 616d 6520 2020 203d 2073 656c  taframe    = sel
+00065fc0: 662e 5f69 6e69 7469 616c 5f73 6f75 7263  f._initial_sourc
+00065fd0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00065fe0: 2020 2020 2020 2029 0d0a 0d0a 2020 2020         )....    
+00065ff0: 2020 2020 7365 6c66 2e73 6861 7264 2829      self.shard()
+00066000: 0d0a 0d0a 2020 2020 2020 2020 7365 6c66  ....        self
+00066010: 2e6c 6f61 645f 7368 6172 6473 2829 0d0a  .load_shards()..
+00066020: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+00066030: 790d 0a20 2020 2064 6566 206d 6170 7069  y..    def mappi
+00066040: 6e67 7328 7365 6c66 293a 0d0a 2020 2020  ngs(self):..    
+00066050: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00066060: 5f6d 6170 7069 6e67 730d 0a0d 0a0d 0a20  _mappings...... 
+00066070: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
+00066080: 2020 6465 6620 7369 7465 2873 656c 6629    def site(self)
+00066090: 3a0d 0a20 2020 2020 2020 2069 6620 7365  :..        if se
+000660a0: 6c66 2e74 6172 6765 7420 6973 204e 6f6e  lf.target is Non
+000660b0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+000660c0: 7265 7475 726e 204e 6f6e 650d 0a20 2020  return None..   
+000660d0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000660e0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000660f0: 656c 662e 7461 7267 6574 2e76 6965 7770  elf.target.viewp
+00066100: 6f69 6e74 2e73 6974 650d 0a0d 0a20 2020  oint.site....   
+00066110: 2023 4070 726f 7065 7274 790d 0a20 2020   #@property..   
+00066120: 2023 6465 6620 7369 7465 2873 656c 6629   #def site(self)
+00066130: 3a0d 0a20 2020 2023 2020 2020 7365 6c66  :..    #    self
+00066140: 2e5f 696e 6974 6961 6c5f 7461 7267 6574  ._initial_target
+00066150: 2e73 6974 650d 0a0d 0a20 2020 2040 7072  .site....    @pr
+00066160: 6f70 6572 7479 0d0a 2020 2020 2354 4f44  operty..    #TOD
+00066170: 4f20 2d20 6d61 6e69 7075 6c61 7465 2046  O - manipulate F
+00066180: 6f63 7573 2074 6f20 696e 636c 7564 6520  ocus to include 
+00066190: 6669 6c74 6572 7320 6265 666f 7265 2072  filters before r
+000661a0: 6574 7572 6e69 6e67 2069 740d 0a20 2020  eturning it..   
+000661b0: 2064 6566 2074 6172 6765 7428 7365 6c66   def target(self
+000661c0: 293a 0d0a 2020 2020 2020 2020 6966 2073  ):..        if s
+000661d0: 656c 662e 5f69 6e69 7469 616c 5f74 6172  elf._initial_tar
+000661e0: 6765 7420 6973 204e 6f6e 653a 0d0a 2020  get is None:..  
+000661f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00066200: 204e 6f6e 650d 0a20 2020 2020 2020 2065   None..        e
+00066210: 6c69 6620 6973 696e 7374 616e 6365 2873  lif isinstance(s
+00066220: 656c 662e 5f69 6e69 7469 616c 5f74 6172  elf._initial_tar
+00066230: 6765 742c 5669 6577 706f 696e 7429 3a0d  get,Viewpoint):.
+00066240: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00066250: 7572 6e20 466f 6375 7328 7365 6c66 2e5f  urn Focus(self._
+00066260: 696e 6974 6961 6c5f 7461 7267 6574 290d  initial_target).
+00066270: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+00066280: 696e 7374 616e 6365 2873 656c 662e 5f69  instance(self._i
+00066290: 6e69 7469 616c 5f74 6172 6765 742c 466f  nitial_target,Fo
+000662a0: 6375 7329 3a0d 0a20 2020 2020 2020 2020  cus):..         
+000662b0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+000662c0: 696e 6974 6961 6c5f 7461 7267 6574 0d0a  initial_target..
+000662d0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+000662e0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000662f0: 2054 7970 6545 7272 6f72 2827 466f 6375   TypeError('Focu
+00066300: 734c 6f61 6465 722e 7461 7267 6574 2073  sLoader.target s
+00066310: 686f 756c 6420 6265 2061 2056 6965 7770  hould be a Viewp
+00066320: 6f69 6e74 206f 7220 466f 6375 732c 2062  oint or Focus, b
+00066330: 7574 2077 6173 2069 6e20 6661 6374 3a20  ut was in fact: 
+00066340: 7b7d 272e 666f 726d 6174 2872 6570 7228  {}'.format(repr(
+00066350: 7365 6c66 2e5f 696e 6974 6961 6c5f 7461  self._initial_ta
+00066360: 7267 6574 2929 290d 0a0d 0a20 2020 2064  rget)))....    d
+00066370: 6566 205f 7369 6e67 6c65 5f64 696d 656e  ef _single_dimen
+00066380: 7369 6f6e 5f66 6f63 7573 5f73 7472 696e  sion_focus_strin
+00066390: 676c 6574 2873 656c 662c 6469 6d65 6e73  glet(self,dimens
+000663a0: 696f 6e5f 696e 6465 7829 3a0d 0a0d 0a20  ion_index):.... 
+000663b0: 2020 2020 2020 2072 2731 3d23 3723 2331         r'1=#7##1
+000663c0: 2332 3b27 0d0a 0d0a 0d0a 2020 2020 2020  #2;'......      
+000663d0: 2020 2334 2064 6f74 7469 6e65 7373 2069    #4 dottiness i
+000663e0: 7320 6375 7374 6f6d 2c20 656c 656d 656e  s custom, elemen
+000663f0: 7473 2061 7265 2073 6570 6172 6174 6564  ts are separated
+00066400: 2062 7920 7370 6163 6573 0d0a 2020 2020   by spaces..    
+00066410: 2020 2020 2365 2e67 2e0d 0a20 2020 2020      #e.g...     
+00066420: 2020 2023 3132 3d23 3423 2331 2331 3738     #12=#4##1#178
+00066430: 2031 3739 2031 3830 3b0d 0a20 2020 2020   179 180;..     
+00066440: 2020 2023 4a41 4e31 3120 3137 380d 0a20     #JAN11 178.. 
+00066450: 2020 2020 2020 2023 4645 4231 3120 3137         #FEB11 17
+00066460: 390d 0a20 2020 2020 2020 2023 4d41 5231  9..        #MAR1
+00066470: 3120 3138 300d 0a20 2020 2020 2020 2069  1 180..        i
+00066480: 6620 6469 6d65 6e73 696f 6e5f 696e 6465  f dimension_inde
+00066490: 7820 3c3d 2037 3a0d 0a0d 0a20 2020 2020  x <= 7:....     
+000664a0: 2020 2020 2020 2065 6666 6563 7469 7665         effective
+000664b0: 5f65 6c65 6d65 6e74 7320 3d20 7365 6c66  _elements = self
+000664c0: 2e5f 6d61 7070 696e 6773 2e65 6666 6563  ._mappings.effec
+000664d0: 7469 7665 5f75 6e69 745f 6469 6d65 6e73  tive_unit_dimens
+000664e0: 696f 6e5f 656c 656d 656e 7473 2864 696d  ion_elements(dim
+000664f0: 656e 7369 6f6e 5f69 6e64 6578 3d64 696d  ension_index=dim
+00066500: 656e 7369 6f6e 5f69 6e64 6578 290d 0a20  ension_index).. 
+00066510: 2020 2020 2020 2065 6c69 6620 6469 6d65         elif dime
+00066520: 6e73 696f 6e5f 696e 6465 7820 3d3d 2038  nsion_index == 8
+00066530: 3a0d 0a20 2020 2020 2020 2020 2020 2065  :..            e
+00066540: 6666 6563 7469 7665 5f65 6c65 6d65 6e74  ffective_element
+00066550: 7320 3d20 7365 6c66 2e5f 6d61 7070 696e  s = self._mappin
+00066560: 6773 2e65 6666 6563 7469 7665 5f69 6e64  gs.effective_ind
+00066570: 6963 6174 6f72 5f65 6c65 6d65 6e74 730d  icator_elements.
+00066580: 0a20 2020 2020 2020 2065 6c69 6620 6469  .        elif di
+00066590: 6d65 6e73 696f 6e5f 696e 6465 7820 3d3d  mension_index ==
+000665a0: 2039 3a0d 0a20 2020 2020 2020 2020 2020   9:..           
+000665b0: 2065 6666 6563 7469 7665 5f65 6c65 6d65   effective_eleme
+000665c0: 6e74 7320 3d20 7365 6c66 2e5f 6d61 7070  nts = self._mapp
+000665d0: 696e 6773 2e65 6666 6563 7469 7665 5f63  ings.effective_c
+000665e0: 6f6d 7061 7269 736f 6e5f 656c 656d 656e  omparison_elemen
+000665f0: 7473 0d0a 2020 2020 2020 2020 656c 6966  ts..        elif
+00066600: 2064 696d 656e 7369 6f6e 5f69 6e64 6578   dimension_index
+00066610: 203d 3d20 3130 3a0d 0a20 2020 2020 2020   == 10:..       
+00066620: 2020 2020 2065 6666 6563 7469 7665 5f65       effective_e
+00066630: 6c65 6d65 6e74 7320 3d20 7365 6c66 2e5f  lements = self._
+00066640: 6d61 7070 696e 6773 2e65 6666 6563 7469  mappings.effecti
+00066650: 7665 5f63 7572 7265 6e63 795f 656c 656d  ve_currency_elem
+00066660: 656e 7473 0d0a 2020 2020 2020 2020 656c  ents..        el
+00066670: 6966 2064 696d 656e 7369 6f6e 5f69 6e64  if dimension_ind
+00066680: 6578 203d 3d20 3131 3a0d 0a20 2020 2020  ex == 11:..     
+00066690: 2020 2020 2020 2065 6666 6563 7469 7665         effective
+000666a0: 5f65 6c65 6d65 6e74 7320 3d20 7365 6c66  _elements = self
+000666b0: 2e5f 6d61 7070 696e 6773 2e65 6666 6563  ._mappings.effec
+000666c0: 7469 7665 5f74 696d 655f 656c 656d 656e  tive_time_elemen
+000666d0: 7473 0d0a 2020 2020 2020 2020 656c 6966  ts..        elif
+000666e0: 2064 696d 656e 7369 6f6e 5f69 6e64 6578   dimension_index
+000666f0: 203d 3d20 3132 3a0d 0a20 2020 2020 2020   == 12:..       
+00066700: 2020 2020 2065 6666 6563 7469 7665 5f65       effective_e
+00066710: 6c65 6d65 6e74 7320 3d20 7365 6c66 2e5f  lements = self._
+00066720: 6d61 7070 696e 6773 2e65 6666 6563 7469  mappings.effecti
+00066730: 7665 5f74 7261 6e73 666f 726d 5f65 6c65  ve_transform_ele
+00066740: 6d65 6e74 730d 0a0d 0a20 2020 2020 2020  ments....       
+00066750: 2023 5765 206e 6565 6420 7468 6520 706f   #We need the po
+00066760: 7369 7469 6f6e 2072 656c 6174 6976 6520  sition relative 
+00066770: 746f 2074 6865 2069 6e69 7469 616c 2074  to the initial t
+00066780: 6172 6765 7420 696e 2074 6865 2053 7472  arget in the Str
+00066790: 7563 7475 7265 0d0a 2020 2020 2020 2020  ucture..        
+000667a0: 7374 7275 6374 7572 6520 3d20 7365 6c66  structure = self
+000667b0: 2e5f 696e 6974 6961 6c5f 7461 7267 6574  ._initial_target
+000667c0: 2e73 7472 7563 7475 7265 735b 6469 6d65  .structures[dime
+000667d0: 6e73 696f 6e5f 696e 6465 785d 0d0a 0d0a  nsion_index]....
+000667e0: 2020 2020 2020 2020 6669 7273 745f 6566          first_ef
+000667f0: 6665 6374 6976 655f 656c 656d 656e 7420  fective_element 
+00066800: 3d20 6566 6665 6374 6976 655f 656c 656d  = effective_elem
+00066810: 656e 7473 5b30 5d0d 0a0d 0a20 2020 2020  ents[0]....     
+00066820: 2020 2069 6620 6c65 6e28 6566 6665 6374     if len(effect
+00066830: 6976 655f 656c 656d 656e 7473 2920 3e20  ive_elements) > 
+00066840: 313a 0d0a 2020 2020 2020 2020 2020 2020  1:..            
+00066850: 2350 7265 7474 7920 626c 756e 7420 2d20  #Pretty blunt - 
+00066860: 6275 7420 4920 7468 696e 6b20 6974 2077  but I think it w
+00066870: 6f72 6b73 202d 2069 6620 7468 6572 6520  orks - if there 
+00066880: 6973 206d 6f72 6520 7468 616e 2031 2065  is more than 1 e
+00066890: 6666 6563 7469 7665 2065 6c65 6d65 6e74  ffective element
+000668a0: 2c20 7468 656e 206d 7573 7420 6265 2034  , then must be 4
+000668b0: 2027 6375 7374 6f6d 2720 283f 290d 0a20   'custom' (?).. 
+000668c0: 2020 2020 2020 2020 2020 2064 6f74 7469             dotti
+000668d0: 6e65 7373 5f6e 756d 6265 7220 3d20 340d  ness_number = 4.
+000668e0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
+000668f0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+00066900: 656e 2866 6972 7374 5f65 6666 6563 7469  en(first_effecti
+00066910: 7665 5f65 6c65 6d65 6e74 2e63 6869 6c64  ve_element.child
+00066920: 7265 6e29 203e 2030 3a0d 0a0d 0a20 2020  ren) > 0:....   
+00066930: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00066940: 6669 7273 745f 6566 6665 6374 6976 655f  first_effective_
+00066950: 656c 656d 656e 742e 6772 6f75 705f 6f6e  element.group_on
+00066960: 6c79 203d 3d20 2747 726f 7570 273a 0d0a  ly == 'Group':..
+00066970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066980: 2020 2020 2344 6f74 7469 6e65 7373 2036      #Dottiness 6
+00066990: 2069 7320 616c 6c20 6368 696c 6472 656e   is all children
 000669a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000669b0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
-000669c0: 2020 2020 2020 2020 2020 2020 2023 446f               #Do
-000669d0: 7474 696e 6573 7320 3720 6973 2073 656c  ttiness 7 is sel
-000669e0: 6620 616e 6420 616c 6c20 6368 696c 6472  f and all childr
-000669f0: 656e 0d0a 2020 2020 2020 2020 2020 2020  en..            
-00066a00: 2020 2020 2020 2020 646f 7474 696e 6573          dottines
-00066a10: 735f 6e75 6d62 6572 203d 2037 0d0a 0d0a  s_number = 7....
-00066a20: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00066a30: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00066a40: 2020 2020 2020 2023 5369 6e67 6c65 2065         #Single e
-00066a50: 6c65 6d65 6e74 7320 6765 7420 6120 646f  lements get a do
-00066a60: 7474 696e 6573 7320 6f66 2031 202d 2069  ttiness of 1 - i
-00066a70: 2e65 2e20 6a75 7374 2073 656c 660d 0a20  .e. just self.. 
-00066a80: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00066a90: 6f74 7469 6e65 7373 5f6e 756d 6265 7220  ottiness_number 
-00066aa0: 3d20 310d 0a0d 0a20 2020 2020 2020 2069  = 1....        i
-00066ab0: 6e73 7461 6e63 655f 6e75 6d62 6572 203d  nstance_number =
-00066ac0: 2030 0d0a 2020 2020 2020 2020 666f 7220   0..        for 
-00066ad0: 7365 2069 6e20 7374 7275 6374 7572 652e  se in structure.
-00066ae0: 7761 6c6b 2829 3a0d 0a20 2020 2020 2020  walk():..       
-00066af0: 2020 2020 2023 4b65 6570 2069 6e63 7265       #Keep incre
-00066b00: 6d65 6e74 696e 6720 7468 6520 6566 6665  menting the effe
-00066b10: 6374 6976 6520 656c 656d 656e 7420 756e  ctive element un
-00066b20: 7469 6c20 2861 6e64 2069 6e63 6c75 6469  til (and includi
-00066b30: 6e67 2920 7768 656e 2077 6520 6669 6e64  ng) when we find
-00066b40: 2074 6865 206d 6174 6368 696e 6720 656c   the matching el
-00066b50: 656d 656e 742e 2054 6865 6e20 7374 6f70  ement. Then stop
-00066b60: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00066b70: 2066 6972 7374 5f65 6666 6563 7469 7665   first_effective
-00066b80: 5f65 6c65 6d65 6e74 2e73 686f 7274 6e61  _element.shortna
-00066b90: 6d65 203d 3d20 7365 2e73 686f 7274 6e61  me == se.shortna
-00066ba0: 6d65 3a0d 0a20 2020 2020 2020 2020 2020  me:..           
-00066bb0: 2020 2020 2069 6e73 7461 6e63 655f 6e75       instance_nu
-00066bc0: 6d62 6572 202b 3d20 310d 0a0d 0a20 2020  mber += 1....   
-00066bd0: 2020 2020 2020 2020 2069 6620 6669 7273           if firs
-00066be0: 745f 6566 6665 6374 6976 655f 656c 656d  t_effective_elem
-00066bf0: 656e 7420 3d3d 2073 653a 0d0a 2020 2020  ent == se:..    
-00066c00: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00066c10: 6b0d 0a0d 0a20 2020 2020 2020 2070 6879  k....        phy
-00066c20: 7369 645f 7374 7269 6e67 203d 2027 2027  sid_string = ' '
-00066c30: 2e6a 6f69 6e28 5b73 7472 2865 6c2e 7068  .join([str(el.ph
-00066c40: 7973 6964 2920 666f 7220 656c 2069 6e20  ysid) for el in 
-00066c50: 6566 6665 6374 6976 655f 656c 656d 656e  effective_elemen
-00066c60: 7473 5d29 0d0a 0d0a 2020 2020 2020 2020  ts])....        
-00066c70: 2364 696d 656e 7369 6f6e 5f69 6e64 6578  #dimension_index
-00066c80: 202b 2031 0d0a 2020 2020 2020 2020 2320   + 1..        # 
-00066c90: 3d0d 0a20 2020 2020 2020 2023 446f 7474  =..        #Dott
-00066ca0: 696e 6573 730d 0a20 2020 2020 2020 2023  iness..        #
-00066cb0: 496e 7374 616e 6365 204e 756d 6265 720d  Instance Number.
-00066cc0: 0a20 2020 2020 2020 2023 5068 7973 6964  .        #Physid
-00066cd0: 0d0a 2020 2020 2020 2020 6f75 7470 7574  ..        output
-00066ce0: 5f73 7472 696e 6720 3d20 277b 7d3d 237b  _string = '{}=#{
-00066cf0: 7d23 237b 7d23 7b7d 3b27 2e66 6f72 6d61  }##{}#{};'.forma
-00066d00: 7428 6469 6d65 6e73 696f 6e5f 696e 6465  t(dimension_inde
-00066d10: 782b 312c 646f 7474 696e 6573 735f 6e75  x+1,dottiness_nu
-00066d20: 6d62 6572 2c69 6e73 7461 6e63 655f 6e75  mber,instance_nu
-00066d30: 6d62 6572 2c70 6879 7369 645f 7374 7269  mber,physid_stri
-00066d40: 6e67 290d 0a0d 0a20 2020 2020 2020 2072  ng)....        r
-00066d50: 6574 7572 6e20 6f75 7470 7574 5f73 7472  eturn output_str
-00066d60: 696e 670d 0a0d 0a20 2020 2040 7072 6f70  ing....    @prop
-00066d70: 6572 7479 0d0a 2020 2020 6465 6620 5f66  erty..    def _f
-00066d80: 6f63 7573 5f73 7472 696e 6728 7365 6c66  ocus_string(self
-00066d90: 293a 0d0a 2020 2020 2020 2020 666f 6375  ):..        focu
-00066da0: 735f 7374 7269 6e67 203d 2022 466f 6375  s_string = "Focu
-00066db0: 7320 3d20 220d 0a0d 0a20 2020 2020 2020  s = "....       
-00066dc0: 2066 6f72 206e 2c20 7374 7275 6374 7572   for n, structur
-00066dd0: 6520 696e 2065 6e75 6d65 7261 7465 2873  e in enumerate(s
-00066de0: 656c 662e 5f69 6e69 7469 616c 5f74 6172  elf._initial_tar
-00066df0: 6765 742e 7374 7275 6374 7572 6573 2e76  get.structures.v
-00066e00: 616c 7565 7328 2929 3a0d 0a20 2020 2020  alues()):..     
-00066e10: 2020 2020 2020 2023 456d 7074 7920 7374         #Empty st
-00066e20: 7275 6374 7572 6573 2028 6265 6361 7573  ructures (becaus
-00066e30: 6520 6f66 2065 6d70 7479 2055 6e69 7420  e of empty Unit 
-00066e40: 6469 6d65 6e73 696f 6e73 2920 646f 206e  dimensions) do n
-00066e50: 6f74 2067 6574 2061 2066 6f63 7573 2073  ot get a focus s
-00066e60: 7472 696e 676c 6574 0d0a 2020 2020 2020  tringlet..      
-00066e70: 2020 2020 2020 6966 2073 7472 7563 7475        if structu
-00066e80: 7265 2069 7320 6e6f 7420 4e6f 6e65 3a0d  re is not None:.
-00066e90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00066ea0: 2066 6f63 7573 5f73 7472 696e 6720 2b3d   focus_string +=
-00066eb0: 2073 656c 662e 5f73 696e 676c 655f 6469   self._single_di
-00066ec0: 6d65 6e73 696f 6e5f 666f 6375 735f 7374  mension_focus_st
-00066ed0: 7269 6e67 6c65 7428 6469 6d65 6e73 696f  ringlet(dimensio
-00066ee0: 6e5f 696e 6465 7820 3d20 6e29 0d0a 0d0a  n_index = n)....
-00066ef0: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-00066f00: 6f63 7573 5f73 7472 696e 670d 0a0d 0a20  ocus_string.... 
-00066f10: 2020 2040 7072 6f70 6572 7479 0d0a 2020     @property..  
-00066f20: 2020 6465 6620 5f66 6f63 7573 5f62 6c6f    def _focus_blo
-00066f30: 636b 7365 745f 7374 7269 6e67 2873 656c  ckset_string(sel
-00066f40: 6629 3a0d 0a20 2020 2020 2020 2027 2727  f):..        '''
-00066f50: 4120 7374 7269 6e67 2066 6f72 2063 6c65  A string for cle
-00066f60: 6172 696e 6720 646f 776e 2074 6865 2064  aring down the d
-00066f70: 6174 6120 696e 2074 6865 2066 6f63 7573  ata in the focus
-00066f80: 202d 2069 7427 6c6c 2067 6f20 696e 746f   - it'll go into
-00066f90: 2061 2042 6c6f 636b 5365 7420 636f 6d6d   a BlockSet comm
-00066fa0: 616e 6427 2727 0d0a 2020 2020 2020 2020  and'''..        
-00066fb0: 666f 6375 735f 626c 6f63 6b73 6574 5f73  focus_blockset_s
-00066fc0: 7472 696e 6720 3d20 2762 6c6f 636b 2d73  tring = 'block-s
-00066fd0: 6574 2056 6965 7770 6f69 6e74 203d 207b  et Viewpoint = {
-00066fe0: 7d2c 2027 2e66 6f72 6d61 7428 7365 6c66  }, '.format(self
-00066ff0: 2e5f 696e 6974 6961 6c5f 7461 7267 6574  ._initial_target
-00067000: 2e70 6879 7369 6429 202b 2073 656c 662e  .physid) + self.
-00067010: 5f66 6f63 7573 5f73 7472 696e 6720 2b20  _focus_string + 
-00067020: 272c 2056 616c 7565 203d 204e 2f41 270d  ', Value = N/A'.
-00067030: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00067040: 666f 6375 735f 626c 6f63 6b73 6574 5f73  focus_blockset_s
-00067050: 7472 696e 670d 0a0d 0a20 2020 2064 6566  tring....    def
-00067060: 2064 656c 6574 655f 7461 7267 6574 5f64   delete_target_d
-00067070: 6174 6128 7365 6c66 293a 0d0a 2020 2020  ata(self):..    
-00067080: 2020 2020 2727 2742 6c6f 636b 5365 7420      '''BlockSet 
-00067090: 7468 6520 466f 6375 7320 746f 204e 2f41  the Focus to N/A
-000670a0: 2e20 5468 6973 2069 7320 6120 6d69 6768  . This is a migh
-000670b0: 7479 2070 6f77 6572 6675 6c20 636f 6d6d  ty powerful comm
-000670c0: 616e 642c 2074 6f20 6265 2075 7365 6420  and, to be used 
-000670d0: 7769 7468 2063 6175 7469 6f6e 2727 270d  with caution'''.
-000670e0: 0a20 2020 2020 2020 206c 6f67 2e76 6572  .        log.ver
-000670f0: 626f 7365 2827 4465 6c65 7469 6e67 2061  bose('Deleting a
-00067100: 6c6c 207b 7d20 6461 7461 2070 6f69 6e74  ll {} data point
-00067110: 7320 696e 207b 7d2e 2027 2e66 6f72 6d61  s in {}. '.forma
-00067120: 7428 6c65 6e28 7365 6c66 292c 7365 6c66  t(len(self),self
-00067130: 2e5f 666f 6375 735f 7374 7269 6e67 2929  ._focus_string))
-00067140: 0d0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
-00067150: 6974 652e 696d 706f 7274 6572 2e72 756e  ite.importer.run
-00067160: 5f63 6f6d 6d61 6e64 7328 5b73 656c 662e  _commands([self.
-00067170: 5f66 6f63 7573 5f62 6c6f 636b 7365 745f  _focus_blockset_
-00067180: 7374 7269 6e67 5d29 0d0a 0d0a 2020 2020  string])....    
-00067190: 6465 6620 5f5f 6c65 6e5f 5f28 7365 6c66  def __len__(self
-000671a0: 293a 0d0a 0d0a 2020 2020 2020 2020 6465  ):....        de
-000671b0: 6620 5f6c 656e 5f65 6666 6563 7469 7665  f _len_effective
-000671c0: 5f65 6c65 6d65 6e74 7328 6566 6665 6374  _elements(effect
-000671d0: 6976 655f 656c 656d 656e 7473 293a 0d0a  ive_elements):..
-000671e0: 2020 2020 2020 2020 2020 2020 6966 2065              if e
-000671f0: 6666 6563 7469 7665 5f65 6c65 6d65 6e74  ffective_element
-00067200: 7320 6973 204e 6f6e 653a 0d0a 2020 2020  s is None:..    
-00067210: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00067220: 726e 2031 0d0a 2020 2020 2020 2020 2020  rn 1..          
-00067230: 2020 6669 7273 745f 6566 6665 6374 6976    first_effectiv
-00067240: 655f 656c 656d 656e 7420 3d20 6566 6665  e_element = effe
-00067250: 6374 6976 655f 656c 656d 656e 7473 5b30  ctive_elements[0
-00067260: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
-00067270: 6620 6c65 6e28 6566 6665 6374 6976 655f  f len(effective_
-00067280: 656c 656d 656e 7473 2920 3e20 313a 0d0a  elements) > 1:..
-00067290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000672a0: 7265 7475 726e 206c 656e 2865 6666 6563  return len(effec
-000672b0: 7469 7665 5f65 6c65 6d65 6e74 7329 0d0a  tive_elements)..
-000672c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000672d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000672e0: 2020 2069 6620 6c65 6e28 6669 7273 745f     if len(first_
-000672f0: 6566 6665 6374 6976 655f 656c 656d 656e  effective_elemen
-00067300: 742e 6368 696c 6472 656e 2920 3e20 303a  t.children) > 0:
-00067310: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00067320: 2020 2020 2020 2344 6f74 7469 6e65 7373        #Dottiness
-00067330: 2037 2069 7320 7365 6c66 2061 6e64 2061   7 is self and a
-00067340: 6c6c 2063 6869 6c64 7265 6e0d 0a20 2020  ll children..   
-00067350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067360: 2063 6f75 6e74 203d 2030 0d0a 2020 2020   count = 0..    
-00067370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067380: 666f 7220 6368 2069 6e20 6669 7273 745f  for ch in first_
-00067390: 6566 6665 6374 6976 655f 656c 656d 656e  effective_elemen
-000673a0: 742e 7761 6c6b 2829 3a0d 0a20 2020 2020  t.walk():..     
-000673b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000673c0: 2020 2069 6620 6368 2e67 726f 7570 5f6f     if ch.group_o
-000673d0: 6e6c 7920 6973 204e 6f6e 6520 6f72 2063  nly is None or c
-000673e0: 682e 6772 6f75 705f 6f6e 6c79 2021 3d20  h.group_only != 
-000673f0: 2747 726f 7570 273a 0d0a 2020 2020 2020  'Group':..      
-00067400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067410: 2020 2020 2020 636f 756e 742b 3d31 0d0a        count+=1..
-00067420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067430: 2020 2020 6966 2063 6f75 6e74 203d 3d30      if count ==0
-00067440: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00067450: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00067460: 6e20 310d 0a20 2020 2020 2020 2020 2020  n 1..           
-00067470: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00067480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067490: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-000674a0: 6f75 6e74 0d0a 2020 2020 2020 2020 2020  ount..          
-000674b0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-000674c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000674d0: 2023 5369 6e67 6c65 2065 6c65 6d65 6e74   #Single element
-000674e0: 7320 6765 7420 6120 646f 7474 696e 6573  s get a dottines
-000674f0: 7320 6f66 2031 202d 2069 2e65 2e20 6a75  s of 1 - i.e. ju
-00067500: 7374 2073 656c 660d 0a20 2020 2020 2020  st self..       
-00067510: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00067520: 7572 6e20 310d 0a0d 0a20 2020 2020 2020  urn 1....       
-00067530: 2072 6573 756c 7420 3d20 310d 0a20 2020   result = 1..   
-00067540: 2020 2020 2066 6f72 206e 2069 6e20 7261       for n in ra
-00067550: 6e67 6528 7365 6c66 2e73 6974 652e 6e75  nge(self.site.nu
-00067560: 6d62 6572 5f6f 665f 756e 6974 5f64 696d  mber_of_unit_dim
-00067570: 656e 7369 6f6e 7329 3a0d 0a20 2020 2020  ensions):..     
-00067580: 2020 2020 2020 2072 6573 756c 7420 2a3d         result *=
-00067590: 2020 5f6c 656e 5f65 6666 6563 7469 7665    _len_effective
-000675a0: 5f65 6c65 6d65 6e74 7328 7365 6c66 2e5f  _elements(self._
-000675b0: 6d61 7070 696e 6773 2e65 6666 6563 7469  mappings.effecti
-000675c0: 7665 5f75 6e69 745f 6469 6d65 6e73 696f  ve_unit_dimensio
-000675d0: 6e5f 656c 656d 656e 7473 2864 696d 656e  n_elements(dimen
-000675e0: 7369 6f6e 5f69 6e64 6578 3d6e 2929 0d0a  sion_index=n))..
-000675f0: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
-00067600: 202a 3d20 5f6c 656e 5f65 6666 6563 7469   *= _len_effecti
-00067610: 7665 5f65 6c65 6d65 6e74 7328 7365 6c66  ve_elements(self
-00067620: 2e5f 6d61 7070 696e 6773 2e65 6666 6563  ._mappings.effec
-00067630: 7469 7665 5f69 6e64 6963 6174 6f72 5f65  tive_indicator_e
-00067640: 6c65 6d65 6e74 7320 290d 0a20 2020 2020  lements )..     
-00067650: 2020 2072 6573 756c 7420 2a3d 205f 6c65     result *= _le
-00067660: 6e5f 6566 6665 6374 6976 655f 656c 656d  n_effective_elem
-00067670: 656e 7473 2873 656c 662e 5f6d 6170 7069  ents(self._mappi
-00067680: 6e67 732e 6566 6665 6374 6976 655f 636f  ngs.effective_co
-00067690: 6d70 6172 6973 6f6e 5f65 6c65 6d65 6e74  mparison_element
-000676a0: 7329 0d0a 2020 2020 2020 2020 7265 7375  s)..        resu
-000676b0: 6c74 202a 3d20 5f6c 656e 5f65 6666 6563  lt *= _len_effec
-000676c0: 7469 7665 5f65 6c65 6d65 6e74 7328 7365  tive_elements(se
-000676d0: 6c66 2e5f 6d61 7070 696e 6773 2e65 6666  lf._mappings.eff
-000676e0: 6563 7469 7665 5f63 7572 7265 6e63 795f  ective_currency_
-000676f0: 656c 656d 656e 7473 2020 290d 0a20 2020  elements  )..   
-00067700: 2020 2020 2072 6573 756c 7420 2a3d 205f       result *= _
-00067710: 6c65 6e5f 6566 6665 6374 6976 655f 656c  len_effective_el
-00067720: 656d 656e 7473 2873 656c 662e 5f6d 6170  ements(self._map
-00067730: 7069 6e67 732e 6566 6665 6374 6976 655f  pings.effective_
-00067740: 7472 616e 7366 6f72 6d5f 656c 656d 656e  transform_elemen
-00067750: 7473 2029 0d0a 2020 2020 2020 2020 7265  ts )..        re
-00067760: 7375 6c74 202a 3d20 5f6c 656e 5f65 6666  sult *= _len_eff
-00067770: 6563 7469 7665 5f65 6c65 6d65 6e74 7328  ective_elements(
-00067780: 7365 6c66 2e5f 6d61 7070 696e 6773 2e65  self._mappings.e
-00067790: 6666 6563 7469 7665 5f74 696d 655f 656c  ffective_time_el
-000677a0: 656d 656e 7473 2020 2020 2020 290d 0a20  ements      ).. 
-000677b0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-000677c0: 7375 6c74 0d0a 0d0a 0d0a 2323 2323 2323  sult......######
-000677d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000677e0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-000677f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00067800: 2323 2323 2323 2323 2323 2323 230d 0a23  #############..#
-00067810: 0d0a 2320 5374 7275 6374 7572 6520 436f  ..# Structure Co
-00067820: 6d70 6172 6973 6f6e 0d0a 230d 0a23 2323  mparison..#..###
-00067830: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00067840: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00067850: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+000669b0: 2020 2020 2020 646f 7474 696e 6573 735f        dottiness_
+000669c0: 6e75 6d62 6572 203d 2036 0d0a 0d0a 2020  number = 6....  
+000669d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000669e0: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
+000669f0: 2020 2020 2020 2020 2023 446f 7474 696e           #Dottin
+00066a00: 6573 7320 3720 6973 2073 656c 6620 616e  ess 7 is self an
+00066a10: 6420 616c 6c20 6368 696c 6472 656e 0d0a  d all children..
+00066a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00066a30: 2020 2020 646f 7474 696e 6573 735f 6e75      dottiness_nu
+00066a40: 6d62 6572 203d 2037 0d0a 0d0a 0d0a 0d0a  mber = 7........
+00066a50: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00066a60: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00066a70: 2020 2023 5369 6e67 6c65 2065 6c65 6d65     #Single eleme
+00066a80: 6e74 7320 6765 7420 6120 646f 7474 696e  nts get a dottin
+00066a90: 6573 7320 6f66 2031 202d 2069 2e65 2e20  ess of 1 - i.e. 
+00066aa0: 6a75 7374 2073 656c 660d 0a20 2020 2020  just self..     
+00066ab0: 2020 2020 2020 2020 2020 2064 6f74 7469             dotti
+00066ac0: 6e65 7373 5f6e 756d 6265 7220 3d20 310d  ness_number = 1.
+00066ad0: 0a0d 0a20 2020 2020 2020 2069 6e73 7461  ...        insta
+00066ae0: 6e63 655f 6e75 6d62 6572 203d 2030 0d0a  nce_number = 0..
+00066af0: 2020 2020 2020 2020 666f 7220 7365 2069          for se i
+00066b00: 6e20 7374 7275 6374 7572 652e 7761 6c6b  n structure.walk
+00066b10: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
+00066b20: 2023 4b65 6570 2069 6e63 7265 6d65 6e74   #Keep increment
+00066b30: 696e 6720 7468 6520 6566 6665 6374 6976  ing the effectiv
+00066b40: 6520 656c 656d 656e 7420 756e 7469 6c20  e element until 
+00066b50: 2861 6e64 2069 6e63 6c75 6469 6e67 2920  (and including) 
+00066b60: 7768 656e 2077 6520 6669 6e64 2074 6865  when we find the
+00066b70: 206d 6174 6368 696e 6720 656c 656d 656e   matching elemen
+00066b80: 742e 2054 6865 6e20 7374 6f70 0d0a 2020  t. Then stop..  
+00066b90: 2020 2020 2020 2020 2020 6966 2066 6972            if fir
+00066ba0: 7374 5f65 6666 6563 7469 7665 5f65 6c65  st_effective_ele
+00066bb0: 6d65 6e74 2e73 686f 7274 6e61 6d65 203d  ment.shortname =
+00066bc0: 3d20 7365 2e73 686f 7274 6e61 6d65 3a0d  = se.shortname:.
+00066bd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00066be0: 2069 6e73 7461 6e63 655f 6e75 6d62 6572   instance_number
+00066bf0: 202b 3d20 310d 0a0d 0a20 2020 2020 2020   += 1....       
+00066c00: 2020 2020 2069 6620 6669 7273 745f 6566       if first_ef
+00066c10: 6665 6374 6976 655f 656c 656d 656e 7420  fective_element 
+00066c20: 3d3d 2073 653a 0d0a 2020 2020 2020 2020  == se:..        
+00066c30: 2020 2020 2020 2020 6272 6561 6b0d 0a0d          break...
+00066c40: 0a20 2020 2020 2020 2070 6879 7369 645f  .        physid_
+00066c50: 7374 7269 6e67 203d 2027 2027 2e6a 6f69  string = ' '.joi
+00066c60: 6e28 5b73 7472 2865 6c2e 7068 7973 6964  n([str(el.physid
+00066c70: 2920 666f 7220 656c 2069 6e20 6566 6665  ) for el in effe
+00066c80: 6374 6976 655f 656c 656d 656e 7473 5d29  ctive_elements])
+00066c90: 0d0a 0d0a 2020 2020 2020 2020 2364 696d  ....        #dim
+00066ca0: 656e 7369 6f6e 5f69 6e64 6578 202b 2031  ension_index + 1
+00066cb0: 0d0a 2020 2020 2020 2020 2320 3d0d 0a20  ..        # =.. 
+00066cc0: 2020 2020 2020 2023 446f 7474 696e 6573         #Dottines
+00066cd0: 730d 0a20 2020 2020 2020 2023 496e 7374  s..        #Inst
+00066ce0: 616e 6365 204e 756d 6265 720d 0a20 2020  ance Number..   
+00066cf0: 2020 2020 2023 5068 7973 6964 0d0a 2020       #Physid..  
+00066d00: 2020 2020 2020 6f75 7470 7574 5f73 7472        output_str
+00066d10: 696e 6720 3d20 277b 7d3d 237b 7d23 237b  ing = '{}=#{}##{
+00066d20: 7d23 7b7d 3b27 2e66 6f72 6d61 7428 6469  }#{};'.format(di
+00066d30: 6d65 6e73 696f 6e5f 696e 6465 782b 312c  mension_index+1,
+00066d40: 646f 7474 696e 6573 735f 6e75 6d62 6572  dottiness_number
+00066d50: 2c69 6e73 7461 6e63 655f 6e75 6d62 6572  ,instance_number
+00066d60: 2c70 6879 7369 645f 7374 7269 6e67 290d  ,physid_string).
+00066d70: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
+00066d80: 6e20 6f75 7470 7574 5f73 7472 696e 670d  n output_string.
+00066d90: 0a0d 0a20 2020 2040 7072 6f70 6572 7479  ...    @property
+00066da0: 0d0a 2020 2020 6465 6620 5f66 6f63 7573  ..    def _focus
+00066db0: 5f73 7472 696e 6728 7365 6c66 293a 0d0a  _string(self):..
+00066dc0: 2020 2020 2020 2020 666f 6375 735f 7374          focus_st
+00066dd0: 7269 6e67 203d 2022 466f 6375 7320 3d20  ring = "Focus = 
+00066de0: 220d 0a0d 0a20 2020 2020 2020 2066 6f72  "....        for
+00066df0: 206e 2c20 7374 7275 6374 7572 6520 696e   n, structure in
+00066e00: 2065 6e75 6d65 7261 7465 2873 656c 662e   enumerate(self.
+00066e10: 5f69 6e69 7469 616c 5f74 6172 6765 742e  _initial_target.
+00066e20: 7374 7275 6374 7572 6573 2e76 616c 7565  structures.value
+00066e30: 7328 2929 3a0d 0a20 2020 2020 2020 2020  s()):..         
+00066e40: 2020 2023 456d 7074 7920 7374 7275 6374     #Empty struct
+00066e50: 7572 6573 2028 6265 6361 7573 6520 6f66  ures (because of
+00066e60: 2065 6d70 7479 2055 6e69 7420 6469 6d65   empty Unit dime
+00066e70: 6e73 696f 6e73 2920 646f 206e 6f74 2067  nsions) do not g
+00066e80: 6574 2061 2066 6f63 7573 2073 7472 696e  et a focus strin
+00066e90: 676c 6574 0d0a 2020 2020 2020 2020 2020  glet..          
+00066ea0: 2020 6966 2073 7472 7563 7475 7265 2069    if structure i
+00066eb0: 7320 6e6f 7420 4e6f 6e65 3a0d 0a20 2020  s not None:..   
+00066ec0: 2020 2020 2020 2020 2020 2020 2066 6f63               foc
+00066ed0: 7573 5f73 7472 696e 6720 2b3d 2073 656c  us_string += sel
+00066ee0: 662e 5f73 696e 676c 655f 6469 6d65 6e73  f._single_dimens
+00066ef0: 696f 6e5f 666f 6375 735f 7374 7269 6e67  ion_focus_string
+00066f00: 6c65 7428 6469 6d65 6e73 696f 6e5f 696e  let(dimension_in
+00066f10: 6465 7820 3d20 6e29 0d0a 0d0a 2020 2020  dex = n)....    
+00066f20: 2020 2020 7265 7475 726e 2066 6f63 7573      return focus
+00066f30: 5f73 7472 696e 670d 0a0d 0a20 2020 2040  _string....    @
+00066f40: 7072 6f70 6572 7479 0d0a 2020 2020 6465  property..    de
+00066f50: 6620 5f66 6f63 7573 5f62 6c6f 636b 7365  f _focus_blockse
+00066f60: 745f 7374 7269 6e67 2873 656c 6629 3a0d  t_string(self):.
+00066f70: 0a20 2020 2020 2020 2027 2727 4120 7374  .        '''A st
+00066f80: 7269 6e67 2066 6f72 2063 6c65 6172 696e  ring for clearin
+00066f90: 6720 646f 776e 2074 6865 2064 6174 6120  g down the data 
+00066fa0: 696e 2074 6865 2066 6f63 7573 202d 2069  in the focus - i
+00066fb0: 7427 6c6c 2067 6f20 696e 746f 2061 2042  t'll go into a B
+00066fc0: 6c6f 636b 5365 7420 636f 6d6d 616e 6427  lockSet command'
+00066fd0: 2727 0d0a 2020 2020 2020 2020 666f 6375  ''..        focu
+00066fe0: 735f 626c 6f63 6b73 6574 5f73 7472 696e  s_blockset_strin
+00066ff0: 6720 3d20 2762 6c6f 636b 2d73 6574 2056  g = 'block-set V
+00067000: 6965 7770 6f69 6e74 203d 207b 7d2c 2027  iewpoint = {}, '
+00067010: 2e66 6f72 6d61 7428 7365 6c66 2e5f 696e  .format(self._in
+00067020: 6974 6961 6c5f 7461 7267 6574 2e70 6879  itial_target.phy
+00067030: 7369 6429 202b 2073 656c 662e 5f66 6f63  sid) + self._foc
+00067040: 7573 5f73 7472 696e 6720 2b20 272c 2056  us_string + ', V
+00067050: 616c 7565 203d 204e 2f41 270d 0a20 2020  alue = N/A'..   
+00067060: 2020 2020 2072 6574 7572 6e20 666f 6375       return focu
+00067070: 735f 626c 6f63 6b73 6574 5f73 7472 696e  s_blockset_strin
+00067080: 670d 0a0d 0a20 2020 2064 6566 2064 656c  g....    def del
+00067090: 6574 655f 7461 7267 6574 5f64 6174 6128  ete_target_data(
+000670a0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+000670b0: 2727 2742 6c6f 636b 5365 7420 7468 6520  '''BlockSet the 
+000670c0: 466f 6375 7320 746f 204e 2f41 2e20 5468  Focus to N/A. Th
+000670d0: 6973 2069 7320 6120 6d69 6768 7479 2070  is is a mighty p
+000670e0: 6f77 6572 6675 6c20 636f 6d6d 616e 642c  owerful command,
+000670f0: 2074 6f20 6265 2075 7365 6420 7769 7468   to be used with
+00067100: 2063 6175 7469 6f6e 2727 270d 0a20 2020   caution'''..   
+00067110: 2020 2020 206c 6f67 2e76 6572 626f 7365       log.verbose
+00067120: 2827 4465 6c65 7469 6e67 2061 6c6c 207b  ('Deleting all {
+00067130: 7d20 6461 7461 2070 6f69 6e74 7320 696e  } data points in
+00067140: 207b 7d2e 2027 2e66 6f72 6d61 7428 6c65   {}. '.format(le
+00067150: 6e28 7365 6c66 292c 7365 6c66 2e5f 666f  n(self),self._fo
+00067160: 6375 735f 7374 7269 6e67 2929 0d0a 2020  cus_string))..  
+00067170: 2020 2020 2020 7365 6c66 2e73 6974 652e        self.site.
+00067180: 696d 706f 7274 6572 2e72 756e 5f63 6f6d  importer.run_com
+00067190: 6d61 6e64 7328 5b73 656c 662e 5f66 6f63  mands([self._foc
+000671a0: 7573 5f62 6c6f 636b 7365 745f 7374 7269  us_blockset_stri
+000671b0: 6e67 5d29 0d0a 0d0a 2020 2020 6465 6620  ng])....    def 
+000671c0: 5f5f 6c65 6e5f 5f28 7365 6c66 293a 0d0a  __len__(self):..
+000671d0: 0d0a 2020 2020 2020 2020 6465 6620 5f6c  ..        def _l
+000671e0: 656e 5f65 6666 6563 7469 7665 5f65 6c65  en_effective_ele
+000671f0: 6d65 6e74 7328 6566 6665 6374 6976 655f  ments(effective_
+00067200: 656c 656d 656e 7473 293a 0d0a 2020 2020  elements):..    
+00067210: 2020 2020 2020 2020 6966 2065 6666 6563          if effec
+00067220: 7469 7665 5f65 6c65 6d65 6e74 7320 6973  tive_elements is
+00067230: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00067240: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
+00067250: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+00067260: 7273 745f 6566 6665 6374 6976 655f 656c  rst_effective_el
+00067270: 656d 656e 7420 3d20 6566 6665 6374 6976  ement = effectiv
+00067280: 655f 656c 656d 656e 7473 5b30 5d0d 0a20  e_elements[0].. 
+00067290: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+000672a0: 6e28 6566 6665 6374 6976 655f 656c 656d  n(effective_elem
+000672b0: 656e 7473 2920 3e20 313a 0d0a 2020 2020  ents) > 1:..    
+000672c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000672d0: 726e 206c 656e 2865 6666 6563 7469 7665  rn len(effective
+000672e0: 5f65 6c65 6d65 6e74 7329 0d0a 2020 2020  _elements)..    
+000672f0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00067300: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00067310: 6620 6c65 6e28 6669 7273 745f 6566 6665  f len(first_effe
+00067320: 6374 6976 655f 656c 656d 656e 742e 6368  ctive_element.ch
+00067330: 696c 6472 656e 2920 3e20 303a 0d0a 2020  ildren) > 0:..  
+00067340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067350: 2020 2344 6f74 7469 6e65 7373 2037 2069    #Dottiness 7 i
+00067360: 7320 7365 6c66 2061 6e64 2061 6c6c 2063  s self and all c
+00067370: 6869 6c64 7265 6e0d 0a20 2020 2020 2020  hildren..       
+00067380: 2020 2020 2020 2020 2020 2020 2063 6f75               cou
+00067390: 6e74 203d 2030 0d0a 2020 2020 2020 2020  nt = 0..        
+000673a0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000673b0: 6368 2069 6e20 6669 7273 745f 6566 6665  ch in first_effe
+000673c0: 6374 6976 655f 656c 656d 656e 742e 7761  ctive_element.wa
+000673d0: 6c6b 2829 3a0d 0a20 2020 2020 2020 2020  lk():..         
+000673e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000673f0: 6620 6368 2e67 726f 7570 5f6f 6e6c 7920  f ch.group_only 
+00067400: 6973 204e 6f6e 6520 6f72 2063 682e 6772  is None or ch.gr
+00067410: 6f75 705f 6f6e 6c79 2021 3d20 2747 726f  oup_only != 'Gro
+00067420: 7570 273a 0d0a 2020 2020 2020 2020 2020  up':..          
+00067430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067440: 2020 636f 756e 742b 3d31 0d0a 2020 2020    count+=1..    
+00067450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067460: 6966 2063 6f75 6e74 203d 3d30 3a0d 0a20  if count ==0:.. 
+00067470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00067480: 2020 2020 2020 2072 6574 7572 6e20 310d         return 1.
+00067490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000674a0: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+000674b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000674c0: 2020 2020 7265 7475 726e 2063 6f75 6e74      return count
+000674d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000674e0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+000674f0: 2020 2020 2020 2020 2020 2020 2023 5369               #Si
+00067500: 6e67 6c65 2065 6c65 6d65 6e74 7320 6765  ngle elements ge
+00067510: 7420 6120 646f 7474 696e 6573 7320 6f66  t a dottiness of
+00067520: 2031 202d 2069 2e65 2e20 6a75 7374 2073   1 - i.e. just s
+00067530: 656c 660d 0a20 2020 2020 2020 2020 2020  elf..           
+00067540: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00067550: 310d 0a0d 0a20 2020 2020 2020 2072 6573  1....        res
+00067560: 756c 7420 3d20 310d 0a20 2020 2020 2020  ult = 1..       
+00067570: 2066 6f72 206e 2069 6e20 7261 6e67 6528   for n in range(
+00067580: 7365 6c66 2e73 6974 652e 6e75 6d62 6572  self.site.number
+00067590: 5f6f 665f 756e 6974 5f64 696d 656e 7369  _of_unit_dimensi
+000675a0: 6f6e 7329 3a0d 0a20 2020 2020 2020 2020  ons):..         
+000675b0: 2020 2072 6573 756c 7420 2a3d 2020 5f6c     result *=  _l
+000675c0: 656e 5f65 6666 6563 7469 7665 5f65 6c65  en_effective_ele
+000675d0: 6d65 6e74 7328 7365 6c66 2e5f 6d61 7070  ments(self._mapp
+000675e0: 696e 6773 2e65 6666 6563 7469 7665 5f75  ings.effective_u
+000675f0: 6e69 745f 6469 6d65 6e73 696f 6e5f 656c  nit_dimension_el
+00067600: 656d 656e 7473 2864 696d 656e 7369 6f6e  ements(dimension
+00067610: 5f69 6e64 6578 3d6e 2929 0d0a 0d0a 2020  _index=n))....  
+00067620: 2020 2020 2020 7265 7375 6c74 202a 3d20        result *= 
+00067630: 5f6c 656e 5f65 6666 6563 7469 7665 5f65  _len_effective_e
+00067640: 6c65 6d65 6e74 7328 7365 6c66 2e5f 6d61  lements(self._ma
+00067650: 7070 696e 6773 2e65 6666 6563 7469 7665  ppings.effective
+00067660: 5f69 6e64 6963 6174 6f72 5f65 6c65 6d65  _indicator_eleme
+00067670: 6e74 7320 290d 0a20 2020 2020 2020 2072  nts )..        r
+00067680: 6573 756c 7420 2a3d 205f 6c65 6e5f 6566  esult *= _len_ef
+00067690: 6665 6374 6976 655f 656c 656d 656e 7473  fective_elements
+000676a0: 2873 656c 662e 5f6d 6170 7069 6e67 732e  (self._mappings.
+000676b0: 6566 6665 6374 6976 655f 636f 6d70 6172  effective_compar
+000676c0: 6973 6f6e 5f65 6c65 6d65 6e74 7329 0d0a  ison_elements)..
+000676d0: 2020 2020 2020 2020 7265 7375 6c74 202a          result *
+000676e0: 3d20 5f6c 656e 5f65 6666 6563 7469 7665  = _len_effective
+000676f0: 5f65 6c65 6d65 6e74 7328 7365 6c66 2e5f  _elements(self._
+00067700: 6d61 7070 696e 6773 2e65 6666 6563 7469  mappings.effecti
+00067710: 7665 5f63 7572 7265 6e63 795f 656c 656d  ve_currency_elem
+00067720: 656e 7473 2020 290d 0a20 2020 2020 2020  ents  )..       
+00067730: 2072 6573 756c 7420 2a3d 205f 6c65 6e5f   result *= _len_
+00067740: 6566 6665 6374 6976 655f 656c 656d 656e  effective_elemen
+00067750: 7473 2873 656c 662e 5f6d 6170 7069 6e67  ts(self._mapping
+00067760: 732e 6566 6665 6374 6976 655f 7472 616e  s.effective_tran
+00067770: 7366 6f72 6d5f 656c 656d 656e 7473 2029  sform_elements )
+00067780: 0d0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+00067790: 202a 3d20 5f6c 656e 5f65 6666 6563 7469   *= _len_effecti
+000677a0: 7665 5f65 6c65 6d65 6e74 7328 7365 6c66  ve_elements(self
+000677b0: 2e5f 6d61 7070 696e 6773 2e65 6666 6563  ._mappings.effec
+000677c0: 7469 7665 5f74 696d 655f 656c 656d 656e  tive_time_elemen
+000677d0: 7473 2020 2020 2020 290d 0a20 2020 2020  ts      )..     
+000677e0: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+000677f0: 0d0a 0d0a 0d0a 2323 2323 2323 2323 2323  ......##########
+00067800: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00067810: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00067820: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00067830: 2323 2323 2323 2323 230d 0a23 0d0a 2320  #########..#..# 
+00067840: 5374 7275 6374 7572 6520 436f 6d70 6172  Structure Compar
+00067850: 6973 6f6e 0d0a 230d 0a23 2323 2323 2323  ison..#..#######
 00067860: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-00067870: 0d0a 0d0a 636c 6173 7320 5374 7275 6374  ....class Struct
-00067880: 7572 6545 6c65 6d65 6e74 436f 6d70 6172  ureElementCompar
-00067890: 6973 6f6e 286f 626a 6563 7429 3a0d 0a20  ison(object):.. 
-000678a0: 2020 2027 2727 4372 6561 7465 6420 6279     '''Created by
-000678b0: 2061 2053 7472 7563 7475 7265 456c 656d   a StructureElem
-000678c0: 656e 7420 6475 7269 6e67 2061 2063 6f6d  ent during a com
-000678d0: 7061 7269 736f 6e20 7769 7468 2061 6e6f  parison with ano
-000678e0: 7468 6572 2053 7472 7563 7475 7265 456c  ther StructureEl
-000678f0: 656d 656e 7420 7769 7468 2068 656c 7066  ement with helpf
-00067900: 756c 2027 2727 0d0a 0d0a 2020 2020 234d  ul '''....    #M
-00067910: 7573 7420 6561 7369 6c79 2073 686f 7720  ust easily show 
-00067920: 7570 2064 6966 6665 7265 6e63 6573 2c20  up differences, 
-00067930: 616e 6420 6372 6561 7465 206e 6963 656c  and create nicel
-00067940: 7920 666f 726d 6174 7465 6420 6d65 7373  y formatted mess
-00067950: 6167 6573 0d0a 0d0a 2020 2020 2345 7373  ages....    #Ess
-00067960: 656e 7469 616c 6c79 2074 6865 206f 6e6c  entially the onl
-00067970: 7920 706f 7373 6962 6c65 2064 6966 6665  y possible diffe
-00067980: 7265 6e63 6573 2061 7265 2061 6464 6564  rences are added
-00067990: 2c20 7265 6d6f 7665 6420 6f72 2072 656f  , removed or reo
-000679a0: 7264 6572 6564 2063 6869 6c64 7265 6e0d  rdered children.
-000679b0: 0a20 2020 2023 416e 7974 6869 6e67 2077  .    #Anything w
-000679c0: 6869 6368 2069 7320 7468 6520 7361 6d65  hich is the same
-000679d0: 2073 686f 756c 6420 7361 7973 2073 6f20   should says so 
-000679e0: 7175 6963 6b6c 792c 2061 6e64 2074 6865  quickly, and the
-000679f0: 6e20 7765 2063 616e 2064 7269 6c6c 2064  n we can drill d
-00067a00: 6f77 6e20 746f 2074 6865 2063 6869 6c64  own to the child
-00067a10: 7265 6e20 616e 6420 736f 206f 6e2e 2e2e  ren and so on...
-00067a20: 0d0a 0d0a 2020 2020 6465 6620 5f5f 696e  ....    def __in
-00067a30: 6974 5f5f 2873 656c 662c 7374 7275 6374  it__(self,struct
-00067a40: 7572 655f 656c 656d 656e 742c 6f74 6865  ure_element,othe
-00067a50: 725f 7374 7275 6374 7572 655f 656c 656d  r_structure_elem
-00067a60: 656e 7429 3a0d 0a20 2020 2020 2020 2073  ent):..        s
-00067a70: 656c 662e 7374 7275 6374 7572 655f 656c  elf.structure_el
-00067a80: 656d 656e 7420 3d20 7374 7275 6374 7572  ement = structur
-00067a90: 655f 656c 656d 656e 740d 0a20 2020 2020  e_element..     
-00067aa0: 2020 2073 656c 662e 6f74 6865 725f 7374     self.other_st
-00067ab0: 7275 6374 7572 655f 656c 656d 656e 7420  ructure_element 
-00067ac0: 3d20 6f74 6865 725f 7374 7275 6374 7572  = other_structur
-00067ad0: 655f 656c 656d 656e 740d 0a20 2020 2020  e_element..     
-00067ae0: 2020 2073 656c 662e 636f 6d70 6172 6973     self.comparis
-00067af0: 6f6e 5f6c 6973 7420 2020 3d20 5b5d 0d0a  on_list   = []..
-00067b00: 2020 2020 2020 2020 7365 6c66 2e69 735f          self.is_
-00067b10: 696e 5f73 656c 6620 2020 2020 2020 203d  in_self        =
-00067b20: 204e 6f6e 650d 0a20 2020 2020 2020 2073   None..        s
-00067b30: 656c 662e 6973 5f69 6e5f 6f74 6865 7220  elf.is_in_other 
-00067b40: 2020 2020 2020 3d20 4e6f 6e65 0d0a 2020        = None..  
-00067b50: 2020 2020 2020 7365 6c66 2e6f 7020 3d20        self.op = 
-00067b60: 4e6f 6e65 0d0a 0d0a 2020 2020 4070 726f  None....    @pro
-00067b70: 7065 7274 790d 0a20 2020 2064 6566 2073  perty..    def s
-00067b80: 616d 6528 7365 6c66 293a 0d0a 2020 2020  ame(self):..    
-00067b90: 2020 2020 2727 2752 6574 7572 6e20 5472      '''Return Tr
-00067ba0: 7565 2069 6620 7468 6572 6520 6973 206e  ue if there is n
-00067bb0: 6f20 6469 6666 6572 656e 6365 2062 6574  o difference bet
-00067bc0: 7765 656e 2074 6865 2073 7472 7563 7475  ween the structu
-00067bd0: 7265 2065 6c65 6d65 6e74 7327 2727 0d0a  re elements'''..
-00067be0: 2020 2020 2020 2020 6966 206e 6f74 2028          if not (
-00067bf0: 7365 6c66 2e69 735f 696e 5f73 656c 6620  self.is_in_self 
-00067c00: 616e 6420 7365 6c66 2e69 735f 696e 5f6f  and self.is_in_o
-00067c10: 7468 6572 293a 0d0a 2020 2020 2020 2020  ther):..        
-00067c20: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-00067c30: 0d0a 0d0a 2020 2020 2020 2020 666f 7220  ....        for 
-00067c40: 6320 696e 2073 656c 662e 636f 6d70 6172  c in self.compar
-00067c50: 6973 6f6e 5f6c 6973 743a 0d0a 2020 2020  ison_list:..    
-00067c60: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
-00067c70: 2e73 616d 653a 0d0a 2020 2020 2020 2020  .same:..        
-00067c80: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00067c90: 616c 7365 0d0a 2020 2020 2020 2020 7265  alse..        re
-00067ca0: 7475 726e 2054 7275 650d 0a0d 0a20 2020  turn True....   
-00067cb0: 2064 6566 206e 6577 5f6c 6561 665f 7374   def new_leaf_st
-00067cc0: 7269 6e67 7328 7365 6c66 293a 0d0a 2020  rings(self):..  
-00067cd0: 2020 2020 2020 666f 7220 7365 2069 6e20        for se in 
-00067ce0: 7365 6c66 2e6e 6577 5f65 6c65 6d65 6e74  self.new_element
-00067cf0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
-00067d00: 6966 2073 652e 6973 5f6c 6561 663a 0d0a  if se.is_leaf:..
-00067d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00067d20: 7969 656c 6420 277b 3a34 307d 203a 3a20  yield '{:40} :: 
-00067d30: 7b7d 272e 666f 726d 6174 2873 652e 6c6f  {}'.format(se.lo
-00067d40: 6e67 6e61 6d65 2c20 7365 2e73 7472 696e  ngname, se.strin
-00067d50: 675f 746f 5f72 6f6f 7429 0d0a 0d0a 2020  g_to_root)....  
-00067d60: 2020 6465 6620 6e65 775f 6e6f 6e6c 6561    def new_nonlea
-00067d70: 665f 7374 7269 6e67 7328 7365 6c66 293a  f_strings(self):
-00067d80: 0d0a 2020 2020 2020 2020 666f 7220 7365  ..        for se
-00067d90: 2069 6e20 7365 6c66 2e6e 6577 5f65 6c65   in self.new_ele
-00067da0: 6d65 6e74 733a 0d0a 2020 2020 2020 2020  ments:..        
-00067db0: 2020 2020 6966 206e 6f74 2073 652e 6973      if not se.is
-00067dc0: 5f6c 6561 663a 0d0a 2020 2020 2020 2020  _leaf:..        
-00067dd0: 2020 2020 2020 2020 7969 656c 6420 277b          yield '{
-00067de0: 3a35 307d 203a 3a20 7b7d 272e 666f 726d  :50} :: {}'.form
-00067df0: 6174 2873 652e 6c6f 6e67 6e61 6d65 2c20  at(se.longname, 
-00067e00: 7365 2e73 7472 696e 675f 746f 5f72 6f6f  se.string_to_roo
-00067e10: 7429 0d0a 0d0a 2020 2020 6465 6620 7265  t)....    def re
-00067e20: 6d6f 7665 645f 6c65 6166 5f73 7472 696e  moved_leaf_strin
-00067e30: 6773 2873 656c 6629 3a0d 0a20 2020 2020  gs(self):..     
-00067e40: 2020 2066 6f72 2073 6520 696e 2073 656c     for se in sel
-00067e50: 662e 7265 6d6f 7665 645f 656c 656d 656e  f.removed_elemen
-00067e60: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
-00067e70: 2069 6620 7365 2e69 735f 6c65 6166 3a0d   if se.is_leaf:.
-00067e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00067e90: 2079 6965 6c64 2027 7b3a 3430 7d20 3a3a   yield '{:40} ::
-00067ea0: 207b 7d27 2e66 6f72 6d61 7428 7365 2e6c   {}'.format(se.l
-00067eb0: 6f6e 676e 616d 652c 2073 652e 7374 7269  ongname, se.stri
-00067ec0: 6e67 5f74 6f5f 726f 6f74 290d 0a0d 0a20  ng_to_root).... 
-00067ed0: 2020 2064 6566 2072 656d 6f76 6564 5f6e     def removed_n
-00067ee0: 6f6e 6c65 6166 5f73 7472 696e 6773 2873  onleaf_strings(s
-00067ef0: 656c 6629 3a0d 0a20 2020 2020 2020 2066  elf):..        f
-00067f00: 6f72 2073 6520 696e 2073 656c 662e 7265  or se in self.re
-00067f10: 6d6f 7665 645f 656c 656d 656e 7473 3a0d  moved_elements:.
-00067f20: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00067f30: 6e6f 7420 7365 2e69 735f 6c65 6166 3a0d  not se.is_leaf:.
-00067f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00067f50: 2079 6965 6c64 2027 7b3a 3530 7d20 3a3a   yield '{:50} ::
-00067f60: 207b 7d27 2e66 6f72 6d61 7428 7365 2e6c   {}'.format(se.l
-00067f70: 6f6e 676e 616d 652c 2073 652e 7374 7269  ongname, se.stri
-00067f80: 6e67 5f74 6f5f 726f 6f74 290d 0a0d 0a20  ng_to_root).... 
-00067f90: 2020 2064 6566 2064 6966 665f 7374 7269     def diff_stri
-00067fa0: 6e67 7328 7365 6c66 2c69 6e64 656e 7420  ngs(self,indent 
-00067fb0: 3d20 302c 7472 696d 5f65 7175 616c 203d  = 0,trim_equal =
-00067fc0: 2046 616c 7365 293a 0d0a 0d0a 2020 2020   False):....    
-00067fd0: 2020 2020 7072 696e 745f 7374 7269 6e67      print_string
-00067fe0: 203d 2027 270d 0a0d 0a20 2020 2020 2020   = ''....       
-00067ff0: 2069 6620 7365 6c66 2e69 735f 696e 5f73   if self.is_in_s
-00068000: 656c 6620 6973 204e 6f6e 6520 616e 6420  elf is None and 
-00068010: 7365 6c66 2e69 735f 696e 5f6f 7468 6572  self.is_in_other
-00068020: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
-00068030: 2020 2020 2020 2023 4669 7273 7420 656c         #First el
-00068040: 656d 656e 7420 2d20 746f 7020 6c65 7665  ement - top leve
-00068050: 6c0d 0a20 2020 2020 2020 2020 2020 2070  l..            p
-00068060: 7269 6e74 5f73 7472 696e 6720 3d20 277b  rint_string = '{
-00068070: 3a6c 6c75 2e73 686f 7274 6e61 6d65 5f73  :llu.shortname_s
-00068080: 697a 657d 2058 2020 7b3a 6c6c 752e 7368  ize} X  {:llu.sh
-00068090: 6f72 746e 616d 655f 7369 7a65 7d27 2e66  ortname_size}'.f
-000680a0: 6f72 6d61 7428 7365 6c66 2e73 7472 7563  ormat(self.struc
-000680b0: 7475 7265 5f65 6c65 6d65 6e74 2e73 686f  ture_element.sho
-000680c0: 7274 6e61 6d65 2c20 7365 6c66 2e6f 7468  rtname, self.oth
-000680d0: 6572 5f73 7472 7563 7475 7265 5f65 6c65  er_structure_ele
-000680e0: 6d65 6e74 2e73 686f 7274 6e61 6d65 290d  ment.shortname).
-000680f0: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
-00068100: 6c66 2e69 735f 696e 5f73 656c 6620 616e  lf.is_in_self an
-00068110: 6420 7365 6c66 2e69 735f 696e 5f6f 7468  d self.is_in_oth
-00068120: 6572 3a0d 0a20 2020 2020 2020 2020 2020  er:..           
-00068130: 2069 6620 7365 6c66 2e73 7472 7563 7475   if self.structu
-00068140: 7265 5f65 6c65 6d65 6e74 2e6c 6f6e 676e  re_element.longn
-00068150: 616d 6520 3d3d 2073 656c 662e 6f74 6865  ame == self.othe
-00068160: 725f 7374 7275 6374 7572 655f 656c 656d  r_structure_elem
-00068170: 656e 742e 6c6f 6e67 6e61 6d65 3a0d 0a20  ent.longname:.. 
-00068180: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00068190: 7269 6e74 5f73 7472 696e 6720 3d20 696e  rint_string = in
-000681a0: 6465 6e74 2a27 2020 272b 277b 3a6c 6c75  dent*'  '+'{:llu
-000681b0: 2e73 686f 7274 6e61 6d65 5f73 697a 657d  .shortname_size}
-000681c0: 207b 7d20 7b3a 6c6c 752e 7368 6f72 746e   {} {:llu.shortn
-000681d0: 616d 655f 7369 7a65 7d20 2020 2020 2020  ame_size}       
-000681e0: 2020 2020 2020 207b 7d27 2e66 6f72 6d61         {}'.forma
-000681f0: 7428 7365 6c66 2e73 7472 7563 7475 7265  t(self.structure
-00068200: 5f65 6c65 6d65 6e74 2e73 686f 7274 6e61  _element.shortna
-00068210: 6d65 2c73 656c 662e 6f70 2c73 656c 662e  me,self.op,self.
-00068220: 6f74 6865 725f 7374 7275 6374 7572 655f  other_structure_
-00068230: 656c 656d 656e 742e 7368 6f72 746e 616d  element.shortnam
-00068240: 652c 7365 6c66 2e73 7472 7563 7475 7265  e,self.structure
-00068250: 5f65 6c65 6d65 6e74 2e6c 6f6e 676e 616d  _element.longnam
-00068260: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00068270: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
-00068280: 2020 2020 2020 2070 7269 6e74 5f73 7472         print_str
-00068290: 696e 6720 3d20 696e 6465 6e74 2a27 2020  ing = indent*'  
-000682a0: 272b 277b 3a6c 6c75 2e73 686f 7274 6e61  '+'{:llu.shortna
-000682b0: 6d65 5f73 697a 657d 207b 7d20 7b3a 6c6c  me_size} {} {:ll
-000682c0: 752e 7368 6f72 746e 616d 655f 7369 7a65  u.shortname_size
-000682d0: 7d20 2020 2020 2020 2020 2020 2020 207b  }              {
-000682e0: 7d20 2f20 7b7d 272e 666f 726d 6174 2873  } / {}'.format(s
-000682f0: 656c 662e 7374 7275 6374 7572 655f 656c  elf.structure_el
-00068300: 656d 656e 742e 7368 6f72 746e 616d 652c  ement.shortname,
-00068310: 7365 6c66 2e6f 702c 7365 6c66 2e6f 7468  self.op,self.oth
-00068320: 6572 5f73 7472 7563 7475 7265 5f65 6c65  er_structure_ele
-00068330: 6d65 6e74 2e73 686f 7274 6e61 6d65 2c73  ment.shortname,s
-00068340: 656c 662e 7374 7275 6374 7572 655f 656c  elf.structure_el
-00068350: 656d 656e 742e 6c6f 6e67 6e61 6d65 2c20  ement.longname, 
-00068360: 7365 6c66 2e6f 7468 6572 5f73 7472 7563  self.other_struc
-00068370: 7475 7265 5f65 6c65 6d65 6e74 2e6c 6f6e  ture_element.lon
-00068380: 676e 616d 6529 0d0a 0d0a 2020 2020 2020  gname)....      
-00068390: 2020 656c 6966 2073 656c 662e 6973 5f69    elif self.is_i
-000683a0: 6e5f 7365 6c66 3a0d 0a20 2020 2020 2020  n_self:..       
-000683b0: 2020 2020 2070 7269 6e74 5f73 7472 696e       print_strin
-000683c0: 6720 3d20 696e 6465 6e74 2a27 2020 272b  g = indent*'  '+
-000683d0: 277b 3a6c 6c75 2e73 686f 7274 6e61 6d65  '{:llu.shortname
-000683e0: 5f73 697a 657d 207b 7d20 2020 2020 2020  _size} {}       
-000683f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068400: 2020 7b7d 272e 666f 726d 6174 2873 656c    {}'.format(sel
-00068410: 662e 7374 7275 6374 7572 655f 656c 656d  f.structure_elem
-00068420: 656e 742e 7368 6f72 746e 616d 652c 7365  ent.shortname,se
-00068430: 6c66 2e6f 702c 7365 6c66 2e73 7472 7563  lf.op,self.struc
-00068440: 7475 7265 5f65 6c65 6d65 6e74 2e6c 6f6e  ture_element.lon
-00068450: 676e 616d 6529 0d0a 0d0a 2020 2020 2020  gname)....      
-00068460: 2020 656c 6966 2073 656c 662e 6973 5f69    elif self.is_i
-00068470: 6e5f 6f74 6865 723a 0d0a 2020 2020 2020  n_other:..      
-00068480: 2020 2020 2020 7072 696e 745f 7374 7269        print_stri
-00068490: 6e67 203d 2069 6e64 656e 742a 2720 2027  ng = indent*'  '
-000684a0: 2b27 2020 2020 2020 2020 2020 207b 7d20  +'           {} 
-000684b0: 7b3a 6c6c 752e 7368 6f72 746e 616d 655f  {:llu.shortname_
-000684c0: 7369 7a65 7d20 2020 2020 2020 2020 2020  size}           
-000684d0: 2020 207b 7d27 2e66 6f72 6d61 7428 7365     {}'.format(se
-000684e0: 6c66 2e6f 702c 7365 6c66 2e73 7472 7563  lf.op,self.struc
-000684f0: 7475 7265 5f65 6c65 6d65 6e74 2e73 686f  ture_element.sho
-00068500: 7274 6e61 6d65 2c73 656c 662e 7374 7275  rtname,self.stru
-00068510: 6374 7572 655f 656c 656d 656e 742e 6c6f  cture_element.lo
-00068520: 6e67 6e61 6d65 290d 0a0d 0a20 2020 2020  ngname)....     
-00068530: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00068540: 2020 2020 2020 7072 696e 7428 696e 6465        print(inde
-00068550: 6e74 2a27 2020 272c 273f 3f3f 3f27 2c73  nt*'  ','????',s
-00068560: 656c 662e 6f70 2c73 656c 662e 7374 7275  elf.op,self.stru
-00068570: 6374 7572 655f 656c 656d 656e 742e 7368  cture_element.sh
-00068580: 6f72 746e 616d 6529 0d0a 2020 2020 2020  ortname)..      
-00068590: 2020 2020 2020 6173 7365 7274 2046 616c        assert Fal
-000685a0: 7365 0d0a 0d0a 2020 2020 2020 2020 7969  se....        yi
-000685b0: 656c 6420 7072 696e 745f 7374 7269 6e67  eld print_string
-000685c0: 0d0a 0d0a 2020 2020 2020 2020 6966 206e  ....        if n
-000685d0: 6f74 2028 7472 696d 5f65 7175 616c 2061  ot (trim_equal a
-000685e0: 6e64 2073 656c 662e 6f70 203d 3d20 273d  nd self.op == '=
-000685f0: 2729 3a0d 0a20 2020 2020 2020 2020 2020  '):..           
-00068600: 2066 6f72 2073 6563 2069 6e20 7365 6c66   for sec in self
-00068610: 2e63 6f6d 7061 7269 736f 6e5f 6c69 7374  .comparison_list
-00068620: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00068630: 2020 2079 6965 6c64 2066 726f 6d20 7365     yield from se
-00068640: 632e 6469 6666 5f73 7472 696e 6773 2869  c.diff_strings(i
-00068650: 6e64 656e 7420 2b20 312c 7472 696d 5f65  ndent + 1,trim_e
-00068660: 7175 616c 3d74 7269 6d5f 6571 7561 6c29  qual=trim_equal)
-00068670: 0d0a 0d0a 2020 2020 2020 2020 2370 7269  ....        #pri
-00068680: 6e74 2028 6b2b 2027 5c74 272b 636f 6d70  nt (k+ '\t'+comp
-00068690: 2e74 7261 6e73 6f70 290d 0a0d 0a0d 0a20  .transop)...... 
-000686a0: 2020 2064 6566 2070 7269 6e74 5f63 6f6d     def print_com
-000686b0: 7061 7269 736f 6e28 7365 6c66 2c69 6e64  parison(self,ind
-000686c0: 656e 7420 3d20 302c 7472 696d 5f65 7175  ent = 0,trim_equ
-000686d0: 616c 203d 2046 616c 7365 293a 0d0a 0d0a  al = False):....
-000686e0: 2020 2020 2020 2020 7072 696e 745f 7374          print_st
-000686f0: 7269 6e67 203d 2027 270d 0a0d 0a20 2020  ring = ''....   
-00068700: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
-00068710: 696e 5f73 656c 6620 6973 204e 6f6e 6520  in_self is None 
-00068720: 616e 6420 7365 6c66 2e69 735f 696e 5f6f  and self.is_in_o
-00068730: 7468 6572 2069 7320 4e6f 6e65 3a0d 0a20  ther is None:.. 
-00068740: 2020 2020 2020 2020 2020 2023 4669 7273             #Firs
-00068750: 7420 656c 656d 656e 7420 2d20 746f 7020  t element - top 
-00068760: 6c65 7665 6c0d 0a20 2020 2020 2020 2020  level..         
-00068770: 2020 2070 7269 6e74 5f73 7472 696e 6720     print_string 
-00068780: 3d20 277b 3a6c 6c75 2e73 686f 7274 6e61  = '{:llu.shortna
-00068790: 6d65 5f73 697a 657d 2058 2020 7b3a 6c6c  me_size} X  {:ll
-000687a0: 752e 7368 6f72 746e 616d 655f 7369 7a65  u.shortname_size
-000687b0: 7d27 2e66 6f72 6d61 7428 7365 6c66 2e73  }'.format(self.s
-000687c0: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-000687d0: 2e73 686f 7274 6e61 6d65 2c20 7365 6c66  .shortname, self
-000687e0: 2e6f 7468 6572 5f73 7472 7563 7475 7265  .other_structure
-000687f0: 5f65 6c65 6d65 6e74 2e73 686f 7274 6e61  _element.shortna
-00068800: 6d65 290d 0a20 2020 2020 2020 2065 6c69  me)..        eli
-00068810: 6620 7365 6c66 2e69 735f 696e 5f73 656c  f self.is_in_sel
-00068820: 6620 616e 6420 7365 6c66 2e69 735f 696e  f and self.is_in
-00068830: 5f6f 7468 6572 3a0d 0a20 2020 2020 2020  _other:..       
-00068840: 2020 2020 2069 6620 7365 6c66 2e73 7472       if self.str
-00068850: 7563 7475 7265 5f65 6c65 6d65 6e74 2e6c  ucture_element.l
-00068860: 6f6e 676e 616d 6520 3d3d 2073 656c 662e  ongname == self.
-00068870: 6f74 6865 725f 7374 7275 6374 7572 655f  other_structure_
-00068880: 656c 656d 656e 742e 6c6f 6e67 6e61 6d65  element.longname
-00068890: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000688a0: 2020 2070 7269 6e74 5f73 7472 696e 6720     print_string 
-000688b0: 3d20 696e 6465 6e74 2a27 2020 272b 277b  = indent*'  '+'{
-000688c0: 3a6c 6c75 2e73 686f 7274 6e61 6d65 5f73  :llu.shortname_s
-000688d0: 697a 657d 207b 7d20 7b3a 6c6c 752e 7368  ize} {} {:llu.sh
-000688e0: 6f72 746e 616d 655f 7369 7a65 7d20 2020  ortname_size}   
-000688f0: 2020 2020 2020 2020 2020 207b 7d27 2e66             {}'.f
-00068900: 6f72 6d61 7428 7365 6c66 2e73 7472 7563  ormat(self.struc
-00068910: 7475 7265 5f65 6c65 6d65 6e74 2e73 686f  ture_element.sho
-00068920: 7274 6e61 6d65 2c73 656c 662e 6f70 2c73  rtname,self.op,s
-00068930: 656c 662e 6f74 6865 725f 7374 7275 6374  elf.other_struct
-00068940: 7572 655f 656c 656d 656e 742e 7368 6f72  ure_element.shor
-00068950: 746e 616d 652c 7365 6c66 2e73 7472 7563  tname,self.struc
-00068960: 7475 7265 5f65 6c65 6d65 6e74 2e6c 6f6e  ture_element.lon
-00068970: 676e 616d 6529 0d0a 2020 2020 2020 2020  gname)..        
-00068980: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
-00068990: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000689a0: 5f73 7472 696e 6720 3d20 696e 6465 6e74  _string = indent
-000689b0: 2a27 2020 272b 277b 3a6c 6c75 2e73 686f  *'  '+'{:llu.sho
-000689c0: 7274 6e61 6d65 5f73 697a 657d 207b 7d20  rtname_size} {} 
-000689d0: 7b3a 6c6c 752e 7368 6f72 746e 616d 655f  {:llu.shortname_
-000689e0: 7369 7a65 7d20 2020 2020 2020 2020 2020  size}           
-000689f0: 2020 207b 7d20 2f20 7b7d 272e 666f 726d     {} / {}'.form
-00068a00: 6174 2873 656c 662e 7374 7275 6374 7572  at(self.structur
-00068a10: 655f 656c 656d 656e 742e 7368 6f72 746e  e_element.shortn
-00068a20: 616d 652c 7365 6c66 2e6f 702c 7365 6c66  ame,self.op,self
-00068a30: 2e6f 7468 6572 5f73 7472 7563 7475 7265  .other_structure
-00068a40: 5f65 6c65 6d65 6e74 2e73 686f 7274 6e61  _element.shortna
-00068a50: 6d65 2c73 656c 662e 7374 7275 6374 7572  me,self.structur
-00068a60: 655f 656c 656d 656e 742e 6c6f 6e67 6e61  e_element.longna
-00068a70: 6d65 2c20 7365 6c66 2e6f 7468 6572 5f73  me, self.other_s
-00068a80: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00068a90: 2e6c 6f6e 676e 616d 6529 0d0a 0d0a 2020  .longname)....  
-00068aa0: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-00068ab0: 6973 5f69 6e5f 7365 6c66 3a0d 0a20 2020  is_in_self:..   
-00068ac0: 2020 2020 2020 2020 2070 7269 6e74 5f73           print_s
-00068ad0: 7472 696e 6720 3d20 696e 6465 6e74 2a27  tring = indent*'
-00068ae0: 2020 272b 277b 3a6c 6c75 2e73 686f 7274    '+'{:llu.short
-00068af0: 6e61 6d65 5f73 697a 657d 207b 7d20 2020  name_size} {}   
-00068b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00068b10: 2020 2020 2020 7b7d 272e 666f 726d 6174        {}'.format
-00068b20: 2873 656c 662e 7374 7275 6374 7572 655f  (self.structure_
-00068b30: 656c 656d 656e 742e 7368 6f72 746e 616d  element.shortnam
-00068b40: 652c 7365 6c66 2e6f 702c 7365 6c66 2e73  e,self.op,self.s
-00068b50: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00068b60: 2e6c 6f6e 676e 616d 6529 0d0a 0d0a 2020  .longname)....  
-00068b70: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
-00068b80: 6973 5f69 6e5f 6f74 6865 723a 0d0a 2020  is_in_other:..  
-00068b90: 2020 2020 2020 2020 2020 7072 696e 745f            print_
-00068ba0: 7374 7269 6e67 203d 2069 6e64 656e 742a  string = indent*
-00068bb0: 2720 2027 2b27 2020 2020 2020 2020 2020  '  '+'          
-00068bc0: 207b 7d20 7b3a 6c6c 752e 7368 6f72 746e   {} {:llu.shortn
-00068bd0: 616d 655f 7369 7a65 7d20 2020 2020 2020  ame_size}       
-00068be0: 2020 2020 2020 207b 7d27 2e66 6f72 6d61         {}'.forma
-00068bf0: 7428 7365 6c66 2e6f 702c 7365 6c66 2e73  t(self.op,self.s
-00068c00: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
-00068c10: 2e73 686f 7274 6e61 6d65 2c73 656c 662e  .shortname,self.
-00068c20: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-00068c30: 742e 6c6f 6e67 6e61 6d65 290d 0a0d 0a20  t.longname).... 
-00068c40: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00068c50: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00068c60: 696e 6465 6e74 2a27 2020 272c 273f 3f3f  indent*'  ','???
-00068c70: 3f27 2c73 656c 662e 6f70 2c73 656c 662e  ?',self.op,self.
-00068c80: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
-00068c90: 742e 7368 6f72 746e 616d 6529 0d0a 2020  t.shortname)..  
-00068ca0: 2020 2020 2020 2020 2020 6173 7365 7274            assert
-00068cb0: 2046 616c 7365 0d0a 0d0a 2020 2020 2020   False....      
-00068cc0: 2020 7072 696e 7428 7072 696e 745f 7374    print(print_st
-00068cd0: 7269 6e67 290d 0a0d 0a20 2020 2020 2020  ring)....       
-00068ce0: 2069 6620 6e6f 7420 2874 7269 6d5f 6571   if not (trim_eq
-00068cf0: 7561 6c20 616e 6420 7365 6c66 2e6f 7020  ual and self.op 
-00068d00: 3d3d 2027 3d27 293a 0d0a 2020 2020 2020  == '='):..      
-00068d10: 2020 2020 2020 666f 7220 7365 6320 696e        for sec in
-00068d20: 2073 656c 662e 636f 6d70 6172 6973 6f6e   self.comparison
-00068d30: 5f6c 6973 743a 0d0a 2020 2020 2020 2020  _list:..        
-00068d40: 2020 2020 2020 2020 7365 632e 7072 696e          sec.prin
-00068d50: 745f 636f 6d70 6172 6973 6f6e 2869 6e64  t_comparison(ind
-00068d60: 656e 7420 2b20 312c 7472 696d 5f65 7175  ent + 1,trim_equ
-00068d70: 616c 3d74 7269 6d5f 6571 7561 6c29 0d0a  al=trim_equal)..
-00068d80: 0d0a 2020 2020 2020 2020 2370 7269 6e74  ..        #print
-00068d90: 2028 6b2b 2027 5c74 272b 636f 6d70 2e74   (k+ '\t'+comp.t
-00068da0: 7261 6e73 6f70 290d 0a0d 0a20 2020 2064  ransop)....    d
-00068db0: 6566 2063 6f75 6e74 5f65 7175 616c 5f61  ef count_equal_a
-00068dc0: 6e64 5f74 6f74 616c 2873 656c 6629 3a0d  nd_total(self):.
-00068dd0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00068de0: 2e69 735f 696e 5f73 656c 6620 616e 6420  .is_in_self and 
-00068df0: 7365 6c66 2e69 735f 696e 5f6f 7468 6572  self.is_in_other
-00068e00: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-00068e10: 6f75 6e74 5f65 7175 616c 203d 2031 0d0a  ount_equal = 1..
-00068e20: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00067870: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00067880: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+00067890: 2323 2323 2323 2323 2323 2323 0d0a 0d0a  ############....
+000678a0: 636c 6173 7320 5374 7275 6374 7572 6545  class StructureE
+000678b0: 6c65 6d65 6e74 436f 6d70 6172 6973 6f6e  lementComparison
+000678c0: 286f 626a 6563 7429 3a0d 0a20 2020 2027  (object):..    '
+000678d0: 2727 4372 6561 7465 6420 6279 2061 2053  ''Created by a S
+000678e0: 7472 7563 7475 7265 456c 656d 656e 7420  tructureElement 
+000678f0: 6475 7269 6e67 2061 2063 6f6d 7061 7269  during a compari
+00067900: 736f 6e20 7769 7468 2061 6e6f 7468 6572  son with another
+00067910: 2053 7472 7563 7475 7265 456c 656d 656e   StructureElemen
+00067920: 7420 7769 7468 2068 656c 7066 756c 2027  t with helpful '
+00067930: 2727 0d0a 0d0a 2020 2020 234d 7573 7420  ''....    #Must 
+00067940: 6561 7369 6c79 2073 686f 7720 7570 2064  easily show up d
+00067950: 6966 6665 7265 6e63 6573 2c20 616e 6420  ifferences, and 
+00067960: 6372 6561 7465 206e 6963 656c 7920 666f  create nicely fo
+00067970: 726d 6174 7465 6420 6d65 7373 6167 6573  rmatted messages
+00067980: 0d0a 0d0a 2020 2020 2345 7373 656e 7469  ....    #Essenti
+00067990: 616c 6c79 2074 6865 206f 6e6c 7920 706f  ally the only po
+000679a0: 7373 6962 6c65 2064 6966 6665 7265 6e63  ssible differenc
+000679b0: 6573 2061 7265 2061 6464 6564 2c20 7265  es are added, re
+000679c0: 6d6f 7665 6420 6f72 2072 656f 7264 6572  moved or reorder
+000679d0: 6564 2063 6869 6c64 7265 6e0d 0a20 2020  ed children..   
+000679e0: 2023 416e 7974 6869 6e67 2077 6869 6368   #Anything which
+000679f0: 2069 7320 7468 6520 7361 6d65 2073 686f   is the same sho
+00067a00: 756c 6420 7361 7973 2073 6f20 7175 6963  uld says so quic
+00067a10: 6b6c 792c 2061 6e64 2074 6865 6e20 7765  kly, and then we
+00067a20: 2063 616e 2064 7269 6c6c 2064 6f77 6e20   can drill down 
+00067a30: 746f 2074 6865 2063 6869 6c64 7265 6e20  to the children 
+00067a40: 616e 6420 736f 206f 6e2e 2e2e 0d0a 0d0a  and so on.......
+00067a50: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00067a60: 2873 656c 662c 7374 7275 6374 7572 655f  (self,structure_
+00067a70: 656c 656d 656e 742c 6f74 6865 725f 7374  element,other_st
+00067a80: 7275 6374 7572 655f 656c 656d 656e 7429  ructure_element)
+00067a90: 3a0d 0a20 2020 2020 2020 2073 656c 662e  :..        self.
+00067aa0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+00067ab0: 7420 3d20 7374 7275 6374 7572 655f 656c  t = structure_el
+00067ac0: 656d 656e 740d 0a20 2020 2020 2020 2073  ement..        s
+00067ad0: 656c 662e 6f74 6865 725f 7374 7275 6374  elf.other_struct
+00067ae0: 7572 655f 656c 656d 656e 7420 3d20 6f74  ure_element = ot
+00067af0: 6865 725f 7374 7275 6374 7572 655f 656c  her_structure_el
+00067b00: 656d 656e 740d 0a20 2020 2020 2020 2073  ement..        s
+00067b10: 656c 662e 636f 6d70 6172 6973 6f6e 5f6c  elf.comparison_l
+00067b20: 6973 7420 2020 3d20 5b5d 0d0a 2020 2020  ist   = []..    
+00067b30: 2020 2020 7365 6c66 2e69 735f 696e 5f73      self.is_in_s
+00067b40: 656c 6620 2020 2020 2020 203d 204e 6f6e  elf        = Non
+00067b50: 650d 0a20 2020 2020 2020 2073 656c 662e  e..        self.
+00067b60: 6973 5f69 6e5f 6f74 6865 7220 2020 2020  is_in_other     
+00067b70: 2020 3d20 4e6f 6e65 0d0a 2020 2020 2020    = None..      
+00067b80: 2020 7365 6c66 2e6f 7020 3d20 4e6f 6e65    self.op = None
+00067b90: 0d0a 0d0a 2020 2020 4070 726f 7065 7274  ....    @propert
+00067ba0: 790d 0a20 2020 2064 6566 2073 616d 6528  y..    def same(
+00067bb0: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
+00067bc0: 2727 2752 6574 7572 6e20 5472 7565 2069  '''Return True i
+00067bd0: 6620 7468 6572 6520 6973 206e 6f20 6469  f there is no di
+00067be0: 6666 6572 656e 6365 2062 6574 7765 656e  fference between
+00067bf0: 2074 6865 2073 7472 7563 7475 7265 2065   the structure e
+00067c00: 6c65 6d65 6e74 7327 2727 0d0a 2020 2020  lements'''..    
+00067c10: 2020 2020 6966 206e 6f74 2028 7365 6c66      if not (self
+00067c20: 2e69 735f 696e 5f73 656c 6620 616e 6420  .is_in_self and 
+00067c30: 7365 6c66 2e69 735f 696e 5f6f 7468 6572  self.is_in_other
+00067c40: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
+00067c50: 7265 7475 726e 2046 616c 7365 0d0a 0d0a  return False....
+00067c60: 2020 2020 2020 2020 666f 7220 6320 696e          for c in
+00067c70: 2073 656c 662e 636f 6d70 6172 6973 6f6e   self.comparison
+00067c80: 5f6c 6973 743a 0d0a 2020 2020 2020 2020  _list:..        
+00067c90: 2020 2020 6966 206e 6f74 2063 2e73 616d      if not c.sam
+00067ca0: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00067cb0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00067cc0: 0d0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00067cd0: 2054 7275 650d 0a0d 0a20 2020 2064 6566   True....    def
+00067ce0: 206e 6577 5f6c 6561 665f 7374 7269 6e67   new_leaf_string
+00067cf0: 7328 7365 6c66 293a 0d0a 2020 2020 2020  s(self):..      
+00067d00: 2020 666f 7220 7365 2069 6e20 7365 6c66    for se in self
+00067d10: 2e6e 6577 5f65 6c65 6d65 6e74 733a 0d0a  .new_elements:..
+00067d20: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00067d30: 652e 6973 5f6c 6561 663a 0d0a 2020 2020  e.is_leaf:..    
+00067d40: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+00067d50: 6420 277b 3a34 307d 203a 3a20 7b7d 272e  d '{:40} :: {}'.
+00067d60: 666f 726d 6174 2873 652e 6c6f 6e67 6e61  format(se.longna
+00067d70: 6d65 2c20 7365 2e73 7472 696e 675f 746f  me, se.string_to
+00067d80: 5f72 6f6f 7429 0d0a 0d0a 2020 2020 6465  _root)....    de
+00067d90: 6620 6e65 775f 6e6f 6e6c 6561 665f 7374  f new_nonleaf_st
+00067da0: 7269 6e67 7328 7365 6c66 293a 0d0a 2020  rings(self):..  
+00067db0: 2020 2020 2020 666f 7220 7365 2069 6e20        for se in 
+00067dc0: 7365 6c66 2e6e 6577 5f65 6c65 6d65 6e74  self.new_element
+00067dd0: 733a 0d0a 2020 2020 2020 2020 2020 2020  s:..            
+00067de0: 6966 206e 6f74 2073 652e 6973 5f6c 6561  if not se.is_lea
+00067df0: 663a 0d0a 2020 2020 2020 2020 2020 2020  f:..            
+00067e00: 2020 2020 7969 656c 6420 277b 3a35 307d      yield '{:50}
+00067e10: 203a 3a20 7b7d 272e 666f 726d 6174 2873   :: {}'.format(s
+00067e20: 652e 6c6f 6e67 6e61 6d65 2c20 7365 2e73  e.longname, se.s
+00067e30: 7472 696e 675f 746f 5f72 6f6f 7429 0d0a  tring_to_root)..
+00067e40: 0d0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
+00067e50: 645f 6c65 6166 5f73 7472 696e 6773 2873  d_leaf_strings(s
+00067e60: 656c 6629 3a0d 0a20 2020 2020 2020 2066  elf):..        f
+00067e70: 6f72 2073 6520 696e 2073 656c 662e 7265  or se in self.re
+00067e80: 6d6f 7665 645f 656c 656d 656e 7473 3a0d  moved_elements:.
+00067e90: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00067ea0: 7365 2e69 735f 6c65 6166 3a0d 0a20 2020  se.is_leaf:..   
+00067eb0: 2020 2020 2020 2020 2020 2020 2079 6965               yie
+00067ec0: 6c64 2027 7b3a 3430 7d20 3a3a 207b 7d27  ld '{:40} :: {}'
+00067ed0: 2e66 6f72 6d61 7428 7365 2e6c 6f6e 676e  .format(se.longn
+00067ee0: 616d 652c 2073 652e 7374 7269 6e67 5f74  ame, se.string_t
+00067ef0: 6f5f 726f 6f74 290d 0a0d 0a20 2020 2064  o_root)....    d
+00067f00: 6566 2072 656d 6f76 6564 5f6e 6f6e 6c65  ef removed_nonle
+00067f10: 6166 5f73 7472 696e 6773 2873 656c 6629  af_strings(self)
+00067f20: 3a0d 0a20 2020 2020 2020 2066 6f72 2073  :..        for s
+00067f30: 6520 696e 2073 656c 662e 7265 6d6f 7665  e in self.remove
+00067f40: 645f 656c 656d 656e 7473 3a0d 0a20 2020  d_elements:..   
+00067f50: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00067f60: 7365 2e69 735f 6c65 6166 3a0d 0a20 2020  se.is_leaf:..   
+00067f70: 2020 2020 2020 2020 2020 2020 2079 6965               yie
+00067f80: 6c64 2027 7b3a 3530 7d20 3a3a 207b 7d27  ld '{:50} :: {}'
+00067f90: 2e66 6f72 6d61 7428 7365 2e6c 6f6e 676e  .format(se.longn
+00067fa0: 616d 652c 2073 652e 7374 7269 6e67 5f74  ame, se.string_t
+00067fb0: 6f5f 726f 6f74 290d 0a0d 0a20 2020 2064  o_root)....    d
+00067fc0: 6566 2064 6966 665f 7374 7269 6e67 7328  ef diff_strings(
+00067fd0: 7365 6c66 2c69 6e64 656e 7420 3d20 302c  self,indent = 0,
+00067fe0: 7472 696d 5f65 7175 616c 203d 2046 616c  trim_equal = Fal
+00067ff0: 7365 293a 0d0a 0d0a 2020 2020 2020 2020  se):....        
+00068000: 7072 696e 745f 7374 7269 6e67 203d 2027  print_string = '
+00068010: 270d 0a0d 0a20 2020 2020 2020 2069 6620  '....        if 
+00068020: 7365 6c66 2e69 735f 696e 5f73 656c 6620  self.is_in_self 
+00068030: 6973 204e 6f6e 6520 616e 6420 7365 6c66  is None and self
+00068040: 2e69 735f 696e 5f6f 7468 6572 2069 7320  .is_in_other is 
+00068050: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+00068060: 2020 2023 4669 7273 7420 656c 656d 656e     #First elemen
+00068070: 7420 2d20 746f 7020 6c65 7665 6c0d 0a20  t - top level.. 
+00068080: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00068090: 5f73 7472 696e 6720 3d20 277b 3a6c 6c75  _string = '{:llu
+000680a0: 2e73 686f 7274 6e61 6d65 5f73 697a 657d  .shortname_size}
+000680b0: 2058 2020 7b3a 6c6c 752e 7368 6f72 746e   X  {:llu.shortn
+000680c0: 616d 655f 7369 7a65 7d27 2e66 6f72 6d61  ame_size}'.forma
+000680d0: 7428 7365 6c66 2e73 7472 7563 7475 7265  t(self.structure
+000680e0: 5f65 6c65 6d65 6e74 2e73 686f 7274 6e61  _element.shortna
+000680f0: 6d65 2c20 7365 6c66 2e6f 7468 6572 5f73  me, self.other_s
+00068100: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+00068110: 2e73 686f 7274 6e61 6d65 290d 0a20 2020  .shortname)..   
+00068120: 2020 2020 2065 6c69 6620 7365 6c66 2e69       elif self.i
+00068130: 735f 696e 5f73 656c 6620 616e 6420 7365  s_in_self and se
+00068140: 6c66 2e69 735f 696e 5f6f 7468 6572 3a0d  lf.is_in_other:.
+00068150: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00068160: 7365 6c66 2e73 7472 7563 7475 7265 5f65  self.structure_e
+00068170: 6c65 6d65 6e74 2e6c 6f6e 676e 616d 6520  lement.longname 
+00068180: 3d3d 2073 656c 662e 6f74 6865 725f 7374  == self.other_st
+00068190: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
+000681a0: 6c6f 6e67 6e61 6d65 3a0d 0a20 2020 2020  longname:..     
+000681b0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000681c0: 5f73 7472 696e 6720 3d20 696e 6465 6e74  _string = indent
+000681d0: 2a27 2020 272b 277b 3a6c 6c75 2e73 686f  *'  '+'{:llu.sho
+000681e0: 7274 6e61 6d65 5f73 697a 657d 207b 7d20  rtname_size} {} 
+000681f0: 7b3a 6c6c 752e 7368 6f72 746e 616d 655f  {:llu.shortname_
+00068200: 7369 7a65 7d20 2020 2020 2020 2020 2020  size}           
+00068210: 2020 207b 7d27 2e66 6f72 6d61 7428 7365     {}'.format(se
+00068220: 6c66 2e73 7472 7563 7475 7265 5f65 6c65  lf.structure_ele
+00068230: 6d65 6e74 2e73 686f 7274 6e61 6d65 2c73  ment.shortname,s
+00068240: 656c 662e 6f70 2c73 656c 662e 6f74 6865  elf.op,self.othe
+00068250: 725f 7374 7275 6374 7572 655f 656c 656d  r_structure_elem
+00068260: 656e 742e 7368 6f72 746e 616d 652c 7365  ent.shortname,se
+00068270: 6c66 2e73 7472 7563 7475 7265 5f65 6c65  lf.structure_ele
+00068280: 6d65 6e74 2e6c 6f6e 676e 616d 6529 0d0a  ment.longname)..
+00068290: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000682a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000682b0: 2020 2070 7269 6e74 5f73 7472 696e 6720     print_string 
+000682c0: 3d20 696e 6465 6e74 2a27 2020 272b 277b  = indent*'  '+'{
+000682d0: 3a6c 6c75 2e73 686f 7274 6e61 6d65 5f73  :llu.shortname_s
+000682e0: 697a 657d 207b 7d20 7b3a 6c6c 752e 7368  ize} {} {:llu.sh
+000682f0: 6f72 746e 616d 655f 7369 7a65 7d20 2020  ortname_size}   
+00068300: 2020 2020 2020 2020 2020 207b 7d20 2f20             {} / 
+00068310: 7b7d 272e 666f 726d 6174 2873 656c 662e  {}'.format(self.
+00068320: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+00068330: 742e 7368 6f72 746e 616d 652c 7365 6c66  t.shortname,self
+00068340: 2e6f 702c 7365 6c66 2e6f 7468 6572 5f73  .op,self.other_s
+00068350: 7472 7563 7475 7265 5f65 6c65 6d65 6e74  tructure_element
+00068360: 2e73 686f 7274 6e61 6d65 2c73 656c 662e  .shortname,self.
+00068370: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+00068380: 742e 6c6f 6e67 6e61 6d65 2c20 7365 6c66  t.longname, self
+00068390: 2e6f 7468 6572 5f73 7472 7563 7475 7265  .other_structure
+000683a0: 5f65 6c65 6d65 6e74 2e6c 6f6e 676e 616d  _element.longnam
+000683b0: 6529 0d0a 0d0a 2020 2020 2020 2020 656c  e)....        el
+000683c0: 6966 2073 656c 662e 6973 5f69 6e5f 7365  if self.is_in_se
+000683d0: 6c66 3a0d 0a20 2020 2020 2020 2020 2020  lf:..           
+000683e0: 2070 7269 6e74 5f73 7472 696e 6720 3d20   print_string = 
+000683f0: 696e 6465 6e74 2a27 2020 272b 277b 3a6c  indent*'  '+'{:l
+00068400: 6c75 2e73 686f 7274 6e61 6d65 5f73 697a  lu.shortname_siz
+00068410: 657d 207b 7d20 2020 2020 2020 2020 2020  e} {}           
+00068420: 2020 2020 2020 2020 2020 2020 2020 7b7d                {}
+00068430: 272e 666f 726d 6174 2873 656c 662e 7374  '.format(self.st
+00068440: 7275 6374 7572 655f 656c 656d 656e 742e  ructure_element.
+00068450: 7368 6f72 746e 616d 652c 7365 6c66 2e6f  shortname,self.o
+00068460: 702c 7365 6c66 2e73 7472 7563 7475 7265  p,self.structure
+00068470: 5f65 6c65 6d65 6e74 2e6c 6f6e 676e 616d  _element.longnam
+00068480: 6529 0d0a 0d0a 2020 2020 2020 2020 656c  e)....        el
+00068490: 6966 2073 656c 662e 6973 5f69 6e5f 6f74  if self.is_in_ot
+000684a0: 6865 723a 0d0a 2020 2020 2020 2020 2020  her:..          
+000684b0: 2020 7072 696e 745f 7374 7269 6e67 203d    print_string =
+000684c0: 2069 6e64 656e 742a 2720 2027 2b27 2020   indent*'  '+'  
+000684d0: 2020 2020 2020 2020 207b 7d20 7b3a 6c6c           {} {:ll
+000684e0: 752e 7368 6f72 746e 616d 655f 7369 7a65  u.shortname_size
+000684f0: 7d20 2020 2020 2020 2020 2020 2020 207b  }              {
+00068500: 7d27 2e66 6f72 6d61 7428 7365 6c66 2e6f  }'.format(self.o
+00068510: 702c 7365 6c66 2e73 7472 7563 7475 7265  p,self.structure
+00068520: 5f65 6c65 6d65 6e74 2e73 686f 7274 6e61  _element.shortna
+00068530: 6d65 2c73 656c 662e 7374 7275 6374 7572  me,self.structur
+00068540: 655f 656c 656d 656e 742e 6c6f 6e67 6e61  e_element.longna
+00068550: 6d65 290d 0a0d 0a20 2020 2020 2020 2065  me)....        e
+00068560: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00068570: 2020 7072 696e 7428 696e 6465 6e74 2a27    print(indent*'
+00068580: 2020 272c 273f 3f3f 3f27 2c73 656c 662e    ','????',self.
+00068590: 6f70 2c73 656c 662e 7374 7275 6374 7572  op,self.structur
+000685a0: 655f 656c 656d 656e 742e 7368 6f72 746e  e_element.shortn
+000685b0: 616d 6529 0d0a 2020 2020 2020 2020 2020  ame)..          
+000685c0: 2020 6173 7365 7274 2046 616c 7365 0d0a    assert False..
+000685d0: 0d0a 2020 2020 2020 2020 7969 656c 6420  ..        yield 
+000685e0: 7072 696e 745f 7374 7269 6e67 0d0a 0d0a  print_string....
+000685f0: 2020 2020 2020 2020 6966 206e 6f74 2028          if not (
+00068600: 7472 696d 5f65 7175 616c 2061 6e64 2073  trim_equal and s
+00068610: 656c 662e 6f70 203d 3d20 273d 2729 3a0d  elf.op == '='):.
+00068620: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00068630: 2073 6563 2069 6e20 7365 6c66 2e63 6f6d   sec in self.com
+00068640: 7061 7269 736f 6e5f 6c69 7374 3a0d 0a20  parison_list:.. 
+00068650: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00068660: 6965 6c64 2066 726f 6d20 7365 632e 6469  ield from sec.di
+00068670: 6666 5f73 7472 696e 6773 2869 6e64 656e  ff_strings(inden
+00068680: 7420 2b20 312c 7472 696d 5f65 7175 616c  t + 1,trim_equal
+00068690: 3d74 7269 6d5f 6571 7561 6c29 0d0a 0d0a  =trim_equal)....
+000686a0: 2020 2020 2020 2020 2370 7269 6e74 2028          #print (
+000686b0: 6b2b 2027 5c74 272b 636f 6d70 2e74 7261  k+ '\t'+comp.tra
+000686c0: 6e73 6f70 290d 0a0d 0a0d 0a20 2020 2064  nsop)......    d
+000686d0: 6566 2070 7269 6e74 5f63 6f6d 7061 7269  ef print_compari
+000686e0: 736f 6e28 7365 6c66 2c69 6e64 656e 7420  son(self,indent 
+000686f0: 3d20 302c 7472 696d 5f65 7175 616c 203d  = 0,trim_equal =
+00068700: 2046 616c 7365 293a 0d0a 0d0a 2020 2020   False):....    
+00068710: 2020 2020 7072 696e 745f 7374 7269 6e67      print_string
+00068720: 203d 2027 270d 0a0d 0a20 2020 2020 2020   = ''....       
+00068730: 2069 6620 7365 6c66 2e69 735f 696e 5f73   if self.is_in_s
+00068740: 656c 6620 6973 204e 6f6e 6520 616e 6420  elf is None and 
+00068750: 7365 6c66 2e69 735f 696e 5f6f 7468 6572  self.is_in_other
+00068760: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00068770: 2020 2020 2020 2023 4669 7273 7420 656c         #First el
+00068780: 656d 656e 7420 2d20 746f 7020 6c65 7665  ement - top leve
+00068790: 6c0d 0a20 2020 2020 2020 2020 2020 2070  l..            p
+000687a0: 7269 6e74 5f73 7472 696e 6720 3d20 277b  rint_string = '{
+000687b0: 3a6c 6c75 2e73 686f 7274 6e61 6d65 5f73  :llu.shortname_s
+000687c0: 697a 657d 2058 2020 7b3a 6c6c 752e 7368  ize} X  {:llu.sh
+000687d0: 6f72 746e 616d 655f 7369 7a65 7d27 2e66  ortname_size}'.f
+000687e0: 6f72 6d61 7428 7365 6c66 2e73 7472 7563  ormat(self.struc
+000687f0: 7475 7265 5f65 6c65 6d65 6e74 2e73 686f  ture_element.sho
+00068800: 7274 6e61 6d65 2c20 7365 6c66 2e6f 7468  rtname, self.oth
+00068810: 6572 5f73 7472 7563 7475 7265 5f65 6c65  er_structure_ele
+00068820: 6d65 6e74 2e73 686f 7274 6e61 6d65 290d  ment.shortname).
+00068830: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
+00068840: 6c66 2e69 735f 696e 5f73 656c 6620 616e  lf.is_in_self an
+00068850: 6420 7365 6c66 2e69 735f 696e 5f6f 7468  d self.is_in_oth
+00068860: 6572 3a0d 0a20 2020 2020 2020 2020 2020  er:..           
+00068870: 2069 6620 7365 6c66 2e73 7472 7563 7475   if self.structu
+00068880: 7265 5f65 6c65 6d65 6e74 2e6c 6f6e 676e  re_element.longn
+00068890: 616d 6520 3d3d 2073 656c 662e 6f74 6865  ame == self.othe
+000688a0: 725f 7374 7275 6374 7572 655f 656c 656d  r_structure_elem
+000688b0: 656e 742e 6c6f 6e67 6e61 6d65 3a0d 0a20  ent.longname:.. 
+000688c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000688d0: 7269 6e74 5f73 7472 696e 6720 3d20 696e  rint_string = in
+000688e0: 6465 6e74 2a27 2020 272b 277b 3a6c 6c75  dent*'  '+'{:llu
+000688f0: 2e73 686f 7274 6e61 6d65 5f73 697a 657d  .shortname_size}
+00068900: 207b 7d20 7b3a 6c6c 752e 7368 6f72 746e   {} {:llu.shortn
+00068910: 616d 655f 7369 7a65 7d20 2020 2020 2020  ame_size}       
+00068920: 2020 2020 2020 207b 7d27 2e66 6f72 6d61         {}'.forma
+00068930: 7428 7365 6c66 2e73 7472 7563 7475 7265  t(self.structure
+00068940: 5f65 6c65 6d65 6e74 2e73 686f 7274 6e61  _element.shortna
+00068950: 6d65 2c73 656c 662e 6f70 2c73 656c 662e  me,self.op,self.
+00068960: 6f74 6865 725f 7374 7275 6374 7572 655f  other_structure_
+00068970: 656c 656d 656e 742e 7368 6f72 746e 616d  element.shortnam
+00068980: 652c 7365 6c66 2e73 7472 7563 7475 7265  e,self.structure
+00068990: 5f65 6c65 6d65 6e74 2e6c 6f6e 676e 616d  _element.longnam
+000689a0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000689b0: 656c 7365 3a0d 0a20 2020 2020 2020 2020  else:..         
+000689c0: 2020 2020 2020 2070 7269 6e74 5f73 7472         print_str
+000689d0: 696e 6720 3d20 696e 6465 6e74 2a27 2020  ing = indent*'  
+000689e0: 272b 277b 3a6c 6c75 2e73 686f 7274 6e61  '+'{:llu.shortna
+000689f0: 6d65 5f73 697a 657d 207b 7d20 7b3a 6c6c  me_size} {} {:ll
+00068a00: 752e 7368 6f72 746e 616d 655f 7369 7a65  u.shortname_size
+00068a10: 7d20 2020 2020 2020 2020 2020 2020 207b  }              {
+00068a20: 7d20 2f20 7b7d 272e 666f 726d 6174 2873  } / {}'.format(s
+00068a30: 656c 662e 7374 7275 6374 7572 655f 656c  elf.structure_el
+00068a40: 656d 656e 742e 7368 6f72 746e 616d 652c  ement.shortname,
+00068a50: 7365 6c66 2e6f 702c 7365 6c66 2e6f 7468  self.op,self.oth
+00068a60: 6572 5f73 7472 7563 7475 7265 5f65 6c65  er_structure_ele
+00068a70: 6d65 6e74 2e73 686f 7274 6e61 6d65 2c73  ment.shortname,s
+00068a80: 656c 662e 7374 7275 6374 7572 655f 656c  elf.structure_el
+00068a90: 656d 656e 742e 6c6f 6e67 6e61 6d65 2c20  ement.longname, 
+00068aa0: 7365 6c66 2e6f 7468 6572 5f73 7472 7563  self.other_struc
+00068ab0: 7475 7265 5f65 6c65 6d65 6e74 2e6c 6f6e  ture_element.lon
+00068ac0: 676e 616d 6529 0d0a 0d0a 2020 2020 2020  gname)....      
+00068ad0: 2020 656c 6966 2073 656c 662e 6973 5f69    elif self.is_i
+00068ae0: 6e5f 7365 6c66 3a0d 0a20 2020 2020 2020  n_self:..       
+00068af0: 2020 2020 2070 7269 6e74 5f73 7472 696e       print_strin
+00068b00: 6720 3d20 696e 6465 6e74 2a27 2020 272b  g = indent*'  '+
+00068b10: 277b 3a6c 6c75 2e73 686f 7274 6e61 6d65  '{:llu.shortname
+00068b20: 5f73 697a 657d 207b 7d20 2020 2020 2020  _size} {}       
+00068b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00068b40: 2020 7b7d 272e 666f 726d 6174 2873 656c    {}'.format(sel
+00068b50: 662e 7374 7275 6374 7572 655f 656c 656d  f.structure_elem
+00068b60: 656e 742e 7368 6f72 746e 616d 652c 7365  ent.shortname,se
+00068b70: 6c66 2e6f 702c 7365 6c66 2e73 7472 7563  lf.op,self.struc
+00068b80: 7475 7265 5f65 6c65 6d65 6e74 2e6c 6f6e  ture_element.lon
+00068b90: 676e 616d 6529 0d0a 0d0a 2020 2020 2020  gname)....      
+00068ba0: 2020 656c 6966 2073 656c 662e 6973 5f69    elif self.is_i
+00068bb0: 6e5f 6f74 6865 723a 0d0a 2020 2020 2020  n_other:..      
+00068bc0: 2020 2020 2020 7072 696e 745f 7374 7269        print_stri
+00068bd0: 6e67 203d 2069 6e64 656e 742a 2720 2027  ng = indent*'  '
+00068be0: 2b27 2020 2020 2020 2020 2020 207b 7d20  +'           {} 
+00068bf0: 7b3a 6c6c 752e 7368 6f72 746e 616d 655f  {:llu.shortname_
+00068c00: 7369 7a65 7d20 2020 2020 2020 2020 2020  size}           
+00068c10: 2020 207b 7d27 2e66 6f72 6d61 7428 7365     {}'.format(se
+00068c20: 6c66 2e6f 702c 7365 6c66 2e73 7472 7563  lf.op,self.struc
+00068c30: 7475 7265 5f65 6c65 6d65 6e74 2e73 686f  ture_element.sho
+00068c40: 7274 6e61 6d65 2c73 656c 662e 7374 7275  rtname,self.stru
+00068c50: 6374 7572 655f 656c 656d 656e 742e 6c6f  cture_element.lo
+00068c60: 6e67 6e61 6d65 290d 0a0d 0a20 2020 2020  ngname)....     
+00068c70: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00068c80: 2020 2020 2020 7072 696e 7428 696e 6465        print(inde
+00068c90: 6e74 2a27 2020 272c 273f 3f3f 3f27 2c73  nt*'  ','????',s
+00068ca0: 656c 662e 6f70 2c73 656c 662e 7374 7275  elf.op,self.stru
+00068cb0: 6374 7572 655f 656c 656d 656e 742e 7368  cture_element.sh
+00068cc0: 6f72 746e 616d 6529 0d0a 2020 2020 2020  ortname)..      
+00068cd0: 2020 2020 2020 6173 7365 7274 2046 616c        assert Fal
+00068ce0: 7365 0d0a 0d0a 2020 2020 2020 2020 7072  se....        pr
+00068cf0: 696e 7428 7072 696e 745f 7374 7269 6e67  int(print_string
+00068d00: 290d 0a0d 0a20 2020 2020 2020 2069 6620  )....        if 
+00068d10: 6e6f 7420 2874 7269 6d5f 6571 7561 6c20  not (trim_equal 
+00068d20: 616e 6420 7365 6c66 2e6f 7020 3d3d 2027  and self.op == '
+00068d30: 3d27 293a 0d0a 2020 2020 2020 2020 2020  ='):..          
+00068d40: 2020 666f 7220 7365 6320 696e 2073 656c    for sec in sel
+00068d50: 662e 636f 6d70 6172 6973 6f6e 5f6c 6973  f.comparison_lis
+00068d60: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
+00068d70: 2020 2020 7365 632e 7072 696e 745f 636f      sec.print_co
+00068d80: 6d70 6172 6973 6f6e 2869 6e64 656e 7420  mparison(indent 
+00068d90: 2b20 312c 7472 696d 5f65 7175 616c 3d74  + 1,trim_equal=t
+00068da0: 7269 6d5f 6571 7561 6c29 0d0a 0d0a 2020  rim_equal)....  
+00068db0: 2020 2020 2020 2370 7269 6e74 2028 6b2b        #print (k+
+00068dc0: 2027 5c74 272b 636f 6d70 2e74 7261 6e73   '\t'+comp.trans
+00068dd0: 6f70 290d 0a0d 0a20 2020 2064 6566 2063  op)....    def c
+00068de0: 6f75 6e74 5f65 7175 616c 5f61 6e64 5f74  ount_equal_and_t
+00068df0: 6f74 616c 2873 656c 6629 3a0d 0a20 2020  otal(self):..   
+00068e00: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+00068e10: 696e 5f73 656c 6620 616e 6420 7365 6c66  in_self and self
+00068e20: 2e69 735f 696e 5f6f 7468 6572 3a0d 0a20  .is_in_other:.. 
 00068e30: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
-00068e40: 5f65 7175 616c 203d 2030 0d0a 0d0a 2020  _equal = 0....  
-00068e50: 2020 2020 2020 636f 756e 745f 746f 7461        count_tota
-00068e60: 6c20 3d20 310d 0a0d 0a20 2020 2020 2020  l = 1....       
-00068e70: 2066 6f72 2063 6f6d 7020 696e 2073 656c   for comp in sel
-00068e80: 662e 636f 6d70 6172 6973 6f6e 5f6c 6973  f.comparison_lis
-00068e90: 743a 0d0a 2020 2020 2020 2020 2020 2020  t:..            
-00068ea0: 6368 696c 645f 636f 756e 745f 6571 7561  child_count_equa
-00068eb0: 6c2c 2063 6869 6c64 5f63 6f75 6e74 5f74  l, child_count_t
-00068ec0: 6f74 616c 203d 2063 6f6d 702e 636f 756e  otal = comp.coun
-00068ed0: 745f 6571 7561 6c5f 616e 645f 746f 7461  t_equal_and_tota
-00068ee0: 6c28 290d 0a20 2020 2020 2020 2020 2020  l()..           
-00068ef0: 2063 6f75 6e74 5f65 7175 616c 202b 3d20   count_equal += 
-00068f00: 6368 696c 645f 636f 756e 745f 6571 7561  child_count_equa
-00068f10: 6c0d 0a20 2020 2020 2020 2020 2020 2063  l..            c
-00068f20: 6f75 6e74 5f74 6f74 616c 202b 3d20 6368  ount_total += ch
-00068f30: 696c 645f 636f 756e 745f 746f 7461 6c0d  ild_count_total.
-00068f40: 0a0d 0a20 2020 2020 2020 2072 6574 7572  ...        retur
-00068f50: 6e20 636f 756e 745f 6571 7561 6c2c 2063  n count_equal, c
-00068f60: 6f75 6e74 5f74 6f74 616c 0d0a 0d0a 2020  ount_total....  
-00068f70: 2020 6465 6620 6164 645f 6361 6c63 756c    def add_calcul
-00068f80: 6174 696f 6e5f 636f 6d70 6172 6973 6f6e  ation_comparison
-00068f90: 2873 656c 662c 2070 7265 7669 6f75 735f  (self, previous_
-00068fa0: 6361 6c63 756c 6174 696f 6e5f 6c6f 6f6b  calculation_look
-00068fb0: 7570 293a 0d0a 2020 2020 2020 2020 2727  up):..        ''
-00068fc0: 270d 0a20 2020 2020 2020 2043 7265 6174  '..        Creat
-00068fd0: 6520 6120 636f 6d70 6172 6973 6f6e 2062  e a comparison b
-00068fe0: 6574 7765 656e 2070 7265 7669 6f75 7320  etween previous 
-00068ff0: 6361 6c63 756c 6174 696f 6e73 2061 6e64  calculations and
-00069000: 2066 696e 616c 2063 616c 6375 6c61 7469   final calculati
-00069010: 6f6e 730d 0a0d 0a20 2020 2020 2020 2052  ons....        R
-00069020: 6574 7572 6e73 2061 2064 6963 7469 6f6e  eturns a diction
-00069030: 6172 7920 6f66 207b 7368 6f72 7463 6f64  ary of {shortcod
-00069040: 653a 2028 6f6c 645f 6361 6c63 756c 6174  e: (old_calculat
-00069050: 696f 6e2c 206e 6577 5f63 616c 6375 6c61  ion, new_calcula
-00069060: 7469 6f6e 297d 0d0a 2020 2020 2020 2020  tion)}..        
-00069070: 2727 270d 0a0d 0a20 2020 2020 2020 2063  '''....        c
-00069080: 6861 6e67 6564 5f63 616c 6375 6c61 7469  hanged_calculati
-00069090: 6f6e 7320 3d20 7b7d 0d0a 0d0a 2020 2020  ons = {}....    
-000690a0: 2020 2020 234e 6f74 6520 2d20 6f74 6865      #Note - othe
-000690b0: 7220 7374 7275 6374 7572 6520 656c 656d  r structure elem
-000690c0: 656e 7420 6973 2075 7375 616c 6c79 2074  ent is usually t
-000690d0: 6865 2062 7569 6c74 2073 7472 7563 7475  he built structu
-000690e0: 7265 2065 6c65 6d65 6e74 2c20 7369 6e63  re element, sinc
-000690f0: 6520 7765 2061 7265 2063 6f6d 7061 7269  e we are compari
-00069100: 6e67 2070 7265 7669 6f75 7320 746f 206e  ng previous to n
-00069110: 6577 2077 6974 6820 7072 6576 696f 7573  ew with previous
-00069120: 2e63 6f6d 7061 7265 286e 6577 290d 0a20  .compare(new).. 
-00069130: 2020 2020 2020 2066 6f72 2073 6520 696e         for se in
-00069140: 2073 656c 662e 6f74 6865 725f 7374 7275   self.other_stru
-00069150: 6374 7572 655f 656c 656d 656e 742e 7761  cture_element.wa
-00069160: 6c6b 2829 3a0d 0a20 2020 2020 2020 2020  lk():..         
-00069170: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-00069180: 2020 2020 2020 2020 206f 6c64 5f63 616c           old_cal
-00069190: 6375 6c61 7469 6f6e 203d 2070 7265 7669  culation = previ
-000691a0: 6f75 735f 6361 6c63 756c 6174 696f 6e5f  ous_calculation_
-000691b0: 6c6f 6f6b 7570 5b73 652e 7368 6f72 7463  lookup[se.shortc
-000691c0: 6f64 655d 0d0a 2020 2020 2020 2020 2020  ode]..          
-000691d0: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
-000691e0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-000691f0: 2020 2020 6966 2073 652e 6361 6c63 756c      if se.calcul
-00069200: 6174 696f 6e20 6973 206e 6f74 204e 6f6e  ation is not Non
-00069210: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-00069220: 2020 2020 2020 2020 2354 6865 7265 2069          #There i
-00069230: 7320 6e6f 206f 6c64 2063 616c 6375 6c61  s no old calcula
-00069240: 7469 6f6e 202d 2073 6f20 7075 7420 696e  tion - so put in
-00069250: 2074 6865 206e 6577 2063 616c 6375 6c61   the new calcula
-00069260: 7469 6f6e 206f 6e6c 790d 0a20 2020 2020  tion only..     
-00069270: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00069280: 6861 6e67 6564 5f63 616c 6375 6c61 7469  hanged_calculati
-00069290: 6f6e 735b 7365 2e73 686f 7274 636f 6465  ons[se.shortcode
-000692a0: 5d20 3d20 284e 6f6e 652c 7365 2e63 616c  ] = (None,se.cal
-000692b0: 6375 6c61 7469 6f6e 290d 0a20 2020 2020  culation)..     
-000692c0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-000692d0: 6e75 650d 0a0d 0a20 2020 2020 2020 2020  nue....         
-000692e0: 2020 2023 4361 6c63 756c 6174 696f 6e73     #Calculations
-000692f0: 206d 6179 2068 6176 6520 6265 656e 2063   may have been c
-00069300: 7265 6174 6564 2028 6173 2061 2073 7472  reated (as a str
-00069310: 696e 6729 206f 7220 6265 2069 6e20 7468  ing) or be in th
-00069320: 6520 6f72 6967 696e 616c 2070 6879 7369  e original physi
-00069330: 6420 666f 726d 2065 7870 6f72 7465 6420  d form exported 
-00069340: 6672 6f6d 2045 6d70 6f77 6572 0d0a 2020  from Empower..  
-00069350: 2020 2020 2020 2020 2020 2357 6520 6e65            #We ne
-00069360: 6564 2074 6f20 6368 6563 6b20 6167 6169  ed to check agai
-00069370: 6e73 7420 626f 7468 0d0a 2020 2020 2020  nst both..      
-00069380: 2020 2020 2020 6e65 775f 6361 6c63 756c        new_calcul
-00069390: 6174 696f 6e20 3d20 7365 2e65 6c65 6d65  ation = se.eleme
-000693a0: 6e74 2e63 616c 6375 6c61 7469 6f6e 0d0a  nt.calculation..
-000693b0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-000693c0: 7068 7973 6964 5f63 616c 6375 6c61 7469  physid_calculati
-000693d0: 6f6e 203d 2073 652e 656c 656d 656e 742e  on = se.element.
-000693e0: 5f70 6879 7369 645f 6361 6c63 756c 6174  _physid_calculat
-000693f0: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
-00069400: 2023 4966 2074 6865 2063 616c 6375 6c61   #If the calcula
-00069410: 7469 6f6e 7320 6d61 7463 682c 2064 6f20  tions match, do 
-00069420: 6e6f 7468 696e 670d 0a20 2020 2020 2020  nothing..       
-00069430: 2020 2020 2069 6620 286f 6c64 5f63 616c       if (old_cal
-00069440: 6375 6c61 7469 6f6e 2069 7320 4e6f 6e65  culation is None
-00069450: 2061 6e64 206e 6577 5f63 616c 6375 6c61   and new_calcula
-00069460: 7469 6f6e 2069 7320 4e6f 6e65 2920 6f72  tion is None) or
-00069470: 2020 6f6c 645f 6361 6c63 756c 6174 696f    old_calculatio
-00069480: 6e20 3d3d 206e 6577 5f63 616c 6375 6c61  n == new_calcula
-00069490: 7469 6f6e 206f 7220 6f6c 645f 6361 6c63  tion or old_calc
-000694a0: 756c 6174 696f 6e20 3d3d 206e 6577 5f70  ulation == new_p
-000694b0: 6879 7369 645f 6361 6c63 756c 6174 696f  hysid_calculatio
-000694c0: 6e3a 0d0a 2020 2020 2020 2020 2020 2020  n:..            
-000694d0: 2020 2020 7061 7373 0d0a 2020 2020 2020      pass..      
-000694e0: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
-000694f0: 2020 2020 2020 2020 2020 2020 2023 4f74               #Ot
-00069500: 6865 7277 6973 652c 2072 6563 6f72 6420  herwise, record 
-00069510: 7468 6520 6368 616e 6765 6420 6361 6c63  the changed calc
-00069520: 756c 6174 696f 6e0d 0a20 2020 2020 2020  ulation..       
-00069530: 2020 2020 2020 2020 2063 6861 6e67 6564           changed
-00069540: 5f63 616c 6375 6c61 7469 6f6e 735b 7365  _calculations[se
-00069550: 2e73 686f 7274 636f 6465 5d20 3d20 286f  .shortcode] = (o
-00069560: 6c64 5f63 616c 6375 6c61 7469 6f6e 2c6e  ld_calculation,n
-00069570: 6577 5f63 616c 6375 6c61 7469 6f6e 290d  ew_calculation).
-00069580: 0a0d 0a20 2020 2020 2020 2073 656c 662e  ...        self.
-00069590: 6368 616e 6765 645f 6361 6c63 756c 6174  changed_calculat
-000695a0: 696f 6e73 203d 2063 6861 6e67 6564 5f63  ions = changed_c
-000695b0: 616c 6375 6c61 7469 6f6e 730d 0a0d 0a64  alculations....d
-000695c0: 6566 205f 6765 745f 6c65 6166 5f74 7261  ef _get_leaf_tra
-000695d0: 6e73 6c61 7469 6f6e 5f64 665f 6672 6f6d  nslation_df_from
-000695e0: 5f74 7570 6c65 2864 696d 656e 7369 6f6e  _tuple(dimension
-000695f0: 2c73 7472 7563 7475 7265 5f74 7570 6c65  ,structure_tuple
-00069600: 2c66 6965 6c64 5f73 686f 7274 6e61 6d65  ,field_shortname
-00069610: 2c73 7472 7563 7475 7265 5f65 6c65 6d65  ,structure_eleme
-00069620: 6e74 5f70 6174 6829 3a0d 0a0d 0a20 2020  nt_path):....   
-00069630: 2027 2727 0d0a 2020 2020 3a70 6172 616d   '''..    :param
-00069640: 3a20 7374 7275 6374 7572 655f 7475 706c  : structure_tupl
-00069650: 652e 2054 6865 206f 6c64 2077 6179 206f  e. The old way o
-00069660: 6620 7370 6563 6966 7969 6e67 2061 2073  f specifying a s
-00069670: 7472 7563 7475 7265 2065 6c65 6d65 6e74  tructure element
-00069680: 2e20 4120 7475 706c 6520 6f66 2028 7374  . A tuple of (st
-00069690: 7275 6374 7572 6520 7368 6f72 7463 6f64  ructure shortcod
-000696a0: 652c 2068 6965 7261 7263 6879 2073 686f  e, hierarchy sho
-000696b0: 7274 636f 6465 2c20 6669 7273 7420 656c  rtcode, first el
-000696c0: 656d 656e 7420 696e 2073 7562 2d74 7265  ement in sub-tre
-000696d0: 6520 7368 6f72 7463 6f64 6529 0d0a 0d0a  e shortcode)....
-000696e0: 2020 2020 2727 270d 0a0d 0a20 2020 2023      '''....    #
-000696f0: 544f 444f 202d 2064 6f20 7468 6973 2074  TODO - do this t
-00069700: 6872 6f75 6768 2074 6865 206f 626a 6563  hrough the objec
-00069710: 7420 6d6f 6465 6c2c 2074 6f20 656e 7375  t model, to ensu
-00069720: 7265 2063 6c65 616e 2073 796e 6368 726f  re clean synchro
-00069730: 6e69 7361 7469 6f6e 0d0a 2020 2020 6469  nisation..    di
-00069740: 6d65 6e73 696f 6e5f 696e 6465 783d 6469  mension_index=di
-00069750: 6d65 6e73 696f 6e2e 696e 6465 780d 0a20  mension.index.. 
-00069760: 2020 2073 6974 653d 6469 6d65 6e73 696f     site=dimensio
-00069770: 6e2e 7369 7465 0d0a 0d0a 2020 2020 2344  n.site....    #D
-00069780: 6f6e 2774 2064 6f75 626c 6520 7570 2066  on't double up f
-00069790: 6965 6c64 2073 686f 7274 6e61 6d65 7320  ield shortnames 
-000697a0: 7768 656e 2061 2063 616e 6f6e 6963 616c  when a canonical
-000697b0: 2066 6965 6c64 2069 7320 7075 7420 696e   field is put in
-000697c0: 0d0a 2020 2020 6966 2066 6965 6c64 5f73  ..    if field_s
-000697d0: 686f 7274 6e61 6d65 2069 6e20 5b27 4944  hortname in ['ID
-000697e0: 272c 2753 686f 7274 204e 616d 6527 2c27  ','Short Name','
-000697f0: 4c6f 6e67 204e 616d 6527 5d3a 0d0a 2020  Long Name']:..  
-00069800: 2020 2020 2020 6669 656c 645f 7368 6f72        field_shor
-00069810: 746e 616d 6520 3d20 4e6f 6e65 0d0a 0d0a  tname = None....
-00069820: 2020 2020 6966 2073 7472 7563 7475 7265      if structure
-00069830: 5f74 7570 6c65 2069 7320 6e6f 7420 4e6f  _tuple is not No
-00069840: 6e65 3a0d 0a20 2020 2020 2020 2074 7279  ne:..        try
-00069850: 3a0d 0a20 2020 2020 2020 2020 2020 2023  :..            #
-00069860: 6966 2073 7472 7563 7475 7265 2069 7320  if structure is 
-00069870: 6120 7374 7269 6e67 2074 6865 6e20 7765  a string then we
-00069880: 206e 6565 6420 746f 206c 6f6f 6b20 7570   need to look up
-00069890: 2074 6865 2073 7472 7563 7475 7265 2066   the structure f
-000698a0: 726f 6d20 7468 6520 7368 6f72 746e 616d  rom the shortnam
-000698b0: 650d 0a20 2020 2020 2020 2020 2020 205f  e..            _
-000698c0: 7374 7275 6374 7572 655f 7368 6f72 746e  structure_shortn
-000698d0: 616d 652c 5f72 6f6f 745f 7368 6f72 746e  ame,_root_shortn
-000698e0: 616d 652c 5f73 7562 7472 6565 5f73 686f  ame,_subtree_sho
-000698f0: 7274 6e61 6d65 203d 2073 7472 7563 7475  rtname = structu
-00069900: 7265 5f74 7570 6c65 0d0a 0d0a 2020 2020  re_tuple....    
-00069910: 2020 2020 6578 6365 7074 2049 6e64 6578      except Index
-00069920: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-00069930: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
-00069940: 726f 7228 2770 6172 616d 6574 6572 2073  ror('parameter s
-00069950: 7472 7563 7475 7265 206d 7573 7420 6265  tructure must be
-00069960: 2061 2074 7570 6c65 206f 6620 7368 6f72   a tuple of shor
-00069970: 746e 616d 6573 2028 7374 7275 6374 7572  tnames (structur
-00069980: 652c 726f 6f74 5f74 7265 655f 7374 6172  e,root_tree_star
-00069990: 742c 7375 6274 7265 655f 7374 6172 7429  t,subtree_start)
-000699a0: 206f 7220 6120 6d70 7875 2e53 7472 7563   or a mpxu.Struc
-000699b0: 7475 7265 456c 656d 656e 7420 6f62 6a65  tureElement obje
-000699c0: 6374 2729 0d0a 0d0a 2020 2020 2020 2020  ct')....        
-000699d0: 2354 4f44 4f20 2d20 7468 6973 2073 686f  #TODO - this sho
-000699e0: 756c 6420 7265 616c 6c79 2063 6f6d 6520  uld really come 
-000699f0: 6469 7265 6374 6c79 2066 726f 6d20 7468  directly from th
-00069a00: 6520 7369 7465 206f 626a 6563 7420 286f  e site object (o
-00069a10: 7220 7375 626f 626a 6563 7473 2920 736f  r subobjects) so
-00069a20: 2074 6861 7420 7468 6520 7369 7465 2063   that the site c
-00069a30: 616e 2072 6574 7572 6e20 6461 7461 2074  an return data t
-00069a40: 6861 7420 6973 2064 6566 696e 6974 656c  hat is definitel
-00069a50: 7920 7570 2074 6f20 6461 7465 0d0a 2020  y up to date..  
-00069a60: 2020 2020 2020 5f73 7472 7563 7475 7265        _structure
-00069a70: 203d 2064 696d 656e 7369 6f6e 2e73 7472   = dimension.str
-00069a80: 7563 7475 7265 735b 5f73 7472 7563 7475  uctures[_structu
-00069a90: 7265 5f73 686f 7274 6e61 6d65 5d0d 0a0d  re_shortname]...
-00069aa0: 0a20 2020 2020 2020 205f 6869 6572 6172  .        _hierar
-00069ab0: 6368 7920 3d20 5f73 7472 7563 7475 7265  chy = _structure
-00069ac0: 2e67 6574 5f72 6f6f 745f 656c 656d 656e  .get_root_elemen
-00069ad0: 7428 5f72 6f6f 745f 7368 6f72 746e 616d  t(_root_shortnam
-00069ae0: 6529 0d0a 0d0a 2020 2020 2020 2020 6966  e)....        if
-00069af0: 205f 6869 6572 6172 6368 7920 6973 204e   _hierarchy is N
-00069b00: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-00069b10: 2020 6d73 6720 3d20 2743 6f75 6c64 206e    msg = 'Could n
-00069b20: 6f74 2072 6561 6420 4869 6572 6172 6368  ot read Hierarch
-00069b30: 7920 2227 202b 205f 7374 7275 6374 7572  y "' + _structur
-00069b40: 655f 7368 6f72 746e 616d 6520 2b20 272e  e_shortname + '.
-00069b50: 272b 5f72 6f6f 745f 7368 6f72 746e 616d  '+_root_shortnam
-00069b60: 652b 2720 6672 6f6d 207a 6572 6f20 6261  e+' from zero ba
-00069b70: 7365 6420 4469 6d65 6e73 696f 6e5b 2720  sed Dimension[' 
-00069b80: 2b20 7374 7228 6469 6d65 6e73 696f 6e5f  + str(dimension_
-00069b90: 696e 6465 7829 202b 2027 5d20 696e 2073  index) + '] in s
-00069ba0: 6974 6520 2227 202b 2073 6974 652e 5f73  ite "' + site._s
-00069bb0: 6974 655f 6c6f 6361 746f 7220 2b20 2722  ite_locator + '"
-00069bc0: 270d 0a20 2020 2020 2020 2020 2020 206c  '..            l
-00069bd0: 6f67 2e65 7272 6f72 286d 7367 290d 0a20  og.error(msg).. 
-00069be0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00069bf0: 206d 7065 782e 436f 6d70 6c65 7465 6c79   mpex.Completely
-00069c00: 4c6f 6767 6564 4572 726f 7228 6d73 6729  LoggedError(msg)
-00069c10: 0d0a 0d0a 2020 2020 2020 2020 2367 6574  ....        #get
-00069c20: 2061 2044 6174 6146 7261 6d65 2077 6869   a DataFrame whi
-00069c30: 6368 2077 696c 6c20 7472 616e 736c 6174  ch will translat
-00069c40: 6520 7468 6520 6c65 6166 2073 686f 7274  e the leaf short
-00069c50: 6e61 6d65 7320 746f 206c 6576 656c 2030  names to level 0
-00069c60: 2d20 616e 6420 7570 2070 6879 7369 6473  - and up physids
-00069c70: 2c20 666f 7220 7573 6520 6475 7269 6e67  , for use during
-00069c80: 2064 6174 6120 6578 706c 6f73 696f 6e0d   data explosion.
-00069c90: 0a20 2020 2020 2020 2063 6f6c 756d 6e5f  .        column_
-00069ca0: 7072 6566 6978 3d27 6469 6d20 272b 7374  prefix='dim '+st
-00069cb0: 7228 6469 6d65 6e73 696f 6e5f 696e 6465  r(dimension_inde
-00069cc0: 7829 2b27 2027 2b5f 7375 6274 7265 655f  x)+' '+_subtree_
-00069cd0: 7368 6f72 746e 616d 652b 2720 270d 0a20  shortname+' '.. 
-00069ce0: 2020 2020 2020 206c 6561 665f 7472 616e         leaf_tran
-00069cf0: 736c 6174 696f 6e5f 6466 203d 205f 6869  slation_df = _hi
-00069d00: 6572 6172 6368 792e 6765 745f 7375 6274  erarchy.get_subt
-00069d10: 7265 655f 7472 616e 736c 6174 696f 6e5f  ree_translation_
-00069d20: 6466 2873 7562 7472 6565 5f73 686f 7274  df(subtree_short
-00069d30: 6e61 6d65 3d5f 7375 6274 7265 655f 7368  name=_subtree_sh
-00069d40: 6f72 746e 616d 652c 636f 6c75 6d6e 5f70  ortname,column_p
-00069d50: 7265 6669 783d 636f 6c75 6d6e 5f70 7265  refix=column_pre
-00069d60: 6669 782c 6669 656c 645f 7368 6f72 746e  fix,field_shortn
-00069d70: 616d 653d 6669 656c 645f 7368 6f72 746e  ame=field_shortn
-00069d80: 616d 6529 0d0a 0d0a 2020 2020 656c 6966  ame)....    elif
-00069d90: 2073 7472 7563 7475 7265 5f65 6c65 6d65   structure_eleme
-00069da0: 6e74 5f70 6174 6820 6973 206e 6f74 204e  nt_path is not N
-00069db0: 6f6e 653a 0d0a 2020 2020 2020 2020 2357  one:..        #W
-00069dc0: 6865 6e20 6120 7061 7468 2068 6173 2062  hen a path has b
-00069dd0: 6565 6e20 7061 7373 6564 2069 6e20 6173  een passed in as
-00069de0: 2061 2070 6172 616d 6574 6572 2c20 7765   a parameter, we
-00069df0: 206b 6e6f 7720 7468 6520 6578 6163 7420   know the exact 
-00069e00: 5374 7275 6374 7572 6545 6c65 6d65 6e74  StructureElement
-00069e10: 2077 6520 6172 6520 6765 7474 696e 6720   we are getting 
-00069e20: 7468 6520 7472 6565 2066 6f72 0d0a 0d0a  the tree for....
-00069e30: 2020 2020 2020 2020 7374 7275 6374 7572          structur
-00069e40: 655f 656c 656d 656e 7420 3d20 6469 6d65  e_element = dime
-00069e50: 6e73 696f 6e2e 6765 7428 7374 7275 6374  nsion.get(struct
-00069e60: 7572 655f 656c 656d 656e 745f 7061 7468  ure_element_path
-00069e70: 290d 0a20 2020 2020 2020 2023 6765 7420  )..        #get 
-00069e80: 6120 4461 7461 4672 616d 6520 7768 6963  a DataFrame whic
-00069e90: 6820 7769 6c6c 2074 7261 6e73 6c61 7465  h will translate
-00069ea0: 2074 6865 206c 6561 6620 7368 6f72 746e   the leaf shortn
-00069eb0: 616d 6573 2074 6f20 6c65 7665 6c20 302d  ames to level 0-
-00069ec0: 2061 6e64 2075 7020 7068 7973 6964 732c   and up physids,
-00069ed0: 2066 6f72 2075 7365 2064 7572 696e 6720   for use during 
-00069ee0: 6461 7461 2065 7870 6c6f 7369 6f6e 0d0a  data explosion..
-00069ef0: 2020 2020 2020 2020 636f 6c75 6d6e 5f70          column_p
-00069f00: 7265 6669 783d 2764 696d 2027 2b73 7472  refix='dim '+str
-00069f10: 2864 696d 656e 7369 6f6e 5f69 6e64 6578  (dimension_index
-00069f20: 292b 2720 272b 7374 7275 6374 7572 655f  )+' '+structure_
-00069f30: 656c 656d 656e 742e 7368 6f72 746e 616d  element.shortnam
-00069f40: 652b 2720 270d 0a20 2020 2020 2020 206c  e+' '..        l
-00069f50: 6561 665f 7472 616e 736c 6174 696f 6e5f  eaf_translation_
-00069f60: 6466 203d 2073 7472 7563 7475 7265 5f65  df = structure_e
-00069f70: 6c65 6d65 6e74 2e67 6574 5f73 7562 7472  lement.get_subtr
-00069f80: 6565 5f74 7261 6e73 6c61 7469 6f6e 5f64  ee_translation_d
-00069f90: 6628 7375 6274 7265 655f 7368 6f72 746e  f(subtree_shortn
-00069fa0: 616d 653d 7374 7275 6374 7572 655f 656c  ame=structure_el
-00069fb0: 656d 656e 742e 7368 6f72 746e 616d 652c  ement.shortname,
-00069fc0: 636f 6c75 6d6e 5f70 7265 6669 783d 636f  column_prefix=co
-00069fd0: 6c75 6d6e 5f70 7265 6669 782c 6669 656c  lumn_prefix,fiel
-00069fe0: 645f 7368 6f72 746e 616d 653d 6669 656c  d_shortname=fiel
-00069ff0: 645f 7368 6f72 746e 616d 6529 0d0a 0d0a  d_shortname)....
-0006a000: 0d0a 2020 2020 2343 6861 6e67 6520 7468  ..    #Change th
-0006a010: 6520 6669 656c 6420 7368 6f72 746e 616d  e field shortnam
-0006a020: 6520 746f 2061 206e 6f6e 7365 6e73 6520  e to a nonsense 
-0006a030: 7374 7269 6e67 2066 6f72 2074 6865 2064  string for the d
-0006a040: 6174 6166 7261 6d65 2072 656e 616d 6520  ataframe rename 
-0006a050: 2d20 7468 6520 636f 6465 2062 656c 6f77  - the code below
-0006a060: 2077 6f6e 2774 2061 6363 6570 7420 6120   won't accept a 
-0006a070: 4e6f 6e65 0d0a 2020 2020 6966 2066 6965  None..    if fie
-0006a080: 6c64 5f73 686f 7274 6e61 6d65 2069 7320  ld_shortname is 
-0006a090: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2066  None:..        f
-0006a0a0: 6965 6c64 5f73 686f 7274 6e61 6d65 203d  ield_shortname =
-0006a0b0: 2027 2323 2323 2323 2323 2323 2323 2327   '#############'
-0006a0c0: 0d0a 2020 2020 6c65 6166 5f74 7261 6e73  ..    leaf_trans
-0006a0d0: 6c61 7469 6f6e 5f64 662e 7265 6e61 6d65  lation_df.rename
-0006a0e0: 2863 6f6c 756d 6e73 3d7b 636f 6c75 6d6e  (columns={column
-0006a0f0: 5f70 7265 6669 782b 2749 4427 3a27 4c4b  _prefix+'ID':'LK
-0006a100: 5550 2049 4427 2c63 6f6c 756d 6e5f 7072  UP ID',column_pr
-0006a110: 6566 6978 2b27 5368 6f72 7420 4e61 6d65  efix+'Short Name
-0006a120: 273a 274c 4b55 5020 5368 6f72 7420 4e61  ':'LKUP Short Na
-0006a130: 6d65 272c 636f 6c75 6d6e 5f70 7265 6669  me',column_prefi
-0006a140: 782b 274c 6f6e 6720 4e61 6d65 273a 274c  x+'Long Name':'L
-0006a150: 4b55 5020 4c6f 6e67 204e 616d 6527 2c63  KUP Long Name',c
-0006a160: 6f6c 756d 6e5f 7072 6566 6978 2b66 6965  olumn_prefix+fie
-0006a170: 6c64 5f73 686f 7274 6e61 6d65 3a27 4c4b  ld_shortname:'LK
-0006a180: 5550 2027 2b66 6965 6c64 5f73 686f 7274  UP '+field_short
-0006a190: 6e61 6d65 7d2c 696e 706c 6163 653d 5472  name},inplace=Tr
-0006a1a0: 7565 290d 0a0d 0a20 2020 2072 6574 7572  ue)....    retur
-0006a1b0: 6e20 6c65 6166 5f74 7261 6e73 6c61 7469  n leaf_translati
-0006a1c0: 6f6e 5f64 660d 0a0d 0a64 6566 205f 7472  on_df....def _tr
-0006a1d0: 616e 736c 6174 655f 6469 6d28 6466 2c64  anslate_dim(df,d
-0006a1e0: 696d 5f69 6465 6e74 6966 6965 722c 6469  im_identifier,di
-0006a1f0: 6d5f 7479 7065 2c74 7261 6e73 6c61 7465  m_type,translate
-0006a200: 5f64 662c 6669 656c 645f 7368 6f72 746e  _df,field_shortn
-0006a210: 616d 653d 4e6f 6e65 293a 0d0a 2020 2020  ame=None):..    
-0006a220: 234c 6f6f 6b75 7020 6569 7468 6572 206f  #Lookup either o
-0006a230: 6e20 7368 6f72 746e 616d 652c 206c 6f6e  n shortname, lon
-0006a240: 676e 616d 6520 6f72 2070 6879 7369 6420  gname or physid 
-0006a250: 286f 7220 6669 656c 6429 0d0a 2020 2020  (or field)..    
-0006a260: 234c 6f6f 6b75 7020 6569 7468 6572 2061  #Lookup either a
-0006a270: 2073 696e 676c 6520 6f72 206d 756c 7469   single or multi
-0006a280: 706c 6520 636f 6c75 6d6e 730d 0a0d 0a20  ple columns.... 
-0006a290: 2020 2023 4966 2061 2073 696e 6775 6c61     #If a singula
-0006a2a0: 7220 6974 656d 2c20 636f 6e76 6572 7420  r item, convert 
-0006a2b0: 6974 2074 6f20 6120 6c69 7374 0d0a 2020  it to a list..  
-0006a2c0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0006a2d0: 6469 6d5f 6964 656e 7469 6669 6572 2c73  dim_identifier,s
-0006a2e0: 7472 2920 6f72 2069 7369 6e73 7461 6e63  tr) or isinstanc
-0006a2f0: 6528 6469 6d5f 6964 656e 7469 6669 6572  e(dim_identifier
-0006a300: 2c69 6e74 2920 6f72 2069 7369 6e73 7461  ,int) or isinsta
-0006a310: 6e63 6528 6469 6d5f 6964 656e 7469 6669  nce(dim_identifi
-0006a320: 6572 2c66 6c6f 6174 293a 0d0a 2020 2020  er,float):..    
-0006a330: 2020 2020 6469 6d5f 6964 656e 7469 6669      dim_identifi
-0006a340: 6572 3d5b 6469 6d5f 6964 656e 7469 6669  er=[dim_identifi
-0006a350: 6572 5d0d 0a0d 0a20 2020 206c 6566 745f  er]....    left_
-0006a360: 6f6e 3d4e 6f6e 650d 0a20 2020 2072 6967  on=None..    rig
-0006a370: 6874 5f6f 6e3d 4e6f 6e65 0d0a 0d0a 0d0a  ht_on=None......
-0006a380: 2020 2020 2323 2323 2323 2323 2323 2323      ############
-0006a390: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006a3a0: 2323 2323 0d0a 2020 2020 2323 544f 444f  ####..    ##TODO
-0006a3b0: 0d0a 2020 2020 2323 2323 2323 2323 2323  ..    ##########
+00068e40: 5f65 7175 616c 203d 2031 0d0a 2020 2020  _equal = 1..    
+00068e50: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00068e60: 2020 2020 2020 2063 6f75 6e74 5f65 7175         count_equ
+00068e70: 616c 203d 2030 0d0a 0d0a 2020 2020 2020  al = 0....      
+00068e80: 2020 636f 756e 745f 746f 7461 6c20 3d20    count_total = 
+00068e90: 310d 0a0d 0a20 2020 2020 2020 2066 6f72  1....        for
+00068ea0: 2063 6f6d 7020 696e 2073 656c 662e 636f   comp in self.co
+00068eb0: 6d70 6172 6973 6f6e 5f6c 6973 743a 0d0a  mparison_list:..
+00068ec0: 2020 2020 2020 2020 2020 2020 6368 696c              chil
+00068ed0: 645f 636f 756e 745f 6571 7561 6c2c 2063  d_count_equal, c
+00068ee0: 6869 6c64 5f63 6f75 6e74 5f74 6f74 616c  hild_count_total
+00068ef0: 203d 2063 6f6d 702e 636f 756e 745f 6571   = comp.count_eq
+00068f00: 7561 6c5f 616e 645f 746f 7461 6c28 290d  ual_and_total().
+00068f10: 0a20 2020 2020 2020 2020 2020 2063 6f75  .            cou
+00068f20: 6e74 5f65 7175 616c 202b 3d20 6368 696c  nt_equal += chil
+00068f30: 645f 636f 756e 745f 6571 7561 6c0d 0a20  d_count_equal.. 
+00068f40: 2020 2020 2020 2020 2020 2063 6f75 6e74             count
+00068f50: 5f74 6f74 616c 202b 3d20 6368 696c 645f  _total += child_
+00068f60: 636f 756e 745f 746f 7461 6c0d 0a0d 0a20  count_total.... 
+00068f70: 2020 2020 2020 2072 6574 7572 6e20 636f         return co
+00068f80: 756e 745f 6571 7561 6c2c 2063 6f75 6e74  unt_equal, count
+00068f90: 5f74 6f74 616c 0d0a 0d0a 2020 2020 6465  _total....    de
+00068fa0: 6620 6164 645f 6361 6c63 756c 6174 696f  f add_calculatio
+00068fb0: 6e5f 636f 6d70 6172 6973 6f6e 2873 656c  n_comparison(sel
+00068fc0: 662c 2070 7265 7669 6f75 735f 6361 6c63  f, previous_calc
+00068fd0: 756c 6174 696f 6e5f 6c6f 6f6b 7570 293a  ulation_lookup):
+00068fe0: 0d0a 2020 2020 2020 2020 2727 270d 0a20  ..        '''.. 
+00068ff0: 2020 2020 2020 2043 7265 6174 6520 6120         Create a 
+00069000: 636f 6d70 6172 6973 6f6e 2062 6574 7765  comparison betwe
+00069010: 656e 2070 7265 7669 6f75 7320 6361 6c63  en previous calc
+00069020: 756c 6174 696f 6e73 2061 6e64 2066 696e  ulations and fin
+00069030: 616c 2063 616c 6375 6c61 7469 6f6e 730d  al calculations.
+00069040: 0a0d 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00069050: 6e73 2061 2064 6963 7469 6f6e 6172 7920  ns a dictionary 
+00069060: 6f66 207b 7368 6f72 7463 6f64 653a 2028  of {shortcode: (
+00069070: 6f6c 645f 6361 6c63 756c 6174 696f 6e2c  old_calculation,
+00069080: 206e 6577 5f63 616c 6375 6c61 7469 6f6e   new_calculation
+00069090: 297d 0d0a 2020 2020 2020 2020 2727 270d  )}..        '''.
+000690a0: 0a0d 0a20 2020 2020 2020 2063 6861 6e67  ...        chang
+000690b0: 6564 5f63 616c 6375 6c61 7469 6f6e 7320  ed_calculations 
+000690c0: 3d20 7b7d 0d0a 0d0a 2020 2020 2020 2020  = {}....        
+000690d0: 234e 6f74 6520 2d20 6f74 6865 7220 7374  #Note - other st
+000690e0: 7275 6374 7572 6520 656c 656d 656e 7420  ructure element 
+000690f0: 6973 2075 7375 616c 6c79 2074 6865 2062  is usually the b
+00069100: 7569 6c74 2073 7472 7563 7475 7265 2065  uilt structure e
+00069110: 6c65 6d65 6e74 2c20 7369 6e63 6520 7765  lement, since we
+00069120: 2061 7265 2063 6f6d 7061 7269 6e67 2070   are comparing p
+00069130: 7265 7669 6f75 7320 746f 206e 6577 2077  revious to new w
+00069140: 6974 6820 7072 6576 696f 7573 2e63 6f6d  ith previous.com
+00069150: 7061 7265 286e 6577 290d 0a20 2020 2020  pare(new)..     
+00069160: 2020 2066 6f72 2073 6520 696e 2073 656c     for se in sel
+00069170: 662e 6f74 6865 725f 7374 7275 6374 7572  f.other_structur
+00069180: 655f 656c 656d 656e 742e 7761 6c6b 2829  e_element.walk()
+00069190: 3a0d 0a20 2020 2020 2020 2020 2020 2074  :..            t
+000691a0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+000691b0: 2020 2020 206f 6c64 5f63 616c 6375 6c61       old_calcula
+000691c0: 7469 6f6e 203d 2070 7265 7669 6f75 735f  tion = previous_
+000691d0: 6361 6c63 756c 6174 696f 6e5f 6c6f 6f6b  calculation_look
+000691e0: 7570 5b73 652e 7368 6f72 7463 6f64 655d  up[se.shortcode]
+000691f0: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
+00069200: 6365 7074 204b 6579 4572 726f 723a 0d0a  cept KeyError:..
+00069210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069220: 6966 2073 652e 6361 6c63 756c 6174 696f  if se.calculatio
+00069230: 6e20 6973 206e 6f74 204e 6f6e 653a 0d0a  n is not None:..
+00069240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069250: 2020 2020 2354 6865 7265 2069 7320 6e6f      #There is no
+00069260: 206f 6c64 2063 616c 6375 6c61 7469 6f6e   old calculation
+00069270: 202d 2073 6f20 7075 7420 696e 2074 6865   - so put in the
+00069280: 206e 6577 2063 616c 6375 6c61 7469 6f6e   new calculation
+00069290: 206f 6e6c 790d 0a20 2020 2020 2020 2020   only..         
+000692a0: 2020 2020 2020 2020 2020 2063 6861 6e67             chang
+000692b0: 6564 5f63 616c 6375 6c61 7469 6f6e 735b  ed_calculations[
+000692c0: 7365 2e73 686f 7274 636f 6465 5d20 3d20  se.shortcode] = 
+000692d0: 284e 6f6e 652c 7365 2e63 616c 6375 6c61  (None,se.calcula
+000692e0: 7469 6f6e 290d 0a20 2020 2020 2020 2020  tion)..         
+000692f0: 2020 2020 2020 2063 6f6e 7469 6e75 650d         continue.
+00069300: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
+00069310: 4361 6c63 756c 6174 696f 6e73 206d 6179  Calculations may
+00069320: 2068 6176 6520 6265 656e 2063 7265 6174   have been creat
+00069330: 6564 2028 6173 2061 2073 7472 696e 6729  ed (as a string)
+00069340: 206f 7220 6265 2069 6e20 7468 6520 6f72   or be in the or
+00069350: 6967 696e 616c 2070 6879 7369 6420 666f  iginal physid fo
+00069360: 726d 2065 7870 6f72 7465 6420 6672 6f6d  rm exported from
+00069370: 2045 6d70 6f77 6572 0d0a 2020 2020 2020   Empower..      
+00069380: 2020 2020 2020 2357 6520 6e65 6564 2074        #We need t
+00069390: 6f20 6368 6563 6b20 6167 6169 6e73 7420  o check against 
+000693a0: 626f 7468 0d0a 2020 2020 2020 2020 2020  both..          
+000693b0: 2020 6e65 775f 6361 6c63 756c 6174 696f    new_calculatio
+000693c0: 6e20 3d20 7365 2e65 6c65 6d65 6e74 2e63  n = se.element.c
+000693d0: 616c 6375 6c61 7469 6f6e 0d0a 2020 2020  alculation..    
+000693e0: 2020 2020 2020 2020 6e65 775f 7068 7973          new_phys
+000693f0: 6964 5f63 616c 6375 6c61 7469 6f6e 203d  id_calculation =
+00069400: 2073 652e 656c 656d 656e 742e 5f70 6879   se.element._phy
+00069410: 7369 645f 6361 6c63 756c 6174 696f 6e0d  sid_calculation.
+00069420: 0a20 2020 2020 2020 2020 2020 2023 4966  .            #If
+00069430: 2074 6865 2063 616c 6375 6c61 7469 6f6e   the calculation
+00069440: 7320 6d61 7463 682c 2064 6f20 6e6f 7468  s match, do noth
+00069450: 696e 670d 0a20 2020 2020 2020 2020 2020  ing..           
+00069460: 2069 6620 286f 6c64 5f63 616c 6375 6c61   if (old_calcula
+00069470: 7469 6f6e 2069 7320 4e6f 6e65 2061 6e64  tion is None and
+00069480: 206e 6577 5f63 616c 6375 6c61 7469 6f6e   new_calculation
+00069490: 2069 7320 4e6f 6e65 2920 6f72 2020 6f6c   is None) or  ol
+000694a0: 645f 6361 6c63 756c 6174 696f 6e20 3d3d  d_calculation ==
+000694b0: 206e 6577 5f63 616c 6375 6c61 7469 6f6e   new_calculation
+000694c0: 206f 7220 6f6c 645f 6361 6c63 756c 6174   or old_calculat
+000694d0: 696f 6e20 3d3d 206e 6577 5f70 6879 7369  ion == new_physi
+000694e0: 645f 6361 6c63 756c 6174 696f 6e3a 0d0a  d_calculation:..
+000694f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00069500: 7061 7373 0d0a 2020 2020 2020 2020 2020  pass..          
+00069510: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+00069520: 2020 2020 2020 2020 2023 4f74 6865 7277           #Otherw
+00069530: 6973 652c 2072 6563 6f72 6420 7468 6520  ise, record the 
+00069540: 6368 616e 6765 6420 6361 6c63 756c 6174  changed calculat
+00069550: 696f 6e0d 0a20 2020 2020 2020 2020 2020  ion..           
+00069560: 2020 2020 2063 6861 6e67 6564 5f63 616c       changed_cal
+00069570: 6375 6c61 7469 6f6e 735b 7365 2e73 686f  culations[se.sho
+00069580: 7274 636f 6465 5d20 3d20 286f 6c64 5f63  rtcode] = (old_c
+00069590: 616c 6375 6c61 7469 6f6e 2c6e 6577 5f63  alculation,new_c
+000695a0: 616c 6375 6c61 7469 6f6e 290d 0a0d 0a20  alculation).... 
+000695b0: 2020 2020 2020 2073 656c 662e 6368 616e         self.chan
+000695c0: 6765 645f 6361 6c63 756c 6174 696f 6e73  ged_calculations
+000695d0: 203d 2063 6861 6e67 6564 5f63 616c 6375   = changed_calcu
+000695e0: 6c61 7469 6f6e 730d 0a0d 0a64 6566 205f  lations....def _
+000695f0: 6765 745f 6c65 6166 5f74 7261 6e73 6c61  get_leaf_transla
+00069600: 7469 6f6e 5f64 665f 6672 6f6d 5f74 7570  tion_df_from_tup
+00069610: 6c65 2864 696d 656e 7369 6f6e 2c73 7472  le(dimension,str
+00069620: 7563 7475 7265 5f74 7570 6c65 2c66 6965  ucture_tuple,fie
+00069630: 6c64 5f73 686f 7274 6e61 6d65 2c73 7472  ld_shortname,str
+00069640: 7563 7475 7265 5f65 6c65 6d65 6e74 5f70  ucture_element_p
+00069650: 6174 6829 3a0d 0a0d 0a20 2020 2027 2727  ath):....    '''
+00069660: 0d0a 2020 2020 3a70 6172 616d 3a20 7374  ..    :param: st
+00069670: 7275 6374 7572 655f 7475 706c 652e 2054  ructure_tuple. T
+00069680: 6865 206f 6c64 2077 6179 206f 6620 7370  he old way of sp
+00069690: 6563 6966 7969 6e67 2061 2073 7472 7563  ecifying a struc
+000696a0: 7475 7265 2065 6c65 6d65 6e74 2e20 4120  ture element. A 
+000696b0: 7475 706c 6520 6f66 2028 7374 7275 6374  tuple of (struct
+000696c0: 7572 6520 7368 6f72 7463 6f64 652c 2068  ure shortcode, h
+000696d0: 6965 7261 7263 6879 2073 686f 7274 636f  ierarchy shortco
+000696e0: 6465 2c20 6669 7273 7420 656c 656d 656e  de, first elemen
+000696f0: 7420 696e 2073 7562 2d74 7265 6520 7368  t in sub-tree sh
+00069700: 6f72 7463 6f64 6529 0d0a 0d0a 2020 2020  ortcode)....    
+00069710: 2727 270d 0a0d 0a20 2020 2023 544f 444f  '''....    #TODO
+00069720: 202d 2064 6f20 7468 6973 2074 6872 6f75   - do this throu
+00069730: 6768 2074 6865 206f 626a 6563 7420 6d6f  gh the object mo
+00069740: 6465 6c2c 2074 6f20 656e 7375 7265 2063  del, to ensure c
+00069750: 6c65 616e 2073 796e 6368 726f 6e69 7361  lean synchronisa
+00069760: 7469 6f6e 0d0a 2020 2020 6469 6d65 6e73  tion..    dimens
+00069770: 696f 6e5f 696e 6465 783d 6469 6d65 6e73  ion_index=dimens
+00069780: 696f 6e2e 696e 6465 780d 0a20 2020 2073  ion.index..    s
+00069790: 6974 653d 6469 6d65 6e73 696f 6e2e 7369  ite=dimension.si
+000697a0: 7465 0d0a 0d0a 2020 2020 2344 6f6e 2774  te....    #Don't
+000697b0: 2064 6f75 626c 6520 7570 2066 6965 6c64   double up field
+000697c0: 2073 686f 7274 6e61 6d65 7320 7768 656e   shortnames when
+000697d0: 2061 2063 616e 6f6e 6963 616c 2066 6965   a canonical fie
+000697e0: 6c64 2069 7320 7075 7420 696e 0d0a 2020  ld is put in..  
+000697f0: 2020 6966 2066 6965 6c64 5f73 686f 7274    if field_short
+00069800: 6e61 6d65 2069 6e20 5b27 4944 272c 2753  name in ['ID','S
+00069810: 686f 7274 204e 616d 6527 2c27 4c6f 6e67  hort Name','Long
+00069820: 204e 616d 6527 5d3a 0d0a 2020 2020 2020   Name']:..      
+00069830: 2020 6669 656c 645f 7368 6f72 746e 616d    field_shortnam
+00069840: 6520 3d20 4e6f 6e65 0d0a 0d0a 2020 2020  e = None....    
+00069850: 6966 2073 7472 7563 7475 7265 5f74 7570  if structure_tup
+00069860: 6c65 2069 7320 6e6f 7420 4e6f 6e65 3a0d  le is not None:.
+00069870: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
+00069880: 2020 2020 2020 2020 2020 2023 6966 2073             #if s
+00069890: 7472 7563 7475 7265 2069 7320 6120 7374  tructure is a st
+000698a0: 7269 6e67 2074 6865 6e20 7765 206e 6565  ring then we nee
+000698b0: 6420 746f 206c 6f6f 6b20 7570 2074 6865  d to look up the
+000698c0: 2073 7472 7563 7475 7265 2066 726f 6d20   structure from 
+000698d0: 7468 6520 7368 6f72 746e 616d 650d 0a20  the shortname.. 
+000698e0: 2020 2020 2020 2020 2020 205f 7374 7275             _stru
+000698f0: 6374 7572 655f 7368 6f72 746e 616d 652c  cture_shortname,
+00069900: 5f72 6f6f 745f 7368 6f72 746e 616d 652c  _root_shortname,
+00069910: 5f73 7562 7472 6565 5f73 686f 7274 6e61  _subtree_shortna
+00069920: 6d65 203d 2073 7472 7563 7475 7265 5f74  me = structure_t
+00069930: 7570 6c65 0d0a 0d0a 2020 2020 2020 2020  uple....        
+00069940: 6578 6365 7074 2049 6e64 6578 4572 726f  except IndexErro
+00069950: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+00069960: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+00069970: 2770 6172 616d 6574 6572 2073 7472 7563  'parameter struc
+00069980: 7475 7265 206d 7573 7420 6265 2061 2074  ture must be a t
+00069990: 7570 6c65 206f 6620 7368 6f72 746e 616d  uple of shortnam
+000699a0: 6573 2028 7374 7275 6374 7572 652c 726f  es (structure,ro
+000699b0: 6f74 5f74 7265 655f 7374 6172 742c 7375  ot_tree_start,su
+000699c0: 6274 7265 655f 7374 6172 7429 206f 7220  btree_start) or 
+000699d0: 6120 6d70 7875 2e53 7472 7563 7475 7265  a mpxu.Structure
+000699e0: 456c 656d 656e 7420 6f62 6a65 6374 2729  Element object')
+000699f0: 0d0a 0d0a 2020 2020 2020 2020 2354 4f44  ....        #TOD
+00069a00: 4f20 2d20 7468 6973 2073 686f 756c 6420  O - this should 
+00069a10: 7265 616c 6c79 2063 6f6d 6520 6469 7265  really come dire
+00069a20: 6374 6c79 2066 726f 6d20 7468 6520 7369  ctly from the si
+00069a30: 7465 206f 626a 6563 7420 286f 7220 7375  te object (or su
+00069a40: 626f 626a 6563 7473 2920 736f 2074 6861  bobjects) so tha
+00069a50: 7420 7468 6520 7369 7465 2063 616e 2072  t the site can r
+00069a60: 6574 7572 6e20 6461 7461 2074 6861 7420  eturn data that 
+00069a70: 6973 2064 6566 696e 6974 656c 7920 7570  is definitely up
+00069a80: 2074 6f20 6461 7465 0d0a 2020 2020 2020   to date..      
+00069a90: 2020 5f73 7472 7563 7475 7265 203d 2064    _structure = d
+00069aa0: 696d 656e 7369 6f6e 2e73 7472 7563 7475  imension.structu
+00069ab0: 7265 735b 5f73 7472 7563 7475 7265 5f73  res[_structure_s
+00069ac0: 686f 7274 6e61 6d65 5d0d 0a0d 0a20 2020  hortname]....   
+00069ad0: 2020 2020 205f 6869 6572 6172 6368 7920       _hierarchy 
+00069ae0: 3d20 5f73 7472 7563 7475 7265 2e67 6574  = _structure.get
+00069af0: 5f72 6f6f 745f 656c 656d 656e 7428 5f72  _root_element(_r
+00069b00: 6f6f 745f 7368 6f72 746e 616d 6529 0d0a  oot_shortname)..
+00069b10: 0d0a 2020 2020 2020 2020 6966 205f 6869  ..        if _hi
+00069b20: 6572 6172 6368 7920 6973 204e 6f6e 653a  erarchy is None:
+00069b30: 0d0a 2020 2020 2020 2020 2020 2020 6d73  ..            ms
+00069b40: 6720 3d20 2743 6f75 6c64 206e 6f74 2072  g = 'Could not r
+00069b50: 6561 6420 4869 6572 6172 6368 7920 2227  ead Hierarchy "'
+00069b60: 202b 205f 7374 7275 6374 7572 655f 7368   + _structure_sh
+00069b70: 6f72 746e 616d 6520 2b20 272e 272b 5f72  ortname + '.'+_r
+00069b80: 6f6f 745f 7368 6f72 746e 616d 652b 2720  oot_shortname+' 
+00069b90: 6672 6f6d 207a 6572 6f20 6261 7365 6420  from zero based 
+00069ba0: 4469 6d65 6e73 696f 6e5b 2720 2b20 7374  Dimension[' + st
+00069bb0: 7228 6469 6d65 6e73 696f 6e5f 696e 6465  r(dimension_inde
+00069bc0: 7829 202b 2027 5d20 696e 2073 6974 6520  x) + '] in site 
+00069bd0: 2227 202b 2073 6974 652e 5f73 6974 655f  "' + site._site_
+00069be0: 6c6f 6361 746f 7220 2b20 2722 270d 0a20  locator + '"'.. 
+00069bf0: 2020 2020 2020 2020 2020 206c 6f67 2e65             log.e
+00069c00: 7272 6f72 286d 7367 290d 0a20 2020 2020  rror(msg)..     
+00069c10: 2020 2020 2020 2072 6169 7365 206d 7065         raise mpe
+00069c20: 782e 436f 6d70 6c65 7465 6c79 4c6f 6767  x.CompletelyLogg
+00069c30: 6564 4572 726f 7228 6d73 6729 0d0a 0d0a  edError(msg)....
+00069c40: 2020 2020 2020 2020 2367 6574 2061 2044          #get a D
+00069c50: 6174 6146 7261 6d65 2077 6869 6368 2077  ataFrame which w
+00069c60: 696c 6c20 7472 616e 736c 6174 6520 7468  ill translate th
+00069c70: 6520 6c65 6166 2073 686f 7274 6e61 6d65  e leaf shortname
+00069c80: 7320 746f 206c 6576 656c 2030 2d20 616e  s to level 0- an
+00069c90: 6420 7570 2070 6879 7369 6473 2c20 666f  d up physids, fo
+00069ca0: 7220 7573 6520 6475 7269 6e67 2064 6174  r use during dat
+00069cb0: 6120 6578 706c 6f73 696f 6e0d 0a20 2020  a explosion..   
+00069cc0: 2020 2020 2063 6f6c 756d 6e5f 7072 6566       column_pref
+00069cd0: 6978 3d27 6469 6d20 272b 7374 7228 6469  ix='dim '+str(di
+00069ce0: 6d65 6e73 696f 6e5f 696e 6465 7829 2b27  mension_index)+'
+00069cf0: 2027 2b5f 7375 6274 7265 655f 7368 6f72   '+_subtree_shor
+00069d00: 746e 616d 652b 2720 270d 0a20 2020 2020  tname+' '..     
+00069d10: 2020 206c 6561 665f 7472 616e 736c 6174     leaf_translat
+00069d20: 696f 6e5f 6466 203d 205f 6869 6572 6172  ion_df = _hierar
+00069d30: 6368 792e 6765 745f 7375 6274 7265 655f  chy.get_subtree_
+00069d40: 7472 616e 736c 6174 696f 6e5f 6466 2873  translation_df(s
+00069d50: 7562 7472 6565 5f73 686f 7274 6e61 6d65  ubtree_shortname
+00069d60: 3d5f 7375 6274 7265 655f 7368 6f72 746e  =_subtree_shortn
+00069d70: 616d 652c 636f 6c75 6d6e 5f70 7265 6669  ame,column_prefi
+00069d80: 783d 636f 6c75 6d6e 5f70 7265 6669 782c  x=column_prefix,
+00069d90: 6669 656c 645f 7368 6f72 746e 616d 653d  field_shortname=
+00069da0: 6669 656c 645f 7368 6f72 746e 616d 6529  field_shortname)
+00069db0: 0d0a 0d0a 2020 2020 656c 6966 2073 7472  ....    elif str
+00069dc0: 7563 7475 7265 5f65 6c65 6d65 6e74 5f70  ucture_element_p
+00069dd0: 6174 6820 6973 206e 6f74 204e 6f6e 653a  ath is not None:
+00069de0: 0d0a 2020 2020 2020 2020 2357 6865 6e20  ..        #When 
+00069df0: 6120 7061 7468 2068 6173 2062 6565 6e20  a path has been 
+00069e00: 7061 7373 6564 2069 6e20 6173 2061 2070  passed in as a p
+00069e10: 6172 616d 6574 6572 2c20 7765 206b 6e6f  arameter, we kno
+00069e20: 7720 7468 6520 6578 6163 7420 5374 7275  w the exact Stru
+00069e30: 6374 7572 6545 6c65 6d65 6e74 2077 6520  ctureElement we 
+00069e40: 6172 6520 6765 7474 696e 6720 7468 6520  are getting the 
+00069e50: 7472 6565 2066 6f72 0d0a 0d0a 2020 2020  tree for....    
+00069e60: 2020 2020 7374 7275 6374 7572 655f 656c      structure_el
+00069e70: 656d 656e 7420 3d20 6469 6d65 6e73 696f  ement = dimensio
+00069e80: 6e2e 6765 7428 7374 7275 6374 7572 655f  n.get(structure_
+00069e90: 656c 656d 656e 745f 7061 7468 290d 0a20  element_path).. 
+00069ea0: 2020 2020 2020 2023 6765 7420 6120 4461         #get a Da
+00069eb0: 7461 4672 616d 6520 7768 6963 6820 7769  taFrame which wi
+00069ec0: 6c6c 2074 7261 6e73 6c61 7465 2074 6865  ll translate the
+00069ed0: 206c 6561 6620 7368 6f72 746e 616d 6573   leaf shortnames
+00069ee0: 2074 6f20 6c65 7665 6c20 302d 2061 6e64   to level 0- and
+00069ef0: 2075 7020 7068 7973 6964 732c 2066 6f72   up physids, for
+00069f00: 2075 7365 2064 7572 696e 6720 6461 7461   use during data
+00069f10: 2065 7870 6c6f 7369 6f6e 0d0a 2020 2020   explosion..    
+00069f20: 2020 2020 636f 6c75 6d6e 5f70 7265 6669      column_prefi
+00069f30: 783d 2764 696d 2027 2b73 7472 2864 696d  x='dim '+str(dim
+00069f40: 656e 7369 6f6e 5f69 6e64 6578 292b 2720  ension_index)+' 
+00069f50: 272b 7374 7275 6374 7572 655f 656c 656d  '+structure_elem
+00069f60: 656e 742e 7368 6f72 746e 616d 652b 2720  ent.shortname+' 
+00069f70: 270d 0a20 2020 2020 2020 206c 6561 665f  '..        leaf_
+00069f80: 7472 616e 736c 6174 696f 6e5f 6466 203d  translation_df =
+00069f90: 2073 7472 7563 7475 7265 5f65 6c65 6d65   structure_eleme
+00069fa0: 6e74 2e67 6574 5f73 7562 7472 6565 5f74  nt.get_subtree_t
+00069fb0: 7261 6e73 6c61 7469 6f6e 5f64 6628 7375  ranslation_df(su
+00069fc0: 6274 7265 655f 7368 6f72 746e 616d 653d  btree_shortname=
+00069fd0: 7374 7275 6374 7572 655f 656c 656d 656e  structure_elemen
+00069fe0: 742e 7368 6f72 746e 616d 652c 636f 6c75  t.shortname,colu
+00069ff0: 6d6e 5f70 7265 6669 783d 636f 6c75 6d6e  mn_prefix=column
+0006a000: 5f70 7265 6669 782c 6669 656c 645f 7368  _prefix,field_sh
+0006a010: 6f72 746e 616d 653d 6669 656c 645f 7368  ortname=field_sh
+0006a020: 6f72 746e 616d 6529 0d0a 0d0a 0d0a 2020  ortname)......  
+0006a030: 2020 2343 6861 6e67 6520 7468 6520 6669    #Change the fi
+0006a040: 656c 6420 7368 6f72 746e 616d 6520 746f  eld shortname to
+0006a050: 2061 206e 6f6e 7365 6e73 6520 7374 7269   a nonsense stri
+0006a060: 6e67 2066 6f72 2074 6865 2064 6174 6166  ng for the dataf
+0006a070: 7261 6d65 2072 656e 616d 6520 2d20 7468  rame rename - th
+0006a080: 6520 636f 6465 2062 656c 6f77 2077 6f6e  e code below won
+0006a090: 2774 2061 6363 6570 7420 6120 4e6f 6e65  't accept a None
+0006a0a0: 0d0a 2020 2020 6966 2066 6965 6c64 5f73  ..    if field_s
+0006a0b0: 686f 7274 6e61 6d65 2069 7320 4e6f 6e65  hortname is None
+0006a0c0: 3a0d 0a20 2020 2020 2020 2066 6965 6c64  :..        field
+0006a0d0: 5f73 686f 7274 6e61 6d65 203d 2027 2323  _shortname = '##
+0006a0e0: 2323 2323 2323 2323 2323 2327 0d0a 2020  ###########'..  
+0006a0f0: 2020 6c65 6166 5f74 7261 6e73 6c61 7469    leaf_translati
+0006a100: 6f6e 5f64 662e 7265 6e61 6d65 2863 6f6c  on_df.rename(col
+0006a110: 756d 6e73 3d7b 636f 6c75 6d6e 5f70 7265  umns={column_pre
+0006a120: 6669 782b 2749 4427 3a27 4c4b 5550 2049  fix+'ID':'LKUP I
+0006a130: 4427 2c63 6f6c 756d 6e5f 7072 6566 6978  D',column_prefix
+0006a140: 2b27 5368 6f72 7420 4e61 6d65 273a 274c  +'Short Name':'L
+0006a150: 4b55 5020 5368 6f72 7420 4e61 6d65 272c  KUP Short Name',
+0006a160: 636f 6c75 6d6e 5f70 7265 6669 782b 274c  column_prefix+'L
+0006a170: 6f6e 6720 4e61 6d65 273a 274c 4b55 5020  ong Name':'LKUP 
+0006a180: 4c6f 6e67 204e 616d 6527 2c63 6f6c 756d  Long Name',colum
+0006a190: 6e5f 7072 6566 6978 2b66 6965 6c64 5f73  n_prefix+field_s
+0006a1a0: 686f 7274 6e61 6d65 3a27 4c4b 5550 2027  hortname:'LKUP '
+0006a1b0: 2b66 6965 6c64 5f73 686f 7274 6e61 6d65  +field_shortname
+0006a1c0: 7d2c 696e 706c 6163 653d 5472 7565 290d  },inplace=True).
+0006a1d0: 0a0d 0a20 2020 2072 6574 7572 6e20 6c65  ...    return le
+0006a1e0: 6166 5f74 7261 6e73 6c61 7469 6f6e 5f64  af_translation_d
+0006a1f0: 660d 0a0d 0a64 6566 205f 7472 616e 736c  f....def _transl
+0006a200: 6174 655f 6469 6d28 6466 2c64 696d 5f69  ate_dim(df,dim_i
+0006a210: 6465 6e74 6966 6965 722c 6469 6d5f 7479  dentifier,dim_ty
+0006a220: 7065 2c74 7261 6e73 6c61 7465 5f64 662c  pe,translate_df,
+0006a230: 6669 656c 645f 7368 6f72 746e 616d 653d  field_shortname=
+0006a240: 4e6f 6e65 293a 0d0a 2020 2020 234c 6f6f  None):..    #Loo
+0006a250: 6b75 7020 6569 7468 6572 206f 6e20 7368  kup either on sh
+0006a260: 6f72 746e 616d 652c 206c 6f6e 676e 616d  ortname, longnam
+0006a270: 6520 6f72 2070 6879 7369 6420 286f 7220  e or physid (or 
+0006a280: 6669 656c 6429 0d0a 2020 2020 234c 6f6f  field)..    #Loo
+0006a290: 6b75 7020 6569 7468 6572 2061 2073 696e  kup either a sin
+0006a2a0: 676c 6520 6f72 206d 756c 7469 706c 6520  gle or multiple 
+0006a2b0: 636f 6c75 6d6e 730d 0a0d 0a20 2020 2023  columns....    #
+0006a2c0: 4966 2061 2073 696e 6775 6c61 7220 6974  If a singular it
+0006a2d0: 656d 2c20 636f 6e76 6572 7420 6974 2074  em, convert it t
+0006a2e0: 6f20 6120 6c69 7374 0d0a 2020 2020 6966  o a list..    if
+0006a2f0: 2069 7369 6e73 7461 6e63 6528 6469 6d5f   isinstance(dim_
+0006a300: 6964 656e 7469 6669 6572 2c73 7472 2920  identifier,str) 
+0006a310: 6f72 2069 7369 6e73 7461 6e63 6528 6469  or isinstance(di
+0006a320: 6d5f 6964 656e 7469 6669 6572 2c69 6e74  m_identifier,int
+0006a330: 2920 6f72 2069 7369 6e73 7461 6e63 6528  ) or isinstance(
+0006a340: 6469 6d5f 6964 656e 7469 6669 6572 2c66  dim_identifier,f
+0006a350: 6c6f 6174 293a 0d0a 2020 2020 2020 2020  loat):..        
+0006a360: 6469 6d5f 6964 656e 7469 6669 6572 3d5b  dim_identifier=[
+0006a370: 6469 6d5f 6964 656e 7469 6669 6572 5d0d  dim_identifier].
+0006a380: 0a0d 0a20 2020 206c 6566 745f 6f6e 3d4e  ...    left_on=N
+0006a390: 6f6e 650d 0a20 2020 2072 6967 6874 5f6f  one..    right_o
+0006a3a0: 6e3d 4e6f 6e65 0d0a 0d0a 0d0a 2020 2020  n=None......    
+0006a3b0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
 0006a3c0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006a3d0: 2323 2323 2323 0d0a 0d0a 2020 2020 2341  ######....    #A
-0006a3e0: 7265 2061 6c6c 2064 696d 2069 6465 6e74  re all dim ident
-0006a3f0: 6966 6965 7273 2063 6f6c 756d 6e20 696e  ifiers column in
-0006a400: 2064 663f 0d0a 0d0a 2020 2020 234f 7468   df?....    #Oth
-0006a410: 6572 7769 7365 2074 6865 7920 6172 6520  erwise they are 
-0006a420: 6c69 7465 7261 6c73 0d0a 2020 2020 234c  literals..    #L
-0006a430: 6974 6572 616c 2070 6879 7369 6473 2064  iteral physids d
-0006a440: 6f6e 2774 206e 6565 6420 6c6f 6f6b 696e  on't need lookin
-0006a450: 6720 7570 0d0a 2020 2020 234c 6974 6572  g up..    #Liter
-0006a460: 616c 2073 686f 7274 6e61 6d65 7320 6e65  al shortnames ne
-0006a470: 6564 2061 206c 6f6f 6b75 702c 2062 7574  ed a lookup, but
-0006a480: 206e 6f74 2061 206d 6572 6765 2061 7320   not a merge as 
-0006a490: 7375 6368 0d0a 0d0a 2020 2020 2323 2323  such....    ####
-0006a4a0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
-0006a4b0: 2323 2323 2323 2323 2323 2323 0d0a 0d0a  ############....
-0006a4c0: 2020 2020 636f 6c75 6d6e 735f 666f 725f      columns_for_
-0006a4d0: 6578 706c 6f73 696f 6e3d 5b5d 0d0a 0d0a  explosion=[]....
-0006a4e0: 2020 2020 6966 2064 696d 5f74 7970 653d      if dim_type=
-0006a4f0: 3d27 7068 7973 6964 273a 0d0a 2020 2020  ='physid':..    
-0006a500: 2020 2020 7269 6768 745f 6f6e 3d27 4c4b      right_on='LK
-0006a510: 5550 2049 4427 0d0a 2020 2020 6966 2064  UP ID'..    if d
-0006a520: 696d 5f74 7970 653d 3d27 7368 6f72 746e  im_type=='shortn
-0006a530: 616d 6527 3a0d 0a20 2020 2020 2020 2072  ame':..        r
-0006a540: 6967 6874 5f6f 6e3d 274c 4b55 5020 5368  ight_on='LKUP Sh
-0006a550: 6f72 7420 4e61 6d65 270d 0a20 2020 2069  ort Name'..    i
-0006a560: 6620 6469 6d5f 7479 7065 3d3d 276c 6f6e  f dim_type=='lon
-0006a570: 676e 616d 6527 3a0d 0a20 2020 2020 2020  gname':..       
-0006a580: 2072 6967 6874 5f6f 6e3d 274c 4b55 5020   right_on='LKUP 
-0006a590: 4c6f 6e67 204e 616d 6527 0d0a 2020 2020  Long Name'..    
-0006a5a0: 6966 2064 696d 5f74 7970 653d 3d27 6669  if dim_type=='fi
-0006a5b0: 656c 6427 3a0d 0a20 2020 2020 2020 2072  eld':..        r
-0006a5c0: 6967 6874 5f6f 6e3d 274c 4b55 5020 272b  ight_on='LKUP '+
-0006a5d0: 6669 656c 645f 7368 6f72 746e 616d 650d  field_shortname.
-0006a5e0: 0a0d 0a20 2020 2023 436f 7079 2074 6865  ...    #Copy the
-0006a5f0: 2074 7261 6e73 6c61 7469 6f6e 2064 6174   translation dat
-0006a600: 6166 7261 6d65 2074 6f20 6176 6f69 6420  aframe to avoid 
-0006a610: 636f 7272 7570 7469 6e67 2069 740d 0a20  corrupting it.. 
-0006a620: 2020 2074 7261 6e73 6c61 7465 5f64 663d     translate_df=
-0006a630: 7472 616e 736c 6174 655f 6466 2e64 726f  translate_df.dro
-0006a640: 705f 6475 706c 6963 6174 6573 2873 7562  p_duplicates(sub
-0006a650: 7365 743d 7269 6768 745f 6f6e 2c6b 6565  set=right_on,kee
-0006a660: 703d 276c 6173 7427 292e 636f 7079 2829  p='last').copy()
-0006a670: 0d0a 0d0a 0d0a 2020 2020 2346 6f72 2065  ......    #For e
-0006a680: 7665 7279 2063 6f6c 756d 6e20 7468 6174  very column that
-0006a690: 206e 6565 6473 2074 7261 6e73 6c61 7469   needs translati
-0006a6a0: 6e67 2c20 7472 616e 736c 6174 6520 6974  ng, translate it
-0006a6b0: 0d0a 2020 2020 2354 4f44 4f20 2d20 6f70  ..    #TODO - op
-0006a6c0: 7469 6d69 7365 2074 6869 7320 736f 2077  timise this so w
-0006a6d0: 6520 6172 6520 6e6f 7420 756e 6e65 6365  e are not unnece
-0006a6e0: 7373 6172 696c 7920 7472 616e 736c 6174  ssarily translat
-0006a6f0: 696e 6720 7369 6e67 6c65 2070 6879 7369  ing single physi
-0006a700: 6473 2074 6f20 7068 7973 6964 730d 0a20  ds to physids.. 
-0006a710: 2020 2066 6f72 2063 6f6c 756d 6e20 696e     for column in
-0006a720: 2064 696d 5f69 6465 6e74 6966 6965 723a   dim_identifier:
-0006a730: 0d0a 0d0a 2020 2020 2020 2020 6c65 6674  ....        left
-0006a740: 5f6f 6e3d 636f 6c75 6d6e 0d0a 0d0a 2020  _on=column....  
-0006a750: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-0006a760: 2020 2020 2020 2020 2349 7420 6973 2069          #It is i
-0006a770: 6d70 6f72 7461 6e74 2074 6f20 6b65 6570  mportant to keep
-0006a780: 2074 6865 206e 6577 2064 6174 6166 7261   the new datafra
-0006a790: 6d65 2773 2069 6e64 6578 2074 6865 2073  me's index the s
-0006a7a0: 616d 6520 6173 2074 6865 206f 6c64 206f  ame as the old o
-0006a7b0: 6e65 2c20 696e 2063 6173 6520 7765 2061  ne, in case we a
-0006a7c0: 7265 206d 6572 6769 6e67 2074 6f20 6120  re merging to a 
-0006a7d0: 736c 6963 650d 0a20 2020 2020 2020 2020  slice..         
-0006a7e0: 2020 2023 4f74 6865 7277 6973 6520 7768     #Otherwise wh
-0006a7f0: 656e 2077 6520 7075 7420 7468 6520 636f  en we put the co
-0006a800: 6c75 6d6e 7320 6261 636b 2077 6520 656e  lumns back we en
-0006a810: 6420 7570 2077 6974 6820 7468 6520 6a6f  d up with the jo
-0006a820: 696e 6564 2064 6174 6120 676f 696e 6720  ined data going 
-0006a830: 696e 2074 6865 2077 726f 6e67 2070 6c61  in the wrong pla
-0006a840: 6365 0d0a 2020 2020 2020 2020 2020 2020  ce..            
-0006a850: 6e65 7764 6620 3d20 7064 2e6d 6572 6765  newdf = pd.merge
-0006a860: 2868 6f77 3d27 6c65 6674 272c 6c65 6674  (how='left',left
-0006a870: 3d64 662e 7265 7365 745f 696e 6465 7828  =df.reset_index(
-0006a880: 292c 7269 6768 743d 7472 616e 736c 6174  ),right=translat
-0006a890: 655f 6466 2c6c 6566 745f 6f6e 3d6c 6566  e_df,left_on=lef
-0006a8a0: 745f 6f6e 2c72 6967 6874 5f6f 6e3d 7269  t_on,right_on=ri
-0006a8b0: 6768 745f 6f6e 292e 7365 745f 696e 6465  ght_on).set_inde
-0006a8c0: 7828 2769 6e64 6578 2729 0d0a 2020 2020  x('index')..    
-0006a8d0: 2020 2020 2020 2020 2370 7269 6e74 2827          #print('
-0006a8e0: 6e65 7764 6627 290d 0a20 2020 2020 2020  newdf')..       
-0006a8f0: 2020 2020 2023 7072 696e 7428 6e65 7764       #print(newd
-0006a900: 662e 696e 666f 2829 290d 0a20 2020 2020  f.info())..     
-0006a910: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
-0006a920: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
-0006a930: 2070 7269 6e74 2864 662e 6865 6164 2829   print(df.head()
-0006a940: 290d 0a20 2020 2020 2020 2020 2020 2070  )..            p
-0006a950: 7269 6e74 2827 6c65 6674 5f6f 6e3d 272b  rint('left_on='+
-0006a960: 7374 7228 6c65 6674 5f6f 6e29 290d 0a20  str(left_on)).. 
+0006a3d0: 0d0a 2020 2020 2323 544f 444f 0d0a 2020  ..    ##TODO..  
+0006a3e0: 2020 2323 2323 2323 2323 2323 2323 2323    ##############
+0006a3f0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006a400: 2323 0d0a 0d0a 2020 2020 2341 7265 2061  ##....    #Are a
+0006a410: 6c6c 2064 696d 2069 6465 6e74 6966 6965  ll dim identifie
+0006a420: 7273 2063 6f6c 756d 6e20 696e 2064 663f  rs column in df?
+0006a430: 0d0a 0d0a 2020 2020 234f 7468 6572 7769  ....    #Otherwi
+0006a440: 7365 2074 6865 7920 6172 6520 6c69 7465  se they are lite
+0006a450: 7261 6c73 0d0a 2020 2020 234c 6974 6572  rals..    #Liter
+0006a460: 616c 2070 6879 7369 6473 2064 6f6e 2774  al physids don't
+0006a470: 206e 6565 6420 6c6f 6f6b 696e 6720 7570   need looking up
+0006a480: 0d0a 2020 2020 234c 6974 6572 616c 2073  ..    #Literal s
+0006a490: 686f 7274 6e61 6d65 7320 6e65 6564 2061  hortnames need a
+0006a4a0: 206c 6f6f 6b75 702c 2062 7574 206e 6f74   lookup, but not
+0006a4b0: 2061 206d 6572 6765 2061 7320 7375 6368   a merge as such
+0006a4c0: 0d0a 0d0a 2020 2020 2323 2323 2323 2323  ....    ########
+0006a4d0: 2323 2323 2323 2323 2323 2323 2323 2323  ################
+0006a4e0: 2323 2323 2323 2323 0d0a 0d0a 2020 2020  ########....    
+0006a4f0: 636f 6c75 6d6e 735f 666f 725f 6578 706c  columns_for_expl
+0006a500: 6f73 696f 6e3d 5b5d 0d0a 0d0a 2020 2020  osion=[]....    
+0006a510: 6966 2064 696d 5f74 7970 653d 3d27 7068  if dim_type=='ph
+0006a520: 7973 6964 273a 0d0a 2020 2020 2020 2020  ysid':..        
+0006a530: 7269 6768 745f 6f6e 3d27 4c4b 5550 2049  right_on='LKUP I
+0006a540: 4427 0d0a 2020 2020 6966 2064 696d 5f74  D'..    if dim_t
+0006a550: 7970 653d 3d27 7368 6f72 746e 616d 6527  ype=='shortname'
+0006a560: 3a0d 0a20 2020 2020 2020 2072 6967 6874  :..        right
+0006a570: 5f6f 6e3d 274c 4b55 5020 5368 6f72 7420  _on='LKUP Short 
+0006a580: 4e61 6d65 270d 0a20 2020 2069 6620 6469  Name'..    if di
+0006a590: 6d5f 7479 7065 3d3d 276c 6f6e 676e 616d  m_type=='longnam
+0006a5a0: 6527 3a0d 0a20 2020 2020 2020 2072 6967  e':..        rig
+0006a5b0: 6874 5f6f 6e3d 274c 4b55 5020 4c6f 6e67  ht_on='LKUP Long
+0006a5c0: 204e 616d 6527 0d0a 2020 2020 6966 2064   Name'..    if d
+0006a5d0: 696d 5f74 7970 653d 3d27 6669 656c 6427  im_type=='field'
+0006a5e0: 3a0d 0a20 2020 2020 2020 2072 6967 6874  :..        right
+0006a5f0: 5f6f 6e3d 274c 4b55 5020 272b 6669 656c  _on='LKUP '+fiel
+0006a600: 645f 7368 6f72 746e 616d 650d 0a0d 0a20  d_shortname.... 
+0006a610: 2020 2023 436f 7079 2074 6865 2074 7261     #Copy the tra
+0006a620: 6e73 6c61 7469 6f6e 2064 6174 6166 7261  nslation datafra
+0006a630: 6d65 2074 6f20 6176 6f69 6420 636f 7272  me to avoid corr
+0006a640: 7570 7469 6e67 2069 740d 0a20 2020 2074  upting it..    t
+0006a650: 7261 6e73 6c61 7465 5f64 663d 7472 616e  ranslate_df=tran
+0006a660: 736c 6174 655f 6466 2e64 726f 705f 6475  slate_df.drop_du
+0006a670: 706c 6963 6174 6573 2873 7562 7365 743d  plicates(subset=
+0006a680: 7269 6768 745f 6f6e 2c6b 6565 703d 276c  right_on,keep='l
+0006a690: 6173 7427 292e 636f 7079 2829 0d0a 0d0a  ast').copy()....
+0006a6a0: 0d0a 2020 2020 2346 6f72 2065 7665 7279  ..    #For every
+0006a6b0: 2063 6f6c 756d 6e20 7468 6174 206e 6565   column that nee
+0006a6c0: 6473 2074 7261 6e73 6c61 7469 6e67 2c20  ds translating, 
+0006a6d0: 7472 616e 736c 6174 6520 6974 0d0a 2020  translate it..  
+0006a6e0: 2020 2354 4f44 4f20 2d20 6f70 7469 6d69    #TODO - optimi
+0006a6f0: 7365 2074 6869 7320 736f 2077 6520 6172  se this so we ar
+0006a700: 6520 6e6f 7420 756e 6e65 6365 7373 6172  e not unnecessar
+0006a710: 696c 7920 7472 616e 736c 6174 696e 6720  ily translating 
+0006a720: 7369 6e67 6c65 2070 6879 7369 6473 2074  single physids t
+0006a730: 6f20 7068 7973 6964 730d 0a20 2020 2066  o physids..    f
+0006a740: 6f72 2063 6f6c 756d 6e20 696e 2064 696d  or column in dim
+0006a750: 5f69 6465 6e74 6966 6965 723a 0d0a 0d0a  _identifier:....
+0006a760: 2020 2020 2020 2020 6c65 6674 5f6f 6e3d          left_on=
+0006a770: 636f 6c75 6d6e 0d0a 0d0a 2020 2020 2020  column....      
+0006a780: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+0006a790: 2020 2020 2349 7420 6973 2069 6d70 6f72      #It is impor
+0006a7a0: 7461 6e74 2074 6f20 6b65 6570 2074 6865  tant to keep the
+0006a7b0: 206e 6577 2064 6174 6166 7261 6d65 2773   new dataframe's
+0006a7c0: 2069 6e64 6578 2074 6865 2073 616d 6520   index the same 
+0006a7d0: 6173 2074 6865 206f 6c64 206f 6e65 2c20  as the old one, 
+0006a7e0: 696e 2063 6173 6520 7765 2061 7265 206d  in case we are m
+0006a7f0: 6572 6769 6e67 2074 6f20 6120 736c 6963  erging to a slic
+0006a800: 650d 0a20 2020 2020 2020 2020 2020 2023  e..            #
+0006a810: 4f74 6865 7277 6973 6520 7768 656e 2077  Otherwise when w
+0006a820: 6520 7075 7420 7468 6520 636f 6c75 6d6e  e put the column
+0006a830: 7320 6261 636b 2077 6520 656e 6420 7570  s back we end up
+0006a840: 2077 6974 6820 7468 6520 6a6f 696e 6564   with the joined
+0006a850: 2064 6174 6120 676f 696e 6720 696e 2074   data going in t
+0006a860: 6865 2077 726f 6e67 2070 6c61 6365 0d0a  he wrong place..
+0006a870: 2020 2020 2020 2020 2020 2020 6e65 7764              newd
+0006a880: 6620 3d20 7064 2e6d 6572 6765 2868 6f77  f = pd.merge(how
+0006a890: 3d27 6c65 6674 272c 6c65 6674 3d64 662e  ='left',left=df.
+0006a8a0: 7265 7365 745f 696e 6465 7828 292c 7269  reset_index(),ri
+0006a8b0: 6768 743d 7472 616e 736c 6174 655f 6466  ght=translate_df
+0006a8c0: 2c6c 6566 745f 6f6e 3d6c 6566 745f 6f6e  ,left_on=left_on
+0006a8d0: 2c72 6967 6874 5f6f 6e3d 7269 6768 745f  ,right_on=right_
+0006a8e0: 6f6e 292e 7365 745f 696e 6465 7828 2769  on).set_index('i
+0006a8f0: 6e64 6578 2729 0d0a 2020 2020 2020 2020  ndex')..        
+0006a900: 2020 2020 2370 7269 6e74 2827 6e65 7764      #print('newd
+0006a910: 6627 290d 0a20 2020 2020 2020 2020 2020  f')..           
+0006a920: 2023 7072 696e 7428 6e65 7764 662e 696e   #print(newdf.in
+0006a930: 666f 2829 290d 0a20 2020 2020 2020 2065  fo())..        e
+0006a940: 7863 6570 7420 4b65 7945 7272 6f72 3a0d  xcept KeyError:.
+0006a950: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0006a960: 6e74 2864 662e 6865 6164 2829 290d 0a20  nt(df.head()).. 
 0006a970: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0006a980: 2827 7269 6768 745f 6f6e 3d27 2b73 7472  ('right_on='+str
-0006a990: 2872 6967 6874 5f6f 6e29 290d 0a20 2020  (right_on))..   
-0006a9a0: 2020 2020 2020 2020 2070 7269 6e74 2874           print(t
-0006a9b0: 7261 6e73 6c61 7465 5f64 662e 6865 6164  ranslate_df.head
-0006a9c0: 2829 290d 0a20 2020 2020 2020 2020 2020  ())..           
-0006a9d0: 2072 6169 7365 0d0a 0d0a 2020 2020 2020   raise....      
-0006a9e0: 2020 2347 6574 2074 6865 2063 6f6c 756d    #Get the colum
-0006a9f0: 6e73 2066 6f72 2074 6865 2065 7870 6c6f  ns for the explo
-0006aa00: 6465 2063 616c 6c0d 0a20 2020 2020 2020  de call..       
-0006aa10: 2023 4368 616e 6765 2074 6865 2066 6965   #Change the fie
-0006aa20: 6c64 2073 686f 7274 6e61 6d65 2074 6f20  ld shortname to 
-0006aa30: 6120 6e6f 6e73 656e 7365 2073 7472 696e  a nonsense strin
-0006aa40: 6720 666f 7220 7468 6520 6461 7461 6672  g for the datafr
-0006aa50: 616d 6520 7265 6e61 6d65 202d 2074 6865  ame rename - the
-0006aa60: 2063 6f64 6520 6265 6c6f 7720 776f 6e27   code below won'
-0006aa70: 7420 6163 6365 7074 2061 204e 6f6e 650d  t accept a None.
-0006aa80: 0a20 2020 2020 2020 2069 6620 6669 656c  .        if fiel
-0006aa90: 645f 7368 6f72 746e 616d 6520 6973 204e  d_shortname is N
-0006aaa0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-0006aab0: 2020 6669 656c 645f 7368 6f72 746e 616d    field_shortnam
-0006aac0: 6520 3d20 2723 2323 2323 2323 2323 2323  e = '###########
-0006aad0: 2323 270d 0a20 2020 2020 2020 2063 6f6c  ##'..        col
-0006aae0: 756d 6e73 5f66 6f72 5f65 7870 6c6f 7369  umns_for_explosi
-0006aaf0: 6f6e 2b3d 5b63 2066 6f72 2063 2069 6e20  on+=[c for c in 
-0006ab00: 7472 616e 736c 6174 655f 6466 2e63 6f6c  translate_df.col
-0006ab10: 756d 6e73 2069 6620 6320 6e6f 7420 696e  umns if c not in
-0006ab20: 205b 274c 4b55 5020 4c6f 6e67 204e 616d   ['LKUP Long Nam
-0006ab30: 6527 2c27 4c4b 5550 2053 686f 7274 204e  e','LKUP Short N
-0006ab40: 616d 6527 2c27 4c4b 5550 2049 4427 2c27  ame','LKUP ID','
-0006ab50: 4c4b 5550 2027 2b66 6965 6c64 5f73 686f  LKUP '+field_sho
-0006ab60: 7274 6e61 6d65 5d5d 0d0a 0d0a 2020 2020  rtname]]....    
-0006ab70: 2341 6464 2074 6865 206e 6577 2063 6f6c  #Add the new col
-0006ab80: 756d 6e73 2069 6e74 6f20 7468 6520 6f72  umns into the or
-0006ab90: 6967 696e 616c 2064 6174 6166 7261 6d65  iginal dataframe
-0006aba0: 0d0a 2020 2020 666f 7220 636f 6c75 6d6e  ..    for column
-0006abb0: 2069 6e20 636f 6c75 6d6e 735f 666f 725f   in columns_for_
-0006abc0: 6578 706c 6f73 696f 6e3a 0d0a 2020 2020  explosion:..    
-0006abd0: 2020 2020 6466 5b63 6f6c 756d 6e5d 3d6e      df[column]=n
-0006abe0: 6577 6466 5b63 6f6c 756d 6e5d 0d0a 0d0a  ewdf[column]....
-0006abf0: 2020 2020 2353 6574 2074 7261 6e73 6c61      #Set transla
-0006ac00: 7465 5f64 6620 746f 204e 6f6e 6520 2d20  te_df to None - 
-0006ac10: 746f 2068 656c 7020 7468 6520 4761 7262  to help the Garb
-0006ac20: 6167 6520 436f 6c6c 6563 746f 720d 0a20  age Collector.. 
-0006ac30: 2020 2074 7261 6e73 6c61 7465 5f64 6620     translate_df 
-0006ac40: 3d20 4e6f 6e65 0d0a 0d0a 0d0a 2020 2020  = None......    
-0006ac50: 2370 7269 6e74 2827 6466 2729 0d0a 2020  #print('df')..  
-0006ac60: 2020 2370 7269 6e74 2864 662e 696e 666f    #print(df.info
-0006ac70: 2829 290d 0a0d 0a20 2020 2072 6574 7572  ())....    retur
-0006ac80: 6e20 636f 6c75 6d6e 735f 666f 725f 6578  n columns_for_ex
-0006ac90: 706c 6f73 696f 6e0d 0a0d 0a64 6566 205f  plosion....def _
-0006aca0: 7469 6d65 5f64 696d 656e 7369 6f6e 5f69  time_dimension_i
-0006acb0: 6d70 6f72 745f 656c 656d 656e 7473 2864  mport_elements(d
-0006acc0: 696d 656e 7369 6f6e 2c20 656c 656d 656e  imension, elemen
-0006acd0: 7473 2c69 6d70 6f72 7465 645f 6469 6d65  ts,imported_dime
-0006ace0: 6e73 696f 6e5f 6669 6c65 7061 7468 2c69  nsion_filepath,i
-0006acf0: 6d70 6f72 7465 645f 7469 6d65 5f64 696d  mported_time_dim
-0006ad00: 656e 7369 6f6e 5f66 696c 6570 6174 6820  ension_filepath 
-0006ad10: 293a 0d0a 2020 2020 6469 6d65 6e73 696f  ):..    dimensio
-0006ad20: 6e5f 696e 6465 7820 3d20 3131 0d0a 2020  n_index = 11..  
-0006ad30: 2020 6465 6275 6720 3d20 6469 6d65 6e73    debug = dimens
-0006ad40: 696f 6e2e 7369 7465 2e5f 6465 6275 670d  ion.site._debug.
-0006ad50: 0a0d 0a20 2020 2064 6566 205f 7969 656c  ...    def _yiel
-0006ad60: 645f 7469 6d65 5f64 696d 656e 7369 6f6e  d_time_dimension
-0006ad70: 5f73 7472 696e 6773 2865 6c65 6d65 6e74  _strings(element
-0006ad80: 7329 3a0d 0a20 2020 2020 2020 2023 7469  s):..        #ti
-0006ad90: 6d65 2064 696d 656e 7369 6f6e 2065 6c65  me dimension ele
-0006ada0: 6d65 6e74 2073 7475 6666 0d0a 2020 2020  ment stuff..    
-0006adb0: 2020 2020 666f 7220 6f75 7470 7574 5f65      for output_e
-0006adc0: 6c65 6d65 6e74 2069 6e20 656c 656d 656e  lement in elemen
-0006add0: 7473 3a0d 0a20 2020 2020 2020 2020 2020  ts:..           
-0006ade0: 2023 6c6f 6e67 6e61 6d65 732c 2079 6561   #longnames, yea
-0006adf0: 722c 206d 6f6e 7468 2c20 6461 7920 616e  r, month, day an
-0006ae00: 6420 696e 7465 7276 616c 2069 6e64 6578  d interval index
-0006ae10: 2028 7965 6172 203d 2030 2c20 6461 7920   (year = 0, day 
-0006ae20: 3d20 3529 2e0d 0a20 2020 2020 2020 2020  = 5)...         
-0006ae30: 2020 2023 5075 7420 7468 6520 7368 6f72     #Put the shor
-0006ae40: 746e 616d 6520 696e 746f 2074 6865 206c  tname into the l
-0006ae50: 6f6e 676e 616d 6520 6669 656c 6420 2d20  ongname field - 
-0006ae60: 7468 6520 7368 6f72 746e 616d 6520 7769  the shortname wi
-0006ae70: 6c6c 2062 6520 6465 6661 756c 7465 6420  ll be defaulted 
-0006ae80: 746f 2074 6865 206c 6f6e 676e 616d 652e  to the longname.
-0006ae90: 0d0a 2020 2020 2020 2020 2020 2020 2354  ..            #T
-0006aea0: 6865 6e20 7468 6520 7374 616e 6461 7264  hen the standard
-0006aeb0: 2064 696d 656e 7369 6f6e 2063 6f64 6520   dimension code 
-0006aec0: 7769 6c6c 2062 6520 7275 6e20 746f 2063  will be run to c
-0006aed0: 6f72 7265 6374 2074 6865 206c 6f6e 676e  orrect the longn
-0006aee0: 616d 6520 616e 6420 6164 6420 7468 6520  ame and add the 
-0006aef0: 6465 7363 7269 7074 696f 6e0d 0a20 2020  description..   
-0006af00: 2020 2020 2020 2020 2069 6620 6f75 7470           if outp
-0006af10: 7574 5f65 6c65 6d65 6e74 2e6c 6f6e 676e  ut_element.longn
-0006af20: 616d 6520 6973 206e 6f74 204e 6f6e 653a  ame is not None:
-0006af30: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006af40: 2020 7969 656c 6420 6f75 7470 7574 5f65    yield output_e
-0006af50: 6c65 6d65 6e74 2e6c 6f6e 676e 616d 650d  lement.longname.
-0006af60: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0006af70: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
-0006af80: 2020 2020 7969 656c 6420 6f75 7470 7574      yield output
-0006af90: 5f65 6c65 6d65 6e74 2e73 686f 7274 6e61  _element.shortna
-0006afa0: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
-0006afb0: 7969 656c 6420 275c 7427 0d0a 2020 2020  yield '\t'..    
-0006afc0: 2020 2020 2020 2020 6966 206f 7574 7075          if outpu
-0006afd0: 745f 656c 656d 656e 742e 7368 6f72 746e  t_element.shortn
-0006afe0: 616d 6520 6973 206e 6f74 204e 6f6e 653a  ame is not None:
-0006aff0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006b000: 2020 7969 656c 6420 6f75 7470 7574 5f65    yield output_e
-0006b010: 6c65 6d65 6e74 2e73 686f 7274 6e61 6d65  lement.shortname
-0006b020: 0d0a 2020 2020 2020 2020 2020 2020 7969  ..            yi
-0006b030: 656c 6420 275c 7427 0d0a 2020 2020 2020  eld '\t'..      
-0006b040: 2020 2020 2020 6966 206f 7574 7075 745f        if output_
-0006b050: 656c 656d 656e 742e 7965 6172 2069 7320  element.year is 
-0006b060: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
-0006b070: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-0006b080: 2073 7472 2869 6e74 286f 7574 7075 745f   str(int(output_
-0006b090: 656c 656d 656e 742e 7965 6172 2929 0d0a  element.year))..
-0006b0a0: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
-0006b0b0: 6420 275c 7427 0d0a 2020 2020 2020 2020  d '\t'..        
-0006b0c0: 2020 2020 6966 206f 7574 7075 745f 656c      if output_el
-0006b0d0: 656d 656e 742e 6d6f 6e74 6820 6973 206e  ement.month is n
-0006b0e0: 6f74 204e 6f6e 653a 0d0a 2020 2020 2020  ot None:..      
-0006b0f0: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
-0006b100: 7374 7228 696e 7428 6f75 7470 7574 5f65  str(int(output_e
-0006b110: 6c65 6d65 6e74 2e6d 6f6e 7468 2929 0d0a  lement.month))..
-0006b120: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
-0006b130: 6420 275c 7427 0d0a 2020 2020 2020 2020  d '\t'..        
-0006b140: 2020 2020 6966 206f 7574 7075 745f 656c      if output_el
-0006b150: 656d 656e 742e 6461 7920 6973 206e 6f74  ement.day is not
-0006b160: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-0006b170: 2020 2020 2020 2020 7969 656c 6420 7374          yield st
-0006b180: 7228 696e 7428 6f75 7470 7574 5f65 6c65  r(int(output_ele
-0006b190: 6d65 6e74 2e64 6179 2929 0d0a 2020 2020  ment.day))..    
-0006b1a0: 2020 2020 2020 2020 7969 656c 6420 275c          yield '\
-0006b1b0: 7427 0d0a 2020 2020 2020 2020 2020 2020  t'..            
-0006b1c0: 7969 656c 6420 7374 7228 696e 7428 6f75  yield str(int(ou
-0006b1d0: 7470 7574 5f65 6c65 6d65 6e74 2e69 6e74  tput_element.int
-0006b1e0: 6572 7661 6c5f 696e 6465 7829 290d 0a20  erval_index)).. 
-0006b1f0: 2020 2020 2020 2020 2020 2079 6965 6c64             yield
-0006b200: 2027 5c6e 270d 0a0d 0a20 2020 2023 496d   '\n'....    #Im
-0006b210: 706f 7274 2074 6865 2065 6c65 6d65 6e74  port the element
-0006b220: 7320 696e 2074 6865 2077 6f72 6b69 6e67  s in the working
-0006b230: 2066 696c 6520 696e 746f 2045 6d70 6f77   file into Empow
-0006b240: 6572 0d0a 2020 2020 2345 7870 6f72 7420  er..    #Export 
-0006b250: 7468 6520 7374 7275 6374 7572 6520 746f  the structure to
-0006b260: 2077 6f72 6b69 6e67 5f64 6972 6563 746f   working_directo
-0006b270: 7279 0d0a 0d0a 2020 2020 636f 6d6d 616e  ry....    comman
-0006b280: 645f 6c69 7374 203d 2064 696d 656e 7369  d_list = dimensi
-0006b290: 6f6e 2e73 6974 652e 5f6c 6f67 6f6e 5f70  on.site._logon_p
-0006b2a0: 6172 616d 6574 6572 5f69 6d70 6f72 7465  arameter_importe
-0006b2b0: 725f 636f 6d6d 616e 6473 202b 205c 0d0a  r_commands + \..
-0006b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b2d0: 2020 205b 276c 6f61 642d 6669 6c65 2d74     ['load-file-t
-0006b2e0: 7376 2022 2720 2b20 696d 706f 7274 6564  sv "' + imported
-0006b2f0: 5f74 696d 655f 6469 6d65 6e73 696f 6e5f  _time_dimension_
-0006b300: 6669 6c65 7061 7468 202b 2027 2227 0d0a  filepath + '"'..
-0006b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006b320: 2020 202c 2765 6d70 6f77 6572 2d69 6d70     ,'empower-imp
-0006b330: 6f72 742d 7469 6d65 2d65 6c65 6d65 6e74  ort-time-element
-0006b340: 7320 2224 7b73 6974 657d 2220 2224 7b75  s "${site}" "${u
-0006b350: 7365 727d 2220 2224 7b70 6173 7377 6f72  ser}" "${passwor
-0006b360: 647d 2227 0d0a 2020 2020 2020 2020 2020  d}"'..          
-0006b370: 2020 2020 2020 2020 205d 0d0a 0d0a 2020           ]....  
-0006b380: 2020 2349 6e20 6465 6275 6720 6d6f 6465    #In debug mode
-0006b390: 2077 7269 7465 2074 6865 2064 6174 6120   write the data 
-0006b3a0: 696e 746f 2061 2074 7376 2066 696c 6520  into a tsv file 
-0006b3b0: 616e 6420 7265 6164 2069 7420 7769 7468  and read it with
-0006b3c0: 2049 6d70 6f72 7465 722c 2070 7574 7469   Importer, putti
-0006b3d0: 6e67 2074 6865 2065 6c65 6d65 6e74 7320  ng the elements 
-0006b3e0: 696e 746f 2045 6d70 6f77 6572 0d0a 2020  into Empower..  
-0006b3f0: 2020 6966 2064 6562 7567 3a0d 0a20 2020    if debug:..   
-0006b400: 2020 2020 2023 4e6f 6e20 7469 6d65 2064       #Non time d
-0006b410: 696d 656e 7369 6f6e 7320 6d61 7920 6861  imensions may ha
-0006b420: 7665 2066 6965 6c64 7320 2d20 7772 6974  ve fields - writ
-0006b430: 6520 7468 6520 7374 616e 6461 7264 2061  e the standard a
-0006b440: 6e64 206e 6f6e 2073 7461 6e64 6172 6420  nd non standard 
-0006b450: 6669 656c 6473 2074 6f20 6669 6c65 2061  fields to file a
-0006b460: 6e64 2069 6d70 6f72 7420 7468 656d 0d0a  nd import them..
-0006b470: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
-0006b480: 6e28 696d 706f 7274 6564 5f74 696d 655f  n(imported_time_
-0006b490: 6469 6d65 6e73 696f 6e5f 6669 6c65 7061  dimension_filepa
-0006b4a0: 7468 2c27 7727 2c65 6e63 6f64 696e 673d  th,'w',encoding=
-0006b4b0: 2775 7466 3827 2920 6173 2069 6d70 6f72  'utf8') as impor
-0006b4c0: 7465 645f 7469 6d65 5f64 696d 656e 7369  ted_time_dimensi
-0006b4d0: 6f6e 5f66 696c 653a 0d0a 0d0a 2020 2020  on_file:....    
-0006b4e0: 2020 2020 2020 2020 2357 7269 7465 2065          #Write e
-0006b4f0: 6d70 7479 2063 616c 6375 6c61 7469 6f6e  mpty calculation
-0006b500: 2065 6c65 6d65 6e74 7320 666f 7220 616c   elements for al
-0006b510: 6c20 6368 616e 6765 6420 6361 6c63 756c  l changed calcul
-0006b520: 6174 696f 6e73 2074 6f20 6865 6c70 2070  ations to help p
-0006b530: 7265 7665 6e74 2063 6972 6375 6c61 7220  revent circular 
-0006b540: 6361 6c63 756c 6174 696f 6e73 0d0a 2020  calculations..  
-0006b550: 2020 2020 2020 2020 2020 2354 6865 7365            #These
-0006b560: 2077 696c 6c20 6265 206f 7665 7277 7269   will be overwri
-0006b570: 7474 656e 2069 6d6d 6564 6961 7465 6c79  tten immediately
-0006b580: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-0006b590: 7220 7320 696e 205f 7969 656c 645f 7469  r s in _yield_ti
-0006b5a0: 6d65 5f64 696d 656e 7369 6f6e 5f73 7472  me_dimension_str
-0006b5b0: 696e 6773 2865 6c65 6d65 6e74 7329 3a0d  ings(elements):.
-0006b5c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006b5d0: 2069 6d70 6f72 7465 645f 7469 6d65 5f64   imported_time_d
-0006b5e0: 696d 656e 7369 6f6e 5f66 696c 652e 7772  imension_file.wr
-0006b5f0: 6974 6528 7329 0d0a 0d0a 2020 2020 2020  ite(s)....      
-0006b600: 2020 6c6c 752e 7275 6e5f 7369 6e67 6c65    llu.run_single
-0006b610: 5f6f 7574 7075 745f 696d 706f 7274 6572  _output_importer
-0006b620: 5f63 6f6d 6d61 6e64 7328 636f 6d6d 616e  _commands(comman
-0006b630: 645f 6c69 7374 2c65 6d70 6f77 6572 5f69  d_list,empower_i
-0006b640: 6d70 6f72 7465 725f 6578 6563 7574 6162  mporter_executab
-0006b650: 6c65 3d64 696d 656e 7369 6f6e 2e73 6974  le=dimension.sit
-0006b660: 652e 656d 706f 7765 725f 696d 706f 7274  e.empower_import
-0006b670: 6572 5f65 7865 6375 7461 626c 6529 0d0a  er_executable)..
-0006b680: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
-0006b690: 2020 2020 2023 496e 2027 6e6f 726d 616c       #In 'normal
-0006b6a0: 2720 6d6f 6465 2064 6f20 6120 6d65 7272  ' mode do a merr
-0006b6b0: 7920 6461 6e63 6520 7769 7468 2057 696e  y dance with Win
-0006b6c0: 646f 7773 206e 616d 6564 2070 6970 6573  dows named pipes
-0006b6d0: 2e20 5468 6973 2061 766f 6964 7320 7772  . This avoids wr
-0006b6e0: 6974 696e 6720 7468 6520 6461 7461 2074  iting the data t
-0006b6f0: 6f20 6669 6c65 2066 6f72 2073 6563 7572  o file for secur
-0006b700: 6974 7920 616e 6420 7072 6163 7469 6361  ity and practica
-0006b710: 6c69 7479 2072 6561 736f 6e73 0d0a 2020  lity reasons..  
-0006b720: 2020 2020 2020 2369 6d70 6f72 7465 645f        #imported_
-0006b730: 7469 6d65 5f64 696d 656e 7369 6f6e 5f66  time_dimension_f
-0006b740: 696c 6570 6174 6820 6973 2074 6865 206e  ilepath is the n
-0006b750: 616d 6520 6f66 2074 6865 206e 616d 6564  ame of the named
-0006b760: 2070 6970 6520 652e 672e 205c 5c2e 5c70   pipe e.g. \\.\p
-0006b770: 6970 655c 3964 6363 6661 3038 2d34 3063  ipe\9dccfa08-40c
-0006b780: 312d 3435 6635 2d38 6530 652d 6636 3463  1-45f5-8e0e-f64c
-0006b790: 3138 3530 3262 6364 0d0a 2020 2020 2020  18502bcd..      
-0006b7a0: 2020 2354 6865 206d 6572 7279 2064 616e    #The merry dan
-0006b7b0: 6365 206d 6561 6e73 2073 7461 7274 696e  ce means startin
-0006b7c0: 6720 656d 706f 7765 722c 2072 6566 6572  g empower, refer
-0006b7d0: 656e 6369 6e67 2074 6865 2070 6970 652c  encing the pipe,
-0006b7e0: 206f 7065 6e69 6e67 2074 6865 2070 6970   opening the pip
-0006b7f0: 6520 6265 666f 7265 2065 6d70 6f77 6572  e before empower
-0006b800: 2069 7320 7072 6f70 6572 6c79 2073 7461   is properly sta
-0006b810: 7274 6564 0d0a 2020 2020 2020 2020 2373  rted..        #s
-0006b820: 6574 7469 6e67 2075 7020 7468 6520 6e61  etting up the na
-0006b830: 6d65 6420 7069 7065 206f 6e20 7468 6973  med pipe on this
-0006b840: 2074 6872 6561 642c 2061 6e64 2077 7269   thread, and wri
-0006b850: 7469 6e67 2074 6f20 6974 2028 6173 2073  ting to it (as s
-0006b860: 6f6f 6e20 6173 2049 6d70 6f72 7465 7220  oon as Importer 
-0006b870: 636f 6e6e 6563 7473 2061 7420 6974 7320  connects at its 
-0006b880: 656e 6429 0d0a 2020 2020 2020 2020 2354  end)..        #T
-0006b890: 6865 2064 6966 6669 6375 6c74 792c 2069  he difficulty, i
-0006b8a0: 7320 7468 6174 2077 6520 6861 7665 2074  s that we have t
-0006b8b0: 6f20 7061 7373 2074 6865 206e 616d 6520  o pass the name 
-0006b8c0: 6f66 2074 6865 2070 6970 6520 746f 2049  of the pipe to I
-0006b8d0: 6d70 6f72 7465 722c 2061 6e64 2072 656c  mporter, and rel
-0006b8e0: 7920 6f6e 2074 6865 2066 6163 7420 7468  y on the fact th
-0006b8f0: 6174 2069 7420 776f 6e27 7420 6861 7665  at it won't have
-0006b900: 2074 696d 6520 746f 206f 7065 6e20 6974   time to open it
-0006b910: 0d0a 2020 2020 2020 2020 2362 6566 6f72  ..        #befor
-0006b920: 6520 7765 2068 6176 6520 6372 6561 7465  e we have create
-0006b930: 6420 6974 2e20 4275 7420 7765 2077 696c  d it. But we wil
-0006b940: 6c20 626c 6f63 6b20 6f6e 206f 7572 2073  l block on our s
-0006b950: 6964 6520 756e 7469 6c20 496d 706f 7274  ide until Import
-0006b960: 6572 2068 6173 2063 6f6e 6e65 6374 6564  er has connected
-0006b970: 0d0a 2020 2020 2020 2020 7072 6f63 203d  ..        proc =
-0006b980: 204e 6f6e 650d 0a20 2020 2020 2020 2074   None..        t
-0006b990: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
-0006b9a0: 2070 726f 6320 3d20 6c6c 752e 7374 6172   proc = llu.star
-0006b9b0: 745f 6e6f 5f6f 7574 7075 745f 696d 706f  t_no_output_impo
-0006b9c0: 7274 6572 5f63 6f6d 6d61 6e64 7328 636f  rter_commands(co
-0006b9d0: 6d6d 616e 645f 6c69 7374 2c65 6d70 6f77  mmand_list,empow
-0006b9e0: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
-0006b9f0: 7574 6162 6c65 3d64 696d 656e 7369 6f6e  utable=dimension
-0006ba00: 2e73 6974 652e 656d 706f 7765 725f 696d  .site.empower_im
-0006ba10: 706f 7274 6572 5f65 7865 6375 7461 626c  porter_executabl
-0006ba20: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-0006ba30: 7769 7468 206c 6c75 2e6f 7574 626f 756e  with llu.outboun
-0006ba40: 645f 7069 7065 2869 6d70 6f72 7465 645f  d_pipe(imported_
-0006ba50: 7469 6d65 5f64 696d 656e 7369 6f6e 5f66  time_dimension_f
-0006ba60: 696c 6570 6174 6829 2061 7320 7069 7065  ilepath) as pipe
-0006ba70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-0006ba80: 2020 2023 7769 6e33 3266 696c 652e 5772     #win32file.Wr
-0006ba90: 6974 6546 696c 6528 7069 7065 2c22 222e  iteFile(pipe,"".
-0006baa0: 656e 636f 6465 2822 7574 662d 3822 2929  encode("utf-8"))
-0006bab0: 3b0d 0a20 2020 2020 2020 2020 2020 2020  ;..             
-0006bac0: 2020 2023 5772 6974 6520 656d 7074 7920     #Write empty 
-0006bad0: 6361 6c63 756c 6174 696f 6e20 656c 656d  calculation elem
-0006bae0: 656e 7473 2066 6f72 2061 6c6c 2063 6861  ents for all cha
-0006baf0: 6e67 6564 2063 616c 6375 6c61 7469 6f6e  nged calculation
-0006bb00: 7320 746f 2068 656c 7020 7072 6576 656e  s to help preven
-0006bb10: 7420 6369 7263 756c 6172 2063 616c 6375  t circular calcu
-0006bb20: 6c61 7469 6f6e 730d 0a20 2020 2020 2020  lations..       
-0006bb30: 2020 2020 2020 2020 2023 5468 6573 6520           #These 
-0006bb40: 7769 6c6c 2062 6520 6f76 6572 7772 6974  will be overwrit
-0006bb50: 7465 6e20 696d 6d65 6469 6174 656c 790d  ten immediately.
-0006bb60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006bb70: 2066 6f72 2073 2069 6e20 5f79 6965 6c64   for s in _yield
-0006bb80: 5f74 696d 655f 6469 6d65 6e73 696f 6e5f  _time_dimension_
-0006bb90: 7374 7269 6e67 7328 656c 656d 656e 7473  strings(elements
-0006bba0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-0006bbb0: 2020 2020 2020 2020 2077 696e 3332 6669           win32fi
-0006bbc0: 6c65 2e57 7269 7465 4669 6c65 2870 6970  le.WriteFile(pip
-0006bbd0: 652c 2073 7472 2e65 6e63 6f64 6528 7329  e, str.encode(s)
-0006bbe0: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-0006bbf0: 2020 2020 206c 6f67 2e64 6562 7567 2822       log.debug("
-0006bc00: 5069 7065 207b 7d20 6669 6e69 7368 6564  Pipe {} finished
-0006bc10: 2077 7269 7469 6e67 222e 666f 726d 6174   writing".format
-0006bc20: 2869 6d70 6f72 7465 645f 7469 6d65 5f64  (imported_time_d
-0006bc30: 696d 656e 7369 6f6e 5f66 696c 6570 6174  imension_filepat
-0006bc40: 6829 290d 0a20 2020 2020 2020 2066 696e  h))..        fin
-0006bc50: 616c 6c79 3a0d 0a0d 0a20 2020 2020 2020  ally:....       
-0006bc60: 2020 2020 2023 4368 6563 6b20 6966 2049       #Check if I
-0006bc70: 6d70 6f72 7465 7220 7265 7475 726e 6564  mporter returned
-0006bc80: 2061 6e20 6572 726f 7220 616e 6420 7261   an error and ra
-0006bc90: 6973 6520 6974 2061 7320 6120 7079 7468  ise it as a pyth
-0006bca0: 6f6e 2069 6620 6974 2064 6964 0d0a 2020  on if it did..  
-0006bcb0: 2020 2020 2020 2020 2020 6c6c 752e 636f            llu.co
-0006bcc0: 6d70 6c65 7465 5f6e 6f5f 6f75 7470 7574  mplete_no_output
-0006bcd0: 5f69 6d70 6f72 7465 725f 7072 6f63 6573  _importer_proces
-0006bce0: 7328 7072 6f63 290d 0a0d 0a0d 0a0d 0a20  s(proc)........ 
-0006bcf0: 2020 2023 6465 6620 5f79 6965 6c64 5f74     #def _yield_t
-0006bd00: 696d 655f 6469 6d65 6e73 696f 6e5f 6669  ime_dimension_fi
-0006bd10: 656c 645f 7374 7269 6e67 7328 656c 656d  eld_strings(elem
-0006bd20: 656e 7473 293a 0d0a 2020 2020 230d 0a20  ents):..    #.. 
-0006bd30: 2020 2023 2020 2020 666f 7220 6f75 7470     #    for outp
-0006bd40: 7574 5f65 6c65 6d65 6e74 2069 6e20 656c  ut_element in el
-0006bd50: 656d 656e 7473 3a0d 0a20 2020 2023 0d0a  ements:..    #..
-0006bd60: 2020 2020 2320 2020 2020 2020 2079 6965      #        yie
-0006bd70: 6c64 206f 7574 7075 745f 656c 656d 656e  ld output_elemen
-0006bd80: 742e 6c6f 6e67 6e61 6d65 0d0a 2020 2020  t.longname..    
-0006bd90: 2320 2020 2020 2020 2079 6965 6c64 2027  #        yield '
-0006bda0: 5c74 270d 0a20 2020 2023 2020 2020 2020  \t'..    #      
-0006bdb0: 2020 6966 206f 7574 7075 745f 656c 656d    if output_elem
-0006bdc0: 656e 742e 7368 6f72 746e 616d 6520 6973  ent.shortname is
-0006bdd0: 206e 6f74 204e 6f6e 653a 0d0a 2020 2020   not None:..    
-0006bde0: 2320 2020 2020 2020 2020 2020 2079 6965  #            yie
-0006bdf0: 6c64 206f 7574 7075 745f 656c 656d 656e  ld output_elemen
-0006be00: 742e 7368 6f72 746e 616d 650d 0a20 2020  t.shortname..   
-0006be10: 2023 0d0a 2020 2020 2320 2020 2020 2020   #..    #       
-0006be20: 2079 6965 6c64 2027 5c74 270d 0a20 2020   yield '\t'..   
-0006be30: 2023 2020 2020 2020 2020 6966 206f 7574   #        if out
-0006be40: 7075 745f 656c 656d 656e 742e 6465 7363  put_element.desc
-0006be50: 7269 7074 696f 6e20 6973 206e 6f74 204e  ription is not N
-0006be60: 6f6e 653a 0d0a 2020 2020 2320 2020 2020  one:..    #     
-0006be70: 2020 2020 2020 2079 6965 6c64 206f 7574         yield out
-0006be80: 7075 745f 656c 656d 656e 742e 6465 7363  put_element.desc
-0006be90: 7269 7074 696f 6e0d 0a20 2020 2023 2020  ription..    #  
-0006bea0: 2020 2020 2020 7969 656c 6420 275c 6e27        yield '\n'
-0006beb0: 0d0a 2020 2020 230d 0a20 2020 2023 636f  ..    #..    #co
-0006bec0: 6d6d 616e 645f 6c69 7374 203d 2064 696d  mmand_list = dim
-0006bed0: 656e 7369 6f6e 2e73 6974 652e 5f6c 6f67  ension.site._log
-0006bee0: 6f6e 5f70 6172 616d 6574 6572 5f69 6d70  on_parameter_imp
-0006bef0: 6f72 7465 725f 636f 6d6d 616e 6473 202b  orter_commands +
-0006bf00: 205c 0d0a 2020 2020 2320 2020 2020 2020   \..    #       
-0006bf10: 2020 2020 2020 2020 5b27 7365 742d 7061          ['set-pa
-0006bf20: 7261 6d65 7465 7220 6469 6d65 6e73 696f  rameter dimensio
-0006bf30: 6e5f 696e 6465 783d 2720 2020 202b 2073  n_index='    + s
-0006bf40: 7472 2864 696d 656e 7369 6f6e 5f69 6e64  tr(dimension_ind
-0006bf50: 6578 290d 0a20 2020 2023 2020 2020 2020  ex)..    #      
-0006bf60: 2020 2020 2020 2020 202c 276c 6f61 642d           ,'load-
-0006bf70: 6669 6c65 2d74 7376 2022 2720 2020 2020  file-tsv "'     
-0006bf80: 2020 2020 2020 2020 2020 2020 2020 2b20                + 
-0006bf90: 696d 706f 7274 6564 5f64 696d 656e 7369  imported_dimensi
-0006bfa0: 6f6e 5f66 696c 6570 6174 6820 2b20 2722  on_filepath + '"
-0006bfb0: 270d 0a20 2020 2023 2020 2020 2020 2020  '..    #        
-0006bfc0: 2020 2020 2020 202c 2765 6d70 6f77 6572         ,'empower
-0006bfd0: 2d69 6d70 6f72 742d 6669 656c 642d 7661  -import-field-va
-0006bfe0: 6c75 6573 2022 247b 7369 7465 7d22 2022  lues "${site}" "
-0006bff0: 247b 7573 6572 7d22 2022 247b 7061 7373  ${user}" "${pass
-0006c000: 776f 7264 7d22 2024 7b64 696d 656e 7369  word}" ${dimensi
-0006c010: 6f6e 5f69 6e64 6578 7d27 0d0a 2020 2020  on_index}'..    
-0006c020: 2320 2020 2020 2020 2020 2020 2020 2020  #               
-0006c030: 5d0d 0a20 2020 2023 0d0a 2020 2020 2323  ]..    #..    ##
-0006c040: 426f 7468 2074 696d 6520 6469 6d65 6e73  Both time dimens
-0006c050: 696f 6e73 2061 6e64 2073 7461 6e64 6172  ions and standar
-0006c060: 6420 6469 6d65 6e73 696f 6e73 2077 696c  d dimensions wil
-0006c070: 6c20 6e65 6564 2074 6865 206c 6f6e 676e  l need the longn
-0006c080: 616d 650d 0a20 2020 2023 2349 6e20 6465  ame..    ##In de
-0006c090: 6275 6720 6d6f 6465 2077 7269 7465 2074  bug mode write t
-0006c0a0: 6865 2064 6174 6120 696e 746f 2061 2074  he data into a t
-0006c0b0: 7376 2066 696c 6520 616e 6420 7265 6164  sv file and read
-0006c0c0: 2069 7420 7769 7468 2049 6d70 6f72 7465   it with Importe
-0006c0d0: 722c 2070 7574 7469 6e67 2074 6865 2065  r, putting the e
-0006c0e0: 6c65 6d65 6e74 7320 696e 746f 2045 6d70  lements into Emp
-0006c0f0: 6f77 6572 0d0a 2020 2020 2369 6620 6465  ower..    #if de
-0006c100: 6275 673a 0d0a 2020 2020 2320 2020 2023  bug:..    #    #
-0006c110: 4e6f 6e20 7469 6d65 2064 696d 656e 7369  Non time dimensi
-0006c120: 6f6e 7320 6d61 7920 6861 7665 2066 6965  ons may have fie
-0006c130: 6c64 7320 2d20 7772 6974 6520 7468 6520  lds - write the 
-0006c140: 7374 616e 6461 7264 2061 6e64 206e 6f6e  standard and non
-0006c150: 2073 7461 6e64 6172 6420 6669 656c 6473   standard fields
-0006c160: 2074 6f20 6669 6c65 2061 6e64 2069 6d70   to file and imp
-0006c170: 6f72 7420 7468 656d 0d0a 2020 2020 2320  ort them..    # 
-0006c180: 2020 2077 6974 6820 6f70 656e 2869 6d70     with open(imp
-0006c190: 6f72 7465 645f 6469 6d65 6e73 696f 6e5f  orted_dimension_
-0006c1a0: 6669 6c65 7061 7468 2c27 7727 2920 6173  filepath,'w') as
-0006c1b0: 2069 6d70 6f72 7465 645f 6469 6d65 6e73   imported_dimens
-0006c1c0: 696f 6e5f 6669 6c65 3a0d 0a20 2020 2023  ion_file:..    #
-0006c1d0: 0d0a 2020 2020 2320 2020 2020 2020 2023  ..    #        #
-0006c1e0: 5772 6974 6520 656d 7074 7920 6361 6c63  Write empty calc
-0006c1f0: 756c 6174 696f 6e20 656c 656d 656e 7473  ulation elements
-0006c200: 2066 6f72 2061 6c6c 2063 6861 6e67 6564   for all changed
-0006c210: 2063 616c 6375 6c61 7469 6f6e 7320 746f   calculations to
-0006c220: 2068 656c 7020 7072 6576 656e 7420 6369   help prevent ci
-0006c230: 7263 756c 6172 2063 616c 6375 6c61 7469  rcular calculati
-0006c240: 6f6e 730d 0a20 2020 2023 2020 2020 2020  ons..    #      
-0006c250: 2020 2354 6865 7365 2077 696c 6c20 6265    #These will be
-0006c260: 206f 7665 7277 7269 7474 656e 2069 6d6d   overwritten imm
-0006c270: 6564 6961 7465 6c79 0d0a 2020 2020 2320  ediately..    # 
-0006c280: 2020 2020 2020 2066 6f72 2073 2069 6e20         for s in 
-0006c290: 5f79 6965 6c64 5f74 696d 655f 6469 6d65  _yield_time_dime
-0006c2a0: 6e73 696f 6e5f 6669 656c 645f 7374 7269  nsion_field_stri
-0006c2b0: 6e67 7328 656c 656d 656e 7473 293a 0d0a  ngs(elements):..
-0006c2c0: 2020 2020 2320 2020 2020 2020 2020 2020      #           
-0006c2d0: 2069 6d70 6f72 7465 645f 6469 6d65 6e73   imported_dimens
-0006c2e0: 696f 6e5f 6669 6c65 2e77 7269 7465 2873  ion_file.write(s
-0006c2f0: 290d 0a20 2020 2023 0d0a 2020 2020 2320  )..    #..    # 
-0006c300: 2020 206c 6c75 2e72 756e 5f73 696e 676c     llu.run_singl
-0006c310: 655f 6f75 7470 7574 5f69 6d70 6f72 7465  e_output_importe
-0006c320: 725f 636f 6d6d 616e 6473 2863 6f6d 6d61  r_commands(comma
-0006c330: 6e64 5f6c 6973 742c 656d 706f 7765 725f  nd_list,empower_
-0006c340: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
-0006c350: 626c 653d 6469 6d65 6e73 696f 6e2e 7369  ble=dimension.si
-0006c360: 7465 2e65 6d70 6f77 6572 5f69 6d70 6f72  te.empower_impor
-0006c370: 7465 725f 6578 6563 7574 6162 6c65 290d  ter_executable).
-0006c380: 0a20 2020 2023 0d0a 2020 2020 2365 6c73  .    #..    #els
-0006c390: 653a 0d0a 2020 2020 2320 2020 2023 496e  e:..    #    #In
-0006c3a0: 2027 6e6f 726d 616c 2720 6d6f 6465 2064   'normal' mode d
-0006c3b0: 6f20 6120 6d65 7272 7920 6461 6e63 6520  o a merry dance 
-0006c3c0: 7769 7468 2057 696e 646f 7773 206e 616d  with Windows nam
-0006c3d0: 6564 2070 6970 6573 2e20 5468 6973 2061  ed pipes. This a
-0006c3e0: 766f 6964 7320 7772 6974 696e 6720 7468  voids writing th
-0006c3f0: 6520 6461 7461 2074 6f20 6669 6c65 2066  e data to file f
-0006c400: 6f72 2073 6563 7572 6974 7920 616e 6420  or security and 
-0006c410: 7072 6163 7469 6361 6c69 7479 2072 6561  practicality rea
-0006c420: 736f 6e73 0d0a 2020 2020 2320 2020 2023  sons..    #    #
-0006c430: 696d 706f 7274 6564 5f64 696d 656e 7369  imported_dimensi
-0006c440: 6f6e 5f66 696c 6570 6174 6820 6973 2074  on_filepath is t
-0006c450: 6865 206e 616d 6520 6f66 2074 6865 206e  he name of the n
-0006c460: 616d 6564 2070 6970 6520 652e 672e 205c  amed pipe e.g. \
-0006c470: 5c2e 5c70 6970 655c 3964 6363 6661 3038  \.\pipe\9dccfa08
-0006c480: 2d34 3063 312d 3435 6635 2d38 6530 652d  -40c1-45f5-8e0e-
-0006c490: 6636 3463 3138 3530 3262 6364 0d0a 2020  f64c18502bcd..  
-0006c4a0: 2020 2320 2020 2023 5468 6520 6d65 7272    #    #The merr
-0006c4b0: 7920 6461 6e63 6520 6d65 616e 7320 7374  y dance means st
-0006c4c0: 6172 7469 6e67 2065 6d70 6f77 6572 2c20  arting empower, 
-0006c4d0: 7265 6665 7265 6e63 696e 6720 7468 6520  referencing the 
-0006c4e0: 7069 7065 2c20 6f70 656e 696e 6720 7468  pipe, opening th
-0006c4f0: 6520 7069 7065 2062 6566 6f72 6520 656d  e pipe before em
-0006c500: 706f 7765 7220 6973 2070 726f 7065 726c  power is properl
-0006c510: 7920 7374 6172 7465 640d 0a20 2020 2023  y started..    #
-0006c520: 2020 2020 2373 6574 7469 6e67 2075 7020      #setting up 
-0006c530: 7468 6520 6e61 6d65 6420 7069 7065 206f  the named pipe o
-0006c540: 6e20 7468 6973 2074 6872 6561 642c 2061  n this thread, a
-0006c550: 6e64 2077 7269 7469 6e67 2074 6f20 6974  nd writing to it
-0006c560: 2028 6173 2073 6f6f 6e20 6173 2049 6d70   (as soon as Imp
-0006c570: 6f72 7465 7220 636f 6e6e 6563 7473 2061  orter connects a
-0006c580: 7420 6974 7320 656e 6429 0d0a 2020 2020  t its end)..    
-0006c590: 2320 2020 2023 5468 6520 6469 6666 6963  #    #The diffic
-0006c5a0: 756c 7479 2c20 6973 2074 6861 7420 7765  ulty, is that we
-0006c5b0: 2068 6176 6520 746f 2070 6173 7320 7468   have to pass th
-0006c5c0: 6520 6e61 6d65 206f 6620 7468 6520 7069  e name of the pi
-0006c5d0: 7065 2074 6f20 496d 706f 7274 6572 2c20  pe to Importer, 
-0006c5e0: 616e 6420 7265 6c79 206f 6e20 7468 6520  and rely on the 
-0006c5f0: 6661 6374 2074 6861 7420 6974 2077 6f6e  fact that it won
-0006c600: 2774 2068 6176 6520 7469 6d65 2074 6f20  't have time to 
-0006c610: 6f70 656e 2069 740d 0a20 2020 2023 2020  open it..    #  
-0006c620: 2020 2362 6566 6f72 6520 7765 2068 6176    #before we hav
-0006c630: 6520 6372 6561 7465 6420 6974 2e20 4275  e created it. Bu
-0006c640: 7420 7765 2077 696c 6c20 626c 6f63 6b20  t we will block 
-0006c650: 6f6e 206f 7572 2073 6964 6520 756e 7469  on our side unti
-0006c660: 6c20 496d 706f 7274 6572 2068 6173 2063  l Importer has c
-0006c670: 6f6e 6e65 6374 6564 0d0a 2020 2020 2320  onnected..    # 
-0006c680: 2020 2070 726f 6320 3d20 4e6f 6e65 0d0a     proc = None..
-0006c690: 2020 2020 2320 2020 2074 7279 3a0d 0a20      #    try:.. 
-0006c6a0: 2020 2023 2020 2020 2020 2020 7072 6f63     #        proc
-0006c6b0: 203d 206c 6c75 2e73 7461 7274 5f6e 6f5f   = llu.start_no_
-0006c6c0: 6f75 7470 7574 5f69 6d70 6f72 7465 725f  output_importer_
-0006c6d0: 636f 6d6d 616e 6473 2863 6f6d 6d61 6e64  commands(command
-0006c6e0: 5f6c 6973 742c 656d 706f 7765 725f 696d  _list,empower_im
-0006c6f0: 706f 7274 6572 5f65 7865 6375 7461 626c  porter_executabl
-0006c700: 653d 6469 6d65 6e73 696f 6e2e 7369 7465  e=dimension.site
-0006c710: 2e65 6d70 6f77 6572 5f69 6d70 6f72 7465  .empower_importe
-0006c720: 725f 6578 6563 7574 6162 6c65 290d 0a20  r_executable).. 
-0006c730: 2020 2023 2020 2020 2020 2020 7769 7468     #        with
-0006c740: 206c 6c75 2e6f 7574 626f 756e 645f 7069   llu.outbound_pi
-0006c750: 7065 2869 6d70 6f72 7465 645f 6469 6d65  pe(imported_dime
-0006c760: 6e73 696f 6e5f 6669 6c65 7061 7468 2920  nsion_filepath) 
-0006c770: 6173 2070 6970 653a 0d0a 2020 2020 230d  as pipe:..    #.
-0006c780: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0006c790: 2020 2357 7269 7465 2065 6d70 7479 2063    #Write empty c
-0006c7a0: 616c 6375 6c61 7469 6f6e 2065 6c65 6d65  alculation eleme
-0006c7b0: 6e74 7320 666f 7220 616c 6c20 6368 616e  nts for all chan
-0006c7c0: 6765 6420 6361 6c63 756c 6174 696f 6e73  ged calculations
-0006c7d0: 2074 6f20 6865 6c70 2070 7265 7665 6e74   to help prevent
-0006c7e0: 2063 6972 6375 6c61 7220 6361 6c63 756c   circular calcul
-0006c7f0: 6174 696f 6e73 0d0a 2020 2020 2320 2020  ations..    #   
-0006c800: 2020 2020 2020 2020 2023 5468 6573 6520           #These 
-0006c810: 7769 6c6c 2062 6520 6f76 6572 7772 6974  will be overwrit
-0006c820: 7465 6e20 696d 6d65 6469 6174 656c 790d  ten immediately.
-0006c830: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0006c840: 2020 666f 7220 7320 696e 205f 7969 656c    for s in _yiel
-0006c850: 645f 7469 6d65 5f64 696d 656e 7369 6f6e  d_time_dimension
-0006c860: 5f66 6965 6c64 5f73 7472 696e 6773 2865  _field_strings(e
-0006c870: 6c65 6d65 6e74 7329 3a0d 0a20 2020 2023  lements):..    #
-0006c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006c890: 7769 6e33 3266 696c 652e 5772 6974 6546  win32file.WriteF
-0006c8a0: 696c 6528 7069 7065 2c20 7374 722e 656e  ile(pipe, str.en
-0006c8b0: 636f 6465 2873 2929 0d0a 2020 2020 230d  code(s))..    #.
-0006c8c0: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
-0006c8d0: 2020 6c6f 672e 6465 6275 6728 2250 6970    log.debug("Pip
-0006c8e0: 6520 7b7d 2066 696e 6973 6865 6420 7772  e {} finished wr
-0006c8f0: 6974 696e 6722 2e66 6f72 6d61 7428 696d  iting".format(im
-0006c900: 706f 7274 6564 5f64 696d 656e 7369 6f6e  ported_dimension
-0006c910: 5f66 696c 6570 6174 6829 290d 0a20 2020  _filepath))..   
-0006c920: 2023 0d0a 2020 2020 2320 2020 2066 696e   #..    #    fin
-0006c930: 616c 6c79 3a0d 0a20 2020 2023 0d0a 2020  ally:..    #..  
-0006c940: 2020 2320 2020 2020 2020 2023 4368 6563    #        #Chec
-0006c950: 6b20 6966 2049 6d70 6f72 7465 7220 7265  k if Importer re
-0006c960: 7475 726e 6564 2061 6e20 6572 726f 7220  turned an error 
-0006c970: 616e 6420 7261 6973 6520 6974 2061 7320  and raise it as 
-0006c980: 6120 7079 7468 6f6e 2069 6620 6974 2064  a python if it d
-0006c990: 6964 0d0a 2020 2020 2320 2020 2020 2020  id..    #       
-0006c9a0: 206c 6c75 2e63 6f6d 706c 6574 655f 6e6f   llu.complete_no
-0006c9b0: 5f6f 7574 7075 745f 696d 706f 7274 6572  _output_importer
-0006c9c0: 5f70 726f 6365 7373 2870 726f 6329 0d0a  _process(proc)..
-0006c9d0: 0d0a 2020 2020 6c6f 672e 7665 7262 6f73  ..    log.verbos
-0006c9e0: 6528 2754 696d 6520 456c 656d 656e 7473  e('Time Elements
-0006c9f0: 2063 7265 6174 6564 2066 6f72 2064 696d   created for dim
-0006ca00: 656e 7369 6f6e 2027 2b73 7472 2864 696d  ension '+str(dim
-0006ca10: 656e 7369 6f6e 5f69 6e64 6578 2929 0d0a  ension_index))..
-0006ca20: 0d0a 6465 6620 5f72 6561 645f 7374 7275  ..def _read_stru
-0006ca30: 6374 7572 655f 6672 6f6d 5f73 6974 6528  cture_from_site(
-0006ca40: 6469 6d65 6e73 696f 6e2c 7368 6f72 746e  dimension,shortn
-0006ca50: 616d 652c 656e 636f 6469 6e67 3d27 6370  ame,encoding='cp
-0006ca60: 3132 3532 272c 6f6c 645f 7374 7275 6374  1252',old_struct
-0006ca70: 7572 653d 4e6f 6e65 293a 0d0a 2020 2020  ure=None):..    
-0006ca80: 2727 2752 6561 6420 6120 7374 7275 6374  '''Read a struct
-0006ca90: 7572 6520 666f 7220 6120 6769 7665 6e20  ure for a given 
-0006caa0: 6469 6d65 6e73 696f 6e2c 2062 7920 7370  dimension, by sp
-0006cab0: 6563 6966 7969 6e67 2074 6865 2073 7472  ecifying the str
-0006cac0: 7563 7475 7265 2073 686f 7274 6e61 6d65  ucture shortname
-0006cad0: 0d0a 2020 2020 5265 7475 726e 2061 2053  ..    Return a S
-0006cae0: 7472 7563 7475 7265 2063 6c61 7373 0d0a  tructure class..
-0006caf0: 0d0a 2020 2020 3a70 6172 616d 2064 696d  ..    :param dim
-0006cb00: 656e 7369 6f6e 3a20 7468 6520 456d 706f  ension: the Empo
-0006cb10: 7765 7220 6469 6d65 6e73 696f 6e20 7765  wer dimension we
-0006cb20: 2061 7265 2072 6561 6469 6e67 2061 2073   are reading a s
-0006cb30: 7472 7563 7475 7265 2066 6f72 0d0a 2020  tructure for..  
-0006cb40: 2020 3a70 6172 616d 2073 686f 7274 6e61    :param shortna
-0006cb50: 6d3a 2053 686f 7274 204e 616d 6520 6f66  m: Short Name of
-0006cb60: 2074 6865 5374 7275 6374 7572 650d 0a20   theStructure.. 
-0006cb70: 2020 203a 7061 7261 6d20 6469 6d65 6e73     :param dimens
-0006cb80: 696f 6e5f 6461 7461 5f64 6963 743a 2041  ion_data_dict: A
-0006cb90: 2064 6963 7469 6f6e 6172 7920 6f66 2064   dictionary of d
-0006cba0: 696d 656e 7369 6f6e 2064 6174 6120 2d20  imension data - 
-0006cbb0: 6672 6f6d 2074 6865 2045 6d70 6f77 6572  from the Empower
-0006cbc0: 2065 7870 6f72 7465 6420 6469 6d65 6e73   exported dimens
-0006cbd0: 696f 6e2e 2049 6620 7468 6973 2069 7320  ion. If this is 
-0006cbe0: 656d 7074 792c 2074 6865 6e20 7468 6520  empty, then the 
-0006cbf0: 6469 6d65 6e73 696f 6e20 7769 6c6c 2062  dimension will b
-0006cc00: 6520 7265 6578 706f 7274 6564 2061 6e64  e reexported and
-0006cc10: 2072 6561 6420 696e 2074 6f20 7468 6520   read in to the 
-0006cc20: 6469 6374 696f 6e61 7279 0d0a 2020 2020  dictionary..    
-0006cc30: 2727 270d 0a20 2020 2077 6f72 6b69 6e67  '''..    working
-0006cc40: 5f64 6972 6563 746f 7279 2020 2020 2020  _directory      
-0006cc50: 2020 2020 203d 2064 696d 656e 7369 6f6e       = dimension
-0006cc60: 2e73 6974 652e 5f65 6d70 6f77 6572 5f65  .site._empower_e
-0006cc70: 7870 6f72 745f 6461 7461 5f64 6972 0d0a  xport_data_dir..
-0006cc80: 2020 2020 6f6c 645f 7374 7275 6374 7572      old_structur
-0006cc90: 6520 2020 2020 2020 2020 2020 2020 2020  e               
-0006cca0: 3d20 6f6c 645f 7374 7275 6374 7572 650d  = old_structure.
-0006ccb0: 0a20 2020 2064 6562 7567 2020 2020 2020  .    debug      
-0006ccc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ccd0: 203d 2064 696d 656e 7369 6f6e 2e73 6974   = dimension.sit
-0006cce0: 652e 5f64 6562 7567 0d0a 0d0a 2020 2020  e._debug....    
-0006ccf0: 6966 206f 6c64 5f73 7472 7563 7475 7265  if old_structure
-0006cd00: 2069 7320 6e6f 7420 4e6f 6e65 3a0d 0a20   is not None:.. 
-0006cd10: 2020 2020 2020 2073 7472 7563 7475 7265         structure
-0006cd20: 3d6f 6c64 5f73 7472 7563 7475 7265 0d0a  =old_structure..
-0006cd30: 2020 2020 2020 2020 2373 7472 7563 7475          #structu
-0006cd40: 7265 2e73 686f 7274 6e61 6d65 3d73 686f  re.shortname=sho
-0006cd50: 7274 6e61 6d65 0d0a 2020 2020 2020 2020  rtname..        
-0006cd60: 7374 7275 6374 7572 652e 6469 6d65 6e73  structure.dimens
-0006cd70: 696f 6e5f 696e 6465 7820 3d20 6469 6d65  ion_index = dime
-0006cd80: 6e73 696f 6e2e 696e 6465 780d 0a20 2020  nsion.index..   
-0006cd90: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
-0006cda0: 7374 7275 6374 7572 653d 5374 7275 6374  structure=Struct
-0006cdb0: 7572 6528 6469 6d65 6e73 696f 6e5f 696e  ure(dimension_in
-0006cdc0: 6465 783d 6469 6d65 6e73 696f 6e2e 696e  dex=dimension.in
-0006cdd0: 6465 782c 7368 6f72 746e 616d 653d 7368  dex,shortname=sh
-0006cde0: 6f72 746e 616d 6529 0d0a 0d0a 2020 2020  ortname)....    
-0006cdf0: 6966 2064 6562 7567 3a0d 0a20 2020 2020  if debug:..     
-0006ce00: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-0006ce10: 2020 2020 206f 732e 6d61 6b65 6469 7273       os.makedirs
-0006ce20: 2877 6f72 6b69 6e67 5f64 6972 6563 746f  (working_directo
-0006ce30: 7279 290d 0a20 2020 2020 2020 2065 7863  ry)..        exc
-0006ce40: 6570 7420 4669 6c65 4578 6973 7473 4572  ept FileExistsEr
-0006ce50: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-0006ce60: 2020 7061 7373 0d0a 0d0a 2020 2020 6578    pass....    ex
-0006ce70: 706f 7274 6564 5f73 7472 7563 7475 7265  ported_structure
-0006ce80: 5f66 696c 6570 6174 683d 6f73 2e70 6174  _filepath=os.pat
-0006ce90: 682e 6a6f 696e 2877 6f72 6b69 6e67 5f64  h.join(working_d
-0006cea0: 6972 6563 746f 7279 2c27 4578 706f 7274  irectory,'Export
-0006ceb0: 6564 5f53 7472 7563 7475 7265 5f27 2b73  ed_Structure_'+s
-0006cec0: 7472 2864 696d 656e 7369 6f6e 2e69 6e64  tr(dimension.ind
-0006ced0: 6578 292b 275f 272b 7374 7228 7368 6f72  ex)+'_'+str(shor
-0006cee0: 746e 616d 6529 2b27 2e74 7376 2729 0d0a  tname)+'.tsv')..
-0006cef0: 0d0a 2020 2020 6578 706f 7274 5f73 7472  ..    export_str
-0006cf00: 7563 7475 7265 5f69 6d70 6f72 7465 725f  ucture_importer_
-0006cf10: 7363 7269 7074 3d70 6b67 5f72 6573 6f75  script=pkg_resou
-0006cf20: 7263 6573 2e72 6573 6f75 7263 655f 6669  rces.resource_fi
-0006cf30: 6c65 6e61 6d65 2827 7079 6d70 7827 2c27  lename('pympx','
-0006cf40: 696d 706f 7274 6572 5f73 6372 6970 7473  importer_scripts
-0006cf50: 2f45 7870 6f72 7444 696d 656e 7369 6f6e  /ExportDimension
-0006cf60: 5374 7275 6374 7572 652e 6569 6d70 2729  Structure.eimp')
-0006cf70: 0d0a 0d0a 2020 2020 636f 6d6d 616e 645f  ....    command_
-0006cf80: 6c69 7374 203d 2064 696d 656e 7369 6f6e  list = dimension
-0006cf90: 2e73 6974 652e 5f6c 6f67 6f6e 5f70 6172  .site._logon_par
-0006cfa0: 616d 6574 6572 5f69 6d70 6f72 7465 725f  ameter_importer_
-0006cfb0: 636f 6d6d 616e 6473 202b 205c 0d0a 2020  commands + \..  
-0006cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006cfd0: 2020 2020 205b 2773 6574 2d70 6172 616d       ['set-param
-0006cfe0: 6574 6572 2064 696d 656e 7369 6f6e 5f69  eter dimension_i
-0006cff0: 6e64 6578 3d27 2020 2020 202b 2073 7472  ndex='     + str
-0006d000: 2864 696d 656e 7369 6f6e 2e69 6e64 6578  (dimension.index
-0006d010: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-0006d020: 2020 2020 2020 2020 2020 2c27 7365 742d            ,'set-
-0006d030: 7061 7261 6d65 7465 7220 7374 7275 6374  parameter struct
-0006d040: 7572 655f 7368 6f72 746e 616d 653d 2720  ure_shortname=' 
-0006d050: 2b20 7368 6f72 746e 616d 650d 0a20 2020  + shortname..   
-0006d060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d070: 2020 2020 2c27 656d 706f 7765 722d 6578      ,'empower-ex
-0006d080: 706f 7274 2d73 7472 7563 7475 7265 2022  port-structure "
-0006d090: 247b 7369 7465 7d22 2022 247b 7573 6572  ${site}" "${user
-0006d0a0: 7d22 2022 247b 7061 7373 776f 7264 7d22  }" "${password}"
-0006d0b0: 2024 7b64 696d 656e 7369 6f6e 5f69 6e64   ${dimension_ind
-0006d0c0: 6578 7d20 247b 7374 7275 6374 7572 655f  ex} ${structure_
-0006d0d0: 7368 6f72 746e 616d 657d 270d 0a20 2020  shortname}'..   
-0006d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d0f0: 2020 2020 2c27 7473 762d 656e 636f 6465      ,'tsv-encode
-0006d100: 270d 0a20 2020 2020 2020 2020 2020 2020  '..             
-0006d110: 2020 2020 2020 2020 2020 5d0d 0a0d 0a20            ].... 
-0006d120: 2020 2069 6620 6465 6275 673a 0d0a 2020     if debug:..  
-0006d130: 2020 2020 2020 636f 6d6d 616e 645f 6c69        command_li
-0006d140: 7374 202b 3d20 5b27 7361 7665 2d66 696c  st += ['save-fil
-0006d150: 6520 227b 7d22 272e 666f 726d 6174 286f  e "{}"'.format(o
-0006d160: 732e 7061 7468 2e61 6273 7061 7468 2865  s.path.abspath(e
-0006d170: 7870 6f72 7465 645f 7374 7275 6374 7572  xported_structur
-0006d180: 655f 6669 6c65 7061 7468 2929 5d0d 0a20  e_filepath))].. 
-0006d190: 2020 2020 2020 206c 6c75 2e72 756e 5f73         llu.run_s
-0006d1a0: 696e 676c 655f 6f75 7470 7574 5f69 6d70  ingle_output_imp
-0006d1b0: 6f72 7465 725f 636f 6d6d 616e 6473 2863  orter_commands(c
-0006d1c0: 6f6d 6d61 6e64 5f6c 6973 742c 656d 706f  ommand_list,empo
-0006d1d0: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
-0006d1e0: 6375 7461 626c 653d 6469 6d65 6e73 696f  cutable=dimensio
-0006d1f0: 6e2e 7369 7465 2e65 6d70 6f77 6572 5f69  n.site.empower_i
-0006d200: 6d70 6f72 7465 725f 6578 6563 7574 6162  mporter_executab
-0006d210: 6c65 290d 0a20 2020 2065 6c73 653a 0d0a  le)..    else:..
-0006d220: 2020 2020 2020 2020 636f 6d6d 616e 645f          command_
-0006d230: 6c69 7374 202b 3d20 5b27 6f75 7470 7574  list += ['output
-0006d240: 275d 0d0a 2020 2020 2020 2020 6f75 7470  ']..        outp
-0006d250: 7574 203d 206c 6c75 2e72 756e 5f73 696e  ut = llu.run_sin
-0006d260: 676c 655f 6f75 7470 7574 5f69 6d70 6f72  gle_output_impor
-0006d270: 7465 725f 636f 6d6d 616e 6473 2863 6f6d  ter_commands(com
-0006d280: 6d61 6e64 5f6c 6973 742c 656d 706f 7765  mand_list,empowe
-0006d290: 725f 696d 706f 7274 6572 5f65 7865 6375  r_importer_execu
-0006d2a0: 7461 626c 653d 6469 6d65 6e73 696f 6e2e  table=dimension.
-0006d2b0: 7369 7465 2e65 6d70 6f77 6572 5f69 6d70  site.empower_imp
-0006d2c0: 6f72 7465 725f 6578 6563 7574 6162 6c65  orter_executable
-0006d2d0: 290d 0a0d 0a20 2020 2064 6566 205f 7265  )....    def _re
-0006d2e0: 6164 5f65 7870 6f72 7465 645f 7374 7275  ad_exported_stru
-0006d2f0: 6374 7572 655f 6461 7461 2865 7870 6f72  cture_data(expor
-0006d300: 7465 645f 7374 7275 6374 7572 655f 6461  ted_structure_da
-0006d310: 7461 293a 0d0a 0d0a 2020 2020 2020 2020  ta):....        
-0006d320: 234e 6f74 6520 7061 7265 6e74 7320 616c  #Note parents al
-0006d330: 7761 7973 2065 7869 7374 2062 6566 6f72  ways exist befor
-0006d340: 6520 6368 696c 6472 656e 2c20 616e 6420  e children, and 
-0006d350: 7468 6520 7472 6565 2069 7320 616c 7761  the tree is alwa
-0006d360: 7973 2077 7269 7474 656e 2066 726f 6d20  ys written from 
-0006d370: 726f 6f74 2074 6f20 6c65 6166 0d0a 2020  root to leaf..  
-0006d380: 2020 2020 2020 2357 6520 6669 6e64 2074        #We find t
-0006d390: 6865 2070 6172 656e 7420 656c 656d 656e  he parent elemen
-0006d3a0: 7420 6279 206b 6565 7069 6e67 2074 7261  t by keeping tra
-0006d3b0: 636b 206f 6620 7468 6520 6c65 7665 6c2c  ck of the level,
-0006d3c0: 2061 6e64 2065 7373 656e 7469 616c 6c79   and essentially
-0006d3d0: 2070 6f70 7069 6e67 2065 6c65 6d65 6e74   popping element
-0006d3e0: 7320 7768 656e 2074 6865 206c 6576 656c  s when the level
-0006d3f0: 2064 6563 7265 6173 6573 0d0a 2020 2020   decreases..    
-0006d400: 2020 2020 2354 6865 2065 6173 6965 7374      #The easiest
-0006d410: 2077 6179 2074 6f20 646f 2074 6869 7320   way to do this 
-0006d420: 6973 2074 6f20 6861 7665 2061 206c 6576  is to have a lev
-0006d430: 656c 2064 6963 742c 2061 6e64 2075 7365  el dict, and use
-0006d440: 2074 6865 204c 6576 656c 206e 756d 6265   the Level numbe
-0006d450: 7220 746f 206c 6f6f 6b20 7570 2074 6865  r to look up the
-0006d460: 2070 7265 7669 6f75 7320 6c65 7665 6c20   previous level 
-0006d470: 7061 7265 6e74 0d0a 0d0a 2020 2020 2020  parent....      
-0006d480: 2020 2354 6865 2072 6561 736f 6e20 7765    #The reason we
-0006d490: 206d 7573 7420 7573 6520 7468 6520 7374   must use the st
-0006d4a0: 7275 6374 7572 6520 696e 2074 6865 2066  ructure in the f
-0006d4b0: 696c 6520 696e 2074 6869 7320 7761 7920  ile in this way 
-0006d4c0: 6973 2074 6861 7420 5348 4f52 544e 414d  is that SHORTNAM
-0006d4d0: 4553 204d 4159 2042 4520 5245 5045 4154  ES MAY BE REPEAT
-0006d4e0: 4544 2e0d 0a20 2020 2020 2020 2023 5468  ED...        #Th
-0006d4f0: 6973 206d 6561 6e73 2074 6861 7420 796f  is means that yo
-0006d500: 7520 6361 6e27 7420 6a75 7374 206c 6f6f  u can't just loo
-0006d510: 6b20 7570 2074 6865 2070 6172 656e 7420  k up the parent 
-0006d520: 656c 656d 656e 7420 6672 6f6d 2074 6865  element from the
-0006d530: 2073 7472 7563 7475 7265 2e20 4120 7061   structure. A pa
-0006d540: 7265 6e74 206d 6179 2061 7070 6561 7220  rent may appear 
-0006d550: 6d61 6e79 2074 696d 6573 2069 6e20 7468  many times in th
-0006d560: 6520 7361 6d65 2073 7472 7563 7475 7265  e same structure
-0006d570: 0d0a 0d0a 2020 2020 2020 2020 234e 6f74  ....        #Not
-0006d580: 653a 206c 6576 656c 7320 6d75 7374 2061  e: levels must a
-0006d590: 6c77 6179 7320 6265 206f 6e65 2067 7265  lways be one gre
-0006d5a0: 6174 6572 2074 6861 6e20 7468 6520 7072  ater than the pr
-0006d5b0: 6576 696f 7573 206c 6576 656c 2c20 6f72  evious level, or
-0006d5c0: 2074 6865 7920 6d61 7920 6265 2073 6d61   they may be sma
-0006d5d0: 6c6c 6572 2028 7570 2074 6f20 616e 7920  ller (up to any 
-0006d5e0: 616d 6f75 6e74 2073 6d61 6c6c 6572 290d  amount smaller).
-0006d5f0: 0a0d 0a20 2020 2020 2020 2023 652e 672e  ...        #e.g.
-0006d600: 0d0a 2020 2020 2020 2020 2330 0d0a 2020  ..        #0..  
-0006d610: 2020 2020 2020 2331 0d0a 2020 2020 2020        #1..      
-0006d620: 2020 2332 0d0a 2020 2020 2020 2020 2333    #2..        #3
-0006d630: 0d0a 2020 2020 2020 2020 2331 0d0a 2020  ..        #1..  
-0006d640: 2020 2020 2020 2332 0d0a 2020 2020 2020        #2..      
-0006d650: 2020 2332 0d0a 0d0a 2020 2020 2020 2020    #2....        
-0006d660: 2369 7320 6669 6e65 0d0a 0d0a 2020 2020  #is fine....    
-0006d670: 2020 2020 2341 2064 6963 7469 6f6e 6172      #A dictionar
-0006d680: 7920 6f66 2074 6865 2053 7472 7563 7475  y of the Structu
-0006d690: 7265 2065 6c65 6d65 6e74 7320 696e 2074  re elements in t
-0006d6a0: 6865 206c 6576 656c 2061 626f 7665 0d0a  he level above..
-0006d6b0: 2020 2020 2020 2020 6c65 7665 6c5f 6469          level_di
-0006d6c0: 6374 3d7b 7d0d 0a0d 0a20 2020 2020 2020  ct={}....       
-0006d6d0: 2072 6561 6465 723d 6373 762e 4469 6374   reader=csv.Dict
-0006d6e0: 5265 6164 6572 2865 7870 6f72 7465 645f  Reader(exported_
-0006d6f0: 7374 7275 6374 7572 655f 6461 7461 2c64  structure_data,d
-0006d700: 656c 696d 6974 6572 3d27 5c74 2729 0d0a  elimiter='\t')..
-0006d710: 2020 2020 2020 2020 7265 636f 7264 5f6e          record_n
-0006d720: 756d 203d 2030 0d0a 0d0a 2020 2020 2020  um = 0....      
-0006d730: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-0006d740: 2020 2020 666f 7220 7265 636f 7264 2069      for record i
-0006d750: 6e20 7265 6164 6572 3a0d 0a0d 0a20 2020  n reader:....   
-0006d760: 2020 2020 2020 2020 2020 2020 2072 6563               rec
-0006d770: 6f72 645f 6e75 6d2b 3d31 0d0a 0d0a 2020  ord_num+=1....  
-0006d780: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-0006d790: 7665 6c3d 2020 2020 2020 2020 2020 696e  vel=          in
-0006d7a0: 7428 7265 636f 7264 5b27 4c65 7665 6c27  t(record['Level'
-0006d7b0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-0006d7c0: 2020 2020 6973 5f72 6f6f 743d 2020 2020      is_root=    
-0006d7d0: 2020 2020 6c65 7665 6c3d 3d30 0d0a 0d0a      level==0....
+0006a980: 2827 6c65 6674 5f6f 6e3d 272b 7374 7228  ('left_on='+str(
+0006a990: 6c65 6674 5f6f 6e29 290d 0a20 2020 2020  left_on))..     
+0006a9a0: 2020 2020 2020 2070 7269 6e74 2827 7269         print('ri
+0006a9b0: 6768 745f 6f6e 3d27 2b73 7472 2872 6967  ght_on='+str(rig
+0006a9c0: 6874 5f6f 6e29 290d 0a20 2020 2020 2020  ht_on))..       
+0006a9d0: 2020 2020 2070 7269 6e74 2874 7261 6e73       print(trans
+0006a9e0: 6c61 7465 5f64 662e 6865 6164 2829 290d  late_df.head()).
+0006a9f0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0006aa00: 7365 0d0a 0d0a 2020 2020 2020 2020 2347  se....        #G
+0006aa10: 6574 2074 6865 2063 6f6c 756d 6e73 2066  et the columns f
+0006aa20: 6f72 2074 6865 2065 7870 6c6f 6465 2063  or the explode c
+0006aa30: 616c 6c0d 0a20 2020 2020 2020 2023 4368  all..        #Ch
+0006aa40: 616e 6765 2074 6865 2066 6965 6c64 2073  ange the field s
+0006aa50: 686f 7274 6e61 6d65 2074 6f20 6120 6e6f  hortname to a no
+0006aa60: 6e73 656e 7365 2073 7472 696e 6720 666f  nsense string fo
+0006aa70: 7220 7468 6520 6461 7461 6672 616d 6520  r the dataframe 
+0006aa80: 7265 6e61 6d65 202d 2074 6865 2063 6f64  rename - the cod
+0006aa90: 6520 6265 6c6f 7720 776f 6e27 7420 6163  e below won't ac
+0006aaa0: 6365 7074 2061 204e 6f6e 650d 0a20 2020  cept a None..   
+0006aab0: 2020 2020 2069 6620 6669 656c 645f 7368       if field_sh
+0006aac0: 6f72 746e 616d 6520 6973 204e 6f6e 653a  ortname is None:
+0006aad0: 0d0a 2020 2020 2020 2020 2020 2020 6669  ..            fi
+0006aae0: 656c 645f 7368 6f72 746e 616d 6520 3d20  eld_shortname = 
+0006aaf0: 2723 2323 2323 2323 2323 2323 2323 270d  '#############'.
+0006ab00: 0a20 2020 2020 2020 2063 6f6c 756d 6e73  .        columns
+0006ab10: 5f66 6f72 5f65 7870 6c6f 7369 6f6e 2b3d  _for_explosion+=
+0006ab20: 5b63 2066 6f72 2063 2069 6e20 7472 616e  [c for c in tran
+0006ab30: 736c 6174 655f 6466 2e63 6f6c 756d 6e73  slate_df.columns
+0006ab40: 2069 6620 6320 6e6f 7420 696e 205b 274c   if c not in ['L
+0006ab50: 4b55 5020 4c6f 6e67 204e 616d 6527 2c27  KUP Long Name','
+0006ab60: 4c4b 5550 2053 686f 7274 204e 616d 6527  LKUP Short Name'
+0006ab70: 2c27 4c4b 5550 2049 4427 2c27 4c4b 5550  ,'LKUP ID','LKUP
+0006ab80: 2027 2b66 6965 6c64 5f73 686f 7274 6e61   '+field_shortna
+0006ab90: 6d65 5d5d 0d0a 0d0a 2020 2020 2341 6464  me]]....    #Add
+0006aba0: 2074 6865 206e 6577 2063 6f6c 756d 6e73   the new columns
+0006abb0: 2069 6e74 6f20 7468 6520 6f72 6967 696e   into the origin
+0006abc0: 616c 2064 6174 6166 7261 6d65 0d0a 2020  al dataframe..  
+0006abd0: 2020 666f 7220 636f 6c75 6d6e 2069 6e20    for column in 
+0006abe0: 636f 6c75 6d6e 735f 666f 725f 6578 706c  columns_for_expl
+0006abf0: 6f73 696f 6e3a 0d0a 2020 2020 2020 2020  osion:..        
+0006ac00: 6466 5b63 6f6c 756d 6e5d 3d6e 6577 6466  df[column]=newdf
+0006ac10: 5b63 6f6c 756d 6e5d 0d0a 0d0a 2020 2020  [column]....    
+0006ac20: 2353 6574 2074 7261 6e73 6c61 7465 5f64  #Set translate_d
+0006ac30: 6620 746f 204e 6f6e 6520 2d20 746f 2068  f to None - to h
+0006ac40: 656c 7020 7468 6520 4761 7262 6167 6520  elp the Garbage 
+0006ac50: 436f 6c6c 6563 746f 720d 0a20 2020 2074  Collector..    t
+0006ac60: 7261 6e73 6c61 7465 5f64 6620 3d20 4e6f  ranslate_df = No
+0006ac70: 6e65 0d0a 0d0a 0d0a 2020 2020 2370 7269  ne......    #pri
+0006ac80: 6e74 2827 6466 2729 0d0a 2020 2020 2370  nt('df')..    #p
+0006ac90: 7269 6e74 2864 662e 696e 666f 2829 290d  rint(df.info()).
+0006aca0: 0a0d 0a20 2020 2072 6574 7572 6e20 636f  ...    return co
+0006acb0: 6c75 6d6e 735f 666f 725f 6578 706c 6f73  lumns_for_explos
+0006acc0: 696f 6e0d 0a0d 0a64 6566 205f 7469 6d65  ion....def _time
+0006acd0: 5f64 696d 656e 7369 6f6e 5f69 6d70 6f72  _dimension_impor
+0006ace0: 745f 656c 656d 656e 7473 2864 696d 656e  t_elements(dimen
+0006acf0: 7369 6f6e 2c20 656c 656d 656e 7473 2c69  sion, elements,i
+0006ad00: 6d70 6f72 7465 645f 6469 6d65 6e73 696f  mported_dimensio
+0006ad10: 6e5f 6669 6c65 7061 7468 2c69 6d70 6f72  n_filepath,impor
+0006ad20: 7465 645f 7469 6d65 5f64 696d 656e 7369  ted_time_dimensi
+0006ad30: 6f6e 5f66 696c 6570 6174 6820 293a 0d0a  on_filepath ):..
+0006ad40: 2020 2020 6469 6d65 6e73 696f 6e5f 696e      dimension_in
+0006ad50: 6465 7820 3d20 3131 0d0a 2020 2020 6465  dex = 11..    de
+0006ad60: 6275 6720 3d20 6469 6d65 6e73 696f 6e2e  bug = dimension.
+0006ad70: 7369 7465 2e5f 6465 6275 670d 0a0d 0a20  site._debug.... 
+0006ad80: 2020 2064 6566 205f 7969 656c 645f 7469     def _yield_ti
+0006ad90: 6d65 5f64 696d 656e 7369 6f6e 5f73 7472  me_dimension_str
+0006ada0: 696e 6773 2865 6c65 6d65 6e74 7329 3a0d  ings(elements):.
+0006adb0: 0a20 2020 2020 2020 2023 7469 6d65 2064  .        #time d
+0006adc0: 696d 656e 7369 6f6e 2065 6c65 6d65 6e74  imension element
+0006add0: 2073 7475 6666 0d0a 2020 2020 2020 2020   stuff..        
+0006ade0: 666f 7220 6f75 7470 7574 5f65 6c65 6d65  for output_eleme
+0006adf0: 6e74 2069 6e20 656c 656d 656e 7473 3a0d  nt in elements:.
+0006ae00: 0a20 2020 2020 2020 2020 2020 2023 6c6f  .            #lo
+0006ae10: 6e67 6e61 6d65 732c 2079 6561 722c 206d  ngnames, year, m
+0006ae20: 6f6e 7468 2c20 6461 7920 616e 6420 696e  onth, day and in
+0006ae30: 7465 7276 616c 2069 6e64 6578 2028 7965  terval index (ye
+0006ae40: 6172 203d 2030 2c20 6461 7920 3d20 3529  ar = 0, day = 5)
+0006ae50: 2e0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
+0006ae60: 5075 7420 7468 6520 7368 6f72 746e 616d  Put the shortnam
+0006ae70: 6520 696e 746f 2074 6865 206c 6f6e 676e  e into the longn
+0006ae80: 616d 6520 6669 656c 6420 2d20 7468 6520  ame field - the 
+0006ae90: 7368 6f72 746e 616d 6520 7769 6c6c 2062  shortname will b
+0006aea0: 6520 6465 6661 756c 7465 6420 746f 2074  e defaulted to t
+0006aeb0: 6865 206c 6f6e 676e 616d 652e 0d0a 2020  he longname...  
+0006aec0: 2020 2020 2020 2020 2020 2354 6865 6e20            #Then 
+0006aed0: 7468 6520 7374 616e 6461 7264 2064 696d  the standard dim
+0006aee0: 656e 7369 6f6e 2063 6f64 6520 7769 6c6c  ension code will
+0006aef0: 2062 6520 7275 6e20 746f 2063 6f72 7265   be run to corre
+0006af00: 6374 2074 6865 206c 6f6e 676e 616d 6520  ct the longname 
+0006af10: 616e 6420 6164 6420 7468 6520 6465 7363  and add the desc
+0006af20: 7269 7074 696f 6e0d 0a20 2020 2020 2020  ription..       
+0006af30: 2020 2020 2069 6620 6f75 7470 7574 5f65       if output_e
+0006af40: 6c65 6d65 6e74 2e6c 6f6e 676e 616d 6520  lement.longname 
+0006af50: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+0006af60: 2020 2020 2020 2020 2020 2020 2020 7969                yi
+0006af70: 656c 6420 6f75 7470 7574 5f65 6c65 6d65  eld output_eleme
+0006af80: 6e74 2e6c 6f6e 676e 616d 650d 0a20 2020  nt.longname..   
+0006af90: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
+0006afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006afb0: 7969 656c 6420 6f75 7470 7574 5f65 6c65  yield output_ele
+0006afc0: 6d65 6e74 2e73 686f 7274 6e61 6d65 0d0a  ment.shortname..
+0006afd0: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+0006afe0: 6420 275c 7427 0d0a 2020 2020 2020 2020  d '\t'..        
+0006aff0: 2020 2020 6966 206f 7574 7075 745f 656c      if output_el
+0006b000: 656d 656e 742e 7368 6f72 746e 616d 6520  ement.shortname 
+0006b010: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+0006b020: 2020 2020 2020 2020 2020 2020 2020 7969                yi
+0006b030: 656c 6420 6f75 7470 7574 5f65 6c65 6d65  eld output_eleme
+0006b040: 6e74 2e73 686f 7274 6e61 6d65 0d0a 2020  nt.shortname..  
+0006b050: 2020 2020 2020 2020 2020 7969 656c 6420            yield 
+0006b060: 275c 7427 0d0a 2020 2020 2020 2020 2020  '\t'..          
+0006b070: 2020 6966 206f 7574 7075 745f 656c 656d    if output_elem
+0006b080: 656e 742e 7965 6172 2069 7320 6e6f 7420  ent.year is not 
+0006b090: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
+0006b0a0: 2020 2020 2020 2079 6965 6c64 2073 7472         yield str
+0006b0b0: 2869 6e74 286f 7574 7075 745f 656c 656d  (int(output_elem
+0006b0c0: 656e 742e 7965 6172 2929 0d0a 2020 2020  ent.year))..    
+0006b0d0: 2020 2020 2020 2020 7969 656c 6420 275c          yield '\
+0006b0e0: 7427 0d0a 2020 2020 2020 2020 2020 2020  t'..            
+0006b0f0: 6966 206f 7574 7075 745f 656c 656d 656e  if output_elemen
+0006b100: 742e 6d6f 6e74 6820 6973 206e 6f74 204e  t.month is not N
+0006b110: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
+0006b120: 2020 2020 2020 7969 656c 6420 7374 7228        yield str(
+0006b130: 696e 7428 6f75 7470 7574 5f65 6c65 6d65  int(output_eleme
+0006b140: 6e74 2e6d 6f6e 7468 2929 0d0a 2020 2020  nt.month))..    
+0006b150: 2020 2020 2020 2020 7969 656c 6420 275c          yield '\
+0006b160: 7427 0d0a 2020 2020 2020 2020 2020 2020  t'..            
+0006b170: 6966 206f 7574 7075 745f 656c 656d 656e  if output_elemen
+0006b180: 742e 6461 7920 6973 206e 6f74 204e 6f6e  t.day is not Non
+0006b190: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+0006b1a0: 2020 2020 7969 656c 6420 7374 7228 696e      yield str(in
+0006b1b0: 7428 6f75 7470 7574 5f65 6c65 6d65 6e74  t(output_element
+0006b1c0: 2e64 6179 2929 0d0a 2020 2020 2020 2020  .day))..        
+0006b1d0: 2020 2020 7969 656c 6420 275c 7427 0d0a      yield '\t'..
+0006b1e0: 2020 2020 2020 2020 2020 2020 7969 656c              yiel
+0006b1f0: 6420 7374 7228 696e 7428 6f75 7470 7574  d str(int(output
+0006b200: 5f65 6c65 6d65 6e74 2e69 6e74 6572 7661  _element.interva
+0006b210: 6c5f 696e 6465 7829 290d 0a20 2020 2020  l_index))..     
+0006b220: 2020 2020 2020 2079 6965 6c64 2027 5c6e         yield '\n
+0006b230: 270d 0a0d 0a20 2020 2023 496d 706f 7274  '....    #Import
+0006b240: 2074 6865 2065 6c65 6d65 6e74 7320 696e   the elements in
+0006b250: 2074 6865 2077 6f72 6b69 6e67 2066 696c   the working fil
+0006b260: 6520 696e 746f 2045 6d70 6f77 6572 0d0a  e into Empower..
+0006b270: 2020 2020 2345 7870 6f72 7420 7468 6520      #Export the 
+0006b280: 7374 7275 6374 7572 6520 746f 2077 6f72  structure to wor
+0006b290: 6b69 6e67 5f64 6972 6563 746f 7279 0d0a  king_directory..
+0006b2a0: 0d0a 2020 2020 636f 6d6d 616e 645f 6c69  ..    command_li
+0006b2b0: 7374 203d 2064 696d 656e 7369 6f6e 2e73  st = dimension.s
+0006b2c0: 6974 652e 5f6c 6f67 6f6e 5f70 6172 616d  ite._logon_param
+0006b2d0: 6574 6572 5f69 6d70 6f72 7465 725f 636f  eter_importer_co
+0006b2e0: 6d6d 616e 6473 202b 205c 0d0a 2020 2020  mmands + \..    
+0006b2f0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0006b300: 276c 6f61 642d 6669 6c65 2d74 7376 2022  'load-file-tsv "
+0006b310: 2720 2b20 696d 706f 7274 6564 5f74 696d  ' + imported_tim
+0006b320: 655f 6469 6d65 6e73 696f 6e5f 6669 6c65  e_dimension_file
+0006b330: 7061 7468 202b 2027 2227 0d0a 2020 2020  path + '"'..    
+0006b340: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0006b350: 2765 6d70 6f77 6572 2d69 6d70 6f72 742d  'empower-import-
+0006b360: 7469 6d65 2d65 6c65 6d65 6e74 7320 2224  time-elements "$
+0006b370: 7b73 6974 657d 2220 2224 7b75 7365 727d  {site}" "${user}
+0006b380: 2220 2224 7b70 6173 7377 6f72 647d 2227  " "${password}"'
+0006b390: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006b3a0: 2020 2020 205d 0d0a 0d0a 2020 2020 2349       ]....    #I
+0006b3b0: 6e20 6465 6275 6720 6d6f 6465 2077 7269  n debug mode wri
+0006b3c0: 7465 2074 6865 2064 6174 6120 696e 746f  te the data into
+0006b3d0: 2061 2074 7376 2066 696c 6520 616e 6420   a tsv file and 
+0006b3e0: 7265 6164 2069 7420 7769 7468 2049 6d70  read it with Imp
+0006b3f0: 6f72 7465 722c 2070 7574 7469 6e67 2074  orter, putting t
+0006b400: 6865 2065 6c65 6d65 6e74 7320 696e 746f  he elements into
+0006b410: 2045 6d70 6f77 6572 0d0a 2020 2020 6966   Empower..    if
+0006b420: 2064 6562 7567 3a0d 0a20 2020 2020 2020   debug:..       
+0006b430: 2023 4e6f 6e20 7469 6d65 2064 696d 656e   #Non time dimen
+0006b440: 7369 6f6e 7320 6d61 7920 6861 7665 2066  sions may have f
+0006b450: 6965 6c64 7320 2d20 7772 6974 6520 7468  ields - write th
+0006b460: 6520 7374 616e 6461 7264 2061 6e64 206e  e standard and n
+0006b470: 6f6e 2073 7461 6e64 6172 6420 6669 656c  on standard fiel
+0006b480: 6473 2074 6f20 6669 6c65 2061 6e64 2069  ds to file and i
+0006b490: 6d70 6f72 7420 7468 656d 0d0a 2020 2020  mport them..    
+0006b4a0: 2020 2020 7769 7468 206f 7065 6e28 696d      with open(im
+0006b4b0: 706f 7274 6564 5f74 696d 655f 6469 6d65  ported_time_dime
+0006b4c0: 6e73 696f 6e5f 6669 6c65 7061 7468 2c27  nsion_filepath,'
+0006b4d0: 7727 2c65 6e63 6f64 696e 673d 2775 7466  w',encoding='utf
+0006b4e0: 3827 2920 6173 2069 6d70 6f72 7465 645f  8') as imported_
+0006b4f0: 7469 6d65 5f64 696d 656e 7369 6f6e 5f66  time_dimension_f
+0006b500: 696c 653a 0d0a 0d0a 2020 2020 2020 2020  ile:....        
+0006b510: 2020 2020 2357 7269 7465 2065 6d70 7479      #Write empty
+0006b520: 2063 616c 6375 6c61 7469 6f6e 2065 6c65   calculation ele
+0006b530: 6d65 6e74 7320 666f 7220 616c 6c20 6368  ments for all ch
+0006b540: 616e 6765 6420 6361 6c63 756c 6174 696f  anged calculatio
+0006b550: 6e73 2074 6f20 6865 6c70 2070 7265 7665  ns to help preve
+0006b560: 6e74 2063 6972 6375 6c61 7220 6361 6c63  nt circular calc
+0006b570: 756c 6174 696f 6e73 0d0a 2020 2020 2020  ulations..      
+0006b580: 2020 2020 2020 2354 6865 7365 2077 696c        #These wil
+0006b590: 6c20 6265 206f 7665 7277 7269 7474 656e  l be overwritten
+0006b5a0: 2069 6d6d 6564 6961 7465 6c79 0d0a 2020   immediately..  
+0006b5b0: 2020 2020 2020 2020 2020 666f 7220 7320            for s 
+0006b5c0: 696e 205f 7969 656c 645f 7469 6d65 5f64  in _yield_time_d
+0006b5d0: 696d 656e 7369 6f6e 5f73 7472 696e 6773  imension_strings
+0006b5e0: 2865 6c65 6d65 6e74 7329 3a0d 0a20 2020  (elements):..   
+0006b5f0: 2020 2020 2020 2020 2020 2020 2069 6d70               imp
+0006b600: 6f72 7465 645f 7469 6d65 5f64 696d 656e  orted_time_dimen
+0006b610: 7369 6f6e 5f66 696c 652e 7772 6974 6528  sion_file.write(
+0006b620: 7329 0d0a 0d0a 2020 2020 2020 2020 6c6c  s)....        ll
+0006b630: 752e 7275 6e5f 7369 6e67 6c65 5f6f 7574  u.run_single_out
+0006b640: 7075 745f 696d 706f 7274 6572 5f63 6f6d  put_importer_com
+0006b650: 6d61 6e64 7328 636f 6d6d 616e 645f 6c69  mands(command_li
+0006b660: 7374 2c65 6d70 6f77 6572 5f69 6d70 6f72  st,empower_impor
+0006b670: 7465 725f 6578 6563 7574 6162 6c65 3d64  ter_executable=d
+0006b680: 696d 656e 7369 6f6e 2e73 6974 652e 656d  imension.site.em
+0006b690: 706f 7765 725f 696d 706f 7274 6572 5f65  power_importer_e
+0006b6a0: 7865 6375 7461 626c 6529 0d0a 0d0a 2020  xecutable)....  
+0006b6b0: 2020 656c 7365 3a0d 0a20 2020 2020 2020    else:..       
+0006b6c0: 2023 496e 2027 6e6f 726d 616c 2720 6d6f   #In 'normal' mo
+0006b6d0: 6465 2064 6f20 6120 6d65 7272 7920 6461  de do a merry da
+0006b6e0: 6e63 6520 7769 7468 2057 696e 646f 7773  nce with Windows
+0006b6f0: 206e 616d 6564 2070 6970 6573 2e20 5468   named pipes. Th
+0006b700: 6973 2061 766f 6964 7320 7772 6974 696e  is avoids writin
+0006b710: 6720 7468 6520 6461 7461 2074 6f20 6669  g the data to fi
+0006b720: 6c65 2066 6f72 2073 6563 7572 6974 7920  le for security 
+0006b730: 616e 6420 7072 6163 7469 6361 6c69 7479  and practicality
+0006b740: 2072 6561 736f 6e73 0d0a 2020 2020 2020   reasons..      
+0006b750: 2020 2369 6d70 6f72 7465 645f 7469 6d65    #imported_time
+0006b760: 5f64 696d 656e 7369 6f6e 5f66 696c 6570  _dimension_filep
+0006b770: 6174 6820 6973 2074 6865 206e 616d 6520  ath is the name 
+0006b780: 6f66 2074 6865 206e 616d 6564 2070 6970  of the named pip
+0006b790: 6520 652e 672e 205c 5c2e 5c70 6970 655c  e e.g. \\.\pipe\
+0006b7a0: 3964 6363 6661 3038 2d34 3063 312d 3435  9dccfa08-40c1-45
+0006b7b0: 6635 2d38 6530 652d 6636 3463 3138 3530  f5-8e0e-f64c1850
+0006b7c0: 3262 6364 0d0a 2020 2020 2020 2020 2354  2bcd..        #T
+0006b7d0: 6865 206d 6572 7279 2064 616e 6365 206d  he merry dance m
+0006b7e0: 6561 6e73 2073 7461 7274 696e 6720 656d  eans starting em
+0006b7f0: 706f 7765 722c 2072 6566 6572 656e 6369  power, referenci
+0006b800: 6e67 2074 6865 2070 6970 652c 206f 7065  ng the pipe, ope
+0006b810: 6e69 6e67 2074 6865 2070 6970 6520 6265  ning the pipe be
+0006b820: 666f 7265 2065 6d70 6f77 6572 2069 7320  fore empower is 
+0006b830: 7072 6f70 6572 6c79 2073 7461 7274 6564  properly started
+0006b840: 0d0a 2020 2020 2020 2020 2373 6574 7469  ..        #setti
+0006b850: 6e67 2075 7020 7468 6520 6e61 6d65 6420  ng up the named 
+0006b860: 7069 7065 206f 6e20 7468 6973 2074 6872  pipe on this thr
+0006b870: 6561 642c 2061 6e64 2077 7269 7469 6e67  ead, and writing
+0006b880: 2074 6f20 6974 2028 6173 2073 6f6f 6e20   to it (as soon 
+0006b890: 6173 2049 6d70 6f72 7465 7220 636f 6e6e  as Importer conn
+0006b8a0: 6563 7473 2061 7420 6974 7320 656e 6429  ects at its end)
+0006b8b0: 0d0a 2020 2020 2020 2020 2354 6865 2064  ..        #The d
+0006b8c0: 6966 6669 6375 6c74 792c 2069 7320 7468  ifficulty, is th
+0006b8d0: 6174 2077 6520 6861 7665 2074 6f20 7061  at we have to pa
+0006b8e0: 7373 2074 6865 206e 616d 6520 6f66 2074  ss the name of t
+0006b8f0: 6865 2070 6970 6520 746f 2049 6d70 6f72  he pipe to Impor
+0006b900: 7465 722c 2061 6e64 2072 656c 7920 6f6e  ter, and rely on
+0006b910: 2074 6865 2066 6163 7420 7468 6174 2069   the fact that i
+0006b920: 7420 776f 6e27 7420 6861 7665 2074 696d  t won't have tim
+0006b930: 6520 746f 206f 7065 6e20 6974 0d0a 2020  e to open it..  
+0006b940: 2020 2020 2020 2362 6566 6f72 6520 7765        #before we
+0006b950: 2068 6176 6520 6372 6561 7465 6420 6974   have created it
+0006b960: 2e20 4275 7420 7765 2077 696c 6c20 626c  . But we will bl
+0006b970: 6f63 6b20 6f6e 206f 7572 2073 6964 6520  ock on our side 
+0006b980: 756e 7469 6c20 496d 706f 7274 6572 2068  until Importer h
+0006b990: 6173 2063 6f6e 6e65 6374 6564 0d0a 2020  as connected..  
+0006b9a0: 2020 2020 2020 7072 6f63 203d 204e 6f6e        proc = Non
+0006b9b0: 650d 0a20 2020 2020 2020 2074 7279 3a0d  e..        try:.
+0006b9c0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+0006b9d0: 6320 3d20 6c6c 752e 7374 6172 745f 6e6f  c = llu.start_no
+0006b9e0: 5f6f 7574 7075 745f 696d 706f 7274 6572  _output_importer
+0006b9f0: 5f63 6f6d 6d61 6e64 7328 636f 6d6d 616e  _commands(comman
+0006ba00: 645f 6c69 7374 2c65 6d70 6f77 6572 5f69  d_list,empower_i
+0006ba10: 6d70 6f72 7465 725f 6578 6563 7574 6162  mporter_executab
+0006ba20: 6c65 3d64 696d 656e 7369 6f6e 2e73 6974  le=dimension.sit
+0006ba30: 652e 656d 706f 7765 725f 696d 706f 7274  e.empower_import
+0006ba40: 6572 5f65 7865 6375 7461 626c 6529 0d0a  er_executable)..
+0006ba50: 2020 2020 2020 2020 2020 2020 7769 7468              with
+0006ba60: 206c 6c75 2e6f 7574 626f 756e 645f 7069   llu.outbound_pi
+0006ba70: 7065 2869 6d70 6f72 7465 645f 7469 6d65  pe(imported_time
+0006ba80: 5f64 696d 656e 7369 6f6e 5f66 696c 6570  _dimension_filep
+0006ba90: 6174 6829 2061 7320 7069 7065 3a0d 0a20  ath) as pipe:.. 
+0006baa0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0006bab0: 7769 6e33 3266 696c 652e 5772 6974 6546  win32file.WriteF
+0006bac0: 696c 6528 7069 7065 2c22 222e 656e 636f  ile(pipe,"".enco
+0006bad0: 6465 2822 7574 662d 3822 2929 3b0d 0a20  de("utf-8"));.. 
+0006bae0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0006baf0: 5772 6974 6520 656d 7074 7920 6361 6c63  Write empty calc
+0006bb00: 756c 6174 696f 6e20 656c 656d 656e 7473  ulation elements
+0006bb10: 2066 6f72 2061 6c6c 2063 6861 6e67 6564   for all changed
+0006bb20: 2063 616c 6375 6c61 7469 6f6e 7320 746f   calculations to
+0006bb30: 2068 656c 7020 7072 6576 656e 7420 6369   help prevent ci
+0006bb40: 7263 756c 6172 2063 616c 6375 6c61 7469  rcular calculati
+0006bb50: 6f6e 730d 0a20 2020 2020 2020 2020 2020  ons..           
+0006bb60: 2020 2020 2023 5468 6573 6520 7769 6c6c       #These will
+0006bb70: 2062 6520 6f76 6572 7772 6974 7465 6e20   be overwritten 
+0006bb80: 696d 6d65 6469 6174 656c 790d 0a20 2020  immediately..   
+0006bb90: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+0006bba0: 2073 2069 6e20 5f79 6965 6c64 5f74 696d   s in _yield_tim
+0006bbb0: 655f 6469 6d65 6e73 696f 6e5f 7374 7269  e_dimension_stri
+0006bbc0: 6e67 7328 656c 656d 656e 7473 293a 0d0a  ngs(elements):..
+0006bbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006bbe0: 2020 2020 2077 696e 3332 6669 6c65 2e57       win32file.W
+0006bbf0: 7269 7465 4669 6c65 2870 6970 652c 2073  riteFile(pipe, s
+0006bc00: 7472 2e65 6e63 6f64 6528 7329 290d 0a0d  tr.encode(s))...
+0006bc10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006bc20: 206c 6f67 2e64 6562 7567 2822 5069 7065   log.debug("Pipe
+0006bc30: 207b 7d20 6669 6e69 7368 6564 2077 7269   {} finished wri
+0006bc40: 7469 6e67 222e 666f 726d 6174 2869 6d70  ting".format(imp
+0006bc50: 6f72 7465 645f 7469 6d65 5f64 696d 656e  orted_time_dimen
+0006bc60: 7369 6f6e 5f66 696c 6570 6174 6829 290d  sion_filepath)).
+0006bc70: 0a20 2020 2020 2020 2066 696e 616c 6c79  .        finally
+0006bc80: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
+0006bc90: 2023 4368 6563 6b20 6966 2049 6d70 6f72   #Check if Impor
+0006bca0: 7465 7220 7265 7475 726e 6564 2061 6e20  ter returned an 
+0006bcb0: 6572 726f 7220 616e 6420 7261 6973 6520  error and raise 
+0006bcc0: 6974 2061 7320 6120 7079 7468 6f6e 2069  it as a python i
+0006bcd0: 6620 6974 2064 6964 0d0a 2020 2020 2020  f it did..      
+0006bce0: 2020 2020 2020 6c6c 752e 636f 6d70 6c65        llu.comple
+0006bcf0: 7465 5f6e 6f5f 6f75 7470 7574 5f69 6d70  te_no_output_imp
+0006bd00: 6f72 7465 725f 7072 6f63 6573 7328 7072  orter_process(pr
+0006bd10: 6f63 290d 0a0d 0a0d 0a0d 0a20 2020 2023  oc)........    #
+0006bd20: 6465 6620 5f79 6965 6c64 5f74 696d 655f  def _yield_time_
+0006bd30: 6469 6d65 6e73 696f 6e5f 6669 656c 645f  dimension_field_
+0006bd40: 7374 7269 6e67 7328 656c 656d 656e 7473  strings(elements
+0006bd50: 293a 0d0a 2020 2020 230d 0a20 2020 2023  ):..    #..    #
+0006bd60: 2020 2020 666f 7220 6f75 7470 7574 5f65      for output_e
+0006bd70: 6c65 6d65 6e74 2069 6e20 656c 656d 656e  lement in elemen
+0006bd80: 7473 3a0d 0a20 2020 2023 0d0a 2020 2020  ts:..    #..    
+0006bd90: 2320 2020 2020 2020 2079 6965 6c64 206f  #        yield o
+0006bda0: 7574 7075 745f 656c 656d 656e 742e 6c6f  utput_element.lo
+0006bdb0: 6e67 6e61 6d65 0d0a 2020 2020 2320 2020  ngname..    #   
+0006bdc0: 2020 2020 2079 6965 6c64 2027 5c74 270d       yield '\t'.
+0006bdd0: 0a20 2020 2023 2020 2020 2020 2020 6966  .    #        if
+0006bde0: 206f 7574 7075 745f 656c 656d 656e 742e   output_element.
+0006bdf0: 7368 6f72 746e 616d 6520 6973 206e 6f74  shortname is not
+0006be00: 204e 6f6e 653a 0d0a 2020 2020 2320 2020   None:..    #   
+0006be10: 2020 2020 2020 2020 2079 6965 6c64 206f           yield o
+0006be20: 7574 7075 745f 656c 656d 656e 742e 7368  utput_element.sh
+0006be30: 6f72 746e 616d 650d 0a20 2020 2023 0d0a  ortname..    #..
+0006be40: 2020 2020 2320 2020 2020 2020 2079 6965      #        yie
+0006be50: 6c64 2027 5c74 270d 0a20 2020 2023 2020  ld '\t'..    #  
+0006be60: 2020 2020 2020 6966 206f 7574 7075 745f        if output_
+0006be70: 656c 656d 656e 742e 6465 7363 7269 7074  element.descript
+0006be80: 696f 6e20 6973 206e 6f74 204e 6f6e 653a  ion is not None:
+0006be90: 0d0a 2020 2020 2320 2020 2020 2020 2020  ..    #         
+0006bea0: 2020 2079 6965 6c64 206f 7574 7075 745f     yield output_
+0006beb0: 656c 656d 656e 742e 6465 7363 7269 7074  element.descript
+0006bec0: 696f 6e0d 0a20 2020 2023 2020 2020 2020  ion..    #      
+0006bed0: 2020 7969 656c 6420 275c 6e27 0d0a 2020    yield '\n'..  
+0006bee0: 2020 230d 0a20 2020 2023 636f 6d6d 616e    #..    #comman
+0006bef0: 645f 6c69 7374 203d 2064 696d 656e 7369  d_list = dimensi
+0006bf00: 6f6e 2e73 6974 652e 5f6c 6f67 6f6e 5f70  on.site._logon_p
+0006bf10: 6172 616d 6574 6572 5f69 6d70 6f72 7465  arameter_importe
+0006bf20: 725f 636f 6d6d 616e 6473 202b 205c 0d0a  r_commands + \..
+0006bf30: 2020 2020 2320 2020 2020 2020 2020 2020      #           
+0006bf40: 2020 2020 5b27 7365 742d 7061 7261 6d65      ['set-parame
+0006bf50: 7465 7220 6469 6d65 6e73 696f 6e5f 696e  ter dimension_in
+0006bf60: 6465 783d 2720 2020 202b 2073 7472 2864  dex='    + str(d
+0006bf70: 696d 656e 7369 6f6e 5f69 6e64 6578 290d  imension_index).
+0006bf80: 0a20 2020 2023 2020 2020 2020 2020 2020  .    #          
+0006bf90: 2020 2020 202c 276c 6f61 642d 6669 6c65       ,'load-file
+0006bfa0: 2d74 7376 2022 2720 2020 2020 2020 2020  -tsv "'         
+0006bfb0: 2020 2020 2020 2020 2020 2b20 696d 706f            + impo
+0006bfc0: 7274 6564 5f64 696d 656e 7369 6f6e 5f66  rted_dimension_f
+0006bfd0: 696c 6570 6174 6820 2b20 2722 270d 0a20  ilepath + '"'.. 
+0006bfe0: 2020 2023 2020 2020 2020 2020 2020 2020     #            
+0006bff0: 2020 202c 2765 6d70 6f77 6572 2d69 6d70     ,'empower-imp
+0006c000: 6f72 742d 6669 656c 642d 7661 6c75 6573  ort-field-values
+0006c010: 2022 247b 7369 7465 7d22 2022 247b 7573   "${site}" "${us
+0006c020: 6572 7d22 2022 247b 7061 7373 776f 7264  er}" "${password
+0006c030: 7d22 2024 7b64 696d 656e 7369 6f6e 5f69  }" ${dimension_i
+0006c040: 6e64 6578 7d27 0d0a 2020 2020 2320 2020  ndex}'..    #   
+0006c050: 2020 2020 2020 2020 2020 2020 5d0d 0a20              ].. 
+0006c060: 2020 2023 0d0a 2020 2020 2323 426f 7468     #..    ##Both
+0006c070: 2074 696d 6520 6469 6d65 6e73 696f 6e73   time dimensions
+0006c080: 2061 6e64 2073 7461 6e64 6172 6420 6469   and standard di
+0006c090: 6d65 6e73 696f 6e73 2077 696c 6c20 6e65  mensions will ne
+0006c0a0: 6564 2074 6865 206c 6f6e 676e 616d 650d  ed the longname.
+0006c0b0: 0a20 2020 2023 2349 6e20 6465 6275 6720  .    ##In debug 
+0006c0c0: 6d6f 6465 2077 7269 7465 2074 6865 2064  mode write the d
+0006c0d0: 6174 6120 696e 746f 2061 2074 7376 2066  ata into a tsv f
+0006c0e0: 696c 6520 616e 6420 7265 6164 2069 7420  ile and read it 
+0006c0f0: 7769 7468 2049 6d70 6f72 7465 722c 2070  with Importer, p
+0006c100: 7574 7469 6e67 2074 6865 2065 6c65 6d65  utting the eleme
+0006c110: 6e74 7320 696e 746f 2045 6d70 6f77 6572  nts into Empower
+0006c120: 0d0a 2020 2020 2369 6620 6465 6275 673a  ..    #if debug:
+0006c130: 0d0a 2020 2020 2320 2020 2023 4e6f 6e20  ..    #    #Non 
+0006c140: 7469 6d65 2064 696d 656e 7369 6f6e 7320  time dimensions 
+0006c150: 6d61 7920 6861 7665 2066 6965 6c64 7320  may have fields 
+0006c160: 2d20 7772 6974 6520 7468 6520 7374 616e  - write the stan
+0006c170: 6461 7264 2061 6e64 206e 6f6e 2073 7461  dard and non sta
+0006c180: 6e64 6172 6420 6669 656c 6473 2074 6f20  ndard fields to 
+0006c190: 6669 6c65 2061 6e64 2069 6d70 6f72 7420  file and import 
+0006c1a0: 7468 656d 0d0a 2020 2020 2320 2020 2077  them..    #    w
+0006c1b0: 6974 6820 6f70 656e 2869 6d70 6f72 7465  ith open(importe
+0006c1c0: 645f 6469 6d65 6e73 696f 6e5f 6669 6c65  d_dimension_file
+0006c1d0: 7061 7468 2c27 7727 2920 6173 2069 6d70  path,'w') as imp
+0006c1e0: 6f72 7465 645f 6469 6d65 6e73 696f 6e5f  orted_dimension_
+0006c1f0: 6669 6c65 3a0d 0a20 2020 2023 0d0a 2020  file:..    #..  
+0006c200: 2020 2320 2020 2020 2020 2023 5772 6974    #        #Writ
+0006c210: 6520 656d 7074 7920 6361 6c63 756c 6174  e empty calculat
+0006c220: 696f 6e20 656c 656d 656e 7473 2066 6f72  ion elements for
+0006c230: 2061 6c6c 2063 6861 6e67 6564 2063 616c   all changed cal
+0006c240: 6375 6c61 7469 6f6e 7320 746f 2068 656c  culations to hel
+0006c250: 7020 7072 6576 656e 7420 6369 7263 756c  p prevent circul
+0006c260: 6172 2063 616c 6375 6c61 7469 6f6e 730d  ar calculations.
+0006c270: 0a20 2020 2023 2020 2020 2020 2020 2354  .    #        #T
+0006c280: 6865 7365 2077 696c 6c20 6265 206f 7665  hese will be ove
+0006c290: 7277 7269 7474 656e 2069 6d6d 6564 6961  rwritten immedia
+0006c2a0: 7465 6c79 0d0a 2020 2020 2320 2020 2020  tely..    #     
+0006c2b0: 2020 2066 6f72 2073 2069 6e20 5f79 6965     for s in _yie
+0006c2c0: 6c64 5f74 696d 655f 6469 6d65 6e73 696f  ld_time_dimensio
+0006c2d0: 6e5f 6669 656c 645f 7374 7269 6e67 7328  n_field_strings(
+0006c2e0: 656c 656d 656e 7473 293a 0d0a 2020 2020  elements):..    
+0006c2f0: 2320 2020 2020 2020 2020 2020 2069 6d70  #            imp
+0006c300: 6f72 7465 645f 6469 6d65 6e73 696f 6e5f  orted_dimension_
+0006c310: 6669 6c65 2e77 7269 7465 2873 290d 0a20  file.write(s).. 
+0006c320: 2020 2023 0d0a 2020 2020 2320 2020 206c     #..    #    l
+0006c330: 6c75 2e72 756e 5f73 696e 676c 655f 6f75  lu.run_single_ou
+0006c340: 7470 7574 5f69 6d70 6f72 7465 725f 636f  tput_importer_co
+0006c350: 6d6d 616e 6473 2863 6f6d 6d61 6e64 5f6c  mmands(command_l
+0006c360: 6973 742c 656d 706f 7765 725f 696d 706f  ist,empower_impo
+0006c370: 7274 6572 5f65 7865 6375 7461 626c 653d  rter_executable=
+0006c380: 6469 6d65 6e73 696f 6e2e 7369 7465 2e65  dimension.site.e
+0006c390: 6d70 6f77 6572 5f69 6d70 6f72 7465 725f  mpower_importer_
+0006c3a0: 6578 6563 7574 6162 6c65 290d 0a20 2020  executable)..   
+0006c3b0: 2023 0d0a 2020 2020 2365 6c73 653a 0d0a   #..    #else:..
+0006c3c0: 2020 2020 2320 2020 2023 496e 2027 6e6f      #    #In 'no
+0006c3d0: 726d 616c 2720 6d6f 6465 2064 6f20 6120  rmal' mode do a 
+0006c3e0: 6d65 7272 7920 6461 6e63 6520 7769 7468  merry dance with
+0006c3f0: 2057 696e 646f 7773 206e 616d 6564 2070   Windows named p
+0006c400: 6970 6573 2e20 5468 6973 2061 766f 6964  ipes. This avoid
+0006c410: 7320 7772 6974 696e 6720 7468 6520 6461  s writing the da
+0006c420: 7461 2074 6f20 6669 6c65 2066 6f72 2073  ta to file for s
+0006c430: 6563 7572 6974 7920 616e 6420 7072 6163  ecurity and prac
+0006c440: 7469 6361 6c69 7479 2072 6561 736f 6e73  ticality reasons
+0006c450: 0d0a 2020 2020 2320 2020 2023 696d 706f  ..    #    #impo
+0006c460: 7274 6564 5f64 696d 656e 7369 6f6e 5f66  rted_dimension_f
+0006c470: 696c 6570 6174 6820 6973 2074 6865 206e  ilepath is the n
+0006c480: 616d 6520 6f66 2074 6865 206e 616d 6564  ame of the named
+0006c490: 2070 6970 6520 652e 672e 205c 5c2e 5c70   pipe e.g. \\.\p
+0006c4a0: 6970 655c 3964 6363 6661 3038 2d34 3063  ipe\9dccfa08-40c
+0006c4b0: 312d 3435 6635 2d38 6530 652d 6636 3463  1-45f5-8e0e-f64c
+0006c4c0: 3138 3530 3262 6364 0d0a 2020 2020 2320  18502bcd..    # 
+0006c4d0: 2020 2023 5468 6520 6d65 7272 7920 6461     #The merry da
+0006c4e0: 6e63 6520 6d65 616e 7320 7374 6172 7469  nce means starti
+0006c4f0: 6e67 2065 6d70 6f77 6572 2c20 7265 6665  ng empower, refe
+0006c500: 7265 6e63 696e 6720 7468 6520 7069 7065  rencing the pipe
+0006c510: 2c20 6f70 656e 696e 6720 7468 6520 7069  , opening the pi
+0006c520: 7065 2062 6566 6f72 6520 656d 706f 7765  pe before empowe
+0006c530: 7220 6973 2070 726f 7065 726c 7920 7374  r is properly st
+0006c540: 6172 7465 640d 0a20 2020 2023 2020 2020  arted..    #    
+0006c550: 2373 6574 7469 6e67 2075 7020 7468 6520  #setting up the 
+0006c560: 6e61 6d65 6420 7069 7065 206f 6e20 7468  named pipe on th
+0006c570: 6973 2074 6872 6561 642c 2061 6e64 2077  is thread, and w
+0006c580: 7269 7469 6e67 2074 6f20 6974 2028 6173  riting to it (as
+0006c590: 2073 6f6f 6e20 6173 2049 6d70 6f72 7465   soon as Importe
+0006c5a0: 7220 636f 6e6e 6563 7473 2061 7420 6974  r connects at it
+0006c5b0: 7320 656e 6429 0d0a 2020 2020 2320 2020  s end)..    #   
+0006c5c0: 2023 5468 6520 6469 6666 6963 756c 7479   #The difficulty
+0006c5d0: 2c20 6973 2074 6861 7420 7765 2068 6176  , is that we hav
+0006c5e0: 6520 746f 2070 6173 7320 7468 6520 6e61  e to pass the na
+0006c5f0: 6d65 206f 6620 7468 6520 7069 7065 2074  me of the pipe t
+0006c600: 6f20 496d 706f 7274 6572 2c20 616e 6420  o Importer, and 
+0006c610: 7265 6c79 206f 6e20 7468 6520 6661 6374  rely on the fact
+0006c620: 2074 6861 7420 6974 2077 6f6e 2774 2068   that it won't h
+0006c630: 6176 6520 7469 6d65 2074 6f20 6f70 656e  ave time to open
+0006c640: 2069 740d 0a20 2020 2023 2020 2020 2362   it..    #    #b
+0006c650: 6566 6f72 6520 7765 2068 6176 6520 6372  efore we have cr
+0006c660: 6561 7465 6420 6974 2e20 4275 7420 7765  eated it. But we
+0006c670: 2077 696c 6c20 626c 6f63 6b20 6f6e 206f   will block on o
+0006c680: 7572 2073 6964 6520 756e 7469 6c20 496d  ur side until Im
+0006c690: 706f 7274 6572 2068 6173 2063 6f6e 6e65  porter has conne
+0006c6a0: 6374 6564 0d0a 2020 2020 2320 2020 2070  cted..    #    p
+0006c6b0: 726f 6320 3d20 4e6f 6e65 0d0a 2020 2020  roc = None..    
+0006c6c0: 2320 2020 2074 7279 3a0d 0a20 2020 2023  #    try:..    #
+0006c6d0: 2020 2020 2020 2020 7072 6f63 203d 206c          proc = l
+0006c6e0: 6c75 2e73 7461 7274 5f6e 6f5f 6f75 7470  lu.start_no_outp
+0006c6f0: 7574 5f69 6d70 6f72 7465 725f 636f 6d6d  ut_importer_comm
+0006c700: 616e 6473 2863 6f6d 6d61 6e64 5f6c 6973  ands(command_lis
+0006c710: 742c 656d 706f 7765 725f 696d 706f 7274  t,empower_import
+0006c720: 6572 5f65 7865 6375 7461 626c 653d 6469  er_executable=di
+0006c730: 6d65 6e73 696f 6e2e 7369 7465 2e65 6d70  mension.site.emp
+0006c740: 6f77 6572 5f69 6d70 6f72 7465 725f 6578  ower_importer_ex
+0006c750: 6563 7574 6162 6c65 290d 0a20 2020 2023  ecutable)..    #
+0006c760: 2020 2020 2020 2020 7769 7468 206c 6c75          with llu
+0006c770: 2e6f 7574 626f 756e 645f 7069 7065 2869  .outbound_pipe(i
+0006c780: 6d70 6f72 7465 645f 6469 6d65 6e73 696f  mported_dimensio
+0006c790: 6e5f 6669 6c65 7061 7468 2920 6173 2070  n_filepath) as p
+0006c7a0: 6970 653a 0d0a 2020 2020 230d 0a20 2020  ipe:..    #..   
+0006c7b0: 2023 2020 2020 2020 2020 2020 2020 2357   #            #W
+0006c7c0: 7269 7465 2065 6d70 7479 2063 616c 6375  rite empty calcu
+0006c7d0: 6c61 7469 6f6e 2065 6c65 6d65 6e74 7320  lation elements 
+0006c7e0: 666f 7220 616c 6c20 6368 616e 6765 6420  for all changed 
+0006c7f0: 6361 6c63 756c 6174 696f 6e73 2074 6f20  calculations to 
+0006c800: 6865 6c70 2070 7265 7665 6e74 2063 6972  help prevent cir
+0006c810: 6375 6c61 7220 6361 6c63 756c 6174 696f  cular calculatio
+0006c820: 6e73 0d0a 2020 2020 2320 2020 2020 2020  ns..    #       
+0006c830: 2020 2020 2023 5468 6573 6520 7769 6c6c       #These will
+0006c840: 2062 6520 6f76 6572 7772 6974 7465 6e20   be overwritten 
+0006c850: 696d 6d65 6469 6174 656c 790d 0a20 2020  immediately..   
+0006c860: 2023 2020 2020 2020 2020 2020 2020 666f   #            fo
+0006c870: 7220 7320 696e 205f 7969 656c 645f 7469  r s in _yield_ti
+0006c880: 6d65 5f64 696d 656e 7369 6f6e 5f66 6965  me_dimension_fie
+0006c890: 6c64 5f73 7472 696e 6773 2865 6c65 6d65  ld_strings(eleme
+0006c8a0: 6e74 7329 3a0d 0a20 2020 2023 2020 2020  nts):..    #    
+0006c8b0: 2020 2020 2020 2020 2020 2020 7769 6e33              win3
+0006c8c0: 3266 696c 652e 5772 6974 6546 696c 6528  2file.WriteFile(
+0006c8d0: 7069 7065 2c20 7374 722e 656e 636f 6465  pipe, str.encode
+0006c8e0: 2873 2929 0d0a 2020 2020 230d 0a20 2020  (s))..    #..   
+0006c8f0: 2023 2020 2020 2020 2020 2020 2020 6c6f   #            lo
+0006c900: 672e 6465 6275 6728 2250 6970 6520 7b7d  g.debug("Pipe {}
+0006c910: 2066 696e 6973 6865 6420 7772 6974 696e   finished writin
+0006c920: 6722 2e66 6f72 6d61 7428 696d 706f 7274  g".format(import
+0006c930: 6564 5f64 696d 656e 7369 6f6e 5f66 696c  ed_dimension_fil
+0006c940: 6570 6174 6829 290d 0a20 2020 2023 0d0a  epath))..    #..
+0006c950: 2020 2020 2320 2020 2066 696e 616c 6c79      #    finally
+0006c960: 3a0d 0a20 2020 2023 0d0a 2020 2020 2320  :..    #..    # 
+0006c970: 2020 2020 2020 2023 4368 6563 6b20 6966         #Check if
+0006c980: 2049 6d70 6f72 7465 7220 7265 7475 726e   Importer return
+0006c990: 6564 2061 6e20 6572 726f 7220 616e 6420  ed an error and 
+0006c9a0: 7261 6973 6520 6974 2061 7320 6120 7079  raise it as a py
+0006c9b0: 7468 6f6e 2069 6620 6974 2064 6964 0d0a  thon if it did..
+0006c9c0: 2020 2020 2320 2020 2020 2020 206c 6c75      #        llu
+0006c9d0: 2e63 6f6d 706c 6574 655f 6e6f 5f6f 7574  .complete_no_out
+0006c9e0: 7075 745f 696d 706f 7274 6572 5f70 726f  put_importer_pro
+0006c9f0: 6365 7373 2870 726f 6329 0d0a 0d0a 2020  cess(proc)....  
+0006ca00: 2020 6c6f 672e 7665 7262 6f73 6528 2754    log.verbose('T
+0006ca10: 696d 6520 456c 656d 656e 7473 2063 7265  ime Elements cre
+0006ca20: 6174 6564 2066 6f72 2064 696d 656e 7369  ated for dimensi
+0006ca30: 6f6e 2027 2b73 7472 2864 696d 656e 7369  on '+str(dimensi
+0006ca40: 6f6e 5f69 6e64 6578 2929 0d0a 0d0a 6465  on_index))....de
+0006ca50: 6620 5f72 6561 645f 7374 7275 6374 7572  f _read_structur
+0006ca60: 655f 6672 6f6d 5f73 6974 6528 6469 6d65  e_from_site(dime
+0006ca70: 6e73 696f 6e2c 7368 6f72 746e 616d 652c  nsion,shortname,
+0006ca80: 656e 636f 6469 6e67 3d27 6370 3132 3532  encoding='cp1252
+0006ca90: 272c 6f6c 645f 7374 7275 6374 7572 653d  ',old_structure=
+0006caa0: 4e6f 6e65 293a 0d0a 2020 2020 2727 2752  None):..    '''R
+0006cab0: 6561 6420 6120 7374 7275 6374 7572 6520  ead a structure 
+0006cac0: 666f 7220 6120 6769 7665 6e20 6469 6d65  for a given dime
+0006cad0: 6e73 696f 6e2c 2062 7920 7370 6563 6966  nsion, by specif
+0006cae0: 7969 6e67 2074 6865 2073 7472 7563 7475  ying the structu
+0006caf0: 7265 2073 686f 7274 6e61 6d65 0d0a 2020  re shortname..  
+0006cb00: 2020 5265 7475 726e 2061 2053 7472 7563    Return a Struc
+0006cb10: 7475 7265 2063 6c61 7373 0d0a 0d0a 2020  ture class....  
+0006cb20: 2020 3a70 6172 616d 2064 696d 656e 7369    :param dimensi
+0006cb30: 6f6e 3a20 7468 6520 456d 706f 7765 7220  on: the Empower 
+0006cb40: 6469 6d65 6e73 696f 6e20 7765 2061 7265  dimension we are
+0006cb50: 2072 6561 6469 6e67 2061 2073 7472 7563   reading a struc
+0006cb60: 7475 7265 2066 6f72 0d0a 2020 2020 3a70  ture for..    :p
+0006cb70: 6172 616d 2073 686f 7274 6e61 6d3a 2053  aram shortnam: S
+0006cb80: 686f 7274 204e 616d 6520 6f66 2074 6865  hort Name of the
+0006cb90: 5374 7275 6374 7572 650d 0a20 2020 203a  Structure..    :
+0006cba0: 7061 7261 6d20 6469 6d65 6e73 696f 6e5f  param dimension_
+0006cbb0: 6461 7461 5f64 6963 743a 2041 2064 6963  data_dict: A dic
+0006cbc0: 7469 6f6e 6172 7920 6f66 2064 696d 656e  tionary of dimen
+0006cbd0: 7369 6f6e 2064 6174 6120 2d20 6672 6f6d  sion data - from
+0006cbe0: 2074 6865 2045 6d70 6f77 6572 2065 7870   the Empower exp
+0006cbf0: 6f72 7465 6420 6469 6d65 6e73 696f 6e2e  orted dimension.
+0006cc00: 2049 6620 7468 6973 2069 7320 656d 7074   If this is empt
+0006cc10: 792c 2074 6865 6e20 7468 6520 6469 6d65  y, then the dime
+0006cc20: 6e73 696f 6e20 7769 6c6c 2062 6520 7265  nsion will be re
+0006cc30: 6578 706f 7274 6564 2061 6e64 2072 6561  exported and rea
+0006cc40: 6420 696e 2074 6f20 7468 6520 6469 6374  d in to the dict
+0006cc50: 696f 6e61 7279 0d0a 2020 2020 2727 270d  ionary..    '''.
+0006cc60: 0a20 2020 2077 6f72 6b69 6e67 5f64 6972  .    working_dir
+0006cc70: 6563 746f 7279 2020 2020 2020 2020 2020  ectory          
+0006cc80: 203d 2064 696d 656e 7369 6f6e 2e73 6974   = dimension.sit
+0006cc90: 652e 5f65 6d70 6f77 6572 5f65 7870 6f72  e._empower_expor
+0006cca0: 745f 6461 7461 5f64 6972 0d0a 2020 2020  t_data_dir..    
+0006ccb0: 6f6c 645f 7374 7275 6374 7572 6520 2020  old_structure   
+0006ccc0: 2020 2020 2020 2020 2020 2020 3d20 6f6c              = ol
+0006ccd0: 645f 7374 7275 6374 7572 650d 0a20 2020  d_structure..   
+0006cce0: 2064 6562 7567 2020 2020 2020 2020 2020   debug          
+0006ccf0: 2020 2020 2020 2020 2020 2020 203d 2064               = d
+0006cd00: 696d 656e 7369 6f6e 2e73 6974 652e 5f64  imension.site._d
+0006cd10: 6562 7567 0d0a 0d0a 2020 2020 6966 206f  ebug....    if o
+0006cd20: 6c64 5f73 7472 7563 7475 7265 2069 7320  ld_structure is 
+0006cd30: 6e6f 7420 4e6f 6e65 3a0d 0a20 2020 2020  not None:..     
+0006cd40: 2020 2073 7472 7563 7475 7265 3d6f 6c64     structure=old
+0006cd50: 5f73 7472 7563 7475 7265 0d0a 2020 2020  _structure..    
+0006cd60: 2020 2020 2373 7472 7563 7475 7265 2e73      #structure.s
+0006cd70: 686f 7274 6e61 6d65 3d73 686f 7274 6e61  hortname=shortna
+0006cd80: 6d65 0d0a 2020 2020 2020 2020 7374 7275  me..        stru
+0006cd90: 6374 7572 652e 6469 6d65 6e73 696f 6e5f  cture.dimension_
+0006cda0: 696e 6465 7820 3d20 6469 6d65 6e73 696f  index = dimensio
+0006cdb0: 6e2e 696e 6465 780d 0a20 2020 2065 6c73  n.index..    els
+0006cdc0: 653a 0d0a 2020 2020 2020 2020 7374 7275  e:..        stru
+0006cdd0: 6374 7572 653d 5374 7275 6374 7572 6528  cture=Structure(
+0006cde0: 6469 6d65 6e73 696f 6e5f 696e 6465 783d  dimension_index=
+0006cdf0: 6469 6d65 6e73 696f 6e2e 696e 6465 782c  dimension.index,
+0006ce00: 7368 6f72 746e 616d 653d 7368 6f72 746e  shortname=shortn
+0006ce10: 616d 6529 0d0a 0d0a 2020 2020 6966 2064  ame)....    if d
+0006ce20: 6562 7567 3a0d 0a20 2020 2020 2020 2074  ebug:..        t
+0006ce30: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+0006ce40: 206f 732e 6d61 6b65 6469 7273 2877 6f72   os.makedirs(wor
+0006ce50: 6b69 6e67 5f64 6972 6563 746f 7279 290d  king_directory).
+0006ce60: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0006ce70: 4669 6c65 4578 6973 7473 4572 726f 723a  FileExistsError:
+0006ce80: 0d0a 2020 2020 2020 2020 2020 2020 7061  ..            pa
+0006ce90: 7373 0d0a 0d0a 2020 2020 6578 706f 7274  ss....    export
+0006cea0: 6564 5f73 7472 7563 7475 7265 5f66 696c  ed_structure_fil
+0006ceb0: 6570 6174 683d 6f73 2e70 6174 682e 6a6f  epath=os.path.jo
+0006cec0: 696e 2877 6f72 6b69 6e67 5f64 6972 6563  in(working_direc
+0006ced0: 746f 7279 2c27 4578 706f 7274 6564 5f53  tory,'Exported_S
+0006cee0: 7472 7563 7475 7265 5f27 2b73 7472 2864  tructure_'+str(d
+0006cef0: 696d 656e 7369 6f6e 2e69 6e64 6578 292b  imension.index)+
+0006cf00: 275f 272b 7374 7228 7368 6f72 746e 616d  '_'+str(shortnam
+0006cf10: 6529 2b27 2e74 7376 2729 0d0a 0d0a 2020  e)+'.tsv')....  
+0006cf20: 2020 6578 706f 7274 5f73 7472 7563 7475    export_structu
+0006cf30: 7265 5f69 6d70 6f72 7465 725f 7363 7269  re_importer_scri
+0006cf40: 7074 3d70 6b67 5f72 6573 6f75 7263 6573  pt=pkg_resources
+0006cf50: 2e72 6573 6f75 7263 655f 6669 6c65 6e61  .resource_filena
+0006cf60: 6d65 2827 7079 6d70 7827 2c27 696d 706f  me('pympx','impo
+0006cf70: 7274 6572 5f73 6372 6970 7473 2f45 7870  rter_scripts/Exp
+0006cf80: 6f72 7444 696d 656e 7369 6f6e 5374 7275  ortDimensionStru
+0006cf90: 6374 7572 652e 6569 6d70 2729 0d0a 0d0a  cture.eimp')....
+0006cfa0: 2020 2020 636f 6d6d 616e 645f 6c69 7374      command_list
+0006cfb0: 203d 2064 696d 656e 7369 6f6e 2e73 6974   = dimension.sit
+0006cfc0: 652e 5f6c 6f67 6f6e 5f70 6172 616d 6574  e._logon_paramet
+0006cfd0: 6572 5f69 6d70 6f72 7465 725f 636f 6d6d  er_importer_comm
+0006cfe0: 616e 6473 202b 205c 0d0a 2020 2020 2020  ands + \..      
+0006cff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d000: 205b 2773 6574 2d70 6172 616d 6574 6572   ['set-parameter
+0006d010: 2064 696d 656e 7369 6f6e 5f69 6e64 6578   dimension_index
+0006d020: 3d27 2020 2020 202b 2073 7472 2864 696d  ='     + str(dim
+0006d030: 656e 7369 6f6e 2e69 6e64 6578 290d 0a20  ension.index).. 
+0006d040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d050: 2020 2020 2020 2c27 7365 742d 7061 7261        ,'set-para
+0006d060: 6d65 7465 7220 7374 7275 6374 7572 655f  meter structure_
+0006d070: 7368 6f72 746e 616d 653d 2720 2b20 7368  shortname=' + sh
+0006d080: 6f72 746e 616d 650d 0a20 2020 2020 2020  ortname..       
+0006d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d0a0: 2c27 656d 706f 7765 722d 6578 706f 7274  ,'empower-export
+0006d0b0: 2d73 7472 7563 7475 7265 2022 247b 7369  -structure "${si
+0006d0c0: 7465 7d22 2022 247b 7573 6572 7d22 2022  te}" "${user}" "
+0006d0d0: 247b 7061 7373 776f 7264 7d22 2024 7b64  ${password}" ${d
+0006d0e0: 696d 656e 7369 6f6e 5f69 6e64 6578 7d20  imension_index} 
+0006d0f0: 247b 7374 7275 6374 7572 655f 7368 6f72  ${structure_shor
+0006d100: 746e 616d 657d 270d 0a20 2020 2020 2020  tname}'..       
+0006d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d120: 2c27 7473 762d 656e 636f 6465 270d 0a20  ,'tsv-encode'.. 
+0006d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d140: 2020 2020 2020 5d0d 0a0d 0a20 2020 2069        ]....    i
+0006d150: 6620 6465 6275 673a 0d0a 2020 2020 2020  f debug:..      
+0006d160: 2020 636f 6d6d 616e 645f 6c69 7374 202b    command_list +
+0006d170: 3d20 5b27 7361 7665 2d66 696c 6520 227b  = ['save-file "{
+0006d180: 7d22 272e 666f 726d 6174 286f 732e 7061  }"'.format(os.pa
+0006d190: 7468 2e61 6273 7061 7468 2865 7870 6f72  th.abspath(expor
+0006d1a0: 7465 645f 7374 7275 6374 7572 655f 6669  ted_structure_fi
+0006d1b0: 6c65 7061 7468 2929 5d0d 0a20 2020 2020  lepath))]..     
+0006d1c0: 2020 206c 6c75 2e72 756e 5f73 696e 676c     llu.run_singl
+0006d1d0: 655f 6f75 7470 7574 5f69 6d70 6f72 7465  e_output_importe
+0006d1e0: 725f 636f 6d6d 616e 6473 2863 6f6d 6d61  r_commands(comma
+0006d1f0: 6e64 5f6c 6973 742c 656d 706f 7765 725f  nd_list,empower_
+0006d200: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
+0006d210: 626c 653d 6469 6d65 6e73 696f 6e2e 7369  ble=dimension.si
+0006d220: 7465 2e65 6d70 6f77 6572 5f69 6d70 6f72  te.empower_impor
+0006d230: 7465 725f 6578 6563 7574 6162 6c65 290d  ter_executable).
+0006d240: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
+0006d250: 2020 2020 636f 6d6d 616e 645f 6c69 7374      command_list
+0006d260: 202b 3d20 5b27 6f75 7470 7574 275d 0d0a   += ['output']..
+0006d270: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
+0006d280: 206c 6c75 2e72 756e 5f73 696e 676c 655f   llu.run_single_
+0006d290: 6f75 7470 7574 5f69 6d70 6f72 7465 725f  output_importer_
+0006d2a0: 636f 6d6d 616e 6473 2863 6f6d 6d61 6e64  commands(command
+0006d2b0: 5f6c 6973 742c 656d 706f 7765 725f 696d  _list,empower_im
+0006d2c0: 706f 7274 6572 5f65 7865 6375 7461 626c  porter_executabl
+0006d2d0: 653d 6469 6d65 6e73 696f 6e2e 7369 7465  e=dimension.site
+0006d2e0: 2e65 6d70 6f77 6572 5f69 6d70 6f72 7465  .empower_importe
+0006d2f0: 725f 6578 6563 7574 6162 6c65 290d 0a0d  r_executable)...
+0006d300: 0a20 2020 2064 6566 205f 7265 6164 5f65  .    def _read_e
+0006d310: 7870 6f72 7465 645f 7374 7275 6374 7572  xported_structur
+0006d320: 655f 6461 7461 2865 7870 6f72 7465 645f  e_data(exported_
+0006d330: 7374 7275 6374 7572 655f 6461 7461 293a  structure_data):
+0006d340: 0d0a 0d0a 2020 2020 2020 2020 234e 6f74  ....        #Not
+0006d350: 6520 7061 7265 6e74 7320 616c 7761 7973  e parents always
+0006d360: 2065 7869 7374 2062 6566 6f72 6520 6368   exist before ch
+0006d370: 696c 6472 656e 2c20 616e 6420 7468 6520  ildren, and the 
+0006d380: 7472 6565 2069 7320 616c 7761 7973 2077  tree is always w
+0006d390: 7269 7474 656e 2066 726f 6d20 726f 6f74  ritten from root
+0006d3a0: 2074 6f20 6c65 6166 0d0a 2020 2020 2020   to leaf..      
+0006d3b0: 2020 2357 6520 6669 6e64 2074 6865 2070    #We find the p
+0006d3c0: 6172 656e 7420 656c 656d 656e 7420 6279  arent element by
+0006d3d0: 206b 6565 7069 6e67 2074 7261 636b 206f   keeping track o
+0006d3e0: 6620 7468 6520 6c65 7665 6c2c 2061 6e64  f the level, and
+0006d3f0: 2065 7373 656e 7469 616c 6c79 2070 6f70   essentially pop
+0006d400: 7069 6e67 2065 6c65 6d65 6e74 7320 7768  ping elements wh
+0006d410: 656e 2074 6865 206c 6576 656c 2064 6563  en the level dec
+0006d420: 7265 6173 6573 0d0a 2020 2020 2020 2020  reases..        
+0006d430: 2354 6865 2065 6173 6965 7374 2077 6179  #The easiest way
+0006d440: 2074 6f20 646f 2074 6869 7320 6973 2074   to do this is t
+0006d450: 6f20 6861 7665 2061 206c 6576 656c 2064  o have a level d
+0006d460: 6963 742c 2061 6e64 2075 7365 2074 6865  ict, and use the
+0006d470: 204c 6576 656c 206e 756d 6265 7220 746f   Level number to
+0006d480: 206c 6f6f 6b20 7570 2074 6865 2070 7265   look up the pre
+0006d490: 7669 6f75 7320 6c65 7665 6c20 7061 7265  vious level pare
+0006d4a0: 6e74 0d0a 0d0a 2020 2020 2020 2020 2354  nt....        #T
+0006d4b0: 6865 2072 6561 736f 6e20 7765 206d 7573  he reason we mus
+0006d4c0: 7420 7573 6520 7468 6520 7374 7275 6374  t use the struct
+0006d4d0: 7572 6520 696e 2074 6865 2066 696c 6520  ure in the file 
+0006d4e0: 696e 2074 6869 7320 7761 7920 6973 2074  in this way is t
+0006d4f0: 6861 7420 5348 4f52 544e 414d 4553 204d  hat SHORTNAMES M
+0006d500: 4159 2042 4520 5245 5045 4154 4544 2e0d  AY BE REPEATED..
+0006d510: 0a20 2020 2020 2020 2023 5468 6973 206d  .        #This m
+0006d520: 6561 6e73 2074 6861 7420 796f 7520 6361  eans that you ca
+0006d530: 6e27 7420 6a75 7374 206c 6f6f 6b20 7570  n't just look up
+0006d540: 2074 6865 2070 6172 656e 7420 656c 656d   the parent elem
+0006d550: 656e 7420 6672 6f6d 2074 6865 2073 7472  ent from the str
+0006d560: 7563 7475 7265 2e20 4120 7061 7265 6e74  ucture. A parent
+0006d570: 206d 6179 2061 7070 6561 7220 6d61 6e79   may appear many
+0006d580: 2074 696d 6573 2069 6e20 7468 6520 7361   times in the sa
+0006d590: 6d65 2073 7472 7563 7475 7265 0d0a 0d0a  me structure....
+0006d5a0: 2020 2020 2020 2020 234e 6f74 653a 206c          #Note: l
+0006d5b0: 6576 656c 7320 6d75 7374 2061 6c77 6179  evels must alway
+0006d5c0: 7320 6265 206f 6e65 2067 7265 6174 6572  s be one greater
+0006d5d0: 2074 6861 6e20 7468 6520 7072 6576 696f   than the previo
+0006d5e0: 7573 206c 6576 656c 2c20 6f72 2074 6865  us level, or the
+0006d5f0: 7920 6d61 7920 6265 2073 6d61 6c6c 6572  y may be smaller
+0006d600: 2028 7570 2074 6f20 616e 7920 616d 6f75   (up to any amou
+0006d610: 6e74 2073 6d61 6c6c 6572 290d 0a0d 0a20  nt smaller).... 
+0006d620: 2020 2020 2020 2023 652e 672e 0d0a 2020         #e.g...  
+0006d630: 2020 2020 2020 2330 0d0a 2020 2020 2020        #0..      
+0006d640: 2020 2331 0d0a 2020 2020 2020 2020 2332    #1..        #2
+0006d650: 0d0a 2020 2020 2020 2020 2333 0d0a 2020  ..        #3..  
+0006d660: 2020 2020 2020 2331 0d0a 2020 2020 2020        #1..      
+0006d670: 2020 2332 0d0a 2020 2020 2020 2020 2332    #2..        #2
+0006d680: 0d0a 0d0a 2020 2020 2020 2020 2369 7320  ....        #is 
+0006d690: 6669 6e65 0d0a 0d0a 2020 2020 2020 2020  fine....        
+0006d6a0: 2341 2064 6963 7469 6f6e 6172 7920 6f66  #A dictionary of
+0006d6b0: 2074 6865 2053 7472 7563 7475 7265 2065   the Structure e
+0006d6c0: 6c65 6d65 6e74 7320 696e 2074 6865 206c  lements in the l
+0006d6d0: 6576 656c 2061 626f 7665 0d0a 2020 2020  evel above..    
+0006d6e0: 2020 2020 6c65 7665 6c5f 6469 6374 3d7b      level_dict={
+0006d6f0: 7d0d 0a0d 0a20 2020 2020 2020 2072 6561  }....        rea
+0006d700: 6465 723d 6373 762e 4469 6374 5265 6164  der=csv.DictRead
+0006d710: 6572 2865 7870 6f72 7465 645f 7374 7275  er(exported_stru
+0006d720: 6374 7572 655f 6461 7461 2c64 656c 696d  cture_data,delim
+0006d730: 6974 6572 3d27 5c74 2729 0d0a 2020 2020  iter='\t')..    
+0006d740: 2020 2020 7265 636f 7264 5f6e 756d 203d      record_num =
+0006d750: 2030 0d0a 0d0a 2020 2020 2020 2020 7472   0....        tr
+0006d760: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+0006d770: 666f 7220 7265 636f 7264 2069 6e20 7265  for record in re
+0006d780: 6164 6572 3a0d 0a0d 0a20 2020 2020 2020  ader:....       
+0006d790: 2020 2020 2020 2020 2072 6563 6f72 645f           record_
+0006d7a0: 6e75 6d2b 3d31 0d0a 0d0a 2020 2020 2020  num+=1....      
+0006d7b0: 2020 2020 2020 2020 2020 6c65 7665 6c3d            level=
+0006d7c0: 2020 2020 2020 2020 2020 696e 7428 7265            int(re
+0006d7d0: 636f 7264 5b27 4c65 7665 6c27 5d29 0d0a  cord['Level'])..
 0006d7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d7f0: 7368 6f72 746e 616d 653d 7265 636f 7264  shortname=record
-0006d800: 5b27 5368 6f72 7420 4e61 6d65 275d 0d0a  ['Short Name']..
-0006d810: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0006d820: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-0006d830: 2020 2020 2020 2020 2020 2020 234c 6f6f              #Loo
-0006d840: 6b20 7570 2074 6865 2073 686f 7274 6e61  k up the shortna
-0006d850: 6d65 2069 6e20 7468 6520 7368 6f72 746e  me in the shortn
-0006d860: 616d 655f 656c 656d 656e 745f 6469 6374  ame_element_dict
-0006d870: 2c20 736f 2074 6861 7420 7765 2063 616e  , so that we can
-0006d880: 2063 7265 6174 6520 7468 6520 5374 7275   create the Stru
-0006d890: 6374 7572 6545 6c65 6d65 6e74 2066 726f  ctureElement fro
-0006d8a0: 6d20 616e 2045 6c65 6d65 6e74 2077 6974  m an Element wit
-0006d8b0: 6820 6675 6c6c 2069 6e66 6f72 6d61 7469  h full informati
-0006d8c0: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
-0006d8d0: 2020 2020 2020 2020 2341 6e20 456c 656d          #An Elem
-0006d8e0: 656e 7420 7769 6c6c 2062 6520 6c6f 6f6b  ent will be look
-0006d8f0: 6564 2075 7020 2d20 7765 206d 7569 7374  ed up - we muist
-0006d900: 2061 6c77 6179 7320 6372 6561 7465 206e   always create n
-0006d910: 6577 2053 7472 7563 7475 7265 456c 656d  ew StructureElem
-0006d920: 656e 7473 2066 726f 6d20 6561 6368 206c  ents from each l
-0006d930: 696e 6520 696e 2074 6865 2073 7472 7563  ine in the struc
-0006d940: 7475 7265 2066 696c 652e 0d0a 2020 2020  ture file...    
-0006d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006d960: 656c 656d 656e 743d 6469 6d65 6e73 696f  element=dimensio
-0006d970: 6e2e 656c 656d 656e 7473 5b73 686f 7274  n.elements[short
-0006d980: 6e61 6d65 5d0d 0a20 2020 2020 2020 2020  name]..         
-0006d990: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-0006d9a0: 7945 7272 6f72 3a0d 0a20 2020 2020 2020  yError:..       
-0006d9b0: 2020 2020 2020 2020 2020 2020 2023 5468               #Th
-0006d9c0: 6572 6520 6973 206e 6f20 6973 7375 6520  ere is no issue 
-0006d9d0: 6966 2077 6520 6861 7665 2072 6561 6368  if we have reach
-0006d9e0: 6564 2074 6865 2072 6f6f 7420 656c 656d  ed the root elem
-0006d9f0: 656e 742c 2077 6869 6368 2068 6f6c 6473  ent, which holds
-0006da00: 2074 6865 2053 7472 7563 7475 7265 2073   the Structure s
-0006da10: 686f 7274 6e61 6d65 2028 616e 6420 6973  hortname (and is
-0006da20: 206e 6f74 2061 2072 6561 6c20 656c 656d   not a real elem
-0006da30: 656e 7420 616e 7977 6179 290d 0a20 2020  ent anyway)..   
-0006da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006da50: 2069 6620 7368 6f72 746e 616d 653d 3d73   if shortname==s
-0006da60: 7472 7563 7475 7265 2e73 686f 7274 6e61  tructure.shortna
-0006da70: 6d65 2061 6e64 2069 735f 726f 6f74 3a0d  me and is_root:.
-0006da80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006da90: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0006daa0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-0006dab0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-0006dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dad0: 2020 2020 2020 7261 6973 650d 0a0d 0a20        raise.... 
-0006dae0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0006daf0: 5468 6520 7061 7265 6e74 2069 7320 7468  The parent is th
-0006db00: 6520 656c 656d 656e 7420 7769 7468 2061  e element with a
-0006db10: 206c 6576 656c 206f 6e65 206c 6573 7320   level one less 
-0006db20: 7468 616e 2074 6865 2063 7572 7265 6e74  than the current
-0006db30: 206c 6576 656c 0d0a 2020 2020 2020 2020   level..        
-0006db40: 2020 2020 2020 2020 6966 206c 6576 656c          if level
-0006db50: 203e 2030 3a0d 0a20 2020 2020 2020 2020   > 0:..         
-0006db60: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-0006db70: 745f 656c 656d 656e 743d 6c65 7665 6c5f  t_element=level_
-0006db80: 6469 6374 5b6c 6576 656c 2d31 5d0d 0a20  dict[level-1].. 
-0006db90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0006dba0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-0006dbb0: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
-0006dbc0: 5f65 6c65 6d65 6e74 3d4e 6f6e 650d 0a0d  _element=None...
-0006dbd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006dbe0: 2073 7472 7563 7475 7265 5f65 6c65 6d65   structure_eleme
-0006dbf0: 6e74 3d53 7472 7563 7475 7265 456c 656d  nt=StructureElem
-0006dc00: 656e 7428 656c 656d 656e 743d 656c 656d  ent(element=elem
-0006dc10: 656e 740d 0a20 2020 2020 2020 2020 2020  ent..           
-0006dc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dc40: 2020 2020 2020 202c 7374 7275 6374 7572         ,structur
-0006dc50: 653d 7374 7275 6374 7572 650d 0a20 2020  e=structure..   
+0006d7f0: 6973 5f72 6f6f 743d 2020 2020 2020 2020  is_root=        
+0006d800: 6c65 7665 6c3d 3d30 0d0a 0d0a 2020 2020  level==0....    
+0006d810: 2020 2020 2020 2020 2020 2020 7368 6f72              shor
+0006d820: 746e 616d 653d 7265 636f 7264 5b27 5368  tname=record['Sh
+0006d830: 6f72 7420 4e61 6d65 275d 0d0a 0d0a 2020  ort Name']....  
+0006d840: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+0006d850: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+0006d860: 2020 2020 2020 2020 234c 6f6f 6b20 7570          #Look up
+0006d870: 2074 6865 2073 686f 7274 6e61 6d65 2069   the shortname i
+0006d880: 6e20 7468 6520 7368 6f72 746e 616d 655f  n the shortname_
+0006d890: 656c 656d 656e 745f 6469 6374 2c20 736f  element_dict, so
+0006d8a0: 2074 6861 7420 7765 2063 616e 2063 7265   that we can cre
+0006d8b0: 6174 6520 7468 6520 5374 7275 6374 7572  ate the Structur
+0006d8c0: 6545 6c65 6d65 6e74 2066 726f 6d20 616e  eElement from an
+0006d8d0: 2045 6c65 6d65 6e74 2077 6974 6820 6675   Element with fu
+0006d8e0: 6c6c 2069 6e66 6f72 6d61 7469 6f6e 0d0a  ll information..
+0006d8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006d900: 2020 2020 2341 6e20 456c 656d 656e 7420      #An Element 
+0006d910: 7769 6c6c 2062 6520 6c6f 6f6b 6564 2075  will be looked u
+0006d920: 7020 2d20 7765 206d 7569 7374 2061 6c77  p - we muist alw
+0006d930: 6179 7320 6372 6561 7465 206e 6577 2053  ays create new S
+0006d940: 7472 7563 7475 7265 456c 656d 656e 7473  tructureElements
+0006d950: 2066 726f 6d20 6561 6368 206c 696e 6520   from each line 
+0006d960: 696e 2074 6865 2073 7472 7563 7475 7265  in the structure
+0006d970: 2066 696c 652e 0d0a 2020 2020 2020 2020   file...        
+0006d980: 2020 2020 2020 2020 2020 2020 656c 656d              elem
+0006d990: 656e 743d 6469 6d65 6e73 696f 6e2e 656c  ent=dimension.el
+0006d9a0: 656d 656e 7473 5b73 686f 7274 6e61 6d65  ements[shortname
+0006d9b0: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+0006d9c0: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
+0006d9d0: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+0006d9e0: 2020 2020 2020 2020 2023 5468 6572 6520           #There 
+0006d9f0: 6973 206e 6f20 6973 7375 6520 6966 2077  is no issue if w
+0006da00: 6520 6861 7665 2072 6561 6368 6564 2074  e have reached t
+0006da10: 6865 2072 6f6f 7420 656c 656d 656e 742c  he root element,
+0006da20: 2077 6869 6368 2068 6f6c 6473 2074 6865   which holds the
+0006da30: 2053 7472 7563 7475 7265 2073 686f 7274   Structure short
+0006da40: 6e61 6d65 2028 616e 6420 6973 206e 6f74  name (and is not
+0006da50: 2061 2072 6561 6c20 656c 656d 656e 7420   a real element 
+0006da60: 616e 7977 6179 290d 0a20 2020 2020 2020  anyway)..       
+0006da70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0006da80: 7368 6f72 746e 616d 653d 3d73 7472 7563  shortname==struc
+0006da90: 7475 7265 2e73 686f 7274 6e61 6d65 2061  ture.shortname a
+0006daa0: 6e64 2069 735f 726f 6f74 3a0d 0a20 2020  nd is_root:..   
+0006dab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006dac0: 2020 2020 2063 6f6e 7469 6e75 650d 0a20       continue.. 
+0006dad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006dae0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+0006daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006db00: 2020 7261 6973 650d 0a0d 0a20 2020 2020    raise....     
+0006db10: 2020 2020 2020 2020 2020 2023 5468 6520             #The 
+0006db20: 7061 7265 6e74 2069 7320 7468 6520 656c  parent is the el
+0006db30: 656d 656e 7420 7769 7468 2061 206c 6576  ement with a lev
+0006db40: 656c 206f 6e65 206c 6573 7320 7468 616e  el one less than
+0006db50: 2074 6865 2063 7572 7265 6e74 206c 6576   the current lev
+0006db60: 656c 0d0a 2020 2020 2020 2020 2020 2020  el..            
+0006db70: 2020 2020 6966 206c 6576 656c 203e 2030      if level > 0
+0006db80: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0006db90: 2020 2020 2020 2070 6172 656e 745f 656c         parent_el
+0006dba0: 656d 656e 743d 6c65 7665 6c5f 6469 6374  ement=level_dict
+0006dbb0: 5b6c 6576 656c 2d31 5d0d 0a20 2020 2020  [level-1]..     
+0006dbc0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0006dbd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006dbe0: 2020 2020 2020 7061 7265 6e74 5f65 6c65        parent_ele
+0006dbf0: 6d65 6e74 3d4e 6f6e 650d 0a0d 0a20 2020  ment=None....   
+0006dc00: 2020 2020 2020 2020 2020 2020 2073 7472               str
+0006dc10: 7563 7475 7265 5f65 6c65 6d65 6e74 3d53  ucture_element=S
+0006dc20: 7472 7563 7475 7265 456c 656d 656e 7428  tructureElement(
+0006dc30: 656c 656d 656e 743d 656c 656d 656e 740d  element=element.
+0006dc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006dc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0006dc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dc80: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-0006dc90: 7061 7265 6e74 5f73 7472 7563 7475 7265  parent_structure
-0006dca0: 5f65 6c65 6d65 6e74 3d70 6172 656e 745f  _element=parent_
-0006dcb0: 656c 656d 656e 740d 0a20 2020 2020 2020  element..       
-0006dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dce0: 2020 2020 2020 2020 2020 202c 6973 5f72             ,is_r
-0006dcf0: 6f6f 743d 6973 5f72 6f6f 7429 0d0a 0d0a  oot=is_root)....
+0006dc70: 2020 202c 7374 7275 6374 7572 653d 7374     ,structure=st
+0006dc80: 7275 6374 7572 650d 0a20 2020 2020 2020  ructure..       
+0006dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006dca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006dcb0: 2020 2020 2020 2020 2020 202c 7061 7265             ,pare
+0006dcc0: 6e74 5f73 7472 7563 7475 7265 5f65 6c65  nt_structure_ele
+0006dcd0: 6d65 6e74 3d70 6172 656e 745f 656c 656d  ment=parent_elem
+0006dce0: 656e 740d 0a20 2020 2020 2020 2020 2020  ent..           
+0006dcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0006dd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006dd10: 2353 6574 2074 6865 2063 7572 7265 6e74  #Set the current
-0006dd20: 2073 7472 7563 7475 7265 2065 6c65 6d65   structure eleme
-0006dd30: 6e74 2061 7320 7468 6520 5374 7275 6374  nt as the Struct
-0006dd40: 7572 6545 6c65 6d65 6e74 2066 6f72 2074  ureElement for t
-0006dd50: 6869 7320 6c65 7665 6c2e 0d0a 2020 2020  his level...    
-0006dd60: 2020 2020 2020 2020 2020 2020 2341 7320              #As 
-0006dd70: 7765 2067 6f20 646f 776e 2074 6865 2068  we go down the h
-0006dd80: 6965 7261 7263 6879 2077 6520 7365 7420  ierarchy we set 
-0006dd90: 6e65 7720 656c 656d 656e 7473 2e20 5765  new elements. We
-0006dda0: 2077 696c 6c20 6f6e 6c79 2062 6520 6c6f   will only be lo
-0006ddb0: 6f6b 696e 6720 7570 2053 7472 6375 7475  oking up Strcutu
-0006ddc0: 7265 2045 6c65 6d65 6e74 7320 6162 6f76  re Elements abov
-0006ddd0: 6520 7573 2c20 736f 2073 7461 6c65 206f  e us, so stale o
-0006dde0: 6e65 7320 6265 6c6f 7720 7573 2064 6f6e  nes below us don
-0006ddf0: 2774 2061 6374 7561 6c6c 7920 6d61 7474  't actually matt
-0006de00: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
-0006de10: 2020 2020 6c65 7665 6c5f 6469 6374 5b6c      level_dict[l
-0006de20: 6576 656c 5d3d 7374 7275 6374 7572 655f  evel]=structure_
-0006de30: 656c 656d 656e 740d 0a20 2020 2020 2020  element..       
-0006de40: 2065 7863 6570 743a 0d0a 0d0a 2020 2020   except:....    
-0006de50: 2020 2020 2020 2020 7072 696e 7428 2752          print('R
-0006de60: 6563 6f72 6420 4e75 6d62 6572 203d 272c  ecord Number =',
-0006de70: 7265 636f 7264 5f6e 756d 290d 0a20 2020  record_num)..   
-0006de80: 2020 2020 2020 2020 2072 6169 7365 0d0a           raise..
-0006de90: 0d0a 2020 2020 2020 2020 7374 7275 6374  ..        struct
-0006dea0: 7572 652e 5f68 6965 7261 7263 6869 6573  ure._hierarchies
-0006deb0: 5f72 6561 6420 3d20 5472 7565 0d0a 2020  _read = True..  
+0006dd10: 2020 2020 2020 202c 6973 5f72 6f6f 743d         ,is_root=
+0006dd20: 6973 5f72 6f6f 7429 0d0a 0d0a 2020 2020  is_root)....    
+0006dd30: 2020 2020 2020 2020 2020 2020 2353 6574              #Set
+0006dd40: 2074 6865 2063 7572 7265 6e74 2073 7472   the current str
+0006dd50: 7563 7475 7265 2065 6c65 6d65 6e74 2061  ucture element a
+0006dd60: 7320 7468 6520 5374 7275 6374 7572 6545  s the StructureE
+0006dd70: 6c65 6d65 6e74 2066 6f72 2074 6869 7320  lement for this 
+0006dd80: 6c65 7665 6c2e 0d0a 2020 2020 2020 2020  level...        
+0006dd90: 2020 2020 2020 2020 2341 7320 7765 2067          #As we g
+0006dda0: 6f20 646f 776e 2074 6865 2068 6965 7261  o down the hiera
+0006ddb0: 7263 6879 2077 6520 7365 7420 6e65 7720  rchy we set new 
+0006ddc0: 656c 656d 656e 7473 2e20 5765 2077 696c  elements. We wil
+0006ddd0: 6c20 6f6e 6c79 2062 6520 6c6f 6f6b 696e  l only be lookin
+0006dde0: 6720 7570 2053 7472 6375 7475 7265 2045  g up Strcuture E
+0006ddf0: 6c65 6d65 6e74 7320 6162 6f76 6520 7573  lements above us
+0006de00: 2c20 736f 2073 7461 6c65 206f 6e65 7320  , so stale ones 
+0006de10: 6265 6c6f 7720 7573 2064 6f6e 2774 2061  below us don't a
+0006de20: 6374 7561 6c6c 7920 6d61 7474 6572 0d0a  ctually matter..
+0006de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006de40: 6c65 7665 6c5f 6469 6374 5b6c 6576 656c  level_dict[level
+0006de50: 5d3d 7374 7275 6374 7572 655f 656c 656d  ]=structure_elem
+0006de60: 656e 740d 0a20 2020 2020 2020 2065 7863  ent..        exc
+0006de70: 6570 743a 0d0a 0d0a 2020 2020 2020 2020  ept:....        
+0006de80: 2020 2020 7072 696e 7428 2752 6563 6f72      print('Recor
+0006de90: 6420 4e75 6d62 6572 203d 272c 7265 636f  d Number =',reco
+0006dea0: 7264 5f6e 756d 290d 0a20 2020 2020 2020  rd_num)..       
+0006deb0: 2020 2020 2072 6169 7365 0d0a 0d0a 2020       raise....  
 0006dec0: 2020 2020 2020 7374 7275 6374 7572 652e        structure.
-0006ded0: 5f65 7869 7374 735f 696e 5f65 6d70 6f77  _exists_in_empow
-0006dee0: 6572 203d 2054 7275 650d 0a20 2020 2020  er = True..     
-0006def0: 2020 2072 6574 7572 6e20 7374 7275 6374     return struct
-0006df00: 7572 650d 0a0d 0a20 2020 2069 6620 6465  ure....    if de
-0006df10: 6275 673a 0d0a 2020 2020 2020 2020 2352  bug:..        #R
-0006df20: 6561 6420 7468 6520 6578 706f 7274 6564  ead the exported
-0006df30: 2073 7472 7563 7475 7265 2066 696c 650d   structure file.
-0006df40: 0a20 2020 2020 2020 2077 6974 6820 6f70  .        with op
-0006df50: 656e 2865 7870 6f72 7465 645f 7374 7275  en(exported_stru
-0006df60: 6374 7572 655f 6669 6c65 7061 7468 2c6d  cture_filepath,m
-0006df70: 6f64 653d 2772 272c 656e 636f 6469 6e67  ode='r',encoding
-0006df80: 3d65 6e63 6f64 696e 6729 2061 7320 6578  =encoding) as ex
-0006df90: 706f 7274 6564 5f73 7472 7563 7475 7265  ported_structure
-0006dfa0: 5f64 6174 613a 0d0a 0d0a 2020 2020 2020  _data:....      
-0006dfb0: 2020 2020 2020 2354 6865 2065 6c65 6d65        #The eleme
-0006dfc0: 6e74 206c 6973 7420 7468 6174 2077 696c  nt list that wil
-0006dfd0: 6c20 6265 2072 6574 7574 6e65 6420 2d20  l be retutned - 
-0006dfe0: 7765 276c 6c20 6164 6420 656c 656d 656e  we'll add elemen
-0006dff0: 7473 2074 6f20 7468 6973 206c 6973 740d  ts to this list.
-0006e000: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-0006e010: 7563 7475 7265 203d 205f 7265 6164 5f65  ucture = _read_e
-0006e020: 7870 6f72 7465 645f 7374 7275 6374 7572  xported_structur
-0006e030: 655f 6461 7461 2865 7870 6f72 7465 645f  e_data(exported_
-0006e040: 7374 7275 6374 7572 655f 6461 7461 290d  structure_data).
-0006e050: 0a20 2020 2065 6c73 653a 0d0a 2020 2020  .    else:..    
-0006e060: 2020 2020 696d 706f 7274 2069 6f0d 0a20      import io.. 
-0006e070: 2020 2020 2020 2023 446f 2061 2066 756e         #Do a fun
-0006e080: 6b79 2047 6c61 676f 6c79 7469 6320 7265  ky Glagolytic re
-0006e090: 706c 6163 656d 656e 7420 746f 2066 6978  placement to fix
-0006e0a0: 2071 756f 7469 6e67 2069 7373 7565 7320   quoting issues 
-0006e0b0: 2d20 4920 6368 6f73 6520 7468 6520 6f6e  - I chose the on
-0006e0c0: 6520 7468 6174 206c 6f6f 6b73 206c 696b  e that looks lik
-0006e0d0: 6520 6120 6c61 6d70 0d0a 2020 2020 2020  e a lamp..      
-0006e0e0: 2020 2349 6620 7468 6572 6520 6172 6520    #If there are 
-0006e0f0: 7265 616c 2047 6c61 676f 6c79 7469 6320  real Glagolytic 
-0006e100: 6368 6172 6163 7465 7273 2069 6e20 796f  characters in yo
-0006e110: 7572 2064 6174 6120 2868 6967 686c 7920  ur data (highly 
-0006e120: 756e 6c69 6b65 6c79 202d 2069 7427 7320  unlikely - it's 
-0006e130: 6120 7665 7279 2c20 7665 7279 2064 6561  a very, very dea
-0006e140: 6420 6c61 6e67 7561 6765 2920 7468 6973  d language) this
-0006e150: 2063 6f64 6520 7769 6c6c 2066 6169 6c0d   code will fail.
-0006e160: 0a20 2020 2020 2020 2023 5468 6520 656c  .        #The el
-0006e170: 656d 656e 7420 6c69 7374 2074 6861 7420  ement list that 
-0006e180: 7769 6c6c 2062 6520 7265 7475 746e 6564  will be retutned
-0006e190: 202d 2077 6527 6c6c 2061 6464 2065 6c65   - we'll add ele
-0006e1a0: 6d65 6e74 7320 746f 2074 6869 7320 6c69  ments to this li
-0006e1b0: 7374 0d0a 2020 2020 2020 2020 7374 7275  st..        stru
-0006e1c0: 6374 7572 6520 3d20 5f72 6561 645f 6578  cture = _read_ex
-0006e1d0: 706f 7274 6564 5f73 7472 7563 7475 7265  ported_structure
-0006e1e0: 5f64 6174 6128 696f 2e53 7472 696e 6749  _data(io.StringI
-0006e1f0: 4f28 6f75 7470 7574 2e72 6570 6c61 6365  O(output.replace
-0006e200: 2827 2222 272c 27e2 b0a6 2729 2e72 6570  ('""','...').rep
-0006e210: 6c61 6365 2827 2227 2c27 2729 2e72 6570  lace('"','').rep
-0006e220: 6c61 6365 2827 e2b0 a627 2c27 2227 2929  lace('...','"'))
-0006e230: 290d 0a0d 0a20 2020 2023 544f 444f 2073  )....    #TODO s
-0006e240: 6574 2074 6865 2073 7472 7563 7475 7265  et the structure
-0006e250: 206c 6f6e 676e 616d 650d 0a20 2020 2072   longname..    r
-0006e260: 6574 7572 6e20 7374 7275 6374 7572 650d  eturn structure.
-0006e270: 0a0d 0a0d 0a64 6566 205f 6372 6561 7465  .....def _create
-0006e280: 5f65 6d70 6f77 6572 5f64 696d 656e 7369  _empower_dimensi
-0006e290: 6f6e 5f73 686f 7274 6e61 6d65 5f73 7472  on_shortname_str
-0006e2a0: 7563 7475 7265 5f64 6963 7428 2064 696d  ucture_dict( dim
-0006e2b0: 656e 7369 6f6e 0d0a 2020 2020 2020 2020  ension..        
-0006e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006e2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006e2e0: 2020 2020 2020 2020 2020 2020 2020 2c20                , 
-0006e2f0: 6f6c 645f 7374 7275 6374 7572 6573 203d  old_structures =
-0006e300: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-0006e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006e330: 2020 2020 2020 2020 2020 2020 2029 3a0d               ):.
-0006e340: 0a20 2020 2072 6574 7572 6e5f 6469 6374  .    return_dict
-0006e350: 3d7b 7d0d 0a0d 0a20 2020 2069 6620 6f6c  ={}....    if ol
-0006e360: 645f 7374 7275 6374 7572 6573 2069 7320  d_structures is 
-0006e370: 4e6f 6e65 3a0d 0a20 2020 2020 2020 206f  None:..        o
-0006e380: 6c64 5f73 7472 7563 7475 7265 7320 3d20  ld_structures = 
-0006e390: 5b5d 0d0a 0d0a 2020 2020 2348 656c 7065  []....    #Helpe
-0006e3a0: 7220 6675 6e63 7469 6f6e 2074 6f20 636f  r function to co
-0006e3b0: 6e76 6572 7420 7374 7269 6e67 7320 636f  nvert strings co
-0006e3c0: 7272 6563 746c 790d 0a20 2020 2064 6566  rrectly..    def
-0006e3d0: 2063 6f6e 7665 7274 5f73 7472 696e 6728   convert_string(
-0006e3e0: 7329 3a0d 0a20 2020 2020 2020 2069 6620  s):..        if 
-0006e3f0: 7320 3d3d 2027 273a 0d0a 2020 2020 2020  s == '':..      
-0006e400: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0006e410: 650d 0a20 2020 2020 2020 2065 6c73 653a  e..        else:
-0006e420: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0006e430: 7475 726e 2073 0d0a 0d0a 2020 2020 6465  turn s....    de
-0006e440: 6275 6720 3d20 6469 6d65 6e73 696f 6e2e  bug = dimension.
-0006e450: 7369 7465 2e5f 6465 6275 670d 0a0d 0a20  site._debug.... 
-0006e460: 2020 2069 6620 6465 6275 673a 0d0a 2020     if debug:..  
-0006e470: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
-0006e480: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
-0006e490: 6972 7328 6469 6d65 6e73 696f 6e2e 7369  irs(dimension.si
-0006e4a0: 7465 2e5f 656d 706f 7765 725f 6578 706f  te._empower_expo
-0006e4b0: 7274 5f64 6174 615f 6469 7229 0d0a 2020  rt_data_dir)..  
-0006e4c0: 2020 2020 2020 6578 6365 7074 2046 696c        except Fil
-0006e4d0: 6545 7869 7374 7345 7272 6f72 3a0d 0a20  eExistsError:.. 
-0006e4e0: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
-0006e4f0: 0a0d 0a20 2020 2065 7870 6f72 7465 645f  ...    exported_
-0006e500: 7374 7275 6374 7572 6573 5f6c 6973 745f  structures_list_
-0006e510: 6669 6c65 7061 7468 3d6f 732e 7061 7468  filepath=os.path
-0006e520: 2e6a 6f69 6e28 6469 6d65 6e73 696f 6e2e  .join(dimension.
-0006e530: 7369 7465 2e5f 656d 706f 7765 725f 6578  site._empower_ex
-0006e540: 706f 7274 5f64 6174 615f 6469 722c 2027  port_data_dir, '
-0006e550: 5374 7275 6374 7572 6573 5f27 2b73 7472  Structures_'+str
-0006e560: 2864 696d 656e 7369 6f6e 2e69 6e64 6578  (dimension.index
-0006e570: 292b 272e 7473 7627 290d 0a0d 0a20 2020  )+'.tsv')....   
-0006e580: 2023 2345 7870 6f72 7420 7468 6520 7374   ##Export the st
-0006e590: 7275 6374 7572 6573 206c 6973 7420 6672  ructures list fr
-0006e5a0: 6f6d 2045 6d70 6f77 6572 2069 6620 7765  om Empower if we
-0006e5b0: 206e 6565 6420 746f 0d0a 2020 2020 6c6f   need to..    lo
-0006e5c0: 672e 7665 7262 6f73 6528 2022 4578 706f  g.verbose( "Expo
-0006e5d0: 7274 696e 6720 5374 7275 6374 7572 6520  rting Structure 
-0006e5e0: 4c69 7374 2066 726f 6d20 7468 6520 456d  List from the Em
-0006e5f0: 706f 7765 7220 5369 7465 2064 696d 656e  power Site dimen
-0006e600: 7369 6f6e 2022 2b73 7472 2864 696d 656e  sion "+str(dimen
-0006e610: 7369 6f6e 2e69 6e64 6578 292b 2220 6672  sion.index)+" fr
-0006e620: 6f6d 2022 2b64 696d 656e 7369 6f6e 2e73  om "+dimension.s
-0006e630: 6974 652e 5f73 6974 655f 6c6f 6361 746f  ite._site_locato
-0006e640: 7229 0d0a 0d0a 2020 2020 636f 6d6d 616e  r)....    comman
-0006e650: 645f 6c69 7374 203d 2064 696d 656e 7369  d_list = dimensi
-0006e660: 6f6e 2e73 6974 652e 5f6c 6f67 6f6e 5f70  on.site._logon_p
-0006e670: 6172 616d 6574 6572 5f69 6d70 6f72 7465  arameter_importe
-0006e680: 725f 636f 6d6d 616e 6473 202b 205c 0d0a  r_commands + \..
-0006e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006e6a0: 2020 205b 2773 6574 2d70 6172 616d 6574     ['set-paramet
-0006e6b0: 6572 2064 696d 656e 7369 6f6e 5f69 6e64  er dimension_ind
-0006e6c0: 6578 3d27 2020 202b 7374 7228 6469 6d65  ex='   +str(dime
-0006e6d0: 6e73 696f 6e2e 696e 6465 7829 0d0a 2020  nsion.index)..  
-0006e6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006e6f0: 202c 2765 6d70 6f77 6572 2d65 7870 6f72   ,'empower-expor
-0006e700: 742d 7374 7275 6374 7572 6573 2022 247b  t-structures "${
-0006e710: 7369 7465 7d22 2022 247b 7573 6572 7d22  site}" "${user}"
-0006e720: 2022 247b 7061 7373 776f 7264 7d22 2024   "${password}" $
-0006e730: 7b64 696d 656e 7369 6f6e 5f69 6e64 6578  {dimension_index
-0006e740: 7d27 0d0a 2020 2020 2020 2020 2020 2020  }'..            
-0006e750: 2020 2020 2020 202c 2774 7376 2d65 6e63         ,'tsv-enc
-0006e760: 6f64 6527 0d0a 2020 2020 2020 2020 2020  ode'..          
-0006e770: 2020 2020 2020 2020 205d 0d0a 0d0a 2020           ]....  
-0006e780: 2020 6966 2064 6562 7567 3a0d 0a20 2020    if debug:..   
-0006e790: 2020 2020 2063 6f6d 6d61 6e64 5f6c 6973       command_lis
-0006e7a0: 7420 2b3d 205b 2773 6176 652d 6669 6c65  t += ['save-file
-0006e7b0: 2022 7b7d 2227 2e66 6f72 6d61 7428 6f73   "{}"'.format(os
-0006e7c0: 2e70 6174 682e 6162 7370 6174 6828 6578  .path.abspath(ex
-0006e7d0: 706f 7274 6564 5f73 7472 7563 7475 7265  ported_structure
-0006e7e0: 735f 6c69 7374 5f66 696c 6570 6174 6829  s_list_filepath)
-0006e7f0: 295d 0d0a 2020 2020 2020 2020 6c6c 752e  )]..        llu.
-0006e800: 7275 6e5f 7369 6e67 6c65 5f6f 7574 7075  run_single_outpu
-0006e810: 745f 696d 706f 7274 6572 5f63 6f6d 6d61  t_importer_comma
-0006e820: 6e64 7328 636f 6d6d 616e 645f 6c69 7374  nds(command_list
-0006e830: 2c65 6d70 6f77 6572 5f69 6d70 6f72 7465  ,empower_importe
-0006e840: 725f 6578 6563 7574 6162 6c65 3d64 696d  r_executable=dim
-0006e850: 656e 7369 6f6e 2e73 6974 652e 656d 706f  ension.site.empo
-0006e860: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
-0006e870: 6375 7461 626c 6529 0d0a 2020 2020 656c  cutable)..    el
-0006e880: 7365 3a0d 0a20 2020 2020 2020 2063 6f6d  se:..        com
-0006e890: 6d61 6e64 5f6c 6973 7420 2b3d 205b 276f  mand_list += ['o
-0006e8a0: 7574 7075 7427 5d0d 0a20 2020 2020 2020  utput']..       
-0006e8b0: 206f 7574 7075 7420 3d20 6c6c 752e 7275   output = llu.ru
-0006e8c0: 6e5f 7369 6e67 6c65 5f6f 7574 7075 745f  n_single_output_
-0006e8d0: 696d 706f 7274 6572 5f63 6f6d 6d61 6e64  importer_command
-0006e8e0: 7328 636f 6d6d 616e 645f 6c69 7374 2c65  s(command_list,e
-0006e8f0: 6d70 6f77 6572 5f69 6d70 6f72 7465 725f  mpower_importer_
-0006e900: 6578 6563 7574 6162 6c65 3d64 696d 656e  executable=dimen
-0006e910: 7369 6f6e 2e73 6974 652e 656d 706f 7765  sion.site.empowe
-0006e920: 725f 696d 706f 7274 6572 5f65 7865 6375  r_importer_execu
-0006e930: 7461 626c 6529 0d0a 0d0a 2020 2020 6465  table)....    de
-0006e940: 6620 5f72 6561 645f 6578 706f 7274 6564  f _read_exported
-0006e950: 5f73 7472 7563 7475 7265 735f 6461 7461  _structures_data
-0006e960: 2865 7870 6f72 7465 645f 7374 7275 6374  (exported_struct
-0006e970: 7572 6573 5f64 6174 6129 3a0d 0a20 2020  ures_data):..   
-0006e980: 2020 2020 2072 6561 6465 723d 6373 762e       reader=csv.
-0006e990: 4469 6374 5265 6164 6572 2865 7870 6f72  DictReader(expor
-0006e9a0: 7465 645f 7374 7275 6374 7572 6573 5f64  ted_structures_d
-0006e9b0: 6174 612c 6465 6c69 6d69 7465 723d 275c  ata,delimiter='\
-0006e9c0: 7427 290d 0a20 2020 2020 2020 2064 696d  t')..        dim
-0006e9d0: 656e 7369 6f6e 5f6c 6f6e 676e 616d 653d  ension_longname=
-0006e9e0: 4e6f 6e65 0d0a 2020 2020 2020 2020 7374  None..        st
-0006e9f0: 7275 6374 7572 655f 6c69 7374 3d5b 5d0d  ructure_list=[].
-0006ea00: 0a20 2020 2020 2020 2074 7279 3a0d 0a20  .        try:.. 
-0006ea10: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
-0006ea20: 6563 6f72 6420 696e 2072 6561 6465 723a  ecord in reader:
-0006ea30: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-0006ea40: 2020 2020 6469 6d65 6e73 696f 6e5f 6c6f      dimension_lo
-0006ea50: 6e67 6e61 6d65 203d 2063 6f6e 7665 7274  ngname = convert
-0006ea60: 5f73 7472 696e 6728 7265 636f 7264 5b27  _string(record['
-0006ea70: 4469 6d65 6e73 696f 6e27 5d29 0d0a 2020  Dimension'])..  
-0006ea80: 2020 2020 2020 2020 2020 2020 2020 7368                sh
-0006ea90: 6f72 746e 616d 6520 2020 2020 2020 2020  ortname         
-0006eaa0: 203d 2063 6f6e 7665 7274 5f73 7472 696e   = convert_strin
-0006eab0: 6728 7265 636f 7264 5b27 5368 6f72 746e  g(record['Shortn
-0006eac0: 616d 6527 5d29 0d0a 2020 2020 2020 2020  ame'])..        
-0006ead0: 2020 2020 2020 2020 6c6f 6e67 6e61 6d65          longname
-0006eae0: 2020 2020 2020 2020 2020 203d 2063 6f6e             = con
-0006eaf0: 7665 7274 5f73 7472 696e 6728 7265 636f  vert_string(reco
-0006eb00: 7264 5b27 4c6f 6e67 6e61 6d65 275d 290d  rd['Longname']).
-0006eb10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006eb20: 2064 6573 6372 6970 7469 6f6e 2020 2020   description    
-0006eb30: 2020 2020 3d20 636f 6e76 6572 745f 7374      = convert_st
-0006eb40: 7269 6e67 2872 6563 6f72 645b 2744 6573  ring(record['Des
-0006eb50: 6372 6970 7469 6f6e 275d 290d 0a0d 0a20  cription']).... 
-0006eb60: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0006eb70: 544f 444f 202d 2063 6f72 7265 6374 2070  TODO - correct p
-0006eb80: 6172 616d 6574 6572 730d 0a20 2020 2020  arameters..     
-0006eb90: 2020 2020 2020 2020 2020 2073 7472 7563             struc
-0006eba0: 7475 7265 3d20 5374 7275 6374 7572 6528  ture= Structure(
-0006ebb0: 7368 6f72 746e 616d 653d 7368 6f72 746e  shortname=shortn
-0006ebc0: 616d 650d 0a20 2020 2020 2020 2020 2020  ame..           
-0006ebd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ebe0: 2020 2020 2020 2020 202c 6c6f 6e67 6e61           ,longna
-0006ebf0: 6d65 3d6c 6f6e 676e 616d 650d 0a20 2020  me=longname..   
+0006ded0: 5f68 6965 7261 7263 6869 6573 5f72 6561  _hierarchies_rea
+0006dee0: 6420 3d20 5472 7565 0d0a 2020 2020 2020  d = True..      
+0006def0: 2020 7374 7275 6374 7572 652e 5f65 7869    structure._exi
+0006df00: 7374 735f 696e 5f65 6d70 6f77 6572 203d  sts_in_empower =
+0006df10: 2054 7275 650d 0a20 2020 2020 2020 2072   True..        r
+0006df20: 6574 7572 6e20 7374 7275 6374 7572 650d  eturn structure.
+0006df30: 0a0d 0a20 2020 2069 6620 6465 6275 673a  ...    if debug:
+0006df40: 0d0a 2020 2020 2020 2020 2352 6561 6420  ..        #Read 
+0006df50: 7468 6520 6578 706f 7274 6564 2073 7472  the exported str
+0006df60: 7563 7475 7265 2066 696c 650d 0a20 2020  ucture file..   
+0006df70: 2020 2020 2077 6974 6820 6f70 656e 2865       with open(e
+0006df80: 7870 6f72 7465 645f 7374 7275 6374 7572  xported_structur
+0006df90: 655f 6669 6c65 7061 7468 2c6d 6f64 653d  e_filepath,mode=
+0006dfa0: 2772 272c 656e 636f 6469 6e67 3d65 6e63  'r',encoding=enc
+0006dfb0: 6f64 696e 6729 2061 7320 6578 706f 7274  oding) as export
+0006dfc0: 6564 5f73 7472 7563 7475 7265 5f64 6174  ed_structure_dat
+0006dfd0: 613a 0d0a 0d0a 2020 2020 2020 2020 2020  a:....          
+0006dfe0: 2020 2354 6865 2065 6c65 6d65 6e74 206c    #The element l
+0006dff0: 6973 7420 7468 6174 2077 696c 6c20 6265  ist that will be
+0006e000: 2072 6574 7574 6e65 6420 2d20 7765 276c   retutned - we'l
+0006e010: 6c20 6164 6420 656c 656d 656e 7473 2074  l add elements t
+0006e020: 6f20 7468 6973 206c 6973 740d 0a20 2020  o this list..   
+0006e030: 2020 2020 2020 2020 2073 7472 7563 7475           structu
+0006e040: 7265 203d 205f 7265 6164 5f65 7870 6f72  re = _read_expor
+0006e050: 7465 645f 7374 7275 6374 7572 655f 6461  ted_structure_da
+0006e060: 7461 2865 7870 6f72 7465 645f 7374 7275  ta(exported_stru
+0006e070: 6374 7572 655f 6461 7461 290d 0a20 2020  cture_data)..   
+0006e080: 2065 6c73 653a 0d0a 2020 2020 2020 2020   else:..        
+0006e090: 696d 706f 7274 2069 6f0d 0a20 2020 2020  import io..     
+0006e0a0: 2020 2023 446f 2061 2066 756e 6b79 2047     #Do a funky G
+0006e0b0: 6c61 676f 6c79 7469 6320 7265 706c 6163  lagolytic replac
+0006e0c0: 656d 656e 7420 746f 2066 6978 2071 756f  ement to fix quo
+0006e0d0: 7469 6e67 2069 7373 7565 7320 2d20 4920  ting issues - I 
+0006e0e0: 6368 6f73 6520 7468 6520 6f6e 6520 7468  chose the one th
+0006e0f0: 6174 206c 6f6f 6b73 206c 696b 6520 6120  at looks like a 
+0006e100: 6c61 6d70 0d0a 2020 2020 2020 2020 2349  lamp..        #I
+0006e110: 6620 7468 6572 6520 6172 6520 7265 616c  f there are real
+0006e120: 2047 6c61 676f 6c79 7469 6320 6368 6172   Glagolytic char
+0006e130: 6163 7465 7273 2069 6e20 796f 7572 2064  acters in your d
+0006e140: 6174 6120 2868 6967 686c 7920 756e 6c69  ata (highly unli
+0006e150: 6b65 6c79 202d 2069 7427 7320 6120 7665  kely - it's a ve
+0006e160: 7279 2c20 7665 7279 2064 6561 6420 6c61  ry, very dead la
+0006e170: 6e67 7561 6765 2920 7468 6973 2063 6f64  nguage) this cod
+0006e180: 6520 7769 6c6c 2066 6169 6c0d 0a20 2020  e will fail..   
+0006e190: 2020 2020 2023 5468 6520 656c 656d 656e       #The elemen
+0006e1a0: 7420 6c69 7374 2074 6861 7420 7769 6c6c  t list that will
+0006e1b0: 2062 6520 7265 7475 746e 6564 202d 2077   be retutned - w
+0006e1c0: 6527 6c6c 2061 6464 2065 6c65 6d65 6e74  e'll add element
+0006e1d0: 7320 746f 2074 6869 7320 6c69 7374 0d0a  s to this list..
+0006e1e0: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+0006e1f0: 6520 3d20 5f72 6561 645f 6578 706f 7274  e = _read_export
+0006e200: 6564 5f73 7472 7563 7475 7265 5f64 6174  ed_structure_dat
+0006e210: 6128 696f 2e53 7472 696e 6749 4f28 6f75  a(io.StringIO(ou
+0006e220: 7470 7574 2e72 6570 6c61 6365 2827 2222  tput.replace('""
+0006e230: 272c 27e2 b0a6 2729 2e72 6570 6c61 6365  ','...').replace
+0006e240: 2827 2227 2c27 2729 2e72 6570 6c61 6365  ('"','').replace
+0006e250: 2827 e2b0 a627 2c27 2227 2929 290d 0a0d  ('...','"')))...
+0006e260: 0a20 2020 2023 544f 444f 2073 6574 2074  .    #TODO set t
+0006e270: 6865 2073 7472 7563 7475 7265 206c 6f6e  he structure lon
+0006e280: 676e 616d 650d 0a20 2020 2072 6574 7572  gname..    retur
+0006e290: 6e20 7374 7275 6374 7572 650d 0a0d 0a0d  n structure.....
+0006e2a0: 0a64 6566 205f 6372 6561 7465 5f65 6d70  .def _create_emp
+0006e2b0: 6f77 6572 5f64 696d 656e 7369 6f6e 5f73  ower_dimension_s
+0006e2c0: 686f 7274 6e61 6d65 5f73 7472 7563 7475  hortname_structu
+0006e2d0: 7265 5f64 6963 7428 2064 696d 656e 7369  re_dict( dimensi
+0006e2e0: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+0006e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006e310: 2020 2020 2020 2020 2020 2c20 6f6c 645f            , old_
+0006e320: 7374 7275 6374 7572 6573 203d 204e 6f6e  structures = Non
+0006e330: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+0006e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006e360: 2020 2020 2020 2020 2029 3a0d 0a20 2020           ):..   
+0006e370: 2072 6574 7572 6e5f 6469 6374 3d7b 7d0d   return_dict={}.
+0006e380: 0a0d 0a20 2020 2069 6620 6f6c 645f 7374  ...    if old_st
+0006e390: 7275 6374 7572 6573 2069 7320 4e6f 6e65  ructures is None
+0006e3a0: 3a0d 0a20 2020 2020 2020 206f 6c64 5f73  :..        old_s
+0006e3b0: 7472 7563 7475 7265 7320 3d20 5b5d 0d0a  tructures = []..
+0006e3c0: 0d0a 2020 2020 2348 656c 7065 7220 6675  ..    #Helper fu
+0006e3d0: 6e63 7469 6f6e 2074 6f20 636f 6e76 6572  nction to conver
+0006e3e0: 7420 7374 7269 6e67 7320 636f 7272 6563  t strings correc
+0006e3f0: 746c 790d 0a20 2020 2064 6566 2063 6f6e  tly..    def con
+0006e400: 7665 7274 5f73 7472 696e 6728 7329 3a0d  vert_string(s):.
+0006e410: 0a20 2020 2020 2020 2069 6620 7320 3d3d  .        if s ==
+0006e420: 2027 273a 0d0a 2020 2020 2020 2020 2020   '':..          
+0006e430: 2020 7265 7475 726e 204e 6f6e 650d 0a20    return None.. 
+0006e440: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
+0006e450: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0006e460: 2073 0d0a 0d0a 2020 2020 6465 6275 6720   s....    debug 
+0006e470: 3d20 6469 6d65 6e73 696f 6e2e 7369 7465  = dimension.site
+0006e480: 2e5f 6465 6275 670d 0a0d 0a20 2020 2069  ._debug....    i
+0006e490: 6620 6465 6275 673a 0d0a 2020 2020 2020  f debug:..      
+0006e4a0: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
+0006e4b0: 2020 2020 6f73 2e6d 616b 6564 6972 7328      os.makedirs(
+0006e4c0: 6469 6d65 6e73 696f 6e2e 7369 7465 2e5f  dimension.site._
+0006e4d0: 656d 706f 7765 725f 6578 706f 7274 5f64  empower_export_d
+0006e4e0: 6174 615f 6469 7229 0d0a 2020 2020 2020  ata_dir)..      
+0006e4f0: 2020 6578 6365 7074 2046 696c 6545 7869    except FileExi
+0006e500: 7374 7345 7272 6f72 3a0d 0a20 2020 2020  stsError:..     
+0006e510: 2020 2020 2020 2070 6173 730d 0a0d 0a20         pass.... 
+0006e520: 2020 2065 7870 6f72 7465 645f 7374 7275     exported_stru
+0006e530: 6374 7572 6573 5f6c 6973 745f 6669 6c65  ctures_list_file
+0006e540: 7061 7468 3d6f 732e 7061 7468 2e6a 6f69  path=os.path.joi
+0006e550: 6e28 6469 6d65 6e73 696f 6e2e 7369 7465  n(dimension.site
+0006e560: 2e5f 656d 706f 7765 725f 6578 706f 7274  ._empower_export
+0006e570: 5f64 6174 615f 6469 722c 2027 5374 7275  _data_dir, 'Stru
+0006e580: 6374 7572 6573 5f27 2b73 7472 2864 696d  ctures_'+str(dim
+0006e590: 656e 7369 6f6e 2e69 6e64 6578 292b 272e  ension.index)+'.
+0006e5a0: 7473 7627 290d 0a0d 0a20 2020 2023 2345  tsv')....    ##E
+0006e5b0: 7870 6f72 7420 7468 6520 7374 7275 6374  xport the struct
+0006e5c0: 7572 6573 206c 6973 7420 6672 6f6d 2045  ures list from E
+0006e5d0: 6d70 6f77 6572 2069 6620 7765 206e 6565  mpower if we nee
+0006e5e0: 6420 746f 0d0a 2020 2020 6c6f 672e 7665  d to..    log.ve
+0006e5f0: 7262 6f73 6528 2022 4578 706f 7274 696e  rbose( "Exportin
+0006e600: 6720 5374 7275 6374 7572 6520 4c69 7374  g Structure List
+0006e610: 2066 726f 6d20 7468 6520 456d 706f 7765   from the Empowe
+0006e620: 7220 5369 7465 2064 696d 656e 7369 6f6e  r Site dimension
+0006e630: 2022 2b73 7472 2864 696d 656e 7369 6f6e   "+str(dimension
+0006e640: 2e69 6e64 6578 292b 2220 6672 6f6d 2022  .index)+" from "
+0006e650: 2b64 696d 656e 7369 6f6e 2e73 6974 652e  +dimension.site.
+0006e660: 5f73 6974 655f 6c6f 6361 746f 7229 0d0a  _site_locator)..
+0006e670: 0d0a 2020 2020 636f 6d6d 616e 645f 6c69  ..    command_li
+0006e680: 7374 203d 2064 696d 656e 7369 6f6e 2e73  st = dimension.s
+0006e690: 6974 652e 5f6c 6f67 6f6e 5f70 6172 616d  ite._logon_param
+0006e6a0: 6574 6572 5f69 6d70 6f72 7465 725f 636f  eter_importer_co
+0006e6b0: 6d6d 616e 6473 202b 205c 0d0a 2020 2020  mmands + \..    
+0006e6c0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0006e6d0: 2773 6574 2d70 6172 616d 6574 6572 2064  'set-parameter d
+0006e6e0: 696d 656e 7369 6f6e 5f69 6e64 6578 3d27  imension_index='
+0006e6f0: 2020 202b 7374 7228 6469 6d65 6e73 696f     +str(dimensio
+0006e700: 6e2e 696e 6465 7829 0d0a 2020 2020 2020  n.index)..      
+0006e710: 2020 2020 2020 2020 2020 2020 202c 2765               ,'e
+0006e720: 6d70 6f77 6572 2d65 7870 6f72 742d 7374  mpower-export-st
+0006e730: 7275 6374 7572 6573 2022 247b 7369 7465  ructures "${site
+0006e740: 7d22 2022 247b 7573 6572 7d22 2022 247b  }" "${user}" "${
+0006e750: 7061 7373 776f 7264 7d22 2024 7b64 696d  password}" ${dim
+0006e760: 656e 7369 6f6e 5f69 6e64 6578 7d27 0d0a  ension_index}'..
+0006e770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006e780: 2020 202c 2774 7376 2d65 6e63 6f64 6527     ,'tsv-encode'
+0006e790: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006e7a0: 2020 2020 205d 0d0a 0d0a 2020 2020 6966       ]....    if
+0006e7b0: 2064 6562 7567 3a0d 0a20 2020 2020 2020   debug:..       
+0006e7c0: 2063 6f6d 6d61 6e64 5f6c 6973 7420 2b3d   command_list +=
+0006e7d0: 205b 2773 6176 652d 6669 6c65 2022 7b7d   ['save-file "{}
+0006e7e0: 2227 2e66 6f72 6d61 7428 6f73 2e70 6174  "'.format(os.pat
+0006e7f0: 682e 6162 7370 6174 6828 6578 706f 7274  h.abspath(export
+0006e800: 6564 5f73 7472 7563 7475 7265 735f 6c69  ed_structures_li
+0006e810: 7374 5f66 696c 6570 6174 6829 295d 0d0a  st_filepath))]..
+0006e820: 2020 2020 2020 2020 6c6c 752e 7275 6e5f          llu.run_
+0006e830: 7369 6e67 6c65 5f6f 7574 7075 745f 696d  single_output_im
+0006e840: 706f 7274 6572 5f63 6f6d 6d61 6e64 7328  porter_commands(
+0006e850: 636f 6d6d 616e 645f 6c69 7374 2c65 6d70  command_list,emp
+0006e860: 6f77 6572 5f69 6d70 6f72 7465 725f 6578  ower_importer_ex
+0006e870: 6563 7574 6162 6c65 3d64 696d 656e 7369  ecutable=dimensi
+0006e880: 6f6e 2e73 6974 652e 656d 706f 7765 725f  on.site.empower_
+0006e890: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
+0006e8a0: 626c 6529 0d0a 2020 2020 656c 7365 3a0d  ble)..    else:.
+0006e8b0: 0a20 2020 2020 2020 2063 6f6d 6d61 6e64  .        command
+0006e8c0: 5f6c 6973 7420 2b3d 205b 276f 7574 7075  _list += ['outpu
+0006e8d0: 7427 5d0d 0a20 2020 2020 2020 206f 7574  t']..        out
+0006e8e0: 7075 7420 3d20 6c6c 752e 7275 6e5f 7369  put = llu.run_si
+0006e8f0: 6e67 6c65 5f6f 7574 7075 745f 696d 706f  ngle_output_impo
+0006e900: 7274 6572 5f63 6f6d 6d61 6e64 7328 636f  rter_commands(co
+0006e910: 6d6d 616e 645f 6c69 7374 2c65 6d70 6f77  mmand_list,empow
+0006e920: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
+0006e930: 7574 6162 6c65 3d64 696d 656e 7369 6f6e  utable=dimension
+0006e940: 2e73 6974 652e 656d 706f 7765 725f 696d  .site.empower_im
+0006e950: 706f 7274 6572 5f65 7865 6375 7461 626c  porter_executabl
+0006e960: 6529 0d0a 0d0a 2020 2020 6465 6620 5f72  e)....    def _r
+0006e970: 6561 645f 6578 706f 7274 6564 5f73 7472  ead_exported_str
+0006e980: 7563 7475 7265 735f 6461 7461 2865 7870  uctures_data(exp
+0006e990: 6f72 7465 645f 7374 7275 6374 7572 6573  orted_structures
+0006e9a0: 5f64 6174 6129 3a0d 0a20 2020 2020 2020  _data):..       
+0006e9b0: 2072 6561 6465 723d 6373 762e 4469 6374   reader=csv.Dict
+0006e9c0: 5265 6164 6572 2865 7870 6f72 7465 645f  Reader(exported_
+0006e9d0: 7374 7275 6374 7572 6573 5f64 6174 612c  structures_data,
+0006e9e0: 6465 6c69 6d69 7465 723d 275c 7427 290d  delimiter='\t').
+0006e9f0: 0a20 2020 2020 2020 2064 696d 656e 7369  .        dimensi
+0006ea00: 6f6e 5f6c 6f6e 676e 616d 653d 4e6f 6e65  on_longname=None
+0006ea10: 0d0a 2020 2020 2020 2020 7374 7275 6374  ..        struct
+0006ea20: 7572 655f 6c69 7374 3d5b 5d0d 0a20 2020  ure_list=[]..   
+0006ea30: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+0006ea40: 2020 2020 2020 2066 6f72 2072 6563 6f72         for recor
+0006ea50: 6420 696e 2072 6561 6465 723a 0d0a 0d0a  d in reader:....
+0006ea60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ea70: 6469 6d65 6e73 696f 6e5f 6c6f 6e67 6e61  dimension_longna
+0006ea80: 6d65 203d 2063 6f6e 7665 7274 5f73 7472  me = convert_str
+0006ea90: 696e 6728 7265 636f 7264 5b27 4469 6d65  ing(record['Dime
+0006eaa0: 6e73 696f 6e27 5d29 0d0a 2020 2020 2020  nsion'])..      
+0006eab0: 2020 2020 2020 2020 2020 7368 6f72 746e            shortn
+0006eac0: 616d 6520 2020 2020 2020 2020 203d 2063  ame          = c
+0006ead0: 6f6e 7665 7274 5f73 7472 696e 6728 7265  onvert_string(re
+0006eae0: 636f 7264 5b27 5368 6f72 746e 616d 6527  cord['Shortname'
+0006eaf0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+0006eb00: 2020 2020 6c6f 6e67 6e61 6d65 2020 2020      longname    
+0006eb10: 2020 2020 2020 203d 2063 6f6e 7665 7274         = convert
+0006eb20: 5f73 7472 696e 6728 7265 636f 7264 5b27  _string(record['
+0006eb30: 4c6f 6e67 6e61 6d65 275d 290d 0a20 2020  Longname'])..   
+0006eb40: 2020 2020 2020 2020 2020 2020 2064 6573               des
+0006eb50: 6372 6970 7469 6f6e 2020 2020 2020 2020  cription        
+0006eb60: 3d20 636f 6e76 6572 745f 7374 7269 6e67  = convert_string
+0006eb70: 2872 6563 6f72 645b 2744 6573 6372 6970  (record['Descrip
+0006eb80: 7469 6f6e 275d 290d 0a0d 0a20 2020 2020  tion'])....     
+0006eb90: 2020 2020 2020 2020 2020 2023 544f 444f             #TODO
+0006eba0: 202d 2063 6f72 7265 6374 2070 6172 616d   - correct param
+0006ebb0: 6574 6572 730d 0a20 2020 2020 2020 2020  eters..         
+0006ebc0: 2020 2020 2020 2073 7472 7563 7475 7265         structure
+0006ebd0: 3d20 5374 7275 6374 7572 6528 7368 6f72  = Structure(shor
+0006ebe0: 746e 616d 653d 7368 6f72 746e 616d 650d  tname=shortname.
+0006ebf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0006ec00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ec10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ec20: 202c 6469 6d65 6e73 696f 6e5f 696e 6465   ,dimension_inde
-0006ec30: 7820 3d20 6469 6d65 6e73 696f 6e2e 696e  x = dimension.in
-0006ec40: 6465 780d 0a20 2020 2020 2020 2020 2020  dex..           
-0006ec50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ec60: 2020 2020 2020 2020 202c 6469 6d65 6e73           ,dimens
-0006ec70: 696f 6e3d 6469 6d65 6e73 696f 6e0d 0a20  ion=dimension.. 
+0006ec10: 2020 2020 202c 6c6f 6e67 6e61 6d65 3d6c       ,longname=l
+0006ec20: 6f6e 676e 616d 650d 0a20 2020 2020 2020  ongname..       
+0006ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ec40: 2020 2020 2020 2020 2020 2020 202c 6469               ,di
+0006ec50: 6d65 6e73 696f 6e5f 696e 6465 7820 3d20  mension_index = 
+0006ec60: 6469 6d65 6e73 696f 6e2e 696e 6465 780d  dimension.index.
+0006ec70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0006ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006eca0: 2020 2029 0d0a 2020 2020 2020 2020 2020     )..          
-0006ecb0: 2020 2020 2020 7374 7275 6374 7572 652e        structure.
-0006ecc0: 6465 7363 7269 7074 696f 6e20 3d20 6465  description = de
-0006ecd0: 7363 7269 7074 696f 6e0d 0a20 2020 2020  scription..     
-0006ece0: 2020 2020 2020 2020 2020 2073 7472 7563             struc
-0006ecf0: 7475 7265 2e5f 6578 6973 7473 5f69 6e5f  ture._exists_in_
-0006ed00: 656d 706f 7765 7220 3d20 5472 7565 0d0a  empower = True..
-0006ed10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006ed20: 7374 7275 6374 7572 655f 6c69 7374 2e61  structure_list.a
-0006ed30: 7070 656e 6428 7374 7275 6374 7572 6529  ppend(structure)
-0006ed40: 0d0a 0d0a 0d0a 2020 2020 2020 2020 6578  ......        ex
-0006ed50: 6365 7074 2045 7863 6570 7469 6f6e 3a0d  cept Exception:.
-0006ed60: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0006ed70: 6e74 2827 4c69 6e65 206e 6f3a 2027 2b73  nt('Line no: '+s
-0006ed80: 7472 2872 6561 6465 722e 6c69 6e65 5f6e  tr(reader.line_n
-0006ed90: 756d 2929 0d0a 2020 2020 2020 2020 2020  um))..          
-0006eda0: 2020 7261 6973 650d 0a0d 0a20 2020 2020    raise....     
-0006edb0: 2020 2023 5468 6973 2069 7320 616e 206f     #This is an o
-0006edc0: 7070 6f72 7475 6e69 7479 2074 6f20 7365  pportunity to se
-0006edd0: 7420 7468 6520 6469 6d65 6e73 696f 6e20  t the dimension 
-0006ede0: 6c6f 6e67 6e61 6d65 2c20 7768 6963 6820  longname, which 
-0006edf0: 6973 6e27 7420 6176 6169 6c61 626c 6520  isn't available 
-0006ee00: 7669 6120 616e 2065 7870 6c69 6369 7420  via an explicit 
-0006ee10: 656d 706f 7765 7220 636f 6d6d 616e 640d  empower command.
-0006ee20: 0a20 2020 2020 2020 2064 696d 656e 7369  .        dimensi
-0006ee30: 6f6e 2e6c 6f6e 676e 616d 6520 3d20 6469  on.longname = di
-0006ee40: 6d65 6e73 696f 6e5f 6c6f 6e67 6e61 6d65  mension_longname
-0006ee50: 0d0a 0d0a 2020 2020 2020 2020 7265 7475  ....        retu
-0006ee60: 726e 2073 7472 7563 7475 7265 5f6c 6973  rn structure_lis
-0006ee70: 740d 0a0d 0a20 2020 206d 616a 6f72 5f76  t....    major_v
-0006ee80: 6572 7369 6f6e 2c20 6d69 6e6f 725f 7665  ersion, minor_ve
-0006ee90: 7273 696f 6e2c 2072 656c 6561 7365 2c20  rsion, release, 
-0006eea0: 7265 6c65 6173 655f 6e75 6d62 6572 203d  release_number =
-0006eeb0: 2064 696d 656e 7369 6f6e 2e73 6974 652e   dimension.site.
-0006eec0: 696d 706f 7274 6572 5f76 6572 7369 6f6e  importer_version
-0006eed0: 0d0a 2020 2020 656e 636f 6469 6e67 3d27  ..    encoding='
-0006eee0: 616e 7369 270d 0a20 2020 2069 6620 286d  ansi'..    if (m
-0006eef0: 616a 6f72 5f76 6572 7369 6f6e 203d 3d20  ajor_version == 
-0006ef00: 3920 616e 6420 286d 696e 6f72 5f76 6572  9 and (minor_ver
-0006ef10: 7369 6f6e 203e 3d20 3829 2920 6f72 206d  sion >= 8)) or m
-0006ef20: 616a 6f72 5f76 6572 7369 6f6e 203e 2039  ajor_version > 9
-0006ef30: 3a0d 0a20 2020 2020 2020 2065 6e63 6f64  :..        encod
-0006ef40: 696e 673d 2275 7466 2d38 2d73 6967 220d  ing="utf-8-sig".
-0006ef50: 0a20 2020 2020 2020 200d 0a20 2020 2069  .        ..    i
-0006ef60: 6620 6465 6275 673a 0d0a 2020 2020 2020  f debug:..      
-0006ef70: 2020 2352 6561 6420 7468 6520 6461 7461    #Read the data
-0006ef80: 2066 726f 6d20 6669 6c65 0d0a 2020 2020   from file..    
-0006ef90: 2020 2020 7769 7468 206f 7065 6e28 6578      with open(ex
-0006efa0: 706f 7274 6564 5f73 7472 7563 7475 7265  ported_structure
-0006efb0: 735f 6c69 7374 5f66 696c 6570 6174 682c  s_list_filepath,
-0006efc0: 6d6f 6465 3d27 7227 2c65 6e63 6f64 696e  mode='r',encodin
-0006efd0: 673d 656e 636f 6469 6e67 2920 6173 2065  g=encoding) as e
-0006efe0: 7870 6f72 7465 645f 7374 7275 6374 7572  xported_structur
-0006eff0: 6573 5f64 6174 613a 0d0a 2020 2020 2020  es_data:..      
-0006f000: 2020 2020 2020 2354 6865 2065 6c65 6d65        #The eleme
-0006f010: 6e74 206c 6973 7420 7468 6174 2077 696c  nt list that wil
-0006f020: 6c20 6265 2072 6574 7574 6e65 6420 2d20  l be retutned - 
-0006f030: 7765 276c 6c20 6164 6420 656c 656d 656e  we'll add elemen
-0006f040: 7473 2074 6f20 7468 6973 206c 6973 740d  ts to this list.
-0006f050: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-0006f060: 7563 7475 7265 5f6c 6973 7420 3d20 5f72  ucture_list = _r
-0006f070: 6561 645f 6578 706f 7274 6564 5f73 7472  ead_exported_str
-0006f080: 7563 7475 7265 735f 6461 7461 2865 7870  uctures_data(exp
-0006f090: 6f72 7465 645f 7374 7275 6374 7572 6573  orted_structures
-0006f0a0: 5f64 6174 6129 0d0a 2020 2020 2020 2020  _data)..        
-0006f0b0: 2020 2020 0d0a 2020 2020 656c 7365 3a0d      ..    else:.
-0006f0c0: 0a20 2020 2020 2020 2069 6d70 6f72 7420  .        import 
-0006f0d0: 696f 0d0a 2020 2020 2020 2020 2344 6f20  io..        #Do 
-0006f0e0: 6120 6675 6e6b 7920 476c 6167 6f6c 7974  a funky Glagolyt
-0006f0f0: 6963 2072 6570 6c61 6365 6d65 6e74 2074  ic replacement t
-0006f100: 6f20 6669 7820 7175 6f74 696e 6720 6973  o fix quoting is
-0006f110: 7375 6573 202d 2049 2063 686f 7365 2074  sues - I chose t
-0006f120: 6865 206f 6e65 2074 6861 7420 6c6f 6f6b  he one that look
-0006f130: 7320 6c69 6b65 2061 206c 616d 700d 0a20  s like a lamp.. 
-0006f140: 2020 2020 2020 2023 4966 2074 6865 7265         #If there
-0006f150: 2061 7265 2072 6561 6c20 476c 6167 6f6c   are real Glagol
-0006f160: 7974 6963 2063 6861 7261 6374 6572 7320  ytic characters 
-0006f170: 696e 2079 6f75 7220 6461 7461 2028 6869  in your data (hi
-0006f180: 6768 6c79 2075 6e6c 696b 656c 7920 2d20  ghly unlikely - 
-0006f190: 6974 2773 2061 2076 6572 792c 2076 6572  it's a very, ver
-0006f1a0: 7920 6465 6164 206c 616e 6775 6167 6529  y dead language)
-0006f1b0: 2074 6869 7320 636f 6465 2077 696c 6c20   this code will 
-0006f1c0: 6661 696c 0d0a 2020 2020 2020 2020 2354  fail..        #T
-0006f1d0: 6865 2065 6c65 6d65 6e74 206c 6973 7420  he element list 
-0006f1e0: 7468 6174 2077 696c 6c20 6265 2072 6574  that will be ret
-0006f1f0: 7574 6e65 6420 2d20 7765 276c 6c20 6164  utned - we'll ad
-0006f200: 6420 656c 656d 656e 7473 2074 6f20 7468  d elements to th
-0006f210: 6973 206c 6973 740d 0a20 2020 2020 2020  is list..       
-0006f220: 2073 7472 7563 7475 7265 5f6c 6973 7420   structure_list 
-0006f230: 3d20 5f72 6561 645f 6578 706f 7274 6564  = _read_exported
-0006f240: 5f73 7472 7563 7475 7265 735f 6461 7461  _structures_data
-0006f250: 2869 6f2e 5374 7269 6e67 494f 286f 7574  (io.StringIO(out
-0006f260: 7075 742e 7265 706c 6163 6528 2722 2227  put.replace('""'
-0006f270: 2c27 e2b0 a627 292e 7265 706c 6163 6528  ,'...').replace(
-0006f280: 2722 272c 2727 292e 7265 706c 6163 6528  '"','').replace(
-0006f290: 27e2 b0a6 272c 2722 2729 2929 0d0a 0d0a  '...','"')))....
-0006f2a0: 2020 2020 2341 7474 656d 7074 2074 6f20      #Attempt to 
-0006f2b0: 6b65 6570 2074 6865 2073 616d 6520 6f62  keep the same ob
-0006f2c0: 6a65 6374 2072 6566 6572 656e 6365 7320  ject references 
-0006f2d0: 666f 7220 7072 6576 696f 7573 6c79 2075  for previously u
-0006f2e0: 7365 6420 656c 656d 656e 7473 0d0a 2020  sed elements..  
-0006f2f0: 2020 6966 206f 6c64 5f73 7472 7563 7475    if old_structu
-0006f300: 7265 7320 6973 206e 6f74 204e 6f6e 653a  res is not None:
-0006f310: 0d0a 2020 2020 2020 2020 666f 7220 7374  ..        for st
-0006f320: 7275 6374 7572 6520 696e 206f 6c64 5f73  ructure in old_s
-0006f330: 7472 7563 7475 7265 733a 0d0a 2020 2020  tructures:..    
-0006f340: 2020 2020 2020 2020 7265 7475 726e 5f64          return_d
-0006f350: 6963 745b 7374 7275 6374 7572 652e 7368  ict[structure.sh
-0006f360: 6f72 746e 616d 655d 3d73 7472 7563 7475  ortname]=structu
-0006f370: 7265 0d0a 0d0a 2020 2020 666f 7220 7374  re....    for st
-0006f380: 7275 6374 7572 6520 696e 2073 7472 7563  ructure in struc
-0006f390: 7475 7265 5f6c 6973 743a 0d0a 2020 2020  ture_list:..    
-0006f3a0: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
-0006f3b0: 2020 2020 2020 2349 6620 7468 6520 7374        #If the st
-0006f3c0: 7275 6374 7572 6520 616c 7265 6164 7920  ructure already 
-0006f3d0: 6578 6973 7473 2c20 7365 7420 7468 6520  exists, set the 
-0006f3e0: 7374 7275 6374 7572 6573 2069 6e74 6572  structures inter
-0006f3f0: 6e61 6c73 2074 6f20 6265 2074 6865 2073  nals to be the s
-0006f400: 616d 6520 6173 2074 6865 206e 6577 2073  ame as the new s
-0006f410: 7472 7563 7475 7265 2c20 6275 7420 6d61  tructure, but ma
-0006f420: 6b65 2073 7572 6520 7765 206b 6565 7020  ke sure we keep 
-0006f430: 7468 650d 0a20 2020 2020 2020 2020 2020  the..           
-0006f440: 2072 6574 7572 6e5f 6469 6374 5b73 7472   return_dict[str
-0006f450: 7563 7475 7265 2e73 686f 7274 6e61 6d65  ucture.shortname
-0006f460: 5d2e 6c6f 6e67 6e61 6d65 2020 2020 3d20  ].longname    = 
-0006f470: 7374 7275 6374 7572 652e 6c6f 6e67 6e61  structure.longna
-0006f480: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
-0006f490: 7265 7475 726e 5f64 6963 745b 7374 7275  return_dict[stru
-0006f4a0: 6374 7572 652e 7368 6f72 746e 616d 655d  cture.shortname]
-0006f4b0: 2e64 6573 6372 6970 7469 6f6e 203d 2073  .description = s
-0006f4c0: 7472 7563 7475 7265 2e64 6573 6372 6970  tructure.descrip
-0006f4d0: 7469 6f6e 0d0a 0d0a 2020 2020 2020 2020  tion....        
-0006f4e0: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
-0006f4f0: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
-0006f500: 7475 726e 5f64 6963 745b 7374 7275 6374  turn_dict[struct
-0006f510: 7572 652e 7368 6f72 746e 616d 655d 3d73  ure.shortname]=s
-0006f520: 7472 7563 7475 7265 0d0a 0d0a 2020 2020  tructure....    
-0006f530: 7265 7475 726e 2072 6574 7572 6e5f 6469  return return_di
-0006f540: 6374 0d0a 0d0a 0d0a 6465 6620 5f63 7265  ct......def _cre
-0006f550: 6174 655f 656d 706f 7765 725f 6469 6d65  ate_empower_dime
-0006f560: 6e73 696f 6e5f 656c 656d 656e 745f 6c69  nsion_element_li
-0006f570: 7374 2864 696d 656e 7369 6f6e 2c64 6562  st(dimension,deb
-0006f580: 7567 3d46 616c 7365 293a 0d0a 2020 2020  ug=False):..    
-0006f590: 2727 2743 7265 6174 6520 6120 6c69 7374  '''Create a list
-0006f5a0: 206f 6620 456d 706f 7765 7220 656c 656d   of Empower elem
-0006f5b0: 656e 7473 2c20 666f 7220 6120 6769 7665  ents, for a give
-0006f5c0: 6e20 6469 6d65 6e73 696f 6e0d 0a20 2020  n dimension..   
-0006f5d0: 2054 6865 2065 6c65 6d65 6e74 7320 7769   The elements wi
-0006f5e0: 6c6c 2062 6520 6f66 2074 7970 6520 456c  ll be of type El
-0006f5f0: 656d 656e 742c 2061 2063 6c61 7373 2069  ement, a class i
-0006f600: 6e20 7468 6973 206d 6f64 756c 652e 0d0a  n this module...
-0006f610: 0d0a 2020 2020 3a70 6172 616d 2064 696d  ..    :param dim
-0006f620: 656e 7369 6f6e 3a20 4120 7079 6d70 7820  ension: A pympx 
-0006f630: 4469 6d65 6e73 696f 6e20 6f62 6a65 6374  Dimension object
-0006f640: 0d0a 2020 2020 3a70 6172 616d 2064 6562  ..    :param deb
-0006f650: 7567 3a20 5772 6974 6520 656c 656d 656e  ug: Write elemen
-0006f660: 7473 2074 6f20 6669 6c65 2c20 746f 2061  ts to file, to a
-0006f670: 6964 2077 6974 6820 6465 6275 6767 696e  id with debuggin
-0006f680: 670d 0a20 2020 2027 2727 0d0a 0d0a 2020  g..    '''....  
-0006f690: 2020 2348 656c 7065 7220 6675 6e63 7469    #Helper functi
-0006f6a0: 6f6e 2074 6f20 636f 6e76 6572 7420 7374  on to convert st
-0006f6b0: 7269 6e67 7320 636f 7272 6563 746c 790d  rings correctly.
-0006f6c0: 0a20 2020 2064 6566 2063 6f6e 7665 7274  .    def convert
-0006f6d0: 5f73 7472 696e 6728 7329 3a0d 0a20 2020  _string(s):..   
-0006f6e0: 2020 2020 2023 7072 696e 7428 2763 6f6e       #print('con
-0006f6f0: 7665 7274 696e 6720 7374 7269 6e67 272c  verting string',
-0006f700: 7329 0d0a 2020 2020 2020 2020 6966 2073  s)..        if s
-0006f710: 203d 3d20 2727 3a0d 0a20 2020 2020 2020   == '':..       
-0006f720: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0006f730: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
-0006f740: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0006f750: 7572 6e20 730d 0a0d 0a20 2020 2023 5468  urn s....    #Th
-0006f760: 6520 656c 656d 656e 7420 6c69 7374 2074  e element list t
-0006f770: 6861 7420 7769 6c6c 2062 6520 7265 7475  hat will be retu
-0006f780: 726e 6564 202d 2077 6527 6c6c 2061 6464  rned - we'll add
-0006f790: 2065 6c65 6d65 6e74 7320 746f 2074 6869   elements to thi
-0006f7a0: 7320 6c69 7374 0d0a 2020 2020 656c 656d  s list..    elem
-0006f7b0: 656e 745f 6c69 7374 3d5b 5d0d 0a0d 0a20  ent_list=[].... 
-0006f7c0: 2020 2023 4578 706f 7274 2074 6865 2064     #Export the d
-0006f7d0: 696d 656e 7369 6f6e 2066 726f 6d20 456d  imension from Em
-0006f7e0: 706f 7765 720d 0a20 2020 2023 4d61 6b65  power..    #Make
-0006f7f0: 2074 6865 2064 6972 6563 746f 7269 6573   the directories
-0006f800: 2069 6620 696e 2064 6562 7567 206d 6f64   if in debug mod
-0006f810: 650d 0a20 2020 2069 6620 6465 6275 673a  e..    if debug:
-0006f820: 0d0a 2020 2020 2020 2020 7472 793a 0d0a  ..        try:..
-0006f830: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
-0006f840: 616b 6564 6972 7328 6469 6d65 6e73 696f  akedirs(dimensio
-0006f850: 6e2e 7369 7465 2e5f 656d 706f 7765 725f  n.site._empower_
-0006f860: 6578 706f 7274 5f64 6174 615f 6469 7229  export_data_dir)
-0006f870: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-0006f880: 2046 696c 6545 7869 7374 7345 7272 6f72   FileExistsError
-0006f890: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
-0006f8a0: 6173 730d 0a0d 0a20 2020 2064 696d 5f69  ass....    dim_i
-0006f8b0: 6e64 6578 203d 696e 7428 6469 6d65 6e73  ndex =int(dimens
-0006f8c0: 696f 6e2e 696e 6465 7829 0d0a 0d0a 2020  ion.index)....  
-0006f8d0: 2020 6c6f 672e 7665 7262 6f73 6528 2022    log.verbose( "
-0006f8e0: 5275 6e6e 696e 6720 494d 504f 5254 4552  Running IMPORTER
-0006f8f0: 3a20 6672 6f6d 203c 7374 6469 6e3e 2074  : from <stdin> t
-0006f900: 6f20 6578 706f 7274 2074 6865 2045 6d70  o export the Emp
-0006f910: 6f77 6572 2053 6974 6520 6469 6d65 6e73  ower Site dimens
-0006f920: 696f 6e20 7b7d 2066 726f 6d20 7b7d 222e  ion {} from {}".
-0006f930: 666f 726d 6174 2864 696d 5f69 6e64 6578  format(dim_index
-0006f940: 2c20 6469 6d65 6e73 696f 6e2e 7369 7465  , dimension.site
-0006f950: 2e5f 7369 7465 5f6c 6f63 6174 6f72 2929  ._site_locator))
-0006f960: 0d0a 0d0a 2020 2020 636f 6d6d 616e 645f  ....    command_
-0006f970: 6c69 7374 203d 2064 696d 656e 7369 6f6e  list = dimension
-0006f980: 2e73 6974 652e 5f6c 6f67 6f6e 5f70 6172  .site._logon_par
-0006f990: 616d 6574 6572 5f69 6d70 6f72 7465 725f  ameter_importer_
-0006f9a0: 636f 6d6d 616e 6473 202b 205c 0d0a 2020  commands + \..  
-0006f9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006f9c0: 205b 2773 6574 2d70 6172 616d 6574 6572   ['set-parameter
-0006f9d0: 2074 6172 6765 743d 2720 2020 2020 2020   target='       
-0006f9e0: 2020 2020 202b 6f73 2e70 6174 682e 6162       +os.path.ab
-0006f9f0: 7370 6174 6828 6469 6d65 6e73 696f 6e2e  spath(dimension.
-0006fa00: 7369 7465 2e5f 656d 706f 7765 725f 6578  site._empower_ex
-0006fa10: 706f 7274 5f64 6174 615f 6469 7229 0d0a  port_data_dir)..
-0006fa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006fa30: 2020 202c 2773 6574 2d70 6172 616d 6574     ,'set-paramet
-0006fa40: 6572 2064 696d 656e 7369 6f6e 5f69 6e64  er dimension_ind
-0006fa50: 6578 3d27 2020 202b 7374 7228 6469 6d5f  ex='   +str(dim_
-0006fa60: 696e 6465 7829 0d0a 2020 2020 2020 2020  index)..        
-0006fa70: 2020 2020 2020 2020 2020 202c 2765 6d70             ,'emp
-0006fa80: 6f77 6572 2d65 7870 6f72 742d 656c 656d  ower-export-elem
-0006fa90: 656e 7473 2022 247b 7369 7465 7d22 2022  ents "${site}" "
-0006faa0: 247b 7573 6572 7d22 2022 247b 7061 7373  ${user}" "${pass
-0006fab0: 776f 7264 7d22 2024 7b64 696d 656e 7369  word}" ${dimensi
-0006fac0: 6f6e 5f69 6e64 6578 7d27 0d0a 2020 2020  on_index}'..    
-0006fad0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-0006fae0: 2774 7376 2d65 6e63 6f64 6527 0d0a 2020  'tsv-encode'..  
-0006faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0006fb00: 205d 0d0a 0d0a 2020 2020 6966 2064 6562   ]....    if deb
-0006fb10: 7567 3a0d 0a20 2020 2020 2020 2063 6f6d  ug:..        com
-0006fb20: 6d61 6e64 5f6c 6973 7420 2b3d 205b 2773  mand_list += ['s
-0006fb30: 6176 652d 6669 6c65 2022 247b 7461 7267  ave-file "${targ
-0006fb40: 6574 7d5c 4469 6d65 6e73 696f 6e5f 247b  et}\Dimension_${
-0006fb50: 6469 6d65 6e73 696f 6e5f 696e 6465 787d  dimension_index}
-0006fb60: 2e74 7376 2227 5d0d 0a20 2020 2020 2020  .tsv"']..       
-0006fb70: 206c 6c75 2e72 756e 5f73 696e 676c 655f   llu.run_single_
-0006fb80: 6f75 7470 7574 5f69 6d70 6f72 7465 725f  output_importer_
-0006fb90: 636f 6d6d 616e 6473 2863 6f6d 6d61 6e64  commands(command
-0006fba0: 5f6c 6973 742c 656d 706f 7765 725f 696d  _list,empower_im
-0006fbb0: 706f 7274 6572 5f65 7865 6375 7461 626c  porter_executabl
-0006fbc0: 653d 6469 6d65 6e73 696f 6e2e 7369 7465  e=dimension.site
-0006fbd0: 2e65 6d70 6f77 6572 5f69 6d70 6f72 7465  .empower_importe
-0006fbe0: 725f 6578 6563 7574 6162 6c65 290d 0a20  r_executable).. 
-0006fbf0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-0006fc00: 2020 636f 6d6d 616e 645f 6c69 7374 202b    command_list +
-0006fc10: 3d20 5b27 6f75 7470 7574 275d 0d0a 0d0a  = ['output']....
-0006fc20: 2020 2020 2020 2020 6f75 7470 7574 203d          output =
-0006fc30: 206c 6c75 2e72 756e 5f73 696e 676c 655f   llu.run_single_
-0006fc40: 6f75 7470 7574 5f69 6d70 6f72 7465 725f  output_importer_
-0006fc50: 636f 6d6d 616e 6473 2863 6f6d 6d61 6e64  commands(command
-0006fc60: 5f6c 6973 742c 656d 706f 7765 725f 696d  _list,empower_im
-0006fc70: 706f 7274 6572 5f65 7865 6375 7461 626c  porter_executabl
-0006fc80: 653d 6469 6d65 6e73 696f 6e2e 7369 7465  e=dimension.site
-0006fc90: 2e65 6d70 6f77 6572 5f69 6d70 6f72 7465  .empower_importe
-0006fca0: 725f 6578 6563 7574 6162 6c65 290d 0a0d  r_executable)...
-0006fcb0: 0a20 2020 2064 6566 205f 7265 6164 5f65  .    def _read_e
-0006fcc0: 7870 6f72 7465 645f 6469 6d65 6e73 696f  xported_dimensio
-0006fcd0: 6e5f 6461 7461 2865 7870 6f72 7465 645f  n_data(exported_
-0006fce0: 6469 6d65 6e73 696f 6e5f 6461 7461 293a  dimension_data):
-0006fcf0: 0d0a 2020 2020 2020 2020 7265 6164 6572  ..        reader
-0006fd00: 3d63 7376 2e44 6963 7452 6561 6465 7228  =csv.DictReader(
-0006fd10: 6578 706f 7274 6564 5f64 696d 656e 7369  exported_dimensi
-0006fd20: 6f6e 5f64 6174 612c 6465 6c69 6d69 7465  on_data,delimite
-0006fd30: 723d 275c 7427 290d 0a0d 0a20 2020 2020  r='\t')....     
-0006fd40: 2020 2066 6f72 2066 6965 6c64 5f6e 616d     for field_nam
-0006fd50: 6520 696e 2072 6561 6465 722e 6669 656c  e in reader.fiel
-0006fd60: 646e 616d 6573 3a0d 0a20 2020 2020 2020  dnames:..       
-0006fd70: 2020 2020 2069 6620 6669 656c 645f 6e61       if field_na
-0006fd80: 6d65 2021 3d20 2749 4427 2061 6e64 2064  me != 'ID' and d
-0006fd90: 696d 656e 7369 6f6e 2069 7320 6e6f 7420  imension is not 
-0006fda0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-0006fdb0: 2020 2020 2020 2064 696d 656e 7369 6f6e         dimension
-0006fdc0: 2e66 6965 6c64 732e 5f61 6464 5f66 6965  .fields._add_fie
-0006fdd0: 6c64 5f6e 616d 6528 6669 656c 645f 6e61  ld_name(field_na
-0006fde0: 6d65 2c66 726f 6d5f 656d 706f 7765 723d  me,from_empower=
-0006fdf0: 5472 7565 290d 0a0d 0a20 2020 2020 2020  True)....       
-0006fe00: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
-0006fe10: 2020 2070 7265 765f 7265 636f 7264 203d     prev_record =
-0006fe20: 205b 5d0d 0a20 2020 2020 2020 2020 2020   []..           
-0006fe30: 2066 6f72 2072 6563 6f72 6420 696e 2072   for record in r
-0006fe40: 6561 6465 723a 0d0a 2020 2020 2020 2020  eader:..        
-0006fe50: 2020 2020 2020 2020 6669 656c 6473 3d7b          fields={
-0006fe60: 7d0d 0a0d 0a20 2020 2020 2020 2020 2020  }....           
-0006fe70: 2020 2020 2023 5468 6973 2069 7320 616e       #This is an
-0006fe80: 206f 6464 2077 6179 2074 6f20 6465 616c   odd way to deal
-0006fe90: 2077 6974 6820 6120 6469 6374 696f 6e61   with a dictiona
-0006fea0: 7279 202d 2062 6173 6963 6c79 2077 6520  ry - basicly we 
-0006feb0: 7761 6e74 2074 6f20 7075 7420 7468 6520  want to put the 
-0006fec0: 6c65 6674 6f76 6572 7320 696e 746f 2066  leftovers into f
-0006fed0: 6965 6c64 732c 0d0a 2020 2020 2020 2020  ields,..        
-0006fee0: 2020 2020 2020 2020 2361 6674 6572 2077          #after w
-0006fef0: 6527 7665 2073 6372 6170 6564 206f 7574  e've scraped out
-0006ff00: 2074 6865 2070 6172 7473 206f 6620 7468   the parts of th
-0006ff10: 6520 656c 656d 656e 7420 7468 6174 2061  e element that a
-0006ff20: 7265 2061 6c77 6179 7320 7072 6573 656e  re always presen
-0006ff30: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
-0006ff40: 2020 2023 536f 2077 6520 6974 6572 6174     #So we iterat
-0006ff50: 6520 6f76 6572 2074 6865 2064 6963 7469  e over the dicti
-0006ff60: 6f6e 6172 792c 2073 6565 696e 6720 6966  onary, seeing if
-0006ff70: 2074 6865 2065 6e74 7279 2069 7320 736f   the entry is so
-0006ff80: 6d65 7468 696e 6720 7468 6174 2069 7320  mething that is 
-0006ff90: 676f 696e 6720 696e 746f 2074 6865 2045  going into the E
-0006ffa0: 6c65 6d65 6e74 2063 6f6e 7374 7275 6374  lement construct
-0006ffb0: 6f72 2028 692e 652e 2074 6865 205f 5f69  or (i.e. the __i
-0006ffc0: 6e69 745f 5f20 6675 6e63 7469 6f6e 290d  nit__ function).
-0006ffd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0006ffe0: 2023 4f72 2069 6620 7468 6520 6469 6374   #Or if the dict
-0006fff0: 696f 6e61 7279 2065 6e74 7279 2069 7320  ionary entry is 
-00070000: 676f 696e 6720 746f 2065 6e64 2075 7020  going to end up 
-00070010: 696e 2045 6c65 6d65 6e74 2e66 6965 6c64  in Element.field
-00070020: 730d 0a0d 0a20 2020 2020 2020 2020 2020  s....           
-00070030: 2020 2020 2070 6879 7369 643d 4e6f 6e65       physid=None
-00070040: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00070050: 2020 7368 6f72 746e 616d 653d 4e6f 6e65    shortname=None
-00070060: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00070070: 2020 6c6f 6e67 6e61 6d65 3d4e 6f6e 650d    longname=None.
-00070080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00070090: 2064 6573 6372 6970 7469 6f6e 3d4e 6f6e   description=Non
-000700a0: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-000700b0: 2020 2067 726f 7570 5f6f 6e6c 793d 4e6f     group_only=No
-000700c0: 6e65 0d0a 2020 2020 2020 2020 2020 2020  ne..            
-000700d0: 2020 2020 6361 6c63 756c 6174 696f 6e5f      calculation_
-000700e0: 7374 6174 7573 3d4e 6f6e 650d 0a20 2020  status=None..   
-000700f0: 2020 2020 2020 2020 2020 2020 2063 616c               cal
-00070100: 6375 6c61 7469 6f6e 3d4e 6f6e 650d 0a20  culation=None.. 
-00070110: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00070120: 6f6c 6f75 723d 4e6f 6e65 0d0a 2020 2020  olour=None..    
-00070130: 2020 2020 2020 2020 2020 2020 6d65 6173              meas
-00070140: 7572 653d 4e6f 6e65 0d0a 2020 2020 2020  ure=None..      
-00070150: 2020 2020 2020 2020 2020 7374 6172 745f            start_
-00070160: 6461 7465 3d4e 6f6e 650d 0a20 2020 2020  date=None..     
-00070170: 2020 2020 2020 2020 2020 2069 6e74 6572             inter
-00070180: 7661 6c3d 4e6f 6e65 0d0a 2020 2020 2020  val=None..      
-00070190: 2020 2020 2020 2020 2020 696e 7465 7276            interv
-000701a0: 616c 5f61 6d6f 756e 743d 4e6f 6e65 0d0a  al_amount=None..
-000701b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000701c0: 6f66 6673 6574 3d4e 6f6e 650d 0a20 2020  offset=None..   
-000701d0: 2020 2020 2020 2020 2020 2020 2072 6573               res
-000701e0: 6f6c 7574 696f 6e3d 4e6f 6e65 0d0a 0d0a  olution=None....
-000701f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070200: 666f 7220 6b65 792c 2076 616c 7565 2069  for key, value i
-00070210: 6e20 7265 636f 7264 2e69 7465 6d73 2829  n record.items()
-00070220: 3a0d 0a0d 0a20 2020 2020 2020 2020 2020  :....           
-00070230: 2020 2020 2020 2020 2069 6620 2020 6b65           if   ke
-00070240: 793d 3d27 4944 273a 0d0a 2020 2020 2020  y=='ID':..      
-00070250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070260: 2020 7068 7973 6964 3d69 6e74 2876 616c    physid=int(val
-00070270: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-00070280: 2020 2020 2020 2020 2020 2020 2023 7072               #pr
-00070290: 696e 7428 2749 4427 2c6b 6579 2c76 616c  int('ID',key,val
-000702a0: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-000702b0: 2020 2020 2020 2020 2065 6c69 6620 6b65           elif ke
-000702c0: 793d 3d27 5368 6f72 7420 4e61 6d65 273a  y=='Short Name':
-000702d0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000702e0: 2020 2020 2020 2020 2020 7368 6f72 746e            shortn
-000702f0: 616d 653d 636f 6e76 6572 745f 7374 7269  ame=convert_stri
-00070300: 6e67 2876 616c 7565 290d 0a20 2020 2020  ng(value)..     
-00070310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070320: 2020 2023 6966 2027 7e54 4523 4d50 7e27     #if '~TE#MP~'
-00070330: 2069 6e20 7368 6f72 746e 616d 653a 0d0a   in shortname:..
-00070340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070350: 2020 2020 2020 2020 2320 2020 2073 686f          #    sho
-00070360: 7274 6e61 6d65 3d73 686f 7274 6e61 6d65  rtname=shortname
-00070370: 5b37 3a5d 0d0a 2020 2020 2020 2020 2020  [7:]..          
-00070380: 2020 2020 2020 2020 2020 2020 2020 2370                #p
-00070390: 7269 6e74 2827 5368 6f72 742d 4e61 6d65  rint('Short-Name
-000703a0: 272c 6b65 792c 7661 6c75 652c 7368 6f72  ',key,value,shor
-000703b0: 746e 616d 6529 0d0a 2020 2020 2020 2020  tname)..        
-000703c0: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-000703d0: 206b 6579 3d3d 274c 6f6e 6720 4e61 6d65   key=='Long Name
-000703e0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-000703f0: 2020 2020 2020 2020 2020 2020 6c6f 6e67              long
-00070400: 6e61 6d65 3d63 6f6e 7665 7274 5f73 7472  name=convert_str
-00070410: 696e 6728 7661 6c75 6529 2020 2020 2020  ing(value)      
-00070420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070430: 2020 0d0a 2020 2020 2020 2020 2020 2020    ..            
-00070440: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
-00070450: 6e74 2827 4c6f 6e67 2d4e 616d 6527 2c6b  nt('Long-Name',k
-00070460: 6579 2c76 616c 7565 2c6c 6f6e 676e 616d  ey,value,longnam
-00070470: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
-00070480: 2020 2020 2020 2020 656c 6966 206b 6579          elif key
-00070490: 3d3d 2744 6573 6372 6970 7469 6f6e 273a  =='Description':
-000704a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000704b0: 2020 2020 2020 2020 2020 6465 7363 7269            descri
-000704c0: 7074 696f 6e20 3d63 6f6e 7665 7274 5f73  ption =convert_s
-000704d0: 7472 696e 6728 7661 6c75 6529 0d0a 2020  tring(value)..  
-000704e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000704f0: 2020 2020 2020 2370 7269 6e74 2827 4465        #print('De
-00070500: 7363 7269 7074 696f 6e27 2c6b 6579 2c76  scription',key,v
-00070510: 616c 7565 290d 0a20 2020 2020 2020 2020  alue)..         
-00070520: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00070530: 6b65 793d 3d27 4772 6f75 7020 4f6e 6c79  key=='Group Only
-00070540: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-00070550: 2020 2020 2020 2020 2020 2020 6772 6f75              grou
-00070560: 705f 6f6e 6c79 3d63 6f6e 7665 7274 5f73  p_only=convert_s
-00070570: 7472 696e 6728 7661 6c75 6529 0d0a 2020  tring(value)..  
-00070580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070590: 2020 2020 2020 2370 7269 6e74 2827 4772        #print('Gr
-000705a0: 6f75 7020 4f6e 6c79 272c 6b65 792c 7661  oup Only',key,va
-000705b0: 6c75 6529 0d0a 2020 2020 2020 2020 2020  lue)..          
-000705c0: 2020 2020 2020 2020 2020 656c 6966 206b            elif k
-000705d0: 6579 3d3d 2743 616c 6375 6c61 7469 6f6e  ey=='Calculation
-000705e0: 2053 7461 7475 7327 3a0d 0a20 2020 2020   Status':..     
-000705f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070600: 2020 2063 616c 6375 6c61 7469 6f6e 5f73     calculation_s
-00070610: 7461 7475 733d 636f 6e76 6572 745f 7374  tatus=convert_st
-00070620: 7269 6e67 2876 616c 7565 290d 0a20 2020  ring(value)..   
-00070630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070640: 2020 2020 2023 7072 696e 7428 2743 616c       #print('Cal
-00070650: 6375 6c61 7469 6f6e 2053 7461 7475 7327  culation Status'
-00070660: 2c6b 6579 2c76 616c 7565 290d 0a20 2020  ,key,value)..   
-00070670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070680: 2065 6c69 6620 6b65 793d 3d27 4361 6c63   elif key=='Calc
-00070690: 756c 6174 696f 6e27 3a0d 0a20 2020 2020  ulation':..     
-000706a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000706b0: 2020 2063 616c 6375 6c61 7469 6f6e 3d63     calculation=c
-000706c0: 6f6e 7665 7274 5f73 7472 696e 6728 7661  onvert_string(va
-000706d0: 6c75 6529 0d0a 2020 2020 2020 2020 2020  lue)..          
-000706e0: 2020 2020 2020 2020 2020 2020 2020 2370                #p
-000706f0: 7269 6e74 2827 4361 6c63 756c 6174 696f  rint('Calculatio
-00070700: 6e27 2c6b 6579 2c76 616c 7565 290d 0a20  n',key,value).. 
-00070710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070720: 2020 2065 6c69 6620 6b65 793d 3d27 436f     elif key=='Co
-00070730: 6c6f 7572 273a 0d0a 2020 2020 2020 2020  lour':..        
-00070740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070750: 636f 6c6f 7572 3d63 6f6e 7665 7274 5f73  colour=convert_s
-00070760: 7472 696e 6728 7661 6c75 6529 0d0a 2020  tring(value)..  
-00070770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070780: 2020 2020 2020 2370 7269 6e74 2827 436f        #print('Co
-00070790: 6c6f 7572 272c 6b65 792c 7661 6c75 6529  lour',key,value)
-000707a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000707b0: 2020 2020 2020 656c 6966 206b 6579 3d3d        elif key==
-000707c0: 274d 6561 7375 7265 2045 6c65 6d65 6e74  'Measure Element
-000707d0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
-000707e0: 2020 2020 2020 2020 2020 2020 6d65 6173              meas
-000707f0: 7572 653d 636f 6e76 6572 745f 7374 7269  ure=convert_stri
-00070800: 6e67 2876 616c 7565 290d 0a20 2020 2020  ng(value)..     
-00070810: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00070820: 6c69 6620 6469 6d65 6e73 696f 6e2e 696e  lif dimension.in
-00070830: 6465 783d 3d31 3120 616e 6420 6b65 793d  dex==11 and key=
-00070840: 3d27 5374 6172 7420 4461 7465 273a 0d0a  ='Start Date':..
-00070850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070860: 2020 2020 2020 2020 7374 6172 745f 6461          start_da
-00070870: 7465 3d63 6f6e 7665 7274 5f73 7472 696e  te=convert_strin
-00070880: 6728 7661 6c75 6529 0d0a 2020 2020 2020  g(value)..      
-00070890: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000708a0: 6966 2064 696d 656e 7369 6f6e 2e69 6e64  if dimension.ind
-000708b0: 6578 3d3d 3131 2061 6e64 206b 6579 3d3d  ex==11 and key==
-000708c0: 2749 6e74 6572 7661 6c27 3a0d 0a20 2020  'Interval':..   
-000708d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000708e0: 2020 2020 2069 6e74 6572 7661 6c3d 636f       interval=co
-000708f0: 6e76 6572 745f 7374 7269 6e67 2876 616c  nvert_string(val
-00070900: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-00070910: 2020 2020 2020 2020 2065 6c69 6620 6469           elif di
-00070920: 6d65 6e73 696f 6e2e 696e 6465 783d 3d31  mension.index==1
-00070930: 3120 616e 6420 6b65 793d 3d27 496e 7465  1 and key=='Inte
-00070940: 7276 616c 2041 6d6f 756e 7427 3a0d 0a20  rval Amount':.. 
-00070950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070960: 2020 2020 2020 2069 6e74 6572 7661 6c5f         interval_
-00070970: 616d 6f75 6e74 3d63 6f6e 7665 7274 5f73  amount=convert_s
-00070980: 7472 696e 6728 7661 6c75 6529 0d0a 2020  tring(value)..  
-00070990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000709a0: 2020 656c 6966 2064 696d 656e 7369 6f6e    elif dimension
-000709b0: 2e69 6e64 6578 3d3d 3131 2061 6e64 206b  .index==11 and k
-000709c0: 6579 3d3d 274f 6666 7365 7427 3a0d 0a20  ey=='Offset':.. 
-000709d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000709e0: 2020 2020 2020 206f 6666 7365 743d 636f         offset=co
-000709f0: 6e76 6572 745f 7374 7269 6e67 2876 616c  nvert_string(val
-00070a00: 7565 290d 0a20 2020 2020 2020 2020 2020  ue)..           
-00070a10: 2020 2020 2020 2020 2065 6c69 6620 6469           elif di
-00070a20: 6d65 6e73 696f 6e2e 696e 6465 783d 3d31  mension.index==1
-00070a30: 3120 616e 6420 6b65 793d 3d27 5265 736f  1 and key=='Reso
-00070a40: 6c75 7469 6f6e 273a 0d0a 2020 2020 2020  lution':..      
-00070a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070a60: 2020 7265 736f 6c75 7469 6f6e 3d63 6f6e    resolution=con
-00070a70: 7665 7274 5f73 7472 696e 6728 7661 6c75  vert_string(valu
-00070a80: 6529 0d0a 0d0a 0d0a 2020 2020 2020 2020  e)......        
-00070a90: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00070aa0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00070ab0: 2020 2020 2020 2020 2020 2066 6965 6c64             field
-00070ac0: 735b 6b65 795d 3d63 6f6e 7665 7274 5f73  s[key]=convert_s
-00070ad0: 7472 696e 6728 7661 6c75 6529 0d0a 2020  tring(value)..  
-00070ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070af0: 2020 2020 2020 2370 7269 6e74 2827 6669        #print('fi
-00070b00: 656c 6473 5b6b 6579 5d3d 7661 6c75 6527  elds[key]=value'
-00070b10: 2c6b 6579 2c76 616c 7565 290d 0a20 2020  ,key,value)..   
-00070b20: 2020 2020 2020 2020 2020 2020 2020 200d                 .
-00070b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00070b40: 2069 6620 7368 6f72 746e 616d 6520 6973   if shortname is
-00070b50: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
-00070b60: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00070b70: 7428 2773 686f 7274 4e61 6d65 2069 7320  t('shortName is 
-00070b80: 4e6f 6e65 2729 0d0a 2020 2020 2020 2020  None')..        
-00070b90: 2020 2020 2020 2020 2020 2020 0d0a 2020              ..  
-00070ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070bb0: 2020 7072 696e 7428 2772 6563 6f72 6427    print('record'
-00070bc0: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
-00070bd0: 2020 2020 2020 2070 7269 6e74 2872 6563         print(rec
-00070be0: 6f72 6429 0d0a 2020 2020 2020 2020 2020  ord)..          
-00070bf0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00070c00: 2770 7265 765f 7265 636f 7264 2729 0d0a  'prev_record')..
-00070c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070c20: 2020 2020 7072 696e 7428 7072 6576 5f72      print(prev_r
-00070c30: 6563 6f72 6429 0d0a 0d0a 2020 2020 2020  ecord)....      
-00070c40: 2020 2020 2020 2020 2020 2020 2020 6173                as
-00070c50: 7365 7274 2020 7368 6f72 746e 616d 6520  sert  shortname 
-00070c60: 6973 206e 6f74 204e 6f6e 650d 0a20 2020  is not None..   
-00070c70: 2020 2020 2020 2020 2020 2020 2070 7265               pre
-00070c80: 765f 7265 636f 7264 3d72 6563 6f72 640d  v_record=record.
-00070c90: 0a0d 0a20 2020 2020 2020 2020 2020 2020  ...             
-00070ca0: 2020 2069 6620 6469 6d65 6e73 696f 6e2e     if dimension.
-00070cb0: 696e 6465 7820 213d 2031 3120 6f72 2073  index != 11 or s
-00070cc0: 7461 7274 5f64 6174 6520 6973 204e 6f6e  tart_date is Non
-00070cd0: 653a 0d0a 0d0a 2020 2020 2020 2020 2020  e:....          
-00070ce0: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
-00070cf0: 743d 2045 6c65 6d65 6e74 2873 686f 7274  t= Element(short
-00070d00: 6e61 6d65 3d73 686f 7274 6e61 6d65 0d0a  name=shortname..
-00070d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070d30: 2020 2020 2c6c 6f6e 676e 616d 653d 6c6f      ,longname=lo
-00070d40: 6e67 6e61 6d65 0d0a 2020 2020 2020 2020  ngname..        
+0006ec90: 2020 2020 202c 6469 6d65 6e73 696f 6e3d       ,dimension=
+0006eca0: 6469 6d65 6e73 696f 6e0d 0a20 2020 2020  dimension..     
+0006ecb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0006ecc0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0006ecd0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0006ece0: 2020 7374 7275 6374 7572 652e 6465 7363    structure.desc
+0006ecf0: 7269 7074 696f 6e20 3d20 6465 7363 7269  ription = descri
+0006ed00: 7074 696f 6e0d 0a20 2020 2020 2020 2020  ption..         
+0006ed10: 2020 2020 2020 2073 7472 7563 7475 7265         structure
+0006ed20: 2e5f 6578 6973 7473 5f69 6e5f 656d 706f  ._exists_in_empo
+0006ed30: 7765 7220 3d20 5472 7565 0d0a 2020 2020  wer = True..    
+0006ed40: 2020 2020 2020 2020 2020 2020 7374 7275              stru
+0006ed50: 6374 7572 655f 6c69 7374 2e61 7070 656e  cture_list.appen
+0006ed60: 6428 7374 7275 6374 7572 6529 0d0a 0d0a  d(structure)....
+0006ed70: 0d0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+0006ed80: 2045 7863 6570 7469 6f6e 3a0d 0a20 2020   Exception:..   
+0006ed90: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0006eda0: 4c69 6e65 206e 6f3a 2027 2b73 7472 2872  Line no: '+str(r
+0006edb0: 6561 6465 722e 6c69 6e65 5f6e 756d 2929  eader.line_num))
+0006edc0: 0d0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0006edd0: 6973 650d 0a0d 0a20 2020 2020 2020 2023  ise....        #
+0006ede0: 5468 6973 2069 7320 616e 206f 7070 6f72  This is an oppor
+0006edf0: 7475 6e69 7479 2074 6f20 7365 7420 7468  tunity to set th
+0006ee00: 6520 6469 6d65 6e73 696f 6e20 6c6f 6e67  e dimension long
+0006ee10: 6e61 6d65 2c20 7768 6963 6820 6973 6e27  name, which isn'
+0006ee20: 7420 6176 6169 6c61 626c 6520 7669 6120  t available via 
+0006ee30: 616e 2065 7870 6c69 6369 7420 656d 706f  an explicit empo
+0006ee40: 7765 7220 636f 6d6d 616e 640d 0a20 2020  wer command..   
+0006ee50: 2020 2020 2064 696d 656e 7369 6f6e 2e6c       dimension.l
+0006ee60: 6f6e 676e 616d 6520 3d20 6469 6d65 6e73  ongname = dimens
+0006ee70: 696f 6e5f 6c6f 6e67 6e61 6d65 0d0a 0d0a  ion_longname....
+0006ee80: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0006ee90: 7472 7563 7475 7265 5f6c 6973 740d 0a0d  tructure_list...
+0006eea0: 0a20 2020 206d 616a 6f72 5f76 6572 7369  .    major_versi
+0006eeb0: 6f6e 2c20 6d69 6e6f 725f 7665 7273 696f  on, minor_versio
+0006eec0: 6e2c 2072 656c 6561 7365 2c20 7265 6c65  n, release, rele
+0006eed0: 6173 655f 6e75 6d62 6572 203d 2064 696d  ase_number = dim
+0006eee0: 656e 7369 6f6e 2e73 6974 652e 696d 706f  ension.site.impo
+0006eef0: 7274 6572 5f76 6572 7369 6f6e 0d0a 2020  rter_version..  
+0006ef00: 2020 656e 636f 6469 6e67 3d27 616e 7369    encoding='ansi
+0006ef10: 270d 0a20 2020 2069 6620 286d 616a 6f72  '..    if (major
+0006ef20: 5f76 6572 7369 6f6e 203d 3d20 3920 616e  _version == 9 an
+0006ef30: 6420 286d 696e 6f72 5f76 6572 7369 6f6e  d (minor_version
+0006ef40: 203e 3d20 3829 2920 6f72 206d 616a 6f72   >= 8)) or major
+0006ef50: 5f76 6572 7369 6f6e 203e 2039 3a0d 0a20  _version > 9:.. 
+0006ef60: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
+0006ef70: 2275 7466 2d38 2d73 6967 220d 0a20 2020  "utf-8-sig"..   
+0006ef80: 2020 2020 200d 0a20 2020 2069 6620 6465       ..    if de
+0006ef90: 6275 673a 0d0a 2020 2020 2020 2020 2352  bug:..        #R
+0006efa0: 6561 6420 7468 6520 6461 7461 2066 726f  ead the data fro
+0006efb0: 6d20 6669 6c65 0d0a 2020 2020 2020 2020  m file..        
+0006efc0: 7769 7468 206f 7065 6e28 6578 706f 7274  with open(export
+0006efd0: 6564 5f73 7472 7563 7475 7265 735f 6c69  ed_structures_li
+0006efe0: 7374 5f66 696c 6570 6174 682c 6d6f 6465  st_filepath,mode
+0006eff0: 3d27 7227 2c65 6e63 6f64 696e 673d 656e  ='r',encoding=en
+0006f000: 636f 6469 6e67 2920 6173 2065 7870 6f72  coding) as expor
+0006f010: 7465 645f 7374 7275 6374 7572 6573 5f64  ted_structures_d
+0006f020: 6174 613a 0d0a 2020 2020 2020 2020 2020  ata:..          
+0006f030: 2020 2354 6865 2065 6c65 6d65 6e74 206c    #The element l
+0006f040: 6973 7420 7468 6174 2077 696c 6c20 6265  ist that will be
+0006f050: 2072 6574 7574 6e65 6420 2d20 7765 276c   retutned - we'l
+0006f060: 6c20 6164 6420 656c 656d 656e 7473 2074  l add elements t
+0006f070: 6f20 7468 6973 206c 6973 740d 0a20 2020  o this list..   
+0006f080: 2020 2020 2020 2020 2073 7472 7563 7475           structu
+0006f090: 7265 5f6c 6973 7420 3d20 5f72 6561 645f  re_list = _read_
+0006f0a0: 6578 706f 7274 6564 5f73 7472 7563 7475  exported_structu
+0006f0b0: 7265 735f 6461 7461 2865 7870 6f72 7465  res_data(exporte
+0006f0c0: 645f 7374 7275 6374 7572 6573 5f64 6174  d_structures_dat
+0006f0d0: 6129 0d0a 2020 2020 2020 2020 2020 2020  a)..            
+0006f0e0: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+0006f0f0: 2020 2020 2069 6d70 6f72 7420 696f 0d0a       import io..
+0006f100: 2020 2020 2020 2020 2344 6f20 6120 6675          #Do a fu
+0006f110: 6e6b 7920 476c 6167 6f6c 7974 6963 2072  nky Glagolytic r
+0006f120: 6570 6c61 6365 6d65 6e74 2074 6f20 6669  eplacement to fi
+0006f130: 7820 7175 6f74 696e 6720 6973 7375 6573  x quoting issues
+0006f140: 202d 2049 2063 686f 7365 2074 6865 206f   - I chose the o
+0006f150: 6e65 2074 6861 7420 6c6f 6f6b 7320 6c69  ne that looks li
+0006f160: 6b65 2061 206c 616d 700d 0a20 2020 2020  ke a lamp..     
+0006f170: 2020 2023 4966 2074 6865 7265 2061 7265     #If there are
+0006f180: 2072 6561 6c20 476c 6167 6f6c 7974 6963   real Glagolytic
+0006f190: 2063 6861 7261 6374 6572 7320 696e 2079   characters in y
+0006f1a0: 6f75 7220 6461 7461 2028 6869 6768 6c79  our data (highly
+0006f1b0: 2075 6e6c 696b 656c 7920 2d20 6974 2773   unlikely - it's
+0006f1c0: 2061 2076 6572 792c 2076 6572 7920 6465   a very, very de
+0006f1d0: 6164 206c 616e 6775 6167 6529 2074 6869  ad language) thi
+0006f1e0: 7320 636f 6465 2077 696c 6c20 6661 696c  s code will fail
+0006f1f0: 0d0a 2020 2020 2020 2020 2354 6865 2065  ..        #The e
+0006f200: 6c65 6d65 6e74 206c 6973 7420 7468 6174  lement list that
+0006f210: 2077 696c 6c20 6265 2072 6574 7574 6e65   will be retutne
+0006f220: 6420 2d20 7765 276c 6c20 6164 6420 656c  d - we'll add el
+0006f230: 656d 656e 7473 2074 6f20 7468 6973 206c  ements to this l
+0006f240: 6973 740d 0a20 2020 2020 2020 2073 7472  ist..        str
+0006f250: 7563 7475 7265 5f6c 6973 7420 3d20 5f72  ucture_list = _r
+0006f260: 6561 645f 6578 706f 7274 6564 5f73 7472  ead_exported_str
+0006f270: 7563 7475 7265 735f 6461 7461 2869 6f2e  uctures_data(io.
+0006f280: 5374 7269 6e67 494f 286f 7574 7075 742e  StringIO(output.
+0006f290: 7265 706c 6163 6528 2722 2227 2c27 e2b0  replace('""','..
+0006f2a0: a627 292e 7265 706c 6163 6528 2722 272c  .').replace('"',
+0006f2b0: 2727 292e 7265 706c 6163 6528 27e2 b0a6  '').replace('...
+0006f2c0: 272c 2722 2729 2929 0d0a 0d0a 2020 2020  ','"')))....    
+0006f2d0: 2341 7474 656d 7074 2074 6f20 6b65 6570  #Attempt to keep
+0006f2e0: 2074 6865 2073 616d 6520 6f62 6a65 6374   the same object
+0006f2f0: 2072 6566 6572 656e 6365 7320 666f 7220   references for 
+0006f300: 7072 6576 696f 7573 6c79 2075 7365 6420  previously used 
+0006f310: 656c 656d 656e 7473 0d0a 2020 2020 6966  elements..    if
+0006f320: 206f 6c64 5f73 7472 7563 7475 7265 7320   old_structures 
+0006f330: 6973 206e 6f74 204e 6f6e 653a 0d0a 2020  is not None:..  
+0006f340: 2020 2020 2020 666f 7220 7374 7275 6374        for struct
+0006f350: 7572 6520 696e 206f 6c64 5f73 7472 7563  ure in old_struc
+0006f360: 7475 7265 733a 0d0a 2020 2020 2020 2020  tures:..        
+0006f370: 2020 2020 7265 7475 726e 5f64 6963 745b      return_dict[
+0006f380: 7374 7275 6374 7572 652e 7368 6f72 746e  structure.shortn
+0006f390: 616d 655d 3d73 7472 7563 7475 7265 0d0a  ame]=structure..
+0006f3a0: 0d0a 2020 2020 666f 7220 7374 7275 6374  ..    for struct
+0006f3b0: 7572 6520 696e 2073 7472 7563 7475 7265  ure in structure
+0006f3c0: 5f6c 6973 743a 0d0a 2020 2020 2020 2020  _list:..        
+0006f3d0: 7472 793a 0d0a 2020 2020 2020 2020 2020  try:..          
+0006f3e0: 2020 2349 6620 7468 6520 7374 7275 6374    #If the struct
+0006f3f0: 7572 6520 616c 7265 6164 7920 6578 6973  ure already exis
+0006f400: 7473 2c20 7365 7420 7468 6520 7374 7275  ts, set the stru
+0006f410: 6374 7572 6573 2069 6e74 6572 6e61 6c73  ctures internals
+0006f420: 2074 6f20 6265 2074 6865 2073 616d 6520   to be the same 
+0006f430: 6173 2074 6865 206e 6577 2073 7472 7563  as the new struc
+0006f440: 7475 7265 2c20 6275 7420 6d61 6b65 2073  ture, but make s
+0006f450: 7572 6520 7765 206b 6565 7020 7468 650d  ure we keep the.
+0006f460: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0006f470: 7572 6e5f 6469 6374 5b73 7472 7563 7475  urn_dict[structu
+0006f480: 7265 2e73 686f 7274 6e61 6d65 5d2e 6c6f  re.shortname].lo
+0006f490: 6e67 6e61 6d65 2020 2020 3d20 7374 7275  ngname    = stru
+0006f4a0: 6374 7572 652e 6c6f 6e67 6e61 6d65 0d0a  cture.longname..
+0006f4b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0006f4c0: 726e 5f64 6963 745b 7374 7275 6374 7572  rn_dict[structur
+0006f4d0: 652e 7368 6f72 746e 616d 655d 2e64 6573  e.shortname].des
+0006f4e0: 6372 6970 7469 6f6e 203d 2073 7472 7563  cription = struc
+0006f4f0: 7475 7265 2e64 6573 6372 6970 7469 6f6e  ture.description
+0006f500: 0d0a 0d0a 2020 2020 2020 2020 6578 6365  ....        exce
+0006f510: 7074 204b 6579 4572 726f 723a 0d0a 2020  pt KeyError:..  
+0006f520: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0006f530: 5f64 6963 745b 7374 7275 6374 7572 652e  _dict[structure.
+0006f540: 7368 6f72 746e 616d 655d 3d73 7472 7563  shortname]=struc
+0006f550: 7475 7265 0d0a 0d0a 2020 2020 7265 7475  ture....    retu
+0006f560: 726e 2072 6574 7572 6e5f 6469 6374 0d0a  rn return_dict..
+0006f570: 0d0a 0d0a 6465 6620 5f63 7265 6174 655f  ....def _create_
+0006f580: 656d 706f 7765 725f 6469 6d65 6e73 696f  empower_dimensio
+0006f590: 6e5f 656c 656d 656e 745f 6c69 7374 2864  n_element_list(d
+0006f5a0: 696d 656e 7369 6f6e 2c64 6562 7567 3d46  imension,debug=F
+0006f5b0: 616c 7365 293a 0d0a 2020 2020 2727 2743  alse):..    '''C
+0006f5c0: 7265 6174 6520 6120 6c69 7374 206f 6620  reate a list of 
+0006f5d0: 456d 706f 7765 7220 656c 656d 656e 7473  Empower elements
+0006f5e0: 2c20 666f 7220 6120 6769 7665 6e20 6469  , for a given di
+0006f5f0: 6d65 6e73 696f 6e0d 0a20 2020 2054 6865  mension..    The
+0006f600: 2065 6c65 6d65 6e74 7320 7769 6c6c 2062   elements will b
+0006f610: 6520 6f66 2074 7970 6520 456c 656d 656e  e of type Elemen
+0006f620: 742c 2061 2063 6c61 7373 2069 6e20 7468  t, a class in th
+0006f630: 6973 206d 6f64 756c 652e 0d0a 0d0a 2020  is module.....  
+0006f640: 2020 3a70 6172 616d 2064 696d 656e 7369    :param dimensi
+0006f650: 6f6e 3a20 4120 7079 6d70 7820 4469 6d65  on: A pympx Dime
+0006f660: 6e73 696f 6e20 6f62 6a65 6374 0d0a 2020  nsion object..  
+0006f670: 2020 3a70 6172 616d 2064 6562 7567 3a20    :param debug: 
+0006f680: 5772 6974 6520 656c 656d 656e 7473 2074  Write elements t
+0006f690: 6f20 6669 6c65 2c20 746f 2061 6964 2077  o file, to aid w
+0006f6a0: 6974 6820 6465 6275 6767 696e 670d 0a20  ith debugging.. 
+0006f6b0: 2020 2027 2727 0d0a 0d0a 2020 2020 2348     '''....    #H
+0006f6c0: 656c 7065 7220 6675 6e63 7469 6f6e 2074  elper function t
+0006f6d0: 6f20 636f 6e76 6572 7420 7374 7269 6e67  o convert string
+0006f6e0: 7320 636f 7272 6563 746c 790d 0a20 2020  s correctly..   
+0006f6f0: 2064 6566 2063 6f6e 7665 7274 5f73 7472   def convert_str
+0006f700: 696e 6728 7329 3a0d 0a20 2020 2020 2020  ing(s):..       
+0006f710: 2023 7072 696e 7428 2763 6f6e 7665 7274   #print('convert
+0006f720: 696e 6720 7374 7269 6e67 272c 7329 0d0a  ing string',s)..
+0006f730: 2020 2020 2020 2020 6966 2073 203d 3d20          if s == 
+0006f740: 2727 3a0d 0a20 2020 2020 2020 2020 2020  '':..           
+0006f750: 2072 6574 7572 6e20 4e6f 6e65 0d0a 2020   return None..  
+0006f760: 2020 2020 2020 656c 7365 3a0d 0a20 2020        else:..   
+0006f770: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0006f780: 730d 0a0d 0a20 2020 2023 5468 6520 656c  s....    #The el
+0006f790: 656d 656e 7420 6c69 7374 2074 6861 7420  ement list that 
+0006f7a0: 7769 6c6c 2062 6520 7265 7475 726e 6564  will be returned
+0006f7b0: 202d 2077 6527 6c6c 2061 6464 2065 6c65   - we'll add ele
+0006f7c0: 6d65 6e74 7320 746f 2074 6869 7320 6c69  ments to this li
+0006f7d0: 7374 0d0a 2020 2020 656c 656d 656e 745f  st..    element_
+0006f7e0: 6c69 7374 3d5b 5d0d 0a0d 0a20 2020 2023  list=[]....    #
+0006f7f0: 4578 706f 7274 2074 6865 2064 696d 656e  Export the dimen
+0006f800: 7369 6f6e 2066 726f 6d20 456d 706f 7765  sion from Empowe
+0006f810: 720d 0a20 2020 2023 4d61 6b65 2074 6865  r..    #Make the
+0006f820: 2064 6972 6563 746f 7269 6573 2069 6620   directories if 
+0006f830: 696e 2064 6562 7567 206d 6f64 650d 0a20  in debug mode.. 
+0006f840: 2020 2069 6620 6465 6275 673a 0d0a 2020     if debug:..  
+0006f850: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+0006f860: 2020 2020 2020 2020 6f73 2e6d 616b 6564          os.maked
+0006f870: 6972 7328 6469 6d65 6e73 696f 6e2e 7369  irs(dimension.si
+0006f880: 7465 2e5f 656d 706f 7765 725f 6578 706f  te._empower_expo
+0006f890: 7274 5f64 6174 615f 6469 7229 0d0a 2020  rt_data_dir)..  
+0006f8a0: 2020 2020 2020 6578 6365 7074 2046 696c        except Fil
+0006f8b0: 6545 7869 7374 7345 7272 6f72 3a0d 0a20  eExistsError:.. 
+0006f8c0: 2020 2020 2020 2020 2020 2070 6173 730d             pass.
+0006f8d0: 0a0d 0a20 2020 2064 696d 5f69 6e64 6578  ...    dim_index
+0006f8e0: 203d 696e 7428 6469 6d65 6e73 696f 6e2e   =int(dimension.
+0006f8f0: 696e 6465 7829 0d0a 0d0a 2020 2020 6c6f  index)....    lo
+0006f900: 672e 7665 7262 6f73 6528 2022 5275 6e6e  g.verbose( "Runn
+0006f910: 696e 6720 494d 504f 5254 4552 3a20 6672  ing IMPORTER: fr
+0006f920: 6f6d 203c 7374 6469 6e3e 2074 6f20 6578  om <stdin> to ex
+0006f930: 706f 7274 2074 6865 2045 6d70 6f77 6572  port the Empower
+0006f940: 2053 6974 6520 6469 6d65 6e73 696f 6e20   Site dimension 
+0006f950: 7b7d 2066 726f 6d20 7b7d 222e 666f 726d  {} from {}".form
+0006f960: 6174 2864 696d 5f69 6e64 6578 2c20 6469  at(dim_index, di
+0006f970: 6d65 6e73 696f 6e2e 7369 7465 2e5f 7369  mension.site._si
+0006f980: 7465 5f6c 6f63 6174 6f72 2929 0d0a 0d0a  te_locator))....
+0006f990: 2020 2020 636f 6d6d 616e 645f 6c69 7374      command_list
+0006f9a0: 203d 2064 696d 656e 7369 6f6e 2e73 6974   = dimension.sit
+0006f9b0: 652e 5f6c 6f67 6f6e 5f70 6172 616d 6574  e._logon_paramet
+0006f9c0: 6572 5f69 6d70 6f72 7465 725f 636f 6d6d  er_importer_comm
+0006f9d0: 616e 6473 202b 205c 0d0a 2020 2020 2020  ands + \..      
+0006f9e0: 2020 2020 2020 2020 2020 2020 205b 2773               ['s
+0006f9f0: 6574 2d70 6172 616d 6574 6572 2074 6172  et-parameter tar
+0006fa00: 6765 743d 2720 2020 2020 2020 2020 2020  get='           
+0006fa10: 202b 6f73 2e70 6174 682e 6162 7370 6174   +os.path.abspat
+0006fa20: 6828 6469 6d65 6e73 696f 6e2e 7369 7465  h(dimension.site
+0006fa30: 2e5f 656d 706f 7765 725f 6578 706f 7274  ._empower_export
+0006fa40: 5f64 6174 615f 6469 7229 0d0a 2020 2020  _data_dir)..    
+0006fa50: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+0006fa60: 2773 6574 2d70 6172 616d 6574 6572 2064  'set-parameter d
+0006fa70: 696d 656e 7369 6f6e 5f69 6e64 6578 3d27  imension_index='
+0006fa80: 2020 202b 7374 7228 6469 6d5f 696e 6465     +str(dim_inde
+0006fa90: 7829 0d0a 2020 2020 2020 2020 2020 2020  x)..            
+0006faa0: 2020 2020 2020 202c 2765 6d70 6f77 6572         ,'empower
+0006fab0: 2d65 7870 6f72 742d 656c 656d 656e 7473  -export-elements
+0006fac0: 2022 247b 7369 7465 7d22 2022 247b 7573   "${site}" "${us
+0006fad0: 6572 7d22 2022 247b 7061 7373 776f 7264  er}" "${password
+0006fae0: 7d22 2024 7b64 696d 656e 7369 6f6e 5f69  }" ${dimension_i
+0006faf0: 6e64 6578 7d27 0d0a 2020 2020 2020 2020  ndex}'..        
+0006fb00: 2020 2020 2020 2020 2020 202c 2774 7376             ,'tsv
+0006fb10: 2d65 6e63 6f64 6527 0d0a 2020 2020 2020  -encode'..      
+0006fb20: 2020 2020 2020 2020 2020 2020 205d 0d0a               ]..
+0006fb30: 0d0a 2020 2020 6966 2064 6562 7567 3a0d  ..    if debug:.
+0006fb40: 0a20 2020 2020 2020 2063 6f6d 6d61 6e64  .        command
+0006fb50: 5f6c 6973 7420 2b3d 205b 2773 6176 652d  _list += ['save-
+0006fb60: 6669 6c65 2022 247b 7461 7267 6574 7d5c  file "${target}\
+0006fb70: 4469 6d65 6e73 696f 6e5f 247b 6469 6d65  Dimension_${dime
+0006fb80: 6e73 696f 6e5f 696e 6465 787d 2e74 7376  nsion_index}.tsv
+0006fb90: 2227 5d0d 0a20 2020 2020 2020 206c 6c75  "']..        llu
+0006fba0: 2e72 756e 5f73 696e 676c 655f 6f75 7470  .run_single_outp
+0006fbb0: 7574 5f69 6d70 6f72 7465 725f 636f 6d6d  ut_importer_comm
+0006fbc0: 616e 6473 2863 6f6d 6d61 6e64 5f6c 6973  ands(command_lis
+0006fbd0: 742c 656d 706f 7765 725f 696d 706f 7274  t,empower_import
+0006fbe0: 6572 5f65 7865 6375 7461 626c 653d 6469  er_executable=di
+0006fbf0: 6d65 6e73 696f 6e2e 7369 7465 2e65 6d70  mension.site.emp
+0006fc00: 6f77 6572 5f69 6d70 6f72 7465 725f 6578  ower_importer_ex
+0006fc10: 6563 7574 6162 6c65 290d 0a20 2020 2065  ecutable)..    e
+0006fc20: 6c73 653a 0d0a 2020 2020 2020 2020 636f  lse:..        co
+0006fc30: 6d6d 616e 645f 6c69 7374 202b 3d20 5b27  mmand_list += ['
+0006fc40: 6f75 7470 7574 275d 0d0a 0d0a 2020 2020  output']....    
+0006fc50: 2020 2020 6f75 7470 7574 203d 206c 6c75      output = llu
+0006fc60: 2e72 756e 5f73 696e 676c 655f 6f75 7470  .run_single_outp
+0006fc70: 7574 5f69 6d70 6f72 7465 725f 636f 6d6d  ut_importer_comm
+0006fc80: 616e 6473 2863 6f6d 6d61 6e64 5f6c 6973  ands(command_lis
+0006fc90: 742c 656d 706f 7765 725f 696d 706f 7274  t,empower_import
+0006fca0: 6572 5f65 7865 6375 7461 626c 653d 6469  er_executable=di
+0006fcb0: 6d65 6e73 696f 6e2e 7369 7465 2e65 6d70  mension.site.emp
+0006fcc0: 6f77 6572 5f69 6d70 6f72 7465 725f 6578  ower_importer_ex
+0006fcd0: 6563 7574 6162 6c65 290d 0a0d 0a20 2020  ecutable)....   
+0006fce0: 2064 6566 205f 7265 6164 5f65 7870 6f72   def _read_expor
+0006fcf0: 7465 645f 6469 6d65 6e73 696f 6e5f 6461  ted_dimension_da
+0006fd00: 7461 2865 7870 6f72 7465 645f 6469 6d65  ta(exported_dime
+0006fd10: 6e73 696f 6e5f 6461 7461 293a 0d0a 2020  nsion_data):..  
+0006fd20: 2020 2020 2020 7265 6164 6572 3d63 7376        reader=csv
+0006fd30: 2e44 6963 7452 6561 6465 7228 6578 706f  .DictReader(expo
+0006fd40: 7274 6564 5f64 696d 656e 7369 6f6e 5f64  rted_dimension_d
+0006fd50: 6174 612c 6465 6c69 6d69 7465 723d 275c  ata,delimiter='\
+0006fd60: 7427 290d 0a0d 0a20 2020 2020 2020 2066  t')....        f
+0006fd70: 6f72 2066 6965 6c64 5f6e 616d 6520 696e  or field_name in
+0006fd80: 2072 6561 6465 722e 6669 656c 646e 616d   reader.fieldnam
+0006fd90: 6573 3a0d 0a20 2020 2020 2020 2020 2020  es:..           
+0006fda0: 2069 6620 6669 656c 645f 6e61 6d65 2021   if field_name !
+0006fdb0: 3d20 2749 4427 2061 6e64 2064 696d 656e  = 'ID' and dimen
+0006fdc0: 7369 6f6e 2069 7320 6e6f 7420 4e6f 6e65  sion is not None
+0006fdd0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+0006fde0: 2020 2064 696d 656e 7369 6f6e 2e66 6965     dimension.fie
+0006fdf0: 6c64 732e 5f61 6464 5f66 6965 6c64 5f6e  lds._add_field_n
+0006fe00: 616d 6528 6669 656c 645f 6e61 6d65 2c66  ame(field_name,f
+0006fe10: 726f 6d5f 656d 706f 7765 723d 5472 7565  rom_empower=True
+0006fe20: 290d 0a0d 0a20 2020 2020 2020 2074 7279  )....        try
+0006fe30: 3a0d 0a20 2020 2020 2020 2020 2020 2070  :..            p
+0006fe40: 7265 765f 7265 636f 7264 203d 205b 5d0d  rev_record = [].
+0006fe50: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0006fe60: 2072 6563 6f72 6420 696e 2072 6561 6465   record in reade
+0006fe70: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+0006fe80: 2020 2020 6669 656c 6473 3d7b 7d0d 0a0d      fields={}...
+0006fe90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0006fea0: 2023 5468 6973 2069 7320 616e 206f 6464   #This is an odd
+0006feb0: 2077 6179 2074 6f20 6465 616c 2077 6974   way to deal wit
+0006fec0: 6820 6120 6469 6374 696f 6e61 7279 202d  h a dictionary -
+0006fed0: 2062 6173 6963 6c79 2077 6520 7761 6e74   basicly we want
+0006fee0: 2074 6f20 7075 7420 7468 6520 6c65 6674   to put the left
+0006fef0: 6f76 6572 7320 696e 746f 2066 6965 6c64  overs into field
+0006ff00: 732c 0d0a 2020 2020 2020 2020 2020 2020  s,..            
+0006ff10: 2020 2020 2361 6674 6572 2077 6527 7665      #after we've
+0006ff20: 2073 6372 6170 6564 206f 7574 2074 6865   scraped out the
+0006ff30: 2070 6172 7473 206f 6620 7468 6520 656c   parts of the el
+0006ff40: 656d 656e 7420 7468 6174 2061 7265 2061  ement that are a
+0006ff50: 6c77 6179 7320 7072 6573 656e 740d 0a20  lways present.. 
+0006ff60: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0006ff70: 536f 2077 6520 6974 6572 6174 6520 6f76  So we iterate ov
+0006ff80: 6572 2074 6865 2064 6963 7469 6f6e 6172  er the dictionar
+0006ff90: 792c 2073 6565 696e 6720 6966 2074 6865  y, seeing if the
+0006ffa0: 2065 6e74 7279 2069 7320 736f 6d65 7468   entry is someth
+0006ffb0: 696e 6720 7468 6174 2069 7320 676f 696e  ing that is goin
+0006ffc0: 6720 696e 746f 2074 6865 2045 6c65 6d65  g into the Eleme
+0006ffd0: 6e74 2063 6f6e 7374 7275 6374 6f72 2028  nt constructor (
+0006ffe0: 692e 652e 2074 6865 205f 5f69 6e69 745f  i.e. the __init_
+0006fff0: 5f20 6675 6e63 7469 6f6e 290d 0a20 2020  _ function)..   
+00070000: 2020 2020 2020 2020 2020 2020 2023 4f72               #Or
+00070010: 2069 6620 7468 6520 6469 6374 696f 6e61   if the dictiona
+00070020: 7279 2065 6e74 7279 2069 7320 676f 696e  ry entry is goin
+00070030: 6720 746f 2065 6e64 2075 7020 696e 2045  g to end up in E
+00070040: 6c65 6d65 6e74 2e66 6965 6c64 730d 0a0d  lement.fields...
+00070050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00070060: 2070 6879 7369 643d 4e6f 6e65 0d0a 2020   physid=None..  
+00070070: 2020 2020 2020 2020 2020 2020 2020 7368                sh
+00070080: 6f72 746e 616d 653d 4e6f 6e65 0d0a 2020  ortname=None..  
+00070090: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+000700a0: 6e67 6e61 6d65 3d4e 6f6e 650d 0a20 2020  ngname=None..   
+000700b0: 2020 2020 2020 2020 2020 2020 2064 6573               des
+000700c0: 6372 6970 7469 6f6e 3d4e 6f6e 650d 0a20  cription=None.. 
+000700d0: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+000700e0: 726f 7570 5f6f 6e6c 793d 4e6f 6e65 0d0a  roup_only=None..
+000700f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070100: 6361 6c63 756c 6174 696f 6e5f 7374 6174  calculation_stat
+00070110: 7573 3d4e 6f6e 650d 0a20 2020 2020 2020  us=None..       
+00070120: 2020 2020 2020 2020 2063 616c 6375 6c61           calcula
+00070130: 7469 6f6e 3d4e 6f6e 650d 0a20 2020 2020  tion=None..     
+00070140: 2020 2020 2020 2020 2020 2063 6f6c 6f75             colou
+00070150: 723d 4e6f 6e65 0d0a 2020 2020 2020 2020  r=None..        
+00070160: 2020 2020 2020 2020 6d65 6173 7572 653d          measure=
+00070170: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+00070180: 2020 2020 2020 7374 6172 745f 6461 7465        start_date
+00070190: 3d4e 6f6e 650d 0a20 2020 2020 2020 2020  =None..         
+000701a0: 2020 2020 2020 2069 6e74 6572 7661 6c3d         interval=
+000701b0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+000701c0: 2020 2020 2020 696e 7465 7276 616c 5f61        interval_a
+000701d0: 6d6f 756e 743d 4e6f 6e65 0d0a 2020 2020  mount=None..    
+000701e0: 2020 2020 2020 2020 2020 2020 6f66 6673              offs
+000701f0: 6574 3d4e 6f6e 650d 0a20 2020 2020 2020  et=None..       
+00070200: 2020 2020 2020 2020 2072 6573 6f6c 7574           resolut
+00070210: 696f 6e3d 4e6f 6e65 0d0a 0d0a 2020 2020  ion=None....    
+00070220: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00070230: 6b65 792c 2076 616c 7565 2069 6e20 7265  key, value in re
+00070240: 636f 7264 2e69 7465 6d73 2829 3a0d 0a0d  cord.items():...
+00070250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00070260: 2020 2020 2069 6620 2020 6b65 793d 3d27       if   key=='
+00070270: 4944 273a 0d0a 2020 2020 2020 2020 2020  ID':..          
+00070280: 2020 2020 2020 2020 2020 2020 2020 7068                ph
+00070290: 7973 6964 3d69 6e74 2876 616c 7565 290d  ysid=int(value).
+000702a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000702b0: 2020 2020 2020 2020 2023 7072 696e 7428           #print(
+000702c0: 2749 4427 2c6b 6579 2c76 616c 7565 290d  'ID',key,value).
+000702d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000702e0: 2020 2020 2065 6c69 6620 6b65 793d 3d27       elif key=='
+000702f0: 5368 6f72 7420 4e61 6d65 273a 0d0a 2020  Short Name':..  
+00070300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070310: 2020 2020 2020 7368 6f72 746e 616d 653d        shortname=
+00070320: 636f 6e76 6572 745f 7374 7269 6e67 2876  convert_string(v
+00070330: 616c 7565 290d 0a20 2020 2020 2020 2020  alue)..         
+00070340: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00070350: 6966 2027 7e54 4523 4d50 7e27 2069 6e20  if '~TE#MP~' in 
+00070360: 7368 6f72 746e 616d 653a 0d0a 2020 2020  shortname:..    
+00070370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070380: 2020 2020 2320 2020 2073 686f 7274 6e61      #    shortna
+00070390: 6d65 3d73 686f 7274 6e61 6d65 5b37 3a5d  me=shortname[7:]
+000703a0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000703b0: 2020 2020 2020 2020 2020 2370 7269 6e74            #print
+000703c0: 2827 5368 6f72 742d 4e61 6d65 272c 6b65  ('Short-Name',ke
+000703d0: 792c 7661 6c75 652c 7368 6f72 746e 616d  y,value,shortnam
+000703e0: 6529 0d0a 2020 2020 2020 2020 2020 2020  e)..            
+000703f0: 2020 2020 2020 2020 656c 6966 206b 6579          elif key
+00070400: 3d3d 274c 6f6e 6720 4e61 6d65 273a 0d0a  =='Long Name':..
+00070410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070420: 2020 2020 2020 2020 6c6f 6e67 6e61 6d65          longname
+00070430: 3d63 6f6e 7665 7274 5f73 7472 696e 6728  =convert_string(
+00070440: 7661 6c75 6529 2020 2020 2020 2020 2020  value)          
+00070450: 2020 2020 2020 2020 2020 2020 2020 0d0a                ..
+00070460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070470: 2020 2020 2020 2020 2370 7269 6e74 2827          #print('
+00070480: 4c6f 6e67 2d4e 616d 6527 2c6b 6579 2c76  Long-Name',key,v
+00070490: 616c 7565 2c6c 6f6e 676e 616d 6529 0d0a  alue,longname)..
+000704a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000704b0: 2020 2020 656c 6966 206b 6579 3d3d 2744      elif key=='D
+000704c0: 6573 6372 6970 7469 6f6e 273a 0d0a 2020  escription':..  
+000704d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000704e0: 2020 2020 2020 6465 7363 7269 7074 696f        descriptio
+000704f0: 6e20 3d63 6f6e 7665 7274 5f73 7472 696e  n =convert_strin
+00070500: 6728 7661 6c75 6529 0d0a 2020 2020 2020  g(value)..      
+00070510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070520: 2020 2370 7269 6e74 2827 4465 7363 7269    #print('Descri
+00070530: 7074 696f 6e27 2c6b 6579 2c76 616c 7565  ption',key,value
+00070540: 290d 0a20 2020 2020 2020 2020 2020 2020  )..             
+00070550: 2020 2020 2020 2065 6c69 6620 6b65 793d         elif key=
+00070560: 3d27 4772 6f75 7020 4f6e 6c79 273a 0d0a  ='Group Only':..
+00070570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070580: 2020 2020 2020 2020 6772 6f75 705f 6f6e          group_on
+00070590: 6c79 3d63 6f6e 7665 7274 5f73 7472 696e  ly=convert_strin
+000705a0: 6728 7661 6c75 6529 0d0a 2020 2020 2020  g(value)..      
+000705b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000705c0: 2020 2370 7269 6e74 2827 4772 6f75 7020    #print('Group 
+000705d0: 4f6e 6c79 272c 6b65 792c 7661 6c75 6529  Only',key,value)
+000705e0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000705f0: 2020 2020 2020 656c 6966 206b 6579 3d3d        elif key==
+00070600: 2743 616c 6375 6c61 7469 6f6e 2053 7461  'Calculation Sta
+00070610: 7475 7327 3a0d 0a20 2020 2020 2020 2020  tus':..         
+00070620: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00070630: 616c 6375 6c61 7469 6f6e 5f73 7461 7475  alculation_statu
+00070640: 733d 636f 6e76 6572 745f 7374 7269 6e67  s=convert_string
+00070650: 2876 616c 7565 290d 0a20 2020 2020 2020  (value)..       
+00070660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070670: 2023 7072 696e 7428 2743 616c 6375 6c61   #print('Calcula
+00070680: 7469 6f6e 2053 7461 7475 7327 2c6b 6579  tion Status',key
+00070690: 2c76 616c 7565 290d 0a20 2020 2020 2020  ,value)..       
+000706a0: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
+000706b0: 6620 6b65 793d 3d27 4361 6c63 756c 6174  f key=='Calculat
+000706c0: 696f 6e27 3a0d 0a20 2020 2020 2020 2020  ion':..         
+000706d0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000706e0: 616c 6375 6c61 7469 6f6e 3d63 6f6e 7665  alculation=conve
+000706f0: 7274 5f73 7472 696e 6728 7661 6c75 6529  rt_string(value)
+00070700: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00070710: 2020 2020 2020 2020 2020 2370 7269 6e74            #print
+00070720: 2827 4361 6c63 756c 6174 696f 6e27 2c6b  ('Calculation',k
+00070730: 6579 2c76 616c 7565 290d 0a20 2020 2020  ey,value)..     
+00070740: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00070750: 6c69 6620 6b65 793d 3d27 436f 6c6f 7572  lif key=='Colour
+00070760: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+00070770: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
+00070780: 7572 3d63 6f6e 7665 7274 5f73 7472 696e  ur=convert_strin
+00070790: 6728 7661 6c75 6529 0d0a 2020 2020 2020  g(value)..      
+000707a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000707b0: 2020 2370 7269 6e74 2827 436f 6c6f 7572    #print('Colour
+000707c0: 272c 6b65 792c 7661 6c75 6529 0d0a 2020  ',key,value)..  
+000707d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000707e0: 2020 656c 6966 206b 6579 3d3d 274d 6561    elif key=='Mea
+000707f0: 7375 7265 2045 6c65 6d65 6e74 273a 0d0a  sure Element':..
+00070800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070810: 2020 2020 2020 2020 6d65 6173 7572 653d          measure=
+00070820: 636f 6e76 6572 745f 7374 7269 6e67 2876  convert_string(v
+00070830: 616c 7565 290d 0a20 2020 2020 2020 2020  alue)..         
+00070840: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00070850: 6469 6d65 6e73 696f 6e2e 696e 6465 783d  dimension.index=
+00070860: 3d31 3120 616e 6420 6b65 793d 3d27 5374  =11 and key=='St
+00070870: 6172 7420 4461 7465 273a 0d0a 2020 2020  art Date':..    
+00070880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070890: 2020 2020 7374 6172 745f 6461 7465 3d63      start_date=c
+000708a0: 6f6e 7665 7274 5f73 7472 696e 6728 7661  onvert_string(va
+000708b0: 6c75 6529 0d0a 2020 2020 2020 2020 2020  lue)..          
+000708c0: 2020 2020 2020 2020 2020 656c 6966 2064            elif d
+000708d0: 696d 656e 7369 6f6e 2e69 6e64 6578 3d3d  imension.index==
+000708e0: 3131 2061 6e64 206b 6579 3d3d 2749 6e74  11 and key=='Int
+000708f0: 6572 7661 6c27 3a0d 0a20 2020 2020 2020  erval':..       
+00070900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070910: 2069 6e74 6572 7661 6c3d 636f 6e76 6572   interval=conver
+00070920: 745f 7374 7269 6e67 2876 616c 7565 290d  t_string(value).
+00070930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00070940: 2020 2020 2065 6c69 6620 6469 6d65 6e73       elif dimens
+00070950: 696f 6e2e 696e 6465 783d 3d31 3120 616e  ion.index==11 an
+00070960: 6420 6b65 793d 3d27 496e 7465 7276 616c  d key=='Interval
+00070970: 2041 6d6f 756e 7427 3a0d 0a20 2020 2020   Amount':..     
+00070980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070990: 2020 2069 6e74 6572 7661 6c5f 616d 6f75     interval_amou
+000709a0: 6e74 3d63 6f6e 7665 7274 5f73 7472 696e  nt=convert_strin
+000709b0: 6728 7661 6c75 6529 0d0a 2020 2020 2020  g(value)..      
+000709c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000709d0: 6966 2064 696d 656e 7369 6f6e 2e69 6e64  if dimension.ind
+000709e0: 6578 3d3d 3131 2061 6e64 206b 6579 3d3d  ex==11 and key==
+000709f0: 274f 6666 7365 7427 3a0d 0a20 2020 2020  'Offset':..     
+00070a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070a10: 2020 206f 6666 7365 743d 636f 6e76 6572     offset=conver
+00070a20: 745f 7374 7269 6e67 2876 616c 7565 290d  t_string(value).
+00070a30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00070a40: 2020 2020 2065 6c69 6620 6469 6d65 6e73       elif dimens
+00070a50: 696f 6e2e 696e 6465 783d 3d31 3120 616e  ion.index==11 an
+00070a60: 6420 6b65 793d 3d27 5265 736f 6c75 7469  d key=='Resoluti
+00070a70: 6f6e 273a 0d0a 2020 2020 2020 2020 2020  on':..          
+00070a80: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00070a90: 736f 6c75 7469 6f6e 3d63 6f6e 7665 7274  solution=convert
+00070aa0: 5f73 7472 696e 6728 7661 6c75 6529 0d0a  _string(value)..
+00070ab0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00070ac0: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
+00070ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070ae0: 2020 2020 2020 2066 6965 6c64 735b 6b65         fields[ke
+00070af0: 795d 3d63 6f6e 7665 7274 5f73 7472 696e  y]=convert_strin
+00070b00: 6728 7661 6c75 6529 0d0a 2020 2020 2020  g(value)..      
+00070b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070b20: 2020 2370 7269 6e74 2827 6669 656c 6473    #print('fields
+00070b30: 5b6b 6579 5d3d 7661 6c75 6527 2c6b 6579  [key]=value',key
+00070b40: 2c76 616c 7565 290d 0a20 2020 2020 2020  ,value)..       
+00070b50: 2020 2020 2020 2020 2020 200d 0a20 2020             ..   
+00070b60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00070b70: 7368 6f72 746e 616d 6520 6973 204e 6f6e  shortname is Non
+00070b80: 653a 0d0a 2020 2020 2020 2020 2020 2020  e:..            
+00070b90: 2020 2020 2020 2020 7072 696e 7428 2773          print('s
+00070ba0: 686f 7274 4e61 6d65 2069 7320 4e6f 6e65  hortName is None
+00070bb0: 2729 0d0a 2020 2020 2020 2020 2020 2020  ')..            
+00070bc0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00070bd0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00070be0: 696e 7428 2772 6563 6f72 6427 290d 0a20  int('record').. 
+00070bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070c00: 2020 2070 7269 6e74 2872 6563 6f72 6429     print(record)
+00070c10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00070c20: 2020 2020 2020 7072 696e 7428 2770 7265        print('pre
+00070c30: 765f 7265 636f 7264 2729 0d0a 2020 2020  v_record')..    
+00070c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070c50: 7072 696e 7428 7072 6576 5f72 6563 6f72  print(prev_recor
+00070c60: 6429 0d0a 0d0a 2020 2020 2020 2020 2020  d)....          
+00070c70: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00070c80: 2020 7368 6f72 746e 616d 6520 6973 206e    shortname is n
+00070c90: 6f74 204e 6f6e 650d 0a20 2020 2020 2020  ot None..       
+00070ca0: 2020 2020 2020 2020 2070 7265 765f 7265           prev_re
+00070cb0: 636f 7264 3d72 6563 6f72 640d 0a0d 0a20  cord=record.... 
+00070cc0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00070cd0: 6620 6469 6d65 6e73 696f 6e2e 696e 6465  f dimension.inde
+00070ce0: 7820 213d 2031 3120 6f72 2073 7461 7274  x != 11 or start
+00070cf0: 5f64 6174 6520 6973 204e 6f6e 653a 0d0a  _date is None:..
+00070d00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00070d10: 2020 2020 2020 656c 656d 656e 743d 2045        element= E
+00070d20: 6c65 6d65 6e74 2873 686f 7274 6e61 6d65  lement(shortname
+00070d30: 3d73 686f 7274 6e61 6d65 0d0a 2020 2020  =shortname..    
+00070d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00070d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070d60: 2020 2020 2020 2020 2020 2020 2c64 6573              ,des
-00070d70: 6372 6970 7469 6f6e 3d64 6573 6372 6970  cription=descrip
-00070d80: 7469 6f6e 0d0a 2020 2020 2020 2020 2020  tion..          
-00070d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070da0: 2020 2020 2020 2020 2020 2c70 6879 7369            ,physi
-00070db0: 643d 7068 7973 6964 0d0a 2020 2020 2020  d=physid..      
+00070d60: 2c6c 6f6e 676e 616d 653d 6c6f 6e67 6e61  ,longname=longna
+00070d70: 6d65 0d0a 2020 2020 2020 2020 2020 2020  me..            
+00070d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070d90: 2020 2020 2020 2020 2c64 6573 6372 6970          ,descrip
+00070da0: 7469 6f6e 3d64 6573 6372 6970 7469 6f6e  tion=description
+00070db0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
 00070dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070dd0: 2020 2020 2020 2020 2020 2020 2020 2c67                ,g
-00070de0: 726f 7570 5f6f 6e6c 793d 6772 6f75 705f  roup_only=group_
-00070df0: 6f6e 6c79 0d0a 2020 2020 2020 2020 2020  only..          
-00070e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070e10: 2020 2020 2020 2020 2020 2c63 616c 6375            ,calcu
-00070e20: 6c61 7469 6f6e 5f73 7461 7475 733d 6361  lation_status=ca
-00070e30: 6c63 756c 6174 696f 6e5f 7374 6174 7573  lculation_status
-00070e40: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00070e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070e60: 2020 2020 2020 2c63 616c 6375 6c61 7469        ,calculati
-00070e70: 6f6e 3d63 616c 6375 6c61 7469 6f6e 0d0a  on=calculation..
+00070dd0: 2020 2020 2020 2c70 6879 7369 643d 7068        ,physid=ph
+00070de0: 7973 6964 0d0a 2020 2020 2020 2020 2020  ysid..          
+00070df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070e00: 2020 2020 2020 2020 2020 2c67 726f 7570            ,group
+00070e10: 5f6f 6e6c 793d 6772 6f75 705f 6f6e 6c79  _only=group_only
+00070e20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00070e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070e40: 2020 2020 2020 2c63 616c 6375 6c61 7469        ,calculati
+00070e50: 6f6e 5f73 7461 7475 733d 6361 6c63 756c  on_status=calcul
+00070e60: 6174 696f 6e5f 7374 6174 7573 0d0a 2020  ation_status..  
+00070e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00070e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070ea0: 2020 2020 2c63 6f6c 6f75 723d 636f 6c6f      ,colour=colo
-00070eb0: 7572 0d0a 2020 2020 2020 2020 2020 2020  ur..            
+00070e90: 2020 2c63 616c 6375 6c61 7469 6f6e 3d63    ,calculation=c
+00070ea0: 616c 6375 6c61 7469 6f6e 0d0a 2020 2020  alculation..    
+00070eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00070ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070ed0: 2020 2020 2020 2020 2c6d 6561 7375 7265          ,measure
-00070ee0: 3d6d 6561 7375 7265 0d0a 2020 2020 2020  =measure..      
+00070ed0: 2c63 6f6c 6f75 723d 636f 6c6f 7572 0d0a  ,colour=colour..
+00070ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00070ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070f00: 2020 2020 2020 2020 2020 2020 2020 2c66                ,f
-00070f10: 6965 6c64 733d 6669 656c 6473 0d0a 2020  ields=fields..  
+00070f00: 2020 2020 2c6d 6561 7375 7265 3d6d 6561      ,measure=mea
+00070f10: 7375 7265 0d0a 2020 2020 2020 2020 2020  sure..          
 00070f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070f40: 2020 2c64 696d 656e 7369 6f6e 3d64 696d    ,dimension=dim
-00070f50: 656e 7369 6f6e 0d0a 2020 2020 2020 2020  ension..        
-00070f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070f70: 2020 2020 2020 2020 2020 2020 290d 0a20              ).. 
-00070f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00070f90: 2020 2023 7072 696e 7428 2765 6c65 6d2d     #print('elem-
-00070fa0: 7368 6f72 746e 616d 6527 2c65 6c65 6d65  shortname',eleme
-00070fb0: 6e74 2e73 686f 7274 6e61 6d65 290d 0a20  nt.shortname).. 
-00070fc0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00070fd0: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
-00070fe0: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-00070ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071000: 2020 2020 2020 2020 696e 7465 7276 616c          interval
-00071010: 5f69 6e64 6578 203d 207b 2759 6561 7227  _index = {'Year'
-00071020: 3a20 2020 2020 6c6c 752e 454d 504f 5745  :     llu.EMPOWE
-00071030: 525f 5945 4152 5f43 4f4e 5354 414e 540d  R_YEAR_CONSTANT.
-00071040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00071050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071060: 2020 2020 2020 2020 2020 2c27 4861 6c66            ,'Half
-00071070: 2d79 6561 7227 3a6c 6c75 2e45 4d50 4f57  -year':llu.EMPOW
-00071080: 4552 5f48 414c 4659 4541 525f 434f 4e53  ER_HALFYEAR_CONS
-00071090: 5441 4e54 0d0a 2020 2020 2020 2020 2020  TANT..          
-000710a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000710b0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-000710c0: 2751 7561 7274 6572 273a 2020 6c6c 752e  'Quarter':  llu.
-000710d0: 454d 504f 5745 525f 5155 4152 5445 525f  EMPOWER_QUARTER_
-000710e0: 434f 4e53 5441 4e54 0d0a 2020 2020 2020  CONSTANT..      
-000710f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071110: 2020 202c 274d 6f6e 7468 273a 6c6c 752e     ,'Month':llu.
-00071120: 454d 504f 5745 525f 4d4f 4e54 485f 434f  EMPOWER_MONTH_CO
-00071130: 4e53 5441 4e54 0d0a 2020 2020 2020 2020  NSTANT..        
-00071140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071160: 202c 2757 6565 6b27 3a6c 6c75 2e45 4d50   ,'Week':llu.EMP
-00071170: 4f57 4552 5f57 4545 4b5f 434f 4e53 5441  OWER_WEEK_CONSTA
-00071180: 4e54 0d0a 2020 2020 2020 2020 2020 2020  NT..            
-00071190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000711a0: 2020 2020 2020 2020 2020 2020 202c 2744               ,'D
-000711b0: 6179 273a 6c6c 752e 454d 504f 5745 525f  ay':llu.EMPOWER_
-000711c0: 4441 595f 434f 4e53 5441 4e54 7d5b 696e  DAY_CONSTANT}[in
-000711d0: 7465 7276 616c 5d0d 0a20 2020 2020 2020  terval]..       
-000711e0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-000711f0: 6570 7420 4b65 7945 7272 6f72 3a0d 0a20  ept KeyError:.. 
-00071200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071210: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-00071220: 7565 4572 726f 7228 2243 6f75 6c64 206e  ueError("Could n
-00071230: 6f74 2063 7265 6174 6520 6120 5469 6d65  ot create a Time
-00071240: 456c 656d 656e 7420 7265 6164 696e 6720  Element reading 
-00071250: 6461 7461 2066 726f 6d20 456d 706f 7765  data from Empowe
-00071260: 7220 7769 7468 2075 6e65 7870 6563 7465  r with unexpecte
-00071270: 6420 496e 7465 7276 616c 2027 7b7d 272e  d Interval '{}'.
-00071280: 2045 7870 6563 7469 6e67 206f 6e65 206f   Expecting one o
-00071290: 6620 2759 6561 7227 2c27 4861 6c66 2d79  f 'Year','Half-y
-000712a0: 6561 7227 2c27 5175 6172 7465 7227 2c27  ear','Quarter','
-000712b0: 4d6f 6e74 6827 2c27 5765 656b 272c 2744  Month','Week','D
-000712c0: 6179 2722 2e66 6f72 6d61 7428 696e 7465  ay'".format(inte
-000712d0: 7276 616c 2929 0d0a 0d0a 2020 2020 2020  rval))....      
-000712e0: 2020 2020 2020 2020 2020 2020 2020 2344                #D
-000712f0: 6563 6970 6865 7220 7374 6172 7420 6461  ecipher start da
-00071300: 7465 2069 6e74 6f20 5965 6172 2c20 4d6f  te into Year, Mo
-00071310: 6e74 682c 2044 6179 0d0a 0d0a 2020 2020  nth, Day....    
-00071320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071330: 5f64 6174 6520 3d20 5f63 616c 635f 6461  _date = _calc_da
-00071340: 7465 5f69 6e66 6f28 7374 6172 745f 6461  te_info(start_da
-00071350: 7465 5f73 7472 3d73 7461 7274 5f64 6174  te_str=start_dat
-00071360: 652c 696e 7465 7276 616c 5f69 6e64 6578  e,interval_index
-00071370: 3d69 6e74 6572 7661 6c5f 696e 6465 782c  =interval_index,
-00071380: 6f66 6673 6574 3d6f 6666 7365 7429 0d0a  offset=offset)..
-00071390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000713a0: 2020 2020 6966 205f 6461 7465 2069 7320      if _date is 
-000713b0: 4e6f 6e65 3a0d 0a20 2020 2020 2020 2020  None:..         
-000713c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000713d0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-000713e0: 2744 6174 6520 6973 204e 6f6e 6520 666f  'Date is None fo
-000713f0: 7220 7374 6172 745f 6461 7465 207b 7d2c  r start_date {},
-00071400: 696e 7465 7276 616c 5f69 6e64 6578 207b  interval_index {
-00071410: 7d2c 6f66 6673 6574 207b 7d27 2e66 6f72  },offset {}'.for
-00071420: 6d61 7428 7374 6172 745f 6461 7465 2c69  mat(start_date,i
-00071430: 6e74 6572 7661 6c5f 696e 6465 782c 6f66  nterval_index,of
-00071440: 6673 6574 2929 0d0a 0d0a 2020 2020 2020  fset))....      
-00071450: 2020 2020 2020 2020 2020 2020 2020 6173                as
-00071460: 7365 7274 2070 6879 7369 6420 6973 206e  sert physid is n
-00071470: 6f74 204e 6f6e 650d 0a20 2020 2020 2020  ot None..       
-00071480: 2020 2020 2020 2020 2020 2020 2065 6c65               ele
-00071490: 6d65 6e74 3d20 5469 6d65 456c 656d 656e  ment= TimeElemen
-000714a0: 7428 696e 7465 7276 616c 5f69 6e64 6578  t(interval_index
-000714b0: 3d69 6e74 6572 7661 6c5f 696e 6465 780d  =interval_index.
-000714c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000714d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000714e0: 2020 2020 2020 2020 202c 7368 6f72 746e           ,shortn
-000714f0: 616d 653d 7368 6f72 746e 616d 650d 0a20  ame=shortname.. 
+00070f30: 2020 2020 2020 2020 2020 2c66 6965 6c64            ,field
+00070f40: 733d 6669 656c 6473 0d0a 2020 2020 2020  s=fields..      
+00070f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070f60: 2020 2020 2020 2020 2020 2020 2020 2c64                ,d
+00070f70: 696d 656e 7369 6f6e 3d64 696d 656e 7369  imension=dimensi
+00070f80: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
+00070f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00070fa0: 2020 2020 2020 2020 290d 0a20 2020 2020          )..     
+00070fb0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00070fc0: 7072 696e 7428 2765 6c65 6d2d 7368 6f72  print('elem-shor
+00070fd0: 746e 616d 6527 2c65 6c65 6d65 6e74 2e73  tname',element.s
+00070fe0: 686f 7274 6e61 6d65 290d 0a20 2020 2020  hortname)..     
+00070ff0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00071000: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00071010: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00071020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071030: 2020 2020 696e 7465 7276 616c 5f69 6e64      interval_ind
+00071040: 6578 203d 207b 2759 6561 7227 3a20 2020  ex = {'Year':   
+00071050: 2020 6c6c 752e 454d 504f 5745 525f 5945    llu.EMPOWER_YE
+00071060: 4152 5f43 4f4e 5354 414e 540d 0a20 2020  AR_CONSTANT..   
+00071070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071090: 2020 2020 2020 2c27 4861 6c66 2d79 6561        ,'Half-yea
+000710a0: 7227 3a6c 6c75 2e45 4d50 4f57 4552 5f48  r':llu.EMPOWER_H
+000710b0: 414c 4659 4541 525f 434f 4e53 5441 4e54  ALFYEAR_CONSTANT
+000710c0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+000710d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000710e0: 2020 2020 2020 2020 2020 202c 2751 7561             ,'Qua
+000710f0: 7274 6572 273a 2020 6c6c 752e 454d 504f  rter':  llu.EMPO
+00071100: 5745 525f 5155 4152 5445 525f 434f 4e53  WER_QUARTER_CONS
+00071110: 5441 4e54 0d0a 2020 2020 2020 2020 2020  TANT..          
+00071120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071130: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+00071140: 274d 6f6e 7468 273a 6c6c 752e 454d 504f  'Month':llu.EMPO
+00071150: 5745 525f 4d4f 4e54 485f 434f 4e53 5441  WER_MONTH_CONSTA
+00071160: 4e54 0d0a 2020 2020 2020 2020 2020 2020  NT..            
+00071170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071180: 2020 2020 2020 2020 2020 2020 202c 2757               ,'W
+00071190: 6565 6b27 3a6c 6c75 2e45 4d50 4f57 4552  eek':llu.EMPOWER
+000711a0: 5f57 4545 4b5f 434f 4e53 5441 4e54 0d0a  _WEEK_CONSTANT..
+000711b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000711c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000711d0: 2020 2020 2020 2020 202c 2744 6179 273a           ,'Day':
+000711e0: 6c6c 752e 454d 504f 5745 525f 4441 595f  llu.EMPOWER_DAY_
+000711f0: 434f 4e53 5441 4e54 7d5b 696e 7465 7276  CONSTANT}[interv
+00071200: 616c 5d0d 0a20 2020 2020 2020 2020 2020  al]..           
+00071210: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00071220: 4b65 7945 7272 6f72 3a0d 0a20 2020 2020  KeyError:..     
+00071230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071240: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00071250: 726f 7228 2243 6f75 6c64 206e 6f74 2063  ror("Could not c
+00071260: 7265 6174 6520 6120 5469 6d65 456c 656d  reate a TimeElem
+00071270: 656e 7420 7265 6164 696e 6720 6461 7461  ent reading data
+00071280: 2066 726f 6d20 456d 706f 7765 7220 7769   from Empower wi
+00071290: 7468 2075 6e65 7870 6563 7465 6420 496e  th unexpected In
+000712a0: 7465 7276 616c 2027 7b7d 272e 2045 7870  terval '{}'. Exp
+000712b0: 6563 7469 6e67 206f 6e65 206f 6620 2759  ecting one of 'Y
+000712c0: 6561 7227 2c27 4861 6c66 2d79 6561 7227  ear','Half-year'
+000712d0: 2c27 5175 6172 7465 7227 2c27 4d6f 6e74  ,'Quarter','Mont
+000712e0: 6827 2c27 5765 656b 272c 2744 6179 2722  h','Week','Day'"
+000712f0: 2e66 6f72 6d61 7428 696e 7465 7276 616c  .format(interval
+00071300: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
+00071310: 2020 2020 2020 2020 2020 2344 6563 6970            #Decip
+00071320: 6865 7220 7374 6172 7420 6461 7465 2069  her start date i
+00071330: 6e74 6f20 5965 6172 2c20 4d6f 6e74 682c  nto Year, Month,
+00071340: 2044 6179 0d0a 0d0a 2020 2020 2020 2020   Day....        
+00071350: 2020 2020 2020 2020 2020 2020 5f64 6174              _dat
+00071360: 6520 3d20 5f63 616c 635f 6461 7465 5f69  e = _calc_date_i
+00071370: 6e66 6f28 7374 6172 745f 6461 7465 5f73  nfo(start_date_s
+00071380: 7472 3d73 7461 7274 5f64 6174 652c 696e  tr=start_date,in
+00071390: 7465 7276 616c 5f69 6e64 6578 3d69 6e74  terval_index=int
+000713a0: 6572 7661 6c5f 696e 6465 782c 6f66 6673  erval_index,offs
+000713b0: 6574 3d6f 6666 7365 7429 0d0a 2020 2020  et=offset)..    
+000713c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000713d0: 6966 205f 6461 7465 2069 7320 4e6f 6e65  if _date is None
+000713e0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+000713f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00071400: 2056 616c 7565 4572 726f 7228 2744 6174   ValueError('Dat
+00071410: 6520 6973 204e 6f6e 6520 666f 7220 7374  e is None for st
+00071420: 6172 745f 6461 7465 207b 7d2c 696e 7465  art_date {},inte
+00071430: 7276 616c 5f69 6e64 6578 207b 7d2c 6f66  rval_index {},of
+00071440: 6673 6574 207b 7d27 2e66 6f72 6d61 7428  fset {}'.format(
+00071450: 7374 6172 745f 6461 7465 2c69 6e74 6572  start_date,inter
+00071460: 7661 6c5f 696e 6465 782c 6f66 6673 6574  val_index,offset
+00071470: 2929 0d0a 0d0a 2020 2020 2020 2020 2020  ))....          
+00071480: 2020 2020 2020 2020 2020 6173 7365 7274            assert
+00071490: 2070 6879 7369 6420 6973 206e 6f74 204e   physid is not N
+000714a0: 6f6e 650d 0a20 2020 2020 2020 2020 2020  one..           
+000714b0: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
+000714c0: 3d20 5469 6d65 456c 656d 656e 7428 696e  = TimeElement(in
+000714d0: 7465 7276 616c 5f69 6e64 6578 3d69 6e74  terval_index=int
+000714e0: 6572 7661 6c5f 696e 6465 780d 0a20 2020  erval_index..   
+000714f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00071500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071520: 2020 2020 2020 202c 7965 6172 3d5f 6461         ,year=_da
-00071530: 7465 2e79 6561 720d 0a20 2020 2020 2020  te.year..       
+00071510: 2020 2020 202c 7368 6f72 746e 616d 653d       ,shortname=
+00071520: 7368 6f72 746e 616d 650d 0a20 2020 2020  shortname..     
+00071530: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00071540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071560: 202c 6d6f 6e74 683d 5f64 6174 652e 6d6f   ,month=_date.mo
-00071570: 6e74 680d 0a20 2020 2020 2020 2020 2020  nth..           
-00071580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071590: 2020 2020 2020 2020 2020 2020 202c 6461               ,da
-000715a0: 793d 5f64 6174 652e 6461 790d 0a20 2020  y=_date.day..   
+00071550: 2020 202c 7965 6172 3d5f 6461 7465 2e79     ,year=_date.y
+00071560: 6561 720d 0a20 2020 2020 2020 2020 2020  ear..           
+00071570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071580: 2020 2020 2020 2020 2020 2020 202c 6d6f               ,mo
+00071590: 6e74 683d 5f64 6174 652e 6d6f 6e74 680d  nth=_date.month.
+000715a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 000715b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000715c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000715d0: 2020 2020 202c 6465 7363 7269 7074 696f       ,descriptio
-000715e0: 6e3d 6465 7363 7269 7074 696f 6e0d 0a20  n=description.. 
+000715c0: 2020 2020 2020 2020 202c 6461 793d 5f64           ,day=_d
+000715d0: 6174 652e 6461 790d 0a20 2020 2020 2020  ate.day..       
+000715e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000715f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071610: 2020 2020 2020 202c 6c6f 6e67 6e61 6d65         ,longname
-00071620: 3d6c 6f6e 676e 616d 650d 0a20 2020 2020  =longname..     
+00071600: 202c 6465 7363 7269 7074 696f 6e3d 6465   ,description=de
+00071610: 7363 7269 7074 696f 6e0d 0a20 2020 2020  scription..     
+00071620: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00071630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071650: 2020 202c 7068 7973 6964 3d70 6879 7369     ,physid=physi
-00071660: 640d 0a20 2020 2020 2020 2020 2020 2020  d..             
-00071670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071680: 2020 2020 2020 2020 2020 202c 6469 6d65             ,dime
-00071690: 6e73 696f 6e3d 6469 6d65 6e73 696f 6e0d  nsion=dimension.
-000716a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000716b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000716c0: 2020 2020 2020 2020 2029 0d0a 2020 2020           )..    
+00071640: 2020 202c 6c6f 6e67 6e61 6d65 3d6c 6f6e     ,longname=lon
+00071650: 676e 616d 650d 0a20 2020 2020 2020 2020  gname..         
+00071660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071670: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+00071680: 7068 7973 6964 3d70 6879 7369 640d 0a20  physid=physid.. 
+00071690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000716a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000716b0: 2020 2020 2020 202c 6469 6d65 6e73 696f         ,dimensio
+000716c0: 6e3d 6469 6d65 6e73 696f 6e0d 0a20 2020  n=dimension..   
 000716d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000716e0: 6173 7365 7274 2065 6c65 6d65 6e74 2e70  assert element.p
-000716f0: 6879 7369 6420 6973 206e 6f74 204e 6f6e  hysid is not Non
-00071700: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
-00071710: 2020 2020 2020 2065 6c65 6d65 6e74 2e5f         element._
-00071720: 696e 7465 7276 616c 5f61 6d6f 756e 7420  interval_amount 
-00071730: 3d20 696e 7428 696e 7465 7276 616c 5f61  = int(interval_a
-00071740: 6d6f 756e 7429 0d0a 2020 2020 2020 2020  mount)..        
-00071750: 2020 2020 2020 2020 2020 2020 656c 656d              elem
-00071760: 656e 742e 5f72 6573 6f6c 7574 696f 6e20  ent._resolution 
-00071770: 2020 2020 203d 2072 6573 6f6c 7574 696f       = resolutio
-00071780: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
-00071790: 2020 2020 2020 2065 6c65 6d65 6e74 2e5f         element._
-000717a0: 7374 6172 745f 6461 7465 2020 2020 2020  start_date      
-000717b0: 3d20 7374 6172 745f 6461 7465 0d0a 2020  = start_date..  
-000717c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000717d0: 2020 6966 206f 6666 7365 7420 6973 204e    if offset is N
-000717e0: 6f6e 653a 0d0a 2020 2020 2020 2020 2020  one:..          
-000717f0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00071800: 656d 656e 742e 5f6f 6666 7365 7420 2020  ement._offset   
-00071810: 2020 2020 2020 203d 204e 6f6e 650d 0a20         = None.. 
-00071820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071830: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
-00071840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071850: 2020 656c 656d 656e 742e 5f6f 6666 7365    element._offse
-00071860: 7420 2020 2020 2020 2020 203d 2069 6e74  t          = int
-00071870: 286f 6666 7365 7429 0d0a 0d0a 2020 2020  (offset)....    
-00071880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071890: 2370 7269 6e74 2827 656c 656d 2d73 686f  #print('elem-sho
-000718a0: 7274 6e61 6d65 3227 2c65 6c65 6d65 6e74  rtname2',element
-000718b0: 2e73 686f 7274 6e61 6d65 290d 0a20 2020  .shortname)..   
-000718c0: 2020 2020 2020 2020 2020 2020 2065 6c65               ele
-000718d0: 6d65 6e74 5f6c 6973 742e 6170 7065 6e64  ment_list.append
-000718e0: 2865 6c65 6d65 6e74 290d 0a0d 0a20 2020  (element)....   
-000718f0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00071900: 7074 696f 6e20 6173 2065 3a0d 0a20 2020  ption as e:..   
-00071910: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
-00071920: 4c69 6e65 206e 6f3a 2027 2b73 7472 2872  Line no: '+str(r
-00071930: 6561 6465 722e 6c69 6e65 5f6e 756d 2929  eader.line_num))
-00071940: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
-00071950: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
-00071960: 2020 2020 7072 696e 7428 7265 636f 7264      print(record
-00071970: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00071980: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-00071990: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000719a0: 2020 7061 7373 0d0a 0d0a 2020 2020 2020    pass....      
-000719b0: 2020 2020 2020 7261 6973 6520 650d 0a20        raise e.. 
-000719c0: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-000719d0: 656d 656e 745f 6c69 7374 0d0a 0d0a 2020  ement_list....  
-000719e0: 2020 6966 2064 6562 7567 3a0d 0a20 2020    if debug:..   
-000719f0: 2020 2020 2066 6f72 2064 6972 2069 6e20       for dir in 
-00071a00: 5b64 696d 656e 7369 6f6e 2e73 6974 652e  [dimension.site.
-00071a10: 5f65 6d70 6f77 6572 5f65 7870 6f72 745f  _empower_export_
-00071a20: 6461 7461 5f64 6972 5d3a 0d0a 0d0a 2020  data_dir]:....  
-00071a30: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
-00071a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071a50: 6f73 2e6d 616b 6564 6972 7328 6469 7229  os.makedirs(dir)
-00071a60: 0d0a 2020 2020 2020 2020 2020 2020 6578  ..            ex
-00071a70: 6365 7074 2046 696c 6545 7869 7374 7345  cept FileExistsE
-00071a80: 7272 6f72 3a0d 0a20 2020 2020 2020 2020  rror:..         
-00071a90: 2020 2020 2020 2070 6173 730d 0a20 2020         pass..   
-00071aa0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00071ab0: 4f53 4572 726f 7220 6173 2065 3a0d 0a20  OSError as e:.. 
-00071ac0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00071ad0: 6620 652e 7769 6e65 7272 6f72 203d 3d20  f e.winerror == 
-00071ae0: 3132 333a 0d0a 2020 2020 2020 2020 2020  123:..          
-00071af0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00071b00: 5661 6c75 6545 7272 6f72 2827 4469 7265  ValueError('Dire
-00071b10: 6374 6f72 7920 227b 7d22 2068 6173 2061  ctory "{}" has a
-00071b20: 6e20 696e 7661 6c69 6420 6e61 6d65 2e20  n invalid name. 
-00071b30: 4469 6420 796f 7520 7061 7373 2061 2073  Did you pass a s
-00071b40: 6974 655f 6c6f 6361 746f 7220 7061 7468  ite_locator path
-00071b50: 2022 7b7d 2220 7769 7468 6f75 7420 646f   "{}" without do
-00071b60: 7562 6c65 2d65 7363 6170 696e 6720 6261  uble-escaping ba
-00071b70: 636b 736c 6173 6865 7320 6f72 2070 7265  ckslashes or pre
-00071b80: 6669 7869 6e67 2074 6865 2073 7472 696e  fixing the strin
-00071b90: 6720 7769 7468 2061 6e20 2272 2220 666f  g with an "r" fo
-00071ba0: 7220 7261 773f 272e 666f 726d 6174 2864  r raw?'.format(d
-00071bb0: 6972 2c72 6570 7228 7369 7465 5f6c 6f63  ir,repr(site_loc
-00071bc0: 6174 6f72 2929 290d 0a20 2020 2020 2020  ator)))..       
-00071bd0: 2020 2020 2020 2020 2065 6c73 653a 0d0a           else:..
-00071be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00071bf0: 2020 2020 7261 6973 6520 650d 0a20 2020      raise e..   
-00071c00: 2020 2020 2352 6561 6420 7468 650d 0a20      #Read the.. 
-00071c10: 2020 2020 2020 2065 7870 6f72 7465 645f         exported_
-00071c20: 6469 6d65 6e73 696f 6e5f 6669 6c65 7061  dimension_filepa
-00071c30: 7468 3d6f 732e 7061 7468 2e6a 6f69 6e28  th=os.path.join(
-00071c40: 6469 6d65 6e73 696f 6e2e 7369 7465 2e5f  dimension.site._
-00071c50: 656d 706f 7765 725f 6578 706f 7274 5f64  empower_export_d
-00071c60: 6174 615f 6469 722c 2027 4469 6d65 6e73  ata_dir, 'Dimens
-00071c70: 696f 6e5f 272b 7374 7228 6469 6d65 6e73  ion_'+str(dimens
-00071c80: 696f 6e2e 696e 6465 7829 2b27 2e74 7376  ion.index)+'.tsv
-00071c90: 2729 0d0a 2020 2020 2020 2020 0d0a 2020  ')..        ..  
-00071ca0: 2020 2020 2020 6d61 6a6f 725f 7665 7273        major_vers
-00071cb0: 696f 6e2c 206d 696e 6f72 5f76 6572 7369  ion, minor_versi
-00071cc0: 6f6e 2c20 7265 6c65 6173 652c 2072 656c  on, release, rel
-00071cd0: 6561 7365 5f6e 756d 6265 7220 3d20 6469  ease_number = di
-00071ce0: 6d65 6e73 696f 6e2e 7369 7465 2e69 6d70  mension.site.imp
-00071cf0: 6f72 7465 725f 7665 7273 696f 6e0d 0a20  orter_version.. 
-00071d00: 2020 2020 2020 2065 6e63 6f64 696e 673d         encoding=
-00071d10: 2761 6e73 6927 0d0a 2020 2020 2020 2020  'ansi'..        
-00071d20: 6966 2028 6d61 6a6f 725f 7665 7273 696f  if (major_versio
-00071d30: 6e20 3d3d 2039 2061 6e64 2028 6d69 6e6f  n == 9 and (mino
-00071d40: 725f 7665 7273 696f 6e20 3e3d 2038 2929  r_version >= 8))
-00071d50: 206f 7220 6d61 6a6f 725f 7665 7273 696f   or major_versio
-00071d60: 6e20 3e20 393a 0d0a 2020 2020 2020 2020  n > 9:..        
-00071d70: 2020 2020 656e 636f 6469 6e67 3d22 7574      encoding="ut
-00071d80: 662d 382d 7369 6722 0d0a 2020 2020 2020  f-8-sig"..      
-00071d90: 2020 2020 2020 0d0a 2020 2020 2020 2020        ..        
-00071da0: 7769 7468 206f 7065 6e28 6578 706f 7274  with open(export
-00071db0: 6564 5f64 696d 656e 7369 6f6e 5f66 696c  ed_dimension_fil
-00071dc0: 6570 6174 682c 6d6f 6465 3d27 7227 2c65  epath,mode='r',e
-00071dd0: 6e63 6f64 696e 673d 656e 636f 6469 6e67  ncoding=encoding
-00071de0: 2920 6173 2065 7870 6f72 7465 645f 6469  ) as exported_di
-00071df0: 6d65 6e73 696f 6e5f 6461 7461 3a0d 0a20  mension_data:.. 
-00071e00: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00071e10: 6e20 5f72 6561 645f 6578 706f 7274 6564  n _read_exported
-00071e20: 5f64 696d 656e 7369 6f6e 5f64 6174 6128  _dimension_data(
-00071e30: 6578 706f 7274 6564 5f64 696d 656e 7369  exported_dimensi
-00071e40: 6f6e 5f64 6174 6129 0d0a 2020 2020 2020  on_data)..      
-00071e50: 2020 0d0a 2020 2020 656c 7365 3a0d 0a20    ..    else:.. 
-00071e60: 2020 2020 2020 2069 6d70 6f72 7420 696f         import io
-00071e70: 0d0a 2020 2020 2020 2020 2344 6f20 6120  ..        #Do a 
-00071e80: 6675 6e6b 7920 476c 6167 6f6c 7974 6963  funky Glagolytic
-00071e90: 2072 6570 6c61 6365 6d65 6e74 2074 6f20   replacement to 
-00071ea0: 6669 7820 7175 6f74 696e 6720 6973 7375  fix quoting issu
-00071eb0: 6573 202d 2049 2063 686f 7365 2074 6865  es - I chose the
-00071ec0: 206f 6e65 2074 6861 7420 6c6f 6f6b 7320   one that looks 
-00071ed0: 6c69 6b65 2061 206c 616d 700d 0a20 2020  like a lamp..   
-00071ee0: 2020 2020 2023 4966 2074 6865 7265 2061       #If there a
-00071ef0: 7265 2072 6561 6c20 476c 6167 6f6c 7974  re real Glagolyt
-00071f00: 6963 2063 6861 7261 6374 6572 7320 696e  ic characters in
-00071f10: 2079 6f75 7220 6461 7461 2028 6869 6768   your data (high
-00071f20: 6c79 2075 6e6c 696b 656c 7920 2d20 6974  ly unlikely - it
-00071f30: 2773 2061 2076 6572 792c 2076 6572 7920  's a very, very 
-00071f40: 6465 6164 206c 616e 6775 6167 6529 2074  dead language) t
-00071f50: 6869 7320 636f 6465 2077 696c 6c20 6661  his code will fa
-00071f60: 696c 0d0a 2020 2020 2020 2020 7265 7475  il..        retu
-00071f70: 726e 205f 7265 6164 5f65 7870 6f72 7465  rn _read_exporte
-00071f80: 645f 6469 6d65 6e73 696f 6e5f 6461 7461  d_dimension_data
-00071f90: 2869 6f2e 5374 7269 6e67 494f 286f 7574  (io.StringIO(out
-00071fa0: 7075 742e 7265 706c 6163 6528 2722 2227  put.replace('""'
-00071fb0: 2c27 e2b0 a627 292e 7265 706c 6163 6528  ,'...').replace(
-00071fc0: 2722 272c 2727 292e 7265 706c 6163 6528  '"','').replace(
-00071fd0: 27e2 b0a6 272c 2722 2729 2929 0d0a 0d0a  '...','"')))....
-00071fe0: 6465 6620 5f63 7265 6174 655f 656d 706f  def _create_empo
-00071ff0: 7765 725f 6469 6d65 6e73 696f 6e5f 7368  wer_dimension_sh
-00072000: 6f72 746e 616d 655f 656c 656d 656e 745f  ortname_element_
-00072010: 6469 6374 2864 696d 656e 7369 6f6e 2c6f  dict(dimension,o
-00072020: 6c64 5f65 6c65 6d65 6e74 733d 4e6f 6e65  ld_elements=None
-00072030: 2c64 6562 7567 3d46 616c 7365 293a 0d0a  ,debug=False):..
-00072040: 2020 2020 2727 2743 7265 6174 6520 6120      '''Create a 
-00072050: 6469 6374 696f 6e61 7279 206f 6620 7368  dictionary of sh
-00072060: 6f72 746e 616d 6573 2074 6f20 456d 706f  ortnames to Empo
-00072070: 7765 7220 656c 656d 656e 7473 2c20 666f  wer elements, fo
-00072080: 7220 6120 6769 7665 6e20 7a65 726f 2062  r a given zero b
-00072090: 6173 6564 2064 696d 656e 7369 6f6e 0d0a  ased dimension..
-000720a0: 2020 2020 5468 6520 656c 656d 656e 7473      The elements
-000720b0: 2077 696c 6c20 6265 206f 6620 7479 7065   will be of type
-000720c0: 2045 6c65 6d65 6e74 2c20 6120 636c 6173   Element, a clas
-000720d0: 7320 696e 2074 6869 7320 6d6f 6475 6c65  s in this module
-000720e0: 2e0d 0a0d 0a20 2020 203a 7061 7261 6d20  .....    :param 
-000720f0: 6469 6d65 6e73 696f 6e3a 2041 2070 796d  dimension: A pym
-00072100: 7078 2044 696d 656e 7369 6f6e 206f 626a  px Dimension obj
-00072110: 6563 740d 0a20 2020 203a 7061 7261 6d20  ect..    :param 
-00072120: 6f6c 645f 656c 656d 656e 7473 3a20 7072  old_elements: pr
-00072130: 6576 696f 7573 2073 6574 206f 6620 656c  evious set of el
-00072140: 656d 656e 7473 2c20 7468 6973 2061 6c6c  ements, this all
-00072150: 6f77 7320 7573 2074 6f20 6d65 7267 6520  ows us to merge 
-00072160: 696e 2074 6865 2065 6c65 6d65 6e74 7320  in the elements 
-00072170: 6173 2074 6865 7920 6172 6520 6372 6561  as they are crea
-00072180: 7465 640d 0a20 2020 2027 2727 0d0a 0d0a  ted..    '''....
-00072190: 2020 2020 656c 656d 656e 745f 6c69 7374      element_list
-000721a0: 3d20 5f63 7265 6174 655f 656d 706f 7765  = _create_empowe
-000721b0: 725f 6469 6d65 6e73 696f 6e5f 656c 656d  r_dimension_elem
-000721c0: 656e 745f 6c69 7374 2864 696d 656e 7369  ent_list(dimensi
-000721d0: 6f6e 3d20 6469 6d65 6e73 696f 6e2c 6465  on= dimension,de
-000721e0: 6275 673d 6465 6275 6729 0d0a 0d0a 2020  bug=debug)....  
-000721f0: 2020 7265 7475 726e 5f64 6963 743d 7b7d    return_dict={}
-00072200: 0d0a 0d0a 2020 2020 2341 7474 656d 7074  ....    #Attempt
-00072210: 2074 6f20 6b65 6570 2074 6865 2073 616d   to keep the sam
-00072220: 6520 6f62 6a65 6374 2072 6566 6572 656e  e object referen
-00072230: 6365 7320 666f 7220 7072 6576 696f 7573  ces for previous
-00072240: 6c79 2075 7365 6420 656c 656d 656e 7473  ly used elements
-00072250: 0d0a 2020 2020 6966 206f 6c64 5f65 6c65  ..    if old_ele
-00072260: 6d65 6e74 7320 6973 206e 6f74 204e 6f6e  ments is not Non
-00072270: 653a 0d0a 2020 2020 2020 2020 7472 793a  e:..        try:
-00072280: 0d0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00072290: 7220 656c 656d 656e 7420 696e 206f 6c64  r element in old
-000722a0: 5f65 6c65 6d65 6e74 732e 7661 6c75 6573  _elements.values
-000722b0: 2829 3a0d 0a20 2020 2020 2020 2020 2020  ():..           
-000722c0: 2020 2020 2072 6574 7572 6e5f 6469 6374       return_dict
-000722d0: 5b65 6c65 6d65 6e74 2e73 686f 7274 6e61  [element.shortna
-000722e0: 6d65 5d3d 656c 656d 656e 740d 0a20 2020  me]=element..   
-000722f0: 2020 2020 2065 7863 6570 7420 4174 7472       except Attr
-00072300: 6962 7574 6545 7272 6f72 3a0d 0a20 2020  ibuteError:..   
-00072310: 2020 2020 2020 2020 2066 6f72 2065 6c65           for ele
-00072320: 6d65 6e74 2069 6e20 6f6c 645f 656c 656d  ment in old_elem
-00072330: 656e 7473 3a0d 0a20 2020 2020 2020 2020  ents:..         
-00072340: 2020 2020 2020 2072 6574 7572 6e5f 6469         return_di
-00072350: 6374 5b65 6c65 6d65 6e74 2e73 686f 7274  ct[element.short
-00072360: 6e61 6d65 5d3d 656c 656d 656e 740d 0a0d  name]=element...
-00072370: 0a20 2020 2066 6f72 2065 6c65 6d65 6e74  .    for element
-00072380: 2069 6e20 656c 656d 656e 745f 6c69 7374   in element_list
-00072390: 3a0d 0a20 2020 2020 2020 2074 7279 3a0d  :..        try:.
-000723a0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000723b0: 7572 6e5f 6469 6374 5b65 6c65 6d65 6e74  urn_dict[element
-000723c0: 2e73 686f 7274 6e61 6d65 5d2e 6d65 7267  .shortname].merg
-000723d0: 6528 656c 656d 656e 7429 0d0a 2020 2020  e(element)..    
-000723e0: 2020 2020 6578 6365 7074 204b 6579 4572      except KeyEr
-000723f0: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
-00072400: 2020 7265 7475 726e 5f64 6963 745b 656c    return_dict[el
-00072410: 656d 656e 742e 7368 6f72 746e 616d 655d  ement.shortname]
-00072420: 3d65 6c65 6d65 6e74 0d0a 0d0a 2020 2020  =element....    
-00072430: 7265 7475 726e 2072 6574 7572 6e5f 6469  return return_di
-00072440: 6374 0d0a 0d0a 6465 6620 5f64 6174 6166  ct....def _dataf
-00072450: 7261 6d65 5f61 735f 656c 656d 656e 7473  rame_as_elements
-00072460: 2864 6174 6166 7261 6d65 2c6c 6f6e 676e  (dataframe,longn
-00072470: 616d 655f 7368 6f72 746e 616d 655f 7275  ame_shortname_ru
-00072480: 6c65 3d4e 6f6e 652c 6469 6d65 6e73 696f  le=None,dimensio
-00072490: 6e3d 4e6f 6e65 293a 0d0a 2020 2020 2727  n=None):..    ''
-000724a0: 2754 616b 6520 6120 7061 6e64 6173 2e44  'Take a pandas.D
-000724b0: 6174 6166 7261 6d65 2061 6e64 2079 6965  ataframe and yie
-000724c0: 6c64 2045 6c65 6d65 6e74 7327 2727 0d0a  ld Elements'''..
-000724d0: 0d0a 2020 2020 2363 6865 636b 2074 6865  ..    #check the
-000724e0: 2063 6f6c 756d 6e73 2061 7265 2063 6f72   columns are cor
-000724f0: 7265 6374 0d0a 2020 2020 6c6f 6e67 5f6e  rect..    long_n
-00072500: 616d 655f 636f 6c75 6d6e 5f69 735f 666f  ame_column_is_fo
-00072510: 756e 6420 2020 3d20 4661 6c73 650d 0a20  und   = False.. 
-00072520: 2020 2073 686f 7274 5f6e 616d 655f 636f     short_name_co
-00072530: 6c75 6d6e 5f69 735f 666f 756e 6420 203d  lumn_is_found  =
-00072540: 2046 616c 7365 0d0a 2020 2020 6465 7363   False..    desc
-00072550: 7269 7074 696f 6e5f 636f 6c75 6d6e 5f69  ription_column_i
-00072560: 735f 666f 756e 6420 3d20 4661 6c73 650d  s_found = False.
-00072570: 0a20 2020 2067 726f 7570 5f6f 6e6c 795f  .    group_only_
-00072580: 636f 6c75 6d6e 5f69 735f 666f 756e 6420  column_is_found 
-00072590: 203d 2046 616c 7365 0d0a 2020 2020 6361   = False..    ca
-000725a0: 6c63 5f73 7461 7475 735f 636f 6c75 6d6e  lc_status_column
-000725b0: 5f69 735f 666f 756e 6420 3d20 4661 6c73  _is_found = Fals
-000725c0: 650d 0a20 2020 2063 616c 6375 6c61 7469  e..    calculati
-000725d0: 6f6e 5f63 6f6c 756d 6e5f 6973 5f66 6f75  on_column_is_fou
-000725e0: 6e64 203d 2046 616c 7365 0d0a 2020 2020  nd = False..    
-000725f0: 636f 6c6f 7572 5f63 6f6c 756d 6e5f 6973  colour_column_is
-00072600: 5f66 6f75 6e64 2020 2020 2020 3d20 4661  _found      = Fa
-00072610: 6c73 650d 0a20 2020 206d 6561 7375 7265  lse..    measure
-00072620: 5f63 6f6c 756d 6e5f 6973 5f66 6f75 6e64  _column_is_found
-00072630: 2020 2020 203d 2046 616c 7365 0d0a 2020       = False..  
-00072640: 2020 6669 656c 645f 7368 6f72 746e 616d    field_shortnam
-00072650: 6573 3d5b 5d0d 0a0d 0a20 2020 2066 6f72  es=[]....    for
-00072660: 2063 2069 6e20 6461 7461 6672 616d 652e   c in dataframe.
-00072670: 636f 6c75 6d6e 733a 0d0a 2020 2020 2020  columns:..      
-00072680: 2020 6966 2063 203d 3d20 274c 6f6e 6720    if c == 'Long 
-00072690: 4e61 6d65 273a 0d0a 2020 2020 2020 2020  Name':..        
-000726a0: 2020 2020 6c6f 6e67 5f6e 616d 655f 636f      long_name_co
-000726b0: 6c75 6d6e 5f69 735f 666f 756e 643d 5472  lumn_is_found=Tr
-000726c0: 7565 0d0a 2020 2020 2020 2020 656c 6966  ue..        elif
-000726d0: 2063 203d 3d20 2753 686f 7274 204e 616d   c == 'Short Nam
-000726e0: 6527 3a0d 0a20 2020 2020 2020 2020 2020  e':..           
-000726f0: 2073 686f 7274 5f6e 616d 655f 636f 6c75   short_name_colu
-00072700: 6d6e 5f69 735f 666f 756e 6420 203d 2054  mn_is_found  = T
-00072710: 7275 650d 0a20 2020 2020 2020 2065 6c69  rue..        eli
-00072720: 6620 6320 3d3d 2027 4465 7363 7269 7074  f c == 'Descript
-00072730: 696f 6e27 3a0d 0a20 2020 2020 2020 2020  ion':..         
-00072740: 2020 2064 6573 6372 6970 7469 6f6e 5f63     description_c
-00072750: 6f6c 756d 6e5f 6973 5f66 6f75 6e64 203d  olumn_is_found =
-00072760: 2054 7275 650d 0a20 2020 2020 2020 2065   True..        e
-00072770: 6c69 6620 6320 3d3d 2027 4772 6f75 7020  lif c == 'Group 
-00072780: 4f6e 6c79 273a 0d0a 2020 2020 2020 2020  Only':..        
-00072790: 2020 2020 6772 6f75 705f 6f6e 6c79 5f63      group_only_c
-000727a0: 6f6c 756d 6e5f 6973 5f66 6f75 6e64 2020  olumn_is_found  
-000727b0: 3d20 5472 7565 0d0a 2020 2020 2020 2020  = True..        
-000727c0: 656c 6966 2063 203d 3d20 2743 616c 6375  elif c == 'Calcu
-000727d0: 6c61 7469 6f6e 2053 7461 7475 7327 3a0d  lation Status':.
-000727e0: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
-000727f0: 635f 7374 6174 7573 5f63 6f6c 756d 6e5f  c_status_column_
-00072800: 6973 5f66 6f75 6e64 203d 2054 7275 650d  is_found = True.
-00072810: 0a20 2020 2020 2020 2065 6c69 6620 6320  .        elif c 
-00072820: 3d3d 2027 4361 6c63 756c 6174 696f 6e27  == 'Calculation'
-00072830: 3a0d 0a20 2020 2020 2020 2020 2020 2063  :..            c
-00072840: 616c 6375 6c61 7469 6f6e 5f63 6f6c 756d  alculation_colum
-00072850: 6e5f 6973 5f66 6f75 6e64 203d 2054 7275  n_is_found = Tru
-00072860: 650d 0a20 2020 2020 2020 2065 6c69 6620  e..        elif 
-00072870: 6320 3d3d 2027 436f 6c6f 7572 273a 0d0a  c == 'Colour':..
-00072880: 2020 2020 2020 2020 2020 2020 636f 6c6f              colo
-00072890: 7572 5f63 6f6c 756d 6e5f 6973 5f66 6f75  ur_column_is_fou
-000728a0: 6e64 2020 2020 2020 3d20 5472 7565 0d0a  nd      = True..
-000728b0: 2020 2020 2020 2020 656c 6966 2063 203d          elif c =
-000728c0: 3d20 274d 6561 7375 7265 2045 6c65 6d65  = 'Measure Eleme
-000728d0: 6e74 273a 0d0a 2020 2020 2020 2020 2020  nt':..          
-000728e0: 2020 6d65 6173 7572 655f 636f 6c75 6d6e    measure_column
-000728f0: 5f69 735f 666f 756e 6420 2020 2020 3d20  _is_found     = 
-00072900: 5472 7565 0d0a 2020 2020 2020 2020 656c  True..        el
-00072910: 7365 3a0d 0a20 2020 2020 2020 2020 2020  se:..           
-00072920: 2066 6965 6c64 5f73 686f 7274 6e61 6d65   field_shortname
-00072930: 732e 6170 7065 6e64 2863 290d 0a0d 0a20  s.append(c).... 
-00072940: 2020 2069 6620 6e6f 7420 6c6f 6e67 5f6e     if not long_n
-00072950: 616d 655f 636f 6c75 6d6e 5f69 735f 666f  ame_column_is_fo
-00072960: 756e 6420 616e 6420 6e6f 7420 7368 6f72  und and not shor
-00072970: 745f 6e61 6d65 5f63 6f6c 756d 6e5f 6973  t_name_column_is
-00072980: 5f66 6f75 6e64 3a0d 0a20 2020 2020 2020  _found:..       
-00072990: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-000729a0: 7228 275f 6461 7461 6672 616d 655f 6173  r('_dataframe_as
-000729b0: 5f65 6c65 6d65 6e74 7328 293a 2054 6865  _elements(): The
-000729c0: 2064 6174 6166 7261 6d65 2070 6172 616d   dataframe param
-000729d0: 6574 6572 206d 7573 7420 636f 6e74 6169  eter must contai
-000729e0: 6e20 6120 6461 7461 6672 616d 6520 7769  n a dataframe wi
-000729f0: 7468 2065 6974 6865 7220 6120 224c 6f6e  th either a "Lon
-00072a00: 6720 4e61 6d65 2220 636f 6c75 6d6e 206f  g Name" column o
-00072a10: 7220 6120 2253 686f 7274 204e 616d 6522  r a "Short Name"
-00072a20: 2063 6f6c 756d 6e20 6f72 2062 6f74 682e   column or both.
-00072a30: 2043 6f6c 756d 6e73 2069 6e20 7468 6520   Columns in the 
-00072a40: 6461 7461 6672 616d 6520 6172 653a 2027  dataframe are: '
-00072a50: 2b73 7472 2864 6174 6166 7261 6d65 2e63  +str(dataframe.c
-00072a60: 6f6c 756d 6e73 2929 0d0a 0d0a 2020 2020  olumns))....    
-00072a70: 666f 7220 6420 696e 2064 6174 6166 7261  for d in datafra
-00072a80: 6d65 2e69 7465 7274 7570 6c65 7328 696e  me.itertuples(in
-00072a90: 6465 783d 4661 6c73 6529 3a0d 0a20 2020  dex=False):..   
-00072aa0: 2020 2020 2023 466f 7220 736f 6d65 2072       #For some r
-00072ab0: 6561 736f 6e20 6974 6572 7475 706c 6573  eason itertuples
-00072ac0: 2069 736e 2774 2063 6f6d 696e 6720 6261   isn't coming ba
-00072ad0: 636b 2077 6974 6820 7468 6520 636f 6c75  ck with the colu
-00072ae0: 6d6e 206e 616d 6573 202d 2063 7265 6174  mn names - creat
-00072af0: 6520 6120 6469 6374 696f 6e61 7279 2075  e a dictionary u
-00072b00: 7369 6e67 2074 6865 206f 7269 6769 6e61  sing the origina
-00072b10: 6c20 636f 6c75 6d6e 206e 616d 6573 206f  l column names o
-00072b20: 6620 7468 6520 6469 6374 696f 6e61 7279  f the dictionary
-00072b30: 0d0a 2020 2020 2020 2020 656c 656d 656e  ..        elemen
-00072b40: 745f 6173 5f64 6963 7469 6f6e 6172 7920  t_as_dictionary 
-00072b50: 3d20 7b7d 0d0a 2020 2020 2020 2020 666f  = {}..        fo
-00072b60: 7220 692c 2076 2069 6e20 656e 756d 6572  r i, v in enumer
-00072b70: 6174 6528 6429 3a0d 0a20 2020 2020 2020  ate(d):..       
-00072b80: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
-00072b90: 2020 2020 2020 2020 2020 2069 6620 6e70             if np
-00072ba0: 2e69 736e 616e 2876 293a 0d0a 2020 2020  .isnan(v):..    
-00072bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00072bc0: 7620 3d20 4e6f 6e65 0d0a 2020 2020 2020  v = None..      
-00072bd0: 2020 2020 2020 6578 6365 7074 2054 7970        except Typ
-00072be0: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
-00072bf0: 2020 2020 2020 2020 2070 6173 730d 0a20           pass.. 
-00072c00: 2020 2020 2020 2020 2020 2065 6c65 6d65             eleme
-00072c10: 6e74 5f61 735f 6469 6374 696f 6e61 7279  nt_as_dictionary
-00072c20: 5b64 6174 6166 7261 6d65 2e63 6f6c 756d  [dataframe.colum
-00072c30: 6e73 5b69 5d5d 203d 2076 0d0a 0d0a 2020  ns[i]] = v....  
-00072c40: 2020 2020 2020 7368 6f72 746e 616d 653d        shortname=
-00072c50: 4e6f 6e65 0d0a 2020 2020 2020 2020 6c6f  None..        lo
-00072c60: 6e67 6e61 6d65 3d4e 6f6e 650d 0a20 2020  ngname=None..   
-00072c70: 2020 2020 2064 6573 6372 6970 7469 6f6e       description
-00072c80: 3d4e 6f6e 650d 0a20 2020 2020 2020 2070  =None..        p
-00072c90: 6879 7369 643d 4e6f 6e65 0d0a 2020 2020  hysid=None..    
-00072ca0: 2020 2020 6772 6f75 705f 6f6e 6c79 3d4e      group_only=N
-00072cb0: 6f6e 650d 0a20 2020 2020 2020 2063 616c  one..        cal
-00072cc0: 6375 6c61 7469 6f6e 5f73 7461 7475 733d  culation_status=
-00072cd0: 4e6f 6e65 0d0a 2020 2020 2020 2020 6361  None..        ca
-00072ce0: 6c63 756c 6174 696f 6e3d 4e6f 6e65 0d0a  lculation=None..
-00072cf0: 2020 2020 2020 2020 636f 6c6f 7572 3d4e          colour=N
-00072d00: 6f6e 650d 0a20 2020 2020 2020 206d 6561  one..        mea
-00072d10: 7375 7265 3d4e 6f6e 650d 0a20 2020 2020  sure=None..     
-00072d20: 2020 2066 6965 6c64 733d 7b7d 0d0a 0d0a     fields={}....
-00072d30: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
-00072d40: 2020 2020 2020 2020 2020 6966 2073 686f            if sho
-00072d50: 7274 5f6e 616d 655f 636f 6c75 6d6e 5f69  rt_name_column_i
-00072d60: 735f 666f 756e 643a 0d0a 2020 2020 2020  s_found:..      
-00072d70: 2020 2020 2020 2020 2020 7368 6f72 746e            shortn
-00072d80: 616d 6520 3d20 656c 656d 656e 745f 6173  ame = element_as
-00072d90: 5f64 6963 7469 6f6e 6172 795b 2753 686f  _dictionary['Sho
-00072da0: 7274 204e 616d 6527 5d0d 0a20 2020 2020  rt Name']..     
-00072db0: 2020 2020 2020 2065 6c73 653a 0d0a 2020         else:..  
-00072dc0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00072dd0: 206c 6f6e 676e 616d 655f 7368 6f72 746e   longname_shortn
-00072de0: 616d 655f 7275 6c65 3a0d 0a20 2020 2020  ame_rule:..     
-00072df0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00072e00: 686f 7274 6e61 6d65 203d 206c 6f6e 676e  hortname = longn
-00072e10: 616d 655f 7368 6f72 746e 616d 655f 7275  ame_shortname_ru
-00072e20: 6c65 2865 6c65 6d65 6e74 5f61 735f 6469  le(element_as_di
-00072e30: 6374 696f 6e61 7279 5b27 4c6f 6e67 204e  ctionary['Long N
-00072e40: 616d 6527 5d29 0d0a 2020 2020 2020 2020  ame'])..        
-00072e50: 2020 2020 2020 2020 656c 7365 3a0d 0a20          else:.. 
-00072e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00072e70: 2020 2023 4a75 7374 2073 6574 206e 6f20     #Just set no 
-00072e80: 7368 6f72 746e 616d 6520 616e 6420 6c65  shortname and le
-00072e90: 7420 456d 706f 7765 7220 736f 7274 2069  t Empower sort i
-00072ea0: 7420 6f75 740d 0a20 2020 2020 2020 2020  t out..         
-00072eb0: 2020 2020 2020 2020 2020 2073 686f 7274             short
-00072ec0: 6e61 6d65 203d 204e 6f6e 6520 2365 6c65  name = None #ele
-00072ed0: 6d65 6e74 5f61 735f 6469 6374 696f 6e61  ment_as_dictiona
-00072ee0: 7279 5b27 4c6f 6e67 204e 616d 6527 5d0d  ry['Long Name'].
-00072ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00072f00: 2020 2020 206e 6565 6473 5f72 6573 796e       needs_resyn
-00072f10: 6320 3d20 5472 7565 0d0a 0d0a 2020 2020  c = True....    
-00072f20: 2020 2020 2020 2020 6966 206c 6f6e 675f          if long_
-00072f30: 6e61 6d65 5f63 6f6c 756d 6e5f 6973 5f66  name_column_is_f
-00072f40: 6f75 6e64 3a0d 0a20 2020 2020 2020 2020  ound:..         
-00072f50: 2020 2020 2020 206c 6f6e 676e 616d 6520         longname 
-00072f60: 3d20 656c 656d 656e 745f 6173 5f64 6963  = element_as_dic
-00072f70: 7469 6f6e 6172 795b 274c 6f6e 6720 4e61  tionary['Long Na
-00072f80: 6d65 275d 0d0a 2020 2020 2020 2020 2020  me']..          
-00072f90: 2020 6966 2064 6573 6372 6970 7469 6f6e    if description
-00072fa0: 5f63 6f6c 756d 6e5f 6973 5f66 6f75 6e64  _column_is_found
-00072fb0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00072fc0: 2020 2064 6573 6372 6970 7469 6f6e 203d     description =
-00072fd0: 2065 6c65 6d65 6e74 5f61 735f 6469 6374   element_as_dict
-00072fe0: 696f 6e61 7279 5b27 4465 7363 7269 7074  ionary['Descript
-00072ff0: 696f 6e27 5d0d 0a20 2020 2020 2020 2020  ion']..         
-00073000: 2020 2069 6620 6772 6f75 705f 6f6e 6c79     if group_only
-00073010: 5f63 6f6c 756d 6e5f 6973 5f66 6f75 6e64  _column_is_found
-00073020: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-00073030: 2020 2067 726f 7570 5f6f 6e6c 7920 3d20     group_only = 
-00073040: 656c 656d 656e 745f 6173 5f64 6963 7469  element_as_dicti
-00073050: 6f6e 6172 795b 2747 726f 7570 204f 6e6c  onary['Group Onl
-00073060: 7927 5d0d 0a20 2020 2020 2020 2020 2020  y']..           
-00073070: 2069 6620 6361 6c63 5f73 7461 7475 735f   if calc_status_
-00073080: 636f 6c75 6d6e 5f69 735f 666f 756e 643a  column_is_found:
-00073090: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000730a0: 2063 616c 6375 6c61 7469 6f6e 5f73 7461   calculation_sta
-000730b0: 7475 7320 3d20 656c 656d 656e 745f 6173  tus = element_as
-000730c0: 5f64 6963 7469 6f6e 6172 795b 2743 616c  _dictionary['Cal
-000730d0: 6375 6c61 7469 6f6e 2053 7461 7475 7327  culation Status'
-000730e0: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
-000730f0: 6620 6361 6c63 756c 6174 696f 6e5f 636f  f calculation_co
-00073100: 6c75 6d6e 5f69 735f 666f 756e 6420 3a0d  lumn_is_found :.
-00073110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00073120: 6361 6c63 756c 6174 696f 6e20 3d20 656c  calculation = el
-00073130: 656d 656e 745f 6173 5f64 6963 7469 6f6e  ement_as_diction
-00073140: 6172 795b 2743 616c 6375 6c61 7469 6f6e  ary['Calculation
-00073150: 275d 0d0a 2020 2020 2020 2020 2020 2020  ']..            
-00073160: 6966 206d 6561 7375 7265 5f63 6f6c 756d  if measure_colum
-00073170: 6e5f 6973 5f66 6f75 6e64 203a 0d0a 2020  n_is_found :..  
-00073180: 2020 2020 2020 2020 2020 2020 206d 6561               mea
-00073190: 7375 7265 203d 2065 6c65 6d65 6e74 5f61  sure = element_a
-000731a0: 735f 6469 6374 696f 6e61 7279 5b27 4d65  s_dictionary['Me
-000731b0: 6173 7572 6520 456c 656d 656e 7427 5d0d  asure Element'].
-000731c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000731d0: 636f 6c6f 7572 5f63 6f6c 756d 6e5f 6973  colour_column_is
-000731e0: 5f66 6f75 6e64 3a0d 0a20 2020 2020 2020  _found:..       
-000731f0: 2020 2020 2020 2020 2063 6f6c 6f75 7220           colour 
-00073200: 3d20 656c 656d 656e 745f 6173 5f64 6963  = element_as_dic
-00073210: 7469 6f6e 6172 795b 2743 6f6c 6f75 7227  tionary['Colour'
-00073220: 5d0d 0a0d 0a20 2020 2020 2020 2020 2020  ]....           
-00073230: 2066 6f72 2066 5f73 6e20 696e 2066 6965   for f_sn in fie
-00073240: 6c64 5f73 686f 7274 6e61 6d65 733a 0d0a  ld_shortnames:..
-00073250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073260: 6669 656c 6473 5b66 5f73 6e5d 203d 2065  fields[f_sn] = e
-00073270: 6c65 6d65 6e74 5f61 735f 6469 6374 696f  lement_as_dictio
-00073280: 6e61 7279 5b66 5f73 6e5d 0d0a 0d0a 2020  nary[f_sn]....  
-00073290: 2020 2020 2020 6578 6365 7074 204b 6579        except Key
-000732a0: 4572 726f 723a 0d0a 2020 2020 2020 2020  Error:..        
-000732b0: 2020 2020 6c6f 672e 6572 726f 7228 7374      log.error(st
-000732c0: 7228 656c 656d 656e 745f 6173 5f64 6963  r(element_as_dic
-000732d0: 7469 6f6e 6172 7929 290d 0a20 2020 2020  tionary))..     
-000732e0: 2020 2020 2020 2072 6169 7365 0d0a 0d0a         raise....
-000732f0: 2020 2020 2020 2020 7969 656c 6420 456c          yield El
-00073300: 656d 656e 7428 7368 6f72 746e 616d 6520  ement(shortname 
-00073310: 2020 2020 2020 2020 203d 2073 686f 7274           = short
-00073320: 6e61 6d65 0d0a 2020 2020 2020 2020 2020  name..          
-00073330: 2020 2020 2020 2020 2020 202c 6c6f 6e67             ,long
-00073340: 6e61 6d65 2020 2020 2020 2020 2020 203d  name           =
-00073350: 206c 6f6e 676e 616d 650d 0a20 2020 2020   longname..     
-00073360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073370: 2c64 6573 6372 6970 7469 6f6e 2020 2020  ,description    
-00073380: 2020 2020 3d20 6465 7363 7269 7074 696f      = descriptio
-00073390: 6e0d 0a20 2020 2020 2020 2020 2020 2020  n..             
-000733a0: 2020 2020 2020 2020 2c70 6879 7369 6420          ,physid 
-000733b0: 2020 2020 2020 2020 2020 2020 3d20 7068              = ph
-000733c0: 7973 6964 0d0a 2020 2020 2020 2020 2020  ysid..          
-000733d0: 2020 2020 2020 2020 2020 202c 6772 6f75             ,grou
-000733e0: 705f 6f6e 6c79 2020 2020 2020 2020 203d  p_only         =
-000733f0: 2067 726f 7570 5f6f 6e6c 790d 0a20 2020   group_only..   
-00073400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073410: 2020 2c63 616c 6375 6c61 7469 6f6e 5f73    ,calculation_s
-00073420: 7461 7475 7320 3d20 6361 6c63 756c 6174  tatus = calculat
-00073430: 696f 6e5f 7374 6174 7573 0d0a 2020 2020  ion_status..    
-00073440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073450: 202c 6361 6c63 756c 6174 696f 6e20 2020   ,calculation   
-00073460: 2020 2020 203d 2063 616c 6375 6c61 7469       = calculati
-00073470: 6f6e 0d0a 2020 2020 2020 2020 2020 2020  on..            
-00073480: 2020 2020 2020 2020 202c 636f 6c6f 7572           ,colour
-00073490: 2020 2020 2020 2020 2020 2020 203d 2063               = c
-000734a0: 6f6c 6f75 720d 0a20 2020 2020 2020 2020  olour..         
-000734b0: 2020 2020 2020 2020 2020 2020 2c66 6965              ,fie
-000734c0: 6c64 7320 2020 2020 2020 2020 2020 2020  lds             
-000734d0: 3d20 6669 656c 6473 0d0a 2020 2020 2020  = fields..      
-000734e0: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
-000734f0: 6f76 6572 7269 6465 5f73 686f 7274 6e61  override_shortna
-00073500: 6d65 5f6c 656e 6774 685f 7275 6c65 203d  me_length_rule =
-00073510: 2054 7275 650d 0a20 2020 2020 2020 2020   True..         
-00073520: 2020 2020 2020 2020 2020 2020 2c64 696d              ,dim
-00073530: 656e 7369 6f6e 2020 2020 2020 2020 2020  ension          
-00073540: 3d20 6469 6d65 6e73 696f 6e0d 0a20 2020  = dimension..   
-00073550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073560: 2020 290d 0a0d 0a23 5468 6973 2066 756e    )....#This fun
-00073570: 6374 696f 6e20 7461 6b65 7320 6162 6f75  ction takes abou
-00073580: 7420 6120 7365 636f 6e64 2074 6f20 7275  t a second to ru
-00073590: 6e2c 2061 6e64 2069 7320 6361 6c6c 6564  n, and is called
-000735a0: 206d 756c 7469 706c 6520 7469 6d65 7320   multiple times 
-000735b0: 6475 7269 6e67 2074 6573 7469 6e67 0d0a  during testing..
-000735c0: 2342 7920 6d61 6b69 6e67 2069 7420 6120  #By making it a 
-000735d0: 6e6f 6e2d 6d65 6d62 6572 2066 756e 6374  non-member funct
-000735e0: 696f 6e2c 2077 6520 6361 6e20 6d6f 6e6b  ion, we can monk
-000735f0: 6579 7061 7463 6820 6120 6d65 6d6f 697a  eypatch a memoiz
-00073600: 6564 2076 6572 7369 6f6e 2064 7572 696e  ed version durin
-00073610: 6720 7465 7374 696e 672c 2074 6875 7320  g testing, thus 
-00073620: 7370 6565 6469 6e67 2075 7020 7465 7374  speeding up test
-00073630: 696e 672c 2062 7574 2070 7265 7365 7276  ing, but preserv
-00073640: 696e 6720 696e 7465 6772 6174 696f 6e20  ing integration 
-00073650: 7465 7374 696e 670d 0a23 5468 6520 5f69  testing..#The _i
-00073660: 6e6e 6572 2076 6572 7369 6f6e 206f 6620  nner version of 
-00073670: 7468 6520 6675 6e63 7469 6f6e 2069 7320  the function is 
-00073680: 746f 2070 7265 7665 6e74 2061 2072 6563  to prevent a rec
-00073690: 7572 7369 6f6e 2065 7272 6f72 2077 6865  ursion error whe
-000736a0: 6e20 6d6f 6e6b 6579 7061 7463 6869 6e67  n monkeypatching
-000736b0: 2074 6865 206d 656d 6f69 7a65 6420 7665   the memoized ve
-000736c0: 7273 696f 6e0d 0a64 6566 205f 696e 6e65  rsion..def _inne
-000736d0: 725f 6765 745f 7369 7465 5f64 6574 6169  r_get_site_detai
-000736e0: 6c73 285f 6c6f 676f 6e5f 7061 7261 6d65  ls(_logon_parame
-000736f0: 7465 725f 696d 706f 7274 6572 5f63 6f6d  ter_importer_com
-00073700: 6d61 6e64 732c 656d 706f 7765 725f 696d  mands,empower_im
-00073710: 706f 7274 6572 5f65 7865 6375 7461 626c  porter_executabl
-00073720: 6529 3a0d 0a20 2020 2073 6974 655f 6465  e):..    site_de
-00073730: 7461 696c 733d 7b7d 0d0a 2020 2020 636f  tails={}..    co
-00073740: 6d6d 616e 645f 6c69 7374 203d 206c 6973  mmand_list = lis
-00073750: 7428 5f6c 6f67 6f6e 5f70 6172 616d 6574  t(_logon_paramet
-00073760: 6572 5f69 6d70 6f72 7465 725f 636f 6d6d  er_importer_comm
-00073770: 616e 6473 2920 2b20 5c0d 0a20 2020 2020  ands) + \..     
-00073780: 2020 2020 2020 2020 2020 2020 2020 5b27                ['
-00073790: 656d 706f 7765 722d 6578 706f 7274 2d73  empower-export-s
-000737a0: 6974 652d 6465 7461 696c 7320 2224 7b73  ite-details "${s
-000737b0: 6974 657d 2220 2224 7b75 7365 727d 2220  ite}" "${user}" 
-000737c0: 2224 7b70 6173 7377 6f72 647d 2227 0d0a  "${password}"'..
-000737d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000737e0: 2020 202c 2774 7376 2d65 6e63 6f64 6527     ,'tsv-encode'
-000737f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00073800: 2020 2020 202c 276f 7574 7075 7427 0d0a       ,'output'..
-00073810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00073820: 2020 205d 0d0a 2020 2020 6f75 7470 7574     ]..    output
-00073830: 203d 206c 6c75 2e72 756e 5f73 696e 676c   = llu.run_singl
-00073840: 655f 6f75 7470 7574 5f69 6d70 6f72 7465  e_output_importe
-00073850: 725f 636f 6d6d 616e 6473 2863 6f6d 6d61  r_commands(comma
-00073860: 6e64 5f6c 6973 742c 656d 706f 7765 725f  nd_list,empower_
-00073870: 696d 706f 7274 6572 5f65 7865 6375 7461  importer_executa
-00073880: 626c 653d 656d 706f 7765 725f 696d 706f  ble=empower_impo
-00073890: 7274 6572 5f65 7865 6375 7461 626c 6529  rter_executable)
-000738a0: 0d0a 0d0a 2020 2020 2354 4f44 4f20 7468  ....    #TODO th
-000738b0: 6973 2064 6f65 7320 6e6f 7420 776f 726b  is does not work
-000738c0: 2066 6f72 204c 6f63 6b20 4469 6d65 6e73   for Lock Dimens
-000738d0: 696f 6e73 2077 6869 6368 2061 7265 2074  ions which are t
-000738e0: 6162 2073 6570 6172 6174 6564 2061 6c72  ab separated alr
-000738f0: 6561 6479 0d0a 2020 2020 666f 7220 6b76  eady..    for kv
-00073900: 2069 6e20 6f75 7470 7574 2e73 706c 6974   in output.split
-00073910: 2827 5c72 5c6e 2729 3a0d 0a20 2020 2020  ('\r\n'):..     
-00073920: 2020 206b 765f 7370 6c69 7420 3d20 6b76     kv_split = kv
-00073930: 2e73 706c 6974 2827 5c74 2729 0d0a 2020  .split('\t')..  
-00073940: 2020 2020 2020 6966 206c 656e 286b 765f        if len(kv_
-00073950: 7370 6c69 7429 203e 2031 3a0d 0a20 2020  split) > 1:..   
-00073960: 2020 2020 2020 2020 2073 6974 655f 6465           site_de
-00073970: 7461 696c 735b 6b76 5f73 706c 6974 5b30  tails[kv_split[0
-00073980: 5d5b 313a 5d5d 203d 206b 765f 7370 6c69  ][1:]] = kv_spli
-00073990: 745b 315d 5b3a 2d31 5d0d 0a20 2020 2072  t[1][:-1]..    r
-000739a0: 6574 7572 6e20 7369 7465 5f64 6574 6169  eturn site_detai
-000739b0: 6c73 0d0a 0d0a 6465 6620 5f67 6574 5f73  ls....def _get_s
-000739c0: 6974 655f 6465 7461 696c 7328 5f6c 6f67  ite_details(_log
-000739d0: 6f6e 5f70 6172 616d 6574 6572 5f69 6d70  on_parameter_imp
-000739e0: 6f72 7465 725f 636f 6d6d 616e 6473 2c65  orter_commands,e
-000739f0: 6d70 6f77 6572 5f69 6d70 6f72 7465 725f  mpower_importer_
-00073a00: 6578 6563 7574 6162 6c65 293a 0d0a 2020  executable):..  
-00073a10: 2020 7265 7475 726e 205f 696e 6e65 725f    return _inner_
-00073a20: 6765 745f 7369 7465 5f64 6574 6169 6c73  get_site_details
-00073a30: 285f 6c6f 676f 6e5f 7061 7261 6d65 7465  (_logon_paramete
-00073a40: 725f 696d 706f 7274 6572 5f63 6f6d 6d61  r_importer_comma
-00073a50: 6e64 732c 656d 706f 7765 725f 696d 706f  nds,empower_impo
-00073a60: 7274 6572 5f65 7865 6375 7461 626c 6529  rter_executable)
-00073a70: 0d0a 0d0a 6465 6620 5f63 616c 635f 6461  ....def _calc_da
-00073a80: 7465 5f69 6e66 6f28 7374 6172 745f 6461  te_info(start_da
-00073a90: 7465 5f73 7472 2c69 6e74 6572 7661 6c5f  te_str,interval_
-00073aa0: 696e 6465 782c 6f66 6673 6574 293a 0d0a  index,offset):..
-00073ab0: 2020 2020 5f73 7461 7274 5f64 6174 655f      _start_date_
-00073ac0: 7374 7220 3d20 2073 7461 7274 5f64 6174  str =  start_dat
-00073ad0: 655f 7374 720d 0a20 2020 205f 696e 7465  e_str..    _inte
-00073ae0: 7276 616c 203d 2069 6e74 6572 7661 6c5f  rval = interval_
-00073af0: 696e 6465 780d 0a20 2020 205f 6f66 6673  index..    _offs
-00073b00: 6574 203d 206f 6666 7365 740d 0a0d 0a20  et = offset.... 
-00073b10: 2020 2069 6620 5f73 7461 7274 5f64 6174     if _start_dat
-00073b20: 655f 7374 7220 6973 204e 6f6e 653a 0d0a  e_str is None:..
-00073b30: 2020 2020 2020 2020 5f64 6174 6520 3d20          _date = 
-00073b40: 4e6f 6e65 0d0a 2020 2020 656c 7365 3a0d  None..    else:.
-00073b50: 0a20 2020 2020 2020 2069 6620 5f69 6e74  .        if _int
-00073b60: 6572 7661 6c20 3d3d 206c 6c75 2e45 4d50  erval == llu.EMP
-00073b70: 4f57 4552 5f44 4159 5f43 4f4e 5354 414e  OWER_DAY_CONSTAN
-00073b80: 543a 0d0a 0d0a 2020 2020 2020 2020 2020  T:....          
-00073b90: 2020 235f 7374 6172 745f 6461 7465 5f73    #_start_date_s
-00073ba0: 7472 2077 696c 6c20 6265 206f 6620 7468  tr will be of th
-00073bb0: 6520 666f 726d 2027 3230 3131 2720 666f  e form '2011' fo
-00073bc0: 7220 4a61 6e20 3230 3131 2c20 2731 2e32  r Jan 2011, '1.2
-00073bd0: 3031 3127 2066 6f72 2046 6562 2032 3031  011' for Feb 201
-00073be0: 310d 0a0d 0a20 2020 2020 2020 2020 2020  1....           
-00073bf0: 2064 6179 203d 204e 6f6e 650d 0a20 2020   day = None..   
-00073c00: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-00073c10: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-00073c20: 6561 7220 3d20 696e 7428 5f73 7461 7274  ear = int(_start
-00073c30: 5f64 6174 655f 7374 722e 7370 6c69 7428  _date_str.split(
-00073c40: 272e 2729 5b31 5d29 0d0a 2020 2020 2020  '.')[1])..      
-00073c50: 2020 2020 2020 6578 6365 7074 2049 6e64        except Ind
-00073c60: 6578 4572 726f 723a 0d0a 2020 2020 2020  exError:..      
-00073c70: 2020 2020 2020 2020 2020 6461 7920 3d20            day = 
-00073c80: 310d 0a20 2020 2020 2020 2020 2020 2020  1..             
-00073c90: 2020 2079 6561 7220 3d20 696e 7428 5f73     year = int(_s
-00073ca0: 7461 7274 5f64 6174 655f 7374 7229 0d0a  tart_date_str)..
-00073cb0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00073cc0: 2064 6179 2069 7320 4e6f 6e65 3a0d 0a20   day is None:.. 
-00073cd0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00073ce0: 6179 203d 2069 6e74 285f 7374 6172 745f  ay = int(_start_
-00073cf0: 6461 7465 5f73 7472 2e73 706c 6974 2827  date_str.split('
-00073d00: 2e27 295b 305d 2920 2b31 0d0a 0d0a 2020  .')[0]) +1....  
-00073d10: 2020 2020 2020 2020 2020 2352 6574 7572            #Retur
-00073d20: 6e20 3173 7420 6f66 206d 6f6e 7468 202d  n 1st of month -
-00073d30: 2074 6869 7320 6973 6e27 7420 636f 7272   this isn't corr
-00073d40: 6563 740d 0a20 2020 2020 2020 2020 2020  ect..           
-00073d50: 205f 6461 7465 203d 2020 6461 7465 7469   _date =  dateti
-00073d60: 6d65 2e64 6174 6574 696d 6528 7965 6172  me.datetime(year
-00073d70: 2c31 2c31 2920 2b20 2864 6179 202a 2044  ,1,1) + (day * D
-00073d80: 4159 290d 0a20 2020 2020 2020 2020 2020  AY)..           
-00073d90: 2023 5f64 6174 6520 3d20 4e6f 6e65 0d0a   #_date = None..
-00073da0: 2020 2020 2020 2020 656c 6966 205f 696e          elif _in
-00073db0: 7465 7276 616c 203d 3d20 6c6c 752e 454d  terval == llu.EM
-00073dc0: 504f 5745 525f 5745 454b 5f43 4f4e 5354  POWER_WEEK_CONST
-00073dd0: 414e 543a 0d0a 0d0a 2020 2020 2020 2020  ANT:....        
-00073de0: 2020 2020 2373 656c 662e 5f73 7461 7274      #self._start
-00073df0: 5f64 6174 655f 7374 7220 7769 6c6c 2062  _date_str will b
-00073e00: 6520 6f66 2074 6865 2066 6f72 6d20 2732  e of the form '2
-00073e10: 3031 3127 2066 6f72 2051 3120 3230 3131  011' for Q1 2011
-00073e20: 2c20 2735 2e32 3031 3127 2066 6f72 2051  , '5.2011' for Q
-00073e30: 3320 3230 3131 0d0a 2020 2020 2020 2020  3 2011..        
-00073e40: 2020 2020 6461 7920 3d20 4e6f 6e65 0d0a      day = None..
-00073e50: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00073e60: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00073e70: 2020 7965 6172 203d 2069 6e74 285f 7374    year = int(_st
-00073e80: 6172 745f 6461 7465 5f73 7472 2e73 706c  art_date_str.spl
-00073e90: 6974 2827 2e27 295b 315d 290d 0a20 2020  it('.')[1])..   
-00073ea0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-00073eb0: 496e 6465 7845 7272 6f72 3a0d 0a20 2020  IndexError:..   
-00073ec0: 2020 2020 2020 2020 2020 2020 2064 6179               day
-00073ed0: 203d 2031 0d0a 2020 2020 2020 2020 2020   = 1..          
-00073ee0: 2020 2020 2020 7965 6172 203d 2069 6e74        year = int
-00073ef0: 285f 7374 6172 745f 6461 7465 5f73 7472  (_start_date_str
-00073f00: 290d 0a0d 0a20 2020 2020 2020 2020 2020  )....           
-00073f10: 2069 6620 6461 7920 6973 204e 6f6e 653a   if day is None:
-00073f20: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00073f30: 2020 6461 7920 3d20 696e 7428 5f73 7461    day = int(_sta
-00073f40: 7274 5f64 6174 655f 7374 722e 7370 6c69  rt_date_str.spli
-00073f50: 7428 272e 2729 5b30 5d29 202b 310d 0a0d  t('.')[0]) +1...
-00073f60: 0a20 2020 2020 2020 2020 2020 2023 5265  .            #Re
-00073f70: 7475 726e 2031 7374 206f 6620 6d6f 6e74  turn 1st of mont
-00073f80: 6820 2d20 7468 6973 2069 736e 2774 2063  h - this isn't c
-00073f90: 6f72 7265 6374 0d0a 2020 2020 2020 2020  orrect..        
-00073fa0: 2020 2020 5f64 6174 6520 3d20 2064 6174      _date =  dat
-00073fb0: 6574 696d 652e 6461 7465 7469 6d65 2879  etime.datetime(y
-00073fc0: 6561 722c 312c 3129 202b 2028 6461 7920  ear,1,1) + (day 
-00073fd0: 2a20 4441 5929 0d0a 2020 2020 2020 2020  * DAY)..        
-00073fe0: 2020 2020 235f 6461 7465 203d 204e 6f6e      #_date = Non
-00073ff0: 650d 0a0d 0a20 2020 2020 2020 2065 6c69  e....        eli
-00074000: 6620 5f69 6e74 6572 7661 6c20 3d3d 206c  f _interval == l
-00074010: 6c75 2e45 4d50 4f57 4552 5f4d 4f4e 5448  lu.EMPOWER_MONTH
-00074020: 5f43 4f4e 5354 414e 543a 0d0a 0d0a 2020  _CONSTANT:....  
-00074030: 2020 2020 2020 2020 2020 235f 7374 6172            #_star
-00074040: 745f 6461 7465 5f73 7472 2077 696c 6c20  t_date_str will 
-00074050: 6265 206f 6620 7468 6520 666f 726d 2027  be of the form '
-00074060: 3230 3131 2720 666f 7220 4a61 6e20 3230  2011' for Jan 20
-00074070: 3131 2c20 2731 2e32 3031 3127 2066 6f72  11, '1.2011' for
-00074080: 2046 6562 2032 3031 310d 0a0d 0a20 2020   Feb 2011....   
-00074090: 2020 2020 2020 2020 206d 6f6e 7468 203d           month =
-000740a0: 204e 6f6e 650d 0a20 2020 2020 2020 2020   None..         
-000740b0: 2020 2074 7279 3a0d 0a20 2020 2020 2020     try:..       
-000740c0: 2020 2020 2020 2020 2079 6561 7220 3d20           year = 
-000740d0: 696e 7428 5f73 7461 7274 5f64 6174 655f  int(_start_date_
-000740e0: 7374 722e 7370 6c69 7428 272e 2729 5b31  str.split('.')[1
-000740f0: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
-00074100: 6578 6365 7074 2049 6e64 6578 4572 726f  except IndexErro
-00074110: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
-00074120: 2020 2020 6d6f 6e74 6820 3d20 310d 0a20      month = 1.. 
-00074130: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-00074140: 6561 7220 3d20 696e 7428 5f73 7461 7274  ear = int(_start
-00074150: 5f64 6174 655f 7374 7229 0d0a 0d0a 2020  _date_str)....  
-00074160: 2020 2020 2020 2020 2020 6966 206d 6f6e            if mon
-00074170: 7468 2069 7320 4e6f 6e65 3a0d 0a20 2020  th is None:..   
-00074180: 2020 2020 2020 2020 2020 2020 206d 6f6e               mon
-00074190: 7468 203d 2069 6e74 285f 7374 6172 745f  th = int(_start_
-000741a0: 6461 7465 5f73 7472 2e73 706c 6974 2827  date_str.split('
-000741b0: 2e27 295b 305d 2920 2b31 0d0a 0d0a 2020  .')[0]) +1....  
-000741c0: 2020 2020 2020 2020 2020 2352 6574 7572            #Retur
-000741d0: 6e20 3173 7420 6f66 206d 6f6e 7468 0d0a  n 1st of month..
-000741e0: 2020 2020 2020 2020 2020 2020 5f64 6174              _dat
-000741f0: 6520 3d20 2064 6174 6574 696d 652e 6461  e =  datetime.da
-00074200: 7465 7469 6d65 2879 6561 722c 6d6f 6e74  tetime(year,mont
-00074210: 682c 3129 0d0a 0d0a 2020 2020 2020 2020  h,1)....        
-00074220: 656c 6966 205f 696e 7465 7276 616c 203d  elif _interval =
-00074230: 3d20 6c6c 752e 454d 504f 5745 525f 5155  = llu.EMPOWER_QU
-00074240: 4152 5445 525f 434f 4e53 5441 4e54 3a0d  ARTER_CONSTANT:.
-00074250: 0a0d 0a20 2020 2020 2020 2020 2020 2023  ...            #
-00074260: 7365 6c66 2e5f 7374 6172 745f 6461 7465  self._start_date
-00074270: 5f73 7472 2077 696c 6c20 6265 206f 6620  _str will be of 
-00074280: 7468 6520 666f 726d 2027 3230 3131 2720  the form '2011' 
-00074290: 666f 7220 5131 2032 3031 312c 2027 352e  for Q1 2011, '5.
-000742a0: 3230 3131 2720 666f 7220 5133 2032 3031  2011' for Q3 201
-000742b0: 310d 0a20 2020 2020 2020 2020 2020 206d  1..            m
-000742c0: 6f6e 7468 203d 204e 6f6e 650d 0a20 2020  onth = None..   
-000742d0: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
-000742e0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
-000742f0: 6561 7220 3d20 696e 7428 5f73 7461 7274  ear = int(_start
-00074300: 5f64 6174 655f 7374 722e 7370 6c69 7428  _date_str.split(
-00074310: 272e 2729 5b31 5d29 0d0a 2020 2020 2020  '.')[1])..      
-00074320: 2020 2020 2020 6578 6365 7074 2049 6e64        except Ind
-00074330: 6578 4572 726f 723a 0d0a 2020 2020 2020  exError:..      
-00074340: 2020 2020 2020 2020 2020 6d6f 6e74 6820            month 
-00074350: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
-00074360: 2020 2020 2079 6561 7220 3d20 696e 7428       year = int(
-00074370: 5f73 7461 7274 5f64 6174 655f 7374 7229  _start_date_str)
-00074380: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-00074390: 6966 206d 6f6e 7468 2069 7320 4e6f 6e65  if month is None
-000743a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000743b0: 2020 206d 6f6e 7468 203d 2069 6e74 285f     month = int(_
-000743c0: 7374 6172 745f 6461 7465 5f73 7472 2e73  start_date_str.s
-000743d0: 706c 6974 2827 2e27 295b 305d 2920 2b31  plit('.')[0]) +1
-000743e0: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
-000743f0: 2352 6574 7572 6e20 3173 7420 6461 7465  #Return 1st date
-00074400: 206f 6620 7175 6172 7465 720d 0a20 2020   of quarter..   
-00074410: 2020 2020 2020 2020 2023 7175 6172 7465           #quarte
-00074420: 7220 2a20 3320 2d20 3220 6769 7665 7320  r * 3 - 2 gives 
-00074430: 6669 7273 7420 6d6f 6e74 6820 6f66 2071  first month of q
-00074440: 7561 7274 6572 0d0a 2020 2020 2020 2020  uarter..        
-00074450: 2020 2020 5f64 6174 6520 3d20 2064 6174      _date =  dat
-00074460: 6574 696d 652e 6461 7465 7469 6d65 2879  etime.datetime(y
-00074470: 6561 722c 6d6f 6e74 682c 3129 0d0a 0d0a  ear,month,1)....
-00074480: 2020 2020 2020 2020 656c 6966 205f 696e          elif _in
-00074490: 7465 7276 616c 203d 3d20 6c6c 752e 454d  terval == llu.EM
-000744a0: 504f 5745 525f 4841 4c46 5945 4152 5f43  POWER_HALFYEAR_C
-000744b0: 4f4e 5354 414e 543a 0d0a 0d0a 2020 2020  ONSTANT:....    
-000744c0: 2020 2020 2020 2020 2373 656c 662e 5f73          #self._s
-000744d0: 7461 7274 5f64 6174 655f 7374 7220 7769  tart_date_str wi
-000744e0: 6c6c 2062 6520 6f66 2074 6865 2066 6f72  ll be of the for
-000744f0: 6d20 2732 3031 3127 2066 6f72 2048 3120  m '2011' for H1 
-00074500: 3230 3131 2c20 2735 2e32 3031 3127 2066  2011, '5.2011' f
-00074510: 6f72 2048 3220 3230 3131 0d0a 2020 2020  or H2 2011..    
-00074520: 2020 2020 2020 2020 6d6f 6e74 6820 3d20          month = 
-00074530: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
-00074540: 2020 7472 793a 0d0a 2020 2020 2020 2020    try:..        
-00074550: 2020 2020 2020 2020 7965 6172 203d 2069          year = i
-00074560: 6e74 285f 7374 6172 745f 6461 7465 5f73  nt(_start_date_s
-00074570: 7472 2e73 706c 6974 2827 2e27 295b 315d  tr.split('.')[1]
-00074580: 290d 0a20 2020 2020 2020 2020 2020 2065  )..            e
-00074590: 7863 6570 7420 496e 6465 7845 7272 6f72  xcept IndexError
-000745a0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000745b0: 2020 206d 6f6e 7468 203d 2031 0d0a 2020     month = 1..  
-000745c0: 2020 2020 2020 2020 2020 2020 2020 7965                ye
-000745d0: 6172 203d 2069 6e74 285f 7374 6172 745f  ar = int(_start_
-000745e0: 6461 7465 5f73 7472 290d 0a0d 0a20 2020  date_str)....   
-000745f0: 2020 2020 2020 2020 2069 6620 6d6f 6e74           if mont
-00074600: 6820 6973 204e 6f6e 653a 0d0a 2020 2020  h is None:..    
-00074610: 2020 2020 2020 2020 2020 2020 6d6f 6e74              mont
-00074620: 6820 3d20 360d 0a0d 0a20 2020 2020 2020  h = 6....       
-00074630: 2020 2020 2023 5265 7475 726e 2031 7374       #Return 1st
-00074640: 2064 6174 6520 6f66 2068 616c 660d 0a20   date of half.. 
-00074650: 2020 2020 2020 2020 2020 205f 6461 7465             _date
-00074660: 203d 2020 6461 7465 7469 6d65 2e64 6174   =  datetime.dat
-00074670: 6574 696d 6528 7965 6172 2c6d 6f6e 7468  etime(year,month
-00074680: 2c31 290d 0a0d 0a0d 0a20 2020 2020 2020  ,1)......       
-00074690: 2065 6c69 6620 5f69 6e74 6572 7661 6c20   elif _interval 
-000746a0: 3d3d 206c 6c75 2e45 4d50 4f57 4552 5f59  == llu.EMPOWER_Y
-000746b0: 4541 525f 434f 4e53 5441 4e54 3a0d 0a0d  EAR_CONSTANT:...
-000746c0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-000746d0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
-000746e0: 2020 2079 6561 7220 3d20 696e 7428 5f73     year = int(_s
-000746f0: 7461 7274 5f64 6174 655f 7374 722e 7370  tart_date_str.sp
-00074700: 6c69 7428 272e 2729 5b31 5d29 0d0a 2020  lit('.')[1])..  
-00074710: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00074720: 2049 6e64 6578 4572 726f 723a 0d0a 2020   IndexError:..  
-00074730: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-00074740: 6e74 6820 3d20 310d 0a20 2020 2020 2020  nth = 1..       
-00074750: 2020 2020 2020 2020 2079 6561 7220 3d20           year = 
-00074760: 696e 7428 5f73 7461 7274 5f64 6174 655f  int(_start_date_
-00074770: 7374 7229 0d0a 2020 2020 2020 2020 2020  str)..          
-00074780: 2020 2352 6574 7572 6e20 4a61 6e75 6172    #Return Januar
-00074790: 7920 3173 7420 6f66 2079 6561 720d 0a20  y 1st of year.. 
-000747a0: 2020 2020 2020 2020 2020 205f 6461 7465             _date
-000747b0: 203d 2020 6461 7465 7469 6d65 2e64 6174   =  datetime.dat
-000747c0: 6574 696d 6528 7965 6172 2c31 2c31 290d  etime(year,1,1).
-000747d0: 0a20 2020 2020 2020 2065 6c73 653a 0d0a  .        else:..
-000747e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000747f0: 6520 5661 6c75 6545 7272 6f72 2827 4e6f  e ValueError('No
-00074800: 7420 496d 706c 656d 656e 7465 642e 2044  t Implemented. D
-00074810: 6174 6520 6d61 7070 696e 6720 6672 6f6d  ate mapping from
-00074820: 2045 6c65 6d65 6e74 7320 6172 6520 6f6e   Elements are on
-00074830: 6c79 2069 6d70 6c65 6d65 6e74 6564 2066  ly implemented f
-00074840: 6f72 2064 6179 2c20 7765 656b 2c20 6d6f  or day, week, mo
-00074850: 6e74 682c 2071 7561 7274 6572 2c20 6861  nth, quarter, ha
-00074860: 6c66 2d79 6561 7220 616e 6420 7965 6172  lf-year and year
-00074870: 2069 6e74 6572 7661 6c73 2c20 676f 7420   intervals, got 
-00074880: 7b7d 2069 6e74 6572 7661 6c5f 696e 6465  {} interval_inde
-00074890: 7827 2e66 6f72 6d61 7428 696e 7465 7276  x'.format(interv
-000748a0: 616c 5f69 6e64 6578 2929 0d0a 0d0a 2020  al_index))....  
-000748b0: 2020 7265 7475 726e 205f 6461 7465 0d0a    return _date..
-000748c0: 0d0a 2354 6869 7320 6675 6e63 7469 6f6e  ..#This function
-000748d0: 2074 616b 6573 2061 626f 7574 2061 2030   takes about a 0
-000748e0: 2e32 2073 6563 6f6e 6473 2074 6f20 7275  .2 seconds to ru
-000748f0: 6e2c 2061 6e64 2069 7320 6361 6c6c 6564  n, and is called
-00074900: 206d 756c 7469 706c 6520 7469 6d65 7320   multiple times 
-00074910: 6475 7269 6e67 2074 6573 7469 6e67 0d0a  during testing..
-00074920: 2342 7920 6d61 6b69 6e67 2069 7420 6120  #By making it a 
-00074930: 6e6f 6e2d 6d65 6d62 6572 2066 756e 6374  non-member funct
-00074940: 696f 6e2c 2077 6520 6361 6e20 6d6f 6e6b  ion, we can monk
-00074950: 6579 7061 7463 6820 6120 6d65 6d6f 697a  eypatch a memoiz
-00074960: 6564 2076 6572 7369 6f6e 2064 7572 696e  ed version durin
-00074970: 6720 7465 7374 696e 672c 2074 6875 7320  g testing, thus 
-00074980: 7370 6565 6469 6e67 2075 7020 7465 7374  speeding up test
-00074990: 696e 672c 2062 7574 2070 7265 7365 7276  ing, but preserv
-000749a0: 696e 6720 696e 7465 6772 6174 696f 6e20  ing integration 
-000749b0: 7465 7374 696e 670d 0a23 5468 6520 5f69  testing..#The _i
-000749c0: 6e6e 6572 2076 6572 7369 6f6e 206f 6620  nner version of 
-000749d0: 7468 6520 6675 6e63 7469 6f6e 2069 7320  the function is 
-000749e0: 746f 2070 7265 7665 6e74 2061 2072 6563  to prevent a rec
-000749f0: 7572 7369 6f6e 2065 7272 6f72 2077 6865  ursion error whe
-00074a00: 6e20 6d6f 6e6b 6579 7061 7463 6869 6e67  n monkeypatching
-00074a10: 2074 6865 206d 656d 6f69 7a65 6420 7665   the memoized ve
-00074a20: 7273 696f 6e0d 0a64 6566 205f 696e 6e65  rsion..def _inne
-00074a30: 725f 6765 745f 696d 706f 7274 6572 5f76  r_get_importer_v
-00074a40: 6572 7369 6f6e 2865 6d70 6f77 6572 5f69  ersion(empower_i
-00074a50: 6d70 6f72 7465 725f 6578 6563 7574 6162  mporter_executab
-00074a60: 6c65 293a 0d0a 0d0a 2020 2020 696d 706f  le):....    impo
-00074a70: 7274 6572 5f73 6372 6970 743d 706b 675f  rter_script=pkg_
-00074a80: 7265 736f 7572 6365 732e 7265 736f 7572  resources.resour
-00074a90: 6365 5f66 696c 656e 616d 6528 2770 796d  ce_filename('pym
-00074aa0: 7078 272c 2769 6d70 6f72 7465 725f 7363  px','importer_sc
-00074ab0: 7269 7074 732f 5665 7273 696f 6e2e 6569  ripts/Version.ei
-00074ac0: 6d70 2729 0d0a 2020 2020 6f75 7470 7574  mp')..    output
-00074ad0: 203d 206c 6c75 2e72 756e 5f65 6d70 6f77   = llu.run_empow
-00074ae0: 6572 5f69 6d70 6f72 7465 725f 7363 7269  er_importer_scri
-00074af0: 7074 2873 6372 6970 743d 696d 706f 7274  pt(script=import
-00074b00: 6572 5f73 6372 6970 740d 0a20 2020 2020  er_script..     
-00074b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074b20: 2020 202c 656d 706f 7765 725f 696d 706f     ,empower_impo
-00074b30: 7274 6572 5f65 7865 6375 7461 626c 653d  rter_executable=
-00074b40: 656d 706f 7765 725f 696d 706f 7274 6572  empower_importer
-00074b50: 5f65 7865 6375 7461 626c 650d 0a20 2020  _executable..   
-00074b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00074b70: 2020 2020 2029 0d0a 0d0a 2020 2020 7265       )....    re
-00074b80: 7475 726e 205b 696e 7428 7329 2066 6f72  turn [int(s) for
-00074b90: 2073 2069 6e20 6f75 7470 7574 2e73 7472   s in output.str
-00074ba0: 6970 2829 2e73 706c 6974 2827 2e27 295d  ip().split('.')]
-00074bb0: 0d0a 0d0a 6465 6620 5f67 6574 5f69 6d70  ....def _get_imp
-00074bc0: 6f72 7465 725f 7665 7273 696f 6e28 656d  orter_version(em
-00074bd0: 706f 7765 725f 696d 706f 7274 6572 5f65  power_importer_e
-00074be0: 7865 6375 7461 626c 6529 3a0d 0a20 2020  xecutable):..   
-00074bf0: 2072 6574 7572 6e20 5f69 6e6e 6572 5f67   return _inner_g
-00074c00: 6574 5f69 6d70 6f72 7465 725f 7665 7273  et_importer_vers
-00074c10: 696f 6e28 656d 706f 7765 725f 696d 706f  ion(empower_impo
-00074c20: 7274 6572 5f65 7865 6375 7461 626c 6529  rter_executable)
-00074c30: 0d0a 0d0a 6465 6620 5f64 6966 6628 6f6c  ....def _diff(ol
-00074c40: 642c 206e 6577 293a 0d0a 2020 2020 2727  d, new):..    ''
-00074c50: 270d 0a20 2020 2046 696e 6420 7468 6520  '..    Find the 
-00074c60: 6469 6666 6572 656e 6365 7320 6265 7477  differences betw
-00074c70: 6565 6e20 7477 6f20 6c69 7374 732e 2052  een two lists. R
-00074c80: 6574 7572 6e73 2061 206c 6973 7420 6f66  eturns a list of
-00074c90: 2070 6169 7273 2c20 7768 6572 6520 7468   pairs, where th
-00074ca0: 650d 0a20 2020 2066 6972 7374 2076 616c  e..    first val
-00074cb0: 7565 2069 7320 696e 205b 272b 272c 272d  ue is in ['+','-
-00074cc0: 272c 273d 275d 2061 6e64 2072 6570 7265  ','='] and repre
-00074cd0: 7365 6e74 7320 616e 2069 6e73 6572 7469  sents an inserti
-00074ce0: 6f6e 2c20 6465 6c65 7469 6f6e 2c20 6f72  on, deletion, or
-00074cf0: 0d0a 2020 2020 6e6f 2063 6861 6e67 6520  ..    no change 
-00074d00: 666f 7220 7468 6174 206c 6973 742e 2054  for that list. T
-00074d10: 6865 2073 6563 6f6e 6420 7661 6c75 6520  he second value 
-00074d20: 6f66 2074 6865 2070 6169 7220 6973 2074  of the pair is t
-00074d30: 6865 206c 6973 740d 0a20 2020 206f 6620  he list..    of 
-00074d40: 656c 656d 656e 7473 2e0d 0a20 2020 2050  elements...    P
-00074d50: 6172 616d 733a 0d0a 2020 2020 2020 2020  arams:..        
-00074d60: 6f6c 6420 2020 2020 7468 6520 6f6c 6420  old     the old 
-00074d70: 6c69 7374 206f 6620 696d 6d75 7461 626c  list of immutabl
-00074d80: 652c 2063 6f6d 7061 7261 626c 6520 7661  e, comparable va
-00074d90: 6c75 6573 2028 6965 2e20 6120 6c69 7374  lues (ie. a list
-00074da0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00074db0: 2020 6f66 2073 7472 696e 6773 290d 0a20    of strings).. 
-00074dc0: 2020 2020 2020 206e 6577 2020 2020 2074         new     t
-00074dd0: 6865 206e 6577 206c 6973 7420 6f66 2069  he new list of i
-00074de0: 6d6d 7574 6162 6c65 2c20 636f 6d70 6172  mmutable, compar
-00074df0: 6162 6c65 2076 616c 7565 730d 0a0d 0a20  able values.... 
-00074e00: 2020 2052 6574 7572 6e73 3a0d 0a20 2020     Returns:..   
-00074e10: 2020 2020 2041 206c 6973 7420 6f66 2070       A list of p
-00074e20: 6169 7273 2c20 7769 7468 2074 6865 2066  airs, with the f
-00074e30: 6972 7374 2070 6172 7420 6f66 2074 6865  irst part of the
-00074e40: 2070 6169 7220 6265 696e 6720 6f6e 6520   pair being one 
-00074e50: 6f66 2074 6872 6565 0d0a 2020 2020 2020  of three..      
-00074e60: 2020 7374 7269 6e67 7320 2827 2d27 2c20    strings ('-', 
-00074e70: 272b 272c 2027 3d27 2920 616e 6420 7468  '+', '=') and th
-00074e80: 6520 7365 636f 6e64 2070 6172 7420 6265  e second part be
-00074e90: 696e 6720 6120 6c69 7374 206f 6620 7661  ing a list of va
-00074ea0: 6c75 6573 2066 726f 6d0d 0a20 2020 2020  lues from..     
-00074eb0: 2020 2074 6865 206f 7269 6769 6e61 6c20     the original 
-00074ec0: 6f6c 6420 616e 642f 6f72 206e 6577 206c  old and/or new l
-00074ed0: 6973 7473 2e20 5468 6520 6669 7273 7420  ists. The first 
-00074ee0: 7061 7274 206f 6620 7468 6520 7061 6972  part of the pair
-00074ef0: 0d0a 2020 2020 2020 2020 636f 7272 6573  ..        corres
-00074f00: 706f 6e64 7320 746f 2077 6865 7468 6572  ponds to whether
-00074f10: 2074 6865 206c 6973 7420 6f66 2076 616c   the list of val
-00074f20: 7565 7320 6973 2061 2064 656c 6574 696f  ues is a deletio
-00074f30: 6e2c 2069 6e73 6572 7469 6f6e 2c20 6f72  n, insertion, or
-00074f40: 0d0a 2020 2020 2020 2020 756e 6368 616e  ..        unchan
-00074f50: 6765 642c 2072 6573 7065 6374 6976 656c  ged, respectivel
-00074f60: 792e 0d0a 2020 2020 4578 616d 706c 6573  y...    Examples
-00074f70: 3a0d 0a20 2020 2020 2020 203e 3e3e 205f  :..        >>> _
-00074f80: 6469 6666 285b 312c 322c 332c 345d 2c5b  diff([1,2,3,4],[
-00074f90: 312c 332c 345d 290d 0a20 2020 2020 2020  1,3,4])..       
-00074fa0: 205b 2827 3d27 2c20 5b31 5d29 2c20 2827   [('=', [1]), ('
-00074fb0: 2d27 2c20 5b32 5d29 2c20 2827 3d27 2c20  -', [2]), ('=', 
-00074fc0: 5b33 2c20 345d 295d 0d0a 2020 2020 2020  [3, 4])]..      
-00074fd0: 2020 3e3e 3e20 5f64 6966 6628 5b31 2c32    >>> _diff([1,2
-00074fe0: 2c33 2c34 5d2c 5b32 2c33 2c34 2c31 5d29  ,3,4],[2,3,4,1])
-00074ff0: 0d0a 2020 2020 2020 2020 5b28 272d 272c  ..        [('-',
-00075000: 205b 315d 292c 2028 273d 272c 205b 322c   [1]), ('=', [2,
-00075010: 2033 2c20 345d 292c 2028 272b 272c 205b   3, 4]), ('+', [
-00075020: 315d 295d 0d0a 2020 2020 2020 2020 3e3e  1])]..        >>
-00075030: 3e20 5f64 6966 6628 2754 6865 2071 7569  > _diff('The qui
-00075040: 636b 2062 726f 776e 2066 6f78 206a 756d  ck brown fox jum
-00075050: 7073 206f 7665 7220 7468 6520 6c61 7a79  ps over the lazy
-00075060: 2064 6f67 272e 7370 6c69 7428 292c 0d0a   dog'.split(),..
-00075070: 2020 2020 2020 2020 2e2e 2e20 2020 2020          ...     
-00075080: 2027 5468 6520 736c 6f77 2062 6c75 6520   'The slow blue 
-00075090: 6368 6565 7365 2064 7269 7073 206f 7665  cheese drips ove
-000750a0: 7220 7468 6520 6c61 7a79 2063 6172 726f  r the lazy carro
-000750b0: 7427 2e73 706c 6974 2829 290d 0a20 2020  t'.split())..   
-000750c0: 2020 2020 202e 2e2e 2023 2064 6f63 7465       ... # docte
-000750d0: 7374 3a20 2b4e 4f52 4d41 4c49 5a45 5f57  st: +NORMALIZE_W
-000750e0: 4849 5445 5350 4143 450d 0a20 2020 2020  HITESPACE..     
-000750f0: 2020 205b 2827 3d27 2c20 5b27 5468 6527     [('=', ['The'
-00075100: 5d29 2c0d 0a20 2020 2020 2020 2020 2827  ]),..         ('
-00075110: 2d27 2c20 5b27 7175 6963 6b27 2c20 2762  -', ['quick', 'b
-00075120: 726f 776e 272c 2027 666f 7827 2c20 276a  rown', 'fox', 'j
-00075130: 756d 7073 275d 292c 0d0a 2020 2020 2020  umps']),..      
-00075140: 2020 2028 272b 272c 205b 2773 6c6f 7727     ('+', ['slow'
-00075150: 2c20 2762 6c75 6527 2c20 2763 6865 6573  , 'blue', 'chees
-00075160: 6527 2c20 2764 7269 7073 275d 292c 0d0a  e', 'drips']),..
-00075170: 2020 2020 2020 2020 2028 273d 272c 205b           ('=', [
-00075180: 276f 7665 7227 2c20 2774 6865 272c 2027  'over', 'the', '
-00075190: 6c61 7a79 275d 292c 0d0a 2020 2020 2020  lazy']),..      
-000751a0: 2020 2028 272d 272c 205b 2764 6f67 275d     ('-', ['dog']
-000751b0: 292c 0d0a 2020 2020 2020 2020 2028 272b  ),..         ('+
-000751c0: 272c 205b 2763 6172 726f 7427 5d29 5d0d  ', ['carrot'])].
-000751d0: 0a20 2020 2027 2727 0d0a 0d0a 2020 2020  .    '''....    
-000751e0: 2320 4372 6561 7465 2061 206d 6170 2066  # Create a map f
-000751f0: 726f 6d20 6f6c 6420 7661 6c75 6573 2074  rom old values t
-00075200: 6f20 7468 6569 7220 696e 6469 6365 730d  o their indices.
-00075210: 0a20 2020 206f 6c64 5f69 6e64 6578 5f6d  .    old_index_m
-00075220: 6170 203d 2064 6963 7428 290d 0a20 2020  ap = dict()..   
-00075230: 2066 6f72 2069 2c20 7661 6c20 696e 2065   for i, val in e
-00075240: 6e75 6d65 7261 7465 286f 6c64 293a 0d0a  numerate(old):..
-00075250: 2020 2020 2020 2020 6f6c 645f 696e 6465          old_inde
-00075260: 785f 6d61 702e 7365 7464 6566 6175 6c74  x_map.setdefault
-00075270: 2876 616c 2c6c 6973 7428 2929 2e61 7070  (val,list()).app
-00075280: 656e 6428 6929 0d0a 0d0a 2020 2020 2320  end(i)....    # 
-00075290: 4669 6e64 2074 6865 206c 6172 6765 7374  Find the largest
-000752a0: 2073 7562 7374 7269 6e67 2063 6f6d 6d6f   substring commo
-000752b0: 6e20 746f 206f 6c64 2061 6e64 206e 6577  n to old and new
-000752c0: 2e0d 0a20 2020 2023 2057 6520 7573 6520  ...    # We use 
-000752d0: 6120 6479 6e61 6d69 6320 7072 6f67 7261  a dynamic progra
-000752e0: 6d6d 696e 6720 6170 7072 6f61 6368 2068  mming approach h
-000752f0: 6572 652e 0d0a 2020 2020 230d 0a20 2020  ere...    #..   
-00075300: 2023 2057 6520 6974 6572 6174 6520 6f76   # We iterate ov
-00075310: 6572 2065 6163 6820 7661 6c75 6520 696e  er each value in
-00075320: 2074 6865 2060 6e65 7760 206c 6973 742c   the `new` list,
-00075330: 2063 616c 6c69 6e67 2074 6865 0d0a 2020   calling the..  
-00075340: 2020 2320 696e 6465 7820 6069 6e65 7760    # index `inew`
-00075350: 2e20 4174 2065 6163 6820 6974 6572 6174  . At each iterat
-00075360: 696f 6e2c 2060 6f76 6572 6c61 705b 695d  ion, `overlap[i]
-00075370: 6020 6973 2074 6865 0d0a 2020 2020 2320  ` is the..    # 
-00075380: 6c65 6e67 7468 206f 6620 7468 6520 6c61  length of the la
-00075390: 7267 6573 7420 7375 6666 6978 206f 6620  rgest suffix of 
-000753a0: 606f 6c64 5b3a 695d 6020 6571 7561 6c20  `old[:i]` equal 
-000753b0: 746f 2061 2073 7566 6669 780d 0a20 2020  to a suffix..   
-000753c0: 2023 206f 6620 606e 6577 5b3a 696e 6577   # of `new[:inew
-000753d0: 5d60 2028 6f72 2075 6e73 6574 2077 6865  ]` (or unset whe
-000753e0: 6e20 606f 6c64 5b69 5d60 2021 3d20 606e  n `old[i]` != `n
-000753f0: 6577 5b69 6e65 775d 6029 2e0d 0a20 2020  ew[inew]`)...   
-00075400: 2023 0d0a 2020 2020 2320 4174 2065 6163   #..    # At eac
-00075410: 6820 7374 6167 6520 6f66 2069 7465 7261  h stage of itera
-00075420: 7469 6f6e 2c20 7468 6520 6e65 7720 606f  tion, the new `o
-00075430: 7665 726c 6170 6020 2863 616c 6c65 640d  verlap` (called.
-00075440: 0a20 2020 2023 2060 5f6f 7665 726c 6170  .    # `_overlap
-00075450: 6020 756e 7469 6c20 7468 6520 6f72 6967  ` until the orig
-00075460: 696e 616c 2060 6f76 6572 6c61 7060 2069  inal `overlap` i
-00075470: 7320 6e6f 206c 6f6e 6765 7220 6e65 6564  s no longer need
-00075480: 6564 290d 0a20 2020 2023 2069 7320 6275  ed)..    # is bu
-00075490: 696c 7420 6672 6f6d 2074 6865 206f 6c64  ilt from the old
-000754a0: 206f 6e65 2e0d 0a20 2020 2023 0d0a 2020   one...    #..  
-000754b0: 2020 2320 4966 2074 6865 206c 656e 6774    # If the lengt
-000754c0: 6820 6f66 206f 7665 726c 6170 2065 7863  h of overlap exc
-000754d0: 6565 6473 2074 6865 206c 6172 6765 7374  eeds the largest
-000754e0: 2073 7562 7374 7269 6e67 0d0a 2020 2020   substring..    
-000754f0: 2320 7365 656e 2073 6f20 6661 7220 2860  # seen so far (`
-00075500: 7375 625f 6c65 6e67 7468 6029 2c20 7765  sub_length`), we
-00075510: 2075 7064 6174 6520 7468 6520 6c61 7267   update the larg
-00075520: 6573 7420 7375 6273 7472 696e 670d 0a20  est substring.. 
-00075530: 2020 2023 2074 6f20 7468 6520 6f76 6572     # to the over
-00075540: 6c61 7070 696e 6720 7374 7269 6e67 732e  lapping strings.
-00075550: 0d0a 0d0a 2020 2020 6f76 6572 6c61 7020  ....    overlap 
-00075560: 3d20 6469 6374 2829 0d0a 2020 2020 2320  = dict()..    # 
-00075570: 6073 7562 5f73 7461 7274 5f6f 6c64 6020  `sub_start_old` 
-00075580: 6973 2074 6865 2069 6e64 6578 206f 6620  is the index of 
-00075590: 7468 6520 6265 6769 6e6e 696e 6720 6f66  the beginning of
-000755a0: 2074 6865 206c 6172 6765 7374 206f 7665   the largest ove
-000755b0: 726c 6170 7069 6e67 0d0a 2020 2020 2320  rlapping..    # 
-000755c0: 7375 6273 7472 696e 6720 696e 2074 6865  substring in the
-000755d0: 206f 6c64 206c 6973 742e 2060 7375 625f   old list. `sub_
-000755e0: 7374 6172 745f 6e65 7760 2069 7320 7468  start_new` is th
-000755f0: 6520 696e 6465 7820 6f66 2074 6865 2062  e index of the b
-00075600: 6567 696e 6e69 6e67 0d0a 2020 2020 2320  eginning..    # 
-00075610: 6f66 2074 6865 2073 616d 6520 7375 6273  of the same subs
-00075620: 7472 696e 6720 696e 2074 6865 206e 6577  tring in the new
-00075630: 206c 6973 742e 2060 7375 625f 6c65 6e67   list. `sub_leng
-00075640: 7468 6020 6973 2074 6865 206c 656e 6774  th` is the lengt
-00075650: 6820 7468 6174 0d0a 2020 2020 2320 6f76  h that..    # ov
-00075660: 6572 6c61 7073 2069 6e20 626f 7468 2e0d  erlaps in both..
-00075670: 0a20 2020 2023 2054 6865 7365 2074 7261  .    # These tra
-00075680: 636b 2074 6865 206c 6172 6765 7374 206f  ck the largest o
-00075690: 7665 726c 6170 7069 6e67 2073 7562 7374  verlapping subst
-000756a0: 7269 6e67 2073 6565 6e20 736f 2066 6172  ring seen so far
-000756b0: 2c20 736f 206e 6174 7572 616c 6c79 0d0a  , so naturally..
-000756c0: 2020 2020 2320 7765 2073 7461 7274 2077      # we start w
-000756d0: 6974 6820 6120 302d 6c65 6e67 7468 2073  ith a 0-length s
-000756e0: 7562 7374 7269 6e67 2e0d 0a20 2020 2073  ubstring...    s
-000756f0: 7562 5f73 7461 7274 5f6f 6c64 203d 2030  ub_start_old = 0
-00075700: 0d0a 2020 2020 7375 625f 7374 6172 745f  ..    sub_start_
-00075710: 6e65 7720 3d20 300d 0a20 2020 2073 7562  new = 0..    sub
-00075720: 5f6c 656e 6774 6820 3d20 300d 0a0d 0a20  _length = 0.... 
-00075730: 2020 2066 6f72 2069 6e65 772c 2076 616c     for inew, val
-00075740: 2069 6e20 656e 756d 6572 6174 6528 6e65   in enumerate(ne
-00075750: 7729 3a0d 0a20 2020 2020 2020 205f 6f76  w):..        _ov
-00075760: 6572 6c61 7020 3d20 6469 6374 2829 0d0a  erlap = dict()..
-00075770: 2020 2020 2020 2020 666f 7220 696f 6c64          for iold
-00075780: 2069 6e20 6f6c 645f 696e 6465 785f 6d61   in old_index_ma
-00075790: 702e 6765 7428 7661 6c2c 6c69 7374 2829  p.get(val,list()
-000757a0: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-000757b0: 2320 6e6f 7720 7765 2061 7265 2063 6f6e  # now we are con
-000757c0: 7369 6465 7269 6e67 2061 6c6c 2076 616c  sidering all val
-000757d0: 7565 7320 6f66 2069 6f6c 6420 7375 6368  ues of iold such
-000757e0: 2074 6861 740d 0a20 2020 2020 2020 2020   that..         
-000757f0: 2020 2023 2060 6f6c 645b 696f 6c64 5d20     # `old[iold] 
-00075800: 3d3d 206e 6577 5b69 6e65 775d 602e 0d0a  == new[inew]`...
-00075810: 2020 2020 2020 2020 2020 2020 5f6f 7665              _ove
-00075820: 726c 6170 5b69 6f6c 645d 203d 2028 696f  rlap[iold] = (io
-00075830: 6c64 2061 6e64 206f 7665 726c 6170 2e67  ld and overlap.g
-00075840: 6574 2869 6f6c 6420 2d20 312c 2030 2929  et(iold - 1, 0))
-00075850: 202b 2031 0d0a 2020 2020 2020 2020 2020   + 1..          
-00075860: 2020 6966 285f 6f76 6572 6c61 705b 696f    if(_overlap[io
-00075870: 6c64 5d20 3e20 7375 625f 6c65 6e67 7468  ld] > sub_length
-00075880: 293a 0d0a 2020 2020 2020 2020 2020 2020  ):..            
-00075890: 2020 2020 2320 7468 6973 2069 7320 7468      # this is th
-000758a0: 6520 6c61 7267 6573 7420 7375 6273 7472  e largest substr
-000758b0: 696e 6720 7365 656e 2073 6f20 6661 722c  ing seen so far,
-000758c0: 2073 6f20 7374 6f72 6520 6974 730d 0a20   so store its.. 
-000758d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000758e0: 2069 6e64 6963 6573 0d0a 2020 2020 2020   indices..      
-000758f0: 2020 2020 2020 2020 2020 7375 625f 6c65            sub_le
-00075900: 6e67 7468 203d 205f 6f76 6572 6c61 705b  ngth = _overlap[
-00075910: 696f 6c64 5d0d 0a20 2020 2020 2020 2020  iold]..         
-00075920: 2020 2020 2020 2073 7562 5f73 7461 7274         sub_start
-00075930: 5f6f 6c64 203d 2069 6f6c 6420 2d20 7375  _old = iold - su
-00075940: 625f 6c65 6e67 7468 202b 2031 0d0a 2020  b_length + 1..  
-00075950: 2020 2020 2020 2020 2020 2020 2020 7375                su
-00075960: 625f 7374 6172 745f 6e65 7720 3d20 696e  b_start_new = in
-00075970: 6577 202d 2073 7562 5f6c 656e 6774 6820  ew - sub_length 
-00075980: 2b20 310d 0a20 2020 2020 2020 206f 7665  + 1..        ove
-00075990: 726c 6170 203d 205f 6f76 6572 6c61 700d  rlap = _overlap.
-000759a0: 0a0d 0a20 2020 2069 6620 7375 625f 6c65  ...    if sub_le
-000759b0: 6e67 7468 203d 3d20 303a 0d0a 2020 2020  ngth == 0:..    
-000759c0: 2020 2020 2320 4966 206e 6f20 636f 6d6d      # If no comm
-000759d0: 6f6e 2073 7562 7374 7269 6e67 2069 7320  on substring is 
-000759e0: 666f 756e 642c 2077 6520 7265 7475 726e  found, we return
-000759f0: 2061 6e20 696e 7365 7274 2061 6e64 2064   an insert and d
-00075a00: 656c 6574 652e 2e2e 0d0a 2020 2020 2020  elete.....      
-00075a10: 2020 7265 7475 726e 2028 6f6c 6420 616e    return (old an
-00075a20: 6420 5b28 272d 272c 206f 6c64 295d 206f  d [('-', old)] o
-00075a30: 7220 5b5d 2920 2b20 286e 6577 2061 6e64  r []) + (new and
-00075a40: 205b 2827 2b27 2c20 6e65 7729 5d20 6f72   [('+', new)] or
-00075a50: 205b 5d29 0d0a 2020 2020 656c 7365 3a0d   [])..    else:.
-00075a60: 0a20 2020 2020 2020 2023 202e 2e2e 6f74  .        # ...ot
-00075a70: 6865 7277 6973 652c 2074 6865 2063 6f6d  herwise, the com
-00075a80: 6d6f 6e20 7375 6273 7472 696e 6720 6973  mon substring is
-00075a90: 2075 6e63 6861 6e67 6564 2061 6e64 2077   unchanged and w
-00075aa0: 6520 7265 6375 7273 6976 656c 790d 0a20  e recursively.. 
-00075ab0: 2020 2020 2020 2023 2064 6966 6620 7468         # diff th
-00075ac0: 6520 7465 7874 2062 6566 6f72 6520 616e  e text before an
-00075ad0: 6420 6166 7465 7220 7468 6174 2073 7562  d after that sub
-00075ae0: 7374 7269 6e67 0d0a 2020 2020 2020 2020  string..        
-00075af0: 7265 7475 726e 205f 6469 6666 286f 6c64  return _diff(old
-00075b00: 5b20 3a20 7375 625f 7374 6172 745f 6f6c  [ : sub_start_ol
-00075b10: 645d 2c20 6e65 775b 203a 2073 7562 5f73  d], new[ : sub_s
-00075b20: 7461 7274 5f6e 6577 5d29 202b 205c 0d0a  tart_new]) + \..
-00075b30: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00075b40: 2827 3d27 2c20 6e65 775b 7375 625f 7374  ('=', new[sub_st
-00075b50: 6172 745f 6e65 7720 3a20 7375 625f 7374  art_new : sub_st
-00075b60: 6172 745f 6e65 7720 2b20 7375 625f 6c65  art_new + sub_le
-00075b70: 6e67 7468 5d29 5d20 2b20 5c0d 0a20 2020  ngth])] + \..   
-00075b80: 2020 2020 2020 2020 2020 2020 5f64 6966              _dif
-00075b90: 6628 6f6c 645b 7375 625f 7374 6172 745f  f(old[sub_start_
-00075ba0: 6f6c 6420 2b20 7375 625f 6c65 6e67 7468  old + sub_length
-00075bb0: 203a 205d 2c0d 0a20 2020 2020 2020 2020   : ],..         
-00075bc0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-00075bd0: 775b 7375 625f 7374 6172 745f 6e65 7720  w[sub_start_new 
-00075be0: 2b20 7375 625f 6c65 6e67 7468 203a 205d  + sub_length : ]
-00075bf0: 290d 0a0d 0a23 6d75 7461 626c 6520 636f  )....#mutable co
-00075c00: 756e 7465 7220 2d20 696e 7465 6765 7273  unter - integers
-00075c10: 2077 696c 6c20 6b65 6570 2072 6573 6574   will keep reset
-00075c20: 7469 6e67 2077 6865 6e20 7765 2063 6f75  ting when we cou
-00075c30: 6e74 0d0a 636c 6173 7320 5f43 6f75 6e74  nt..class _Count
-00075c40: 6572 286f 626a 6563 7429 3a0d 0a20 2020  er(object):..   
-00075c50: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00075c60: 6c66 293a 0d0a 2020 2020 2020 2020 7365  lf):..        se
-00075c70: 6c66 2e63 6f75 6e74 6572 203d 2030 0d0a  lf.counter = 0..
-00075c80: 2020 2020 6465 6620 5f5f 7374 725f 5f28      def __str__(
-00075c90: 7365 6c66 293a 0d0a 2020 2020 2020 2020  self):..        
-00075ca0: 7365 6c66 2e63 6f75 6e74 6572 2b3d 310d  self.counter+=1.
-00075cb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00075cc0: 2728 272b 7374 7228 7365 6c66 2e63 6f75  '('+str(self.cou
-00075cd0: 6e74 6572 2d31 292b 2729 270d 0a         nter-1)+')'..
+000716e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000716f0: 2020 2020 2029 0d0a 2020 2020 2020 2020       )..        
+00071700: 2020 2020 2020 2020 2020 2020 6173 7365              asse
+00071710: 7274 2065 6c65 6d65 6e74 2e70 6879 7369  rt element.physi
+00071720: 6420 6973 206e 6f74 204e 6f6e 650d 0a20  d is not None.. 
+00071730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071740: 2020 2065 6c65 6d65 6e74 2e5f 696e 7465     element._inte
+00071750: 7276 616c 5f61 6d6f 756e 7420 3d20 696e  rval_amount = in
+00071760: 7428 696e 7465 7276 616c 5f61 6d6f 756e  t(interval_amoun
+00071770: 7429 0d0a 2020 2020 2020 2020 2020 2020  t)..            
+00071780: 2020 2020 2020 2020 656c 656d 656e 742e          element.
+00071790: 5f72 6573 6f6c 7574 696f 6e20 2020 2020  _resolution     
+000717a0: 203d 2072 6573 6f6c 7574 696f 6e0d 0a20   = resolution.. 
+000717b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000717c0: 2020 2065 6c65 6d65 6e74 2e5f 7374 6172     element._star
+000717d0: 745f 6461 7465 2020 2020 2020 3d20 7374  t_date      = st
+000717e0: 6172 745f 6461 7465 0d0a 2020 2020 2020  art_date..      
+000717f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00071800: 206f 6666 7365 7420 6973 204e 6f6e 653a   offset is None:
+00071810: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00071820: 2020 2020 2020 2020 2020 656c 656d 656e            elemen
+00071830: 742e 5f6f 6666 7365 7420 2020 2020 2020  t._offset       
+00071840: 2020 203d 204e 6f6e 650d 0a20 2020 2020     = None..     
+00071850: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00071860: 6c73 653a 0d0a 2020 2020 2020 2020 2020  lse:..          
+00071870: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00071880: 656d 656e 742e 5f6f 6666 7365 7420 2020  ement._offset   
+00071890: 2020 2020 2020 203d 2069 6e74 286f 6666         = int(off
+000718a0: 7365 7429 0d0a 0d0a 2020 2020 2020 2020  set)....        
+000718b0: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
+000718c0: 6e74 2827 656c 656d 2d73 686f 7274 6e61  nt('elem-shortna
+000718d0: 6d65 3227 2c65 6c65 6d65 6e74 2e73 686f  me2',element.sho
+000718e0: 7274 6e61 6d65 290d 0a20 2020 2020 2020  rtname)..       
+000718f0: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
+00071900: 5f6c 6973 742e 6170 7065 6e64 2865 6c65  _list.append(ele
+00071910: 6d65 6e74 290d 0a0d 0a20 2020 2020 2020  ment)....       
+00071920: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+00071930: 6e20 6173 2065 3a0d 0a20 2020 2020 2020  n as e:..       
+00071940: 2020 2020 2070 7269 6e74 2827 4c69 6e65       print('Line
+00071950: 206e 6f3a 2027 2b73 7472 2872 6561 6465   no: '+str(reade
+00071960: 722e 6c69 6e65 5f6e 756d 2929 0d0a 2020  r.line_num))..  
+00071970: 2020 2020 2020 2020 2020 7472 793a 0d0a            try:..
+00071980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071990: 7072 696e 7428 7265 636f 7264 290d 0a20  print(record).. 
+000719a0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+000719b0: 7420 4578 6365 7074 696f 6e3a 0d0a 2020  t Exception:..  
+000719c0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+000719d0: 7373 0d0a 0d0a 2020 2020 2020 2020 2020  ss....          
+000719e0: 2020 7261 6973 6520 650d 0a20 2020 2020    raise e..     
+000719f0: 2020 2072 6574 7572 6e20 656c 656d 656e     return elemen
+00071a00: 745f 6c69 7374 0d0a 0d0a 2020 2020 6966  t_list....    if
+00071a10: 2064 6562 7567 3a0d 0a20 2020 2020 2020   debug:..       
+00071a20: 2066 6f72 2064 6972 2069 6e20 5b64 696d   for dir in [dim
+00071a30: 656e 7369 6f6e 2e73 6974 652e 5f65 6d70  ension.site._emp
+00071a40: 6f77 6572 5f65 7870 6f72 745f 6461 7461  ower_export_data
+00071a50: 5f64 6972 5d3a 0d0a 0d0a 2020 2020 2020  _dir]:....      
+00071a60: 2020 2020 2020 7472 793a 0d0a 2020 2020        try:..    
+00071a70: 2020 2020 2020 2020 2020 2020 6f73 2e6d              os.m
+00071a80: 616b 6564 6972 7328 6469 7229 0d0a 2020  akedirs(dir)..  
+00071a90: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00071aa0: 2046 696c 6545 7869 7374 7345 7272 6f72   FileExistsError
+00071ab0: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00071ac0: 2020 2070 6173 730d 0a20 2020 2020 2020     pass..       
+00071ad0: 2020 2020 2065 7863 6570 7420 4f53 4572       except OSEr
+00071ae0: 726f 7220 6173 2065 3a0d 0a20 2020 2020  ror as e:..     
+00071af0: 2020 2020 2020 2020 2020 2069 6620 652e             if e.
+00071b00: 7769 6e65 7272 6f72 203d 3d20 3132 333a  winerror == 123:
+00071b10: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00071b20: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00071b30: 6545 7272 6f72 2827 4469 7265 6374 6f72  eError('Director
+00071b40: 7920 227b 7d22 2068 6173 2061 6e20 696e  y "{}" has an in
+00071b50: 7661 6c69 6420 6e61 6d65 2e20 4469 6420  valid name. Did 
+00071b60: 796f 7520 7061 7373 2061 2073 6974 655f  you pass a site_
+00071b70: 6c6f 6361 746f 7220 7061 7468 2022 7b7d  locator path "{}
+00071b80: 2220 7769 7468 6f75 7420 646f 7562 6c65  " without double
+00071b90: 2d65 7363 6170 696e 6720 6261 636b 736c  -escaping backsl
+00071ba0: 6173 6865 7320 6f72 2070 7265 6669 7869  ashes or prefixi
+00071bb0: 6e67 2074 6865 2073 7472 696e 6720 7769  ng the string wi
+00071bc0: 7468 2061 6e20 2272 2220 666f 7220 7261  th an "r" for ra
+00071bd0: 773f 272e 666f 726d 6174 2864 6972 2c72  w?'.format(dir,r
+00071be0: 6570 7228 7369 7465 5f6c 6f63 6174 6f72  epr(site_locator
+00071bf0: 2929 290d 0a20 2020 2020 2020 2020 2020  )))..           
+00071c00: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00071c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00071c20: 7261 6973 6520 650d 0a20 2020 2020 2020  raise e..       
+00071c30: 2352 6561 6420 7468 650d 0a20 2020 2020  #Read the..     
+00071c40: 2020 2065 7870 6f72 7465 645f 6469 6d65     exported_dime
+00071c50: 6e73 696f 6e5f 6669 6c65 7061 7468 3d6f  nsion_filepath=o
+00071c60: 732e 7061 7468 2e6a 6f69 6e28 6469 6d65  s.path.join(dime
+00071c70: 6e73 696f 6e2e 7369 7465 2e5f 656d 706f  nsion.site._empo
+00071c80: 7765 725f 6578 706f 7274 5f64 6174 615f  wer_export_data_
+00071c90: 6469 722c 2027 4469 6d65 6e73 696f 6e5f  dir, 'Dimension_
+00071ca0: 272b 7374 7228 6469 6d65 6e73 696f 6e2e  '+str(dimension.
+00071cb0: 696e 6465 7829 2b27 2e74 7376 2729 0d0a  index)+'.tsv')..
+00071cc0: 2020 2020 2020 2020 0d0a 2020 2020 2020          ..      
+00071cd0: 2020 6d61 6a6f 725f 7665 7273 696f 6e2c    major_version,
+00071ce0: 206d 696e 6f72 5f76 6572 7369 6f6e 2c20   minor_version, 
+00071cf0: 7265 6c65 6173 652c 2072 656c 6561 7365  release, release
+00071d00: 5f6e 756d 6265 7220 3d20 6469 6d65 6e73  _number = dimens
+00071d10: 696f 6e2e 7369 7465 2e69 6d70 6f72 7465  ion.site.importe
+00071d20: 725f 7665 7273 696f 6e0d 0a20 2020 2020  r_version..     
+00071d30: 2020 2065 6e63 6f64 696e 673d 2761 6e73     encoding='ans
+00071d40: 6927 0d0a 2020 2020 2020 2020 6966 2028  i'..        if (
+00071d50: 6d61 6a6f 725f 7665 7273 696f 6e20 3d3d  major_version ==
+00071d60: 2039 2061 6e64 2028 6d69 6e6f 725f 7665   9 and (minor_ve
+00071d70: 7273 696f 6e20 3e3d 2038 2929 206f 7220  rsion >= 8)) or 
+00071d80: 6d61 6a6f 725f 7665 7273 696f 6e20 3e20  major_version > 
+00071d90: 393a 0d0a 2020 2020 2020 2020 2020 2020  9:..            
+00071da0: 656e 636f 6469 6e67 3d22 7574 662d 382d  encoding="utf-8-
+00071db0: 7369 6722 0d0a 2020 2020 2020 2020 2020  sig"..          
+00071dc0: 2020 0d0a 2020 2020 2020 2020 7769 7468    ..        with
+00071dd0: 206f 7065 6e28 6578 706f 7274 6564 5f64   open(exported_d
+00071de0: 696d 656e 7369 6f6e 5f66 696c 6570 6174  imension_filepat
+00071df0: 682c 6d6f 6465 3d27 7227 2c65 6e63 6f64  h,mode='r',encod
+00071e00: 696e 673d 656e 636f 6469 6e67 2920 6173  ing=encoding) as
+00071e10: 2065 7870 6f72 7465 645f 6469 6d65 6e73   exported_dimens
+00071e20: 696f 6e5f 6461 7461 3a0d 0a20 2020 2020  ion_data:..     
+00071e30: 2020 2020 2020 2072 6574 7572 6e20 5f72         return _r
+00071e40: 6561 645f 6578 706f 7274 6564 5f64 696d  ead_exported_dim
+00071e50: 656e 7369 6f6e 5f64 6174 6128 6578 706f  ension_data(expo
+00071e60: 7274 6564 5f64 696d 656e 7369 6f6e 5f64  rted_dimension_d
+00071e70: 6174 6129 0d0a 2020 2020 2020 2020 0d0a  ata)..        ..
+00071e80: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00071e90: 2020 2069 6d70 6f72 7420 696f 0d0a 2020     import io..  
+00071ea0: 2020 2020 2020 2344 6f20 6120 6675 6e6b        #Do a funk
+00071eb0: 7920 476c 6167 6f6c 7974 6963 2072 6570  y Glagolytic rep
+00071ec0: 6c61 6365 6d65 6e74 2074 6f20 6669 7820  lacement to fix 
+00071ed0: 7175 6f74 696e 6720 6973 7375 6573 202d  quoting issues -
+00071ee0: 2049 2063 686f 7365 2074 6865 206f 6e65   I chose the one
+00071ef0: 2074 6861 7420 6c6f 6f6b 7320 6c69 6b65   that looks like
+00071f00: 2061 206c 616d 700d 0a20 2020 2020 2020   a lamp..       
+00071f10: 2023 4966 2074 6865 7265 2061 7265 2072   #If there are r
+00071f20: 6561 6c20 476c 6167 6f6c 7974 6963 2063  eal Glagolytic c
+00071f30: 6861 7261 6374 6572 7320 696e 2079 6f75  haracters in you
+00071f40: 7220 6461 7461 2028 6869 6768 6c79 2075  r data (highly u
+00071f50: 6e6c 696b 656c 7920 2d20 6974 2773 2061  nlikely - it's a
+00071f60: 2076 6572 792c 2076 6572 7920 6465 6164   very, very dead
+00071f70: 206c 616e 6775 6167 6529 2074 6869 7320   language) this 
+00071f80: 636f 6465 2077 696c 6c20 6661 696c 0d0a  code will fail..
+00071f90: 2020 2020 2020 2020 7265 7475 726e 205f          return _
+00071fa0: 7265 6164 5f65 7870 6f72 7465 645f 6469  read_exported_di
+00071fb0: 6d65 6e73 696f 6e5f 6461 7461 2869 6f2e  mension_data(io.
+00071fc0: 5374 7269 6e67 494f 286f 7574 7075 742e  StringIO(output.
+00071fd0: 7265 706c 6163 6528 2722 2227 2c27 e2b0  replace('""','..
+00071fe0: a627 292e 7265 706c 6163 6528 2722 272c  .').replace('"',
+00071ff0: 2727 292e 7265 706c 6163 6528 27e2 b0a6  '').replace('...
+00072000: 272c 2722 2729 2929 0d0a 0d0a 6465 6620  ','"')))....def 
+00072010: 5f63 7265 6174 655f 656d 706f 7765 725f  _create_empower_
+00072020: 6469 6d65 6e73 696f 6e5f 7368 6f72 746e  dimension_shortn
+00072030: 616d 655f 656c 656d 656e 745f 6469 6374  ame_element_dict
+00072040: 2864 696d 656e 7369 6f6e 2c6f 6c64 5f65  (dimension,old_e
+00072050: 6c65 6d65 6e74 733d 4e6f 6e65 2c64 6562  lements=None,deb
+00072060: 7567 3d46 616c 7365 293a 0d0a 2020 2020  ug=False):..    
+00072070: 2727 2743 7265 6174 6520 6120 6469 6374  '''Create a dict
+00072080: 696f 6e61 7279 206f 6620 7368 6f72 746e  ionary of shortn
+00072090: 616d 6573 2074 6f20 456d 706f 7765 7220  ames to Empower 
+000720a0: 656c 656d 656e 7473 2c20 666f 7220 6120  elements, for a 
+000720b0: 6769 7665 6e20 7a65 726f 2062 6173 6564  given zero based
+000720c0: 2064 696d 656e 7369 6f6e 0d0a 2020 2020   dimension..    
+000720d0: 5468 6520 656c 656d 656e 7473 2077 696c  The elements wil
+000720e0: 6c20 6265 206f 6620 7479 7065 2045 6c65  l be of type Ele
+000720f0: 6d65 6e74 2c20 6120 636c 6173 7320 696e  ment, a class in
+00072100: 2074 6869 7320 6d6f 6475 6c65 2e0d 0a0d   this module....
+00072110: 0a20 2020 203a 7061 7261 6d20 6469 6d65  .    :param dime
+00072120: 6e73 696f 6e3a 2041 2070 796d 7078 2044  nsion: A pympx D
+00072130: 696d 656e 7369 6f6e 206f 626a 6563 740d  imension object.
+00072140: 0a20 2020 203a 7061 7261 6d20 6f6c 645f  .    :param old_
+00072150: 656c 656d 656e 7473 3a20 7072 6576 696f  elements: previo
+00072160: 7573 2073 6574 206f 6620 656c 656d 656e  us set of elemen
+00072170: 7473 2c20 7468 6973 2061 6c6c 6f77 7320  ts, this allows 
+00072180: 7573 2074 6f20 6d65 7267 6520 696e 2074  us to merge in t
+00072190: 6865 2065 6c65 6d65 6e74 7320 6173 2074  he elements as t
+000721a0: 6865 7920 6172 6520 6372 6561 7465 640d  hey are created.
+000721b0: 0a20 2020 2027 2727 0d0a 0d0a 2020 2020  .    '''....    
+000721c0: 656c 656d 656e 745f 6c69 7374 3d20 5f63  element_list= _c
+000721d0: 7265 6174 655f 656d 706f 7765 725f 6469  reate_empower_di
+000721e0: 6d65 6e73 696f 6e5f 656c 656d 656e 745f  mension_element_
+000721f0: 6c69 7374 2864 696d 656e 7369 6f6e 3d20  list(dimension= 
+00072200: 6469 6d65 6e73 696f 6e2c 6465 6275 673d  dimension,debug=
+00072210: 6465 6275 6729 0d0a 0d0a 2020 2020 7265  debug)....    re
+00072220: 7475 726e 5f64 6963 743d 7b7d 0d0a 0d0a  turn_dict={}....
+00072230: 2020 2020 2341 7474 656d 7074 2074 6f20      #Attempt to 
+00072240: 6b65 6570 2074 6865 2073 616d 6520 6f62  keep the same ob
+00072250: 6a65 6374 2072 6566 6572 656e 6365 7320  ject references 
+00072260: 666f 7220 7072 6576 696f 7573 6c79 2075  for previously u
+00072270: 7365 6420 656c 656d 656e 7473 0d0a 2020  sed elements..  
+00072280: 2020 6966 206f 6c64 5f65 6c65 6d65 6e74    if old_element
+00072290: 7320 6973 206e 6f74 204e 6f6e 653a 0d0a  s is not None:..
+000722a0: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+000722b0: 2020 2020 2020 2020 2020 666f 7220 656c            for el
+000722c0: 656d 656e 7420 696e 206f 6c64 5f65 6c65  ement in old_ele
+000722d0: 6d65 6e74 732e 7661 6c75 6573 2829 3a0d  ments.values():.
+000722e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000722f0: 2072 6574 7572 6e5f 6469 6374 5b65 6c65   return_dict[ele
+00072300: 6d65 6e74 2e73 686f 7274 6e61 6d65 5d3d  ment.shortname]=
+00072310: 656c 656d 656e 740d 0a20 2020 2020 2020  element..       
+00072320: 2065 7863 6570 7420 4174 7472 6962 7574   except Attribut
+00072330: 6545 7272 6f72 3a0d 0a20 2020 2020 2020  eError:..       
+00072340: 2020 2020 2066 6f72 2065 6c65 6d65 6e74       for element
+00072350: 2069 6e20 6f6c 645f 656c 656d 656e 7473   in old_elements
+00072360: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00072370: 2020 2072 6574 7572 6e5f 6469 6374 5b65     return_dict[e
+00072380: 6c65 6d65 6e74 2e73 686f 7274 6e61 6d65  lement.shortname
+00072390: 5d3d 656c 656d 656e 740d 0a0d 0a20 2020  ]=element....   
+000723a0: 2066 6f72 2065 6c65 6d65 6e74 2069 6e20   for element in 
+000723b0: 656c 656d 656e 745f 6c69 7374 3a0d 0a20  element_list:.. 
+000723c0: 2020 2020 2020 2074 7279 3a0d 0a20 2020         try:..   
+000723d0: 2020 2020 2020 2020 2072 6574 7572 6e5f           return_
+000723e0: 6469 6374 5b65 6c65 6d65 6e74 2e73 686f  dict[element.sho
+000723f0: 7274 6e61 6d65 5d2e 6d65 7267 6528 656c  rtname].merge(el
+00072400: 656d 656e 7429 0d0a 2020 2020 2020 2020  ement)..        
+00072410: 6578 6365 7074 204b 6579 4572 726f 723a  except KeyError:
+00072420: 0d0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00072430: 7475 726e 5f64 6963 745b 656c 656d 656e  turn_dict[elemen
+00072440: 742e 7368 6f72 746e 616d 655d 3d65 6c65  t.shortname]=ele
+00072450: 6d65 6e74 0d0a 0d0a 2020 2020 7265 7475  ment....    retu
+00072460: 726e 2072 6574 7572 6e5f 6469 6374 0d0a  rn return_dict..
+00072470: 0d0a 6465 6620 5f64 6174 6166 7261 6d65  ..def _dataframe
+00072480: 5f61 735f 656c 656d 656e 7473 2864 6174  _as_elements(dat
+00072490: 6166 7261 6d65 2c6c 6f6e 676e 616d 655f  aframe,longname_
+000724a0: 7368 6f72 746e 616d 655f 7275 6c65 3d4e  shortname_rule=N
+000724b0: 6f6e 652c 6469 6d65 6e73 696f 6e3d 4e6f  one,dimension=No
+000724c0: 6e65 293a 0d0a 2020 2020 2727 2754 616b  ne):..    '''Tak
+000724d0: 6520 6120 7061 6e64 6173 2e44 6174 6166  e a pandas.Dataf
+000724e0: 7261 6d65 2061 6e64 2079 6965 6c64 2045  rame and yield E
+000724f0: 6c65 6d65 6e74 7327 2727 0d0a 0d0a 2020  lements'''....  
+00072500: 2020 2363 6865 636b 2074 6865 2063 6f6c    #check the col
+00072510: 756d 6e73 2061 7265 2063 6f72 7265 6374  umns are correct
+00072520: 0d0a 2020 2020 6c6f 6e67 5f6e 616d 655f  ..    long_name_
+00072530: 636f 6c75 6d6e 5f69 735f 666f 756e 6420  column_is_found 
+00072540: 2020 3d20 4661 6c73 650d 0a20 2020 2073    = False..    s
+00072550: 686f 7274 5f6e 616d 655f 636f 6c75 6d6e  hort_name_column
+00072560: 5f69 735f 666f 756e 6420 203d 2046 616c  _is_found  = Fal
+00072570: 7365 0d0a 2020 2020 6465 7363 7269 7074  se..    descript
+00072580: 696f 6e5f 636f 6c75 6d6e 5f69 735f 666f  ion_column_is_fo
+00072590: 756e 6420 3d20 4661 6c73 650d 0a20 2020  und = False..   
+000725a0: 2067 726f 7570 5f6f 6e6c 795f 636f 6c75   group_only_colu
+000725b0: 6d6e 5f69 735f 666f 756e 6420 203d 2046  mn_is_found  = F
+000725c0: 616c 7365 0d0a 2020 2020 6361 6c63 5f73  alse..    calc_s
+000725d0: 7461 7475 735f 636f 6c75 6d6e 5f69 735f  tatus_column_is_
+000725e0: 666f 756e 6420 3d20 4661 6c73 650d 0a20  found = False.. 
+000725f0: 2020 2063 616c 6375 6c61 7469 6f6e 5f63     calculation_c
+00072600: 6f6c 756d 6e5f 6973 5f66 6f75 6e64 203d  olumn_is_found =
+00072610: 2046 616c 7365 0d0a 2020 2020 636f 6c6f   False..    colo
+00072620: 7572 5f63 6f6c 756d 6e5f 6973 5f66 6f75  ur_column_is_fou
+00072630: 6e64 2020 2020 2020 3d20 4661 6c73 650d  nd      = False.
+00072640: 0a20 2020 206d 6561 7375 7265 5f63 6f6c  .    measure_col
+00072650: 756d 6e5f 6973 5f66 6f75 6e64 2020 2020  umn_is_found    
+00072660: 203d 2046 616c 7365 0d0a 2020 2020 6669   = False..    fi
+00072670: 656c 645f 7368 6f72 746e 616d 6573 3d5b  eld_shortnames=[
+00072680: 5d0d 0a0d 0a20 2020 2066 6f72 2063 2069  ]....    for c i
+00072690: 6e20 6461 7461 6672 616d 652e 636f 6c75  n dataframe.colu
+000726a0: 6d6e 733a 0d0a 2020 2020 2020 2020 6966  mns:..        if
+000726b0: 2063 203d 3d20 274c 6f6e 6720 4e61 6d65   c == 'Long Name
+000726c0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+000726d0: 6c6f 6e67 5f6e 616d 655f 636f 6c75 6d6e  long_name_column
+000726e0: 5f69 735f 666f 756e 643d 5472 7565 0d0a  _is_found=True..
+000726f0: 2020 2020 2020 2020 656c 6966 2063 203d          elif c =
+00072700: 3d20 2753 686f 7274 204e 616d 6527 3a0d  = 'Short Name':.
+00072710: 0a20 2020 2020 2020 2020 2020 2073 686f  .            sho
+00072720: 7274 5f6e 616d 655f 636f 6c75 6d6e 5f69  rt_name_column_i
+00072730: 735f 666f 756e 6420 203d 2054 7275 650d  s_found  = True.
+00072740: 0a20 2020 2020 2020 2065 6c69 6620 6320  .        elif c 
+00072750: 3d3d 2027 4465 7363 7269 7074 696f 6e27  == 'Description'
+00072760: 3a0d 0a20 2020 2020 2020 2020 2020 2064  :..            d
+00072770: 6573 6372 6970 7469 6f6e 5f63 6f6c 756d  escription_colum
+00072780: 6e5f 6973 5f66 6f75 6e64 203d 2054 7275  n_is_found = Tru
+00072790: 650d 0a20 2020 2020 2020 2065 6c69 6620  e..        elif 
+000727a0: 6320 3d3d 2027 4772 6f75 7020 4f6e 6c79  c == 'Group Only
+000727b0: 273a 0d0a 2020 2020 2020 2020 2020 2020  ':..            
+000727c0: 6772 6f75 705f 6f6e 6c79 5f63 6f6c 756d  group_only_colum
+000727d0: 6e5f 6973 5f66 6f75 6e64 2020 3d20 5472  n_is_found  = Tr
+000727e0: 7565 0d0a 2020 2020 2020 2020 656c 6966  ue..        elif
+000727f0: 2063 203d 3d20 2743 616c 6375 6c61 7469   c == 'Calculati
+00072800: 6f6e 2053 7461 7475 7327 3a0d 0a20 2020  on Status':..   
+00072810: 2020 2020 2020 2020 2063 616c 635f 7374           calc_st
+00072820: 6174 7573 5f63 6f6c 756d 6e5f 6973 5f66  atus_column_is_f
+00072830: 6f75 6e64 203d 2054 7275 650d 0a20 2020  ound = True..   
+00072840: 2020 2020 2065 6c69 6620 6320 3d3d 2027       elif c == '
+00072850: 4361 6c63 756c 6174 696f 6e27 3a0d 0a20  Calculation':.. 
+00072860: 2020 2020 2020 2020 2020 2063 616c 6375             calcu
+00072870: 6c61 7469 6f6e 5f63 6f6c 756d 6e5f 6973  lation_column_is
+00072880: 5f66 6f75 6e64 203d 2054 7275 650d 0a20  _found = True.. 
+00072890: 2020 2020 2020 2065 6c69 6620 6320 3d3d         elif c ==
+000728a0: 2027 436f 6c6f 7572 273a 0d0a 2020 2020   'Colour':..    
+000728b0: 2020 2020 2020 2020 636f 6c6f 7572 5f63          colour_c
+000728c0: 6f6c 756d 6e5f 6973 5f66 6f75 6e64 2020  olumn_is_found  
+000728d0: 2020 2020 3d20 5472 7565 0d0a 2020 2020      = True..    
+000728e0: 2020 2020 656c 6966 2063 203d 3d20 274d      elif c == 'M
+000728f0: 6561 7375 7265 2045 6c65 6d65 6e74 273a  easure Element':
+00072900: 0d0a 2020 2020 2020 2020 2020 2020 6d65  ..            me
+00072910: 6173 7572 655f 636f 6c75 6d6e 5f69 735f  asure_column_is_
+00072920: 666f 756e 6420 2020 2020 3d20 5472 7565  found     = True
+00072930: 0d0a 2020 2020 2020 2020 656c 7365 3a0d  ..        else:.
+00072940: 0a20 2020 2020 2020 2020 2020 2066 6965  .            fie
+00072950: 6c64 5f73 686f 7274 6e61 6d65 732e 6170  ld_shortnames.ap
+00072960: 7065 6e64 2863 290d 0a0d 0a20 2020 2069  pend(c)....    i
+00072970: 6620 6e6f 7420 6c6f 6e67 5f6e 616d 655f  f not long_name_
+00072980: 636f 6c75 6d6e 5f69 735f 666f 756e 6420  column_is_found 
+00072990: 616e 6420 6e6f 7420 7368 6f72 745f 6e61  and not short_na
+000729a0: 6d65 5f63 6f6c 756d 6e5f 6973 5f66 6f75  me_column_is_fou
+000729b0: 6e64 3a0d 0a20 2020 2020 2020 2072 6169  nd:..        rai
+000729c0: 7365 2056 616c 7565 4572 726f 7228 275f  se ValueError('_
+000729d0: 6461 7461 6672 616d 655f 6173 5f65 6c65  dataframe_as_ele
+000729e0: 6d65 6e74 7328 293a 2054 6865 2064 6174  ments(): The dat
+000729f0: 6166 7261 6d65 2070 6172 616d 6574 6572  aframe parameter
+00072a00: 206d 7573 7420 636f 6e74 6169 6e20 6120   must contain a 
+00072a10: 6461 7461 6672 616d 6520 7769 7468 2065  dataframe with e
+00072a20: 6974 6865 7220 6120 224c 6f6e 6720 4e61  ither a "Long Na
+00072a30: 6d65 2220 636f 6c75 6d6e 206f 7220 6120  me" column or a 
+00072a40: 2253 686f 7274 204e 616d 6522 2063 6f6c  "Short Name" col
+00072a50: 756d 6e20 6f72 2062 6f74 682e 2043 6f6c  umn or both. Col
+00072a60: 756d 6e73 2069 6e20 7468 6520 6461 7461  umns in the data
+00072a70: 6672 616d 6520 6172 653a 2027 2b73 7472  frame are: '+str
+00072a80: 2864 6174 6166 7261 6d65 2e63 6f6c 756d  (dataframe.colum
+00072a90: 6e73 2929 0d0a 0d0a 2020 2020 666f 7220  ns))....    for 
+00072aa0: 6420 696e 2064 6174 6166 7261 6d65 2e69  d in dataframe.i
+00072ab0: 7465 7274 7570 6c65 7328 696e 6465 783d  tertuples(index=
+00072ac0: 4661 6c73 6529 3a0d 0a20 2020 2020 2020  False):..       
+00072ad0: 2023 466f 7220 736f 6d65 2072 6561 736f   #For some reaso
+00072ae0: 6e20 6974 6572 7475 706c 6573 2069 736e  n itertuples isn
+00072af0: 2774 2063 6f6d 696e 6720 6261 636b 2077  't coming back w
+00072b00: 6974 6820 7468 6520 636f 6c75 6d6e 206e  ith the column n
+00072b10: 616d 6573 202d 2063 7265 6174 6520 6120  ames - create a 
+00072b20: 6469 6374 696f 6e61 7279 2075 7369 6e67  dictionary using
+00072b30: 2074 6865 206f 7269 6769 6e61 6c20 636f   the original co
+00072b40: 6c75 6d6e 206e 616d 6573 206f 6620 7468  lumn names of th
+00072b50: 6520 6469 6374 696f 6e61 7279 0d0a 2020  e dictionary..  
+00072b60: 2020 2020 2020 656c 656d 656e 745f 6173        element_as
+00072b70: 5f64 6963 7469 6f6e 6172 7920 3d20 7b7d  _dictionary = {}
+00072b80: 0d0a 2020 2020 2020 2020 666f 7220 692c  ..        for i,
+00072b90: 2076 2069 6e20 656e 756d 6572 6174 6528   v in enumerate(
+00072ba0: 6429 3a0d 0a20 2020 2020 2020 2020 2020  d):..           
+00072bb0: 2074 7279 3a0d 0a20 2020 2020 2020 2020   try:..         
+00072bc0: 2020 2020 2020 2069 6620 6e70 2e69 736e         if np.isn
+00072bd0: 616e 2876 293a 0d0a 2020 2020 2020 2020  an(v):..        
+00072be0: 2020 2020 2020 2020 2020 2020 7620 3d20              v = 
+00072bf0: 4e6f 6e65 0d0a 2020 2020 2020 2020 2020  None..          
+00072c00: 2020 6578 6365 7074 2054 7970 6545 7272    except TypeErr
+00072c10: 6f72 3a0d 0a20 2020 2020 2020 2020 2020  or:..           
+00072c20: 2020 2020 2070 6173 730d 0a20 2020 2020       pass..     
+00072c30: 2020 2020 2020 2065 6c65 6d65 6e74 5f61         element_a
+00072c40: 735f 6469 6374 696f 6e61 7279 5b64 6174  s_dictionary[dat
+00072c50: 6166 7261 6d65 2e63 6f6c 756d 6e73 5b69  aframe.columns[i
+00072c60: 5d5d 203d 2076 0d0a 0d0a 2020 2020 2020  ]] = v....      
+00072c70: 2020 7368 6f72 746e 616d 653d 4e6f 6e65    shortname=None
+00072c80: 0d0a 2020 2020 2020 2020 6c6f 6e67 6e61  ..        longna
+00072c90: 6d65 3d4e 6f6e 650d 0a20 2020 2020 2020  me=None..       
+00072ca0: 2064 6573 6372 6970 7469 6f6e 3d4e 6f6e   description=Non
+00072cb0: 650d 0a20 2020 2020 2020 2070 6879 7369  e..        physi
+00072cc0: 643d 4e6f 6e65 0d0a 2020 2020 2020 2020  d=None..        
+00072cd0: 6772 6f75 705f 6f6e 6c79 3d4e 6f6e 650d  group_only=None.
+00072ce0: 0a20 2020 2020 2020 2063 616c 6375 6c61  .        calcula
+00072cf0: 7469 6f6e 5f73 7461 7475 733d 4e6f 6e65  tion_status=None
+00072d00: 0d0a 2020 2020 2020 2020 6361 6c63 756c  ..        calcul
+00072d10: 6174 696f 6e3d 4e6f 6e65 0d0a 2020 2020  ation=None..    
+00072d20: 2020 2020 636f 6c6f 7572 3d4e 6f6e 650d      colour=None.
+00072d30: 0a20 2020 2020 2020 206d 6561 7375 7265  .        measure
+00072d40: 3d4e 6f6e 650d 0a20 2020 2020 2020 2066  =None..        f
+00072d50: 6965 6c64 733d 7b7d 0d0a 0d0a 2020 2020  ields={}....    
+00072d60: 2020 2020 7472 793a 0d0a 2020 2020 2020      try:..      
+00072d70: 2020 2020 2020 6966 2073 686f 7274 5f6e        if short_n
+00072d80: 616d 655f 636f 6c75 6d6e 5f69 735f 666f  ame_column_is_fo
+00072d90: 756e 643a 0d0a 2020 2020 2020 2020 2020  und:..          
+00072da0: 2020 2020 2020 7368 6f72 746e 616d 6520        shortname 
+00072db0: 3d20 656c 656d 656e 745f 6173 5f64 6963  = element_as_dic
+00072dc0: 7469 6f6e 6172 795b 2753 686f 7274 204e  tionary['Short N
+00072dd0: 616d 6527 5d0d 0a20 2020 2020 2020 2020  ame']..         
+00072de0: 2020 2065 6c73 653a 0d0a 2020 2020 2020     else:..      
+00072df0: 2020 2020 2020 2020 2020 6966 206c 6f6e            if lon
+00072e00: 676e 616d 655f 7368 6f72 746e 616d 655f  gname_shortname_
+00072e10: 7275 6c65 3a0d 0a20 2020 2020 2020 2020  rule:..         
+00072e20: 2020 2020 2020 2020 2020 2073 686f 7274             short
+00072e30: 6e61 6d65 203d 206c 6f6e 676e 616d 655f  name = longname_
+00072e40: 7368 6f72 746e 616d 655f 7275 6c65 2865  shortname_rule(e
+00072e50: 6c65 6d65 6e74 5f61 735f 6469 6374 696f  lement_as_dictio
+00072e60: 6e61 7279 5b27 4c6f 6e67 204e 616d 6527  nary['Long Name'
+00072e70: 5d29 0d0a 2020 2020 2020 2020 2020 2020  ])..            
+00072e80: 2020 2020 656c 7365 3a0d 0a20 2020 2020      else:..     
+00072e90: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00072ea0: 4a75 7374 2073 6574 206e 6f20 7368 6f72  Just set no shor
+00072eb0: 746e 616d 6520 616e 6420 6c65 7420 456d  tname and let Em
+00072ec0: 706f 7765 7220 736f 7274 2069 7420 6f75  power sort it ou
+00072ed0: 740d 0a20 2020 2020 2020 2020 2020 2020  t..             
+00072ee0: 2020 2020 2020 2073 686f 7274 6e61 6d65         shortname
+00072ef0: 203d 204e 6f6e 6520 2365 6c65 6d65 6e74   = None #element
+00072f00: 5f61 735f 6469 6374 696f 6e61 7279 5b27  _as_dictionary['
+00072f10: 4c6f 6e67 204e 616d 6527 5d0d 0a20 2020  Long Name']..   
+00072f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00072f30: 206e 6565 6473 5f72 6573 796e 6320 3d20   needs_resync = 
+00072f40: 5472 7565 0d0a 0d0a 2020 2020 2020 2020  True....        
+00072f50: 2020 2020 6966 206c 6f6e 675f 6e61 6d65      if long_name
+00072f60: 5f63 6f6c 756d 6e5f 6973 5f66 6f75 6e64  _column_is_found
+00072f70: 3a0d 0a20 2020 2020 2020 2020 2020 2020  :..             
+00072f80: 2020 206c 6f6e 676e 616d 6520 3d20 656c     longname = el
+00072f90: 656d 656e 745f 6173 5f64 6963 7469 6f6e  ement_as_diction
+00072fa0: 6172 795b 274c 6f6e 6720 4e61 6d65 275d  ary['Long Name']
+00072fb0: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00072fc0: 2064 6573 6372 6970 7469 6f6e 5f63 6f6c   description_col
+00072fd0: 756d 6e5f 6973 5f66 6f75 6e64 3a0d 0a20  umn_is_found:.. 
+00072fe0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00072ff0: 6573 6372 6970 7469 6f6e 203d 2065 6c65  escription = ele
+00073000: 6d65 6e74 5f61 735f 6469 6374 696f 6e61  ment_as_dictiona
+00073010: 7279 5b27 4465 7363 7269 7074 696f 6e27  ry['Description'
+00073020: 5d0d 0a20 2020 2020 2020 2020 2020 2069  ]..            i
+00073030: 6620 6772 6f75 705f 6f6e 6c79 5f63 6f6c  f group_only_col
+00073040: 756d 6e5f 6973 5f66 6f75 6e64 3a0d 0a20  umn_is_found:.. 
+00073050: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+00073060: 726f 7570 5f6f 6e6c 7920 3d20 656c 656d  roup_only = elem
+00073070: 656e 745f 6173 5f64 6963 7469 6f6e 6172  ent_as_dictionar
+00073080: 795b 2747 726f 7570 204f 6e6c 7927 5d0d  y['Group Only'].
+00073090: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000730a0: 6361 6c63 5f73 7461 7475 735f 636f 6c75  calc_status_colu
+000730b0: 6d6e 5f69 735f 666f 756e 643a 0d0a 2020  mn_is_found:..  
+000730c0: 2020 2020 2020 2020 2020 2020 2063 616c               cal
+000730d0: 6375 6c61 7469 6f6e 5f73 7461 7475 7320  culation_status 
+000730e0: 3d20 656c 656d 656e 745f 6173 5f64 6963  = element_as_dic
+000730f0: 7469 6f6e 6172 795b 2743 616c 6375 6c61  tionary['Calcula
+00073100: 7469 6f6e 2053 7461 7475 7327 5d0d 0a20  tion Status'].. 
+00073110: 2020 2020 2020 2020 2020 2069 6620 6361             if ca
+00073120: 6c63 756c 6174 696f 6e5f 636f 6c75 6d6e  lculation_column
+00073130: 5f69 735f 666f 756e 6420 3a0d 0a20 2020  _is_found :..   
+00073140: 2020 2020 2020 2020 2020 2020 6361 6c63              calc
+00073150: 756c 6174 696f 6e20 3d20 656c 656d 656e  ulation = elemen
+00073160: 745f 6173 5f64 6963 7469 6f6e 6172 795b  t_as_dictionary[
+00073170: 2743 616c 6375 6c61 7469 6f6e 275d 0d0a  'Calculation']..
+00073180: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+00073190: 6561 7375 7265 5f63 6f6c 756d 6e5f 6973  easure_column_is
+000731a0: 5f66 6f75 6e64 203a 0d0a 2020 2020 2020  _found :..      
+000731b0: 2020 2020 2020 2020 206d 6561 7375 7265           measure
+000731c0: 203d 2065 6c65 6d65 6e74 5f61 735f 6469   = element_as_di
+000731d0: 6374 696f 6e61 7279 5b27 4d65 6173 7572  ctionary['Measur
+000731e0: 6520 456c 656d 656e 7427 5d0d 0a20 2020  e Element']..   
+000731f0: 2020 2020 2020 2020 2069 6620 636f 6c6f           if colo
+00073200: 7572 5f63 6f6c 756d 6e5f 6973 5f66 6f75  ur_column_is_fou
+00073210: 6e64 3a0d 0a20 2020 2020 2020 2020 2020  nd:..           
+00073220: 2020 2020 2063 6f6c 6f75 7220 3d20 656c       colour = el
+00073230: 656d 656e 745f 6173 5f64 6963 7469 6f6e  ement_as_diction
+00073240: 6172 795b 2743 6f6c 6f75 7227 5d0d 0a0d  ary['Colour']...
+00073250: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00073260: 2066 5f73 6e20 696e 2066 6965 6c64 5f73   f_sn in field_s
+00073270: 686f 7274 6e61 6d65 733a 0d0a 2020 2020  hortnames:..    
+00073280: 2020 2020 2020 2020 2020 2020 6669 656c              fiel
+00073290: 6473 5b66 5f73 6e5d 203d 2065 6c65 6d65  ds[f_sn] = eleme
+000732a0: 6e74 5f61 735f 6469 6374 696f 6e61 7279  nt_as_dictionary
+000732b0: 5b66 5f73 6e5d 0d0a 0d0a 2020 2020 2020  [f_sn]....      
+000732c0: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+000732d0: 723a 0d0a 2020 2020 2020 2020 2020 2020  r:..            
+000732e0: 6c6f 672e 6572 726f 7228 7374 7228 656c  log.error(str(el
+000732f0: 656d 656e 745f 6173 5f64 6963 7469 6f6e  ement_as_diction
+00073300: 6172 7929 290d 0a20 2020 2020 2020 2020  ary))..         
+00073310: 2020 2072 6169 7365 0d0a 0d0a 2020 2020     raise....    
+00073320: 2020 2020 7969 656c 6420 456c 656d 656e      yield Elemen
+00073330: 7428 7368 6f72 746e 616d 6520 2020 2020  t(shortname     
+00073340: 2020 2020 203d 2073 686f 7274 6e61 6d65       = shortname
+00073350: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00073360: 2020 2020 2020 202c 6c6f 6e67 6e61 6d65         ,longname
+00073370: 2020 2020 2020 2020 2020 203d 206c 6f6e             = lon
+00073380: 676e 616d 650d 0a20 2020 2020 2020 2020  gname..         
+00073390: 2020 2020 2020 2020 2020 2020 2c64 6573              ,des
+000733a0: 6372 6970 7469 6f6e 2020 2020 2020 2020  cription        
+000733b0: 3d20 6465 7363 7269 7074 696f 6e0d 0a20  = description.. 
+000733c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000733d0: 2020 2020 2c70 6879 7369 6420 2020 2020      ,physid     
+000733e0: 2020 2020 2020 2020 3d20 7068 7973 6964          = physid
+000733f0: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00073400: 2020 2020 2020 202c 6772 6f75 705f 6f6e         ,group_on
+00073410: 6c79 2020 2020 2020 2020 203d 2067 726f  ly         = gro
+00073420: 7570 5f6f 6e6c 790d 0a20 2020 2020 2020  up_only..       
+00073430: 2020 2020 2020 2020 2020 2020 2020 2c63                ,c
+00073440: 616c 6375 6c61 7469 6f6e 5f73 7461 7475  alculation_statu
+00073450: 7320 3d20 6361 6c63 756c 6174 696f 6e5f  s = calculation_
+00073460: 7374 6174 7573 0d0a 2020 2020 2020 2020  status..        
+00073470: 2020 2020 2020 2020 2020 2020 202c 6361               ,ca
+00073480: 6c63 756c 6174 696f 6e20 2020 2020 2020  lculation       
+00073490: 203d 2063 616c 6375 6c61 7469 6f6e 0d0a   = calculation..
+000734a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000734b0: 2020 2020 202c 636f 6c6f 7572 2020 2020       ,colour    
+000734c0: 2020 2020 2020 2020 203d 2063 6f6c 6f75           = colou
+000734d0: 720d 0a20 2020 2020 2020 2020 2020 2020  r..             
+000734e0: 2020 2020 2020 2020 2c66 6965 6c64 7320          ,fields 
+000734f0: 2020 2020 2020 2020 2020 2020 3d20 6669              = fi
+00073500: 656c 6473 0d0a 2020 2020 2020 2020 2020  elds..          
+00073510: 2020 2020 2020 2020 2020 202c 6f76 6572             ,over
+00073520: 7269 6465 5f73 686f 7274 6e61 6d65 5f6c  ride_shortname_l
+00073530: 656e 6774 685f 7275 6c65 203d 2054 7275  ength_rule = Tru
+00073540: 650d 0a20 2020 2020 2020 2020 2020 2020  e..             
+00073550: 2020 2020 2020 2020 2c64 696d 656e 7369          ,dimensi
+00073560: 6f6e 2020 2020 2020 2020 2020 3d20 6469  on          = di
+00073570: 6d65 6e73 696f 6e0d 0a20 2020 2020 2020  mension..       
+00073580: 2020 2020 2020 2020 2020 2020 2020 290d                ).
+00073590: 0a0d 0a23 5468 6973 2066 756e 6374 696f  ...#This functio
+000735a0: 6e20 7461 6b65 7320 6162 6f75 7420 6120  n takes about a 
+000735b0: 7365 636f 6e64 2074 6f20 7275 6e2c 2061  second to run, a
+000735c0: 6e64 2069 7320 6361 6c6c 6564 206d 756c  nd is called mul
+000735d0: 7469 706c 6520 7469 6d65 7320 6475 7269  tiple times duri
+000735e0: 6e67 2074 6573 7469 6e67 0d0a 2342 7920  ng testing..#By 
+000735f0: 6d61 6b69 6e67 2069 7420 6120 6e6f 6e2d  making it a non-
+00073600: 6d65 6d62 6572 2066 756e 6374 696f 6e2c  member function,
+00073610: 2077 6520 6361 6e20 6d6f 6e6b 6579 7061   we can monkeypa
+00073620: 7463 6820 6120 6d65 6d6f 697a 6564 2076  tch a memoized v
+00073630: 6572 7369 6f6e 2064 7572 696e 6720 7465  ersion during te
+00073640: 7374 696e 672c 2074 6875 7320 7370 6565  sting, thus spee
+00073650: 6469 6e67 2075 7020 7465 7374 696e 672c  ding up testing,
+00073660: 2062 7574 2070 7265 7365 7276 696e 6720   but preserving 
+00073670: 696e 7465 6772 6174 696f 6e20 7465 7374  integration test
+00073680: 696e 670d 0a23 5468 6520 5f69 6e6e 6572  ing..#The _inner
+00073690: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
+000736a0: 6675 6e63 7469 6f6e 2069 7320 746f 2070  function is to p
+000736b0: 7265 7665 6e74 2061 2072 6563 7572 7369  revent a recursi
+000736c0: 6f6e 2065 7272 6f72 2077 6865 6e20 6d6f  on error when mo
+000736d0: 6e6b 6579 7061 7463 6869 6e67 2074 6865  nkeypatching the
+000736e0: 206d 656d 6f69 7a65 6420 7665 7273 696f   memoized versio
+000736f0: 6e0d 0a64 6566 205f 696e 6e65 725f 6765  n..def _inner_ge
+00073700: 745f 7369 7465 5f64 6574 6169 6c73 285f  t_site_details(_
+00073710: 6c6f 676f 6e5f 7061 7261 6d65 7465 725f  logon_parameter_
+00073720: 696d 706f 7274 6572 5f63 6f6d 6d61 6e64  importer_command
+00073730: 732c 656d 706f 7765 725f 696d 706f 7274  s,empower_import
+00073740: 6572 5f65 7865 6375 7461 626c 6529 3a0d  er_executable):.
+00073750: 0a20 2020 2073 6974 655f 6465 7461 696c  .    site_detail
+00073760: 733d 7b7d 0d0a 2020 2020 636f 6d6d 616e  s={}..    comman
+00073770: 645f 6c69 7374 203d 206c 6973 7428 5f6c  d_list = list(_l
+00073780: 6f67 6f6e 5f70 6172 616d 6574 6572 5f69  ogon_parameter_i
+00073790: 6d70 6f72 7465 725f 636f 6d6d 616e 6473  mporter_commands
+000737a0: 2920 2b20 5c0d 0a20 2020 2020 2020 2020  ) + \..         
+000737b0: 2020 2020 2020 2020 2020 5b27 656d 706f            ['empo
+000737c0: 7765 722d 6578 706f 7274 2d73 6974 652d  wer-export-site-
+000737d0: 6465 7461 696c 7320 2224 7b73 6974 657d  details "${site}
+000737e0: 2220 2224 7b75 7365 727d 2220 2224 7b70  " "${user}" "${p
+000737f0: 6173 7377 6f72 647d 2227 0d0a 2020 2020  assword}"'..    
+00073800: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+00073810: 2774 7376 2d65 6e63 6f64 6527 0d0a 2020  'tsv-encode'..  
+00073820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00073830: 202c 276f 7574 7075 7427 0d0a 2020 2020   ,'output'..    
+00073840: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
+00073850: 0d0a 2020 2020 6f75 7470 7574 203d 206c  ..    output = l
+00073860: 6c75 2e72 756e 5f73 696e 676c 655f 6f75  lu.run_single_ou
+00073870: 7470 7574 5f69 6d70 6f72 7465 725f 636f  tput_importer_co
+00073880: 6d6d 616e 6473 2863 6f6d 6d61 6e64 5f6c  mmands(command_l
+00073890: 6973 742c 656d 706f 7765 725f 696d 706f  ist,empower_impo
+000738a0: 7274 6572 5f65 7865 6375 7461 626c 653d  rter_executable=
+000738b0: 656d 706f 7765 725f 696d 706f 7274 6572  empower_importer
+000738c0: 5f65 7865 6375 7461 626c 6529 0d0a 0d0a  _executable)....
+000738d0: 2020 2020 2354 4f44 4f20 7468 6973 2064      #TODO this d
+000738e0: 6f65 7320 6e6f 7420 776f 726b 2066 6f72  oes not work for
+000738f0: 204c 6f63 6b20 4469 6d65 6e73 696f 6e73   Lock Dimensions
+00073900: 2077 6869 6368 2061 7265 2074 6162 2073   which are tab s
+00073910: 6570 6172 6174 6564 2061 6c72 6561 6479  eparated already
+00073920: 0d0a 2020 2020 666f 7220 6b76 2069 6e20  ..    for kv in 
+00073930: 6f75 7470 7574 2e73 706c 6974 2827 5c72  output.split('\r
+00073940: 5c6e 2729 3a0d 0a20 2020 2020 2020 206b  \n'):..        k
+00073950: 765f 7370 6c69 7420 3d20 6b76 2e73 706c  v_split = kv.spl
+00073960: 6974 2827 5c74 2729 0d0a 2020 2020 2020  it('\t')..      
+00073970: 2020 6966 206c 656e 286b 765f 7370 6c69    if len(kv_spli
+00073980: 7429 203e 2031 3a0d 0a20 2020 2020 2020  t) > 1:..       
+00073990: 2020 2020 2073 6974 655f 6465 7461 696c       site_detail
+000739a0: 735b 6b76 5f73 706c 6974 5b30 5d5b 313a  s[kv_split[0][1:
+000739b0: 5d5d 203d 206b 765f 7370 6c69 745b 315d  ]] = kv_split[1]
+000739c0: 5b3a 2d31 5d0d 0a20 2020 2072 6574 7572  [:-1]..    retur
+000739d0: 6e20 7369 7465 5f64 6574 6169 6c73 0d0a  n site_details..
+000739e0: 0d0a 6465 6620 5f67 6574 5f73 6974 655f  ..def _get_site_
+000739f0: 6465 7461 696c 7328 5f6c 6f67 6f6e 5f70  details(_logon_p
+00073a00: 6172 616d 6574 6572 5f69 6d70 6f72 7465  arameter_importe
+00073a10: 725f 636f 6d6d 616e 6473 2c65 6d70 6f77  r_commands,empow
+00073a20: 6572 5f69 6d70 6f72 7465 725f 6578 6563  er_importer_exec
+00073a30: 7574 6162 6c65 293a 0d0a 2020 2020 7265  utable):..    re
+00073a40: 7475 726e 205f 696e 6e65 725f 6765 745f  turn _inner_get_
+00073a50: 7369 7465 5f64 6574 6169 6c73 285f 6c6f  site_details(_lo
+00073a60: 676f 6e5f 7061 7261 6d65 7465 725f 696d  gon_parameter_im
+00073a70: 706f 7274 6572 5f63 6f6d 6d61 6e64 732c  porter_commands,
+00073a80: 656d 706f 7765 725f 696d 706f 7274 6572  empower_importer
+00073a90: 5f65 7865 6375 7461 626c 6529 0d0a 0d0a  _executable)....
+00073aa0: 6465 6620 5f63 616c 635f 6461 7465 5f69  def _calc_date_i
+00073ab0: 6e66 6f28 7374 6172 745f 6461 7465 5f73  nfo(start_date_s
+00073ac0: 7472 2c69 6e74 6572 7661 6c5f 696e 6465  tr,interval_inde
+00073ad0: 782c 6f66 6673 6574 293a 0d0a 2020 2020  x,offset):..    
+00073ae0: 5f73 7461 7274 5f64 6174 655f 7374 7220  _start_date_str 
+00073af0: 3d20 2073 7461 7274 5f64 6174 655f 7374  =  start_date_st
+00073b00: 720d 0a20 2020 205f 696e 7465 7276 616c  r..    _interval
+00073b10: 203d 2069 6e74 6572 7661 6c5f 696e 6465   = interval_inde
+00073b20: 780d 0a20 2020 205f 6f66 6673 6574 203d  x..    _offset =
+00073b30: 206f 6666 7365 740d 0a0d 0a20 2020 2069   offset....    i
+00073b40: 6620 5f73 7461 7274 5f64 6174 655f 7374  f _start_date_st
+00073b50: 7220 6973 204e 6f6e 653a 0d0a 2020 2020  r is None:..    
+00073b60: 2020 2020 5f64 6174 6520 3d20 4e6f 6e65      _date = None
+00073b70: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+00073b80: 2020 2020 2069 6620 5f69 6e74 6572 7661       if _interva
+00073b90: 6c20 3d3d 206c 6c75 2e45 4d50 4f57 4552  l == llu.EMPOWER
+00073ba0: 5f44 4159 5f43 4f4e 5354 414e 543a 0d0a  _DAY_CONSTANT:..
+00073bb0: 0d0a 2020 2020 2020 2020 2020 2020 235f  ..            #_
+00073bc0: 7374 6172 745f 6461 7465 5f73 7472 2077  start_date_str w
+00073bd0: 696c 6c20 6265 206f 6620 7468 6520 666f  ill be of the fo
+00073be0: 726d 2027 3230 3131 2720 666f 7220 4a61  rm '2011' for Ja
+00073bf0: 6e20 3230 3131 2c20 2731 2e32 3031 3127  n 2011, '1.2011'
+00073c00: 2066 6f72 2046 6562 2032 3031 310d 0a0d   for Feb 2011...
+00073c10: 0a20 2020 2020 2020 2020 2020 2064 6179  .            day
+00073c20: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+00073c30: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00073c40: 2020 2020 2020 2020 2020 2079 6561 7220             year 
+00073c50: 3d20 696e 7428 5f73 7461 7274 5f64 6174  = int(_start_dat
+00073c60: 655f 7374 722e 7370 6c69 7428 272e 2729  e_str.split('.')
+00073c70: 5b31 5d29 0d0a 2020 2020 2020 2020 2020  [1])..          
+00073c80: 2020 6578 6365 7074 2049 6e64 6578 4572    except IndexEr
+00073c90: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+00073ca0: 2020 2020 2020 6461 7920 3d20 310d 0a20        day = 1.. 
+00073cb0: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00073cc0: 6561 7220 3d20 696e 7428 5f73 7461 7274  ear = int(_start
+00073cd0: 5f64 6174 655f 7374 7229 0d0a 0d0a 2020  _date_str)....  
+00073ce0: 2020 2020 2020 2020 2020 6966 2064 6179            if day
+00073cf0: 2069 7320 4e6f 6e65 3a0d 0a20 2020 2020   is None:..     
+00073d00: 2020 2020 2020 2020 2020 2064 6179 203d             day =
+00073d10: 2069 6e74 285f 7374 6172 745f 6461 7465   int(_start_date
+00073d20: 5f73 7472 2e73 706c 6974 2827 2e27 295b  _str.split('.')[
+00073d30: 305d 2920 2b31 0d0a 0d0a 2020 2020 2020  0]) +1....      
+00073d40: 2020 2020 2020 2352 6574 7572 6e20 3173        #Return 1s
+00073d50: 7420 6f66 206d 6f6e 7468 202d 2074 6869  t of month - thi
+00073d60: 7320 6973 6e27 7420 636f 7272 6563 740d  s isn't correct.
+00073d70: 0a20 2020 2020 2020 2020 2020 205f 6461  .            _da
+00073d80: 7465 203d 2020 6461 7465 7469 6d65 2e64  te =  datetime.d
+00073d90: 6174 6574 696d 6528 7965 6172 2c31 2c31  atetime(year,1,1
+00073da0: 2920 2b20 2864 6179 202a 2044 4159 290d  ) + (day * DAY).
+00073db0: 0a20 2020 2020 2020 2020 2020 2023 5f64  .            #_d
+00073dc0: 6174 6520 3d20 4e6f 6e65 0d0a 2020 2020  ate = None..    
+00073dd0: 2020 2020 656c 6966 205f 696e 7465 7276      elif _interv
+00073de0: 616c 203d 3d20 6c6c 752e 454d 504f 5745  al == llu.EMPOWE
+00073df0: 525f 5745 454b 5f43 4f4e 5354 414e 543a  R_WEEK_CONSTANT:
+00073e00: 0d0a 0d0a 2020 2020 2020 2020 2020 2020  ....            
+00073e10: 2373 656c 662e 5f73 7461 7274 5f64 6174  #self._start_dat
+00073e20: 655f 7374 7220 7769 6c6c 2062 6520 6f66  e_str will be of
+00073e30: 2074 6865 2066 6f72 6d20 2732 3031 3127   the form '2011'
+00073e40: 2066 6f72 2051 3120 3230 3131 2c20 2735   for Q1 2011, '5
+00073e50: 2e32 3031 3127 2066 6f72 2051 3320 3230  .2011' for Q3 20
+00073e60: 3131 0d0a 2020 2020 2020 2020 2020 2020  11..            
+00073e70: 6461 7920 3d20 4e6f 6e65 0d0a 2020 2020  day = None..    
+00073e80: 2020 2020 2020 2020 7472 793a 0d0a 2020          try:..  
+00073e90: 2020 2020 2020 2020 2020 2020 2020 7965                ye
+00073ea0: 6172 203d 2069 6e74 285f 7374 6172 745f  ar = int(_start_
+00073eb0: 6461 7465 5f73 7472 2e73 706c 6974 2827  date_str.split('
+00073ec0: 2e27 295b 315d 290d 0a20 2020 2020 2020  .')[1])..       
+00073ed0: 2020 2020 2065 7863 6570 7420 496e 6465       except Inde
+00073ee0: 7845 7272 6f72 3a0d 0a20 2020 2020 2020  xError:..       
+00073ef0: 2020 2020 2020 2020 2064 6179 203d 2031           day = 1
+00073f00: 0d0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00073f10: 2020 7965 6172 203d 2069 6e74 285f 7374    year = int(_st
+00073f20: 6172 745f 6461 7465 5f73 7472 290d 0a0d  art_date_str)...
+00073f30: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00073f40: 6461 7920 6973 204e 6f6e 653a 0d0a 2020  day is None:..  
+00073f50: 2020 2020 2020 2020 2020 2020 2020 6461                da
+00073f60: 7920 3d20 696e 7428 5f73 7461 7274 5f64  y = int(_start_d
+00073f70: 6174 655f 7374 722e 7370 6c69 7428 272e  ate_str.split('.
+00073f80: 2729 5b30 5d29 202b 310d 0a0d 0a20 2020  ')[0]) +1....   
+00073f90: 2020 2020 2020 2020 2023 5265 7475 726e           #Return
+00073fa0: 2031 7374 206f 6620 6d6f 6e74 6820 2d20   1st of month - 
+00073fb0: 7468 6973 2069 736e 2774 2063 6f72 7265  this isn't corre
+00073fc0: 6374 0d0a 2020 2020 2020 2020 2020 2020  ct..            
+00073fd0: 5f64 6174 6520 3d20 2064 6174 6574 696d  _date =  datetim
+00073fe0: 652e 6461 7465 7469 6d65 2879 6561 722c  e.datetime(year,
+00073ff0: 312c 3129 202b 2028 6461 7920 2a20 4441  1,1) + (day * DA
+00074000: 5929 0d0a 2020 2020 2020 2020 2020 2020  Y)..            
+00074010: 235f 6461 7465 203d 204e 6f6e 650d 0a0d  #_date = None...
+00074020: 0a20 2020 2020 2020 2065 6c69 6620 5f69  .        elif _i
+00074030: 6e74 6572 7661 6c20 3d3d 206c 6c75 2e45  nterval == llu.E
+00074040: 4d50 4f57 4552 5f4d 4f4e 5448 5f43 4f4e  MPOWER_MONTH_CON
+00074050: 5354 414e 543a 0d0a 0d0a 2020 2020 2020  STANT:....      
+00074060: 2020 2020 2020 235f 7374 6172 745f 6461        #_start_da
+00074070: 7465 5f73 7472 2077 696c 6c20 6265 206f  te_str will be o
+00074080: 6620 7468 6520 666f 726d 2027 3230 3131  f the form '2011
+00074090: 2720 666f 7220 4a61 6e20 3230 3131 2c20  ' for Jan 2011, 
+000740a0: 2731 2e32 3031 3127 2066 6f72 2046 6562  '1.2011' for Feb
+000740b0: 2032 3031 310d 0a0d 0a20 2020 2020 2020   2011....       
+000740c0: 2020 2020 206d 6f6e 7468 203d 204e 6f6e       month = Non
+000740d0: 650d 0a20 2020 2020 2020 2020 2020 2074  e..            t
+000740e0: 7279 3a0d 0a20 2020 2020 2020 2020 2020  ry:..           
+000740f0: 2020 2020 2079 6561 7220 3d20 696e 7428       year = int(
+00074100: 5f73 7461 7274 5f64 6174 655f 7374 722e  _start_date_str.
+00074110: 7370 6c69 7428 272e 2729 5b31 5d29 0d0a  split('.')[1])..
+00074120: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00074130: 7074 2049 6e64 6578 4572 726f 723a 0d0a  pt IndexError:..
+00074140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074150: 6d6f 6e74 6820 3d20 310d 0a20 2020 2020  month = 1..     
+00074160: 2020 2020 2020 2020 2020 2079 6561 7220             year 
+00074170: 3d20 696e 7428 5f73 7461 7274 5f64 6174  = int(_start_dat
+00074180: 655f 7374 7229 0d0a 0d0a 2020 2020 2020  e_str)....      
+00074190: 2020 2020 2020 6966 206d 6f6e 7468 2069        if month i
+000741a0: 7320 4e6f 6e65 3a0d 0a20 2020 2020 2020  s None:..       
+000741b0: 2020 2020 2020 2020 206d 6f6e 7468 203d           month =
+000741c0: 2069 6e74 285f 7374 6172 745f 6461 7465   int(_start_date
+000741d0: 5f73 7472 2e73 706c 6974 2827 2e27 295b  _str.split('.')[
+000741e0: 305d 2920 2b31 0d0a 0d0a 2020 2020 2020  0]) +1....      
+000741f0: 2020 2020 2020 2352 6574 7572 6e20 3173        #Return 1s
+00074200: 7420 6f66 206d 6f6e 7468 0d0a 2020 2020  t of month..    
+00074210: 2020 2020 2020 2020 5f64 6174 6520 3d20          _date = 
+00074220: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
+00074230: 6d65 2879 6561 722c 6d6f 6e74 682c 3129  me(year,month,1)
+00074240: 0d0a 0d0a 2020 2020 2020 2020 656c 6966  ....        elif
+00074250: 205f 696e 7465 7276 616c 203d 3d20 6c6c   _interval == ll
+00074260: 752e 454d 504f 5745 525f 5155 4152 5445  u.EMPOWER_QUARTE
+00074270: 525f 434f 4e53 5441 4e54 3a0d 0a0d 0a20  R_CONSTANT:.... 
+00074280: 2020 2020 2020 2020 2020 2023 7365 6c66             #self
+00074290: 2e5f 7374 6172 745f 6461 7465 5f73 7472  ._start_date_str
+000742a0: 2077 696c 6c20 6265 206f 6620 7468 6520   will be of the 
+000742b0: 666f 726d 2027 3230 3131 2720 666f 7220  form '2011' for 
+000742c0: 5131 2032 3031 312c 2027 352e 3230 3131  Q1 2011, '5.2011
+000742d0: 2720 666f 7220 5133 2032 3031 310d 0a20  ' for Q3 2011.. 
+000742e0: 2020 2020 2020 2020 2020 206d 6f6e 7468             month
+000742f0: 203d 204e 6f6e 650d 0a20 2020 2020 2020   = None..       
+00074300: 2020 2020 2074 7279 3a0d 0a20 2020 2020       try:..     
+00074310: 2020 2020 2020 2020 2020 2079 6561 7220             year 
+00074320: 3d20 696e 7428 5f73 7461 7274 5f64 6174  = int(_start_dat
+00074330: 655f 7374 722e 7370 6c69 7428 272e 2729  e_str.split('.')
+00074340: 5b31 5d29 0d0a 2020 2020 2020 2020 2020  [1])..          
+00074350: 2020 6578 6365 7074 2049 6e64 6578 4572    except IndexEr
+00074360: 726f 723a 0d0a 2020 2020 2020 2020 2020  ror:..          
+00074370: 2020 2020 2020 6d6f 6e74 6820 3d20 310d        month = 1.
+00074380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00074390: 2079 6561 7220 3d20 696e 7428 5f73 7461   year = int(_sta
+000743a0: 7274 5f64 6174 655f 7374 7229 0d0a 0d0a  rt_date_str)....
+000743b0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+000743c0: 6f6e 7468 2069 7320 4e6f 6e65 3a0d 0a20  onth is None:.. 
+000743d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000743e0: 6f6e 7468 203d 2069 6e74 285f 7374 6172  onth = int(_star
+000743f0: 745f 6461 7465 5f73 7472 2e73 706c 6974  t_date_str.split
+00074400: 2827 2e27 295b 305d 2920 2b31 0d0a 0d0a  ('.')[0]) +1....
+00074410: 2020 2020 2020 2020 2020 2020 2352 6574              #Ret
+00074420: 7572 6e20 3173 7420 6461 7465 206f 6620  urn 1st date of 
+00074430: 7175 6172 7465 720d 0a20 2020 2020 2020  quarter..       
+00074440: 2020 2020 2023 7175 6172 7465 7220 2a20       #quarter * 
+00074450: 3320 2d20 3220 6769 7665 7320 6669 7273  3 - 2 gives firs
+00074460: 7420 6d6f 6e74 6820 6f66 2071 7561 7274  t month of quart
+00074470: 6572 0d0a 2020 2020 2020 2020 2020 2020  er..            
+00074480: 5f64 6174 6520 3d20 2064 6174 6574 696d  _date =  datetim
+00074490: 652e 6461 7465 7469 6d65 2879 6561 722c  e.datetime(year,
+000744a0: 6d6f 6e74 682c 3129 0d0a 0d0a 2020 2020  month,1)....    
+000744b0: 2020 2020 656c 6966 205f 696e 7465 7276      elif _interv
+000744c0: 616c 203d 3d20 6c6c 752e 454d 504f 5745  al == llu.EMPOWE
+000744d0: 525f 4841 4c46 5945 4152 5f43 4f4e 5354  R_HALFYEAR_CONST
+000744e0: 414e 543a 0d0a 0d0a 2020 2020 2020 2020  ANT:....        
+000744f0: 2020 2020 2373 656c 662e 5f73 7461 7274      #self._start
+00074500: 5f64 6174 655f 7374 7220 7769 6c6c 2062  _date_str will b
+00074510: 6520 6f66 2074 6865 2066 6f72 6d20 2732  e of the form '2
+00074520: 3031 3127 2066 6f72 2048 3120 3230 3131  011' for H1 2011
+00074530: 2c20 2735 2e32 3031 3127 2066 6f72 2048  , '5.2011' for H
+00074540: 3220 3230 3131 0d0a 2020 2020 2020 2020  2 2011..        
+00074550: 2020 2020 6d6f 6e74 6820 3d20 4e6f 6e65      month = None
+00074560: 0d0a 2020 2020 2020 2020 2020 2020 7472  ..            tr
+00074570: 793a 0d0a 2020 2020 2020 2020 2020 2020  y:..            
+00074580: 2020 2020 7965 6172 203d 2069 6e74 285f      year = int(_
+00074590: 7374 6172 745f 6461 7465 5f73 7472 2e73  start_date_str.s
+000745a0: 706c 6974 2827 2e27 295b 315d 290d 0a20  plit('.')[1]).. 
+000745b0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+000745c0: 7420 496e 6465 7845 7272 6f72 3a0d 0a20  t IndexError:.. 
+000745d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+000745e0: 6f6e 7468 203d 2031 0d0a 2020 2020 2020  onth = 1..      
+000745f0: 2020 2020 2020 2020 2020 7965 6172 203d            year =
+00074600: 2069 6e74 285f 7374 6172 745f 6461 7465   int(_start_date
+00074610: 5f73 7472 290d 0a0d 0a20 2020 2020 2020  _str)....       
+00074620: 2020 2020 2069 6620 6d6f 6e74 6820 6973       if month is
+00074630: 204e 6f6e 653a 0d0a 2020 2020 2020 2020   None:..        
+00074640: 2020 2020 2020 2020 6d6f 6e74 6820 3d20          month = 
+00074650: 360d 0a0d 0a20 2020 2020 2020 2020 2020  6....           
+00074660: 2023 5265 7475 726e 2031 7374 2064 6174   #Return 1st dat
+00074670: 6520 6f66 2068 616c 660d 0a20 2020 2020  e of half..     
+00074680: 2020 2020 2020 205f 6461 7465 203d 2020         _date =  
+00074690: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+000746a0: 6528 7965 6172 2c6d 6f6e 7468 2c31 290d  e(year,month,1).
+000746b0: 0a0d 0a0d 0a20 2020 2020 2020 2065 6c69  .....        eli
+000746c0: 6620 5f69 6e74 6572 7661 6c20 3d3d 206c  f _interval == l
+000746d0: 6c75 2e45 4d50 4f57 4552 5f59 4541 525f  lu.EMPOWER_YEAR_
+000746e0: 434f 4e53 5441 4e54 3a0d 0a0d 0a20 2020  CONSTANT:....   
+000746f0: 2020 2020 2020 2020 2074 7279 3a0d 0a20           try:.. 
+00074700: 2020 2020 2020 2020 2020 2020 2020 2079                 y
+00074710: 6561 7220 3d20 696e 7428 5f73 7461 7274  ear = int(_start
+00074720: 5f64 6174 655f 7374 722e 7370 6c69 7428  _date_str.split(
+00074730: 272e 2729 5b31 5d29 0d0a 2020 2020 2020  '.')[1])..      
+00074740: 2020 2020 2020 6578 6365 7074 2049 6e64        except Ind
+00074750: 6578 4572 726f 723a 0d0a 2020 2020 2020  exError:..      
+00074760: 2020 2020 2020 2020 2020 6d6f 6e74 6820            month 
+00074770: 3d20 310d 0a20 2020 2020 2020 2020 2020  = 1..           
+00074780: 2020 2020 2079 6561 7220 3d20 696e 7428       year = int(
+00074790: 5f73 7461 7274 5f64 6174 655f 7374 7229  _start_date_str)
+000747a0: 0d0a 2020 2020 2020 2020 2020 2020 2352  ..            #R
+000747b0: 6574 7572 6e20 4a61 6e75 6172 7920 3173  eturn January 1s
+000747c0: 7420 6f66 2079 6561 720d 0a20 2020 2020  t of year..     
+000747d0: 2020 2020 2020 205f 6461 7465 203d 2020         _date =  
+000747e0: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
+000747f0: 6528 7965 6172 2c31 2c31 290d 0a20 2020  e(year,1,1)..   
+00074800: 2020 2020 2065 6c73 653a 0d0a 2020 2020       else:..    
+00074810: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00074820: 6c75 6545 7272 6f72 2827 4e6f 7420 496d  lueError('Not Im
+00074830: 706c 656d 656e 7465 642e 2044 6174 6520  plemented. Date 
+00074840: 6d61 7070 696e 6720 6672 6f6d 2045 6c65  mapping from Ele
+00074850: 6d65 6e74 7320 6172 6520 6f6e 6c79 2069  ments are only i
+00074860: 6d70 6c65 6d65 6e74 6564 2066 6f72 2064  mplemented for d
+00074870: 6179 2c20 7765 656b 2c20 6d6f 6e74 682c  ay, week, month,
+00074880: 2071 7561 7274 6572 2c20 6861 6c66 2d79   quarter, half-y
+00074890: 6561 7220 616e 6420 7965 6172 2069 6e74  ear and year int
+000748a0: 6572 7661 6c73 2c20 676f 7420 7b7d 2069  ervals, got {} i
+000748b0: 6e74 6572 7661 6c5f 696e 6465 7827 2e66  nterval_index'.f
+000748c0: 6f72 6d61 7428 696e 7465 7276 616c 5f69  ormat(interval_i
+000748d0: 6e64 6578 2929 0d0a 0d0a 2020 2020 7265  ndex))....    re
+000748e0: 7475 726e 205f 6461 7465 0d0a 0d0a 2354  turn _date....#T
+000748f0: 6869 7320 6675 6e63 7469 6f6e 2074 616b  his function tak
+00074900: 6573 2061 626f 7574 2061 2030 2e32 2073  es about a 0.2 s
+00074910: 6563 6f6e 6473 2074 6f20 7275 6e2c 2061  econds to run, a
+00074920: 6e64 2069 7320 6361 6c6c 6564 206d 756c  nd is called mul
+00074930: 7469 706c 6520 7469 6d65 7320 6475 7269  tiple times duri
+00074940: 6e67 2074 6573 7469 6e67 0d0a 2342 7920  ng testing..#By 
+00074950: 6d61 6b69 6e67 2069 7420 6120 6e6f 6e2d  making it a non-
+00074960: 6d65 6d62 6572 2066 756e 6374 696f 6e2c  member function,
+00074970: 2077 6520 6361 6e20 6d6f 6e6b 6579 7061   we can monkeypa
+00074980: 7463 6820 6120 6d65 6d6f 697a 6564 2076  tch a memoized v
+00074990: 6572 7369 6f6e 2064 7572 696e 6720 7465  ersion during te
+000749a0: 7374 696e 672c 2074 6875 7320 7370 6565  sting, thus spee
+000749b0: 6469 6e67 2075 7020 7465 7374 696e 672c  ding up testing,
+000749c0: 2062 7574 2070 7265 7365 7276 696e 6720   but preserving 
+000749d0: 696e 7465 6772 6174 696f 6e20 7465 7374  integration test
+000749e0: 696e 670d 0a23 5468 6520 5f69 6e6e 6572  ing..#The _inner
+000749f0: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
+00074a00: 6675 6e63 7469 6f6e 2069 7320 746f 2070  function is to p
+00074a10: 7265 7665 6e74 2061 2072 6563 7572 7369  revent a recursi
+00074a20: 6f6e 2065 7272 6f72 2077 6865 6e20 6d6f  on error when mo
+00074a30: 6e6b 6579 7061 7463 6869 6e67 2074 6865  nkeypatching the
+00074a40: 206d 656d 6f69 7a65 6420 7665 7273 696f   memoized versio
+00074a50: 6e0d 0a64 6566 205f 696e 6e65 725f 6765  n..def _inner_ge
+00074a60: 745f 696d 706f 7274 6572 5f76 6572 7369  t_importer_versi
+00074a70: 6f6e 2865 6d70 6f77 6572 5f69 6d70 6f72  on(empower_impor
+00074a80: 7465 725f 6578 6563 7574 6162 6c65 293a  ter_executable):
+00074a90: 0d0a 0d0a 2020 2020 696d 706f 7274 6572  ....    importer
+00074aa0: 5f73 6372 6970 743d 706b 675f 7265 736f  _script=pkg_reso
+00074ab0: 7572 6365 732e 7265 736f 7572 6365 5f66  urces.resource_f
+00074ac0: 696c 656e 616d 6528 2770 796d 7078 272c  ilename('pympx',
+00074ad0: 2769 6d70 6f72 7465 725f 7363 7269 7074  'importer_script
+00074ae0: 732f 5665 7273 696f 6e2e 6569 6d70 2729  s/Version.eimp')
+00074af0: 0d0a 2020 2020 6f75 7470 7574 203d 206c  ..    output = l
+00074b00: 6c75 2e72 756e 5f65 6d70 6f77 6572 5f69  lu.run_empower_i
+00074b10: 6d70 6f72 7465 725f 7363 7269 7074 2873  mporter_script(s
+00074b20: 6372 6970 743d 696d 706f 7274 6572 5f73  cript=importer_s
+00074b30: 6372 6970 740d 0a20 2020 2020 2020 2020  cript..         
+00074b40: 2020 2020 2020 2020 2020 2020 2020 202c                 ,
+00074b50: 656d 706f 7765 725f 696d 706f 7274 6572  empower_importer
+00074b60: 5f65 7865 6375 7461 626c 653d 656d 706f  _executable=empo
+00074b70: 7765 725f 696d 706f 7274 6572 5f65 7865  wer_importer_exe
+00074b80: 6375 7461 626c 650d 0a20 2020 2020 2020  cutable..       
+00074b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00074ba0: 2029 0d0a 0d0a 2020 2020 7265 7475 726e   )....    return
+00074bb0: 205b 696e 7428 7329 2066 6f72 2073 2069   [int(s) for s i
+00074bc0: 6e20 6f75 7470 7574 2e73 7472 6970 2829  n output.strip()
+00074bd0: 2e73 706c 6974 2827 2e27 295d 0d0a 0d0a  .split('.')]....
+00074be0: 6465 6620 5f67 6574 5f69 6d70 6f72 7465  def _get_importe
+00074bf0: 725f 7665 7273 696f 6e28 656d 706f 7765  r_version(empowe
+00074c00: 725f 696d 706f 7274 6572 5f65 7865 6375  r_importer_execu
+00074c10: 7461 626c 6529 3a0d 0a20 2020 2072 6574  table):..    ret
+00074c20: 7572 6e20 5f69 6e6e 6572 5f67 6574 5f69  urn _inner_get_i
+00074c30: 6d70 6f72 7465 725f 7665 7273 696f 6e28  mporter_version(
+00074c40: 656d 706f 7765 725f 696d 706f 7274 6572  empower_importer
+00074c50: 5f65 7865 6375 7461 626c 6529 0d0a 0d0a  _executable)....
+00074c60: 6465 6620 5f64 6966 6628 6f6c 642c 206e  def _diff(old, n
+00074c70: 6577 293a 0d0a 2020 2020 2727 270d 0a20  ew):..    '''.. 
+00074c80: 2020 2046 696e 6420 7468 6520 6469 6666     Find the diff
+00074c90: 6572 656e 6365 7320 6265 7477 6565 6e20  erences between 
+00074ca0: 7477 6f20 6c69 7374 732e 2052 6574 7572  two lists. Retur
+00074cb0: 6e73 2061 206c 6973 7420 6f66 2070 6169  ns a list of pai
+00074cc0: 7273 2c20 7768 6572 6520 7468 650d 0a20  rs, where the.. 
+00074cd0: 2020 2066 6972 7374 2076 616c 7565 2069     first value i
+00074ce0: 7320 696e 205b 272b 272c 272d 272c 273d  s in ['+','-','=
+00074cf0: 275d 2061 6e64 2072 6570 7265 7365 6e74  '] and represent
+00074d00: 7320 616e 2069 6e73 6572 7469 6f6e 2c20  s an insertion, 
+00074d10: 6465 6c65 7469 6f6e 2c20 6f72 0d0a 2020  deletion, or..  
+00074d20: 2020 6e6f 2063 6861 6e67 6520 666f 7220    no change for 
+00074d30: 7468 6174 206c 6973 742e 2054 6865 2073  that list. The s
+00074d40: 6563 6f6e 6420 7661 6c75 6520 6f66 2074  econd value of t
+00074d50: 6865 2070 6169 7220 6973 2074 6865 206c  he pair is the l
+00074d60: 6973 740d 0a20 2020 206f 6620 656c 656d  ist..    of elem
+00074d70: 656e 7473 2e0d 0a20 2020 2050 6172 616d  ents...    Param
+00074d80: 733a 0d0a 2020 2020 2020 2020 6f6c 6420  s:..        old 
+00074d90: 2020 2020 7468 6520 6f6c 6420 6c69 7374      the old list
+00074da0: 206f 6620 696d 6d75 7461 626c 652c 2063   of immutable, c
+00074db0: 6f6d 7061 7261 626c 6520 7661 6c75 6573  omparable values
+00074dc0: 2028 6965 2e20 6120 6c69 7374 0d0a 2020   (ie. a list..  
+00074dd0: 2020 2020 2020 2020 2020 2020 2020 6f66                of
+00074de0: 2073 7472 696e 6773 290d 0a20 2020 2020   strings)..     
+00074df0: 2020 206e 6577 2020 2020 2074 6865 206e     new     the n
+00074e00: 6577 206c 6973 7420 6f66 2069 6d6d 7574  ew list of immut
+00074e10: 6162 6c65 2c20 636f 6d70 6172 6162 6c65  able, comparable
+00074e20: 2076 616c 7565 730d 0a0d 0a20 2020 2052   values....    R
+00074e30: 6574 7572 6e73 3a0d 0a20 2020 2020 2020  eturns:..       
+00074e40: 2041 206c 6973 7420 6f66 2070 6169 7273   A list of pairs
+00074e50: 2c20 7769 7468 2074 6865 2066 6972 7374  , with the first
+00074e60: 2070 6172 7420 6f66 2074 6865 2070 6169   part of the pai
+00074e70: 7220 6265 696e 6720 6f6e 6520 6f66 2074  r being one of t
+00074e80: 6872 6565 0d0a 2020 2020 2020 2020 7374  hree..        st
+00074e90: 7269 6e67 7320 2827 2d27 2c20 272b 272c  rings ('-', '+',
+00074ea0: 2027 3d27 2920 616e 6420 7468 6520 7365   '=') and the se
+00074eb0: 636f 6e64 2070 6172 7420 6265 696e 6720  cond part being 
+00074ec0: 6120 6c69 7374 206f 6620 7661 6c75 6573  a list of values
+00074ed0: 2066 726f 6d0d 0a20 2020 2020 2020 2074   from..        t
+00074ee0: 6865 206f 7269 6769 6e61 6c20 6f6c 6420  he original old 
+00074ef0: 616e 642f 6f72 206e 6577 206c 6973 7473  and/or new lists
+00074f00: 2e20 5468 6520 6669 7273 7420 7061 7274  . The first part
+00074f10: 206f 6620 7468 6520 7061 6972 0d0a 2020   of the pair..  
+00074f20: 2020 2020 2020 636f 7272 6573 706f 6e64        correspond
+00074f30: 7320 746f 2077 6865 7468 6572 2074 6865  s to whether the
+00074f40: 206c 6973 7420 6f66 2076 616c 7565 7320   list of values 
+00074f50: 6973 2061 2064 656c 6574 696f 6e2c 2069  is a deletion, i
+00074f60: 6e73 6572 7469 6f6e 2c20 6f72 0d0a 2020  nsertion, or..  
+00074f70: 2020 2020 2020 756e 6368 616e 6765 642c        unchanged,
+00074f80: 2072 6573 7065 6374 6976 656c 792e 0d0a   respectively...
+00074f90: 2020 2020 4578 616d 706c 6573 3a0d 0a20      Examples:.. 
+00074fa0: 2020 2020 2020 203e 3e3e 205f 6469 6666         >>> _diff
+00074fb0: 285b 312c 322c 332c 345d 2c5b 312c 332c  ([1,2,3,4],[1,3,
+00074fc0: 345d 290d 0a20 2020 2020 2020 205b 2827  4])..        [('
+00074fd0: 3d27 2c20 5b31 5d29 2c20 2827 2d27 2c20  =', [1]), ('-', 
+00074fe0: 5b32 5d29 2c20 2827 3d27 2c20 5b33 2c20  [2]), ('=', [3, 
+00074ff0: 345d 295d 0d0a 2020 2020 2020 2020 3e3e  4])]..        >>
+00075000: 3e20 5f64 6966 6628 5b31 2c32 2c33 2c34  > _diff([1,2,3,4
+00075010: 5d2c 5b32 2c33 2c34 2c31 5d29 0d0a 2020  ],[2,3,4,1])..  
+00075020: 2020 2020 2020 5b28 272d 272c 205b 315d        [('-', [1]
+00075030: 292c 2028 273d 272c 205b 322c 2033 2c20  ), ('=', [2, 3, 
+00075040: 345d 292c 2028 272b 272c 205b 315d 295d  4]), ('+', [1])]
+00075050: 0d0a 2020 2020 2020 2020 3e3e 3e20 5f64  ..        >>> _d
+00075060: 6966 6628 2754 6865 2071 7569 636b 2062  iff('The quick b
+00075070: 726f 776e 2066 6f78 206a 756d 7073 206f  rown fox jumps o
+00075080: 7665 7220 7468 6520 6c61 7a79 2064 6f67  ver the lazy dog
+00075090: 272e 7370 6c69 7428 292c 0d0a 2020 2020  '.split(),..    
+000750a0: 2020 2020 2e2e 2e20 2020 2020 2027 5468      ...      'Th
+000750b0: 6520 736c 6f77 2062 6c75 6520 6368 6565  e slow blue chee
+000750c0: 7365 2064 7269 7073 206f 7665 7220 7468  se drips over th
+000750d0: 6520 6c61 7a79 2063 6172 726f 7427 2e73  e lazy carrot'.s
+000750e0: 706c 6974 2829 290d 0a20 2020 2020 2020  plit())..       
+000750f0: 202e 2e2e 2023 2064 6f63 7465 7374 3a20   ... # doctest: 
+00075100: 2b4e 4f52 4d41 4c49 5a45 5f57 4849 5445  +NORMALIZE_WHITE
+00075110: 5350 4143 450d 0a20 2020 2020 2020 205b  SPACE..        [
+00075120: 2827 3d27 2c20 5b27 5468 6527 5d29 2c0d  ('=', ['The']),.
+00075130: 0a20 2020 2020 2020 2020 2827 2d27 2c20  .         ('-', 
+00075140: 5b27 7175 6963 6b27 2c20 2762 726f 776e  ['quick', 'brown
+00075150: 272c 2027 666f 7827 2c20 276a 756d 7073  ', 'fox', 'jumps
+00075160: 275d 292c 0d0a 2020 2020 2020 2020 2028  ']),..         (
+00075170: 272b 272c 205b 2773 6c6f 7727 2c20 2762  '+', ['slow', 'b
+00075180: 6c75 6527 2c20 2763 6865 6573 6527 2c20  lue', 'cheese', 
+00075190: 2764 7269 7073 275d 292c 0d0a 2020 2020  'drips']),..    
+000751a0: 2020 2020 2028 273d 272c 205b 276f 7665       ('=', ['ove
+000751b0: 7227 2c20 2774 6865 272c 2027 6c61 7a79  r', 'the', 'lazy
+000751c0: 275d 292c 0d0a 2020 2020 2020 2020 2028  ']),..         (
+000751d0: 272d 272c 205b 2764 6f67 275d 292c 0d0a  '-', ['dog']),..
+000751e0: 2020 2020 2020 2020 2028 272b 272c 205b           ('+', [
+000751f0: 2763 6172 726f 7427 5d29 5d0d 0a20 2020  'carrot'])]..   
+00075200: 2027 2727 0d0a 0d0a 2020 2020 2320 4372   '''....    # Cr
+00075210: 6561 7465 2061 206d 6170 2066 726f 6d20  eate a map from 
+00075220: 6f6c 6420 7661 6c75 6573 2074 6f20 7468  old values to th
+00075230: 6569 7220 696e 6469 6365 730d 0a20 2020  eir indices..   
+00075240: 206f 6c64 5f69 6e64 6578 5f6d 6170 203d   old_index_map =
+00075250: 2064 6963 7428 290d 0a20 2020 2066 6f72   dict()..    for
+00075260: 2069 2c20 7661 6c20 696e 2065 6e75 6d65   i, val in enume
+00075270: 7261 7465 286f 6c64 293a 0d0a 2020 2020  rate(old):..    
+00075280: 2020 2020 6f6c 645f 696e 6465 785f 6d61      old_index_ma
+00075290: 702e 7365 7464 6566 6175 6c74 2876 616c  p.setdefault(val
+000752a0: 2c6c 6973 7428 2929 2e61 7070 656e 6428  ,list()).append(
+000752b0: 6929 0d0a 0d0a 2020 2020 2320 4669 6e64  i)....    # Find
+000752c0: 2074 6865 206c 6172 6765 7374 2073 7562   the largest sub
+000752d0: 7374 7269 6e67 2063 6f6d 6d6f 6e20 746f  string common to
+000752e0: 206f 6c64 2061 6e64 206e 6577 2e0d 0a20   old and new... 
+000752f0: 2020 2023 2057 6520 7573 6520 6120 6479     # We use a dy
+00075300: 6e61 6d69 6320 7072 6f67 7261 6d6d 696e  namic programmin
+00075310: 6720 6170 7072 6f61 6368 2068 6572 652e  g approach here.
+00075320: 0d0a 2020 2020 230d 0a20 2020 2023 2057  ..    #..    # W
+00075330: 6520 6974 6572 6174 6520 6f76 6572 2065  e iterate over e
+00075340: 6163 6820 7661 6c75 6520 696e 2074 6865  ach value in the
+00075350: 2060 6e65 7760 206c 6973 742c 2063 616c   `new` list, cal
+00075360: 6c69 6e67 2074 6865 0d0a 2020 2020 2320  ling the..    # 
+00075370: 696e 6465 7820 6069 6e65 7760 2e20 4174  index `inew`. At
+00075380: 2065 6163 6820 6974 6572 6174 696f 6e2c   each iteration,
+00075390: 2060 6f76 6572 6c61 705b 695d 6020 6973   `overlap[i]` is
+000753a0: 2074 6865 0d0a 2020 2020 2320 6c65 6e67   the..    # leng
+000753b0: 7468 206f 6620 7468 6520 6c61 7267 6573  th of the larges
+000753c0: 7420 7375 6666 6978 206f 6620 606f 6c64  t suffix of `old
+000753d0: 5b3a 695d 6020 6571 7561 6c20 746f 2061  [:i]` equal to a
+000753e0: 2073 7566 6669 780d 0a20 2020 2023 206f   suffix..    # o
+000753f0: 6620 606e 6577 5b3a 696e 6577 5d60 2028  f `new[:inew]` (
+00075400: 6f72 2075 6e73 6574 2077 6865 6e20 606f  or unset when `o
+00075410: 6c64 5b69 5d60 2021 3d20 606e 6577 5b69  ld[i]` != `new[i
+00075420: 6e65 775d 6029 2e0d 0a20 2020 2023 0d0a  new]`)...    #..
+00075430: 2020 2020 2320 4174 2065 6163 6820 7374      # At each st
+00075440: 6167 6520 6f66 2069 7465 7261 7469 6f6e  age of iteration
+00075450: 2c20 7468 6520 6e65 7720 606f 7665 726c  , the new `overl
+00075460: 6170 6020 2863 616c 6c65 640d 0a20 2020  ap` (called..   
+00075470: 2023 2060 5f6f 7665 726c 6170 6020 756e   # `_overlap` un
+00075480: 7469 6c20 7468 6520 6f72 6967 696e 616c  til the original
+00075490: 2060 6f76 6572 6c61 7060 2069 7320 6e6f   `overlap` is no
+000754a0: 206c 6f6e 6765 7220 6e65 6564 6564 290d   longer needed).
+000754b0: 0a20 2020 2023 2069 7320 6275 696c 7420  .    # is built 
+000754c0: 6672 6f6d 2074 6865 206f 6c64 206f 6e65  from the old one
+000754d0: 2e0d 0a20 2020 2023 0d0a 2020 2020 2320  ...    #..    # 
+000754e0: 4966 2074 6865 206c 656e 6774 6820 6f66  If the length of
+000754f0: 206f 7665 726c 6170 2065 7863 6565 6473   overlap exceeds
+00075500: 2074 6865 206c 6172 6765 7374 2073 7562   the largest sub
+00075510: 7374 7269 6e67 0d0a 2020 2020 2320 7365  string..    # se
+00075520: 656e 2073 6f20 6661 7220 2860 7375 625f  en so far (`sub_
+00075530: 6c65 6e67 7468 6029 2c20 7765 2075 7064  length`), we upd
+00075540: 6174 6520 7468 6520 6c61 7267 6573 7420  ate the largest 
+00075550: 7375 6273 7472 696e 670d 0a20 2020 2023  substring..    #
+00075560: 2074 6f20 7468 6520 6f76 6572 6c61 7070   to the overlapp
+00075570: 696e 6720 7374 7269 6e67 732e 0d0a 0d0a  ing strings.....
+00075580: 2020 2020 6f76 6572 6c61 7020 3d20 6469      overlap = di
+00075590: 6374 2829 0d0a 2020 2020 2320 6073 7562  ct()..    # `sub
+000755a0: 5f73 7461 7274 5f6f 6c64 6020 6973 2074  _start_old` is t
+000755b0: 6865 2069 6e64 6578 206f 6620 7468 6520  he index of the 
+000755c0: 6265 6769 6e6e 696e 6720 6f66 2074 6865  beginning of the
+000755d0: 206c 6172 6765 7374 206f 7665 726c 6170   largest overlap
+000755e0: 7069 6e67 0d0a 2020 2020 2320 7375 6273  ping..    # subs
+000755f0: 7472 696e 6720 696e 2074 6865 206f 6c64  tring in the old
+00075600: 206c 6973 742e 2060 7375 625f 7374 6172   list. `sub_star
+00075610: 745f 6e65 7760 2069 7320 7468 6520 696e  t_new` is the in
+00075620: 6465 7820 6f66 2074 6865 2062 6567 696e  dex of the begin
+00075630: 6e69 6e67 0d0a 2020 2020 2320 6f66 2074  ning..    # of t
+00075640: 6865 2073 616d 6520 7375 6273 7472 696e  he same substrin
+00075650: 6720 696e 2074 6865 206e 6577 206c 6973  g in the new lis
+00075660: 742e 2060 7375 625f 6c65 6e67 7468 6020  t. `sub_length` 
+00075670: 6973 2074 6865 206c 656e 6774 6820 7468  is the length th
+00075680: 6174 0d0a 2020 2020 2320 6f76 6572 6c61  at..    # overla
+00075690: 7073 2069 6e20 626f 7468 2e0d 0a20 2020  ps in both...   
+000756a0: 2023 2054 6865 7365 2074 7261 636b 2074   # These track t
+000756b0: 6865 206c 6172 6765 7374 206f 7665 726c  he largest overl
+000756c0: 6170 7069 6e67 2073 7562 7374 7269 6e67  apping substring
+000756d0: 2073 6565 6e20 736f 2066 6172 2c20 736f   seen so far, so
+000756e0: 206e 6174 7572 616c 6c79 0d0a 2020 2020   naturally..    
+000756f0: 2320 7765 2073 7461 7274 2077 6974 6820  # we start with 
+00075700: 6120 302d 6c65 6e67 7468 2073 7562 7374  a 0-length subst
+00075710: 7269 6e67 2e0d 0a20 2020 2073 7562 5f73  ring...    sub_s
+00075720: 7461 7274 5f6f 6c64 203d 2030 0d0a 2020  tart_old = 0..  
+00075730: 2020 7375 625f 7374 6172 745f 6e65 7720    sub_start_new 
+00075740: 3d20 300d 0a20 2020 2073 7562 5f6c 656e  = 0..    sub_len
+00075750: 6774 6820 3d20 300d 0a0d 0a20 2020 2066  gth = 0....    f
+00075760: 6f72 2069 6e65 772c 2076 616c 2069 6e20  or inew, val in 
+00075770: 656e 756d 6572 6174 6528 6e65 7729 3a0d  enumerate(new):.
+00075780: 0a20 2020 2020 2020 205f 6f76 6572 6c61  .        _overla
+00075790: 7020 3d20 6469 6374 2829 0d0a 2020 2020  p = dict()..    
+000757a0: 2020 2020 666f 7220 696f 6c64 2069 6e20      for iold in 
+000757b0: 6f6c 645f 696e 6465 785f 6d61 702e 6765  old_index_map.ge
+000757c0: 7428 7661 6c2c 6c69 7374 2829 293a 0d0a  t(val,list()):..
+000757d0: 2020 2020 2020 2020 2020 2020 2320 6e6f              # no
+000757e0: 7720 7765 2061 7265 2063 6f6e 7369 6465  w we are conside
+000757f0: 7269 6e67 2061 6c6c 2076 616c 7565 7320  ring all values 
+00075800: 6f66 2069 6f6c 6420 7375 6368 2074 6861  of iold such tha
+00075810: 740d 0a20 2020 2020 2020 2020 2020 2023  t..            #
+00075820: 2060 6f6c 645b 696f 6c64 5d20 3d3d 206e   `old[iold] == n
+00075830: 6577 5b69 6e65 775d 602e 0d0a 2020 2020  ew[inew]`...    
+00075840: 2020 2020 2020 2020 5f6f 7665 726c 6170          _overlap
+00075850: 5b69 6f6c 645d 203d 2028 696f 6c64 2061  [iold] = (iold a
+00075860: 6e64 206f 7665 726c 6170 2e67 6574 2869  nd overlap.get(i
+00075870: 6f6c 6420 2d20 312c 2030 2929 202b 2031  old - 1, 0)) + 1
+00075880: 0d0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00075890: 285f 6f76 6572 6c61 705b 696f 6c64 5d20  (_overlap[iold] 
+000758a0: 3e20 7375 625f 6c65 6e67 7468 293a 0d0a  > sub_length):..
+000758b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000758c0: 2320 7468 6973 2069 7320 7468 6520 6c61  # this is the la
+000758d0: 7267 6573 7420 7375 6273 7472 696e 6720  rgest substring 
+000758e0: 7365 656e 2073 6f20 6661 722c 2073 6f20  seen so far, so 
+000758f0: 7374 6f72 6520 6974 730d 0a20 2020 2020  store its..     
+00075900: 2020 2020 2020 2020 2020 2023 2069 6e64             # ind
+00075910: 6963 6573 0d0a 2020 2020 2020 2020 2020  ices..          
+00075920: 2020 2020 2020 7375 625f 6c65 6e67 7468        sub_length
+00075930: 203d 205f 6f76 6572 6c61 705b 696f 6c64   = _overlap[iold
+00075940: 5d0d 0a20 2020 2020 2020 2020 2020 2020  ]..             
+00075950: 2020 2073 7562 5f73 7461 7274 5f6f 6c64     sub_start_old
+00075960: 203d 2069 6f6c 6420 2d20 7375 625f 6c65   = iold - sub_le
+00075970: 6e67 7468 202b 2031 0d0a 2020 2020 2020  ngth + 1..      
+00075980: 2020 2020 2020 2020 2020 7375 625f 7374            sub_st
+00075990: 6172 745f 6e65 7720 3d20 696e 6577 202d  art_new = inew -
+000759a0: 2073 7562 5f6c 656e 6774 6820 2b20 310d   sub_length + 1.
+000759b0: 0a20 2020 2020 2020 206f 7665 726c 6170  .        overlap
+000759c0: 203d 205f 6f76 6572 6c61 700d 0a0d 0a20   = _overlap.... 
+000759d0: 2020 2069 6620 7375 625f 6c65 6e67 7468     if sub_length
+000759e0: 203d 3d20 303a 0d0a 2020 2020 2020 2020   == 0:..        
+000759f0: 2320 4966 206e 6f20 636f 6d6d 6f6e 2073  # If no common s
+00075a00: 7562 7374 7269 6e67 2069 7320 666f 756e  ubstring is foun
+00075a10: 642c 2077 6520 7265 7475 726e 2061 6e20  d, we return an 
+00075a20: 696e 7365 7274 2061 6e64 2064 656c 6574  insert and delet
+00075a30: 652e 2e2e 0d0a 2020 2020 2020 2020 7265  e.....        re
+00075a40: 7475 726e 2028 6f6c 6420 616e 6420 5b28  turn (old and [(
+00075a50: 272d 272c 206f 6c64 295d 206f 7220 5b5d  '-', old)] or []
+00075a60: 2920 2b20 286e 6577 2061 6e64 205b 2827  ) + (new and [('
+00075a70: 2b27 2c20 6e65 7729 5d20 6f72 205b 5d29  +', new)] or [])
+00075a80: 0d0a 2020 2020 656c 7365 3a0d 0a20 2020  ..    else:..   
+00075a90: 2020 2020 2023 202e 2e2e 6f74 6865 7277       # ...otherw
+00075aa0: 6973 652c 2074 6865 2063 6f6d 6d6f 6e20  ise, the common 
+00075ab0: 7375 6273 7472 696e 6720 6973 2075 6e63  substring is unc
+00075ac0: 6861 6e67 6564 2061 6e64 2077 6520 7265  hanged and we re
+00075ad0: 6375 7273 6976 656c 790d 0a20 2020 2020  cursively..     
+00075ae0: 2020 2023 2064 6966 6620 7468 6520 7465     # diff the te
+00075af0: 7874 2062 6566 6f72 6520 616e 6420 6166  xt before and af
+00075b00: 7465 7220 7468 6174 2073 7562 7374 7269  ter that substri
+00075b10: 6e67 0d0a 2020 2020 2020 2020 7265 7475  ng..        retu
+00075b20: 726e 205f 6469 6666 286f 6c64 5b20 3a20  rn _diff(old[ : 
+00075b30: 7375 625f 7374 6172 745f 6f6c 645d 2c20  sub_start_old], 
+00075b40: 6e65 775b 203a 2073 7562 5f73 7461 7274  new[ : sub_start
+00075b50: 5f6e 6577 5d29 202b 205c 0d0a 2020 2020  _new]) + \..    
+00075b60: 2020 2020 2020 2020 2020 205b 2827 3d27             [('='
+00075b70: 2c20 6e65 775b 7375 625f 7374 6172 745f  , new[sub_start_
+00075b80: 6e65 7720 3a20 7375 625f 7374 6172 745f  new : sub_start_
+00075b90: 6e65 7720 2b20 7375 625f 6c65 6e67 7468  new + sub_length
+00075ba0: 5d29 5d20 2b20 5c0d 0a20 2020 2020 2020  ])] + \..       
+00075bb0: 2020 2020 2020 2020 5f64 6966 6628 6f6c          _diff(ol
+00075bc0: 645b 7375 625f 7374 6172 745f 6f6c 6420  d[sub_start_old 
+00075bd0: 2b20 7375 625f 6c65 6e67 7468 203a 205d  + sub_length : ]
+00075be0: 2c0d 0a20 2020 2020 2020 2020 2020 2020  ,..             
+00075bf0: 2020 2020 2020 2020 2020 6e65 775b 7375            new[su
+00075c00: 625f 7374 6172 745f 6e65 7720 2b20 7375  b_start_new + su
+00075c10: 625f 6c65 6e67 7468 203a 205d 290d 0a0d  b_length : ])...
+00075c20: 0a23 6d75 7461 626c 6520 636f 756e 7465  .#mutable counte
+00075c30: 7220 2d20 696e 7465 6765 7273 2077 696c  r - integers wil
+00075c40: 6c20 6b65 6570 2072 6573 6574 7469 6e67  l keep resetting
+00075c50: 2077 6865 6e20 7765 2063 6f75 6e74 0d0a   when we count..
+00075c60: 636c 6173 7320 5f43 6f75 6e74 6572 286f  class _Counter(o
+00075c70: 626a 6563 7429 3a0d 0a20 2020 2064 6566  bject):..    def
+00075c80: 205f 5f69 6e69 745f 5f28 7365 6c66 293a   __init__(self):
+00075c90: 0d0a 2020 2020 2020 2020 7365 6c66 2e63  ..        self.c
+00075ca0: 6f75 6e74 6572 203d 2030 0d0a 2020 2020  ounter = 0..    
+00075cb0: 6465 6620 5f5f 7374 725f 5f28 7365 6c66  def __str__(self
+00075cc0: 293a 0d0a 2020 2020 2020 2020 7365 6c66  ):..        self
+00075cd0: 2e63 6f75 6e74 6572 2b3d 310d 0a20 2020  .counter+=1..   
+00075ce0: 2020 2020 2072 6574 7572 6e20 2728 272b       return '('+
+00075cf0: 7374 7228 7365 6c66 2e63 6f75 6e74 6572  str(self.counter
+00075d00: 2d31 292b 2729 270d 0a                   -1)+')'..
```

## Comparing `PyMPX-1.2.4.dist-info/LICENSE.txt` & `PyMPX-1.2.5.dist-info/LICENSE.txt`

 * *Files identical despite different names*

## Comparing `PyMPX-1.2.4.dist-info/METADATA` & `PyMPX-1.2.5.dist-info/METADATA`

 * *Files 17% similar despite different names*

```diff
@@ -1,40 +1,41 @@
-Metadata-Version: 2.1
-Name: PyMPX
-Version: 1.2.4
-Summary: Metapraxis Empower python API
-Author: Metapraxis Ltd.
-Author-email: pympx@metapraxis.com
-Maintainer: Jonathan Adrian Treloar
-License: MIT License
-Project-URL: Documentation, https://api.metapraxis.com
-Classifier: Programming Language :: Python :: 3
-Classifier: License :: OSI Approved :: MIT License
-Classifier: Development Status :: 5 - Production/Stable
-Classifier: Intended Audience :: Developers
-Classifier: Natural Language :: English
-Classifier: Operating System :: Microsoft :: Windows
-Classifier: Topic :: Database :: Database Engines/Servers
-Classifier: Topic :: Office/Business :: Financial
-Requires-Python: >=3
-Description-Content-Type: text/x-rst
-License-File: LICENSE.txt
-Requires-Dist: pywin32
-Requires-Dist: cryptography
-Requires-Dist: pandas
-
-PyMPX
-======================
-
-The PyMPX package contains the `pympx` module for manipulating Metapraxis Empower sites.
-
-Repetitive, manual tasks can be replaced with reliable batch code to:
-
-+ Manipulate hierarchies and create new dimension elements and structures
-+ Run Empower importer and batch commands, gracefully handling any errors
-+ Bulk load data in parallel into an Empower site, significantly reducing loading times
-
-The PyMPX package also contains the smaller modules that help you write good ETL batch processes using Python and the `pympx` module.
-
-+ Do standard logging processes
-+ Parameterize and run Jupyter notebooks as part of a batch script
-+ Parallelize batch processes with directory-based queues
+Metadata-Version: 2.1
+Name: PyMPX
+Version: 1.2.5
+Summary: Metapraxis Empower python API
+Author: Metapraxis Ltd.
+Author-email: pympx@metapraxis.com
+Maintainer: Jonathan Adrian Treloar
+License: MIT License
+Project-URL: Documentation, https://api.metapraxis.com
+Classifier: Programming Language :: Python :: 3
+Classifier: License :: OSI Approved :: MIT License
+Classifier: Development Status :: 5 - Production/Stable
+Classifier: Intended Audience :: Developers
+Classifier: Natural Language :: English
+Classifier: Operating System :: Microsoft :: Windows
+Classifier: Topic :: Database :: Database Engines/Servers
+Classifier: Topic :: Office/Business :: Financial
+Requires-Python: >=3
+Description-Content-Type: text/x-rst
+License-File: LICENSE.txt
+Requires-Dist: pywin32
+Requires-Dist: cryptography
+Requires-Dist: pandas
+Requires-Dist: packaging
+
+PyMPX
+======================
+
+The PyMPX package contains the `pympx` module for manipulating Metapraxis Empower sites.
+
+Repetitive, manual tasks can be replaced with reliable batch code to:
+
++ Manipulate hierarchies and create new dimension elements and structures
++ Run Empower importer and batch commands, gracefully handling any errors
++ Bulk load data in parallel into an Empower site, significantly reducing loading times
+
+The PyMPX package also contains the smaller modules that help you write good ETL batch processes using Python and the `pympx` module.
+
++ Do standard logging processes
++ Parameterize and run Jupyter notebooks as part of a batch script
++ Parallelize batch processes with directory-based queues
```

## Comparing `PyMPX-1.2.4.dist-info/RECORD` & `PyMPX-1.2.5.dist-info/RECORD`

 * *Files 4% similar despite different names*

```diff
@@ -1,15 +1,15 @@
 pympx/__init__.py,sha256=3UE2iqGBpVDQTBJj_Dsp_rVLKvWhuQl9KX9l78AmBSc,103
-pympx/_version.py,sha256=76ZKYbt1YT9TJ9XFnJZTliRBmaZCYZl3Yh09rUrg2UQ,20
+pympx/_version.py,sha256=s3vZL9De0VxgfNO-7G64sFP0ikXFumy5zNUncHWGpgk,20
 pympx/etl.py,sha256=FmP7q7el4xoKngsqGz_Vc5iquBxkHa2NzzngqgCb9qQ,4312
 pympx/exceptions.py,sha256=1xzqj8tvZRTXbRoZYWM5CRD7GaUxwNkDjSp1WqTL4WA,4901
 pympx/jupyter.py,sha256=xhW5Mh2xtzV7HKZTbAVDF1cwvSJsymI6M8p0vZ4Djwc,13157
 pympx/logconfig.py,sha256=s31eXWzug7ZhZn6rhE16Yp2ToF4AEqbP7W6fKqbChRA,12486
-pympx/low_level_utilities.py,sha256=jwcZRo-QhO5znQeOZGX7veK6lTSQnJo6JONu3vGSdd4,265668
-pympx/pympx.py,sha256=jTsOukMGw1iHANV8dTqiZc4BsI3RRuhwSn8s3nnWnwQ,482525
+pympx/low_level_utilities.py,sha256=vpUTgiD27TH499kUCTVXP2-sVHWjYZkO7lcAYfHHM-w,265773
+pympx/pympx.py,sha256=UF-ANKAgf5DC92GUVTI_z0t_3ASRhmyK3WmznU8_xKY,482569
 pympx/queuing.py,sha256=UAg2s5u_9yuSt7kaxE8V0a_AGM_9Ny3QmqgFpLPFNhA,104961
 pympx/utils.py,sha256=8_7WeHsuIm4Tv9c3Qoj7hnqb5VyW0xEj86F0VxGSHOI,10542
 pympx/validation.py,sha256=NgPyKtdOF86u2HXjirRXkPr_cnHI0vzoyTXQqkez1PE,12493
 pympx/importer_scripts/Add_Time_Elements_to_Site.eimp,sha256=g0VU81Yayqb38uQ5QbTsKWcFSgK5S4jKfsoYqx1mkZE,152
 pympx/importer_scripts/BulkImport.eimp,sha256=2eWoVaEJ5Q-Ko16dc9GoKNNuCa96k84dfgQifYDs388,1097
 pympx/importer_scripts/EmpowerImport.eimp,sha256=liPYFN9NZnWvTWgxKRWAHq5vQn5iosa8Eew_e1imCz4,1069
 pympx/importer_scripts/ExportAllDimensionElements.eimp,sha256=eoETXMy200CDVqbvSEl3WkxSqfJxxiAaHkP1zcIClNo,3308
@@ -33,13 +33,13 @@
 pympx/importer_scripts/ImportDimensionFields.eimp,sha256=TAiEo9OY0pSuIGxRCNNHFGtUq5WFRvqtjPWpom7S_Qo,822
 pympx/importer_scripts/ImportDimensionStructure.eimp,sha256=ViK5YchoRTbb248Th2Vh0nhi6yS-XVzKdWlrd5pG8IY,745
 pympx/importer_scripts/ImportSecurity.eimp,sha256=1ohRgkWkQTdyMw0_s-SXayEV5xifDmD5ust2RPQCg2c,888
 pympx/importer_scripts/ImportTimeDimensionElements.eimp,sha256=_xOr42u6UrsHTFt-vz-xETrjuiuqiCiAwXSILYAAH1k,731
 pympx/importer_scripts/LoadCommentaryData.eimp,sha256=DS-kohksPSC304rzjxr0fRES18YYqcFHQgWwB-z9maw,1082
 pympx/importer_scripts/LoadCommentaryText.eimp,sha256=J3hU2bpevW1OEsvFv2GnkwI43UbSuGklcPcCQ1m6iDY,1096
 pympx/importer_scripts/Version.eimp,sha256=10iTFfsr970K7L0Fmyr1AA0fpEm8jtu73XjP_fT7aIU,314
-PyMPX-1.2.4.dist-info/LICENSE.txt,sha256=jR1jA78eI030A8d3a0v2dAmainM6Gvb1KjKmtux-U-U,1076
-PyMPX-1.2.4.dist-info/METADATA,sha256=_QTeKp-eYRQM9xw1Llv6Vpba3zPnTMMcrACynnrTvqA,1537
-PyMPX-1.2.4.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-PyMPX-1.2.4.dist-info/eager_resources.txt,sha256=ekklpDUDt_hCby2mrjjrI6tAmwJ8L0NlqgFLX7xPFTU,30
-PyMPX-1.2.4.dist-info/top_level.txt,sha256=QpVfwdq850WAzPeylp1eUzdeZRokzJV2PmrNqyZRleY,6
-PyMPX-1.2.4.dist-info/RECORD,,
+PyMPX-1.2.5.dist-info/LICENSE.txt,sha256=jR1jA78eI030A8d3a0v2dAmainM6Gvb1KjKmtux-U-U,1076
+PyMPX-1.2.5.dist-info/METADATA,sha256=4AIIqoZr6igZlNZpuLjvEGswzIc7vKg47xwhirX_uVY,1603
+PyMPX-1.2.5.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+PyMPX-1.2.5.dist-info/eager_resources.txt,sha256=ekklpDUDt_hCby2mrjjrI6tAmwJ8L0NlqgFLX7xPFTU,30
+PyMPX-1.2.5.dist-info/top_level.txt,sha256=QpVfwdq850WAzPeylp1eUzdeZRokzJV2PmrNqyZRleY,6
+PyMPX-1.2.5.dist-info/RECORD,,
```

